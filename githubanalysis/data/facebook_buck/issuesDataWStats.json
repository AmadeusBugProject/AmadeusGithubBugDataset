{"bugLabels": ["bug"], "issues": [{"created": "2020-03-06 21:21:02", "closed": "2020-06-18 17:54:45", "commits": {}, "ttf": 103.00027777777778, "body": "Cache Keys seem to rely on the existence of the abi jars to use the class hashes in the manifest.\r\n\r\nThose exist in abi-jars and do not exist in regular jars. Example from auto-common class-abi jar:\r\n\r\n```\r\nName: META-INF/maven/com.google.auto/auto-common/pom.properties\r\nMurmur3-128-Digest: f0a85b9e5b58819ae2fb78dcae1fd8fe\r\n\r\nName: META-INF/maven/com.google.auto/auto-common/pom.xml\r\nMurmur3-128-Digest: 23d7b80d435851d717f5aafe4b6c9093\r\n\r\nName: com/google/auto/common/AnnotationMirrors.class\r\nMurmur3-128-Digest: 01ddba71bc0e914c39ea3150c5b091f3\r\n...\r\n```\r\n\r\n\r\n\r\nWhen turning generate_abis = False on the prebuilt_jar the following error occurs. (even when compile_against_abis = false)\r\n\r\nThis doesn't happen when compiling the target directly or when it's used as a direct dep. It occurs when it's a transitive grandchild dep is marked to not generate_abis and that is referenced in code by the direct child.\r\n\r\n```\r\nBuck encountered an internal error\r\ncom.facebook.buck.command.Build$BuildExecutionException: com.facebook.buck.core.exceptions.BuckUncheckedExecutionException: When finalizing rule.: com.facebook.buck.core.exceptions.BuckUncheckedExecutionException: When amending buildableForRuleKey.: com.facebook.buck.core.exceptions.BuckUncheckedExecutionException: When amending jarBuildStepsFactory.: com.facebook.buck.core.exceptions.BuckUncheckedExecutionException: When amending abiClasspath.: java.lang.UnsupportedOperationException: Cache does not know how to return hash codes for archive members except when the archive contains a META-INF/MANIFEST.MF with Murmur3-128-Digest attributes for each file.\r\n\tat com.facebook.buck.command.Build.waitForBuildToFinish(Build.java:297)\r\n\tat com.facebook.buck.command.Build.waitForBuildToFinishAndPrintFailuresToEventBus(Build.java:394)\r\n\tat com.facebook.buck.command.Build.executeAndPrintFailuresToEventBus(Build.java:136)\r\n\tat com.facebook.buck.command.BuildExecutor.buildTargets(BuildExecutor.java:111)\r\n\tat com.facebook.buck.cli.BuildCommand.executeLocalBuild(BuildCommand.java:899)\r\n\tat com.facebook.buck.cli.BuildCommand.executeBuildAndProcessResult(BuildCommand.java:494)\r\n\tat com.facebook.buck.cli.BuildCommand.run(BuildCommand.java:363)\r\n\tat com.facebook.buck.cli.BuildCommand.runWithoutHelpInternal(BuildCommand.java:305)\r\n\tat com.facebook.buck.cli.BuildCommand.runWithoutHelp(BuildCommand.java:287)\r\n\tat com.facebook.buck.cli.AbstractCommand.run(AbstractCommand.java:280)\r\n\tat com.facebook.buck.cli.AbstractContainerCommand.run(AbstractContainerCommand.java:90)\r\n\tat com.facebook.buck.cli.MainRunner.runMainWithExitCode(MainRunner.java:1446)\r\n\tat com.facebook.buck.cli.MainRunner.runMainThenExit(MainRunner.java:477)\r\n\tat com.facebook.buck.cli.MainWithNailgun.nailMain(MainWithNailgun.java:77)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat com.facebook.nailgun.NGSession.runImpl(NGSession.java:313)\r\n\tat com.facebook.nailgun.NGSession.run(NGSession.java:199)\r\n```", "title": "Prebuilt_jars : generate_abis = False breaks transitive deps.", "commitsDetails": [], "labels": ["P1", "bug"], "url": "https://github.com/facebook/buck/issues/2411", "user": "tyvsmith"}, {"created": "2020-03-06 21:15:48", "closed": "2020-06-18 17:54:18", "commits": {}, "ttf": 103.00027777777778, "body": "When using compile_against_abis for kotlin, some jetbrains/android artifacts contain a javaslang package, it looks like the PatternsProcessor class isn't being accurately represented in the ABI jar that's generated. The class itself doesn't seem like anything special, so not sure why it's failing.\r\n\r\n\r\n\r\nUsing\r\n```\r\n[kotlin]\r\n    compile_against_abis = true\r\n```\r\n\r\nPrebuilt Jars pulled:\r\n\r\n - org.jetbrains.kotlin:kotlin-compiler-embeddable:jar:1.3.61\r\n - com.android.tools.external.com-intellij:intellij-core:jar:26.6.0-rc02\r\n\r\n\r\nStacktrace:\r\n\r\n```\r\nexception: java.lang.ClassFormatError: Absent Code attribute in method that is not native or abstract in class file javaslang/match/PatternsProcessor\r\n\tat java.lang.ClassLoader.defineClass1(Native Method)\r\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:763)\r\n\tat java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)\r\n\tat java.net.URLClassLoader.defineClass(URLClassLoader.java:468)\r\n\tat java.net.URLClassLoader.access$100(URLClassLoader.java:74)\r\n\tat java.net.URLClassLoader$1.run(URLClassLoader.java:369)\r\n\tat java.net.URLClassLoader$1.run(URLClassLoader.java:363)\r\n\tat java.security.AccessController.doPrivileged(Native Method)\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:362)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\n\tat java.lang.Class.forName0(Native Method)\r\n\tat java.lang.Class.forName(Class.java:348)\r\n\tat org.jetbrains.kotlin.cli.jvm.plugins.ServiceLoaderLite.loadImplementations(ServiceLoaderLite.kt:51)\r\n\tat org.jetbrains.kotlin.cli.jvm.plugins.ServiceLoaderLite.loadImplementations(ServiceLoaderLite.kt:44)\r\n\tat org.jetbrains.kotlin.kapt3.ClasspathBasedKapt3Extension$loadProcessors$efficientProcessorLoader$1.doLoadProcessors(Kapt3Extension.kt:83)\r\n\tat org.jetbrains.kotlin.kapt3.base.ProcessorLoader.loadProcessors(ProcessorLoader.kt:45)\r\n\tat org.jetbrains.kotlin.kapt3.base.ProcessorLoader.loadProcessors$default(ProcessorLoader.kt:28)\r\n\tat org.jetbrains.kotlin.kapt3.ClasspathBasedKapt3Extension.loadProcessors(Kapt3Extension.kt:88)\r\n\tat org.jetbrains.kotlin.kapt3.AbstractKapt3Extension.analysisCompleted(Kapt3Extension.kt:171)\r\n\tat org.jetbrains.kotlin.kapt3.ClasspathBasedKapt3Extension.analysisCompleted(Kapt3Extension.kt:98)\r\n\tat org.jetbrains.kotlin.cli.jvm.compiler.TopDownAnalyzerFacadeForJVM$analyzeFilesWithJavaIntegration$2.invoke(TopDownAnalyzerFacadeForJVM.kt:97)\r\n\tat org.jetbrains.kotlin.cli.jvm.compiler.TopDownAnalyzerFacadeForJVM.analyzeFilesWithJavaIntegration(TopDownAnalyzerFacadeForJVM.kt:107)\r\n\tat org.jetbrains.kotlin.cli.jvm.compiler.TopDownAnalyzerFacadeForJVM.analyzeFilesWithJavaIntegration$default(TopDownAnalyzerFacadeForJVM.kt:82)\r\n\tat org.jetbrains.kotlin.cli.jvm.compiler.KotlinToJVMBytecodeCompiler$analyze$1.invoke(KotlinToJVMBytecodeCompiler.kt:557)\r\n\tat org.jetbrains.kotlin.cli.jvm.compiler.KotlinToJVMBytecodeCompiler$analyze$1.invoke(KotlinToJVMBytecodeCompiler.kt:82)\r\n\tat org.jetbrains.kotlin.cli.common.messages.AnalyzerWithCompilerReport.analyzeAndReport(AnalyzerWithCompilerReport.kt:107)\r\n\tat org.jetbrains.kotlin.cli.jvm.compiler.KotlinToJVMBytecodeCompiler.analyze(KotlinToJVMBytecodeCompiler.kt:548)\r\n\tat org.jetbrains.kotlin.cli.jvm.compiler.KotlinToJVMBytecodeCompiler.compileModules$cli(KotlinToJVMBytecodeCompiler.kt:177)\r\n\tat org.jetbrains.kotlin.cli.jvm.K2JVMCompiler.doExecute(K2JVMCompiler.kt:165)\r\n\tat org.jetbrains.kotlin.cli.jvm.K2JVMCompiler.doExecute(K2JVMCompiler.kt:55)\r\n\tat org.jetbrains.kotlin.cli.common.CLICompiler.execImpl(CLICompiler.kt:84)\r\n\tat org.jetbrains.kotlin.cli.common.CLICompiler.execImpl(CLICompiler.kt:42)\r\n\tat org.jetbrains.kotlin.cli.common.CLITool.exec(CLITool.kt:104)\r\n\tat org.jetbrains.kotlin.cli.common.CLITool.exec(CLITool.kt:82)\r\n\tat org.jetbrains.kotlin.cli.common.CLITool.exec(CLITool.kt:50)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat com.facebook.buck.jvm.kotlin.JarBackedReflectedKotlinc.buildWithClasspath(JarBackedReflectedKotlinc.java:213)\r\n\tat com.facebook.buck.jvm.kotlin.KotlincStep.execute(KotlincStep.java:101)\r\n\tat com.facebook.buck.step.StepRunner.runStep(StepRunner.java:62)\r\n\tat com.facebook.buck.core.build.engine.impl.CachingBuildRuleBuilder$BuildRuleSteps.executeCommands(CachingBuildRuleBuilder.java:1418)\r\n\tat com.facebook.buck.core.build.engine.impl.CachingBuildRuleBuilder$BuildRuleSteps.runWithDefaultExecutor(CachingBuildRuleBuilder.java:1395)\r\n\tat com.facebook.buck.core.build.engine.impl.CachingBuildRuleBuilder$2.runWithDefaultBehavior(CachingBuildRuleBuilder.java:859)\r\n\tat com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleAsyncTask.runInterruptibly(TrustedListenableFutureTask.java:162)\r\n\tat com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleAsyncTask.runInterruptibly(TrustedListenableFutureTask.java:145)\r\n\tat com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:57)\r\n\tat com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:80)\r\n\tat com.facebook.buck.util.concurrent.WeightedListeningExecutorService.lambda$submit$2(WeightedListeningExecutorService.java:100)\r\n\tat com.facebook.buck.util.concurrent.WeightedListeningExecutorService.lambda$submitWithSemaphore$0(WeightedListeningExecutorService.java:74)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture$AsyncTransformFuture.doTransform(AbstractTransformFuture.java:206)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture$AsyncTransformFuture.doTransform(AbstractTransformFuture.java:195)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture.run(AbstractTransformFuture.java:115)\r\n\tat com.google.common.util.concurrent.MoreExecutors$5$1.run(MoreExecutors.java:999)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n\r\nDecompiled class for reference.\r\n```\r\npackage javaslang.match;\r\n\r\nimport java.io.IOException;\r\nimport java.io.Writer;\r\nimport java.util.Collections;\r\nimport java.util.HashSet;\r\nimport java.util.List;\r\nimport java.util.Set;\r\nimport java.util.stream.Collectors;\r\nimport javaslang.match.generator.Generator;\r\nimport javaslang.match.model.ClassModel;\r\nimport javaslang.match.model.MethodModel;\r\nimport javax.annotation.processing.AbstractProcessor;\r\nimport javax.annotation.processing.Filer;\r\nimport javax.annotation.processing.Messager;\r\nimport javax.annotation.processing.RoundEnvironment;\r\nimport javax.lang.model.SourceVersion;\r\nimport javax.lang.model.element.Element;\r\nimport javax.lang.model.element.TypeElement;\r\nimport javax.lang.model.util.Elements;\r\nimport javax.tools.Diagnostic;\r\n\r\npublic class PatternsProcessor\r\n  extends AbstractProcessor\r\n{\r\n  public Set<String> getSupportedAnnotationTypes() { return Collections.singleton(javaslang.match.annotation.Patterns.class.getName()); }\r\n\r\n  public SourceVersion getSupportedSourceVersion() { return SourceVersion.latestSupported(); }\r\n\r\n  public boolean process(Set<? extends TypeElement> annotations, RoundEnvironment roundEnv) {\r\n    if (!annotations.isEmpty()) {\r\n\r\n      Set<TypeElement> typeElements = (Set)roundEnv.getElementsAnnotatedWith(javaslang.match.annotation.Patterns.class).stream().filter(element -> element instanceof TypeElement).map(element -> (TypeElement)element).collect(Collectors.toSet());\r\n      if (!typeElements.isEmpty()) {\r\n        Set<ClassModel> classModels = transform(typeElements);\r\n        if (!classModels.isEmpty()) {\r\n          generate(classModels);\r\n        }\r\n      } \r\n    } \r\n    return true;\r\n  }\r\n\r\n  private Set<ClassModel> transform(Set<TypeElement> typeElements) {\r\n    Set<ClassModel> classModels = new HashSet<ClassModel>();\r\n    Elements elementUtils = this.processingEnv.getElementUtils();\r\n    Messager messager = this.processingEnv.getMessager();\r\n    for (TypeElement typeElement : typeElements) {\r\n      ClassModel classModel = ClassModel.of(elementUtils, typeElement);\r\n\r\n      \r\n      List<MethodModel> methodModels = (List)classModel.getMethods().stream().filter(method -> method.isAnnotatedWith(javaslang.match.annotation.Unapply.class)).collect(Collectors.toList());\r\n      if (methodModels.isEmpty()) {\r\n        messager.printMessage(Diagnostic.Kind.WARNING, \"No @Unapply methods found.\", classModel.typeElement()); continue;\r\n      } \r\n      boolean methodsValid = ((Boolean)methodModels.stream().reduce(Boolean.valueOf(true), (bool, method) -> Boolean.valueOf((bool.booleanValue() && UnapplyChecker.isValid(method.getExecutableElement(), messager))), (b1, b2) -> Boolean.valueOf((b1.booleanValue() && b2.booleanValue())))).booleanValue();\r\n      if (methodsValid) {\r\n        classModels.add(classModel);\r\n      }\r\n    } \r\n    \r\n    return classModels;\r\n  }\r\n\r\n  private void generate(Set<ClassModel> classModels) {\r\n    Filer filer = this.processingEnv.getFiler();\r\n    for (ClassModel classModel : classModels) {\r\n      String derivedClassName = deriveClassName(classModel);\r\n      String code = Generator.generate(derivedClassName, classModel);\r\n      String fqn = (classModel.hasDefaultPackage() ? \"\" : (classModel.getPackageName() + \".\")) + derivedClassName; \r\n      try { writer = filer.createSourceFile(fqn, new Element[] { classModel.typeElement() }).openWriter(); throwable = null; \r\n        try { writer.write(code); } catch (Throwable throwable1) { throwable = throwable1 = null; throw throwable1; }\r\n        finally { if (writer != null) if (throwable != null) { try { writer.close(); } catch (Throwable throwable1) { throwable.addSuppressed(throwable1); }  } else { writer.close(); }   }  } catch (IOException x)\r\n      { throw new Error(\"Error writing \" + fqn, x); }\r\n    \r\n    } \r\n  }\r\n  \r\n  private String deriveClassName(ClassModel classModel) {\r\n    String name = classModel.getClassName();\r\n    return (\"$\".equals(name) ? \"\" : (name.endsWith(\".$\") ? name.substring(0, name.length() - 2) : name))\r\n      .replaceAll(\"\\\\.\", \"_\") + javaslang.match.annotation.Patterns.class\r\n      .getSimpleName();\r\n  }\r\n}\r\n```", "title": "[Kotlin Class ABI Jars] Invalid ABI jar generated for some Kotlin/Intellij Jars.", "commitsDetails": [], "labels": ["Kotlin", "P1", "bug"], "url": "https://github.com/facebook/buck/issues/2410", "user": "tyvsmith"}, {"created": "2020-03-05 22:59:50", "closed": "2020-05-27 18:05:51", "commits": {}, "ttf": 82.00027777777778, "body": "When consuming a third party dep that has a public top level function, it is not kept in the class abi jar. I've now seen this in a handful of jars as I've explored enabling on the Uber monorepo including\r\n\r\nRepro steps:\r\n\r\n1 )Set compile_against_abis=true in .buckconfig for Kotlin.\r\n2) Add [Square wire-runtime artifact](wire-runtime-3.1.0.jar) or Android UAST jar as a prebuilt jar.\r\n3) Add prebuilt jar as dependency\r\n4) add `import com.squareup.wire.internal.missingRequiredFields` to kotlin file\r\n5) Build\r\n\r\n```\r\nmy_target/tester.kt:9:35 error: unresolved reference: missingRequiredFields\r\nimport com.squareup.wire.internal.missingRequiredFields\r\n                                  ^\r\n\r\n    When running <kotlinc>.\r\n    When building rule //my_target:src_main.\r\n```", "title": "[Kotlin Class ABI Jars] Failed to resolve public top level functions", "commitsDetails": [], "labels": ["P1", "bug"], "url": "https://github.com/facebook/buck/issues/2407", "user": "tyvsmith"}, {"created": "2020-02-21 11:09:19", "closed": "2020-04-21 20:12:13", "commits": {}, "ttf": 60.000277777777775, "body": "Please, consider handling of java exceptions in the cases similar to the following. Currently there is no hint concerning particular BUCK file and line number in the error message. It is really hard to realize what has happened in the case of a large project.\r\n\r\n```\r\n/home/ubuntu/buck/buck-out/gen/ce9b6f2e/programs/buck.pex build //:custom-interpreter-test\r\nNot using buckd because watchman isn't installed.\r\nParsing buck files: finished in 0.6 sec\r\nBuck encountered an internal error\r\njava.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.NullPointerException\r\n\tat com.facebook.buck.parser.TargetSpecResolver.collectTargets(TargetSpecResolver.java:360)\r\n...\r\n```\r\n\r\nSee below for the full error message.\r\n\r\nMinimal example could be distilled further, but I suppose in the current form it gives some notion how it can happen in real life.\r\n\r\n`BUCK` file\r\n\r\n```python\r\npython_binary(\r\n    name = 'custom-interpreter-test',\r\n    main_module = 'just_test_module',\r\n    platform = 'platform',\r\n    build_args = [\r\n        # Intention:\r\n        # '--python-shebang', read_config('python#platform', 'interpreter') + ' -Estt',\r\n        # Accidentally [python].platform section was missed in .buckconfig.local\r\n        '--python-shebang', read_config('python#NOTplatform', 'interpreter'),\r\n    ],\r\n    deps = [\r\n        ':just_test_library',\r\n    ],\r\n)\r\n\r\npython_library(\r\n    name = 'just_test_library',\r\n    srcs = ['just_test_module.py'],\r\n)\r\n```\r\n\r\n`.buckconfig`\r\n\r\n```\r\n[python#platform]\r\n# Should be in .buckconfig.local, for CentOS-8:\r\n# interpreter = /usr/libexec/platform-python\r\ninterpreter = /usr/bin/python3\r\n```\r\n\r\n`just_test_module.py`\r\n\r\n```python\r\nif __name__ == '__main__':\r\n    print('Hi')\r\nelse:\r\n    raise RuntimeError('Must be called as main module')\r\n```\r\n\r\nBUCK version:\r\n```\r\ncommit b2f0616214198619163c194b4c7aba0d563d1c18 (HEAD -> master, origin/master, origin/HEAD)\r\nAuthor: Milen Dzhumerov <mgd@fb.com>\r\nDate:   Mon Feb 17 09:24:32 2020 -0800\r\n```\r\n\r\nOS: Ubuntu-18.04\r\n\r\n```\r\nopenjdk-8-jdk-headless:\r\n  Installed: 8u242-b08-0ubuntu3~18.04\r\n```\r\n\r\n```\r\nBuck encountered an internal error\r\njava.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.NullPointerException\r\n\tat com.facebook.buck.parser.TargetSpecResolver.collectTargets(TargetSpecResolver.java:360)\r\n\tat com.facebook.buck.parser.TargetSpecResolver.resolveTargetSpecs(TargetSpecResolver.java:256)\r\n\tat com.facebook.buck.parser.ParserWithConfigurableAttributes.collectBuildTargetsFromTargetNodeSpecs(ParserWithConfigurableAttributes.java:338)\r\n\tat com.facebook.buck.parser.AbstractParser.buildTargetGraphForTargetNodeSpecs(AbstractParser.java:297)\r\n\tat com.facebook.buck.parser.AbstractParser.buildTargetGraphWithoutTopLevelConfigurationTargets(AbstractParser.java:271)\r\n\tat com.facebook.buck.cli.BuildCommand.createUnversionedTargetGraph(BuildCommand.java:830)\r\n\tat com.facebook.buck.cli.BuildCommand.createGraphsAndTargets(BuildCommand.java:399)\r\n\tat com.facebook.buck.cli.BuildCommand.executeBuildAndProcessResult(BuildCommand.java:476)\r\n\tat com.facebook.buck.cli.BuildCommand.run(BuildCommand.java:363)\r\n\tat com.facebook.buck.cli.BuildCommand.runWithoutHelpInternal(BuildCommand.java:305)\r\n\tat com.facebook.buck.cli.BuildCommand.runWithoutHelp(BuildCommand.java:287)\r\n\tat com.facebook.buck.cli.AbstractCommand.run(AbstractCommand.java:280)\r\n\tat com.facebook.buck.cli.AbstractContainerCommand.run(AbstractContainerCommand.java:90)\r\n\tat com.facebook.buck.cli.MainRunner.runMainWithExitCode(MainRunner.java:1445)\r\n\tat com.facebook.buck.cli.MainRunner.runMainThenExit(MainRunner.java:476)\r\n\tat com.facebook.buck.cli.MainWithoutNailgun.main(MainWithoutNailgun.java:57)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat com.facebook.buck.cli.bootstrapper.ClassLoaderBootstrapper.main(ClassLoaderBootstrapper.java:55)\r\nCaused by: java.util.concurrent.ExecutionException: java.lang.NullPointerException\r\n\tat com.google.common.util.concurrent.AbstractFuture.getDoneValue(AbstractFuture.java:528)\r\n\tat com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:507)\r\n\tat com.google.common.util.concurrent.AbstractFuture$TrustedFuture.get(AbstractFuture.java:85)\r\n\tat com.facebook.buck.parser.TargetSpecResolver.collectTargets(TargetSpecResolver.java:354)\r\n\t... 20 more\r\nCaused by: java.lang.NullPointerException\r\n\tat com.google.common.base.Preconditions.checkNotNull(Preconditions.java:871)\r\n\tat com.google.common.collect.ImmutableCollection$ArrayBasedBuilder.add(ImmutableCollection.java:486)\r\n\tat com.google.common.collect.ImmutableList$Builder.add(ImmutableList.java:775)\r\n\tat com.facebook.buck.json.BuildFilePythonResultDeserializer.deserializeList(BuildFilePythonResultDeserializer.java:113)\r\n\tat com.facebook.buck.json.BuildFilePythonResultDeserializer.deserializeRecursive(BuildFilePythonResultDeserializer.java:127)\r\n\tat com.facebook.buck.json.BuildFilePythonResultDeserializer.deserializeObject(BuildFilePythonResultDeserializer.java:101)\r\n\tat com.facebook.buck.json.BuildFilePythonResultDeserializer.deserializeObjectList(BuildFilePythonResultDeserializer.java:88)\r\n\tat com.facebook.buck.json.BuildFilePythonResultDeserializer.deserialize(BuildFilePythonResultDeserializer.java:62)\r\n\tat com.facebook.buck.json.BuildFilePythonResultDeserializer.deserialize(BuildFilePythonResultDeserializer.java:42)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper._readValue(ObjectMapper.java:3984)\r\n\tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:2276)\r\n\tat com.fasterxml.jackson.core.JsonParser.readValueAs(JsonParser.java:1729)\r\n\tat com.facebook.buck.parser.PythonDslProjectBuildFileParser.performJsonRequest(PythonDslProjectBuildFileParser.java:628)\r\n\tat com.facebook.buck.parser.PythonDslProjectBuildFileParser.getAllRulesInternal(PythonDslProjectBuildFileParser.java:447)\r\n\tat com.facebook.buck.parser.PythonDslProjectBuildFileParser.getManifest(PythonDslProjectBuildFileParser.java:385)\r\n\tat com.facebook.buck.parser.PythonDslProjectBuildFileParser.getManifest(PythonDslProjectBuildFileParser.java:93)\r\n\tat com.facebook.buck.json.TargetCountVerificationParserDecorator.getManifest(TargetCountVerificationParserDecorator.java:73)\r\n\tat com.facebook.buck.json.TargetCountVerificationParserDecorator.getManifest(TargetCountVerificationParserDecorator.java:33)\r\n\tat com.facebook.buck.parser.decorators.EventReportingProjectBuildFileParser.getManifest(EventReportingProjectBuildFileParser.java:69)\r\n\tat com.facebook.buck.parser.decorators.EventReportingProjectBuildFileParser.getManifest(EventReportingProjectBuildFileParser.java:38)\r\n\tat com.facebook.buck.parser.FileParserPool.lambda$getManifest$0(FileParserPool.java:84)\r\n\tat com.facebook.buck.util.concurrent.ResourcePool$1.apply(ResourcePool.java:136)\r\n\tat com.facebook.buck.util.concurrent.ResourcePool$1.apply(ResourcePool.java:128)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture$AsyncTransformFuture.doTransform(AbstractTransformFuture.java:206)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture$AsyncTransformFuture.doTransform(AbstractTransformFuture.java:195)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture.run(AbstractTransformFuture.java:115)\r\n\tat com.google.common.util.concurrent.MoreExecutors$5$1.run(MoreExecutors.java:999)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```", "title": "java.lang.NullPointerException if python shebang is None", "commitsDetails": [], "labels": ["P1", "bug"], "url": "https://github.com/facebook/buck/issues/2398", "user": "plmnikulin"}, {"created": "2019-11-05 01:44:26", "closed": "2020-06-18 17:53:42", "commits": {}, "ttf": 226.00027777777777, "body": "The -module-name argument used to specify the name mangling used for Kotlin bytecode generation is incorrect. It's currently using the invokingRule shortname, which usually results in methods like\r\n\r\n`myMethod$src_release()`\r\n\r\nThis will frequently conflict and allow expanded access from Kotlin.\r\n\r\nThe documentation states \"a Gradle source set (with the exception that the test source set can access the internal declarations of main);\"\r\n\r\nGradle uses the fully qualified module, we should probably use the full invokingRule sans the specific action after the \":\" to allow tests and all other targets within one BUCK file to have access.\r\n\r\n[KotlincToJarStepFactory.java](https://github.com/facebook/buck/blob/master/src/com/facebook/buck/jvm/kotlin/KotlincToJarStepFactory.java)", "title": "Kotlin internal modifier wired incorrectly", "commitsDetails": [], "labels": ["Kotlin", "P1", "bug"], "url": "https://github.com/facebook/buck/issues/2334", "user": "tyvsmith"}, {"created": "2019-04-22 12:07:04", "closed": "2019-09-05 15:59:33", "commits": {}, "ttf": 136.00027777777777, "body": "Contrary to https://buckbuild.com/rule/zip_file.html\r\n\r\n```\r\n      # Imagine this generates the output \r\n      # \"buck-out/gen/foo/hello.txt\". This output will \r\n      # be found in the zip at \"hello.txt\"\r\n      '//some/other:target',\r\n```\r\n\r\nThe binary includes buck-out/gen in the path\r\n\r\n```\r\n$  zipinfo ./buck-out/gen/cooee-cli__/cooee-cli.zip\r\nArchive:  ./buck-out/gen/cooee-cli__/cooee-cli.zip\r\nZip file size: 2124952 bytes, number of entries: 7\r\ndrwxr-xr-x  1.0 unx        0 b- stor 85-Feb-01 00:00 buck-out/\r\ndrwxr-xr-x  1.0 unx        0 b- stor 85-Feb-01 00:00 buck-out/gen/\r\ndrwxr-xr-x  1.0 unx        0 b- stor 85-Feb-01 00:00 buck-out/gen/cooee/\r\n-rwxr-xr-x  2.0 unx  2189137 bl defN 85-Feb-01 00:00 buck-out/gen/cooee/cooee.pex\r\ndrwxr-xr-x  1.0 unx        0 b- stor 85-Feb-01 00:00 shell/\r\n-rw-r--r--  2.0 unx     2886 bl defN 85-Feb-01 00:00 shell/completion.bash\r\n-rw-r--r--  2.0 unx     1272 bl defN 85-Feb-01 00:00 shell/cooee.fish\r\n```", "title": "zip_file includes buck-out path", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/2248", "user": "yschimke"}, {"created": "2019-03-28 09:16:50", "closed": "2019-09-05 16:19:01", "commits": {}, "ttf": 161.00027777777777, "body": "Running into the following exception when trying to index buck project for Intellij:\r\n\r\n```\r\nBuck encountered an internal error\r\njava.lang.ClassCastException: com.facebook.buck.core.rules.configsetting.ConfigSettingDescription cannot be cast to com.facebook.buck.core.model.targetgraph.DescriptionWithTargetGraph\r\n        at com.facebook.buck.features.project.intellij.ShallowTargetNodeToBuildRuleTransformer.transform(ShallowTargetNodeToBuildRuleTransformer.java:65)\r\n        at com.facebook.buck.core.rules.resolver.impl.SingleThreadedActionGraphBuilder.lambda$1(SingleThreadedActionGraphBuilder.java:115)\r\n        at com.facebook.buck.core.rules.resolver.impl.SingleThreadedActionGraphBuilder.computeIfAbsent(SingleThreadedActionGraphBuilder.java:88)\r\n        ... 26 more\r\n```\r\n\r\nThe steps which I followed were:\r\n\r\n1. \r\n```\r\ngit clone --depth 1 https://github.com/facebook/buck.git\r\ncd buck\r\nant\r\n```\r\n\r\n2.\r\n```\r\n./bin/buck build --show-output buck\r\nbuck-out/gen/programs/buck.pex --help\r\n```\r\n\r\n3.\r\n```\r\n./bin/buck project --ide intellij\r\n```", "title": "ClassCastException for generating Intellij project", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/2226", "user": "VisheshVadhera"}, {"changesInPackagesSPOON": ["com.android.manifmerger.OtherOperationType"], "created": "2019-01-04 03:12:33", "spoonStatsSummary": {"INS": 0, "spoonMethodsChanged": 1, "MOV": 0, "DEL": 0, "spoonFilesChanged": 1, "TOT": 1, "UPD": 1}, "commits": {"04000d48656d4c498813942b454b9d13fb570665": {"commitGHEventType": "referenced", "commitUser": "facebook-github-bot"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "OtherOperationType.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 1, "spoonMethodName": "com.android.manifmerger.OtherOperationType"}]}], "nameRev": "04000d48656d4c498813942b454b9d13fb570665 tags/v2019.01.10.01~18", "commitUser": "facebook-github-bot", "commitHash": "04000d48656d4c498813942b454b9d13fb570665", "commitDateTime": "2019-01-09 11:05:08", "commitMessage": "Fix Android manifest merger failure with tools:targetApi\n\nSummary:\nFixing the issue reported in https://github.com/facebook/buck/issues/2149.\n\nAccording to https://developer.android.com/studio/write/tool-attributes the tag should be \"tools:targetApi\", not \"tools:targetAPI\"\n\nReviewed By: jtorkkola\n\nfbshipit-source-id: 14b6835fc1\n", "commitGitStats": [{"filePath": "third-party/java/aosp/tools-targetApi.patch", "deletions": 0, "lines": 11, "insertions": 11}, {"filePath": "test/com/facebook/buck/android/testdata/android_project/apps/sample/AndroidManifest.xml", "deletions": 1, "lines": 3, "insertions": 2}, {"filePath": "third-party/java/aosp/README.txt", "deletions": 1, "lines": 2, "insertions": 1}, {"filePath": "third-party/java/aosp/src/com/android/manifmerger/OtherOperationType.java", "deletions": 1, "lines": 2, "insertions": 1}], "commitParents": ["ed996849cd869bedf76f7c9b25c9037d21138aba"], "authoredDateTime": "2019-01-09 10:20:44", "spoonStatsSkippedReason": "", "commitGHEventType": "referenced"}], "body": "In WorkManager alpha08 and above, it uses tools:targetApi=\"n\" in the AndroidManifest.xml instead of tools:targetAPI=\"n\". The manifest merger buck uses is not case insensitive. So buck can't merge the AndroidManifest.xml in WorkManager. More info [here](https://issuetracker.google.com/u/1/issues/114358542). Is it possible to fix it in the new release of buck?\r\n\r\nThe error I got is as blow:\r\n\r\nBuck encountered an internal error\r\njava.lang.RuntimeException: /path/to/project/buck-out/bin/3rdparty/jvm/android/arch/work/__unpack_work-runtime.aar#aar_unzip__/AndroidManifest.xml:28:9-34:35: Error: Invalid instruction 'targetApi', valid instructions are : REMOVE,REPLACE,STRICT\r\nat com.android.manifmerger.XmlElement.<init>(XmlElement.java:142)\r\nat com.android.manifmerger.XmlElement.initMergeableChildren(XmlElement.java:870)\r\nat com.android.manifmerger.XmlElement.<init>(XmlElement.java:170)\r\nat com.android.manifmerger.XmlElement.initMergeableChildren(XmlElement.java:870)\r\nat com.android.manifmerger.XmlElement.<init>(XmlElement.java:170)\r\nat com.android.manifmerger.XmlDocument.getRootNode(XmlDocument.java:229)\r\nat com.android.manifmerger.ManifestMerger2.loadLibraries(ManifestMerger2.java:591)\r\nat com.android.manifmerger.ManifestMerger2.merge(ManifestMerger2.java:122)\r\nat com.android.manifmerger.ManifestMerger2.access$600(ManifestMerger2.java:53)\r\nat com.android.manifmerger.ManifestMerger2$Invoker.merge(ManifestMerger2.java:1003)\r\nat com.facebook.buck.android.GenerateManifestStep.mergeManifests(GenerateManifestStep.java:121)\r\nat com.facebook.buck.android.GenerateManifestStep.execute(GenerateManifestStep.java:90)\r\nat com.facebook.buck.step.DefaultStepRunner.runStepForBuildTarget(DefaultStepRunner.java:45)\r\n... 16 more\r\nCaused by: /path/to/project/buck-out/bin/3rdparty/jvm/android/arch/work/__unpack_work-runtime.aar#aar_unzip__/AndroidManifest.xml:28:9-34:35: Error: Invalid instruction 'targetApi', valid instructions are : REMOVE,REPLACE,STRICT\r\nat com.android.common.ide.common.res2.MergingException$Builder.build(MergingException.java:134)\r\n... 29 more\r\nCaused by: java.lang.IllegalArgumentException: No enum constant com.android.manifmerger.AttributeOperationType.TARGETAPI\r\nat java.lang.Enum.valueOf(Enum.java:238)\r\nat com.android.manifmerger.AttributeOperationType.valueOf(AttributeOperationType.java:54)\r\nat com.android.manifmerger.XmlElement.<init>(XmlElement.java:124)\r\n... 28 more\r\n\r\nWhen running <generate_manifest>.", "title": "Buck doesn't work with WorkManger alpha08 and above", "closed": "2019-01-09 21:37:42", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["third-party/java/aosp/tools-targetApi.patch", "third-party/java/aosp/src/com/android/manifmerger"], "gitStatsSummary": {"gitFilesChange": 2, "lines": 13, "deletions": 1, "insertions": 12}, "ttf": 5.000277777777778, "filteredCommits": ["04000d48656d4c498813942b454b9d13fb570665"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/2149", "user": "CeciliaGuo47"}, {"changesInPackagesSPOON": ["com.facebook.buck.android.AndroidBuckConfig.getAndroidTarget()", "com.facebook.buck.android.AndroidBuckConfig.getAndroidCompileSdkVersion()", "com.facebook.buck.android.toolchain.impl.AndroidPlatformTargetFactory.createToolchain(com.facebook.buck.core.toolchain.ToolchainProvider,com.facebook.buck.core.toolchain.ToolchainCreationContext)"], "created": "2018-07-03 21:26:14", "spoonStatsSummary": {"INS": 3, "spoonMethodsChanged": 3, "MOV": 1, "DEL": 0, "spoonFilesChanged": 2, "TOT": 8, "UPD": 4}, "commits": {"9b10638c9d3e84a220c084970e7464d193436daa": {"commitGHEventType": "referenced", "commitUser": "raviagarwal7"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "AndroidPlatformTargetFactory.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 4, "TOT": 4, "spoonMethodName": "com.facebook.buck.android.toolchain.impl.AndroidPlatformTargetFactory.createToolchain(com.facebook.buck.core.toolchain.ToolchainProvider,com.facebook.buck.core.toolchain.ToolchainCreationContext)"}]}, {"spoonFilePath": "AndroidBuckConfigTest.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.core.resources.AndroidBuckConfigTest.compileSdkVersionTakesPrecendenceOverTarget()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.core.resources.AndroidBuckConfigTest.compileSdkVersionDefersToTargetIfNotPresent()"}]}, {"spoonFilePath": "AndroidBuckConfig.java", "spoonMethods": [{"INS": 2, "MOV": 1, "DEL": 0, "UPD": 0, "TOT": 3, "spoonMethodName": "com.facebook.buck.android.AndroidBuckConfig.getAndroidTarget()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.android.AndroidBuckConfig.getAndroidCompileSdkVersion()"}]}], "nameRev": "9b10638c9d3e84a220c084970e7464d193436daa tags/v2019.10.02.01~159", "commitUser": "raviagarwal7", "commitHash": "9b10638c9d3e84a220c084970e7464d193436daa", "commitDateTime": "2019-09-17 03:50:39", "commitMessage": "Deprecate android.target and replace with android.compile_sdk_version\n\nSummary: Using \"target\" is a bit confusing because the target SDK in Android is different from the compileSdkVersion. Use `compile_sdk_version` instead to make it clearer what this actually refers to.\n\nReviewed By: asp2insp\n\nshipit-source-id: 723e35a63c\n", "commitGitStats": [{"filePath": "docs/__buckconfig_common.soy", "deletions": 4, "lines": 8, "insertions": 4}, {"filePath": "docs/files-and-dirs/buckconfig.soy", "deletions": 12, "lines": 24, "insertions": 12}, {"filePath": "src/com/facebook/buck/android/AndroidBuckConfig.java", "deletions": 1, "lines": 9, "insertions": 8}, {"filePath": "docs/setup/getting_started.soy", "deletions": 1, "lines": 2, "insertions": 1}, {"filePath": "src/com/facebook/buck/android/toolchain/impl/AndroidPlatformTargetFactory.java", "deletions": 3, "lines": 6, "insertions": 3}, {"filePath": "test/com/facebook/buck/android/AndroidBuckConfigTest.java", "deletions": 0, "lines": 28, "insertions": 28}], "commitParents": ["0341d85ca0db26340ef35676dc9bd5140978d79c"], "authoredDateTime": "2019-09-17 02:34:43", "spoonStatsSkippedReason": "", "commitGHEventType": "referenced"}], "body": "[Aapt2Compile](https://github.com/facebook/buck/blob/master/src/com/facebook/buck/android/Aapt2Compile.java#L45) rule doesn't add build tools version as a dependency causing build inconsistency when tools version are updated. \r\n```\r\n\u2570\u2500$ cat .buckconfig.local | grep build_tools_version\r\n    build_tools_version = 27.0.3\r\n\r\n\u2570\u2500$ ../buck/bin/buck build app\r\n2018-07-03 12:32:33,094 [INFO][buck_tool.py:460] Restarting Buck daemon because Buck version has changed...\r\nParsing buck files: finished in 4.6 sec (100%)\r\nCreating action graph: finished in 0.6 sec (100%)\r\nBuilding: finished in 2.9 sec (100%) 3/3 jobs, 3 updated\r\n  Total time: 8.2 sec\r\n\r\n\u2570\u2500$ cat .buckconfig.local | grep build_tools_version\r\n    build_tools_version = 28.0.0\r\n\r\n\u2570\u2500$ ../buck/bin/buck build app\r\nShutting down and restarting buck daemon: Buck configuration options changed between invocations\r\nParsing buck files: finished in 3.8 sec (100%)\r\nBuilding: finished in 1.5 sec (100%) 2/2 jobs, 0 updated\r\n  Total time: 5.7 sec\r\n```\r\n\r\nTo fix this we need to add [build_tools_version](https://github.com/facebook/buck/blob/02140ab447c63631e90c8e23c9ebcf311ae55a0f/src/com/facebook/buck/android/toolchain/impl/AndroidBuildToolsResolver.java#L59) as a RuleKey to all the rules which uses AndroidPlatformTarget.\r\n\r\nSuggestion:\r\n- Add build tools version as a property to `AndroidPlatformTarget` and make it a rule key for all rules using it. (but this could be error prone if someone forgets to annotate when using `AndroidPlatformTarget`) \r\n- Add the `build_tools_version` rulekey as a global?\r\n", "title": "Build tools version update doesn't rerun aapt steps", "closed": "2019-12-19 19:12:48", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["docs/__buckconfig_common.soy", "docs/setup/getting_started.soy", "src/com/facebook/buck/android", "src/com/facebook/buck/android/toolchain/impl", "docs/files-and-dirs/buckconfig.soy"], "gitStatsSummary": {"gitFilesChange": 5, "lines": 49, "deletions": 21, "insertions": 28}, "ttf": 533.0002777777778, "filteredCommits": ["9b10638c9d3e84a220c084970e7464d193436daa"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/1953", "user": "raviagarwal7"}, {"changesInPackagesSPOON": ["com.facebook.buck.android.toolchain.ndk.impl.AndroidNdkResolver.findNdkFromRepository(java.nio.file.Path)", "com.facebook.buck.android.toolchain.ndk.impl.AndroidNdkResolver"], "created": "2018-05-16 21:06:02", "spoonStatsSummary": {"INS": 4, "spoonMethodsChanged": 2, "MOV": 1, "DEL": 0, "spoonFilesChanged": 1, "TOT": 6, "UPD": 1}, "commits": {"742aabe781a1f9d2047f33f6ffd977905d76999d": {"commitGHEventType": "referenced", "commitUser": "facebook-github-bot"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "AndroidNdkResolver.java", "spoonMethods": [{"INS": 2, "MOV": 1, "DEL": 0, "UPD": 1, "TOT": 4, "spoonMethodName": "com.facebook.buck.android.toolchain.ndk.impl.AndroidNdkResolver.findNdkFromRepository(java.nio.file.Path)"}, {"INS": 2, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.android.toolchain.ndk.impl.AndroidNdkResolver"}]}, {"spoonFilePath": "AndroidNdkResolverTest.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.android.toolchain.ndk.impl.AndroidNdkResolverTest.testUnsupportedVersionNotUsed()"}]}], "nameRev": "742aabe781a1f9d2047f33f6ffd977905d76999d tags/v2018.06.25.01~32", "commitUser": "facebook-github-bot", "commitHash": "742aabe781a1f9d2047f33f6ffd977905d76999d", "commitDateTime": "2018-06-20 23:04:42", "commitMessage": "Introduce min unsupported version of Android NDK\n\nSummary:\nAndroid NDK 17 is not supported right now, no need to crash Buck when older NDKs are present.\n\nIssue with version 17: https://github.com/facebook/buck/issues/1890\n\nReviewed By: bobyangyf\n\nfbshipit-source-id: 788c90f\n", "commitGitStats": [{"filePath": "test/com/facebook/buck/android/toolchain/ndk/impl/AndroidNdkResolverTest.java", "deletions": 0, "lines": 20, "insertions": 20}, {"filePath": "src/com/facebook/buck/android/toolchain/ndk/impl/AndroidNdkResolver.java", "deletions": 0, "lines": 12, "insertions": 12}], "commitParents": ["f09152df1e61ff6b5e9e880fbd6ea990847e0816"], "authoredDateTime": "2018-06-20 22:07:46", "spoonStatsSkippedReason": "", "commitGHEventType": "referenced"}], "body": "with NDK 17. Some architectures were removed\r\n\r\n```\r\nUNKNOWN ERROR: com.google.common.util.concurrent.ExecutionError: java.lang.AssertionError: /Users/zsweers/dev/android/android-sdk/ndk-bundle/sources/cxx-stl/gnu-libstdc++/4.9/libs/armeabi doesn't exist.\r\ncom.google.common.util.concurrent.ExecutionError: com.google.common.util.concurrent.ExecutionError: java.lang.AssertionError: /Users/zsweers/dev/android/android-sdk/ndk-bundle/sources/cxx-stl/gnu-libstdc++/4.9/libs/armeabi doesn't exist.\r\n\tat com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2216)\r\n\tat com.google.common.cache.LocalCache.get(LocalCache.java:4147)\r\n\tat com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:4151)\r\n\tat com.google.common.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:5140)\r\n\tat com.facebook.buck.toolchain.impl.DefaultToolchainProvider.getOrCreate(DefaultToolchainProvider.java:166)\r\n\tat com.facebook.buck.toolchain.impl.DefaultToolchainProvider.getByName(DefaultToolchainProvider.java:109)\r\n\tat com.facebook.buck.toolchain.BaseToolchainProvider.getByName(BaseToolchainProvider.java:24)\r\n\tat com.facebook.buck.jvm.java.JavaBinaryDescription.getCxxPlatform(JavaBinaryDescription.java:79)\r\n\tat com.facebook.buck.jvm.java.JavaBinaryDescription.findDepsForTargetFromConstructorArgs(JavaBinaryDescription.java:175)\r\n\tat com.facebook.buck.jvm.java.JavaBinaryDescription.findDepsForTargetFromConstructorArgs(JavaBinaryDescription.java:55)\r\n\tat com.facebook.buck.rules.TargetNodeFactory.create(TargetNodeFactory.java:115)\r\n\tat com.facebook.buck.rules.TargetNodeFactory.createFromObject(TargetNodeFactory.java:65)\r\n\tat com.facebook.buck.parser.DefaultParserTargetNodeFactory.createTargetNodeFromObject(DefaultParserTargetNodeFactory.java:233)\r\n\tat com.facebook.buck.parser.DefaultParserTargetNodeFactory.createTargetNode(DefaultParserTargetNodeFactory.java:152)\r\n\tat com.facebook.buck.parser.DefaultParserTargetNodeFactory.createTargetNode(DefaultParserTargetNodeFactory.java:61)\r\n\tat com.facebook.buck.parser.TargetNodeParsePipeline.computeNode(TargetNodeParsePipeline.java:124)\r\n\tat com.facebook.buck.parser.TargetNodeParsePipeline.computeNode(TargetNodeParsePipeline.java:54)\r\n\tat com.facebook.buck.parser.ConvertingPipeline.dispatchComputeNode(ConvertingPipeline.java:166)\r\n\tat com.facebook.buck.parser.ConvertingPipeline.lambda$null$0(ConvertingPipeline.java:83)\r\n\tat com.facebook.buck.parser.PipelineNodeCache.getJobWithCacheLookup(PipelineNodeCache.java:73)\r\n\tat com.facebook.buck.parser.ConvertingPipeline.lambda$getAllNodesJob$1(ConvertingPipeline.java:76)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture$AsyncTransformFuture.doTransform(AbstractTransformFuture.java:206)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture$AsyncTransformFuture.doTransform(AbstractTransformFuture.java:195)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture.run(AbstractTransformFuture.java:115)\r\n\tat com.google.common.util.concurrent.MoreExecutors$5$1.run(MoreExecutors.java:999)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: com.google.common.util.concurrent.ExecutionError: java.lang.AssertionError: /Users/zsweers/dev/android/android-sdk/ndk-bundle/sources/cxx-stl/gnu-libstdc++/4.9/libs/armeabi doesn't exist.\r\n\tat com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2216)\r\n\tat com.google.common.cache.LocalCache.get(LocalCache.java:4147)\r\n\tat com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:4151)\r\n\tat com.google.common.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:5140)\r\n\tat com.facebook.buck.toolchain.impl.DefaultToolchainProvider.getOrCreate(DefaultToolchainProvider.java:166)\r\n\tat com.facebook.buck.toolchain.impl.DefaultToolchainProvider.isToolchainPresent(DefaultToolchainProvider.java:125)\r\n\tat com.facebook.buck.cxx.toolchain.CxxPlatformsProviderFactory.createToolchain(CxxPlatformsProviderFactory.java:47)\r\n\tat com.facebook.buck.toolchain.impl.DefaultToolchainProvider.createToolchain(DefaultToolchainProvider.java:191)\r\n\tat com.facebook.buck.toolchain.impl.DefaultToolchainProvider.access$100(DefaultToolchainProvider.java:46)\r\n\tat com.facebook.buck.toolchain.impl.DefaultToolchainProvider$1.load(DefaultToolchainProvider.java:64)\r\n\tat com.facebook.buck.toolchain.impl.DefaultToolchainProvider$1.load(DefaultToolchainProvider.java:58)\r\n\tat com.google.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3708)\r\n\tat com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2416)\r\n\tat com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2299)\r\n\tat com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2212)\r\n\t... 27 more\r\nCaused by: java.lang.AssertionError: /Users/zsweers/dev/android/android-sdk/ndk-bundle/sources/cxx-stl/gnu-libstdc++/4.9/libs/armeabi doesn't exist.\r\n\tat com.facebook.infer.annotation.Assertions.assertCondition(Assertions.java:72)\r\n\tat com.facebook.buck.android.toolchain.ndk.impl.NdkCxxPlatforms$NdkCxxToolchainPaths.processPathPattern(NdkCxxPlatforms.java:963)\r\n\tat com.facebook.buck.android.toolchain.ndk.impl.NdkCxxPlatforms$NdkCxxToolchainPaths.getCxxRuntimeLibsDirectory(NdkCxxPlatforms.java:1053)\r\n\tat com.facebook.buck.android.toolchain.ndk.impl.NdkCxxPlatforms$NdkCxxToolchainPaths.access$000(NdkCxxPlatforms.java:877)\r\n\tat com.facebook.buck.android.toolchain.ndk.impl.NdkCxxPlatforms.getCcLinkTool(NdkCxxPlatforms.java:696)\r\n\tat com.facebook.buck.android.toolchain.ndk.impl.NdkCxxPlatforms.build(NdkCxxPlatforms.java:477)\r\n\tat com.facebook.buck.android.toolchain.ndk.impl.NdkCxxPlatforms.getPlatforms(NdkCxxPlatforms.java:274)\r\n\tat com.facebook.buck.android.toolchain.ndk.impl.NdkCxxPlatforms.getPlatforms(NdkCxxPlatforms.java:239)\r\n\tat com.facebook.buck.android.toolchain.ndk.impl.NdkCxxPlatforms.getPlatforms(NdkCxxPlatforms.java:216)\r\n\tat com.facebook.buck.android.toolchain.ndk.impl.NdkCxxPlatformsProviderFactory.getNdkCxxPlatforms(NdkCxxPlatformsProviderFactory.java:63)\r\n\tat com.facebook.buck.android.toolchain.ndk.impl.NdkCxxPlatformsProviderFactory.createToolchain(NdkCxxPlatformsProviderFactory.java:41)\r\n\tat com.facebook.buck.toolchain.impl.DefaultToolchainProvider.createToolchain(DefaultToolchainProvider.java:191)\r\n\tat com.facebook.buck.toolchain.impl.DefaultToolchainProvider.access$100(DefaultToolchainProvider.java:46)\r\n\tat com.facebook.buck.toolchain.impl.DefaultToolchainProvider$1.load(DefaultToolchainProvider.java:64)\r\n\tat com.facebook.buck.toolchain.impl.DefaultToolchainProvider$1.load(DefaultToolchainProvider.java:58)\r\n\tat com.google.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3708)\r\n\tat com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2416)Connection is lost to Buck daemon! This usually indicates that daemon experienced an unrecoverable error. Here is what you can do:\r\n```", "title": "BUCK crashes on the latest NDK", "closed": "2018-07-05 20:17:52", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/com/facebook/buck/android/toolchain/ndk/impl"], "gitStatsSummary": {"gitFilesChange": 1, "lines": 12, "deletions": 0, "insertions": 12}, "ttf": 49.000277777777775, "filteredCommits": ["742aabe781a1f9d2047f33f6ffd977905d76999d"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/1890", "user": "ZacSweers"}, {"created": "2018-04-16 20:17:38", "closed": "2018-11-20 19:34:04", "commits": {}, "ttf": 217.00027777777777, "body": "After updating Buck https://github.com/facebook/buck/compare/996fc3c1f0c6415477cbbf76aea005286dc4d6ab...02e709184fbd0534817c1e73f7db71b13093e4dd I'm observing CI build errors with following log:\r\n\r\n```console\r\n[ERROR][buck.py:173] Server disconnected unexpectedly: [Errno 104] Connection reset by peer\r\nTraceback (most recent call last):\r\n  File \".okbuck/cache/buck_binary/buck-d6c66ee7d0.pex/programs/buck.py\", line 147, in <module>\r\n  File \".okbuck/cache/buck_binary/buck-d6c66ee7d0.pex/programs/buck.py\", line 134, in main\r\n  File \".okbuck/cache/buck_binary/buck-d6c66ee7d0.pex/programs/buck_tool.py\", line 408, in launch_buck\r\n    if running_version != buck_version_uid or not self._is_buckd_running():\r\n  File \".okbuck/cache/buck_binary/buck-d6c66ee7d0.pex/programs/buck_tool.py\", line 615, in _is_buckd_running\r\n    c.send_command('ng-stats')\r\n  File \".okbuck/cache/buck_binary/buck-d6c66ee7d0.pex/pynailgun/ng.py\", line 438, in send_command\r\n    NailgunException.CONNECTION_BROKEN)\r\nNailgunException: Server disconnected unexpectedly: [Errno 104] Connection reset by peer\r\n```\r\n\r\nOur Buck CI job makes few sequential `buck` invocations, this particular one is `buck project` and build fails pretty consistently on this stage.\r\n", "title": "Server disconnected unexpectedly.", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/1854", "user": "artem-zinnatullin"}, {"created": "2018-04-09 19:07:36", "closed": "2020-02-25 19:55:18", "commits": {}, "ttf": 687.0002777777778, "body": "This commit 005dd2a03a634e5f38eb5ab2ac680c77448a287e regresses a large iOS build of mine from total elapsed time ~12:30 to ~16:30. There's also something in the earlier range 145f10a7d6..ace7495dd (26 commits) that regresses the build from ~10:00 to ~12:30. It looks like most of these commits were made on the same day as part of a larger change.\r\n\r\nThis is with dir cache on and http cache off, on a mac pro running 24 threads.\r\n\r\nAny ideas on what's happening here? Tagging @cjhopman because he's the author of most of those commits. ", "title": "Significant performance regression in 005dd2a03", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/1838", "user": "sheldonneuberger"}, {"created": "2017-11-14 06:47:00", "closed": "2020-02-26 19:56:06", "commits": {}, "ttf": 834.0002777777778, "body": "If you have a backtick in an API for kotlin, buck will fail with a stacktrace like this.\r\n\r\nExample: `fun 'in'()` (replace the `'` with backticks, github won't format it nicely)\r\n\r\n```\r\n./buckw test //libraries/foundation/realtime/realtime-projectgen/... --include unit                                                                                    \ue0b2\r\nBuck encountered an internal error\r\njava.lang.IllegalStateException\r\n\tat com.google.common.base.Preconditions.checkState(Preconditions.java:429)\r\n\tat com.facebook.buck.jvm.java.AccumulateClassNamesStep.parseClassHashes(AccumulateClassNamesStep.java:167)\r\n\tat com.facebook.buck.jvm.java.JavaLibraryRules.initializeFromDisk(JavaLibraryRules.java:81)\r\n\tat com.facebook.buck.jvm.java.DefaultJavaLibrary.initializeFromDisk(DefaultJavaLibrary.java:333)\r\n\tat com.facebook.buck.jvm.java.DefaultJavaLibrary.initializeFromDisk(DefaultJavaLibrary.java:1)\r\n\tat com.facebook.buck.rules.BuildOutputInitializer.initializeFromDisk(BuildOutputInitializer.java:47)\r\n\tat com.facebook.buck.rules.CachingBuildRuleBuilder.doInitializeFromDisk(CachingBuildRuleBuilder.java:1276)\r\n\tat com.facebook.buck.rules.CachingBuildRuleBuilder.finalizeBuildRule(CachingBuildRuleBuilder.java:403)\r\n\tat com.facebook.buck.rules.CachingBuildRuleBuilder.lambda$4(CachingBuildRuleBuilder.java:288)\r\n\tat com.facebook.buck.rules.CachingBuildRuleBuilder.lambda$21(CachingBuildRuleBuilder.java:1634)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture$AsyncTransformFuture.doTransform(AbstractTransformFuture.java:211)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture$AsyncTransformFuture.doTransform(AbstractTransformFuture.java:200)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture.run(AbstractTransformFuture.java:130)\r\n\tat com.google.common.util.concurrent.MoreExecutors$5$1.run(MoreExecutors.java:952)\r\n\tat com.facebook.buck.util.concurrent.WeightedListeningExecutorService.lambda$2(WeightedListeningExecutorService.java:104)\r\n\tat com.facebook.buck.util.concurrent.WeightedListeningExecutorService.lambda$0(WeightedListeningExecutorService.java:78)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture$AsyncTransformFuture.doTransform(AbstractTransformFuture.java:211)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture$AsyncTransformFuture.doTransform(AbstractTransformFuture.java:200)\r\n\tat com.google.common.util.concurrent.AbstractTransformFuture.run(AbstractTransformFuture.java:130)\r\n\tat com.google.common.util.concurrent.MoreExecutors$5$1.run(MoreExecutors.java:952)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n\r\n    When building rule //libraries/foundation/realtime/realtime-projectgen:test_main#testsjar.\r\nDownloaded 68.87 Kbytes/sec avg, 3 artifacts, 48.00 Kbytes\r\nBuilding: finished in 2.1 sec (100%) 397/398 jobs, 1 updated, 0.3% cache miss\r\n  Total time: 2.3 sec\r\n```\r\n\r\nThis is kind of serious, as backticks in kotlin are quite normal to avoid keyword collisions", "title": "Buck blows up on backticks in kotlin", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/1621", "user": "ZacSweers"}, {"created": "2017-10-11 23:06:14", "closed": "2018-10-16 14:26:03", "commits": {}, "ttf": 369.0002777777778, "body": "According to Buck documentation, `buck-out` should be ignored by buck filesystem traversal \r\nhttps://buckbuild.com/concept/buckconfig.html#project.ignore\r\nHowever, seems the logic is changed and files under `buck-out` is being parsed by Buck.\r\n\r\nA sample to repo the issue:\r\n1. `git clone git@github.com:zayhero/BugSample.git`\r\n2. \r\n```\r\nbrian_zhang ~/projects/BugSample (master) $ buck targets\r\n//:Ignored.BUCK\r\n```\r\n3. `buck build //:Ignored.BUCK`\r\n4. \r\n```\r\nbrian_zhang ~/projects/BugSample (master) $ buck targets\r\nBuck wasn't able to parse /Users/brian_zhang/projects/BugSample/buck-out/gen/BUCK:\r\nSyntax error on line 1, column 11:\r\nthis should show error error\r\n          ^\r\n```\r\n\r\nThis shows the `BUCK` file under `buck-out` is being parsed which is not align with Buck documentation.\r\nThis introduce problems to us when we using `react-native`. We need to `git clone` or `npm install` react native code which contains some sample `BUCK` files which cause buck build fail.", "title": "buck-out should be ignored by buck filesystem traversal but didn't", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/1578", "user": "zayhero"}, {"changesInPackagesSPOON": [], "created": "2017-09-23 04:17:35", "spoonStatsSummary": {"INS": 0, "spoonMethodsChanged": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "TOT": 0, "UPD": 0}, "commits": {"4e989d5fa80b21b5316041b590dfe1bc40914443": {"commitGHEventType": "closed", "commitUser": "facebook-github-bot"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "RobolectricTestDescription.java", "spoonMethods": [{"INS": 2, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 3, "spoonMethodName": "com.facebook.buck.android.RobolectricTestDescription.createBuildRule(com.facebook.buck.rules.TargetGraph,com.facebook.buck.model.BuildTarget,com.facebook.buck.io.filesystem.ProjectFilesystem,com.facebook.buck.rules.BuildRuleParams,com.facebook.buck.rules.BuildRuleResolver,com.facebook.buck.rules.CellPathResolver,com.facebook.buck.android.RobolectricTestDescriptionArg)"}]}, {"spoonFilePath": "RobolectricTestRuleTest.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 1, "spoonMethodName": "com.facebook.buck.android.RobolectricTestRuleTest.runtimeDepsIncludeTransitiveResources()"}]}, {"spoonFilePath": "RobolectricTestRuleIntegrationTest.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.android.RobolectricTestRuleIntegrationTest"}]}], "nameRev": "4e989d5fa80b21b5316041b590dfe1bc40914443 tags/v2017.10.01.01~101", "commitUser": "facebook-github-bot", "commitHash": "4e989d5fa80b21b5316041b590dfe1bc40914443", "commitDateTime": "2017-09-26 16:36:06", "commitMessage": "Fix robolectric_test dependency on DummyRDotJava\n\nSummary:\nMy ongoing refactor of `DefaultJavaLibraryBuilder` broke `RobolectricTest`. Fixing that and adding\na regression test.\n\nFixes https://github.com/facebook/buck/issues/1537\n\nTest Plan: New integration test\n\nReviewed By: ttsugriy\n\nfbshipit-source-id: d29e6d3\n", "commitGitStats": [{"filePath": "test/com/facebook/buck/android/RobolectricTestRuleIntegrationTest.java", "deletions": 0, "lines": 41, "insertions": 41}, {"filePath": "src/com/facebook/buck/android/RobolectricTestDescription.java", "deletions": 1, "lines": 8, "insertions": 7}, {"filePath": "test/com/facebook/buck/android/testdata/android_project/java/com/sample/lib/BUCK.fixture", "deletions": 0, "lines": 13, "insertions": 13}, {"filePath": "test/com/facebook/buck/android/RobolectricTestRuleTest.java", "deletions": 1, "lines": 2, "insertions": 1}], "commitParents": ["af8d95c37785f382f939864f85016c0d3979c115"], "authoredDateTime": "2017-09-25 11:46:58", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "The `robolectric_test` 's `#dummy_r_dot_java.jar` is no longer added to the compilation classpath. This causes compilation failures due to missing `R` symbols.\r\n\r\nThis seems related to the recent refactoring around these rules done by @jkeljo ", "title": "Recent buck changes around deps to android library rules broke robolectric tests", "closed": "2017-09-26 23:36:24", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["test/com/facebook/buck/android/testdata/android_project/java/com/sample"], "gitStatsSummary": {"gitFilesChange": 1, "lines": 13, "deletions": 0, "insertions": 13}, "ttf": 3.000277777777778, "filteredCommits": ["4e989d5fa80b21b5316041b590dfe1bc40914443"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/1537", "user": "kageiit"}, {"changesInPackagesSPOON": ["com.facebook.buck.android.AndroidBinaryGraphEnhancer.createPreDexRulesForLibraries(java.lang.Iterable,com.facebook.buck.android.packageable.AndroidPackageableCollection)"], "created": "2017-09-09 16:58:36", "spoonStatsSummary": {"INS": 1, "spoonMethodsChanged": 1, "MOV": 12, "DEL": 11, "spoonFilesChanged": 1, "TOT": 26, "UPD": 2}, "commits": {"c70c2f363789e43c7561eeaf7931ec12f5c4d7c8": {"commitGHEventType": "referenced", "commitUser": "facebook-github-bot"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "AndroidBinaryGraphEnhancer.java", "spoonMethods": [{"INS": 1, "MOV": 12, "DEL": 11, "UPD": 2, "TOT": 26, "spoonMethodName": "com.facebook.buck.android.AndroidBinaryGraphEnhancer.createPreDexRulesForLibraries(java.lang.Iterable,com.facebook.buck.android.packageable.AndroidPackageableCollection)"}]}], "nameRev": "c70c2f363789e43c7561eeaf7931ec12f5c4d7c8 tags/v2017.10.01.01~313", "commitUser": "facebook-github-bot", "commitHash": "c70c2f363789e43c7561eeaf7931ec12f5c4d7c8", "commitDateTime": "2017-09-12 16:02:02", "commitMessage": "Replace getRuleOptional..addToIndex with computeIfAbsent for createPreDexRulesForLibraries\n\nSummary:\nThis fixes a potential race condition when doing parallelized action graph creation.\n\nReported in: https://github.com/facebook/buck/issues/1518\n\nTest Plan: CI\n\nReviewed By: ttsugriy\n\nfbshipit-source-id: 2fc49b1\n", "commitGitStats": [{"filePath": "src/com/facebook/buck/android/AndroidBinaryGraphEnhancer.java", "deletions": 21, "lines": 32, "insertions": 11}], "commitParents": ["671fa23ba0e820c4910d785af489a46316a050be"], "authoredDateTime": "2017-09-12 14:42:14", "spoonStatsSkippedReason": "", "commitGHEventType": "referenced"}], "body": "Seems like this option may not be fully ready yet? @yiding \r\n\r\nStacktrace\r\n```\r\nNot using buckd because NO_BUCKD is set.\r\nPARSING BUCK FILES... 3.1s (100%)\r\nCREATING ACTION GRAPH: FINISHED IN 2.2s\r\nBUILDING: FINISHED IN 10.9s\r\nDOWNLOADED 0.00 BYTES/SEC AVG, 0 ARTIFACTS, 0.00 BYTES\r\n[2017-09-09 07:29:26.321][error][command:null][tid:01][com.facebook.buck.cli.Main] Uncaught exception at top level\r\ncom.google.common.util.concurrent.UncheckedExecutionException: java.lang.IllegalStateException: A build rule for this target has already been created: //.okbuck/cache:com.android.support.animated-vector-drawable-26.0.2.aar#aar_prebuilt_jar,dex\r\n\tat com.google.common.util.concurrent.Futures.wrapAndThrowUnchecked(Futures.java:1329)\r\n\tat com.google.common.util.concurrent.Futures.getUnchecked(Futures.java:1314)\r\n\tat com.facebook.buck.rules.MultiThreadedBuildRuleResolver.requireRule(MultiThreadedBuildRuleResolver.java:105)\r\n\tat com.facebook.buck.rules.ActionGraphCache$1.lambda$2(ActionGraphCache.java:215)\r\n\tat java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:602)\r\n\tat java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577)\r\n\tat java.util.concurrent.CompletableFuture$Completion.exec(CompletableFuture.java:443)\r\n\tat java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)\r\n\tat java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056)\r\n\tat java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692)\r\n\tat java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:157)\r\nCaused by: java.lang.IllegalStateException: A build rule for this target has already been created: //.okbuck/cache:com.android.support.animated-vector-drawable-26.0.2.aar#aar_prebuilt_jar,dex\r\n\tat com.google.common.base.Preconditions.checkState(Preconditions.java:444)\r\n\tat com.facebook.buck.rules.MultiThreadedBuildRuleResolver.addToIndex(MultiThreadedBuildRuleResolver.java:118)\r\n\tat com.facebook.buck.android.AndroidBinaryGraphEnhancer.createPreDexRulesForLibraries(AndroidBinaryGraphEnhancer.java:594)\r\n\tat com.facebook.buck.android.AndroidBinaryGraphEnhancer.createAdditionalBuildables(AndroidBinaryGraphEnhancer.java:341)\r\n\tat com.facebook.buck.android.AndroidBinaryDescription.createBuildRule(AndroidBinaryDescription.java:305)\r\n\tat com.facebook.buck.android.AndroidBinaryDescription.createBuildRule(AndroidBinaryDescription.java:1)\r\n\tat com.facebook.buck.rules.DefaultTargetNodeToBuildRuleTransformer.transform(DefaultTargetNodeToBuildRuleTransformer.java:88)\r\n\tat com.facebook.buck.rules.MultiThreadedBuildRuleResolver.lambda$1(MultiThreadedBuildRuleResolver.java:108)\r\n\tat com.facebook.buck.rules.MultiThreadedBuildRuleResolver$2.compute(MultiThreadedBuildRuleResolver.java:155)\r\n\tat java.util.concurrent.RecursiveTask.exec(RecursiveTask.java:94)\r\n\tat java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289)\r\n\tat java.util.concurrent.ForkJoinTask.doJoin(ForkJoinTask.java:389)\r\n\tat java.util.concurrent.ForkJoinTask.get(ForkJoinTask.java:1001)\r\n\tat com.facebook.buck.util.concurrent.WorkThreadTrackingFutureDecorator.get(WorkThreadTrackingFutureDecorator.java:52)\r\n\tat com.google.common.util.concurrent.Uninterruptibles.getUninterruptibly(Uninterruptibles.java:142)\r\n\tat com.google.common.util.concurrent.Futures.getUnchecked(Futures.java:1312)\r\n```", "title": "\"A build rule for this target has already been created\" errors after enabling action_graph_parallelization_enabled", "closed": "2017-12-07 04:28:20", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/com/facebook/buck/android"], "gitStatsSummary": {"gitFilesChange": 1, "lines": 32, "deletions": 21, "insertions": 11}, "ttf": 88.00027777777778, "filteredCommits": ["c70c2f363789e43c7561eeaf7931ec12f5c4d7c8"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/1518", "user": "kageiit"}, {"created": "2016-05-25 04:51:58", "closed": "2018-06-15 00:11:36", "commits": {}, "ttf": 750.0002777777778, "body": "TravisCI busted due to miniz warnings:\n\n``` sh\nBUILD FAILED: //src/com/facebook/buck/android/agent/native:native failed with exit code 2:\nndk_build\nstderr: ./miniz.c: In function 'tdefl_find_match':\n./miniz.c:2283:3: error: dereferencing type-punned pointer will break strict-aliasing rules [-Werror=strict-aliasing]\n   mz_uint16 c01 = TDEFL_READ_UNALIGNED_WORD(&d->m_dict[pos + match_len - 1]), s01 = TDEFL_READ_UNALIGNED_WORD(s);\n   ^\n./miniz.c:2295:7: error: dereferencing type-punned pointer will break strict-aliasing rules [-Werror=strict-aliasing]\n       TDEFL_PROBE; TDEFL_PROBE; TDEFL_PROBE;\n       ^\n./miniz.c:2295:7: error: dereferencing type-punned pointer will break strict-aliasing rules [-Werror=strict-aliasing]\n./miniz.c:2295:7: error: dereferencing type-punned pointer will break strict-aliasing rules [-Werror=strict-aliasing]\n./miniz.c:2307:7: error: dereferencing type-punned pointer will break strict-aliasing rules [-Werror=strict-aliasing]\n       c01 = TDEFL_READ_UNALIGNED_WORD(&d->m_dict[pos + match_len - 1]);\n       ^\n./miniz.c: In function 'tdefl_compress_fast':\n./miniz.c:2380:7: error: dereferencing type-punned pointer will break strict-aliasing rules [-Werror=strict-aliasing]\n       if (((cur_match_dist = (mz_uint16)(lookahead_pos - probe_pos)) <= dict_size) && ((*(const mz_uint32 *)(d->m_dict + (probe_pos &= TDEFL_LZ_DICT_SIZE_MASK)) & 0xFFFFFF) == first_trigram))\n       ^\ncc1: all warnings being treated as errors\nmake: *** [/home/travis/build/facebook/buck/buck-out/bin/src/com/facebook/buck/android/agent/native/__libnative//local/x86/objs/agent-disguised-exe/miniz.o] Error 1\n```\n", "title": "TravisCI busted due to miniz warnings", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/758", "user": "LegNeato"}, {"created": "2016-03-07 05:11:40", "closed": "2020-02-29 00:14:50", "commits": {}, "ttf": 1453.0002777777777, "body": "`labels` and `attrfilter` don't work with the `visibility` attribute.\n", "title": "Can't use buck query with visibility", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/687", "user": "mikekap"}, {"created": "2016-02-01 15:57:05", "closed": "2016-02-04 18:38:10", "commits": {}, "ttf": 3.000277777777778, "body": "Commit 07060eb97af6bb2b53a3b9a239cc614255e1ef35 has caused a regression of issue #434. Ping @ruibm \n\nWe have a requirement that we cannot host our http cache at the root URL.  Our buckconfig looks like:\n\n[cache]\n  mode = http\n  http_url = http://our.cache.server.lmax.com/buckcache/\n  http_mode = readonly\n  http_timeout_seconds = 5\n\nPreviously this would result is cache reads being resolved to http://our.cache.server.lmax.com/buckcache/artifacts/key/00000000000000000000000000000000 but after this change they new resolve to http://our.cache.server.lmax.com/artifacts/key/00000000000000000000000000000000.\n\nThe same is true for cache writes - where they previously resolved to http://our.cache.server.lmax.com/buckcache/artifacts/key they now resolve to http://our.cache.server.lmax.com/artifacts/key.\n", "title": "path in cache's http_url being ignored (again)", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/640", "user": "sea36"}, {"created": "2016-01-20 14:34:56", "closed": "2016-01-21 12:20:43", "commits": {}, "ttf": 0.0002777777777777778, "body": "Over the last week we have seen a number of flaky travis builds point to the test => com.facebook.buck.jvm.groovy.GroovyTestIntegrationTest\n\nHere are a couple of pointers to travis:\n1. https://travis-ci.org/facebook/buck/builds/103583967\n2. https://travis-ci.org/facebook/buck/builds/103575124\n3. https://travis-ci.org/facebook/buck/builds/103459312\n\nI'll go ahead and disable this test in travis until this is resolved.\n", "title": "GroovyTestIntegrationTest are flaky in Travis", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/626", "user": "ruibm"}, {"created": "2016-01-17 00:24:24", "closed": "2016-01-20 10:50:37", "commits": {}, "ttf": 3.000277777777778, "body": "The command `buck quickstart --type android --dest-dir .` generates a default .hgignore file with the following contents:\n\n```\n*.iml\n/.idea/compiler.xml\n/.idea/libraries/*.xml\n/.idea/modules.xml\n/.idea/runConfigurations/Debug_Buck_test.xml\n/buck-cache\n/buck-out\n/.buckd\n```\n\nRunning the command the `hg init && hg status` on the newly generated project gives an error:\n\n`abort: /path/to/project/.hgignore: invalid pattern (relre): *.iml`\n\nLooks like the default .hgignore file is missing a `syntax: glob` at the beginning\n\nMecurial Version: 3.6.3\nBuck Version: v2015.12.14.01\n", "title": "Android Quickstart .hgignore file has invalid pattern", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/619", "user": "DanielGrech"}, {"created": "2015-12-23 19:16:25", "closed": "2016-12-12 18:39:31", "commits": {}, "ttf": 354.0002777777778, "body": "When Apache XMLBeans is referenced as a prebuilt_jar, Buck complains as follows:\n\n```\nMultiple entries with same key: org/apache/xmlbeans/xml/stream/Location=b010d46296931435514ab3d6237b17e03df64e5b and org/apache/xmlbeans/xml/stream/Location=b010d46296931435514ab3d6237b17e03df64e5b\njava.lang.IllegalArgumentException: Multiple entries with same key: org/apache/xmlbeans/xml/stream/Location=b010d46296931435514ab3d6237b17e03df64e5b and org/apache/xmlbeans/xml/stream/Location=b010d46296931435514ab3d6237b17e03df64e5b\n    at com.google.common.collect.ImmutableMap.checkNoConflict(ImmutableMap.java:150)\n    at com.google.common.collect.ImmutableSortedMap.validateEntries(ImmutableSortedMap.java:300)\n    at com.google.common.collect.ImmutableSortedMap.fromEntries(ImmutableSortedMap.java:286)\n    at com.google.common.collect.ImmutableSortedMap$Builder.build(ImmutableSortedMap.java:408)\n    at com.facebook.buck.jvm.java.AccumulateClassNamesStep.calculateClassHashes(AccumulateClassNamesStep.java:169)\n    at com.facebook.buck.jvm.java.AccumulateClassNamesStep.execute(AccumulateClassNamesStep.java:84)\n    at com.facebook.buck.step.DefaultStepRunner.runStepForBuildTarget(DefaultStepRunner.java:63)\n    at com.facebook.buck.rules.CachingBuildEngine.executeCommandsNowThatDepsAreBuilt(CachingBuildEngine.java:1085)\n    at com.facebook.buck.rules.CachingBuildEngine.access$900(CachingBuildEngine.java:106)\n    at com.facebook.buck.rules.CachingBuildEngine$4.apply(CachingBuildEngine.java:457)\n    at com.facebook.buck.rules.CachingBuildEngine$4.apply(CachingBuildEngine.java:311)\n    at com.google.common.util.concurrent.Futures$ChainingListenableFuture.run(Futures.java:906)\n    at com.google.common.util.concurrent.Futures$1$1.run(Futures.java:635)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n```\n\nThis is because the xmlbeans JAR has multiple duplicate entries for the same file:\n\n``` sh\n> unzip -l buck-out/gen/xmlbeans.jar | grep '/Location\\.class'\n      251  07-23-12 15:42   org/apache/xmlbeans/xml/stream/Location.class\n      251  07-23-12 15:42   org/apache/xmlbeans/xml/stream/Location.class\n```\n\nEven though this JAR works with Java, it would be nice to write this off as 'this is a bad JAR file, because it contains multiple entries for the same class'.  Unfortunately, there is another major build system that has had [known](https://issues.gradle.org/browse/GRADLE-1050) [issues](https://issues.gradle.org/browse/GRADLE-2171) where it can create JARs with multiple entries...\n\nSteps to reproduce:\n\n```\ngit clone https://gist.github.com/rhencke/61216f1778231ce6bd10 jarissue\ncd jarissue\nbuck fetch :xmlbeans\nbuck build :xmlbeans\n```\n", "title": "Buck is allergic to Apache XMLBeans", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/587", "user": "rhencke"}, {"created": "2015-12-03 23:34:56", "closed": "2015-12-06 17:36:14", "commits": {}, "ttf": 2.000277777777778, "body": "I'm trying to isolate third party library in its own cell inside my project:\n\n```\nrepositories.jgit = lib/jgit\n```\n\nThe `jgit_src` is defined as:\n\n```\n$ buck targets --json //lib/jgit:jgit_src\n[\n{\n  \"binaryJar\" : \":jgit__download_src\",\n  \"buck.base_path\" : \"\",\n  \"buck.direct_dependencies\" : [ \"//lib:LICENSE-jgit\", \"//lib/jgit:jgit__download_src\" ],\n  \"buck.type\" : \"prebuilt_jar\",\n  \"deps\" : [ \"//lib:LICENSE-jgit\" ],\n  \"gwtJar\" : null,\n  \"javadocUrl\" : null,\n  \"mavenCoords\" : null,\n  \"name\" : \"jgit_src\",\n  \"sourceJar\" : null,\n  \"visibility\" : [ \"PUBLIC\" ]\n}\n]\n```\n\nAnd the target output is located:\n\n```\n$ buck targets --show_output //lib/jgit:jgit_src\n/lib/jgit:jgit_src buck-out/gen/lib/jgit/jgit_src.jar\n\n$ ls -all buck-out/gen/lib/jgit/jgit_src.jar\n-rw-r--r-- 1 davido users 2025387 Dec  4 00:23 buck-out/gen/lib/jgit/jgit_src.jar\n```\n\nNow, the consumer is saying this:\n\n```\ngenrule(\n  name = 'jgit_edit_src',\n  cmd = 'unzip -qd $TMP $(location @jgit//:jgit_src) ' +\n    'org/eclipse/jgit/diff/Edit.java;' +\n    'cd $TMP;' +\n    'zip -Dq $OUT org/eclipse/jgit/diff/Edit.java',\n  out = 'edit.src.zip',\n)\n```\n\nBut the `location` macros expansion is relocated in root context of cell container:\n\n```\n(cd /home/davido/projects/gerrit/buck-out/gen/gerrit-patch-jgit/jgit_edit_src__srcs && OUT=/home/davido/projects/gerrit/buck-out/gen/gerrit-patch-jgit/jgit_edit_src/edit.src.zip TMP=/home/davido/projects/gerrit/buck-out/gen/gerrit-patch-jgit/jgit_edit_src__tmp /bin/bash -e -c 'unzip -qd $TMP /home/davido/projects/gerrit/buck-out/gen/jgit_src.jar org/eclipse/jgit/diff/Edit.java;cd $TMP;zip -Dq $OUT org/eclipse/jgit/diff/Edit.java')\n```\n\nI would expect, that it should expand to `buck-out/gen/lib/jgit/jgit_src.jar` instead.\n", "title": "Poblem with $(location :foo) macro expansion in cross-cell context", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/544", "user": "davido"}, {"changesInPackagesSPOON": ["com.facebook.buck.zip.SrcZipAwareFileBundler.copy(com.facebook.buck.io.ProjectFilesystem,com.facebook.buck.rules.SourcePathResolver,com.google.common.collect.ImmutableList$Builder,java.nio.file.Path,java.lang.Iterable,boolean)"], "created": "2015-12-02 23:03:20", "spoonStatsSummary": {"INS": 3, "spoonMethodsChanged": 1, "MOV": 3, "DEL": 3, "spoonFilesChanged": 1, "TOT": 10, "UPD": 1}, "commits": {"98f90120601b35b6f6747b11ff68de9c4662beee": {"commitGHEventType": "closed", "commitUser": "andrewjcg"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "SrcZipAwareFileBundler.java", "spoonMethods": [{"INS": 3, "MOV": 3, "DEL": 3, "UPD": 1, "TOT": 10, "spoonMethodName": "com.facebook.buck.zip.SrcZipAwareFileBundler.copy(com.facebook.buck.io.ProjectFilesystem,com.facebook.buck.rules.SourcePathResolver,com.google.common.collect.ImmutableList$Builder,java.nio.file.Path,java.lang.Iterable,boolean)"}]}, {"spoonFilePath": "ZipRuleIntegrationTest.java", "spoonMethods": [{"INS": 1, "MOV": 6, "DEL": 3, "UPD": 4, "TOT": 14, "spoonMethodName": "com.facebook.buck.zip.ZipRuleIntegrationTest.shouldZipSources()"}]}], "nameRev": "98f90120601b35b6f6747b11ff68de9c4662beee tags/v2015.12.14.01~92", "commitUser": "andrewjcg", "commitHash": "98f90120601b35b6f6747b11ff68de9c4662beee", "commitDateTime": "2015-12-02 17:49:54", "commitMessage": "zip_rule: don't zip entries as symlinks\n\nSummary:\nPreviously, we'd setup a symlink tree to sandbox the files we'd\nzip up, which meant we'd zip them up as symlinks rather than the\nactual files.  This diff switches to copying into the sandbox dir\ninstead.\n\nOn another note, our symlink zipping is broken, as we set the symlink\nattribute, but then zip up the file contents rather than the link\ntarget.\n\nCloses #542\n\nTest Plan: updated tests to verify perms\n\nReviewed By: bhamiltoncx\n\nfb-gh-sync-id: 7255487\n", "commitGitStats": [{"filePath": "src/com/facebook/buck/zip/SrcZipAwareFileBundler.java", "deletions": 6, "lines": 13, "insertions": 7}, {"filePath": "test/com/facebook/buck/zip/ZipRuleIntegrationTest.java", "deletions": 3, "lines": 27, "insertions": 24}], "commitParents": ["9a19b8a58edf4591bb4543620877d52bd7351f14"], "authoredDateTime": "2015-12-02 17:49:31", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "This is on buck version v2015.11.23.01, on OS X 10.10.5 (14F1021)\n\nSteps to reproduce:\n\n```\ngit clone https://gist.github.com/rhencke/258d4bfe8634f55943da zipissue\ncd zipissue\nbuck build :foo\ncd buck-out/gen\nunzip foo.zip\n```\n\n(Note the source file, foo.txt, is a normal file, with the ASCII content 'hello')\n\nExpected results:\nfoo.zip contains file foo.txt, with content 'hello'\n`-rw-r--r-- foo.txt`\n\nActual results:\nfoo.zip contains a symlink named foo.txt, which links to the path 'hello'\n`lrwxr-xr-x foo.txt -> hello`\n", "title": "zip_file creates symlinks linking to file content as path", "closed": "2015-12-03 01:53:34", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/com/facebook/buck/zip"], "gitStatsSummary": {"gitFilesChange": 1, "lines": 13, "deletions": 6, "insertions": 7}, "ttf": 0.0002777777777777778, "filteredCommits": ["98f90120601b35b6f6747b11ff68de9c4662beee"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/542", "user": "rhencke"}, {"created": "2015-11-30 20:42:54", "spoonStatsSummary": {}, "commits": {"126cdd1da4d1d6c72dfa59afd6c9cd668bb8ca46": {"commitGHEventType": "closed", "commitUser": "bhamiltoncx"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "126cdd1da4d1d6c72dfa59afd6c9cd668bb8ca46 tags/v2015.12.14.01~108", "commitUser": "bhamiltoncx", "commitHash": "126cdd1da4d1d6c72dfa59afd6c9cd668bb8ca46", "commitDateTime": "2015-12-01 16:47:42", "commitMessage": "Update Python Nailgun client to handle socket.error exceptions\n\nSummary: Users on Linux reported the new Python Nailgun client\nwas leaking `socket.error` exceptions.\n\nThis caused the client (at least on Linux) to incorrectly exit with an\nerror code when shutting down the server, since the server abruptly\ncloses the socket without sending an exit code when we do that.\n\nThis fixes the Python client to turn `socket.error` exceptions\ninto `NailgunException`s with code `CONNECTION_BROKEN` to mirror\nthe behavior of the C client.\n\nNow, the Buck wrapper for the Python Nailgun client will correctly\nignore connection broken errors when shutting down the server.\n\nCloses https://github.com/facebook/buck/issues/534\n\nTest Plan: `buck clean; buck build buck` on Mac.\nAsked original bug reporters to test patch, they confirmed it\nfixed the issue in the Gerrit repo.\n\nReviewed By: sdwilsh\n\nfb-gh-sync-id: 1d9aa34\n", "commitGitStats": [{"filePath": "third-party/nailgun/pynailgun/ng.py", "deletions": 2, "lines": 18, "insertions": 16}], "commitParents": ["89a80cd96f2ca425fd9735525a4d3232fda43d7c"], "authoredDateTime": "2015-12-01 16:11:15", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "I'm having the issue described in d32c960779e496bdf0bddba9d18ad76e89d77d1b, but that commit hasn't fixed the problem (I'm running at 665524d51117957db520323288db886e58af3db8). I didn't see an open issue tracking this, so I'm filing a new one.\n\nI went to look for the debug logging referred to in bhamiltoncx/nailgun@c2788d68d67247a1b30ef7a857027f9b877827ea, but can't find it in buck-out/log. I can reproduce this pretty reliably (25% or so of the time), so let me know where to find logs and I'll be happy to provide them.\n\nI'm reproducing with:\n\n```\nrm -f buck-out/log/buck*.log; buck clean && rm -rf buck-out eclipse-out && buck build gerrit-common:server\n```\n", "title": "Nailgun python client gets connection closed", "closed": "2015-12-02 00:51:22", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["third-party/nailgun/pynailgun/ng.py"], "gitStatsSummary": {"gitFilesChange": 1, "lines": 18, "deletions": 2, "insertions": 16}, "ttf": 1.0002777777777778, "filteredCommits": ["126cdd1da4d1d6c72dfa59afd6c9cd668bb8ca46"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/534", "user": "dborowitz"}, {"created": "2015-11-10 00:54:20", "closed": "2016-04-11 16:55:44", "commits": {}, "ttf": 153.00027777777777, "body": "If you look at https://github.com/facebook/buck/blob/master/test/com/facebook/buck/android/testdata/android_instrumentation_test_integration_test/buck-android-support.jar, the jar file is empty. Is that intentional? It seems to be crashing my build. I can look further into the build failure if the empty file is intentional, but it seemed iffy.\n", "title": "Empty jar committed to repository", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/501", "user": "copumpkin"}, {"created": "2015-10-16 12:29:22", "closed": "2020-03-04 01:14:41", "commits": {}, "ttf": 1600.0002777777777, "body": "Since switch to top-down parsing, Gerrit build is intermittently broken.\nConsider the following rules:\n\n```\n$ buck targets --json //gerrit-gwtui:ui_opt\nUsing buckd.\n[\n{\n  \"buck.base_path\" : \"gerrit-gwtui\",\n  \"buck.direct_dependencies\" : [ \"//gerrit-gwtexpui:CSS\", \"//lib/gwt:dev\", \"//lib:gwtjsonrpc\", \"//gerrit-gwtui:ui_module\" ],\n  \"buck.type\" : \"gwt_binary\",\n  \"deps\" : [ \"//gerrit-gwtexpui:CSS\", \"//lib:gwtjsonrpc\", \"//lib/gwt:dev\" ],\n  \"draftCompile\" : null,\n  \"experimentalArgs\" : [ \"-XdisableClassMetadata\" ],\n  \"localWorkers\" : 8,\n  \"moduleDeps\" : [ \":ui_module\" ],\n  \"modules\" : [ \"com.google.gerrit.GerritGwtUI\" ],\n  \"name\" : \"ui_opt\",\n  \"optimize\" : null,\n  \"strict\" : true,\n  \"style\" : null,\n  \"visibility\" : [ ],\n  \"vmArgs\" : [ \"-Xmx512m\" ]\n}\n]\n```\n\nWhere `//lib/gwt:dev`:\n\n```\n$ buck targets --json //lib/gwt:dev\nUsing buckd.\n[\n{\n  \"annotationProcessorDeps\" : [ ],\n  \"annotationProcessorOnly\" : null,\n  \"annotationProcessorParams\" : [ ],\n  \"annotationProcessors\" : [ ],\n  \"buck.base_path\" : \"lib/gwt\",\n  \"buck.direct_dependencies\" : [ \"//lib/gwt:dev__jar\", \"//lib/gwt:javax-validation\", \"//lib/gwt:javax-validation_src\", \"//lib/ow2:ow2-asm\", \"//lib/ow2:ow2-asm-analysis\", \"//lib/ow2:ow2-asm-commons\", \"//lib/ow2:ow2-asm-tree\", \"//lib/ow2:ow2-asm-util\" ],\n  \"buck.type\" : \"java_library\",\n  \"compiler\" : null,\n  \"deps\" : [ ],\n  \"exportedDeps\" : [ \":javax-validation\", \":javax-validation_src\", \"//lib/ow2:ow2-asm\", \"//lib/ow2:ow2-asm-analysis\", \"//lib/ow2:ow2-asm-commons\", \"//lib/ow2:ow2-asm-tree\", \"//lib/ow2:ow2-asm-util\", \":dev__jar\" ],\n  \"extraArguments\" : [ \"-encoding\", \"UTF-8\" ],\n  \"javaVersion\" : null,\n  \"javac\" : null,\n  \"javacJar\" : null,\n  \"mavenCoords\" : null,\n  \"name\" : \"dev\",\n  \"postprocessClassesCommands\" : [ ],\n  \"proguardConfig\" : null,\n  \"providedDeps\" : [ ],\n  \"resources\" : [ ],\n  \"resourcesRoot\" : null,\n  \"source\" : null,\n  \"srcs\" : [ ],\n  \"target\" : null,\n  \"tests\" : [ ],\n  \"visibility\" : [ \"PUBLIC\" ]\n}\n]\n```\n\nNote the exporting deps above:\n\n```\n//lib/ow2:ow2-asm\n```\n\nbuilding GWT rule with:\n\n```\n  buck build //gerrit-gwtui:ui_opt\n```\n\nis failing with: http://paste.openstack.org/show/476478\n\nThat's because:\n\n```\n$ buck targets --show_output //lib/ow2:ow2-asm\nUsing buckd.\n[+] PROCESSING BUCK FILES...0,1s [100%]\n//lib/ow2:ow2-asm buck-out/gen/lib/ow2/ow2-asm.jar\n```\n\nsupposed to be there, but isn't:\n\n```\n$ ls -all buck-out/gen/lib/ow2/ow2-asm.jar\nls: cannot access buck-out/gen/lib/ow2/ow2-asm.jar: No such file or directory\n```\n\nWorkaround: building bottom-up also fetches exported_deps:\n\n```\n$ buck build --deep //gerrit-gwtui:ui_opt\nUsing buckd.\n[-] PROCESSING BUCK FILES...FINISHED 0,3s [100%]\n[+] BUILDING...5,8s [50%] (202/203 JOBS, 167 UPDATED, 0,0% CACHE MISS)\n |=> IDLE\n |=> IDLE\n |=> IDLE\n |=> //lib/gwt:dev__jar...  5,7s (checking local cache)\n |=> IDLE\n |=> IDLE\n |=> IDLE\n |=> //gerrit-gwtui:ui_opt...  5,1s (running gwt-compile[5,1s])\n |=> //lib/gwt:user...  5,7s (checking local cache)\n |=> IDLE\n\n```\n\nShouldn't exported deps be fetched from the cache also without --deep option in this case?\n", "title": "Problem with top-down graph traversing and exported_deps", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/469", "user": "davido"}, {"created": "2015-10-15 20:15:05", "closed": "2015-11-06 11:41:10", "commits": {}, "ttf": 21.00027777777778, "body": "I'm currently trying to generate an Xcode project for a build target and am hitting this error:\n\n```\n[2015-10-15 13:10:25.554][error][command:d460f5e8-8e3a-4500-86df-c928b9f7e0d4][tid:700][com.facebook.buck.cli.Main] Uncaught exception at top level\njava.lang.NullPointerException\n    at com.facebook.buck.apple.SchemeGenerator.writeScheme(SchemeGenerator.java:133)\n    at com.facebook.buck.apple.WorkspaceAndProjectGenerator.writeWorkspaceSchemes(WorkspaceAndProjectGenerator.java:845)\n    at com.facebook.buck.apple.WorkspaceAndProjectGenerator.generateWorkspaceAndDependentProjects(WorkspaceAndProjectGenerator.java:413)\n    at com.facebook.buck.cli.ProjectCommand.generateWorkspacesForTargets(ProjectCommand.java:808)\n    at com.facebook.buck.cli.ProjectCommand.runXcodeProjectGenerator(ProjectCommand.java:707)\n    at com.facebook.buck.cli.ProjectCommand.runWithoutHelp(ProjectCommand.java:432)\n    at com.facebook.buck.cli.AbstractCommand.run(AbstractCommand.java:153)\n    at com.facebook.buck.cli.BuckCommand.run(BuckCommand.java:84)\n    at com.facebook.buck.cli.Main.runMainWithExitCode(Main.java:792)\n    at com.facebook.buck.cli.Main.tryRunMainWithExitCode(Main.java:1168)\n    at com.facebook.buck.cli.Main.runMainThenExit(Main.java:1225)\n    at com.facebook.buck.cli.Main.nailMain(Main.java:1254)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:606)\n    at com.martiansoftware.nailgun.NGSession.run(NGSession.java:331)\n\n```\n\nI'm unsure exactly what's causing this to happen - I will update if I have more exact steps to repro. \n", "title": "NullPointerException when generating Xcode project", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/468", "user": "lucidsheep"}, {"created": "2015-10-13 06:46:32", "closed": "2020-03-04 01:25:11", "commits": {}, "ttf": 1603.0002777777777, "body": "com.facebook.buck.android.aapt.MiniAapt.ResourceParseException: 'res/.svn' is not a valid resource sub-directory.\ncom.facebook.buck.android.aapt.MiniAapt$ResourceParseException: 'res/.svn' is not a valid resource sub-directory.\n    at com.facebook.buck.android.aapt.MiniAapt.processFileNamesInDirectory(MiniAapt.java:238)\n    at com.facebook.buck.android.aapt.MiniAapt.collectResources(MiniAapt.java:223)\n    at com.facebook.buck.android.aapt.MiniAapt.execute(MiniAapt.java:142)\n    at com.facebook.buck.step.DefaultStepRunner.runStepForBuildTarget(DefaultStepRunner.java:63)\n    at com.facebook.buck.rules.CachingBuildEngine.executeCommandsNowThatDepsAreBuilt(CachingBuildEngine.java:967)\n    at com.facebook.buck.rules.CachingBuildEngine.access$600(CachingBuildEngine.java:88)\n    at com.facebook.buck.rules.CachingBuildEngine$1.apply(CachingBuildEngine.java:367)\n    at com.facebook.buck.rules.CachingBuildEngine$1.apply(CachingBuildEngine.java:239)\n    at com.google.common.util.concurrent.Futures$ChainingListenableFuture.run(Futures.java:906)\n    at com.google.common.util.concurrent.Futures$1$1.run(Futures.java:635)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\n\nBUILD FAILED: //:res failed with exit code 1:\ngenerate_resource_ids\n\n .watchmanconfig file config:\n{\n  \"ignore_dirs\": [\n    \".svn\"\n  ],\n  \"ignore_vcs\": [\n    \".svn\"\n  ]\n}\n\nalso, .buckconfig config:\n[java]\n  src_roots = java, resources\n[cache]\n  mode = dir\n  dir = buck-out/cache\n[project]\n  ignore = .svn\n\n[android]\n  target = android-21\n", "title": "Error parsing resources to generate resource IDs for res", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/460", "user": "zjzxzhang"}, {"created": "2015-10-11 11:50:04", "closed": "2020-03-04 01:29:29", "commits": {}, "ttf": 1605.0002777777777, "body": "prebuilt_jar need the exported_deps argument\n\n``` python\nprebuilt_jar(\n  name = 'retrofit',\n  maven_coords = 'com.squareup.retrofit:retrofit:jar:2.0.0-beta2',\n  binary_jar = 'retrofit-2.0.0-beta2.jar',\n  source_jar = 'retrofit-2.0.0-beta2-sources.jar',\n  deps = [\n    '//third-party/okhttp:okhttp'\n  ],visibility = [\n    'PUBLIC'\n  ]\n)\n```\n\nwhen android_library depend the retrofit jar, can't direct use the okhttp class.\n", "title": "Added deps on prebuilt_jar rule are not available as expected", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/457", "user": "hujin1860"}, {"changesInPackagesSPOON": ["com.facebook.buck.file.OnDiskMavenDownloader", "com.facebook.buck.file.StackedDownloader.createFromConfig(com.facebook.buck.cli.BuckConfig,com.google.common.base.Optional)"], "created": "2015-10-08 20:00:44", "spoonStatsSummary": {"INS": 5, "spoonMethodsChanged": 2, "MOV": 8, "DEL": 3, "spoonFilesChanged": 2, "TOT": 18, "UPD": 2}, "commits": {"24b64dc63078eeeac5486617406ab34271d6c206": {"commitGHEventType": "closed", "commitUser": "sdwilsh"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "StackedDownloaderTest.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.file.StackedDownloaderTest.shouldThrowReadableExceptionWhenUrlPathDoesntExist()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.file.StackedDownloaderTest.shouldThrowReadableExceptionWhenPathDoesntExist()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.file.StackedDownloaderTest"}]}, {"spoonFilePath": "StackedDownloader.java", "spoonMethods": [{"INS": 4, "MOV": 5, "DEL": 2, "UPD": 0, "TOT": 11, "spoonMethodName": "com.facebook.buck.file.StackedDownloader.createFromConfig(com.facebook.buck.cli.BuckConfig,com.google.common.base.Optional)"}]}, {"spoonFilePath": "OnDiskMavenDownloaderTest.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.file.OnDiskMavenDownloaderTest"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.file.OnDiskMavenDownloaderTest.shouldThrowFileNotFoundExceptionWhenPathDoesntExist()"}]}, {"spoonFilePath": "OnDiskMavenDownloader.java", "spoonMethods": [{"INS": 1, "MOV": 3, "DEL": 1, "UPD": 2, "TOT": 7, "spoonMethodName": "com.facebook.buck.file.OnDiskMavenDownloader"}]}], "nameRev": "24b64dc63078eeeac5486617406ab34271d6c206 tags/v2015.11.02.01~47", "commitUser": "sdwilsh", "commitHash": "24b64dc63078eeeac5486617406ab34271d6c206", "commitDateTime": "2015-10-27 08:13:17", "commitMessage": "If Maven path doesn't exist, OnDiskMavenDownloader throws HumanReadableException\n\nSummary:\nIf Maven path doesn't exist, OnDiskMavenDownloader throws \"Maven cache root doesn't exist.\" Added a test for that.\nCloses https://github.com/facebook/buck/issues/454\n\nTest Plan: ant clean lint && ant && buck test\n", "commitGitStats": [{"filePath": "test/com/facebook/buck/file/StackedDownloaderTest.java", "deletions": 0, "lines": 45, "insertions": 45}, {"filePath": "test/com/facebook/buck/file/OnDiskMavenDownloaderTest.java", "deletions": 0, "lines": 19, "insertions": 19}, {"filePath": "src/com/facebook/buck/file/OnDiskMavenDownloader.java", "deletions": 3, "lines": 11, "insertions": 8}, {"filePath": "src/com/facebook/buck/file/StackedDownloader.java", "deletions": 6, "lines": 29, "insertions": 23}], "commitParents": ["d2c6edbf7b41ee5662902c1f06f570fa4bc8e005"], "authoredDateTime": "2015-10-24 16:59:07", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "I was trying buck out on a vm, and I had forgotten to install and initialize maven. As a result, when I ran buck I got the following output. It would be better if the exception message noted that the missing root is the maven cache root.\n\n```\n.buck.cli.Main] Uncaught exception at top level\njava.lang.IllegalArgumentException: Root does not exist\n    at com.google.common.base.Preconditions.checkArgument(Preconditions.java:122)\n    at com.facebook.buck.file.OnDiskMavenDownloader.<init>(OnDiskMavenDownloader.java:39)\n    at com.facebook.buck.file.StackedDownloader.createFromConfig(StackedDownloader.java:76)\n    at com.facebook.buck.rules.KnownBuildRuleTypes.createBuilder(KnownBuildRuleTypes.java:399)\n    at com.facebook.buck.rules.KnownBuildRuleTypes.createInstance(KnownBuildRuleTypes.java:210)\n    at com.facebook.buck.rules.KnownBuildRuleTypesFactory.create(KnownBuildRuleTypesFactory.java:55)\n    at com.facebook.buck.rules.Cell.<init>(Cell.java:93)\n    at com.facebook.buck.cli.Main.runMainWithExitCode(Main.java:597)\n    at com.facebook.buck.cli.Main.tryRunMainWithExitCode(Main.java:1168)\n    at com.facebook.buck.cli.Main.runMainThenExit(Main.java:1225)\n    at com.facebook.buck.cli.Main.main(Main.java:1243)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:606)\n    at com.facebook.buck.cli.bootstrapper.ClassLoaderBootstrapper.main(ClassLoaderBootstrapper.java:62)\n```\n", "title": "If there isn't a maven cache for the current user, the resulting error message is a bit opaque", "closed": "2015-10-27 15:15:21", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/com/facebook/buck/file"], "gitStatsSummary": {"gitFilesChange": 2, "lines": 40, "deletions": 9, "insertions": 31}, "ttf": 18.00027777777778, "filteredCommits": ["24b64dc63078eeeac5486617406ab34271d6c206"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/454", "user": "baroquebobcat"}, {"changesInPackagesSPOON": ["com.facebook.buck.cli.ProjectCommand"], "created": "2015-10-05 23:29:50", "spoonStatsSummary": {"INS": 0, "spoonMethodsChanged": 1, "MOV": 0, "DEL": 0, "spoonFilesChanged": 1, "TOT": 2, "UPD": 2}, "commits": {"63e1a21b0c79197fb392adc9981a71df8f960b14": {"commitGHEventType": "closed", "commitUser": "sdwilsh"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "ProjectCommand.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 2, "TOT": 2, "spoonMethodName": "com.facebook.buck.cli.ProjectCommand"}]}], "nameRev": "63e1a21b0c79197fb392adc9981a71df8f960b14 tags/v2015.10.19.01~67", "commitUser": "sdwilsh", "commitHash": "63e1a21b0c79197fb392adc9981a71df8f960b14", "commitDateTime": "2015-10-08 14:19:34", "commitMessage": "Fix CLI docs --ide option\n\nSummary:\nFix CLI docs --ide option\n\nCloses #452\n\nTest Plan: buck project --help, make sure --ide does not mention default options.\n", "commitGitStats": [{"filePath": "docs/concept/buckconfig.soy", "deletions": 0, "lines": 10, "insertions": 10}, {"filePath": "src/com/facebook/buck/cli/ProjectCommand.java", "deletions": 2, "lines": 4, "insertions": 2}, {"filePath": "docs/command/project.soy", "deletions": 1, "lines": 3, "insertions": 2}], "commitParents": ["3aaf0eac2127179477b4a251c7e670721ee8603d"], "authoredDateTime": "2015-10-07 05:58:40", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "The help text says it will default to intellij if not set [ref](https://github.com/facebook/buck/blob/b8fa3fa7c03a8df28deaa53ece5078d66024d1e4/src/com/facebook/buck/cli/ProjectCommand.java#L181-L182), but instead it asks you to provide or set it:\n\n```\n$ ./buck project\n...\n\nUsing buckd.\n[+] PROCESSING BUCK FILES...24.1s [100%]\nBUILD FAILED: Please specify ide using --ide option or set ide in .buckconfig\n```\n", "title": "./buck project --ide option says providing a value is optional, but requires value", "closed": "2015-10-08 21:29:41", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["docs/command/project.soy", "src/com/facebook/buck/cli", "docs/concept/buckconfig.soy"], "gitStatsSummary": {"gitFilesChange": 3, "lines": 17, "deletions": 3, "insertions": 14}, "ttf": 2.000277777777778, "filteredCommits": ["63e1a21b0c79197fb392adc9981a71df8f960b14"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/452", "user": "baroquebobcat"}, {"created": "2015-10-02 06:09:05", "closed": "2015-10-19 00:05:05", "commits": {}, "ttf": 16.00027777777778, "body": "This is related to #350. I currently run into the following error:\n\n[2015-10-01 23:00:43.226][error][command:65b949e6-99f9-4c2b-a6ea-08824173e257][tid:379][com.facebook.buck.cli.Main] Uncaught exception at top level\njava.lang.NullPointerException\n    at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:210)\n    at com.facebook.buck.java.JavaFileParser.createJavaFileParser(JavaFileParser.java:68)\n    at com.facebook.buck.cli.ProjectCommand.runExperimentalIntellijProjectGenerator(ProjectCommand.java:535)\n    at com.facebook.buck.cli.ProjectCommand.runIntellijProjectGenerator(ProjectCommand.java:573)\n    at com.facebook.buck.cli.ProjectCommand.runWithoutHelp(ProjectCommand.java:425)\n    at com.facebook.buck.cli.AbstractCommand.run(AbstractCommand.java:153)\n    at com.facebook.buck.cli.BuckCommand.run(BuckCommand.java:84)\n    at com.facebook.buck.cli.Main.runMainWithExitCode(Main.java:792)\n    at com.facebook.buck.cli.Main.tryRunMainWithExitCode(Main.java:1168)\n    at com.facebook.buck.cli.Main.runMainThenExit(Main.java:1225)\n    at com.facebook.buck.cli.Main.nailMain(Main.java:1254)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:497)\n    at com.martiansoftware.nailgun.NGSession.run(NGSession.java:331)\n\nI've tried this with verbose logging (-v = 10). Here are a few snippets that seem relevant:\n\n[2015-10-01 23:00:42.699][debug][command:65b949e6-99f9-4c2b-a6ea-08824173e257][tid:379][com.facebook.buck.json.ProjectBuildFileParser] Starting buck.py command: [/usr/bin/python, -u, /Users/shawn/Dropbox/Development/myproj/.buckd/tmp/buck_run.TuMiWn/buck5883202559706827887.py, --allow_empty_globs, --watchman_watch_root, /Users/shawn/Dropbox/Development/myproj, --project_root, /Users/shawn/Dropbox/Development/myproj, --build_file_name, BUCK, --include, //build/myproj.defs] environment: Optional.of({BUCK_ORIG_TMPDIR=/var/folders/sl/68wd6hc911d03m1lq98t1pkw0000gn/T/, NAILGUN_FILESEPARATOR=/, VERSIONER_PYTHON_VERSION=2.7, NAILGUN_TTY_2=0, NAILGUN_TTY_1=0, PATH=/Library/Java/JavaVirtualMachines/jdk1.8.0_45.jdk/Contents/Home/bin:/Users/shawn/google-cloud-sdk/bin:/Library/Java/JavaVirtualMachines/jdk1.8.0_45.jdk/Contents/Home/bin:/Users/shawn/Dropbox/configuration/bin/mac:/Users/shawn/Dropbox/configuration/bin/no-arch:/usr/local/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/go/bin:/usr/local/opt/go/libexec/bin:/Users/shawn/Dropbox/Development/myproj/bin:/Users/shawn/Dropbox/Development/plan9port/bin:/Users/shawn/Dropbox/Development/myproj/vendor/buck/bin, GOPATH=/Users/shawn/Dropbox/Development/myproj, NAILGUN_TTY_0=0, LC_CTYPE=en_US.UTF-8, LOGNAME=shawn, TERM_PROGRAM=iTerm.app, myproj_ROOT=/Users/shawn/Development/myproj, SHELL=/bin/bash, GOPATH_HACK=/Users/shawn/Dropbox/Development/myproj, GIT_PAGER=, CONFIGURATION_DIR=/Users/shawn/Dropbox/configuration, __CF_USER_TEXT_ENCODING=0x1F5:0x0:0x0, LANG=en_US.UTF-8, COLORFGBG=12;8, LSCOLORS=gxfxxxxxcxxxxxCdCdExEd, HOME=/Users/shawn, DROPBOX_ROOT=/Users/shawn/Dropbox, TMPDIR=/var/folders/sl/68wd6hc911d03m1lq98t1pkw0000gn/T/, EDITOR=subl -w, PLAN9=/Users/shawn/Dropbox/Development/plan9port, CLICOLOR=YES, NAILGUN_PATHSEPARATOR=:, USER=shawn, JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_45.jdk/Contents/Home, TERM=xterm-256color, _=/usr/local/bin/babushka, VERSIONER_PYTHON_PREFER_32_BIT=no})\n", "title": "Experimental IJ project generator encounters a null check in the JavaFileParser", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/444", "user": "strangemonad"}, {"changesInPackagesSPOON": [], "created": "2015-10-01 17:07:54", "spoonStatsSummary": {"INS": 0, "spoonMethodsChanged": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "TOT": 0, "UPD": 0}, "commits": {"9ce4596f82112e89549a72bbab36cb6b35df1185": {"commitGHEventType": "referenced", "commitUser": "sdwilsh"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "MiniAaptTest.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.android.aapt.MiniAaptTest.testDotSeparatedResourceNames()"}]}], "nameRev": "9ce4596f82112e89549a72bbab36cb6b35df1185 tags/v2015.10.26.01~46", "commitUser": "sdwilsh", "commitHash": "9ce4596f82112e89549a72bbab36cb6b35df1185", "commitDateTime": "2015-10-21 17:04:50", "commitMessage": "Add tests for Android xml resources with dot separated string names\n\nSummary: This is a test for https://github.com/facebook/buck/issues/443 (that happens to pass, so the diagnosed issue is likely different).\n\nTest Plan: CI\n", "commitGitStats": [{"filePath": "test/com/facebook/buck/android/aapt/MiniAaptTest.java", "deletions": 0, "lines": 29, "insertions": 29}], "commitParents": ["f692934f509db6b5d0ae493874947f26712f51a3"], "authoredDateTime": "2015-10-20 12:55:41", "spoonStatsSkippedReason": "", "commitGHEventType": "referenced"}], "body": "Hi,\n    I'm trying to migrate my core library projects to BUCK build. However, there're some bugs in the R.java code generation process. \n\n```\nI've imported jira android client to our project. It includes some keys which contains dot, such like the following file.\ngsp-android-core/res/values/jconnect_droid_strings.xml:    <string name=\"jconnect.droid.attach\">Attach</string>\n\nHowever when I use buck to build this project it generates  plenty of such errors.\n   android_project/buck-out/bin/gsp-android-core/__gsp-android-core#dummy_r_dot_java_rdotjava_src__/com/happyelements/gsp/android/R.java:48: error: \u9700\u8981<\u6807\u8bc6\u7b26>\n           public static int jconnect.droid.attach=0x07f0101f;\n\n\nBut in the other build system such like gradle in android studio and ant in eclipse, the R.java file would be like the following:\n    public static int jconnect_droid_attach=0x7f08003d;\n\nIs it because of some design purpose to strength the format of the resource files?\nI've made a demo project, however it can't be submit to request. It's built successfully under GRADLE, but unable to build by BUCK.\nThanks \n```\n\nRegards,\nCong Ling\n", "title": "about res xml R.java code generation issue", "closed": "2016-06-14 05:53:25", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "gitStatsSummary": {"gitFilesChange": 0, "lines": 0, "deletions": 0, "insertions": 0}, "ttf": 256.0002777777778, "filteredCommits": ["9ce4596f82112e89549a72bbab36cb6b35df1185"], "labels": ["bug"], "numCommits": 0, "url": "https://github.com/facebook/buck/issues/443", "user": "congling"}, {"changesInPackagesSPOON": ["com.facebook.buck.artifact_cache.HttpArtifactCache.fetchImpl(com.facebook.buck.rules.RuleKey,java.nio.file.Path,com.facebook.buck.event.HttpArtifactCacheEvent.Finished$Builder)"], "created": "2015-09-25 16:44:42", "spoonStatsSummary": {"INS": 1, "spoonMethodsChanged": 1, "MOV": 3, "DEL": 1, "spoonFilesChanged": 1, "TOT": 6, "UPD": 1}, "commits": {"d04476abea5458e9e41f25cd61dc685e8dd93198": {"commitGHEventType": "closed", "commitUser": "marcinkosiba"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "HttpArtifactCacheTest.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 2, "TOT": 2, "spoonMethodName": "com.facebook.buck.artifact_cache.HttpArtifactCacheTest.testFetchUrl()"}]}, {"spoonFilePath": "HttpArtifactCache.java", "spoonMethods": [{"INS": 1, "MOV": 3, "DEL": 1, "UPD": 1, "TOT": 6, "spoonMethodName": "com.facebook.buck.artifact_cache.HttpArtifactCache.fetchImpl(com.facebook.buck.rules.RuleKey,java.nio.file.Path,com.facebook.buck.event.HttpArtifactCacheEvent.Finished$Builder)"}]}], "nameRev": "d04476abea5458e9e41f25cd61dc685e8dd93198 tags/v2015.10.05.01~17", "commitUser": "marcinkosiba", "commitHash": "d04476abea5458e9e41f25cd61dc685e8dd93198", "commitDateTime": "2015-10-02 10:10:45", "commitMessage": "Fix Http cache URL resolution.\n\nSummary:\nThe refactoring to not pass a URL around broke anyone using paths\non their cache server. This brings back the old behavior.\n\nFixes #434.\n\nTest Plan: CI\n", "commitGitStats": [{"filePath": "src/com/facebook/buck/artifact_cache/HttpArtifactCache.java", "deletions": 1, "lines": 3, "insertions": 2}, {"filePath": "test/com/facebook/buck/artifact_cache/HttpArtifactCacheTest.java", "deletions": 2, "lines": 4, "insertions": 2}], "commitParents": ["8e15003435fc2dd57db167fc18d26721b86ca995"], "authoredDateTime": "2015-10-01 06:38:23", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "This commit 8f5949bba7a05fc3a304bbed87a29efd4bc9821a appears to introduce a leading / into the url.resolve() calls at line 98 and 203. If your http_url has a path (as ours does) then this breaks the cache fetches and puts. Ping @marcinkosiba.\n", "title": "path in cache's http_url being ignored", "closed": "2015-10-02 17:13:15", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/com/facebook/buck/artifact_cache"], "gitStatsSummary": {"gitFilesChange": 1, "lines": 3, "deletions": 1, "insertions": 2}, "ttf": 7.000277777777778, "filteredCommits": ["d04476abea5458e9e41f25cd61dc685e8dd93198"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/434", "user": "mread"}, {"created": "2015-09-21 19:55:14", "closed": "2016-01-26 22:50:42", "commits": {}, "ttf": 127.00027777777778, "body": "Historically, the Android SDK had two different naming schemes for the build tools directory. Thus, my build-tools directory looks like this:\n\n``` sh\n> ls ~/.android-sdk/build-tools/\n\u2026ld-tools/20.0.0/  \u2026ld-tools/22.0.1/              \u2026ld-tools/build-tools-18.1.1/  \u2026ld-tools/build-tools-19.0.3/  \u2026ld-tools/build-tools-21.0.1/  \n\u2026ld-tools/21.1.1/  \u2026ld-tools/build-tools-17.0.0/  \u2026ld-tools/build-tools-19.0.0/  \u2026ld-tools/build-tools-19.1.0/  \u2026ld-tools/build-tools-21.0.2/  \n\u2026ld-tools/21.1.2/  \u2026ld-tools/build-tools-18.0.1/  \u2026ld-tools/build-tools-19.0.1/  \u2026ld-tools/build-tools-20.0.0/  \u2026ld-tools/build-tools-21.1.0/  \n\u2026ld-tools/22.0.0/  \u2026ld-tools/build-tools-18.1.0/  \u2026ld-tools/build-tools-19.0.2/  \u2026ld-tools/build-tools-21.0.0/  \u2026ld-tools/build-tools-22.0.1/  \n```\n\nIt appears that Buck only parses the `/xx.x.x/` style of name:\n\n```\nBUILD FAILED: Invalid version string: build-tools-17.0.0\njava.lang.RuntimeException: Invalid version string: build-tools-17.0.0\njava.lang.RuntimeException: Invalid version string: build-tools-17.0.0\n    at com.facebook.buck.util.VersionStringComparator.compare(VersionStringComparator.java:47)\n    at com.facebook.buck.android.AndroidPlatformTarget$3.compare(AndroidPlatformTarget.java:369)\n    at com.facebook.buck.android.AndroidPlatformTarget$3.compare(AndroidPlatformTarget.java:1)\n    at java.util.TimSort.countRunAndMakeAscending(TimSort.java:329)\n    at java.util.TimSort.sort(TimSort.java:189)\n    at java.util.TimSort.sort(TimSort.java:173)\n    at java.util.Arrays.sort(Arrays.java:659)\n    at java.util.Collections.sort(Collections.java:217)\n    at com.facebook.buck.android.AndroidPlatformTarget.pickNewestBuildToolsDir(AndroidPlatformTarget.java:364)\n    at com.facebook.buck.android.AndroidPlatformTarget.createFromDefaultDirectoryStructure(AndroidPlatformTarget.java:298)\n    at com.facebook.buck.android.AndroidPlatformTarget$AndroidWithGoogleApisFactory.newInstance(AndroidPlatformTarget.java:443)\n    at com.facebook.buck.android.AndroidPlatformTarget.getTargetForId(AndroidPlatformTarget.java:200)\n    at com.facebook.buck.cli.Main$1.get(Main.java:872)\n    at com.facebook.buck.cli.Main$1.get(Main.java:1)\n    at com.facebook.buck.step.ExecutionContext.getAndroidPlatformTarget(ExecutionContext.java:167)\n    at com.facebook.buck.android.DxStep.getShellCommandInternal(DxStep.java:129)\n    at com.facebook.buck.shell.ShellStep.getShellCommand(ShellStep.java:210)\n    at com.facebook.buck.shell.ShellStep.getDescription(ShellStep.java:241)\n    at com.facebook.buck.step.DefaultStepRunner.runStepForBuildTarget(DefaultStepRunner.java:56)\n    at com.facebook.buck.rules.CachingBuildEngine.executeCommandsNowThatDepsAreBuilt(CachingBuildEngine.java:958)\n    at com.facebook.buck.rules.CachingBuildEngine.access$6(CachingBuildEngine.java:941)\n    at com.facebook.buck.rules.CachingBuildEngine$1.apply(CachingBuildEngine.java:367)\n    at com.facebook.buck.rules.CachingBuildEngine$1.apply(CachingBuildEngine.java:1)\n    at com.google.common.util.concurrent.Futures$ChainingListenableFuture.run(Futures.java:906)\n    at com.google.common.util.concurrent.Futures$1$1.run(Futures.java:635)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:724)\n```\n\nRemoving the old build-tools versions allows the build to pass, but it probably makes sense to parse both directory formats.\n", "title": "\"Invalid version string: build-tools-17.0.0\"", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/425", "user": "ndahlquist"}, {"changesInPackagesSPOON": ["com.facebook.buck.cli.QuickstartCommand.runWithoutHelp(com.facebook.buck.cli.CommandRunnerParams)", "com.facebook.buck.util.PackagedResource", "com.facebook.buck.cli.QuickstartCommand"], "created": "2015-09-15 08:35:23", "spoonStatsSummary": {"INS": 4, "spoonMethodsChanged": 3, "MOV": 3, "DEL": 4, "spoonFilesChanged": 2, "TOT": 17, "UPD": 6}, "commits": {"5cd2715455542e57357212f42c019c95e5bbcfed": {"commitGHEventType": "closed", "commitUser": "shs96c"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "QuickstartCommand.java", "spoonMethods": [{"INS": 3, "MOV": 1, "DEL": 2, "UPD": 2, "TOT": 8, "spoonMethodName": "com.facebook.buck.cli.QuickstartCommand.runWithoutHelp(com.facebook.buck.cli.CommandRunnerParams)"}, {"INS": 0, "MOV": 2, "DEL": 2, "UPD": 4, "TOT": 8, "spoonMethodName": "com.facebook.buck.cli.QuickstartCommand"}]}, {"spoonFilePath": "QuickstartIntegrationTest.java", "spoonMethods": []}, {"spoonFilePath": "PackagedResource.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.util.PackagedResource"}]}], "nameRev": "5cd2715455542e57357212f42c019c95e5bbcfed tags/v2015.09.21.01~47", "commitUser": "shs96c", "commitHash": "5cd2715455542e57357212f42c019c95e5bbcfed", "commitDateTime": "2015-09-16 10:12:48", "commitMessage": "Enable zipped bundles to be represented as PackedResource\n\nSummary:\nAdds a structured way of packaging resources and then accessing them\nat run time from within Buck, after spooling that resource to a temp\ndirectory.\n\nThe file and directory are both marked for cleanup on JVM exit.\n\nApplies this to the `quickstart` command.\n\nCloses https://github.com/facebook/buck/issues/421\n\nTest Plan:\nbuck test --all\nbuck quickstart --android-sdk /opt/android_sdk --dest-dir /Users/simons/src/temp --type ANDROID\n\nbuck build buck\nbuck.pex quickstart --android-sdk /opt/android_sdk --dest-dir /Users/simons/src/temp --type ANDROID\n", "commitGitStats": [{"filePath": "programs/buck_tool.py", "deletions": 2, "lines": 2, "insertions": 0}, {"filePath": "src/com/facebook/buck/cli/quickstart/android/apps/myapp/{BUCK => BUCK.tmpl}", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "build.xml", "deletions": 1, "lines": 16, "insertions": 15}, {"filePath": ".buckconfig", "deletions": 23, "lines": 23, "insertions": 0}, {"filePath": "src/com/facebook/buck/cli/quickstart/android/res/com/example/activity/{BUCK => BUCK.tmpl}", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "programs/BUCK", "deletions": 2, "lines": 2, "insertions": 0}, {"filePath": "programs/buck_repo.py", "deletions": 2, "lines": 2, "insertions": 0}, {"filePath": "src/com/facebook/buck/util/PackagedResource.java", "deletions": 0, "lines": 121, "insertions": 121}, {"filePath": "src/com/facebook/buck/util/BUCK", "deletions": 0, "lines": 1, "insertions": 1}, {"filePath": "src/com/facebook/buck/cli/quickstart/android/BUCK", "deletions": 0, "lines": 8, "insertions": 8}, {"filePath": "src/com/facebook/buck/cli/quickstart/ios/BUCK", "deletions": 0, "lines": 8, "insertions": 8}, {"filePath": "src/com/facebook/buck/cli/QuickstartCommand.java", "deletions": 14, "lines": 42, "insertions": 28}, {"filePath": "test/com/facebook/buck/cli/QuickstartIntegrationTest.java", "deletions": 0, "lines": 5, "insertions": 5}, {"filePath": "src/com/facebook/buck/cli/quickstart/ios/ios/{BUCK => BUCK.tmpl}", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "src/com/facebook/buck/cli/quickstart/android/java/com/example/activity/{BUCK => BUCK.tmpl}", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "src/com/facebook/buck/cli/BUCK", "deletions": 1, "lines": 5, "insertions": 4}], "commitParents": ["e9747ed5512f15ba271fb340720b762c812c5c7e"], "authoredDateTime": "2015-09-15 14:02:56", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "`buck` was installed through homebrew.\n\ntrying to create a test iOS project I get:\n\n```\nmkdir qs && cd qs && touch .buckconfig\nbuck quickstart --type ios --dest-dir .\n```\n\n```\n[2015-09-15 11:26:22.439][error][command:17850afd-f86f-427b-91fe-db1f94b0639a][tid:01][com.facebook.buck.cli.Main] Uncaught exception at top level\njava.nio.file.NoSuchFileException: /Users/vhbit/projects/qs/src/com/facebook/buck/cli/quickstart/ios\n    at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)\n    at sun.nio.fs.UnixFileAttributeViews$Basic.readAttributes(UnixFileAttributeViews.java:55)\n    at sun.nio.fs.UnixFileSystemProvider.readAttributes(UnixFileSystemProvider.java:144)\n    at java.nio.file.Files.readAttributes(Files.java:1734)\n    at java.nio.file.FileTreeWalker.getAttributes(FileTreeWalker.java:219)\n    at java.nio.file.FileTreeWalker.visit(FileTreeWalker.java:276)\n    at java.nio.file.FileTreeWalker.walk(FileTreeWalker.java:322)\n    at java.nio.file.Files.walkFileTree(Files.java:2659)\n    at java.nio.file.Files.walkFileTree(Files.java:2739)\n    at com.facebook.buck.io.MoreFiles.copyRecursively(MoreFiles.java:150)\n    at com.facebook.buck.io.MoreFiles.copyRecursively(MoreFiles.java:101)\n    at com.facebook.buck.cli.QuickstartCommand.runWithoutHelp(QuickstartCommand.java:207)\n    at com.facebook.buck.cli.AbstractCommand.run(AbstractCommand.java:153)\n    at com.facebook.buck.cli.BuckCommand.run(BuckCommand.java:84)\n    at com.facebook.buck.cli.Main.runMainWithExitCode(Main.java:766)\n    at com.facebook.buck.cli.Main.tryRunMainWithExitCode(Main.java:1136)\n    at com.facebook.buck.cli.Main.runMainThenExit(Main.java:1193)\n    at com.facebook.buck.cli.Main.main(Main.java:1211)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:483)\n    at com.facebook.buck.cli.bootstrapper.ClassLoaderBootstrapper.main(ClassLoaderBootstrapper.java:62)\n```\n\nLooks like `buck` tries to get templates from the current directory\n", "title": "Can't quickstart an iOS project from a template", "closed": "2015-09-16 19:16:38", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["programs/buck_tool.py", "src/com/facebook/buck/cli/quickstart/android/apps/myapp/{BUCK => BUCK.tmpl}", ".buckconfig", "src/com/facebook/buck/util/BUCK", "programs/BUCK", "programs/buck_repo.py", "src/com/facebook/buck/cli/BUCK", "src/com/facebook/buck/cli/quickstart/ios/BUCK", "src/com/facebook/buck/util", "src/com/facebook/buck/cli/quickstart/android/java/com/example", "src/com/facebook/buck/cli/quickstart/ios/ios/{BUCK => BUCK.tmpl}", "src/com/facebook/buck/cli", "src/com/facebook/buck/cli/quickstart/android/BUCK"], "gitStatsSummary": {"gitFilesChange": 13, "lines": 214, "deletions": 44, "insertions": 170}, "ttf": 1.0002777777777778, "filteredCommits": ["5cd2715455542e57357212f42c019c95e5bbcfed"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/421", "user": "vhbit"}, {"created": "2015-09-12 21:57:10", "closed": "2016-03-09 12:12:59", "commits": {}, "ttf": 178.00027777777777, "body": "For example, try creating an `android_prebuilt_aar` for $ANDROID_HOME/extras/google/m2repository/com/google/android/gms/play-services/7.5.0/play-services-7.5.0.aar\n", "title": "android_prebuilt_aar fails if an aar is missing a classes.jar", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/417", "user": "rowillia"}, {"created": "2015-09-07 21:43:40", "closed": "2015-10-06 15:17:38", "commits": {}, "ttf": 28.00027777777778, "body": "Using the example code from https://buckbuild.com/rule/remote_file.html\n\n```\nremote_file(\n  name = 'jetty-source',\n  out = 'jetty-all-9.2.10.v20150310-sources.jar',\n  url = 'mvn:org.eclipse.jetty.aggregate:jetty-all:src:9.2.10.v20150310',\n  sha1 = '311da310416d2feb3de227081d7c3f48742d7075',\n)\n```\n\nIt appears the `optionalServer` isn't optional.\n", "title": "remote_file doesn't work", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/408", "user": "rowillia"}, {"created": "2015-08-26 21:44:10", "closed": "2016-09-09 14:19:40", "commits": {}, "ttf": 379.0002777777778, "body": "Repro (on our fork https://github.com/liuyang-li/buck/commit/751fc167e05e43d0e50b516501daac5c2ffabcae , but I don't think it's significantly different?):\n1. `buck test`\n2. `buck test --dry-run`\n\nExpected: shows information from a dry run.\nActual: Fails with the message\n\n```\n====STANDARD OUT====\n\n====STANDARD ERR====\n\nFAIL    <100ms  0 Passed   0 Skipped   1 Failed   //module:test\nFAILURE //module:test main: null\njava.lang.NullPointerException\n    at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:210)\n    at com.facebook.buck.java.JavaTest$1.call(JavaTest.java:396)\n    at com.facebook.buck.java.JavaTest$1.call(JavaTest.java:1)\n    at com.facebook.buck.cli.TestRunning$6.call(TestRunning.java:555)\n    at com.facebook.buck.cli.TestRunning$6.call(TestRunning.java:1)\n    at com.facebook.buck.step.DefaultStepRunner$1.call(DefaultStepRunner.java:96)\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n```\n\nWe are using TestNG instead of JUnit, so I don't know if this is happening with JUnit. If someone could confirm whether or not this works in JUnit (or on current Buck master), that'd be great :)\n", "title": "buck test --dry-run throws NullPointerException when tests are cached", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/399", "user": "jiangty-addepar"}, {"created": "2015-08-24 14:24:37", "closed": "2016-01-14 12:19:32", "commits": {}, "ttf": 142.00027777777777, "body": "Hi,\n\nAttempting to build on Mac OS X 10.10.4, here is all my versioning (most irrelevant, but you never know): \n\n```\n$ java -version\njava version \"1.8.0_25\"\nJava(TM) SE Runtime Environment (build 1.8.0_25-b17)\nJava HotSpot(TM) 64-Bit Server VM (build 25.25-b02, mixed mode)\n$ javac -version\njavac 1.8.0_25\n$ ant -version\nApache Ant(TM) version 1.9.6 compiled on June 29 2015\n$ python --version\nPython 2.7.10\n$ git --version\ngit version 2.3.5\n$ uname -a\nDarwin Mark-Hughes.local 14.4.0 Darwin Kernel Version 14.4.0: Thu May 28 11:35:04 PDT 2015; root:xnu-2782.30.5~1/RELEASE_X86_64 x86_64\n```\n\nHere is what happens:\n\n```\n$ ant clean\nBuildfile: /Users/markhughes/src/buck/build.xml\n\nclean:\n   [delete] Deleting directory /Users/markhughes/src/buck/build\n\nBUILD SUCCESSFUL\nTotal time: 0 seconds\n\n~/src/buck on \u2b60 master \u231a 0:07:33\n$ ant\nBuildfile: /Users/markhughes/src/buck/build.xml\n\ncheckversion:\n\ncompile-testrunner:\n    [mkdir] Created dir: /Users/markhughes/src/buck/build/testrunner/classes\n    [javac] Compiling 13 source files to /Users/markhughes/src/buck/build/testrunner/classes\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/java/runner/FileClassPathRunner.java:101: illegal start of type\n    [javac]     List<Path> paths = new LinkedList<>();\n    [javac]                                       ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/java/runner/FileClassPathRunner.java:101: > expected\n    [javac]     List<Path> paths = new LinkedList<>();\n    [javac]                                          ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/java/runner/FileClassPathRunner.java:132: illegal start of type\n    [javac]     List<URL> readUrls = new LinkedList<>();\n    [javac]                                         ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/java/runner/FileClassPathRunner.java:132: > expected\n    [javac]     List<URL> readUrls = new LinkedList<>();\n    [javac]                                            ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/java/runner/FileClassPathRunner.java:134: illegal start of type\n    [javac]     List<String> classPathEntries = new LinkedList<>();\n    [javac]                                                    ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/java/runner/FileClassPathRunner.java:134: > expected\n    [javac]     List<String> classPathEntries = new LinkedList<>();\n    [javac]                                                       ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/BaseRunner.java:59: illegal start of type\n    [javac]   protected Set<TestDescription> seenDescriptions = new HashSet<>();\n    [javac]                                                                 ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/BaseRunner.java:59: > expected\n    [javac]   protected Set<TestDescription> seenDescriptions = new HashSet<>();\n    [javac]                                                                    ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/JUnitRunner.java:124: illegal start of type\n    [javac]         results = new ArrayList<>();\n    [javac]                                 ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/JUnitRunner.java:124: > expected\n    [javac]         results = new ArrayList<>();\n    [javac]                                    ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/JUnitRunner.java:158: illegal start of type\n    [javac]       List<TestResult> fakeResults = new ArrayList<>();\n    [javac]                                                    ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/JUnitRunner.java:158: > expected\n    [javac]       List<TestResult> fakeResults = new ArrayList<>();\n    [javac]                                                       ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/JUnitRunner.java:179: illegal start of type\n    [javac]         return new ArrayList<>();\n    [javac]                              ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/JUnitRunner.java:179: > expected\n    [javac]         return new ArrayList<>();\n    [javac]                                 ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/JulLogFormatter.java:74: '{' expected\n    [javac]       try (PrintWriter pw = new PrintWriter(sw)) {\n    [javac]           ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/JulLogFormatter.java:74: 'try' without 'catch' or 'finally'\n    [javac]       try (PrintWriter pw = new PrintWriter(sw)) {\n    [javac]       ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/JulLogFormatter.java:83: illegal start of expression\n    [javac]   private static String formatRecordLevel(Level level) {\n    [javac]   ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/JulLogFormatter.java:100: ';' expected\n    [javac] }\n    [javac] ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/JulLogFormatter.java:101: '}' expected\n    [javac] ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/TestNGRunner.java:56: illegal start of type\n    [javac]         results = new ArrayList<>();\n    [javac]                                 ^\n    [javac] /Users/markhughes/src/buck/src/com/facebook/buck/junit/TestNGRunner.java:56: > expected\n    [javac]         results = new ArrayList<>();\n    [javac]                                    ^\n    [javac] 21 errors\n\nBUILD FAILED\n/Users/markhughes/src/buck/build.xml:229: Compile failed; see the compiler error output for details.\n\nTotal time: 0 seconds\n\n```\n\nNot sure whats going on here, have I done something wrong? Let me know if I can supply any more valuable information! \n", "title": "ant fails at compile-testrunner (illegal start of type)", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/398", "user": "markhughes"}, {"created": "2015-06-19 05:51:46", "closed": "2020-03-02 19:49:48", "commits": {}, "ttf": 1718.0002777777777, "body": "I have \n\n```\nheaders = [\n  'bx/include/compat/osx',\n  'bx/include',\n  'bgfx/3rdparty/khronos',\n  'bgfx/3rdparty',\n  'bgfx/examples/common',\n  'bgfx/include',\n],\n```\n\nWhen I go to build, I get\n\n```\n[2015-06-18 22:49:53.742][error][command:db8f1dae-12dc-44bd-a0a0-097fa02e604e][tid:324][com.facebook.buck.event.listener.LoggingBuildListener] failed creating linking \"/Users/blo/nisqually/buck-out/gen/lib/lib#default,header-symlink-tree/lib/bgfx/3rdparty/khronos\" -> \"/Users/blo/nisqually/lib/bgfx/3rdparty/khronos\"\njava.nio.file.FileAlreadyExistsException: /Users/blo/nisqually/buck-out/gen/lib/lib#default,header-symlink-tree/lib/bgfx/3rdparty\njava.nio.file.FileAlreadyExistsException: /Users/blo/nisqually/buck-out/gen/lib/lib#default,header-symlink-tree/lib/bgfx/3rdparty\n```\n\nIt seems that the symlink \"/Users/blo/nisqually/buck-out/gen/lib/lib#default,header-symlink-tree/lib/bgfx/3rdparty\" gets created first, then tries to create .../bgfx/3rdparty/khronos and it explodes because .../bgfx/3rdparty is a symlink, not a directory.\n\nFor the library in question, this is simply how it expects its headers to be laid out.\n", "title": "Produce an error when referencing folders when we expect files", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/356", "user": "newobj"}, {"created": "2015-06-12 20:35:01", "closed": "2016-08-25 20:55:22", "commits": {}, "ttf": 440.0002777777778, "body": "Gerrit Code Review project uses Buck and can be extended with plugin concept. There are two plugin Buck build modes supported: in Gerrit tree and standalone (Bucklets driven).\n\nI'm seeing weird stale artifact problem in tree plugin build mode: the plugin is only built once. After that, changing the sources doesn't trigger re-build of the artifact anymore. `buck clean` doesn't help either, only `rm -rf buck-out`.\n\nI have a very small reproducer, but will try to describe the problem:\n\n Main project directory structure is\n\n```\ngerrit\n|--bucklets/gerrit_plugin.bucklet\n|--plugins\n```\n\nPlugin:\n\n```\nfoo\n|--BUCK\n|--src/main/[...]\n```\n\nThe content of `bucklets/gerrit_plugin.bucklet` is:\n\n```\ndef gerrit_library(\n    name,\n    srcs = []):\n  java_library(\n    name = name,\n    srcs = srcs,\n    visibility = ['PUBLIC'],\n  )\n```\n\nThe content of `foo/BUCK` is:\n\n```\ninclude_defs('//bucklets/gerrit_plugin.bucklet')\n\ngerrit_library(\n  name = 'foo',\n  srcs = glob(['src/main/java/**/*.java']),\n)\n```\n\nNow, when the plugin `foo` is linked to `plugins` directory with symbolic link, we can only build once and never again:\n\n```\n$ cd gerrit\n$ buck build plugins/foo:foo\nUsing buckd.\n[-] PROCESSING BUCK FILES...FINISHED 0,1s\n[-] BUILDING...FINISHED 0,2s (1/1 JOBS, 1 UPDATED, 0,0% CACHE HITS)\n```\n\nNow when we change the source file: `plugins/foo/src/main/java/org/ostrovsky/buck/Main.java` and say introduce some compile errors, and re-run, nothing happens:\n\n```\n$ buck build plugins/foo:foo\nUsing buckd.\n[-] PROCESSING BUCK FILES...FINISHED 0,1s\n[-] BUILDING...FINISHED 0,0s (1/1 JOBS, 0 UPDATED)\n```\n\n`buck clean` doesn't help either. The only way to re-trigger the build is to drop `buck-out` directory:\n\n```\n$ rm -rf buck-out/\n$ buck build plugins/foo:foo\nUsing buckd.\n[-] PROCESSING BUCK FILES...FINISHED 0,1s\n[+] BUILDING...0,0s (0/1 JOBS, 0 UPDATED)\n |=> //plugins/foo:foo...  0,0s (running javac[0,0s])\n/home/davido/projects/buck_problem/plugins/foo/src/main/java/org/ostrovsky/buck/Main.java:21: error: illegal start of type\n  42\n  ^\n/home/davido/projects/buck_problem/plugins/foo/src/main/java/org/ostrovsky/buck/Main.java:21: error: ';' expected\n  42\n    ^\nErrors: 2. Warnings: 0.\nBUILD FAILED: //plugins/foo:foo failed with exit code 1:\n```\n\nThis problem only occurs, when `foo` is a symbolic link to some directory parallel to `gerrit`:\n\n```\n$ ls -all plugins/\nlrwxrwxrwx 1 davido users    9 Jun 12 22:26 foo -> ../../foo\n```\n\nAll is fine when `foo` is a real directory and not a symbolic link.\n", "title": "Buckd does not detect build file changes when symbolic links are involved", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/341", "user": "davido"}, {"changesInPackagesSPOON": ["com.facebook.buck.util.VersionStringComparator.compare(java.lang.String,java.lang.String)", "com.facebook.buck.android.AndroidPlatformTarget.createFromDefaultDirectoryStructure(java.lang.String,com.facebook.buck.android.AndroidDirectoryResolver,java.lang.String,java.util.Set,com.google.common.base.Optional)", "com.facebook.buck.util.VersionStringComparator"], "created": "2015-05-29 20:38:31", "spoonStatsSummary": {"INS": 13, "spoonMethodsChanged": 3, "MOV": 9, "DEL": 1, "spoonFilesChanged": 2, "TOT": 29, "UPD": 6}, "commits": {"8ebaf2b997a9b198d747b441fdda42ef7ea208be": {"commitGHEventType": "closed", "commitUser": "sdwilsh"}, "c2439153f7677de718a9559c65e18f32b99eb0f3": {"commitGHEventType": "referenced", "commitUser": "sdwilsh"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "AndroidPlatformTarget.java", "spoonMethods": [{"INS": 4, "MOV": 3, "DEL": 0, "UPD": 3, "TOT": 10, "spoonMethodName": "com.facebook.buck.android.AndroidPlatformTarget.createFromDefaultDirectoryStructure(java.lang.String,com.facebook.buck.android.AndroidDirectoryResolver,java.lang.String,java.util.Set,com.google.common.base.Optional)"}]}, {"spoonFilePath": "AndroidPlatformTargetTest.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.android.AndroidPlatformTargetTest.testChoosesCorrectBuildToolsBinDirectory()"}]}], "nameRev": "8ebaf2b997a9b198d747b441fdda42ef7ea208be tags/v2015.09.10.01~757", "commitUser": "sdwilsh", "commitHash": "8ebaf2b997a9b198d747b441fdda42ef7ea208be", "commitDateTime": "2015-06-03 15:22:53", "commitMessage": "Find the Android Build Tools in the Right Place\n\nSummary:\nAs of Build Tools version 23.0.0_rc1, some tools are found under `bin`\nin the appropriate `build-tools` folder.  This change makes Buck\nunderstand this new location.\n\nCloses #326\n\nTest Plan: added test\n", "commitGitStats": [{"filePath": "test/com/facebook/buck/android/AndroidPlatformTargetTest.java", "deletions": 0, "lines": 48, "insertions": 48}, {"filePath": "src/com/facebook/buck/android/AndroidPlatformTarget.java", "deletions": 4, "lines": 21, "insertions": 17}], "commitParents": ["c2439153f7677de718a9559c65e18f32b99eb0f3"], "authoredDateTime": "2015-06-01 12:59:02", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "VersionStringComparator.java", "spoonMethods": [{"INS": 8, "MOV": 6, "DEL": 1, "UPD": 2, "TOT": 17, "spoonMethodName": "com.facebook.buck.util.VersionStringComparator.compare(java.lang.String,java.lang.String)"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 2, "spoonMethodName": "com.facebook.buck.util.VersionStringComparator"}]}, {"spoonFilePath": "VersionStringComparatorTest.java", "spoonMethods": [{"INS": 3, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 3, "spoonMethodName": "com.facebook.buck.util.VersionStringComparatorTest.testIsValidVersionString()"}, {"INS": 4, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 4, "spoonMethodName": "com.facebook.buck.util.VersionStringComparatorTest.testCompare()"}]}], "nameRev": "c2439153f7677de718a9559c65e18f32b99eb0f3 tags/v2015.09.10.01~758", "commitUser": "sdwilsh", "commitHash": "c2439153f7677de718a9559c65e18f32b99eb0f3", "commitDateTime": "2015-06-03 15:22:44", "commitMessage": "Version Parsing Support  for Release Candidates\n\nSummary:\nThe Android SDK makes their version numbers a tiny bit more complicated\nby adding a `_rc#`.  This change adds support to parsing that and doing\nthe correct comparison.\n\nAddresses part of #326\n\nTest Plan: added a unit test\n", "commitGitStats": [{"filePath": "src/com/facebook/buck/util/VersionStringComparator.java", "deletions": 4, "lines": 25, "insertions": 21}, {"filePath": "test/com/facebook/buck/util/VersionStringComparatorTest.java", "deletions": 0, "lines": 10, "insertions": 10}], "commitParents": ["7229d88ad72bfb81c24bff506cff0339bae6a3d0"], "authoredDateTime": "2015-06-01 12:59:02", "spoonStatsSkippedReason": "", "commitGHEventType": "referenced"}], "body": "I've updated all android tools today and now when trying to build the project with Buck I get the following exception:\n\n```\njava.util.concurrent.ExecutionException: java.lang.RuntimeException: Invalid version string: 23.0.0_rc1\n        at com.google.common.util.concurrent.AbstractFuture$Sync.getValue(AbstractFuture.java:299)\n        at com.google.common.util.concurrent.AbstractFuture$Sync.get(AbstractFuture.java:286)\n        at com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:116)\n        at com.facebook.buck.command.Build.executeBuild(Build.java:239)\n        at com.facebook.buck.command.Build.executeAndPrintFailuresToConsole(Build.java:270)\n        at com.facebook.buck.cli.BuildCommand.runWithoutHelp(BuildCommand.java:329)\n        at com.facebook.buck.cli.InstallCommand.runWithoutHelp(InstallCommand.java:127)\n        at com.facebook.buck.cli.AbstractCommand.run(AbstractCommand.java:133)\n        at com.facebook.buck.cli.BuckCommand.run(BuckCommand.java:80)\n        at com.facebook.buck.cli.Main.runMainWithExitCode(Main.java:652)\n        at com.facebook.buck.cli.Main.tryRunMainWithExitCode(Main.java:985)\n        at com.facebook.buck.cli.Main.runMainThenExit(Main.java:1042)\n        at com.facebook.buck.cli.Main.nailMain(Main.java:1071)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:497)\n        at com.martiansoftware.nailgun.NGSession.run(NGSession.java:338)\nCaused by: java.lang.RuntimeException: Invalid version string: 23.0.0_rc1\n        at com.facebook.buck.util.VersionStringComparator.compare(VersionStringComparator.java:36)\n        at com.facebook.buck.android.AndroidPlatformTarget$3.compare(AndroidPlatformTarget.java:334)\n        at com.facebook.buck.android.AndroidPlatformTarget$3.compare(AndroidPlatformTarget.java:1)\n        at java.util.TimSort.binarySort(TimSort.java:292)\n        at java.util.TimSort.sort(TimSort.java:217)\n        at java.util.Arrays.sort(Arrays.java:1512)\n        at java.util.ArrayList.sort(ArrayList.java:1454)\n        at java.util.Collections.sort(Collections.java:175)\n        at com.facebook.buck.android.AndroidPlatformTarget.pickNewestBuildToolsDir(AndroidPlatformTarget.java:329)\n        at com.facebook.buck.android.AndroidPlatformTarget.createFromDefaultDirectoryStructure(AndroidPlatformTarget.java:271)\n        at com.facebook.buck.android.AndroidPlatformTarget$AndroidWithGoogleApisFactory.newInstance(AndroidPlatformTarget.java:408)\n        at com.facebook.buck.android.AndroidPlatformTarget.getTargetForId(AndroidPlatformTarget.java:196)\n        at com.facebook.buck.cli.Main$1.get(Main.java:749)\n        at com.facebook.buck.cli.Main$1.get(Main.java:1)\n        at com.facebook.buck.step.ExecutionContext.getAndroidPlatformTarget(ExecutionContext.java:170)\n        at com.facebook.buck.android.AaptStep.getShellCommandInternal(AaptStep.java:94)\n        at com.facebook.buck.shell.ShellStep.getShellCommand(ShellStep.java:202)\n        at com.facebook.buck.shell.ShellStep.getDescription(ShellStep.java:233)\n        at com.facebook.buck.step.DefaultStepRunner.runStepForBuildTarget(DefaultStepRunner.java:56)\n        at com.facebook.buck.rules.CachingBuildEngine.executeCommandsNowThatDepsAreBuilt(CachingBuildEngine.java:616)\n        at com.facebook.buck.rules.CachingBuildEngine.buildOnceDepsAreBuilt(CachingBuildEngine.java:431)\n        at com.facebook.buck.rules.CachingBuildEngine.access$3(CachingBuildEngine.java:349)\n        at com.facebook.buck.rules.CachingBuildEngine$1.onSuccess(CachingBuildEngine.java:202)\n        at com.facebook.buck.rules.CachingBuildEngine$1.onSuccess(CachingBuildEngine.java:1)\n        at com.facebook.buck.util.concurrent.MoreFutures$1.onSuccess(MoreFutures.java:130)\n        at com.google.common.util.concurrent.Futures$6.run(Futures.java:1319)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\n```\n\nLooks like the regexp used in VersionStringComparator doesn't fit for the new versioning format.\n", "title": "New android tools: parsing version string \"23.0.0_rc1\"", "closed": "2015-06-03 23:03:38", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/com/facebook/buck/util", "src/com/facebook/buck/android"], "gitStatsSummary": {"gitFilesChange": 2, "lines": 46, "deletions": 8, "insertions": 38}, "ttf": 5.000277777777778, "filteredCommits": ["8ebaf2b997a9b198d747b441fdda42ef7ea208be", "c2439153f7677de718a9559c65e18f32b99eb0f3"], "labels": ["bug"], "numCommits": 2, "url": "https://github.com/facebook/buck/issues/326", "user": "zserge"}, {"created": "2015-05-26 15:28:19", "spoonStatsSummary": {}, "commits": {"1cccf26c62b116c52cd57cf7e9617b83f5b659bf": {"commitGHEventType": "closed", "commitUser": "sdwilsh"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "1cccf26c62b116c52cd57cf7e9617b83f5b659bf tags/v2015.09.10.01~821", "commitUser": "sdwilsh", "commitHash": "1cccf26c62b116c52cd57cf7e9617b83f5b659bf", "commitDateTime": "2015-05-27 09:18:59", "commitMessage": "Fix soyweb-local.sh\n\nI screwed up in 98c6630471f1d2d79518e21bfb305acebf966753, and since\nI'm on Windows, I didn't test the shell script.\n\nCloses #315\n", "commitGitStats": [{"filePath": "docs/soyweb-local.sh", "deletions": 1, "lines": 2, "insertions": 1}], "commitParents": ["7f5ae0f3edfad625364fb164c0ad1ce0cb29dfa6"], "authoredDateTime": "2015-05-26 08:43:18", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "Commit 98c6630471f introduced a change that makes running `docs/soyweb-local.sh` fail with\n    `Exception in thread \"main\" java.lang.RuntimeException: Could not find file: /globals.json\nat org.plovr.cli.SoyWebCommand.runCommandWithOptions(SoyWebCommand.java:34)\nat org.plovr.cli.SoyWebCommand.runCommandWithOptions(SoyWebCommand.java:18)\nat org.plovr.cli.AbstractCommandRunner.runCommand(AbstractCommandRunner.java:41)\nat org.plovr.cli.Command.execute(Command.java:47)\nat org.plovr.cli.Main.mainWithExitCode(Main.java:56)\nat org.plovr.cli.Main.main(Main.java:30)`\nThis seems to still be a problem at commit 5eef2cf1609d75529.\n", "title": "docs/soyweb-local.sh can't find globals.json", "closed": "2015-05-27 16:30:31", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["docs/soyweb-local.sh"], "gitStatsSummary": {"gitFilesChange": 1, "lines": 2, "deletions": 1, "insertions": 1}, "ttf": 1.0002777777777778, "filteredCommits": ["1cccf26c62b116c52cd57cf7e9617b83f5b659bf"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/315", "user": "bmihai"}, {"changesInPackagesSPOON": ["com.facebook.buck.cxx.CxxPreprocessAndCompile.makeMainStep()", "com.facebook.buck.testutil.integration.BuckBuildLog.BuildLogEntry.getRuleKey()", "com.facebook.buck.testutil.integration.BuckBuildLog.getLogEntry(com.facebook.buck.model.BuildTarget)", "com.facebook.buck.cxx.CxxPreprocessAndCompileStep.execute(com.facebook.buck.step.ExecutionContext)", "com.facebook.buck.cxx.CxxPreprocessAndCompile.getDepFilePath()", "com.facebook.buck.cxx.AbstractCxxSource.Type.isPreprocessable()", "com.facebook.buck.cxx.CxxPreprocessAndCompileStep.getDepTemp()", "com.facebook.buck.cxx.CxxPreprocessAndCompileStep.getDepFileArgs(java.nio.file.Path)", "com.facebook.buck.cxx.CxxPreprocessAndCompileStep.makeCompileCommand(java.lang.String,java.lang.String)", "com.facebook.buck.cxx.CxxPreprocessAndCompileStep.makePreprocessCommand()", "com.facebook.buck.cxx.CxxPreprocessAndCompile.getInputsAfterBuildingLocally()", "com.facebook.buck.testutil.integration.BuckBuildLog.BuildLogEntry", "com.facebook.buck.testutil.integration.BuckBuildLog.BuildLogEntry.getStatus()", "com.facebook.buck.testutil.integration.BuckBuildLog.BuildLogEntry.getCacheResult()", "com.facebook.buck.cxx.CxxPreprocessAndCompile.useDependencyFileRuleKeys()", "com.facebook.buck.testutil.integration.BuckBuildLog.BuildLogEntry.getSuccessType()", "com.facebook.buck.cxx.CxxPreprocessAndCompileStep"], "created": "2015-05-01 15:37:10", "spoonStatsSummary": {"INS": 19.0, "spoonMethodsChanged": 17, "MOV": 3.0, "DEL": 1.0, "spoonFilesChanged": 4, "TOT": 23.0, "UPD": 0.0}, "commits": {"219c93531213a748ad41d5acef7c86ae87c049cb": {"commitGHEventType": "referenced", "commitUser": "andrewjcg"}, "6d25c1ca192de86bb1e17c66bc98dacccc1a1628": {"commitGHEventType": "referenced", "commitUser": "andrewjcg"}, "8b090df2b88c284b187347b22cbf499ce0dd9f6c": {"commitGHEventType": "referenced", "commitUser": "andrewjcg"}, "8430361d1517dafe285d6895ed494be82f75c3ea": {"commitGHEventType": "referenced", "commitUser": "andrewjcg"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BuckBuildLog.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.testutil.integration.BuckBuildLog.BuildLogEntry.getRuleKey()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.testutil.integration.BuckBuildLog.getLogEntry(com.facebook.buck.model.BuildTarget)"}, {"INS": 1, "MOV": 1, "DEL": 1, "UPD": 0, "TOT": 3, "spoonMethodName": "com.facebook.buck.testutil.integration.BuckBuildLog.BuildLogEntry"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.testutil.integration.BuckBuildLog.BuildLogEntry.getCacheResult()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.testutil.integration.BuckBuildLog.BuildLogEntry.getSuccessType()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.testutil.integration.BuckBuildLog.BuildLogEntry.getStatus()"}]}, {"spoonFilePath": "CxxPreprocessAndCompileIntegrationTest.java", "spoonMethods": [{"INS": 0, "MOV": 1, "DEL": 1, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileIntegrationTest.setUp()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileIntegrationTest.inputBasedRuleKeyAvoidsRecompilingAfterChangeToUnusedHeader()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileIntegrationTest.inputBasedRuleKeyAvoidsRerunningIfGeneratedHeaderDoesNotChange()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileIntegrationTest.inputBasedRuleKeyAvoidsRerunningIfGeneratedSourceDoesNotChange()"}]}, {"spoonFilePath": "CxxPreprocessAndCompile.java", "spoonMethods": []}, {"spoonFilePath": "CxxBinaryIntegrationTest.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 2, "TOT": 2, "spoonMethodName": "com.facebook.buck.cxx.CxxBinaryIntegrationTest.testSimpleCxxBinaryWithHeader()"}]}, {"spoonFilePath": "CxxLexYaccIntegrationTest.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 2, "TOT": 2, "spoonMethodName": "com.facebook.buck.cxx.CxxLexYaccIntegrationTest.testSimpleCxxBinaryLexYaccBuilds()"}]}], "nameRev": "219c93531213a748ad41d5acef7c86ae87c049cb tags/v2015.09.10.01~543", "commitUser": "andrewjcg", "commitHash": "219c93531213a748ad41d5acef7c86ae87c049cb", "commitDateTime": "2015-06-30 10:13:03", "commitMessage": "Use input-based rule keys for C/C++ compilation\n\nSummary:\nThis enables C/C++ compile rules to use input-based rule keys,\nwhich avoids recompilation when unused headers are changed.\n\nAddresses part of #298\n\nTest Plan: added an integration test\n", "commitGitStats": [{"filePath": "test/com/facebook/buck/cxx/testdata/lexyacc/foo/main.cpp", "deletions": 0, "lines": 2, "insertions": 2}, {"filePath": "test/com/facebook/buck/cxx/testdata/simple/foo/simple_with_header.h", "deletions": 1, "lines": 2, "insertions": 1}, {"filePath": "test/com/facebook/buck/cxx/testdata/step_test/BUCK", "deletions": 0, "lines": 45, "insertions": 45}, {"filePath": "test/com/facebook/buck/testutil/integration/BuckBuildLog.java", "deletions": 20, "lines": 61, "insertions": 41}, {"filePath": "test/com/facebook/buck/cxx/testdata/step_test/source.cpp", "deletions": 0, "lines": 3, "insertions": 3}, {"filePath": "test/com/facebook/buck/cxx/testdata/step_test/unused_header.h", "deletions": 0, "lines": 1, "insertions": 1}, {"filePath": "test/com/facebook/buck/cxx/testdata/unused_header/BUCK", "deletions": 0, "lines": 9, "insertions": 9}, {"filePath": "test/com/facebook/buck/cxx/CxxBinaryIntegrationTest.java", "deletions": 1, "lines": 2, "insertions": 1}, {"filePath": "test/com/facebook/buck/cxx/CxxPreprocessAndCompileIntegrationTest.java", "deletions": 12, "lines": 179, "insertions": 167}, {"filePath": "test/com/facebook/buck/cxx/CxxLexYaccIntegrationTest.java", "deletions": 1, "lines": 2, "insertions": 1}, {"filePath": "test/com/facebook/buck/cxx/testdata/simple/foo/bar.cpp", "deletions": 0, "lines": 2, "insertions": 2}, {"filePath": "src/com/facebook/buck/cxx/CxxPreprocessAndCompile.java", "deletions": 1, "lines": 5, "insertions": 4}, {"filePath": "test/com/facebook/buck/cxx/testdata/step_test/unused.dat", "deletions": 0, "lines": 1, "insertions": 1}, {"filePath": "test/com/facebook/buck/cxx/testdata/step_test/foo.cpp", "deletions": 0, "lines": 5, "insertions": 5}], "commitParents": ["74a414c93c2643d4b823edd3036f418673980de4"], "authoredDateTime": "2015-06-29 12:01:33", "spoonStatsSkippedReason": "", "commitGHEventType": "referenced"}, {"commitSpoonAstDiffStats": [], "nameRev": "6d25c1ca192de86bb1e17c66bc98dacccc1a1628 tags/v2015.09.10.01~275", "commitUser": "andrewjcg", "commitHash": "6d25c1ca192de86bb1e17c66bc98dacccc1a1628", "commitDateTime": "2015-08-06 15:45:55", "commitMessage": "CachingBuildEngine: support dependency-file rule keys\n\nSummary:\nThis diff adds dep-file rule key support to the build engine.\nFor rules that support them, the build engine gets from them a\nlist of explicitly used inputs and records them (locally and to\nthe cache), along with a dependency file rule key, for next time.\n\nOn subsequent runs, if the dep-file and associated rule keys\nare availabl from the last run, a new dependency file rule key\ncan be calclulated to check if a rebuild can be avoided.\n\nAddresses part of #298\n\nTest Plan: added unittests\n", "commitGitStats": [{"filePath": "src/com/facebook/buck/rules/RuleKey.java", "deletions": 26, "lines": 51, "insertions": 25}, {"filePath": "src/com/facebook/buck/cli/FetchCommand.java", "deletions": 0, "lines": 5, "insertions": 5}, {"filePath": "src/com/facebook/buck/rules/BuildInfo.java", "deletions": 0, "lines": 11, "insertions": 11}, {"filePath": "src/com/facebook/buck/rules/BuildRuleSuccessType.java", "deletions": 0, "lines": 8, "insertions": 8}, {"filePath": "test/com/facebook/buck/rules/CachingBuildEngineTest.java", "deletions": 11, "lines": 410, "insertions": 399}, {"filePath": "src/com/facebook/buck/cli/BuildCommand.java", "deletions": 0, "lines": 5, "insertions": 5}, {"filePath": "src/com/facebook/buck/rules/keys/SupportsDependencyFileRuleKey.java", "deletions": 0, "lines": 33, "insertions": 33}, {"filePath": "docs/concept/buckconfig.soy", "deletions": 0, "lines": 6, "insertions": 6}, {"filePath": "src/com/facebook/buck/cli/TestCommand.java", "deletions": 0, "lines": 5, "insertions": 5}, {"filePath": "src/com/facebook/buck/cli/BuckConfig.java", "deletions": 0, "lines": 9, "insertions": 9}, {"filePath": "src/com/facebook/buck/rules/CachingBuildEngine.java", "deletions": 1, "lines": 120, "insertions": 119}], "commitParents": ["588ccf53c69a31220ebeb8063f4c12b274369cd4"], "authoredDateTime": "2015-08-06 03:58:07", "spoonStatsSkippedReason": "tooManyChanges", "commitGHEventType": "referenced"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "CxxLink.java", "spoonMethods": []}, {"spoonFilePath": "CxxLinkIntegrationTest.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.CxxLinkIntegrationTest"}]}, {"spoonFilePath": "CxxBinaryIntegrationTest.java", "spoonMethods": [{"INS": 0, "MOV": 2, "DEL": 0, "UPD": 1, "TOT": 3, "spoonMethodName": "com.facebook.buck.cxx.CxxBinaryIntegrationTest.testSimpleCxxBinaryWithDependencyOnCxxLibraryWithHeader()"}, {"INS": 0, "MOV": 2, "DEL": 0, "UPD": 1, "TOT": 3, "spoonMethodName": "com.facebook.buck.cxx.CxxBinaryIntegrationTest.doTestSimpleCxxBinaryBuilds(java.lang.String,boolean)"}, {"INS": 0, "MOV": 2, "DEL": 0, "UPD": 1, "TOT": 3, "spoonMethodName": "com.facebook.buck.cxx.CxxBinaryIntegrationTest.testSimpleCxxBinaryWithHeader()"}]}, {"spoonFilePath": "CxxLexYaccIntegrationTest.java", "spoonMethods": [{"INS": 0, "MOV": 2, "DEL": 0, "UPD": 1, "TOT": 3, "spoonMethodName": "com.facebook.buck.cxx.CxxLexYaccIntegrationTest.testSimpleCxxBinaryLexYaccBuilds()"}]}], "nameRev": "8b090df2b88c284b187347b22cbf499ce0dd9f6c tags/v2015.09.10.01~467", "commitUser": "andrewjcg", "commitHash": "8b090df2b88c284b187347b22cbf499ce0dd9f6c", "commitDateTime": "2015-07-14 08:10:41", "commitMessage": "Use input-based rule keys for C/C++ linking\n\nSummary:\nThis enables C/C++ link rules to use input-based rule keys, which\navoids re-linking when unused headers are changed.\n\nAddresses part of #298\n\nTest Plan: added an integration test\n", "commitGitStats": [{"filePath": "test/com/facebook/buck/cxx/CxxBinaryIntegrationTest.java", "deletions": 3, "lines": 13, "insertions": 10}, {"filePath": "test/com/facebook/buck/cxx/CxxLinkIntegrationTest.java", "deletions": 0, "lines": 75, "insertions": 75}, {"filePath": "src/com/facebook/buck/cxx/CxxLink.java", "deletions": 1, "lines": 5, "insertions": 4}, {"filePath": "test/com/facebook/buck/cxx/CxxLexYaccIntegrationTest.java", "deletions": 1, "lines": 7, "insertions": 6}], "commitParents": ["8184a32a019b2ed956e8f24c18cb49a266af47bf"], "authoredDateTime": "2015-07-13 22:31:43", "spoonStatsSkippedReason": "", "commitGHEventType": "referenced"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "CxxCompileStepIntegrationTest.java", "spoonMethods": [{"INS": 2, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.cxx.CxxCompileStepIntegrationTest.assertCompDir(java.nio.file.Path,com.google.common.base.Optional)"}]}, {"spoonFilePath": "CompilationDatabaseIntegrationTest.java", "spoonMethods": [{"INS": 3, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 3, "spoonMethodName": "com.facebook.buck.apple.CompilationDatabaseIntegrationTest.assertFlags(java.lang.String,java.lang.String,boolean,java.util.Map,com.google.common.collect.ImmutableSet,java.lang.Iterable)"}]}, {"spoonFilePath": "CxxPreprocessAndCompileTest.java", "spoonMethods": [{"INS": 3, "MOV": 2, "DEL": 0, "UPD": 1, "TOT": 6, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileTest.usesCorrectCommandForPreprocess()"}, {"INS": 3, "MOV": 3, "DEL": 0, "UPD": 2, "TOT": 8, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileTest.usesCorrectCommandForCompile()"}]}, {"spoonFilePath": "CxxPreprocessAndCompileStep.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileStep.getDepFileArgs(java.nio.file.Path)"}, {"INS": 3, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 3, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileStep"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileStep.getDepTemp()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileStep.execute(com.facebook.buck.step.ExecutionContext)"}, {"INS": 1, "MOV": 1, "DEL": 0, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileStep.makeCompileCommand(java.lang.String,java.lang.String)"}, {"INS": 1, "MOV": 1, "DEL": 0, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileStep.makePreprocessCommand()"}]}, {"spoonFilePath": "CxxCompilationDatabaseTest.java", "spoonMethods": [{"INS": 3, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 3, "spoonMethodName": "com.facebook.buck.cxx.CxxCompilationDatabaseTest.testCompilationDatabseWithCombinedPreprocessAndCompileStrategy()"}]}, {"spoonFilePath": "AbstractCxxSource.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.AbstractCxxSource.Type.isPreprocessable()"}]}, {"spoonFilePath": "CxxDependencyFileIntegrationTest.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.CxxDependencyFileIntegrationTest"}]}, {"spoonFilePath": "CxxPreprocessAndCompileIntegrationTest.java", "spoonMethods": [{"INS": 1, "MOV": 1, "DEL": 0, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileIntegrationTest.setUp()"}]}, {"spoonFilePath": "CxxPreprocessAndCompileStepTest.java", "spoonMethods": [{"INS": 2, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileStepTest.errorProcessor()"}, {"INS": 2, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompileStepTest.outputProcessor()"}]}, {"spoonFilePath": "CxxPreprocessAndCompile.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompile.useDependencyFileRuleKeys()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompile.makeMainStep()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompile.getInputsAfterBuildingLocally()"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.cxx.CxxPreprocessAndCompile.getDepFilePath()"}]}], "nameRev": "8430361d1517dafe285d6895ed494be82f75c3ea tags/v2015.09.10.01~274", "commitUser": "andrewjcg", "commitHash": "8430361d1517dafe285d6895ed494be82f75c3ea", "commitDateTime": "2015-08-06 15:45:55", "commitMessage": "C/C++: generate and use dependency files to avoid preprocessing\n\nSummary:\nThis hooks up the C/C++ rules to use the dependency files supported\nby the build engine to avoid re-preprocessing when unused headers\nare changed.  Since we tend to overspecify in the UI, this can help\nreduce the amount of preprocessing we do.\n\nAddresses part of #298\n\nTest Plan: added tests\n", "commitGitStats": [{"filePath": "src/com/facebook/buck/cxx/CxxPreprocessAndCompile.java", "deletions": 1, "lines": 43, "insertions": 42}, {"filePath": "test/com/facebook/buck/cxx/testdata/depfiles/used.h", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "src/com/facebook/buck/cxx/CxxPreprocessAndCompileStep.java", "deletions": 0, "lines": 37, "insertions": 37}, {"filePath": "test/com/facebook/buck/cxx/CxxPreprocessAndCompileStepTest.java", "deletions": 0, "lines": 4, "insertions": 4}, {"filePath": "test/com/facebook/buck/cxx/CxxDependencyFileIntegrationTest.java", "deletions": 0, "lines": 132, "insertions": 132}, {"filePath": "test/com/facebook/buck/cxx/CxxCompileStepIntegrationTest.java", "deletions": 0, "lines": 2, "insertions": 2}, {"filePath": "src/com/facebook/buck/cxx/AbstractCxxSource.java", "deletions": 1, "lines": 6, "insertions": 5}, {"filePath": "test/com/facebook/buck/cxx/CxxPreprocessAndCompileTest.java", "deletions": 0, "lines": 8, "insertions": 8}, {"filePath": "test/com/facebook/buck/cxx/CxxPreprocessAndCompileIntegrationTest.java", "deletions": 5, "lines": 12, "insertions": 7}, {"filePath": "test/com/facebook/buck/cxx/CxxCompilationDatabaseTest.java", "deletions": 0, "lines": 3, "insertions": 3}, {"filePath": "test/com/facebook/buck/cxx/testdata/depfiles/unused.h", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/apple/CompilationDatabaseIntegrationTest.java", "deletions": 0, "lines": 3, "insertions": 3}, {"filePath": "test/com/facebook/buck/cxx/testdata/depfiles/BUCK", "deletions": 0, "lines": 10, "insertions": 10}, {"filePath": "test/com/facebook/buck/cxx/testdata/depfiles/test.cpp", "deletions": 0, "lines": 5, "insertions": 5}], "commitParents": ["6d25c1ca192de86bb1e17c66bc98dacccc1a1628"], "authoredDateTime": "2015-08-06 04:47:07", "spoonStatsSkippedReason": "", "commitGHEventType": "referenced"}], "body": "I've got a buckfile that describes a cxx_binary (among other things):\nhttps://github.com/luser/rr/blob/28bee6461b876b8da356fde7f9eac78bc1acfb1f/BUCK#L76\n\nIt builds and works fine, but if I make a change to a header file, say, adding a line to:\nhttps://github.com/luser/rr/blob/28bee6461b876b8da356fde7f9eac78bc1acfb1f/src/RecordCommand.h\n\n...and rebuild, buck rebuilds all the object files for the binary. It should only have to rebuild RecordCommand.o and main.o, since they're the only things that include RecordCommand.h.\n\nHere's buck-out/log/buck-0.log:\nhttps://gist.github.com/98dc56db48e6d5ce3623\n", "title": "buck rebuilding the world when a header changes", "closed": "2015-08-10 08:07:22", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["test/com/facebook/buck/cxx/testdata/simple/foo/simple_with_header.h", "test/com/facebook/buck/cxx/testdata/lexyacc/foo/main.cpp", "src/com/facebook/buck/cli", "test/com/facebook/buck/cxx/testdata/step_test/BUCK", "test/com/facebook/buck/cxx/testdata/step_test/source.cpp", "test/com/facebook/buck/cxx/testdata/step_test/unused_header.h", "test/com/facebook/buck/cxx/testdata/unused_header/BUCK", "src/com/facebook/buck/rules", "test/com/facebook/buck/cxx/testdata/depfiles/test.cpp", "test/com/facebook/buck/cxx/testdata/step_test/foo.cpp", "docs/concept/buckconfig.soy", "test/com/facebook/buck/cxx/testdata/depfiles/used.h", "test/com/facebook/buck/cxx/testdata/depfiles/unused.h", "src/com/facebook/buck/cxx", "test/com/facebook/buck/cxx/testdata/step_test/unused.dat", "src/com/facebook/buck/rules/keys", "test/com/facebook/buck/cxx/testdata/depfiles/BUCK", "test/com/facebook/buck/cxx/testdata/simple/foo/bar.cpp"], "gitStatsSummary": {"gitFilesChange": 26, "lines": 429, "deletions": 32, "insertions": 397}, "ttf": 100.00027777777778, "filteredCommits": ["8b090df2b88c284b187347b22cbf499ce0dd9f6c", "6d25c1ca192de86bb1e17c66bc98dacccc1a1628", "8430361d1517dafe285d6895ed494be82f75c3ea", "219c93531213a748ad41d5acef7c86ae87c049cb"], "labels": ["bug"], "numCommits": 4, "url": "https://github.com/facebook/buck/issues/298", "user": "luser"}, {"created": "2015-04-22 19:18:53", "spoonStatsSummary": {}, "commits": {"aeeae3740a3fc6235a43191929a2b5ad281d2f88": {"commitGHEventType": "closed", "commitUser": "sdwilsh"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "aeeae3740a3fc6235a43191929a2b5ad281d2f88 tags/v2015.09.10.01~709", "commitUser": "sdwilsh", "commitHash": "aeeae3740a3fc6235a43191929a2b5ad281d2f88", "commitDateTime": "2015-06-08 17:49:38", "commitMessage": "Remove duplicate uses of files in rules\n\nSummary:\nWe are clowns and were referencing these in duplicate rules needlessly.\n\nCloses #288\n\nTest Plan: built it and no longer saw the errors\n", "commitGitStats": [{"filePath": "src/com/facebook/buck/thrift/BUCK", "deletions": 2, "lines": 5, "insertions": 3}, {"filePath": "test/com/facebook/buck/parser/BUCK", "deletions": 0, "lines": 1, "insertions": 1}, {"filePath": "src/com/facebook/buck/java/BUCK", "deletions": 1, "lines": 1, "insertions": 0}, {"filePath": "src/com/facebook/buck/android/BUCK", "deletions": 0, "lines": 1, "insertions": 1}, {"filePath": "src/com/facebook/buck/rules/BUCK", "deletions": 3, "lines": 3, "insertions": 0}], "commitParents": ["2e3f05b3be294324e985953842ba93f20ca03886"], "authoredDateTime": "2015-06-08 11:17:12", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "I'm seeing these warnings:\n\n```\nbuck> .\\bin\\buck build buck-win\nBuck does not appear to have been built -- building Buck!\nAll done, continuing with build.\nNot using buckd because watchman isn't installed.\n[-] PARSING BUCK FILES...FINISHED 2,0s\nDuplicate found when adding file to jar: org/apache/cassandra/thrift/ITransportFactory.class\nDuplicate found when adding file to jar: org/apache/cassandra/thrift/TFramedTransportFactory.class\nDuplicate found when adding file to jar: com/facebook/buck/rules/AbstractBuildRule.class\nDuplicate found when adding file to jar: com/facebook/buck/rules/BuildRuleParams$1.class\nDuplicate found when adding file to jar: com/facebook/buck/rules/BuildRuleParams$2.class\nDuplicate found when adding file to jar: com/facebook/buck/rules/BuildRuleParams.class\nDuplicate found when adding file to jar: com/facebook/buck/rules/BuildRuleResolver$1.class\nDuplicate found when adding file to jar: com/facebook/buck/rules/BuildRuleResolver.class\nDuplicate found when adding file to jar: com/facebook/buck/java/Javac.class\n[-] BUILDING...FINISHED 158,6s\n```\n", "title": "\"Duplicate found when adding file to jar\" warnings during Buck build", "closed": "2015-06-09 01:01:50", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/com/facebook/buck/thrift/BUCK", "test/com/facebook/buck/parser/BUCK", "src/com/facebook/buck/java/BUCK", "src/com/facebook/buck/android/BUCK", "src/com/facebook/buck/rules/BUCK"], "gitStatsSummary": {"gitFilesChange": 5, "lines": 11, "deletions": 6, "insertions": 5}, "ttf": 47.000277777777775, "filteredCommits": ["aeeae3740a3fc6235a43191929a2b5ad281d2f88"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/288", "user": "davido"}, {"changesInPackagesSPOON": ["com.facebook.buck.java.CopyResourcesStep.buildSteps()", "com.facebook.buck.io.MorePaths.pathWithUnixSeparatorsAndTrailingSlash(java.nio.file.Path)"], "created": "2015-04-21 14:55:28", "spoonStatsSummary": {"INS": 1.0, "spoonMethodsChanged": 2, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 2, "TOT": 2.0, "UPD": 1.0}, "commits": {"a4afe018fae8f91f47ff736e8e43afea0b67fff2": {"commitGHEventType": "referenced", "commitUser": "sdwilsh"}, "cc54390bb69dc120d7700842b74e8802fdc27e27": {"commitGHEventType": "referenced", "commitUser": "mread"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "CopyResourcesStep.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 1, "spoonMethodName": "com.facebook.buck.java.CopyResourcesStep.buildSteps()"}]}, {"spoonFilePath": "CopyResourcesStepMustCorrectlyParseFilepathIntegrationTest.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.java.CopyResourcesStepMustCorrectlyParseFilepathIntegrationTest"}]}, {"spoonFilePath": "MorePaths.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.io.MorePaths.pathWithUnixSeparatorsAndTrailingSlash(java.nio.file.Path)"}]}], "nameRev": "a4afe018fae8f91f47ff736e8e43afea0b67fff2 tags/v2015.09.10.01~962", "commitUser": "sdwilsh", "commitHash": "a4afe018fae8f91f47ff736e8e43afea0b67fff2", "commitDateTime": "2015-05-08 14:17:04", "commitMessage": "Test and fix copy_resources issue - facebook#286\n\nSummary:\nAs discussed on facebook#286, if a resource path contained a filename that matched the name of the resource root directory then the wrong symlink target would be constructed causing the copy_resources step to fail.\nCloses https://github.com/facebook/buck/pull/301\nGithub Author: Matt Read <matt.read@lmax.com>\n", "commitGitStats": [{"filePath": "test/com/facebook/buck/java/testdata/wont_delete/java/com/example/data/looping.data", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/testdata/wont_delete/java/com/example/data/acceptance.dmp", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/testdata/wont_delete/java/com/example/BUCK", "deletions": 0, "lines": 6, "insertions": 6}, {"filePath": "src/com/facebook/buck/io/MorePaths.java", "deletions": 0, "lines": 5, "insertions": 5}, {"filePath": "test/com/facebook/buck/java/CopyResourcesStepMustCorrectlyParseFilepathIntegrationTest.java", "deletions": 0, "lines": 44, "insertions": 44}, {"filePath": "src/com/facebook/buck/java/CopyResourcesStep.java", "deletions": 1, "lines": 3, "insertions": 2}], "commitParents": ["76178fac5abdb7eacdd04e543d1c7f7890f9c539"], "authoredDateTime": "2015-05-07 05:38:45", "spoonStatsSkippedReason": "", "commitGHEventType": "referenced"}, {"commitSpoonAstDiffStats": [], "nameRev": "cc54390bb69dc120d7700842b74e8802fdc27e27 tags/v2015.09.10.01~1283", "commitUser": "mread", "commitHash": "cc54390bb69dc120d7700842b74e8802fdc27e27", "commitDateTime": "2015-03-27 17:28:15", "commitMessage": "Change IntelliJ project generation to use Path serialisation instead of strings.\n\nSummary:\nIntelliJ project generation uses strings in many places instead of paths\nbecause jackson wasn't able to serialise paths at that time. Since it now\ncan, this updates the code to use paths where possible.\n\nTest Plan: CI\n", "commitGitStats": [{"filePath": "test/com/facebook/buck/java/JavaSourceJarTest.java", "deletions": 2, "lines": 8, "insertions": 6}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/asset_only/BUCK", "deletions": 0, "lines": 13, "insertions": 13}, {"filePath": "src/com/facebook/buck/java/BUCK", "deletions": 1, "lines": 4, "insertions": 3}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/title/module_res_com_sample_title.iml.expected", "deletions": 0, "lines": 46, "insertions": 46}, {"filePath": "src/com/facebook/buck/java/ResourcesRootPackageFinder.java", "deletions": 9, "lines": 26, "insertions": 17}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/apps/sample/AndroidManifest.xml", "deletions": 0, "lines": 18, "insertions": 18}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/base/res/drawable-mdpi/app_icon.png", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/FakeJavaPackageFinder.java", "deletions": 2, "lines": 13, "insertions": 11}, {"filePath": "src/com/facebook/buck/java/intellij/Project.java", "deletions": 33, "lines": 58, "insertions": 25}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/java/com/sample/lib/Sample.java", "deletions": 0, "lines": 31, "insertions": 31}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/asset_only/module_res_com_sample_asset_only.iml.expected", "deletions": 0, "lines": 43, "insertions": 43}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/base/module_res_com_sample_base.iml.expected", "deletions": 0, "lines": 46, "insertions": 46}, {"filePath": "src/com/facebook/buck/io/MorePaths.java", "deletions": 1, "lines": 10, "insertions": 9}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/keystores/debug.keystore", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/base/BUCK", "deletions": 0, "lines": 15, "insertions": 15}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/base/res/drawable-mdpi/app_icon.png", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/java/com/sample/lib/Sample2.java", "deletions": 0, "lines": 31, "insertions": 31}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/keystores/BUCK", "deletions": 0, "lines": 6, "insertions": 6}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/base/module_res_com_sample_base.iml.expected", "deletions": 0, "lines": 43, "insertions": 43}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/top/BUCK", "deletions": 0, "lines": 15, "insertions": 15}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/base/buck-assets/hilarity.txt", "deletions": 0, "lines": 1, "insertions": 1}, {"filePath": "src/com/facebook/buck/java/JavaSourceJar.java", "deletions": 1, "lines": 2, "insertions": 1}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/top/module_res_com_sample_top.iml.expected", "deletions": 0, "lines": 44, "insertions": 44}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/apps/sample/BUCK", "deletions": 0, "lines": 14, "insertions": 14}, {"filePath": "test/com/facebook/buck/java/intellij/ProjectTest.java", "deletions": 16, "lines": 43, "insertions": 27}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/apps/sample/AndroidManifest.xml", "deletions": 0, "lines": 18, "insertions": 18}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/title/module_res_com_sample_title.iml.expected", "deletions": 0, "lines": 43, "insertions": 43}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/base/res/values-fr/strings.xml", "deletions": 0, "lines": 5, "insertions": 5}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/asset_only/assets/asset_file.txt", "deletions": 0, "lines": 1, "insertions": 1}, {"filePath": "test/com/facebook/buck/shell/ExportFileTest.java", "deletions": 41, "lines": 89, "insertions": 48}, {"filePath": "src/com/facebook/buck/java/intellij/CompilerXml.java", "deletions": 4, "lines": 8, "insertions": 4}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/top/res/drawable/tiny_something.png", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/apps/sample/module_apps_sample.iml.expected", "deletions": 0, "lines": 47, "insertions": 47}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/java/com/sample/lib/module_java_com_sample_lib.iml.expected", "deletions": 0, "lines": 47, "insertions": 47}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/top/module_res_com_sample_top.iml.expected", "deletions": 0, "lines": 47, "insertions": 47}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/base/BUCK", "deletions": 0, "lines": 15, "insertions": 15}, {"filePath": "src/com/facebook/buck/java/CopyResourcesStep.java", "deletions": 7, "lines": 11, "insertions": 4}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/java/com/sample/lib/BUCK", "deletions": 0, "lines": 16, "insertions": 16}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/.idea/modules.xml.expected", "deletions": 0, "lines": 13, "insertions": 13}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/base/res/values-fr/strings.xml", "deletions": 0, "lines": 5, "insertions": 5}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/java/com/sample/lib/Sample3.java", "deletions": 0, "lines": 22, "insertions": 22}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/top/res/drawable/tiny_something.png", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/BUCK", "deletions": 0, "lines": 3, "insertions": 3}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/.idea/compiler.xml.expected", "deletions": 0, "lines": 44, "insertions": 44}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/asset_only/BUCK", "deletions": 0, "lines": 13, "insertions": 13}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/java/com/sample/lib/Sample.java", "deletions": 0, "lines": 31, "insertions": 31}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/apps/sample/module_apps_sample.iml.expected", "deletions": 0, "lines": 47, "insertions": 47}, {"filePath": "test/com/facebook/buck/java/intellij/ProjectIntegrationTest.java", "deletions": 8, "lines": 139, "insertions": 131}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/java/com/sample/lib/Sample3.java", "deletions": 0, "lines": 22, "insertions": 22}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/base/res/drawable-hdpi/app_icon.png", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/top/res/drawable/tiny_white.png", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/cli/ResourcesRootPackageFinderTest.java", "deletions": 4, "lines": 9, "insertions": 5}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/keystores/BUCK", "deletions": 0, "lines": 6, "insertions": 6}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/keystores/debug.keystore", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/base/buck-assets/hilarity.txt", "deletions": 0, "lines": 1, "insertions": 1}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/keystores/debug.keystore.properties", "deletions": 0, "lines": 3, "insertions": 3}, {"filePath": "src/com/facebook/buck/java/JavaPackageFinder.java", "deletions": 2, "lines": 10, "insertions": 8}, {"filePath": "src/com/facebook/buck/java/intellij/DependentModule.java", "deletions": 18, "lines": 18, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/.idea/modules.xml.expected", "deletions": 0, "lines": 13, "insertions": 13}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/base/res/values/strings.xml", "deletions": 0, "lines": 5, "insertions": 5}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/.idea/compiler.xml.expected", "deletions": 0, "lines": 44, "insertions": 44}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/top/res/drawable/tiny_black.png", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/.idea/runConfigurations/Debug_Buck_test.xml.expected", "deletions": 0, "lines": 16, "insertions": 16}, {"filePath": "test/com/facebook/buck/cli/DefaultJavaPackageFinderTest.java", "deletions": 41, "lines": 93, "insertions": 52}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/apps/sample/BUCK", "deletions": 0, "lines": 14, "insertions": 14}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/title/BUCK", "deletions": 0, "lines": 14, "insertions": 14}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/.idea/runConfigurations/Debug_Buck_test.xml.expected", "deletions": 0, "lines": 16, "insertions": 16}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/title/res/values/strings.xml", "deletions": 0, "lines": 4, "insertions": 4}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/java/com/sample/lib/Sample2.java", "deletions": 0, "lines": 31, "insertions": 31}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/java/com/sample/lib/module_java_com_sample_lib.iml.expected", "deletions": 0, "lines": 50, "insertions": 50}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/asset_only/module_res_com_sample_asset_only.iml.expected", "deletions": 0, "lines": 46, "insertions": 46}, {"filePath": "src/com/facebook/buck/java/intellij/Module.java", "deletions": 31, "lines": 85, "insertions": 54}, {"filePath": "src/com/facebook/buck/command/intellij.py", "deletions": 8, "lines": 18, "insertions": 10}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/top/res/layout/top_layout.xml", "deletions": 0, "lines": 12, "insertions": 12}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/title/res/values/strings.xml", "deletions": 0, "lines": 4, "insertions": 4}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/java/com/sample/lib/BUCK", "deletions": 0, "lines": 16, "insertions": 16}, {"filePath": "test/com/facebook/buck/rules/CachingBuildEngineTest.java", "deletions": 11, "lines": 28, "insertions": 17}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/top/res/drawable/tiny_black.png", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/top/BUCK", "deletions": 0, "lines": 15, "insertions": 15}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/asset_only/assets/asset_file.txt", "deletions": 0, "lines": 1, "insertions": 1}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/title/BUCK", "deletions": 0, "lines": 14, "insertions": 14}, {"filePath": "src/com/facebook/buck/java/JavacErrorParser.java", "deletions": 1, "lines": 2, "insertions": 1}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/base/res/drawable-hdpi/app_icon.png", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/keystores/debug.keystore.properties", "deletions": 0, "lines": 3, "insertions": 3}, {"filePath": "src/com/facebook/buck/java/DefaultJavaPackageFinder.java", "deletions": 28, "lines": 52, "insertions": 24}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/top/res/layout/top_layout.xml", "deletions": 0, "lines": 12, "insertions": 12}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/top/res/drawable/tiny_white.png", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/res/com/sample/base/res/drawable-xhdpi/app_icon.png", "deletions": 0, "lines": 0, "insertions": 0}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/base/res/values/strings.xml", "deletions": 0, "lines": 5, "insertions": 5}, {"filePath": "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/res/com/sample/base/res/drawable-xhdpi/app_icon.png", "deletions": 0, "lines": 0, "insertions": 0}], "commitParents": ["24cb38c5c4abf0e24d9840537509c0a6a11b0978"], "authoredDateTime": "2015-03-25 07:29:27", "spoonStatsSkippedReason": "tooManyFiles", "commitGHEventType": "referenced"}], "body": "This commit cc54390bb69dc120d7700842b74e8802fdc27e27 from @Coneko  March 25th introduces a problem during copy_resources.\n\nThe error thrown is this:\n\n```\njava.nio.file.DirectoryNotEmptyException: /xxx/buck-out/bin/test/com/facebook/buck/java/__java_test_java_tmp__/junit8251078377745712488/buck-out/bin/java/com/example/lib__resources__classes/data\n    at sun.nio.fs.UnixFileSystemProvider.implDelete(UnixFileSystemProvider.java:242)\n    at sun.nio.fs.AbstractFileSystemProvider.deleteIfExists(AbstractFileSystemProvider.java:108)\n    at java.nio.file.Files.deleteIfExists(Files.java:1165)\n    at com.facebook.buck.io.ProjectFilesystem.createSymLink(ProjectFilesystem.java:726)\n    at com.facebook.buck.step.fs.SymlinkFileStep.execute(SymlinkFileStep.java:81)\n    at com.facebook.buck.step.CompositeStep.execute(CompositeStep.java:42)\n    at com.facebook.buck.java.CopyResourcesStep.execute(CopyResourcesStep.java:75)\n    at com.facebook.buck.step.DefaultStepRunner.runStepInternal(DefaultStepRunner.java:69)\n```\n\nYou can reproduce it by applying this commit 3e364b985ef9878fb9fe289ab52d549b4415bddf and then running the following:\n\n```\nant clean default && \\\n./bin/buck test //test/com/facebook/buck/java:java --filter CopyResourcesStepFailsIntegrationTest\n```\n\nI'm continuing to investigate but it looks like either order in which resources are symlinked or the types of resources that are symlinked has changed. Any help appreciated.\n", "title": "copy_resources fails to delete directory", "closed": "2015-05-15 09:43:27", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/com/facebook/buck/java/intellij", "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/keystores/debug.keystore.properties", "src/com/facebook/buck/java/BUCK", "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/java/com", "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/keystores/BUCK", "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/apps/sample", "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/java/com", "src/com/facebook/buck/command/intellij.py", "src/com/facebook/buck/io", "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/keystores/debug.keystore.properties", "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/apps/sample", "test/com/facebook/buck/java/testdata/wont_delete/java/com/example", "src/com/facebook/buck/java", "test/com/facebook/buck/java", "test/com/facebook/buck/java/BUCK", "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/keystores/BUCK", "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary_autogeneration_disabled/keystores/debug.keystore", "test/com/facebook/buck/java/intellij/testdata/project_with_android_binary/keystores/debug.keystore"], "gitStatsSummary": {"gitFilesChange": 38, "lines": 771, "deletions": 147, "insertions": 624}, "ttf": 23.00027777777778, "filteredCommits": ["cc54390bb69dc120d7700842b74e8802fdc27e27", "a4afe018fae8f91f47ff736e8e43afea0b67fff2"], "labels": ["bug"], "numCommits": 2, "url": "https://github.com/facebook/buck/issues/286", "user": "mread"}, {"created": "2015-03-13 14:11:19", "closed": "2020-03-04 17:54:57", "commits": {}, "ttf": 1818.0002777777777, "body": "I have a compilation error in one of my test targets, but the other test targets compile fine. I would expect --keep-going to not abort when it encounters the first compilation failure, and instead a) finish compiling the rest of the tests, and b) run the tests that successfully compiled. Instead, it aborts.\n\n```\n$ buck --version\nUsing buckd.\nbuck version 79d36de9f5284f6e833cca81867d6088a25685fb\n$ buck test --keep-going\nUsing buckd.\n[-] PROCESSING BUCK FILES...FINISHED 0.3s\n[+] BUILDING...1.5s (507/553 JOBS)\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project:ListChildProjectsIT...  0.4s (running javac[0.4s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project:GetCommitIT...  0.5s (running calculate_abi[0.0s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/ssh:BanCommitIT...  0.1s (running javac[0.1s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/server/change:GetRelatedIT...  0.2s (running javac[0.2s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/server/change:CommentsIT...  0.2s (running javac[0.2s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/server/project:CustomLabelIT...  0.1s (running javac[0.1s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/server/change:PatchListCacheIT...  0.1s (running javac[0.1s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project:ListBranchesIT...  0.5s (running javac[0.5s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project:SetParentIT...  0.3s (running javac[0.3s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project:ListProjectsIT...  0.3s (running javac[0.3s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/ssh:GarbageCollectionIT...  0.1s (running javac[0.0s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project:TagsIT...  0.3s (running javac[0.3s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/server/project:LabelTypeIT...  0.1s (running javac[0.1s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project:ProjectLevelConfigIT...  0.3s (running javac[0.3s])\n |=> //gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project:GetProjectIT...  0.5s (running javac[0.4s])\n/usr/local/google/home/dborowitz/nobackup/c/gerrit-upstream/gerrit/gerrit-acceptance-tests/src/test/java/com/google/gerrit/acceptance/rest/project/ListProjectsIT.java:197: error: wrong number of type argu$\nents; required 1\n    Iterable<String, ProjectInfo> result = toProjectInfoMap(r);\n            ^\nErrors: 1. Warnings: 0.\nBUILD FAILED: Not all rules succeeded.\n```\n", "title": "buck test --keep-going doesn't work", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/274", "user": "dborowitz"}, {"created": "2015-02-02 15:47:12", "closed": "2020-03-02 21:33:03", "commits": {}, "ttf": 1855.0002777777777, "body": "Quoted from https://github.com/facebook/buck/issues/109#issuecomment-71261664\n\n> I've spent some time to understand why small extension to Gerrit GWT Plugin API worked as expected in standalone build mode, but failed to compile in Gerrit tree mode: [1]. Classpath of GWT compiler invocation was polluted with dozens of pseudo GWT modules, that interfered with this new extension.\n> \n> What happened? The easiest way to see the problem is to check the source code: [2].\n> \n> It turns out (it wasn't really clear to me) that the implementation reconstructs GWT modules from the dependency graph. In Gerrit tree build //gerrit-plugin-api:lib that was passed here, resolved to dozens of rules and thus the whole Gerrit server stuff was included as GWT modules and passed to the GWT compiler. Even though we used provided deps.\n> \n> In standalone mode, that makes use of bucklets, the implementation is different: plugin-api.jar is fetched from Central and is used as module deps. Dependency graph here is empty, so nothing is passed in addition to GWT compiler and the classpath wasn't polluted.\n> \n> I think that the reachability resolution algorithm should differentiate between provided deps and normal deps. Another option to consider is to make dependency module resolution configurable.\n> \n> [1] https://gerrit-review.googlesource.com/#/c/63489\n> [2] https://github.com/facebook/buck/blob/master/src/com/facebook/buck/gwt/GwtBinaryDescription.java#L115,L138\n", "title": "GWT build rules pull in unwanted dependencies", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/239", "user": "Coneko"}, {"changesInPackagesSPOON": ["com.facebook.buck.rules.macros.MacroHandler.expand(com.facebook.buck.model.BuildTarget,com.facebook.buck.rules.BuildRuleResolver,com.facebook.buck.util.ProjectFilesystem,java.lang.String)"], "created": "2014-10-23 23:03:35", "spoonStatsSummary": {"INS": 1.0, "spoonMethodsChanged": 1, "MOV": 4.0, "DEL": 1.0, "spoonFilesChanged": 1, "TOT": 6.0, "UPD": 0.0}, "commits": {"1bae64971f126e3cfe9fab51553d6a64a8c83d0e": {"commitGHEventType": "referenced", "commitUser": "andrewjcg"}, "eba83724c560150c00720a74c8db250c23cf6484": {"commitGHEventType": "closed", "commitUser": "andrewjcg"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "1bae64971f126e3cfe9fab51553d6a64a8c83d0e tags/v2015.09.10.01~2147", "commitUser": "andrewjcg", "commitHash": "1bae64971f126e3cfe9fab51553d6a64a8c83d0e", "commitDateTime": "2014-10-29 12:45:45", "commitMessage": "Document string parameter macros\n\nSummary:\nThis adds explicit documentation for the string parameter macros\nwe support in the string parameters of various rules, and references\nit from the genrule description.  In particular, it explains the\nbasic syntax and escaping procedure.\n\nTest Plan:\nran page locally\n\nFixes #212\n", "commitGitStats": [{"filePath": "docs/rule/genrule.soy", "deletions": 1, "lines": 3, "insertions": 2}, {"filePath": "docs/__common.soy", "deletions": 0, "lines": 6, "insertions": 6}, {"filePath": "docs/function/string_parameter_macros.soy", "deletions": 0, "lines": 66, "insertions": 66}], "commitParents": ["ef9cc91cf2bc6c61df031c7b8ca040300e4b2ad1"], "authoredDateTime": "2014-10-23 21:02:06", "spoonStatsSkippedReason": "", "commitGHEventType": "referenced"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "MacroHandler.java", "spoonMethods": [{"INS": 1, "MOV": 4, "DEL": 1, "UPD": 0, "TOT": 6, "spoonMethodName": "com.facebook.buck.rules.macros.MacroHandler.expand(com.facebook.buck.model.BuildTarget,com.facebook.buck.rules.BuildRuleResolver,com.facebook.buck.util.ProjectFilesystem,java.lang.String)"}]}, {"spoonFilePath": "MacroHandlerTest.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.rules.macros.MacroHandlerTest.escapeMacro()"}]}], "nameRev": "eba83724c560150c00720a74c8db250c23cf6484 tags/v2015.09.10.01~2149", "commitUser": "andrewjcg", "commitHash": "eba83724c560150c00720a74c8db250c23cf6484", "commitDateTime": "2014-10-29 12:45:40", "commitMessage": "Drop backslash from escaped macros\n\nSummary:\nCurrently we respect the backslash to escape the use of builtin\nmacros, but we don't drop it in the expanded value.\n\nFixes #212\n\nTest Plan: added unittest\n", "commitGitStats": [{"filePath": "src/com/facebook/buck/rules/macros/MacroHandler.java", "deletions": 13, "lines": 29, "insertions": 16}, {"filePath": "test/com/facebook/buck/rules/macros/MacroHandlerTest.java", "deletions": 0, "lines": 12, "insertions": 12}], "commitParents": ["12a0437ff5ef88475f66f34c8dd2e3a8bc6f4078"], "authoredDateTime": "2014-10-23 17:44:43", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "Before this commit d6f3252170abe7a6de8e7dec0cc90000147c5d10 something like this was valid:\n\n```\ndef custom(\n    name,\n    dest):\n  genrule(\n    name = name,\n    cmd = 'cd $TMP;' +\n      ('mkdir -p $(dirname %s);' % '$OUT') +\n       'echo \"__done__\" >$OUT',\n    out = dest\n  )\n\ncustom(\n  name = 'foo',\n  dest = 'bar/baz/qux.txt',\n)\n```\n\nWith the resolution:\n\n```\n$ buck targets --json :foo\nUsing buckd.\n[\n{\n  \"buck.base_path\" : \"\",\n  \"buck.output_file\" : \"buck-out/gen/bar/baz/qux.txt\",\n  \"cmd\" : \"cd $TMP;mkdir -p $(dirname $OUT);echo \\\"done\\\" >$OUT\",\n  \"deps\" : [ ],\n  \"name\" : \"foo\",\n  \"out\" : \"bar/baz/qux.txt\",\n  \"srcs\" : [ ],\n  \"type\" : \"genrule\",\n  \"visibility\" : [ ]\n}\n]\n```\n\nIn fact Gerrit Code Review project is relying on this \"feature\" in its toolchain.\n\nAfter the mentioned commit, this Buck sniplet is rejected with:\n\n```\n$ cat .buckversion\nd6f3252170abe7a6de8e7dec0cc90000147c5d10\n\n$ buck build :foo\nUsing buckd.\nBUILD FAILED: //:foo: no such macro \"dirname\"\n```\n", "title": "Shell macros are broken in recent master, e. g. \"$(dirname %s)\" ", "closed": "2014-10-29 19:54:42", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["docs/rule/genrule.soy", "src/com/facebook/buck/rules/macros", "docs/function/string_parameter_macros.soy", "docs/__common.soy"], "gitStatsSummary": {"gitFilesChange": 4, "lines": 104, "deletions": 14, "insertions": 90}, "ttf": 5.000277777777778, "filteredCommits": ["1bae64971f126e3cfe9fab51553d6a64a8c83d0e", "eba83724c560150c00720a74c8db250c23cf6484"], "labels": ["bug", "documentation"], "numCommits": 2, "url": "https://github.com/facebook/buck/issues/212", "user": "davido"}, {"created": "2014-10-15 18:49:01", "closed": "2020-03-04 17:59:58", "commits": {}, "ttf": 1966.0002777777777, "body": "The scenario here is an AAR file that has **no** resources in its `res/` directory, and has **no** `R.txt` file.  The AAR has a classes.jar that includes an `R.class` that was created as a result of what appears to be an obfuscation pass (proguard or otherwise) -- that assumption is made based on the fact that there are several other adjacent classes with single-character names:  `Q.class`, `R.class`, `S.class`, etc.  Ordinarily, if there is no R.txt, then no _resources_-related R.class should be generated for it (and this works correctly in a Gradle build, for example:  there is no `build/generated/source/r/debug/com/crashlytics/android/R.java` file, because the AAR contains no `R.txt`).\n\nBuck appears to be assuming that **all** AAR files require an `R.class`, even if it has an empty `res/` and missing `R.txt`, so it ends up generating an empty `R.class` for that package.  However, in this case, that class ends up overwriting the `R` class that already exists in classes.jar.  That causes an error with the caching system, reporting an error due to \"Multiple entries with the same key\":\n\n```\nMultiple entries with same key: com/crashlytics/android/R=3040495ca6cb51bd19a9878a5a73ae8093cdb0fd and com/crashlytics/android/R=2dd42ddb490ce969a59fcfd0e692f3ee1accafad\n```\n\nChecking the `buck-out/` directory shows that the entries come from two different places:\n\n```\nbuck-out//gen/aars__crashlytics-2.0.3#aar_prebuilt_jar.classes.txt:com/crashlytics/android/R 2dd42ddb490ce969a59fcfd0e692f3ee1accafad\nbuck-out//bin/__app#aapt_package_rdotjava_classes__/classes.txt:com/crashlytics/android/R 3040495ca6cb51bd19a9878a5a73ae8093cdb0fd\n```\n\nPresumably, the one in `#aar_prebuilt_jar.classes.txt` is the true R.class that exists in the `classes.jar` of the AAR.  The one in `#aapt_package_rdotjava_classes__/classes.txt` appears to be the automatically generated R.class as a result of the aapt resources processing.\n\nIn an effort to get past this error just to get the project to compile, I deleted the entry from the `#aapt_package_` version, and that allowed it to continue to the `smart_dex` step.  At this point I hit a `GC overhead limit exceeded` error (this is caused by `dx` not having a large enough heap size: my project requires a 3GB heap for dex to succeed).  But that's a separate issue.\n\nAfter adjusting the heap size in the `dx` shell script, the dex tool itself then hit an error with:\n\n```\njava.lang.IllegalArgumentException: already added: Lcom/crashlytics/android/R;\n```\n\nIt's already added because it is still trying to add both the real (obfuscated) R.class and the generated (R.txt) R.class.\n\nI'm not sure if this should be reported as an issue to the Crashlytics team (since having an R.class in the library's own package scope can be seen as risky and should probably be avoided).  However, since all other build tools seem to work perfectly fine with this scenario, I'm going to assume that it's a bug in buck in that it generates the resources R.class for an AAR that does not want one.\n\nAn AAR that exhibits this behavior is the Crashlytics SDK (both versions 1.2.0 and 2.0.3).  The URL to download the AAR from their Maven repository:  [crashlytics-2.0.3.aar](https://sdk-user:5Y|3-ViTSt*8Hxu7Jj*97zzaC6+RUK9MPw_4kqbPMfWe4Iwc^$@twittersdk.artifactoryonline.com/twittersdk/repo/com/twitter/sdk/android/crashlytics/2.0.3/crashlytics-2.0.3.aar).\n", "title": "AAR that contains R.class has that class overwritten by Buck assumptions", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/207", "user": "jhansche"}, {"created": "2014-09-02 15:28:37", "closed": "2016-06-14 09:17:03", "commits": {}, "ttf": 650.0002777777778, "body": "This commit abd06e22bb6f7696e3b0687eba4a2d591a7dd1ae appears to have changed the behaviour of `buck project` as per the issue title. Could someone confirm whether this is as intended please? And if so, how to configure a module with child directories containing BUCK files that we do not wish to be separate IntelliJ modules? @Coneko @oconnor663 \n", "title": "IntelliJ modules now exclude any folder containing a BUCK file that does not contain a project_config", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/188", "user": "mread"}, {"created": "2014-08-11 10:21:05", "spoonStatsSummary": {}, "commits": {"d2ab9501bb77349d1ac09a5716ac9795ad95d3ad": {"commitGHEventType": "closed", "commitUser": "sdwilsh"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "d2ab9501bb77349d1ac09a5716ac9795ad95d3ad tags/v2015.09.10.01~2667", "commitUser": "sdwilsh", "commitHash": "d2ab9501bb77349d1ac09a5716ac9795ad95d3ad", "commitDateTime": "2014-08-11 12:25:07", "commitMessage": "Prefer Buck's twitter-commons over a system-installed one.\n\nSummary:\nWe were properly prepending the path for setuptools, but not for\ntwitter-commons, so the system version would be used instead of ours.\n\nFixes #175\n\nTest Plan: `buck test --all`\n", "commitGitStats": [{"filePath": "src/com/facebook/buck/python/pex.py", "deletions": 2, "lines": 4, "insertions": 2}], "commitParents": ["c68efa45e7b412cb53bcb3e5e4f88b86828d89d0"], "authoredDateTime": "2014-08-11 10:34:44", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "If you have any of the twitter's packages installed globally (pex, or pants, or twiitter commons) a python build will fail. Creating an empty virtualenv fixes the problem, which means that the sys.path should be modified so to add preference to the packages shipped with buck.\n\n``` bash\n$ ~/buck/bin/buck build //foo:foo\nWatchman not found, please install when using buckd.\nSee https://github.com/facebook/watchman for details.\n[-] PARSING BUILD FILES...FINISHED 1.0s\n[+] BUILDING...1.5s\n |=> IDLE\n |=> //foo:foo...  1.3s (running pex[0.4s])\nLog:\n/usr/local/lib/python2.7/dist-packages/twitter/common/python/__init__.py:22: UserWarning: \ntwitter.common.python has been renamed to pex.  please switch imports\nto use pex instead.\n\n  \"\"\")\nTraceback (most recent call last):\n  File \"/home/skreft/buck/src/com/facebook/buck/python/pex.py\", line 24, in <module>\n    from twitter.common.python.pex_builder import PEXBuilder\n  File \"/usr/local/lib/python2.7/dist-packages/twitter/common/python/pex_builder.py\", line 2, in <module>\n    from pex.pex_builder import *\n  File \"/home/skreft/buck/src/com/facebook/buck/python/pex.py\", line 24, in <module>\n    from twitter.common.python.pex_builder import PEXBuilder\nImportError: cannot import name PEXBuilder\nBUILD FAILED: //foo:foo failed with exit code 1:\npex\n```\n", "title": "Building a python binary fails if any twitter packages are installed globally", "closed": "2014-08-11 19:25:21", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/com/facebook/buck/python/pex.py"], "gitStatsSummary": {"gitFilesChange": 1, "lines": 4, "deletions": 2, "insertions": 2}, "ttf": 0.0002777777777777778, "filteredCommits": ["d2ab9501bb77349d1ac09a5716ac9795ad95d3ad"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/175", "user": "sk-"}, {"created": "2014-07-11 13:46:04", "closed": "2020-03-02 21:56:21", "commits": {}, "ttf": 2061.0002777777777, "body": "/usr/bin/java on my Mac changed to point to a non-JDK JRE. Buck understandably complained:\n\n```\nBUILD FAILED: //gitiles-servlet:servlet failed on step javac with an exception:\nIf using JRE instead of JDK, ToolProvider.getSystemJavaCompiler() may be null.\n```\n\nMy usual fix is to rewrite the symlink to point to a JDK; I was surprised when this did not fix the problem. Then I remembered to manually kill buckd. (Which was moderately annoying in itself because \"killall buckd\" didn't work.) It would be nice if the buck launcher could detect if it's running under a different Java than buckd and restart the latter if that's the case.\n", "title": "buckd should restart if java binary changes", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/154", "user": "dborowitz"}, {"created": "2014-06-14 20:15:45", "spoonStatsSummary": {}, "commits": {"240abedc219e86ece2d3295e743dafaf805f3fe2": {"commitGHEventType": "closed", "commitUser": "natthu"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "240abedc219e86ece2d3295e743dafaf805f3fe2 tags/v2015.09.10.01~2694", "commitUser": "natthu", "commitHash": "240abedc219e86ece2d3295e743dafaf805f3fe2", "commitDateTime": "2014-08-11 12:02:58", "commitMessage": "Do not set the MaxPermSize java command line option if using Java 8.\n\nSummary: Fixes #138\n\nTest Plan:\nUsing java 1.8, launch buck/buckd commands; verify the \"ignoring option\"\nwarning is no longer printed.\n", "commitGitStats": [{"filePath": "bin/buck_repo.py", "deletions": 3, "lines": 12, "insertions": 9}], "commitParents": ["e42ca7fa93a2a735b7b91232e373c51526d1c19a"], "authoredDateTime": "2014-08-07 12:56:07", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "Using buck with `Java 8` produces these warnings:\n\n```\n$ buck build gerrit\nUsing buckd.\n[-] PARSING BUILD FILES...FINISHED 0,8s\n[-] BUILDING...FINISHED 112,9s\nLog:\nUsing buckd.\nJava HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0\nJava HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=512m; support was removed in 8.0\n[-] PARSING BUILD FILES...FINISHED 0,1s\nUsing buckd.\nDaemon is busy, starting new buck process.\nJava HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0\nJava HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=512m; support was removed in 8.0\n[-] PARSING BUILD FILES...FINISHED 0,1s\n```\n", "title": "buck_comon: ignoring option MaxPermSize=256m; support was removed in 8.0", "closed": "2014-08-11 19:17:22", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["bin/buck_repo.py"], "gitStatsSummary": {"gitFilesChange": 1, "lines": 12, "deletions": 3, "insertions": 9}, "ttf": 57.000277777777775, "filteredCommits": ["240abedc219e86ece2d3295e743dafaf805f3fe2"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/138", "user": "davido"}, {"created": "2014-06-13 12:33:33", "spoonStatsSummary": {}, "commits": {"a408e2dafbc19c2b4274d57c76c5d0f31bc6306b": {"commitGHEventType": "referenced", "commitUser": "sdwilsh"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "a408e2dafbc19c2b4274d57c76c5d0f31bc6306b tags/v2015.09.10.01~2971", "commitUser": "sdwilsh", "commitHash": "a408e2dafbc19c2b4274d57c76c5d0f31bc6306b", "commitDateTime": "2014-06-18 07:56:50", "commitMessage": "Fixed the description of build target patterns ending with \"...\".\n\nSummary: Reported in a comment of #137.\n", "commitGitStats": [{"filePath": "docs/concept/build_target_pattern.soy", "deletions": 2, "lines": 4, "insertions": 2}], "commitParents": ["2d1a7bb05d2717b09aec323a4b6d9935b68af912"], "authoredDateTime": "2014-06-18 07:20:12", "spoonStatsSkippedReason": "", "commitGHEventType": "referenced"}], "body": "In https://facebook.github.io/buck/concept/build_target_pattern.html it is explained that a target pattern can end with three dots, meaning that it would match all targets defined in that folder or subfolders.\n\nHowever, running buck build or buck test, generates the following error.\n\n```\n~/buck/bin/buck test //javatests/com/foo/bar/...\nBUILD FAILED: //javatests/com/foo/bar/...:... cannot contain ..\n```\n", "title": "Build and Test do not accept targets ending with \"/...\"", "closed": "2014-12-30 23:36:15", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["docs/concept/build_target_pattern.soy"], "gitStatsSummary": {"gitFilesChange": 1, "lines": 4, "deletions": 2, "insertions": 2}, "ttf": 200.00027777777777, "filteredCommits": ["a408e2dafbc19c2b4274d57c76c5d0f31bc6306b"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/137", "user": "sk-"}, {"changesInPackagesSPOON": ["com.facebook.buck.java.JavaLibraryDescription.createBuildable(com.facebook.buck.rules.BuildRuleParams,com.facebook.buck.java.JavaLibraryDescription$Arg)", "com.facebook.buck.android.AndroidLibraryDescription.createBuildable(com.facebook.buck.rules.BuildRuleParams,com.facebook.buck.android.AndroidLibraryDescription$Arg)", "com.facebook.buck.rules.AbstractBuilder.build(com.facebook.buck.util.ProjectFilesystem)", "com.facebook.buck.rules.AbstractBuilder.build(com.facebook.buck.rules.BuildRuleResolver,com.facebook.buck.util.ProjectFilesystem)", "com.facebook.buck.java.JavaLibraryDescription.validateResources(com.facebook.buck.java.JavaLibraryDescription$Arg,com.facebook.buck.util.ProjectFilesystem)", "com.facebook.buck.rules.AbstractBuilder.build()"], "created": "2014-06-11 15:41:42", "spoonStatsSummary": {"INS": 5, "spoonMethodsChanged": 6, "MOV": 0, "DEL": 1, "spoonFilesChanged": 3, "TOT": 8, "UPD": 2}, "commits": {"406263085b48a356347ddf43084b8d0ea9699344": {"commitGHEventType": "closed", "commitUser": "natthu"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "AndroidLibraryDescription.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 1, "spoonMethodName": "com.facebook.buck.android.AndroidLibraryDescription.createBuildable(com.facebook.buck.rules.BuildRuleParams,com.facebook.buck.android.AndroidLibraryDescription$Arg)"}]}, {"spoonFilePath": "RobolectricTestDescription.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 1, "spoonMethodName": "com.facebook.buck.android.RobolectricTestDescription.createBuildable(com.facebook.buck.rules.BuildRuleParams,com.facebook.buck.android.RobolectricTestDescription$Arg)"}]}, {"spoonFilePath": "JavaTestDescription.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 1, "spoonMethodName": "com.facebook.buck.java.JavaTestDescription.createBuildable(com.facebook.buck.rules.BuildRuleParams,com.facebook.buck.java.JavaTestDescription$Arg)"}]}, {"spoonFilePath": "AbstractBuilder.java", "spoonMethods": [{"INS": 2, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.rules.AbstractBuilder.build(com.facebook.buck.util.ProjectFilesystem)"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.rules.AbstractBuilder.build(com.facebook.buck.rules.BuildRuleResolver,com.facebook.buck.util.ProjectFilesystem)"}, {"INS": 1, "MOV": 0, "DEL": 1, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.rules.AbstractBuilder.build()"}]}, {"spoonFilePath": "JavaLibraryDescription.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 1, "spoonMethodName": "com.facebook.buck.java.JavaLibraryDescription.createBuildable(com.facebook.buck.rules.BuildRuleParams,com.facebook.buck.java.JavaLibraryDescription$Arg)"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.java.JavaLibraryDescription.validateResources(com.facebook.buck.java.JavaLibraryDescription$Arg,com.facebook.buck.util.ProjectFilesystem)"}]}, {"spoonFilePath": "DefaultJavaLibraryTest.java", "spoonMethods": [{"INS": 0, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 1, "spoonMethodName": "com.facebook.buck.java.DefaultJavaLibraryTest.testClasspathForJavacCommand().2"}, {"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.java.DefaultJavaLibraryTest.testJavaLibaryThrowsIfResourceIsDirectory()"}, {"INS": 0, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 1, "spoonMethodName": "com.facebook.buck.java.DefaultJavaLibraryTest.createDefaultJavaLibaryRuleWithAbiKey(java.lang.String,com.facebook.buck.model.BuildTarget,com.google.common.collect.ImmutableSet,com.google.common.collect.ImmutableSortedSet,com.google.common.collect.ImmutableSortedSet).3"}, {"INS": 0, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 1, "spoonMethodName": "com.facebook.buck.java.DefaultJavaLibraryTest.createDefaultJavaLibaryRuleWithAbiKey(java.lang.String,com.facebook.buck.model.BuildTarget,com.google.common.collect.ImmutableSet,com.google.common.collect.ImmutableSortedSet,com.google.common.collect.ImmutableSortedSet).3.getAbiKey()"}, {"INS": 2, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.java.DefaultJavaLibraryTest.testGetInputsToCompareToOutputWhenAResourceAsSourcePathExists()"}, {"INS": 0, "MOV": 2, "DEL": 0, "UPD": 1, "TOT": 3, "spoonMethodName": "com.facebook.buck.java.DefaultJavaLibraryTest.testClasspathForJavacCommand().2.getOutputClasspathEntries()"}, {"INS": 0, "MOV": 0, "DEL": 0, "UPD": 1, "TOT": 1, "spoonMethodName": "com.facebook.buck.java.DefaultJavaLibraryTest.createJarResolver(com.google.common.collect.ImmutableMap).4"}, {"INS": 3, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 3, "spoonMethodName": "com.facebook.buck.java.DefaultJavaLibraryTest.testRuleKeyIsOrderInsensitiveForSourcesAndResources()"}, {"INS": 0, "MOV": 2, "DEL": 0, "UPD": 1, "TOT": 3, "spoonMethodName": "com.facebook.buck.java.DefaultJavaLibraryTest.testClasspathForJavacCommand().2.getDeclaredClasspathEntries()"}]}], "nameRev": "406263085b48a356347ddf43084b8d0ea9699344 tags/v2015.09.10.01~2984", "commitUser": "natthu", "commitHash": "406263085b48a356347ddf43084b8d0ea9699344", "commitDateTime": "2014-06-16 17:18:26", "commitMessage": "Throw an error if a directory is passed to the `resources` arg of a java_library.\n\nSummary:\nBonus - also throw if a file doesn't exist.\n\nCloses #136\n\nTest Plan:\nUnit test\nbuck test --all\n", "commitGitStats": [{"filePath": "src/com/facebook/buck/android/AndroidLibraryDescription.java", "deletions": 1, "lines": 2, "insertions": 1}, {"filePath": "src/com/facebook/buck/android/RobolectricTestDescription.java", "deletions": 1, "lines": 2, "insertions": 1}, {"filePath": "test/com/facebook/buck/rules/AbstractBuilder.java", "deletions": 3, "lines": 10, "insertions": 7}, {"filePath": "src/com/facebook/buck/java/JavaLibraryDescription.java", "deletions": 1, "lines": 20, "insertions": 19}, {"filePath": "src/com/facebook/buck/java/JavaTestDescription.java", "deletions": 1, "lines": 2, "insertions": 1}, {"filePath": "test/com/facebook/buck/java/DefaultJavaLibraryTest.java", "deletions": 3, "lines": 41, "insertions": 38}], "commitParents": ["9767017162fb5fe9861ec710922c7e7e89a24810"], "authoredDateTime": "2014-06-12 11:47:24", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "When one of the specified resources is a directory an exception is thrown explaining the cause. however, the process never finishes, below is a sample ouput, that was stopped after 20s.\n\n```\n[-] PARSING BUILD FILES...FINISHED 0.3s\n[+] BUILDING...0.0s\n |=> //.../foo-jar...  0.0s (checking local cache)\nException in thread \"DefaultStepRunner-4\" java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.io.FileNotFoundException: foo/bar (Is a directory)\n    at com.facebook.buck.util.DefaultFileHashCache.get(DefaultFileHashCache.java:76)\n    at com.facebook.buck.rules.RuleKey$Builder.setInputVal(RuleKey.java:290)\n    at com.facebook.buck.rules.RuleKey$Builder.setInputs(RuleKey.java:276)\n    at com.facebook.buck.rules.AbstractBuildRule.appendToRuleKey(AbstractBuildRule.java:167)\n    at com.facebook.buck.rules.AbstractBuildRule.getRuleKeyPair(AbstractBuildRule.java:199)\n    at com.facebook.buck.rules.AbstractBuildRule.getRuleKey(AbstractBuildRule.java:180)\n    at com.facebook.buck.rules.CachingBuildEngine$1.onSuccess(CachingBuildEngine.java:175)\n    at com.facebook.buck.rules.CachingBuildEngine$1.onSuccess(CachingBuildEngine.java:130)\n    at com.google.common.util.concurrent.Futures$4.run(Futures.java:1169)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.util.concurrent.ExecutionException: java.io.FileNotFoundException: foo/bar (Is a directory)\n    at com.google.common.util.concurrent.AbstractFuture$Sync.getValue(AbstractFuture.java:299)\n    at com.google.common.util.concurrent.AbstractFuture$Sync.get(AbstractFuture.java:286)\n    at com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:116)\n    at com.google.common.util.concurrent.Uninterruptibles.getUninterruptibly(Uninterruptibles.java:135)\n    at com.google.common.cache.LocalCache$Segment.getAndRecordStats(LocalCache.java:2344)\n    at com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2316)\n    at com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2278)\n    at com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2193)\n    at com.google.common.cache.LocalCache.get(LocalCache.java:3932)\n    at com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:3936)\n    at com.google.common.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:4806)\n    at com.facebook.buck.util.DefaultFileHashCache.get(DefaultFileHashCache.java:74)\n    ... 11 more\nCaused by: java.io.FileNotFoundException: foo/bar (Is a directory)\n    at java.io.FileInputStream.open(Native Method)\n    at java.io.FileInputStream.<init>(FileInputStream.java:146)\n    at com.google.common.io.Files$FileByteSource.openStream(Files.java:127)\n    at com.google.common.io.Files$FileByteSource.openStream(Files.java:117)\n    at com.google.common.io.ByteSource.getInput(ByteSource.java:91)\n    at com.google.common.io.ByteSource.getInput(ByteSource.java:57)\n    at com.google.common.io.ByteStreams$3.openStream(ByteStreams.java:907)\n    at com.google.common.io.ByteSource.copyTo(ByteSource.java:227)\n    at com.google.common.io.ByteSource.hash(ByteSource.java:281)\n    at com.google.common.io.ByteStreams.hash(ByteStreams.java:792)\n    at com.facebook.buck.util.DefaultFileHashCache$1.load(DefaultFileHashCache.java:56)\n    at com.facebook.buck.util.DefaultFileHashCache$1.load(DefaultFileHashCache.java:51)\n[-] PARSING BUILD FILES...FINISHED 0.3s\n[+] BUILDING...20.4s\n |=> IDLE\n |=> IDLE\n |=> IDLE\n |=> //third_party/java/language-detection:langdetect...  20.3s (checking local cache)\n |=> IDLE\nLog:\n\n```\n", "title": "Java_library hangs when resources is invalid", "closed": "2014-06-17 01:27:08", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["test/com/facebook/buck/rules", "src/com/facebook/buck/android", "src/com/facebook/buck/java"], "gitStatsSummary": {"gitFilesChange": 3, "lines": 32, "deletions": 5, "insertions": 27}, "ttf": 5.000277777777778, "filteredCommits": ["406263085b48a356347ddf43084b8d0ea9699344"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/136", "user": "sk-"}, {"changesInPackagesSPOON": ["com.facebook.buck.java.DefaultJavaLibrary.appendDetailsToRuleKey(com.facebook.buck.rules.RuleKey$Builder)"], "created": "2014-06-09 17:23:22", "spoonStatsSummary": {"INS": 1, "spoonMethodsChanged": 1, "MOV": 1, "DEL": 0, "spoonFilesChanged": 1, "TOT": 2, "UPD": 0}, "commits": {"99ab6a25490d7d49ddfeb18af1c490ee9cb06e57": {"commitGHEventType": "closed", "commitUser": "natthu"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "DefaultJavaLibrary.java", "spoonMethods": [{"INS": 1, "MOV": 1, "DEL": 0, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.java.DefaultJavaLibrary.appendDetailsToRuleKey(com.facebook.buck.rules.RuleKey$Builder)"}]}, {"spoonFilePath": "DefaultJavaLibraryIntegrationTest.java", "spoonMethods": [{"INS": 1, "MOV": 0, "DEL": 0, "UPD": 0, "TOT": 1, "spoonMethodName": "com.facebook.buck.java.DefaultJavaLibraryIntegrationTest.ensureChangingDepFromProvidedToTransitiveTriggersRebuild()"}]}], "nameRev": "99ab6a25490d7d49ddfeb18af1c490ee9cb06e57 tags/v2015.09.10.01~3062", "commitUser": "natthu", "commitHash": "99ab6a25490d7d49ddfeb18af1c490ee9cb06e57", "commitDateTime": "2014-06-09 14:18:02", "commitMessage": "Set 'provided_deps' explicitly in the rule key.\n\nSummary:\nBug description: https://github.com/facebook/buck/issues/133\n\nSince we were not treating provided deps differently in the rule key, changing\na dependency from transitive to provided wouldn't change the java library's\nrule key. This fixes it.\n\nCloses #133 on github.\n\nTest Plan: Integration test that fails without this fix.\n", "commitGitStats": [{"filePath": "src/com/facebook/buck/java/DefaultJavaLibrary.java", "deletions": 1, "lines": 6, "insertions": 5}, {"filePath": "test/com/facebook/buck/java/DefaultJavaLibraryIntegrationTest.java", "deletions": 0, "lines": 16, "insertions": 16}, {"filePath": "test/com/facebook/buck/java/testdata/provided_deps/BUCK", "deletions": 1, "lines": 2, "insertions": 1}], "commitParents": ["ffa99667422b1601d8caecbd213002b13c7ae53d"], "authoredDateTime": "2014-06-09 11:22:33", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "Found on Buck version: 62a21e043\nGiven the following .buckconfig content:\n\n```\n[cache]\n  mode = dir\n  dir = buck-out/cache\n```\n\nand the following BUCK file:\n\n```\ngenrule(\n  name = 'manifest',\n  cmd = 'echo \"foo: bar\" > $OUT',\n  out = 'MANIFEST.MF',\n)\n\njava_binary(\n  name = 'plugin',\n  main_class = 'org.ostrovsky.buck.Main',\n  manifest_file = ':manifest',\n  merge_manifests = False,\n  deps = [\n    '//:plugin-lib',\n  ],\n)\n\njava_library(\n  name = 'plugin-lib',\n  srcs = glob(['java/**/*.java']),\n  deps = ['//:commons-io'],\n)\n\nprebuilt_jar(\n  name = 'commons-io',\n  binary_jar = 'libs/commons-io-1.4.jar',\n  source_jar = 'libs/commons-io-1.4-sources.jar',\n)\n```\n\nBuild the project with `buck build :plugin`. Verify that as expected `buck-out/gen/plugin.jar` contains (because of transitive dependencies to it) apache commons-io classes.\n\nChange in `java_library()` reference to `commons-io` from transitive to provided dependencies:\n\n```\njava_library(\n  name = 'plugin-lib',\n  srcs = glob(['java/**/*.java']),\n  provided_deps = ['//:commons-io'],\n)\n```\n\nRepeat the build with `buck build :plugin`: \n\n```\n$ buck build :plugin\nUsing buckd.\n[-] PARSING BUILD FILES...FINISHED 0,0s\n[-] BUILDING...FINISHED 0,0s\nLog:\n```\n\nNo rebuild takes place: the plugin.jar still contains commons-io. Expected result: after changing from `deps` to `provided_deps` plugin.jar must be recreated and not contain commons-io classes.\n\nTrying to clean the build result to enforce the rebuild with `buck clean` doesn't help here: still no rebuild takes place.\n\nThe only known work around: wipe out the buck output directory and rebuild:\n\n```\nrm -rf buck-out && buck build :plugin\n```\n\nfixes that.\n", "title": "java_library(): changing deps to provided_deps doesn't trigger library rebuild", "closed": "2014-06-09 21:31:21", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["test/com/facebook/buck/java/testdata/provided_deps/BUCK", "src/com/facebook/buck/java"], "gitStatsSummary": {"gitFilesChange": 2, "lines": 8, "deletions": 2, "insertions": 6}, "ttf": 0.0002777777777777778, "filteredCommits": ["99ab6a25490d7d49ddfeb18af1c490ee9cb06e57"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/133", "user": "davido"}, {"changesInPackagesSPOON": ["com.facebook.buck.java.JarDirectoryStep.copyZipEntriesToJar(java.io.File,com.facebook.buck.zip.CustomZipOutputStream,java.util.jar.Manifest,java.util.Set,com.facebook.buck.event.BuckEventBus)"], "created": "2014-06-06 13:09:12", "spoonStatsSummary": {"INS": 1, "spoonMethodsChanged": 1, "MOV": 1, "DEL": 0, "spoonFilesChanged": 1, "TOT": 2, "UPD": 0}, "commits": {"eeb8b90eaf25754d38d24cfc988314343e6b18db": {"commitGHEventType": "closed", "commitUser": "andrewjcg"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "JarDirectoryStep.java", "spoonMethods": [{"INS": 1, "MOV": 1, "DEL": 0, "UPD": 0, "TOT": 2, "spoonMethodName": "com.facebook.buck.java.JarDirectoryStep.copyZipEntriesToJar(java.io.File,com.facebook.buck.zip.CustomZipOutputStream,java.util.jar.Manifest,java.util.Set,com.facebook.buck.event.BuckEventBus)"}]}], "nameRev": "eeb8b90eaf25754d38d24cfc988314343e6b18db tags/v2015.09.10.01~3064", "commitUser": "andrewjcg", "commitHash": "eeb8b90eaf25754d38d24cfc988314343e6b18db", "commitDateTime": "2014-06-09 14:15:51", "commitMessage": "JavaDirectoryStep: only reset compressed size for deflated entries\n\nSummary:\nD984455 changed the ZipDirectoryStep to work around a rare bug which\ncaused zip exceptions when re-compressing the entry changed the\ncompressed size.  However, we should only do this for \"deflated\"\nzip entries, as \"stored\" zip entries require the compressed size\nto be equal to the uncompressed size (as documented at\nhttp://docs.oracle.com/javase/7/docs/api/java/util/zip/ZipEntry.html#getCompressedSize()).\n\nGitHub: fixes #132\n\nTest Plan:\nBuilt a java binary dependening on a prebuilt JAR with an embedded\nJAR \"stored\" entry.\n", "commitGitStats": [{"filePath": "src/com/facebook/buck/java/JarDirectoryStep.java", "deletions": 3, "lines": 17, "insertions": 14}], "commitParents": ["c6df48189aec754980f78a13a23da4849bdb75ec"], "authoredDateTime": "2014-06-09 11:44:44", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "In some cases the output of a java_binary is not a valid zip file.\n\nWith the following BUCK file, I'm building a spring boot app.\n\n```\njava_library(\n    name = 'example',\n    srcs = [\n        'Example.java',\n    ],\n    provided_deps = [\n        '//third_party/java/boot:spring-boot-deps',\n    ],\n)\n\njava_binary(\n    name = 'example_app',\n    deps = [\n        ':example',\n        '//third_party/java/boot:spring-boot',\n    ],\n    manifest_file = 'manifest',\n)\n```\n\nThe build is successful. However, when running `unzip -l example_app.jar` I got the following error with unzip 6.0.\n\n```\nArchive:  /home/skreft/java_test/buck-out/gen/java/src/com/deezer/research/boot/example_app.jar\n  Length      Date    Time    Name\n---------  ---------- -----   ----\n        0  2014-06-06 14:31   com/\n        0  2014-06-06 14:31   com/deezer/\n        0  2014-06-06 14:31   com/deezer/research/\n        0  2014-06-06 14:31   com/deezer/research/boot/\n     1009  2014-06-06 14:31   com/deezer/research/boot/Example.class\n        0  2014-06-06 11:12   META-INF/\n        0  2014-06-06 11:07   META-INF/maven/\n        0  2014-06-06 11:07   META-INF/maven/org.springframework/\n        0  2014-06-06 11:07   META-INF/maven/org.springframework/gs-spring-boot/\n     1948  2014-06-06 11:05   META-INF/maven/org.springframework/gs-spring-boot/pom.xml\n      119  2014-06-06 11:07   META-INF/maven/org.springframework/gs-spring-boot/pom.properties\n        0  2014-06-06 11:07   lib/\n*** buffer overflow detected ***: unzip terminated\n======= Backtrace: =========\n/lib/x86_64-linux-gnu/libc.so.6(+0x6ea2f)[0x7f90f7e58a2f]\n/lib/x86_64-linux-gnu/libc.so.6(__fortify_fail+0x37)[0x7f90f7ededd7]\n/lib/x86_64-linux-gnu/libc.so.6(+0xf3e50)[0x7f90f7edde50]\n/lib/x86_64-linux-gnu/libc.so.6(+0xf3359)[0x7f90f7edd359]\n/lib/x86_64-linux-gnu/libc.so.6(_IO_default_xsputn+0x89)[0x7f90f7e60079]\n/lib/x86_64-linux-gnu/libc.so.6(_IO_vfprintf+0xa6f)[0x7f90f7e3102f]\n/lib/x86_64-linux-gnu/libc.so.6(__vsprintf_chk+0x88)[0x7f90f7edd3e8]\n/lib/x86_64-linux-gnu/libc.so.6(__sprintf_chk+0x7d)[0x7f90f7edd33d]\nunzip[0x40ecc0]\nunzip[0x410d83]\nunzip[0x4114bf]\nunzip[0x403dd7]\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf5)[0x7f90f7e0bb45]\nunzip[0x402079]\n======= Memory map: ========\n00400000-00426000 r-xp 00000000 08:01 421151                             /usr/bin/unzip\n00625000-00626000 r--p 00025000 08:01 421151                             /usr/bin/unzip\n00626000-00627000 rw-p 00026000 08:01 421151                             /usr/bin/unzip\n00627000-00719000 rw-p 00000000 00:00 0 \n00f8d000-00fae000 rw-p 00000000 00:00 0                                  [heap]\n7f90f7bd4000-7f90f7be9000 r-xp 00000000 08:01 261674                     /lib/x86_64-linux-gnu/libgcc_s.so.1\n7f90f7be9000-7f90f7de9000 ---p 00015000 08:01 261674                     /lib/x86_64-linux-gnu/libgcc_s.so.1\n7f90f7de9000-7f90f7dea000 rw-p 00015000 08:01 261674                     /lib/x86_64-linux-gnu/libgcc_s.so.1\n7f90f7dea000-7f90f7f8a000 r-xp 00000000 08:01 261679                     /lib/x86_64-linux-gnu/libc-2.18.so\n7f90f7f8a000-7f90f818a000 ---p 001a0000 08:01 261679                     /lib/x86_64-linux-gnu/libc-2.18.so\n7f90f818a000-7f90f818e000 r--p 001a0000 08:01 261679                     /lib/x86_64-linux-gnu/libc-2.18.so\n7f90f818e000-7f90f8190000 rw-p 001a4000 08:01 261679                     /lib/x86_64-linux-gnu/libc-2.18.so\n7f90f8190000-7f90f8194000 rw-p 00000000 00:00 0 \n7f90f8194000-7f90f81a3000 r-xp 00000000 08:01 261637                     /lib/x86_64-linux-gnu/libbz2.so.1.0.4\n7f90f81a3000-7f90f83a2000 ---p 0000f000 08:01 261637                     /lib/x86_64-linux-gnu/libbz2.so.1.0.4\n7f90f83a2000-7f90f83a3000 r--p 0000e000 08:01 261637                     /lib/x86_64-linux-gnu/libbz2.so.1.0.4\n7f90f83a3000-7f90f83a4000 rw-p 0000f000 08:01 261637                     /lib/x86_64-linux-gnu/libbz2.so.1.0.4\n7f90f83a4000-7f90f83c4000 r-xp 00000000 08:01 261683                     /lib/x86_64-linux-gnu/ld-2.18.so\n7f90f8413000-7f90f859c000 r--p 00000000 08:01 393509                     /usr/lib/locale/locale-archive\n7f90f859c000-7f90f859f000 rw-p 00000000 00:00 0 \n7f90f85c0000-7f90f85c3000 rw-p 00000000 00:00 0 \n7f90f85c3000-7f90f85c4000 r--p 0001f000 08:01 261683                     /lib/x86_64-linux-gnu/ld-2.18.so\n7f90f85c4000-7f90f85c5000 rw-p 00020000 08:01 261683                     /lib/x86_64-linux-gnu/ld-2.18.so\n7f90f85c5000-7f90f85c6000 rw-p 00000000 00:00 0 \n7fff7803f000-7fff78060000 rw-p 00000000 00:00 0                          [stack]\n7fff781af000-7fff781b0000 r-xp 00000000 00:00 0                          [vdso]\nffffffffff600000-ffffffffff601000 r-xp 00000000 00:00 0                  [vsyscall]\n```\n\nNote that this can be considered an error in unzip (and I think it was fixed in the new version see https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=741384). However, there are other signs showing the generated jar may be invalid. If I run the generated file, I got a IndexOutOfBoundsException (probably because the loader foound something wrong) and if I manually generate the same example_app.jar I do not see any errors.\n", "title": "Invalid generated jar file", "closed": "2014-06-09 21:31:21", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/com/facebook/buck/java"], "gitStatsSummary": {"gitFilesChange": 1, "lines": 17, "deletions": 3, "insertions": 14}, "ttf": 3.000277777777778, "filteredCommits": ["eeb8b90eaf25754d38d24cfc988314343e6b18db"], "labels": ["bug"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/132", "user": "sk-"}, {"created": "2014-04-12 19:27:48", "closed": "2014-04-29 17:22:02", "commits": {}, "ttf": 16.00027777777778, "body": "$ git pull\n$ ant\n$ ./bin/buck build buck\n[-] PARSING BUILD FILES...FINISHED 0.2s\n[+] BUILDING...0.0s\njava.lang.AbstractMethodError\n    at com.facebook.buck.json.ProjectBuildFileParser.generatePathToBuckPy(ProjectBuildFileParser.java:354)\n    at com.facebook.buck.json.ProjectBuildFileParser.getPathToBuckPy(ProjectBuildFileParser.java:326)\n    at com.facebook.buck.json.ProjectBuildFileParser.buildArgs(ProjectBuildFileParser.java:181)\n    at com.facebook.buck.json.ProjectBuildFileParser.init(ProjectBuildFileParser.java:152)\n    at com.facebook.buck.json.ProjectBuildFileParser.initIfNeeded(ProjectBuildFileParser.java:143)\n    at com.facebook.buck.json.ProjectBuildFileParser.getAllRulesInternal(ProjectBuildFileParser.java:259)\n    at com.facebook.buck.json.ProjectBuildFileParser.getAllRulesAndMetaRules(ProjectBuildFileParser.java:249)\n    at com.facebook.buck.parser.Parser.parseBuildFile(Parser.java:561)\n    at com.facebook.buck.parser.Parser.parseBuildFilesForTargets(Parser.java:344)\n    at com.facebook.buck.cli.BuildCommand.runCommandWithOptionsInternal(BuildCommand.java:107)\n    at com.facebook.buck.cli.BuildCommand.runCommandWithOptionsInternal(BuildCommand.java:47)\n    at com.facebook.buck.cli.AbstractCommandRunner.runCommandWithOptions(AbstractCommandRunner.java:121)\n    at com.facebook.buck.cli.AbstractCommandRunner.runCommand(AbstractCommandRunner.java:101)\n    at com.facebook.buck.cli.Command.execute(Command.java:103)\n    at com.facebook.buck.cli.Main.executeCommand(Main.java:567)\n    at com.facebook.buck.cli.Main.runMainWithExitCode(Main.java:407)\n    at com.facebook.buck.cli.Main.tryRunMainWithExitCode(Main.java:788)\n    at com.facebook.buck.cli.Main.runMainThenExit(Main.java:807)\n    at com.facebook.buck.cli.Main.main(Main.java:818)\n\nTry again, now with ant clean:\n\n$ ant clean\n$ ant\n$ ./bin/buck build buck\n[-] PARSING BUILD FILES...FINISHED 3.3s\n[-] BUILDING...FINISHED 37.5s\nLog:\nNo Android platform target specified. Using default: Google Inc.:Google APIs:19\n\nsucceed/profit.\n", "title": "ant clean still necessary", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/104", "user": "tfarina"}, {"created": "2013-12-23 19:00:15", "closed": "2014-04-24 17:33:23", "commits": {}, "ttf": 121.00027777777778, "body": "When the \"buck\" command fails it always leaves a \"buck-out\" directory behind with some log files in it. This is fine for a broken build, but it's bad when you just ran \"buck\" in the wrong directory. To reproduce:\n\n```\n$ mkdir buck_out_test\n$ cd buck_out_test\n$ ls\n$ buck build app\nBUILD FAILED: No directory app when resolving target //app:app in context FULLY_QUALIFIED\n$ ls\nbuck-out\n```\n", "title": "Buck should avoid creating any output if it doesn't find a valid BUCK file", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/73", "user": "iainmerrick"}, {"created": "2013-12-23 18:52:16", "closed": "2015-06-05 19:01:57", "commits": {}, "ttf": 529.0002777777778, "body": "I created a BUCK file for some third-party code, and my android_resource rule failed with a weird error:\n\n```\nBUILD FAILED: [...]#dummy_r_dot_java failed on step android-res-merge with an exception:\njava.io.FileNotFoundException: buck-out/gen/[...]/__res_text_symbols__/R.txt (No such file or directory)\n```\n\nI eventually figured out that the \"res\" directory didn't contain any files! Surely this shouldn't be an error -- just create an empty R.txt file.\n\nIf it remains an error (or warning) then the error message should be made much clearer.\n", "title": "Empty resource directory gives confusing error message", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/72", "user": "iainmerrick"}, {"created": "2013-10-27 04:08:58", "closed": "2014-04-24 17:25:26", "commits": {}, "ttf": 179.00027777777777, "body": "$ ant\n# OK.\n\nThen:\n\n$ ./bin/buck build buck\n[+] PARSING BUILD FILES...1.4s\njava.lang.IncompatibleClassChangeError: Expecting non-static method com.facebook.buck.cli.BuildCommandOptions.findAndroidSdkDir()Lcom/google/common/base/Optional;\n    at com.facebook.buck.cli.BuildCommandOptions.createBuild(BuildCommandOptions.java:148)\n    at com.facebook.buck.cli.BuildCommand.runCommandWithOptionsInternal(BuildCommand.java:106)\n    at com.facebook.buck.cli.BuildCommand.runCommandWithOptionsInternal(BuildCommand.java:44)\n    at com.facebook.buck.cli.AbstractCommandRunner.runCommandWithOptions(AbstractCommandRunner.java:114)\n    at com.facebook.buck.cli.AbstractCommandRunner.runCommand(AbstractCommandRunner.java:94)\n    at com.facebook.buck.cli.Command.execute(Command.java:104)\n    at com.facebook.buck.cli.Main.runMainWithExitCode(Main.java:392)\n    at com.facebook.buck.cli.Main.tryRunMainWithExitCode(Main.java:571)\n    at com.facebook.buck.cli.Main.runMainThenExit(Main.java:588)\n[-] PARSING BUILD FILES...FINISHED 1.4s\n[+] BUILDING...0.1s\n", "title": "buck doesn't build for me", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/62", "user": "tfarina"}, {"created": "2013-10-06 19:51:04", "closed": "2014-05-02 20:40:51", "commits": {}, "ttf": 208.00027777777777, "body": "I was running \"ant test\" under FreeBSD with `LANG` set to `pl_PL.UTF-8` (which has comma as the decimal separator), and this fails:\n\n```\n    [junit] Testcase: testSimpleBuild took 0,008 sec\n    [junit]     FAILED\n    [junit] expected:<...D FILES...FINISHED 0[.]4s\n    [junit] > but was:<...D FILES...FINISHED 0[,]4s\n    [junit] >\n    [junit] junit.framework.AssertionFailedError: expected:<...D FILES...FINISHED 0[.]4s\n    [junit] > but was:<...D FILES...FINISHED 0[,]4s\n    [junit] >\n    [junit]     at com.facebook.buck.event.listener.SimpleConsoleEventBusListenerTest.testSimpleBuild(SimpleConsoleEventBusListenerTest.java:89)\n    [junit] \n    [junit] TEST com.facebook.buck.event.listener.SimpleConsoleEventBusListenerTest FAILED\n    [junit] Testsuite: com.facebook.buck.event.listener.SuperConsoleEventBusListenerTest\n    [junit] Tests run: 1, Failures: 1, Errors: 0, Time elapsed: 0,022 sec\n    [junit] \n    [junit] Testcase: testSimpleBuild took 0,012 sec\n    [junit]     FAILED\n    [junit] expected:<[[+] PARSING BUILD FILES...0.3s]> but was:<[[+] PARSING BUILD FILES...0,3s]>\n    [junit] junit.framework.AssertionFailedError: expected:<[[+] PARSING BUILD FILES...0.3s]> but was:<[[+] PARSING BUILD FILES...0,3s]>\n    [junit]     at com.facebook.buck.event.listener.SuperConsoleEventBusListenerTest.validateConsole(SuperConsoleEventBusListenerTest.java:199)\n    [junit]     at com.facebook.buck.event.listener.SuperConsoleEventBusListenerTest.testSimpleBuild(SuperConsoleEventBusListenerTest.java:85)\n    [junit] \n    [junit] TEST com.facebook.buck.event.listener.SuperConsoleEventBusListenerTest FAILED\n```\n", "title": "`SuperConsoleEventBusListenerTest` fails because of OS decimal separator setting", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/58", "user": "saper"}, {"created": "2013-07-24 22:00:21", "closed": "2015-02-02 15:54:02", "commits": {}, "ttf": 557.0002777777778, "body": "Commit 2aa814be5a646e5cd8c0480bb68e20007b5df4e7 broke java_library() using a resource from genfile() when the BUCK file is not in the Java package path.\n\n```cat >BUCK\ngenrule(\n  name = 'gen',\n  cmd = 'mkdir -p $(dirname $OUT);echo foo>$OUT',\n  deps = [],\n  out = 'resources/com/example/foo.properties',\n)\njava_library(\n  name = 'lib',\n  resources = [genfile('resources/com/example/foo.properties')],\n  deps = [':gen'],\n)\n\n$ buck build :lib\n$ jar tf buck-out/gen/lib__lib__output/lib.jar \nfoo.properties\nMETA-INF/MANIFEST.MF\n\n```\n\nI expected to see com/example/foo.properties.\n```\n", "title": "java_library() breaks package path when resource is genfile()", "commitsDetails": [], "labels": ["bug", "enhancement"], "url": "https://github.com/facebook/buck/issues/41", "user": "spearce"}, {"created": "2013-07-01 03:47:25", "spoonStatsSummary": {}, "commits": {"ffa99667422b1601d8caecbd213002b13c7ae53d": {"commitGHEventType": "closed", "commitUser": "andrewjcg"}}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "ffa99667422b1601d8caecbd213002b13c7ae53d tags/v2015.09.10.01~3063", "commitUser": "andrewjcg", "commitHash": "ffa99667422b1601d8caecbd213002b13c7ae53d", "commitDateTime": "2014-06-09 14:16:57", "commitMessage": "Properly quote variables in bash scripts\n\nSummary:\nThis fixes one of the problems described in issue #38 on GitHub,\nwhere a project directory with spaces was exposing a lot of misquoted\nvariables in our bash wrapper scripts.\n\nGitHub: Fixes #38\n\nTest Plan:\n  mkdir \"/var/tmp/path with spaces\"\n  cd \"/var/tmp/path with spaces\"\n  touch .buckconfig\n  touch BUCK\n  buck targets\n", "commitGitStats": [{"filePath": "bin/buck_common", "deletions": 87, "lines": 174, "insertions": 87}, {"filePath": "bin/buckd", "deletions": 16, "lines": 32, "insertions": 16}, {"filePath": "bin/buck", "deletions": 5, "lines": 10, "insertions": 5}], "commitParents": ["eeb8b90eaf25754d38d24cfc988314343e6b18db"], "authoredDateTime": "2014-06-09 11:45:29", "spoonStatsSkippedReason": "", "commitGHEventType": "closed"}], "body": "```\n aylott in ~/Projects/Design Tools/foo\n\u00b1 |master \u2713| \u2192 buck targets\nError: Could not find or load main class Tools.foo..buckd\n```\n", "title": "Buck cannot handle paths with spaces", "closed": "2014-06-09 21:31:21", "filteredCommitsReason": {"duplicated": 0, "mergeCommitUsed": 0, "alsoFixesPhrase": 0, "multipleIssueFixes": 0, "moreThanOneParent": 0, "unavailable": 0}, "statsSkippedReason": "", "changesInPackagesGIT": ["bin/buckd", "bin/buck", "bin/buck_common"], "gitStatsSummary": {"gitFilesChange": 3, "lines": 216, "deletions": 108, "insertions": 108}, "ttf": 343.0002777777778, "filteredCommits": ["ffa99667422b1601d8caecbd213002b13c7ae53d"], "labels": ["bug", "enhancement"], "numCommits": 1, "url": "https://github.com/facebook/buck/issues/38", "user": "subtleGradient"}, {"created": "2013-06-04 14:12:48", "closed": "2014-11-20 00:33:15", "commits": {}, "ttf": 533.0002777777778, "body": "This sporadically fails on my Mac OS 10.8.3 system when the project directory is inside of a path named \"Git\":\n\n```\n$ mkdir -p Git/buck_test ; cd Git/buck_test ; git init\n$ mkdir -p data/src/ ; touch data/src/foo\n$ cat >data/BUCK\ngenrule(\n  name = 'test',\n  cmd = 'cd $SRCDIR/src; zip -qr $OUT .',\n  srcs = glob(['src/**/*']),\n  deps = [],\n  out = 'test.zip',\n)\n$ buck build data:test\n```\n\nBuck fails with a lowercase path appearing in the output:\n\n``````\n$ buck build data:test\nBUILDING //data:test\n/bin/bash: line 0: cd: /Users/sop/git/buck_test/buck-out/gen/data/test__srcs/src: No such file or directory\nBUILD FAILED: //data:test failed on step \"genrule: cd $SRCDIR/src; zip -qr $OUT .\" with exit code 1```\n``````\n\nLooking at the gen tree the path within the project is repeated inside of $SRCDIR and should not have:\n\n```\n$ ls buck-out/gen/data/test__srcs/data/src/\nfoo\n```\n\nI can't consistently reproduce this failure, but once it happens, it happens continuously until I delete the directory and recreate it.\n\nI suspect there is something wrong with the absolute path handling in Buck. If Buck samples the path as \"/Users/sop/git/buck_test\" and another function gives it \"/Users/sop/Git/buck_test\" obviously the prefix is not the same and Buck now is unable to generate the correct number of directories to process when writing $SRCDIR.\n\nI wonder if there is something related to the difference in absolute and canonical path:\n\n```\n$ cat >Resolve.java <<EOF\npublic class Resolve {\npublic static void main(String[] argv) throws Exception {\nSystem.out.println(\"abs = \" + new java.io.File(argv[0]).getAbsolutePath());\nSystem.out.println(\"can = \" + new java.io.File(argv[0]).getCanonicalPath());\n}}\nEOF\n$ javac Resolve.java\n\n$ pwd\n/Users/sop/Git/gerrit_next\n\n$ java -cp . Resolve .\nabs = /Users/sop/git/gerrit_next/.\ncan = /Users/sop/Git/gerrit_next\n```\n\nand the Mac OS process environment just manages to get itself confused.\n", "title": "genrule() sometimes creates incorrect $SRCDIR on Mac OS X", "commitsDetails": [], "labels": ["bug", "enhancement"], "url": "https://github.com/facebook/buck/issues/35", "user": "spearce"}, {"created": "2013-05-29 00:43:13", "closed": "2013-07-09 13:55:29", "commits": {}, "ttf": 41.000277777777775, "body": "I am trying to upgrade our build to f158d62ccc20ab9cc2cc27733c94235b8c27d742 + my patches so we can start using buckd. In doing so I discovered outputs are now going to buck-gen rather than buck-out/gen. OK fine, but `buck clean` should remove buck-gen.\n", "title": "buck build creates buck-{bin,gen} but buck clean does not delete them", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/30", "user": "spearce"}, {"created": "2013-05-21 23:39:39", "closed": "2013-05-23 16:44:17", "commits": {}, "ttf": 1.0002777777777778, "body": "## I followed the directions for the code sample in Buck Quick Start and everything went well until I ran \"buck install //apps/myapp:app\" for which the result was:\n\nFP143:my-first-buck-project jeromegarcia$ buck install //apps/myapp:app\nBUILDING //apps/myapp:app\njava.io.IOException: Cannot run program \"/Users/jeromegarcia/android-sdk-macosx/build-tools/17.0.0/aapt\" (in directory \".\"): error=2, No such file or directory\n    at java.lang.ProcessBuilder.start(ProcessBuilder.java:470)\n    at com.facebook.buck.shell.ShellStep.execute(ShellStep.java:138)\n    at com.facebook.buck.step.DefaultStepRunner.runStepInternal(DefaultStepRunner.java:79)\n    at com.facebook.buck.step.DefaultStepRunner.runStepForBuildTarget(DefaultStepRunner.java:68)\n    at com.facebook.buck.rules.AbstractCachingBuildRule$3.call(AbstractCachingBuildRule.java:434)\n    at com.facebook.buck.rules.AbstractCachingBuildRule$3.call(AbstractCachingBuildRule.java:421)\n    at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)\n    at java.util.concurrent.FutureTask.run(FutureTask.java:138)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)\n    at java.lang.Thread.run(Thread.java:680)\nCaused by: java.io.IOException: error=2, No such file or directory\n    at java.lang.UNIXProcess.forkAndExec(Native Method)\n    at java.lang.UNIXProcess.<init>(UNIXProcess.java:53)\n    at java.lang.ProcessImpl.start(ProcessImpl.java:91)\n    at java.lang.ProcessBuilder.start(ProcessBuilder.java:452)\n    ... 10 more\n## BUILD FAILED: //apps/myapp:app failed on step \"aapt package -J buck-out/bin/apps/myapp/**app_uber_rdotjava_src**\" with exit code 1\n\nI tried various approaches such as creating symbolic links to my Android platform-tools directory which contains aapt, adb, etc. to even copying the entire contents of the platform-tools directory into a \"../build-tools/17.0.0\" directory I created but they all failed. Has someone else encountered this problem and found a solution?\n\nThanks,\nJerome E. Garcia\n", "title": "Cannot run aapt", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/26", "user": "jeromeernestgarcia"}, {"created": "2013-05-16 04:32:00", "closed": "2013-05-23 16:44:04", "commits": {}, "ttf": 7.000277777777778, "body": "Google just updated their buildtools and moved the locations of tools buck is looking for.\n", "title": "Buck doesn't work with Android Build Tools 22", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/24", "user": "rowillia"}, {"created": "2013-05-09 06:04:40", "closed": "2013-07-24 04:05:50", "commits": {}, "ttf": 75.00027777777778, "body": "On a moderately complex project (45 BUCK and defs files, 2230 lines of definition \"code\") the introduction of Jython in 57593156 has added over 3.5 seconds of latency to a no-op build of a moderately complicated target.\n# master\n\n$ time buck build gerrit-gwtui:ui_chrome\nreal    0m7.474s\nuser    0m14.332s\nsys 0m0.710s\n# with 575931561c61e82e477eecb2f0ffe8400bf2fc39 reverted:\n\n$ time buck build gerrit-gwtui:ui_chrome\nreal    0m3.769s\nuser    0m4.236s\nsys 0m0.735s\n\nNot shelling out is nice, but startup time seems to have been very negatively impacted.\n", "title": "Jython has slowed down no-op incrementals", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/18", "user": "spearce"}, {"created": "2013-05-09 01:32:45", "closed": "2013-05-23 15:26:31", "commits": {}, "ttf": 14.000277777777777, "body": "$ echo 'java_library(name=\"foo\",resources=glob(['src/**']))' >BUCK\n$ buck build :foo\nException in thread \"pool-1-thread-1\" java.lang.RuntimeException: javax.script.ScriptException: SyntaxError: no viable alternative at input '**' in /Users/sop/git/buck_bugs/././BUCK at line number 1 at column number 44\n    at com.google.common.base.Throwables.propagate(Throwables.java:160)\n    at com.facebook.buck.json.BuildFileToJsonParser$BuildFileRunner.run(BuildFileToJsonParser.java:189)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)\n    at java.lang.Thread.run(Thread.java:680)\nCaused by: javax.script.ScriptException: SyntaxError: no viable alternative at input '**' in /Users/sop/git/buck_bugs/././BUCK at line number 1 at column number 44\n    at org.python.jsr223.PyScriptEngine.scriptException(PyScriptEngine.java:190)\n    at org.python.jsr223.PyScriptEngine.eval(PyScriptEngine.java:42)\n    at org.python.jsr223.PyScriptEngine.eval(PyScriptEngine.java:31)\n    at javax.script.AbstractScriptEngine.eval(AbstractScriptEngine.java:247)\n    at com.facebook.buck.json.BuildFileToJsonParser$BuildFileRunner.run(BuildFileToJsonParser.java:186)\n    ... 3 more\nCaused by: Traceback (most recent call last):\n  File \"<script>\", line 6, in <module>\n  File \"/Users/sop/git/buck/src/com/facebook/buck/parser/buck.py\", line 669, in main\n    execfile(os.path.join(project_root, build_file), build_env['BUILD_FILE_SYMBOL_TABLE'])\n  File \"/Users/sop/git/buck_bugs/././BUCK\", line 1\n    java_library(name=\"foo\",resources=glob([src/**]))\n                                               ^\nSyntaxError: no viable alternative at input '**'\n\n```\nat org.python.core.PyException.fillInStackTrace(PyException.java:70)\nat java.lang.Throwable.<init>(Throwable.java:181)\nat java.lang.Exception.<init>(Exception.java:29)\nat java.lang.RuntimeException.<init>(RuntimeException.java:32)\nat org.python.core.PyException.<init>(PyException.java:46)\nat org.python.core.PyException.<init>(PyException.java:43)\nat org.python.core.PyException.<init>(PyException.java:39)\nat org.python.core.PySyntaxError.<init>(PySyntaxError.java:22)\nat org.python.core.ParserFacade.fixParseError(ParserFacade.java:92)\nat org.python.core.ParserFacade.parse(ParserFacade.java:184)\nat org.python.core.Py.compile_flags(Py.java:1731)\nat org.python.core.__builtin__.execfile_flags(__builtin__.java:514)\nat org.python.core.__builtin__.execfile(__builtin__.java:499)\nat org.python.core.__builtin__.execfile(__builtin__.java:526)\nat org.python.core.BuiltinFunctions.__call__(__builtin__.java:155)\nat org.python.core.PyObject.__call__(PyObject.java:408)\nat buck$py.main$35(/Users/sop/git/buck/src/com/facebook/buck/parser/buck.py:654)\nat buck$py.call_function(/Users/sop/git/buck/src/com/facebook/buck/parser/buck.py)\nat org.python.core.PyTableCode.call(PyTableCode.java:165)\nat org.python.core.PyBaseCode.call(PyBaseCode.java:120)\nat org.python.core.PyFunction.__call__(PyFunction.java:307)\nat org.python.pycode._pyx0.f$0(<script>:6)\nat org.python.pycode._pyx0.call_function(<script>)\nat org.python.core.PyTableCode.call(PyTableCode.java:165)\nat org.python.core.PyCode.call(PyCode.java:18)\nat org.python.core.Py.runCode(Py.java:1275)\nat org.python.core.__builtin__.eval(__builtin__.java:484)\nat org.python.core.__builtin__.eval(__builtin__.java:488)\nat org.python.util.PythonInterpreter.eval(PythonInterpreter.java:198)\nat org.python.jsr223.PyScriptEngine.eval(PyScriptEngine.java:40)\n... 6 more\n```\n\nBUILD FAILED: No rule found when resolving target //:foo in build file //BUCK\n", "title": "glob(['src/**']) crashes with ugly jython stack trace", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/17", "user": "spearce"}, {"created": "2013-05-02 14:32:34", "closed": "2013-05-07 00:30:51", "commits": {}, "ttf": 4.000277777777778, "body": "I know I should have listed ':bin' in the deps of the genrule(). If I happen to forget, but says its an internal buck bug.\n\necho '\njava_library(name=\"lib\", srcs=[\"Hello.java\"])\njava_binary(name=\"bin\", deps=[\":lib\"], main_class=\"Hello\")\ngenrule(\n  name=\"hi\",\n  cmd=\"${:bin}>$OUT\",\n  srcs=[],\n  deps=[],\n  out=\"hi.txt\",\n)'>BUCK\n\necho '\npublic class Hello {\npublic static void main(String[] a) {\nSystem.out.println(\"Hi\");\n}\n}'>Hello.java\n\nANDROID_SDK=/tmp buck build :hi\nBUILDING //:hi\njava.util.concurrent.ExecutionException: java.lang.RuntimeException: No dep named //:bin in ${:bin}>$OUT\n    at com.google.common.util.concurrent.AbstractFuture$Sync.getValue(AbstractFuture.java:306)\n    at com.google.common.util.concurrent.AbstractFuture$Sync.get(AbstractFuture.java:293)\n    at com.google.common.util.concurrent.AbstractFuture.get(AbstractFuture.java:116)\n    at com.facebook.buck.cli.BuildCommand.executeBuildAndPrintAnyFailuresToConsole(BuildCommand.java:140)\n,,,\nBUILD FAILED: Unexpected internal error (this is probably a buck bug).\n", "title": "missing dep on genrule() claims its a buck bug", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/14", "user": "spearce"}, {"created": "2013-04-30 21:09:36", "closed": "2014-05-02 21:20:56", "commits": {}, "ttf": 367.0002777777778, "body": "echo '[java]\n  src_roots = resources' >.buckconfig\nmkdir -p src/main/resources; echo msg=hi>src/main/resources/one.properties\nmkdir src/main/resources/pkg; echo msg=hi>src/main/resources/pkg/two.properties\necho 'java_library(name='test', resources=glob(['src/main/resources/*_/_']))' >BUCK\nbuck build :test\n\n$ jar tf buck-out/gen/lib__test__output/test.jar\npkg/two.properties\nsrc/main/resources/one.properties\nMETA-INF/MANIFEST.MF\n\nI expected to have one.properties, not src/main/resources/one.properties in the output JAR.\n", "title": "src_roots only honored for resources within a package", "commitsDetails": [], "labels": ["bug"], "url": "https://github.com/facebook/buck/issues/11", "user": "spearce"}], "projectName": "facebook/buck", "captureTime": "Sat Jul  4 12:20:04 2020"}