{"projectName": "apache/pulsar", "bugLabels": ["type/bug"], "captureTime": "Sat Jul  4 00:39:03 2020", "issues": [{"title": "Proxy tries connect unavailable broker", "body": "**Describe the bug**\r\nNot sure if it's a bug or a feature required.\r\n\r\nWe are working on rust client (`pulsar-rs`), we implemented a reconnecting feature when loosing connection. It works well when proxy restarts.\r\n\r\nThe problem is on broker restart/unavailable, proxy tries to connect to broker and get `Connection refused` because broker is not ready.\r\n\r\n```\r\n\"org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: io.netty.channel.AbstractChannel$AnnotatedConnectException: finishConnect(..) failed: Connection refused: yo-pulsar-c1-n2/192.168.10.11:2004\"\r\n````\r\n\r\nProxy should responds custom error indicating that broker is booting.\r\n\r\nWDYT? Maybe I'm wrong on how it works, in that case can you explain me how proxy or service discovery handle this case.\r\n", "url": "https://github.com/apache/pulsar/issues/7399", "user": "KannarFr", "labels": ["type/bug"], "created": "2020-06-30 15:34:32", "closed": "2020-07-01 15:13:27", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Pulsar Manager docker image doesn't start PostGreSQL", "body": "**Describe the bug**\r\nStarting the Pulsar Manager Docker image results in errors when trying to start PostGreSQL server.\r\nAfter a while it reports lots of chown errors:\r\n\r\n> Starting PostGreSQL Server\r\nchown: /data/Pictures/Photos Library.photoslibrary: Operation not permitted\r\n\r\n**To Reproduce**\r\ndocker run -it -p 9527:9527 -e REDIRECT_HOST=http://192.168.0.104 -e REDIRECT_PORT=9527 -e DRIVER_CLASS_NAME=org.postgresql.Driver -e URL='jdbc:postgresql://127.0.0.1:5432/pulsar_manager' -e USERNAME=pulsar -e PASSWORD=pulsar -e LOG_LEVEL=DEBUG -v $PWD:/data apachepulsar/pulsar-manager:v0.1.0 /bin/sh\r\n\r\n**Expected behavior**\r\nPulsar Manager to be up and running.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: iOS\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/7383", "user": "ErikJansenIRefact", "labels": ["type/bug"], "created": "2020-06-29 07:31:27", "closed": "2020-06-29 07:52:14", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Grant permission on namespace successfully when disabling authorization", "body": "**Describe the bug**\r\n\r\nUsing the master code, grant permission on namespace successfully when disabling authorization. I am not sure it is correct or not.\r\n\r\nUsing version 2.5.2 of  Pulsar, it will throw an error:\r\n\r\n```\r\n bin/pulsar-admin namespaces grant-permission public/default --actions produce --role admin\r\nAuthorization is not enabled\r\n\r\nReason: HTTP 501 Not Implemented\r\n```", "url": "https://github.com/apache/pulsar/issues/7343", "user": "zymap", "labels": ["type/bug"], "created": "2020-06-23 14:38:58", "closed": "2020-06-24 01:17:40", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "SchemaParseException", "body": "**Describe the bug**\r\nCreate a producer with a schema from a pojo class returns a schema parse exception\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a class LineItem:\r\npublic class LineItem {\r\n    public int orderNbr;\r\n    public int partNbr;\r\n    public int supplierNbr;\r\n    public int lineNbr;\r\n    public Double quantity;\r\n    public Double extendedPrice;\r\n    public Double discount;\r\n    public String shipDate;\r\n    public String comment;\r\n}\r\n2. Create a new producer with an Avro schema from the LineItem class\r\n\r\nProducer<LineItem> producer = client.newProducer(Schema.AVRO(LineItem.class))\r\n.topic(topicName)\r\n\r\n3. Expected a new producer but an exception is thrown instead:\r\n\r\nException in thread \u201cmain\u201d org.apache.pulsar.shade.org.apache.avro.SchemaParseException: Illegal character in: this$0\r\n        at org.apache.pulsar.shade.org.apache.avro.Schema.validateName(Schema.java:1532)\r\n        at org.apache.pulsar.shade.org.apache.avro.Schema.access$400(Schema.java:87)\r\n        at org.apache.pulsar.shade.org.apache.avro.Schema$Field.<init>(Schema.java:520)\r\n        at org.apache.pulsar.shade.org.apache.avro.Schema$Field.<init>(Schema.java:559)\r\n        at org.apache.pulsar.shade.org.apache.avro.reflect.ReflectData.createSchema(ReflectData.java:630)\r\n        at org.apache.pulsar.shade.org.apache.avro.specific.SpecificData$3.computeValue(SpecificData.java:335)\r\n        at org.apache.pulsar.shade.org.apache.avro.specific.SpecificData$3.computeValue(SpecificData.java:332)\r\n        at java.lang.ClassValue.getFromHashMap(ClassValue.java:227)\r\n        at java.lang.ClassValue.getFromBackup(ClassValue.java:209)\r\n        at java.lang.ClassValue.get(ClassValue.java:115)\r\n        at org.apache.pulsar.shade.org.apache.avro.specific.SpecificData.getSchema(SpecificData.java:346)\r\n        at org.apache.pulsar.client.impl.schema.StructSchema.extractAvroSchema(StructSchema.java:174)\r\n        at org.apache.pulsar.client.impl.schema.StructSchema.createAvroSchema(StructSchema.java:161)\r\n        at org.apache.pulsar.client.impl.schema.StructSchema.parseSchemaInfo(StructSchema.java:187)\r\n        at org.apache.pulsar.client.impl.schema.JSONSchema.of(JSONSchema.java:96)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.lang.reflect.Method.invoke(Method.java:498)\r\n        at org.apache.pulsar.client.internal.DefaultImplementation.lambda$newJSONSchema$26(DefaultImplementation.java:242)\r\n        at org.apache.pulsar.client.internal.ReflectionUtils.catchExceptions(ReflectionUtils.java:35)\r\n        at org.apache.pulsar.client.internal.DefaultImplementation.newJSONSchema(DefaultImplementation.java:239)\r\n        at org.apache.pulsar.client.api.Schema.JSON(Schema.java:260)\r\n        at CsvExample.createProducer(CsvExample.java:139)\r\n        at CsvExample.sendMessages(CsvExample.java:44)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/7333", "user": "ErikJansenIRefact", "labels": ["component/schemaregistry", "triage/week-26", "type/bug"], "created": "2020-06-22 08:43:08", "closed": "2020-06-25 12:10:07", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "Broken links for pulsar-io-jdbc-2.6.0.nar.* on download page", "body": "The links for pulsar-io-jdbc-2.6.0.nar are broken.", "url": "https://github.com/apache/pulsar/issues/7313", "user": "sebbASF", "labels": ["component/website", "triage/week-26", "type/bug"], "created": "2020-06-19 09:47:29", "closed": "2020-06-26 00:02:09", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "Pulsar build failed", "body": "**Describe the bug**\r\nError in - Building Pulsar Shaded Broker 2.7.0-SNAPSHOT                    [41/137] \r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Clone the repository \r\n2. mvn install -DskipTests -e\r\n3. See error\r\n\r\n**Expected behavior**\r\nBuild successful \r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - Apache Maven 3.6.0                                                                                                                                    \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7Maven home: /usr/share/maven                                                                                                                          \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7Java version: 11.0.7, vendor: Ubuntu, runtime: /usr/lib/jvm/java-11-openjdk-amd64                                                                     \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7Default locale: en, platform encoding: UTF-8                                                                                                          \u2502\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7OS name: \"linux\", version: \"5.3.0-1028-azure\", arch: \"amd64\", family: \"unix\"     \r\n\r\n**Logs**\r\n[errors.log](https://github.com/apache/pulsar/files/4800322/errors.log)\r\n", "url": "https://github.com/apache/pulsar/issues/7307", "user": "sundar-10", "labels": ["component/build", "triage/week-25", "type/bug"], "created": "2020-06-18 17:58:06", "closed": "2020-06-19 08:14:58", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[pulsar-admin] weird error on wrong command", "body": "Pulsar 2.5.2\r\nIf the run \"pulsar-admin namespaces list\" and by mistake give it a tenant/ns instead of just tenant I get the following error, and it takes some time to figure out what the problem is. Some input validation would help here.\r\n\r\n> pulsar-admin namespaces list tenant/ns\r\nnull\r\n\r\nReason: javax.ws.rs.client.ResponseProcessingException: com.fasterxml.jackson.databind.exc.MismatchedInputException: Cannot deserialize instance of `java.util.ArrayList<java.lang.Object>` out of START_OBJECT token\r\n at [Source: (org.glassfish.jersey.message.internal.ReaderInterceptorExecutor$UnCloseableInputStream); line: 1, column: 1]\r\n", "url": "https://github.com/apache/pulsar/issues/7301", "user": "trexinc", "labels": ["help wanted", "triage/week-25", "type/bug"], "created": "2020-06-18 13:10:43", "closed": "2020-07-02 04:50:01", "commits": {"2b94d02eee58f960cf296ebd97fe57a8364ae793": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 13.000277777777777, "commitsDetails": [{"commitHash": "2b94d02eee58f960cf296ebd97fe57a8364ae793", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["9423abfe32bfa83cb1bae568d8250c663e6f2738"], "nameRev": "2b94d02eee58f960cf296ebd97fe57a8364ae793 master~11", "commitMessage": "Add tenant name check in list namespaces function. (#7369)\n\nfix [https://github.com/apache/pulsar/issues/7301](https://github.com/apache/pulsar/issues/7301)", "commitDateTime": "2020-07-01 21:50:00", "authoredDateTime": "2020-07-02 12:50:00", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java", "insertions": 9, "deletions": 8, "lines": 17}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/NamespacesTest.java", "insertions": 10, "deletions": 5, "lines": 15}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NamespacesBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.NamespacesBase.internalGetTenantNamespaces(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NamespacesTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.NamespacesTest.testGetNamespaces()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["2b94d02eee58f960cf296ebd97fe57a8364ae793"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 9, "deletions": 8, "lines": 17, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl"], "changesInPackagesSPOON": ["org.apache.pulsar.broker.admin.impl.NamespacesBase.internalGetTenantNamespaces(java.lang.String)"]}, {"title": "pulsar-admin topics delete-partitioned-topic always gives HTTP 401 Unauthorized", "body": "Pulsar 2.5.2\r\nCan't delete a partitioned topic, I use pulsar-client over TLS with super-user client certificate. I can delete regular topics and the partitions themselves.\r\n\r\nbin/pulsar-admin topics delete-partitioned-topic internal/test/test\r\n19:07:57.412 [AsyncHttpClient-5-1] WARN  org.apache.pulsar.client.admin.internal.BaseResource - [https://pulsar-admin-proxy:8443/admin/v2/persistent/internal/test/test/partitions?force=false] Failed to perform http delete request: javax.ws.rs.NotAuthorizedException: HTTP 401 Unauthorized\r\nHTTP 401 Unauthorized\r\n\r\nReason: HTTP 401 Unauthorized\r\n", "url": "https://github.com/apache/pulsar/issues/7292", "user": "trexinc", "labels": ["component/broker", "triage/week-25", "type/bug"], "created": "2020-06-17 19:16:24", "closed": "2020-06-23 08:47:11", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "Not able to start Pulsar in Standalone mode with Functions-Worker", "body": "**Describe the bug**\r\nI am trying to run a pulsar producer using java client that writes data to the standalone pulsar. I have run the pulsar using the following command:\r\n```\r\nbin/pulsar standalone\r\n```\r\nWhen I was writing the data with TLS encryption, it was working fine. But after I tried the TLS authentication configuration, I am getting the following error in my client logs:\r\n\r\n```\r\n09:08:35.261 [AsyncHttpClient-80-1] WARN  org.apache.pulsar.client.admin.internal.BaseResource - [http://localhost:8080/admin/v2/persistent/public/functions/assignments] Failed to perform http put request: javax.ws.rs.NotAuthorizedException: HTTP 401 Unauthorized\r\n09:08:35.273 [main] ERROR org.apache.pulsar.functions.worker.WorkerService - Error Starting up in worker\r\norg.apache.pulsar.client.admin.PulsarAdminException$NotAuthorizedException: HTTP 401 Unauthorized\r\n\tat org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:212) ~[org.apache.pulsar-pulsar-client-admin-original-2.5.0.jar:2.5.0]\r\n\tat org.apache.pulsar.client.admin.internal.BaseResource$1.failed(BaseResource.java:130) ~[org.apache.pulsar-pulsar-client-admin-original-2.5.0.jar:2.5.0]\r\n\tat org.glassfish.jersey.client.JerseyInvocation$4.failed(JerseyInvocation.java:1030) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.JerseyInvocation$4.completed(JerseyInvocation.java:1017) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.ClientRuntime.processResponse(ClientRuntime.java:227) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.ClientRuntime.access$200(ClientRuntime.java:85) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.ClientRuntime$2.lambda$response$0(ClientRuntime.java:178) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:316) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:298) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:312) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.ClientRuntime$2.response(ClientRuntime.java:178) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector$3.onCompleted(AsyncHttpConnector.java:243) ~[org.apache.pulsar-pulsar-client-admin-original-2.5.0.jar:2.5.0]\r\n\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector$3.onCompleted(AsyncHttpConnector.java:234) ~[org.apache.pulsar-pulsar-client-admin-original-2.5.0.jar:2.5.0]\r\n\tat org.asynchttpclient.AsyncCompletionHandler.onCompleted(AsyncCompletionHandler.java:66) ~[org.asynchttpclient-async-http-client-2.7.0.jar:?]\r\n\tat org.asynchttpclient.netty.NettyResponseFuture.loadContent(NettyResponseFuture.java:222) ~[org.asynchttpclient-async-http-client-2.7.0.jar:?]\r\n\tat org.asynchttpclient.netty.NettyResponseFuture.done(NettyResponseFuture.java:257) ~[org.asynchttpclient-async-http-client-2.7.0.jar:?]\r\n\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.finishUpdate(AsyncHttpClientHandler.java:241) ~[org.asynchttpclient-async-http-client-2.7.0.jar:?]\r\n\tat org.asynchttpclient.netty.handler.HttpHandler.handleChunk(HttpHandler.java:113) ~[org.asynchttpclient-async-http-client-2.7.0.jar:?]\r\n\tat org.asynchttpclient.netty.handler.HttpHandler.handleRead(HttpHandler.java:142) ~[org.asynchttpclient-async-http-client-2.7.0.jar:?]\r\n\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.channelRead(AsyncHttpClientHandler.java:78) ~[org.asynchttpclient-async-http-client-2.7.0.jar:?]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:352) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:102) ~[io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:352) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:438) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:326) ~[io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:300) ~[io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:253) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:352) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1422) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:931) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:700) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:635) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:552) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:514) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$6.run(SingleThreadEventExecutor.java:1050) ~[io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) ~[?:1.8.0_242]\r\nCaused by: javax.ws.rs.NotAuthorizedException: HTTP 401 Unauthorized\r\n\tat org.glassfish.jersey.client.JerseyInvocation.convertToException(JerseyInvocation.java:1080) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.JerseyInvocation.access$700(JerseyInvocation.java:99) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\t... 47 more\r\n```\r\nHowever, when I tried with the following command the standalone pulsar works:\r\n```\r\nbin/pulsar standalone -nfw -nss\r\n```\r\nBut why is it not working with `functions worker` ?\r\n\r\n**To Reproduce**\r\nI have followed the following link for creating tls certificates : http://pulsar.apache.org/docs/en/security-tls-transport/\r\n\r\n`standalone.conf`:\r\n```\r\ntlsEnabled=true\r\ntlsCertRefreshCheckDurationSec=300\r\ntlsCertificateFilePath=/home/Downloads/my-ca/broker.cert.pem\r\ntlsKeyFilePath=/home/Downloads/my-ca/broker.key-pk8.pem\r\ntlsTrustCertsFilePath=/home/Downloads/my-ca/certs/ca.cert.pem\r\nauthenticationEnabled=true\r\nauthenticationProviders=org.apache.pulsar.broker.authentication.AuthenticationProviderTls\r\nauthorizationEnabled=false\r\nauthorizationProvider=org.apache.pulsar.broker.authorization.PulsarAuthorizationProvider\r\nauthorizationAllowWildcardsMatching=false\r\nsuperUserRoles=admin\r\nbrokerClientTlsEnabled=true\r\nbrokerClientAuthenticationPlugin=org.apache.pulsar.client.impl.auth.AuthenticationTls\r\nbrokerClientAuthenticationParameters=tlsCertFile:/home/Downloads/my-ca/admin.cert.pem,tlsKeyFile:/home/Downloads/my-ca/admin.key-pk8.pem\r\nbrokerClientTrustCertsFilePath=/home/Downloads/my-ca/certs/ca.cert.pem\r\n```\r\n\r\n`client.conf`:\r\n```\r\nwebServiceUrl=https://localhost:8443/\r\nbrokerServiceUrl=pulsar+ssl://localhost:6651/\r\nauthPlugin=org.apache.pulsar.client.impl.auth.AuthenticationTls\r\nauthParams=tlsCertFile:/home/Downloads/my-ca/abc.cert.pem,tlsKeyFile:/home/Downloads/my-ca/abc.key-pk8.pem\r\ntlsTrustCertsFilePath=/home/Downloads/my-ca/certs/ca.cert.pem\r\n```\r\n\r\n`functions-worker.yml`:\r\n```\r\nauthenticationEnabled: true\r\nauthorizationEnabled: true\r\ntlsEnabled: true\r\n```\r\n\r\n**Expected behaviour**\r\nShould have run successfully in standalone mode.\r\n\r\n**Desktop (please complete the following information):**\r\n I am doing everything within an **Ubuntu 18.04.4 LTS** VM with **Pulsar 2.5.0**\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/7287", "user": "97arushisharma", "labels": ["component/security", "triage/week-25", "type/bug"], "created": "2020-06-17 09:33:59", "closed": "2020-07-02 07:36:25", "commits": {}, "ttf": 14.000277777777777, "commitsDetails": []}, {"title": "Getting Connection refused: /127.0.0.1:6651 error on trying TLS encryption", "body": "**Description**\r\nI am trying to run a pulsar producer using java client that writes data to the standalone pulsar. I have run the pulsar using the following command:\r\n```\r\nbin/pulsar standalone\r\n```\r\nWhen I was writing the data without TLS encryption, it was working fine. But after I tried the TLS configuration, I am getting the following error in my client logs:\r\n\r\n```\r\norg.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:6651\r\njava.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:6651\r\norg.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:6651\r\njava.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:6651\r\norg.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:6651\r\njava.net.ConnectException: Connection refused WARNING [147 2020-06-15 09:27:10.157]: com.sqlstream.aspen.namespace.common.OutputUdx convertAllRows java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:6651\r\norg.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:6651\r\n\tat org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:717)\r\n\tat org.apache.pulsar.client.impl.ProducerBuilderImpl.create(ProducerBuilderImpl.java:93)\r\n\tat com.sqlstream.aspen.namespace.pulsar.PulsarOutputSink.open(PulsarOutputSink.java:196)\r\n\tat com.sqlstream.aspen.namespace.common.OutputUdx.convertAllRows(OutputUdx.java:228)\r\n\tat com.sqlstream.aspen.namespace.common.OutputUdx.writeRowsToSink(OutputUdx.java:216)\r\n\tat com.sqlstream.aspen.namespace.common.OutputUdx.writeRows(OutputUdx.java:176)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat net.sf.farrago.runtime.FarragoTransformUdx.executeUdx(FarragoTransformUdx.java:364)\r\n\tat net.sf.farrago.runtime.FarragoTransformUdx.run(FarragoTransformUdx.java:403)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:6651\r\n\tat java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1908)\r\n\tat org.apache.pulsar.client.impl.ProducerBuilderImpl.create(ProducerBuilderImpl.java:91)\r\n\t... 11 more\r\nCaused by: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:6651\r\n\tat org.apache.pulsar.client.impl.ConnectionPool.lambda$null$9(ConnectionPool.java:203)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:510)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:518)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$6.run(SingleThreadEventExecutor.java:1050)\r\n\tat org.apache.pulsar.shade.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\t... 1 more\r\nCaused by: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:6651\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:661)\r\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:646)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990)\r\n\tat org.apache.pulsar.client.impl.ConnectionPool.lambda$connectToAddress$17(ConnectionPool.java:276)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:577)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:570)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:549)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:490)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:615)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:608)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:117)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.fulfillConnectPromise(AbstractNioChannel.java:321)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:337)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:688)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:635)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:552)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:514)\r\n\t... 4 more\r\nCaused by: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:6651\r\nCaused by: java.net.ConnectException: Connection refused\r\n\tat sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)\r\n\tat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:714)\r\n\tat org.apache.pulsar.shade.io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:330)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:334)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:688)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:635)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:552)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:514)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$6.run(SingleThreadEventExecutor.java:1050)\r\n\tat org.apache.pulsar.shade.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n**To Reproduce**\r\n\r\nI have followed the following link for creating tls certificates(only upto BrokerConfiguration) : [http://pulsar.apache.org/docs/en/security-tls-transport/](http://pulsar.apache.org/docs/en/security-tls-transport/)\r\n\r\nHere are the producer client configurations: \r\nConfigs are: my-topic - pulsar+ssl://127.0.0.1:6651 \r\nClientConfigs : {tlsTrustCertsFilePath=/home/Downloads/my-ca/certs/ca.cert.pem, serviceUrl=pulsar+ssl://127.0.0.1:6651, useTls=true} \r\nProducerConfigs : {producerName=ABCProducer, topicName=my-topic}\r\n\r\nI am using the Java Client and passing the configs using `loadConf` function.\r\nI have also set the following properties in `broker.conf` file:\r\n```\r\ntlsEnabled=true\r\ntlsCertificateFilePath=/path/to/broker.cert.pem\r\ntlsKeyFilePath=/path/to/broker.key-pk8.pem\r\ntlsTrustCertsFilePath=/home/Downloads/my-ca/certs/ca.cert.pem\r\nbrokerServicePortTls=6651\r\n```\r\n\r\nI am doing everything within an **Ubuntu 18.04.4 LTS** VM with **Pulsar 2.5.0**. Following are the VM network settings:\r\nAttached to : NAT\r\nAdvance:\r\nPromiscuous Mode: Deny\r\n\r\n**Expected behavior**\r\nSuccessfully transfer data to the topic using TLS encryption.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/7277", "user": "97arushisharma", "labels": ["type/bug"], "created": "2020-06-15 10:17:25", "closed": "2020-06-15 10:52:29", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Can't read messages offloaded to S3", "body": "**Describe the bug**\r\nOnce ledgers are offloaded and removed from local storage, a reader is not able to retrieve the messages.\r\n\r\n**To Reproduce**\r\nProduce messages\r\nRead messages from beginning (SUCCESS)\r\nRollover Ledgers\r\nOffload\r\nWait for the offload deletion lag\r\nRead messages from beginning (FAIL - Timeout)\r\n\r\n**Expected behavior**\r\n\r\nI should still be able to retrieve messages from the beginning of my topic if they are offloaded to S3\r\n\r\n**Additional context**\r\nPulsar on AWS EKS, with the latest helm chart.\r\n\r\n**More details**\r\n\r\nI'm testing pulsar offloading to S3. I have a script producing 1M messages and another one reading them. The reading works well a few times (I re-run from scratch) but then I start to get exceptions:\r\n\r\n```\r\n10:28:56.701 [pulsar-io-24-1] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [ten/ns/persistent/my-topic-reader-3558c16521] Rewind from 233:0 to 233:0\r\n10:28:56.701 [pulsar-io-24-1] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://ten/ns/my-topic] There are no replicated subscriptions on the topic\r\n10:28:56.701 [pulsar-io-24-1] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://ten/ns/my-topic][reader-3558c16521] Created new subscription for 0\r\n10:28:56.701 [pulsar-io-24-1] INFO  org.apache.pulsar.broker.service.ServerCnx - [/x.x.x.x7:53908] Created subscription on topic persistent://ten/ns/my-topic / reader-3558c16521\r\n10:28:56.705 [bookkeeper-ml-workers-OrderedExecutor-6-0] WARN  org.apache.bookkeeper.mledger.impl.OpReadEntry - [ten/ns/persistent/my-topic][reader-3558c16521] read failed from ledger at position:233:0 : Unknown exception\r\n10:28:56.705 [broker-topic-workers-OrderedScheduler-3-0] ERROR org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer - [persistent://ten/ns/my-topic / reader-3558c16521-Consumer{subscription=PersistentSubscription{topic=persistent://ten/ns/my-topic, name=reader-3558c16521}, consumerId=0, consumerName=, address=/x.x.x.x7:53908}] Error reading entries at 233:0 : Unknown exception - Retrying to read in 15.0 seconds\r\n```\r\n\r\nThose ledgers are getting offloaded to S3. It looks like as soon as the ledger is removed(set-offload-deletion-lag) from the local storage I'm getting the exception below.\r\n\r\n```\r\n10:28:28.452 [bookkeeper-ml-workers-OrderedExecutor-6-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [ten/ns/persistent/my-topic] End TrimConsumedLedgers. ledgers=3 totalSize=38942923\r\n10:28:28.452 [bookkeeper-ml-workers-OrderedExecutor-6-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [ten/ns/persistent/my-topic] Deleting offloaded ledger 233 from bookkeeper - size: 15432415\r\n10:28:28.452 [bookkeeper-ml-workers-OrderedExecutor-6-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [ten/ns/persistent/my-topic] Deleting offloaded ledger 234 from bookkeeper - size: 15504438\r\n- size: 16168356\r\n```\r\n\r\nAlso I can see the Ledgers got removed from Zookeeper. Is there a configuration option I'm missing?  Is there a way to understand why:\r\n\r\n```\r\nread failed from ledger at position:233:0 : Unknown exception\r\n```\r\n is happening? Thank you!\r\n", "url": "https://github.com/apache/pulsar/issues/7246", "user": "jujugrrr", "labels": ["component/tieredstorage", "triage/week-24", "type/bug"], "created": "2020-06-11 14:28:22", "closed": "2020-06-17 14:29:23", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "Schema registry section appear after search schema", "body": "![image](https://user-images.githubusercontent.com/12592133/84342710-dac74700-abd8-11ea-8ba2-f01f37e6d1cc.png)\r\n", "url": "https://github.com/apache/pulsar/issues/7238", "user": "codelipenghui", "labels": ["component/documentation", "component/website", "triage/week-24", "type/bug"], "created": "2020-06-11 03:44:16", "closed": "2020-07-02 01:01:09", "commits": {}, "ttf": 20.00027777777778, "commitsDetails": []}, {"title": "the throughout of produce decrease to 0.0", "body": "**Describe the bug**\r\nwe have two geo-replication clusters with different node configurations, but the configurations of pulsar which deployed by k8s helm are the same.\r\nwe test throughout using pulsar-perf, and we found one of the clusters the throughout of produce decrease to 0.0.\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1.  deploy k8s cluster using k8s helm\r\n2.  execute './bin/pulsar-perf produce fl-tenant/fl-namespace/tt1   --rate 10  -s 5120000 -z LZ4'\r\n3.  about 20 seconds, maybe less.\r\n4.  See error\r\n![image](https://user-images.githubusercontent.com/18047329/84244768-b155df00-ab36-11ea-93a8-e6bb6f9af189.png)\r\n\r\nversion: 2.5.2/2.5.0\r\n\r\nwe checked all broker/bookie logs, there is no error exception, and don't have a clue how to fix it.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/7232", "user": "dockerzhang", "labels": ["triage/week-24", "type/bug"], "created": "2020-06-10 08:26:49", "closed": "2020-06-11 11:06:07", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "In Key_Shared subscription with stickyHashRange allow hashes in between", "body": "**Is your feature request related to a problem? Please describe.**\r\nIn `Key_Shared` subscription using `stickyHashRange`, consumers interleaving hashes are not allowed. For example, consumer 1 hash: [[0, 99], [400, 65535]], consumer 2 hash: [[100,399]].\r\nthrows an exception, `Range conflict with consumer` from [here](https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/HashRangeExclusiveStickyKeyConsumerSelector.java#L109).\r\nThis does not allow us to use better hashing techniques ex: **consistent hashing**.\r\nIs this a necessary check?\r\n\r\n**Describe the solution you'd like**\r\nAvoid the check if this is not necessary. \r\n\r\n**Additional context**\r\nI am not sure if this is a feature or a bug. Reporting as a feature, please feel free to change accordingly. \r\nTo reproduce the error, you can create two consumers with \r\n```java\r\nclient.newConsumer(Schema.STRING)\r\n             ....\r\n             .subscriptionType(SubscriptionType.Key_Shared)\r\n            .keySharedPolicy(KeySharedPolicy.stickyHashRange().ranges(Range.of(0,99), Range.of(400, 65535)))\r\n            .subscribe();\r\n```\r\n```java\r\nclient.newConsumer(Schema.STRING)\r\n             ....\r\n             .subscriptionType(SubscriptionType.Key_Shared)\r\n            .keySharedPolicy(KeySharedPolicy.stickyHashRange().ranges(Range.of(100,399)))\r\n            .subscribe();\r\n```", "url": "https://github.com/apache/pulsar/issues/7217", "user": "AnkushKhanna", "labels": ["component/broker", "triage/week-24", "type/bug"], "created": "2020-06-09 07:02:09", "closed": "2020-06-11 00:43:55", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Can i use pattern Regex in non-persistent mode?", "body": "**Describe the bug**\r\ni use java client to subscribe pattern  topic(like: non-persistent://iot/yy/hu/.*), when i publish a message by \"non-persistent://iot/yy/hu/2\" , i cannot get the message. but in persistent mdoe i can receive.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nuse this command to publish message\r\n`./pulsar-client produce non-persistent://iot/yy/hu/2 --messages \"message1\"`\r\n\r\n**Screenshots**\r\ni got the message from broker log:\r\n![image](https://user-images.githubusercontent.com/21210211/84025525-54371d80-a9be-11ea-88bc-b62881ebfe0f.png)\r\n\r\nmaybe is due to :\r\n`[pulsar-io-50-17] WARN  org.apache.pulsar.broker.service.BrokerService - No autoTopicCreateOverride policy found for non-persistent://iot/yy/hu/2`\r\n", "url": "https://github.com/apache/pulsar/issues/7205", "user": "zhijianfree", "labels": ["triage/week-24", "type/bug"], "created": "2020-06-08 11:32:52", "closed": "2020-06-12 13:19:50", "commits": {"3ff532d5fe5ae44fb13f72ed780f2ffd000ba6cd": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "3ff532d5fe5ae44fb13f72ed780f2ffd000ba6cd", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["134a8a2e2064a895e9a70bab2ba4c01510fb349e"], "nameRev": "3ff532d5fe5ae44fb13f72ed780f2ffd000ba6cd master~86", "commitMessage": "Add tests and documentation for subscribing to non-persistent with topic pattern (#7240)\n\nFixes #7205\r\n\r\nMotivation\r\nAdd tests and documentation for subscribing to non-persistent with topic pattern", "commitDateTime": "2020-06-12 21:19:49", "authoredDateTime": "2020-06-12 21:19:49", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/NonPersistentTopicE2ETest.java", "insertions": 45, "deletions": 0, "lines": 45}, {"filePath": "site2/docs/client-libraries-java.md", "insertions": 17, "deletions": 2, "lines": 19}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NonPersistentTopicE2ETest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.NonPersistentTopicE2ETest.testPatternTopic()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Using entryLogPerLedgerEnabled  feature will got NoSuchMethodError", "body": "**Describe the bug**\r\nusing entryLogPerLedgerEnabled feature by set `entryLogPerLedgerEnabled=true` in bookkeeper.conf and produce some message, when bookie try to flush enties to entrylogfile,  got NoSuchMethodError.\r\n\r\n`java.lang.NoSuchMethodError: org.apache.commons.lang3.mutable.MutableInt.incrementAndGet() at org.apache.bookkeeper.bookie.EntryLogManagerForEntryLogPerLedger$EntryLogsPerLedgerCounter.openNewEntryLogForLedger`\r\n\r\n**Additional context**\r\nIt seems MutableInt.incrementAndGet() is available from commons-lang3(v3.5) but Pulsar is using  commons-lang3(v3.4)  \r\n\r\n**Expected behavior**\r\nAs BookKeeper is using commons-lang3(v3.6), Pulsar shoud also update to v3.6\r\n", "url": "https://github.com/apache/pulsar/issues/7202", "user": "wangjialing218", "labels": ["triage/week-24", "type/bug"], "created": "2020-06-08 06:42:44", "closed": "2020-06-09 04:54:27", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "presto\u2019s catalog config [ pulsar.zookeeper-uri] not support multi uris", "body": "**Describe the bug**\r\nWhen I use pulsar-sql, I want to config pulsar.zookeeper-uri with multi uris and seperate by \r\ndivide by semicolon, currently pulsar.properties doesnot support\u3002\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to '/apache-pulsar-2.5.0/conf/presto/catalog/pulsar.properties'\r\n2. config pulsar.properties with 'pulsar.zookeeper-uri=kmr-234487a9-gn-279fcec2-core-1-001:2181,kmr-234487a9-gn-279fcec2-core-1-002:2181,kmr-234487a9-gn-279fcec2-core-1-003:2181'\r\n3. start pulsar-sql\r\n4. See error: cant found root path in zk\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/10680639/83985449-e6620600-a96b-11ea-9242-1b539bad227d.png)\r\n![image](https://user-images.githubusercontent.com/10680639/83985461-f24dc800-a96b-11ea-8e33-1f86326363ff.png)", "url": "https://github.com/apache/pulsar/issues/7197", "user": "zhaoyu1989", "labels": ["type/bug"], "created": "2020-06-08 01:39:47", "closed": "2020-06-09 01:54:01", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "\u3010Bug\u3011get last messageId with failed exception", "body": "**Describe the bug**\r\nWhen I use flink to consume pulsar topic, flink-pulsar-connector will use admin http request to get last messageId. However, i get the following exception in broker side:\r\n```\r\n17:37:47.033 [pulsar-web-41-23] ERROR org.apache.pulsar.broker.admin.impl.PersistentTopicsBase - [null] Failed to get last messageId persistent://test/test/test-partition-22\r\njavax.ws.rs.WebApplicationException: HTTP 307 Temporary Redirect\r\n        at org.apache.pulsar.broker.web.PulsarWebResource.validateTopicOwnership(PulsarWebResource.java:596) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n        at org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.validateReadOperationOnTopic(PersistentTopicsBase.java:238) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n        at org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalGetLastMessageId(PersistentTopicsBase.java:2285) [org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n        at org.apache.pulsar.broker.admin.v2.PersistentTopics.getLastMessageId(PersistentTopics.java:1063) [org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n        at jdk.internal.reflect.GeneratedMethodAccessor133.invoke(Unknown Source) ~[?:?]\r\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\r\n        at java.lang.reflect.Method.invoke(Method.java:564) ~[?:?]\r\n        at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:76) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:148) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:191) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n        at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:183) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:103) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n        at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:493) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n        at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:415) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n        at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:104) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n        at org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:277) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:316) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:298) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:268) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n        at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:289) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n        at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:256) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n        at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:703) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n        at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:416) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n        at org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:370) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:389) [o\r\n```\r\nWhen checking the code, i found the `Temporary Redirect` should be the expected behavior when the request topic not owned by the current broker. \r\n```\r\nif (!nsService.isServiceUnitOwned(topicName)) {\r\n\tboolean newAuthoritative = isLeaderBroker(pulsar());\r\n\t// Replace the host and port of the current request and redirect\r\n\tURI redirect = UriBuilder.fromUri(uri.getRequestUri()).host(webUrl.get().getHost())\r\n\t\t.port(webUrl.get().getPort()).replaceQueryParam(\"authoritative\", newAuthoritative).build();\r\n\t// Redirect\r\n\tlog.debug(\"Redirecting the rest call to {}\", redirect);\r\n\tthrow new WebApplicationException(Response.temporaryRedirect(redirect).build());\r\n}\r\n```\r\n**Expected behavior**\r\nWhen the requested topic not owned by current broker, i will trigger `Temporary Redirect`, and we should not use log error level to print the exception stack. \r\nIn my opinion, printing the exception stack with debug level will better. Because we will monitor the brokers' error messages and alert to the person on duty.\r\n\r\n@sijie @jiazhai @codelipenghui  Could you give me some ideas?", "url": "https://github.com/apache/pulsar/issues/7189", "user": "hangc0276", "labels": ["component/broker", "triage/week-24", "type/bug"], "created": "2020-06-06 10:39:07", "closed": "2020-06-09 08:33:01", "commits": {"626f2c8f635d50d1abff1d942c9bc71a08004225": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "626f2c8f635d50d1abff1d942c9bc71a08004225", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["2aff473e598fe5e8ba9f8ed0860de35a67718725"], "nameRev": "626f2c8f635d50d1abff1d942c9bc71a08004225 tags/v2.6.0-candidate-1~6", "commitMessage": "change topic lookup redirect log level (#7215)\n\nFix #7189\r\n\r\nChanges\r\nchange the WebApplicationException log level from error to debug", "commitDateTime": "2020-06-09 16:33:00", "authoredDateTime": "2020-06-09 16:33:00", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 5, "deletions": 0, "lines": 5}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalGetLastMessageId(javax.ws.rs.container.AsyncResponse,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Pulsar allows creating duplicate topics with the same name", "body": "**Describe the bug**\r\nPulsar 2.5.0 allows creating two topics (one partitioned, and the other non-partitioned) with the same name through Admin API. This behaviour is consistent across both persistent and non-persistent topics.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a partitioned topic in a tenant/namespace (e.g. persistent://public/test/duplicate-test)\r\n2. Create a non-partitioned topic in tenant/namespace by the same name as above\r\n\r\n**Expected behavior**\r\nAamin API should return HTTP `409` with the following response, like it does if the order of steps above is reveresed:\r\n```\r\n{\r\n    \"reason\": \"This topic already exists\"\r\n}\r\n```\r\n\r\n**Additional context**\r\nIt does not allow topics with duplicate names as expected when reversing the order of steps above (create non-partitioned topic first, and then try to create partitioned topic by the same name. Response with HTTP 409 as described above)\r\n\r\nAdditionally, both topics do exist and show up in their respective list API calls. When trying to publish messages to the topic, they always seem to be received by the partitioned topic. If partitioned topic is removed, the publish still succeeds, and the messages go to the non-partitioned topic by the same name.\r\n", "url": "https://github.com/apache/pulsar/issues/7183", "user": "deltasquare4", "labels": ["component/admin", "component/broker", "release/2.5.1", "type/bug"], "created": "2020-06-05 10:52:41", "closed": "2020-06-08 05:25:15", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "using pulsar-client-kafka_0_9 version to consume partition topic\uff0c will throw Exception", "body": "**Describe the bug**\r\nWhen using pulsar-client-kafka_0_9 version to consume partition topic\uff0c will throw Exception\r\n\r\n\r\n```bash\r\nException in thread \"main\" java.lang.ClassCastException: org.apache.pulsar.client.impl.TopicMessageIdImpl cannot be cast to org.apache.pulsar.client.impl.MessageIdImpl\r\n        at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:317)\r\n        at com.tencent.tdmq.kafka.demo.KafkaApi0_9.consumer(KafkaApi0_9.java:87)\r\n        at com.tencent.tdmq.kafka.demo.KafkaApi0_9.main(KafkaApi0_9.java:113)\r\n```", "url": "https://github.com/apache/pulsar/issues/7178", "user": "liudezhi2098", "labels": ["component/kafka", "type/bug"], "created": "2020-06-05 06:40:40", "closed": "2020-06-08 08:18:14", "commits": {"d8ab1a24b36143c91bf483116acc9b74e1a23f3a": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "d8ab1a24b36143c91bf483116acc9b74e1a23f3a", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["4beebb31a05afb0e310e7deed7ea1aac17b9521b"], "nameRev": "d8ab1a24b36143c91bf483116acc9b74e1a23f3a tags/v2.6.0-candidate-1~19", "commitMessage": "Fix kafka_0_9 Consumer partition topic throw error (#7179)\n\nMaster Issue: #7178\r\n## Motivation\r\n\r\nWhen using pulsar-client-kafka_0_9 version to consume partition topic\uff0c will throw java.lang.ClassCastException,  \r\nbecause \r\n```\r\norg.apache.pulsar.client.impl.TopicMessageIdImpl cannot be cast to org.apache.pulsar.client.impl.MessageIdImpl\r\n```\r\n## Modifications\r\nBrokerService\r\n```java\r\n public void subscribe(List<String> topics, ConsumerRebalanceListener callback) {\r\n        List<CompletableFuture<org.apache.pulsar.client.api.Consumer<byte[]>>> futures = new ArrayList<>();\r\n\r\n        List<TopicPartition> topicPartitions = new ArrayList<>();\r\n        try {\r\n            for (String topic : topics) {\r\n                // Create individual subscription on each partition, that way we can keep using the\r\n                // acknowledgeCumulative()\r\n                int numberOfPartitions = ((PulsarClientImpl) client).getNumberOfPartitions(topic).get();\r\n\r\n                ConsumerBuilder<byte[]> consumerBuilder = PulsarConsumerKafkaConfig.getConsumerBuilder(client, properties);\r\n                consumerBuilder.subscriptionType(SubscriptionType.Failover);\r\n                consumerBuilder.messageListener(this);\r\n                consumerBuilder.subscriptionName(groupId);\r\n                //consumerBuilder.topics(topics);\r\n                if (numberOfPartitions > 1) {\r\n                    // Subscribe to each partition\r\n                    consumerBuilder.consumerName(ConsumerName.generateRandomName());\r\n                    for (int i = 0; i < numberOfPartitions; i++) {\r\n                        String partitionName = TopicName.get(topic).getPartition(i).toString();\r\n                        CompletableFuture<org.apache.pulsar.client.api.Consumer<byte[]>> future = consumerBuilder.clone()\r\n                                .topic(partitionName).subscribeAsync();\r\n                        int partitionIndex = i;\r\n                        TopicPartition tp = new TopicPartition(\r\n                                TopicName.get(topic).getPartitionedTopicName(),\r\n                                partitionIndex);\r\n                        futures.add(future.thenApply(consumer -> {\r\n                            log.info(\"Add consumer {} for partition {}\", consumer, tp);\r\n                            consumers.putIfAbsent(tp, consumer);\r\n                            return consumer;\r\n                        }));\r\n                        topicPartitions.add(tp);\r\n```\r\nWe should remove consumerBuilder.topics(topics)\u3002", "commitDateTime": "2020-06-08 13:26:04", "authoredDateTime": "2020-06-08 13:26:04", "commitGitStats": [{"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka_0_9/src/main/java/org/apache/kafka/clients/consumer/PulsarKafkaConsumer.java", "insertions": 0, "deletions": 1, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarKafkaConsumer.java", "spoonMethods": [{"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.subscribe(java.util.List,org.apache.kafka.clients.consumer.ConsumerRebalanceListener)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "regex subscription not working for new topics in Python", "body": "**Describe the bug**\r\nIf a new topic is added that matches a regex subscription then if the client is written in Java it detects it and adds a cursor but if it is written in Python it does not.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\nRun the following as a Phython3 client:\r\n```\r\n#!/usr/bin/python3\r\nimport pulsar\r\nimport re\r\n\r\nclient = pulsar.Client(\"pulsar://localhost:6650\")\r\ninitial_position=pulsar.InitialPosition.Earliest )\r\nconsumer = client.subscribe(re.compile('.*'), subscription_name='my-sub' )\r\n\r\nwhile True:\r\n    msg = consumer.receive()\r\n    print(\"Received message '%s'\" % msg.data())\r\n    consumer.acknowledge(msg)\r\n\r\nclient.close()\r\n```\r\n\r\nIn another window run this command to get a Java client for comparison:\r\n```\r\n/opt/pulsar/bin/pulsar-client consume --regex '.*' -s all -n 0\r\n```\r\n\r\nIn another window send a message to a new topic:\r\n```\r\n/opt/pulsar//bin/pulsar-client produce addtopic -m 'm1'\r\n```\r\nWait a minute for the clients to detect the new topic.\r\nSend another message to the same topic.\r\n```\r\n/opt/pulsar//bin/pulsar-client produce addtopic -m 'm2'\r\n```\r\nThe Java client receives the message but the Python one does not.\r\n\r\nKill and restart the clients. Send a message to the same topic.\r\n```\r\n/opt/pulsar//bin/pulsar-client produce addtopic -m 'm3'\r\n```\r\nBoth clients receive the message.\r\n\r\n**Expected behavior**\r\nBoth clients should receive the second message.\r\n\r\n**Screenshots**\r\nNA\r\n\r\n**Desktop (please complete the following information):**\r\n Centos 7\r\nPulsar 2.5.1\r\nPython pulsar-client 2.5.2\r\n\r\n**Additional context**\r\n`initial_position=pulsar.InitialPosition.Earliest` does not help\r\n", "url": "https://github.com/apache/pulsar/issues/7168", "user": "baynes", "labels": ["component/python", "help wanted", "triage/week-23", "type/bug"], "created": "2020-06-04 10:11:57", "closed": "2020-06-09 18:07:27", "commits": {"c2759be5e6423f84e0df54100e41a5722194b34e": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "c2759be5e6423f84e0df54100e41a5722194b34e", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f26bab30991d4da178d61b197e9c698bc337f5de"], "nameRev": "c2759be5e6423f84e0df54100e41a5722194b34e tags/v2.6.0-candidate-1~3", "commitMessage": "Fix bug: pattern consumer's receive() will cause deadlock for topics auto discovery (#7206)\n\nFixes #7168 \r\n\r\n### Motivation\r\n\r\nWhen a pattern consumer is blocked by `receive()`, the `mutex_` will be held until new messages arrived. If the auto discovery timer task found new topics and tried to subscribe them, `mutex_` must be acquired first, then the deadlock happened.\r\n\r\n### Modifications\r\n\r\n- Release the `mutex_` after the consumer's state was verified.\r\n- Change unit tests to verify that new topics could be subscribed when the consumer's blocked by `receive(Message&)` or `receive(Message&, int)` methods.\r\n\r\n### Verifying this change\r\n\r\n- [ ] Make sure that the change passes the CI checks.\r\n\r\nThis change is already covered by existing tests, such as *BasicEndToEndTest.testPatternMultiTopicsConsumerAutoDiscovery*.", "commitDateTime": "2020-06-09 11:07:26", "authoredDateTime": "2020-06-10 02:07:26", "commitGitStats": [{"filePath": "pulsar-client-cpp/lib/MultiTopicsConsumerImpl.cc", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-client-cpp/tests/BasicEndToEndTest.cc", "insertions": 65, "deletions": 79, "lines": 144}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Sometimes get partitioned metadata  will throws  NullPointerException", "body": "**Describe the bug**\r\nSometimes get partitioned metadata  will throws  NullPointerException,\r\nbecause the NamespaceService not initialized yet\r\n\r\n\r\n```bash\r\nWARN  org.apache.pulsar.broker.service.ServerCnx - Failed to get Partitioned Metadata \r\n[/112.0.0.1:6760] persistent://public/default/test null\r\njava.lang.NullPointerException: null      \r\n        at org.apache.pulsar.broker.service.BrokerService.fetchPartitionedTopicMetadataCheckAllowAutoCreationAsync(Br\r\nokerService.java:1830)     \r\n        at org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.lambda$23(PersistentTopicsBase.java:2215)     \r\n        at org.apache.pulsar.broker.admin.impl.PersistentTopicsBase$$Lambda$141/1430619109.apply(Unknown Source) ~[?:\r\n?]\r\n        at java.util.concurrent.CompletableFuture.doThenCompose(CompletableFuture.java:1996) \r\n        at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2546) \r\nat org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.getPartitionedTopicMetadata(PersistentTopicsBase.\r\njava:2214) \r\n        at org.apache.pulsar.broker.service.ServerCnx.lambda$4(ServerCnx.java:469)       \r\nat org.apache.pulsar.broker.service.ServerCnx$$Lambda$131/1787376191.apply(Unknown Source)\r\n        at java.util.concurrent.CompletableFuture.doThenApply(CompletableFuture.java:1530) \r\n        at java.util.concurrent.CompletableFuture.thenApply(CompletableFuture.java:2369)      \r\n at org.apache.pulsar.broker.service.ServerCnx.handlePartitionMetadataRequest(ServerCnx.java:467) \r\n```", "url": "https://github.com/apache/pulsar/issues/7163", "user": "liudezhi2098", "labels": ["type/bug"], "created": "2020-06-04 03:43:06", "closed": "2020-06-08 08:18:30", "commits": {"844b2ec7816cba2e9c75b1fba151b065f631d5f6": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "844b2ec7816cba2e9c75b1fba151b065f631d5f6", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["fa2da42337e926240d1b62cfb052507802b24b7e"], "nameRev": "844b2ec7816cba2e9c75b1fba151b065f631d5f6 tags/v2.6.0-candidate-1~23", "commitMessage": "fix get partitioned metadata  throws NullPointerException (#7164)\n\nMaster Issue: #7163\r\n## Motivation\r\n\r\nSometimes get partitioned metadata will throws NullPointerException, because the NamespaceService not initialized yet , so needed a judgment .\r\n\r\n## Modifications\r\nBrokerService\r\n```java\r\n        if(pulsar.getNamespaceService() == null){\r\n            return CompletableFuture.completedFuture(null);\r\n        }\r\n```\r\n", "commitDateTime": "2020-06-08 10:30:23", "authoredDateTime": "2020-06-08 10:30:23", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.fetchPartitionedTopicMetadataCheckAllowAutoCreationAsync(org.apache.pulsar.common.naming.TopicName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Mistake in Pulsar Function Documentation", "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\nIn the documentation of pulsar function, under the Logger section there is an mistake in \"Go\" code sample . Go code sample states  `\"github.com/apache/pulsar/pulsar-function-go/log\"` in the import but in reality it is  `\"github.com/apache/pulsar/pulsar-function-go/logutil\"`\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to   `https://pulsar.apache.org/docs/en/functions-develop/#logger`\r\n2. Click on 'Go'\r\n4. See error\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\nThe import section of the code sample should have `\"github.com/apache/pulsar/pulsar-function-go/logutil\"`\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n<img width=\"833\" alt=\"Screen Shot 2020-06-03 at 7 48 15 PM\" src=\"https://user-images.githubusercontent.com/43142501/83699847-2c694380-a5d3-11ea-917c-03b2005b8d6a.png\">\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/7158", "user": "skothari-tibco", "labels": ["component/documentation", "triage/week-23", "type/bug"], "created": "2020-06-03 23:48:46", "closed": "2020-06-06 04:59:27", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Increase partitions of a non-existing topic created multiple non-partitioned topics", "body": "**Describe the bug**\r\nIf I try to increase partitions of a non-existing topic, the method would fail but multiple non-partitioned topics would be created after that.\r\n\r\n**To Reproduce**\r\nAssume that we had a standalone Pulsar running. There're no topics at first:\r\n\r\n```bash\r\n$ URL_BASE=http://localhost:8080/admin/v2/persistent/public/default\r\n$ curl $URL_BASE; echo\r\n[]\r\n```\r\n\r\nHere we use POST method to increase partitions, but the target topic `Foo` doesn't exist. Check topics again, we found there're 3 new topics:\r\n\r\n```bash\r\n$ curl $URL_BASE/Foo/partitions -X POST -H 'Content-Type: application/json' -d \"3\"; echo\r\n{\"reason\":\"Topic is not partitioned topic\"}\r\n$ curl $URL_BASE; echo\r\n[\"persistent://public/default/Foo-partition-0\",\"persistent://public/default/Foo-partition-1\",\"persistent://public/default/Foo-partition-2\"]\r\n```\r\n\r\nHowever, it can't be treated as a partitioned topic, so we can't use relative admin APIs to delete it, create a partitioned topic `Foo`, or increase partitions. The only way is to delete each single topic one by one:\r\n\r\n```bash\r\n$ curl $URL_BASE/Foo/partitions; echo\r\n{\"partitions\":0}\r\n$ curl $URL_BASE/Foo/partitions -X DELETE; echo\r\n{\"reason\":\"Partitioned topic does not exist\"}\r\n$ curl $URL_BASE/Foo/partitions -X POST -H 'Content-Type: application/json' -d \"5\"; echo\r\n{\"reason\":\"Already have non partition topicpersistent://public/default/Foo-partition-0 which contains partition suffix '-partition-' and end with numeric value and end with numeric value smaller than the new number of partition. Update of partitioned topic Foo could cause conflict.\"}\r\n$ curl $URL_BASE/Foo/partitions -X PUT -H 'Content-Type: application/json' -d \"5\"; echo\r\n{\"reason\":\"This topic already exists\"}\r\n$ curl $URL_BASE/Foo-partition-0 -X DELETE\r\n$ curl $URL_BASE/Foo-partition-1 -X DELETE\r\n$ curl $URL_BASE/Foo-partition-2 -X DELETE\r\n$ curl $URL_BASE; echo\r\n[]\r\n```\r\n\r\n**Expected behavior**\r\nWhen we try to increase partitions of a non-existing topic, no topics should be created. The POST method should affect nothing.", "url": "https://github.com/apache/pulsar/issues/7152", "user": "BewareMyPower", "labels": ["component/broker", "triage/week-23", "type/bug"], "created": "2020-06-03 09:14:04", "closed": "2020-06-08 12:03:58", "commits": {"710b22d401ca945050bf1248ebbb867ae1f3d4b5": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "710b22d401ca945050bf1248ebbb867ae1f3d4b5", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["bcfa7f00554b72314799b2d38a5815d5ee802e5e"], "nameRev": "710b22d401ca945050bf1248ebbb867ae1f3d4b5 tags/v2.6.0-candidate-1~15", "commitMessage": "Add topic type validation before update topic partitions (#7181)\n\nFixes #7152 \r\n\r\n### Motivation\r\nThis PR add topic type validation before update partition numbers of partitioned-topic. \r\nThis can prevent  creating new partitions for non-partitoned topics.\r\n", "commitDateTime": "2020-06-08 20:03:57", "authoredDateTime": "2020-06-08 20:03:57", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 14, "deletions": 0, "lines": 14}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminResourceTest.java", "insertions": 42, "deletions": 1, "lines": 43}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.validatePartitionedTopicMetadata(java.lang.String,java.lang.String,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.updatePartitionedTopic(java.lang.String,java.lang.String,java.lang.String,boolean,boolean,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminResourceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResourceTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResourceTest.setup()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResourceTest.cleanup()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResourceTest.testValidatePartitionedTopicMetadata()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Cannot resolve import in BatchSourceExecutor", "body": "**Describe the bug**\r\nCannot resolve dependency of `org.apache.pulsar.functions.utils.Reflections` in BatchSourceExecutor, since `Reflections ` has move to pulsar-common.\r\n**To Reproduce**\r\npull the master \r\n**Expected behavior**\r\nshould import from the right path\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/48062889/83605735-ff089f80-a5aa-11ea-85de-0e066f75b99a.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/7149", "user": "aloyszhang", "labels": ["type/bug"], "created": "2020-06-03 07:01:36", "closed": "2020-06-04 01:36:54", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "when i start broker, i met that pulsar read broker.conf,initialize backlogQuotaDefaultRetentionPolicy failed", "body": "pulsar version=2.5.0\r\njdk =1.8\r\nthis is start broker error information:\r\n./pulsar broker\r\n[AppClassLoader@18b4aac2] info AspectJ Weaver Version 1.9.2 built on Wednesday Oct 24, 2018 at 15:43:33 GMT\r\n[AppClassLoader@18b4aac2] info register classloader sun.misc.Launcher$AppClassLoader@18b4aac2\r\n[AppClassLoader@18b4aac2] info using configuration file:xxx/pulsar/lib/org.apache.pulsar-pulsar-zookeeper-utils-2.5.0.jar!/META-INF/aop.xml\r\n[AppClassLoader@18b4aac2] info using configuration file:xxx/pulsar/lib/org.apache.pulsar-pulsar-zookeeper-2.5.0.jar!/META-INF/aop.xml\r\n[AppClassLoader@18b4aac2] info register aspect org.apache.pulsar.broker.zookeeper.aspectj.ClientCnxnAspect\r\n[AppClassLoader@18b4aac2] info register aspect org.apache.pulsar.zookeeper.FinalRequestProcessorAspect\r\n[AppClassLoader@18b4aac2] info register aspect org.apache.pulsar.zookeeper.ZooKeeperServerAspect\r\n2020-06-01 08:10:34,251 [sun.misc.Launcher$AppClassLoader@18b4aac2] error Uncaught exception in thread main: failed to initialize backlogQuotaDefaultRetentionPolicy field while setting value producer_request_hold\r\n\r\nI have not met this  error before. backlogQuotaDefaultRetentionPolicy is Related to pular start\uff1fI can't understant.\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/7134", "user": "Gray-Fullbuster", "labels": ["triage/week-23", "type/bug"], "created": "2020-06-02 01:43:25", "closed": "2020-06-08 08:11:15", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "some config field of ServiceConfiguration spell wrong", "body": "**Describe the bug**\r\nSome spelling error of the fields in  `ServiceConfiguration` , \r\nLike : `maxPendingPublishdRequestsPerConnection` and `replicatioPolicyCheckDurationSeconds`, \r\nand much more typoes can be found in broker.conf. \r\n we should correct them.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/7128", "user": "aloyszhang", "labels": ["triage/week-23", "type/bug"], "created": "2020-06-01 16:21:05", "closed": "2020-06-02 07:53:19", "commits": {"5b20496709b0a7bc7d517c5ac335e86e9d650255": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "5b20496709b0a7bc7d517c5ac335e86e9d650255", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["3a49ad5f6e2217bc56f4d8e9d159260337234c11"], "nameRev": "5b20496709b0a7bc7d517c5ac335e86e9d650255 tags/v2.6.0-candidate-1~82", "commitMessage": "Fix typos and remove unused import (#7129)\n\nFixes #7128\r\n\r\n### Motivation\r\nThis PR is a minor update to fix typos in `ServiceConfiguration` & broker.conf  and remove unused import", "commitDateTime": "2020-06-02 15:53:18", "authoredDateTime": "2020-06-02 15:53:18", "commitGitStats": [{"filePath": "conf/bookkeeper.conf", "insertions": 9, "deletions": 9, "lines": 18}, {"filePath": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Topic.java", "insertions": 0, "deletions": 1, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServiceConfiguration.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.ServiceConfiguration", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.startCheckReplicationPolicies()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Topic.java", "spoonMethods": []}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "When the content of the sent message is 5M, it will appear that the current Topic can no longer send the message", "body": "**Describe the bug**\r\nBy default config , when the content of the sent message is 5M, it will appear that the current topic can no longer send the message.\r\n\r\n*Send a message*\r\n```java\r\nbyte[] data = new byte[5 * 1024 * 1024];\r\nproducer.newMessage().value(data).send();\r\n```\r\n*bookie has always been wrong  io.netty.handler.codec.TooLongFrameException: Adjusted frame length exceeds 5242880: 5242992 - discarded*\r\n\r\n```bash\r\nbookie-io-1-26] ERROR org.apache.bookkeeper.proto.BookieRequestHandler - Unhandled exception occurred in I/O thread or handler\r\nio.netty.handler.codec.TooLongFrameException: Adjusted frame length exceeds 5242880: 5242992 - discarded\r\n        at io.netty.handler.codec.LengthFieldBasedFrameDecoder.fail(LengthFieldBasedFrameDecoder.java:513) ~[io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.handler.codec.LengthFieldBasedFrameDecoder.failIfNecessary(LengthFieldBasedFrameDecoder.java:491) ~[io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.handler.codec.LengthFieldBasedFrameDecoder.exceededFrameLength(LengthFieldBasedFrameDecoder.java:378) ~[io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.handler.codec.LengthFieldBasedFrameDecoder.decode(LengthFieldBasedFrameDecoder.java:421) ~[io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.handler.codec.LengthFieldBasedFrameDecoder.decode(LengthFieldBasedFrameDecoder.java:334) ~[io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:503) ~[io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:442) ~[io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:281) ~[io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n```\r\n\r\nBookie default configuration nettyMaxFrameSizeBytes is 5242880  \r\nbut broker set NettyMaxFrameSizeBytes  \uff08conf.getMaxMessageSize() Commands.MESSAGE_SIZE_FRAME_PADDING);\r\n\r\n\r\n```\r\nbk_server.conf\r\n# The maximum netty frame size in bytes. Any message received larger than this will be rejeted. Default value is 5MB.\r\n# nettyMaxFrameSizeBytes=5242880\r\n\r\nbroker.conf\r\n# Max size of messages.\r\nmaxMessageSize=5242880\r\n```\r\nSo the broker thinks that the 5M message can be sent normally, but the bookie thinks it has exceeded the length, and bkclient will keep retrying.", "url": "https://github.com/apache/pulsar/issues/7115", "user": "liudezhi2098", "labels": ["component/storage", "triage/week-23", "type/bug"], "created": "2020-05-31 06:19:20", "closed": "2020-06-04 03:36:19", "commits": {"d009c11087d420b827e65f30cd26d8731cf0996d": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "d009c11087d420b827e65f30cd26d8731cf0996d", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["605868d64e018bc4fc075b4633423de0928e3d9a"], "nameRev": "d009c11087d420b827e65f30cd26d8731cf0996d tags/v2.6.0-candidate-1~63", "commitMessage": "fix support set nettyMaxFrameSizeBytes on bookeeper config (#7116)\n\nMaster Issue: #7115\r\n## Motivation\r\n\r\nfix by default config , when the content of the sent message is 5M, it will appear that the current topic can no longer send the message.\r\n\r\n## Modifications\r\nbookkeeper.con f\r\n```java\r\n# The maximum netty frame size in bytes. Any message received larger than this will be rejeted. Default value is 1G.\r\nnettyMaxFrameSizeBytes=1073741824\r\n```\r\n\r\nThe default setting is 1G size, I think it should be larger than the broker's", "commitDateTime": "2020-06-04 11:36:18", "authoredDateTime": "2020-06-04 11:36:18", "commitGitStats": [{"filePath": "conf/bookkeeper.conf", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[Helm] Proxy started throwing Jetty errors even on a new cluster", "body": "**Describe the bug**\r\nWhen starting up a new cluster we're getting errors from the proxy related to jetty thread allocation problems but I'm confused as the docker image is still using the tagged 2.5.0 and I don't see any pulled in external libs.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behaviour:\r\n1. Helm install\r\n2. k logs dga-detection-pulsar-proxy-0\r\n\r\n**Expected behavior**\r\nProxy to come up as expected\r\n\r\n**Screenshots**\r\nk logs with the stacktrace, [netty.txt](https://github.com/apache/pulsar/files/4697235/netty.txt).\r\n\r\n**Desktop (please complete the following information):**\r\n - Kubernetes 1.16\r\n - helm v3.1.1\r\n- Using helm chart from apache/pulsar-helm-chart ", "url": "https://github.com/apache/pulsar/issues/7089", "user": "ckdarby", "labels": ["type/bug"], "created": "2020-05-28 17:22:32", "closed": "2020-05-28 21:23:59", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[docker] catch OperationalError when running pulsar-standalone container", "body": "**Describe the bug**\r\ncatch OperationalError when running pulsar-standalone container\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1.  start docker container\r\ndocker run -d --name=test -p 80:80  -p 6650:6650 -p 8080:8080 apachepulsar/pulsar-standalone:2.5.2\r\n\r\n2.  access http://local_ip:80\r\n3. See error\r\n![image](https://user-images.githubusercontent.com/18047329/83133610-b61d9a80-a115-11ea-97d6-c5e5d2d75a6d.png)\r\n", "url": "https://github.com/apache/pulsar/issues/7084", "user": "dockerzhang", "labels": ["triage/week-22", "type/bug"], "created": "2020-05-28 11:07:13", "closed": "2020-05-29 21:38:57", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "pulsar client 2.5.2 cli does not support subscription-position when running consumer", "body": "When running pulsar client cli command for consumer, --subscription-position is shown as unknown option\r\n\r\nNote pulsar client version: 2.5.2\r\n\r\nRun the below command to start a consumer \r\n```\r\n./pulsar-client consume \"persistent://public/default/my-partitioned-topic-partition-0\" -s subcribname  -t Exclusive --subscription-position Earliest\r\n```\r\n            OR\r\n```\r\n./pulsar-client consume \"persistent://public/default/my-partitioned-topic-partition-0\" -s subcribname  -t Exclusive -p Earliest\r\n```\r\n\r\n**Throws below error**\r\n```\r\nUnknown option: --subscription-position\r\nConsume messages from a specified topic\r\nUsage: consume [options] TopicName\r\n  Options:\r\n    --hex\r\n       Display binary messages in he\r\n```\r\n\r\n**Expected behavior**\r\nIt should allow the option --subscription-position as document for pulsar 2.5.2\r\n\r\n**Additional context**\r\n```\r\nI would like to know if the --subscription-position as Earliest will consume all the messages that was sent to topic before starting consumer with the subscriber?\r\nFor e.g\r\n1.Create a topic\r\n2.send data to topic \"A\"\r\n3 start consumer with option --subscription-position as Earliest\r\n4. send data to topic \"B\"\r\n```\r\n\r\nWill I be able to consume the messages sent in step 2 i.e \"A\" or I will be able to consume only messages sent in step 4 onwards i.e\"B\"\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/7056", "user": "sakthi-prasad", "labels": ["component/documentation", "component/website", "triage/week-22", "type/bug"], "created": "2020-05-27 15:32:59", "closed": "2020-07-01 02:29:39", "commits": {}, "ttf": 34.000277777777775, "commitsDetails": []}, {"title": "[python] pulsar-client@2.5.2's dep on enum34@1.1.9 may break build systems", "body": "Enum34 appears to have had a regression of the below issue in 1.1.9 https://bitbucket.org/stoneleaf/enum34/issues/31/make-the-install-a-noop-on-python36\r\n\r\nThis breaks builds due to `AttributeError: module 'enum' has no attribute 'IntFlag'`\r\n\r\nRelated poetry issue: https://github.com/python-poetry/poetry/issues/1122#issuecomment-628037127\r\n\r\nSuggest using enum34@1.1.8 until this is fixed", "url": "https://github.com/apache/pulsar/issues/7050", "user": "curtiscook", "labels": ["component/python", "help wanted", "release/2.5.3", "triage/week-22", "type/bug"], "created": "2020-05-27 00:30:45", "closed": "2020-06-12 18:50:49", "commits": {}, "ttf": 16.00027777777778, "commitsDetails": []}, {"title": "NullPointerException with SubscriptionMode.NonDurable", "body": "If we try to create a consumer with `SubscriptionMode.NonDurable`  it will fail with a `NullPointerException`.\r\n\r\nWe try to mimic the behaviour of Reader with partitioned topics. \r\n\r\nIt can be reproduced this way:\r\n\r\n```\r\n\t\t\tfinal Consumer<T> consumer = client.newConsumer(schema).topic(topicUri)\r\n\t\t\t\t\t.readCompacted(true)\r\n\t\t\t\t\t.subscriptionMode(SubscriptionMode.NonDurable) \r\n                                        .subscriptionType(SubscriptionType.Exclusive)\r\n                                        .subscriptionName(subscription)\r\n\t\t\t\t\t.subscriptionInitialPosition(SubscriptionInitialPosition.Earliest)\r\n                                        .subscribe();\r\n```\r\n\r\nThe exception throw is the following:\r\n\r\n```\r\n\tjava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: java.lang.NullPointerException\r\n\t\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture.biRelay(CompletableFuture.java:1284) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture$BiRelay.tryFire(CompletableFuture.java:1270) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture$CoCompletion.tryFire(CompletableFuture.java:1020) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[na:1.8.0_111]\r\n\t\tat org.apache.pulsar.client.impl.ConsumerImpl.connectionFailed(ConsumerImpl.java:738) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.client.impl.ConnectionHandler.handleConnectionError(ConnectionHandler.java:78) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture$UniExceptionally.tryFire(CompletableFuture.java:852) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1962) ~[na:1.8.0_111]\r\n\t\tat org.apache.pulsar.client.impl.BinaryProtoLookupService.lambda$null$2(BinaryProtoLookupService.java:127) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:656) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:632) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1962) ~[na:1.8.0_111]\r\n\t\tat org.apache.pulsar.client.impl.ClientCnx.handleLookupResponse(ClientCnx.java:480) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:132) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:321) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:295) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat java.lang.Thread.run(Thread.java:745) ~[na:1.8.0_111]\r\n\tCaused by: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: java.lang.NullPointerException\r\n\t\t... 33 common frames omitted\r\n\tCaused by: java.util.concurrent.CompletionException: java.lang.NullPointerException\r\n\t\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:659) ~[na:1.8.0_111]\r\n\t\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:632) ~[na:1.8.0_111]\r\n\t\t... 30 common frames omitted\r\n\tCaused by: java.lang.NullPointerException: null\r\n\t\tat org.apache.pulsar.client.impl.ConsumerImpl.connectionOpened(ConsumerImpl.java:586) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat org.apache.pulsar.client.impl.ConnectionHandler.lambda$grabCnx$0(ConnectionHandler.java:68) ~[pulsar-client-2.5.2.jar:2.5.2]\r\n\t\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:656) ~[na:1.8.0_111]\r\n\t\t... 31 common frames omitted\t\t\r\n```", "url": "https://github.com/apache/pulsar/issues/7046", "user": "fmiguelez", "labels": ["component/client", "triage/week-22", "type/bug"], "created": "2020-05-26 13:55:44", "closed": "2020-06-02 07:52:03", "commits": {"3a49ad5f6e2217bc56f4d8e9d159260337234c11": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "3a49ad5f6e2217bc56f4d8e9d159260337234c11", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["870a637b4906862a611e418341dd926e21458f08"], "nameRev": "3a49ad5f6e2217bc56f4d8e9d159260337234c11 tags/v2.6.0-candidate-1~83", "commitMessage": "fix NullPointerException with SubscriptionMode.NonDurable (#7118)\n\nFixes #7046\r\n\r\n\r\n### Motivation\r\n\r\nThis code is to enable non-persistent subscriptions to continue to consume\uff0c based on the Id of the first message in the client's ReceiverQueue when reconnection is triggered.\r\n\r\nBut it's not considered the case that there is no messageId for the first connection. Therefore, we need to determine whether the MessageId is null.", "commitDateTime": "2020-06-02 15:52:02", "authoredDateTime": "2020-06-02 15:52:02", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/NonDurableSubscriptionTest.java", "insertions": 82, "deletions": 0, "lines": 82}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 3, "deletions": 3, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NonDurableSubscriptionTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.NonDurableSubscriptionTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.connectionOpened(org.apache.pulsar.client.impl.ClientCnx)", "TOT": 10, "UPD": 0, "INS": 3, "MOV": 7, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Producers failed to open when leader broker shut down", "body": "When a leader broker shut down, producers that connected with the broker failed to open on a new broker.\r\n\r\nAccording to the leader broker log, the broker unloaded bundles and closed producers.\r\nAlso, according to logs of other brokers, another broker became leader broker and bundles were loaded.\r\n\r\nHowever, producers that connected with the old leader broker reconnected with a new broker but some producers of ones failed to open on the new broker.\r\n\r\nAfter the producers reconnected with the new broker, they didn't send `CommandProducer` messages and stop.\r\nhttps://github.com/apache/pulsar/blob/d55bc00f34a2fa763a3756fa0adbb1366ae319bd/pulsar-common/src/main/proto/PulsarApi.proto#L406-L430\r\n\r\n#### Expected behavior\r\nWhen producers reconnect with a new broker, open on the broker.\r\n\r\n#### Actual behavior\r\nSome producers failed to open on the new broker.\r\n\r\n#### Steps to reproduce\r\nWe tried but haven't reproduced yet.\r\n\r\n#### System configuration\r\nOS(Broker): CentOS 7.7\r\nPulsar Broker: 2.3.2\r\nPulsar Client Java: 2.3.2", "url": "https://github.com/apache/pulsar/issues/7041", "user": "k2la", "labels": ["component/broker", "triage/week-22", "type/bug"], "created": "2020-05-26 06:05:57", "closed": "2020-05-31 02:20:51", "commits": {"04035c59d6b55479a443cc64e8351f4a467cc253": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "04035c59d6b55479a443cc64e8351f4a467cc253", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["ae324b1abdd11244df93e220e4fb0733115208aa"], "nameRev": "04035c59d6b55479a443cc64e8351f4a467cc253 tags/v2.6.0-candidate-1~103", "commitMessage": "Limit the number of times lookup requests are redirected (#7096)\n\nMaster Issue: #7041\r\n\r\n### Motivation\r\n\r\nWhen a leader broker is restarted, some producers for topics owned by that broker may not be reopened on the new broker. When this happens, message publishing will continue to fail until the client application is restarted.\r\n\r\nAs a result of the investigation, I found that lookup requests sent by the producers in question are redirected more than 10,000 times between multiple brokers.\r\n\r\nWhen a lookup request is redirected, `BinaryProtoLookupService#findBroker()` is called recursively. Therefore, tens of thousands of redirects will cause `StackOverflowError` and `BinaryProtoLookupService#findBroker()` will never complete.\r\n\r\n### Modifications\r\n\r\nLimit the number of times a lookup is redirected to 100. This maximum is user configurable. If the number of redirects exceeds 100, the lookup will fail. But `ConnectionHandler` retries lookup so that the producer can eventually reconnect to the new broker.", "commitDateTime": "2020-05-31 10:20:50", "authoredDateTime": "2020-05-31 11:20:50", "commitGitStats": [{"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/ClientBuilder.java", "insertions": 9, "deletions": 0, "lines": 9}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BinaryProtoLookupService.java", "insertions": 20, "deletions": 5, "lines": 25}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ClientBuilderImpl.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/HttpClient.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/conf/ClientConfigurationData.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/BinaryProtoLookupServiceTest.java", "insertions": 128, "deletions": 0, "lines": 128}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/conf/ConfigurationDataUtilsTest.java", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ClientBuilder.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.maxLookupRedirects(int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BinaryProtoLookupService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BinaryProtoLookupService", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BinaryProtoLookupService.findBroker(java.net.InetSocketAddress,boolean,org.apache.pulsar.common.naming.TopicName,int)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BinaryProtoLookupService.getBroker(org.apache.pulsar.common.naming.TopicName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BinaryProtoLookupService.findBroker(java.net.InetSocketAddress,boolean,org.apache.pulsar.common.naming.TopicName)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ClientBuilderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ClientBuilderImpl.maxLookupRedirects(int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "HttpClient.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.HttpClient", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ClientConfigurationData.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.conf.ClientConfigurationData", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BinaryProtoLookupServiceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BinaryProtoLookupServiceTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConfigurationDataUtilsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.conf.ConfigurationDataUtilsTest.testLoadClientConfigurationData()", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Ledger dir is redundant when using an existing bookkeeper cluster", "body": "**Describe the bug**\r\nCurrently, we can use an existing bookkeeper cluster by parameter `bookkeeperMetadataServiceUri` (based master branch), however, the ledger dir (`/ledgers`) is still created in pulsar metadata store when initialize cluster metadata. This may confuse some users when trying to locate bookie nodes.\r\n\r\n**Expected behavior**\r\nCreate the ledger dir when necessary.\r\n", "url": "https://github.com/apache/pulsar/issues/7033", "user": "ayolivia", "labels": ["component/storage", "help wanted", "triage/week-22", "type/bug"], "created": "2020-05-25 09:33:38", "closed": "2020-06-10 04:48:26", "commits": {"5421a4c36671823e70750995bfb1cef763ea48c1": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 15.000277777777777, "commitsDetails": [{"commitHash": "5421a4c36671823e70750995bfb1cef763ea48c1", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["3da6452195fab40033abb586d19a5d90510cb08c"], "nameRev": "5421a4c36671823e70750995bfb1cef763ea48c1 master~97", "commitMessage": "Remove redundant ledger dir creation when necessary (#7196)\n\n### Motivation\r\n\r\nFixes #7033\r\n\r\n### Modifications\r\n\r\nAdd the logic to handle the creation of ledger dir when using an existing bookkeeper cluster and a test for this.", "commitDateTime": "2020-06-09 21:48:25", "authoredDateTime": "2020-06-10 12:48:25", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/PulsarClusterMetadataSetup.java", "insertions": 14, "deletions": 7, "lines": 21}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/zookeeper/ClusterMetadataSetupTest.java", "insertions": 41, "deletions": 1, "lines": 42}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarClusterMetadataSetup.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.PulsarClusterMetadataSetup.main(java.lang.String[])", "TOT": 8, "UPD": 1, "INS": 3, "MOV": 4, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.PulsarClusterMetadataSetup.Arguments", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ClusterMetadataSetupTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.zookeeper.ClusterMetadataSetupTest.testSetupWithBkMetadataServiceUri()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "By default, presto SQL does not start the prometheus service", "body": "**Describe the bug**\r\n\r\nWhen starting `sql-worker` and using telnet to check the service, the following problems were found:\r\n\r\n```bash\r\ntelnet localhost:9092\r\n```\r\n\r\nOutput:\r\n\r\n```\r\nTrying 127.0.0.1...\r\ntelnet: connect to address 127.0.0.1: Connection refused\r\nTrying ::1...\r\ntelnet: connect to address ::1: Connection refused\r\ntelnet: Unable to connect to remote host\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. conf prometheus server on `conf/presto/catlog/pulsar.properties`:\r\n\r\n```\r\npulsar.stats-provider=org.apache.bookkeeper.stats.prometheus.PrometheusMetricsProvider\r\npulsar.stats-provider-configs={\"httpServerEnabled\":\"false\", \"prometheusStatsHttpPort\":\"9092\", \"prometheusStatsHttpEnable\":\"true\"}\r\n```\r\n\r\n2. ./bin/pulsar standalone\r\n3. ./bin/pulsar sql-worker run\r\n4. telnet localhost:9092\r\n\r\n**Expected behavior**\r\n\r\nUsers can correctly access port 9092.\r\n\r\n**Additional context**\r\n\r\nBut when we use the built-in connectors to write data to presto, we can access port 9092 normally.\r\n\r\n\r\nStart the built-in connector DataGeneratorSource and ingest some mock data.\r\n\r\n```\r\n./bin/pulsar-admin sources create --name generator --destinationTopicName generator_test --source-type data-generator\r\n```", "url": "https://github.com/apache/pulsar/issues/7029", "user": "wolfstudy", "labels": ["type/bug"], "created": "2020-05-25 05:17:21", "closed": "2020-05-25 08:22:41", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "In 2.5.2 Prometheus out metrics are always zero", "body": "**Describe the bug**\r\nIn 2.5.2, the Prometheus metrics that measure the out rate/throughput for topics are always zero. This is a regression from 2.5.1. Specifically, these two metrics seems to always be zero:\r\n\r\n* pulsar_throughput_out\r\n* pulsar_rate_out\r\n\r\nHere is a graph while publishing and consuming at the same time so that in rate == out rate:\r\n\r\n![image](https://user-images.githubusercontent.com/22917476/82732655-823d1200-9cdc-11ea-9795-7e911ca0cfbb.png)\r\n\r\nThe green line is in rate and the yellow line is out rate. The first part of the graph is running 2.5.2 and no out rate or throughput is recorded. Then I downgraded to 2.5.1. As you can see, the yellow line jumps up to be even with the green line, which is what I expect based on the producers/consumers. Then I upgraded back to 2.5.2 and the yellow line goes back to zero even though the producers/consumers configuration is unchanged.\r\n\r\nNote that the statics on the topics correctly report the out rate. This is only a problem with the Prometheus metrics.\r\n\r\nDocker image: apachepulsar/pulsar-all:2.5.2\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Connect to any topic so that its out rate is not zero.\r\n2. Query the metrics in Prometheus.\r\n3. Metrics always report zero.\r\n\r\n**Expected behavior**\r\nMetrics to accurately report the out rate and throughput.\r\n", "url": "https://github.com/apache/pulsar/issues/7022", "user": "cdbartholomew", "labels": ["component/stats", "triage/week-22", "type/bug"], "created": "2020-05-23 14:08:39", "closed": "2020-05-28 17:39:47", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "There are invalid links in the document", "body": "1.`REST API` menu is invalid\r\n\r\n![\u6355\u83b711111](https://user-images.githubusercontent.com/14244944/82417785-a0bdc600-9aae-11ea-952b-8010fa15d8c6.PNG)\r\n\r\n\r\n2.The page opened through the `REST` link of the `Admin Api` page is blank.\r\n![\u6355\u83b7222222](https://user-images.githubusercontent.com/14244944/82416881-5c7df600-9aad-11ea-8e6c-09c65eeb6b99.PNG)\r\n\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/7002", "user": "jiawulin001", "labels": ["component/documentation", "triage/week-21", "type/bug"], "created": "2020-05-20 07:29:27", "closed": "2020-05-27 22:41:39", "commits": {"adf650e258703af9246ebe0c0c27c1d600aee585": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 7.000277777777778, "commitsDetails": [{"commitHash": "adf650e258703af9246ebe0c0c27c1d600aee585", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["fb182c04c0137347ffefdd00d0e5d5bf27d979f6"], "nameRev": "adf650e258703af9246ebe0c0c27c1d600aee585 tags/v2.6.0-candidate-1~135", "commitMessage": "fixes RESTAPIs and Cli button not working. (#7038)\n\nFixes #7002 \r\n\r\n### Motivation\r\n\r\nthe `REST APIs` and `Cli` button only work in English ver. website.\r\n\r\n### Modifications\r\n\r\nCurrently, the site retrieve user selected version by `document.querySelector('a[href=\"/en/versions\"]')`. Therefore, when the language changes, this path will no longer exists(it will become `a[href=\"/zh-CN/versions\"]` for Chinese ver. for example).\r\nSo I changed another way that achieves the same goal, with the help of `logo` class.\r\nThe downside is that this new line of code might be ambiguous. So I added another line to comment it.\r\n\r\n### Verifying this change\r\n\r\n- [ yes ] Make sure that the change passes the CI checks.", "commitDateTime": "2020-05-27 15:41:38", "authoredDateTime": "2020-05-28 06:41:38", "commitGitStats": [{"filePath": "site2/website/static/js/custom.js", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "The `managedLedgerMaxEntriesPerLedger` parameter does not take effect", "body": "**Describe the bug**\r\n\r\nconf/standalone.conf:\r\n\r\n```\r\nmanagedLedgerMinLedgerRolloverTimeMinutes=2\r\nmanagedLedgerMaxEntriesPerLedger=5000\r\n```\r\n\r\nI'm testing offload-related functions locally, expecting the ledger to switch early, so the value of managedLedgerMaxEntriesPerLedger is set to 5000, but it seems that the parameter does not take effect. When the data in a ledger reaches 50000, the switch of ledger occurs\r\n\r\n**Expected behavior**\r\nThe `managedLedgerMaxEntriesPerLedger` parameter take effect\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/20965307/82416329-6a7f4700-9aac-11ea-9c40-48565a4d2d41.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - Pulsar Version: 2.5.1 and 2.5.2\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/7001", "user": "wolfstudy", "labels": ["component/storage", "triage/week-21", "type/bug"], "created": "2020-05-20 07:14:04", "closed": "2020-05-21 03:17:46", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Offload data from bk to aws-s3 error on 2.5.2", "body": "**Describe the bug**\r\n\r\nconf/standalone.conf:\r\n\r\n```\r\n managedLedgerOffloadDriver=aws-s3\r\n s3ManagedLedgerOffloadBucket=test-pulsar-offload\r\n s3ManagedLedgerOffloadRegion=us-west-2\r\n s3ManagedLedgerOffloadServiceEndpoint=http://s3.amazonaws.com\r\n```\r\n\r\nthe broker error as follows:\r\n\r\n```\r\nNarClassLoader@3a8dc651] info register aspect org.apache.pulsar.broker.zookeeper.aspectj.ClientCnxnAspect\r\n13:36:59.190 [pulsar-ordered-OrderedExecutor-6-0] INFO  org.apache.bookkeeper.mledger.offload.OffloaderUtils - Found and loaded 1 offloaders\r\n13:36:59.196 [pulsar-ordered-OrderedExecutor-6-0] ERROR org.apache.pulsar.broker.PulsarService - create ledgerOffloader failed for namespace public/functions\r\norg.apache.pulsar.broker.PulsarServerException: org.apache.pulsar.broker.PulsarServerException: Either s3ManagedLedgerOffloadRegion or s3ManagedLedgerOffloadServiceEndpoint must be set if s3 offload enabled\r\n\tat org.apache.pulsar.broker.PulsarService.createManagedLedgerOffloader(PulsarService.java:836) ~[org.apache.pulsar-pulsar-broker-2.5.2.jar:2.5.2]\r\n\tat org.apache.pulsar.broker.PulsarService.lambda$getManagedLedgerOffloader$4(PulsarService.java:800) ~[org.apache.pulsar-pulsar-broker-2.5.2.jar:2.5.2]\r\n\tat java.util.concurrent.ConcurrentHashMap.compute(ConcurrentHashMap.java:1877) ~[?:1.8.0_201]\r\n\tat org.apache.pulsar.broker.PulsarService.getManagedLedgerOffloader(PulsarService.java:792) ~[org.apache.pulsar-pulsar-broker-2.5.2.jar:2.5.2]\r\n\tat org.apache.pulsar.broker.service.BrokerService.lambda$getManagedLedgerConfig$33(BrokerService.java:1065) ~[org.apache.pulsar-pulsar-broker-2.5.2.jar:2.5.2]\r\n\tat org.apache.bookkeeper.mledger.util.SafeRun$2.safeRun(SafeRun.java:49) [org.apache.pulsar-managed-ledger-2.5.2.jar:2.5.2]\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_201]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_201]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.48.Final.jar:4.1.48.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_201]\r\nCaused by: org.apache.pulsar.broker.PulsarServerException: Either s3ManagedLedgerOffloadRegion or s3ManagedLedgerOffloadServiceEndpoint must be set if s3 offload enabled\r\n\tat org.apache.pulsar.broker.PulsarService.createManagedLedgerOffloader(PulsarService.java:829) ~[org.apache.pulsar-pulsar-broker-2.5.2.jar:2.5.2]\r\n\t... 10 more\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. connfig conf/standalone.conf\r\n2.  start pulsar 2.5.2 standalone\r\n\r\n**Expected behavior**\r\nThe broker can start normally\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/7000", "user": "wolfstudy", "labels": ["component/tieredstorage", "triage/week-21", "type/bug"], "created": "2020-05-20 07:08:40", "closed": "2020-06-19 04:04:55", "commits": {}, "ttf": 29.00027777777778, "commitsDetails": []}, {"title": "AuthorizationService isSuperUser is not check for allow* methods", "body": "**Describe the bug**\r\nNew allow* methods in AuthorizationService must check for isSuperUser.", "url": "https://github.com/apache/pulsar/issues/6988", "user": "KannarFr", "labels": ["type/bug"], "created": "2020-05-19 13:42:23", "closed": "2020-05-20 00:33:32", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Duplicated messages are sent to dead letter topic", "body": "**To Reproduce**\r\n1. Consumer config: SubscriptionMode=Shared, SubscriptionName=Test1, ack Timeout=10000ms, enable Dead Letter Policy and setMaxRedeliveryCount=3\r\n2. Run 3 Consumers with the above config in 3 parallel threads. The consumers will not send the ACK\r\n3. Send a message to the topic which the consumers are listening to\r\n4. Because the ACK will not be sent, the message will be sent to the dead letter topic after the redelivery count is exceeded.\r\n\r\n**Expected behavior**\r\nOnly one message is sent to dead-letters topic\r\n\r\n**Actual behavior**\r\nThe message is sent to the dead-letters topic twice\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6960", "user": "bigbang489", "labels": ["component/client", "help wanted", "triage/week-21", "type/bug"], "created": "2020-05-14 10:06:38", "closed": "2020-06-05 01:42:53", "commits": {"6926180966f45eb9c1499b7f0eb32ea2a1368fd6": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 21.00027777777778, "commitsDetails": [{"commitHash": "6926180966f45eb9c1499b7f0eb32ea2a1368fd6", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["5070b143eb0bde72368605df280b305304199376"], "nameRev": "6926180966f45eb9c1499b7f0eb32ea2a1368fd6 tags/v2.6.0-candidate-1~43", "commitMessage": "Fix Duplicated messages are sent to dead letter topic #6960 (#7021)\n\nFixes #6960\r\n\r\n\r\n### Motivation\r\n\r\nbug fix\r\n\r\n### Modifications\r\n\r\n\"UnAckedMessageTracker\" will call \"consumerBase.redeliverUnacknowledgedMessages\". There will be 2 steps here: \r\n1) Filter out the messages that need to enter the DLQ\r\n2) The remaining messages will be re-delivered via RedeliverUnacknowledgedMessages request\r\n\r\nThe problem appeared in the second step, when all messages were filtered out in the first step. If the MessageIdsList received by the broker is empty, it will trigger the reposting of all unackedMessages under this consumer.\r\n\r\nOther consumers will consume messages that exceed maxRedeliveryCount again, and then the messages will repeatedly enter DLQ\r\n\r\nTherefore, if all messages have been filtered out, the RedeliverUnacknowledgedMessages request should not be initiated. Just let \"processPossibleToDLQ\" send them to DLQ and ack.\r\n\r\n### Verifying this change\r\nunit test:\r\norg.apache.pulsar.client.api.DeadLetterTopicTest#testDuplicatedMessageSendToDeadLetterTopic\r\n", "commitDateTime": "2020-06-05 09:42:52", "authoredDateTime": "2020-06-05 09:42:52", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/DeadLetterTopicTest.java", "insertions": 81, "deletions": 3, "lines": 84}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 5, "deletions": 4, "lines": 9}], "commitSpoonAstDiffStats": [{"spoonFilePath": "DeadLetterTopicTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.DeadLetterTopicTest.testDuplicatedMessageSendToDeadLetterTopic()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.redeliverUnacknowledgedMessages(java.util.Set)", "TOT": 4, "UPD": 0, "INS": 1, "MOV": 3, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "pulsar Admin async http client thread number explode", "body": "**Describe the bug**\r\nWhen use pulsar flink connector to consume messages from pulsar topic, each pulsar source client will create a pulsar admin client to operate with pulsar brokers. In my situation, in a flink task manager, it consume 124 topics, but create 6k+ AsyncHttpClient to operate with pulsar broker, leading to flink task manager OOM.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. start pulsar flink connector to subscribe 100 topics\r\n2. monitor the each task manager's AsyncHttpClient number\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6939", "user": "hangc0276", "labels": ["type/bug"], "created": "2020-05-11 13:10:25", "closed": "2020-05-12 06:45:27", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "LocalRunner is Broken", "body": "**Describe the bug**\r\nThe LocalRunner class does not start a local thread runner instance for Java functions.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create an instance of the LocalRunner class inside a Java class\r\n2. Initialize it like so:\r\n \r\n`FunctionConfig functionConfig = \r\n\t   FunctionConfig.builder()\r\n\t    \t.className(WordCountFunction.class.getName())\r\n\t    \t.maxPendingAsyncRequests(Integer.valueOf(500))\r\n\t    \t.name(\"word-counter\")\r\n\t    \t.runtime(FunctionConfig.Runtime.JAVA)\r\n\t    \t.build()`\r\n\r\n\t  LocalRunner localRunner = \r\n\t    \tLocalRunner.builder()\r\n\t    \t\t.brokerServiceUrl(BROKER_URL)\r\n\t    \t\t.functionConfig(functionConfig)\r\n\t    \t\t.build();`\r\n3. Attach to the process with a debugger and set a breakpoint at line 360 of the LocalRunner class and attempt to step through to line 361\r\n4. See a \"silent\" NullPointerException is thrown in the following call; \r\n`instanceConfig.setMaxPendingAsyncRequests(functionConfig.getMaxPendingAsyncRequests());`  This is because the call to `getMaxPendingAsyncRequests()` returns null, even though I set it to a value in the FunctionConfig\r\n\r\n**Expected behavior**\r\nOne would expect the value I passed in to be set and for the LocalRunner to start the function inside a local thread\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nI have the code fix and will attach it to this ticket. Basically the issue is that there is a default value for that field inside the FunctionConfig class that is set as a direct assignment. However, since the class is Lombok annotated, that assignment gets ignored AND prevents assignments from occurring inside the builder as well.\r\n\r\nI have removed that assignment, and added an equivalent logic block to the `FunctionConfigUtils.inferMissingArguments` method to set a default value of 1000 if none is provided.\r\n", "url": "https://github.com/apache/pulsar/issues/6931", "user": "david-streamlio", "labels": ["component/functions", "triage/week-20", "type/bug"], "created": "2020-05-10 02:46:52", "closed": "2020-05-18 21:31:41", "commits": {}, "ttf": 8.000277777777777, "commitsDetails": []}, {"title": "Batched producer gets invalid message ID", "body": "**Describe the bug**\r\nWhen using a producer with batched messaging enabled, attempting to obtain the resultant message ID gives an invalid value.\r\n\r\nThis is with the C backed Go client.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nRun:\r\n```\r\npulsar-admin namespaces create public/test\r\n```\r\n\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\t\"fmt\"\r\n\t\"os\"\r\n\t\"sync\"\r\n\r\n\t\"github.com/apache/pulsar/pulsar-client-go/pulsar\"\r\n)\r\n\r\nfunc main() {\r\n\tif err := Main(); err != nil {\r\n\t\tfmt.Fprintf(os.Stderr, \"Error: %s\\n\", err)\r\n\t\tos.Exit(1)\r\n\t}\r\n\tos.Exit(0)\r\n}\r\n\r\nfunc Main() error {\r\n\tclient, err := pulsar.NewClient(pulsar.ClientOptions{\r\n\t\tURL: \"pulsar://localhost:6650\",\r\n\t})\r\n\tif err != nil {\r\n\t\treturn err\r\n\t}\r\n\r\n\tif err := Test(client, true); err != nil { return err }\r\n\tif err := Test(client, false); err != nil { return err }\r\n\r\n\treturn nil\r\n}\r\n\r\nfunc Test(client pulsar.Client, batching bool) error {\r\n\tproducer, err := client.CreateProducer(pulsar.ProducerOptions{\r\n\t\tTopic: \"persistent://public/test/test\",\r\n\t\tBatching: batching,\r\n\t})\r\n\tif err != nil { return err }\r\n\r\n\twg := sync.WaitGroup{}\r\n\r\n\tcallback := func(msgid pulsar.MessageID, err error) {\r\n\t\tfmt.Printf(\"MsgID: %x\\n\", msgid.Serialize())\r\n\t\twg.Done()\r\n\t}\r\n\r\n\tfmt.Printf(\"Batching: %v\\n\", batching)\r\n\r\n\twg.Add(5)\r\n\tfor i := 0; i < 5; i++ {\r\n\t\tproducer.SendAndGetMsgIDAsync(context.Background(), pulsar.ProducerMessage{\r\n\t\t\tKey:     \"abcd\",\r\n\t\t\tPayload: []byte(\"test\"),\r\n\t\t}, callback)\r\n\t}\r\n\r\n\twg.Wait()\r\n\r\n\treturn nil\r\n}\r\n```\r\n\r\n**Expected behavior**\r\nTo be able to obtain valid message IDs.\r\n\r\n**Screenshots**\r\n```\r\n2020/05/07 19:11:54.376 c_client.go:68: [info] INFO  | ConnectionPool:85 | Created connection for pulsar://localhost:6650\r\n2020/05/07 19:11:54.379 c_client.go:68: [info] INFO  | ClientConnection:330 | [127.0.0.1:58554 -> 127.0.0.1:6650] Connected to broker\r\n2020/05/07 19:11:54.382 c_client.go:68: [info] INFO  | BatchMessageContainer:43 | { BatchContainer [size = 0] [batchSizeInBytes_ = 0] [maxAllowedMessageBatchSizeInBytes_ = 131072] [maxAllowedNumMessagesInBatch_ = 1000] [topicName = persistent://public/test/test] [producerName_ = ] [batchSizeInBytes_ = 0] [numberOfBatchesSent = 0] [averageBatchSize = 0]} BatchMessageContainer constructed\r\n2020/05/07 19:11:54.382 c_client.go:68: [info] INFO  | HandlerBase:53 | [persistent://public/test/test, ] Getting connection from pool\r\n2020/05/07 19:11:54.384 c_client.go:68: [info] INFO  | ProducerImpl:151 | [persistent://public/test/test, ] Created producer on broker [127.0.0.1:58554 -> 127.0.0.1:6650] \r\nBatching: true\r\nMsgID: 08ffffffffffffffffff0110ffffffffffffffffff01\r\nMsgID: 08ffffffffffffffffff0110ffffffffffffffffff01\r\nMsgID: 08ffffffffffffffffff0110ffffffffffffffffff01\r\nMsgID: 08ffffffffffffffffff0110ffffffffffffffffff01\r\nMsgID: 08ffffffffffffffffff0110ffffffffffffffffff01\r\n2020/05/07 19:11:54.397 c_client.go:68: [info] INFO  | HandlerBase:53 | [persistent://public/test/test, ] Getting connection from pool\r\n2020/05/07 19:11:54.399 c_client.go:68: [info] INFO  | ProducerImpl:151 | [persistent://public/test/test, ] Created producer on broker [127.0.0.1:58554 -> 127.0.0.1:6650] \r\nBatching: false\r\nMsgID: 08501032\r\nMsgID: 08501033\r\nMsgID: 08501034\r\nMsgID: 08501035\r\nMsgID: 08501036\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Linux - Fedora 31\r\n\r\n**Additional context**\r\nClient library version 2.5.1 with server 2.5.1", "url": "https://github.com/apache/pulsar/issues/6913", "user": "phemmer", "labels": ["component/client", "component/go", "triage/week-19", "type/bug"], "created": "2020-05-07 23:15:59", "closed": "2020-05-08 15:02:53", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[Website] Links to generated client docs are broken", "body": "The links to the generated client docs on the website return `not found` for many of them. I have tried:\r\n\r\n* Java\r\n* Python\r\n* C++\r\n\r\nThey all reference 2.5.1-SNAPSHOT in the URL, but that doesn't seem to exist. \r\n\r\nThere is an example on this page:\r\n\r\n[https://pulsar.apache.org/docs/en/client-libraries-java/](https://pulsar.apache.org/docs/en/client-libraries-java/\r\n)\r\nThe links in the first table, column Package both return:\r\n\r\n```\r\nNot Found\r\nThe requested URL was not found on this server.\r\n```\r\n\r\nThe old versions (2.5.0-SNAPSHOT) are still there if I manually update the URL in my browwer, but it seems the latest 2.5.1 ones are missing.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6900", "user": "cdbartholomew", "labels": ["component/website", "triage/week-19", "type/bug"], "created": "2020-05-06 16:07:47", "closed": "2020-05-07 07:48:29", "commits": {"464df758429545f344e54ecd42727d7da61ec7e3": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "464df758429545f344e54ecd42727d7da61ec7e3", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["acb9276d87a41359fadfa4403145903411675634"], "nameRev": "464df758429545f344e54ecd42727d7da61ec7e3 tags/v2.6.0-candidate-1~230", "commitMessage": "Fixed client api error link (#6904)\n\nFixed https://github.com/apache/pulsar/issues/6900\r\n\r\n### Motivation\r\n\r\nThe current version only includes 2.5.0-SNAPSHOT, not 2.5.1-SNAPSHOT, so 2.5.0-SNAPSHOT is used.\r\n\r\n### Modifications\r\n\r\n* Fix version number replacement problem\r\n\r\n### Verifying this change\r\n\r\nLocal test pass", "commitDateTime": "2020-05-07 00:48:28", "authoredDateTime": "2020-05-07 15:48:28", "commitGitStats": [{"filePath": "site2/website/scripts/replace.js", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["464df758429545f344e54ecd42727d7da61ec7e3"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2, "deletions": 2, "lines": 4, "gitFilesChange": 1}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["site2/website/scripts/replace.js"]}, {"title": "topicPublishRateLimiter not effective after restart broker", "body": "when config set-publish-rate on namespaces\uff0cthen can limit publish rate, but when restart broker the limit has expired.\r\n\r\n1\u3001*config set-publish-rate *\r\n```bash\r\nsh pulsar-admin namespaces set-publish-rate -b -1 -m 200 public/test_rate\r\n```\r\n\r\n2\u3001*restart broker (only 1 broker)*\r\nAbstractTopic throw exception : CompletableFuture cannot cast Policies \r\n```\r\ntry {\r\n            policies = brokerService.pulsar().getConfigurationCache().policiesCache()\r\n                    .getDataIfPresent(AdminResource.path(POLICIES, TopicName.get(topic).getNamespace()));\r\n            if (policies == null) {\r\n                policies = new Policies();\r\n            }\r\n        } catch (Exception e) {\r\n            log.warn(\"[{}] Error getting policies {} and publish throttling will be disabled\", topic, e.getMessage());\r\n        }\r\n        updatePublishDispatcher(policies);\r\n```\r\nthen this.topicPublishRateLimiter = PublishRateLimiter.DISABLED_RATE_LIMITER \r\n```java\r\n  private void updatePublishDispatcher(Policies policies) {\r\n        final String clusterName = brokerService.pulsar().getConfiguration().getClusterName();\r\n        final PublishRate publishRate = policies != null && policies.publishMaxMessageRate != null\r\n                ? policies.publishMaxMessageRate.get(clusterName)\r\n                : null;\r\n        if (publishRate != null\r\n                && (publishRate.publishThrottlingRateInByte > 0 || publishRate.publishThrottlingRateInMsg > 0)) {\r\n            log.info(\"Enabling publish rate limiting {} on topic {}\", publishRate, this.topic);\r\n            // lazy init Publish-rateLimiting monitoring if not initialized yet\r\n            this.brokerService.setupTopicPublishRateLimiterMonitor();\r\n            if (this.topicPublishRateLimiter == null\r\n                    || this.topicPublishRateLimiter == PublishRateLimiter.DISABLED_RATE_LIMITER) {\r\n                // create new rateLimiter if rate-limiter is disabled\r\n                this.topicPublishRateLimiter = new PublishRateLimiterImpl(policies, clusterName);\r\n            } else {\r\n                this.topicPublishRateLimiter.update(policies, clusterName);\r\n            }\r\n        } else {\r\n            log.info(\"Disabling publish throttling for {}\", this.topic);\r\n            this.topicPublishRateLimiter = PublishRateLimiter.DISABLED_RATE_LIMITER;\r\n            enableProducerRead();\r\n        }\r\n    }\r\n```\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6892", "user": "liudezhi2098", "labels": ["release/2.5.2", "triage/week-19", "type/bug"], "created": "2020-05-06 12:40:31", "closed": "2020-05-13 05:07:45", "commits": {"1aaa148125a851536326d33f59434e3aae456096": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "b3c05ba53418703bf08d59f6c23b4dae76e31582": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "1aaa148125a851536326d33f59434e3aae456096", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["3198f4ffab051b237aa7692b1451cd933eb80f98"], "nameRev": "1aaa148125a851536326d33f59434e3aae456096 tags/v2.6.0-candidate-1~199", "commitMessage": "fix topicPublishRateLimiter not effective after restart broker (#6893)\n\nMaster Issue: #6892\r\n## Motivation\r\n\r\nwhen config set-publish-rate on namespaces\uff0cthen can limit publish rate, but when restart broker the limit has expired.\r\n\r\n## Modifications\r\n\r\nmodify get the acquisition policy sync way, any namespaces will save a policy on zk.\r\n```java\r\n        try {\r\n            policies = brokerService.pulsar().getConfigurationCache().policiesCache()\r\n                    .get(AdminResource.path(POLICIES, TopicName.get(topic).getNamespace()))\r\n                    .orElseGet(() -> new Policies());\r\n        } catch (Exception e) {\r\n            log.warn(\"[{}] Error getting policies {} and publish throttling will be disabled\", topic, e.getMessage());\r\n        }\r\n```", "commitDateTime": "2020-05-13 13:07:44", "authoredDateTime": "2020-05-13 13:07:44", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java", "insertions": 2, "deletions": 4, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AbstractTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic", "TOT": 4, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 1}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "b3c05ba53418703bf08d59f6c23b4dae76e31582", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["2dae2b5d2ea4eb689f8f181b9a5326398ce1687b"], "nameRev": "b3c05ba53418703bf08d59f6c23b4dae76e31582 tags/v2.5.2-candidate-1~3", "commitMessage": "fix topicPublishRateLimiter not effective after restart broker (#6893)\n\nMaster Issue: #6892\n## Motivation\n\nwhen config set-publish-rate on namespaces\uff0cthen can limit publish rate, but when restart broker the limit has expired.\n\n## Modifications\n\nmodify get the acquisition policy sync way, any namespaces will save a policy on zk.\n```java\n        try {\n            policies = brokerService.pulsar().getConfigurationCache().policiesCache()\n                    .get(AdminResource.path(POLICIES, TopicName.get(topic).getNamespace()))\n                    .orElseGet(() -> new Policies());\n        } catch (Exception e) {\n            log.warn(\"[{}] Error getting policies {} and publish throttling will be disabled\", topic, e.getMessage());\n        }\n```\n(cherry picked from commit 1aaa148125a851536326d33f59434e3aae456096)\n", "commitDateTime": "2020-05-13 13:09:03", "authoredDateTime": "2020-05-13 13:07:44", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java", "insertions": 2, "deletions": 4, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AbstractTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic", "TOT": 4, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "ttlDurationDefaultInSeconds is not applied", "body": "Pulsar 2.5.0\r\nbroker.conf has ttlDurationDefaultInSeconds=3600\r\nBut when creating a new namespace it is still created with ttl 0.", "url": "https://github.com/apache/pulsar/issues/6887", "user": "trexinc", "labels": ["component/broker", "help wanted", "triage/week-19", "type/bug"], "created": "2020-05-06 06:59:25", "closed": "2020-05-12 10:53:07", "commits": {"a24203cc140a97940bca99ca7a761c7e5e78c49c": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "f428d84b2448ac83607124a7794ba2bdc25028fb": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "a24203cc140a97940bca99ca7a761c7e5e78c49c", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["0b803a83fbbe873020cdf18f8259ea92584492ec"], "nameRev": "a24203cc140a97940bca99ca7a761c7e5e78c49c tags/v2.6.0-candidate-1~202", "commitMessage": "[Issue 6887][pulsar-broker] ttlDurationDefaultInSeconds not applying (#6920)\n\nFixes #6887 \r\n\r\n### Motivation\r\nThe ttl for namespaces should be retrieved from broker's configuration if it is not configured at namespace policies. However, the current code only returns the value stored in namespace policies directly without judging if it is configured or not.\r\n\r\n### Modifications\r\n\r\nAdded a condition to test if ttl is configured at namespace policies. If not, retrieve value stored in broker's configuration and return it as output.\r\n\r\n* fixes \"ttlDurationDefaultInSeconds is not applied\"\r\n\r\n* testcase added for getTtlDurationDefaultInSeconds", "commitDateTime": "2020-05-12 18:53:06", "authoredDateTime": "2020-05-12 18:53:06", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java", "insertions": 7, "deletions": 0, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.mergeNamespaceWithDefaults(org.apache.pulsar.common.policies.data.Policies,java.lang.String,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.testGetTtlDurationDefaultInSeconds()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "f428d84b2448ac83607124a7794ba2bdc25028fb", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["4095bdf556494684c890813af3ab8806f2ac9405"], "nameRev": "f428d84b2448ac83607124a7794ba2bdc25028fb tags/v2.5.2-candidate-1~6", "commitMessage": "[Issue 6887][pulsar-broker] ttlDurationDefaultInSeconds not applying (#6920)\n\nFixes #6887\n\n### Motivation\nThe ttl for namespaces should be retrieved from broker's configuration if it is not configured at namespace policies. However, the current code only returns the value stored in namespace policies directly without judging if it is configured or not.\n\n### Modifications\n\nAdded a condition to test if ttl is configured at namespace policies. If not, retrieve value stored in broker's configuration and return it as output.\n\n* fixes \"ttlDurationDefaultInSeconds is not applied\"\n\n* testcase added for getTtlDurationDefaultInSeconds\n(cherry picked from commit a24203cc140a97940bca99ca7a761c7e5e78c49c)\n", "commitDateTime": "2020-05-12 21:42:54", "authoredDateTime": "2020-05-12 18:53:06", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java", "insertions": 7, "deletions": 0, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.mergeNamespaceWithDefaults(org.apache.pulsar.common.policies.data.Policies,java.lang.String,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.testGetTtlDurationDefaultInSeconds()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": " the brokerPublisherThrPottlingTickTimeMillis config  spelling mistake", "body": "the brokerPublisherThrPottlingTickTimeMillis config  spelling mistake", "url": "https://github.com/apache/pulsar/issues/6876", "user": "liudezhi2098", "labels": ["release/2.5.2", "triage/week-19", "type/bug"], "created": "2020-05-05 08:52:29", "closed": "2020-05-12 12:53:44", "commits": {"65dc9d99924e5ec00952a81c7091195304baa58e": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "aed2c17f3d8c70d5d66a3e1ff4c442fa0e4cde7e": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 7.000277777777778, "commitsDetails": [{"commitHash": "65dc9d99924e5ec00952a81c7091195304baa58e", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["a24203cc140a97940bca99ca7a761c7e5e78c49c"], "nameRev": "65dc9d99924e5ec00952a81c7091195304baa58e tags/v2.6.0-candidate-1~201", "commitMessage": "fix brokerPublisherThrottlingTickTimeMillis in broker.conf (#6877)\n\nMaster Issue: #6876\r\n\r\nMotivation\r\nthe brokerPublisherThrPottlingTickTimeMillis config spelling mistake\r\n\r\nModifications\r\nbroker.conf\r\n\r\n  # Tick time to schedule task that checks broker publish rate limiting across all topics\r\n# Reducing to lower value can give more accuracy while throttling publish but\r\n# it uses more CPU to perform frequent check. (Disable publish throttling with value 0)\r\nbrokerPublisherThrottlingTickTimeMillis=50\r\n\r\n\r\n* fix brokerPublisherThrottlingTickTimeMillis in broker.conf\r\n\r\n* fix brokerPublisherThrottlingTickTimeMillis in standalone.conf\r\n\r\nCo-authored-by: dezhiliu <dezhiliu@tencent.com>", "commitDateTime": "2020-05-12 20:53:43", "authoredDateTime": "2020-05-12 20:53:43", "commitGitStats": [{"filePath": "conf/broker.conf", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "conf/standalone.conf", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "aed2c17f3d8c70d5d66a3e1ff4c442fa0e4cde7e", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["f428d84b2448ac83607124a7794ba2bdc25028fb"], "nameRev": "aed2c17f3d8c70d5d66a3e1ff4c442fa0e4cde7e tags/v2.5.2-candidate-1~5", "commitMessage": "fix brokerPublisherThrottlingTickTimeMillis in broker.conf (#6877)\n\nMaster Issue: #6876\n\nMotivation\nthe brokerPublisherThrPottlingTickTimeMillis config spelling mistake\n\nModifications\nbroker.conf\n\n  # Tick time to schedule task that checks broker publish rate limiting across all topics\n# Reducing to lower value can give more accuracy while throttling publish but\n# it uses more CPU to perform frequent check. (Disable publish throttling with value 0)\nbrokerPublisherThrottlingTickTimeMillis=50\n\n* fix brokerPublisherThrottlingTickTimeMillis in broker.conf\n\n* fix brokerPublisherThrottlingTickTimeMillis in standalone.conf\n\nCo-authored-by: dezhiliu <dezhiliu@tencent.com>(cherry picked from commit 65dc9d99924e5ec00952a81c7091195304baa58e)\n", "commitDateTime": "2020-05-12 21:43:04", "authoredDateTime": "2020-05-12 20:53:43", "commitGitStats": [{"filePath": "conf/broker.conf", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "conf/standalone.conf", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Wrong auth provider check on broker's originalRole auth check", "body": "**Describe the bug**\r\nIf a proxy has a auth provider A, and the proxy to broker has a B auth provider usage. The broker originalAuth check uses B instead of A.\r\n", "url": "https://github.com/apache/pulsar/issues/6873", "user": "KannarFr", "labels": ["component/proxy", "triage/week-19", "type/bug"], "created": "2020-05-04 20:28:48", "closed": "2020-05-09 00:46:01", "commits": {"8381371a3cdae52521c8d50ca053d7510989fb33": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "450cc152277fe4dd64c68097dfc9feee75ecce27": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "8381371a3cdae52521c8d50ca053d7510989fb33", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["8a752d30b7f11e4fc4478122a899a173679a4ad3"], "nameRev": "8381371a3cdae52521c8d50ca053d7510989fb33 tags/v2.6.0-candidate-1~218", "commitMessage": "use originalAuthMethod on originalAuthChecker (#6870)\n\nFixes #6873\r\n\r\nUse originalAuthMethod on originalAuthProvider check.", "commitDateTime": "2020-05-08 17:46:00", "authoredDateTime": "2020-05-09 02:46:00", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 15, "deletions": 1, "lines": 16}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleConnect(org.apache.pulsar.common.api.proto.PulsarApi.CommandConnect)", "TOT": 5, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "450cc152277fe4dd64c68097dfc9feee75ecce27", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["7a71328a597fe04a942b7d105391bb30297534e6"], "nameRev": "450cc152277fe4dd64c68097dfc9feee75ecce27 tags/v2.5.2-candidate-1~19", "commitMessage": "use originalAuthMethod on originalAuthChecker (#6870)\n\nFixes #6873\n\nUse originalAuthMethod on originalAuthProvider check.\n(cherry picked from commit 8381371a3cdae52521c8d50ca053d7510989fb33)\n", "commitDateTime": "2020-05-12 21:28:45", "authoredDateTime": "2020-05-09 02:46:00", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 15, "deletions": 1, "lines": 16}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleConnect(org.apache.pulsar.common.api.proto.PulsarApi.CommandConnect)", "TOT": 5, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Producer cannot connect after Unloading bundle", "body": "**Describe the bug**\r\nI have 2 pulsar clusters in Beijing and Guangzhou, each with 2 physics machine deployed broker nodes.\r\n1\u3001There are 5 producers in this Topic. After multiple shed loads it was found that some of the producers were unable to connect to the pulsar, and the producers that were unable to connect at the same time when the broker of the ownership was different. For example, broker numbers A and B, producers 1,2 and 3 can't connect when the townership of that topic is A; 3, 4, and 5 can't connect when the ownership is B.\r\nchecking the broker log revealed that there was an exception that kept outputting `Producer with id persistent://xxx/xxx/xxx is already present on the connection`.\r\nI looked at the broker logs and found that when `Unloading bundle` occurs, a producer node will output a log of a `[ForkJoinPool.commonPool-worker-24] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.1.116.123:15070][xxxx] Creating producer. producerId=0` immediately after `Disconnecting producer:`, and this `Creating producer` has no subsequent results (either created successfully or failed). Then when the Unloading bundle occurs again and the downtownership of the topic returns to the broker, the producer node keeps having an exception that is `Producer with id [xxx] already present on the connection`.\r\nhttps://github.com/apache/pulsar/blob/f2afad353795f70c00910b6dcce5df8c62b94a67/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java#L900\r\nhttps://github.com/apache/pulsar/blob/f2afad353795f70c00910b6dcce5df8c62b94a67/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Producer.java#L516\r\nhttps://github.com/apache/pulsar/blob/f2afad353795f70c00910b6dcce5df8c62b94a67/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java#L892\r\nI think that for some reason the process of `ServerCnx#handleProducer` was interrupted, and then the CompleteFuture<Producer> corresponding to the producerId in that ServerCnx couldn't complete or exception, causing the producer using that connection to fail to connect.\r\n2\u3001geo-replication of an exception `Producer with name 'pulsar.repl.bj-xxx-product' is already connected to topic`\r\n\r\n**To Reproduce**\r\nUnfortunately, I cannot reproduce the problem in a local environement.But now in the production environment has emerged.\r\n\r\n**Expected behavior**\r\nThe producer can connect properly.\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/8822016/80999100-b60fdf00-8e76-11ea-8042-94a1bb67828c.png)\r\n\r\ngeo-replication\r\n![image](https://user-images.githubusercontent.com/8822016/80998885-4a2d7680-8e76-11ea-9fad-93d409f75976.png)\r\n**Desktop (please complete the following information):**\r\npulsar 2.5.0\r\n\r\n**Additional context**\r\nAttached is the log of one of the unloading bundles.\r\n[UnloadingBundle.log](https://github.com/apache/pulsar/files/4576535/UnloadingBundle.log)\r\n", "url": "https://github.com/apache/pulsar/issues/6872", "user": "zyllt", "labels": ["component/broker", "component/client", "release/2.5.2", "triage/week-19", "type/bug"], "created": "2020-05-04 18:29:40", "closed": "2020-05-06 07:15:20", "commits": {"30e26f84fbd35c2f88665195c426a73336a6fc1f": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "1856f2f8a41f092d5758f88f230c4a3b32e59f85": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "30e26f84fbd35c2f88665195c426a73336a6fc1f", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["1a8adfe8c628c3890231cfb3fd74c5bb412b3bf2"], "nameRev": "30e26f84fbd35c2f88665195c426a73336a6fc1f tags/v2.6.0-candidate-1~234", "commitMessage": "[Broker] Handle all exceptions from `topic.addProducer` (#6881)\n\nFixes #6872\r\nFixes #6416\r\n\r\nIf a producer tries to create a producer to a topic that is currently\r\nunloading, we can get a `RuntimeException` from\r\n`BrokerService.checkTopicNsOwnership` which is bubbled up through\r\n`topic.addProducer`. By only handling a `BrokerServiceException` this\r\nresults in a future that never completes and results in producers not\r\nbeing able to be created if this topic is scheduled back to this broker.", "commitDateTime": "2020-05-06 15:15:19", "authoredDateTime": "2020-05-06 01:15:19", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": []}], "spoonStatsSkippedReason": ""}, {"commitHash": "1856f2f8a41f092d5758f88f230c4a3b32e59f85", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["53f74c7fd9eb0bf4a81f09d2dc1ab0a7895e1b97"], "nameRev": "1856f2f8a41f092d5758f88f230c4a3b32e59f85 tags/v2.5.2-candidate-1~30", "commitMessage": "[Broker] Handle all exceptions from `topic.addProducer` (#6881)\n\nFixes #6872\nFixes #6416\n\nIf a producer tries to create a producer to a topic that is currently\nunloading, we can get a `RuntimeException` from\n`BrokerService.checkTopicNsOwnership` which is bubbled up through\n`topic.addProducer`. By only handling a `BrokerServiceException` this\nresults in a future that never completes and results in producers not\nbeing able to be created if this topic is scheduled back to this broker.\n(cherry picked from commit 30e26f84fbd35c2f88665195c426a73336a6fc1f)\n", "commitDateTime": "2020-05-08 17:54:40", "authoredDateTime": "2020-05-06 01:15:19", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": []}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Python Pulsar Function Crash With customRuntimeOptions", "body": "**Describe the bug**\r\n\r\nIf the python function is created with --custom-runtime-options, it will crash with `google.protobuf.json_format.ParseError: Message type \"proto.FunctionDetails\" has no field named \"customRuntimeOptions\".`\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Write a python pulsar function:\r\n```python\r\nfrom pulsar import Function\r\n\r\nclass RandomFunction(Function):\r\n    def process(self, item, context):\r\n        context.get_logger().info(context.get_message_id())\r\n```\r\n\r\n2. Deploy with the command:\r\n\r\n```\r\nbin/pulsar-admin functions create --py rand.py \\\r\n--classname rand.RandomFunction \\\r\n--inputs persistent://public/default/random \\\r\n--custom-runtime-options '{\"resourceRequirements\":{\"limits\":{\"memory\":\"64Mi\"}}}'\r\n```\r\n\r\n3. See error\r\n\r\n```\r\n\u25b6 kubectl logs -f pf-public-default-randomfunction-e5521ea1-0\r\n\"Downloaded successfully\"\r\nshardId=0\r\nTraceback (most recent call last):\r\n  File \"/pulsar/instances/python-instance/python_instance_main.py\", line 211, in <module>\r\n    main()\r\n  File \"/pulsar/instances/python-instance/python_instance_main.py\", line 98, in main\r\n    json_format.Parse(args.function_details, function_details)\r\n  File \"/usr/local/lib/python2.7/dist-packages/google/protobuf/json_format.py\", line 430, in Parse\r\n    return ParseDict(js, message, ignore_unknown_fields, descriptor_pool)\r\n  File \"/usr/local/lib/python2.7/dist-packages/google/protobuf/json_format.py\", line 450, in ParseDict\r\n    parser.ConvertMessage(js_dict, message)\r\n  File \"/usr/local/lib/python2.7/dist-packages/google/protobuf/json_format.py\", line 481, in ConvertMessage\r\n    self._ConvertFieldValuePair(value, message)\r\n  File \"/usr/local/lib/python2.7/dist-packages/google/protobuf/json_format.py\", line 592, in _ConvertFieldValuePair\r\n    raise ParseError(str(e))\r\ngoogle.protobuf.json_format.ParseError: Message type \"proto.FunctionDetails\" has no field named \"customRuntimeOptions\".\r\n Available Fields(except extensions): ['tenant', 'namespace', 'name', 'className', 'logTopic', 'processingGuarantees', 'userConfig', 'secretsMap', 'runtime', 'autoAck', 'parallelism', 'source', 'sink', 'resources', 'packageUrl', 'retryDetails', 'runtimeFlags', 'componentType']\r\n```\r\n\r\n**Expected behavior**\r\nMessage \"proto.FunctionDetails\" should accept \"customRuntimeOptions\".\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - Pulsar Docker Image pulsar-all 2.5.1\r\n - k8s helm\r\n", "url": "https://github.com/apache/pulsar/issues/6858", "user": "rueian", "labels": ["component/functions", "component/python", "triage/week-19", "type/bug"], "created": "2020-05-02 10:54:03", "closed": "2020-05-07 02:50:21", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "Consumer stuck with batch receive when batchingMaxMessages greater than receiverQueueSize", "body": "**Describe the bug**\r\nConsumer stuck with batch receive when batchingMaxMessages greater than receiverQueueSize\r\n\r\n**To Reproduce**\r\n```java\r\nconsumer = clientProviderForTests.getPulsarClient().newConsumer()\r\n        .subscriptionName(\"disconnections3\")\r\n        .topic(\"public/default/test\")\r\n        .receiverQueueSize(500)\r\n        .batchReceivePolicy(BatchReceivePolicy.builder().maxNumBytes(1024*1024).maxNumMessages(3000).build())\r\n        .subscribe();\r\n```\r\n\r\n**Expected behavior**\r\nThe consumer can consume messages when `batchingMaxMessages` greater than `receiverQueueSize`.\r\n\r\n**Additional context**\r\nversion 2.5.1 and build from the master branch", "url": "https://github.com/apache/pulsar/issues/6854", "user": "codelipenghui", "labels": ["release/2.5.2", "type/bug"], "created": "2020-05-01 01:27:50", "closed": "2020-05-11 00:41:12", "commits": {"561868d4c441d654ab795a9386d8e9a5e28f03dd": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "c6bbfc6d59c83ee78688b4b7dd177277aa8e4c72": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 9.000277777777777, "commitsDetails": [{"commitHash": "561868d4c441d654ab795a9386d8e9a5e28f03dd", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["30934e16eacb83c34a6691db3d9ad294d260599e"], "nameRev": "561868d4c441d654ab795a9386d8e9a5e28f03dd tags/v2.6.0-candidate-1~214", "commitMessage": "fix consumer stuck when batchReceivePolicy maxNumMessages > maxReceiverQueueSize (#6862)\n\nFix #6854 \r\n\r\n### Bug description\r\nThe consumer stuck due to `hasEnoughMessagesForBatchReceive` checking:\r\n```\r\nprotected boolean hasEnoughMessagesForBatchReceive() {\r\n        if (batchReceivePolicy.getMaxNumMessages() <= 0 && batchReceivePolicy.getMaxNumBytes() <= 0) {\r\n            return false;\r\n        }\r\n        return (batchReceivePolicy.getMaxNumMessages() > 0 && incomingMessages.size() >= batchReceivePolicy.getMaxNumMessages())\r\n                || (batchReceivePolicy.getMaxNumBytes() > 0 && INCOMING_MESSAGES_SIZE_UPDATER.get(this) >= batchReceivePolicy.getMaxNumBytes());\r\n    }\r\n```\r\n\r\n### Changes\r\nWhen batchReceivePolicy maxNumMessages > maxReceiverQueueSize, we force batch receivePolicy maxNumMessages to maxReceiverQueueSize to avoid consumer stuck when checking `hasEnoughMessagesForBatchReceive`\r\n\r\n\r\n* fix consumer stuck when batchReceivePolicy maxNumMessages > maxReceiverQueueSize\r\n\r\n* throw log warn and add test case", "commitDateTime": "2020-05-11 08:41:11", "authoredDateTime": "2020-05-11 08:41:11", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/ConsumerBatchReceiveTest.java", "insertions": 98, "deletions": 26, "lines": 124}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/BatchReceivePolicy.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 28, "deletions": 1, "lines": 29}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConsumerBatchReceiveTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveAndRedelivery(java.lang.String,org.apache.pulsar.client.api.BatchReceivePolicy,boolean)", "TOT": 5, "UPD": 3, "INS": 0, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveAsync(java.lang.String,org.apache.pulsar.client.api.BatchReceivePolicy,boolean)", "TOT": 4, "UPD": 3, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceive(java.lang.String,org.apache.pulsar.client.api.BatchReceivePolicy,boolean)", "TOT": 4, "UPD": 3, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveNonPartitionedTopic(org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceivePartitionedTopic(org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testAsyncBatchReceiveNonPartitionedTopic(org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testAsyncBatchReceivePartitionedTopic(org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveAndRedeliveryNonPartitionedTopic(org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveAndRedeliveryPartitionedTopic(org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceive(java.lang.String,org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveAsync(java.lang.String,org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveAndRedelivery(java.lang.String,org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.batchReceivePolicyProvider()", "TOT": 20, "UPD": 0, "INS": 20, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchReceivePolicy.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.BatchReceivePolicy.getMaxNumBytes()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase", "TOT": 9, "UPD": 0, "INS": 4, "MOV": 4, "DEL": 1}]}, {"spoonFilePath": "MultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.seek(long)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.completeOpBatchReceive(org.apache.pulsar.client.impl.OpBatchReceive)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "c6bbfc6d59c83ee78688b4b7dd177277aa8e4c72", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["0dfb4822b3298415c73a60add8da61df638592b9"], "nameRev": "c6bbfc6d59c83ee78688b4b7dd177277aa8e4c72 tags/v2.5.2-candidate-1~16", "commitMessage": "fix consumer stuck when batchReceivePolicy maxNumMessages > maxReceiverQueueSize (#6862)\n\nFix #6854\n\n### Bug description\nThe consumer stuck due to `hasEnoughMessagesForBatchReceive` checking:\n```\nprotected boolean hasEnoughMessagesForBatchReceive() {\n        if (batchReceivePolicy.getMaxNumMessages() <= 0 && batchReceivePolicy.getMaxNumBytes() <= 0) {\n            return false;\n        }\n        return (batchReceivePolicy.getMaxNumMessages() > 0 && incomingMessages.size() >= batchReceivePolicy.getMaxNumMessages())\n                || (batchReceivePolicy.getMaxNumBytes() > 0 && INCOMING_MESSAGES_SIZE_UPDATER.get(this) >= batchReceivePolicy.getMaxNumBytes());\n    }\n```\n\n### Changes\nWhen batchReceivePolicy maxNumMessages > maxReceiverQueueSize, we force batch receivePolicy maxNumMessages to maxReceiverQueueSize to avoid consumer stuck when checking `hasEnoughMessagesForBatchReceive`\n\n* fix consumer stuck when batchReceivePolicy maxNumMessages > maxReceiverQueueSize\n\n* throw log warn and add test case\n(cherry picked from commit 561868d4c441d654ab795a9386d8e9a5e28f03dd)\n", "commitDateTime": "2020-05-12 21:32:04", "authoredDateTime": "2020-05-11 08:41:11", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/ConsumerBatchReceiveTest.java", "insertions": 98, "deletions": 26, "lines": 124}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/BatchReceivePolicy.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 28, "deletions": 1, "lines": 29}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConsumerBatchReceiveTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveAndRedelivery(java.lang.String,org.apache.pulsar.client.api.BatchReceivePolicy,boolean)", "TOT": 5, "UPD": 3, "INS": 0, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveAsync(java.lang.String,org.apache.pulsar.client.api.BatchReceivePolicy,boolean)", "TOT": 4, "UPD": 3, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceive(java.lang.String,org.apache.pulsar.client.api.BatchReceivePolicy,boolean)", "TOT": 4, "UPD": 3, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveNonPartitionedTopic(org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceivePartitionedTopic(org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testAsyncBatchReceiveNonPartitionedTopic(org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testAsyncBatchReceivePartitionedTopic(org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveAndRedeliveryNonPartitionedTopic(org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveAndRedeliveryPartitionedTopic(org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceive(java.lang.String,org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveAsync(java.lang.String,org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.testBatchReceiveAndRedelivery(java.lang.String,org.apache.pulsar.client.api.BatchReceivePolicy,boolean,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ConsumerBatchReceiveTest.batchReceivePolicyProvider()", "TOT": 20, "UPD": 0, "INS": 20, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchReceivePolicy.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.BatchReceivePolicy.getMaxNumBytes()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase", "TOT": 9, "UPD": 0, "INS": 4, "MOV": 4, "DEL": 1}]}, {"spoonFilePath": "MultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.seek(long)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.completeOpBatchReceive(org.apache.pulsar.client.impl.OpBatchReceive)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[Pulsar SQL] multiple zk servers issue", "body": "**Describe the bug**\r\n\r\n\r\nPulsar SQL documentation indicates:\r\n\r\n```\r\npulsar.zookeeper-uri=localhost1,localhost2:2181\r\n```\r\n\r\nIt doesn't work, I tried:\r\n\r\n```\r\npulsar.zookeeper-uri=localhost1:2181,localhost2:2181\r\n```\r\n\r\nAnd same issue.\r\n\r\nBut for\r\n\r\n```\r\npulsar.zookeeper-uri=localhost1:2181\r\n```\r\n\r\nIt works.\r\n\r\n\r\nWhen it doesn't work, it throws:\r\n\r\n```\r\n2020-04-30T12:33:53.229Z        INFO    Query-20200430_123351_00000_ak294-159   org.apache.zookeeper.common.X509Util    Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation\r\n2020-04-30T12:33:53.233Z        INFO    Query-20200430_123351_00000_ak294-159   org.apache.zookeeper.ClientCnxnSocket   jute.maxbuffer value is 4194304 Bytes\r\n2020-04-30T12:33:53.239Z        INFO    Query-20200430_123351_00000_ak294-159   org.apache.zookeeper.ClientCnxn zookeeper.request.timeout value is 0. feature enabled=\r\n2020-04-30T12:33:53.247Z        INFO    Query-20200430_123351_00000_ak294-159-SendThread(yo-zookeeper-c2-n3:2184)      org.apache.zookeeper.ClientCnxnOpening socket connection to server yo-zookeeper-c2-n3/192.168.10.6:2184. Will not attempt to authenticate using SASL (unknown error)\r\n2020-04-30T12:33:53.253Z        INFO    Query-20200430_123351_00000_ak294-159-SendThread(yo-zookeeper-c2-n3:2184)      org.apache.zookeeper.ClientCnxnSocket connection established, initiating session, client: /192.168.10.17:56234, server: yo-zookeeper-c2-n3/192.168.10.6:2184\r\n2020-04-30T12:33:53.273Z        INFO    Query-20200430_123351_00000_ak294-159-SendThread(yo-zookeeper-c2-n3:2184)      org.apache.zookeeper.ClientCnxnSession establishment complete on server yo-zookeeper-c2-n3/192.168.10.6:2184, sessionid = 0x308edaa37a20019, negotiated timeout = 10000\r\n2020-04-30T12:33:53.276Z        INFO    Query-20200430_123351_00000_ak294-159-EventThread       org.apache.bookkeeper.zookeeper.ZooKeeperWatcherBase    ZooKeeper client is connected now.\r\n2020-04-30T12:33:53.306Z        INFO    Query-20200430_123351_00000_ak294-159   org.apache.bookkeeper.meta.MetadataDrivers      BookKeeper metadata driver manager initialized\r\n2020-04-30T12:33:53.307Z        INFO    Query-20200430_123351_00000_ak294-159   org.apache.bookkeeper.meta.MetadataDrivers      BookKeeper metadata driver manager initialized\r\n2020-04-30T12:33:53.307Z        INFO    Query-20200430_123351_00000_ak294-159   org.apache.bookkeeper.meta.MetadataDrivers      BookKeeper metadata driver manager initialized\r\n2020-04-30T12:33:53.310Z        INFO    Query-20200430_123351_00000_ak294-159   org.apache.bookkeeper.meta.zk.ZKMetadataDriverBase      Initialize zookeeper metadata driver with external zookeeper client : ledgersRootPath = /ledgers.\r\n2020-04-30T12:33:53.324Z        WARN    Query-20200430_123351_00000_ak294-159   org.apache.bookkeeper.util.EventLoopUtil        Could not use Netty Epoll event loop: failed to load the required native library\r\n2020-04-30T12:33:53.347Z        ERROR   Query-20200430_123351_00000_ak294-159   org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl       Failed to initialize DNS Resolver org.apache.bookkeeper.net.ScriptBasedMapping, used default subnet resolver : java.lang.RuntimeException: No network topology script is found when using script based DNS resolver.\r\n2020-04-30T12:33:53.353Z        INFO    Query-20200430_123351_00000_ak294-159   org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl       Initialize rackaware ensemble placement policy @ <Bookie:192.168.10.17:0> @ /default-rack : org.apache.bookkeeper.client.TopologyAwareEnsemblePlacementPolicy$DefaultResolver.\r\n2020-04-30T12:33:53.353Z        INFO    Query-20200430_123351_00000_ak294-159   org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl       Not weighted\r\n2020-04-30T12:33:53.356Z        INFO    Query-20200430_123351_00000_ak294-159   org.apache.bookkeeper.client.BookKeeper Weighted ledger placement is not enabled\r\n2020-04-30T12:33:53.383Z        INFO    BookKeeperClientScheduler-OrderedScheduler-0-0  org.apache.bookkeeper.net.NetworkTopologyImpl   Adding a new node: /default-rack/yo-bookkeeper-c1-n3:3181\r\n2020-04-30T12:33:53.383Z        INFO    BookKeeperClientScheduler-OrderedScheduler-0-0  org.apache.bookkeeper.net.NetworkTopologyImpl   Adding a new node: /default-rack/yo-bookkeeper-c1-n1:3181\r\n2020-04-30T12:33:53.384Z        INFO    BookKeeperClientScheduler-OrderedScheduler-0-0  org.apache.bookkeeper.net.NetworkTopologyImpl   Adding a new node: /default-rack/yo-bookkeeper-c1-n2:3181\r\n2020-04-30T12:33:53.386Z        ERROR   Query-20200430_123351_00000_ak294-159   org.apache.pulsar.sql.presto.PulsarSplitManager Failed to get splits\r\njava.io.IOException: Failed to initialize ledger manager factory\r\n        at org.apache.bookkeeper.client.BookKeeper.<init>(BookKeeper.java:520)\r\n        at org.apache.bookkeeper.client.BookKeeper.<init>(BookKeeper.java:368)\r\n        at org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl$DefaultBkFactory.<init>(ManagedLedgerFactoryImpl.java:183)\r\n        at org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.<init>(ManagedLedgerFactoryImpl.java:122)\r\n        at org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.<init>(ManagedLedgerFactoryImpl.java:114)\r\n        at org.apache.pulsar.sql.presto.PulsarConnectorCache.initManagedLedgerFactory(PulsarConnectorCache.java:108)\r\n        at org.apache.pulsar.sql.presto.PulsarConnectorCache.<init>(PulsarConnectorCache.java:66)\r\n        at org.apache.pulsar.sql.presto.PulsarConnectorCache.getConnectorCache(PulsarConnectorCache.java:83)\r\n        at org.apache.pulsar.sql.presto.PulsarSplitManager.getSplitsNonPartitionedTopic(PulsarSplitManager.java:224)\r\n        at org.apache.pulsar.sql.presto.PulsarSplitManager.getSplits(PulsarSplitManager.java:126)\r\n        at com.facebook.presto.split.SplitManager.getSplits(SplitManager.java:64)\r\n        at com.facebook.presto.sql.planner.DistributedExecutionPlanner$Visitor.visitTableScan(DistributedExecutionPlanner.java:146)\r\n        at com.facebook.presto.sql.planner.DistributedExecutionPlanner$Visitor.visitTableScan(DistributedExecutionPlanner.java:122)\r\n        at com.facebook.presto.sql.planner.plan.TableScanNode.accept(TableScanNode.java:136)\r\n        at com.facebook.presto.sql.planner.DistributedExecutionPlanner.doPlan(DistributedExecutionPlanner.java:108)\r\n        at com.facebook.presto.sql.planner.DistributedExecutionPlanner.doPlan(DistributedExecutionPlanner.java:113)\r\n        at com.facebook.presto.sql.planner.DistributedExecutionPlanner.plan(DistributedExecutionPlanner.java:85)\r\n        at com.facebook.presto.execution.SqlQueryExecution.planDistribution(SqlQueryExecution.java:385)\r\n        at com.facebook.presto.execution.SqlQueryExecution.start(SqlQueryExecution.java:287)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n        at java.lang.Thread.run(Thread.java:748)\r\nCaused by: org.apache.bookkeeper.meta.exceptions.MetadataException: Failed to initialized ledger manager factory\r\n        at org.apache.bookkeeper.meta.zk.ZKMetadataDriverBase.getLedgerManagerFactory(ZKMetadataDriverBase.java:243)\r\n        at org.apache.bookkeeper.client.BookKeeper.<init>(BookKeeper.java:518)\r\n        ... 21 more\r\nCaused by: java.io.IOException: Empty Ledger Root Path.\r\n        at org.apache.bookkeeper.meta.AbstractZkLedgerManagerFactory.newLedgerManagerFactory(AbstractZkLedgerManagerFactory.java:158)\r\n        at org.apache.bookkeeper.meta.zk.ZKMetadataDriverBase.getLedgerManagerFactory(ZKMetadataDriverBase.java:239)\r\n        ... 22 more\r\n\r\n```", "url": "https://github.com/apache/pulsar/issues/6852", "user": "KannarFr", "labels": ["component/sql", "triage/week-19", "type/bug"], "created": "2020-04-30 12:37:52", "closed": "2020-06-04 02:07:07", "commits": {"a9ae25757f75c1a8b1e6cdf17dcd832196c7f421": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 34.000277777777775, "commitsDetails": [{"commitHash": "a9ae25757f75c1a8b1e6cdf17dcd832196c7f421", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["b2329e4f34095c12c93c11628b03b70fa2996e29"], "nameRev": "a9ae25757f75c1a8b1e6cdf17dcd832196c7f421 tags/v2.6.0-candidate-1~68", "commitMessage": "[Pulsar SQL] Fix pulsar sql use multi zk address failed (#6947)\n\nFixes #6852 \r\n\r\n### Motivation\r\n\r\nCurrently, if the config `pulsar.zookeeper-uri` use multi zk address like this `127.0.0.1:2181,127.0.0.2:2181,127.0.0.3:2181` in $PULAR_HOME/conf/presto/catalog/pulsar.properties, the Pulsar SQL query will be failed.\r\n\r\nBreak PR https://github.com/apache/pulsar/pull/5001.\r\n\r\n### Modifications\r\n\r\nChange the multi zk address delimiter from `,` to `;` for the config `metadataServiceUri` of the `ClientConfiguration`.", "commitDateTime": "2020-06-04 10:07:06", "authoredDateTime": "2020-06-04 10:07:06", "commitGitStats": [{"filePath": "pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarConnectorCache.java", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarConnectorCache.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.PulsarConnectorCache.initManagedLedgerFactory(org.apache.pulsar.sql.presto.PulsarConnectorConfig)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Latest pulsar-all docker image might be broken.", "body": "**Describe the bug**\r\nWhen following instruction to run pulsar with minikube, \r\nI stuck at the step \"$ kubectl apply -f bookie.yaml\"\r\nThe pod can not start up and I see error log\r\n\"Error: Could not find or load main class\"\r\nAfter change to version 2.5.0 it seems working fine.\r\nSo there might be some problem with the latest(2.5.1) pulsar-all image.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nFollow instruction [here](https://pulsar.apache.org/docs/en/2.5.1/deploy-kubernetes/#deploying-pulsar-components) to run pulsar cluster in Kubernetes.\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n![image](https://user-images.githubusercontent.com/13480084/80670164-0e9c4200-8a5b-11ea-8f18-0ffb58764552.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Mac\r\n", "url": "https://github.com/apache/pulsar/issues/6850", "user": "MarvinCai", "labels": ["type/bug"], "created": "2020-04-30 03:51:09", "closed": "2020-05-29 01:16:50", "commits": {}, "ttf": 28.00027777777778, "commitsDetails": []}, {"title": "autoSkipNonRecoverableData config in broker.conf does not work ", "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\nwhen reading data from pulsar, if  autoSkipNonRecoverableData is set, then the reading process will not block due to certain NonRecoverableLedgerException. However, when use Reader API and use seek(timestamp) method, this configuration takes no effect.\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\nSeek should not fail due to certain NonRecoverableLedgerException\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6841", "user": "pheecian", "labels": ["triage/week-18", "type/bug"], "created": "2020-04-29 09:39:17", "closed": "2020-05-12 12:56:15", "commits": {"3198f4ffab051b237aa7692b1451cd933eb80f98": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "2dae2b5d2ea4eb689f8f181b9a5326398ce1687b": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 13.000277777777777, "commitsDetails": [{"commitHash": "3198f4ffab051b237aa7692b1451cd933eb80f98", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["65dc9d99924e5ec00952a81c7091195304baa58e"], "nameRev": "3198f4ffab051b237aa7692b1451cd933eb80f98 tags/v2.6.0-candidate-1~200", "commitMessage": "fix autoSkipConf (#6863)\n\nFixes #6841\r\nCo-authored-by: Xiaopeng Zhang <xiaopengzhang@Xiaopengs-MacBook-Pro.local>\r\nCo-authored-by: Jia Zhai <zhaijia@apache.org>", "commitDateTime": "2020-05-12 20:56:13", "authoredDateTime": "2020-05-12 20:56:13", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getManagedLedgerConfig(org.apache.pulsar.common.naming.TopicName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "2dae2b5d2ea4eb689f8f181b9a5326398ce1687b", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["aed2c17f3d8c70d5d66a3e1ff4c442fa0e4cde7e"], "nameRev": "2dae2b5d2ea4eb689f8f181b9a5326398ce1687b tags/v2.5.2-candidate-1~4", "commitMessage": "fix autoSkipConf (#6863)\n\nFixes #6841\nCo-authored-by: Xiaopeng Zhang <xiaopengzhang@Xiaopengs-MacBook-Pro.local>\nCo-authored-by: Jia Zhai <zhaijia@apache.org>\n(cherry picked from commit 3198f4ffab051b237aa7692b1451cd933eb80f98)\n", "commitDateTime": "2020-05-12 21:43:12", "authoredDateTime": "2020-05-12 20:56:13", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getManagedLedgerConfig(org.apache.pulsar.common.naming.TopicName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Geo-replication failed when enabling partitioned topic auto-creation", "body": "**Describe the bug**\r\nGeo-replication failed when enabling partitioned topic auto-creation\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Start a geo Pulsar cluster\r\n2. Enable the partitioned topic auto-creation(allowAutoTopicCreationType=partitioned)\r\n3. Create a namespace with 2 clusters\r\n4. Start a producer to produce messages to a topic(don't create it by pulsar-admin)\r\n5. The error occurs at a local cluster\r\n\r\n```\r\n16:19:02.142 [pulsar-io-22-24] ERROR org.apache.pulsar.client.impl.ProducerImpl - [persistent://geo/default/pub-test-partition-2] [pulsar.repl.pulsar-cluster-a] Failed to create producer: persistent://geo/default/pub-test-partition-2 Failed to start replicator pulsar-cluster-a\r\n16:19:02.142 [pulsar-io-22-24] WARN  org.apache.pulsar.client.impl.ConnectionHandler - [persistent://geo/default/pub-test-partition-2] [pulsar.repl.pulsar-cluster-a] Could not get connection to broker: persistent://geo/default/pub-test-partition-2 Failed to start replicator pulsar-cluster-a -- Will try again in 3.13 s\r\n16:19:02.355 [pulsar-timer-42-1] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [persistent://geo/default/pub-test-partition-1] [pulsar.repl.pulsar-cluster-a] Reconnecting after connection was closed\r\n16:19:02.357 [pulsar-io-22-8] INFO  org.apache.pulsar.client.impl.ProducerImpl - [persistent://geo/default/pub-test-partition-1] [pulsar.repl.pulsar-cluster-a] Creating producer on cnx [id: 0xbed80cce, L:/192.168.1.102:54848 - R:/192.168.1.102:6660]\r\n16:19:02.360 [pulsar-io-22-18] WARN  org.apache.pulsar.client.impl.ClientCnx - [id: 0xbed80cce, L:/192.168.1.102:54848 - R:/192.168.1.102:6660] Received error from server: persistent://geo/default/pub-test-partition-1 Failed to start replicator pulsar-cluster-a\r\n16:19:02.360 [pulsar-io-22-18] ERROR org.apache.pulsar.client.impl.ProducerImpl - [persistent://geo/default/pub-test-partition-1] [pulsar.repl.pulsar-cluster-a] Failed to create producer: persistent://geo/default/pub-test-partition-1 Failed to start replicator pulsar-cluster-a\r\n16:19:02.360 [pulsar-io-22-18] WARN  org.apache.pulsar.client.impl.ConnectionHandler - [persistent://geo/default/pub-test-partition-1] [pulsar.repl.pulsar-cluster-a] Could not get connection to broker: persistent://geo/default/pub-test-partition-1 Failed to start replicator pulsar-cluster-a -- Will try again in 2.919 s\r\n```\r\n\r\n```\r\n16:18:59.839 [pulsar-ordered-OrderedExecutor-1-0] WARN  org.apache.pulsar.broker.service.BrokerService - Replication or dedup check failed. Removing topic from topics list persistent://geo/default/pub-test-partition-0, java.util.concurrent.CompletionException: org.apache.pulsar.broker.service.BrokerServiceException$NamingException: persistent://geo/default/pub-test-partition-0 Failed to start replicator pulsar-cluster-a\r\n16:18:59.839 [pulsar-ordered-OrderedExecutor-1-0] ERROR org.apache.pulsar.broker.service.ServerCnx - [/192.168.1.102:54867] Failed to create topic persistent://geo/default/pub-test-partition-0\r\njava.util.concurrent.CompletionException: org.apache.pulsar.broker.service.BrokerServiceException$NamingException: persistent://geo/default/pub-test-partition-0 Failed to start replicator pulsar-cluster-a\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.biRelay(CompletableFuture.java:1298) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.andTree(CompletableFuture.java:1321) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.allOf(CompletableFuture.java:2238) ~[?:1.8.0_241]\r\n\tat org.apache.pulsar.common.util.FutureUtil.waitForAll(FutureUtil.java:37) ~[org.apache.pulsar-pulsar-common-2.5.1.jar:2.5.1]\r\n\tat org.apache.pulsar.broker.service.persistent.PersistentTopic.checkReplication(PersistentTopic.java:1103) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n\tat org.apache.pulsar.broker.service.BrokerService$2.openLedgerComplete(BrokerService.java:892) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.lambda$asyncOpen$7(ManagedLedgerFactoryImpl.java:341) ~[org.apache.pulsar-managed-ledger-2.5.1.jar:2.5.1]\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:670) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:683) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:2010) ~[?:1.8.0_241]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.asyncOpen(ManagedLedgerFactoryImpl.java:340) ~[org.apache.pulsar-managed-ledger-2.5.1.jar:2.5.1]\r\n\tat org.apache.pulsar.broker.service.BrokerService.lambda$createPersistentTopic$25(BrokerService.java:885) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:670) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:646) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975) ~[?:1.8.0_241]\r\n\tat org.apache.pulsar.broker.service.BrokerService.lambda$getManagedLedgerConfig$34(BrokerService.java:1036) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n\tat org.apache.bookkeeper.mledger.util.SafeRun$2.safeRun(SafeRun.java:49) [org.apache.pulsar-managed-ledger-2.5.1.jar:2.5.1]\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_241]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_241]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.45.Final.jar:4.1.45.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_241]\r\nCaused by: org.apache.pulsar.broker.service.BrokerServiceException$NamingException: persistent://geo/default/pub-test-partition-0 Failed to start replicator pulsar-cluster-a\r\n\tat org.apache.pulsar.broker.service.persistent.PersistentTopic.startReplicator(PersistentTopic.java:1180) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n\tat org.apache.pulsar.broker.service.persistent.PersistentTopic.checkReplication(PersistentTopic.java:1086) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n\t... 18 more\r\n16:19:00.081 [pulsar-io-22-3] INFO  org.apache.pulsar.broker.service.ServerCnx - [/192.168.1.102:54857][persistent://geo/default/pub-test-partition-1] Creating producer. producerId=3\r\n16:19:00.081 [pulsar-ordered-OrderedExecutor-2-0] INFO  org.apache.pulsar.broker.service.AbstractTopic - Disabling publish throttling for persistent://geo/default/pub-test-partition-1\r\n16:19:00.082 [pulsar-ordered-OrderedExecutor-2-0] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://geo/default/pub-test-partition-1] There are no replicated subscriptions on the topic\r\n16:19:00.082 [pulsar-ordered-OrderedExecutor-2-0] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://geo/default/pub-test-partition-1] Starting replicator to remote: pulsar-cluster-a\r\n16:19:00.082 [pulsar-ordered-OrderedExecutor-2-0] ERROR org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://geo/default/pub-test-partition-1] Replicator startup failed due to partitioned-topic pulsar-cluster-a\r\n16:19:00.082 [pulsar-ordered-OrderedExecutor-2-0] WARN  org.apache.pulsar.broker.service.BrokerService - Replication or dedup check failed. Removing topic from topics list persistent://geo/default/pub-test-partition-1, java.util.concurrent.CompletionException: org.apache.pulsar.broker.service.BrokerServiceException$NamingException: persistent://geo/default/pub-test-partition-1 Failed to start replicator pulsar-cluster-a\r\n16:19:00.082 [pulsar-ordered-OrderedExecutor-2-0] ERROR org.apache.pulsar.broker.service.ServerCnx - [/192.168.1.102:54857] Failed to create topic persistent://geo/default/pub-test-partition-1\r\njava.util.concurrent.CompletionException: org.apache.pulsar.broker.service.BrokerServiceException$NamingException: persistent://geo/default/pub-test-partition-1 Failed to start replicator pulsar-cluster-a\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.biRelay(CompletableFuture.java:1298) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.andTree(CompletableFuture.java:1321) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.allOf(CompletableFuture.java:2238) ~[?:1.8.0_241]\r\n\tat org.apache.pulsar.common.util.FutureUtil.waitForAll(FutureUtil.java:37) ~[org.apache.pulsar-pulsar-common-2.5.1.jar:2.5.1]\r\n\tat org.apache.pulsar.broker.service.persistent.PersistentTopic.checkReplication(PersistentTopic.java:1103) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n\tat org.apache.pulsar.broker.service.BrokerService$2.openLedgerComplete(BrokerService.java:892) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.lambda$asyncOpen$7(ManagedLedgerFactoryImpl.java:341) ~[org.apache.pulsar-managed-ledger-2.5.1.jar:2.5.1]\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:670) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:683) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:2010) ~[?:1.8.0_241]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.asyncOpen(ManagedLedgerFactoryImpl.java:340) ~[org.apache.pulsar-managed-ledger-2.5.1.jar:2.5.1]\r\n\tat org.apache.pulsar.broker.service.BrokerService.lambda$createPersistentTopic$25(BrokerService.java:885) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:670) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:646) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) ~[?:1.8.0_241]\r\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975) ~[?:1.8.0_241]\r\n\tat org.apache.pulsar.broker.service.BrokerService.lambda$getManagedLedgerConfig$34(BrokerService.java:1036) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n\tat org.apache.bookkeeper.mledger.util.SafeRun$2.safeRun(SafeRun.java:49) [org.apache.pulsar-managed-ledger-2.5.1.jar:2.5.1]\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_241]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_241]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.45.Final.jar:4.1.45.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_241]\r\nCaused by: org.apache.pulsar.broker.service.BrokerServiceException$NamingException: persistent://geo/default/pub-test-partition-1 Failed to start replicator pulsar-cluster-a\r\n\tat org.apache.pulsar.broker.service.persistent.PersistentTopic.startReplicator(PersistentTopic.java:1180) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n\tat org.apache.pulsar.broker.service.persistent.PersistentTopic.checkReplication(PersistentTopic.java:1086) ~[org.apache.pulsar-pulsar-broker-2.5.1.jar:2.5.1]\r\n\t... 18 more\r\n```\r\n\r\n**Expected behavior**\r\nGeo-replication should work well\r\n\r\n**Additional context**\r\nVersion 2.5.1\r\n", "url": "https://github.com/apache/pulsar/issues/6840", "user": "codelipenghui", "labels": ["release/2.5.2", "type/bug"], "created": "2020-04-29 08:20:15", "closed": "2020-04-30 02:13:50", "commits": {"bb41702501e90a0789a39a1cb921b6b82eb55d07": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "a2d5d5b59cfb84843eed15d806e0441b0d64a442": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "bb41702501e90a0789a39a1cb921b6b82eb55d07", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["9030e84fddf6c4764924c3ad6aca6b72d192c103"], "nameRev": "bb41702501e90a0789a39a1cb921b6b82eb55d07 tags/v2.6.0-candidate-1~245", "commitMessage": "Avoid creating partitioned topic for partition name (#6846)\n\nFixes #6840\r\n\r\nMotivation\r\nAvoid creating partitioned topic for partition name\r\n\r\nVerifying this change\r\nNew unit test added.", "commitDateTime": "2020-04-30 10:13:49", "authoredDateTime": "2020-04-30 10:13:49", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/TopicAutoCreationTest.java", "insertions": 88, "deletions": 0, "lines": 88}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.fetchPartitionedTopicMetadataCheckAllowAutoCreationAsync(org.apache.pulsar.common.naming.TopicName)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "TopicAutoCreationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.TopicAutoCreationTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "a2d5d5b59cfb84843eed15d806e0441b0d64a442", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["1c029455b6c6d32f305901d19db76a98b777a031"], "nameRev": "a2d5d5b59cfb84843eed15d806e0441b0d64a442 tags/v2.5.2-candidate-1~35", "commitMessage": "Avoid creating partitioned topic for partition name (#6846)\n\nFixes #6840\n\nMotivation\nAvoid creating partitioned topic for partition name\n\nVerifying this change\nNew unit test added.\n(cherry picked from commit bb41702501e90a0789a39a1cb921b6b82eb55d07)\n", "commitDateTime": "2020-05-08 17:36:51", "authoredDateTime": "2020-04-30 10:13:49", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/TopicAutoCreationTest.java", "insertions": 88, "deletions": 0, "lines": 88}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.fetchPartitionedTopicMetadataCheckAllowAutoCreationAsync(org.apache.pulsar.common.naming.TopicName)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "TopicAutoCreationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.TopicAutoCreationTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "command \"pulsar-admin functions list\"  unavailable in  run function-worker separately", "body": "**Describe the bug**\r\nrun function-worker separately, pulsar-admin functions list cmd unavailable\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. run function-worker separately\r\n2. run pulsar-admin functions list cmd, get functions list\r\n3. return result \"Reason: HTTP 503 Service Unavailable\"\r\n4. set --admin-url as functions-work ip:port\r\n5. after run cmd,return result \"Reason: HTTP 404 Not Found\"\r\n\r\n**Expected behavior**\r\nbroker.conf set functionsWorkerEnabled=false\r\n\r\nPulsar Version:2.4.1\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6839", "user": "laxpio", "labels": ["triage/week-18", "type/bug"], "created": "2020-04-29 02:52:04", "closed": "2020-05-09 02:16:58", "commits": {"714a776c124f5afff86f6df87675f3452e6dd207": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "0dfb4822b3298415c73a60add8da61df638592b9": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 9.000277777777777, "commitsDetails": [{"commitHash": "714a776c124f5afff86f6df87675f3452e6dd207", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["8381371a3cdae52521c8d50ca053d7510989fb33"], "nameRev": "714a776c124f5afff86f6df87675f3452e6dd207 tags/v2.6.0-candidate-1~217", "commitMessage": "[function] Function endpoint admin/v3/functions/{tenant}/{namespace} always returns 404 (#6767)\n\nFix #6839 \r\n### Motivation\r\n\r\nThe V3 endpoint that returns a list of all functions in a namespace always returns 404. The V2 version of the endpoint returns the actual list of functions in the namespace. It looks like during the switch from V2 to V3, the implementation for the endpoint was missed. This endpoint is part of the current API [documentation](https://pulsar.apache.org/functions-rest-api/?version=2.5.0#operation/listFunctions), so I don't think it was removed intentionally.\r\n\r\nThis endpoint is also used by the pulsar-admin command, so that always returns 404:\r\n\r\n```\r\npulsar-admin functions list --tenant chris-kafkaesque-io --namespace local-useast2-aws\r\nHTTP 404 Not Found\r\n\r\nReason: HTTP 404 Not Found\r\n```\r\n\r\n### Modifications\r\n\r\nI have added the endpoint to `FunctionsApiV3Resource.java`. It is essentially a clone of the V2 version.\r\n\r\n### Verifying this change\r\n\r\nThis is a pretty small change. I have confirmed that the V3 version of the endpoint now returns the same list of functions as the V2 version. I have also confirmed that the pulsar-admin command now works:\r\n\r\n```\r\nbin/pulsar-admin functions list --tenant chris-kafkaesque-io --namespace TTL\r\n23:45:10.763 [main] INFO  org.apache.pulsar.common.util.SecurityUtility - Found and Instantiated Bouncy Castle provider in classpath BC\r\n\"exclaim\"\r\n\"pulsar-functions-0.1\"\r\n```\r\n", "commitDateTime": "2020-05-09 10:16:57", "authoredDateTime": "2020-05-08 22:16:57", "commitGitStats": [{"filePath": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/rest/api/v3/FunctionsApiV3Resource.java", "insertions": 8, "deletions": 0, "lines": 8}], "commitSpoonAstDiffStats": [{"spoonFilePath": "FunctionsApiV3Resource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.worker.rest.api.v3.FunctionsApiV3Resource.listSources(java.lang.String,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "0dfb4822b3298415c73a60add8da61df638592b9", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["9c5644b4b5bac05b8c3f82b7eda89ee750e5c725"], "nameRev": "0dfb4822b3298415c73a60add8da61df638592b9 tags/v2.5.2-candidate-1~17", "commitMessage": "[function] Function endpoint admin/v3/functions/{tenant}/{namespace} always returns 404 (#6767)\n\nFix #6839\n### Motivation\n\nThe V3 endpoint that returns a list of all functions in a namespace always returns 404. The V2 version of the endpoint returns the actual list of functions in the namespace. It looks like during the switch from V2 to V3, the implementation for the endpoint was missed. This endpoint is part of the current API [documentation](https://pulsar.apache.org/functions-rest-api/?version=2.5.0#operation/listFunctions), so I don't think it was removed intentionally.\n\nThis endpoint is also used by the pulsar-admin command, so that always returns 404:\n\n```\npulsar-admin functions list --tenant chris-kafkaesque-io --namespace local-useast2-aws\nHTTP 404 Not Found\n\nReason: HTTP 404 Not Found\n```\n\n### Modifications\n\nI have added the endpoint to `FunctionsApiV3Resource.java`. It is essentially a clone of the V2 version.\n\n### Verifying this change\n\nThis is a pretty small change. I have confirmed that the V3 version of the endpoint now returns the same list of functions as the V2 version. I have also confirmed that the pulsar-admin command now works:\n\n```\nbin/pulsar-admin functions list --tenant chris-kafkaesque-io --namespace TTL\n23:45:10.763 [main] INFO  org.apache.pulsar.common.util.SecurityUtility - Found and Instantiated Bouncy Castle provider in classpath BC\n\"exclaim\"\n\"pulsar-functions-0.1\"\n```\n\n(cherry picked from commit 714a776c124f5afff86f6df87675f3452e6dd207)\n", "commitDateTime": "2020-05-12 21:31:54", "authoredDateTime": "2020-05-08 22:16:57", "commitGitStats": [{"filePath": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/rest/api/v3/FunctionsApiV3Resource.java", "insertions": 8, "deletions": 0, "lines": 8}], "commitSpoonAstDiffStats": [{"spoonFilePath": "FunctionsApiV3Resource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.worker.rest.api.v3.FunctionsApiV3Resource.listSources(java.lang.String,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "java.lang.OutOfMemoryError: GC overhead limit exceeded' is observed when creating producers on a non-existent topic", "body": "**Describe the bug**\r\n\r\n if we try to create producer for a non-existent topic the ProducerImpl object is hanging in the dump. Although producer creation fails but we see that ProducerImpl object corresponding to each producing action hanging in the dump. This behavior will lead to OOM in microservice which by mistake tries to produce consistently to a non-existent topic.", "url": "https://github.com/apache/pulsar/issues/6838", "user": "sijie", "labels": ["triage/week-18", "type/bug"], "created": "2020-04-29 01:47:00", "closed": "2020-05-11 09:50:40", "commits": {"6eed21739e5c33e5064cd34cf0da0d93a991b1e5": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "2b1a1ed8add1d2f2de025af5fa1a7ed514f0ebcf": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "842996e859dc027551108cbc5f3da414e8d1135f": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 12.000277777777777, "commitsDetails": [{"commitHash": "6eed21739e5c33e5064cd34cf0da0d93a991b1e5", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["3aaed249f5c200431f5e8dacad2de2cbd64ee1ad"], "nameRev": "6eed21739e5c33e5064cd34cf0da0d93a991b1e5 tags/v2.6.0-candidate-1~212", "commitMessage": "Close producer when the topic does not exists. (#6879)\n\nFixes #6838\r\n\r\n### Motivation\r\n\r\nClose producer when the topic does not exists.\r\n\r\n### Modifications\r\n\r\n1. Fix exception handle for the topic does not exist.\r\n2. Change state to Close when producer got TopicDoesNotExists exception so that the producer can close the cnx and will no longer add send timeout tasks to HashedWheelTimer.", "commitDateTime": "2020-05-11 17:50:39", "authoredDateTime": "2020-05-11 17:50:39", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/TopicDoesNotExistsTest.java", "insertions": 70, "deletions": 0, "lines": 70}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 14, "deletions": 1, "lines": 15}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": []}, {"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleProducer(org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicDoesNotExistsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TopicDoesNotExistsTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.connectionOpened(org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "2b1a1ed8add1d2f2de025af5fa1a7ed514f0ebcf", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["e7b8e3d5efcb2f7f84ff8f89960ffb40cc67d3ff"], "nameRev": "2b1a1ed8add1d2f2de025af5fa1a7ed514f0ebcf tags/v2.5.2-candidate-1~14", "commitMessage": "Close producer when the topic does not exists. (#6879)\n\nFixes #6838\n\n### Motivation\n\nClose producer when the topic does not exists.\n\n### Modifications\n\n1. Fix exception handle for the topic does not exist.\n2. Change state to Close when producer got TopicDoesNotExists exception so that the producer can close the cnx and will no longer add send timeout tasks to HashedWheelTimer.\n(cherry picked from commit 6eed21739e5c33e5064cd34cf0da0d93a991b1e5)\n", "commitDateTime": "2020-05-12 21:32:24", "authoredDateTime": "2020-05-11 17:50:39", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/TopicDoesNotExistsTest.java", "insertions": 70, "deletions": 0, "lines": 70}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 14, "deletions": 1, "lines": 15}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": []}, {"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleProducer(org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicDoesNotExistsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TopicDoesNotExistsTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.connectionOpened(org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "842996e859dc027551108cbc5f3da414e8d1135f", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["c74414c219b465bf8278de30c22f5bad950529da"], "nameRev": "842996e859dc027551108cbc5f3da414e8d1135f tags/v2.6.0-candidate-1~78", "commitMessage": "Close producer without state check while the topic does not exists. (#7120)\n\nFixes #6838 related to #6879\r\n\r\n### Motivation\r\n\r\nClose producer without state check while the topic does not exists. The problem is the `State` of the producer failed to pass the check condition so that the producer can't be closed. If TopicDoesNotExsitsException happens on a producer, we can directly close this producer without state checking for the producer.", "commitDateTime": "2020-06-03 09:54:16", "authoredDateTime": "2020-06-03 09:54:16", "commitGitStats": [{"filePath": ".github/workflows/ci-unit-broker-others.yml", "insertions": 137, "deletions": 0, "lines": 137}, {"filePath": ".github/workflows/ci-unit-broker.yml", "insertions": 0, "deletions": 52, "lines": 52}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/TopicDoesNotExistsTest.java", "insertions": 13, "deletions": 5, "lines": 18}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 1, "deletions": 5, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "TopicDoesNotExistsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TopicDoesNotExistsTest.testCreateProducerOnNotExistsTopic()", "TOT": 14, "UPD": 2, "INS": 7, "MOV": 1, "DEL": 4}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.connectionOpened(org.apache.pulsar.client.impl.ClientCnx)", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 2}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 2, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Segmentation fault of C++ client when close a producer if there're pending expired messages", "body": "**Describe the bug**\r\nWith C++ client, if a `Producer` call `close()` while there're some pending expired messages, after that, a segmentation fault would happen.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior by running [SendAsyncThenClose.cpp](https://gist.github.com/BewareMyPower/2c4760cec0c6f19985700f2b10f56334):\r\n1. Create a producer with 1ms send timeout;\r\n2. Then call `sendAsync` to send a large amount of messages, eg. 10000;\r\n3. Close the producer.\r\n4. Many send callbacks are called after `close()`, then a segmentation fault may occur.\r\n\r\n**Expected behavior**\r\nAfter producer calls `close()`, pending send callbacks should be discarded and not called.\r\n\r\n**Additional context**\r\nIt may exit normally, so more runs are needed to reproduce the error, eg.\r\n\r\n```\r\n2020-04-26 13:21:15.221 INFO  ProducerImpl:493 | [persistent://public/default/FooTest, standalone-0-51] Closing producer for topic persistent://public/default/FooTest\r\n[OK] msg 8951: (3514,7,-1,951)\r\n# ....\r\n[OK] msg 8999: (3514,7,-1,999)\r\n[FAILED] msg 9000\r\n# ...\r\n[FAILED] msg 9999\r\nSegmentation fault\r\n```\r\n\r\nThe backtrace (I deleted the prefix of path):\r\n```\r\n#0  0x00007f5ad24dd53f in boost::date_time::microsec_clock<boost::posix_time::ptime>::create_time (converter=<optimized out>)\r\n    at boost/date_time/microsec_time_clock.hpp:86\r\n#1  boost::date_time::microsec_clock<boost::posix_time::ptime>::universal_time ()\r\n    at boost/date_time/microsec_time_clock.hpp:78\r\n#2  boost::asio::time_traits<boost::posix_time::ptime>::now () at boost/asio/time_traits.hpp:48\r\n#3  boost::asio::detail::deadline_timer_service<boost::asio::time_traits<boost::posix_time::ptime> >::expires_from_now (ec=..., expiry_time=..., impl=..., \r\n    this=<optimized out>) at boost/asio/detail/deadline_timer_service.hpp:213\r\n#4  boost::asio::basic_deadline_timer<boost::posix_time::ptime, boost::asio::time_traits<boost::posix_time::ptime>, boost::asio::executor>::expires_from_now (\r\n    this=0x0, expiry_time=...) at boost/asio/basic_deadline_timer.hpp:548\r\n#5  0x00007f5ad257a736 in pulsar::ProducerImpl::handleSendTimeout (this=0xbc001250, err=...)\r\n    at pulsar/pulsar-client-cpp/lib/ProducerImpl.cc:578\r\n```\r\n\r\nFrame 5:\r\n```c++\r\n573\t        if (diff.total_milliseconds() <= 0) {\r\n574\t            // The diff is less than or equal to zero, meaning that the message has been expired.\r\n575\t            LOG_DEBUG(getName() << \"Timer expired. Calling timeout callbacks.\");\r\n576\t            failPendingMessages(ResultTimeout);\r\n577\t            // Since the pending queue is cleared now, set timer to expire after configured value.\r\n578\t            sendTimer_->expires_from_now(milliseconds(conf_.getSendTimeout()));\r\n579\t        } else {\r\n```\r\n\r\n```\r\n(gdb) p sendTimer_ \r\n$1 = {<std::__shared_ptr<boost::asio::basic_deadline_timer<boost::posix_time::ptime, boost::asio::time_traits<boost::posix_time::ptime>, boost::asio::executor>, (__gnu_cxx::_Lock_policy)2>> = {_M_ptr = 0x0, _M_refcount = {_M_pi = 0x0}}, <No data fields>}\r\n```\r\n\r\nBecause in `ProducerImpl::closeAsync()`,  `cancelTimers` is called so that `sendTimer_` was cancelled and reset to nullptr. But `ProducerImpl::handleSendTimeout` queued in the event loop of `Executor` may still be called, while it doesn't check if `sendTimer_` has been cancelled.", "url": "https://github.com/apache/pulsar/issues/6822", "user": "BewareMyPower", "labels": ["triage/week-18", "type/bug"], "created": "2020-04-26 05:58:55", "closed": "2020-05-26 06:58:17", "commits": {"0996327b6a6bdefd61eaeeca904b89a5a9391c42": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 30.00027777777778, "commitsDetails": [{"commitHash": "0996327b6a6bdefd61eaeeca904b89a5a9391c42", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["a8701c13b3871ecc65f56639adbf249dbd2cf231"], "nameRev": "0996327b6a6bdefd61eaeeca904b89a5a9391c42 tags/v2.6.0-candidate-1~144", "commitMessage": "Fix segmentation fault if handleSendTimeout() is called after closeAsync() (#6827)\n\nFixes #6822 \r\n\r\n### Motivation\r\n\r\nThe program may cause segmentation fault after closed accidentally because  `ProducerImpl::handleSendTimeout()` doesn't check the state or other fields of `ProducerImpl`, which may cause that a null `sendTimer_` calls its methods.\r\n\r\n### Modifications\r\n\r\n- Acquire `mutex_` and check if the `state_` is `Ready` before handling the send timer callback;\r\n- Devide `failPendingMessages()` into two parts which are `getPendingCallbacksWhenFailedWithLock()` and `PendingCallbacks::complete()`.\r\n\r\n    - The 1st part needs to acquire `mutex_` to access class members safely. In addition, we already hold `mutex_` before `failPendingMessages()`, so we need a method to get necessary callbacks without the lock.\r\n    - The 2nd part doesn't and shouldn't acquire `mutex_`, because we don't know how long user provided callbacks may cost. If lock this part, `mutex_` may be hold for a long time.\r\n- Define a new struct contains a `BatchMessageContainer::MessageContainerListPtr` field, because nested classes can't be forward declared.", "commitDateTime": "2020-05-25 23:58:16", "authoredDateTime": "2020-05-26 14:58:16", "commitGitStats": [{"filePath": "pulsar-client-cpp/lib/ProducerImpl.cc", "insertions": 38, "deletions": 15, "lines": 53}, {"filePath": "pulsar-client-cpp/lib/ProducerImpl.h", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Geo repeated consumption", "body": "**Describe the bug**\r\nI deployed two pulsar clusters across regions, the RRT between two regions is 400ms, but each message produced is consumed twice in the same subscription.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Produce message in one region\r\n```\r\npulsar-client produce --messages \"hahae\" my-tenant/my-namespace/hello\r\n```\r\n2. consume message from the other region\r\n```\r\npulsar-client consume my-tenant/my-namespace/hello --subscription-name haha --num-messages 0\r\n```\r\n3. See error\r\n```\r\n11:49:23.836 [pulsar-client-io-1-1] INFO  com.scurrilous.circe.checksum.Crc32cIntChecksum - SSE4.2 CRC32C provider initialized\r\n----- got message -----\r\nhahae\r\n----- got message -----\r\nhahae\r\n```\r\n\r\n**Expected behavior**\r\nI expect only one message\r\n```\r\n----- got message -----\r\nhahae\r\n```\r\n\r\n**Desktop:**\r\n - OS: Linux 3.10.0-1062.4.1.el7.x86_64\r\n\r\n**Additional context**\r\nconfiguration-store: apache-zookeeper-3.6.0\r\napache-pulsar-2.5.0\r\n", "url": "https://github.com/apache/pulsar/issues/6815", "user": "zr-hebo", "labels": ["type/bug"], "created": "2020-04-25 04:55:24", "closed": "2020-04-26 13:40:54", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Wrong admin REST API documentation for create subscription", "body": "**Describe the bug**\r\n![image](https://user-images.githubusercontent.com/12592133/80169049-fd94a080-8616-11ea-9f9e-e3337be35286.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6811", "user": "codelipenghui", "labels": ["type/bug"], "created": "2020-04-24 02:34:15", "closed": "2020-04-24 03:01:34", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "TLS Authentication on proxy prevents Prometheus metrics collection", "body": "I am running a Pulsar deployment with TLS and Authentication on enabled on the proxy only, and neither TLS nor Authentication enabled inside the private cluster.\r\n\r\nWhen Prometheus attempts to scrape metrics from the proxy component, the following errors are produced in the log:\r\n\r\n```\r\n15:21:54.630 [pulsar-external-web-4-8] INFO  org.eclipse.jetty.server.RequestLog - 10.244.39.210 - - [20/Apr/2020:15:21:54 +0000] \"GET /metrics HTTP/1.1\" 302 0 \"-\" \"Prometheus/1.6.3\" 27\r\n15:21:54.641 [pulsar-external-web-4-2] WARN  org.apache.pulsar.broker.web.AuthenticationFilter - [10.244.39.210] Failed to authenticate HTTP request: Authentication required\r\n15:21:54.642 [pulsar-external-web-4-2] INFO  org.eclipse.jetty.server.RequestLog - 10.244.39.210 - - [20/Apr/2020:15:21:54 +0000] \"GET /metrics/ HTTP/1.1\" 401 353 \"http://10.244.40.37:8080/metrics\" \"Prometheus/1.6.3\" 20\r\n```\r\n\r\nIs there a way to allow Prometheus to gather proxy metrics in my configuration?", "url": "https://github.com/apache/pulsar/issues/6789", "user": "bschofield", "labels": ["type/bug"], "created": "2020-04-21 23:24:26", "closed": "2020-04-22 09:27:39", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Server exception when using enum in schema", "body": "**Describe the bug**\r\nWhen trying to create a topic with a schema containing an enum, an exception is thrown on the server.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Run the following go code:\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"fmt\"\r\n\r\n\t\"github.com/apache/pulsar/pulsar-client-go/pulsar\"\r\n)\r\n\r\nvar schema = `\r\n{ \"name\": \"test\", \"type\": \"record\", \"fields\": [\r\n\t{ \"name\": \"testfield\", \"type\": \"enum\", \"symbols\": [\"one\",\"two\"] }\r\n]}\r\n`\r\n\r\nfunc main() {\r\n\tclient, _ := pulsar.NewClient(pulsar.ClientOptions{URL: \"pulsar://localhost:6650\"})\r\n\t_, err := client.CreateProducerWithSchema(pulsar.ProducerOptions{Topic: \"test\"}, pulsar.NewJsonSchema(schema, nil))\r\n\tfmt.Printf(\"Error: %s\\n\", err)\r\n}\r\n```\r\n\r\n**Expected behavior**\r\nNo error\r\n\r\n**Actual behavior**\r\nOn client:\r\n```\r\n2020/04/19 00:23:46.004 c_client.go:68: [info] WARN  | ClientConnection:925 | [127.0.0.1:43932 -> 127.0.0.1:6650] Received error response from server: 1 -- req_id: 0\r\n2020/04/19 00:23:46.004 c_client.go:68: [info] ERROR | ProducerImpl:219 | [persistent://public/default/test, ] Failed to create producer: UnknownError\r\n2020/04/19 00:23:46.004 c_client.go:68: [info] INFO  | ProducerImpl:474 | Producer - [persistent://public/default/test, ] , [batching  = off]\r\nError: Failed to create Producer: UnknownError\r\n```\r\nOn server:\r\n```\r\n00:23:46.003 [bookkeeper-ml-workers-OrderedExecutor-2-0] ERROR org.apache.pulsar.broker.service.ServerCnx - [/127.0.0.1:43932] Failed to create topic persistent://public/default/test\r\njava.util.concurrent.CompletionException: java.lang.IllegalArgumentException: Can not resolve JsonSchema 'type' id of \"record\", not recognized as one of standard values: [STRING, NUMBER, INTEGER, BOOLEAN, OBJECT, ARRAY, NULL, ANY]\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273) ~[?:1.8.0_242]\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280) ~[?:1.8.0_242]\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:673) ~[?:1.8.0_242]\r\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:646) ~[?:1.8.0_242]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) ~[?:1.8.0_242]\r\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975) ~[?:1.8.0_242]\r\n\tat org.apache.pulsar.broker.service.BrokerService$2.lambda$openLedgerComplete$1(BrokerService.java:868) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n\tat java.util.concurrent.CompletableFuture.uniRun(CompletableFuture.java:719) ~[?:1.8.0_242]\r\n\tat java.util.concurrent.CompletableFuture.uniRunStage(CompletableFuture.java:731) ~[?:1.8.0_242]\r\n\tat java.util.concurrent.CompletableFuture.thenRun(CompletableFuture.java:2023) ~[?:1.8.0_242]\r\n\tat org.apache.pulsar.broker.service.BrokerService$2.openLedgerComplete(BrokerService.java:861) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.lambda$asyncOpen$7(ManagedLedgerFactoryImpl.java:341) ~[org.apache.pulsar-managed-ledger-2.5.0.jar:2.5.0]\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:670) ~[?:1.8.0_242]\r\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:646) ~[?:1.8.0_242]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) ~[?:1.8.0_242]\r\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975) ~[?:1.8.0_242]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl$2.initializeComplete(ManagedLedgerFactoryImpl.java:329) ~[org.apache.pulsar-managed-ledger-2.5.0.jar:2.5.0]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl$3.operationComplete(ManagedLedgerImpl.java:446) ~[org.apache.pulsar-managed-ledger-2.5.0.jar:2.5.0]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl$3.operationComplete(ManagedLedgerImpl.java:436) ~[org.apache.pulsar-managed-ledger-2.5.0.jar:2.5.0]\r\n\tat org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper.lambda$null$5(MetaStoreImplZookeeper.java:223) ~[org.apache.pulsar-managed-ledger-2.5.0.jar:2.5.0]\r\n\tat org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:32) [org.apache.pulsar-managed-ledger-2.5.0.jar:2.5.0]\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_242]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_242]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_242]\r\nCaused by: java.lang.IllegalArgumentException: Can not resolve JsonSchema 'type' id of \"record\", not recognized as one of standard values: [STRING, NUMBER, INTEGER, BOOLEAN, OBJECT, ARRAY, NULL, ANY]\r\n\tat com.fasterxml.jackson.module.jsonSchema.JsonSchemaIdResolver.typeFromId(JsonSchemaIdResolver.java:66) ~[com.fasterxml.jackson.module-jackson-module-jsonSchema-2.10.1.jar:2.10.1]\r\n\tat com.fasterxml.jackson.databind.jsontype.impl.TypeDeserializerBase._findDeserializer(TypeDeserializerBase.java:156) ~[com.fasterxml.jackson.core-jackson-databind-2.10.1.jar:2.10.1]\r\n\tat com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer._deserializeTypedForId(AsPropertyTypeDeserializer.java:113) ~[com.fasterxml.jackson.core-jackson-databind-2.10.1.jar:2.10.1]\r\n\tat com.fasterxml.jackson.databind.jsontype.impl.AsPropertyTypeDeserializer.deserializeTypedFromObject(AsPropertyTypeDeserializer.java:97) ~[com.fasterxml.jackson.core-jackson-databind-2.10.1.jar:2.10.1]\r\n\tat com.fasterxml.jackson.databind.deser.AbstractDeserializer.deserializeWithType(AbstractDeserializer.java:254) ~[com.fasterxml.jackson.core-jackson-databind-2.10.1.jar:2.10.1]\r\n\tat com.fasterxml.jackson.databind.deser.impl.TypeWrappedDeserializer.deserialize(TypeWrappedDeserializer.java:68) ~[com.fasterxml.jackson.core-jackson-databind-2.10.1.jar:2.10.1]\r\n\tat com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:4202) ~[com.fasterxml.jackson.core-jackson-databind-2.10.1.jar:2.10.1]\r\n\tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3266) ~[com.fasterxml.jackson.core-jackson-databind-2.10.1.jar:2.10.1]\r\n\tat org.apache.pulsar.broker.service.schema.validator.StructSchemaDataValidator.validate(StructSchemaDataValidator.java:60) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n\tat org.apache.pulsar.broker.service.schema.validator.SchemaDataValidator.validateSchemaData(SchemaDataValidator.java:42) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n\tat org.apache.pulsar.broker.service.schema.validator.SchemaRegistryServiceWithSchemaDataValidator.putSchemaIfAbsent(SchemaRegistryServiceWithSchemaDataValidator.java:92) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n\tat org.apache.pulsar.broker.service.AbstractTopic.addSchema(AbstractTopic.java:194) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n\tat org.apache.pulsar.broker.service.ServerCnx.tryAddSchema(ServerCnx.java:1489) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n\tat org.apache.pulsar.broker.service.ServerCnx.lambda$null$19(ServerCnx.java:934) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:670) ~[?:1.8.0_242]\r\n\t... 23 more\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Linux, Fedora 31\r\n\r\n**Additional context**\r\nPulsar version: 2.5.0\r\n\r\nAnd can we please get some better error handling in that section of the code on the server? That exception is extremely confusing. It took me way too long to figure out the problem was with the `enum`.", "url": "https://github.com/apache/pulsar/issues/6768", "user": "phemmer", "labels": ["triage/week-17", "type/bug"], "created": "2020-04-19 04:29:17", "closed": "2020-05-06 05:33:18", "commits": {}, "ttf": 17.00027777777778, "commitsDetails": []}, {"title": "Avro Schema Definition flags are not exposed on Pulsar Functions", "body": "**Describe the bug**\r\nA few stories have been added that allow Avro Schema Compatibility on Pulsar to conform with the default Avro behaviour, namely:\r\n\r\n- https://github.com/apache/pulsar/pull/5938\r\n- https://github.com/apache/pulsar/pull/6704 -- adding `boolean isJsr310ConversionEnabled`\r\n- https://github.com/apache/pulsar/pull/3752 -- adding `boolean getAlwaysAllowNull`\r\n\r\nUnfortunately these flags are not exposed into Pulsar Function configuration, therefore we cannot AUTO_CONSUME or AUTO_PRODUCE to topics with stricter Avro Schema Validation\r\n\r\n**Expected behavior**\r\n\r\n- The same flags to be exposed under Functions Configuration\r\n- Upon setting those flags, a function should be able to **consume** from a Topic with strict(default) Avro Schema Validation\r\n- Upon setting those flags, a function should be able to **produce** from a Topic with strict(default) Avro Schema Validation\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6765", "user": "psilos", "labels": ["triage/week-17", "type/bug"], "created": "2020-04-18 15:34:06", "closed": "2020-06-09 08:11:27", "commits": {"2aff473e598fe5e8ba9f8ed0860de35a67718725": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 51.000277777777775, "commitsDetails": [{"commitHash": "2aff473e598fe5e8ba9f8ed0860de35a67718725", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["dbc064928fed1b41c4d7cb4c785395271210cefe"], "nameRev": "2aff473e598fe5e8ba9f8ed0860de35a67718725 tags/v2.6.0-candidate-1~7", "commitMessage": "[issue #6765]  Expose definition flags to function  (#6868)\n\n1\uff09\r\nChange the value of the CLI tool parameter \"--custom-schema-input\" from\r\n\"TopicName-> schemaType\" \r\n to\r\n\"topicName-> {\" schemaType \":\" type\",\" jsr310ConversionEnabled \": true,\" alwaysAllowNull \": true}\"\r\n\r\n2\uff09\r\nModify Function.proto, add properties \"jsr310ConversionEnabled\", \"alwaysAllowNull\"\u3002So that we can receive the above 2 parameters\r\n\r\n3\uff09\r\nModify the \"FunctionConfigUtils#convert\" method \uff0c put the two parameters in \"CustomSchemaInputs\" into ConsumerSpec\r\n\r\n4\uff09\r\nIn \u201cJavaInstanceRunnable#setupInput\u201d method, put the above 2 parameters into \"ConsumerConfig\" and pass it to \"PulsarSource\", let it set the parameters into \"schema\" when creating the consumer of Source\u3002\r\nSo that\uff0cThe \u201cfunction\u201d can get these 2 parameters from the message of \r\n\u201dcurrentRecord\u201c\r\n", "commitDateTime": "2020-06-09 16:11:26", "authoredDateTime": "2020-06-09 16:11:26", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/functions/worker/PulsarFunctionLocalRunTest.java", "insertions": 126, "deletions": 0, "lines": 126}, {"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdFunctions.java", "insertions": 8, "deletions": 1, "lines": 9}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/functions/ConsumerConfig.java", "insertions": 11, "deletions": 0, "lines": 11}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/functions/FunctionConfig.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/io/SinkConfig.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/JavaInstanceRunnable.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/sink/PulsarSink.java", "insertions": 7, "deletions": 3, "lines": 10}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/sink/PulsarSinkConfig.java", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/PulsarSource.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java", "insertions": 32, "deletions": 5, "lines": 37}, {"filePath": "pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/pojo/AvroTestObject.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-functions/proto/src/main/proto/Function.proto", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/FunctionConfigUtils.java", "insertions": 45, "deletions": 13, "lines": 58}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarFunctionLocalRunTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.worker.PulsarFunctionLocalRunTest.testAvroFunctionLocalRun(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.worker.PulsarFunctionLocalRunTest.testAvroFunctionLocalRun()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CmdFunctions.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdFunctions.FunctionDetailsCommand", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.admin.cli.CmdFunctions.FunctionDetailsCommand.processArguments()", "TOT": 8, "UPD": 0, "INS": 4, "MOV": 4, "DEL": 0}]}, {"spoonFilePath": "SchemaDefinitionBuilderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.SchemaDefinitionBuilderImpl.withProperties(java.util.Map)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerConfig.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.functions.ConsumerConfig", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "FunctionConfig.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.functions.FunctionConfig", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SinkConfig.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.io.SinkConfig", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JavaInstanceRunnable.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupInput(org.apache.pulsar.functions.instance.ContextImpl)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupOutput(org.apache.pulsar.functions.instance.ContextImpl)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarSink.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.sink.PulsarSink.initializeSchema()", "TOT": 8, "UPD": 0, "INS": 6, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "PulsarSinkConfig.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.sink.PulsarSinkConfig", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarSource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.PulsarSource.setupConsumerConfigs()", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "TopicSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(java.lang.String,java.lang.Class,java.lang.String,boolean)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.getSchema(java.lang.String,java.lang.Class,org.apache.pulsar.common.functions.ConsumerConfig,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.getSchema(java.lang.String,java.lang.Class,org.apache.pulsar.common.functions.ConsumerConfig,boolean,java.lang.ClassLoader)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(java.lang.Class,org.apache.pulsar.common.schema.SchemaType)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(java.lang.String,java.lang.Class,org.apache.pulsar.common.functions.ConsumerConfig,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(java.lang.Class,org.apache.pulsar.common.schema.SchemaType,org.apache.pulsar.common.functions.ConsumerConfig)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(java.lang.String,java.lang.Class,java.lang.String,boolean,java.lang.ClassLoader)", "TOT": 5, "UPD": 0, "INS": 3, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(java.lang.String,java.lang.Class,org.apache.pulsar.common.functions.ConsumerConfig,boolean,java.lang.ClassLoader)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroTestObject.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.api.examples.pojo.AvroTestObject", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "FunctionConfigUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.utils.FunctionConfigUtils.convert(org.apache.pulsar.common.functions.FunctionConfig,java.lang.ClassLoader)", "TOT": 13, "UPD": 2, "INS": 5, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.functions.utils.FunctionConfigUtils.doJavaChecks(org.apache.pulsar.common.functions.FunctionConfig,java.lang.ClassLoader)", "TOT": 6, "UPD": 2, "INS": 3, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.utils.FunctionConfigUtils", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.utils.FunctionConfigUtils.convertFromDetails(org.apache.pulsar.functions.proto.Function.FunctionDetails)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Wrong tokenSecretKey configuration description about using base64 inline", "body": "**Describe the bug**\r\nWhen using base64 line in tokenSecretKey, config should specify like \"tokenSecretKey=data:;base64,xxxxxxxxx\" but not \"tokenSecretKey=data:base64,xxxxxxxxx\". Description in documnet is missing a semicolon.\r\n\r\ndata URI scheme:\r\nhttps://en.wikipedia.org/wiki/Data_URI_scheme\r\n\r\nwrong documents:\r\nhttps://pulsar.apache.org/docs/en/reference-configuration/\r\n\r\n> Configure the secret key to be used to validate auth tokens. The key can be specified like:\u00a0tokenSecretKey=data:base64,xxxxxxxxx\u00a0or\u00a0tokenSecretKey=file:///my/secret.key\r\n\r\nhttps://pulsar.apache.org/docs/en/security-jwt/\r\n\r\n>  \\# If using secret key\r\ntokenSecretKey=file:///path/to/secret.key\r\n\\# The key can also be passed inline:\r\n\\# tokenSecretKey=data:base64,FLFyW0oLJ2Fi22KKCm21J18mbAdztfSHN/lAT5ucEKU=\r\n\r\n\r\n**To Reproduce**\r\n// correct result\r\napache-pulsar-2.5.0>bin/pulsar tokens create --secret-key 'qcsXyb5eo8c09YXIMJaA97RYPCmIuyTlrN2KcI0zzxM=' --subject admin\r\neyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiJ9.L869nKrziQIPkgqIawIh-RxxDelfGIiol1DBhoBl26Y\r\n\r\n// wrong result\r\napache-pulsar-2.5.0>bin/pulsar tokens create --secret-key 'data:base64,qcsXyb5eo8c09YXIMJaA97RYPCmIuyTlrN2KcI0zzxM=' --subject admin\r\neyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiJ9.ne2WjK3zY4cecotgUYkU0kkviOyslnCqPDHcPYF-HDc\r\n\r\n// correct result\r\napache-pulsar-2.5.0>bin/pulsar tokens create --secret-key 'data:;base64,qcsXyb5eo8c09YXIMJaA97RYPCmIuyTlrN2KcI0zzxM=' --subject admin\r\neyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiJ9.L869nKrziQIPkgqIawIh-RxxDelfGIiol1DBhoBl26Y\r\n\r\n\r\n**Expected behavior**\r\nCorrect tokenSecretKey base64 inline description in documents and examples.", "url": "https://github.com/apache/pulsar/issues/6761", "user": "erobot", "labels": ["triage/week-17", "type/bug"], "created": "2020-04-18 08:23:26", "closed": "2020-06-02 07:54:05", "commits": {"fcd9852766d46b4e8a45e06abf2464bb7274080f": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 44.000277777777775, "commitsDetails": [{"commitHash": "fcd9852766d46b4e8a45e06abf2464bb7274080f", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["5b20496709b0a7bc7d517c5ac335e86e9d650255"], "nameRev": "fcd9852766d46b4e8a45e06abf2464bb7274080f tags/v2.6.0-candidate-1~81", "commitMessage": "Correct tokenSecretKey base64 inline description. (#6959)\n\n### Motivation\r\n\r\nFixes #6761\r\n\r\n### Modifications\r\n\r\nCorrect tokenSecretKey base64 inline description in documents (based master & version 2.5.1) and examples.", "commitDateTime": "2020-06-02 15:54:04", "authoredDateTime": "2020-06-02 15:54:04", "commitGitStats": [{"filePath": "conf/broker.conf", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "conf/proxy.conf", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "deployment/kubernetes/helm/pulsar/values.yaml", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyConfiguration.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/docs/reference-configuration.md", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "site2/docs/security-jwt.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/docs/security-token-admin.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.5.1/reference-configuration.md", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "site2/website/versioned_docs/version-2.5.1/security-jwt.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/auth/token/TokenAuthWithSymmetricKeys.java", "insertions": 6, "deletions": 6, "lines": 12}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ProxyConfiguration.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyConfiguration", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TokenAuthWithSymmetricKeys.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.auth.token.TokenAuthWithSymmetricKeys.configureBroker(org.apache.pulsar.tests.integration.containers.BrokerContainer)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.auth.token.TokenAuthWithSymmetricKeys.configureProxy(org.apache.pulsar.tests.integration.containers.ProxyContainer)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.auth.token.TokenAuthWithSymmetricKeys.createKeysAndTokens(org.apache.pulsar.tests.integration.containers.PulsarContainer)", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.auth.token.TokenAuthWithSymmetricKeys.createClientTokenWithExpiry(long,java.util.concurrent.TimeUnit)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Wrong admin API description for create subscription", "body": "**Describe the bug**\r\nWrong admin API description for create subscription\r\nhttp://pulsar.apache.org/admin-rest-api/?version=2.5.0#operation/createSubscription\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/12592133/79625697-34713f00-815d-11ea-96eb-5fa4aeeeebd5.png)\r\n", "url": "https://github.com/apache/pulsar/issues/6759", "user": "codelipenghui", "labels": ["component/documentation", "help wanted", "release/2.5.2", "triage/week-17", "type/bug"], "created": "2020-04-18 02:14:57", "closed": "2020-05-12 04:10:51", "commits": {}, "ttf": 24.00027777777778, "commitsDetails": []}, {"title": "Get schema by version can get the deleted schema info.", "body": "**Describe the bug**\r\nGet schema by version can get the deleted schema info. \r\n\r\n**To Reproduce**\r\n1. create a schema for a topic.\r\n2. delete schema of the topic.\r\n3. get schema by the previous schema version that created.\r\n4. Still can schema info.\r\n\r\n**Expected behavior**\r\nShould response 404\r\n\r\n**Additional context**\r\nmaster branch.\r\n", "url": "https://github.com/apache/pulsar/issues/6754", "user": "codelipenghui", "labels": ["help wanted", "release/2.5.2", "triage/week-17", "type/bug"], "created": "2020-04-17 13:49:34", "closed": "2020-04-30 13:27:39", "commits": {"466b0b89af61a0d9c7aa7e6220c91f366f2d3831": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "cadc852b36c18d6496a8c6ca82eda6b63087ef80": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 12.000277777777777, "commitsDetails": [{"commitHash": "466b0b89af61a0d9c7aa7e6220c91f366f2d3831", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["42ed9bf12e29099e5c1655484311441402dde3d7"], "nameRev": "466b0b89af61a0d9c7aa7e6220c91f366f2d3831 tags/v2.6.0-candidate-1~241", "commitMessage": "Fix Get schema by version can get the deleted schema info #6754 (#6764)\n\n", "commitDateTime": "2020-04-30 21:27:38", "authoredDateTime": "2020-04-30 21:27:38", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorage.java", "insertions": 7, "deletions": 6, "lines": 13}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java", "insertions": 29, "deletions": 8, "lines": 37}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentTopicE2ETest.java", "insertions": 42, "deletions": 0, "lines": 42}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/SchemaServiceTest.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BookkeeperSchemaStorage.java", "spoonMethods": []}, {"spoonFilePath": "SchemaRegistryServiceImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.getSchema(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaVersion)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicE2ETest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicE2ETest.testDeleteSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaServiceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaServiceTest.addLotsOfEntriesThenDelete()", "TOT": 7, "UPD": 2, "INS": 2, "MOV": 2, "DEL": 1}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "cadc852b36c18d6496a8c6ca82eda6b63087ef80", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["d8b6e3fe6075417650bd0620f655db9a8cb37a99"], "nameRev": "cadc852b36c18d6496a8c6ca82eda6b63087ef80 tags/v2.5.2-candidate-1~32", "commitMessage": "Fix Get schema by version can get the deleted schema info #6754 (#6764)\n\n(cherry picked from commit 466b0b89af61a0d9c7aa7e6220c91f366f2d3831)\n", "commitDateTime": "2020-05-08 17:45:02", "authoredDateTime": "2020-04-30 21:27:38", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorage.java", "insertions": 7, "deletions": 6, "lines": 13}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java", "insertions": 29, "deletions": 8, "lines": 37}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentTopicE2ETest.java", "insertions": 42, "deletions": 0, "lines": 42}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/SchemaServiceTest.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BookkeeperSchemaStorage.java", "spoonMethods": []}, {"spoonFilePath": "SchemaRegistryServiceImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.getSchema(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaVersion)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicE2ETest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicE2ETest.testDeleteSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaServiceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaServiceTest.addLotsOfEntriesThenDelete()", "TOT": 7, "UPD": 2, "INS": 2, "MOV": 2, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "org.apache.bookkeeper.proto.WriteEntryProcessor - Attempt to write to fenced ledger", "body": "**Describe the bug**\r\nthere a exception after restart bookie, and all machines in the cluster keep reporting errors as below:\r\n\r\n2020-04-17 12:52:12.009 INFO  [GarbageCollectorThread-11-1] org.apache.bookkeeper.bookie.GarbageCollectorThread - Enter minor compaction, suspendMinor false\r\n2020-04-17 12:52:12.009 INFO  [GarbageCollectorThread-11-1] org.apache.bookkeeper.bookie.GarbageCollectorThread - Do compaction to compact those files lower than 0.2\r\n2020-04-17 12:52:12.040 INFO  [db-storage-cleanup-10-1] org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex - Deleting indexes for ledgers: [28960, 28725, 28965, 28726, 28727, 28967, 28280]\r\n2020-04-17 12:52:12.172 INFO  [db-storage-cleanup-10-1] org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex - Deleted indexes for 100016 entries from 7 ledgers in 0.131 seconds\r\n2020-04-17 12:54:19.134 INFO  [GarbageCollectorThread-11-1] org.apache.bookkeeper.bookie.EntryLogCompactor - Removing entry log 214 after compaction\r\n2020-04-17 12:54:19.200 INFO  [GarbageCollectorThread-11-1] org.apache.bookkeeper.bookie.GarbageCollectorThread - Removing entry log metadata for 214\r\n2020-04-17 12:54:19.200 INFO  [GarbageCollectorThread-11-1] org.apache.bookkeeper.bookie.GarbageCollectorThread - Compaction: entry log usage buckets[10% 20% 30% 40% 50% 60% 70% 80% 90% 100%] = [0, 1, 0, 0, 0, 0, 0, 0, 0, 0]\r\n2020-04-17 13:01:50.892 INFO  [BookieJournal-3181] org.apache.bookkeeper.bookie.JournalChannel - Opening journal /data1/bookkeeper/journal/current/16f3c9ea3e4.txn\r\n2020-04-17 13:02:12.041 INFO  [SyncThread-7-1] org.apache.bookkeeper.bookie.Journal - garbage collected journal 16f3c9ea3de.txn\r\n2020-04-17 13:07:12.036 INFO  [db-storage-cleanup-10-1] org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex - Deleting indexes for ledgers: [28976, 28978, 28981, 28982, 28983, 28973]\r\n2020-04-17 13:07:12.374 INFO  [db-storage-cleanup-10-1] org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex - Deleted indexes for 250008 entries from 6 ledgers in 0.337 seconds\r\n2020-04-17 13:22:12.036 INFO  [db-storage-cleanup-10-1] org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex - Deleting indexes for ledgers: [28980, 28984]\r\n2020-04-17 13:22:12.380 INFO  [db-storage-cleanup-10-1] org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex - Deleted indexes for 100000 entries from 2 ledgers in 0.344 seconds\r\n2020-04-17 13:26:48.176 INFO  [bookie-io-1-12] org.apache.bookkeeper.proto.AuthHandler - Authentication success on server side\r\n2020-04-17 13:26:48.176 INFO  [bookie-io-1-12] org.apache.bookkeeper.proto.BookieRequestHandler - Channel connected  [id: 0x410eafe2, L:/10.52.10.114:3181 - R:/10.52.10.115:47648]\r\n2020-04-17 13:37:12.036 INFO  [db-storage-cleanup-10-1] org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex - Deleting indexes for ledgers: [28992, 28963, 28986]\r\n2020-04-17 13:37:12.127 INFO  [db-storage-cleanup-10-1] org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex - Deleted indexes for 100984 entries from 3 ledgers in 0.09 seconds\r\n2020-04-17 13:41:47.029 INFO  [bookie-io-1-13] org.apache.bookkeeper.proto.AuthHandler - Authentication success on server side\r\n2020-04-17 13:41:47.029 INFO  [bookie-io-1-13] org.apache.bookkeeper.proto.BookieRequestHandler - Channel connected  [id: 0x490c94fc, L:/10.52.10.114:3181 - R:/10.52.10.114:49494]\r\n2020-04-17 13:41:47.385 INFO  [bookie-io-1-14] org.apache.bookkeeper.proto.AuthHandler - Authentication success on server side\r\n2020-04-17 13:41:47.385 INFO  [bookie-io-1-14] org.apache.bookkeeper.proto.BookieRequestHandler - Channel connected  [id: 0xceb71e0d, L:/10.52.10.114:3181 - R:/10.52.10.116:56866]\r\n2020-04-17 13:41:47.386 INFO  [bookie-io-1-15] org.apache.bookkeeper.proto.AuthHandler - Authentication success on server side\r\n2020-04-17 13:41:47.386 INFO  [bookie-io-1-15] org.apache.bookkeeper.proto.BookieRequestHandler - Channel connected  [id: 0x2c0138fa, L:/10.52.10.114:3181 - R:/10.52.10.115:47792]\r\n2020-04-17 13:41:47.388 INFO  [bookie-io-1-16] org.apache.bookkeeper.proto.AuthHandler - Authentication success on server side\r\n2020-04-17 13:41:47.388 INFO  [bookie-io-1-16] org.apache.bookkeeper.proto.BookieRequestHandler - Channel connected  [id: 0xcad36398, L:/10.52.10.114:3181 - R:/10.52.10.114:49502]\r\n2020-04-17 13:42:11.346 ERROR [bookie-io-1-11] org.apache.bookkeeper.proto.WriteEntryProcessor - Attempt to write to fenced ledger\r\norg.apache.bookkeeper.bookie.BookieException$LedgerFencedException: null\r\n        at org.apache.bookkeeper.bookie.BookieException.create(BookieException.java:57) ~[org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.bookie.Bookie.addEntry(Bookie.java:1374) ~[org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.proto.WriteEntryProcessor.processPacket(WriteEntryProcessor.java:79) [org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.proto.PacketProcessorBase.safeRun(PacketProcessorBase.java:85) [org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.proto.BookieRequestProcessor.processAddRequest(BookieRequestProcessor.java:616) [org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.proto.BookieRequestProcessor.processRequest(BookieRequestProcessor.java:365) [org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.proto.BookieRequestHandler.channelRead(BookieRequestHandler.java:80) [org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:352) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.ChannelInboundHandlerAdapter.channelRead(ChannelInboundHandlerAdapter.java:93) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at org.apache.bookkeeper.proto.AuthHandler$ServerSideHandler.channelRead(AuthHandler.java:89) [org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:352) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at org.apache.bookkeeper.proto.BookieProtoEncoding$RequestDecoder.channelRead(BookieProtoEncoding.java:441) [org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:352) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:326) [io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:300) [io.netty-netty-codec-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:352) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1422) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:931) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:700) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:635) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:552) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:514) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$6.run(SingleThreadEventExecutor.java:1050) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_144]\r\n\r\n\r\n**To Reproduce**\r\n\r\n1. restart the bookie service incorrectly with root user\r\n2. stop the bookie service and start service with normal user\r\n3. an error will occur after the service is started\r\n4. See error\r\n\r\n**Expected behavior**\r\nexpected to solve this issue\r\n\r\n**Screenshots**\r\n\r\n**Desktop (please complete the following information):**\r\n\r\n\r\n**Additional context**\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6751", "user": "kaykillyou", "labels": ["triage/week-17", "type/bug"], "created": "2020-04-17 07:35:55", "closed": "2020-04-21 03:42:54", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "Cannot be cast to [B - presto connector", "body": "Given a byte[] field in a Schema, pulsar presto connector throws this exceptions even when presto identifies the column as varbinary\r\n````\r\njava.lang.ClassCastException: java.nio.HeapByteBuffer cannot be cast to [B\r\n2020-04-16T18:53:25.559818923Z \tat org.apache.pulsar.sql.presto.PulsarRecordCursor.getSlice(PulsarRecordCursor.java:496)\r\n2020-04-16T18:53:25.559823223Z \tat com.facebook.presto.$gen.CursorProcessor_20200416_185325_28.project_0(Unknown Source)\r\n2020-04-16T18:53:25.559827723Z \tat com.facebook.presto.$gen.CursorProcessor_20200416_185325_28.process(Unknown Source)\r\n2020-04-16T18:53:25.559832623Z \tat com.facebook.presto.operator.ScanFilterAndProjectOperator.processColumnSource(ScanFilterAndProjectOperator.java:237)\r\n2020-04-16T18:53:25.559836923Z \tat com.facebook.presto.operator.ScanFilterAndProjectOperator.getOutput(ScanFilterAndProjectOperator.java:229)\r\n2020-04-16T18:53:25.559848923Z \tat com.facebook.presto.operator.Driver.processInternal(Driver.java:373)\r\n2020-04-16T18:53:25.559852723Z \tat com.facebook.presto.operator.Driver.lambda$processFor$8(Driver.java:282)\r\n2020-04-16T18:53:25.559856623Z \tat com.facebook.presto.operator.Driver.tryWithLock(Driver.java:672)\r\n2020-04-16T18:53:25.559860423Z \tat com.facebook.presto.operator.Driver.processFor(Driver.java:276)\r\n2020-04-16T18:53:25.559864323Z \tat com.facebook.presto.execution.SqlTaskExecution$DriverSplitRunner.processFor(SqlTaskExecution.java:973)\r\n2020-04-16T18:53:25.559868223Z \tat com.facebook.presto.execution.executor.PrioritizedSplitRunner.process(PrioritizedSplitRunner.java:162)\r\n2020-04-16T18:53:25.559872323Z \tat com.facebook.presto.execution.executor.TaskExecutor$TaskRunner.run(TaskExecutor.java:477)\r\n2020-04-16T18:53:25.559876423Z \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n2020-04-16T18:53:25.559880323Z \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n2020-04-16T18:53:25.559884223Z \tat java.lang.Thread.run(Thread.java:748)\r\n````", "url": "https://github.com/apache/pulsar/issues/6749", "user": "eaba", "labels": ["triage/week-16", "type/bug"], "created": "2020-04-16 19:33:13", "closed": "2020-05-11 07:23:39", "commits": {"3aaed249f5c200431f5e8dacad2de2cbd64ee1ad": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "e7b8e3d5efcb2f7f84ff8f89960ffb40cc67d3ff": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 24.00027777777778, "commitsDetails": [{"commitHash": "3aaed249f5c200431f5e8dacad2de2cbd64ee1ad", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["561868d4c441d654ab795a9386d8e9a5e28f03dd"], "nameRev": "3aaed249f5c200431f5e8dacad2de2cbd64ee1ad tags/v2.6.0-candidate-1~213", "commitMessage": "Pulsar SQL Support Avro Schema `ByteBuffer` Type (#6925)\n\nFixes #6749\r\n\r\n### Motivation\r\n\r\nCurrently, the Pulsar SQL couldn't support AvroSchema use the `ByteBuffer` as the field type. For example, use the POJO class as below.\r\n\r\n```\r\n@Data\r\npublic static class LogFile {\r\n    int id;\r\n    String name;\r\n    ByteBuffer data;\r\n}\r\n\r\nProducer<LogFile> producer = pulsarClient.newProducer(Schema.AVRO(LogFile.class)).topic(topic).create();\r\n```\r\n\r\nError Log\r\n```\r\n2020-05-08T23:34:47.079+0800\tERROR\tSplitRunner-5-101\tcom.facebook.presto.execution.executor.TaskExecutor\tError processing Split 20200508_153445_00006_nxngm.1.0-1 PulsarSplit{splitId=1, connectorId='pulsar', originSchemaName='bytes-sql-test4', schemaName='public/default', tableName='bytes-sql-test4', splitSize=4, schema='{\"type\":\"record\",\"name\":\"LogFile\",\"namespace\":\"com.ran.schema.KeyValueSchemaTest$\",\"fields\":[{\"name\":\"id\",\"type\":\"int\"},{\"name\":\"name\",\"type\":[\"null\",\"string\"],\"default\":null},{\"name\":\"data\",\"type\":[\"null\",\"bytes\"],\"default\":null}]}', schemaType=AVRO, startPositionEntryId=5, endPositionEntryId=9, startPositionLedgerId=3359, endPositionLedgerId=3359, schemaInfoProperties={\"__alwaysAllowNull\":\"true\"}} (start = 4.34095226272178E8, wall = 546 ms, cpu = 0 ms, wait = 0 ms, calls = 1)\r\njava.lang.ClassCastException: java.nio.HeapByteBuffer cannot be cast to [B\r\n\tat org.apache.pulsar.sql.presto.PulsarRecordCursor.getSlice(PulsarRecordCursor.java:516)\r\n\tat com.facebook.presto.spi.RecordPageSource.getNextPage(RecordPageSource.java:117)\r\n\tat com.facebook.presto.operator.TableScanOperator.getOutput(TableScanOperator.java:242)\r\n\tat com.facebook.presto.operator.Driver.processInternal(Driver.java:373)\r\n\tat com.facebook.presto.operator.Driver.lambda$processFor$8(Driver.java:282)\r\n\tat com.facebook.presto.operator.Driver.tryWithLock(Driver.java:672)\r\n\tat com.facebook.presto.operator.Driver.processFor(Driver.java:276)\r\n\tat com.facebook.presto.execution.SqlTaskExecution$DriverSplitRunner.processFor(SqlTaskExecution.java:973)\r\n\tat com.facebook.presto.execution.executor.PrioritizedSplitRunner.process(PrioritizedSplitRunner.java:162)\r\n\tat com.facebook.presto.execution.executor.TaskExecutor$TaskRunner.run(TaskExecutor.java:477)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n### Modifications\r\n\r\nWhen the presto field record type is `VarbinaryType.VARBINARY`, check the record type is `ByteBuffer`, `byte[]`, `ByteBuf` or others, and to process the field record by the type.\r\n\r\n* pulsar sql support avro schema `ByteBuffer` type\r\n\r\n* add ByteBuf check and unit tests.", "commitDateTime": "2020-05-11 15:23:38", "authoredDateTime": "2020-05-11 15:23:38", "commitGitStats": [{"filePath": "pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarRecordCursor.java", "insertions": 29, "deletions": 1, "lines": 30}, {"filePath": "pulsar-sql/presto-pulsar/src/test/java/org/apache/pulsar/sql/presto/TestPulsarRecordCursor.java", "insertions": 51, "deletions": 0, "lines": 51}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarRecordCursor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.PulsarRecordCursor.toBytes(java.lang.Object)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.sql.presto.PulsarRecordCursor.getSlice(int)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "TestPulsarRecordCursor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.TestPulsarRecordCursor.testRecordToBytes()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "e7b8e3d5efcb2f7f84ff8f89960ffb40cc67d3ff", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["c6bbfc6d59c83ee78688b4b7dd177277aa8e4c72"], "nameRev": "e7b8e3d5efcb2f7f84ff8f89960ffb40cc67d3ff tags/v2.5.2-candidate-1~15", "commitMessage": "Pulsar SQL Support Avro Schema `ByteBuffer` Type (#6925)\n\nFixes #6749\n\n### Motivation\n\nCurrently, the Pulsar SQL couldn't support AvroSchema use the `ByteBuffer` as the field type. For example, use the POJO class as below.\n\n```\n@Data\npublic static class LogFile {\n    int id;\n    String name;\n    ByteBuffer data;\n}\n\nProducer<LogFile> producer = pulsarClient.newProducer(Schema.AVRO(LogFile.class)).topic(topic).create();\n```\n\nError Log\n```\n2020-05-08T23:34:47.079+0800\tERROR\tSplitRunner-5-101\tcom.facebook.presto.execution.executor.TaskExecutor\tError processing Split 20200508_153445_00006_nxngm.1.0-1 PulsarSplit{splitId=1, connectorId='pulsar', originSchemaName='bytes-sql-test4', schemaName='public/default', tableName='bytes-sql-test4', splitSize=4, schema='{\"type\":\"record\",\"name\":\"LogFile\",\"namespace\":\"com.ran.schema.KeyValueSchemaTest$\",\"fields\":[{\"name\":\"id\",\"type\":\"int\"},{\"name\":\"name\",\"type\":[\"null\",\"string\"],\"default\":null},{\"name\":\"data\",\"type\":[\"null\",\"bytes\"],\"default\":null}]}', schemaType=AVRO, startPositionEntryId=5, endPositionEntryId=9, startPositionLedgerId=3359, endPositionLedgerId=3359, schemaInfoProperties={\"__alwaysAllowNull\":\"true\"}} (start = 4.34095226272178E8, wall = 546 ms, cpu = 0 ms, wait = 0 ms, calls = 1)\njava.lang.ClassCastException: java.nio.HeapByteBuffer cannot be cast to [B\n\tat org.apache.pulsar.sql.presto.PulsarRecordCursor.getSlice(PulsarRecordCursor.java:516)\n\tat com.facebook.presto.spi.RecordPageSource.getNextPage(RecordPageSource.java:117)\n\tat com.facebook.presto.operator.TableScanOperator.getOutput(TableScanOperator.java:242)\n\tat com.facebook.presto.operator.Driver.processInternal(Driver.java:373)\n\tat com.facebook.presto.operator.Driver.lambda$processFor$8(Driver.java:282)\n\tat com.facebook.presto.operator.Driver.tryWithLock(Driver.java:672)\n\tat com.facebook.presto.operator.Driver.processFor(Driver.java:276)\n\tat com.facebook.presto.execution.SqlTaskExecution$DriverSplitRunner.processFor(SqlTaskExecution.java:973)\n\tat com.facebook.presto.execution.executor.PrioritizedSplitRunner.process(PrioritizedSplitRunner.java:162)\n\tat com.facebook.presto.execution.executor.TaskExecutor$TaskRunner.run(TaskExecutor.java:477)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat java.lang.Thread.run(Thread.java:748)\n```\n\n### Modifications\n\nWhen the presto field record type is `VarbinaryType.VARBINARY`, check the record type is `ByteBuffer`, `byte[]`, `ByteBuf` or others, and to process the field record by the type.\n\n* pulsar sql support avro schema `ByteBuffer` type\n\n* add ByteBuf check and unit tests.\n(cherry picked from commit 3aaed249f5c200431f5e8dacad2de2cbd64ee1ad)\n", "commitDateTime": "2020-05-12 21:32:15", "authoredDateTime": "2020-05-11 15:23:38", "commitGitStats": [{"filePath": "pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarRecordCursor.java", "insertions": 29, "deletions": 1, "lines": 30}, {"filePath": "pulsar-sql/presto-pulsar/src/test/java/org/apache/pulsar/sql/presto/TestPulsarRecordCursor.java", "insertions": 51, "deletions": 0, "lines": 51}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarRecordCursor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.PulsarRecordCursor.toBytes(java.lang.Object)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.sql.presto.PulsarRecordCursor.getSlice(int)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "TestPulsarRecordCursor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.TestPulsarRecordCursor.testRecordToBytes()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Produce encrypted messages, messageMetadata objects are not recycle", "body": "When producing encrypted messages for inspection, MessageMetadata objects are not released after they are created\r\n\r\n\r\norg.apache.pulsar.broker.service.Producer\r\n```\r\n if (topic.isEncryptionRequired()) {\r\n\r\n            headersAndPayload.markReaderIndex();\r\n            MessageMetadata msgMetadata = Commands.parseMessageMetadata(headersAndPayload);\r\n            headersAndPayload.resetReaderIndex();\r\n            // Check whether the message is encrypted or not\r\n            if (msgMetadata.getEncryptionKeysCount() < 1) {\r\n                log.warn(\"[{}] Messages must be encrypted\", getTopic().getName());\r\n                cnx.ctx().channel().eventLoop().execute(() -> {\r\n                    cnx.ctx().writeAndFlush(Commands.newSendError(producerId, sequenceId, ServerError.MetadataError,\r\n                            \"Messages must be encrypted\"));\r\n                    cnx.completedSendOperation(isNonPersistentTopic, headersAndPayload.readableBytes());\r\n                });\r\n                return;\r\n            }\r\n        }\r\n    }\r\n```\r\n*MessageMetadata was not recycled*\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6744", "user": "liudezhi2098", "labels": ["type/bug"], "created": "2020-04-16 09:47:21", "closed": "2020-04-16 15:30:08", "commits": {"dadb878d176b8fb72a910880a316b2926d2d5466": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "8c2d1cf5251a16404437ed779ea09ca3062e7cb0": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "dadb878d176b8fb72a910880a316b2926d2d5466", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["65e21036251eed623a48eeb8e2ce96458caca137"], "nameRev": "dadb878d176b8fb72a910880a316b2926d2d5466 tags/v2.6.0-candidate-1~287", "commitMessage": "fix_msgMetadata_not_recycle (#6745)\n\n**Motivation**\r\nfix when producing encrypted messages for inspection, MessageMetadata objects are not released after they are created. #6744\r\n```javascript\r\nif (topic.isEncryptionRequired()) {\r\n\r\n            headersAndPayload.markReaderIndex();\r\n            MessageMetadata msgMetadata = Commands.parseMessageMetadata(headersAndPayload);\r\n            headersAndPayload.resetReaderIndex();\r\n            // Check whether the message is encrypted or not\r\n            if (msgMetadata.getEncryptionKeysCount() < 1) {\r\n                log.warn(\"[{}] Messages must be encrypted\", getTopic().getName());\r\n                cnx.ctx().channel().eventLoop().execute(() -> {\r\n                    cnx.ctx().writeAndFlush(Commands.newSendError(producerId, sequenceId, ServerError.MetadataError,\r\n                            \"Messages must be encrypted\"));\r\n                    cnx.completedSendOperation(isNonPersistentTopic, headersAndPayload.readableBytes());\r\n                });\r\n                return;\r\n            }\r\n        }\r\n    }\r\n```\r\nMessageMetadata was not recycled\r\n\r\n**Changes**\r\nReplace old value with new value\r\n```javascript\r\n if (topic.isEncryptionRequired()) {\r\n\r\n            headersAndPayload.markReaderIndex();\r\n            MessageMetadata msgMetadata = Commands.parseMessageMetadata(headersAndPayload);\r\n            headersAndPayload.resetReaderIndex();\r\n            int encryptionKeysCount = msgMetadata.getEncryptionKeysCount();\r\n            metadata.recycle();\r\n            // Check whether the message is encrypted or not\r\n            if (encryptionKeysCount < 1) {\r\n                log.warn(\"[{}] Messages must be encrypted\", getTopic().getName());\r\n                cnx.ctx().channel().eventLoop().execute(() -> {\r\n                    cnx.ctx().writeAndFlush(Commands.newSendError(producerId, sequenceId, ServerError.MetadataError,\r\n                            \"Messages must be encrypted\"));\r\n                    cnx.completedSendOperation(isNonPersistentTopic, headersAndPayload.readableBytes());\r\n                });\r\n                return;\r\n            }\r\n        }\r\n```\r\n\r\n* fix_msgMetadata_not_recycle\r\n\r\nCo-authored-by: dezhiliu <dezhiliu@tencent.com>", "commitDateTime": "2020-04-16 23:30:07", "authoredDateTime": "2020-04-16 23:30:07", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Producer.java", "insertions": 3, "deletions": 2, "lines": 5}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Producer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.Producer.beforePublish(long,long,io.netty.buffer.ByteBuf,long)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "8c2d1cf5251a16404437ed779ea09ca3062e7cb0", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["0d5d0c1559d695e870aec1feb970b5fb01e8f2b7"], "nameRev": "8c2d1cf5251a16404437ed779ea09ca3062e7cb0 tags/v2.5.2-candidate-1~50", "commitMessage": "fix_msgMetadata_not_recycle (#6745)\n\n**Motivation**\nfix when producing encrypted messages for inspection, MessageMetadata objects are not released after they are created. #6744\n```javascript\nif (topic.isEncryptionRequired()) {\n\n            headersAndPayload.markReaderIndex();\n            MessageMetadata msgMetadata = Commands.parseMessageMetadata(headersAndPayload);\n            headersAndPayload.resetReaderIndex();\n            // Check whether the message is encrypted or not\n            if (msgMetadata.getEncryptionKeysCount() < 1) {\n                log.warn(\"[{}] Messages must be encrypted\", getTopic().getName());\n                cnx.ctx().channel().eventLoop().execute(() -> {\n                    cnx.ctx().writeAndFlush(Commands.newSendError(producerId, sequenceId, ServerError.MetadataError,\n                            \"Messages must be encrypted\"));\n                    cnx.completedSendOperation(isNonPersistentTopic, headersAndPayload.readableBytes());\n                });\n                return;\n            }\n        }\n    }\n```\nMessageMetadata was not recycled\n\n**Changes**\nReplace old value with new value\n```javascript\n if (topic.isEncryptionRequired()) {\n\n            headersAndPayload.markReaderIndex();\n            MessageMetadata msgMetadata = Commands.parseMessageMetadata(headersAndPayload);\n            headersAndPayload.resetReaderIndex();\n            int encryptionKeysCount = msgMetadata.getEncryptionKeysCount();\n            metadata.recycle();\n            // Check whether the message is encrypted or not\n            if (encryptionKeysCount < 1) {\n                log.warn(\"[{}] Messages must be encrypted\", getTopic().getName());\n                cnx.ctx().channel().eventLoop().execute(() -> {\n                    cnx.ctx().writeAndFlush(Commands.newSendError(producerId, sequenceId, ServerError.MetadataError,\n                            \"Messages must be encrypted\"));\n                    cnx.completedSendOperation(isNonPersistentTopic, headersAndPayload.readableBytes());\n                });\n                return;\n            }\n        }\n```\n\n* fix_msgMetadata_not_recycle\n\nCo-authored-by: dezhiliu <dezhiliu@tencent.com>(cherry picked from commit dadb878d176b8fb72a910880a316b2926d2d5466)\n", "commitDateTime": "2020-05-08 16:21:52", "authoredDateTime": "2020-04-16 23:30:07", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Producer.java", "insertions": 3, "deletions": 2, "lines": 5}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Producer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.Producer.beforePublish(long,long,io.netty.buffer.ByteBuf,long)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Compile client failed with container", "body": "**Describe the bug**\r\nWhen i try to compile client with container,  it failed with link error.\r\n\r\n/opt/rh/devtoolset-2/root/usr/libexec/gcc/x86_64-CentOS-linux/4.8.2/ld: /usr/local/lib/libsnappy.a(snappy.o): relocation R_X86_64_32 against `.rodata' can not be used when making a shared object; recompile with -fPIC\r\n\r\nIn the container, i find the snappy compiled with  CFLAGS=\"-fPIC -O3\" .\r\n# Snappy\r\nRUN curl -O -L https://github.com/google/snappy/releases/download/1.1.3/snappy-1.1.3.tar.gz && \\\r\n    tar xvfz snappy-1.1.3.tar.gz && \\\r\n    cd snappy-1.1.3 && \\\r\n    CFLAGS=\"-fPIC -O3\" ./configure && \\\r\n    make && make install && \\\r\n    rm -rf /snappy-1.1.3 /snappy-1.1.3.tar.gz\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6724", "user": "wenxuwan", "labels": ["triage/week-16", "type/bug"], "created": "2020-04-13 04:01:08", "closed": "2020-04-16 01:34:29", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "cannot be correctly parsed batch message from http response", "body": "**Describe the bug**\r\nwhen get batch message from http response,  only get the first message.\r\n\r\nmethod: \r\n`List<Message<byte[]>> getIndividualMsgsFromBatch(String topic, String msgId, byte[] data,\r\n                                                             Map<String, String> properties`\r\n\r\n**To Reproduce**\r\n```java\r\n   private List<Message<byte[]>> getIndividualMsgsFromBatch(String topic, String msgId, byte[] data,\r\n                                                             Map<String, String> properties) {\r\n        List<Message<byte[]>> ret = new ArrayList<>();\r\n        int batchSize = Integer.parseInt(properties.get(BATCH_HEADER));\r\n        for (int i = 0; i < batchSize; i++) {\r\n            String batchMsgId = msgId + \":\" + i;\r\n            PulsarApi.SingleMessageMetadata.Builder singleMessageMetadataBuilder = PulsarApi.SingleMessageMetadata\r\n                    .newBuilder();\r\n            ByteBuf buf = Unpooled.wrappedBuffer(data); \r\n            try {\r\n                ByteBuf singleMessagePayload = Commands.deSerializeSingleMessageInBatch(buf, singleMessageMetadataBuilder, i,\r\n                        batchSize);\r\n                SingleMessageMetadata singleMessageMetadata = singleMessageMetadataBuilder.build();\r\n                if (singleMessageMetadata.getPropertiesCount() > 0) {\r\n                    for (KeyValue entry : singleMessageMetadata.getPropertiesList()) {\r\n                        properties.put(entry.getKey(), entry.getValue());\r\n                    }\r\n                }\r\n                ret.add(new MessageImpl<>(topic, batchMsgId, properties, singleMessagePayload, Schema.BYTES));\r\n            } catch (Exception ex) {\r\n                log.error(\"Exception occured while trying to get BatchMsgId: {}\", batchMsgId, ex);\r\n            }\r\n            buf.release();\r\n            singleMessageMetadataBuilder.recycle();\r\n        }\r\n        return ret;\r\n    }\r\n```\r\nByteBuf buf need to move out of the loop\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6714", "user": "liudezhi2098", "labels": ["triage/week-16", "type/bug"], "created": "2020-04-11 02:45:34", "closed": "2020-04-16 09:35:51", "commits": {"565e3196e0be0b52f78137fddcb0cfde655ee010": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "e75e0a06cc0ab3af38f88ba5544202b624e4d69d": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "565e3196e0be0b52f78137fddcb0cfde655ee010", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["cdc3883644f4b2ef0d33cca258f918aebc6aa1ab"], "nameRev": "565e3196e0be0b52f78137fddcb0cfde655ee010 tags/v2.6.0-candidate-1~299", "commitMessage": "fix_admin_getIndividualMsgsFromBatch_bug (#6715)\n\n**Motivation**\r\nfix when get batch message from http response, only get the first message. #6714\r\n```javascript\r\nfor (int i = 0; i < batchSize; i++) {\r\n            String batchMsgId = msgId + \":\" + i;\r\n            PulsarApi.SingleMessageMetadata.Builder singleMessageMetadataBuilder = PulsarApi.SingleMessageMetadata\r\n                    .newBuilder();\r\n            ByteBuf buf = Unpooled.wrappedBuffer(data); // here you need to move out of the loop\r\n            try {\r\n                ByteBuf singleMessagePayload = Commands.deSerializeSingleMessageInBatch(buf, singleMessageMetadataBuilder, i,\r\n                        batchSize);\r\n                SingleMessageMetadata singleMessageMetadata = singleMessageMetadataBuilder.build();\r\n                if (singleMessageMetadata.getPropertiesCount() > 0) {\r\n                    for (KeyValue entry : singleMessageMetadata.getPropertiesList()) {\r\n                        properties.put(entry.getKey(), entry.getValue());\r\n                    }\r\n                }\r\n                ret.add(new MessageImpl<>(topic, batchMsgId, properties, singleMessagePayload, Schema.BYTES));\r\n            } catch (Exception ex) {\r\n                log.error(\"Exception occured while trying to get BatchMsgId: {}\", batchMsgId, ex);\r\n            }\r\n            buf.release();\r\n            singleMessageMetadataBuilder.recycle();\r\n        }\r\n```\r\nByteBuf buf  need to move out of the loop\r\n\r\n**Changes**\r\nReplace old value with new value\r\n```javascript\r\n ByteBuf buf = Unpooled.wrappedBuffer(data);\r\n        for (int i = 0; i < batchSize; i++) {\r\n            String batchMsgId = msgId + \":\" + i;\r\n            PulsarApi.SingleMessageMetadata.Builder singleMessageMetadataBuilder = PulsarApi.SingleMessageMetadata\r\n                    .newBuilder();\r\n            try {\r\n                ByteBuf singleMessagePayload =\r\n                        Commands.deSerializeSingleMessageInBatch(buf, singleMessageMetadataBuilder, i, batchSize);\r\n                SingleMessageMetadata singleMessageMetadata = singleMessageMetadataBuilder.build();\r\n                if (singleMessageMetadata.getPropertiesCount() > 0) {\r\n                    for (KeyValue entry : singleMessageMetadata.getPropertiesList()) {\r\n                        properties.put(entry.getKey(), entry.getValue());\r\n                    }\r\n                }\r\n                ret.add(new MessageImpl<>(topic, batchMsgId, properties, singleMessagePayload, Schema.BYTES));\r\n            } catch (Exception ex) {\r\n                log.error(\"Exception occured while trying to get BatchMsgId: {}\", batchMsgId, ex);\r\n            }\r\n            singleMessageMetadataBuilder.recycle();\r\n        }\r\n        buf.release();\r\n```", "commitDateTime": "2020-04-13 21:10:28", "authoredDateTime": "2020-04-14 12:10:28", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTopicApiTest.java", "insertions": 103, "deletions": 0, "lines": 103}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/TopicsImpl.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminTopicApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminTopicApiTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicsImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getIndividualMsgsFromBatch(java.lang.String,java.lang.String,byte[],java.util.Map)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "e75e0a06cc0ab3af38f88ba5544202b624e4d69d", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["0fd02bd7569cbeecd8e512b05ab958443738d308"], "nameRev": "e75e0a06cc0ab3af38f88ba5544202b624e4d69d tags/v2.5.2-candidate-1~53", "commitMessage": "fix_admin_getIndividualMsgsFromBatch_bug (#6715)\n\n**Motivation**\nfix when get batch message from http response, only get the first message. #6714\n```javascript\nfor (int i = 0; i < batchSize; i++) {\n            String batchMsgId = msgId + \":\" + i;\n            PulsarApi.SingleMessageMetadata.Builder singleMessageMetadataBuilder = PulsarApi.SingleMessageMetadata\n                    .newBuilder();\n            ByteBuf buf = Unpooled.wrappedBuffer(data); // here you need to move out of the loop\n            try {\n                ByteBuf singleMessagePayload = Commands.deSerializeSingleMessageInBatch(buf, singleMessageMetadataBuilder, i,\n                        batchSize);\n                SingleMessageMetadata singleMessageMetadata = singleMessageMetadataBuilder.build();\n                if (singleMessageMetadata.getPropertiesCount() > 0) {\n                    for (KeyValue entry : singleMessageMetadata.getPropertiesList()) {\n                        properties.put(entry.getKey(), entry.getValue());\n                    }\n                }\n                ret.add(new MessageImpl<>(topic, batchMsgId, properties, singleMessagePayload, Schema.BYTES));\n            } catch (Exception ex) {\n                log.error(\"Exception occured while trying to get BatchMsgId: {}\", batchMsgId, ex);\n            }\n            buf.release();\n            singleMessageMetadataBuilder.recycle();\n        }\n```\nByteBuf buf  need to move out of the loop\n\n**Changes**\nReplace old value with new value\n```javascript\n ByteBuf buf = Unpooled.wrappedBuffer(data);\n        for (int i = 0; i < batchSize; i++) {\n            String batchMsgId = msgId + \":\" + i;\n            PulsarApi.SingleMessageMetadata.Builder singleMessageMetadataBuilder = PulsarApi.SingleMessageMetadata\n                    .newBuilder();\n            try {\n                ByteBuf singleMessagePayload =\n                        Commands.deSerializeSingleMessageInBatch(buf, singleMessageMetadataBuilder, i, batchSize);\n                SingleMessageMetadata singleMessageMetadata = singleMessageMetadataBuilder.build();\n                if (singleMessageMetadata.getPropertiesCount() > 0) {\n                    for (KeyValue entry : singleMessageMetadata.getPropertiesList()) {\n                        properties.put(entry.getKey(), entry.getValue());\n                    }\n                }\n                ret.add(new MessageImpl<>(topic, batchMsgId, properties, singleMessagePayload, Schema.BYTES));\n            } catch (Exception ex) {\n                log.error(\"Exception occured while trying to get BatchMsgId: {}\", batchMsgId, ex);\n            }\n            singleMessageMetadataBuilder.recycle();\n        }\n        buf.release();\n```\n(cherry picked from commit 565e3196e0be0b52f78137fddcb0cfde655ee010)\n", "commitDateTime": "2020-05-08 16:21:11", "authoredDateTime": "2020-04-14 12:10:28", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTopicApiTest.java", "insertions": 103, "deletions": 0, "lines": 103}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/TopicsImpl.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminTopicApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminTopicApiTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicsImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getIndividualMsgsFromBatch(java.lang.String,java.lang.String,byte[],java.util.Map)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Health check fails when running Docker images", "body": "**Describe the bug**\r\nWhen requesting the health check endpoint for a broker, it always fails when running inside a Docker image:\r\n\r\n```curl localhost:8080/admin/v2/brokers/health\r\n\r\n --- An unexpected error occurred in the server ---\r\n\r\nMessage: org.apache.pulsar.client.api.PulsarClientException$TimeoutException: 5 lookup request timedout after ms 30000\r\n\r\nStacktrace:\r\n\r\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$TimeoutException: 5 lookup request timedout after ms 30000\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)\r\n\tat java.util.concurrent.CompletableFuture.biRelay(CompletableFuture.java:1284)\r\n\tat java.util.concurrent.CompletableFuture$BiRelay.tryFire(CompletableFuture.java:1270)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.lambda$connectionOpened$14(ProducerImpl.java:1205)\r\n\tat java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)\r\n\tat java.util.concurrent.CompletableFuture$UniExceptionally.tryFire(CompletableFuture.java:852)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)\r\n\tat org.apache.pulsar.client.impl.ClientCnx.checkRequestTimeout(ClientCnx.java:1026)\r\n\tat org.apache.pulsar.client.impl.ClientCnx.lambda$channelActive$0(ClientCnx.java:187)\r\n\tat io.netty.util.concurrent.PromiseTask.runTask(PromiseTask.java:98)\r\n\tat io.netty.util.concurrent.ScheduledFutureTask.run(ScheduledFutureTask.java:176)\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:164)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:472)\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:384)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: org.apache.pulsar.client.api.PulsarClientException$TimeoutException: 5 lookup request timedout after ms 30000\r\n\tat org.apache.pulsar.client.impl.ClientCnx.checkRequestTimeout(ClientCnx.java:1025)\r\n\t... 10 more\r\n```\r\n\r\nThis problem does not happen when running the broker in standalone mode.\r\n\r\nThis issue is present in master and in the v2.5.1-candidate-2 tag. In an identical setup running 2.5.0, this does not happen.\r\n\r\n**To Reproduce**\r\n\r\n1. Build Docker images like this:\r\n\r\n```\r\ngit checkout master\r\nmvn install -DskipTests\r\ncd docker\r\n./build.sh\r\n```\r\n\r\n2. Run the image in Kubernetes on minikube.\r\n\r\n3. From inside the broker container, call the health endpoint:\r\n\r\ncurl localhost:8080/admin/v2/brokers/health\r\n\r\n**Expected behavior**\r\nReturn HTTP 200.\r\n\r\n**Additional context**\r\n\r\nEvery time the endpoint is called, it leaves a handing producer on the topic:\r\n\r\n```\r\nbin/pulsar-admin topics stats persistent://pulsar/pulsar/10.32.0.6:8080/healthcheck\r\n{\r\n  \"msgRateIn\" : 0.0,\r\n  \"msgThroughputIn\" : 0.0,\r\n  \"msgRateOut\" : 0.0,\r\n  \"msgThroughputOut\" : 0.0,\r\n  \"averageMsgSize\" : 0.0,\r\n  \"storageSize\" : 0,\r\n  \"backlogSize\" : 0,\r\n  \"publishers\" : [ {\r\n    \"msgRateIn\" : 0.0,\r\n    \"msgThroughputIn\" : 0.0,\r\n    \"averageMsgSize\" : 0.0,\r\n    \"producerId\" : 0,\r\n    \"metadata\" : { },\r\n    \"producerName\" : \"pulsar-0-2\",\r\n    \"connectedSince\" : \"2020-04-10T11:20:20.001Z\",\r\n    \"clientVersion\" : \"2.5.1\",\r\n    \"address\" : \"/10.32.0.6:56852\"\r\n  }, {\r\n    \"msgRateIn\" : 0.0,\r\n    \"msgThroughputIn\" : 0.0,\r\n    \"averageMsgSize\" : 0.0,\r\n    \"producerId\" : 2,\r\n    \"metadata\" : { },\r\n    \"producerName\" : \"pulsar-0-4\",\r\n    \"connectedSince\" : \"2020-04-10T11:35:42.63Z\",\r\n    \"clientVersion\" : \"2.5.1\",\r\n    \"address\" : \"/10.32.0.6:56852\"\r\n  }, {\r\n    \"msgRateIn\" : 0.0,\r\n    \"msgThroughputIn\" : 0.0,\r\n    \"averageMsgSize\" : 0.0,\r\n    \"producerId\" : 1,\r\n    \"metadata\" : { },\r\n    \"producerName\" : \"pulsar-0-3\",\r\n    \"connectedSince\" : \"2020-04-10T11:34:27.901Z\",\r\n    \"clientVersion\" : \"2.5.1\",\r\n    \"address\" : \"/10.32.0.6:56852\"\r\n  } ],\r\n  \"subscriptions\" : { },\r\n  \"replication\" : { },\r\n  \"deduplicationStatus\" : \"Disabled\",\r\n  \"bytesInCounter\" : 0,\r\n  \"msgInCounter\" : 0\r\n}\r\n```", "url": "https://github.com/apache/pulsar/issues/6710", "user": "cdbartholomew", "labels": ["type/bug"], "created": "2020-04-10 12:01:32", "closed": "2020-04-11 00:53:27", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Cannot create Pulsar-IO connector with nar maven plugin", "body": "**Describe the bug**\r\nNi-fi maven plugin is not copying /resources/META-INF/services/pulsar-io.yaml\r\nPulsar cannot load the connector because a yaml file is not inside the .nar archive\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1.  Clone an existing pulsar-io connector\r\n2. mvn compile\r\n3. Use nar plugin to generate .nar\r\n4. Copy the nar under connectors folder\r\n5. Type the command: pulsar-admin sink reload\r\n6. Type the command: pulsar-admin sinks available-sinks\r\n\r\n**Expected behavior**\r\nShould see the plug-in available\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/695970/78906950-4e859000-7a80-11ea-982b-dad685ee82ba.png)\r\n\r\n**Desktop (please complete the following information):**\r\n - macOS\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6701", "user": "itaross", "labels": ["type/bug"], "created": "2020-04-09 14:37:36", "closed": "2020-04-09 14:47:08", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[AVRO SCHEMA] Reset cursor on stream if avro encode fails", "body": "**Describe the bug**\r\nIf the avro encode fails, the cursor in the stream is not reset. For the next message the positions are thus arbitrary. \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Add an avro schema (Add it using the json string representing the avro schema). Keep the second field not null\r\n2. Write a message that sends null for the second field. This means first field was written into the buffer and the avro encode crashed before second field could be written.\r\n3. Write the correct message and notice that the correct message is not written from position 0 in the buffer.\r\n4. The decode shows that fields from first and second messages are mixed up and there are multiple different errors on decode. Below is a sample stacktrace. on the consumer side when msg.getValue() is invoked.\r\n\r\n```\r\nException in thread \"main\" org.apache.pulsar.shade.org.apache.avro.AvroRuntimeException: Malformed data. Length is negative: -52\r\n\tat org.apache.pulsar.shade.org.apache.avro.io.BinaryDecoder.doReadBytes(BinaryDecoder.java:336)\r\n\tat org.apache.pulsar.shade.org.apache.avro.io.BinaryDecoder.readString(BinaryDecoder.java:263)\r\n\tat org.apache.pulsar.shade.org.apache.avro.io.ResolvingDecoder.readString(ResolvingDecoder.java:201)\r\n\tat org.apache.pulsar.shade.org.apache.avro.generic.GenericDatumReader.readString(GenericDatumReader.java:422)\r\n\tat org.apache.pulsar.shade.org.apache.avro.generic.GenericDatumReader.readString(GenericDatumReader.java:414)\r\n\tat org.apache.pulsar.shade.org.apache.avro.generic.GenericDatumReader.readWithoutConversion(GenericDatumReader.java:181)\r\n\tat org.apache.pulsar.shade.org.apache.avro.generic.GenericDatumReader.read(GenericDatumReader.java:153)\r\n\tat org.apache.pulsar.shade.org.apache.avro.generic.GenericDatumReader.readField(GenericDatumReader.java:232)\r\n\tat org.apache.pulsar.shade.org.apache.avro.generic.GenericDatumReader.readRecord(GenericDatumReader.java:222)\r\n\tat org.apache.pulsar.shade.org.apache.avro.generic.GenericDatumReader.readWithoutConversion(GenericDatumReader.java:175)\r\n\tat org.apache.pulsar.shade.org.apache.avro.generic.GenericDatumReader.read(GenericDatumReader.java:153)\r\n\tat org.apache.pulsar.shade.org.apache.avro.generic.GenericDatumReader.read(GenericDatumReader.java:145)\r\n\tat org.apache.pulsar.client.impl.schema.generic.GenericAvroReader.read(GenericAvroReader.java:75)\r\n\tat org.apache.pulsar.client.impl.schema.generic.GenericAvroReader.read(GenericAvroReader.java:42)\r\n\tat org.apache.pulsar.client.api.schema.SchemaReader.read(SchemaReader.java:36)\r\n\tat org.apache.pulsar.client.impl.schema.StructSchema.decode(StructSchema.java:98)\r\n\tat org.apache.pulsar.client.impl.schema.AutoConsumeSchema.decode(AutoConsumeSchema.java:96)\r\n\tat org.apache.pulsar.client.impl.schema.AutoConsumeSchema.decode(AutoConsumeSchema.java:39)\r\n\tat org.apache.pulsar.client.impl.MessageImpl.getValue(MessageImpl.java:275)\r\n\r\n```\r\nThe bugs was noticed in 2.4, 2.5 as well as the latest \r\n\r\n\r\n**Expected behavior**\r\nThe first message should be discarded. The second message should be produced and consumed correctly.\r\n\r\n**Additional context**\r\nThe debugger reveals  the issue when [this](https://github.com/apache/pulsar/blob/21f6dcdda406423f1bcfe4761831b7297d659fd1/pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/writer/AvroWriter.java#L44) line crashes.  The following flush() that resets the cursor to 0 is not executed and thence the issue. Copying code from the link for reference:\r\n\r\n```\r\n    public synchronized byte[] write(T message) {\r\n        try {\r\n            writer.write(message, this.encoder);   // if crash here, no flush so no reset cursor to 0.\r\n            this.encoder.flush();\r\n            return this.byteArrayOutputStream.toByteArray();\r\n        } catch (Exception e) {\r\n            throw new SchemaSerializationException(e);\r\n        } finally {\r\n            this.byteArrayOutputStream.reset();\r\n        }\r\n    }\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/6694", "user": "shiv4289", "labels": ["component/schemaregistry", "triage/week-15", "type/bug"], "created": "2020-04-08 15:05:04", "closed": "2020-04-14 08:43:47", "commits": {"7cffe2ab7420b0001f1337ef6007448124fecf18": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "14a1a2b9e8d81294625810413ff36191391103b7": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "7cffe2ab7420b0001f1337ef6007448124fecf18", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["d8be7c5b56199d89eee921adf99b983f7861cf61"], "nameRev": "7cffe2ab7420b0001f1337ef6007448124fecf18 tags/v2.6.0-candidate-1~297", "commitMessage": "[issue 6694][AVRO ENCODE] Reset cursor if message encode fails. (#6695)\n\nFixes #6694 \r\n\r\n### Motivation\r\n\r\nIf the avro encode for message fails after writing a few bytes, the cursor in the stream is not reset. The following **flush()** that would normally reset the cursor is skipped in the event of an exception.\r\n\r\n### Modifications\r\n\r\nAdd **flush()** in the finally block.\r\n\r\n### Test\r\nAdded test for verifying the fix", "commitDateTime": "2020-04-14 01:43:46", "authoredDateTime": "2020-04-14 14:01:46", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/writer/AvroWriter.java", "insertions": 8, "deletions": 2, "lines": 10}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/AvroSchemaTest.java", "insertions": 23, "deletions": 0, "lines": 23}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AvroWriter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.writer.AvroWriter.write(java.lang.Object)", "TOT": 6, "UPD": 0, "INS": 3, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "AvroSchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchemaTest.discardBufferIfBadAvroData()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "14a1a2b9e8d81294625810413ff36191391103b7", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["e75e0a06cc0ab3af38f88ba5544202b624e4d69d"], "nameRev": "14a1a2b9e8d81294625810413ff36191391103b7 tags/v2.5.2-candidate-1~52", "commitMessage": "[issue 6694][AVRO ENCODE] Reset cursor if message encode fails. (#6695)\n\nFixes #6694\n\n### Motivation\n\nIf the avro encode for message fails after writing a few bytes, the cursor in the stream is not reset. The following **flush()** that would normally reset the cursor is skipped in the event of an exception.\n\n### Modifications\n\nAdd **flush()** in the finally block.\n\n### Test\nAdded test for verifying the fix\n(cherry picked from commit 7cffe2ab7420b0001f1337ef6007448124fecf18)\n", "commitDateTime": "2020-05-08 16:21:22", "authoredDateTime": "2020-04-14 14:01:46", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/writer/AvroWriter.java", "insertions": 8, "deletions": 2, "lines": 10}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/AvroSchemaTest.java", "insertions": 23, "deletions": 0, "lines": 23}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AvroWriter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.writer.AvroWriter.write(java.lang.Object)", "TOT": 6, "UPD": 0, "INS": 3, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "AvroSchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchemaTest.discardBufferIfBadAvroData()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[v2.5.0]memory leak during offload to tiered storage", "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\nthe feature of \"offload to tiered storage\" cause severe memory leak and finally shut down the broker due to OOM\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nsetup a simple pulsar deployment with zookeeper, bookie, and broker.\r\nproduce message to topic continuously\r\nenable auto-offload by setting  --size-threshold 10M (driver = filesystem)\r\nand the offload works indeed but the memory consumed by broker goes up up and up  \r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\nno memory leak\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n<img width=\"1429\" alt=\"Screen Shot 2020-04-08 at 3 53 24 PM\" src=\"https://user-images.githubusercontent.com/8122303/78758731-2bd87600-79b1-11ea-874b-7e0ce686c479.png\">\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS] \r\nlinux \r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\nFYI, if disable the aotu-offload, the broker works fine. Once enable \"offload\", broker will shut down due to OOM\r\n", "url": "https://github.com/apache/pulsar/issues/6692", "user": "pheecian", "labels": ["component/tieredstorage", "release/2.5.2", "triage/week-15", "type/bug"], "created": "2020-04-08 07:56:13", "closed": "2020-04-22 09:06:23", "commits": {"514b6af7586633424739cfc3c6131b0d0afec9e4": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "74c668a35130b85cf67256ab10466dbc06f99e50": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 14.000277777777777, "commitsDetails": [{"commitHash": "514b6af7586633424739cfc3c6131b0d0afec9e4", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["b9bdfa12637fdeb67a23c410a799f1d4d4cb99d6"], "nameRev": "514b6af7586633424739cfc3c6131b0d0afec9e4 tags/v2.6.0-candidate-1~270", "commitMessage": "Avoid prefetch too much data when offloading data to HDFS (#6717)\n\nFixes #6692 \r\n\r\n### Motivation\r\navoid prefetch too much data when offloading, which may lead to OOM;\r\nfix object not close issue, which is also mentioned by congbobo184 https://github.com/apache/pulsar/pull/6697\r\n\r\n*Explain here the context, and why you're making that change. What is the problem you're trying to solve.*\r\n\r\n### Does this pull request potentially affect one of the following parts:\r\n\r\n*If `yes` was chosen, please highlight the changes*\r\n\r\n  - Dependencies (does it add or upgrade a dependency): (no)\r\n  - The public API: (no)\r\n  - The schema: (no)\r\n  - The default values of configurations: (no)\r\n  - The wire protocol: (no)\r\n  - The rest endpoints: (no)\r\n  - The admin cli options: (no)\r\n  - Anything that affects deployment: (no)\r\n\r\n### Documentation\r\n\r\n  - Does this pull request introduce a new feature? (no)", "commitDateTime": "2020-04-22 17:06:22", "authoredDateTime": "2020-04-22 17:06:22", "commitGitStats": [{"filePath": "conf/broker.conf", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/policies/data/OffloadPolicies.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "tiered-storage/file-system/src/main/java/org/apache/bookkeeper/mledger/offload/filesystem/impl/FileSystemManagedLedgerOffloader.java", "insertions": 56, "deletions": 17, "lines": 73}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServiceConfiguration.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.ServiceConfiguration", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "OffloadPolicies.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.policies.data.OffloadPolicies", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.policies.data.OffloadPolicies.hashCode()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.policies.data.OffloadPolicies.equals(java.lang.Object)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.policies.data.OffloadPolicies.toString()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "FileSystemManagedLedgerOffloader.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.offload(org.apache.bookkeeper.client.api.ReadHandle,java.util.UUID,java.util.Map)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.LedgerReader.run()", "TOT": 5, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.FileSystemWriter", "TOT": 25, "UPD": 0, "INS": 5, "MOV": 10, "DEL": 10}, {"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.LedgerReader", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.FileSystemWriter.recycle()", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.FileSystemWriter.create(org.apache.bookkeeper.client.api.LedgerEntries,org.apache.hadoop.io.MapFile$Writer,java.util.concurrent.Semaphore,java.util.concurrent.CountDownLatch,java.util.concurrent.atomic.AtomicLong,org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader$LedgerReader)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.FileSystemWriter.run()", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "74c668a35130b85cf67256ab10466dbc06f99e50", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["c3fa923e46ae37c7bab5503dbd40c3a0c54fe154"], "nameRev": "74c668a35130b85cf67256ab10466dbc06f99e50 tags/v2.5.2-candidate-1~44", "commitMessage": "Avoid prefetch too much data when offloading data to HDFS (#6717)\n\nFixes #6692\n\n### Motivation\navoid prefetch too much data when offloading, which may lead to OOM;\nfix object not close issue, which is also mentioned by congbobo184 https://github.com/apache/pulsar/pull/6697\n\n*Explain here the context, and why you're making that change. What is the problem you're trying to solve.*\n\n### Does this pull request potentially affect one of the following parts:\n\n*If `yes` was chosen, please highlight the changes*\n\n  - Dependencies (does it add or upgrade a dependency): (no)\n  - The public API: (no)\n  - The schema: (no)\n  - The default values of configurations: (no)\n  - The wire protocol: (no)\n  - The rest endpoints: (no)\n  - The admin cli options: (no)\n  - Anything that affects deployment: (no)\n\n### Documentation\n\n  - Does this pull request introduce a new feature? (no)\n(cherry picked from commit 514b6af7586633424739cfc3c6131b0d0afec9e4)\n", "commitDateTime": "2020-05-08 16:47:48", "authoredDateTime": "2020-04-22 17:06:22", "commitGitStats": [{"filePath": "conf/broker.conf", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/policies/data/OffloadPolicies.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "tiered-storage/file-system/src/main/java/org/apache/bookkeeper/mledger/offload/filesystem/impl/FileSystemManagedLedgerOffloader.java", "insertions": 56, "deletions": 17, "lines": 73}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServiceConfiguration.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.ServiceConfiguration", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "OffloadPolicies.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.policies.data.OffloadPolicies", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.policies.data.OffloadPolicies.hashCode()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.policies.data.OffloadPolicies.equals(java.lang.Object)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.policies.data.OffloadPolicies.toString()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "FileSystemManagedLedgerOffloader.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.offload(org.apache.bookkeeper.client.api.ReadHandle,java.util.UUID,java.util.Map)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.LedgerReader.run()", "TOT": 5, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.FileSystemWriter", "TOT": 25, "UPD": 0, "INS": 5, "MOV": 10, "DEL": 10}, {"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.LedgerReader", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.FileSystemWriter.recycle()", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.FileSystemWriter.create(org.apache.bookkeeper.client.api.LedgerEntries,org.apache.hadoop.io.MapFile$Writer,java.util.concurrent.Semaphore,java.util.concurrent.CountDownLatch,java.util.concurrent.atomic.AtomicLong,org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader$LedgerReader)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.offload.filesystem.impl.FileSystemManagedLedgerOffloader.FileSystemWriter.run()", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Pulsar proxy with TLS enabled not ignoring attribute fields in private key (loadPrivateKeyFromPemFile()) ", "body": "**Describe the bug**\r\n\r\nThere are cases when a private key pem file (e.g., when [converting a pkcs#12 pair to pem](https://security.stackexchange.com/a/191120)) may be of the format:\r\n```\r\nBag Attributes\r\n    friendlyName: *.example.com\r\n    localKeyID: <redacted>\r\nKey Attributes: <No Attributes>\r\n-----BEGIN PRIVATE KEY-----\r\n<redacted>\r\n-----END PRIVATE KEY-----\r\n```\r\n\r\nAs a result, the client can't complete the TLS connection... from client:\r\n```\r\nERROR ClientConnection:388 | ... Handshake failed: Connection reset by peer\r\n```\r\n**To Reproduce**\r\n\r\n1. Enable pulsar-proxy with TLS enabled\r\n2. Import your tls.crt and tls.key k8s secrets (import the cert) with key being in format of Description above\r\n3. Try to connect via `pulsar+ssl` with your client\r\n4. See the error:\r\n\r\nFrom client\r\n```\r\n2020-04-07 07:15:22.782 INFO  ConnectionPool:85 | Created connection for pulsar+ssl://<redacted>:6651\r\n2020-04-07 07:15:23.051 INFO  ClientConnection:330 | ... Connected to broker\r\n2020-04-07 07:15:23.256 ERROR ClientConnection:388 | ... Handshake failed: Connection reset by peer\r\n2020-04-07 07:15:23.256 INFO  ClientConnection:1349 | ... Connection closed\r\n```\r\n\r\nFrom server:\r\n```\r\n13:45:03.437 [pulsar-proxy-io-2-1] WARN  io.netty.channel.ChannelInitializer - Failed to initialize a channel. Closing: [id: 0x488d7794, L:/<redacted>]\r\njava.lang.IllegalArgumentException: Illegal base64 character 20\r\nu0009at java.util.Base64$Decoder.decode0(Base64.java:714) ~[?:1.8.0_232]\r\nu0009at java.util.Base64$Decoder.decode(Base64.java:526) ~[?:1.8.0_232]\r\nu0009at java.util.Base64$Decoder.decode(Base64.java:549) ~[?:1.8.0_232]\r\nu0009at org.apache.pulsar.common.util.SecurityUtility.loadPrivateKeyFromPemFile(SecurityUtility.java:206) ~[org.apache.pulsar-pulsar-common-2.4.2.jar:2.4.2]\r\n```\r\n\r\n**Expected behavior**\r\n\r\nAs, say, with other servers like nginx, it should be able to load the key appropriately even in this format. After applying workaround (see \"Workaround\" below), works:\r\n```\r\n2020-04-07 16:59:41.336 INFO  ConnectionPool:85 | Created connection for pulsar+ssl://<redacted>:6651\r\n2020-04-07 16:59:41.536 INFO  ClientConnection:330 | [<redacted>:<redacted> -> <redacted?:6651] Connected to broker\r\n2020-04-07 16:59:42.358 INFO  HandlerBase:53 | [persistent://<tenant>/<ns>/<topic>, ] Getting connection from pool\r\n2020-04-07 16:59:42.572 INFO  ConnectionPool:85 | Created connection for pulsar://<redacted>:6650\r\n2020-04-07 16:59:42.765 INFO  ClientConnection:332 | [<redacted>:<redacted> -> <redacted>:6651] Connected to broker through proxy. Logical broker: pulsar://<redacted>:6650\r\n```\r\n\r\n**Desktop (Environment):**\r\n - OS: Ubuntu 18.04\r\n - Kubernetes 1.15\r\n - Pulsar v2.4.2\r\n\r\n### Workaround\r\n\r\nMake sure private key begins and ands with `-----BEGIN` and `-----END`, respectively, and restart the pulsar-proxy\r\n\r\n### Proposed Solution\r\n\r\nIn https://github.com/apache/pulsar/blob/master/pulsar-common/src/main/java/org/apache/pulsar/common/util/SecurityUtility.java#L251-279, change:\r\n```\r\n            // Skip the first line (-----BEGIN RSA PRIVATE KEY-----)\r\n            reader.readLine();\r\n            while ((currentLine = reader.readLine()) != null) {\r\n                sb.append(previousLine);\r\n                previousLine = currentLine;\r\n            }\r\n            // Skip the last line (-----END RSA PRIVATE KEY-----)\r\n\r\n```\r\n... to something like:\r\n```\r\n            // Jump to the first line, eg: \"-----BEGIN RSA PRIVATE KEY-----\"\r\n            while(!reader.readLine().startsWith(\"-----BEGIN\") {\r\n                reader.readLine\r\n            }\r\n\r\n            // Stop once we see the last line (-----END RSA PRIVATE KEY-----)\r\n            while ((currentLine = reader.readLine()) != null && ! currentLine.startsWith(\"-----END\")) {\r\n                sb.append(currentLine);\r\n            }\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/6690", "user": "schahal", "labels": ["help wanted", "triage/week-15", "type/bug"], "created": "2020-04-08 01:56:29", "closed": "2020-04-08 16:07:03", "commits": {"5663acb68e905ab0634a80748a44c7c9b9c0a8a9": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "5663acb68e905ab0634a80748a44c7c9b9c0a8a9", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["21f6dcdda406423f1bcfe4761831b7297d659fd1"], "nameRev": "5663acb68e905ab0634a80748a44c7c9b9c0a8a9 tags/v2.6.0-candidate-1~316", "commitMessage": "More accurately load the private key from PEM file (#6690) (#6691)\n\nCo-authored-by: Satbir Chahal <satbir.chahal@petuum.com>", "commitDateTime": "2020-04-08 09:07:02", "authoredDateTime": "2020-04-08 09:07:02", "commitGitStats": [{"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/util/SecurityUtility.java", "insertions": 8, "deletions": 7, "lines": 15}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SecurityUtility.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.util.SecurityUtility.loadPrivateKeyFromPemFile(java.lang.String)", "TOT": 7, "UPD": 1, "INS": 2, "MOV": 2, "DEL": 2}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Kafka Source Connector in pulsar cluster", "body": "**Describe the bug**\r\nException in kafka source connector in pulsar cluster function worker\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Run Pulsar Cluster - one zookeeper, one broker and three bookie\r\n2. Ensure Function worker enabled\r\n3. Create Source for kafka\r\n4. Running kafka container and produce message to it.\r\n5. No Exception thrown instead getting hanged . while checking logs no more meaningful errors\r\n\r\n**Expected behavior**\r\nRunning Kafka Source Connector through function worker mode in pulsar cluster\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/43499028/78557506-8a291b80-782e-11ea-8060-a7a4c0321d36.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Windows\r\n\r\n**Additional context**\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6675", "user": "Esakkimuthu991", "labels": ["triage/week-15", "type/bug"], "created": "2020-04-06 12:16:47", "closed": "2020-04-09 20:18:05", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "Using Map's with Avro Generated Types Generates Weird Errors", "body": "**Description of the bug**\r\nI have a project that uses Avro generated types (POJO's generated by the Avro compiler) as the type to be serialized with the producer. Everything works fine excepts if one of the fields is a map. When the field is a map and a value is set into this map, the following error is generated:\r\n\r\n```\r\norg.apache.pulsar.shade.org.apache.avro.UnresolvedUnionException: Not in union\r\n   [\"null\",{\"type\":\"array\",\"items\":{\"type\":\"record\",\"name\":\"PairCharSequenceDouble\",\r\n   \"namespace\":\"org.apache.pulsar.shade.org.apache.avro.reflect\",\r\n   \"fields\":[{\"name\":\"key\",\"type\":\"string\"},{\"name\":\"value\",\"type\":\"double\"}]},\r\n   \"java-class\":\"java.util.Map\"}]\r\n```\r\nAnecdotally, if the field containing a map is not set, the message is properly serialized, proving that the problem is indeed the map field. Also, the same type if implemented as a POJO class by hand (without using a Avro compiler) works fine. Which means that something happens during the message serialization when the type being serialized contains the code generated by the compiler.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Define an new type like the one below:\r\n```\r\n{\r\n    \"namespace\": \"com.acme.something\",\r\n    \"type\": \"record\",\r\n    \"name\": \"AvroGenComplexType\",\r\n    \"fields\": [\r\n        {\r\n            \"name\": \"stringField\",\r\n            \"type\": \"string\"\r\n        },\r\n        {\r\n            \"name\": \"booleanField\",\r\n            \"type\": \"boolean\"\r\n        },\r\n        {\r\n            \"name\": \"bytesField\",\r\n            \"type\": \"bytes\"\r\n        },\r\n        {\r\n            \"name\": \"intField\",\r\n            \"type\": \"int\"\r\n        },\r\n        {\r\n            \"name\": \"longField\",\r\n            \"type\": \"long\"\r\n        },\r\n        {\r\n            \"name\": \"floatField\",\r\n            \"type\": \"float\"\r\n        },\r\n        {\r\n            \"name\": \"doubleField\",\r\n            \"type\": \"double\"\r\n        },\r\n        {\r\n            \"name\": \"mapField\",\r\n            \"type\": [\r\n                \"null\",\r\n                {\r\n                    \"type\": \"map\",\r\n                    \"values\": \"double\"\r\n                }\r\n            ],\r\n            \"default\": null\r\n        },\r\n        {\r\n            \"name\": \"innerField\",\r\n            \"type\": [\r\n                \"null\",\r\n                {\r\n                    \"type\": \"record\",\r\n                    \"name\": \"AvroGenInnerType\",\r\n                    \"fields\": [\r\n                        {\r\n                            \"name\": \"doubleField\",\r\n                            \"type\": \"double\"\r\n                        },\r\n                        {\r\n                            \"name\": \"arrayField\",\r\n                            \"type\": {\r\n                                \"type\": \"array\",\r\n                                \"items\": \"string\"\r\n                            }\r\n                        },\r\n                        {\r\n                            \"name\": \"enumField\",\r\n                            \"type\": {\r\n                                \"type\": \"enum\",\r\n                                \"name\": \"AvroGenMultipleOptions\",\r\n                                \"symbols\": [\r\n                                    \"FirstOption\", \"SecondOption\",\r\n                                    \"ThirdOption\", \"FourthOption\"\r\n                                ],\r\n                                \"default\": \"FirstOption\"\r\n                            }\r\n                        }\r\n                    ]\r\n                }\r\n            ],\r\n            \"default\": null\r\n        }\r\n    ]\r\n}\r\n```\r\n2. Using a Avro compiler, generate the types for Java.\r\n3. Write a Pulsar producer with the following code:\r\n```\r\n    protected AvroGenComplexType createAvroGenComplexType() {\r\n\r\n        AvroGenComplexType.Builder complexType =\r\n            AvroGenComplexType.newBuilder();\r\n\r\n        complexType.setStringField(String.valueOf(RANDOM.nextInt()));\r\n        complexType.setBooleanField(RANDOM.nextBoolean());\r\n        byte[] bytes = new byte[1024];\r\n        RANDOM.nextBytes(bytes);\r\n        ByteBuffer byteBuffer = ByteBuffer.wrap(bytes);\r\n        complexType.setBytesField(byteBuffer);\r\n        complexType.setIntField(RANDOM.nextInt());\r\n        complexType.setLongField(RANDOM.nextLong());\r\n        complexType.setFloatField(RANDOM.nextFloat());\r\n        complexType.setDoubleField(RANDOM.nextDouble());\r\n\r\n        // ******** This part will generate the error ********\r\n        Map<CharSequence, Double> mapField = new HashMap<>(1);\r\n        mapField.put(String.valueOf(RANDOM.nextInt()), RANDOM.nextDouble());\r\n        complexType.setMapField(mapField);\r\n        // *****************************************************\r\n\r\n        complexType.setInnerFieldBuilder(AvroGenInnerType.newBuilder()\r\n            .setDoubleField(RANDOM.nextDouble())\r\n            .setArrayField(Arrays.asList(String.valueOf(RANDOM.nextInt())))\r\n            .setEnumField(AvroGenMultipleOptions.ThirdOption));\r\n\r\n        return complexType.build();\r\n\r\n    }\r\n\r\n    public void produceAvroGenBasedMessages(String topic, int numMessages)\r\n        throws PulsarClientException {\r\n        Producer<AvroGenComplexType> producer = null;\r\n        try {\r\n            producer = pulsarClient.newProducer(\r\n                Schema.AVRO(AvroGenComplexType.class))\r\n                    .topic(topic)\r\n                    .create();\r\n            for (int i = 0; i < numMessages; i++) {\r\n                producer.send(createAvroGenComplexType());\r\n            }\r\n        } finally {\r\n            if (producer != null) {\r\n                producer.closeAsync();\r\n            }\r\n        }\r\n    }\r\n\r\n```\r\n4. Execute the code and observe the error being thrown.\r\n\r\n**Expected behavior**\r\nThe code should execute completely without complaining about any errors related to the type being serialized. This is true specifically because the type being used was generated by the Avro compiler, which double-checks any compliance with the spec.\r\n\r\n**Screenshots**\r\nN/A\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Tested on Linux (Fedora 31)", "url": "https://github.com/apache/pulsar/issues/6669", "user": "riferrei", "labels": ["component/schemaregistry", "triage/week-14", "type/bug"], "created": "2020-04-04 23:41:22", "closed": "2020-05-11 02:51:15", "commits": {}, "ttf": 36.000277777777775, "commitsDetails": []}, {"title": "Error when installing the Helm chart", "body": "**Describe the bug**\r\n\r\nThe following error occurs when trying to install the Helm chart:\r\n\r\n    Error: YAML parse error on pulsar/templates/broker-configmap.yaml: error converting YAML to JSON: yaml: line 40: mapping values are not allowed in this context\r\n\r\n\r\n**To Reproduce**\r\n\r\n    helm install --name pulsar ./pulsar -f pulsar/values-mini.yaml\r\n    Error: YAML parse error on pulsar/templates/broker-configmap.yaml: error converting YAML to JSON: yaml: line 40: mapping values are not allowed in this context\r\n\r\n**Expected behavior**\r\nIt should work :)\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nI'm using Helm 2 \r\n\r\n    $ helm2 version\r\n    Client: &version.Version{SemVer:\"v2.16.5\", GitCommit:\"89bd14c1541fa93a09492010030fd3699ca65a97\", GitTreeState:\"clean\"}\r\n    Server: &version.Version{SemVer:\"v2.16.5\", GitCommit:\"bbdfe5e7803a12bbdf97e94cd847859890cf4050\", GitTreeState:\"clean\"}\r\n", "url": "https://github.com/apache/pulsar/issues/6663", "user": "dunglas", "labels": ["type/bug"], "created": "2020-04-03 16:37:36", "closed": "2020-04-03 17:14:25", "commits": {"98344a711670919785fc581fc6056299ba60dcea": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "98344a711670919785fc581fc6056299ba60dcea", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["3bb0380efa20ac2d21d6f8254ef5a7f1c7fb2d11"], "nameRev": "98344a711670919785fc581fc6056299ba60dcea tags/v2.6.0-candidate-1~335", "commitMessage": "[Issue 6663][helm] Lint the Helm chart in the CI (#6666)\n\n### Motivation\r\n\r\nPrevent issues such as #6663 by checking the validity of the Helm chart in the CI.\r\n\r\n### Modifications\r\n\r\nAdd a GitHub Actions workflow checking the chart.", "commitDateTime": "2020-04-03 16:33:57", "authoredDateTime": "2020-04-04 01:33:57", "commitGitStats": [{"filePath": ".github/workflows/ci-deployment-helm.yaml", "insertions": 41, "deletions": 0, "lines": 41}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Websocket Proxy Connectivity Issue (500 Server Error) ", "body": "**Describe the bug**\r\nWe are using Node.js with Websocket API to create the Producer and Consumer. Our infrastructure has as the below setup:\r\nWebsocket Producer/Consumer -->>connects to a loadbalancer -->>connects to Websocket Proxy -->>Brokers.\r\n\r\nThe Producers connects fine and we are able to produce messages. And, the Consumer is also able to connect and consume fine as long as the producer is producing and there are messages on the bus. But, whenever there is an idle time (when there is no messages on the bus) and the consumer is connected and waiting for the messages on the bus, it is throwing an \"Unexpected server response: 500\" Error. After multiple attempts of retry, the consumer reconnects again. \r\n\r\nBut, as the Producer Idle time is 60-70% of the day, the consumer is intermittently throwing a lot of 500 server Error, and reconnect attempts in the client logs.\r\n\r\nIdeally, this is not the behavior we should be seeing while connecting to the Websocket Proxy. The retry should get connected.\r\n\r\n**From The Client Logs:**\r\n```\r\n[start-subscription-consumer-prod] {\"method\": \"rws.ts -> ReconnectingWebSocket -> connect\", \"message\": \"Reopening Websocket connection with ready state: 0\", \"data\": {\"url\": \"-----?subscriptionType=Shared\"}}\r\n[start-subscription-consumer-prod] {\"method\": \"rws.ts -> ReconnectingWebSocket -> connect\", \"message\": \"Error occurred in ReconnectingWebSocket connecting to websocket\", \"error\": {\"url\": \"---?subscriptionType=Shared\"}}\r\n[start-subscription-consumer-prod] 2020-03-31 15:06:59: error: {\"method\": \"consumer.ts -> getConsumerData\",\"message\": \"Error occurred while connecting to websocket, Closing & Reopening\",\"error\": \"Error: Unexpected server response: 500\"}\r\n```\r\n**From the Websocket Proxy Logs:**\r\n```\r\n14:38:37.605 [pulsar-websocket-web-1-2] DEBUG org.eclipse.jetty.server.HttpChannel - COMPLETE for /ws/v2/consumer/persistent/---- written=900\r\n14:38:37.605 [pulsar-websocket-web-1-3] DEBUG org.eclipse.jetty.server.HttpChannel - COMPLETE for /ws/v2/consumer/---- written=902\r\n14:38:37.605 [pulsar-websocket-web-1-2] INFO  org.eclipse.jetty.server.RequestLog - 63.17.8.211 - - [31/Mar/2020:14:38:27 -0400] \"GET /ws/v2/consumer/----subscriptionType=Shared HTTP/1.1\" 500 900 \"-\" \"-\" 9999\r\n14:38:37.605 [pulsar-websocket-web-1-3] INFO  org.eclipse.jetty.server.RequestLog - 63.17.17.34 - - [31/Mar/2020:14:38:27 -0400] \"GET /ws/v2/consumer/----subscriptionType=Shared HTTP/1.1\" 500 902 \"-\" \"-\" 10006\r\n14:38:42.537 [pulsar-websocket-web-1-3] DEBUG org.eclipse.jetty.server.HttpChannel - REQUEST for //----/ws/v2/consumer/persistent/------subscriptionType=Shared on HttpChannelOverHttp@38ad8bac{r=1,c=false,a=IDLE,uri=//----subscriptionType=Shared,age=0}\r\nGET //---?subscriptionType=Shared HTTP/1.1\r\n14:38:42.537 [pulsar-websocket-web-1-3] DEBUG org.eclipse.jetty.server.HttpChannel - HttpChannelOverHttp@38ad8bac{r=1,c=false,a=IDLE,uri=----subscriptionType=Shared,age=0} onContentComplete\r\n14:38:42.537 [pulsar-websocket-web-1-3] DEBUG org.eclipse.jetty.server.HttpChannel - HttpChannelOverHttp@38ad8bac{r=1,c=false,a=IDLE,uri=----subscriptionType=Shared,age=0} onRequestComplete\r\n14:38:42.537 [pulsar-websocket-web-1-3] DEBUG org.eclipse.jetty.server.HttpChannel - HttpChannelOverHttp@38ad8bac{r=1,c=false,a=IDLE,uri=----subscriptionType=Shared,age=0} handle //----subscriptionType=Shared\r\n14:38:42.537 [pulsar-websocket-web-1-3] DEBUG org.eclipse.jetty.server.HttpChannel - HttpChannelOverHttp@38ad8bac{r=1,c=false,a=DISPATCHED,uri=---subscriptionType=Shared,age=0} action DISPATCH\r\n14:38:42.537 [pulsar-websocket-web-1-3] DEBUG org.eclipse.jetty.server.Server - REQUEST GET /ws/v2/consumer/-- on HttpChannelOverHttp@38ad8bac{r=1,c=false,a=DISPATCHED,uri=---subscriptionType=Shared,age=0}\r\n14:38:42.537 [pulsar-websocket-web-1-3] DEBUG org.eclipse.jetty.server.handler.ContextHandler - scope null||/ws/v2/consumer/---- @ o.e.j.s.ServletContextHandler@1c6804cd{/ws/v2/consumer,null,AVAILABLE}\r\n14:38:42.537 [pulsar-websocket-web-1-3] DEBUG org.eclipse.jetty.server.handler.ContextHandler - context=/ws/v2/consumer||/--- @ o.e.j.s.ServletContextHandler@1c6804cd{/ws/v2/consumer,null,AVAILABLE}\r\n14:38:42.537 [pulsar-websocket-web-1-3] DEBUG org.eclipse.jetty.servlet.ServletHandler - servlet /ws/v2/consumer||/--- -> ws-events@95770d2a==org.apache.pulsar.websocket.WebSocketConsumerServlet,jsp=null,order=-1,inst=true\r\n14:38:42.537 [pulsar-websocket-web-1-3] INFO  org.apache.pulsar.websocket.AbstractWebSocketHandler - [63.17.1.44:34686] Authenticated WebSocket client XYZ on topic ----\r\n14:38:42.543 [pulsar-websocket-web-1-4] DEBUG org.eclipse.jetty.server.HttpChannel - REQUEST for /---subscriptionType=Shared on HttpChannelOverHttp@2fb5dc40{r=1,c=false,a=IDLE,uri=----subscriptionType=Shared,age=0}\r\nGET //---subscriptionType=Shared HTTP/1.1\r\n```\r\n\r\n**From the Broker Logs:**\r\n```\r\n[pulsar-client-io-45-6] INFO  org.apache.pulsar.client.impl.ConsumerImpl - -- Subscribed to topic on WebsocketProxy:Port -- consumer: 7851\r\n[pulsar-web-30-11] INFO  org.eclipse.jetty.server.RequestLog - ClientIP - - [31/Mar/2020:08:19:39 -0400] \"GET /ws/v2/consumer/--subscriptionType=Shared HTTP/1.1\" 101 0 \"-\" \"-\" 4\r\n```\r\nWhy the client IP is seen on the broker logs? As the client is connecting to the Websocket Proxy, we should only see websocket proxy Ips in the broker logs for the connections. Is there some kind of connection leakage in websocket proxy?\r\n\r\n\r\nAs per our observation, there are multiple issues here with the connectivity to Websocket Proxys.\r\n\r\nAny suggestions to resolve this issues, please.\r\n", "url": "https://github.com/apache/pulsar/issues/6644", "user": "Saswatibhoi", "labels": ["component/websocket", "triage/week-14", "type/bug"], "created": "2020-03-31 19:10:01", "closed": "2020-05-27 15:43:04", "commits": {}, "ttf": 56.000277777777775, "commitsDetails": []}, {"title": "Why the Bookkeeper crash", "body": "I deploy my pulsar and bookeeper on three 24U96G VM.\r\nEach memory config is\r\n  bk: 18G heap 18G directMemory\r\n  pulsar: 18G heap 32G directMemory\r\n[pulsar-bookie-pulsar.log.zip](https://github.com/apache/pulsar/files/4396834/pulsar-bookie-pulsar.log.zip)\r\n\r\n\r\n\r\nWhen I am testing pulsar's millions topic ability, When I am adding producer and consumer, My bookkeeper process  often crash quit. I don't know how to position problem", "url": "https://github.com/apache/pulsar/issues/6629", "user": "Shoothzj", "labels": ["triage/week-14", "type/bug", "type/performance"], "created": "2020-03-28 08:35:39", "closed": "2020-04-17 06:19:58", "commits": {}, "ttf": 19.00027777777778, "commitsDetails": []}, {"title": "Documentation of admin REST API is missing body parameters", "body": "**Describe the bug**\r\nThere seems to have a regression in the documentation #1650\r\n\r\nThere is still no body request in the current admin REST API\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to https://pulsar.apache.org/admin-rest-api/?version=2.5.0#operation/setMaxProducersPerTopic\r\n2. There is no request body parameters\r\n\r\n**Expected behavior**\r\nTo see request body parameters, that way we can use the REST API without looking at java source code :wink: \r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n![image](https://user-images.githubusercontent.com/59561696/77745981-7f93a880-701c-11ea-882e-ea7eaad2fea2.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: ubuntu 18.04, firefox 74.0, chrome 80\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6625", "user": "jeremie-kaiko", "labels": ["component/documentation", "help wanted", "triage/week-14", "type/bug"], "created": "2020-03-27 10:20:36", "closed": "2020-06-29 01:45:58", "commits": {}, "ttf": 93.00027777777778, "commitsDetails": []}, {"title": "WebSocket Topic URL Parser is Incorrect", "body": "**Describe the bug**\r\nThe code [in the web socket interface](https://github.com/apache/pulsar/blob/639fbf1801b227bb191cfc548f26906902481b8f/pulsar-websocket/src/main/java/org/apache/pulsar/websocket/AbstractWebSocketHandler.java#L182) does not parse topic names correctly. I will limit my example to a consumer but similar issues apply to readers and producers.\r\nFrom the code (line numbers are for reference, they do not match the actual code)\r\n```java\r\n   1  String uri = request.getRequestURI();\r\n   2  List<String> parts = Splitter.on(\"/\").splitToList(uri);\r\n   3\r\n   4  // V1 Format must be like :\r\n   5  // /ws/producer/persistent/my-property/my-cluster/my-ns/my-topic\r\n   6  // or\r\n   7  // /ws/consumer/persistent/my-property/my-cluster/my-ns/my-topic/my-subscription\r\n   8  // or\r\n   9  // /ws/reader/persistent/my-property/my-cluster/my-ns/my-topic\r\n  10\r\n  11  // V2 Format must be like :\r\n  12  // /ws/v2/producer/persistent/my-property/my-ns/my-topic\r\n  13  // or\r\n  14  // /ws/v2/consumer/persistent/my-property/my-ns/my-topic/my-subscription\r\n  15  // or\r\n  16  // /ws/v2/reader/persistent/my-property/my-ns/my-topic\r\n  17\r\n  18  checkArgument(parts.size() >= 8, \"Invalid topic name format\");\r\n  19  checkArgument(parts.get(1).equals(\"ws\"));\r\n  20\r\n  21  final boolean isV2Format = parts.get(2).equals(\"v2\");\r\n  22  final int domainIndex = isV2Format ? 4 : 3;\r\n  23  checkArgument(parts.get(domainIndex).equals(\"persistent\") ||\r\n  24          parts.get(domainIndex).equals(\"non-persistent\"));\r\n  25\r\n  26\r\n  27  final String domain = parts.get(domainIndex);\r\n  28  final NamespaceName namespace = isV2Format ? NamespaceName.get(parts.get(5), parts.get(6)) :\r\n  29          NamespaceName.get( parts.get(4), parts.get(5), parts.get(6));\r\n  30  final String name = parts.get(7);\r\n  31\r\n  32  return TopicName.get(domain, namespace, name);\r\n  33\r\n```\r\n\r\n**To Reproduce**\r\nAs an breaking example, take the v2 web socket topic URL:\r\n\r\n```\r\n/ws/v2/consumer/persistent/my-tenant/my-ns/some/topic/with/slashes/my-sub\r\n```\r\n\r\nIn the code above, the following assignments would be made\r\n```java\r\n  27  final String domain = parts.get(4)\r\n```\r\nwhich translates to\r\n```java\r\n  27  final String domain = \"persistent\"  // this seems good\r\n```\r\nAnd then:\r\n```java\r\n 28  final NamespaceName namespace = NamespaceName.get(parts.get(5), parts.get(6))\r\n```\r\ntranslates to:\r\n```java\r\n 28  final NamespaceName namespace = NamespaceName.get(\"my-tenant\", \"my-ns\") // this seems good\r\n```\r\n\r\n**But then**, \r\n```java\r\n  30  final String name = parts.get(7);\r\n```\r\ntranslates to \r\n```java\r\n  30  final String name = \"some\"; // THIS IS ONLY THE FIRST PART OF THE TOPIC\r\n```\r\n\r\n**Expected behavior**\r\nThe topic name should have been parsed as `\"some/topic/with/slashes\"`.\r\nThe code assumes that the topic will not have any slashes in it. But this assumption is incorrect. The [documentation](http://pulsar.apache.org/docs/en/concepts-messaging/#topics) explicitly states that \"topic names are freeform\". The Java [code](https://github.com/apache/pulsar/blob/639fbf1801b227bb191cfc548f26906902481b8f/pulsar-common/src/test/java/org/apache/pulsar/common/naming/TopicNameTest.java#L180) even tests for this case. \r\n\r\n**Screenshots**\r\nN/a\r\n\r\n**Desktop (please complete the following information):**\r\nN/a\r\n\r\n**Additional context**\r\nN/a\r\n", "url": "https://github.com/apache/pulsar/issues/6619", "user": "tschmidt64", "labels": ["type/bug"], "created": "2020-03-27 00:36:03", "closed": "2020-04-02 00:54:39", "commits": {"11eb86c3a9abdd5149a0a54582cd85c63bfb5cf3": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "11eb86c3a9abdd5149a0a54582cd85c63bfb5cf3", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["c955ff9ebf363175991704d5dd17da7bdc5e7468"], "nameRev": "11eb86c3a9abdd5149a0a54582cd85c63bfb5cf3 tags/v2.6.0-candidate-1~339", "commitMessage": "Issue #6619: WebSocket Topic URL Parser is Incorrect (#6630)\n\nfix #6619\r\n\r\n* delete useless code\r\n\r\n* fix #6619\r\n\r\n* add license", "commitDateTime": "2020-04-02 08:54:37", "authoredDateTime": "2020-04-02 08:54:37", "commitGitStats": [{"filePath": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/AbstractWebSocketHandler.java", "insertions": 24, "deletions": 14, "lines": 38}, {"filePath": "pulsar-websocket/src/test/java/org/apache/pulsar/websocket/AbstractWebSocketHandlerTest.java", "insertions": 111, "deletions": 0, "lines": 111}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AbstractWebSocketHandler.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.websocket.AbstractWebSocketHandler.extractTopicName(javax.servlet.http.HttpServletRequest)", "TOT": 9, "UPD": 2, "INS": 5, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "AbstractWebSocketHandlerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.websocket.AbstractWebSocketHandlerTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "When ttlDurationDefaultInSeconds is set the messages are expired one by one every 5 minutes even before ttlDurationDefaultInSeconds is reached", "body": "Messages are being expired even before ttlDurationDefaultInSeconds is reached when ttlDurationDefaultInSeconds is set.\r\n\r\n**To Reproduce**\r\n1. in broker conf auto topic creation is enabled\r\n2. in broker set ttlDurationDefaultInSeconds to 604800 (in all brokers and restart them)\r\n3. now create subscription to topic - persistent/public/default/amit_test\r\n4. close the subscription\r\n5. create producer to above topic - providing a name and setting timeout to 0 (also dedup has been enabled in broker conf)\r\n6. Now send 2 messages to the topic using the producer one after another\r\n7. Now close the producer and client\r\n8. Now using admin stats monitor the topic - pulsar-broker:8080/admin/v2/persistent/public/default/amit_test/stats\r\n9. under the subscription can see that 2 messages are present in msgBacklog and lastExpireTimestamp is 0 (and no active producers or consumers)\r\n10. After couple of minutes can observe msgBacklog reduced to 1 and lastExpireTimestamp is set to recent timestamp\r\n11. After 5 more min can observe msgBacklog reduced to 0 and lastExpireTimestamp is updated to recent timestamp\r\n\r\n**Expected behavior**\r\nMessages should not be expired until ttl is reached.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu\r\n - Pulsar version - 2.5.0 \r\n", "url": "https://github.com/apache/pulsar/issues/6617", "user": "AmitANetskope", "labels": ["triage/week-14", "type/bug"], "created": "2020-03-26 10:30:23", "closed": "2020-04-08 02:19:13", "commits": {}, "ttf": 12.000277777777777, "commitsDetails": []}, {"title": "Failed to decode long type fields in json schema message", "body": "**Describe the bug**\r\nIf message sent in json schema, long field will be decoded as int if its value below Integer.MAX_VALUE, other wise decoded as string.\r\nFor example, the json message below: \r\n```json\r\n{\r\n    \"timestamp\": 1585204833128\r\n}\r\n```\r\nwill be decoded as \r\n\r\n```json\r\n{\r\n    \"timestamp\": \"1585204833128\"\r\n}\r\n```\r\n\r\n**To Reproduce**\r\n\r\n**Expected behavior**\r\nLong type fields encoded in json schema will be decoded as long.\r\n\r\n**Screenshots**\r\n\r\n**Desktop (please complete the following information):**\r\n\r\n\r\n**Additional context**\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6612", "user": "lynnmatrix", "labels": ["component/schemaregistry", "triage/week-13", "type/bug"], "created": "2020-03-26 06:45:26", "closed": "2020-04-05 19:17:13", "commits": {"1aad3b73efe2a2afe0cd2598987f112416117159": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "8035ae04a3f7f96e9829957dd5d3185ad4049b6c": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 10.000277777777777, "commitsDetails": [{"commitHash": "1aad3b73efe2a2afe0cd2598987f112416117159", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["c555eb7c915dcceec4df5273eacf5b38b2261123"], "nameRev": "1aad3b73efe2a2afe0cd2598987f112416117159 tags/v2.6.0-candidate-1~332", "commitMessage": "ISSUE-6612 FIX: parse long field in GenricJsonRecord (#6612) (#6622)\n\nFixes #6612\r\n\r\n\r\n### Motivation\r\n\r\nIf message sent in json schema, long field will be decoded as int if its value below Integer.MAX_VALUE, other wise decoded as string.\r\nFor example, the json message below: \r\n```json\r\n{\r\n    \"timestamp\": 1585204833128\r\n}\r\n```\r\nwill be decoded as \r\n\r\n```json\r\n{\r\n    \"timestamp\": \"1585204833128\"\r\n}\r\n```\r\n\r\n### Modifications\r\n\r\nAdd field type check in GenericJsonRecord", "commitDateTime": "2020-04-05 12:17:12", "authoredDateTime": "2020-04-06 03:17:12", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericJsonRecord.java", "insertions": 8, "deletions": 4, "lines": 12}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/generic/GenericJsonRecordTest.java", "insertions": 57, "deletions": 0, "lines": 57}], "commitSpoonAstDiffStats": [{"spoonFilePath": "GenericJsonRecord.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericJsonRecord.getField(java.lang.String)", "TOT": 19, "UPD": 4, "INS": 3, "MOV": 10, "DEL": 2}]}, {"spoonFilePath": "GenericJsonRecordTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericJsonRecordTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "8035ae04a3f7f96e9829957dd5d3185ad4049b6c", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["7f0cd1af01d74074a60ec9c6478adf9d59e63bca"], "nameRev": "8035ae04a3f7f96e9829957dd5d3185ad4049b6c tags/v2.5.2-candidate-1~57", "commitMessage": "ISSUE-6612 FIX: parse long field in GenricJsonRecord (#6612) (#6622)\n\nFixes #6612\n\n### Motivation\n\nIf message sent in json schema, long field will be decoded as int if its value below Integer.MAX_VALUE, other wise decoded as string.\nFor example, the json message below:\n```json\n{\n    \"timestamp\": 1585204833128\n}\n```\nwill be decoded as\n\n```json\n{\n    \"timestamp\": \"1585204833128\"\n}\n```\n\n### Modifications\n\nAdd field type check in GenericJsonRecord\n(cherry picked from commit 1aad3b73efe2a2afe0cd2598987f112416117159)\n", "commitDateTime": "2020-05-08 16:20:22", "authoredDateTime": "2020-04-06 03:17:12", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericJsonRecord.java", "insertions": 8, "deletions": 4, "lines": 12}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/generic/GenericJsonRecordTest.java", "insertions": 57, "deletions": 0, "lines": 57}], "commitSpoonAstDiffStats": [{"spoonFilePath": "GenericJsonRecord.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericJsonRecord.getField(java.lang.String)", "TOT": 19, "UPD": 4, "INS": 3, "MOV": 10, "DEL": 2}]}, {"spoonFilePath": "GenericJsonRecordTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericJsonRecordTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "TimeoutException on some client connected", "body": "**TimeoutException on some client connected**\r\nSince few moments, i face some issues on my standalone pulsar install. It ran without any issue until last week.\r\n\r\nI need to restart pulsar in order to have a clean pulsar broker but timeout exception come back few hours later and some clients are disconnected.\r\nAll clients that are trying to connect are directly disconnected.\r\n\r\nFor me, it's due to something that happen with topics policies may be.\r\n\r\nAny hints about this issue ? is it due to zookeepper ? or something due to disk memory ? \r\n\r\nThanks by advance.\r\n\r\n**Piece of Generated exception**\r\n\r\n>15:36:37.371 [ForkJoinPool.commonPool-worker-14] INFO  org.apache.pulsar.broker.service.AbstractTopic - Disabling publish throttling for persistent://mytenant/agent_namespace/data_up-38e04c4a-f49b-487d-a87e-5cc51f3d7dc4\r\n15:36:37.368 [pulsar-ordered-OrderedExecutor-5-0] WARN  org.apache.pulsar.broker.service.BrokerService - Got exception when reading persistence policy for persistent://my_tenant/agent_namespace/data_up-c8aa8f88-8db6-4fbc-b1cd-c5cf6237a5af: null\r\njava.util.concurrent.TimeoutException: null\r\n        at java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1784) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1928) ~[?:1.8.0_232]\r\n        at org.apache.pulsar.zookeeper.ZooKeeperDataCache.get(ZooKeeperDataCache.java:97) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.service.BrokerService.lambda$getManagedLedgerConfig$32(BrokerService.java:922) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.bookkeeper.mledger.util.SafeRun$2.safeRun(SafeRun.java:49) [org.apache.pulsar-managed-ledger-2.5.0.jar:2.5.0]\r\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_232]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_232]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_232]\r\n15:36:37.368 [pulsar-ordered-OrderedExecutor-6-0] WARN  org.apache.pulsar.broker.service.BrokerService - Got exception when reading persistence policy for persistent://mytenant/agent_namespace/action_down-11844a57-10ab-415a-9d1a-4c3017a588b3: null\r\njava.util.concurrent.TimeoutException: null\r\n        at java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1784) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1928) ~[?:1.8.0_232]\r\n        at org.apache.pulsar.zookeeper.ZooKeeperDataCache.get(ZooKeeperDataCache.java:97) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.service.BrokerService.lambda$getManagedLedgerConfig$32(BrokerService.java:922) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.bookkeeper.mledger.util.SafeRun$2.safeRun(SafeRun.java:49) [org.apache.pulsar-managed-ledger-2.5.0.jar:2.5.0]\r\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_232]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_232]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_232]\r\n15:36:37.379 [pulsar-ordered-OrderedExecutor-6-0] WARN  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://mytenant/agent_namespace/action_down-11844a57-10ab-415a-9d1a-4c3017a588b3] Failed to update persistence-policies java.util.concurrent.TimeoutException\r\n15:36:37.379 [pulsar-ordered-OrderedExecutor-5-0] WARN  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://mytenant/agent_namespace/data_up-c8aa8f88-8db6-4fbc-b1cd-c5cf6237a5af] Failed to update persistence-policies java.util.concurrent.TimeoutException\r\n15:36:38.903 [pulsar-web-57-9] INFO  org.eclipse.jetty.server.RequestLog - xx.xxx.xxx.xxx - - [24/Mar/2020:15:36:38 +0000] \"GET /metrics HTTP/1.1\" 302 0 \"-\" \"Prometheus/2.16.0\" 1\r\n15:36:38.906 [pulsar-web-57-14] INFO  org.eclipse.jetty.server.RequestLog - xx.xxx.xxx.xxx - - [24/Mar/2020:15:36:08 +0000] \"GET /metrics/ HTTP/1.1\" 500 331 \"http://xx.xxx.xxxx.xxxx:8082/metrics\" \"Prometheus/2.16.0\" 30002\r\n15:36:53.904 [pulsar-web-57-18] INFO  org.eclipse.jetty.server.RequestLog - xx.xxx.xxx.xxx - - [24/Mar/2020:15:36:53 +0000] \"GET /metrics HTTP/1.1\" 302 0 \"-\" \"Prometheus/2.16.0\" 1\r\n15:36:53.906 [pulsar-web-57-19] INFO  org.eclipse.jetty.server.RequestLog - xx.xxx.xxx.xxx - - [24/Mar/2020:15:36:23 +0000] \"GET /metrics/ HTTP/1.1\" 500 331 \"http://xx.xxx.xxx.xxx:8082/metrics\" \"Prometheus/2.16.0\" 30002\r\n15:37:07.366 [prometheus-stats-69-1] ERROR org.apache.pulsar.broker.service.BacklogQuotaManager - Failed to read policies data, will apply the default backlog quota: namespace=mytenant/agent_namespace\r\njava.util.concurrent.TimeoutException: null\r\n        at java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1784) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1928) ~[?:1.8.0_232]\r\n        at org.apache.pulsar.zookeeper.ZooKeeperDataCache.get(ZooKeeperDataCache.java:97) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.service.BacklogQuotaManager.getBacklogQuota(BacklogQuotaManager.java:64) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.service.persistent.PersistentTopic.getBacklogQuota(PersistentTopic.java:1746) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.getTopicStats(NamespaceStatsAggregator.java:96) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.lambda$null$0(NamespaceStatsAggregator.java:64) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.forEach(ConcurrentOpenHashMap.java:385) ~[org.apache.pulsar-pulsar-common-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.forEach(ConcurrentOpenHashMap.java:159) ~[org.apache.pulsar-pulsar-common-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.lambda$null$1(NamespaceStatsAggregator.java:63) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.forEach(ConcurrentOpenHashMap.java:385) ~[org.apache.pulsar-pulsar-common-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.forEach(ConcurrentOpenHashMap.java:159) ~[org.apache.pulsar-pulsar-common-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.lambda$generate$2(NamespaceStatsAggregator.java:62) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.forEach(ConcurrentOpenHashMap.java:385) ~[org.apache.pulsar-pulsar-common-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.forEach(ConcurrentOpenHashMap.java:159) ~[org.apache.pulsar-pulsar-common-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.generate(NamespaceStatsAggregator.java:59) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.stats.prometheus.PrometheusMetricsGenerator.generate(PrometheusMetricsGenerator.java:73) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.stats.prometheus.PrometheusMetricsServlet.lambda$doGet$0(PrometheusMetricsServlet.java:70) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:32) [org.apache.pulsar-managed-ledger-2.5.0.jar:2.5.0]\r\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_232]\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_232]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_232]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [?:1.8.0_232]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_232]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_232]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_232]\r\n15:37:07.368 [pulsar-ordered-OrderedExecutor-0-0] WARN  org.apache.pulsar.broker.service.BrokerService - Got exception when reading persistence policy for persistent://mytenant/agent_namespace/data_up-8498c9ea-0d9f-446a-9efe-9990d3c26293: null\r\njava.util.concurrent.TimeoutException: null\r\n        at java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1784) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1928) ~[?:1.8.0_232]\r\n        at org.apache.pulsar.zookeeper.ZooKeeperDataCache.get(ZooKeeperDataCache.java:97) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.service.BrokerService.lambda$getManagedLedgerConfig$32(BrokerService.java:922) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.bookkeeper.mledger.util.SafeRun$2.safeRun(SafeRun.java:49) [org.apache.pulsar-managed-ledger-2.5.0.jar:2.5.0]\r\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_232]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_232]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_232]\r\n15:37:07.368 [pulsar-ordered-OrderedExecutor-0-0] WARN  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://mytenant/agent_namespace/data_up-8498c9ea-0d9f-446a-9efe-9990d3c26293] Failed to update persistence-policies java.util.concurrent.TimeoutException\r\n15:37:07.368 [ForkJoinPool.commonPool-worker-9] ERROR org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://mytenant/agent_namespace/data_down-c6a8df26-acce-45bd-8704-974f73b237f3] Policies update failed org.apache.pulsar.broker.service.BrokerServiceException$ServerMetadataException: java.util.concurrent.TimeoutException, scheduled retry in 60 seconds\r\njava.util.concurrent.CompletionException: org.apache.pulsar.broker.service.BrokerServiceException$ServerMetadataException: java.util.concurrent.TimeoutException\r\n        at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:661) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:683) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:2010) ~[?:1.8.0_232]\r\n        at org.apache.pulsar.broker.service.persistent.PersistentTopic.checkReplicationAndRetryOnFailure(PersistentTopic.java:976) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.service.persistent.PersistentTopic.onPoliciesUpdate(PersistentTopic.java:1722) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.service.BrokerService.lambda$null$48(BrokerService.java:1309) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at java.util.Optional.ifPresent(Optional.java:159) ~[?:1.8.0_232]\r\n        at org.apache.pulsar.broker.service.BrokerService.lambda$null$49(BrokerService.java:1309) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:670) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:683) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:2010) ~[?:1.8.0_232]\r\n        at org.apache.pulsar.broker.service.BrokerService.lambda$onUpdate$50(BrokerService.java:1304) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.forEach(ConcurrentOpenHashMap.java:385) ~[org.apache.pulsar-pulsar-common-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.forEach(ConcurrentOpenHashMap.java:159) ~[org.apache.pulsar-pulsar-common-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.service.BrokerService.onUpdate(BrokerService.java:1300) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.service.BrokerService.onUpdate(BrokerService.java:151) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.zookeeper.ZooKeeperDataCache.lambda$4(ZooKeeperDataCache.java:138) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.5.0.jar:2.5.0]\r\n        at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:670) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:646) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975) ~[?:1.8.0_232]\r\n        at org.apache.pulsar.zookeeper.ZooKeeperCache.lambda$18(ZooKeeperCache.java:374) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.5.0.jar:2.5.0]\r\n        at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:670) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:646) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975) ~[?:1.8.0_232]\r\n        at org.apache.pulsar.zookeeper.ZooKeeperCache.lambda$14(ZooKeeperCache.java:355) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.5.0.jar:2.5.0]\r\n        at java.util.concurrent.ForkJoinTask$RunnableExecuteAction.exec(ForkJoinTask.java:1402) [?:1.8.0_232]\r\n        at java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289) [?:1.8.0_232]\r\n        at java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056) [?:1.8.0_232]\r\n        at java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692) [?:1.8.0_232]\r\n        at java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:157) [?:1.8.0_232]\r\nCaused by: org.apache.pulsar.broker.service.BrokerServiceException$ServerMetadataException: java.util.concurrent.TimeoutException\r\n        at org.apache.pulsar.broker.service.persistent.PersistentTopic.checkReplication(PersistentTopic.java:1030) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        ... 29 more\r\nCaused by: java.util.concurrent.TimeoutException\r\n        at java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1784) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1928) ~[?:1.8.0_232]\r\n        at org.apache.pulsar.zookeeper.ZooKeeperDataCache.get(ZooKeeperDataCache.java:97) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.service.persistent.PersistentTopic.checkReplication(PersistentTopic.java:1026) ~[org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        ... 29 more\r\n\r\n - ServerOS: centos7\r\n - client: linux or windows\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6599", "user": "otmanel31", "labels": ["triage/week-13", "type/bug"], "created": "2020-03-24 16:37:52", "closed": "2020-04-29 07:40:34", "commits": {}, "ttf": 35.000277777777775, "commitsDetails": []}, {"title": "View the details of the sources command in the pulsar admin cli document and see 404", "body": "When I want to view the details of the sources command under pulsar admin cli, there is an exception. See the following figure for details\r\n<img width=\"800\" alt=\"WechatIMG80\" src=\"https://user-images.githubusercontent.com/27547000/77437823-10e9fb80-6e20-11ea-865d-608ee1dee8ea.png\">\r\n![WechatIMG81](https://user-images.githubusercontent.com/27547000/77437846-18a9a000-6e20-11ea-8d75-94a118f1e51c.jpeg)\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6598", "user": "apacheBright", "labels": ["component/documentation", "component/website", "help wanted", "triage/week-13", "type/bug"], "created": "2020-03-24 14:36:00", "closed": "2020-06-09 03:21:35", "commits": {}, "ttf": 76.00027777777778, "commitsDetails": []}, {"title": "Many Log Lines of \"Sse42Crc32C is not supported\"", "body": "**Describe the bug**\r\nWhen running the brokers with the default config, there are many log lines like this:\r\n\r\n```\r\n[main-EventThread] ERROR org.apache.bookkeeper.proto.checksum.CRC32CDigestManager - Sse42Crc32C is not supported, will use a slower CRC32C implementation.\r\n```\r\n\r\n**To Reproduce**\r\n1. Deploy pulsar in k8s\r\n2. Look at the logs in bookkeeper\r\n\r\n**Expected behavior**\r\nThe log lines shouldn't be so noisy\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Mac\r\n\r\n**Additional context**\r\nThis seems to be a common thing people experience but in all my googling I couldn't find a good solution. I'm making this issue so future Googlers can find the solution.\r\n", "url": "https://github.com/apache/pulsar/issues/6597", "user": "oliverisaac", "labels": ["type/bug"], "created": "2020-03-24 13:56:40", "closed": "2020-03-24 13:58:15", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "producer builder  failed to load config", "body": "**Describe the bug**\r\nproducer builder  failed to load config into existing configuration data\r\n\r\n**To Reproduce**\r\n```java\r\n        PulsarClient client = PulsarClient.builder().serviceUrl(pulsarServiceUrl).build();\r\n        Map<String, Object> config = new HashMap<>();\r\n        config.put(\"topicName\", topic);\r\n        config.put(\"producerName\", \"test-producer\");\r\n        ProducerBuilderImpl<byte[]> builder = (ProducerBuilderImpl<byte[]>) client.newProducer().loadConf(config);\r\n        Producer<byte[]> producer = builder.create();\r\n        producer.send(\"test\".getBytes());\r\n```\r\n```\r\nException in thread \"main\" java.lang.RuntimeException: Failed to load config into existing configuration data\r\n\tat org.apache.pulsar.client.impl.conf.ConfigurationDataUtils.loadData(ConfigurationDataUtils.java:69)\r\n\tat org.apache.pulsar.client.impl.ProducerBuilderImpl.loadConf(ProducerBuilderImpl.java:112)\r\n```\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: OSX\r\n - pulsar.version: 2.4.0  \r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6594", "user": "pierre94", "labels": ["triage/week-13", "type/bug"], "created": "2020-03-23 11:48:39", "closed": "2020-03-26 12:19:24", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "PulsarConsumerSource messageReceiveTimeoutMs parameter should be configurable", "body": "**Describe the bug**\r\nThe messageReceiveTimeoutMs value in the PulsarConsumerSource class is hardcoded to 100ms and cannot be altered through configuration at present.\r\n\r\n**To Reproduce**\r\nThis is a design bug and not a bug that generated an error.\r\n\r\n**Expected behavior**\r\nThe messageReceiveTimeoutMs value in the PulsarConsumerSource class is hardcoded to 100ms but should be configurable to accommodate different hardware setups such as developer labs where the performance level may not be as critical.\r\n\r\n**Screenshots**\r\nN/A\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: N/A\r\n\r\n**Additional context**\r\nN/A", "url": "https://github.com/apache/pulsar/issues/6578", "user": "lonerzzz", "labels": ["release/2.5.2", "triage/week-13", "type/bug"], "created": "2020-03-20 23:48:26", "closed": "2020-05-19 13:23:16", "commits": {}, "ttf": 59.000277777777775, "commitsDetails": []}, {"title": "Can not increase partitions in topic with only one partition", "body": "**Describe the bug**\r\nA partitioned topic with only one partition can not be increased to have more partitions.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a partitioned topic with one partition:\r\n    ```\r\n    bin/pulsar-admin persistent create-partitioned-topic \\\r\n    persistent://public/default/part_topic \\\r\n    --partitions 1\r\n    ```\r\n2. Try to increase the number of partitions:\r\n    ```\r\n    bin/pulsar-admin topics update-partitioned-topic persistent://public/default/part_topic -p 3\r\n    ```\r\n\r\nIt then fails with:\r\n\r\n```\r\n13:57:59.057 [AsyncHttpClient-5-1] WARN  org.apache.pulsar.client.admin.internal.BaseResource - [http://localhost:8080/admin/v2/persistent/public/default/part_topic/partitions?updateLocalTopicOnly=false] Failed to perform http post request: javax.ws.rs.ClientErrorException: HTTP 409 Conflict\r\nTopic is not partitioned topic\r\n\r\nReason: Topic is not partitioned topic\r\n```\r\n\r\n**Expected behavior**\r\nIt does not fail.", "url": "https://github.com/apache/pulsar/issues/6564", "user": "poulhenriksen", "labels": ["type/bug"], "created": "2020-03-19 14:02:54", "closed": "2020-03-26 05:45:31", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "ZooKeeperChildrenCache reloading creates heavy load on Zookeeper", "body": "When topics are frequently created/deleted, Zookeeper is appears to be heavy loaded, which makes Pulsar cluster unstable: brokers may loose connection to Zookeeper, restart themselves, etc.\r\nIncreasing brokers number from 3 to 12 increased duration of operations that involve topics creation by 3 times: from 0.5s to 1.5s in our case. Send message operations duration has not increased.\r\n<img width=\"1243\" alt=\"\u0421\u043a\u0440\u0438\u043d\u0448\u043e\u0442 2020-03-03 18 40 53\" src=\"https://user-images.githubusercontent.com/4807772/77056435-72a30380-69e3-11ea-9bec-89a8c190dd7c.png\">\r\nAs you can see on the screenshot, before adding brokers there are also >0 outstanding request to the zk leader.\r\nBefore Zookeeper restart, there are lots of messages (tens in second) like this in the log:\r\n```\r\nMar 10 18:29:29 pulsar[39841]: [pulsar-ordered-OrderedExecutor-5-0-EventThread] \r\nINFO  org.apache.pulsar.zookeeper.ZooKeeperChildrenCache - \r\n[State:CONNECTED Timeout:30000 sessionid:0x2000739aa380002 local:/xxx remoteserver:xxx:2181 lastZxid:4295513491 xid:268976 sent:268977 recv:287904 queuedpkts:1 pendingresp:3 queuedevents:0] \r\nReceived ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/managed-ledgers/<tenant_name>/<cluster_name>/<namespace_name>/persistent\r\n\r\nMar 10 18:29:29 pulsar[39841]: [pulsar-ordered-OrderedExecutor-6-0] INFO  org.apache.pulsar.zookeeper.ZooKeeperChildrenCache - reloadCache called in zookeeperChildrenCache for path /managed-ledgers/<tenant_name>/<cluster_name>/<namespace_name>/persistent\r\n```\r\n\r\n**How to reproduce**\r\nPulsar 2.4.1.\r\nApproximately 2000 create/delete topic operations in a minute. 130000 short-living topics exist on average.\r\n\r\n**How to mitigate**\r\nRestart all Zookeeper instances one by one. After that topic create/delete operation duration decreased dramatically, overall performance improved and Pulsar cluster stabilized. Number of messages about reloading zk cache is decreased significantly.\r\nOn screenshots below, last zk instance was restarted at 1:46 PM. As you can see after that there is no excessive requests/ zk cache reloading.\r\n<img width=\"1680\" alt=\"\u0421\u043a\u0440\u0438\u043d\u0448\u043e\u0442 2020-03-19 12 54 38\" src=\"https://user-images.githubusercontent.com/4807772/77056676-d2011380-69e3-11ea-8a60-3eb53539a697.png\">\r\n\r\n<img width=\"1680\" alt=\"\u0421\u043a\u0440\u0438\u043d\u0448\u043e\u0442 2020-03-19 12 58 18\" src=\"https://user-images.githubusercontent.com/4807772/77056946-40de6c80-69e4-11ea-8a33-c7c79d998123.png\">\r\n\r\n**Assumption about cause**\r\nz-nodes like this contain all persistent topic names that belong to the particular namespace.\r\n`/managed-ledgers/<tenant_name>/<cluster_name>/<namespace_name>/persistent`\r\n\r\nInitially they are loaded and cached (with watcher set) during clean start of Pulsar cluster:\r\n`NamespaceService#findBrokerServiceUrl`:\r\nin method `searchForCandidateBroker`:\r\n```\r\n    // Schedule the task to pre-load topics\r\n    pulsar.loadNamespaceTopics(bundle);\r\n```\r\n\r\nThen, each time topic is created/deleted (which happens frequently in our case), watcher is triggered, cache is reloaded (by making request to zk) and watcher is set again.\r\nThis repeats very often, and creates heavy load on Zookeeper.\r\n\r\nHowever it looks like that children of nodes `/managed-ledgers/<tenant_name>/<cluster_name>/<namespace_name>/persistent` aren't used that often, which is proved by restarting zookeeper.\r\nWhen zookeeper is restarted, zk-sessions are closed and watchers are disconnected.\r\nSo cache is not reloaded unless the `/managed-ledgers/<tenant_name>/<cluster_name>/<namespace_name>/persistent` node is requested again by broker, which is not the case according to logs and JFRs.\r\n\r\n**Expected behavior**\r\nPulsar cluster is stable and shows good performance when topics are created/deleted frequently w/o Zookeeper restart.\r\n", "url": "https://github.com/apache/pulsar/issues/6563", "user": "rfetishkevi", "labels": ["triage/week-13", "type/bug", "type/performance"], "created": "2020-03-19 10:59:51", "closed": "2020-05-12 07:14:11", "commits": {"f4fc7994071383748d1c5def92da2a652419c2c0": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "926d6871436ba463d64440933a3b8a4aa85d15bf": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 53.000277777777775, "commitsDetails": [{"commitHash": "f4fc7994071383748d1c5def92da2a652419c2c0", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["90dba138c79b5e8a9d5c576ec75c31e24f778914"], "nameRev": "f4fc7994071383748d1c5def92da2a652419c2c0 tags/v2.6.0-candidate-1~204", "commitMessage": "[ISSUE 6563][Broker] Invalidate managed ledgers zookeeper cache instead of reloading on watcher triggered (#6659)\n\nFixes #6563\r\n\r\n### Motivation\r\nFrequent topics creation/deletion triggers zookeeper children cache reloading for z-nodes **/managed-ledgers/<tenant_name>/<cluster_name>/<namespace_name>/persistent** more than needed.\r\nThis creates additional load on zookeeper and broker, slows down brokers and makes them less stable. Also this causes scalability issues - adding more brokers increases operations duration even more.\r\n\r\n* [ISSUE 6563][Broker] Invalidate managed ledgers zookeeper cache instead of reloading on watcher triggered\r\n\r\n* [ISSUE 6563][Broker] Adding licence header to the new class\r\n\r\n* [ISSUE 6563][Broker] Invalidate correct zk cache path\r\n\r\n* [ISSUE 6563][Broker] Fix mocking issue\r\n\r\nCo-authored-by: Pavel Tishkevich <pavel.tishkevich@onde.app>\r\nCo-authored-by: penghui <penghui@apache.org>", "commitDateTime": "2020-05-12 15:14:10", "authoredDateTime": "2020-05-12 10:14:10", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/cache/LocalZooKeeperCacheService.java", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZooKeeperChildrenCache.java", "insertions": 0, "deletions": 4, "lines": 4}, {"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZooKeeperManagedLedgerCache.java", "insertions": 71, "deletions": 0, "lines": 71}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.managedLedgerListCache()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "LocalZooKeeperCacheService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.cache.LocalZooKeeperCacheService", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.cache.LocalZooKeeperCacheService.managedLedgerListCache()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testCreatePartitionedTopicHavingNonPartitionTopicWithPartitionSuffix()", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testUpdatePartitionedTopicHavingNonPartitionTopicWithPartitionSuffix()", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ZooKeeperChildrenCache.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.ZooKeeperChildrenCache.clearTree()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ZooKeeperManagedLedgerCache.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.ZooKeeperManagedLedgerCache", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "926d6871436ba463d64440933a3b8a4aa85d15bf", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["71e78783b0f7241603d0518b6ac0f368ef624f60"], "nameRev": "926d6871436ba463d64440933a3b8a4aa85d15bf tags/v2.5.2-candidate-1~8", "commitMessage": "[ISSUE 6563][Broker] Invalidate managed ledgers zookeeper cache instead of reloading on watcher triggered (#6659)\n\nFixes #6563\n\n### Motivation\nFrequent topics creation/deletion triggers zookeeper children cache reloading for z-nodes **/managed-ledgers/<tenant_name>/<cluster_name>/<namespace_name>/persistent** more than needed.\nThis creates additional load on zookeeper and broker, slows down brokers and makes them less stable. Also this causes scalability issues - adding more brokers increases operations duration even more.\n\n* [ISSUE 6563][Broker] Invalidate managed ledgers zookeeper cache instead of reloading on watcher triggered\n\n* [ISSUE 6563][Broker] Adding licence header to the new class\n\n* [ISSUE 6563][Broker] Invalidate correct zk cache path\n\n* [ISSUE 6563][Broker] Fix mocking issue\n\nCo-authored-by: Pavel Tishkevich <pavel.tishkevich@onde.app>\nCo-authored-by: penghui <penghui@apache.org>(cherry picked from commit f4fc7994071383748d1c5def92da2a652419c2c0)\n", "commitDateTime": "2020-05-12 21:42:28", "authoredDateTime": "2020-05-12 10:14:10", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/cache/LocalZooKeeperCacheService.java", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZooKeeperChildrenCache.java", "insertions": 0, "deletions": 4, "lines": 4}, {"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZooKeeperManagedLedgerCache.java", "insertions": 71, "deletions": 0, "lines": 71}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.managedLedgerListCache()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "LocalZooKeeperCacheService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.cache.LocalZooKeeperCacheService", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.cache.LocalZooKeeperCacheService.managedLedgerListCache()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testCreatePartitionedTopicHavingNonPartitionTopicWithPartitionSuffix()", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testUpdatePartitionedTopicHavingNonPartitionTopicWithPartitionSuffix()", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ZooKeeperChildrenCache.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.ZooKeeperChildrenCache.clearTree()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ZooKeeperManagedLedgerCache.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.ZooKeeperManagedLedgerCache", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[pulsar-client] NPE while call getLastMessageId", "body": "**Describe the bug**\r\nMeet NPE while call getLastMessageId as below:\r\n```\r\n[root@xxx apache-pulsar-2.6.0-SNAPSHOT]# bin/pulsar-admin topics last-message-id persistent://public/default/test\r\njava.lang.RuntimeException: com.fasterxml.jackson.databind.JsonMappingException: (was java.lang.NullPointerException) (through reference chain: org.apache.pulsar.client.impl.BatchMessageIdImpl[\"acker\"]->org.apache.pulsar.client.impl.BatchMessageAcker[\"outstandingAcks\"])\r\n        at org.apache.pulsar.admin.cli.CliCommand.print(CliCommand.java:182)\r\n        at org.apache.pulsar.admin.cli.CmdTopics$GetLastMessageId.run(CmdTopics.java:773)\r\n        at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:71)\r\n        at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:221)\r\n        at org.apache.pulsar.admin.cli.PulsarAdminTool.main(PulsarAdminTool.java:263)\r\nCaused by: com.fasterxml.jackson.databind.JsonMappingException: (was java.lang.NullPointerException) (through reference chain: org.apache.pulsar.client.impl.BatchMessageIdImpl[\"acker\"]->org.apache.pulsar.client.impl.BatchMessageAcker[\"outstandingAcks\"])\r\n        at com.fasterxml.jackson.databind.JsonMappingException.wrapWithPath(JsonMappingException.java:394)\r\n        at com.fasterxml.jackson.databind.JsonMappingException.wrapWithPath(JsonMappingException.java:353)\r\n        at com.fasterxml.jackson.databind.ser.std.StdSerializer.wrapAndThrow(StdSerializer.java:316)\r\n        at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:730)\r\n        at com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.java:166)\r\n        at com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:727)\r\n        at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:722)\r\n        at com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.java:166)\r\n        at com.fasterxml.jackson.databind.ser.DefaultSerializerProvider._serialize(DefaultSerializerProvider.java:480)\r\n        at com.fasterxml.jackson.databind.ser.DefaultSerializerProvider.serializeValue(DefaultSerializerProvider.java:319)\r\n        at com.fasterxml.jackson.databind.ObjectWriter$Prefetch.serialize(ObjectWriter.java:1433)\r\n        at com.fasterxml.jackson.databind.ObjectWriter._configAndWriteValue(ObjectWriter.java:1135)\r\n        at com.fasterxml.jackson.databind.ObjectWriter.writeValueAsString(ObjectWriter.java:1005)\r\n        at org.apache.pulsar.admin.cli.CliCommand.print(CliCommand.java:180)\r\n        ... 4 more\r\nCaused by: java.lang.NullPointerException\r\n        at org.apache.pulsar.client.impl.BatchMessageAcker.getOutstandingAcks(BatchMessageAcker.java:69)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.lang.reflect.Method.invoke(Method.java:498)\r\n        at com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:688)\r\n        at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.java:722)\r\n        ... 14 more\r\n```\r\nThe reason is that `BatchMessageIdImpl` use a default `BatchMessageAcker` with null value.\r\n\r\n**Expected behavior**\r\n`getLastMessageId` should be successful like below:\r\n```\r\n[root@xxx apache-pulsar-2.6.0-SNAPSHOT]# bin/pulsar-admin topics last-message-id persistent://public/default/test\r\n{\r\n  \"ledgerId\" : 5,\r\n  \"entryId\" : 0,\r\n  \"partitionIndex\" : -1,\r\n  \"batchIndex\" : 9,\r\n  \"acker\" : {\r\n    \"batchSize\" : 0,\r\n    \"prevBatchCumulativelyAcked\" : false,\r\n    \"outstandingAcks\" : 0\r\n  },\r\n  \"outstandingAcksInSameBatch\" : 0,\r\n  \"batchSize\" : 0\r\n}\r\n\r\n```\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6561", "user": "murong00", "labels": ["release/2.5.1", "type/bug"], "created": "2020-03-19 07:00:16", "closed": "2020-03-19 16:59:07", "commits": {"2007de6dedd6997cccd424f3d40988e99b0fa85a": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "4cdd4de1d123e131cc74f29a8bbed2abfc79ed4c": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "584079eff17e9ba518ca496c5e26979b0c9b0bfb": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "2007de6dedd6997cccd424f3d40988e99b0fa85a", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["9634eb79773adc399397aa3a73e23118281a1737"], "nameRev": "2007de6dedd6997cccd424f3d40988e99b0fa85a tags/v2.6.0-candidate-1~389", "commitMessage": "Fix NPE while call getLastMessageId. (#6562)\n\n### Motivation\r\n\r\nFixes #6561\r\n\r\n### Modifications\r\n\r\nInitialize `BatchMessageAckerDisabled` with a `new BitSet()` Object.", "commitDateTime": "2020-03-19 09:59:06", "authoredDateTime": "2020-03-20 00:59:06", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageAcker.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageAckerDisabled.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/BatchMessageIdImplTest.java", "insertions": 30, "deletions": 0, "lines": 30}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BatchMessageAcker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageAcker", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "BatchMessageAckerDisabled.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageAckerDisabled", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "BatchMessageIdImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageIdImplTest.deserializationTest()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "4cdd4de1d123e131cc74f29a8bbed2abfc79ed4c", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["b66f11c1ad057b6d99ae26b84f4801e568fad21f"], "nameRev": "4cdd4de1d123e131cc74f29a8bbed2abfc79ed4c tags/v2.5.1-candidate-1~6", "commitMessage": "Fix NPE while call getLastMessageId. (#6562)\n\n### Motivation\r\n\r\nFixes #6561\r\n\r\n### Modifications\r\n\r\nInitialize `BatchMessageAckerDisabled` with a `new BitSet()` Object.\n\n(cherry picked from commit 2007de6dedd6997cccd424f3d40988e99b0fa85a)\n", "commitDateTime": "2020-04-05 16:15:18", "authoredDateTime": "2020-03-20 00:59:06", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageAcker.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageAckerDisabled.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/BatchMessageIdImplTest.java", "insertions": 30, "deletions": 0, "lines": 30}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BatchMessageAcker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageAcker", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "BatchMessageAckerDisabled.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageAckerDisabled", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "BatchMessageIdImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageIdImplTest.deserializationTest()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "584079eff17e9ba518ca496c5e26979b0c9b0bfb", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["9f33ee1249f262bd096e3e12f3601a1edb1d929e"], "nameRev": "584079eff17e9ba518ca496c5e26979b0c9b0bfb tags/v2.5.1-candidate-3~15", "commitMessage": "Fix NPE while call getLastMessageId. (#6562)\n\n### Motivation\r\n\r\nFixes #6561\r\n\r\n### Modifications\r\n\r\nInitialize `BatchMessageAckerDisabled` with a `new BitSet()` Object.\n\n(cherry picked from commit 2007de6dedd6997cccd424f3d40988e99b0fa85a)\n", "commitDateTime": "2020-04-13 11:33:46", "authoredDateTime": "2020-03-20 00:59:06", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageAcker.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageAckerDisabled.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/BatchMessageIdImplTest.java", "insertions": 30, "deletions": 0, "lines": 30}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BatchMessageAcker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageAcker", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "BatchMessageAckerDisabled.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageAckerDisabled", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "BatchMessageIdImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageIdImplTest.deserializationTest()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Cant ack messages on exclusive subscriptions with partioned topic", "body": "**Describe the bug**\r\nWhen creating a consumer with an exclusive subscription, acked messages are not reflected in broker stats.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a consumer with an exclusive subscription to a partitioned topic\r\n2. Ack each message individually as they are received\r\n3. Notice that \"unackedMessages\" continually climbs in the `topic stats` via the admin client\r\n```java\r\nstatic PulsarClient getJPulsarClient() throws Exception{\r\n        return PulsarClient.builder()\r\n                .serviceUrl(\"pulsar://localhost:6650\")\r\n                .connectionsPerBroker(20)\r\n                .ioThreads(8)\r\n                .listenerThreads(8)\r\n                .build();\r\n\r\n    }\r\n\r\n    static Consumer<byte[]> getJPulsarConsumer(PulsarClient client, String topic, String subscription) throws Exception {\r\n      return  client.newConsumer(Schema.BYTES)\r\n                .subscriptionName(subscription)\r\n                .subscriptionType(SubscriptionType.Exclusive)\r\n                .topic(topic)\r\n                .consumerName(\"ackTestConsumer\")\r\n              .subscribe();\r\n    }\r\n\r\n    public static void main(String... args) throws Exception{\r\n        PulsarClient client = getJPulsarClient();\r\n        String topic = \"public/default/870|EXTERNID_NG|2020-03-17\";\r\n        String subscription = \"ackTestSubscription\"\r\n        Consumer<byte[]> consumer = getJPulsarConsumer(client, topic, subscription);\r\n\r\n        int maxMessages = 1000000;\r\n        List<CompletableFuture<Object>> futures = new ArrayList<>();\r\n        for(int i = 0; i < maxMessages; i ++){\r\n            futures.add(consumer.receiveAsync().thenApplyAsync(m -> {\r\n                try {\r\n                    consumer.acknowledge(m.getMessageId());\r\n                } catch (PulsarClientException e) {\r\n                    e.printStackTrace();\r\n                }\r\n                return null;\r\n            }));\r\n        }\r\n\r\n        CompletableFuture.allOf(futures.toArray(new CompletableFuture[futures.size()])).get();\r\n    }\r\n```\r\n\r\n**Expected behavior**\r\nThe \"unackedMessages\" metric should _at most_ hover at or around the receiveQueueSize if not 0. The backlog should also be descreasing\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n![Screen Shot 2020-03-18 at 5 52 35 PM](https://user-images.githubusercontent.com/1275634/77017925-69f9f100-6941-11ea-84d9-0db2039cafdf.png)\r\n![Screen Shot 2020-03-18 at 5 52 18 PM](https://user-images.githubusercontent.com/1275634/77017931-6ebea500-6941-11ea-9457-0e4880ca8ad6.png)\r\n![image](https://user-images.githubusercontent.com/1275634/77018096-de349480-6941-11ea-973f-8b7491ba7e5c.png)\r\n\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: N/A\r\n\r\n**Additional context**\r\nIf the subscription is changed to Shared, the topicStats produce the expected behavior (showing messages acked)\r\n", "url": "https://github.com/apache/pulsar/issues/6552", "user": "st0ckface", "labels": ["release/2.5.1", "type/bug"], "created": "2020-03-18 23:58:04", "closed": "2020-03-19 05:42:04", "commits": {"2449696acad38239ac460cd51d77431b5acafcfd": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "a458fce58826f0d987b44e3fbb32193246330c0a": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "7bf3d6bec50349c5dc51cc33e555d57246a4edac": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "2449696acad38239ac460cd51d77431b5acafcfd", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["ec31d549e7aacf8b8fe54be650adc3b36e04446c"], "nameRev": "2449696acad38239ac460cd51d77431b5acafcfd tags/v2.6.0-candidate-1~394", "commitMessage": "Don't increment unacked messages for the consumer with Exclusive/Failover subscription mode. (#6558)\n\nFixes #6552\r\n\r\n### Motivation\r\n\r\n#6552 is introduced by #5929, so this PR stop increase unacked messages for the consumer with Exclusive/Failover subscription mode.", "commitDateTime": "2020-03-18 22:42:03", "authoredDateTime": "2020-03-19 13:42:03", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/ConsumerStatsTest.java", "insertions": 37, "deletions": 0, "lines": 37}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Consumer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.Consumer.incrementUnackedMessages(int)", "TOT": 5, "UPD": 1, "INS": 1, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "ConsumerStatsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.stats.ConsumerStatsTest.testAckStatsOnPartitionedTopicForExclusiveSubscription()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "a458fce58826f0d987b44e3fbb32193246330c0a", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["166498b1bc8ae414dd2471a5edc357ffba4668d5"], "nameRev": "a458fce58826f0d987b44e3fbb32193246330c0a tags/v2.5.1-candidate-1~8", "commitMessage": "Don't increment unacked messages for the consumer with Exclusive/Failover subscription mode. (#6558)\n\nFixes #6552\r\n\r\n### Motivation\r\n\r\n#6552 is introduced by #5929, so this PR stop increase unacked messages for the consumer with Exclusive/Failover subscription mode.\n\n(cherry picked from commit 2449696acad38239ac460cd51d77431b5acafcfd)\n", "commitDateTime": "2020-04-05 16:15:06", "authoredDateTime": "2020-03-19 13:42:03", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/ConsumerStatsTest.java", "insertions": 37, "deletions": 0, "lines": 37}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Consumer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.Consumer.incrementUnackedMessages(int)", "TOT": 5, "UPD": 1, "INS": 1, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "ConsumerStatsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.stats.ConsumerStatsTest.testAckStatsOnPartitionedTopicForExclusiveSubscription()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "7bf3d6bec50349c5dc51cc33e555d57246a4edac", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["5db85967db3fc2afca5af05486e18a1a2fc19dc9"], "nameRev": "7bf3d6bec50349c5dc51cc33e555d57246a4edac tags/v2.5.1-candidate-3~17", "commitMessage": "Don't increment unacked messages for the consumer with Exclusive/Failover subscription mode. (#6558)\n\nFixes #6552\r\n\r\n### Motivation\r\n\r\n#6552 is introduced by #5929, so this PR stop increase unacked messages for the consumer with Exclusive/Failover subscription mode.\n\n(cherry picked from commit 2449696acad38239ac460cd51d77431b5acafcfd)\n", "commitDateTime": "2020-04-13 11:33:38", "authoredDateTime": "2020-03-19 13:42:03", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/ConsumerStatsTest.java", "insertions": 37, "deletions": 0, "lines": 37}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Consumer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.Consumer.incrementUnackedMessages(int)", "TOT": 5, "UPD": 1, "INS": 1, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "ConsumerStatsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.stats.ConsumerStatsTest.testAckStatsOnPartitionedTopicForExclusiveSubscription()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[GitHub Action]: CI - Integration - Backwards Compatibility, failed for docker no space", "body": "Several PR has github action failed with error:\r\n```\r\n11:37:36.219 [main:org.testcontainers.utility.RegistryAuthLocator@135] WARN  org.testcontainers.utility.RegistryAuthLocator - Failure when attempting to lookup auth config (dockerImageName: quay.io/testcontainers/ryuk:0.2.3, configFile: /home/runner/.docker/config.json. Falling back to docker-java default behaviour. Exception message: /home/runner/.docker/config.json (No such file or directory)\r\n        \u2139\ufe0e Checking the system...\r\n        \u2714 Docker version should be at least 1.6.0\r\n        \u2718 Docker environment should have more than 2GB free disk space\r\n\r\njava.lang.AssertionError: Docker environment should have more than 2GB free disk space\r\n\tat org.rnorth.visibleassertions.VisibleAssertions.fail(VisibleAssertions.java:437)\r\n\tat org.rnorth.visibleassertions.VisibleAssertions.assertTrue(VisibleAssertions.java:129)\r\n\tat org.testcontainers.DockerClientFactory.checkDiskSpace(DockerClientFactory.java:185)\r\n\tat org.testcontainers.DockerClientFactory.client(DockerClientFactory.java:134)\r\n\tat org.testcontainers.containers.GenericContainer.<init>(GenericContainer.java:138)\r\n\tat org.apache.pulsar.tests.integration.containers.ChaosContainer.<init>(ChaosContainer.java:46)\r\n\tat org.apache.pulsar.tests.integration.containers.PulsarContainer.<init>(PulsarContainer.java:90)\r\n\tat org.apache.pulsar.tests.integration.containers.StandaloneContainer.<init>(StandaloneContainer.java:43)\r\n\tat org.apache.pulsar.tests.integration.topologies.PulsarStandaloneTestBase.startCluster(PulsarStandaloneTestBase.java:62)\r\n\tat org.apache.pulsar.tests.integration.suites.PulsarStandaloneTestSuite.setUpCluster(PulsarStandaloneTestSuite.java:31)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124)\r\n\tat \r\n```\r\n\r\nhttps://github.com/apache/pulsar/actions?query=workflow%3A%22CI+-+Integration+-+Backwards+Compatibility%22", "url": "https://github.com/apache/pulsar/issues/6538", "user": "jiazhai", "labels": ["type/bug"], "created": "2020-03-15 08:02:04", "closed": "2020-03-17 11:22:23", "commits": {"e938a35a100108db0f8bfd4c4317d7fc883237c8": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "e938a35a100108db0f8bfd4c4317d7fc883237c8", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["da369d7a755469ec28a3f4a78025d85c099d45ab"], "nameRev": "e938a35a100108db0f8bfd4c4317d7fc883237c8 tags/v2.6.0-candidate-1~409", "commitMessage": "[Issue 6538][Integration test]Add clean disk in yaml (#6548)\n\nFixed: https://github.com/apache/pulsar/issues/6538\r\n### Motivation\r\n\r\nCurrently, some images take up a large amount of disk space, causing the test to fail, so clean up these images.\r\n\r\n### Modifications\r\n\r\n* Add command for clean docker image in YAML file.\r\n\r\n### Verifying this change\r\n\r\nThis test is passed https://github.com/AmateurEvents/pulsar/pull/20/checks?check_run_id=513034384\r\n\r\n* Add clean disk in yaml\r\n\r\n* Fixed docker images\r\n\r\n* Add if condition", "commitDateTime": "2020-03-17 19:22:21", "authoredDateTime": "2020-03-17 19:22:21", "commitGitStats": [{"filePath": ".github/workflows/ci-integration-backwards-compatibility.yaml", "insertions": 9, "deletions": 12, "lines": 21}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["e938a35a100108db0f8bfd4c4317d7fc883237c8"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 9, "deletions": 12, "lines": 21, "gitFilesChange": 1}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": [".github/workflows/ci-integration-backwards-compatibility.yaml"]}, {"title": "[BUG]Msg duplicate when consumer in Failover mode", "body": "**Describe the bug**\r\nMsg duplicate when consumer in Failover mode\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. create a subscribe name A to topic B\r\n2. send some message C to topic B\r\n3. create consumer with subscribe name A in Failover mode, consumer name AA\r\n4. get message C in consumer AA, an sleep seconds\r\n5. create consumer with subscribe name A in Failover mode, consumer name BB\r\n6.  consumer BB get message C\r\n\r\n**Expected behavior**\r\n\r\n- Do not change active consumer (maybe best)\r\n\r\n- Or do not deliver message which already delivered to other consumer\r\n\r\n**Screenshots**\r\n\r\n![image](https://user-images.githubusercontent.com/5317064/76604476-bc09d380-6549-11ea-9049-032e48ca3680.png)\r\n", "url": "https://github.com/apache/pulsar/issues/6535", "user": "archfish", "labels": ["triage/week-12", "type/bug"], "created": "2020-03-13 08:43:34", "closed": "2020-03-17 03:58:16", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "BCFIPS not supprted with pulsar client libraray", "body": "**Describe the bug**\r\nNeed bcfips support for pulsar clinet.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nJust deploy on a jboss server which has bcfips support.\r\nPulsar client will fail with NoClassDefFoundError:\r\n\r\n**Expected behavior**\r\nthere should be an option to provde a security provider. like bcfips.\r\n\r\n**Additional context**\r\njava.lang.NoClassDefFoundError: Could not initialize class org.apache.pulsar.common.util.SecurityUtility\r\nThis class has a static block which load the bc provider.\r\nHere is the code block. Here we want to load org.bouncycastle.jce.provider.BouncyCastleFIPSProvider.\r\n\r\nstatic {\r\n        // Fixes loading PKCS8Key file: https://stackoverflow.com/a/18912362\r\n        java.security.Security.addProvider(new org.bouncycastle.jce.provider.BouncyCastleProvider());\r\n    }\r\n", "url": "https://github.com/apache/pulsar/issues/6517", "user": "kemburi", "labels": ["component/security", "triage/week-12", "type/bug"], "created": "2020-03-11 07:39:21", "closed": "2020-05-06 06:28:51", "commits": {}, "ttf": 55.000277777777775, "commitsDetails": []}, {"title": "negative `unackedMessages` in consumers stats", "body": "**Describe the bug**\r\n\r\nPulsar docker image `apachepulsar/pulsar:2.5.0`. Standalone mode.\r\n\r\nI noticed that `pulsar_subscription_unacked_messages` value in the prometheus stats is a negative number for `non-persitent` topics.\r\n\r\n**According my tests (not extensive) the bug appears only when topic type is `non-persistent`**.\r\n\r\nRelated: #5929\r\n\r\n___\r\n\r\nThat is what i get:\r\n\r\n```cmd\r\npulsar_subscription_unacked_messages{cluster=\"standalone\",namespace=\"sample/ns1\",topic=\"non-persistent://sample/ns1/demo-1\",subscription=\"my-consumer-11\"} -4739 1583659567277\r\n```\r\n\r\n\r\n```json\r\n{\r\n    \"non-persistent://sample/ns1/demo-1\": {\r\n        \"publishers\": [\r\n            {\r\n                \"msgRateIn\": 8.998,\r\n                \"msgThroughputIn\": 449.904,\r\n                \"averageMsgSize\": 50,\r\n                \"address\": \"/172.17.0.1:34560\",\r\n                \"producerId\": 0,\r\n                \"producerName\": \"my-producer-11\",\r\n                \"connectedSince\": \"2020-03-08T09:17:45.526Z\",\r\n                \"clientVersion\": \"pulsar-client-go\",\r\n                \"metadata\": {}\r\n            }\r\n        ],\r\n        \"replication\": {},\r\n        \"subscriptions\": {\r\n            \"my-consumer-11\": {\r\n                \"consumers\": [\r\n                    {\r\n                        \"address\": \"/172.17.0.1:34560\",\r\n                        \"consumerName\": \"\",\r\n                        \"availablePermits\": 1,\r\n                        \"connectedSince\": \"2020-03-08T09:17:45.526Z\",\r\n                        \"msgRateOut\": 8.998,\r\n                        \"msgThroughputOut\": 449.901,\r\n                        \"msgRateRedeliver\": 0,\r\n                        \"unackedMessages\": -5925,\r\n                        \"blockedConsumerOnUnackedMsgs\": false,\r\n                        \"clientVersion\": \"pulsar-client-go\",\r\n                        \"metadata\": {}\r\n                    }\r\n                ],\r\n                \"msgBacklog\": 0,\r\n                \"msgRateExpired\": 0,\r\n                \"msgRateOut\": 8.998,\r\n                \"msgThroughputOut\": 449.901,\r\n                \"msgRateRedeliver\": 0,\r\n                \"type\": \"Shared\",\r\n                \"msgDropRate\": 0\r\n            }\r\n        },\r\n        \"producerCount\": 1,\r\n        \"averageMsgSize\": 49.999,\r\n        \"msgRateIn\": 8.998,\r\n        \"msgRateOut\": 8.998,\r\n        \"msgThroughputIn\": 449.904,\r\n        \"msgThroughputOut\": 449.901\r\n    }\r\n}\r\n```\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\nSee the code below. It creates publisher/consumer for following topics:\r\n\r\n- `non-persistent://sample/ns1/demo-1` # has hegative `unackedMessages` in consumers stats\r\n- `persistent://sample/ns1/demo-1` # no problem\r\n\r\nAnd that is pretty much it.\r\n\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\t\"fmt\"\r\n\t\"log\"\r\n\t\"os\"\r\n\t\"os/signal\"\r\n\t\"sync\"\r\n\t\"syscall\"\r\n\t\"time\"\r\n\r\n\tcomcast \"github.com/Comcast/pulsar-client-go\"\r\n)\r\n\r\nvar pulsarPool = comcast.NewManagedClientPool()\r\n\r\nfunc newPulsarProducer(name, topic string) *comcast.ManagedProducer {\r\n\treturn comcast.NewManagedProducer(pulsarPool, comcast.ManagedProducerConfig{\r\n\t\tManagedClientConfig: comcast.ManagedClientConfig{\r\n\t\t\tClientConfig: comcast.ClientConfig{\r\n\t\t\t\tAddr: \"pulsar://localhost:6650\",\r\n\t\t\t},\r\n\t\t},\r\n\t\tTopic: topic,\r\n\t\tName:  name,\r\n\t})\r\n}\r\n\r\nfunc newPulsarConsumer(name, topic string) *comcast.ManagedConsumer {\r\n\treturn comcast.NewManagedConsumer(pulsarPool, comcast.ManagedConsumerConfig{\r\n\t\tManagedClientConfig: comcast.ManagedClientConfig{\r\n\t\t\tClientConfig: comcast.ClientConfig{\r\n\t\t\t\tAddr: \"pulsar://localhost:6650\",\r\n\t\t\t},\r\n\t\t},\r\n\t\tTopic: topic,\r\n\t\tName:  name,\r\n\t})\r\n}\r\n\r\nfunc startPulsarProducer(p *comcast.ManagedProducer, wg *sync.WaitGroup, stop chan struct{}) {\r\n\tdefer func() {\r\n\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second*5)\r\n\t\tdefer cancel()\r\n\t\t_ = p.Close(ctx)\r\n\t\twg.Done()\r\n\t}()\r\n\tproduce := func(msg string) error {\r\n\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second*5)\r\n\t\tdefer cancel()\r\n\t\t_, err := p.Send(ctx, []byte(msg))\r\n\t\treturn err\r\n\t}\r\n\r\nloop:\r\n\tfor i := 0; ; i++ {\r\n\t\tselect {\r\n\t\tcase <-stop:\r\n\t\t\tbreak loop\r\n\t\tdefault:\r\n\t\t\tmsg := fmt.Sprintf(\"message-%d\", i)\r\n\t\t\tif err := produce(msg); err != nil {\r\n\t\t\t\tlog.Printf(\"producer error: %v\\n\", err)\r\n\t\t\t\tbreak loop\r\n\t\t\t}\r\n\t\t}\r\n\t\ttime.Sleep(time.Millisecond * 100)\r\n\t}\r\n}\r\n\r\nfunc startPulsarConsumer(c *comcast.ManagedConsumer, wg *sync.WaitGroup) {\r\n\tdefer func() {\r\n\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second*5)\r\n\t\tdefer cancel()\r\n\t\t_ = c.Unsubscribe(ctx)\r\n\t\t_ = c.Close(ctx)\r\n\t\twg.Done()\r\n\t}()\r\n\tconsume := func() error {\r\n\t\tctx, cancel := context.WithTimeout(context.Background(), time.Second*5)\r\n\t\tdefer cancel()\r\n\r\n\t\tmsg, err := c.Receive(ctx)\r\n\t\tif err != nil {\r\n\t\t\treturn err\r\n\t\t}\r\n\t\tlog.Println(\"received:\", msg.Topic, string(msg.Payload), *msg.Msg.ConsumerId)\r\n\r\n\t\treturn c.Ack(ctx, msg)\r\n\t}\r\n\r\n\tfor {\r\n\t\tif err := consume(); err != nil {\r\n\t\t\tlog.Printf(\"consumer error: %v\\n\", err)\r\n\t\t\tbreak\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunc doPulsar() {\r\n\tstopCh := make(chan struct{})\r\n\tgo func() {\r\n\t\tsignalChan := make(chan os.Signal, 1)\r\n\t\tsignal.Notify(signalChan, syscall.SIGINT)\r\n\t\t<-signalChan\r\n\t\tclose(stopCh)\r\n\t\tlog.Println(\"SIGINT received. Terminating...\")\r\n\t}()\r\n\r\n\ttopic1 := \"non-persistent://sample/ns1/demo-1\"\r\n\tp11 := newPulsarProducer(\"my-producer-11\", topic1)\r\n\tc11 := newPulsarConsumer(\"my-consumer-11\", topic1)\r\n\r\n\ttopic2 := \"persistent://sample/ns1/demo-1\"\r\n\tp21 := newPulsarProducer(\"my-producer-21\", topic2)\r\n\tc21 := newPulsarConsumer(\"my-consumer-21\", topic2)\r\n\r\n\tvar wg sync.WaitGroup\r\n\twg.Add(4)\r\n\tgo startPulsarProducer(p11, &wg, stopCh)\r\n\tgo startPulsarConsumer(c11, &wg)\r\n\r\n\tgo startPulsarProducer(p21, &wg, stopCh)\r\n\tgo startPulsarConsumer(c21, &wg)\r\n\r\n\twg.Wait()\r\n}\r\n\r\nfunc main() {\r\n\tdoPulsar()\r\n}\r\n\r\n```\r\n\r\n\r\n**Expected behavior**\r\n\r\nDo not have negative `unackedMessages`/`pulsar_subscription_unacked_messages` values.\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - ProductName:\tMac OS X, ProductVersion:\t10.15.3\r\n", "url": "https://github.com/apache/pulsar/issues/6510", "user": "ilyam8", "labels": ["release/2.5.1", "triage/week-11", "type/bug"], "created": "2020-03-08 09:42:55", "closed": "2020-03-16 10:09:27", "commits": {}, "ttf": 8.000277777777777, "commitsDetails": []}, {"title": "[deployment]wrong k8s yaml config and env do not update", "body": "**Describe the bug**  \r\n\r\n1.env is not working  \r\n2. some ``apiVersion``  need update  \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to ``pulsar/deployment/kubernetes/generic/k8s-1-9-and-above`` or ``pulsar/deployment/kubernetes/generic/origin``\r\n2. run  ``kubectl apply -f .``\r\n3. run ``kubectl pods -w ``\r\n4. See error:  \r\n```\r\nbookie-tz5j7                         0/1     CrashLoopBackOff   5          10m\r\nbroker-7c85c49978-87g6h              0/1     CrashLoopBackOff   5          10m\r\nbroker-7c85c49978-f7548              0/1     CrashLoopBackOff   5          10m\r\nbroker-7c85c49978-l8xqt              0/1     CrashLoopBackOff   5          10m\r\n```  \r\n\r\ncontainer log : \r\n```\r\n2020-03-07 08:51:57,034 [sun.misc.Launcher$AppClassLoader@18b4aac2] error Uncaught exception in thread main: Required zookeeperServers is null,Required clusterName is null\r\n```\r\n  \r\nthe reason is ``apply-config-from-env.py`` is not working :   \r\n```\r\n    # Update values from Env\r\n    for k in sorted(os.environ.keys()):\r\n        v = os.environ[k]\r\n        if k in keys:\r\n            print('[%s] Applying config %s = %s' % (conf_filename, k, v))\r\n            idx = keys[k]\r\n            lines[idx] = '%s=%s\\n' % (k, v)\r\n``` \r\n\r\nshould be replace ``PULSAR_PREFIX_`` to empty : \r\n```\r\n    # Update values from Env\r\n    for k in sorted(os.environ.keys()):\r\n        v = os.environ[k]\r\n************************************************************************\r\n        if k.startswith(PF_ENV_PREFIX):\r\n            k = k[len(PF_ENV_PREFIX):]\r\n************************************************************************\r\n        if k in keys:\r\n            print('[%s] Applying config %s = %s' % (conf_filename, k, v))\r\n            idx = keys[k]\r\n            lines[idx] = '%s=%s\\n' % (k, v)\r\n```\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - k8s version: 1.16.1\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6507", "user": "liangyuanpeng", "labels": ["triage/week-11", "type/bug"], "created": "2020-03-07 09:33:33", "closed": "2020-03-19 05:43:45", "commits": {}, "ttf": 11.000277777777777, "commitsDetails": []}, {"title": "Memory leak during automatic topic compaction", "body": "**Describe the bug**\r\nWhen the automatic log compaction is triggered for a topic within a namespace with active compaction-threshold, there is severe leak of direct memory, eventually causing broker shutdown:\r\n```\r\n\r\n[bookkeeper-io-12-3] ERROR org.apache.pulsar.PulsarBrokerStarter - -- Shutting down - Received OOM exception: failed to allocate 16777216 byte(s) of direct memory (used: 6442450944, max: 6442450944)\r\nio.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 6442450944, max: 6442450944)\r\n        at ...\r\n```\r\nDigging into this, it seems the phase two of compaction leaks most.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\n1. start pulsar-broker with leak detection 'Paranoid'\r\n`-Dpulsar.allocator.leak_detection=Paranoid`\r\n\r\n2. Create namespace and set compaction-threshold\r\n```\r\nbin/pulsar-admin namespaces create -c pulsar-cluster default/compacted\r\nbin/pulsar-admin namespaces set-compaction-threshold -t 4M default/compacted\r\n```\r\n\r\n3. Start producing messages on a topic in the `compacted` namespace, wait for compaction to be triggered. Batching must be used for the produces, and no compression must be used (to leak direct memory)\r\n4. grep for 'LEAK' in the pulsar broker log file\r\n6. May take some time to wait for OOM error, but leaks should be logged at first compaction run\r\n\r\n**Expected behavior**\r\nTopic compaction should not leak memory\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/6697938/75991608-027e8300-5ef7-11ea-9625-9c092c17585e.png)\r\n\r\nShowing typical direct memory usage before OOM\r\n\r\n**Additional context**\r\nLinux 4.15.x\r\n", "url": "https://github.com/apache/pulsar/issues/6482", "user": "racorn", "labels": ["triage/week-10", "type/bug"], "created": "2020-03-05 14:40:50", "closed": "2020-03-06 06:32:29", "commits": {"f2ec1b4e2836859b0a6beb9b5a12656e4bcaf8f9": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "af106d879d1db6ab9c8b7d1821c672086bfa3421": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "d618dcbdf4b6484a258313d5c5207d2e97bfcebb": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "07ba135e4475d55fe71093395e75f90b2386e06a": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "f2ec1b4e2836859b0a6beb9b5a12656e4bcaf8f9", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["8003d08e5ca325867d2e825921f18ddda8d4e1d4"], "nameRev": "f2ec1b4e2836859b0a6beb9b5a12656e4bcaf8f9 tags/v2.6.0-candidate-1~433", "commitMessage": "Fix memory leak when running topic compaction. (#6485)\n\n\r\nFixes #6482\r\n\r\n### Motivation\r\nPrevent topic compaction from leaking direct memory\r\n\r\n### Modifications\r\n\r\nSeveral leaks were discovered using Netty leak detection and code review.\r\n* `CompactedTopicImpl.readOneMessageId` would get an `Enumeration` of `LedgerEntry`, but did not release the underlying buffers. Fix: iterate though the `Enumeration` and release underlying buffer. Instead of logging the case where the `Enumeration` did not contain any elements, complete the future exceptionally with the message (will be logged by Caffeine).\r\n* Two main sources of leak in `TwoPhaseCompactor`. The `RawBacthConverter.rebatchMessage` method failed to close/release a `ByteBuf` (uncompressedPayload). Also, the return ByteBuf of `RawBacthConverter.rebatchMessage` was not closed. The first one was easy to fix (release buffer), to fix the second one and make the code easier to read, I decided to not let `RawBacthConverter.rebatchMessage`  close the message read from the topic, instead the message read from the topic can be closed in a try/finally clause surrounding most of the method body handing a message from a topic (in phase two loop). Then if a new message was produced by `RawBacthConverter.rebatchMessage` we check that after we have added the message to the compact ledger and release the message.\r\n\r\n### Verifying this change\r\nModified `RawReaderTest.testBatchingRebatch` to show new contract.\r\n\r\nOne can run the test described to reproduce the issue, to verify no leak is detected.", "commitDateTime": "2020-03-05 22:32:28", "authoredDateTime": "2020-03-06 07:32:28", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/client/impl/RawBatchConverter.java", "insertions": 2, "deletions": 3, "lines": 5}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/CompactedTopicImpl.java", "insertions": 13, "deletions": 6, "lines": 19}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/TwoPhaseCompactor.java", "insertions": 65, "deletions": 54, "lines": 119}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/RawReaderTest.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RawBatchConverter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.RawBatchConverter.rebatchMessage(org.apache.pulsar.client.api.RawMessage,java.util.function.BiPredicate)", "TOT": 3, "UPD": 2, "INS": 0, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "CompactedTopicImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.CompactedTopicImpl.readOneMessageId(org.apache.bookkeeper.client.LedgerHandle,long)", "TOT": 13, "UPD": 3, "INS": 2, "MOV": 7, "DEL": 1}]}, {"spoonFilePath": "TwoPhaseCompactor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.TwoPhaseCompactor.phaseTwoLoop(org.apache.pulsar.client.api.RawReader,org.apache.pulsar.client.api.MessageId,java.util.Map,org.apache.bookkeeper.client.LedgerHandle,java.util.concurrent.Semaphore,java.util.concurrent.CompletableFuture)", "TOT": 14, "UPD": 0, "INS": 5, "MOV": 8, "DEL": 1}]}, {"spoonFilePath": "RawReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderTest.testBatchingRebatch()", "TOT": 10, "UPD": 0, "INS": 1, "MOV": 8, "DEL": 1}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "af106d879d1db6ab9c8b7d1821c672086bfa3421", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "d618dcbdf4b6484a258313d5c5207d2e97bfcebb", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["c23ab8602737bd7a8323e57ffe50fb466605a458"], "nameRev": "d618dcbdf4b6484a258313d5c5207d2e97bfcebb tags/v2.5.1-candidate-1~18", "commitMessage": "Fix memory leak when running topic compaction. (#6485)\n\n\r\nFixes #6482\r\n\r\n### Motivation\r\nPrevent topic compaction from leaking direct memory\r\n\r\n### Modifications\r\n\r\nSeveral leaks were discovered using Netty leak detection and code review.\r\n* `CompactedTopicImpl.readOneMessageId` would get an `Enumeration` of `LedgerEntry`, but did not release the underlying buffers. Fix: iterate though the `Enumeration` and release underlying buffer. Instead of logging the case where the `Enumeration` did not contain any elements, complete the future exceptionally with the message (will be logged by Caffeine).\r\n* Two main sources of leak in `TwoPhaseCompactor`. The `RawBacthConverter.rebatchMessage` method failed to close/release a `ByteBuf` (uncompressedPayload). Also, the return ByteBuf of `RawBacthConverter.rebatchMessage` was not closed. The first one was easy to fix (release buffer), to fix the second one and make the code easier to read, I decided to not let `RawBacthConverter.rebatchMessage`  close the message read from the topic, instead the message read from the topic can be closed in a try/finally clause surrounding most of the method body handing a message from a topic (in phase two loop). Then if a new message was produced by `RawBacthConverter.rebatchMessage` we check that after we have added the message to the compact ledger and release the message.\r\n\r\n### Verifying this change\r\nModified `RawReaderTest.testBatchingRebatch` to show new contract.\r\n\r\nOne can run the test described to reproduce the issue, to verify no leak is detected.\n\n(cherry picked from commit f2ec1b4e2836859b0a6beb9b5a12656e4bcaf8f9)\n", "commitDateTime": "2020-04-05 10:54:14", "authoredDateTime": "2020-03-06 07:32:28", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/client/impl/RawBatchConverter.java", "insertions": 2, "deletions": 3, "lines": 5}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/CompactedTopicImpl.java", "insertions": 13, "deletions": 6, "lines": 19}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/TwoPhaseCompactor.java", "insertions": 65, "deletions": 54, "lines": 119}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/RawReaderTest.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RawBatchConverter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.RawBatchConverter.rebatchMessage(org.apache.pulsar.client.api.RawMessage,java.util.function.BiPredicate)", "TOT": 3, "UPD": 2, "INS": 0, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "CompactedTopicImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.CompactedTopicImpl.readOneMessageId(org.apache.bookkeeper.client.LedgerHandle,long)", "TOT": 13, "UPD": 3, "INS": 2, "MOV": 7, "DEL": 1}]}, {"spoonFilePath": "TwoPhaseCompactor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.TwoPhaseCompactor.phaseTwoLoop(org.apache.pulsar.client.api.RawReader,org.apache.pulsar.client.api.MessageId,java.util.Map,org.apache.bookkeeper.client.LedgerHandle,java.util.concurrent.Semaphore,java.util.concurrent.CompletableFuture)", "TOT": 14, "UPD": 0, "INS": 5, "MOV": 8, "DEL": 1}]}, {"spoonFilePath": "RawReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderTest.testBatchingRebatch()", "TOT": 10, "UPD": 0, "INS": 1, "MOV": 8, "DEL": 1}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "07ba135e4475d55fe71093395e75f90b2386e06a", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["80e14756eb75bd7c1ecb350b2da9e6f0b9a77680"], "nameRev": "07ba135e4475d55fe71093395e75f90b2386e06a tags/v2.5.1-candidate-3~28", "commitMessage": "Fix memory leak when running topic compaction. (#6485)\n\n\r\nFixes #6482\r\n\r\n### Motivation\r\nPrevent topic compaction from leaking direct memory\r\n\r\n### Modifications\r\n\r\nSeveral leaks were discovered using Netty leak detection and code review.\r\n* `CompactedTopicImpl.readOneMessageId` would get an `Enumeration` of `LedgerEntry`, but did not release the underlying buffers. Fix: iterate though the `Enumeration` and release underlying buffer. Instead of logging the case where the `Enumeration` did not contain any elements, complete the future exceptionally with the message (will be logged by Caffeine).\r\n* Two main sources of leak in `TwoPhaseCompactor`. The `RawBacthConverter.rebatchMessage` method failed to close/release a `ByteBuf` (uncompressedPayload). Also, the return ByteBuf of `RawBacthConverter.rebatchMessage` was not closed. The first one was easy to fix (release buffer), to fix the second one and make the code easier to read, I decided to not let `RawBacthConverter.rebatchMessage`  close the message read from the topic, instead the message read from the topic can be closed in a try/finally clause surrounding most of the method body handing a message from a topic (in phase two loop). Then if a new message was produced by `RawBacthConverter.rebatchMessage` we check that after we have added the message to the compact ledger and release the message.\r\n\r\n### Verifying this change\r\nModified `RawReaderTest.testBatchingRebatch` to show new contract.\r\n\r\nOne can run the test described to reproduce the issue, to verify no leak is detected.\n\n(cherry picked from commit f2ec1b4e2836859b0a6beb9b5a12656e4bcaf8f9)\n", "commitDateTime": "2020-04-13 11:32:44", "authoredDateTime": "2020-03-06 07:32:28", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/client/impl/RawBatchConverter.java", "insertions": 2, "deletions": 3, "lines": 5}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/CompactedTopicImpl.java", "insertions": 13, "deletions": 6, "lines": 19}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/TwoPhaseCompactor.java", "insertions": 65, "deletions": 54, "lines": 119}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/RawReaderTest.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RawBatchConverter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.RawBatchConverter.rebatchMessage(org.apache.pulsar.client.api.RawMessage,java.util.function.BiPredicate)", "TOT": 3, "UPD": 2, "INS": 0, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "CompactedTopicImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.CompactedTopicImpl.readOneMessageId(org.apache.bookkeeper.client.LedgerHandle,long)", "TOT": 13, "UPD": 3, "INS": 2, "MOV": 7, "DEL": 1}]}, {"spoonFilePath": "TwoPhaseCompactor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.TwoPhaseCompactor.phaseTwoLoop(org.apache.pulsar.client.api.RawReader,org.apache.pulsar.client.api.MessageId,java.util.Map,org.apache.bookkeeper.client.LedgerHandle,java.util.concurrent.Semaphore,java.util.concurrent.CompletableFuture)", "TOT": 14, "UPD": 0, "INS": 5, "MOV": 8, "DEL": 1}]}, {"spoonFilePath": "RawReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderTest.testBatchingRebatch()", "TOT": 10, "UPD": 0, "INS": 1, "MOV": 8, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 3, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0.0, "deletions": 0.0, "lines": 0.0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0.0, "UPD": 0.0, "INS": 0.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Unable to create partitioned topic which is a substring of an existing topic", "body": "**Describe the bug**\r\nUnable to create partitioned topic which is a substring of an existing topic\r\n\r\n**To Reproduce**\r\n1. Create a partitioned topic using below command\r\n_**./pulsar-admin topics create-partitioned-topic persistent://public/default/create_substring_topic -p 1**_\r\n2. Create another partitioned topic using below command. The topic name is a substring of above created topic\r\n\r\n _**./pulsar-admin topics create-partitioned-topic persistent://public/default/substring_topic -p 1**_\r\n\r\nBelow error is thrown in the console\r\n\r\n10:14:38.692 [AsyncHttpClient-5-1] WARN  org.apache.pulsar.client.admin.internal.BaseResource - [https://itomdipulsar-proxy:8443/admin/v2/persistent/public/default/substring_topic/partitions] Failed to perform http put request: javax.ws.rs.ClientErrorException: HTTP 412 Precondition Failed\r\nAlready have topic persistent://public/default/create_substring_topic-partition-0 which contains partition suffix '-partition-' and end with numeric value, Creation of partitioned topic substring_topic could cause conflict.\r\n\r\nReason: Already have topic persistent://public/default/create_substring_topic-partition-0 which contains partition suffix '-partition-' and end with numeric value, Creation of partitioned topic substring_topic could cause conflict.\r\n\r\n**Expected behavior**\r\nPartitioned topic should get created even if its a substring of existing topic\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6468", "user": "sakthi-prasad", "labels": ["component/cli", "release/2.5.1", "triage/week-10", "type/bug"], "created": "2020-03-04 11:00:05", "closed": "2020-03-06 08:50:11", "commits": {"19ccfd5c60020a32bceeca128a9846ca006f0dc7": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "b3ce70b64b3182bd29926d041b8dc280f3156dd9": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "1c19557fd836fb64b3cdc65339045414b7992955": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "8f9749dbe86c1d43ff157693c1f778dcc947be88": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "19ccfd5c60020a32bceeca128a9846ca006f0dc7", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["f2ec1b4e2836859b0a6beb9b5a12656e4bcaf8f9"], "nameRev": "19ccfd5c60020a32bceeca128a9846ca006f0dc7 tags/v2.6.0-candidate-1~432", "commitMessage": "Fix create partitioned topic with a substring of an existing topic name. (#6478)\n\nFixes #6468\r\n\r\nFix create a partitioned topic with a substring of an existing topic name. And make create partitioned topic async.", "commitDateTime": "2020-03-06 16:50:10", "authoredDateTime": "2020-03-06 16:50:10", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 109, "deletions": 5, "lines": 114}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 17, "deletions": 80, "lines": 97}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/NonPersistentTopics.java", "insertions": 4, "deletions": 30, "lines": 34}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/PersistentTopics.java", "insertions": 11, "deletions": 5, "lines": 16}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/NonPersistentTopics.java", "insertions": 7, "deletions": 30, "lines": 37}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 23, "deletions": 6, "lines": 29}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java", "insertions": 5, "deletions": 3, "lines": 8}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTest.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 45, "deletions": 12, "lines": 57}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/v1/V1_AdminApiTest.java", "insertions": 1, "deletions": 3, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.tryCreatePartitionsAsync(int)", "TOT": 8, "UPD": 1, "INS": 4, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.tryCreatePartitionAsync(int)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.internalCreatePartitionedTopic(javax.ws.rs.container.AsyncResponse,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.checkTopicExistsAsync(org.apache.pulsar.common.naming.TopicName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.resumeAsyncResponseExceptionally(javax.ws.rs.container.AsyncResponse,java.lang.Throwable)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.tryCreatePartitionAsync(int,java.util.concurrent.CompletableFuture)", "TOT": 7, "UPD": 0, "INS": 7, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreatePartitionedTopic(int)", "TOT": 25, "UPD": 11, "INS": 0, "MOV": 13, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.updatePartitionInOtherCluster(int,java.util.Set)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalDeletePartitionedTopic(javax.ws.rs.container.AsyncResponse,boolean,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalSkipAllMessagesForNonPartitionedTopic(javax.ws.rs.container.AsyncResponse,java.lang.String,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.validatePartitionTopicName(java.lang.String)", "TOT": 4, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalResetCursor(javax.ws.rs.container.AsyncResponse,java.lang.String,long,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreateSubscription(javax.ws.rs.container.AsyncResponse,java.lang.String,org.apache.pulsar.client.impl.MessageIdImpl,boolean,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreateMissedPartitions()", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreateMissedPartitions(javax.ws.rs.container.AsyncResponse)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NonPersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.NonPersistentTopics.createPartitionedTopic(java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 21, "UPD": 4, "INS": 0, "MOV": 7, "DEL": 10}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.NonPersistentTopics.createPartitionedTopic(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createPartitionedTopic(java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 5, "UPD": 0, "INS": 0, "MOV": 4, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createMissedPartitions(java.lang.String,java.lang.String,java.lang.String)", "TOT": 4, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createPartitionedTopic(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createMissedPartitions(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.partitionedTopics(java.lang.String)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.testPersistentTopicCreation()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminTest.persistentTopics()", "TOT": 5, "UPD": 0, "INS": 5, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGetPartitionedTopicsList()", "TOT": 19, "UPD": 4, "INS": 10, "MOV": 4, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testRevokePartitionedTopic()", "TOT": 15, "UPD": 4, "INS": 5, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testCreatePartitionedTopicHavingNonPartitionTopicWithPartitionSuffix()", "TOT": 12, "UPD": 0, "INS": 7, "MOV": 4, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGetSubscriptions()", "TOT": 10, "UPD": 0, "INS": 5, "MOV": 5, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testUpdatePartitionedTopicHavingNonPartitionTopicWithPartitionSuffix()", "TOT": 12, "UPD": 0, "INS": 9, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testUnloadTopic()", "TOT": 8, "UPD": 0, "INS": 5, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGrantPartitionedTopic()", "TOT": 10, "UPD": 0, "INS": 7, "MOV": 3, "DEL": 0}]}, {"spoonFilePath": "V1_AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v1.V1_AdminApiTest.partitionedTopics(java.lang.String)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "b3ce70b64b3182bd29926d041b8dc280f3156dd9", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "1c19557fd836fb64b3cdc65339045414b7992955", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["98a57dff735f77bee5cf03449f004bfed7fc42fd"], "nameRev": "1c19557fd836fb64b3cdc65339045414b7992955 tags/v2.5.1-candidate-1~21", "commitMessage": "Fix create partitioned topic with a substring of an existing topic name. (#6478)\n\nFixes #6468\r\n\r\nFix create a partitioned topic with a substring of an existing topic name. And make create partitioned topic async.\n\n(cherry picked from commit 19ccfd5c60020a32bceeca128a9846ca006f0dc7)\n", "commitDateTime": "2020-04-05 10:53:44", "authoredDateTime": "2020-03-06 16:50:10", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 109, "deletions": 5, "lines": 114}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 17, "deletions": 80, "lines": 97}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/NonPersistentTopics.java", "insertions": 4, "deletions": 30, "lines": 34}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/PersistentTopics.java", "insertions": 11, "deletions": 5, "lines": 16}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/NonPersistentTopics.java", "insertions": 7, "deletions": 30, "lines": 37}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 23, "deletions": 6, "lines": 29}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java", "insertions": 5, "deletions": 3, "lines": 8}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTest.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 45, "deletions": 12, "lines": 57}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/v1/V1_AdminApiTest.java", "insertions": 1, "deletions": 3, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.tryCreatePartitionsAsync(int)", "TOT": 8, "UPD": 1, "INS": 4, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.tryCreatePartitionAsync(int)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.internalCreatePartitionedTopic(javax.ws.rs.container.AsyncResponse,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.checkTopicExistsAsync(org.apache.pulsar.common.naming.TopicName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.resumeAsyncResponseExceptionally(javax.ws.rs.container.AsyncResponse,java.lang.Throwable)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.tryCreatePartitionAsync(int,java.util.concurrent.CompletableFuture)", "TOT": 7, "UPD": 0, "INS": 7, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreatePartitionedTopic(int)", "TOT": 25, "UPD": 11, "INS": 0, "MOV": 13, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.updatePartitionInOtherCluster(int,java.util.Set)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalDeletePartitionedTopic(javax.ws.rs.container.AsyncResponse,boolean,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalSkipAllMessagesForNonPartitionedTopic(javax.ws.rs.container.AsyncResponse,java.lang.String,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.validatePartitionTopicName(java.lang.String)", "TOT": 4, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalResetCursor(javax.ws.rs.container.AsyncResponse,java.lang.String,long,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreateSubscription(javax.ws.rs.container.AsyncResponse,java.lang.String,org.apache.pulsar.client.impl.MessageIdImpl,boolean,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreateMissedPartitions()", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreateMissedPartitions(javax.ws.rs.container.AsyncResponse)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NonPersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.NonPersistentTopics.createPartitionedTopic(java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 21, "UPD": 4, "INS": 0, "MOV": 7, "DEL": 10}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.NonPersistentTopics.createPartitionedTopic(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createPartitionedTopic(java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 5, "UPD": 0, "INS": 0, "MOV": 4, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createMissedPartitions(java.lang.String,java.lang.String,java.lang.String)", "TOT": 4, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createPartitionedTopic(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createMissedPartitions(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.partitionedTopics(java.lang.String)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.testPersistentTopicCreation()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminTest.persistentTopics()", "TOT": 5, "UPD": 0, "INS": 5, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGetPartitionedTopicsList()", "TOT": 19, "UPD": 4, "INS": 10, "MOV": 4, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testRevokePartitionedTopic()", "TOT": 15, "UPD": 4, "INS": 5, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testCreatePartitionedTopicHavingNonPartitionTopicWithPartitionSuffix()", "TOT": 12, "UPD": 0, "INS": 7, "MOV": 4, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGetSubscriptions()", "TOT": 10, "UPD": 0, "INS": 5, "MOV": 5, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testUpdatePartitionedTopicHavingNonPartitionTopicWithPartitionSuffix()", "TOT": 12, "UPD": 0, "INS": 9, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testUnloadTopic()", "TOT": 8, "UPD": 0, "INS": 5, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGrantPartitionedTopic()", "TOT": 10, "UPD": 0, "INS": 7, "MOV": 3, "DEL": 0}]}, {"spoonFilePath": "V1_AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v1.V1_AdminApiTest.partitionedTopics(java.lang.String)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "8f9749dbe86c1d43ff157693c1f778dcc947be88", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["1d23d567b082b8df2a25c95d02e89a91c4cfcbf1"], "nameRev": "8f9749dbe86c1d43ff157693c1f778dcc947be88 tags/v2.5.1-candidate-3~31", "commitMessage": "Fix create partitioned topic with a substring of an existing topic name. (#6478)\n\nFixes #6468\r\n\r\nFix create a partitioned topic with a substring of an existing topic name. And make create partitioned topic async.\n\n(cherry picked from commit 19ccfd5c60020a32bceeca128a9846ca006f0dc7)\n", "commitDateTime": "2020-04-13 11:32:30", "authoredDateTime": "2020-03-06 16:50:10", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 109, "deletions": 5, "lines": 114}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 17, "deletions": 80, "lines": 97}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/NonPersistentTopics.java", "insertions": 4, "deletions": 30, "lines": 34}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/PersistentTopics.java", "insertions": 11, "deletions": 5, "lines": 16}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/NonPersistentTopics.java", "insertions": 7, "deletions": 30, "lines": 37}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 23, "deletions": 6, "lines": 29}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java", "insertions": 5, "deletions": 3, "lines": 8}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTest.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 45, "deletions": 12, "lines": 57}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/v1/V1_AdminApiTest.java", "insertions": 1, "deletions": 3, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.tryCreatePartitionsAsync(int)", "TOT": 8, "UPD": 1, "INS": 4, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.tryCreatePartitionAsync(int)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.internalCreatePartitionedTopic(javax.ws.rs.container.AsyncResponse,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.checkTopicExistsAsync(org.apache.pulsar.common.naming.TopicName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.resumeAsyncResponseExceptionally(javax.ws.rs.container.AsyncResponse,java.lang.Throwable)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.tryCreatePartitionAsync(int,java.util.concurrent.CompletableFuture)", "TOT": 7, "UPD": 0, "INS": 7, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreatePartitionedTopic(int)", "TOT": 25, "UPD": 11, "INS": 0, "MOV": 13, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.updatePartitionInOtherCluster(int,java.util.Set)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalDeletePartitionedTopic(javax.ws.rs.container.AsyncResponse,boolean,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalSkipAllMessagesForNonPartitionedTopic(javax.ws.rs.container.AsyncResponse,java.lang.String,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.validatePartitionTopicName(java.lang.String)", "TOT": 4, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalResetCursor(javax.ws.rs.container.AsyncResponse,java.lang.String,long,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreateSubscription(javax.ws.rs.container.AsyncResponse,java.lang.String,org.apache.pulsar.client.impl.MessageIdImpl,boolean,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreateMissedPartitions()", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreateMissedPartitions(javax.ws.rs.container.AsyncResponse)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NonPersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.NonPersistentTopics.createPartitionedTopic(java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 21, "UPD": 4, "INS": 0, "MOV": 7, "DEL": 10}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.NonPersistentTopics.createPartitionedTopic(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createPartitionedTopic(java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 5, "UPD": 0, "INS": 0, "MOV": 4, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createMissedPartitions(java.lang.String,java.lang.String,java.lang.String)", "TOT": 4, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createPartitionedTopic(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createMissedPartitions(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.partitionedTopics(java.lang.String)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.testPersistentTopicCreation()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminTest.persistentTopics()", "TOT": 5, "UPD": 0, "INS": 5, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGetPartitionedTopicsList()", "TOT": 19, "UPD": 4, "INS": 10, "MOV": 4, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testRevokePartitionedTopic()", "TOT": 15, "UPD": 4, "INS": 5, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testCreatePartitionedTopicHavingNonPartitionTopicWithPartitionSuffix()", "TOT": 12, "UPD": 0, "INS": 7, "MOV": 4, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGetSubscriptions()", "TOT": 10, "UPD": 0, "INS": 5, "MOV": 5, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testUpdatePartitionedTopicHavingNonPartitionTopicWithPartitionSuffix()", "TOT": 12, "UPD": 0, "INS": 9, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testUnloadTopic()", "TOT": 8, "UPD": 0, "INS": 5, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGrantPartitionedTopic()", "TOT": 10, "UPD": 0, "INS": 7, "MOV": 3, "DEL": 0}]}, {"spoonFilePath": "V1_AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v1.V1_AdminApiTest.partitionedTopics(java.lang.String)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 3, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0.0, "deletions": 0.0, "lines": 0.0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0.0, "UPD": 0.0, "INS": 0.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Attempting to use token authentication in pulsar standalone but 401 Unauthorized", "body": "**Describe the bug**\r\nI am trying to run pulsar standalone using token-based authentication. I have add following lines to standalone.conf. but it is still 401 when i called restful api\r\n\r\n\r\n\r\n\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n MacOS\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6467", "user": "bleacha870721", "labels": ["type/bug"], "created": "2020-03-04 10:36:35", "closed": "2020-03-04 11:54:02", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "getLastMessageId from PulsarAdmin doesn't work with BatchMessageIdImpl", "body": "**Describe the bug**\r\nA topic created with a producer in batch mode generates batch messages id : ledgerId:entryId:partitionIndex:batchIndex.\r\nThe getLastMessageId method return a MessageIdImpl which doesn't use the batchIndex parameter. \r\n\r\n\r\n**To Reproduce**\r\n1. Send messages with a producer in batch mode : \r\n`\r\n\r\n        public class ProducerTest {\r\n\tpublic static void main(String[] args) throws Exception {\r\n\r\n\t\ttry (PulsarClient client = PulsarClient.builder()\r\n\t\t\t\t.serviceUrl(\"pulsar://localhost:6650\")\r\n\t\t\t\t.build()) {\r\n\r\n\t\t\tProducer<String> producer = client\r\n\t\t\t\t\t.newProducer(Schema.STRING)\r\n\t\t\t\t\t.topic(\"topic\")\r\n\t\t\t\t\t.enableBatching(true)\r\n\t\t\t\t\t.batchingMaxMessages(10)\r\n\t\t\t\t\t.blockIfQueueFull(false)\r\n\t\t\t\t\t.batchingMaxPublishDelay(100, TimeUnit.SECONDS)\r\n\t\t\t\t\t.create();\r\n\r\n\t\t\tCompletableFuture<MessageId> messageIdCompletableFuture = null;\r\n\t\t\tfor (int i = 0; i < 10; i++) {\r\n\t\t\t\tmessageIdCompletableFuture = producer.newMessage()\r\n\t\t\t\t\t\t.value(String.valueOf(i))\r\n\t\t\t\t\t\t.sendAsync();\r\n\t\t\t}\r\n\r\n\t\t\tmessageIdCompletableFuture.get();\r\n\t\t}\r\n\t}\r\n        }`\r\n\r\n2. Shows generated messages : \r\n\r\n|value|__topic                          |__messageId              |__messageIdToString|\r\n|0    |persistent://public/default/topic|[08 F0 B6 02 10 00 20 00]|39792:0: -1:0       |\r\n|1    |persistent://public/default/topic|[08 F0 B6 02 10 00 20 01]|39792:0: -1:1       |\r\n|2    |persistent://public/default/topic|[08 F0 B6 02 10 00 20 02]|39792:0: -1:2       |\r\n|3    |persistent://public/default/topic|[08 F0 B6 02 10 00 20 03]|39792:0: -1:3       |\r\n|4    |persistent://public/default/topic|[08 F0 B6 02 10 00 20 04]|39792:0: -1:4       |\r\n|5    |persistent://public/default/topic|[08 F0 B6 02 10 00 20 05]|39792:0: -1:5       |\r\n|6    |persistent://public/default/topic|[08 F0 B6 02 10 00 20 06]|39792:0: -1:6       |\r\n|7    |persistent://public/default/topic|[08 F0 B6 02 10 00 20 07]|39792:0: -1:7       |\r\n|8    |persistent://public/default/topic|[08 F0 B6 02 10 00 20 08]|39792:0: -1:8       |\r\n|9    |persistent://public/default/topic|[08 F0 B6 02 10 00 20 09]|39792:0: -1:9       |\r\n\r\n3. Retrieve the last message id from pulsar admin and display it : \r\n39792:0: -1\r\n\r\n\r\n**Expected behavior**\r\nIt shoud return 39792:0: -1:9\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 18.04\r\n - Pulsar runs in docker standalone instance", "url": "https://github.com/apache/pulsar/issues/6462", "user": "kevin-kosmos", "labels": ["triage/week-10", "type/bug"], "created": "2020-03-03 15:17:06", "closed": "2020-03-18 01:48:23", "commits": {"757824f88c06feb97968af6f5cdd7ccbea5ac666": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "921e5f82713c2935ea28039b73fba32cc31c245f": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "8152d9d9d4986303eb50a334a2f322b76e978373": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 14.000277777777777, "commitsDetails": [{"commitHash": "757824f88c06feb97968af6f5cdd7ccbea5ac666", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f59d611523f2ad8073e03768447ba26b6fcbf45e"], "nameRev": "757824f88c06feb97968af6f5cdd7ccbea5ac666 tags/v2.6.0-candidate-1~407", "commitMessage": "Fix admin getLastMessageId return batchIndex (#6511)\n\nFix #6462 \r\n### Motivation\r\nadmin api add getLastMessageId return batchIndex", "commitDateTime": "2020-03-17 18:48:22", "authoredDateTime": "2020-03-18 09:48:22", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 21, "deletions": 11, "lines": 32}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 8, "deletions": 3, "lines": 11}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Topic.java", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java", "insertions": 6, "deletions": 1, "lines": 7}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java", "insertions": 33, "deletions": 1, "lines": 34}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/ReplicatedSubscriptionsController.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiGetLastMessageIdTest.java", "insertions": 97, "deletions": 11, "lines": 108}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 33, "deletions": 0, "lines": 33}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/TopicsImpl.java", "insertions": 7, "deletions": 2, "lines": 9}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageAcker.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageIdImpl.java", "insertions": 6, "deletions": 0, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalGetLastMessageId(boolean)", "TOT": 22, "UPD": 7, "INS": 0, "MOV": 9, "DEL": 6}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalGetLastMessageId(javax.ws.rs.container.AsyncResponse,boolean)", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.getLastMessageId(java.lang.String,java.lang.String,java.lang.String,boolean)", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 3, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.getLastMessageId(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String,boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleGetLastMessageId(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetLastMessageId)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Topic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.getLastMessageId()", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NonPersistentTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentTopic.getLastMessageId()", "TOT": 4, "UPD": 1, "INS": 1, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "PersistentTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.getLastMessageId()", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.triggerOffload(org.apache.pulsar.client.impl.MessageIdImpl).6", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ReplicatedSubscriptionsController.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.ReplicatedSubscriptionsController.receivedSnapshotRequest(org.apache.pulsar.common.api.proto.PulsarMarkers.ReplicatedSubscriptionsSnapshotRequest)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminApiGetLastMessageIdTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiGetLastMessageIdTest.testGetLastMessageId()", "TOT": 38, "UPD": 1, "INS": 14, "MOV": 14, "DEL": 9}]}, {"spoonFilePath": "PersistentTopicsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGetLastMessageId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicsImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getLastMessageIdAsync(java.lang.String).16", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getLastMessageIdAsync(java.lang.String).16.completed(org.apache.pulsar.client.impl.MessageIdImpl)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getLastMessageIdAsync(java.lang.String).16.completed(org.apache.pulsar.client.impl.BatchMessageIdImpl)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchMessageAcker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageAcker", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchMessageIdImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageIdImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "921e5f82713c2935ea28039b73fba32cc31c245f", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["c735e132c18403ea23408cb3004d416d3b7b5e25"], "nameRev": "921e5f82713c2935ea28039b73fba32cc31c245f tags/v2.5.1-candidate-1~11", "commitMessage": "Fix admin getLastMessageId return batchIndex (#6511)\n\nFix #6462 \r\n### Motivation\r\nadmin api add getLastMessageId return batchIndex\n\n(cherry picked from commit 757824f88c06feb97968af6f5cdd7ccbea5ac666)\n", "commitDateTime": "2020-04-05 10:54:59", "authoredDateTime": "2020-03-18 09:48:22", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 21, "deletions": 11, "lines": 32}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 8, "deletions": 3, "lines": 11}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Topic.java", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java", "insertions": 6, "deletions": 1, "lines": 7}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java", "insertions": 33, "deletions": 1, "lines": 34}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/ReplicatedSubscriptionsController.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiGetLastMessageIdTest.java", "insertions": 97, "deletions": 11, "lines": 108}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 33, "deletions": 0, "lines": 33}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/TopicsImpl.java", "insertions": 7, "deletions": 2, "lines": 9}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageAcker.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageIdImpl.java", "insertions": 6, "deletions": 0, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalGetLastMessageId(boolean)", "TOT": 22, "UPD": 7, "INS": 0, "MOV": 9, "DEL": 6}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalGetLastMessageId(javax.ws.rs.container.AsyncResponse,boolean)", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.getLastMessageId(java.lang.String,java.lang.String,java.lang.String,boolean)", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 3, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.getLastMessageId(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String,boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleGetLastMessageId(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetLastMessageId)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Topic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.getLastMessageId()", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NonPersistentTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentTopic.getLastMessageId()", "TOT": 4, "UPD": 1, "INS": 1, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "PersistentTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.getLastMessageId()", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.triggerOffload(org.apache.pulsar.client.impl.MessageIdImpl).6", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ReplicatedSubscriptionsController.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.ReplicatedSubscriptionsController.receivedSnapshotRequest(org.apache.pulsar.common.api.proto.PulsarMarkers.ReplicatedSubscriptionsSnapshotRequest)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminApiGetLastMessageIdTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiGetLastMessageIdTest.testGetLastMessageId()", "TOT": 38, "UPD": 1, "INS": 14, "MOV": 14, "DEL": 9}]}, {"spoonFilePath": "PersistentTopicsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGetLastMessageId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicsImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getLastMessageIdAsync(java.lang.String).16", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getLastMessageIdAsync(java.lang.String).16.completed(org.apache.pulsar.client.impl.MessageIdImpl)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getLastMessageIdAsync(java.lang.String).16.completed(org.apache.pulsar.client.impl.BatchMessageIdImpl)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchMessageAcker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageAcker", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchMessageIdImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageIdImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "8152d9d9d4986303eb50a334a2f322b76e978373", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["04c605f261eecf24397eb97aaf1e3ccd6f48235e"], "nameRev": "8152d9d9d4986303eb50a334a2f322b76e978373 tags/v2.5.1-candidate-3~20", "commitMessage": "Fix admin getLastMessageId return batchIndex (#6511)\n\nFix #6462 \r\n### Motivation\r\nadmin api add getLastMessageId return batchIndex\n\n(cherry picked from commit 757824f88c06feb97968af6f5cdd7ccbea5ac666)\n", "commitDateTime": "2020-04-13 11:33:22", "authoredDateTime": "2020-03-18 09:48:22", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 21, "deletions": 11, "lines": 32}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 8, "deletions": 3, "lines": 11}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Topic.java", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java", "insertions": 6, "deletions": 1, "lines": 7}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java", "insertions": 33, "deletions": 1, "lines": 34}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/ReplicatedSubscriptionsController.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiGetLastMessageIdTest.java", "insertions": 97, "deletions": 11, "lines": 108}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 33, "deletions": 0, "lines": 33}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/TopicsImpl.java", "insertions": 7, "deletions": 2, "lines": 9}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageAcker.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageIdImpl.java", "insertions": 6, "deletions": 0, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalGetLastMessageId(boolean)", "TOT": 22, "UPD": 7, "INS": 0, "MOV": 9, "DEL": 6}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalGetLastMessageId(javax.ws.rs.container.AsyncResponse,boolean)", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.getLastMessageId(java.lang.String,java.lang.String,java.lang.String,boolean)", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 3, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.getLastMessageId(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String,boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleGetLastMessageId(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetLastMessageId)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Topic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.getLastMessageId()", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NonPersistentTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentTopic.getLastMessageId()", "TOT": 4, "UPD": 1, "INS": 1, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "PersistentTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.getLastMessageId()", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.triggerOffload(org.apache.pulsar.client.impl.MessageIdImpl).6", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ReplicatedSubscriptionsController.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.ReplicatedSubscriptionsController.receivedSnapshotRequest(org.apache.pulsar.common.api.proto.PulsarMarkers.ReplicatedSubscriptionsSnapshotRequest)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminApiGetLastMessageIdTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiGetLastMessageIdTest.testGetLastMessageId()", "TOT": 38, "UPD": 1, "INS": 14, "MOV": 14, "DEL": 9}]}, {"spoonFilePath": "PersistentTopicsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGetLastMessageId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicsImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getLastMessageIdAsync(java.lang.String).16", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getLastMessageIdAsync(java.lang.String).16.completed(org.apache.pulsar.client.impl.MessageIdImpl)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getLastMessageIdAsync(java.lang.String).16.completed(org.apache.pulsar.client.impl.BatchMessageIdImpl)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchMessageAcker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageAcker", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchMessageIdImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageIdImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Pulsar Java client: Use System.nanoTime() instead of System.currentTimeMillis() to measure elapsed time", "body": "**Describe the bug**\r\n\r\nMore an improvement than a bug, but\r\n\r\n`ConsumerBase` and `ProducerImpl` use `System.currentTimeMillis()` to measure the elapsed time in the 'operations' inner classes (`ConsumerBase$OpBatchReceive` and `ProducerImpl$OpSendMsg`).\r\n\r\nAn instance variable `createdAt` is initialized with `System.currentTimeMills()`, but it is not used for reading wall clock time, the variable is only used for computing elapsed time (e.g. timeout for a batch).\r\n\r\nWhen the variable is used to compute elapsed time, it would more sense to use `System.nanoTime()`.\r\n", "url": "https://github.com/apache/pulsar/issues/6453", "user": "racorn", "labels": ["type/bug"], "created": "2020-03-02 12:52:04", "closed": "2020-03-03 07:21:59", "commits": {"459ec6e8386f6d67e966321dcd0558d15c96205b": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "f6ce0ea6578834628b6c7163b4033995753143c4": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "49de49fc16273b643ffd0b9bd8dc38ed72359090": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "f6db479d62346b4c4b35d3e2bf9b27329fa4e1cb": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "459ec6e8386f6d67e966321dcd0558d15c96205b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["baf155f4a41de959145841e4cd922e89363e9292"], "nameRev": "459ec6e8386f6d67e966321dcd0558d15c96205b tags/v2.6.0-candidate-1~443", "commitMessage": "Use System.nanoTime() instead of System.currentTimeMillis() (#6454)\n\nFixes #6453 \r\n\r\n### Motivation\r\n`ConsumerBase` and `ProducerImpl` use `System.currentTimeMillis()` to measure the elapsed time in the 'operations' inner classes (`ConsumerBase$OpBatchReceive` and `ProducerImpl$OpSendMsg`).\r\n\r\nAn instance variable `createdAt` is initialized with `System.currentTimeMills()`, but it is not used for reading wall clock time, the variable is only used for computing elapsed time (e.g. timeout for a batch).\r\n\r\nWhen the variable is used to compute elapsed time, it would more sense to use `System.nanoTime()`.\r\n\r\n### Modifications\r\n\r\nThe instance variable `createdAt` in `ConsumerBase$OpBatchReceive` and  `ProducerImpl$OpSendMsg` is initialized with `System.nanoTime()`. Usage of the variable is updated to reflect that the variable holds nano time; computations of elapsed time takes the difference between the current system nano time and the `createdAt` variable.\r\n\r\nThe `createdAt` field is package protected, and is currently only used in the declaring class and outer class, limiting the chances for unwanted side effects.\r\n", "commitDateTime": "2020-03-02 23:21:58", "authoredDateTime": "2020-03-03 08:21:58", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 5, "deletions": 4, "lines": 9}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 8, "deletions": 7, "lines": 15}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.OpBatchReceive", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.run(io.netty.util.Timeout)", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 3, "DEL": 1}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.OpSendMsg.create(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.common.protocol.ByteBufPair,long,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.OpSendMsg.create(java.util.List,org.apache.pulsar.common.protocol.ByteBufPair,long,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.OpSendMsg.create(java.util.List,org.apache.pulsar.common.protocol.ByteBufPair,long,long,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.run(io.netty.util.Timeout)", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 3, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.getDelayInMillis()", "TOT": 5, "UPD": 1, "INS": 1, "MOV": 2, "DEL": 1}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "f6ce0ea6578834628b6c7163b4033995753143c4", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "49de49fc16273b643ffd0b9bd8dc38ed72359090", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["eb3a4814b9c71bbebff77203d37b2ed50c293e58"], "nameRev": "49de49fc16273b643ffd0b9bd8dc38ed72359090 tags/v2.5.1-candidate-1~26", "commitMessage": "Use System.nanoTime() instead of System.currentTimeMillis() (#6454)\n\nFixes #6453 \r\n\r\n### Motivation\r\n`ConsumerBase` and `ProducerImpl` use `System.currentTimeMillis()` to measure the elapsed time in the 'operations' inner classes (`ConsumerBase$OpBatchReceive` and `ProducerImpl$OpSendMsg`).\r\n\r\nAn instance variable `createdAt` is initialized with `System.currentTimeMills()`, but it is not used for reading wall clock time, the variable is only used for computing elapsed time (e.g. timeout for a batch).\r\n\r\nWhen the variable is used to compute elapsed time, it would more sense to use `System.nanoTime()`.\r\n\r\n### Modifications\r\n\r\nThe instance variable `createdAt` in `ConsumerBase$OpBatchReceive` and  `ProducerImpl$OpSendMsg` is initialized with `System.nanoTime()`. Usage of the variable is updated to reflect that the variable holds nano time; computations of elapsed time takes the difference between the current system nano time and the `createdAt` variable.\r\n\r\nThe `createdAt` field is package protected, and is currently only used in the declaring class and outer class, limiting the chances for unwanted side effects.\r\n\n(cherry picked from commit 459ec6e8386f6d67e966321dcd0558d15c96205b)\n", "commitDateTime": "2020-04-05 10:53:18", "authoredDateTime": "2020-03-03 08:21:58", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 5, "deletions": 4, "lines": 9}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 8, "deletions": 7, "lines": 15}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.OpBatchReceive", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.pendingBatchReceiveTask(io.netty.util.Timeout)", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 3, "DEL": 1}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.OpSendMsg.create(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.common.protocol.ByteBufPair,long,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.OpSendMsg.create(java.util.List,org.apache.pulsar.common.protocol.ByteBufPair,long,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.OpSendMsg.create(java.util.List,org.apache.pulsar.common.protocol.ByteBufPair,long,long,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.run(io.netty.util.Timeout)", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 3, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.getDelayInMillis()", "TOT": 5, "UPD": 1, "INS": 1, "MOV": 2, "DEL": 1}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "f6db479d62346b4c4b35d3e2bf9b27329fa4e1cb", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["e8b93d55f5d493d82adb2b11da7727469b146200"], "nameRev": "f6db479d62346b4c4b35d3e2bf9b27329fa4e1cb tags/v2.5.1-candidate-3~36", "commitMessage": "Use System.nanoTime() instead of System.currentTimeMillis() (#6454)\n\nFixes #6453 \r\n\r\n### Motivation\r\n`ConsumerBase` and `ProducerImpl` use `System.currentTimeMillis()` to measure the elapsed time in the 'operations' inner classes (`ConsumerBase$OpBatchReceive` and `ProducerImpl$OpSendMsg`).\r\n\r\nAn instance variable `createdAt` is initialized with `System.currentTimeMills()`, but it is not used for reading wall clock time, the variable is only used for computing elapsed time (e.g. timeout for a batch).\r\n\r\nWhen the variable is used to compute elapsed time, it would more sense to use `System.nanoTime()`.\r\n\r\n### Modifications\r\n\r\nThe instance variable `createdAt` in `ConsumerBase$OpBatchReceive` and  `ProducerImpl$OpSendMsg` is initialized with `System.nanoTime()`. Usage of the variable is updated to reflect that the variable holds nano time; computations of elapsed time takes the difference between the current system nano time and the `createdAt` variable.\r\n\r\nThe `createdAt` field is package protected, and is currently only used in the declaring class and outer class, limiting the chances for unwanted side effects.\r\n\n(cherry picked from commit 459ec6e8386f6d67e966321dcd0558d15c96205b)\n", "commitDateTime": "2020-04-13 11:32:06", "authoredDateTime": "2020-03-03 08:21:58", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 5, "deletions": 4, "lines": 9}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 8, "deletions": 7, "lines": 15}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.OpBatchReceive", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.pendingBatchReceiveTask(io.netty.util.Timeout)", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 3, "DEL": 1}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.OpSendMsg.create(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.common.protocol.ByteBufPair,long,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.OpSendMsg.create(java.util.List,org.apache.pulsar.common.protocol.ByteBufPair,long,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.OpSendMsg.create(java.util.List,org.apache.pulsar.common.protocol.ByteBufPair,long,long,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.run(io.netty.util.Timeout)", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 3, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.getDelayInMillis()", "TOT": 5, "UPD": 1, "INS": 1, "MOV": 2, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 3, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0.0, "deletions": 0.0, "lines": 0.0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0.0, "UPD": 0.0, "INS": 0.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "AvroSchema::decode(byte[] bytes, byte[] schemaVersion) crashes", "body": "**Describe the bug**\r\n\r\nAdd the following in SimpleSchemaTest.java at the end. Run the below test. It will crash in last line\r\n\r\n    @Test\r\n    public void testSchemaVersionUpdate() throws PulsarClientException, PulsarAdminException, ExecutionException, InterruptedException, NoSuchFieldException {\r\n        final String topic = \"persistent://my-property/my-ns/testAvroSchemaUpgrade\";\r\n\r\n        Producer producer1 = pulsarClient.newProducer(Schema.AVRO(V1Data.class))\r\n                .topic(topic)\r\n                .create();\r\n\r\n        Consumer consumer = pulsarClient.newConsumer(Schema.AUTO_CONSUME())\r\n                .topic(topic)\r\n                .subscriptionName(\"schemaUpdate1\")\r\n                .subscribe();\r\n\r\n        producer1.send(new V1Data(1));\r\n\r\n        Message msg = consumer.receive();\r\n\r\n        MultiVersionSchemaInfoProvider schemaProvider = new MultiVersionSchemaInfoProvider(TopicName.get(topic), (PulsarClientImpl) pulsarClient);\r\n        String avroSchemaInJson = new String(schemaProvider.getSchemaByVersion(msg.getSchemaVersion()).get().getSchema());\r\n        AvroSchema schema = (AvroSchema) Schema.AVRO(SchemaDefinition.builder().withJsonDef(avroSchemaInJson).build());\r\n\r\n        schema.decode(msg.getData(), msg.getSchemaVersion());\r\n    }\r\n\r\n**stacktrace**\r\n\r\n```\r\ncom.google.common.util.concurrent.UncheckedExecutionException: java.lang.NullPointerException\r\n\r\n\tat com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2050)\r\n\tat com.google.common.cache.LocalCache.get(LocalCache.java:3951)\r\n\tat com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:3973)\r\n\tat com.google.common.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:4957)\r\n\tat org.apache.pulsar.client.impl.schema.StructSchema.decode(StructSchema.java:98)\r\n\tat org.apache.pulsar.client.api.SimpleSchemaTest.testSchemaVersionUpdate(SimpleSchemaTest.java:668)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124)\r\n\tat org.testng.internal.Invoker.invokeMethod(Invoker.java:583)\r\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:719)\r\n\tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:989)\r\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125)\r\n\tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109)\r\n\tat org.testng.TestRunner.privateRun(TestRunner.java:648)\r\n\tat org.testng.TestRunner.run(TestRunner.java:505)\r\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:455)\r\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:450)\r\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:415)\r\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:364)\r\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\r\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:84)\r\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1208)\r\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1137)\r\n\tat org.testng.TestNG.runSuites(TestNG.java:1049)\r\n\tat org.testng.TestNG.run(TestNG.java:1017)\r\n\tat org.testng.IDEARemoteTestNG.run(IDEARemoteTestNG.java:73)\r\n\tat org.testng.RemoteTestNGStarter.main(RemoteTestNGStarter.java:123)\r\nCaused by: java.lang.NullPointerException\r\n\tat org.apache.pulsar.client.impl.schema.StructSchema.getSchemaInfoByVersion(StructSchema.java:172)\r\n\tat org.apache.pulsar.client.impl.schema.AvroSchema.loadReader(AvroSchema.java:104)\r\n\tat org.apache.pulsar.client.impl.schema.StructSchema$1.load(StructSchema.java:72)\r\n\tat org.apache.pulsar.client.impl.schema.StructSchema$1.load(StructSchema.java:69)\r\n\tat com.google.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3527)\r\n\tat com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2276)\r\n\tat com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2154)\r\n\tat com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2044)\r\n\t... 29 more\r\n```\r\nPerhaps related to this commit id : 900d81ae701b3199a86b3a026eb120747da23987\r\n", "url": "https://github.com/apache/pulsar/issues/6420", "user": "shiv4289", "labels": ["component/schemaregistry", "triage/week-9", "type/bug"], "created": "2020-02-25 16:03:29", "closed": "2020-03-02 09:30:30", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "auto_consume for avro crashes in decode (updated producer .class, old consumer schema .class)", "body": "**Describe the bug**\r\nWe use schema compatibility = NONE. This means we can put data as per multiple schemas on the same topic. When we read those values back we build the consumer using AUTO_CONSUME.\r\nOn receiving the message,\r\n1.  We extract the schema from message,\r\n2. Construct avro schema from the message in (1)\r\n3. schema.decode(msg)\r\n\r\n**This used to work well for us with 2.3 server and 2.3 client. With server and client upgrade to 2.5 this does not work in some cases.** \r\n\r\nFrom my debugging on this, there seems to be an issue as a result of which avro does not use the the reader schema correctly  in the schema object provided here ->. schema.decode(msg)  .\r\n\r\n**Expected behavior**\r\nWith schema.decode() the decode method should use the exact schema that was used to build avroSchema instance.\r\n", "url": "https://github.com/apache/pulsar/issues/6419", "user": "shiv4289", "labels": ["component/schemaregistry", "triage/week-9", "type/bug"], "created": "2020-02-25 15:31:44", "closed": "2020-03-02 09:10:19", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "The client reused in PulsarConsumerSource is closed after first failure.", "body": "**Describe the bug**\r\nWhen flink restart PulsarConsumerSource, PulsarConsumerSource reuse client from cache, but the client is closed. then the AlreadyClosedException will be throwed again and again.\r\n\r\n**To Reproduce**\r\nstart a PulsarConsumerSource in flink\r\nmake a exception or timeout \r\nPulsarConsumerSource will restart again and again and throw AlreadyClosedException\r\n\r\n**Expected behavior**\r\ndon't  reuse cached client\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: macos , pulsar 2.5.0 flink 1.10.0\r\n", "url": "https://github.com/apache/pulsar/issues/6417", "user": "xiemeilong", "labels": ["type/bug"], "created": "2020-02-25 10:38:18", "closed": "2020-03-01 09:28:58", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "In some instances, producers fail to create after a topic is scheduled onto previously used broker", "body": "**Describe the bug**\r\nWhen a topic is unloaded from a broker, a producer can attempt to reconnect before the topic is scheduled to a new broker but after the topic is unloaded. In some instances (discussed more below) this re-connection results in a producer that fails to create _or_ error out and leaves a danging `producerFuture` that is never resolved or removed (unless the client terminates it's connection). If the topic ends up back on the same broker (either immediately or after another unload occurs from another broker) any producers that try and connect will immediately fail as the existing producerFuture is found and responds to the client with an error.\r\n\r\nIn #5571, an epoch was added to help address some related issues, however, in this case, as seen in https://github.com/apache/pulsar/blob/f2afad353795f70c00910b6dcce5df8c62b94a67/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java#L864-L898, the `producerFuture` is retrieved based solely on the `producerId` which the client provides. Because of this, the epoch isn't useful to solve the problem.\r\n\r\nAs to the details of why the producer fails initially, what we see is the following:\r\n1. A topic is unloaded\r\n2. The producer tries to re-connect\r\n3. We call into `org.apache.pulsar.broker.service.BrokerService#checkTopicNsOwnership` (https://github.com/apache/pulsar/blob/f2afad353795f70c00910b6dcce5df8c62b94a67/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java#L1197) and an exception is thrown (we see this warning in our logs)\r\n4. In some instances, this exception doesn't appear to bubble up to the following code https://github.com/apache/pulsar/blob/f2afad353795f70c00910b6dcce5df8c62b94a67/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java#L655-L665 (we often don't see the \"Service unit is not ready\" log when it breaks, however, in some cases we don't see this logs and still have a proper exception sent to the client)\r\n5. This apparent break in exception handling (or control flow in general) appears to cause the `getOrCreateTopic` at https://github.com/apache/pulsar/blob/f2afad353795f70c00910b6dcce5df8c62b94a67/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java#L902 to never return and the `producerFuture` to never be resolved. We see this on the client side by a timeout to create a producer in cases where it fails, in other instances the timeout doesn't occur and we instead get a proper error message to the client, indicating that the namespace bundle isn't owned. As best as I can tell, this doesn't have anything to do with the `pendingTopicLoadingQueue` as we don't see enough topics being loaded that would put us into needing to use that queue.\r\n6. Now, with the dangling `producerFuture` in place, once the topic is re-scheduled back to this broker, it will be unable to ever create a producer. \r\n\r\nI honestly have no idea why or how the call to `getOrCreateTopic` appears to never return, but we have about 10 instances we have validated with our logs (attached an instance below) that all show this same pattern and also have heap dumps (can share if desired) that also support this.\r\n\r\nWe have seen some other issues like https://github.com/apache/pulsar/issues/6054 (they haven't re-occurred often enough to gather enough data) but as best as we can tell it may be a related issue, where some call to load the topic never completes.\r\n\r\nWhile there is likely some easy workarounds for this specific issue (such as putting a timeout on the `producerFuture` or by using the `epoch` in conjunction with the `producerId` for the `producers` map), this is really a spooky one, and I wonder if related issues could have a similar root cause! \r\n\r\n**To Reproduce**\r\nSince this appears to be down to a timing issue, it is hard to reliably reproduce, however, the following should work with enough tries:\r\n1. Have a producer, producing to a topic with a low reconnect timeout\r\n2. Unload the topic/bundle\r\n3. Observe that the producer gets a timeout on creating a producer\r\n4. Unload the topic/bundle again until it makes it back to the initial broker\r\n5. Observe that you can't get a new producer\r\n\r\n**Expected behavior**\r\nWe expect to be able to create a producer after an unload.\r\n\r\n**Logs**\r\nThese aren't full logs, just the relevant lines for when a `producerFuture` is left behind\r\n#### Bad Instance\r\nBroker Logs \r\n```\r\n{\"msg\":\"17:11:16.978 [bookkeeper-ml-workers-OrderedExecutor-2-0] INFO  org.apache.pulsar.broker.service.BrokerService - Created topic persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails - dedup is disabled\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:16.978 [bookkeeper-ml-workers-OrderedExecutor-2-0] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] There are no replicated subscriptions on the topic\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:16.978 [bookkeeper-ml-workers-OrderedExecutor-2-0] INFO  org.apache.pulsar.broker.service.persistent.SubscribeRateLimiter - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] configured subscribe-dispatch rate at broker SubscribeRate{subscribeThrottlingRatePerConsumer=300, ratePeriodInSecond=30}\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:16.978 [bookkeeper-ml-workers-OrderedExecutor-2-0] INFO  org.apache.pulsar.broker.service.persistent.DispatchRateLimiter - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] configured TOPIC message-dispatch rate at broker DispatchRate{dispatchThrottlingRateInMsg=500000, dispatchThrottlingRateInByte=52428800, ratePeriodInSecond=1}\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:16.978 [bookkeeper-ml-workers-OrderedExecutor-2-0] INFO  org.apache.pulsar.broker.service.AbstractTopic - Disabling publish throttling for persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:16.978 [bookkeeper-ml-workers-OrderedExecutor-2-0] WARN  org.apache.pulsar.broker.service.AbstractTopic - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] Error getting policies null and publish throttling will be disabled\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:16.380 [Thread-5203370] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.9.29.28:37282] Subscribing on topic persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails / canvas-cdc/clean-prod-iad/cdc-transform-71\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:16.143 [Thread-492744] WARN  org.apache.pulsar.broker.service.BrokerService - Namespace bundle for topic (persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails) not served by this instance. Please redo the lookup. Request is denied: namespace=canvas-cdc/prod-iad\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.143 [Thread-492744] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.9.27.47:40828] persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails configured with schema false\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.073 [bookkeeper-ml-workers-OrderedExecutor-2-0] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] Topic closed\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.065 [Thread-492726] WARN  org.apache.pulsar.broker.service.ServerCnx - [/10.9.29.28:52860][persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails][canvas-cdc/clean-prod-iad/cdc-transform-71] Failed to create consumer: Topic is temporarily unavailable\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.065 [Thread-492726] WARN  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] Attempting to subscribe to a fenced topic\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.064 [Thread-492726] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.9.29.28:52860] Subscribing on topic persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails / canvas-cdc/clean-prod-iad/cdc-transform-71\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.024 [Thread-492716] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.9.27.47:40828][persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] Creating producer. producerId=73\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:15.629 [pulsar-web-33-11] INFO  org.apache.pulsar.broker.service.persistent.PersistentSubscription - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails][canvas-cdc/clean-prod-iad/cdc-transform-71] Successfully disconnected and closed subscription\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:15.629 [pulsar-web-33-11] INFO  org.apache.pulsar.broker.service.persistent.PersistentSubscription - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails][canvas-cdc/clean-prod-iad/cdc-transform-71] Successfully closed subscription [ManagedCursorImpl{ledger=canvas-cdc/prod-iad/persistent/cluster71-canvas.cluster67_shard_1072.thumbnails, name=canvas-cdc%2Fclean-prod-iad%2Fcdc-transform-71, ackPos=522049:0, readPos=522049:1}]\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:15.628 [pulsar-web-33-11] INFO  org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails / canvas-cdc/clean-prod-iad/cdc-transform-71] All consumers removed. Subscription is disconnected\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:15.627 [pulsar-web-33-11] INFO  org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers - Removed consumer Consumer{subscription=PersistentSubscription{topic=persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails, name=canvas-cdc/clean-prod-iad/cdc-transform-71}, consumerId=229, consumerName=5525b, address=/10.9.29.28:52860} with pending 0 acks\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:15.627 [pulsar-web-33-11] INFO  org.apache.pulsar.broker.service.Consumer - Disconnecting consumer: Consumer{subscription=PersistentSubscription{topic=persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails, name=canvas-cdc/clean-prod-iad/cdc-transform-71}, consumerId=229, consumerName=5525b, address=/10.9.29.28:52860}\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:15.627 [pulsar-web-33-11] INFO  org.apache.pulsar.broker.service.Producer - Disconnecting producer: Producer{topic=PersistentTopic{topic=persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails}, client=/10.9.27.47:40828, producerName=pulsar-prod-iad-199-193, producerId=73}\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:15.627 [pulsar-web-33-11] INFO  org.apache.pulsar.broker.service.BrokerService - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] Unloading topic\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n```\r\n\r\nClient Logs\r\n```\r\n{\"msg\":\"17:12:02.508 [pulsar-timer-4-1] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] [pulsar-prod-iad-199-193] Reconnecting after connection was closed\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:12:02.406 [pulsar-client-io-1-1] WARN  org.apache.pulsar.client.impl.ConnectionHandler - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] [pulsar-prod-iad-199-193] Could not get connection to broker: 14588 lookup request timedout after ms 30000 -- Will try again in 0.1 s\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:12:02.406 [pulsar-client-io-1-1] ERROR org.apache.pulsar.client.impl.ProducerImpl - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] [pulsar-prod-iad-199-193] Failed to create producer: 14588 lookup request timedout after ms 30000\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:11:15.970 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ProducerImpl - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] [pulsar-prod-iad-199-193] Creating producer on cnx [id: 0x37f41d66, L:/10.9.27.47:40828 - R:/10.9.36.202:6651]\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:11:15.968 [pulsar-timer-4-1] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] [pulsar-prod-iad-199-193] Reconnecting after timeout\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:11:15.866 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.thumbnails] [pulsar-prod-iad-199-193] Closed connection [id: 0x37f41d66, L:/10.9.27.47:40828 - R:/10.9.36.202:6651] -- Will try again in 0.1 s\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n```\r\n\r\n#### Good Instance\r\nBroker Logs\r\n```\r\n{\"msg\":\"17:11:17.631 [bookkeeper-ml-workers-OrderedExecutor-7-0] INFO  org.apache.pulsar.broker.service.BrokerService - Created topic persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories - dedup is disabled\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:17.631 [bookkeeper-ml-workers-OrderedExecutor-7-0] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] There are no replicated subscriptions on the topic\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:17.630 [bookkeeper-ml-workers-OrderedExecutor-7-0] INFO  org.apache.pulsar.broker.service.persistent.SubscribeRateLimiter - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] configured subscribe-dispatch rate at broker SubscribeRate{subscribeThrottlingRatePerConsumer=300, ratePeriodInSecond=30}\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:17.630 [bookkeeper-ml-workers-OrderedExecutor-7-0] INFO  org.apache.pulsar.broker.service.persistent.DispatchRateLimiter - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] configured TOPIC message-dispatch rate at broker DispatchRate{dispatchThrottlingRateInMsg=500000, dispatchThrottlingRateInByte=52428800, ratePeriodInSecond=1}\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:17.630 [bookkeeper-ml-workers-OrderedExecutor-7-0] INFO  org.apache.pulsar.broker.service.AbstractTopic - Disabling publish throttling for persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:17.630 [bookkeeper-ml-workers-OrderedExecutor-7-0] WARN  org.apache.pulsar.broker.service.AbstractTopic - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] Error getting policies null and publish throttling will be disabled\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:17.369 [Thread-5203753] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.9.27.47:60270][persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] Creating producer. producerId=97\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:17.218 [ForkJoinPool.commonPool-worker-1] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.9.29.28:37282] Subscribing on topic persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories / canvas-cdc/clean-prod-iad/cdc-transform-71\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-2r8zr\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"6cc06889852e17619b2520562cdb2eba70b37d5e318210f0df33ee868378fe8d\"}}\r\n{\"msg\":\"17:11:16.989 [Thread-493004] WARN  org.apache.pulsar.broker.service.BrokerService - Namespace is being unloaded, cannot add topic persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.988 [Thread-493004] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.9.27.47:40828][persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] Creating producer. producerId=97\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.967 [bookkeeper-ml-workers-OrderedExecutor-7-0] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] Topic closed\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.880 [pulsar-web-33-2] INFO  org.apache.pulsar.broker.service.persistent.PersistentSubscription - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories][canvas-cdc/clean-prod-iad/cdc-transform-71] Successfully disconnected and closed subscription\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.880 [pulsar-web-33-2] INFO  org.apache.pulsar.broker.service.persistent.PersistentSubscription - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories][canvas-cdc/clean-prod-iad/cdc-transform-71] Successfully closed subscription [ManagedCursorImpl{ledger=canvas-cdc/prod-iad/persistent/cluster71-canvas.cluster67_shard_1072.group_categories, name=canvas-cdc%2Fclean-prod-iad%2Fcdc-transform-71, ackPos=521792:0, readPos=521792:1}]\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.880 [pulsar-web-33-2] INFO  org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories / canvas-cdc/clean-prod-iad/cdc-transform-71] All consumers removed. Subscription is disconnected\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.880 [pulsar-web-33-2] INFO  org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers - Removed consumer Consumer{subscription=PersistentSubscription{topic=persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories, name=canvas-cdc/clean-prod-iad/cdc-transform-71}, consumerId=81, consumerName=5525b, address=/10.9.29.28:52860} with pending 0 acks\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.879 [pulsar-web-33-2] INFO  org.apache.pulsar.broker.service.Consumer - Disconnecting consumer: Consumer{subscription=PersistentSubscription{topic=persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories, name=canvas-cdc/clean-prod-iad/cdc-transform-71}, consumerId=81, consumerName=5525b, address=/10.9.29.28:52860}\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.879 [pulsar-web-33-2] INFO  org.apache.pulsar.broker.service.Producer - Disconnecting producer: Producer{topic=PersistentTopic{topic=persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories}, client=/10.9.27.47:40828, producerName=pulsar-prod-iad-196-161, producerId=97}\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n{\"msg\":\"17:11:16.879 [pulsar-web-33-2] INFO  org.apache.pulsar.broker.service.BrokerService - [persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] Unloading topic\\n\",\"kube\":{\"namespace\":\"pulsar\",\"pod_name\":\"pulsar-prod-broker-564968ff9c-zljhk\",\"container_name\":\"broker\"},\"docker\":{\"container_id\":\"c2bc11c1db743603d128641575963a36d3c5ee2f6abca2994df97a7e8720359e\"}}\r\n```\r\n\r\nClient Logs\r\n```\r\n{\"msg\":\"17:11:17.727 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ProducerImpl - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] [pulsar-prod-iad-196-161] Created producer on cnx [id: 0xd2d7a3f2, L:/10.9.27.47:60270 - R:/10.9.47.166:6651]\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:11:17.365 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ProducerImpl - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] [pulsar-prod-iad-196-161] Creating producer on cnx [id: 0xd2d7a3f2, L:/10.9.27.47:60270 - R:/10.9.47.166:6651]\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:11:17.362 [pulsar-timer-4-1] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] [pulsar-prod-iad-196-161] Reconnecting after connection was closed\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:11:17.262 [pulsar-client-io-1-1] WARN  org.apache.pulsar.client.impl.ConnectionHandler - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] [pulsar-prod-iad-196-161] Could not get connection to broker: Namespace is being unloaded, cannot add topic persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories -- Will try again in 0.1 s\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:11:17.261 [pulsar-client-io-1-1] ERROR org.apache.pulsar.client.impl.ProducerImpl - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] [pulsar-prod-iad-196-161] Failed to create producer: Namespace is being unloaded, cannot add topic persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:11:17.261 [pulsar-client-io-1-1] WARN  org.apache.pulsar.client.impl.ClientCnx - [id: 0x37f41d66, L:/10.9.27.47:40828 - R:/10.9.36.202:6651] Received error from server: Namespace is being unloaded, cannot add topic persistent://canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:11:16.982 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ProducerImpl - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] [pulsar-prod-iad-196-161] Creating producer on cnx [id: 0x37f41d66, L:/10.9.27.47:40828 - R:/10.9.36.202:6651]\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:11:16.980 [pulsar-timer-4-1] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] [pulsar-prod-iad-196-161] Reconnecting after timeout\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n{\"msg\":\"17:11:16.880 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [canvas-cdc/prod-iad/cluster71-canvas.cluster67_shard_1072.group_categories] [pulsar-prod-iad-196-161] Closed connection [id: 0x37f41d66, L:/10.9.27.47:40828 - R:/10.9.36.202:6651] -- Will try again in 0.1 s\\n\",\"kube\":{\"namespace\":\"pulsar-cdc\",\"pod_name\":\"pf-canvas-cdc-prod-iad-cluster71-0\",\"container_name\":\"pulsarfunction\"},\"docker\":{\"container_id\":\"c4e6640923ec8e00f50ca85375c7b37c0de7b59491dd7cdb68800b84f8ac5740\"}}\r\n```\r\nThe most important thing to note here is just the difference in when we get a client exception (in the good case) and when we don't (in the bad case). We see this pattern pretty much universally, but, AFAICT from the code, there isn't any reason to believe that that the future shouldn't immediately resolve in both cases.\r\n\r\n**Additional context**\r\nWe saw this in 2.4.x but are also seeing it in 2.5.0 using the official docker images. We also are connecting directly to the brokers (this occurs in a pulsar IO source). We see this occur when we have lots of load shedding when we are back-filling data into Pulsar and don't have as well distributed load. \r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6416", "user": "addisonj", "labels": ["triage/week-9", "type/bug"], "created": "2020-02-25 07:58:19", "closed": "2020-05-06 07:15:20", "commits": {"4a4cce9c2047e1ae1102756d1f53532fcf2dced5": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "10e3499af1afdad0a843e364a45b261577a80c0d": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "9b10c94c86f5167099d9c1afd4ba4342282609ee": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "30e26f84fbd35c2f88665195c426a73336a6fc1f": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "1856f2f8a41f092d5758f88f230c4a3b32e59f85": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 70.00027777777778, "commitsDetails": [{"commitHash": "4a4cce9c2047e1ae1102756d1f53532fcf2dced5", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["757824f88c06feb97968af6f5cdd7ccbea5ac666"], "nameRev": "4a4cce9c2047e1ae1102756d1f53532fcf2dced5 tags/v2.6.0-candidate-1~406", "commitMessage": "[broker] Timeout API calls in BrokerService (#6489)\n\nSee #6416. This change ensures that all futures within BrokerService\r\nhave a guranteed timeout. As stated in #6416, we see cases where it\r\nappears that loading or creating a topic fails to resolve the future for\r\nunknown reasons. It appears that these futures *may* not be returning.\r\nThis seems like a sane change to make to ensure that these futures\r\nfinish, however, it still isn't understood under what conditions these\r\nfutures may not be returning, so this fix is mostly a workaround for\r\nsome underlying issues\r\n\r\nCo-authored-by: Addison Higham <ahigham@instructure.com>", "commitDateTime": "2020-03-17 18:49:12", "authoredDateTime": "2020-03-17 19:49:12", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 20, "deletions": 6, "lines": 26}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getCurrentMessagePublishBufferSize()", "TOT": 15, "UPD": 6, "INS": 1, "MOV": 8, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkGC(int)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkCompaction()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.refreshBrokerPublishRate()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.monitorBacklogQuota()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.unloadServiceUnit(org.apache.pulsar.common.naming.NamespaceBundle,boolean)", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getTopicStats()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.updateConfigurationAndRegisterListeners()", "TOT": 25, "UPD": 15, "INS": 0, "MOV": 10, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkMessagePublishBuffer()", "TOT": 6, "UPD": 2, "INS": 3, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.blockDispatchersWithLargeUnAckMessages()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.updateDynamicServiceConfiguration()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.createPendingLoadTopic()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkUnAckMessageDispatching()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.createNonPersistentTopic(java.lang.String)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.loadOrCreatePersistentTopic(java.lang.String,boolean)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.createDefaultPartitionedTopicAsync(org.apache.pulsar.common.naming.TopicName)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.futureWithDeadline()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getManagedLedgerConfig(org.apache.pulsar.common.naming.TopicName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "10e3499af1afdad0a843e364a45b261577a80c0d", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["79b8259224baa42c4f59467d24ad29b8789140af"], "nameRev": "10e3499af1afdad0a843e364a45b261577a80c0d tags/v2.5.1-candidate-1~15", "commitMessage": "[broker] Timeout API calls in BrokerService (#6489)\n\nSee #6416. This change ensures that all futures within BrokerService\r\nhave a guranteed timeout. As stated in #6416, we see cases where it\r\nappears that loading or creating a topic fails to resolve the future for\r\nunknown reasons. It appears that these futures *may* not be returning.\r\nThis seems like a sane change to make to ensure that these futures\r\nfinish, however, it still isn't understood under what conditions these\r\nfutures may not be returning, so this fix is mostly a workaround for\r\nsome underlying issues\r\n\r\nCo-authored-by: Addison Higham <ahigham@instructure.com>\n(cherry picked from commit 4a4cce9c2047e1ae1102756d1f53532fcf2dced5)\n", "commitDateTime": "2020-04-05 10:54:34", "authoredDateTime": "2020-03-17 19:49:12", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 20, "deletions": 6, "lines": 26}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getCurrentMessagePublishBufferSize()", "TOT": 15, "UPD": 6, "INS": 1, "MOV": 8, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkGC(int)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkCompaction()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.refreshBrokerPublishRate()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.monitorBacklogQuota()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.unloadServiceUnit(org.apache.pulsar.common.naming.NamespaceBundle,boolean)", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getTopicStats()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.updateConfigurationAndRegisterListeners()", "TOT": 25, "UPD": 15, "INS": 0, "MOV": 10, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkMessagePublishBuffer()", "TOT": 6, "UPD": 2, "INS": 3, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.blockDispatchersWithLargeUnAckMessages()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.updateDynamicServiceConfiguration()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.createPendingLoadTopic()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkUnAckMessageDispatching()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.createNonPersistentTopic(java.lang.String)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.loadOrCreatePersistentTopic(java.lang.String,boolean)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.createDefaultPartitionedTopicAsync(org.apache.pulsar.common.naming.TopicName)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.futureWithDeadline()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getManagedLedgerConfig(org.apache.pulsar.common.naming.TopicName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "9b10c94c86f5167099d9c1afd4ba4342282609ee", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["7eeb10d7b358f0e84faa9237b79b51d55fa19eb0"], "nameRev": "9b10c94c86f5167099d9c1afd4ba4342282609ee tags/v2.5.1-candidate-3~25", "commitMessage": "[broker] Timeout API calls in BrokerService (#6489)\n\nSee #6416. This change ensures that all futures within BrokerService\r\nhave a guranteed timeout. As stated in #6416, we see cases where it\r\nappears that loading or creating a topic fails to resolve the future for\r\nunknown reasons. It appears that these futures *may* not be returning.\r\nThis seems like a sane change to make to ensure that these futures\r\nfinish, however, it still isn't understood under what conditions these\r\nfutures may not be returning, so this fix is mostly a workaround for\r\nsome underlying issues\r\n\r\nCo-authored-by: Addison Higham <ahigham@instructure.com>\n(cherry picked from commit 4a4cce9c2047e1ae1102756d1f53532fcf2dced5)\n", "commitDateTime": "2020-04-13 11:32:56", "authoredDateTime": "2020-03-17 19:49:12", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 20, "deletions": 6, "lines": 26}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getCurrentMessagePublishBufferSize()", "TOT": 15, "UPD": 6, "INS": 1, "MOV": 8, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkGC(int)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkCompaction()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.refreshBrokerPublishRate()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.monitorBacklogQuota()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.unloadServiceUnit(org.apache.pulsar.common.naming.NamespaceBundle,boolean)", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getTopicStats()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.updateConfigurationAndRegisterListeners()", "TOT": 25, "UPD": 15, "INS": 0, "MOV": 10, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkMessagePublishBuffer()", "TOT": 6, "UPD": 2, "INS": 3, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.blockDispatchersWithLargeUnAckMessages()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.updateDynamicServiceConfiguration()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.createPendingLoadTopic()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkUnAckMessageDispatching()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.createNonPersistentTopic(java.lang.String)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.loadOrCreatePersistentTopic(java.lang.String,boolean)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.createDefaultPartitionedTopicAsync(org.apache.pulsar.common.naming.TopicName)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.futureWithDeadline()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getManagedLedgerConfig(org.apache.pulsar.common.naming.TopicName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "30e26f84fbd35c2f88665195c426a73336a6fc1f", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["1a8adfe8c628c3890231cfb3fd74c5bb412b3bf2"], "nameRev": "30e26f84fbd35c2f88665195c426a73336a6fc1f tags/v2.6.0-candidate-1~234", "commitMessage": "[Broker] Handle all exceptions from `topic.addProducer` (#6881)\n\nFixes #6872\r\nFixes #6416\r\n\r\nIf a producer tries to create a producer to a topic that is currently\r\nunloading, we can get a `RuntimeException` from\r\n`BrokerService.checkTopicNsOwnership` which is bubbled up through\r\n`topic.addProducer`. By only handling a `BrokerServiceException` this\r\nresults in a future that never completes and results in producers not\r\nbeing able to be created if this topic is scheduled back to this broker.", "commitDateTime": "2020-05-06 15:15:19", "authoredDateTime": "2020-05-06 01:15:19", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": []}], "spoonStatsSkippedReason": ""}, {"commitHash": "1856f2f8a41f092d5758f88f230c4a3b32e59f85", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["53f74c7fd9eb0bf4a81f09d2dc1ab0a7895e1b97"], "nameRev": "1856f2f8a41f092d5758f88f230c4a3b32e59f85 tags/v2.5.2-candidate-1~30", "commitMessage": "[Broker] Handle all exceptions from `topic.addProducer` (#6881)\n\nFixes #6872\nFixes #6416\n\nIf a producer tries to create a producer to a topic that is currently\nunloading, we can get a `RuntimeException` from\n`BrokerService.checkTopicNsOwnership` which is bubbled up through\n`topic.addProducer`. By only handling a `BrokerServiceException` this\nresults in a future that never completes and results in producers not\nbeing able to be created if this topic is scheduled back to this broker.\n(cherry picked from commit 30e26f84fbd35c2f88665195c426a73336a6fc1f)\n", "commitDateTime": "2020-05-08 17:54:40", "authoredDateTime": "2020-05-06 01:15:19", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": []}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 3, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 2, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0.0, "UPD": 0.0, "INS": 0.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "High CPU load when PulsarClient (Java) is idle", "body": "**Describe the bug**\r\nRunning a simple consumer on Windows using the `PulsarClient`, I notice that there is considerable CPU usage when the consumer is just idling. Profiling showed that the 'pulsar-timer-x-y' thread is heavy on the CPU. Digging into the source code, we can see that the `HashedWheelTimer `is set up with 1 ms tick time:\r\n\r\n`timer = new HashedWheelTimer(getThreadFactory(\"pulsar-timer\"), 1, TimeUnit.MILLISECONDS);`\r\n\r\nA simple test with similar values show that a running HashedWheelTimer can consume CPU equal to 100% of one hyperthread:\r\n\r\n```\r\n    @Test\r\n    public void testTimerWheel() throws Exception {\r\n        HashedWheelTimer timer = new HashedWheelTimer(1, TimeUnit.MILLISECONDS);\r\n\r\n        timer.newTimeout(new TimerTask() {\r\n\r\n            @Override\r\n            public void run(final Timeout timeout) throws Exception {\r\n                timer.newTimeout(this, 500, TimeUnit.MILLISECONDS);\r\n\r\n            }\r\n        }, 500, TimeUnit.MILLISECONDS);\r\n\r\n        Thread.sleep(30_000);\r\n        timer.stop();\r\n    }\r\n```\r\nMy understanding of the `HashedWheelTimer` is that it is indented to be used for a large number of approximated timeouts and not for millisecond precision scheduling, but I may be mistaken.\r\n\r\n**To Reproduce**\r\nRun a simple producer subscribing to a topic with no messages, or run the above simple JUnit test. Observe CPU usage.\r\n\r\n**Expected behavior**\r\nAn idle consumer should not incur high CPU load. For example, when running 8 consumers on a i7-8700 (4 cores 2 threads per core), TaskManager reported 100% CPU usage - when there was no traffic, no messages on the topics.\r\n\r\n**Discussion**\r\nHigh CPU load is a high price to pay for immediate batch dispatching (which may be the primary reason for setting the 1 ms tick time). It should be possible to lax on immediate batch dispatching in favor of more compute resources available to other tasks.\r\n\r\nAn alternative is to use a plain old `ScheduledExecutorService` for batch dispatching/reception, tests suggest it will also be lighter on the CPU when millisecond precision is required and the number of task is not too high. For example, I could schedule 2000 simple tasks every millisecond (`scheduleAtFixedRate`) with more compute available on a single thread. When scheduling 10k tasks every millisecond, the thread was working 100%, but scheduling 10k tasks every 10 millisecond was OK. So if a client is used to create a huge number of producers/consumers, it might be better to lax the batch timeout so the timeout thread has a chance to actually perform its work. Another observation is that the `HashedWheelTimer` used with 1 millisecond tick time is not able to run a single simple task every millisecond, party due to the `HashedWheelTimer` approximate nature, and maybe party because spinning the wheel competes with task expiration.\r\n\r\nNote that when using `ScheduledExecutorService` each task might not get exactly the same number of executions, for example when scheduling 1000 tasks run execute every millisecond for 30 seconds, task were executed between 29 986 and 30 012 times.\r\n\r\nSome suggestions:\r\n1) The tick time could be configurable, with default value = 1 millisecond to preserve current behavior.\r\n2) Use default tick time 100 milliseconds, then create a `ScheduledExecutorService `in `PulsarClientImpl` that is exposed the same way as the `Timer `object for other classes to use. The `ProducerImpl `and `ConsumerBase` could use the `ScheduledExecutorService `to schedule batch dispatching/reception.\r\n\r\n**Additional context**\r\nObserved under Windows 10 64-bit, running Java 11.\r\n", "url": "https://github.com/apache/pulsar/issues/6414", "user": "racorn", "labels": ["component/client", "help wanted", "triage/week-9", "type/bug"], "created": "2020-02-24 23:13:42", "closed": "2020-03-03 02:31:55", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "Pull Request checks detected documentation changes but it's not", "body": "**Describe the bug**\r\nOn https://github.com/apache/pulsar/pull/6381, the checks are detected as documentation changes but it's not. So checks like units tests are not run while they must be run.\r\n", "url": "https://github.com/apache/pulsar/issues/6409", "user": "KannarFr", "labels": ["triage/week-9", "type/bug"], "created": "2020-02-24 10:48:08", "closed": "2020-02-24 20:21:55", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "when send a delayed message, there is a case pull duplicate messages", "body": "**Describe the bug**\r\nwhen send a delayed message ,there is a case when a consumer restarts and pull duplicate messages.\r\n\r\n**To Reproduce**\r\n\r\n1\u3001send message\r\n```\r\nMessageId msgId = producer.newMessage()\r\n                          .value(\"my-async-message\".getBytes())\r\n                          .deliverAfter(5000, TimeUnit.MILLISECONDS)\r\n                          .send();\r\nSystem.out.println(msgId.getMessageId())\r\n```\r\nConsole\r\n```\r\nmsgId=405:0:-1\r\n```\r\n2\u3001Stop consumers in 5000ms,  just produced message hasn't arrived\r\n\r\n3\u3001start conumers\uff0c then get two same  messages\uff0cthis is  we do not want\r\n```\r\n do {\r\n       Message msg = consumer.receive();\r\n       System.out.println(msg.getMessageId())\r\n }  while (true);\r\n```\r\nConsole\r\n```\r\n405:0:-1\r\n405:0:-1\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/6403", "user": "liudezhi2098", "labels": ["triage/week-9", "type/bug"], "created": "2020-02-23 14:14:47", "closed": "2020-02-27 03:08:37", "commits": {"e71b9fc4e256f24c9b6c0edd14e40e8af1f24374": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "14508a6e018369c5438cd3d9af3edd533e65129e": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "5db132936bdeac2d24626c46d0eefd32629af2fa": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "63464ab7724e525676ed1d7d35f244452f5bcec2": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "e71b9fc4e256f24c9b6c0edd14e40e8af1f24374", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["792ab172ce0419097fdf10eae156ba95b61abc21"], "nameRev": "e71b9fc4e256f24c9b6c0edd14e40e8af1f24374 tags/v2.6.0-candidate-1~459", "commitMessage": "Consumer received duplicated deplayed messages upon restart\n\nFix when send a delayed message ,there is a case when a consumer restarts and pull duplicate messages. #6403", "commitDateTime": "2020-02-26 19:26:15", "authoredDateTime": "2020-02-26 19:26:15", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java", "insertions": 8, "deletions": 1, "lines": 9}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ManagedCursorImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncReplayEntries(java.util.Set,org.apache.bookkeeper.mledger.AsyncCallbacks.ReadEntriesCallback,java.lang.Object,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "14508a6e018369c5438cd3d9af3edd533e65129e", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "5db132936bdeac2d24626c46d0eefd32629af2fa", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["81c32448e39e2db94edc503026f937098aef773c"], "nameRev": "5db132936bdeac2d24626c46d0eefd32629af2fa tags/v2.5.1-candidate-1~36", "commitMessage": "Consumer received duplicated deplayed messages upon restart\n\nFix when send a delayed message ,there is a case when a consumer restarts and pull duplicate messages. #6403\n\n(cherry picked from commit e71b9fc4e256f24c9b6c0edd14e40e8af1f24374)\n", "commitDateTime": "2020-04-05 10:52:30", "authoredDateTime": "2020-02-26 19:26:15", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java", "insertions": 8, "deletions": 1, "lines": 9}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ManagedCursorImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncReplayEntries(java.util.Set,org.apache.bookkeeper.mledger.AsyncCallbacks.ReadEntriesCallback,java.lang.Object,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "63464ab7724e525676ed1d7d35f244452f5bcec2", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["9a8621f4f9b58ff67244be8561130e9b853e4f1e"], "nameRev": "63464ab7724e525676ed1d7d35f244452f5bcec2 tags/v2.5.1-candidate-3~47", "commitMessage": "Consumer received duplicated deplayed messages upon restart\n\nFix when send a delayed message ,there is a case when a consumer restarts and pull duplicate messages. #6403\n\n(cherry picked from commit e71b9fc4e256f24c9b6c0edd14e40e8af1f24374)\n", "commitDateTime": "2020-04-13 11:13:23", "authoredDateTime": "2020-02-26 19:26:15", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java", "insertions": 8, "deletions": 1, "lines": 9}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ManagedCursorImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncReplayEntries(java.util.Set,org.apache.bookkeeper.mledger.AsyncCallbacks.ReadEntriesCallback,java.lang.Object,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["e71b9fc4e256f24c9b6c0edd14e40e8af1f24374"], "filteredCommitsReason": {"duplicated": 3, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 8.0, "deletions": 1.0, "lines": 9.0, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 1.0, "UPD": 0.0, "INS": 1.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl"], "changesInPackagesSPOON": ["org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncReplayEntries(java.util.Set,org.apache.bookkeeper.mledger.AsyncCallbacks.ReadEntriesCallback,java.lang.Object,boolean)"]}, {"title": "Cpp python test failed", "body": "**Describe the bug**\r\nPython test failed:\r\n```\r\nYou should consider upgrading via the 'pip install --upgrade pip' command.\r\n---- Running Python unit tests\r\n/tmp /pulsar/pulsar-client-cpp/python /pulsar/pulsar-client-cpp\r\nTraceback (most recent call last):\r\n  File \"pulsar_test.py\", line 26, in <module>\r\n    from pulsar import Client, MessageId, \\\r\n  File \"/usr/local/lib/python2.7/dist-packages/pulsar/__init__.py\", line 109, in <module>\r\n    from pulsar import schema\r\n  File \"/usr/local/lib/python2.7/dist-packages/pulsar/schema/__init__.py\", line 21, in <module>\r\n    from .definition import *\r\n  File \"/usr/local/lib/python2.7/dist-packages/pulsar/schema/definition.py\", line 21, in <module>\r\n    from enum import Enum, EnumMeta\r\nImportError: No module named enum\r\n##[error]Process completed with exit code 1.\r\n```\r\n\r\n**To Reproduce**\r\nhttps://github.com/apache/pulsar/pull/6392/checks?check_run_id=461910053\r\n\r\n**Expected behavior**\r\nTest pass\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - Github action\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6400", "user": "tuteng", "labels": ["type/bug"], "created": "2020-02-23 01:50:21", "closed": "2020-02-24 19:37:05", "commits": {"2f4207753f1f1164b28d24d49c813557c15d2f63": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "71e24d95bf0f82d1023266ab6605088a6ff3bc13": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "81c32448e39e2db94edc503026f937098aef773c": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "9a8621f4f9b58ff67244be8561130e9b853e4f1e": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "2f4207753f1f1164b28d24d49c813557c15d2f63", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["e1f7505cbc2cadcba7cb79d8e3ed5b7855688858"], "nameRev": "2f4207753f1f1164b28d24d49c813557c15d2f63 tags/v2.6.0-candidate-1~467", "commitMessage": "Fixed enum package not found (#6401)\n\nFixes https://github.com/apache/pulsar/issues/6400\r\n\r\n### Motivation\r\nThis problem is blocking the current test. 1.1.8 version of `enum34` seems to have some problems, and the problem reproduces:\r\n\r\nUse pulsar latest code:\r\n```\r\ncd pulsar\r\nmvn clean install -DskipTests\r\ndokcer pull apachepulsar/pulsar-build:ubuntu-16.04\r\ndocker run -it -v $PWD:/pulsar --name pulsar apachepulsar/pulsar-build:ubuntu-16.04 /bin/bash\r\ndocker exec -it pulsar /bin/bash\r\ncmake .\r\nmake -j4 && make install \r\ncd python\r\npython setup.py bdist_wheel\r\npip install dist/pulsar_client-*-linux_x86_64.whl\r\n```\r\n`pip show enum34`\r\n```\r\nName: enum34\r\nVersion: 1.1.8\r\nSummary: Python 3.4 Enum backported to 3.3, 3.2, 3.1, 2.7, 2.6, 2.5, and 2.4\r\nHome-page: https://bitbucket.org/stoneleaf/enum34\r\nAuthor: Ethan Furman\r\nAuthor-email: ethan@stoneleaf.us\r\nLicense: BSD License\r\nLocation: /usr/local/lib/python2.7/dist-packages\r\nRequires:\r\nRequired-by: pulsar-client, grpcio\r\n```\r\n\r\n```\r\nroot@55e06c5c770f:/pulsar/pulsar-client-cpp/python# python\r\nPython 2.7.12 (default, Oct  8 2019, 14:14:10)\r\n[GCC 5.4.0 20160609] on linux2\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> from enum import Enum, EnumMeta\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nImportError: No module named enum\r\n>>> exit()\r\n```\r\n\r\nThere is no problem with using 1.1.9 in the test.\r\n\r\n### Modifications\r\n\r\n* Upgrade enum34 from 1.1.8 to 1.1.9\r\n\r\n### Verifying this change\r\n\r\nlocal test pass\r\n", "commitDateTime": "2020-02-24 11:37:04", "authoredDateTime": "2020-02-25 03:37:04", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/setup.py", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "71e24d95bf0f82d1023266ab6605088a6ff3bc13", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "81c32448e39e2db94edc503026f937098aef773c", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["211d7f09ed4c1d4c951eeec86aa1c429bdfa46ce"], "nameRev": "81c32448e39e2db94edc503026f937098aef773c tags/v2.5.1-candidate-1~37", "commitMessage": "Fixed enum package not found (#6401)\n\nFixes https://github.com/apache/pulsar/issues/6400\r\n\r\n### Motivation\r\nThis problem is blocking the current test. 1.1.8 version of `enum34` seems to have some problems, and the problem reproduces:\r\n\r\nUse pulsar latest code:\r\n```\r\ncd pulsar\r\nmvn clean install -DskipTests\r\ndokcer pull apachepulsar/pulsar-build:ubuntu-16.04\r\ndocker run -it -v $PWD:/pulsar --name pulsar apachepulsar/pulsar-build:ubuntu-16.04 /bin/bash\r\ndocker exec -it pulsar /bin/bash\r\ncmake .\r\nmake -j4 && make install \r\ncd python\r\npython setup.py bdist_wheel\r\npip install dist/pulsar_client-*-linux_x86_64.whl\r\n```\r\n`pip show enum34`\r\n```\r\nName: enum34\r\nVersion: 1.1.8\r\nSummary: Python 3.4 Enum backported to 3.3, 3.2, 3.1, 2.7, 2.6, 2.5, and 2.4\r\nHome-page: https://bitbucket.org/stoneleaf/enum34\r\nAuthor: Ethan Furman\r\nAuthor-email: ethan@stoneleaf.us\r\nLicense: BSD License\r\nLocation: /usr/local/lib/python2.7/dist-packages\r\nRequires:\r\nRequired-by: pulsar-client, grpcio\r\n```\r\n\r\n```\r\nroot@55e06c5c770f:/pulsar/pulsar-client-cpp/python# python\r\nPython 2.7.12 (default, Oct  8 2019, 14:14:10)\r\n[GCC 5.4.0 20160609] on linux2\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> from enum import Enum, EnumMeta\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nImportError: No module named enum\r\n>>> exit()\r\n```\r\n\r\nThere is no problem with using 1.1.9 in the test.\r\n\r\n### Modifications\r\n\r\n* Upgrade enum34 from 1.1.8 to 1.1.9\r\n\r\n### Verifying this change\r\n\r\nlocal test pass\r\n\n(cherry picked from commit 2f4207753f1f1164b28d24d49c813557c15d2f63)\n", "commitDateTime": "2020-04-05 10:52:25", "authoredDateTime": "2020-02-25 03:37:04", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/setup.py", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "9a8621f4f9b58ff67244be8561130e9b853e4f1e", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["c41498e90480bf7aa92dda17f38d39ebc4b2cb9b"], "nameRev": "9a8621f4f9b58ff67244be8561130e9b853e4f1e tags/v2.5.1-candidate-3~48", "commitMessage": "Fixed enum package not found (#6401)\n\nFixes https://github.com/apache/pulsar/issues/6400\r\n\r\n### Motivation\r\nThis problem is blocking the current test. 1.1.8 version of `enum34` seems to have some problems, and the problem reproduces:\r\n\r\nUse pulsar latest code:\r\n```\r\ncd pulsar\r\nmvn clean install -DskipTests\r\ndokcer pull apachepulsar/pulsar-build:ubuntu-16.04\r\ndocker run -it -v $PWD:/pulsar --name pulsar apachepulsar/pulsar-build:ubuntu-16.04 /bin/bash\r\ndocker exec -it pulsar /bin/bash\r\ncmake .\r\nmake -j4 && make install \r\ncd python\r\npython setup.py bdist_wheel\r\npip install dist/pulsar_client-*-linux_x86_64.whl\r\n```\r\n`pip show enum34`\r\n```\r\nName: enum34\r\nVersion: 1.1.8\r\nSummary: Python 3.4 Enum backported to 3.3, 3.2, 3.1, 2.7, 2.6, 2.5, and 2.4\r\nHome-page: https://bitbucket.org/stoneleaf/enum34\r\nAuthor: Ethan Furman\r\nAuthor-email: ethan@stoneleaf.us\r\nLicense: BSD License\r\nLocation: /usr/local/lib/python2.7/dist-packages\r\nRequires:\r\nRequired-by: pulsar-client, grpcio\r\n```\r\n\r\n```\r\nroot@55e06c5c770f:/pulsar/pulsar-client-cpp/python# python\r\nPython 2.7.12 (default, Oct  8 2019, 14:14:10)\r\n[GCC 5.4.0 20160609] on linux2\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> from enum import Enum, EnumMeta\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\nImportError: No module named enum\r\n>>> exit()\r\n```\r\n\r\nThere is no problem with using 1.1.9 in the test.\r\n\r\n### Modifications\r\n\r\n* Upgrade enum34 from 1.1.8 to 1.1.9\r\n\r\n### Verifying this change\r\n\r\nlocal test pass\r\n\n(cherry picked from commit 2f4207753f1f1164b28d24d49c813557c15d2f63)\n", "commitDateTime": "2020-04-13 11:13:18", "authoredDateTime": "2020-02-25 03:37:04", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/setup.py", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["2f4207753f1f1164b28d24d49c813557c15d2f63"], "filteredCommitsReason": {"duplicated": 3, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 1.0, "deletions": 1.0, "lines": 2.0, "gitFilesChange": 1}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["pulsar-client-cpp/python/setup.py"]}, {"title": "when sending a message, set duplicate key to properties, can't pull the message while concumer", "body": "**Describe the bug**\r\nwhen sending a message, set duplicate key to properties, can't pull the message while concumer\uff0c\r\nand it can\u2019t be consumed anymore\r\n\r\n**To Reproduce**\r\n_producer client_\r\n```java\r\nproducer.newMessage().value(\"Hello\")\r\n              .property(\"TagA\", \"taga\")\r\n              .property(\"TagA\", \"tagb\")\r\n              .send()\r\n\r\n ````\r\n_consumer client_\r\n```bash\r\n2020-02-21 10:24:46 WARN pulsar-client-io-1-1 - [/127.0.0.1:6650] Got exception IllegalStateException : Duplicate key TagA\r\njava.lang.IllegalStateException: Duplicate key TagA\r\n        at java.util.stream.Collectors.lambda$throwingMerger$135(Collectors.java:133) ~[na:1.8.0_20]\r\n        at java.util.stream.Collectors$$Lambda$84/1635934342.apply(Unknown Source) ~[na:na]\r\n        at java.util.HashMap.merge(HashMap.java:1245) ~[na:1.8.0_20]\r\n        at java.util.stream.Collectors.lambda$toMap$193(Collectors.java:1320) ~[na:1.8.0_20]\r\n        at java.util.stream.Collectors$$Lambda$86/674653444.accept(Unknown Source) ~[na:na]\r\n        at java.util.stream.ReduceOps$3ReducingSink.accept(ReduceOps.java:169) ~[na:1.8.0_20]\r\n        at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1374) ~[na:1.8.0_20]\r\n        at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:512) ~[na:1.8.0_20]\r\n        at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:502) ~[na:1.8.0_20]\r\n        at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708) ~[na:1.8.0_20]\r\n        at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234) ~[na:1.8.0_20]\r\n        at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499) ~[na:1.8.0_20]\r\n        at org.apache.pulsar.client.impl.MessageImpl.<init>(MessageImpl.java:109) ~[pulsar-client.jar:2.5.0]\r\n        at org.apache.pulsar.client.impl.ConsumerImpl.messageReceived(ConsumerImpl.java:1039) ~[pulsar-client.jar:2.5.0]\r\n        at org.apache.pulsar.client.impl.ClientCnx.handleMessage(ClientCnx.java:383) ~[pulsar-client.jar:2.5.0]\r\n        at org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:183) ~[pulsar-client.jar:2.5.0]\r\n        at org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:374) [pulsar-client.jar:2.5.0]\r\n        at org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:360) [pulsar-client.jar:2.5.0]\r\n\r\n ````\r\n", "url": "https://github.com/apache/pulsar/issues/6388", "user": "liudezhi2098", "labels": ["triage/week-9", "type/bug"], "created": "2020-02-21 06:27:27", "closed": "2020-04-11 02:15:07", "commits": {"79abc88fed61c2d34b4850eb1853694f400e00b9": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "ccc8e694d9c5fc86012151e55b32a834fb936aab": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "383b0257cfa084d5cf35470ceecc76bba98e1969": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 49.000277777777775, "commitsDetails": [{"commitHash": "79abc88fed61c2d34b4850eb1853694f400e00b9", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["9602c9bd5dd7f1f1f4af41e8af73236413911aa3"], "nameRev": "79abc88fed61c2d34b4850eb1853694f400e00b9 tags/v2.6.0-candidate-1~387", "commitMessage": "fix duplicate key to send propertys (#6390)\n\n**Motivation**\r\nFix when sending a message, set duplicate key to properties, can't pull the message while concumer #6388 \r\n```javascript\r\n//org.apache.pulsar.client.impl.MessageImpl\r\nif (msgMetadata.getPropertiesCount() > 0) {\r\n            this.properties = Collections.unmodifiableMap(msgMetadataBuilder.getPropertiesList().stream()\r\n                    .collect(Collectors.toMap(KeyValue::getKey, KeyValue::getValue)));\r\n        } else {\r\n            properties = Collections.emptyMap();\r\n        }\r\n        this.schema = schema;\r\n```\r\nCollectors.toMap can not allowed duplicate key\r\n\r\n**Changes**\r\nReplace old value with new value\r\n```javascript\r\nif (msgMetadata.getPropertiesCount() > 0) {\r\n            this.properties = Collections.unmodifiableMap(msgMetadataBuilder.getPropertiesList().stream()\r\n                    .collect(Collectors.toMap(KeyValue::getKey, KeyValue::getValue,\r\n                            (oldValue,newValue) -> newValue)));\r\n        } else {\r\n            properties = Collections.emptyMap();\r\n        }\r\n        this.schema = schema;\r\n```", "commitDateTime": "2020-03-20 10:09:06", "authoredDateTime": "2020-03-20 10:09:06", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MessageImpl.java", "insertions": 7, "deletions": 3, "lines": 10}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/MessageImplTest.java", "insertions": 15, "deletions": 0, "lines": 15}], "commitSpoonAstDiffStats": [{"spoonFilePath": "MessageImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl.getSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl.getProperties()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MessageImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessageImplTest.testSetDuplicatePropertiesKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "ccc8e694d9c5fc86012151e55b32a834fb936aab", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["d2a20dda4e4367498f191a0d6a458fe02da7e6f7"], "nameRev": "ccc8e694d9c5fc86012151e55b32a834fb936aab tags/v2.5.1-candidate-1~43", "commitMessage": "fix duplicate key to send propertys (#6390)\n\n**Motivation**\r\nFix when sending a message, set duplicate key to properties, can't pull the message while concumer #6388 \r\n```javascript\r\n//org.apache.pulsar.client.impl.MessageImpl\r\nif (msgMetadata.getPropertiesCount() > 0) {\r\n            this.properties = Collections.unmodifiableMap(msgMetadataBuilder.getPropertiesList().stream()\r\n                    .collect(Collectors.toMap(KeyValue::getKey, KeyValue::getValue)));\r\n        } else {\r\n            properties = Collections.emptyMap();\r\n        }\r\n        this.schema = schema;\r\n```\r\nCollectors.toMap can not allowed duplicate key\r\n\r\n**Changes**\r\nReplace old value with new value\r\n```javascript\r\nif (msgMetadata.getPropertiesCount() > 0) {\r\n            this.properties = Collections.unmodifiableMap(msgMetadataBuilder.getPropertiesList().stream()\r\n                    .collect(Collectors.toMap(KeyValue::getKey, KeyValue::getValue,\r\n                            (oldValue,newValue) -> newValue)));\r\n        } else {\r\n            properties = Collections.emptyMap();\r\n        }\r\n        this.schema = schema;\r\n```\n\n(cherry picked from commit 79abc88fed61c2d34b4850eb1853694f400e00b9)\n", "commitDateTime": "2020-04-05 10:51:57", "authoredDateTime": "2020-03-20 10:09:06", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MessageImpl.java", "insertions": 7, "deletions": 3, "lines": 10}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/MessageImplTest.java", "insertions": 15, "deletions": 0, "lines": 15}], "commitSpoonAstDiffStats": [{"spoonFilePath": "MessageImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl.getSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl.getProperties()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MessageImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessageImplTest.testSetDuplicatePropertiesKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "383b0257cfa084d5cf35470ceecc76bba98e1969", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["29a05c0f058e31325c2d660813572e5b9538df2c"], "nameRev": "383b0257cfa084d5cf35470ceecc76bba98e1969 tags/v2.5.1-candidate-3~54", "commitMessage": "fix duplicate key to send propertys (#6390)\n\n**Motivation**\r\nFix when sending a message, set duplicate key to properties, can't pull the message while concumer #6388 \r\n```javascript\r\n//org.apache.pulsar.client.impl.MessageImpl\r\nif (msgMetadata.getPropertiesCount() > 0) {\r\n            this.properties = Collections.unmodifiableMap(msgMetadataBuilder.getPropertiesList().stream()\r\n                    .collect(Collectors.toMap(KeyValue::getKey, KeyValue::getValue)));\r\n        } else {\r\n            properties = Collections.emptyMap();\r\n        }\r\n        this.schema = schema;\r\n```\r\nCollectors.toMap can not allowed duplicate key\r\n\r\n**Changes**\r\nReplace old value with new value\r\n```javascript\r\nif (msgMetadata.getPropertiesCount() > 0) {\r\n            this.properties = Collections.unmodifiableMap(msgMetadataBuilder.getPropertiesList().stream()\r\n                    .collect(Collectors.toMap(KeyValue::getKey, KeyValue::getValue,\r\n                            (oldValue,newValue) -> newValue)));\r\n        } else {\r\n            properties = Collections.emptyMap();\r\n        }\r\n        this.schema = schema;\r\n```\n\n(cherry picked from commit 79abc88fed61c2d34b4850eb1853694f400e00b9)\n", "commitDateTime": "2020-04-13 11:12:51", "authoredDateTime": "2020-03-20 10:09:06", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MessageImpl.java", "insertions": 7, "deletions": 3, "lines": 10}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/MessageImplTest.java", "insertions": 15, "deletions": 0, "lines": 15}], "commitSpoonAstDiffStats": [{"spoonFilePath": "MessageImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl.getSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl.getProperties()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MessageImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessageImplTest.testSetDuplicatePropertiesKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "It takes too long to subscribe to a topic", "body": "**Describe the bug**\r\nIt takes more than 4s to subscribe to a topic. Sometimes it takes more than 10s. Most of the time was spent starting the replicator.\r\n\r\n\r\n**Broker log**\r\n\r\nThere are logs about topic persistent://2/signal_geo/1579404480244 from the broker. \r\n```\r\n11:28:00.295 [bookkeeper-ml-workers-OrderedExecutor-0-0] INFO org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://2/signal_geo/1579404480244] There are no replicated subscriptions on the topic\r\n11:28:00.295 [bookkeeper-ml-workers-OrderedExecutor-0-0] DEBUG org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://2/signal_geo/1579404480244] Checking replication status\r\n11:28:00.295 [bookkeeper-ml-workers-OrderedExecutor-0-0] INFO org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://2/signal_geo/1579404480244] Starting replicator to remote: qa-pulsar-ali\r\n11:28:00.297 [pulsar-io-22-5] DEBUG org.apache.pulsar.broker.service.ServerCnx - [persistent://2/signal_geo/1579404480197] Received Lookup from /10.32.69.26:35808 for 141589\r\n11:28:00.319 [pulsar-io-22-4] DEBUG org.apache.pulsar.broker.service.ServerCnx - [persistent://2/signal_geo/1579404480229] Received PartitionMetadataLookup from /10.32.69.26:35566 for 141591\r\n11:28:00.323 [pulsar-io-22-11] DEBUG org.apache.pulsar.broker.service.ServerCnx - [persistent://2/signal_geo/1579404480229] Received Lookup from /10.32.69.26:35448 for 141592\r\n11:28:04.347 [bookkeeper-ml-workers-OrderedExecutor-0-0] INFO org.apache.pulsar.broker.service.AbstractReplicator - [persistent://2/signal_geo/1579404480244][qa-pulsar-ten -> qa-pulsar-ali] Starting replicator\r\n11:28:04.348 [bookkeeper-ml-workers-OrderedExecutor-0-0] INFO org.apache.pulsar.broker.service.BrokerService - Created topic persistent://2/signal_geo/1579404480244 - dedup is disabled\r\n11:28:04.349 [bookkeeper-ml-workers-OrderedExecutor-0-0] DEBUG org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://2/signal_geo/1579404480244] [10.32.68.229:8787:18672:1579404480289] [mfhzn] Added consumer \u2013 count: 1\r\n```", "url": "https://github.com/apache/pulsar/issues/6363", "user": "dsmlily", "labels": ["triage/week-8", "type/bug"], "created": "2020-02-19 10:12:01", "closed": "2020-02-23 11:43:49", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "There is at least one place where sendAsync does not release the semaphore", "body": "**Describe the bug**\r\n\r\nIf an error occurs that completes the future without releasing the semaphore then the calling thread may block forever.\r\n\r\nhttps://github.com/apache/pulsar/blob/master/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java#L354\r\n\r\nThere may be another case with timeout that tickles this but that's harder to reproduce\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\nSend a bunch of large messages asynchronously; hang\r\n\r\n**Expected behavior**\r\nAny failure path should release the semaphore before returning.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6360", "user": "scr-oath", "labels": ["help wanted", "release/2.5.1", "triage/week-8", "type/bug"], "created": "2020-02-18 22:17:59", "closed": "2020-03-18 02:48:29", "commits": {}, "ttf": 28.00027777777778, "commitsDetails": []}, {"title": "[Helm] Bookeeper + Autorecovery error state - could not find or load main class", "body": "**Describe the bug**\r\nWhen trying to deploy both the 2.5.0 and 2.4.2 helm charts on kubernetes v1.17.2, autorecovery and bookkeeper instances go into error state.\r\nIt seems that they arent passed a proper main class definition, instead they try to load `\"-Xms` for example...\r\n\r\nAutorecovery logs\r\n```\r\n[conf/pulsar_env.sh] Applying config PULSAR_MEM = \" -Xms64m -Xmx128m \"\r\n[conf/bookkeeper.conf] Applying config zkServers = pulsar-zookeeper-0.pulsar-zookeeper\r\nJMX enabled by default\r\nError: Could not find or load main class \"\r\n```\r\n\r\nBookkeeper logs\r\n```\r\n[conf/pulsar_env.sh] Applying config PULSAR_MEM = \"-Xms128m -Xmx256m -XX:MaxDirectMemorySize=128m -Dio.netty.leakDetectionLevel=disabled -Dio.netty.recycler.linkCapacity=1024 -XX:+UseG1GC -XX:MaxGCPauseMillis=10 -XX:+ParallelRefProcEnabled -XX:+UnlockExperimentalVMOptions -XX:+AggressiveOpts -XX:+DoEscapeAnalysis -XX:ParallelGCThreads=32 -XX:ConcGCThreads=32 -XX:G1NewSizePercent=50 -XX:+DisableExplicitGC -XX:-ResizePLAB -XX:+ExitOnOutOfMemoryError -XX:+PerfDisableSharedMem -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintHeapAtGC -verbosegc -XX:G1LogLevel=finest\"\r\n[conf/bookkeeper.conf] Applying config autoRecoveryDaemonEnabled = false\r\n[conf/bookkeeper.conf] Applying config dbStorage_readAheadCacheMaxSizeMb = 32\r\n[conf/bookkeeper.conf] Applying config dbStorage_rocksDB_blockCacheSize = 268435456\r\n[conf/bookkeeper.conf] Applying config dbStorage_writeCacheMaxSizeMb = 32\r\n[conf/bookkeeper.conf] Applying config journalMaxSizeMB = 2048\r\n[conf/bookkeeper.conf] Applying config statsProviderClass = org.apache.bookkeeper.stats.prometheus.PrometheusMetricsProvider\r\n[conf/bookkeeper.conf] Applying config useHostNameAsBookieID = true\r\n[conf/bookkeeper.conf] Applying config zkServers = pulsar-zookeeper-0.pulsar-zookeeper\r\n[conf/pulsar_env.sh] Applying config PULSAR_MEM = \"-Xms128m -Xmx256m -XX:MaxDirectMemorySize=128m -Dio.netty.leakDetectionLevel=disabled -Dio.netty.recycler.linkCapacity=1024 -XX:+UseG1GC -XX:MaxGCPauseMillis=10 -XX:+ParallelRefProcEnabled -XX:+UnlockExperimentalVMOptions -XX:+AggressiveOpts -XX:+DoEscapeAnalysis -XX:ParallelGCThreads=32 -XX:ConcGCThreads=32 -XX:G1NewSizePercent=50 -XX:+DisableExplicitGC -XX:-ResizePLAB -XX:+ExitOnOutOfMemoryError -XX:+PerfDisableSharedMem -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintHeapAtGC -verbosegc -XX:G1LogLevel=finest\"\r\n[conf/pulsar_env.sh] Applying config PULSAR_MEM = \"-Xms128m -Xmx256m -XX:MaxDirectMemorySize=128m -Dio.netty.leakDetectionLevel=disabled -Dio.netty.recycler.linkCapacity=1024 -XX:+UseG1GC -XX:MaxGCPauseMillis=10 -XX:+ParallelRefProcEnabled -XX:+UnlockExperimentalVMOptions -XX:+AggressiveOpts -XX:+DoEscapeAnalysis -XX:ParallelGCThreads=32 -XX:ConcGCThreads=32 -XX:G1NewSizePercent=50 -XX:+DisableExplicitGC -XX:-ResizePLAB -XX:+ExitOnOutOfMemoryError -XX:+PerfDisableSharedMem -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintHeapAtGC -verbosegc -XX:G1LogLevel=finest\"\r\nError: Could not find or load main class \"-Xms128m\r\nHeap\r\n garbage-first heap   total 131072K, used 7168K [0x00000000f0000000, 0x00000000f0100400, 0x0000000100000000)\r\n  region size 1024K, 8 young (8192K), 0 survivors (0K)\r\n Metaspace       used 2881K, capacity 4480K, committed 4480K, reserved 1056768K\r\n  class space    used 302K, capacity 384K, committed 384K, reserved 1048576K\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Checkout either master, branch 2.5.0 or 2.4.2\r\n2. package the helm charts (either with latest helm3 or helm2 version)\r\n3. Deploy helm chart with default values or mini-values.yaml included\r\n4. check with `kubectl get pods` and `kubectl get logs`\r\n\r\n**Expected behavior**\r\nClean release of pulsar on Kubernetes, available Bookkeeper nodes etc.\r\n\r\n**Screenshots**\r\n```\r\nNAME                                   READY   STATUS             RESTARTS   AGE\r\npulsar-autorecovery-5c95797dff-tr27f   0/1     CrashLoopBackOff   5          5m58s\r\npulsar-bastion-84c76c6998-rj9nb        1/1     Running            0          5m58s\r\npulsar-bookkeeper-0                    0/1     CrashLoopBackOff   5          5m58s\r\npulsar-broker-8b8ff58f5-p54w9          0/1     CrashLoopBackOff   5          5m58s\r\npulsar-dashboard-74fd69f4b5-s6h56      1/1     Running            0          5m58s\r\npulsar-grafana-7dfdc79bb4-5t44r        1/1     Running            0          5m58s\r\npulsar-prometheus-89b474499-kvl24      1/1     Running            0          5m58s\r\npulsar-proxy-7c69fc6df5-2mwbw          1/1     Running            0          5m58s\r\npulsar-zookeeper-0                     1/1     Running            0          5m58s\r\npulsar-zookeeper-metadata-nl8x9        0/1     Completed          0          5m58s\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - Manjaro (Arch)\r\n- Kubernetes 1.17.3\r\n- Helm 2.16.3 and 3.1.0\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6355", "user": "MisterTimn", "labels": ["triage/week-8", "type/bug"], "created": "2020-02-18 15:10:35", "closed": "2020-02-22 06:07:11", "commits": {"af4773bf7bf56a1306ed44a6084cb4491d7d3943": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "151b7623a1c9423acd561840a65a669959e8c027": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "b5d0ac7902bd2f9a429347ab1a96573bc540a069": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "af4773bf7bf56a1306ed44a6084cb4491d7d3943", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["bb5d6fdb0417ec33c0b62c9fafd3622647dbe6bd"], "nameRev": "af4773bf7bf56a1306ed44a6084cb4491d7d3943 tags/v2.6.0-candidate-1~474", "commitMessage": "[Issue 6355][HELM] autorecovery - could not find or load main class (#6373)\n\nThis applies the recommended fix from\r\nhttps://github.com/apache/pulsar/issues/6355#issuecomment-587756717\r\n\r\nFixes #6355\r\n\r\n### Motivation\r\n\r\nThis PR corrects the configmap data which was causing the autorecovery pod to crashloop\r\nwith `could not find or load main class`\r\n\r\n### Modifications\r\n\r\nUpdated the configmap var data per [this comment](https://github.com/apache/pulsar/issues/6355#issuecomment-587756717) from @sijie ", "commitDateTime": "2020-02-21 22:07:10", "authoredDateTime": "2020-02-21 22:07:10", "commitGitStats": [{"filePath": "deployment/kubernetes/helm/pulsar/values-mini.yaml", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "deployment/kubernetes/helm/pulsar/values.yaml", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "151b7623a1c9423acd561840a65a669959e8c027", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["4cee828d301f1e655b2bb25a97f04d1c72dc9eeb"], "nameRev": "151b7623a1c9423acd561840a65a669959e8c027 tags/v2.5.1-candidate-1~45", "commitMessage": "[Issue 6355][HELM] autorecovery - could not find or load main class (#6373)\n\nThis applies the recommended fix from\r\nhttps://github.com/apache/pulsar/issues/6355#issuecomment-587756717\r\n\r\nFixes #6355\r\n\r\n### Motivation\r\n\r\nThis PR corrects the configmap data which was causing the autorecovery pod to crashloop\r\nwith `could not find or load main class`\r\n\r\n### Modifications\r\n\r\nUpdated the configmap var data per [this comment](https://github.com/apache/pulsar/issues/6355#issuecomment-587756717) from @sijie \n\n(cherry picked from commit af4773bf7bf56a1306ed44a6084cb4491d7d3943)\n", "commitDateTime": "2020-04-05 10:51:48", "authoredDateTime": "2020-02-21 22:07:10", "commitGitStats": [{"filePath": "deployment/kubernetes/helm/pulsar/values-mini.yaml", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "deployment/kubernetes/helm/pulsar/values.yaml", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "b5d0ac7902bd2f9a429347ab1a96573bc540a069", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["d7b559e20cb570478085db8323832ec6f1e0a8d5"], "nameRev": "b5d0ac7902bd2f9a429347ab1a96573bc540a069 tags/v2.5.1-candidate-3~57", "commitMessage": "[Issue 6355][HELM] autorecovery - could not find or load main class (#6373)\n\nThis applies the recommended fix from\r\nhttps://github.com/apache/pulsar/issues/6355#issuecomment-587756717\r\n\r\nFixes #6355\r\n\r\n### Motivation\r\n\r\nThis PR corrects the configmap data which was causing the autorecovery pod to crashloop\r\nwith `could not find or load main class`\r\n\r\n### Modifications\r\n\r\nUpdated the configmap var data per [this comment](https://github.com/apache/pulsar/issues/6355#issuecomment-587756717) from @sijie \n\n(cherry picked from commit af4773bf7bf56a1306ed44a6084cb4491d7d3943)\n", "commitDateTime": "2020-04-13 11:12:38", "authoredDateTime": "2020-02-21 22:07:10", "commitGitStats": [{"filePath": "deployment/kubernetes/helm/pulsar/values-mini.yaml", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "deployment/kubernetes/helm/pulsar/values.yaml", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Reader.startMessageIdInclusive() is not working ", "body": "**Describe the bug**\r\nI tried to get the latest message from the topic using Reader.\r\n```\r\nclient.newReader()\r\n                    .topic(topic)\r\n                    .startMessageId( X )\r\n                    .startMessageIdInclusive()\r\n                    .create();\r\n```\r\nBut I got the message from X+1 and so on.\r\n\r\n**Expected behavior**\r\nExpected to receive the message from X and so on.\r\n\r\n**Additional context**\r\npulsar version = 2.5.0\r\n", "url": "https://github.com/apache/pulsar/issues/6350", "user": "Vanchhay", "labels": ["triage/week-8", "type/bug"], "created": "2020-02-18 05:45:02", "closed": "2020-02-24 04:27:09", "commits": {"63ccd43e1a3294d696a4af37c76261eed1bb3124": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "8a64dc6669cec5698bb0e2ef4a7fb75631c0d72c": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "0002a255c9d22ef4fa635b085c8c89b9d48d1797": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "d789b102690da5b23eb1ccf3fb91fc5beec529dd": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "63ccd43e1a3294d696a4af37c76261eed1bb3124", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["7fb9affa3615ade8edddabce849437df02f89500"], "nameRev": "63ccd43e1a3294d696a4af37c76261eed1bb3124 tags/v2.6.0-candidate-1~469", "commitMessage": "[Java Reader Client] Start reader inside batch result in read first message in batch. (#6345)\n\nFixes #6344 \r\nFixes #6350\r\n\r\nThe bug was brought in https://github.com/apache/pulsar/pull/5622 by changing the skip logic wrongly.\r\n", "commitDateTime": "2020-02-23 20:27:08", "authoredDateTime": "2020-02-24 12:27:08", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java", "insertions": 29, "deletions": 9, "lines": 38}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicReaderTest.java", "insertions": 67, "deletions": 7, "lines": 74}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/BatchReceivePolicy.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 25, "deletions": 6, "lines": 31}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SimpleProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testReaderStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 13, "UPD": 5, "INS": 0, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testConsumerStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 20, "UPD": 4, "INS": 8, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartInMiddleOfBatch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchReceivePolicy.java", "spoonMethods": []}, {"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.hasEnoughMessagesForBatchReceive()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.isResetIncludedAndSameEntryLedger(org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.messageReceived(org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData,int,io.netty.buffer.ByteBuf,org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.receiveIndividualMessagesFromBatch(org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata,int,io.netty.buffer.ByteBuf,org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData,org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(long)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(org.apache.pulsar.client.api.MessageId)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.clearReceiverQueue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "8a64dc6669cec5698bb0e2ef4a7fb75631c0d72c", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "0002a255c9d22ef4fa635b085c8c89b9d48d1797", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["e939f5597b4a6df03d4e4475afc2fc39b4cad051"], "nameRev": "0002a255c9d22ef4fa635b085c8c89b9d48d1797 tags/v2.5.1-candidate-1~51", "commitMessage": "[Java Reader Client] Start reader inside batch result in read first message in batch. (#6345)\n\nFixes #6344 \r\nFixes #6350\r\n\r\nThe bug was brought in https://github.com/apache/pulsar/pull/5622 by changing the skip logic wrongly.\r\n\n(cherry picked from commit 63ccd43e1a3294d696a4af37c76261eed1bb3124)\n", "commitDateTime": "2020-04-05 10:51:09", "authoredDateTime": "2020-02-24 12:27:08", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java", "insertions": 29, "deletions": 9, "lines": 38}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicReaderTest.java", "insertions": 67, "deletions": 7, "lines": 74}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/BatchReceivePolicy.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 25, "deletions": 6, "lines": 31}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SimpleProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testReaderStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 13, "UPD": 5, "INS": 0, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testConsumerStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 20, "UPD": 4, "INS": 8, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartInMiddleOfBatch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchReceivePolicy.java", "spoonMethods": []}, {"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.hasEnoughMessagesForBatchReceive()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.isResetIncludedAndSameEntryLedger(org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.messageReceived(org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData,int,io.netty.buffer.ByteBuf,org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.receiveIndividualMessagesFromBatch(org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata,int,io.netty.buffer.ByteBuf,org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData,org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(long)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(org.apache.pulsar.client.api.MessageId)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.clearReceiverQueue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "d789b102690da5b23eb1ccf3fb91fc5beec529dd", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["1b6266b8bbb4ab10e2e28981169c4545bbdb7c05"], "nameRev": "d789b102690da5b23eb1ccf3fb91fc5beec529dd tags/v2.5.1-candidate-3~63", "commitMessage": "[Java Reader Client] Start reader inside batch result in read first message in batch. (#6345)\n\nFixes #6344 \r\nFixes #6350\r\n\r\nThe bug was brought in https://github.com/apache/pulsar/pull/5622 by changing the skip logic wrongly.\r\n\n(cherry picked from commit 63ccd43e1a3294d696a4af37c76261eed1bb3124)\n", "commitDateTime": "2020-04-13 11:12:02", "authoredDateTime": "2020-02-24 12:27:08", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java", "insertions": 29, "deletions": 9, "lines": 38}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicReaderTest.java", "insertions": 67, "deletions": 7, "lines": 74}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/BatchReceivePolicy.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 25, "deletions": 6, "lines": 31}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SimpleProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testReaderStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 13, "UPD": 5, "INS": 0, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testConsumerStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 20, "UPD": 4, "INS": 8, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartInMiddleOfBatch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchReceivePolicy.java", "spoonMethods": []}, {"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.hasEnoughMessagesForBatchReceive()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.isResetIncludedAndSameEntryLedger(org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.messageReceived(org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData,int,io.netty.buffer.ByteBuf,org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.receiveIndividualMessagesFromBatch(org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata,int,io.netty.buffer.ByteBuf,org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData,org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(long)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(org.apache.pulsar.client.api.MessageId)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.clearReceiverQueue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 3, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0.0, "deletions": 0.0, "lines": 0.0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0.0, "UPD": 0.0, "INS": 0.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[Reader] seek to batch messageId went wrong in 2.5.0", "body": "Starting the reader with a MessageId inside a batch:  (11:0:3:151) with :\r\n```\r\nclient.newReader()\r\n         .topic(topic)\r\n         .startMessageId(startMessageId)\r\n         .startMessageIdInclusive()\r\n         .loadConf(readerConf)\r\n         .create();\r\n```\r\nthe first message I read with reader.readNext() happens to be the one with messageId (11:0:3:0).\r\n\r\nThis is 2.5.0 related since my library relies on 2.4.2 works correctly.", "url": "https://github.com/apache/pulsar/issues/6344", "user": "yjshen", "labels": ["triage/week-8", "type/bug"], "created": "2020-02-17 12:37:14", "closed": "2020-02-24 04:27:09", "commits": {"63ccd43e1a3294d696a4af37c76261eed1bb3124": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "8a64dc6669cec5698bb0e2ef4a7fb75631c0d72c": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "0002a255c9d22ef4fa635b085c8c89b9d48d1797": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "d789b102690da5b23eb1ccf3fb91fc5beec529dd": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "63ccd43e1a3294d696a4af37c76261eed1bb3124", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["7fb9affa3615ade8edddabce849437df02f89500"], "nameRev": "63ccd43e1a3294d696a4af37c76261eed1bb3124 tags/v2.6.0-candidate-1~469", "commitMessage": "[Java Reader Client] Start reader inside batch result in read first message in batch. (#6345)\n\nFixes #6344 \r\nFixes #6350\r\n\r\nThe bug was brought in https://github.com/apache/pulsar/pull/5622 by changing the skip logic wrongly.\r\n", "commitDateTime": "2020-02-23 20:27:08", "authoredDateTime": "2020-02-24 12:27:08", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java", "insertions": 29, "deletions": 9, "lines": 38}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicReaderTest.java", "insertions": 67, "deletions": 7, "lines": 74}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/BatchReceivePolicy.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 25, "deletions": 6, "lines": 31}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SimpleProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testReaderStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 13, "UPD": 5, "INS": 0, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testConsumerStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 20, "UPD": 4, "INS": 8, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartInMiddleOfBatch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchReceivePolicy.java", "spoonMethods": []}, {"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.hasEnoughMessagesForBatchReceive()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.isResetIncludedAndSameEntryLedger(org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.messageReceived(org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData,int,io.netty.buffer.ByteBuf,org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.receiveIndividualMessagesFromBatch(org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata,int,io.netty.buffer.ByteBuf,org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData,org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(long)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(org.apache.pulsar.client.api.MessageId)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.clearReceiverQueue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "8a64dc6669cec5698bb0e2ef4a7fb75631c0d72c", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "0002a255c9d22ef4fa635b085c8c89b9d48d1797", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["e939f5597b4a6df03d4e4475afc2fc39b4cad051"], "nameRev": "0002a255c9d22ef4fa635b085c8c89b9d48d1797 tags/v2.5.1-candidate-1~51", "commitMessage": "[Java Reader Client] Start reader inside batch result in read first message in batch. (#6345)\n\nFixes #6344 \r\nFixes #6350\r\n\r\nThe bug was brought in https://github.com/apache/pulsar/pull/5622 by changing the skip logic wrongly.\r\n\n(cherry picked from commit 63ccd43e1a3294d696a4af37c76261eed1bb3124)\n", "commitDateTime": "2020-04-05 10:51:09", "authoredDateTime": "2020-02-24 12:27:08", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java", "insertions": 29, "deletions": 9, "lines": 38}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicReaderTest.java", "insertions": 67, "deletions": 7, "lines": 74}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/BatchReceivePolicy.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 25, "deletions": 6, "lines": 31}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SimpleProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testReaderStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 13, "UPD": 5, "INS": 0, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testConsumerStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 20, "UPD": 4, "INS": 8, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartInMiddleOfBatch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchReceivePolicy.java", "spoonMethods": []}, {"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.hasEnoughMessagesForBatchReceive()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.isResetIncludedAndSameEntryLedger(org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.messageReceived(org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData,int,io.netty.buffer.ByteBuf,org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.receiveIndividualMessagesFromBatch(org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata,int,io.netty.buffer.ByteBuf,org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData,org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(long)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(org.apache.pulsar.client.api.MessageId)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.clearReceiverQueue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "d789b102690da5b23eb1ccf3fb91fc5beec529dd", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["1b6266b8bbb4ab10e2e28981169c4545bbdb7c05"], "nameRev": "d789b102690da5b23eb1ccf3fb91fc5beec529dd tags/v2.5.1-candidate-3~63", "commitMessage": "[Java Reader Client] Start reader inside batch result in read first message in batch. (#6345)\n\nFixes #6344 \r\nFixes #6350\r\n\r\nThe bug was brought in https://github.com/apache/pulsar/pull/5622 by changing the skip logic wrongly.\r\n\n(cherry picked from commit 63ccd43e1a3294d696a4af37c76261eed1bb3124)\n", "commitDateTime": "2020-04-13 11:12:02", "authoredDateTime": "2020-02-24 12:27:08", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java", "insertions": 29, "deletions": 9, "lines": 38}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicReaderTest.java", "insertions": 67, "deletions": 7, "lines": 74}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/BatchReceivePolicy.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 25, "deletions": 6, "lines": 31}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SimpleProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testReaderStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 13, "UPD": 5, "INS": 0, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testConsumerStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartMessageIdAtExpectedPos(boolean,boolean,int)", "TOT": 20, "UPD": 4, "INS": 8, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartInMiddleOfBatch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchReceivePolicy.java", "spoonMethods": []}, {"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.hasEnoughMessagesForBatchReceive()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.isResetIncludedAndSameEntryLedger(org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.messageReceived(org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData,int,io.netty.buffer.ByteBuf,org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.receiveIndividualMessagesFromBatch(org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata,int,io.netty.buffer.ByteBuf,org.apache.pulsar.common.api.proto.PulsarApi.MessageIdData,org.apache.pulsar.client.impl.ClientCnx)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(long)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(org.apache.pulsar.client.api.MessageId)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.clearReceiverQueue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 3, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0.0, "deletions": 0.0, "lines": 0.0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0.0, "UPD": 0.0, "INS": 0.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Broker failed to start when specifying a list of bookie groups", "body": "**Describe the bug**\r\nWhen set `bookkeeperClientIsolationGroups` to a list of bookie groups (e.g. group1,group2), pulsar service failed to start:\r\n```\r\n18:33:22.906 [main] ERROR org.apache.pulsar.PulsarBrokerStarter - Failed to start pulsar service.\r\norg.apache.pulsar.broker.PulsarServerException: java.lang.ClassCastException: java.util.ArrayList cannot be cast to java.lang.String\r\n        at org.apache.pulsar.broker.PulsarService.start(PulsarService.java:526) ~[pulsar-broker-2.6.0-SNAPSHOT.jar:2.6.0-SNAPSHOT]\r\n        at org.apache.pulsar.PulsarBrokerStarter$BrokerStarter.start(PulsarBrokerStarter.java:274) ~[pulsar-broker-2.6.0-SNAPSHOT.jar:2.6.0-SNAPSHOT]\r\n        at org.apache.pulsar.PulsarBrokerStarter.main(PulsarBrokerStarter.java:339) [pulsar-broker-2.6.0-SNAPSHOT.jar:2.6.0-SNAPSHOT]\r\n```\r\n\r\n**Expected behavior**\r\nPulsar service should start successfully when specifying a list of bookie groups.\r\n\r\n**Describe the solution you'd like**\r\nAdd type judgment when get `String` property.\r\n", "url": "https://github.com/apache/pulsar/issues/6343", "user": "murong00", "labels": ["triage/week-8", "type/bug"], "created": "2020-02-17 12:29:14", "closed": "2020-02-24 13:46:32", "commits": {"e1f7505cbc2cadcba7cb79d8e3ed5b7855688858": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "bd4d87979674a2fd6541cf79566cfd29a52ecae0": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "6af87b6651f89f6fe1748308d352dfa2a7b66a47": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "b908316c93b59eb7d09ebfc75479a4c1068add99": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 7.000277777777778, "commitsDetails": [{"commitHash": "e1f7505cbc2cadcba7cb79d8e3ed5b7855688858", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["63ccd43e1a3294d696a4af37c76261eed1bb3124"], "nameRev": "e1f7505cbc2cadcba7cb79d8e3ed5b7855688858 tags/v2.6.0-candidate-1~468", "commitMessage": "Fix broker to specify a list of bookie groups. (#6349)\n\n### Motivation\r\n\r\nFixes #6343\r\n\r\n### Modifications\r\n\r\nAdd a method to cast object value to `String`.", "commitDateTime": "2020-02-24 21:46:31", "authoredDateTime": "2020-02-24 21:46:31", "commitGitStats": [{"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "insertions": 14, "deletions": 2, "lines": 16}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ZkIsolatedBookieEnsemblePlacementPolicy.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.ZkIsolatedBookieEnsemblePlacementPolicy.castToString(java.lang.Object)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.zookeeper.ZkIsolatedBookieEnsemblePlacementPolicy.initialize(org.apache.bookkeeper.conf.ClientConfiguration,java.util.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger)", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 2, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "bd4d87979674a2fd6541cf79566cfd29a52ecae0", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "6af87b6651f89f6fe1748308d352dfa2a7b66a47", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["0002a255c9d22ef4fa635b085c8c89b9d48d1797"], "nameRev": "6af87b6651f89f6fe1748308d352dfa2a7b66a47 tags/v2.5.1-candidate-1~50", "commitMessage": "Fix broker to specify a list of bookie groups. (#6349)\n\n### Motivation\r\n\r\nFixes #6343\r\n\r\n### Modifications\r\n\r\nAdd a method to cast object value to `String`.\n\n(cherry picked from commit e1f7505cbc2cadcba7cb79d8e3ed5b7855688858)\n", "commitDateTime": "2020-04-05 10:51:14", "authoredDateTime": "2020-02-24 21:46:31", "commitGitStats": [{"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "insertions": 14, "deletions": 2, "lines": 16}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ZkIsolatedBookieEnsemblePlacementPolicy.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.ZkIsolatedBookieEnsemblePlacementPolicy.castToString(java.lang.Object)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.zookeeper.ZkIsolatedBookieEnsemblePlacementPolicy.initialize(org.apache.bookkeeper.conf.ClientConfiguration,java.util.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger)", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 2, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "b908316c93b59eb7d09ebfc75479a4c1068add99", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["d789b102690da5b23eb1ccf3fb91fc5beec529dd"], "nameRev": "b908316c93b59eb7d09ebfc75479a4c1068add99 tags/v2.5.1-candidate-3~62", "commitMessage": "Fix broker to specify a list of bookie groups. (#6349)\n\n### Motivation\r\n\r\nFixes #6343\r\n\r\n### Modifications\r\n\r\nAdd a method to cast object value to `String`.\n\n(cherry picked from commit e1f7505cbc2cadcba7cb79d8e3ed5b7855688858)\n", "commitDateTime": "2020-04-13 11:12:06", "authoredDateTime": "2020-02-24 21:46:31", "commitGitStats": [{"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkIsolatedBookieEnsemblePlacementPolicy.java", "insertions": 14, "deletions": 2, "lines": 16}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ZkIsolatedBookieEnsemblePlacementPolicy.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.ZkIsolatedBookieEnsemblePlacementPolicy.castToString(java.lang.Object)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.zookeeper.ZkIsolatedBookieEnsemblePlacementPolicy.initialize(org.apache.bookkeeper.conf.ClientConfiguration,java.util.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger)", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 2, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 3, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0.0, "deletions": 0.0, "lines": 0.0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0.0, "UPD": 0.0, "INS": 0.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Korean documentation is not built to the website", "body": "*Problem*\r\n\r\nThe Korean translation has been enabled in Crowdin. But the pages are not built to the website. So when choosing `Korean` in the menu, the documentation is not reachable.", "url": "https://github.com/apache/pulsar/issues/6342", "user": "sijie", "labels": ["component/documentation", "triage/week-8", "type/bug"], "created": "2020-02-17 07:58:55", "closed": "2020-04-15 01:41:41", "commits": {"77ff6b5423d7ecb1f43894d5cd0d813f86426ef3": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 57.000277777777775, "commitsDetails": [{"commitHash": "77ff6b5423d7ecb1f43894d5cd0d813f86426ef3", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["d4a47c6d5541b2e0c1917b9521bdcb71d56bc2a2"], "nameRev": "77ff6b5423d7ecb1f43894d5cd0d813f86426ef3 tags/v2.6.0-candidate-1~293", "commitMessage": "Issue 6342: Korean documentation is not built to the website (#6735)\n\nFixes #6342\r\n\r\n*Motivation*\r\n\r\nFix duplicated entry in the languages.js", "commitDateTime": "2020-04-14 18:41:40", "authoredDateTime": "2020-04-14 18:41:40", "commitGitStats": [{"filePath": "site2/website/languages.js", "insertions": 1, "deletions": 5, "lines": 6}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[Helm] Wrong/Missing key definition in configData in values-mini.yaml", "body": "**Describe the bug**\r\nInconsistent key definition between `values.yaml` and `values-mini.yaml` in line 184. \r\nIt seems the former is correct.\r\n\r\n[values-mini.yaml L184](https://github.com/apache/pulsar/blob/df152109415f2b10dd83e8afe50d9db7ab7cbad5/deployment/kubernetes/helm/pulsar/values-mini.yaml#L184)  \r\n1. missing `BOOKIE_GC `, `BOOKIE_MEM ` and `PULSAR_PREFIX_dbStorage_rocksDB_blockCacheSize `.   \r\n2. `PULSAR_MEM `duplicated.\r\n\r\n[values.yaml  L184](https://github.com/apache/pulsar/blob/df152109415f2b10dd83e8afe50d9db7ab7cbad5/deployment/kubernetes/helm/pulsar/values.yaml#L184)  as contrast. \r\n \r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6338", "user": "liyuntao", "labels": ["type/bug"], "created": "2020-02-17 03:47:45", "closed": "2020-02-17 10:41:08", "commits": {"7d4df990798a1f46d26f973120de5896e188eddf": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "a67adb4be9e59d7eb70e318b0e0ba38d6d9bb66d": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "29a473343da9fb70f40ea380da64803804b1637d": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "7d4df990798a1f46d26f973120de5896e188eddf", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["26d569b9a894b1ab051bdf215cb99a107f8abee5"], "nameRev": "7d4df990798a1f46d26f973120de5896e188eddf tags/v2.6.0-candidate-1~482", "commitMessage": "explicit statement env 'BOOKIE_MEM' and 'BOOKIE_GC' for values-mini.yaml (#6340)\n\nFixes #6338\r\n\r\n### Motivation\r\nThis commit started while I was using helm in my local minikube, noticed that there's a mismatch between `values-mini.yaml` and `values.yaml` files. At first I thought it was a copy/paste error. So I created #6338;\r\n\r\nThen I looked into the details how these env-vars[ were used](https://github.com/apache/pulsar/blob/28875d5abc4cd13a3e9cc4f59524d2566d9f9f05/conf/bkenv.sh#L36), found out its ok to use `PULSAR_MEM` as an alternative. But it introduce problems:\r\n1. Since `BOOKIE_GC` was not defined , the default [BOOKIE_EXTRA_OPTS](https://github.com/apache/pulsar/blob/28875d5abc4cd13a3e9cc4f59524d2566d9f9f05/conf/bkenv.sh#L39)  will finally use default value of `BOOKIE_GC`, thus would cover same the JVM parameters defined prior in `PULSAR_MEM`.\r\n2. May cause problems when bootstrap scripts changed in later dev, better to make it explicitly.\r\n\r\nSo I create this pr to solve above problems(hidden trouble).\r\n\r\n### Modifications\r\n\r\nAs mentioned above, I've made such modifications below:\r\n1. make `BOOKIE_MEM` and `BOOKIE_GC` explicit in `values-mini.yaml` file.  Keep up with the format in`values.yaml` file.\r\n2. remove all  print-gc-logs related args. Considering the resource constraints of minikube environment. The removed part's content is `-XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintHeapAtGC -verbosegc -XX:G1LogLevel=finest`\r\n3. leave `PULSAR_PREFIX_dbStorage_rocksDB_blockCacheSize` empty as usual, as [conf/standalone.conf#L576](https://github.com/apache/pulsar/blob/df152109415f2b10dd83e8afe50d9db7ab7cbad5/conf/standalone.conf#L576) says it would to use 10% of the direct memory size by default.\r\n", "commitDateTime": "2020-02-17 18:41:06", "authoredDateTime": "2020-02-17 18:41:06", "commitGitStats": [{"filePath": "deployment/kubernetes/helm/pulsar/values-mini.yaml", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "a67adb4be9e59d7eb70e318b0e0ba38d6d9bb66d", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["0abaaeefd8a418b1282485e52224d4959966a14a"], "nameRev": "a67adb4be9e59d7eb70e318b0e0ba38d6d9bb66d tags/v2.5.1-candidate-1~53", "commitMessage": "explicit statement env 'BOOKIE_MEM' and 'BOOKIE_GC' for values-mini.yaml (#6340)\n\nFixes #6338\r\n\r\n### Motivation\r\nThis commit started while I was using helm in my local minikube, noticed that there's a mismatch between `values-mini.yaml` and `values.yaml` files. At first I thought it was a copy/paste error. So I created #6338;\r\n\r\nThen I looked into the details how these env-vars[ were used](https://github.com/apache/pulsar/blob/28875d5abc4cd13a3e9cc4f59524d2566d9f9f05/conf/bkenv.sh#L36), found out its ok to use `PULSAR_MEM` as an alternative. But it introduce problems:\r\n1. Since `BOOKIE_GC` was not defined , the default [BOOKIE_EXTRA_OPTS](https://github.com/apache/pulsar/blob/28875d5abc4cd13a3e9cc4f59524d2566d9f9f05/conf/bkenv.sh#L39)  will finally use default value of `BOOKIE_GC`, thus would cover same the JVM parameters defined prior in `PULSAR_MEM`.\r\n2. May cause problems when bootstrap scripts changed in later dev, better to make it explicitly.\r\n\r\nSo I create this pr to solve above problems(hidden trouble).\r\n\r\n### Modifications\r\n\r\nAs mentioned above, I've made such modifications below:\r\n1. make `BOOKIE_MEM` and `BOOKIE_GC` explicit in `values-mini.yaml` file.  Keep up with the format in`values.yaml` file.\r\n2. remove all  print-gc-logs related args. Considering the resource constraints of minikube environment. The removed part's content is `-XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintHeapAtGC -verbosegc -XX:G1LogLevel=finest`\r\n3. leave `PULSAR_PREFIX_dbStorage_rocksDB_blockCacheSize` empty as usual, as [conf/standalone.conf#L576](https://github.com/apache/pulsar/blob/df152109415f2b10dd83e8afe50d9db7ab7cbad5/conf/standalone.conf#L576) says it would to use 10% of the direct memory size by default.\r\n\n(cherry picked from commit 7d4df990798a1f46d26f973120de5896e188eddf)\n", "commitDateTime": "2020-04-05 10:51:00", "authoredDateTime": "2020-02-17 18:41:06", "commitGitStats": [{"filePath": "deployment/kubernetes/helm/pulsar/values-mini.yaml", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "29a473343da9fb70f40ea380da64803804b1637d", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["4f4d0d2fb7e60be9e1694706d5bfa9b347907dba"], "nameRev": "29a473343da9fb70f40ea380da64803804b1637d tags/v2.5.1-candidate-3~65", "commitMessage": "explicit statement env 'BOOKIE_MEM' and 'BOOKIE_GC' for values-mini.yaml (#6340)\n\nFixes #6338\r\n\r\n### Motivation\r\nThis commit started while I was using helm in my local minikube, noticed that there's a mismatch between `values-mini.yaml` and `values.yaml` files. At first I thought it was a copy/paste error. So I created #6338;\r\n\r\nThen I looked into the details how these env-vars[ were used](https://github.com/apache/pulsar/blob/28875d5abc4cd13a3e9cc4f59524d2566d9f9f05/conf/bkenv.sh#L36), found out its ok to use `PULSAR_MEM` as an alternative. But it introduce problems:\r\n1. Since `BOOKIE_GC` was not defined , the default [BOOKIE_EXTRA_OPTS](https://github.com/apache/pulsar/blob/28875d5abc4cd13a3e9cc4f59524d2566d9f9f05/conf/bkenv.sh#L39)  will finally use default value of `BOOKIE_GC`, thus would cover same the JVM parameters defined prior in `PULSAR_MEM`.\r\n2. May cause problems when bootstrap scripts changed in later dev, better to make it explicitly.\r\n\r\nSo I create this pr to solve above problems(hidden trouble).\r\n\r\n### Modifications\r\n\r\nAs mentioned above, I've made such modifications below:\r\n1. make `BOOKIE_MEM` and `BOOKIE_GC` explicit in `values-mini.yaml` file.  Keep up with the format in`values.yaml` file.\r\n2. remove all  print-gc-logs related args. Considering the resource constraints of minikube environment. The removed part's content is `-XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintGCApplicationStoppedTime -XX:+PrintHeapAtGC -verbosegc -XX:G1LogLevel=finest`\r\n3. leave `PULSAR_PREFIX_dbStorage_rocksDB_blockCacheSize` empty as usual, as [conf/standalone.conf#L576](https://github.com/apache/pulsar/blob/df152109415f2b10dd83e8afe50d9db7ab7cbad5/conf/standalone.conf#L576) says it would to use 10% of the direct memory size by default.\r\n\n(cherry picked from commit 7d4df990798a1f46d26f973120de5896e188eddf)\n", "commitDateTime": "2020-04-13 11:11:54", "authoredDateTime": "2020-02-17 18:41:06", "commitGitStats": [{"filePath": "deployment/kubernetes/helm/pulsar/values-mini.yaml", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Pulsar 2.5.0 regression: Reader.hasMessageAvailable returns false when startMessageId is the message id of the last message id in startMessageIdInclusive mode", "body": "**Description**\r\n`Reader.hasMessageAvailable` returns `false` when `startMessageId` is the message id of the last message id in `startMessageIdInclusive` mode. \r\nIf the message id is any other id than the id of the last message, there is no issues. \r\nThis problem occurs with Pulsar 2.5.0. The test case passes with Pulsar 2.4.2.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n```\r\ngit clone -b has-message-available-2.5.0 https://github.com/lhotari/pulsar-bug-repro\r\ncd pulsar-bug-repro\r\n./gradlew test\r\n```\r\nThe repository that includes the test case is https://github.com/lhotari/pulsar-bug-repro .\r\n\r\n**To test with Pulsar 2.4.2 (test passes)**\r\n```\r\ngit checkout has-message-available-2.4.2\r\n./gradlew cleanTest test\r\n```\r\n\r\n**Expected behavior**\r\nWhen using the Reader API and specifying the message id of the message id of the last message that exists in the topic with startMessageIdInclusive mode, then Reader.hasMessageAvailable should return true.", "url": "https://github.com/apache/pulsar/issues/6333", "user": "lhotari", "labels": ["release/2.5.1", "triage/week-8", "type/bug"], "created": "2020-02-15 20:12:30", "closed": "2020-03-03 07:04:51", "commits": {"baf155f4a41de959145841e4cd922e89363e9292": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "37da6ce04a5084e6a134e5fa928903f53fc2dc0e": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "49207d71796cb95515fdbd595b3cc47ffdc52c94": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 16.00027777777778, "commitsDetails": [{"commitHash": "baf155f4a41de959145841e4cd922e89363e9292", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["333888ad61c062f9e3d2946918ffc21fafd441af"], "nameRev": "baf155f4a41de959145841e4cd922e89363e9292 tags/v2.6.0-candidate-1~444", "commitMessage": "[ClientAPI]Fix hasMessageAvailable() (#6362)\n\nFixes #6333 \r\n\r\nPreviously, `hasMoreMessages` is test against:\r\n```\r\nreturn lastMessageIdInBroker.compareTo(lastDequeuedMessage) == 0\r\n                && incomingMessages.size() > 0;\r\n```\r\nHowever, the `incomingMessages` could be 0 when the consumer/reader has just started and hasn't received any messages yet. \r\n\r\nIn this PR, the last entry is retrieved and decoded to get message metadata. for the batchIndex field population.", "commitDateTime": "2020-03-02 23:04:49", "authoredDateTime": "2020-03-03 15:04:49", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 76, "deletions": 10, "lines": 86}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/TwoPhaseCompactor.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicReaderTest.java", "insertions": 74, "deletions": 1, "lines": 75}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/ReaderTest.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 71, "deletions": 27, "lines": 98}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ZeroQueueConsumerImpl.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/raw/RawMessageImpl.java", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleGetLastMessageId(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetLastMessageId)", "TOT": 19, "UPD": 1, "INS": 1, "MOV": 17, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.getLargestBatchIndexWhenPossible(org.apache.pulsar.broker.service.Topic,org.apache.bookkeeper.mledger.impl.PositionImpl,int,long,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TwoPhaseCompactor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.TwoPhaseCompactor.phaseOne(org.apache.pulsar.client.api.RawReader)", "TOT": 3, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartInMiddleOfBatch()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.variationsForHasMessageAvailable()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testHasMessageAvailable(boolean,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ReaderTest.testReadMessageWithBatchingWithMessageInclusive()", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 4, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMoreMessages(org.apache.pulsar.client.api.MessageId,org.apache.pulsar.client.api.MessageId)", "TOT": 13, "UPD": 7, "INS": 0, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.messageProcessed(org.apache.pulsar.client.api.Message)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.internalGetLastMessageIdAsync(org.apache.pulsar.client.impl.Backoff,java.util.concurrent.atomic.AtomicLong,java.util.concurrent.CompletableFuture)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMessageAvailable()", "TOT": 18, "UPD": 5, "INS": 1, "MOV": 10, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMessageAvailableAsync()", "TOT": 22, "UPD": 2, "INS": 8, "MOV": 11, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.clearReceiverQueue()", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMoreMessages(org.apache.pulsar.client.api.MessageId,org.apache.pulsar.client.api.MessageId,boolean)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(org.apache.pulsar.client.api.MessageId)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ZeroQueueConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ZeroQueueConsumerImpl.fetchSingleMessageFromBroker()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "RawMessageImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.raw.RawMessageImpl.getBatchSize()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "37da6ce04a5084e6a134e5fa928903f53fc2dc0e", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["12a5dd5aad5f48a3059146af39a74e84822f5639"], "nameRev": "37da6ce04a5084e6a134e5fa928903f53fc2dc0e tags/v2.5.1-candidate-1~47", "commitMessage": "[ClientAPI]Fix hasMessageAvailable() (#6362)\n\nFixes #6333 \r\n\r\nPreviously, `hasMoreMessages` is test against:\r\n```\r\nreturn lastMessageIdInBroker.compareTo(lastDequeuedMessage) == 0\r\n                && incomingMessages.size() > 0;\r\n```\r\nHowever, the `incomingMessages` could be 0 when the consumer/reader has just started and hasn't received any messages yet. \r\n\r\nIn this PR, the last entry is retrieved and decoded to get message metadata. for the batchIndex field population.\n\n(cherry picked from commit baf155f4a41de959145841e4cd922e89363e9292)\n", "commitDateTime": "2020-04-05 10:51:36", "authoredDateTime": "2020-03-03 15:04:49", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 76, "deletions": 10, "lines": 86}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/TwoPhaseCompactor.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicReaderTest.java", "insertions": 74, "deletions": 1, "lines": 75}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/ReaderTest.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 71, "deletions": 27, "lines": 98}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ZeroQueueConsumerImpl.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/raw/RawMessageImpl.java", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleGetLastMessageId(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetLastMessageId)", "TOT": 19, "UPD": 1, "INS": 1, "MOV": 17, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.getLargestBatchIndexWhenPossible(org.apache.pulsar.broker.service.Topic,org.apache.bookkeeper.mledger.impl.PositionImpl,int,long,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TwoPhaseCompactor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.TwoPhaseCompactor.phaseOne(org.apache.pulsar.client.api.RawReader)", "TOT": 3, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartInMiddleOfBatch()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.variationsForHasMessageAvailable()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testHasMessageAvailable(boolean,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ReaderTest.testReadMessageWithBatchingWithMessageInclusive()", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 4, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMoreMessages(org.apache.pulsar.client.api.MessageId,org.apache.pulsar.client.api.MessageId)", "TOT": 13, "UPD": 7, "INS": 0, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.messageProcessed(org.apache.pulsar.client.api.Message)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.internalGetLastMessageIdAsync(org.apache.pulsar.client.impl.Backoff,java.util.concurrent.atomic.AtomicLong,java.util.concurrent.CompletableFuture)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMessageAvailable()", "TOT": 18, "UPD": 5, "INS": 1, "MOV": 10, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMessageAvailableAsync()", "TOT": 22, "UPD": 2, "INS": 8, "MOV": 11, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.clearReceiverQueue()", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMoreMessages(org.apache.pulsar.client.api.MessageId,org.apache.pulsar.client.api.MessageId,boolean)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(org.apache.pulsar.client.api.MessageId)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ZeroQueueConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ZeroQueueConsumerImpl.fetchSingleMessageFromBroker()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "RawMessageImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.raw.RawMessageImpl.getBatchSize()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "49207d71796cb95515fdbd595b3cc47ffdc52c94", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["8a11030b25f2b286d91ab1112b86bace29887d73"], "nameRev": "49207d71796cb95515fdbd595b3cc47ffdc52c94 tags/v2.5.1-candidate-3~59", "commitMessage": "[ClientAPI]Fix hasMessageAvailable() (#6362)\n\nFixes #6333 \r\n\r\nPreviously, `hasMoreMessages` is test against:\r\n```\r\nreturn lastMessageIdInBroker.compareTo(lastDequeuedMessage) == 0\r\n                && incomingMessages.size() > 0;\r\n```\r\nHowever, the `incomingMessages` could be 0 when the consumer/reader has just started and hasn't received any messages yet. \r\n\r\nIn this PR, the last entry is retrieved and decoded to get message metadata. for the batchIndex field population.\n\n(cherry picked from commit baf155f4a41de959145841e4cd922e89363e9292)\n", "commitDateTime": "2020-04-13 11:12:30", "authoredDateTime": "2020-03-03 15:04:49", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 76, "deletions": 10, "lines": 86}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/TwoPhaseCompactor.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicReaderTest.java", "insertions": 74, "deletions": 1, "lines": 75}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/ReaderTest.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 71, "deletions": 27, "lines": 98}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ZeroQueueConsumerImpl.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/raw/RawMessageImpl.java", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleGetLastMessageId(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetLastMessageId)", "TOT": 19, "UPD": 1, "INS": 1, "MOV": 17, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.getLargestBatchIndexWhenPossible(org.apache.pulsar.broker.service.Topic,org.apache.bookkeeper.mledger.impl.PositionImpl,int,long,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TwoPhaseCompactor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.TwoPhaseCompactor.phaseOne(org.apache.pulsar.client.api.RawReader)", "TOT": 3, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderStartInMiddleOfBatch()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.variationsForHasMessageAvailable()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testHasMessageAvailable(boolean,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ReaderTest.testReadMessageWithBatchingWithMessageInclusive()", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 4, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMoreMessages(org.apache.pulsar.client.api.MessageId,org.apache.pulsar.client.api.MessageId)", "TOT": 13, "UPD": 7, "INS": 0, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.messageProcessed(org.apache.pulsar.client.api.Message)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.internalGetLastMessageIdAsync(org.apache.pulsar.client.impl.Backoff,java.util.concurrent.atomic.AtomicLong,java.util.concurrent.CompletableFuture)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMessageAvailable()", "TOT": 18, "UPD": 5, "INS": 1, "MOV": 10, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMessageAvailableAsync()", "TOT": 22, "UPD": 2, "INS": 8, "MOV": 11, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.clearReceiverQueue()", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMoreMessages(org.apache.pulsar.client.api.MessageId,org.apache.pulsar.client.api.MessageId,boolean)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.seekAsync(org.apache.pulsar.client.api.MessageId)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ZeroQueueConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ZeroQueueConsumerImpl.fetchSingleMessageFromBroker()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "RawMessageImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.raw.RawMessageImpl.getBatchSize()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Bug in netty 4.1.43 prevents from using Linux native Epoll transport", "body": "**Describe the bug**\r\nnetty 4.1.43 has a bug preventing it from using Linux native Epoll transport - https://github.com/netty/netty/issues/9758\r\n\r\nThis results in pulsar brokers failing over to `NioEventLoopGroup` even when running on Linux.\r\n\r\nThe bug seems to be fixed in netty releases 4.1.44+\r\n\r\n**To Reproduce**\r\n1. Run pulsar docker container:\r\n```\r\ndocker run -it apachepulsar/pulsar:latest bin/pulsar standalone\r\n```\r\n2. Observe the logs. Following errors appears on startup\r\n```\r\n23:56:05.428 [main] WARN  org.apache.distributedlog.impl.BKNamespaceDriver - Could not use Netty Epoll event loop for bookie server:\r\njava.lang.NoClassDefFoundError: Could not initialize class io.netty.channel.epoll.EpollEventLoop\r\n        at io.netty.channel.epoll.EpollEventLoopGroup.newChild(EpollEventLoopGroup.java:142) ~[io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.EpollEventLoopGroup.newChild(EpollEventLoopGroup.java:35) ~[io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.util.concurrent.MultithreadEventExecutorGroup.<init>(MultithreadEventExecutorGroup.java:84) ~[io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.util.concurrent.MultithreadEventExecutorGroup.<init>(MultithreadEventExecutorGroup.java:58) ~[io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.util.concurrent.MultithreadEventExecutorGroup.<init>(MultithreadEventExecutorGroup.java:47) ~[io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.MultithreadEventLoopGroup.<init>(MultithreadEventLoopGroup.java:59) ~[io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:104) ~[io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:91) ~[io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:68) ~[io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at org.apache.distributedlog.impl.BKNamespaceDriver.getDefaultEventLoopGroup(BKNamespaceDriver.java:257) ~[org.apache.distributedlog-distributedlog-core-4.10.0.jar:4.10.0]\r\n        at org.apache.distributedlog.impl.BKNamespaceDriver.initializeBookKeeperClients(BKNamespaceDriver.java:268) ~[org.apache.distributedlog-distributedlog-core-4.10.0.jar:4.10.0]\r\n        at org.apache.distributedlog.impl.BKNamespaceDriver.initialize(BKNamespaceDriver.java:206) ~[org.apache.distributedlog-distributedlog-core-4.10.0.jar:4.10.0]\r\n        at org.apache.distributedlog.api.namespace.NamespaceBuilder.build(NamespaceBuilder.java:239) ~[org.apache.distributedlog-distributedlog-core-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.stream.server.service.DLNamespaceProviderService.doStart(DLNamespaceProviderService.java:120) ~[org.apache.bookkeeper-stream-storage-server-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.common.component.AbstractLifecycleComponent.start(AbstractLifecycleComponent.java:83) ~[org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.common.component.LifecycleComponentStack.lambda$start$2(LifecycleComponentStack.java:113) ~[org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n        at com.google.common.collect.ImmutableList.forEach(ImmutableList.java:407) [com.google.guava-guava-25.1-jre.jar:?]\r\n        at org.apache.bookkeeper.common.component.LifecycleComponentStack.start(LifecycleComponentStack.java:113) [org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.stream.server.StreamStorageLifecycleComponent.doStart(StreamStorageLifecycleComponent.java:51) [org.apache.bookkeeper-stream-storage-server-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.common.component.AbstractLifecycleComponent.start(AbstractLifecycleComponent.java:83) [org.apache.bookkeeper-bookkeeper-common-4.10.0.jar:4.10.0]\r\n        at org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.runStreamStorage(LocalBookkeeperEnsemble.java:323) [org.apache.pulsar-pulsar-zookeeper-utils-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.startStandalone(LocalBookkeeperEnsemble.java:405) [org.apache.pulsar-pulsar-zookeeper-utils-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.PulsarStandalone.start(PulsarStandalone.java:260) [org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.PulsarStandaloneStarter.main(PulsarStandaloneStarter.java:119) [org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n```\r\nWith DEBUG logging enabled following error appears as well:\r\n```\r\n22:31:13.747 [main] DEBUG io.netty.util.internal.NativeLibraryLoader - Unable to load the library 'netty_transport_native_epoll_x86_64', trying other loading mechanism.\r\njava.lang.UnsatisfiedLinkError: no netty_transport_native_epoll_x86_64 in java.library.path\r\n        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1860) ~[?:1.8.0_232]\r\n        at java.lang.Runtime.loadLibrary0(Runtime.java:870) ~[?:1.8.0_232]\r\n        at java.lang.System.loadLibrary(System.java:1122) ~[?:1.8.0_232]\r\n        at io.netty.util.internal.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:38) ~[io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_232]\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_232]\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_232]\r\n        at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_232]\r\n        at io.netty.util.internal.NativeLibraryLoader$1.run(NativeLibraryLoader.java:369) ~[io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_232]\r\n        at io.netty.util.internal.NativeLibraryLoader.loadLibraryByHelper(NativeLibraryLoader.java:361) ~[io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.util.internal.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:339) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.util.internal.NativeLibraryLoader.load(NativeLibraryLoader.java:136) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.Native.loadNativeLibrary(Native.java:228) [io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.Native.<clinit>(Native.java:57) [io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.Epoll.<clinit>(Epoll.java:39) [io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.EpollEventLoop.<clinit>(EpollEventLoop.java:52) [io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.EpollEventLoopGroup.newChild(EpollEventLoopGroup.java:142) [io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.EpollEventLoopGroup.newChild(EpollEventLoopGroup.java:35) [io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.util.concurrent.MultithreadEventExecutorGroup.<init>(MultithreadEventExecutorGroup.java:84) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.util.concurrent.MultithreadEventExecutorGroup.<init>(MultithreadEventExecutorGroup.java:58) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.util.concurrent.MultithreadEventExecutorGroup.<init>(MultithreadEventExecutorGroup.java:47) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.MultithreadEventLoopGroup.<init>(MultithreadEventLoopGroup.java:59) [io.netty-netty-transport-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:104) [io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:91) [io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:68) [io.netty-netty-transport-native-epoll-4.1.43.Final.jar:4.1.43.Final]\r\n        at org.apache.bookkeeper.util.EventLoopUtil.getEventLoopGroup(EventLoopUtil.java:59) [org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.util.EventLoopUtil.getClientEventLoopGroup(EventLoopUtil.java:43) [org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.client.BookKeeper.<init>(BookKeeper.java:458) [org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at org.apache.bookkeeper.client.BookKeeper$Builder.build(BookKeeper.java:296) [org.apache.bookkeeper-bookkeeper-server-4.10.0.jar:4.10.0]\r\n        at org.apache.pulsar.broker.BookKeeperClientFactoryImpl.create(BookKeeperClientFactoryImpl.java:70) [org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.ManagedLedgerClientFactory.<init>(ManagedLedgerClientFactory.java:61) [org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.broker.PulsarService.start(PulsarService.java:394) [org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.PulsarBrokerStarter$BrokerStarter.start(PulsarBrokerStarter.java:264) [org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n        at org.apache.pulsar.PulsarBrokerStarter.main(PulsarBrokerStarter.java:329) [org.apache.pulsar-pulsar-broker-2.5.0.jar:2.5.0]\r\n```\r\n\r\n**Expected behavior**\r\nNetty `EpollEventLoopGroup` is initialized correctly.\r\n", "url": "https://github.com/apache/pulsar/issues/6330", "user": "dzmitryk", "labels": ["release/2.5.1", "triage/week-8", "type/bug"], "created": "2020-02-15 00:11:23", "closed": "2020-02-27 06:43:58", "commits": {}, "ttf": 12.000277777777777, "commitsDetails": []}, {"title": "Pulsar io connector is not run at broker. ", "body": "**Describe the bug**\r\nPulsar io connector is not run at broker.  Status gotted by api says it running. But there is no functions log at /pulsar/logs/ folder. and there is no function effect .\r\nAll connector can run at local mode.\r\n\r\n**To Reproduce**\r\ncreate any connector . I have tried source and sink, buildin and custom.\r\n\r\n**Expected behavior**\r\nConnector runs normally.\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/2681638/74445791-ebc5ad00-4eb1-11ea-825d-bf696c0822d9.png)\r\n![image](https://user-images.githubusercontent.com/2681638/74445856-03049a80-4eb2-11ea-845e-a9f008f67246.png)\r\n![image](https://user-images.githubusercontent.com/2681638/74446238-8f16c200-4eb2-11ea-8884-892d92d5c026.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS:  k8s  apachepulsar/pulsar-all:2.5.0\r\n\r\n**Additional context**\r\n", "url": "https://github.com/apache/pulsar/issues/6323", "user": "xiemeilong", "labels": ["triage/week-8", "type/bug"], "created": "2020-02-13 14:46:00", "closed": "2020-02-29 04:02:07", "commits": {}, "ttf": 15.000277777777777, "commitsDetails": []}, {"title": "[pulsar client] partitioned topic cause connection leak when connection pool disable pooling", "body": "**Describe the bug**\r\nwhen use partitioned topic, the connection from client to discovery service will grow up and keep alive util application shut down.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. we used pulsar-perf, command is: ./bin/pulsar-perf consume -n 6 -c 0 -u pulsar://x.x.x.x:6660,x.x.x.x:6660 -s sub-1 -st Failover tenantTest/namespaceTest/partitiontopic2\r\n2. then netstat -anp | grep 6660 | wc -l, the connection number will increasing slowly\r\n\r\n**Expected behavior**\r\nif we disable pooling, the connection should close when we done our lookup.\r\n\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/5679413/74398752-9fe41b00-4e53-11ea-9dba-74ded0371c22.png)\r\n\r\n**Additional context**\r\nthere is a timer in partition topic client will autoUpdatePartitions, every getPartitionsForTopic will create a new connection and won't close it\r\n", "url": "https://github.com/apache/pulsar/issues/6319", "user": "ltamber", "labels": ["triage/week-7", "type/bug"], "created": "2020-02-13 03:31:54", "closed": "2020-06-11 02:58:48", "commits": {}, "ttf": 118.00027777777778, "commitsDetails": []}, {"title": "Kafka sink property `ack` should be `acks`", "body": "The 2.5.0 docs at https://pulsar.apache.org/docs/en/io-kafka-sink/ currently states that the `ack` property controls the setting for Kafka acknowledgements, but this property is actually named `acks`, per https://github.com/apache/pulsar/blob/master/pulsar-io/kafka/src/main/java/org/apache/pulsar/io/kafka/KafkaSinkConfig.java#L52\r\n\r\nI can take this simple issue as a first contribution :)", "url": "https://github.com/apache/pulsar/issues/6312", "user": "jrpilat", "labels": ["type/bug"], "created": "2020-02-12 18:58:41", "closed": "2020-02-12 20:13:38", "commits": {"73986aa1bdd9d4f98be8cc4fb148927a8b4dc0a7": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "73986aa1bdd9d4f98be8cc4fb148927a8b4dc0a7", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["22d782463e8893187a7987d26965dbb4cd0be2a5"], "nameRev": "73986aa1bdd9d4f98be8cc4fb148927a8b4dc0a7 tags/v2.6.0-candidate-1~506", "commitMessage": "Fix typo: replace property `ack` with `acks` in docs for the Kafka sink (#6316)\n\nFixes #6312 \r\n\r\n### Motivation\r\nThe docs for the Kafka sink have a typo in one of the property names: `ack` should be `acks`\r\n\r\n### Modifications\r\n- Fixed the above typo in the unversioned docs\r\n- Fixed the above typo in the versioned docs\r\n\r\n### Verifying this change\r\nThis change is a trivial rework / code cleanup without any test coverage.", "commitDateTime": "2020-02-12 12:13:37", "authoredDateTime": "2020-02-12 14:13:37", "commitGitStats": [{"filePath": "site2/docs/io-kafka-sink.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.5.0/io-kafka-sink.md", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Attempting to use token authentication in pulsar standalone causes it to exit", "body": "**Describe the bug**\r\nI am trying to run pulsar standalone using token-based authentication.  But when I add the line\r\n>authenticationProviders=org.apache.pulsar.broker.authentication.AuthenticationProviderToken\r\nto conf/standalone.conf, running `bin/pulsar standalone` causes it to exit almost immediately.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. In conf/standalone.conf, add the lines\r\n>authenticationEnabled=true\r\n>authorizationEnabled=true\r\n>authenticationProviders=org.apache.pulsar.broker.authentication.AuthenticationProviderToken\r\n>tokenSecretKey=file:///path/to/secret.key\r\n(as directed by https://pulsar.apache.org/docs/en/security-jwt/)\r\n2. Run `bin/pulsar standalone`.\r\n\r\n**Expected behavior**\r\nI expected pulsar to start in standalone mode.  Instead, it exited, and the log file contains errors such as\r\n>[main] ERROR org.apache.pulsar.functions.worker.WorkerService - Error Starting up in worker\r\n>org.apache.pulsar.client.admin.PulsarAdminException$NotAuthorizedException : HTTP 401 Unauthorized\r\nand \r\n>java.lang.NoClassDefFoundError: Could not initialize class io.netty.channel.epoll.EpollEventLoop\r\n\r\n**Desktop (please complete the following information):**\r\nUbuntu 18.04\r\n\r\n**Additional context**\r\nI have attached a log file (from running `bin/pulsar-daemon start standalone` instead):\r\n[pulsar-standalone-gideon.log](https://github.com/apache/pulsar/files/4192750/pulsar-standalone-gideon.log)", "url": "https://github.com/apache/pulsar/issues/6309", "user": "rmbellovin", "labels": ["triage/week-7", "type/bug"], "created": "2020-02-12 14:16:10", "closed": "2020-04-14 08:59:34", "commits": {}, "ttf": 61.000277777777775, "commitsDetails": []}, {"title": "pulsar running in standalone mode in docker does not respond to pulsar-admin", "body": "I downloaded and unzipped the 2.5.0 binary, and started it in standalone mode in docker with the command\r\n`docker run -it -p 6650:6650 -p 8080:8080 --mount source=pulsardata,target=/pulsar/data --mount source=pulsarconf,target=/pulsar/conf apachepulsar/pulsar:2.5.0 bin/pulsar standalone`\r\n\r\nHowever, when I then try to run a `pulsar-admin` command, it prints\r\n>null\r\n>\r\n>Reason: javax.ws.rs.ProcessingException: Remotely closed\r\n\r\n**To Reproduce**\r\n1. Download and unzip the apache-pulsar-2.5.0 binary.\r\n2. Start pulsar in standalone mode in docker\r\n3. Run `bin/pulsar-admin tenants list`\r\n\r\n**Expected behavior**\r\nI expected it to print\r\n>\"public\"\r\n>\"sample\"\r\n\r\n**Desktop (please complete the following information):**\r\nUbuntu 18.04", "url": "https://github.com/apache/pulsar/issues/6307", "user": "rmbellovin", "labels": ["triage/week-7", "type/bug"], "created": "2020-02-12 11:25:08", "closed": "2020-04-29 07:42:27", "commits": {}, "ttf": 76.00027777777778, "commitsDetails": []}, {"title": "[Proxy]If zk leader was down, proxy was not worked until restart it", "body": "**Describe the bug**\r\nMy pulsar is running on k8s and our service is using pulsar proxy, I have did some failure testing.\r\nWhen I force crash the node which serve the zk leader, all my pulsar broker crash several times because zk connection problem, they were started final, but I must restart pulsar proxy after brokers were availabled, mentioned by #6158 . \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Deploy pulsar on k8s\r\n2. use pulsar-perf tool to connect pulsar proxy and continuous pub/sub on a topic\r\n3. \"force\" crash a k8s node which has zk leader\r\n4. The reconnect mechanism doesn't work until restart pulsar proxys.\r\n\r\n**Expected behavior**\r\nProxy can recover without restart.\r\nOr broker keep available without restart.\r\n\r\n**Screenshots**\r\nBroker error log\r\n```\r\n04:55:22.078 [main] ERROR org.apache.pulsar.zookeeper.GlobalZooKeeperCache - Failed to establish global zookeeper session: null\r\njava.util.concurrent.TimeoutException: null\r\n\tat java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1784) ~[?:1.8.0_232]\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1928) ~[?:1.8.0_232]\r\n\tat org.apache.pulsar.zookeeper.GlobalZooKeeperCache.start(GlobalZooKeeperCache.java:69) [org.apache.pulsar-pulsar-zookeeper-utils-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.broker.PulsarService.startZkCacheService(PulsarService.java:572) [org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:366) [org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.PulsarBrokerStarter$BrokerStarter.start(PulsarBrokerStarter.java:273) [org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.PulsarBrokerStarter.main(PulsarBrokerStarter.java:332) [org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n04:55:22.082 [main] ERROR org.apache.pulsar.broker.PulsarService - java.io.IOException: java.util.concurrent.TimeoutException\r\norg.apache.pulsar.broker.PulsarServerException: java.io.IOException: java.util.concurrent.TimeoutException\r\n\tat org.apache.pulsar.broker.PulsarService.startZkCacheService(PulsarService.java:574) ~[org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:366) [org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.PulsarBrokerStarter$BrokerStarter.start(PulsarBrokerStarter.java:273) [org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.PulsarBrokerStarter.main(PulsarBrokerStarter.java:332) [org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\nCaused by: java.io.IOException: java.util.concurrent.TimeoutException\r\n\tat org.apache.pulsar.zookeeper.GlobalZooKeeperCache.start(GlobalZooKeeperCache.java:76) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.broker.PulsarService.startZkCacheService(PulsarService.java:572) ~[org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\t... 3 more\r\nCaused by: java.util.concurrent.TimeoutException\r\n\tat java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1784) ~[?:1.8.0_232]\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1928) ~[?:1.8.0_232]\r\n\tat org.apache.pulsar.zookeeper.GlobalZooKeeperCache.start(GlobalZooKeeperCache.java:69) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.broker.PulsarService.startZkCacheService(PulsarService.java:572) ~[org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\t... 3 more\r\n04:55:22.083 [main] ERROR org.apache.pulsar.PulsarBrokerStarter - Failed to start pulsar service.\r\norg.apache.pulsar.broker.PulsarServerException: org.apache.pulsar.broker.PulsarServerException: java.io.IOException: java.util.concurrent.TimeoutException\r\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:472) ~[org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.PulsarBrokerStarter$BrokerStarter.start(PulsarBrokerStarter.java:273) ~[org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.PulsarBrokerStarter.main(PulsarBrokerStarter.java:332) [org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\nCaused by: org.apache.pulsar.broker.PulsarServerException: java.io.IOException: java.util.concurrent.TimeoutException\r\n\tat org.apache.pulsar.broker.PulsarService.startZkCacheService(PulsarService.java:574) ~[org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:366) ~[org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\t... 2 more\r\nCaused by: java.io.IOException: java.util.concurrent.TimeoutException\r\n\tat org.apache.pulsar.zookeeper.GlobalZooKeeperCache.start(GlobalZooKeeperCache.java:76) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.broker.PulsarService.startZkCacheService(PulsarService.java:572) ~[org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:366) ~[org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\t... 2 more\r\nCaused by: java.util.concurrent.TimeoutException\r\n\tat java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1784) ~[?:1.8.0_232]\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1928) ~[?:1.8.0_232]\r\n\tat org.apache.pulsar.zookeeper.GlobalZooKeeperCache.start(GlobalZooKeeperCache.java:69) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.broker.PulsarService.startZkCacheService(PulsarService.java:572) ~[org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:366) ~[org.apache.pulsar-pulsar-broker-2.4.2.jar:2.4.2]\r\n\t... 2 more\r\n04:55:22.084 [pulsar-ordered-OrderedExecutor-3-0-SendThread(zookeeper:2181)] WARN  org.apache.zookeeper.ClientCnxn - Client session timed out, have not heard from server in 30005ms for sessionid 0x0\r\n```\r\n\r\nzk-2.log (new leader)\r\n```\r\n04:51:47.727 [QuorumPeer[myid=3]/0.0.0.0:2181] INFO  org.apache.zookeeper.server.quorum.QuorumPeer - LEADING\r\n04:51:47.727 [QuorumPeer[myid=3]/0.0.0.0:2181] INFO  org.apache.zookeeper.server.ZooKeeperServer - Created server with tickTime 2000 minSessionTimeout 4000 maxSessionTimeout 40000 datadir data/zookeeper/version-2 snapdir data/zookeeper/version-2\r\n04:51:47.727 [QuorumPeer[myid=3]/0.0.0.0:2181] INFO  org.apache.zookeeper.server.quorum.Leader - LEADING - LEADER ELECTION TOOK - 10421\r\n04:51:47.734 [LearnerHandler-/10.30.2.141:43982] INFO  org.apache.zookeeper.server.quorum.LearnerHandler - Follower sid: 1 : info : org.apache.zookeeper.server.quorum.QuorumPeer$QuorumServer@6fe50a68\r\n```\r\n\r\nperf-tool output\r\n```\r\n06:14:00.049 [pulsar-timer-5-1] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [persistent://public/default/topic-perf] [cn-beijing-105-1] Reconnecting after connection was closed\r\n06:14:00.111 [pulsar-client-io-2-2] INFO  org.apache.pulsar.client.impl.ConnectionPool - [[id: 0xfa71e541, L:/172.17.0.2:47758 - R:/172.16.11.200:6650]] Connected to server\r\n06:14:00.114 [main] INFO  org.apache.pulsar.testclient.PerformanceProducer - Throughput produced:      0.0  msg/s ---      0.0 Mbit/s --- failure      0.0 msg/s --- Latency: mean:   0.000 ms - med:   0.000 - 95pct:   0.000 - 99pct:   0.000 - 99.9pct:   0.000 - 99.99pct:   0.000 - Max:   0.000\r\n06:14:00.345 [pulsar-client-io-2-2] ERROR org.apache.pulsar.client.impl.ClientCnx - [id: 0xfa71e541, L:/172.17.0.2:47758 - R:/172.16.11.200:6650] Close connection because received internal-server error No active broker is available\r\n06:14:00.346 [pulsar-client-io-2-2] WARN  org.apache.pulsar.client.impl.BinaryProtoLookupService - [persistent://public/default/topic-perf] failed to send lookup request : org.apache.pulsar.client.api.PulsarClientException$LookupException: No active broker is available\r\n06:14:00.347 [pulsar-client-io-2-2] WARN  org.apache.pulsar.client.impl.ConnectionHandler - [persistent://public/default/topic-perf] [cn-beijing-105-1] Error connecting to broker: org.apache.pulsar.client.api.PulsarClientException$LookupException: No active broker is available\r\n06:14:00.348 [pulsar-client-io-2-2] WARN  org.apache.pulsar.client.impl.ConnectionHandler - [persistent://public/default/topic-perf] [cn-beijing-105-1] Could not get connection to broker: org.apache.pulsar.client.api.PulsarClientException$LookupException: No active broker is available -- Will try again in 57.763 s\r\n06:14:00.348 [pulsar-client-io-2-2] INFO  org.apache.pulsar.client.impl.ClientCnx - [id: 0xfa71e541, L:/172.17.0.2:47758 ! R:/172.16.11.200:6650] Disconnected\r\n```", "url": "https://github.com/apache/pulsar/issues/6305", "user": "snowcrumble", "labels": ["triage/week-7", "type/bug"], "created": "2020-02-12 07:08:32", "closed": "2020-02-17 10:53:11", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "The script apply-config-from-env.py doesn't modify existent settings", "body": "**Describe the bug**\r\nThe script *apply-config-from-env.py* should update the settings in the configuration files base on the environment variables with prefix *PULSAR_PREFIX_*. The script should modify the files by adding a line at the end of them if the setting is not already present or by overriding the line with the setting if it is already in the file.\r\n\r\n**To Reproduce**\r\n\r\nFollow the steps detailed here [here](http://pulsar.apache.org/docs/en/deploy-kubernetes/)\r\n\r\n**Expected behavior**\r\n\r\nThe K8 cluster should be configured with _zkServers=zookeeper_ instead of the default value _zkServers=localhost:2181_.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu\r\n - Minikube\r\n - K8 1.14.1\r\n", "url": "https://github.com/apache/pulsar/issues/6292", "user": "andresgaragiola", "labels": ["type/bug"], "created": "2020-02-11 11:56:42", "closed": "2020-02-11 23:19:08", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Hanging ManagedLedgerBkTest.setUp", "body": "When I try to run any of the ManagedLedgerBkTest instances locally, the tests are hanging on the setUp method. \r\nThe log messages are stuck in a loop with messages like this:\r\n\r\n> 17:32:25.009 [LedgerDirsMonitorThread:org.apache.bookkeeper.util.DiskChecker@156] ERROR org.apache.bookkeeper.util.DiskChecker - Space left on device /var/folders/zg/mg9pbwns01d3hnc5p2y0hxnr0000gp/T/bookie3504632864196205720test/current : 8410619904, Used space fraction: 0.9664495 > threshold 0.95.\r\n> 17:32:35.008 [LedgerDirsMonitorThread:org.apache.bookkeeper.bookie.LedgerDirsMonitor@110] WARN  org.apache.bookkeeper.bookie.LedgerDirsMonitor - LedgerDirsMonitor check process: All ledger directories are non writable\r\n> 17:32:35.009 [LedgerDirsMonitorThread:org.apache.bookkeeper.util.DiskChecker@156] ERROR org.apache.bookkeeper.util.DiskChecker - Space left on device /var/folders/zg/mg9pbwns01d3hnc5p2y0hxnr0000gp/T/bookie3504632864196205720test/current : 8410492928, Used space fraction: 0.96645004 > threshold 0.95.\r\n> 17:32:45.007 [LedgerDirsMonitorThread:org.apache.bookkeeper.bookie.LedgerDirsMonitor@110] WARN  org.apache.bookkeeper.bookie.LedgerDirsMonitor - LedgerDirsMonitor check process: All ledger directories are non writable\r\n> 17:32:45.008 [LedgerDirsMonitorThread:org.apache.bookkeeper.util.DiskChecker@156] ERROR org.apache.bookkeeper.util.DiskChecker - Space left on device /var/folders/zg/mg9pbwns01d3hnc5p2y0hxnr0000gp/T/bookie3504632864196205720test/current : 8432586752, Used space fraction: 0.9663619 > threshold 0.95.\r\n> \r\n> Process finished with exit code 130 (interrupted by signal 2: SIGINT)\r\n\r\n\r\nIf there's a disk space issue (which seems odd because I have 9 GB free), we need a condition to check for that and throw an exception instead of loop infinitely.\r\n\r\nI've attached a more complete log here:\r\n[test_log2.txt](https://github.com/apache/pulsar/files/4183692/test_log2.txt)\r\n(It ends when I killed the test.)", "url": "https://github.com/apache/pulsar/issues/6288", "user": "devinbost", "labels": ["triage/week-7", "type/bug"], "created": "2020-02-11 00:35:26", "closed": "2020-03-26 02:00:15", "commits": {}, "ttf": 44.000277777777775, "commitsDetails": []}, {"title": "[Flaky test]Integration Pulsar SQL test failed", "body": "**Describe the bug**\r\n\r\nExecute command `show schemas pulsar;`\r\n\r\n```\r\norg.glassfish.jersey.inject.hk2.Hk2InjectionManagerFactory to org.glassfish.jersey.internal.inject.InjectionManagerFactory\r\n15:25:52.735 [tc-okhttp-stream-708057752:org.apache.pulsar.tests.integration.utils.DockerUtils$2@221] INFO  org.apache.pulsar.tests.integration.utils.DockerUtils - DOCKER.exec(TestBasicPresto-fvuvk-presto-worker:/bin/bash -c /pulsar/bin/pulsar sql --execute 'show schemas in pulsar;'): STDERR: \r\n15:25:52.735 [tc-okhttp-stream-708057752:org.apache.pulsar.tests.integration.utils.DockerUtils$2@221] INFO  org.apache.pulsar.tests.integration.utils.DockerUtils - DOCKER.exec(TestBasicPresto-fvuvk-presto-worker:/bin/bash -c /pulsar/bin/pulsar sql --execute 'show schemas in pulsar;'): STDERR: \r\n15:25:52.784 [tc-okhttp-stream-708057752:org.apache.pulsar.tests.integration.utils.DockerUtils$2@236] INFO  org.apache.pulsar.tests.integration.utils.DockerUtils - DOCKER.exec(TestBasicPresto-fvuvk-presto-worker:/bin/bash -c /pulsar/bin/pulsar sql --execute 'show schemas in pulsar;'): Done\r\n15:25:52.786 [tc-okhttp-stream-708057752:org.apache.pulsar.tests.integration.utils.DockerUtils$2@254] INFO  org.apache.pulsar.tests.integration.utils.DockerUtils - DOCKER.exec(TestBasicPresto-fvuvk-presto-worker:/bin/bash -c /pulsar/bin/pulsar sql --execute 'show schemas in pulsar;'): completed with 1\r\n15:25:52.786 [tc-okhttp-stream-708057752:org.apache.pulsar.tests.integration.utils.DockerUtils$2@257] ERROR org.apache.pulsar.tests.integration.utils.DockerUtils - DOCKER.exec(TestBasicPresto-fvuvk-presto-worker:/bin/bash -c /pulsar/bin/pulsar sql --execute 'show schemas in pulsar;'): completed with non zero return code: 1\r\nstdout: \r\nstderr: Query 20200208_152552_00008_u94b7 failed: Failed to get schemas from pulsar: Cannot cast org.glassfish.jersey.inject.hk2.Hk2InjectionManagerFactory to org.glassfish.jersey.internal.inject.InjectionManagerFactory\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n```\r\nmvn -B -f tests/docker-images/pom.xml install -am -Pdocker -DskipTests\r\nmvn -B -f tests/pom.xml test -DintegrationTestSuiteFile=pulsar-sql.xml -DintegrationTests -DredirectTestOutputToFile=false\r\n```\r\n\r\nor\r\n\r\n```\r\ndocker pull apachepulsar/pulsar:2.5.0\r\ndocker run -d -it -v $PWD/data:/pulsar/data --name pulsar-standalone apachepulsar/pulsar:2.5.0 bin/pulsar standalone\r\ndocker exec -it pulsar-standalone /bin/bash\r\n./bin/puslar sql-worker run\r\n\r\ndocker exec -it pulsar-standalone /bin/bash\r\n\r\nroot@03d5def01027:/pulsar# ./bin/pulsar sql\r\nWARNING: History file is not readable/writable: /root/.presto_history. History will not be available during this session.\r\npresto> show schemas in pulsar;\r\nQuery 20200209_025519_00000_gjvmd failed: Failed to get schemas from pulsar: Cannot cast org.glassfish.jersey.inject.hk2.Hk2InjectionManagerFactory to org.glassfish.jersey.internal.inject.InjectionManagerFactory\r\n\r\npresto>\r\n```\r\n\r\n**Expected behavior**\r\nSQL test pass\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6274", "user": "tuteng", "labels": ["type/bug"], "created": "2020-02-08 15:30:26", "closed": "2020-02-09 23:01:00", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Deduplication fails when the batch message contains duplicate message and valid message", "body": "**Describe the bug**\r\nThis bug was discussed in the slack channel https://apache-pulsar.slack.com/archives/C5ZSVEN4E/p1581119933163000.  The problem occurs when a batch messages contain both duplicate data and valid data. If sequence ID for a message is lower than the broker maintained the highest sequence ID, the batch message which contains this message also considered a duplicate. So that will lead to valid messages can't be stored success and consumers can't get these messages.\r\n", "url": "https://github.com/apache/pulsar/issues/6273", "user": "codelipenghui", "labels": ["release/2.5.1", "triage/week-7", "type/bug"], "created": "2020-02-08 07:35:33", "closed": "2020-02-14 08:05:59", "commits": {"b898f49a9ebd6d1fdc602201987c182ba6ad8d2b": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "3790518668604caa0914cb8be776c1e6d17c881c": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "0f140e293184fc1902259a16861805301015f248": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "b898f49a9ebd6d1fdc602201987c182ba6ad8d2b", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["2e1c74aa78e58c5788ae117dede594e6387949e3"], "nameRev": "b898f49a9ebd6d1fdc602201987c182ba6ad8d2b tags/v2.6.0-candidate-1~492", "commitMessage": "Should flush the last potential duplicated since can't combine potential duplicated messages and non-duplicated messages into a batch. (#6326)\n\nFixes #6273\r\n\r\nMotivation\r\nThe main reason for #6273 is combining potential duplicated messages and non-duplicated messages into a batch. So need to flush the potential duplicated message first and then add the non-duplicated messages to a batch.", "commitDateTime": "2020-02-14 16:05:58", "authoredDateTime": "2020-02-14 16:05:58", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/ClientDeduplicationTest.java", "insertions": 7, "deletions": 5, "lines": 12}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageContainerImpl.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 16, "deletions": 8, "lines": 24}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ClientDeduplicationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.ClientDeduplicationTest.testProducerDeduplicationWithDiscontinuousSequenceId()", "TOT": 7, "UPD": 4, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "BatchMessageContainerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.add(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.client.impl.SendCallback)", "TOT": 5, "UPD": 0, "INS": 3, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.sendAsync(org.apache.pulsar.client.api.Message,org.apache.pulsar.client.impl.SendCallback)", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "3790518668604caa0914cb8be776c1e6d17c881c", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["afe1aa3cbd27672298b21d6bebe6e7233f638bf2"], "nameRev": "3790518668604caa0914cb8be776c1e6d17c881c tags/v2.5.1-candidate-1~58", "commitMessage": "Should flush the last potential duplicated since can't combine potential duplicated messages and non-duplicated messages into a batch. (#6326)\n\nFixes #6273\r\n\r\nMotivation\r\nThe main reason for #6273 is combining potential duplicated messages and non-duplicated messages into a batch. So need to flush the potential duplicated message first and then add the non-duplicated messages to a batch.\n\n(cherry picked from commit b898f49a9ebd6d1fdc602201987c182ba6ad8d2b)\n", "commitDateTime": "2020-04-05 10:50:36", "authoredDateTime": "2020-02-14 16:05:58", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/ClientDeduplicationTest.java", "insertions": 7, "deletions": 5, "lines": 12}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageContainerImpl.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 16, "deletions": 8, "lines": 24}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ClientDeduplicationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.ClientDeduplicationTest.testProducerDeduplicationWithDiscontinuousSequenceId()", "TOT": 7, "UPD": 4, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "BatchMessageContainerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.add(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.client.impl.SendCallback)", "TOT": 5, "UPD": 0, "INS": 3, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.sendAsync(org.apache.pulsar.client.api.Message,org.apache.pulsar.client.impl.SendCallback)", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "0f140e293184fc1902259a16861805301015f248", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["432135ef959f920487b91d0a0f626c23a4022913"], "nameRev": "0f140e293184fc1902259a16861805301015f248 tags/v2.5.1-candidate-3~70", "commitMessage": "Should flush the last potential duplicated since can't combine potential duplicated messages and non-duplicated messages into a batch. (#6326)\n\nFixes #6273\r\n\r\nMotivation\r\nThe main reason for #6273 is combining potential duplicated messages and non-duplicated messages into a batch. So need to flush the potential duplicated message first and then add the non-duplicated messages to a batch.\n\n(cherry picked from commit b898f49a9ebd6d1fdc602201987c182ba6ad8d2b)\n", "commitDateTime": "2020-04-13 11:11:32", "authoredDateTime": "2020-02-14 16:05:58", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/ClientDeduplicationTest.java", "insertions": 7, "deletions": 5, "lines": 12}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageContainerImpl.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 16, "deletions": 8, "lines": 24}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ClientDeduplicationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.ClientDeduplicationTest.testProducerDeduplicationWithDiscontinuousSequenceId()", "TOT": 7, "UPD": 4, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "BatchMessageContainerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.add(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.client.impl.SendCallback)", "TOT": 5, "UPD": 0, "INS": 3, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.sendAsync(org.apache.pulsar.client.api.Message,org.apache.pulsar.client.impl.SendCallback)", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "(Flaky-test) - no space left on device: Could not build image", "body": "When running the `CI - Integration - Sql` Github CI Action, this error appeared:\r\n```\r\n[ERROR] Error processing tar file(exit status 1): write /pulsar/offloaders/tiered-storage-jcloud-2.6.0-SNAPSHOT.nar: no space left on device\r\n[ERROR] Error processing tar file(exit status 1): write /pulsar/offloaders/tiered-storage-jcloud-2.6.0-SNAPSHOT.nar: no space left on device\r\n[ERROR] Failed to execute goal com.spotify:dockerfile-maven-plugin:1.4.13:build (default) on project pulsar-standalone-docker-image: Could not build image: Error processing tar file(exit status 1): write /pulsar/offloaders/tiered-storage-jcloud-2.6.0-SNAPSHOT.nar: no space left on device -> [Help 1]\r\n```\r\n\r\nThe issue appeared here: https://github.com/apache/pulsar/pull/6202/checks?check_run_id=432618226\r\n\r\nLogs are attached.\r\n[logs_14608.zip](https://github.com/apache/pulsar/files/4173390/logs_14608.zip)\r\n", "url": "https://github.com/apache/pulsar/issues/6268", "user": "devinbost", "labels": ["type/bug"], "created": "2020-02-07 23:46:07", "closed": "2020-02-11 00:25:00", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "(Flaky-test) Failure to build postgres image during tests", "body": "```\r\n[ERROR] The command '/bin/sh -c /pulsar/django/init-postgres.sh' returned a non-zero code: 1\r\n[ERROR] The command '/bin/sh -c /pulsar/django/init-postgres.sh' returned a non-zero code: 1\r\n[ERROR] Failed to execute goal com.spotify:dockerfile-maven-plugin:1.4.13:build (default) on project pulsar-standalone-docker-image: Could not build image: The command '/bin/sh -c /pulsar/django/init-postgres.sh' returned a non-zero code: 1 -> [Help 1]\r\n[ERROR] \r\n```\r\n\r\nIt's showing up here: https://github.com/apache/pulsar/pull/6202/checks?check_run_id=432265311\r\n\r\n[logs_14410.zip](https://github.com/apache/pulsar/files/4172256/logs_14410.zip)\r\n", "url": "https://github.com/apache/pulsar/issues/6266", "user": "devinbost", "labels": ["type/bug"], "created": "2020-02-07 18:02:18", "closed": "2020-02-10 02:19:00", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Pulsar-client 2.5.0 throws UnsatisfiedLinkError when snappy is used for compression\u00a5", "body": "**Describe the bug**\r\nUnsatisfiedLinkError is thrown when snappy compression is used.\r\n\r\nThe actual error:\r\n```\r\njava.lang.UnsatisfiedLinkError:\r\norg.apache.pulsar.shade.org.xerial.snappy.SnappyNative.maxCompressedLength(I)I\r\n```\r\n\r\nThe error won't happen if compression is not used or other compression like LZ4 is used.\r\nAlso, the error won't happen if `pulsar-perf` that comes with the binary is used with SNAPPY specified.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a producer with pulsar-client 2.5.0\r\n```\r\nProducer<byte[]> producer = client.newProducer().compressionType(CompressionType.SNAPPY).topic(topic).create();\r\n```\r\n\r\n**Expected behavior**\r\nJust work with errors.\r\n\r\n**Screenshots**\r\nNone.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Mac OSX\r\n\r\n**Additional context**\r\nMy guess:\r\nThe binary has `org.xerial.snappy-snappy-java-1.1.1.3.jar` which has snappy `.so` files, but if I use pulsar-client those `.so` files are not installed, so it is producing such errors ?", "url": "https://github.com/apache/pulsar/issues/6260", "user": "feeblefakie", "labels": ["triage/week-7", "type/bug"], "created": "2020-02-07 08:32:04", "closed": "2020-02-21 06:20:15", "commits": {"3197dcdb223d4ea8a2bc42bede63cb910eaceadf": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "d2a20dda4e4367498f191a0d6a458fe02da7e6f7": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "29a05c0f058e31325c2d660813572e5b9538df2c": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 13.000277777777777, "commitsDetails": [{"commitHash": "3197dcdb223d4ea8a2bc42bede63cb910eaceadf", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["5177bfd3eba33534af6eb697909be9196b9ab247"], "nameRev": "3197dcdb223d4ea8a2bc42bede63cb910eaceadf tags/v2.6.0-candidate-1~476", "commitMessage": "[Pulsar-Client] Stop shade snappy-java in pulsar-client-shaded (#6375)\n\nFixes #6260 \r\n\r\nSnappy, like other compressions (LZ4, ZSTD), depends on native libraries to do the real encode/decode stuff. When we shade them in a fat jar, only the java implementations of snappy class are shaded, however, left the JNI incompatible with the underlying c++ code.\r\n\r\nWe should just remove the shade for snappy, and let maven import its lib as a dependency.\r\n\r\nI've tested the shaded jar locally generated by this pr, it works for all compression codecs.", "commitDateTime": "2020-02-20 22:20:14", "authoredDateTime": "2020-02-21 14:20:14", "commitGitStats": [{"filePath": "pulsar-broker-shaded/pom.xml", "insertions": 0, "deletions": 5, "lines": 5}, {"filePath": "pulsar-client-all/pom.xml", "insertions": 0, "deletions": 5, "lines": 5}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka-shaded/pom.xml", "insertions": 6, "deletions": 13, "lines": 19}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka-shaded_0_8/pom.xml", "insertions": 8, "deletions": 15, "lines": 23}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka-shaded_0_9/pom.xml", "insertions": 9, "deletions": 16, "lines": 25}, {"filePath": "pulsar-client-shaded/pom.xml", "insertions": 0, "deletions": 5, "lines": 5}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "d2a20dda4e4367498f191a0d6a458fe02da7e6f7", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["151b7623a1c9423acd561840a65a669959e8c027"], "nameRev": "d2a20dda4e4367498f191a0d6a458fe02da7e6f7 tags/v2.5.1-candidate-1~44", "commitMessage": "[Pulsar-Client] Stop shade snappy-java in pulsar-client-shaded (#6375)\n\nFixes #6260 \r\n\r\nSnappy, like other compressions (LZ4, ZSTD), depends on native libraries to do the real encode/decode stuff. When we shade them in a fat jar, only the java implementations of snappy class are shaded, however, left the JNI incompatible with the underlying c++ code.\r\n\r\nWe should just remove the shade for snappy, and let maven import its lib as a dependency.\r\n\r\nI've tested the shaded jar locally generated by this pr, it works for all compression codecs.\n\n(cherry picked from commit 3197dcdb223d4ea8a2bc42bede63cb910eaceadf)\n", "commitDateTime": "2020-04-05 10:51:52", "authoredDateTime": "2020-02-21 14:20:14", "commitGitStats": [{"filePath": "pulsar-broker-shaded/pom.xml", "insertions": 0, "deletions": 5, "lines": 5}, {"filePath": "pulsar-client-all/pom.xml", "insertions": 0, "deletions": 5, "lines": 5}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka-shaded/pom.xml", "insertions": 6, "deletions": 13, "lines": 19}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka-shaded_0_8/pom.xml", "insertions": 8, "deletions": 15, "lines": 23}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka-shaded_0_9/pom.xml", "insertions": 9, "deletions": 16, "lines": 25}, {"filePath": "pulsar-client-shaded/pom.xml", "insertions": 0, "deletions": 5, "lines": 5}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "29a05c0f058e31325c2d660813572e5b9538df2c", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["1ae7bd0501c39f175e49ebe9b3c0c75dfa728804"], "nameRev": "29a05c0f058e31325c2d660813572e5b9538df2c tags/v2.5.1-candidate-3~55", "commitMessage": "[Pulsar-Client] Stop shade snappy-java in pulsar-client-shaded (#6375)\n\nFixes #6260 \r\n\r\nSnappy, like other compressions (LZ4, ZSTD), depends on native libraries to do the real encode/decode stuff. When we shade them in a fat jar, only the java implementations of snappy class are shaded, however, left the JNI incompatible with the underlying c++ code.\r\n\r\nWe should just remove the shade for snappy, and let maven import its lib as a dependency.\r\n\r\nI've tested the shaded jar locally generated by this pr, it works for all compression codecs.\n\n(cherry picked from commit 3197dcdb223d4ea8a2bc42bede63cb910eaceadf)\n", "commitDateTime": "2020-04-13 11:12:46", "authoredDateTime": "2020-02-21 14:20:14", "commitGitStats": [{"filePath": "pulsar-broker-shaded/pom.xml", "insertions": 0, "deletions": 5, "lines": 5}, {"filePath": "pulsar-client-all/pom.xml", "insertions": 0, "deletions": 5, "lines": 5}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka-shaded/pom.xml", "insertions": 6, "deletions": 13, "lines": 19}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka-shaded_0_8/pom.xml", "insertions": 8, "deletions": 15, "lines": 23}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka-shaded_0_9/pom.xml", "insertions": 9, "deletions": 16, "lines": 25}, {"filePath": "pulsar-client-shaded/pom.xml", "insertions": 0, "deletions": 5, "lines": 5}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Pulsar Functions not working with LocalRunner  (2.5.0)", "body": "**Describe the bug**\r\nPulsar Function are not working with LocalRunner\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a Function\r\n--------------------------------------------\r\n```\r\nimport org.apache.pulsar.functions.api.Context;\r\nimport org.apache.pulsar.functions.api.Function;\r\npublic class CounterFunction implements Function<String, String> {\r\n    @Override\r\n    public String process(String input, Context context) {\r\n        Arrays.asList(input.split(\"\\\\s+\")).forEach(word -> context.incrCounter(word, 1));\r\n        return input;\r\n    }\r\n}\r\n```\r\n---------------------------------------------\r\n2. Create a LocalRunner\r\n---------------------------------------------\r\n```\r\nimport org.apache.pulsar.common.functions.FunctionConfig;\r\nimport org.apache.pulsar.functions.LocalRunner;\r\n\r\n\r\nimport java.util.Collections;\r\n\r\npublic class CounterRunner {\r\n\r\n    public static void main(String[] args) throws Exception {\r\n\r\n        FunctionConfig functionConfig = new FunctionConfig();\r\n        functionConfig.setName(\"counter\");\r\n        functionConfig.setInputs(Collections.singleton(\"input\"));\r\n        functionConfig.setClassName(CounterFunction.class.getName());\r\n        functionConfig.setRuntime(FunctionConfig.Runtime.JAVA);\r\n        functionConfig.setOutput(\"output\");\r\n\r\n        LocalRunner localRunner = LocalRunner.builder().functionConfig(functionConfig).build();\r\n        localRunner.start(true);\r\n    }\r\n\r\n```\r\n3. Start a Local Pulsar Instance Or Configure Local Runner to Connect to your Pusar\r\n      LocalRunner localRunner = LocalRunner.builder().functionConfig(functionConfig).brokerServiceUrl(\"pulsar://PORT:PORT\").build();\r\n\r\n4. Execute : and see Error  :  \r\n```\r\nException in thread \"main\" java.lang.NoClassDefFoundError: org/apache/pulsar/functions/runtime/shaded/io/netty/util/Timer\r\n\tat org.apache.pulsar.client.impl.ClientBuilderImpl.build(ClientBuilderImpl.java:62)\r\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntimeFactory.createPulsarClient(ThreadRuntimeFactory.java:96)\r\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntimeFactory.<init>(ThreadRuntimeFactory.java:67)\r\n\tat org.apache.pulsar.functions.LocalRunner.startThreadedMode(LocalRunner.java:405)\r\n\tat org.apache.pulsar.functions.LocalRunner.start(LocalRunner.java:319)\r\n\tat com.functions.CounterRunner.main(CounterRunner.java:24)\r\nCaused by: java.lang.ClassNotFoundException: org.apache.pulsar.functions.runtime.shaded.io.netty.util.Timer\r\n\tat java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:582)\r\n\tat java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:178)\r\n\tat java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:521)\r\n\t... 6 more\r\n[INFO ] 2020-02-06 10:43:49.132 [Thread-0] LocalRunner - Shutting down the localrun runtimeSpawner ...\r\n\r\nProcess finished with exit code 1\r\n```\r\n\r\n**Expected behavior**\r\n\r\nPulsar Function works and consumer input topic / produce into output topic\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n- OS: Windows \r\n- IDE : Intellij 2019.3\r\n- Java : 11\r\n- dependencies {\r\n    implementation group: 'org.apache.pulsar', name: 'pulsar-functions-local-runner', version: '2.5.0'\r\n}\r\n\r\n**Additional context**\r\nIT works in the previous version (2.4.0)\r\n- dependencies {\r\n    implementation group: 'org.apache.pulsar', name: 'pulsar-functions-local-runner', version: '2.4.0'\r\n}", "url": "https://github.com/apache/pulsar/issues/6238", "user": "yfathi", "labels": ["type/bug"], "created": "2020-02-06 09:53:19", "closed": "2020-02-06 09:55:41", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Broker health check throws exception badversion", "body": "More detail information https://github.com/apache/pulsar-manager/issues/259\r\n\r\n**Describe the bug**\r\nAn exception is thrown only the first time.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6229", "user": "tuteng", "labels": ["triage/week-6", "type/bug"], "created": "2020-02-05 10:30:19", "closed": "2020-04-09 21:21:24", "commits": {}, "ttf": 64.00027777777778, "commitsDetails": []}, {"title": "zookeeper connection cause resource leak", "body": "in class `ZookeeperBkClientFactoryImpl`,  the `create` method\r\n\r\n```\r\nif (zk.getState() == States.CONNECTEDREADONLY && sessionType != SessionType.AllowReadOnly) {\r\n                    future.completeExceptionally(new IllegalStateException(\"Cannot use a read-only session\"));\r\n                }\r\n```\r\n\r\nalthough this code can not reach, but pulsar should handle 'zookeeper.close' for this code\r\n", "url": "https://github.com/apache/pulsar/issues/6228", "user": "zplinuxlover", "labels": ["help wanted", "triage/week-6", "type/bug"], "created": "2020-02-05 08:46:23", "closed": "2020-02-29 20:53:16", "commits": {"e6a631d491948119c07a30339c7daf71002c5c0a": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "30b1818df29e3f57f7b77a80b59ad771b5073a33": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "211d7f09ed4c1d4c951eeec86aa1c429bdfa46ce": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "c41498e90480bf7aa92dda17f38d39ebc4b2cb9b": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 24.00027777777778, "commitsDetails": [{"commitHash": "e6a631d491948119c07a30339c7daf71002c5c0a", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["4f461c3bd36ad832789a6f9186f77da151aba5a5"], "nameRev": "e6a631d491948119c07a30339c7daf71002c5c0a tags/v2.6.0-candidate-1~450", "commitMessage": "Close ZK before canceling future with exception (#6228) (#6399)\n\nFixes #6228\r\n", "commitDateTime": "2020-02-29 13:53:15", "authoredDateTime": "2020-02-29 21:53:15", "commitGitStats": [{"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZookeeperBkClientFactoryImpl.java", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ZookeeperBkClientFactoryImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.ZookeeperBkClientFactoryImpl.create(java.lang.String,org.apache.pulsar.zookeeper.SessionType,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "30b1818df29e3f57f7b77a80b59ad771b5073a33", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "211d7f09ed4c1d4c951eeec86aa1c429bdfa46ce", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["1061ac8c7e041ea4034e7414f0597ae1a53e998d"], "nameRev": "211d7f09ed4c1d4c951eeec86aa1c429bdfa46ce tags/v2.5.1-candidate-1~38", "commitMessage": "Close ZK before canceling future with exception (#6228) (#6399)\n\nFixes #6228\r\n\n(cherry picked from commit e6a631d491948119c07a30339c7daf71002c5c0a)\n", "commitDateTime": "2020-04-05 10:52:20", "authoredDateTime": "2020-02-29 21:53:15", "commitGitStats": [{"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZookeeperBkClientFactoryImpl.java", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ZookeeperBkClientFactoryImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.ZookeeperBkClientFactoryImpl.create(java.lang.String,org.apache.pulsar.zookeeper.SessionType,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "c41498e90480bf7aa92dda17f38d39ebc4b2cb9b", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["6181612e0d38333b4754d5b7142b685ce464888d"], "nameRev": "c41498e90480bf7aa92dda17f38d39ebc4b2cb9b tags/v2.5.1-candidate-3~49", "commitMessage": "Close ZK before canceling future with exception (#6228) (#6399)\n\nFixes #6228\r\n\n(cherry picked from commit e6a631d491948119c07a30339c7daf71002c5c0a)\n", "commitDateTime": "2020-04-13 11:13:14", "authoredDateTime": "2020-02-29 21:53:15", "commitGitStats": [{"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZookeeperBkClientFactoryImpl.java", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ZookeeperBkClientFactoryImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.ZookeeperBkClientFactoryImpl.create(java.lang.String,org.apache.pulsar.zookeeper.SessionType,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 3, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0.0, "deletions": 0.0, "lines": 0.0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0.0, "UPD": 0.0, "INS": 0.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "persistent://public/default/extract-text-.* does match everything topic starts with extract-text?", "body": "**Describe the bug**\r\nI am using the python client with pulsar 2.4.2. I made a subscription with persistent://public/default/extract-text-.* expecting that it would subscribe to all topics that start with extract-text but instead pulsar just creates a topic called persistent://public/default/extract-text-.*? Is this a bug or is there a different syntax to subscribe to all topics starting with extract-text?\r\n", "url": "https://github.com/apache/pulsar/issues/6185", "user": "pl6306", "labels": ["component/python", "triage/week-6", "type/bug"], "created": "2020-02-02 04:34:18", "closed": "2020-02-25 02:37:37", "commits": {}, "ttf": 22.00027777777778, "commitsDetails": []}, {"title": "[Documentation]Wrong description of routing modes", "body": "> [The [routing mode](#routing-modes) determines both which broker handles each partition](https://github.com/apache/pulsar/blame/master/site2/docs/concepts-messaging.md#L286)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6177", "user": "yjshen", "labels": ["component/documentation", "triage/week-5", "type/bug"], "created": "2020-01-31 15:28:19", "closed": "2020-02-06 23:29:09", "commits": {"3b46f502fed947b02066e0769a655266e94d2eb0": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "3b46f502fed947b02066e0769a655266e94d2eb0", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["0e8d533d7a2f8e2279a6af54eb297e1051bd3f62"], "nameRev": "3b46f502fed947b02066e0769a655266e94d2eb0 tags/v2.6.0-candidate-1~548", "commitMessage": "[Doc] Fix issue 6177 - Correct explanation for routing mode (#6244)\n\nFix https://github.com/apache/pulsar/issues/6177", "commitDateTime": "2020-02-06 15:29:08", "authoredDateTime": "2020-02-07 07:29:08", "commitGitStats": [{"filePath": "site2/docs/concepts-messaging.md", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["3b46f502fed947b02066e0769a655266e94d2eb0"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Strange CPU usage in standalone using Docker", "body": "**Describe the bug**\r\nI am testing Pulsar 2.5.0 in the standalone mode using Docker 2.2.0.0. \r\nThe container is created using docker-compose, this is the configuration:\r\n\r\n```\r\npulsar:\r\n    image: apachepulsar/pulsar:2.5.0\r\n    ports:\r\n      - \"8080:8080\"\r\n      - \"6650:6650\"\r\n    expose:\r\n      - 8080\r\n      - 6650\r\n    environment:\r\n      - PULSAR_MEM=\" -Xms512m -Xmx512m -XX:MaxDirectMemorySize=1g\"\r\n    command: >\r\n      /bin/bash -c\r\n      \"bin/apply-config-from-env.py conf/standalone.conf\r\n      && bin/pulsar standalone\"\r\n```\r\n\r\nI noted a strange cpu usage, always ~40% cpu usage without doing any operation after the `docker-compose up`, look at this log\r\n\r\n```top - 10:57:17 up 14:11,  0 users,  load average: 0.20, 0.37, 0.93\r\nTasks:   3 total,   1 running,   2 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s):  5.6 us,  7.4 sy,  0.0 ni, 87.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\r\nMiB Mem :   7964.3 total,   4760.5 free,   1862.6 used,   1341.2 buff/cache\r\nMiB Swap:   1024.0 total,    947.5 free,     76.5 used.   5851.5 avail Mem \r\n\r\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND\r\n    1 root      20   0 5324348 637228  30316 S  33.3   7.8   7:00.23 /usr/local/openjdk-8/bin/java -cp /pulsar/conf:::/pulsar/lib/*: -Dlog4j.configurationFile=log4j2.yaml -Djute.maxbuffer=10485760 -Djava.net.preferIPv4Stack=true -Dpulsar.allocator.exit_on_oom=true -Dio.netty.recycler.maxCapacity.default=1000 -Dio.netty.recycler.linkCapacity=1024 -Xms512m -Xm+\r\n  610 root      20   0    5752   3652   3128 S   0.0   0.0   0:00.11 bash\r\n  692 root      20   0    9616   3328   2968 R   0.0   0.0   0:00.00 top\r\n\r\ntop - 10:57:20 up 14:11,  0 users,  load average: 0.35, 0.40, 0.94\r\nTasks:   3 total,   1 running,   2 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s):  0.7 us,  2.6 sy,  0.0 ni, 96.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\r\nMiB Mem :   7964.3 total,   4758.7 free,   1864.3 used,   1341.2 buff/cache\r\nMiB Swap:   1024.0 total,    947.5 free,     76.5 used.   5849.8 avail Mem \r\n\r\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND\r\n    1 root      20   0 5324348 637228  30316 S  31.7   7.8   7:01.18 /usr/local/openjdk-8/bin/java -cp /pulsar/conf:::/pulsar/lib/*: -Dlog4j.configurationFile=log4j2.yaml -Djute.maxbuffer=10485760 -Djava.net.preferIPv4Stack=true -Dpulsar.allocator.exit_on_oom=true -Dio.netty.recycler.maxCapacity.default=1000 -Dio.netty.recycler.linkCapacity=1024 -Xms512m -Xm+\r\n  610 root      20   0    5752   3652   3128 S   0.0   0.0   0:00.11 bash\r\n  692 root      20   0    9616   3328   2968 R   0.0   0.0   0:00.00 top```\r\n\r\nis this normal?\r\n", "url": "https://github.com/apache/pulsar/issues/6175", "user": "nicolo-paganin", "labels": ["triage/week-6", "type/bug"], "created": "2020-01-31 11:03:50", "closed": "2020-02-28 02:40:24", "commits": {}, "ttf": 27.00027777777778, "commitsDetails": []}, {"title": "Log compaction fails due to timeout", "body": "**Describe the bug**\r\nLog compaction fails due to a timeout.\r\n\r\n**To Reproduce**\r\n1. Start pulsar standalone\r\n1. Create producer\r\n2. Produce messages at high throughput\r\n3. Trigger topic compaction\r\n4. Read compaction status\r\n\r\n**Detailed steps to reproduce:**\r\n\r\n0. Clear all state\r\n```bash\r\n# rm -r data logs # !!! careful !!! this wipes all your topics etc.\r\n```\r\n\r\n1. Start pulsar standalone\r\n```bash\r\nbin/pulsar standalone\r\n```\r\n\r\n2. Create producer\r\n```java\r\nPulsarClient pulsarClient = PulsarClient.builder()\r\n    .serviceUrl(\"pulsar://192.168.11.22:6650\")\r\n    .build();\r\nProducer<byte[]> producer = pulsarClient.newProducer()\r\n    .topic(\"my-topic\")\r\n    .create();\r\n```\r\n\r\n3. Produce messages at high throughput\r\n```java\r\nint msgCount = 500000;\r\nlong before = System.currentTimeMillis();\r\nfor (int i = 0; i < msgCount; i++) {\r\n    producer.newMessage()\r\n            .key(\"asdf\")\r\n            .value(new byte[] {1, 2, 3, 4, 5})\r\n            .sendAsync();\r\n}\r\nSystem.out.println(\"Sent \" + msgCount + \" messages in \" + (System.currentTimeMillis() - before) + \" msec\");\r\n```\r\n\r\n4. Trigger topic compaction\r\n```bash\r\n$ bin/pulsar-admin topics compact persistent://public/default/my-topic\r\nTopic compaction requested for persistent://public/default/my-topic\r\n```\r\n\r\n5. Read compaction status\r\n```bash\r\n$ bin/pulsar-admin topics compaction-status persistent://public/default/my-topic\r\nCompaction is currently running\r\n\r\n$ # WAIT FOR 10 SECONDS\r\n\r\n$ bin/pulsar-admin topics compaction-status persistent://public/default/my-topic\r\nError in compaction\r\nnull\r\n\r\nReason: Error compacting: java.util.concurrent.TimeoutException: Timeout\r\n```\r\n\r\n**Expected behavior**\r\nCompaction and no error\r\n\r\n**Desktop (please complete the following information):**\r\n - Pulsar version: 2.5.0 (tar.gz from website)\r\n - OS: `Linux 4.19.0-4-amd64 #1 SMP Debian 4.19.28-2 (2019-03-15) x86_64 unknown unknown GNU/Linux`\r\n\r\n**Logs**\r\nThe complete logs from the start of compaction until the error was read via compaction status\r\n```\r\n09:47:54.409 [pulsar-web-57-8] INFO  org.apache.pulsar.client.impl.ConsumerStatsRecorderImpl - Starting Pulsar consumer status recorder with config: {\r\n  \"topicNames\" : [ \"persistent://public/default/my-topic\" ],\r\n  \"topicsPattern\" : null,\r\n  \"subscriptionName\" : \"__compaction\",\r\n  \"subscriptionType\" : \"Exclusive\",\r\n  \"receiverQueueSize\" : 1000,\r\n  \"acknowledgementsGroupTimeMicros\" : 100000,\r\n  \"negativeAckRedeliveryDelayMicros\" : 60000000,\r\n  \"maxTotalReceiverQueueSizeAcrossPartitions\" : 50000,\r\n  \"consumerName\" : null,\r\n  \"ackTimeoutMillis\" : 0,\r\n  \"tickDurationMillis\" : 1000,\r\n  \"priorityLevel\" : 0,\r\n  \"cryptoFailureAction\" : \"FAIL\",\r\n  \"properties\" : { },\r\n  \"readCompacted\" : true,\r\n  \"subscriptionInitialPosition\" : \"Latest\",\r\n  \"patternAutoDiscoveryPeriod\" : 1,\r\n  \"regexSubscriptionMode\" : \"PersistentOnly\",\r\n  \"deadLetterPolicy\" : null,\r\n  \"autoUpdatePartitions\" : true,\r\n  \"replicateSubscriptionState\" : false,\r\n  \"resetIncludeHead\" : false,\r\n  \"keySharedPolicy\" : null\r\n}\r\n09:47:54.410 [pulsar-web-57-8] INFO  org.apache.pulsar.client.impl.ConsumerStatsRecorderImpl - Pulsar client config: {\r\n  \"serviceUrl\" : \"pulsar://localhost:6650\",\r\n  \"authPluginClassName\" : null,\r\n  \"authParams\" : null,\r\n  \"operationTimeoutMs\" : 30000,\r\n  \"statsIntervalSeconds\" : 60,\r\n  \"numIoThreads\" : 1,\r\n  \"numListenerThreads\" : 1,\r\n  \"connectionsPerBroker\" : 1,\r\n  \"useTcpNoDelay\" : true,\r\n  \"useTls\" : false,\r\n  \"tlsTrustCertsFilePath\" : null,\r\n  \"tlsAllowInsecureConnection\" : false,\r\n  \"tlsHostnameVerificationEnable\" : false,\r\n  \"concurrentLookupRequest\" : 5000,\r\n  \"maxLookupRequest\" : 50000,\r\n  \"maxNumberOfRejectedRequestPerConnection\" : 50,\r\n  \"keepAliveIntervalSeconds\" : 30,\r\n  \"connectionTimeoutMs\" : 10000,\r\n  \"requestTimeoutMs\" : 60000,\r\n  \"initialBackoffIntervalNanos\" : 100000000,\r\n  \"maxBackoffIntervalNanos\" : 60000000000\r\n}\r\n09:47:54.411 [pulsar-web-57-8] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [31/1/2020:09:47:54 +0900] \"PUT /admin/v2/persistent/public/default/my-topic/compaction HTTP/1.1\" 204 0 \"-\" \"Pulsar-Java-v2.5.0\" 6\r\n09:47:54.411 [pulsar-client-io-85-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/my-topic][__compaction] Subscribing to topic on cnx [id: 0xeb973738, L:/127.0.0.1:60180 - R:localhost/127.0.0.1:6650]\r\n09:47:54.412 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - [/127.0.0.1:60180] Subscribing on topic persistent://public/default/my-topic / __compaction\r\n09:47:54.412 [pulsar-io-50-7] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [public/default/persistent/my-topic-__compaction] Rewind from 1544:100 to 1544:0\r\n09:47:54.412 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://public/default/my-topic] There are no replicated subscriptions on the topic\r\n09:47:54.412 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://public/default/my-topic][__compaction] Created new subscription for 1\r\n09:47:54.412 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - [/127.0.0.1:60180] Created subscription on topic persistent://public/default/my-topic / __compaction\r\n09:47:54.413 [pulsar-client-io-85-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/my-topic][__compaction] Subscribed to topic on localhost/127.0.0.1:6650 -- consumer: 1\r\n09:47:54.413 [pulsar-client-io-85-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/my-topic][__compaction] Seek subscription to message id -1:-1:-1\r\n09:47:54.415 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.Consumer - Disconnecting consumer: Consumer{subscription=CompactorSubscription{topic=persistent://public/default/my-topic, name=__compaction}, consumerId=1, consumerName=b411f, address=/127.0.0.1:60180}\r\n09:47:54.416 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.AbstractDispatcherSingleActiveConsumer - Removing consumer Consumer{subscription=CompactorSubscription{topic=persistent://public/default/my-topic, name=__compaction}, consumerId=1, consumerName=b411f, address=/127.0.0.1:60180}\r\n09:47:54.416 [pulsar-client-io-85-1] INFO  org.apache.pulsar.client.impl.ClientCnx - [localhost/127.0.0.1:6650] Broker notification of Closed consumer: 1\r\n09:47:54.416 [pulsar-client-io-85-1] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [persistent://public/default/my-topic] [__compaction] Closed connection [id: 0xeb973738, L:/127.0.0.1:60180 - R:localhost/127.0.0.1:6650] -- Will try again in 0.1 s\r\n09:47:54.416 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.persistent.PersistentSubscription - [persistent://public/default/my-topic][__compaction] Successfully disconnected consumers from subscription, proceeding with cursor reset\r\n09:47:54.416 [bookkeeper-ml-workers-OrderedExecutor-2-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [public/default/persistent/my-topic] Initiate reset position to 1544:-1 on cursor __compaction\r\n09:47:54.424 [BookKeeperClientWorker-OrderedExecutor-1-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [public/default/persistent/my-topic] reset position to 1544:-1 before current read position 1544:0 on cursor __compaction\r\n09:47:54.425 [BookKeeperClientWorker-OrderedExecutor-1-0] INFO  org.apache.pulsar.broker.service.ServerCnx - [/127.0.0.1:60180] [persistent://public/default/my-topic][__compaction] Reset subscription to message id -1:-1\r\n09:47:54.426 [pulsar-client-io-85-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/my-topic][__compaction] Successfully reset subscription to message id -1:-1:-1\r\n09:47:54.516 [pulsar-timer-87-1] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [persistent://public/default/my-topic] [__compaction] Reconnecting after timeout\r\n09:47:54.517 [pulsar-client-io-85-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/my-topic][__compaction] Subscribing to topic on cnx [id: 0xeb973738, L:/127.0.0.1:60180 - R:localhost/127.0.0.1:6650]\r\n09:47:54.517 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - [/127.0.0.1:60180] Subscribing on topic persistent://public/default/my-topic / __compaction\r\n09:47:54.518 [pulsar-io-50-7] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [public/default/persistent/my-topic-__compaction] Rewind from 1544:-1 to 1544:0\r\n09:47:54.518 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://public/default/my-topic] There are no replicated subscriptions on the topic\r\n09:47:54.518 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://public/default/my-topic][__compaction] Created new subscription for 1\r\n09:47:54.518 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - [/127.0.0.1:60180] Created subscription on topic persistent://public/default/my-topic / __compaction\r\n09:47:54.518 [pulsar-client-io-85-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/my-topic][__compaction] Subscribed to topic on localhost/127.0.0.1:6650 -- consumer: 1\r\n09:47:54.526 [pulsar-external-listener-86-1] WARN  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/my-topic] [__compaction] Could not get connection while getLastMessageId -- Will try again in 100 ms\r\n09:47:54.527 [pulsar-external-listener-86-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/my-topic][__compaction] Get topic last message Id\r\n09:47:54.527 [pulsar-client-io-85-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/my-topic][__compaction] Successfully getLastMessageId 1544:37344\r\n09:47:54.527 [pulsar-client-io-85-1] INFO  org.apache.pulsar.compaction.TwoPhaseCompactor - Commencing phase one of compaction for persistent://public/default/my-topic, reading to 1544:37344:-1\r\n09:47:57.416 [pulsar-web-57-12] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [31/1/2020:09:47:57 +0900] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 887 \"-\" \"Pulsar-Java-v2.5.0\" 5\r\n09:48:02.838 [pulsar-web-57-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [31/1/2020:09:48:02 +0900] \"GET /admin/v2/persistent/public/default/my-topic/compaction HTTP/1.1\" 200 35 \"-\" \"Pulsar-Java-v2.5.0\" 2\r\n09:48:04.646 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - [/127.0.0.1:60180] Closing consumer: 1\r\n09:48:04.646 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.AbstractDispatcherSingleActiveConsumer - Removing consumer Consumer{subscription=CompactorSubscription{topic=persistent://public/default/my-topic, name=__compaction}, consumerId=1, consumerName=b411f, address=/127.0.0.1:60180}\r\n09:48:04.646 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - [/127.0.0.1:60180] Closed consumer Consumer{subscription=CompactorSubscription{topic=persistent://public/default/my-topic, name=__compaction}, consumerId=1, consumerName=b411f, address=/127.0.0.1:60180}\r\n09:48:04.646 [pulsar-client-io-85-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/my-topic] [__compaction] Closed consumer\r\n09:48:05.941 [pulsar-web-57-3] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [31/1/2020:09:48:05 +0900] \"GET /admin/v2/persistent/public/default/my-topic/compaction HTTP/1.1\" 200 79 \"-\" \"Pulsar-Java-v2.5.0\" 2\r\n09:48:27.417 [pulsar-web-57-6] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [31/1/2020:09:48:27 +0900] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 887 \"-\" \"Pulsar-Java-v2.5.0\" 5\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/6173", "user": "EugenDueck", "labels": ["triage/week-6", "type/bug"], "created": "2020-01-31 01:00:28", "closed": "2020-02-10 01:38:01", "commits": {"d3f6c55d0da05b9f440dc79d7bebb72c7fca67ee": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "1f609ae81e771f5df816d3b1996e6417c7236b40": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 10.000277777777777, "commitsDetails": [{"commitHash": "d3f6c55d0da05b9f440dc79d7bebb72c7fca67ee", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["5fe096d385c2afaff1f6bc2fd206c051fef47768"], "nameRev": "d3f6c55d0da05b9f440dc79d7bebb72c7fca67ee tags/v2.6.0-candidate-1~530", "commitMessage": "[Issue 6173][compaction] Fix log compaction for flow control/empty topic/last deletion (#6237)\n\nFixes https://github.com/apache/pulsar/issues/6173\r\n\r\n### Motivation\r\n\r\nFixes problems for log compaction found in issue https://github.com/apache/pulsar/issues/6173 :\r\n\r\n1. Compaction fails for an empty topic. \r\n2. Compaction never ends if the value of the last message is an empty batch message when the compaction is triggered. \r\n3. Compaction fails for a topic with batch messages because RawReader flow control doesn't handle batch messages properly.\r\n\r\n### Modifications\r\n\r\n1. Check if any message is available before compaction phases, and finish the compaction immediately if there is no messages to read to avoid timeout exception.\r\n2. Add missing check for empty batch message for the condition to end the phase 2 loop.\r\n3. Increase correct number of available permits in RawConsumer for batch messages.\r\n\r\n### Verifying this change\r\n\r\nProducing messages in both batch and not-batch mode in corresponding tests.", "commitDateTime": "2020-02-09 17:37:59", "authoredDateTime": "2020-02-10 09:37:59", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/client/api/RawReader.java", "insertions": 7, "deletions": 0, "lines": 7}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/client/impl/RawReaderImpl.java", "insertions": 17, "deletions": 1, "lines": 18}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/TwoPhaseCompactor.java", "insertions": 42, "deletions": 27, "lines": 69}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/RawReaderTest.java", "insertions": 35, "deletions": 1, "lines": 36}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/compaction/CompactionTest.java", "insertions": 12, "deletions": 6, "lines": 18}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/compaction/CompactorTest.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RawReader.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.hasMessageAvailableAsync()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "RawReaderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderImpl.hasMessageAvailableAsync()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderImpl.RawConsumerImpl.tryCompletePending()", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TwoPhaseCompactor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.TwoPhaseCompactor.doCompaction(org.apache.pulsar.client.api.RawReader,org.apache.bookkeeper.client.BookKeeper)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.compaction.TwoPhaseCompactor.phaseTwoLoop(org.apache.pulsar.client.api.RawReader,org.apache.pulsar.client.api.MessageId,java.util.Map,org.apache.bookkeeper.client.LedgerHandle,java.util.concurrent.Semaphore,java.util.concurrent.CompletableFuture)", "TOT": 10, "UPD": 1, "INS": 2, "MOV": 5, "DEL": 2}]}, {"spoonFilePath": "RawReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderTest.publishMessages(java.lang.String,int)", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderTest.testFlowControlBatch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderTest.publishMessages(java.lang.String,int,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CompactionTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.CompactionTest.testCompactionWithLastDeletedKey()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.compaction.CompactionTest.testEmptyCompactionLedger()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.compaction.CompactionTest.lastDeletedBatching()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.compaction.CompactionTest.testCompactionWithLastDeletedKey(boolean)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.compaction.CompactionTest.testEmptyCompactionLedger(boolean)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CompactorTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.CompactorTest.testCompactEmptyTopic()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.increaseAvailablePermits(org.apache.pulsar.client.impl.ClientCnx,int)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "1f609ae81e771f5df816d3b1996e6417c7236b40", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["b696d66214e009c474486cb8e1fd46982dd37cbd"], "nameRev": "1f609ae81e771f5df816d3b1996e6417c7236b40 tags/v2.5.1-candidate-3~81", "commitMessage": "[Issue 6173][compaction] Fix log compaction for flow control/empty topic/last deletion (#6237)\n\nFixes https://github.com/apache/pulsar/issues/6173\r\n\r\n### Motivation\r\n\r\nFixes problems for log compaction found in issue https://github.com/apache/pulsar/issues/6173 :\r\n\r\n1. Compaction fails for an empty topic. \r\n2. Compaction never ends if the value of the last message is an empty batch message when the compaction is triggered. \r\n3. Compaction fails for a topic with batch messages because RawReader flow control doesn't handle batch messages properly.\r\n\r\n### Modifications\r\n\r\n1. Check if any message is available before compaction phases, and finish the compaction immediately if there is no messages to read to avoid timeout exception.\r\n2. Add missing check for empty batch message for the condition to end the phase 2 loop.\r\n3. Increase correct number of available permits in RawConsumer for batch messages.\r\n\r\n### Verifying this change\r\n\r\nProducing messages in both batch and not-batch mode in corresponding tests.\n\n(cherry picked from commit d3f6c55d0da05b9f440dc79d7bebb72c7fca67ee)\n", "commitDateTime": "2020-04-13 11:10:39", "authoredDateTime": "2020-02-10 09:37:59", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/client/api/RawReader.java", "insertions": 7, "deletions": 0, "lines": 7}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/client/impl/RawReaderImpl.java", "insertions": 17, "deletions": 1, "lines": 18}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/TwoPhaseCompactor.java", "insertions": 42, "deletions": 27, "lines": 69}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/RawReaderTest.java", "insertions": 35, "deletions": 1, "lines": 36}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/compaction/CompactionTest.java", "insertions": 12, "deletions": 6, "lines": 18}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/compaction/CompactorTest.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RawReader.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.hasMessageAvailableAsync()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "RawReaderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderImpl.hasMessageAvailableAsync()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderImpl.RawConsumerImpl.tryCompletePending()", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TwoPhaseCompactor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.TwoPhaseCompactor.doCompaction(org.apache.pulsar.client.api.RawReader,org.apache.bookkeeper.client.BookKeeper)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.compaction.TwoPhaseCompactor.phaseTwoLoop(org.apache.pulsar.client.api.RawReader,org.apache.pulsar.client.api.MessageId,java.util.Map,org.apache.bookkeeper.client.LedgerHandle,java.util.concurrent.Semaphore,java.util.concurrent.CompletableFuture)", "TOT": 10, "UPD": 1, "INS": 2, "MOV": 5, "DEL": 2}]}, {"spoonFilePath": "RawReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderTest.publishMessages(java.lang.String,int)", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderTest.testFlowControlBatch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderTest.publishMessages(java.lang.String,int,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CompactionTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.CompactionTest.testCompactionWithLastDeletedKey()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.compaction.CompactionTest.testEmptyCompactionLedger()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.compaction.CompactionTest.lastDeletedBatching()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.compaction.CompactionTest.testCompactionWithLastDeletedKey(boolean)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.compaction.CompactionTest.testEmptyCompactionLedger(boolean)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CompactorTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.compaction.CompactorTest.testCompactEmptyTopic()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.increaseAvailablePermits(org.apache.pulsar.client.impl.ClientCnx,int)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["d3f6c55d0da05b9f440dc79d7bebb72c7fca67ee"], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 67, "deletions": 29, "lines": 96, "gitFilesChange": 4}, "spoonStatsSummary": {"TOT": 19, "UPD": 3, "INS": 8, "MOV": 6, "DEL": 2, "spoonFilesChanged": 4, "spoonMethodsChanged": 6}, "statsSkippedReason": "", "changesInPackagesGIT": ["pulsar-broker/src/main/java/org/apache/pulsar/client/api", "pulsar-client/src/main/java/org/apache/pulsar/client/impl", "pulsar-broker/src/main/java/org/apache/pulsar/client/impl", "pulsar-broker/src/main/java/org/apache/pulsar/compaction"], "changesInPackagesSPOON": ["org.apache.pulsar.compaction.TwoPhaseCompactor.doCompaction(org.apache.pulsar.client.api.RawReader,org.apache.bookkeeper.client.BookKeeper)", "org.apache.pulsar.client.impl.ConsumerImpl.increaseAvailablePermits(org.apache.pulsar.client.impl.ClientCnx,int)", "org.apache.pulsar.compaction.TwoPhaseCompactor.phaseTwoLoop(org.apache.pulsar.client.api.RawReader,org.apache.pulsar.client.api.MessageId,java.util.Map,org.apache.bookkeeper.client.LedgerHandle,java.util.concurrent.Semaphore,java.util.concurrent.CompletableFuture)", "org.apache.pulsar.client.impl.RawReaderImpl.RawConsumerImpl.tryCompletePending()", "org.apache.pulsar.client.impl.RawReaderImpl.hasMessageAvailableAsync()", "org.apache.pulsar.client.api.hasMessageAvailableAsync()"]}, {"title": "Python Functions broken by logging change", "body": "**Describe the bug**\r\nNative logging was added to the Python client in #6113 with a change to the constructor args. This change is not accommodated in the Python Function handling. python_instance_main uses the old args order causing the args to get misinterpreted.\r\nThe new pulsar.Client constructor is:\r\n```\r\ndef __init__(self, service_url,\r\n                 authentication=None,\r\n                 operation_timeout_seconds=30,\r\n                 io_threads=1,\r\n                 message_listener_threads=1,\r\n                 concurrent_lookup_requests=50000,\r\n                 log_conf_file_path=None,\r\n                 logger=None,\r\n                 use_tls=False,\r\n                 tls_trust_certs_file_path=None,\r\n                 tls_allow_insecure_connection=False,\r\n                 tls_validate_hostname=False,\r\n                 ):\r\n```\r\npulsar-functions-instance python_instance_main calls:\r\n```\r\npulsar_client = pulsar.Client(args.pulsar_serviceurl, authentication, 30, 1, 1, 50000, None, use_tls, tls_trust_cert_path, tls_allow_insecure_connection)\r\n```\r\ncausing the args from `use_tls` onwards to be off by one.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Setup a Python Function\r\n\r\n**Expected behavior**\r\nFunction should run but instead it fails.\r\n\r\n**Screenshots**\r\n```\r\n[2020-01-29 15:07:13 +0000] [ERROR] log.py: Traceback (most recent call last):\r\n[2020-01-29 15:07:13 +0000] [ERROR] log.py:   File \"/Users/sbourke/sw/src/pulsar-2020.01.29/pulsar-functions/instance/target/python-instance/python_instance_main.py\", line 211, in <module>\r\n[2020-01-29 15:07:13 +0000] [ERROR] log.py: main()\r\n[2020-01-29 15:07:13 +0000] [ERROR] log.py:   File \"/Users/sbourke/sw/src/pulsar-2020.01.29/pulsar-functions/instance/target/python-instance/python_instance_main.py\", line 161, in main\r\n[2020-01-29 15:07:13 +0000] [ERROR] log.py: pulsar_client = pulsar.Client(args.pulsar_serviceurl, authentication, 30, 1, 1, 50000, None, use_tls, tls_trust_cert_path, tls_allow_insecure_connection)\r\n[2020-01-29 15:07:13 +0000] [ERROR] log.py:   File \"/Users/sbourke/sw/src/pulsar-2020.01.29/pulsar-functions/instance/target/python-instance/pulsar/__init__.py\", line 397, in __init__\r\n[2020-01-29 15:07:13 +0000] [ERROR] log.py: _check_type_or_none(logging.Logger, logger, 'logger')\r\n[2020-01-29 15:07:13 +0000] [ERROR] log.py:   File \"/Users/sbourke/sw/src/pulsar-2020.01.29/pulsar-functions/instance/target/python-instance/pulsar/__init__.py\", line 1177, in _check_type_or_none\r\n[2020-01-29 15:07:13 +0000] [ERROR] log.py: % (name, var_type.__name__))\r\n[2020-01-29 15:07:13 +0000] [ERROR] log.py: ValueError\r\n[2020-01-29 15:07:13 +0000] [ERROR] log.py: :\r\n[2020-01-29 15:07:13 +0000] [ERROR] log.py: Argument logger is expected to be either None or of type 'Logger'\r\n```", "url": "https://github.com/apache/pulsar/issues/6171", "user": "sbourkeostk", "labels": ["component/functions", "component/python", "triage/week-6", "type/bug"], "created": "2020-01-30 15:05:59", "closed": "2020-02-07 02:23:45", "commits": {"92d71023ca2e5a5eb58f5954a5506ab5d4ccd22c": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 7.000277777777778, "commitsDetails": [{"commitHash": "92d71023ca2e5a5eb58f5954a5506ab5d4ccd22c", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["4a2bceb35f83a11d037845731642cf0cc667809f"], "nameRev": "92d71023ca2e5a5eb58f5954a5506ab5d4ccd22c tags/v2.6.0-candidate-1~550", "commitMessage": "Revert \"Support for python native logging from python wrapper (#6113)\" (#6174)\n\nAs stated in #6171, change #6113 broke the function instance runner. This change attempts to revert #6113 first to make sure CI back to normal.\r\n\r\nAdditionally, it fixes and improves a bunch of integration tests. (unfortunately, we have to couple these changes to make sure it pass CI).", "commitDateTime": "2020-02-06 15:27:36", "authoredDateTime": "2020-02-06 15:27:36", "commitGitStats": [{"filePath": ".github/workflows/ci-integration-sql.yaml", "insertions": 12, "deletions": 0, "lines": 12}, {"filePath": ".github/workflows/ci-unit-adaptors.yml", "insertions": 15, "deletions": 0, "lines": 15}, {"filePath": ".github/workflows/ci-unit-broker-sasl.yml", "insertions": 15, "deletions": 0, "lines": 15}, {"filePath": ".github/workflows/ci-unit-broker.yml", "insertions": 14, "deletions": 0, "lines": 14}, {"filePath": ".github/workflows/ci-unit-flaky.yaml", "insertions": 13, "deletions": 5, "lines": 18}, {"filePath": ".github/workflows/ci-unit-proxy.yaml", "insertions": 17, "deletions": 2, "lines": 19}, {"filePath": ".github/workflows/ci-unit.yaml", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/ServerCnxTest.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/PartitionCreationTest.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/v1/V1_ProducerConsumerTest.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/BrokerClientIntegrationTest.java", "insertions": 6, "deletions": 3, "lines": 9}, {"filePath": "pulsar-client-cpp/lib/MultiTopicsConsumerImpl.cc", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-client-cpp/python/pulsar/__init__.py", "insertions": 0, "deletions": 7, "lines": 7}, {"filePath": "pulsar-client-cpp/python/src/config.cc", "insertions": 0, "deletions": 103, "lines": 103}, {"filePath": "pulsar-client-cpp/tests/BasicEndToEndTest.cc", "insertions": 5, "deletions": 2, "lines": 7}, {"filePath": "pulsar-functions/worker/src/test/java/org/apache/pulsar/functions/worker/rest/api/v2/FunctionApiV2ResourceTest.java", "insertions": 17, "deletions": 7, "lines": 24}, {"filePath": "pulsar-functions/worker/src/test/java/org/apache/pulsar/functions/worker/rest/api/v3/FunctionApiV3ResourceTest.java", "insertions": 17, "deletions": 7, "lines": 24}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyTest.java", "insertions": 28, "deletions": 21, "lines": 49}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/cli/FunctionsCLITest.java", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnxTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnxTest.testDuplicateConcurrentSubscribeCommand()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PartitionCreationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.PartitionCreationTest.testCreateConsumerForPartitionedTopicUpdateWhenDisableTopicAutoCreation()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "V1_ProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.v1.V1_ProducerConsumerTest.testActiveAndInActiveConsumerEntryCacheBehavior()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BrokerClientIntegrationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BrokerClientIntegrationTest.testUnsupportedBatchMessageConsumer(org.apache.pulsar.client.api.SubscriptionType)", "TOT": 6, "UPD": 2, "INS": 3, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "FunctionApiV2ResourceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.worker.rest.api.v2.FunctionApiV2ResourceTest.testUpdateFunctionWithUrl()", "TOT": 8, "UPD": 5, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.worker.rest.api.v2.FunctionApiV2ResourceTest.testDownloadFunctionFile()", "TOT": 7, "UPD": 5, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.worker.rest.api.v2.FunctionApiV2ResourceTest.testRegisterFunctionFileUrlWithValidSinkClass()", "TOT": 8, "UPD": 5, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.worker.rest.api.v2.FunctionApiV2ResourceTest.testRegisterFunctionWithConflictingFields()", "TOT": 8, "UPD": 5, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "FunctionApiV3ResourceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.worker.rest.api.v3.FunctionApiV3ResourceTest.testDownloadFunctionFile()", "TOT": 7, "UPD": 5, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.worker.rest.api.v3.FunctionApiV3ResourceTest.testRegisterFunctionFileUrlWithValidSinkClass()", "TOT": 8, "UPD": 5, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.worker.rest.api.v3.FunctionApiV3ResourceTest.testRegisterFunctionWithConflictingFields()", "TOT": 8, "UPD": 5, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.worker.rest.api.v3.FunctionApiV3ResourceTest.testCreateFunctionWithoutSettingRuntime()", "TOT": 8, "UPD": 5, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProxyTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyTest.testRegexSubscription()", "TOT": 6, "UPD": 4, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyTest.testProducer()", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyTest.testProducerConsumer()", "TOT": 5, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyTest.testPartitions()", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyTest.testGetSchema()", "TOT": 6, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyTest.testProtocolVersionAdvertisement()", "TOT": 6, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 3}]}, {"spoonFilePath": "FunctionsCLITest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.cli.FunctionsCLITest.testUploadDownload()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Can't control the queue size in shared subscription with multiple topics", "body": "**Describe the bug**\r\nIn the use case where I have multiple consumers of the type pulsar.ConsumerType.Shared, the receiver_queue_size=1 parameter is ignored? It works fine when it is a single topic. It also doesn't work in a partitioned topic\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\npts = ['topic-1','topic-2','topic-3']\r\nconsumer = client.subscribe(topic=pts,\r\n                                    subscription_name=subscription,\r\n                                    receiver_queue_size=1,\r\n                                    max_total_receiver_queue_size_across_partitions=1,\r\n                                    consumer_type=pulsar.ConsumerType.Shared,\r\n                                    initial_position=pulsar.InitialPosition.Earliest)\r\n\r\n**Expected behavior**\r\nI expect that each consumer to get a receiver_queue_size of 1. But it doesn't\r\n\r\n**Additional context**\r\nUsing version 2.4.2\r\n", "url": "https://github.com/apache/pulsar/issues/6162", "user": "pl6306", "labels": ["component/client", "triage/week-6", "type/bug"], "created": "2020-01-29 16:01:42", "closed": "2020-02-07 02:29:32", "commits": {}, "ttf": 8.000277777777777, "commitsDetails": []}, {"title": "Failing to cumulative acknowledge messages as old as 15 seconds", "body": "Observed behavior: Topic backlog is filling up and never cleared.\r\nExpected behavior: Topic backlog is cleared. \r\nIn further tests observed to exhibit over as low as 5 seconds / 5 consecutive messages.\r\n\r\n- Pulsar 2.4.2, cluster of 4 * brokers/proxies/bookies/zk\r\n- Single persistent non-partitioned topic\r\n- Failover subscription\r\n- Single Producer\r\n- Single Consumer\r\n\r\nNamespace creation:\r\n```sh\r\nbin/pulsar-admin tenants create cb\r\nbin/pulsar-admin namespaces create cb/test\r\nbin/pulsar-admin namespaces set-backlog-quota cb/test --limit 300M --policy consumer_backlog_eviction\r\nbin/pulsar-admin namespaces set-deduplication cb/test --enable\r\n```\r\n\r\nClient (shared code):\r\n```java\r\npublic class PulsarTestBase {\r\n\r\n  protected SystemLogger logger;\r\n  protected String clientId;\r\n  protected PulsarClient pulsar;\r\n\r\n  protected String pulsarUrl = \"pulsar://3.234.220.124:30004/\";\r\n\r\n  protected String topicName = \"persistent://cb/test/topic-1\";\r\n\r\n  PulsarTestBase(String clientId) {\r\n    this.clientId = clientId;\r\n    logger = new SystemLogger.Builder(clientId).withCloudwatch(false).withPrometheus(false).build();\r\n  }\r\n\r\n  protected void createClient() throws PulsarClientException {\r\n    pulsar =\r\n        PulsarClient.builder()\r\n            .serviceUrl(pulsarUrl)\r\n            .connectionsPerBroker(1) // default: 1\r\n            .connectionTimeout(10, TimeUnit.SECONDS)\r\n            .enableTcpNoDelay(true)\r\n            .keepAliveInterval(999, TimeUnit.DAYS)\r\n            .maxBackoffInterval(5, TimeUnit.SECONDS)\r\n            .startingBackoffInterval(1, TimeUnit.SECONDS)\r\n            .statsInterval(60, TimeUnit.SECONDS)\r\n            // number of threads to be used for handling connections to brokers\r\n            .ioThreads(1) // default: 1\r\n            //  number of threads to be used for message listeners\r\n            .listenerThreads(1) // default: 1\r\n            // number of concurrent lookup-requests allowed to send on each broker-connection\r\n            .maxConcurrentLookupRequests(5000) // default: 5000\r\n            .maxLookupRequests(50000) // default: 50000\r\n            // how many broker-rejects within 30 secs before connection to broker is recycled\r\n            .maxNumberOfRejectedRequestPerConnection(50) // default: 50\r\n            // how long to retry a broker op before the op is marked as failed\r\n            .operationTimeout(30, TimeUnit.SECONDS) // default: 30 sec\r\n            .build();\r\n  }\r\n}\r\n```\r\n\r\nProducer code:\r\n```java\r\npublic class TestProducer extends PulsarTestBase {\r\n\r\n  public static void main(String[] args) throws Exception {\r\n    new TestProducer(args[0]);\r\n  }\r\n\r\n  TestProducer(String clientId) throws Exception {\r\n    super(clientId);\r\n    createClient();\r\n\r\n    Producer<Order> producer =\r\n        pulsar\r\n            .newProducer(Schema.PROTOBUF(Order.class))\r\n            .producerName(clientId)\r\n            .topic(topicName)\r\n            .batchingMaxPublishDelay(1, TimeUnit.MILLISECONDS) // default: 1 ms\r\n            .batchingMaxMessages(1000) // default: 1000\r\n            // batching disabled, as we produce far more rarely than 1ms range\r\n            .enableBatching(false) // default: true\r\n            // block vs throw exception if pending-ack queue is full\r\n            .blockIfQueueFull(false) // default: false\r\n            // how many non-acked msgs to buffer before block or throw-exception\r\n            .maxPendingMessages(1000) // default: 1000\r\n            .sendTimeout(30, TimeUnit.SECONDS) // default: 30 sec\r\n            // .initialSequenceId() // TODO what if non-existent ID passed?\r\n            .hashingScheme(HashingScheme.JavaStringHash) // default: java string\r\n            .create();\r\n\r\n    V3.log(\"msg\", \"producing messages\");\r\n\r\n    long counter = 0L;\r\n\r\n    while (true) {\r\n\r\n      Thread.sleep(1000L);\r\n\r\n      V3.log(\"msg\", \"producing message\", \"counter\", counter);\r\n\r\n      producer\r\n          .newMessage()\r\n          .value(Order.newBuilder().setPrice(1d).setSize(counter).build())\r\n          .send();\r\n\r\n      counter++;\r\n    }\r\n  }\r\n\r\n  private final BiConsumer<? super MessageId, ? super Throwable> producerResultHandler =\r\n      new BiConsumer<MessageId, Throwable>() {\r\n        @Override\r\n        public void accept(MessageId messageId, Throwable ex) {\r\n          if (ex != null) {\r\n            V3.log(ex, \"msg\", \"pulsar producer submit error\", \"*metric\", \"DroppedData\", \"value\", 1);\r\n          }\r\n        }\r\n      };\r\n}\r\n```\r\n\r\nConsumer code:\r\n```java\r\npublic class TestConsumer extends PulsarTestBase {\r\n\r\n  public static void main(String[] args) throws Exception {\r\n    new TestConsumer(args[0]);\r\n  }\r\n\r\n  TestConsumer(String clientId) throws Exception {\r\n    super(clientId);\r\n    createClient();\r\n\r\n    Consumer<Order> consumer =\r\n        pulsar\r\n            .newConsumer(Schema.PROTOBUF(Order.class))\r\n            .consumerName(clientId)\r\n            .subscriptionInitialPosition(SubscriptionInitialPosition.Latest)\r\n            .subscriptionType(SubscriptionType.Failover)\r\n            .subscriptionName(\"failover-subscription\")\r\n            .topic(topicName)\r\n            .subscribe();\r\n\r\n    MessageId firstMsgIdToAck = null;\r\n    int msgAckDelayCounter = 0;\r\n\r\n    V3.log(\"msg\", \"waiting for messages\");\r\n\r\n    while (true) {\r\n      Message<Order> message = consumer.receive();\r\n      Order order = message.getValue();\r\n\r\n      V3.log(\r\n          \"msg\", \"received message\",\r\n          \"sequenceId\", message.getSequenceId(),\r\n          \"price\", order.getPrice(),\r\n          \"size\", order.getSize(),\r\n          \"producer\", message.getProducerName(),\r\n          \"messageId\", Pulsar.msgIdToHex(message.getMessageId()));\r\n\r\n      if (firstMsgIdToAck == null) {\r\n        firstMsgIdToAck = message.getMessageId();\r\n        V3.log(\"msg\", \"storing ack message id\", \"messageId\", Pulsar.msgIdToHex(firstMsgIdToAck));\r\n      }\r\n\r\n      if (++msgAckDelayCounter == 15) {\r\n        V3.log(\"msg\", \"acknowledging message id\", \"messageId\", Pulsar.msgIdToHex(firstMsgIdToAck));\r\n        consumer.acknowledgeCumulativeAsync(firstMsgIdToAck);\r\n        firstMsgIdToAck = null;\r\n        msgAckDelayCounter = 0;\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nProducer log screenshot:\r\n![image](https://user-images.githubusercontent.com/588573/73253048-6dd08900-41c4-11ea-8653-fcc6d8be86b6.png)\r\n\r\nConsumer log screenshot:\r\n![image](https://user-images.githubusercontent.com/588573/73253156-a1131800-41c4-11ea-92e1-883481eb0bf4.png)\r\n\r\nAdmin console screenshot:\r\n![image](https://user-images.githubusercontent.com/588573/73253181-aec89d80-41c4-11ea-828b-68f8a7c8e278.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6157", "user": "youurayy", "labels": ["component/client", "triage/week-6", "type/bug"], "created": "2020-01-28 10:04:51", "closed": "2020-02-06 00:09:56", "commits": {}, "ttf": 8.000277777777777, "commitsDetails": []}, {"title": "Brokers constantly crash in the k8s cluster (Could not connect to bookie) after bookies ip change", "body": "**Describe the bug**\r\nBrokers constantly failing in a 2.5.0 GKE cluster with a _CrashLoopBackOff_ . They work for several hours and then fail. Tried installing clean cluster 3 days in a raw and the behavior persisted. Looks like there is a bookie discovering issue\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Use default helm chart values-mini.yaml on GKE 3 nodes\r\n2. Use following values:\r\n```\r\n  # Pulsar proxy\r\n  proxy: yes\r\n  # Bookkeeper auto-recovery\r\n  autoRecovery: no\r\n  # Pulsar dashboard\r\n  # Deprecated\r\n  # Replace pulsar-dashboard with pulsar-manager\r\n  dashboard: yes\r\n  # pulsar manager\r\n  pulsar_manager: no\r\n  # Bastion pod for administrative commands\r\n  bastion: yes\r\n  # Monitoring stack (prometheus and grafana)\r\n  monitoring: no\r\n```\r\n3. Wait for some time (4+ hours)\r\n4. See error\r\n\r\n**Expected behavior**\r\nBrokers should **not** fail with the CrashLoopBackOff error\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/3329606/73246774-80e15a00-41c0-11ea-9913-a24725282f8e.png)\r\n\r\n**Additional context**\r\nAdding logs from 2 failing brokers and 3 bookies. Also adding last logs from one of the evicted pods.\r\n[bookeeper-1.log](https://github.com/apache/pulsar/files/4121328/bookeeper-1.log)\r\n[bookeeper-2.log](https://github.com/apache/pulsar/files/4121329/bookeeper-2.log)\r\n[bookeeper-3.log](https://github.com/apache/pulsar/files/4121331/bookeeper-3.log)\r\n[broker-1.log](https://github.com/apache/pulsar/files/4121332/broker-1.log)\r\n[broker-2.log](https://github.com/apache/pulsar/files/4121333/broker-2.log)\r\n[evicted_broker.txt](https://github.com/apache/pulsar/files/4121424/evicted_broker.txt)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6154", "user": "Lanayx", "labels": ["component/k8s", "triage/week-6", "type/bug"], "created": "2020-01-28 08:47:13", "closed": "2020-06-22 22:37:32", "commits": {}, "ttf": 146.00027777777777, "commitsDetails": []}, {"title": "Pulsar manager Negative initial size: -1  error", "body": "Following error can be seen in the logs of the pulsar manager:\r\n\r\n```\r\n18:04:02.914 [pulsar-external-web-4-5] WARN  org.eclipse.jetty.server.HttpChannel - /admin/v2/clusters\r\njava.lang.IllegalArgumentException: Negative initial size: -1\r\n\tat java.io.ByteArrayOutputStream.<init>(ByteArrayOutputStream.java:74) ~[?:1.8.0_232]\r\n\tat org.apache.pulsar.proxy.server.AdminProxyHandler$ReplayableProxyContentProvider.<init>(AdminProxyHandler.java:150) ~[org.apache.pulsar-pulsar-proxy-2.4.2.jar:2.4.2]\r\n```\r\nIt happens when the pulsar manager tries to communicate to the broker via the pulsar proxy.  Proxy is working just fine when producing and consuming messages via python client code. The pulsar manager UI just spins.\r\n\r\nPossibly similar issue to https://github.com/streamnative/pulsarctl/pull/157\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6141", "user": "roman-popenov", "labels": ["type/bug"], "created": "2020-01-25 20:08:27", "closed": "2020-01-26 17:06:18", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Unable to upgrade bookie to 2.5.0", "body": "**Describe the bug**\r\nWhen upgrading an existing 2.4.1 bookie cluster to 2.5.0 on kubernetes, the bookie fails to start with the following exception during initialization: `io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 2147483648, max: 2147483648)`\r\n\r\nThe node where the bookie was deployed has more than enough free memory. Rolling the bookie back to versions 2.4.1 or 2.4.2 allows the bookie to initialize successfully.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Have an existing 2.4.1 bookie cluster on kuberentes\r\n2. Update the image on the stateful set definition and set it to start in read only mode.\r\n3. Restart one of the bookies to update the image version\r\n4. See error on the bookie logs\r\n\r\n**Expected behavior**\r\nUpgrading a bookie should work\r\n\r\n**Additional context**\r\n[bookie.log](https://github.com/apache/pulsar/files/4104451/bookie.log)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6131", "user": "gperinazzo", "labels": ["triage/week-4", "type/bug"], "created": "2020-01-23 17:12:09", "closed": "2020-02-08 01:15:54", "commits": {"28875d5abc4cd13a3e9cc4f59524d2566d9f9f05": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "f0c2ce19fbdc4ef2778abd9e892f1aa95926ea9c": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 15.000277777777777, "commitsDetails": [{"commitHash": "28875d5abc4cd13a3e9cc4f59524d2566d9f9f05", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["6511763063bba796ce4fea74bd7b702f0d40bd1d"], "nameRev": "28875d5abc4cd13a3e9cc4f59524d2566d9f9f05 tags/v2.6.0-candidate-1~539", "commitMessage": "[ISSUE-6131]: Ensure JVM memory and GC options are set for bookie (#6201)\n\n### Motivation\r\nFixes #6131 (caused by #5675):\r\n\r\nWhen upgrading an existing 2.4.1 bookie cluster to 2.5.0 on kubernetes, the bookie fails to start with the following exception during initialization: io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 2147483648, max: 2147483648). This is caused by the fact that the bookie environment variables `BOOKIE_MEM` and `BOOKIE_FC` defined in conf/bkenv.sh has no effect, and it is always using the defaults values. \r\n\r\n#### Proposed solution:\r\nSet `BOOKIE_MEM` and `BOOKIE_GC` in the helm deployments charts and default to `PULSAR_MEM` if the `BOOKIE` settings are not set and then use the default settings if none of those environment variables are set.\r\n\r\n#### Changes made\r\nHelm chart deployment `values.yaml` and `values-mini.yaml` along with the `bkenv.sh` configuration script.\r\n\r\n### Documentation\r\nCurrently, the documentation explaining the deployment process and how to change settings is lacking and need to be updated.", "commitDateTime": "2020-02-07 17:15:53", "authoredDateTime": "2020-02-07 20:15:53", "commitGitStats": [{"filePath": "conf/bkenv.sh", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "deployment/kubernetes/helm/pulsar/templates/bookkeeper-statefulset.yaml", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "deployment/kubernetes/helm/pulsar/values.yaml", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "f0c2ce19fbdc4ef2778abd9e892f1aa95926ea9c", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["9b2ee74c40d811d4676f2ae77dcded7617acbd90"], "nameRev": "f0c2ce19fbdc4ef2778abd9e892f1aa95926ea9c tags/v2.5.1-candidate-3~86", "commitMessage": "[ISSUE-6131]: Ensure JVM memory and GC options are set for bookie (#6201)\n\n### Motivation\r\nFixes #6131 (caused by #5675):\r\n\r\nWhen upgrading an existing 2.4.1 bookie cluster to 2.5.0 on kubernetes, the bookie fails to start with the following exception during initialization: io.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 2147483648, max: 2147483648). This is caused by the fact that the bookie environment variables `BOOKIE_MEM` and `BOOKIE_FC` defined in conf/bkenv.sh has no effect, and it is always using the defaults values. \r\n\r\n#### Proposed solution:\r\nSet `BOOKIE_MEM` and `BOOKIE_GC` in the helm deployments charts and default to `PULSAR_MEM` if the `BOOKIE` settings are not set and then use the default settings if none of those environment variables are set.\r\n\r\n#### Changes made\r\nHelm chart deployment `values.yaml` and `values-mini.yaml` along with the `bkenv.sh` configuration script.\r\n\r\n### Documentation\r\nCurrently, the documentation explaining the deployment process and how to change settings is lacking and need to be updated.\n\n(cherry picked from commit 28875d5abc4cd13a3e9cc4f59524d2566d9f9f05)\n", "commitDateTime": "2020-04-13 11:10:17", "authoredDateTime": "2020-02-07 20:15:53", "commitGitStats": [{"filePath": "conf/bkenv.sh", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "deployment/kubernetes/helm/pulsar/templates/bookkeeper-statefulset.yaml", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "deployment/kubernetes/helm/pulsar/values.yaml", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Download page link text does not agree with file name", "body": "The displayed text in the links for the Older Releases on the page https://pulsar.apache.org/download/ does not agree with the file to which the link points. e.g.\r\n\r\napache-pulsar-2.4.2-bin-tar.gz\r\npoints to a file with the name\r\napache-pulsar-2.4.2-bin.tar.gz\r\n\r\nThe links work, but this is confusing.", "url": "https://github.com/apache/pulsar/issues/6115", "user": "sebbASF", "labels": ["component/documentation", "triage/week-4", "type/bug"], "created": "2020-01-21 12:57:57", "closed": "2020-01-24 03:22:18", "commits": {"9db9605d06f6fd38301c1fb062f2bb81ee45b3d0": {"commitGHEventType": "closed", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "9db9605d06f6fd38301c1fb062f2bb81ee45b3d0", "commitGHEventType": "closed", "commitUser": "sijie", "commitParents": ["c078a552cb284295ad49b84d3d1af77f0ee8a5a6"], "nameRev": "9db9605d06f6fd38301c1fb062f2bb81ee45b3d0 tags/v2.6.0-candidate-1~590", "commitMessage": "[website]Fixed website error (#6125)\n\nFixed:\r\nhttps://github.com/apache/pulsar/issues/6115\r\nhttps://github.com/apache/pulsar/issues/6110\r\nhttps://github.com/apache/pulsar/issues/6108\r\nhttps://github.com/apache/pulsar/issues/6100\r\n\r\n### Motivation\r\n\r\nThere are some errors in the content of the current document due to the adjustment of the architecture, so we will fix it.\r\n\r\n### Modifications\r\n\r\n* The display is inconsistent with the downloaded content.\r\n* Document display error\r\n* Add io-use.md for version 2.5.0", "commitDateTime": "2020-01-23 19:22:14", "authoredDateTime": "2020-01-24 11:22:14", "commitGitStats": [{"filePath": "site2/docs/io-quickstart.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/docs/io-use.md", "insertions": 22, "deletions": 22, "lines": 44}, {"filePath": "site2/website/pages/en/download.js", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/website/sidebars.json", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "site2/website/versioned_docs/version-2.4.0/io-quickstart.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.5.0/io-quickstart.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.5.0/io-use.md", "insertions": 1506, "deletions": 0, "lines": 1506}, {"filePath": "site2/website/versioned_sidebars/version-2.5.0-sidebars.json", "insertions": 0, "deletions": 1, "lines": 1}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["9db9605d06f6fd38301c1fb062f2bb81ee45b3d0"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2, "deletions": 4, "lines": 6, "gitFilesChange": 3}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["site2/website/sidebars.json", "site2/website/pages/en/download.js", "site2/website/versioned_sidebars/version-2.5.0-sidebars.json"]}, {"title": "[Doc 2.5.0] Wrong link address in doc", "body": "**Describe the bug**\r\n\r\nWrong link address in doc. doc version 2.5.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to [rest-api](https://pulsar.apache.org/docs/en/admin-api-overview/#rest-api)\r\n2. Click on 'document'\r\n3. Redirect to https://pulsar.incubator.apache.org/en/admin-rest-api#/\r\n4. Blank page\r\n\r\n**Expected behavior**\r\n\r\nshould redirect to a valid page.\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/5317064/72788387-cce64900-3c6c-11ea-9ef9-a9a47f1d5cf9.png)\r\n![image](https://user-images.githubusercontent.com/5317064/72788400-d4a5ed80-3c6c-11ea-9aec-ecf94259d1c7.png)\r\n\r\n**Desktop (please complete the following information):**\r\n - OS:  MacOS 10.15  \r\n - Google Chrome\r\n\r\n**Additional context**\r\n\r\nuse grep command find more domain `pulsar.incubator.apache.org`\r\n\r\n```shell\r\ngrep -iR \"pulsar.incubator.apache.org\" .\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/6114", "user": "archfish", "labels": ["help wanted", "type/bug"], "created": "2020-01-21 08:45:16", "closed": "2020-01-22 03:02:46", "commits": {"f9674f71f5f17095b2706095fcf8c0d8df888cfc": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "f9674f71f5f17095b2706095fcf8c0d8df888cfc", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["7d851a3cb6d0bf7aae9ce940d7ed2dd73ccadcf9"], "nameRev": "f9674f71f5f17095b2706095fcf8c0d8df888cfc tags/v2.6.0-candidate-1~603", "commitMessage": "Fix missing Swagger files for the version 2.5.0 (#6118)\n\nFixes #6114\r\n\r\nModifications\r\nThe swagger files were generated for the version 2.5.0 according to the instruction provided by @tuteng", "commitDateTime": "2020-01-22 11:02:45", "authoredDateTime": "2020-01-22 04:02:45", "commitGitStats": [{"filePath": "site2/website/static/swagger/2.5.0/swagger.json", "insertions": 10285, "deletions": 0, "lines": 10285}, {"filePath": "site2/website/static/swagger/2.5.0/swaggerfunctions.json", "insertions": 1499, "deletions": 0, "lines": 1499}, {"filePath": "site2/website/static/swagger/2.5.0/swaggersink.json", "insertions": 955, "deletions": 0, "lines": 955}, {"filePath": "site2/website/static/swagger/2.5.0/swaggersource.json", "insertions": 902, "deletions": 0, "lines": 902}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[Doc 2.5.0] The content of Connector Admin CLI is blank ", "body": "**Describe the bug**\r\nThe content of Connector Admin CLI is blank .\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'http://pulsar.apache.org/docs/en/reference-connector-admin/'\r\n2. See error\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6110", "user": "huangdx0726", "labels": ["component/documentation", "triage/week-4", "type/bug"], "created": "2020-01-21 07:22:49", "closed": "2020-05-22 04:00:45", "commits": {"9db9605d06f6fd38301c1fb062f2bb81ee45b3d0": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 121.00027777777778, "commitsDetails": [{"commitHash": "9db9605d06f6fd38301c1fb062f2bb81ee45b3d0", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["c078a552cb284295ad49b84d3d1af77f0ee8a5a6"], "nameRev": "9db9605d06f6fd38301c1fb062f2bb81ee45b3d0 tags/v2.6.0-candidate-1~590", "commitMessage": "[website]Fixed website error (#6125)\n\nFixed:\r\nhttps://github.com/apache/pulsar/issues/6115\r\nhttps://github.com/apache/pulsar/issues/6110\r\nhttps://github.com/apache/pulsar/issues/6108\r\nhttps://github.com/apache/pulsar/issues/6100\r\n\r\n### Motivation\r\n\r\nThere are some errors in the content of the current document due to the adjustment of the architecture, so we will fix it.\r\n\r\n### Modifications\r\n\r\n* The display is inconsistent with the downloaded content.\r\n* Document display error\r\n* Add io-use.md for version 2.5.0", "commitDateTime": "2020-01-23 19:22:14", "authoredDateTime": "2020-01-24 11:22:14", "commitGitStats": [{"filePath": "site2/docs/io-quickstart.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/docs/io-use.md", "insertions": 22, "deletions": 22, "lines": 44}, {"filePath": "site2/website/pages/en/download.js", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/website/sidebars.json", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "site2/website/versioned_docs/version-2.4.0/io-quickstart.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.5.0/io-quickstart.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.5.0/io-use.md", "insertions": 1506, "deletions": 0, "lines": 1506}, {"filePath": "site2/website/versioned_sidebars/version-2.5.0-sidebars.json", "insertions": 0, "deletions": 1, "lines": 1}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["9db9605d06f6fd38301c1fb062f2bb81ee45b3d0"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2, "deletions": 4, "lines": 6, "gitFilesChange": 3}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["site2/website/sidebars.json", "site2/website/pages/en/download.js", "site2/website/versioned_sidebars/version-2.5.0-sidebars.json"]}, {"title": "[doc] 404 error in pulsar io-use", "body": "**Describe the bug**\r\n404 error in pulsar io-use.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'http://pulsar.apache.org/docs/en/io-use'\r\n2. Click on 'Use'\r\n3. Scroll down to 'reload'\r\n4.Click `here` link\r\n4. See error\r\n\r\n**Expected behavior**\r\nRight page is displayed.\r\n\r\n**Screenshots**\r\n![\u56fe\u7247](https://user-images.githubusercontent.com/29513837/72782364-84c02a00-3c5e-11ea-991e-45b5b8543839.png)\r\n.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6108", "user": "huangdx0726", "labels": ["type/bug"], "created": "2020-01-21 06:59:02", "closed": "2020-01-24 04:06:03", "commits": {"9db9605d06f6fd38301c1fb062f2bb81ee45b3d0": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "9db9605d06f6fd38301c1fb062f2bb81ee45b3d0", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["c078a552cb284295ad49b84d3d1af77f0ee8a5a6"], "nameRev": "9db9605d06f6fd38301c1fb062f2bb81ee45b3d0 tags/v2.6.0-candidate-1~590", "commitMessage": "[website]Fixed website error (#6125)\n\nFixed:\r\nhttps://github.com/apache/pulsar/issues/6115\r\nhttps://github.com/apache/pulsar/issues/6110\r\nhttps://github.com/apache/pulsar/issues/6108\r\nhttps://github.com/apache/pulsar/issues/6100\r\n\r\n### Motivation\r\n\r\nThere are some errors in the content of the current document due to the adjustment of the architecture, so we will fix it.\r\n\r\n### Modifications\r\n\r\n* The display is inconsistent with the downloaded content.\r\n* Document display error\r\n* Add io-use.md for version 2.5.0", "commitDateTime": "2020-01-23 19:22:14", "authoredDateTime": "2020-01-24 11:22:14", "commitGitStats": [{"filePath": "site2/docs/io-quickstart.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/docs/io-use.md", "insertions": 22, "deletions": 22, "lines": 44}, {"filePath": "site2/website/pages/en/download.js", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/website/sidebars.json", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "site2/website/versioned_docs/version-2.4.0/io-quickstart.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.5.0/io-quickstart.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.5.0/io-use.md", "insertions": 1506, "deletions": 0, "lines": 1506}, {"filePath": "site2/website/versioned_sidebars/version-2.5.0-sidebars.json", "insertions": 0, "deletions": 1, "lines": 1}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["9db9605d06f6fd38301c1fb062f2bb81ee45b3d0"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2, "deletions": 4, "lines": 6, "gitFilesChange": 3}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["site2/website/sidebars.json", "site2/website/pages/en/download.js", "site2/website/versioned_sidebars/version-2.5.0-sidebars.json"]}, {"title": "[website] The 2.5.0 REST API page seems can not be loaded", "body": "![image](https://user-images.githubusercontent.com/24502569/72780814-c353e580-3c5a-11ea-8a94-6a036e386551.png)\r\n", "url": "https://github.com/apache/pulsar/issues/6107", "user": "zymap", "labels": ["type/bug"], "created": "2020-01-21 06:32:26", "closed": "2020-01-22 04:27:20", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[doc] 404 error Pulsar IO", "body": "**Describe the bug**\r\n404 error Pulsar IO.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'http://pulsar.apache.org/docs/en/2.4.2/io-quickstart'\r\n2. Click on 'Get started'\r\n3. Scroll down to ' Install Pulsar and builtin connector'\r\n4.Click `here` like.\r\n4. See error\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Screenshots**\r\n![\u56fe\u7247](https://user-images.githubusercontent.com/29513837/72712701-85958500-3ba6-11ea-989c-2f3fae85d423.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6100", "user": "huangdx0726", "labels": ["component/documentation", "help wanted", "triage/week-4", "type/bug"], "created": "2020-01-20 09:01:55", "closed": "2020-02-06 02:14:49", "commits": {"9db9605d06f6fd38301c1fb062f2bb81ee45b3d0": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 16.00027777777778, "commitsDetails": [{"commitHash": "9db9605d06f6fd38301c1fb062f2bb81ee45b3d0", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["c078a552cb284295ad49b84d3d1af77f0ee8a5a6"], "nameRev": "9db9605d06f6fd38301c1fb062f2bb81ee45b3d0 tags/v2.6.0-candidate-1~590", "commitMessage": "[website]Fixed website error (#6125)\n\nFixed:\r\nhttps://github.com/apache/pulsar/issues/6115\r\nhttps://github.com/apache/pulsar/issues/6110\r\nhttps://github.com/apache/pulsar/issues/6108\r\nhttps://github.com/apache/pulsar/issues/6100\r\n\r\n### Motivation\r\n\r\nThere are some errors in the content of the current document due to the adjustment of the architecture, so we will fix it.\r\n\r\n### Modifications\r\n\r\n* The display is inconsistent with the downloaded content.\r\n* Document display error\r\n* Add io-use.md for version 2.5.0", "commitDateTime": "2020-01-23 19:22:14", "authoredDateTime": "2020-01-24 11:22:14", "commitGitStats": [{"filePath": "site2/docs/io-quickstart.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/docs/io-use.md", "insertions": 22, "deletions": 22, "lines": 44}, {"filePath": "site2/website/pages/en/download.js", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/website/sidebars.json", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "site2/website/versioned_docs/version-2.4.0/io-quickstart.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.5.0/io-quickstart.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.5.0/io-use.md", "insertions": 1506, "deletions": 0, "lines": 1506}, {"filePath": "site2/website/versioned_sidebars/version-2.5.0-sidebars.json", "insertions": 0, "deletions": 1, "lines": 1}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["9db9605d06f6fd38301c1fb062f2bb81ee45b3d0"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2, "deletions": 4, "lines": 6, "gitFilesChange": 3}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["site2/website/sidebars.json", "site2/website/pages/en/download.js", "site2/website/versioned_sidebars/version-2.5.0-sidebars.json"]}, {"title": "[doc] 404 error in Pulsar Functions", "body": "**Describe the bug**\r\n404 error in Pulsar Functions.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'http://pulsar.apache.org/docs/en/2.4.2/functions-deploy'\r\n2. Scroll down to end\r\n2. Click on 'NEXT'\r\n\r\n4. See error\r\n\r\n**Expected behavior**\r\nShow correct page.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6099", "user": "huangdx0726", "labels": ["type/bug"], "created": "2020-01-20 08:45:20", "closed": "2020-01-20 09:57:49", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[doc] Incorrect picture in pulsar function-overview ", "body": "**Describe the bug**\r\nIncorrect picture in pulsar function-overview.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'http://pulsar.apache.org/docs/en/2.4.2/functions-overview'\r\n2. Click on '....'\r\n3. Scroll down to 'Programming model'\r\n4. See error\r\n\r\n**Expected behavior**\r\nThe last \"in\" should is \"pudding\".\r\n\r\n**Screenshots**\r\n![\u56fe\u7247](https://user-images.githubusercontent.com/29513837/72704600-347c9580-3b94-11ea-980d-6ecd74676044.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/6094", "user": "huangdx0726", "labels": ["component/documentation", "help wanted", "triage/week-4", "type/bug"], "created": "2020-01-20 06:52:19", "closed": "2020-01-22 09:55:55", "commits": {"cb19ee87b7a6eb01e382ba3d6576f825de0aa3d4": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "cb19ee87b7a6eb01e382ba3d6576f825de0aa3d4", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f9674f71f5f17095b2706095fcf8c0d8df888cfc"], "nameRev": "cb19ee87b7a6eb01e382ba3d6576f825de0aa3d4 tags/v2.6.0-candidate-1~602", "commitMessage": "[Issue 6094][doc] fix Incorrect picture in pulsar function-overview (#6095)\n\nFixes #6094 \r\n\r\n\r\n### Motivation\r\n\r\nIncorrect picture in pulsar function-overview\r\n\r\n### Modifications\r\n\r\nFix the last word \"in\" to \"pudding\".", "commitDateTime": "2020-01-22 01:55:55", "authoredDateTime": "2020-01-22 17:55:55", "commitGitStats": [{"filePath": "site2/docs/assets/pulsar-functions-word-count.png", "insertions": 0, "deletions": 0, "lines": 0}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[v2.5.0] Functions dead-letter-topic parameter not supported", "body": "**Describe the bug**\r\nIn the Functions reference https://pulsar.apache.org/docs/en/functions-cli/ it shows a parameter `dead-letter-topic`. When using it, it is passed to `/pulsar/instances/python-instance/python_instance_main.py` under the `--function_details` json as\r\n```\r\n\"customRuntimeOptions\": \"persistent://tenant/namespace/dlq-topic\"\r\n```\r\nBut `customRuntimeOptions` is not recognized:\r\n```\r\ngoogle.protobuf.json_format.ParseError: Message type \"proto.FunctionDetails\" has no field named \"customRuntimeOptions\".\r\n Available Fields(except extensions): ['tenant', 'namespace', 'name', 'className', 'logTopic', 'processingGuarantees', 'userConfig', 'secretsMap', 'runtime', 'autoAck', 'parallelism', 'source', 'sink', 'resources', 'packageUrl', 'retryDetails', 'runtimeFlags', 'componentType']\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create pulsar function with `--dead-letter-topic` argument\r\n\r\n**Expected behavior**\r\nFunction should be configured correctly\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Docker\r\n\r\n**Additional context**\r\npulsar tag v2.5.0\r\n", "url": "https://github.com/apache/pulsar/issues/6084", "user": "frejonb", "labels": ["component/documentation", "help wanted", "triage/week-4", "type/bug"], "created": "2020-01-18 12:39:09", "closed": "2020-06-10 05:02:39", "commits": {"c6e258dc2643174758fb7265f0f1be62df1f02e9": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "acdd987c18a38136ff511fab44cf90c692d88dca": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 143.00027777777777, "commitsDetails": [{"commitHash": "c6e258dc2643174758fb7265f0f1be62df1f02e9", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["055f3bbec4edd5aa78b4ba5fffd2217f44be218e"], "nameRev": "c6e258dc2643174758fb7265f0f1be62df1f02e9 tags/v2.6.0-candidate-1~609", "commitMessage": "[Functions] The argument and description for dead letter topic is wrong (#6101)\n\n*Motivation*\r\n\r\nRelated to #6084\r\n\r\n #5400 introduces `customRuntimeOptions` in function details. But the description was wrong. The mistake was probably introduced by bad merges.\r\n\r\n*Modification*\r\n\r\nFix the argument and description for `deadletterTopic` and `customRuntimeOptions`.", "commitDateTime": "2020-01-21 09:04:59", "authoredDateTime": "2020-01-20 17:04:59", "commitGitStats": [{"filePath": "pulsar-client-tools-test/src/test/java/org/apache/pulsar/admin/cli/CmdFunctionsTest.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdFunctions.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "CmdFunctionsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdFunctionsTest.testCreateFunction()", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CmdFunctions.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdFunctions.FunctionDetailsCommand", "TOT": 3, "UPD": 2, "INS": 0, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "acdd987c18a38136ff511fab44cf90c692d88dca", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["de4593089c9f298708fa9c013a2b05fa4d892a48"], "nameRev": "acdd987c18a38136ff511fab44cf90c692d88dca tags/v2.5.1-candidate-3~106", "commitMessage": "[Functions] The argument and description for dead letter topic is wrong (#6101)\n\n*Motivation*\r\n\r\nRelated to #6084\r\n\r\n #5400 introduces `customRuntimeOptions` in function details. But the description was wrong. The mistake was probably introduced by bad merges.\r\n\r\n*Modification*\r\n\r\nFix the argument and description for `deadletterTopic` and `customRuntimeOptions`.\n\n(cherry picked from commit c6e258dc2643174758fb7265f0f1be62df1f02e9)\n", "commitDateTime": "2020-04-13 11:08:01", "authoredDateTime": "2020-01-20 17:04:59", "commitGitStats": [{"filePath": "pulsar-client-tools-test/src/test/java/org/apache/pulsar/admin/cli/CmdFunctionsTest.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdFunctions.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "CmdFunctionsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdFunctionsTest.testCreateFunction()", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CmdFunctions.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdFunctions.FunctionDetailsCommand", "TOT": 3, "UPD": 2, "INS": 0, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Cannot create producer via websocket in standalone mode", "body": "**Describe the bug**\r\nWebsocket api is broken - it is impossible to connect with producer to any existing topic.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Run pulsar in standalone mode (docker-compose file):\r\n```\r\nservices:\r\n  standalone:\r\n    image: apachepulsar/pulsar-standalone:2.5.0\r\n    expose:\r\n      - 8080\r\n      - 6650\r\n    ports:\r\n      - \"6650:6650\"\r\n      - \"8080:8080\"\r\n```\r\n2. Try to create producer via websocket (python 3.7)\r\n```\r\nimport asyncio\r\nimport websockets\r\n\r\nasync def connect_test():\r\n    TOPIC = 'ws://localhost:8080/ws/v2/producer/persistent/public/default/my-topic'\r\n    async with websockets.connect(TOPIC) as websocket:\r\n        print('connected!')\r\n\r\nasyncio.get_event_loop().run_until_complete(connect_test())\r\n```\r\n3. An exception will occur: error 400\r\n4. Pulsar logs in docker:\r\n```\r\n12:46:38.002 [pulsar-web-57-6] WARN  org.apache.pulsar.websocket.ProducerHandler - [172.18.0.1:48562] Failed in creating producer on topic persistent://public/default/my-topic: Param serviceUrl must not be blank.\r\n12:46:38.002 [pulsar-web-57-6] INFO  org.eclipse.jetty.server.RequestLog - 172.18.0.1 - - [17/Jan/2020:12:46:38 +0000] \"GET /ws/v2/producer/persistent/public/default/my-topic HTTP/1.1\" 400 462 \"-\" \"Python/3.7 websockets/8.1\" 1\r\n```\r\n5. Change version of pulsar to 2.4.2 - all is working fine!\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Windows 10\r\n - Docker-engine: 19.0.3.5 \r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6079", "user": "VitalyShein", "labels": ["component/websocket", "triage/week-4", "type/bug"], "created": "2020-01-17 12:51:03", "closed": "2020-01-24 07:02:36", "commits": {"49a98972bd2aa8deef2f9a95cf7678bd1e6033a4": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "13b65f193082f1fcbc08e342083ffc0e1b5c74af": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "49a98972bd2aa8deef2f9a95cf7678bd1e6033a4", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["ec122ed9562cffe7c98020a1acdc4e766f5d4d15"], "nameRev": "49a98972bd2aa8deef2f9a95cf7678bd1e6033a4 tags/v2.6.0-candidate-1~583", "commitMessage": " [Websocket] Websocket doesn't set the correct cluster data (#6102)\n\n*Motivation*\r\n\r\nFixes #5997\r\nFixes #6079\r\n\r\nA regression was introduced in #5486. If websocket service as running as part of\r\npulsar standalone, the cluster data is set with null service urls. This causes\r\nservice url is not set correctly in the pulsar client and an illegal argument exception\r\n(\"Param serviceUrl must not be blank.\") will be thrown.\r\n\r\n*Modifications*\r\n\r\n1. Pass `null` when constructing the websocket service. So the local cluster data can\r\n   be refreshed when creating pulsar client.\r\n2. Set the cluster data after both broker service and web service started and ports are allocated.", "commitDateTime": "2020-01-23 23:02:35", "authoredDateTime": "2020-01-23 23:02:35", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java", "insertions": 7, "deletions": 3, "lines": 10}, {"filePath": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/WebSocketService.java", "insertions": 2, "deletions": 0, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.PulsarService.start()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "WebSocketService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.websocket.WebSocketService", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "13b65f193082f1fcbc08e342083ffc0e1b5c74af", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["acdd987c18a38136ff511fab44cf90c692d88dca"], "nameRev": "13b65f193082f1fcbc08e342083ffc0e1b5c74af tags/v2.5.1-candidate-3~105", "commitMessage": " [Websocket] Websocket doesn't set the correct cluster data (#6102)\n\n*Motivation*\r\n\r\nFixes #5997\r\nFixes #6079\r\n\r\nA regression was introduced in #5486. If websocket service as running as part of\r\npulsar standalone, the cluster data is set with null service urls. This causes\r\nservice url is not set correctly in the pulsar client and an illegal argument exception\r\n(\"Param serviceUrl must not be blank.\") will be thrown.\r\n\r\n*Modifications*\r\n\r\n1. Pass `null` when constructing the websocket service. So the local cluster data can\r\n   be refreshed when creating pulsar client.\r\n2. Set the cluster data after both broker service and web service started and ports are allocated.\n\n(cherry picked from commit 49a98972bd2aa8deef2f9a95cf7678bd1e6033a4)\n", "commitDateTime": "2020-04-13 11:08:05", "authoredDateTime": "2020-01-23 23:02:35", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java", "insertions": 7, "deletions": 3, "lines": 10}, {"filePath": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/WebSocketService.java", "insertions": 2, "deletions": 0, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.PulsarService.start()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "WebSocketService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.websocket.WebSocketService", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[website] Download page is messed up", "body": "**Describe the bug**\r\nIt seems like some messed up apache_pulsar prebuilt packages.\r\n\r\nEvery mirror is only listing 2.5.0 even though 2.4.2 is the last stable version. This especially bad if CI/CD is depending on these mirrors.\r\n\r\nhttps://pulsar.apache.org/docs/en/client-libraries-cpp/ list prebuilt .deb files at 2.4.2.\r\n\r\n2.5 is being staged for release and per ASF policy only latest version is kept on mirrors. All the versions are kept at http://archive.apache.org\r\n\r\n**Expected behavior**\r\n The website document should be updated with the archive links as download page (http://pulsar.apache.org/en/download/) for the old releases. ", "url": "https://github.com/apache/pulsar/issues/6071", "user": "Jennifer88huang", "labels": ["component/website", "triage/week-3", "type/bug"], "created": "2020-01-17 02:01:13", "closed": "2020-01-17 12:20:51", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[docs] Add docs to specify whether the consumer push or pull", "body": "**Describe the bug**\r\n> Does the consumer push or pull? It looks like pull but I didn't see that in the docs.\r\nThe wire protocol is actually *push*. The client sends \"permits\" to the broker to ask for messages. The broker will push the requested number of messages to the consumer.\r\n \r\n> Since it is pull and the receive call only receives 1 message at a time, is there a buffer to it? E.g. you can receive and that buffers 4096 bytes and then gives you one message at a time out of the buffer.\r\n\r\nThere is a queue at the consumer side to receive messages pushed from broker. The queue size is configurable by `receiveQueueSize`. Each time `consumer#receive` is called. A message is dequeued from the buffer.\r\n\r\n> Mateo's post https://dzone.com/articles/a-developers-introduction-to-the-pulsar-streaming says it is a pull:\r\n> producers push dat$$anonymous$$nd from which consumers pull data.\r\n\r\nFrom API perspective, it is a \"pull\". But at the wire protocol layer, it is a \"push\" + client side queue.\r\n\r\nThis behavior was never changed.\r\n\r\n--- \r\nConversation between Jesse Anderson and Sijie Guo", "url": "https://github.com/apache/pulsar/issues/6058", "user": "Jennifer88huang", "labels": ["component/documentation", "triage/week-3", "type/bug"], "created": "2020-01-15 04:20:01", "closed": "2020-01-22 02:55:50", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "[docs] Add docs on TypedMessageBuilder", "body": "**Describe the bug**\r\nFrom the way TypedMessageBuilder is set up, it looks like the best practice is to always have the key be a string. Is that the case?\r\n\r\nWhat if you want the key to be an Avro object? You obviously send it as bytes, but the API will make it more difficult to get the Avro object back on the consumer.\r\n\r\n---\r\nComments from Jesse Anderson", "url": "https://github.com/apache/pulsar/issues/6057", "user": "Jennifer88huang", "labels": ["component/documentation", "triage/week-3", "type/bug"], "created": "2020-01-15 04:12:47", "closed": "2020-01-19 01:59:33", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "[docs] Add info on how to choose partition when using a key", "body": "**Describe the bug**\r\nOn [Partitioned topics](https://pulsar.apache.org/docs/en/next/cookbooks-partitioned/) page, it does not say what happens when you use a key. Does that override things? Does it change how a partition is chosen? Looking at the API docs, all of them talk about the absence of keys but don't say what happens with keys.\r\n\r\nI see the link now to the routing modes. It doesn't really make sense that you can set round robin and have that overridden by simply adding a key.\r\n\r\nWith keys, how are partitions chosen? With Kafka it is:\r\nselectedPartition = murmur2(keybytes) % numPartitions\r\n\r\nComments from Jesse Anderson\r\n", "url": "https://github.com/apache/pulsar/issues/6056", "user": "Jennifer88huang", "labels": ["component/documentation", "doc-required", "triage/week-3", "type/bug"], "created": "2020-01-15 04:06:51", "closed": "2020-01-23 08:27:07", "commits": {"472f4485fb30e863fd27527c704a44f8a47246e0": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 8.000277777777777, "commitsDetails": [{"commitHash": "472f4485fb30e863fd27527c704a44f8a47246e0", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["3035aa6862c0208aee621a63704e9fd9d54e89e6"], "nameRev": "472f4485fb30e863fd27527c704a44f8a47246e0 tags/v2.6.0-candidate-1~597", "commitMessage": "[Issue 6056][docs] Add example on how to choose partition when using a key (#6065)\n\nFixes #6056 \r\n\r\n### Motivation\r\nThere is no doc telling users how to choose partition when you use a key.\r\n\r\n### Modifications\r\nAdd example on how to choose partition when using a key.", "commitDateTime": "2020-01-23 00:27:06", "authoredDateTime": "2020-01-23 16:27:06", "commitGitStats": [{"filePath": "site2/docs/cookbooks-partitioned.md", "insertions": 28, "deletions": 13, "lines": 41}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "How to force delete subscribers", "body": "pulsar-admin topics unsubscribe  persistent://public/default/xxx -s xxx\r\n\r\n14:57:36.617 [AsyncHttpClient-5-1] WARN  org.apache.pulsar.client.admin.internal.BaseResource - [http://localhost:8080/admin/v2/persistent/public/default/merchant-item-sit/subscription/ypsx-wms-sit] Failed to perform http delete request: javax.ws.rs.ClientErrorException: HTTP 412 Precondition Failed\r\nSubscription has active connected consumers\r\n\r\nReason: Subscription has active connected consumers", "url": "https://github.com/apache/pulsar/issues/6043", "user": "blsnt", "labels": ["component/admin", "component/cli", "help wanted", "triage/week-3", "type/bug", "type/enhancement"], "created": "2020-01-14 06:58:13", "closed": "2020-03-25 01:42:21", "commits": {"525f9e9a0bc53b1282447e50f0fa93570d2af32b": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 70.00027777777778, "commitsDetails": [{"commitHash": "525f9e9a0bc53b1282447e50f0fa93570d2af32b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f7ccdb8cec747eda1c1e724a52b64633b4f2698c"], "nameRev": "525f9e9a0bc53b1282447e50f0fa93570d2af32b tags/v2.6.0-candidate-1~369", "commitMessage": "[Issue 6043] Support force deleting subscription (#6383)\n\n### Motivation\r\n\r\nFixes #6043\r\n\r\n### Modifications\r\n\r\nAdd method `deleteForcefully` to support force deleting subscription.", "commitDateTime": "2020-03-24 18:42:19", "authoredDateTime": "2020-03-25 09:42:19", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 90, "deletions": 1, "lines": 91}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/PersistentTopics.java", "insertions": 4, "deletions": 2, "lines": 6}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 5, "deletions": 2, "lines": 7}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Subscription.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentSubscription.java", "insertions": 42, "deletions": 1, "lines": 43}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentSubscription.java", "insertions": 42, "deletions": 1, "lines": 43}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java", "insertions": 50, "deletions": 0, "lines": 50}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/Topics.java", "insertions": 43, "deletions": 0, "lines": 43}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/TopicsImpl.java", "insertions": 20, "deletions": 0, "lines": 20}, {"filePath": "pulsar-client-tools-test/src/test/java/org/apache/pulsar/admin/cli/PulsarAdminToolTest.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdPersistentTopics.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdTopics.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "site2/docs/reference-pulsar-admin.md", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalSkipAllMessagesForNonPartitionedTopic(javax.ws.rs.container.AsyncResponse,java.lang.String,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalDeleteSubscription(javax.ws.rs.container.AsyncResponse,java.lang.String,boolean,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalDeleteSubscriptionForcefully(javax.ws.rs.container.AsyncResponse,java.lang.String,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalDeleteSubscriptionForNonPartitionedTopicForcefully(javax.ws.rs.container.AsyncResponse,java.lang.String,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalDeleteSubscription(javax.ws.rs.container.AsyncResponse,java.lang.String,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.deleteSubscription(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String,java.lang.String,boolean)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.deleteSubscription(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String,java.lang.String,java.lang.String,boolean,boolean)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Subscription.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.deleteForcefully()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NonPersistentSubscription.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentSubscription.delete()", "TOT": 7, "UPD": 1, "INS": 1, "MOV": 5, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentSubscription.deleteForcefully()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentSubscription.delete(boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentSubscription.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentSubscription.commitTxn(org.apache.pulsar.transaction.impl.common.TxnID,java.util.Map)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentSubscription.delete()", "TOT": 7, "UPD": 1, "INS": 1, "MOV": 5, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentSubscription.deleteForcefully()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentSubscription.delete(boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.testDeleteSubscription()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGetSubscriptions()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Topics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.deleteSubscription(java.lang.String,java.lang.String,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.deleteSubscriptionAsync(java.lang.String,java.lang.String,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicsImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.deleteSubscription(java.lang.String,java.lang.String,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.deleteSubscriptionAsync(java.lang.String,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.deleteSubscriptionAsync(java.lang.String,java.lang.String,boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarAdminToolTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.PulsarAdminToolTest.topics()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.admin.cli.PulsarAdminToolTest.persistentTopics()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CmdPersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdPersistentTopics.DeleteSubscription", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.admin.cli.CmdPersistentTopics.DeleteSubscription.run()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CmdTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdTopics.DeleteSubscription", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.admin.cli.CmdTopics.DeleteSubscription.run()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[docs] The subscription types are not updated", "body": "**Describe the bug**\r\nFour subscription modes are available in Pulsar:  exclusive, shared, failover, and Key_Shared.; however the doc content is not updated on https://pulsar.apache.org/docs/en/next/concepts-messaging/#limitations-of-key_shared-mode\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/47805623/72264916-82564280-3656-11ea-9f14-7e1730be1fae.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/6038", "user": "Jennifer88huang", "labels": ["component/documentation", "help wanted", "triage/week-2", "type/bug"], "created": "2020-01-13 14:48:25", "closed": "2020-01-19 01:59:33", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "reader's subscription not auto delete after reader disconnected on non persistent topic", "body": "**Describe the bug**\r\nOn persistent topic, a reader's subscription will auto delete after reader disconnected, but on non-persistent topic, the reader's subscription is not auto deleted.\r\n**To Reproduce**\r\n1. connect a reader on a non-persistent topic\r\n2. then disconnet the reader\r\n3. use bin/pulsar-admin topics stats topicname, the reader's subscription is not been deleted.\r\n\r\n**Expected behavior**\r\non persistent \r\n**Screenshots**\r\nroot@broker1:/pulsar# bin/pulsar-admin topics stats non-persistent://public/default/test_t3\r\n{\r\n  \"msgRateIn\" : 0.0,\r\n  \"msgThroughputIn\" : 0.0,\r\n  \"msgRateOut\" : 0.0,\r\n  \"msgThroughputOut\" : 0.0,\r\n  \"averageMsgSize\" : 0.0,\r\n  \"storageSize\" : 0,\r\n  \"publishers\" : [ ],\r\n  \"subscriptions\" : {\r\n    \"reader-e8f7d8\" : {\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateRedeliver\" : 0.0,\r\n      \"msgBacklog\" : 0,\r\n      \"blockedSubscriptionOnUnackedMsgs\" : false,\r\n      \"msgDelayed\" : 0,\r\n      \"unackedMessages\" : 0,\r\n      \"type\" : \"Exclusive\",\r\n      \"msgRateExpired\" : 0.0,\r\n      \"consumers\" : [ ],\r\n      \"isReplicated\" : false\r\n    },\r\n    \"reader-fb504f\" : {\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateRedeliver\" : 0.0,\r\n      \"msgBacklog\" : 0,\r\n      \"blockedSubscriptionOnUnackedMsgs\" : false,\r\n      \"msgDelayed\" : 0,\r\n      \"unackedMessages\" : 0,\r\n      \"type\" : \"Exclusive\",\r\n      \"msgRateExpired\" : 0.0,\r\n      \"consumers\" : [ ],\r\n      \"isReplicated\" : false\r\n    },\r\n    \"reader-16a9a5\" : {\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateRedeliver\" : 0.0,\r\n      \"msgBacklog\" : 0,\r\n      \"blockedSubscriptionOnUnackedMsgs\" : false,\r\n      \"msgDelayed\" : 0,\r\n      \"unackedMessages\" : 0,\r\n      \"type\" : \"Exclusive\",\r\n      \"msgRateExpired\" : 0.0,\r\n      \"consumers\" : [ ],\r\n      \"isReplicated\" : false\r\n    },\r\n    \"reader-61c774\" : {\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateRedeliver\" : 0.0,\r\n      \"msgBacklog\" : 0,\r\n      \"blockedSubscriptionOnUnackedMsgs\" : false,\r\n      \"msgDelayed\" : 0,\r\n      \"unackedMessages\" : 0,\r\n      \"type\" : \"Exclusive\",\r\n      \"msgRateExpired\" : 0.0,\r\n      \"consumers\" : [ ],\r\n      \"isReplicated\" : false\r\n    }\r\n  },\r\n  \"replication\" : { }\r\n}\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\nlinux\r\npulsar 2.4.0\r\n", "url": "https://github.com/apache/pulsar/issues/6021", "user": "sydnash", "labels": ["triage/week-2", "type/bug"], "created": "2020-01-09 07:11:45", "closed": "2020-01-14 07:35:43", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "[REST] Tenant creates should use local cluster if the cluster is empty", "body": "**Describe the bug**\r\nWhen using REST API to create a tenant and specify the cluster name as an empty string, the broker will return the error `Clusters do not exist`.\r\n\r\n**To Reproduce**\r\n1. Startup a standalone\r\n2. Using REST API to create a tenant with empty cluster name\r\n\r\n**Expected behavior**\r\nThe tenant can be created with the local cluster successfully.\r\n", "url": "https://github.com/apache/pulsar/issues/5999", "user": "zymap", "labels": ["triage/week-2", "type/bug"], "created": "2020-01-06 05:30:03", "closed": "2020-02-16 05:37:08", "commits": {"e9083f5592035b4812e086040d4a758379fdd349": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 41.000277777777775, "commitsDetails": [{"commitHash": "e9083f5592035b4812e086040d4a758379fdd349", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["bf7302a743ed847b7c8906d448aefb3164bb205e"], "nameRev": "e9083f5592035b4812e086040d4a758379fdd349 tags/v2.6.0-candidate-1~487", "commitMessage": "[Issue 5999] Support create/update tenant with empty cluster (#6027)\n\n### Motivation\r\n\r\nFixes #5999\r\n\r\n### Modifications\r\n\r\nAdd the logic to handle the blank cluster name.", "commitDateTime": "2020-02-15 21:37:07", "authoredDateTime": "2020-02-16 13:37:07", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/TenantsBase.java", "insertions": 12, "deletions": 7, "lines": 19}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTest.java", "insertions": 32, "deletions": 5, "lines": 37}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/auth/MockedPulsarServiceBaseTest.java", "insertions": 16, "deletions": 0, "lines": 16}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/ResendRequestTest.java", "insertions": 6, "deletions": 3, "lines": 9}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/web/WebServiceTest.java", "insertions": 8, "deletions": 0, "lines": 8}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/PatternTopicsConsumerImplTest.java", "insertions": 14, "deletions": 7, "lines": 21}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/PerMessageUnAcknowledgedRedeliveryTest.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/TopicsConsumerImplTest.java", "insertions": 20, "deletions": 10, "lines": 30}, {"filePath": "pulsar-client-tools-test/src/test/java/org/apache/pulsar/client/cli/PulsarClientToolTest.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyParserTest.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyTest.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyTlsTest.java", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "TenantsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.TenantsBase.validateClusters(org.apache.pulsar.common.policies.data.TenantInfo)", "TOT": 4, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.TenantsBase.createTenant(java.lang.String,org.apache.pulsar.common.policies.data.TenantInfo)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.TenantsBase.updateTenant(java.lang.String,org.apache.pulsar.common.policies.data.TenantInfo)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminTest.properties()", "TOT": 29, "UPD": 4, "INS": 10, "MOV": 12, "DEL": 3}]}, {"spoonFilePath": "MockedPulsarServiceBaseTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.auth.MockedPulsarServiceBaseTest.createDefaultTenantInfo()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ResendRequestTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ResendRequestTest.testExclusiveSingleAckedPartitionedTopic()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.ResendRequestTest.testSharedSingleAckedPartitionedTopic()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.ResendRequestTest.testFailoverSingleAckedPartitionedTopic()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "WebServiceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.web.WebServiceTest.testMaxRequestSize()", "TOT": 5, "UPD": 0, "INS": 5, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PatternTopicsConsumerImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testPatternTopicsSubscribeWithBuilderFail()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testBinaryProtoToGetTopicsOfNamespacePersistent()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testBinaryProtoToGetTopicsOfNamespaceNonPersistent()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testBinaryProtoToGetTopicsOfNamespaceAll()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testStartEmptyPatternConsumer()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testAutoSubscribePatternConsumer()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testAutoUnbubscribePatternConsumer()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "PerMessageUnAcknowledgedRedeliveryTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PerMessageUnAcknowledgedRedeliveryTest.testSharedAckedPartitionedTopic()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "TopicsConsumerImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TopicsConsumerImplTest.testDifferentTopicsNameSubscribe()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicsConsumerImplTest.testGetConsumersAndGetTopics()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicsConsumerImplTest.testSyncProducerAndConsumer()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicsConsumerImplTest.testAsyncConsumer()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicsConsumerImplTest.testConsumerUnackedRedelivery()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicsConsumerImplTest.testSubscribeUnsubscribeSingleTopic()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicsConsumerImplTest.testTopicsNameSubscribeWithBuilderFail()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicsConsumerImplTest.testMultiTopicsMessageListener()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicsConsumerImplTest.testTopicAutoUpdatePartitions()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicsConsumerImplTest.testGetLastMessageId()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "PulsarClientToolTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.cli.PulsarClientToolTest.testInitialzation()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ProxyParserTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyParserTest.testPartitions()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ProxyTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyTest.testPartitions()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ProxyTlsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyTlsTest.testPartitions()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "websocket meet 404 when create producer in standalone mode", "body": "**Describe the bug**\r\nThis issue is split from issue #5979, which reported by @jeffgrunewald \r\n\r\nI am attempting to build and run pulsar locally for development mode but I receive a 404 whenever attempting to connect to the websocket to create a producer due to a missing \"serviceUrl\" param. I have set this value to my local host/port in the conf/websocket.conf file but the result is the same. Is there somewhere else this should be set or an undocumented requirement for connecting from the websocket client?\r\n\r\nI have not experienced this issue when using the standard Pulsar docker image (apache/pulsar:latest) and running the command bin/pulsar standalone as the CMD directive.\r\n\r\nJust to be clear, I am attempting this off a clone of the tip of the master branch, not the latest release tarball. I do see in the logs the `ConsumerStatsRecorderImpl` Pulsar client config is listing the serviceUrl as `\"serviceUrl\" : \"pulsar://127.0.0.1:6650\"`. Are the current websocket client connection instructions accurate for the latest unreleased version?\r\n\r\nFor further context, I am writing a pulsar client library for the Elixir language based on the websocket api. My producer and consumer is connecting to the endpoint `ws://localhost:8080/ws/v2/producer/persistent...` where localhost is dynamically supplied as part of the client configuration and my dockerized pulsar for development purposes is mapping the default service port 8080 from the container to the host. \r\n\r\n\r\n\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5997", "user": "jiazhai", "labels": ["component/websocket", "triage/week-2", "type/bug"], "created": "2020-01-06 03:48:28", "closed": "2020-01-24 07:02:35", "commits": {"49a98972bd2aa8deef2f9a95cf7678bd1e6033a4": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "13b65f193082f1fcbc08e342083ffc0e1b5c74af": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 18.00027777777778, "commitsDetails": [{"commitHash": "49a98972bd2aa8deef2f9a95cf7678bd1e6033a4", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["ec122ed9562cffe7c98020a1acdc4e766f5d4d15"], "nameRev": "49a98972bd2aa8deef2f9a95cf7678bd1e6033a4 tags/v2.6.0-candidate-1~583", "commitMessage": " [Websocket] Websocket doesn't set the correct cluster data (#6102)\n\n*Motivation*\r\n\r\nFixes #5997\r\nFixes #6079\r\n\r\nA regression was introduced in #5486. If websocket service as running as part of\r\npulsar standalone, the cluster data is set with null service urls. This causes\r\nservice url is not set correctly in the pulsar client and an illegal argument exception\r\n(\"Param serviceUrl must not be blank.\") will be thrown.\r\n\r\n*Modifications*\r\n\r\n1. Pass `null` when constructing the websocket service. So the local cluster data can\r\n   be refreshed when creating pulsar client.\r\n2. Set the cluster data after both broker service and web service started and ports are allocated.", "commitDateTime": "2020-01-23 23:02:35", "authoredDateTime": "2020-01-23 23:02:35", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java", "insertions": 7, "deletions": 3, "lines": 10}, {"filePath": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/WebSocketService.java", "insertions": 2, "deletions": 0, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.PulsarService.start()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "WebSocketService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.websocket.WebSocketService", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "13b65f193082f1fcbc08e342083ffc0e1b5c74af", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["acdd987c18a38136ff511fab44cf90c692d88dca"], "nameRev": "13b65f193082f1fcbc08e342083ffc0e1b5c74af tags/v2.5.1-candidate-3~105", "commitMessage": " [Websocket] Websocket doesn't set the correct cluster data (#6102)\n\n*Motivation*\r\n\r\nFixes #5997\r\nFixes #6079\r\n\r\nA regression was introduced in #5486. If websocket service as running as part of\r\npulsar standalone, the cluster data is set with null service urls. This causes\r\nservice url is not set correctly in the pulsar client and an illegal argument exception\r\n(\"Param serviceUrl must not be blank.\") will be thrown.\r\n\r\n*Modifications*\r\n\r\n1. Pass `null` when constructing the websocket service. So the local cluster data can\r\n   be refreshed when creating pulsar client.\r\n2. Set the cluster data after both broker service and web service started and ports are allocated.\n\n(cherry picked from commit 49a98972bd2aa8deef2f9a95cf7678bd1e6033a4)\n", "commitDateTime": "2020-04-13 11:08:05", "authoredDateTime": "2020-01-23 23:02:35", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java", "insertions": 7, "deletions": 3, "lines": 10}, {"filePath": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/WebSocketService.java", "insertions": 2, "deletions": 0, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.PulsarService.start()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "WebSocketService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.websocket.WebSocketService", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[doc] The link of Pulsar Functions SDK for Java is 404", "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'https://pulsar.apache.org/docs/en/functions-overview/'\r\n2. Scroll down to 'Word count example'\r\n3. Click on 'Pulsar Functions SDK for Java'\r\n4. See error\r\n\r\n![\u56fe\u7247](https://user-images.githubusercontent.com/29513837/71793907-edfa4780-3079-11ea-923f-fe9dc697ed1f.png)\r\n", "url": "https://github.com/apache/pulsar/issues/5996", "user": "huangdx0726", "labels": ["component/documentation", "component/functions", "component/website", "triage/week-2", "type/bug"], "created": "2020-01-06 03:44:55", "closed": "2020-03-05 07:42:04", "commits": {}, "ttf": 59.000277777777775, "commitsDetails": []}, {"title": "k8s/EKS some Proxies fail to get Broker info from Zookeeper", "body": "![image](https://user-images.githubusercontent.com/588573/71786914-e014da00-3019-11ea-8632-19f3c4f78887.png)\r\n\r\n1 - seeing a lot of these errors during cluster init\r\n2 - this is a response to e.g. `bin/pulsar-admin topics list cb/test`, which on the console returns `HTTP 403 Forbidden`\r\n\r\nThis only happens on 1 or 2 out of 4 total Proxies in the cluster. The healthy Proxies return a correct response.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5994", "user": "youurayy", "labels": ["component/k8s", "triage/week-2", "type/bug"], "created": "2020-01-05 22:18:57", "closed": "2020-02-01 07:52:12", "commits": {"b838c59fcf43b4bdce65867e85c3871f6971f957": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "0d50cf9cebce9ce4a8254b5b1782959f5e01ff6e": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 26.00027777777778, "commitsDetails": [{"commitHash": "b838c59fcf43b4bdce65867e85c3871f6971f957", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["b8760d5c5688a68b5bd92770ab1bc7b1fbf0dc09"], "nameRev": "b838c59fcf43b4bdce65867e85c3871f6971f957 tags/v2.6.0-candidate-1~570", "commitMessage": "[Issue-5994]: Start proxy pods when at least one broker pod is running (#6158)\n\n### Motivation\r\nFixes #5994:\r\nIf the proxy service comes up before the brokers are up and reachable there will be HTTP 403 when running `bin/pulsar-admin` commands from inside the proxy pod.\r\n \r\nThe proxy will also not be able to connect to the brokers when data is pushed through binary port with the following error:\r\n```bash\r\nCaused by: org.apache.pulsar.broker.service.BrokerServiceException$PersistenceException: org.apache.bookkeeper.mledger.ManagedLedgerException: Not enough non-faulty bookies available\r\n\t... 14 more\r\nCaused by: org.apache.bookkeeper.mledger.ManagedLedgerException: Not enough non-faulty bookies available\r\n22:11:07.633 [pulsar-web-32-6] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.6 - - [24/Jan/2020:22:11:07 +0000] \"PUT /admin/v2/persistent/public/functions/assignments HTTP/1.1\" 500 2528 \"-\" \"Pulsar-Java-v2.5.0\" 280\r\n```\r\n\r\n#### Workaround:\r\nRestart the proxy pods once brokers pods are running\r\n\r\n#### Proposed solution:\r\nHold off starting of the proxies until at least one broker is reachable in the cluster. \r\n\r\n### Modifications\r\n\r\nChanges are inside `proxy-deployment.yaml` helm template file that defines a new init container before proxy is started. The init container waits until broker is reachable using the nslookup on the broker service with a sleep of 30 seconds between retries and up to number of brokers times.\r\n\r\nAlternative solution that doesn't always work was `'until nslookup broker-service; sleep 2; done;', but 403 would still sometimes (could have been a fluke, but I saw it happening once).\r\n\r\n### Verifying this change\r\n1) Follow the instructions on how deploying helm and run:\r\n`helm install pulsar --values pulsar/values-mini.yaml ./pulsar/`. \r\n2) Wait until all the services are up and running.  \r\n3) Connect to proxy pod and run `bin/pulsar-admin broker-stats monitoring-metrics` - no 403 or permission errors should arise\r\n4) Set up tenant, namespace\r\n5) Push data into a topic - No errors in the proxy logs and client is able to push data into cluster through proxies", "commitDateTime": "2020-01-31 23:52:11", "authoredDateTime": "2020-02-01 02:52:11", "commitGitStats": [{"filePath": "deployment/kubernetes/helm/pulsar/templates/proxy-deployment.yaml", "insertions": 16, "deletions": 1, "lines": 17}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "0d50cf9cebce9ce4a8254b5b1782959f5e01ff6e", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["ef7e99bf3b5a9ba723c0f8b576f60de4889a872e"], "nameRev": "0d50cf9cebce9ce4a8254b5b1782959f5e01ff6e tags/v2.5.1-candidate-3~98", "commitMessage": "[Issue-5994]: Start proxy pods when at least one broker pod is running (#6158)\n\n### Motivation\r\nFixes #5994:\r\nIf the proxy service comes up before the brokers are up and reachable there will be HTTP 403 when running `bin/pulsar-admin` commands from inside the proxy pod.\r\n \r\nThe proxy will also not be able to connect to the brokers when data is pushed through binary port with the following error:\r\n```bash\r\nCaused by: org.apache.pulsar.broker.service.BrokerServiceException$PersistenceException: org.apache.bookkeeper.mledger.ManagedLedgerException: Not enough non-faulty bookies available\r\n\t... 14 more\r\nCaused by: org.apache.bookkeeper.mledger.ManagedLedgerException: Not enough non-faulty bookies available\r\n22:11:07.633 [pulsar-web-32-6] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.6 - - [24/Jan/2020:22:11:07 +0000] \"PUT /admin/v2/persistent/public/functions/assignments HTTP/1.1\" 500 2528 \"-\" \"Pulsar-Java-v2.5.0\" 280\r\n```\r\n\r\n#### Workaround:\r\nRestart the proxy pods once brokers pods are running\r\n\r\n#### Proposed solution:\r\nHold off starting of the proxies until at least one broker is reachable in the cluster. \r\n\r\n### Modifications\r\n\r\nChanges are inside `proxy-deployment.yaml` helm template file that defines a new init container before proxy is started. The init container waits until broker is reachable using the nslookup on the broker service with a sleep of 30 seconds between retries and up to number of brokers times.\r\n\r\nAlternative solution that doesn't always work was `'until nslookup broker-service; sleep 2; done;', but 403 would still sometimes (could have been a fluke, but I saw it happening once).\r\n\r\n### Verifying this change\r\n1) Follow the instructions on how deploying helm and run:\r\n`helm install pulsar --values pulsar/values-mini.yaml ./pulsar/`. \r\n2) Wait until all the services are up and running.  \r\n3) Connect to proxy pod and run `bin/pulsar-admin broker-stats monitoring-metrics` - no 403 or permission errors should arise\r\n4) Set up tenant, namespace\r\n5) Push data into a topic - No errors in the proxy logs and client is able to push data into cluster through proxies\n\n(cherry picked from commit b838c59fcf43b4bdce65867e85c3871f6971f957)\n", "commitDateTime": "2020-04-13 11:08:38", "authoredDateTime": "2020-02-01 02:52:11", "commitGitStats": [{"filePath": "deployment/kubernetes/helm/pulsar/templates/proxy-deployment.yaml", "insertions": 16, "deletions": 1, "lines": 17}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Helm deployment fails to deploy properly", "body": "**Describe the bug**\r\nUnable to get Pulsar working correctly following the helm deployments.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Follow instructions on [helm deployment](https://github.com/apache/pulsar/tree/master/deployment/kubernetes/helm)\r\n2. Try to add a new environment from Pulsar admin manager\r\n\r\n**Expected behavior**\r\nExpect Pulsar to come up & be able to use pulsar admin manager to add new environment.\r\n\r\nFor what I can see in K8 the proxy isn't being exposed properly on the network. Unable to use the minikube ip address for port 30001.\r\n", "url": "https://github.com/apache/pulsar/issues/5992", "user": "ckdarby", "labels": ["component/k8s", "triage/week-2", "type/bug"], "created": "2020-01-05 16:56:55", "closed": "2020-04-16 02:14:29", "commits": {}, "ttf": 101.00027777777778, "commitsDetails": []}, {"title": "Consumer negative acknowledgement not working", "body": "**Describe the bug**\r\nAccording to doc, `When a consumer does not consume a message successfully at a time, and wants to consume the message again, the consumer can send a negative acknowledgement to the broker, and then the broker will redeliver the message.`\r\n\r\nIf I log the message and **negative-acknowledge** it afterwards, shouldn't it be redeliver back to the consumer on the next **receceive()** poll?\r\n\r\n**To Reproduce**\r\nBelow is a simple consumer testing code.\r\n```\r\n    Consumer<byte[]> consumer =\r\n        client\r\n            .newConsumer()\r\n            .subscriptionType(SubscriptionType.Key_Shared)\r\n            .subscriptionName(\"ks-test\")\r\n            .topic(\"test-topic\")\r\n            .subscribe();\r\n    while (true) {\r\n      Message<byte[]> message = consumer.receive(100, TimeUnit.MILLISECONDS);\r\n      if (message != null) {\r\n        System.out.println(new String(message.getData()));\r\n        consumer.negativeAcknowledge(message);\r\n      }\r\n    }\r\n\r\n```\r\n\r\n**Expected behavior**\r\nI expect to see the same message reprinted over and over as in the below screenshot\r\n\r\n![correct](https://user-images.githubusercontent.com/14175735/71762980-6f14db80-2ece-11ea-9b61-fa4376fcc354.png)\r\n\r\nHowever, I'm seeing this. No message redelivery. Redelivery happens only after `ConsumerBuilder.ackTimeout()` expires. This tells me, the negative acknowledgement is actually not acking. Am I missing something on the consumer API?\r\n\r\n![wrong](https://user-images.githubusercontent.com/14175735/71763005-bdc27580-2ece-11ea-858f-983a0d27e7a9.png)\r\n\r\n**Environment**\r\n - OS: Ubuntu\r\n - Pulser Vserion: 2.4.1\r\n - Java Client Version: 2.4.2\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5991", "user": "alphashaw", "labels": ["type/bug"], "created": "2020-01-04 08:51:04", "closed": "2020-01-04 20:38:59", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "one small barrier in starting the standalone cluster", "body": "**Describe the bug**\r\nWhen I started a local standalone cluster according to the documentation, I encountered a small problem that the standalone cluster start failure.\r\nUsing the following command\r\n```shell\r\nbin/pulsar standalone\r\n```\r\nThe error message is as follows:\r\n```shell\r\nCaused by: java.net.UnknownHostException: failed to resolve 'pdeMacBook-Pro.local' after 4 queries\r\n\tat io.netty.resolver.dns.DnsResolveContext.finishResolve(DnsResolveContext.java:848) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.resolver.dns.DnsResolveContext.tryToFinishResolve(DnsResolveContext.java:809) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n```shell\r\nwget https://archive.apache.org/dist/pulsar/pulsar-2.4.2/apache-pulsar-2.4.2-bin.tar.gz\r\ntar xvfz apache-pulsar-2.4.2-bin.tar.gz\r\nbin/pulsar standalone\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Mac OS\r\n\r\n**Additional context**\r\nActually, I have solved this problem by editing \"advertisedAddress\" configuration in standalone.conf.\r\n", "url": "https://github.com/apache/pulsar/issues/5983", "user": "fangpengcheng95", "labels": ["help wanted", "triage/week-2", "type/bug"], "created": "2020-01-03 08:53:38", "closed": "2020-01-23 08:29:31", "commits": {}, "ttf": 19.00027777777778, "commitsDetails": []}, {"title": "Acked messages unexpectedly redelivered when others are negatively acked", "body": "**Describe the bug**\r\n\r\nWe've encountered an issue in which acknowledged messages are redelivered one or more times after other messages are negatively acknowledged. This seems to occur when messages are produced in batches. This happens in the absence of any known broker or connection failures.\r\n\r\n**To Reproduce**\r\n\r\nI've modified the `NegativeAcksTest` to test for the correct behavior here: https://github.com/apache/pulsar/compare/master...gmethvin:negative-ack-duplicates\r\n\r\nAs the test demonstrates, in some configurations positively acknowledged messages are redelivered. This is similar to a situation we see in production.\r\n\r\n**Expected behavior**\r\n\r\nOnly the negatively acknowledged messages should be redelivered. Positively acknowledged messages should not be redelivered, at least not in a typical situation with no failures.\r\n\r\nWe produce messages in batches, but both the APIs and the documentation suggest that both acks and negative acks act on a per-message level. If negative acks act on batches, then the APIs and documentation should be changed to clearly indicate that.\r\n", "url": "https://github.com/apache/pulsar/issues/5969", "user": "gmethvin", "labels": ["triage/week-1", "type/bug"], "created": "2019-12-31 04:48:45", "closed": "2020-06-02 01:01:18", "commits": {"aa0fbb0d31d36f383054d93e3684de79879c430c": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 153.00027777777777, "commitsDetails": [{"commitHash": "aa0fbb0d31d36f383054d93e3684de79879c430c", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["9cdf3fce30d7dc163d2cd76e7f101b1497a99c8f"], "nameRev": "aa0fbb0d31d36f383054d93e3684de79879c430c tags/v2.6.0-candidate-1~91", "commitMessage": "[PIP-54] Support acknowledgment at batch index level (#6052)\n\nMaster issue: #6253\r\nFixes #5969\r\n\r\n### Motivation\r\n\r\nAdd support for ack batch message local index. Can be disabled at broker side by set batchIndexAcknowledgeEnable=false at broker.conf\r\n\r\nPIP-54 documentation will be created soon.\r\n\r\n### Modifications\r\n\r\n1. Managed cursor support track and persistent local index of batch message.\r\n2. Client support send batch index ack to broker.\r\n3. The batch messages with index ack information dispatched to the client.\r\n4. Client skip the acked index.\r\n\r\n### Verifying this change\r\n\r\nNew unit tests added", "commitDateTime": "2020-06-01 18:01:17", "authoredDateTime": "2020-06-02 09:01:17", "commitGitStats": [{"filePath": "buildtools/src/main/resources/pulsar/suppressions.xml", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "conf/broker.conf", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/ManagedCursor.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/ManagedLedgerConfig.java", "insertions": 17, "deletions": 0, "lines": 17}, {"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java", "insertions": 138, "deletions": 14, "lines": 152}, {"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/PositionImpl.java", "insertions": 11, "deletions": 0, "lines": 11}, {"filePath": "managed-ledger/src/main/proto/MLDataFormats.proto", "insertions": 12, "deletions": 1, "lines": 13}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedCursorContainerTest.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedCursorTest.java", "insertions": 135, "deletions": 0, "lines": 135}, {"filePath": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractBaseDispatcher.java", "insertions": 11, "deletions": 1, "lines": 12}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java", "insertions": 32, "deletions": 9, "lines": 41}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/EntryBatchIndexesAcks.java", "insertions": 71, "deletions": 0, "lines": 71}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentDispatcherMultipleConsumers.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentDispatcherSingleActiveConsumer.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentStickyKeyDispatcherMultipleConsumers.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/CompactorSubscription.java", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherMultipleConsumers.java", "insertions": 5, "deletions": 3, "lines": 8}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherSingleActiveConsumer.java", "insertions": 4, "deletions": 2, "lines": 6}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentStickyKeyDispatcherMultipleConsumers.java", "insertions": 5, "deletions": 3, "lines": 8}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentSubscription.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java", "insertions": 1, "deletions": 2, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/client/impl/RawReaderImpl.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/ServerCnxTest.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentStickyKeyDispatcherMultipleConsumersTest.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/BatchMessageIndexAckDisableTest.java", "insertions": 148, "deletions": 0, "lines": 148}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/BatchMessageIndexAckTest.java", "insertions": 184, "deletions": 0, "lines": 184}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/CompactedOutBatchMessageTest.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/AcknowledgmentsGroupingTracker.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageIdImpl.java", "insertions": 6, "deletions": 2, "lines": 8}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ClientCnx.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 18, "deletions": 5, "lines": 23}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/NonPersistentAcknowledgmentGroupingTracker.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PersistentAcknowledgmentsGroupingTracker.java", "insertions": 89, "deletions": 15, "lines": 104}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ZeroQueueConsumerImpl.java", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/BatchMessageIdImplTest.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/proto/PulsarApi.java", "insertions": 198, "deletions": 0, "lines": 198}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Commands.java", "insertions": 27, "deletions": 9, "lines": 36}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/util/SafeCollectionUtils.java", "insertions": 39, "deletions": 0, "lines": 39}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/BitSetRecyclable.java", "insertions": 1209, "deletions": 0, "lines": 1209}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentBitSet.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentBitSetRecyclable.java", "insertions": 50, "deletions": 0, "lines": 50}, {"filePath": "pulsar-common/src/main/proto/PulsarApi.proto", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-common/src/test/java/org/apache/pulsar/common/util/collections/BitSetRecyclableRecyclableTest.java", "insertions": 48, "deletions": 0, "lines": 48}, {"filePath": "pulsar-common/src/test/java/org/apache/pulsar/common/util/collections/ConcurrentBitSetRecyclableTest.java", "insertions": 37, "deletions": 0, "lines": 37}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyFiles"}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Vagrantfile problem", "body": "**Describe the bug**\r\nWhen I try to setup the vm environment, and build the project. I failed because zip/unzip tools are not installed.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Clear your pulsar environment\r\n2. cd dev/ \r\n3. vargrant up; vagrant ssh\r\n4. cd /pulsar\r\n5. mvn test\r\n\r\n**Expected behavior**\r\nBuild failure because of Pulsar Shaded Broker depends on zip/unzip tool.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: macos\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5967", "user": "zuquan-song", "labels": ["type/bug"], "created": "2019-12-30 22:21:05", "closed": "2020-01-01 00:28:41", "commits": {"babce5e02c9b82ae10947ba81ef46748c6f2c85a": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "babce5e02c9b82ae10947ba81ef46748c6f2c85a", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["757d971b647ccc8b57051aebc8f72323919af7f1"], "nameRev": "babce5e02c9b82ae10947ba81ef46748c6f2c85a tags/v2.5.0-candidate-2~15", "commitMessage": "Vagrantfile update for build dependency (#5968)\n\nFixes #5967\r\n\r\n### Motivation\r\nCannot build the project successfully.\r\n\r\n### Modifications\r\nAdd install commands to install the unzip zip tools when vm sets up", "commitDateTime": "2020-01-01 08:28:40", "authoredDateTime": "2019-12-31 19:28:40", "commitGitStats": [{"filePath": "dev/Vagrantfile", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Proof-read test \"sql-getting-started\"", "body": "Proof-read \"sql-getting-started\" under the directory site2\\docs ", "url": "https://github.com/apache/pulsar/issues/5963", "user": "xiaojieshi", "labels": ["type/bug"], "created": "2019-12-30 08:26:07", "closed": "2020-01-14 12:44:46", "commits": {}, "ttf": 15.000277777777777, "commitsDetails": []}, {"title": "After stopping the bookie and recovering, it can be produced at this time, but cannot be consumed normally. Restarting the broker can resume normal", "body": "**Describe the bug**\r\nTopic(E=3,W=3,A=2), stopped 2 bookie nodes, then recover the 2 bookie, \r\nThe message can be produced normally, but the consumer cannot pull the message unless the broker is restarted.\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. sh pulsar-daemon stop bookie -- A \r\n2. sh pulsar-daemon stop bookie -- B\r\n3. production message, return result is normal\r\n4. consumers have been unable to pull news", "url": "https://github.com/apache/pulsar/issues/5962", "user": "liudezhi2098", "labels": ["triage/week-1", "type/bug"], "created": "2019-12-30 08:25:44", "closed": "2020-01-03 12:58:14", "commits": {"dcaa1d350fec920ef0ba32b4aeecd2e9604d4824": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "dcaa1d350fec920ef0ba32b4aeecd2e9604d4824", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["cff311c264430e0490a158c442eed3c9b1b2521a"], "nameRev": "dcaa1d350fec920ef0ba32b4aeecd2e9604d4824 tags/v2.5.0-candidate-2~7", "commitMessage": "fix  2 copies of 3bookie and stop 2 booksie after production. After the entire bookie is restored, it can be produced at this time, and the produced data cannot be consumed normally. Restarting the broker can resume normal (#5965)\n\nAfter stopping the bookie and recovering, it can be produced at this time, but cannot be consumed normally. Restarting the broker can resume normal\r\n\r\nFixes #5962\r\n\r\nMotivation\r\nproblem :\r\nTopic(E=3,W=3,A=2), stopped 2 bookie nodes, then recover the 2 bookie,\r\nThe message can be produced normally, but the consumer cannot pull the message unless the broker is restarted.\r\nWe hope that the bookie summary will resume normal consumption\r\n\r\nModifications\r\nThe main cause of this problem is that readHandle.readAsync does not catch the exception,\r\ncausing some methods to not trigger.\r\ntherefore, added the exception capture module , and the exceptions involved in the bookeeper project are also fixed.", "commitDateTime": "2020-01-03 20:58:12", "authoredDateTime": "2020-01-03 20:58:12", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/EntryCacheImpl.java", "insertions": 17, "deletions": 2, "lines": 19}, {"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/EntryCacheManager.java", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "EntryCacheImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.EntryCacheImpl.asyncReadEntry0(org.apache.bookkeeper.client.api.ReadHandle,org.apache.bookkeeper.mledger.impl.PositionImpl,org.apache.bookkeeper.mledger.AsyncCallbacks.ReadEntryCallback,java.lang.Object)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.EntryCacheImpl.asyncReadEntry0(org.apache.bookkeeper.client.api.ReadHandle,long,long,boolean,org.apache.bookkeeper.mledger.AsyncCallbacks.ReadEntriesCallback,java.lang.Object)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "EntryCacheManager.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.EntryCacheManager.EntryCacheDisabled.asyncReadEntry(org.apache.bookkeeper.client.api.ReadHandle,long,long,boolean,org.apache.bookkeeper.mledger.AsyncCallbacks.ReadEntriesCallback,java.lang.Object)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "unknown field \"requests\" in io.k8s.api.core.v1.Container", "body": "**Describe the bug**\r\n\r\n```\r\nError: unable to build kubernetes objects from release manifest: error validating \"\": error validating data: ValidationError(Deployment.spec.template.spec.containers[0]): unknown field \"requests\" in io.k8s.api.core.v1.Container\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\n1. helm install test-pulsar --values ./pulsar/values.yaml ./pulsar\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Mac os\r\n\r\n**Additional context**\r\n\r\n```\r\n$ helm version\r\n\r\nversion.BuildInfo{Version:\"v3.0.2\", GitCommit:\"19e47ee3283ae98139d98460de796c1be1e3975f\", GitTreeState:\"clean\", GoVersion:\"go1.13.5\"}\r\n```\r\n\r\n```\r\n$kubectl version\r\n\r\nClient Version: version.Info{Major:\"1\", Minor:\"16\", GitVersion:\"v1.16.3\", GitCommit:\"b3cbbae08ec52a7fc73d334838e18d17e8512749\", GitTreeState:\"clean\", BuildDate:\"2019-11-14T04:24:34Z\", GoVersion:\"go1.12.13\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"15\", GitVersion:\"v1.15.5\", GitCommit:\"20c265fef0741dd71a66480e35bd69f18351daea\", GitTreeState:\"clean\", BuildDate:\"2019-10-15T19:07:57Z\", GoVersion:\"go1.12.10\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/5958", "user": "wolfstudy", "labels": ["component/k8s", "triage/week-1", "type/bug"], "created": "2019-12-30 06:28:57", "closed": "2020-01-03 07:14:10", "commits": {"c76c19e7a4adc31e2da35920e6a2b8bb7a13cc1a": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "c76c19e7a4adc31e2da35920e6a2b8bb7a13cc1a", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["c7cdfa8d1310b06b31dc48c185dcd7a161760f9d"], "nameRev": "c76c19e7a4adc31e2da35920e6a2b8bb7a13cc1a tags/v2.6.0-candidate-1~568", "commitMessage": "[Issue-5958][helm]: Fixing templates for helm deployment (#6148)\n\nMotivation:\r\nFixes #5958: \r\n\r\nThe following error appears when trying to deploy Pulsar using helm and values-mini.yaml: \r\n\r\n```unable to build kubernetes objects from release manifest: error validating \"\": error validating data: ValidationError(Deployment.spec.template.spec.containers[0]): unknown field \"requests\" in io.k8s.api.core.v1.Container``` \r\n\r\nCause:\r\nMistake in the `pulsar-manager-deployment.yaml` deployment file:\r\n\r\nFirst line **63** should be:\r\n`{{- if .Values.pulsar_manager.resources }}` and it is currently `{{- if .Values.grafana.resources }}`\r\n\r\nThere is also a mistake at line **65**:\r\n`{{ toYaml .Values.grafana.resources | indent 10 }}` should be `{{ toYaml .Values.pulsar_manager.resources | indent 12 }}`\r\n\r\nModifications:\r\nChanged values in `values.yaml` and `templates/pulsar-manager-deployment.yaml`\r\n\r\nTest:\r\nDeploy the application into a kubernetes local cluster with\r\n`helm install pulsar-cluster --values pulsar/values-mini.yaml pulsar`\r\n\r\nAND\r\n\r\n`helm install pulsar-cluster --values pulsar/values.yaml pulsar`\r\n\r\nDocumentation:\r\nDoes this pull request introduce a new feature? - **No**", "commitDateTime": "2020-01-31 23:56:09", "authoredDateTime": "2020-02-01 02:56:09", "commitGitStats": [{"filePath": "deployment/kubernetes/helm/pulsar/templates/pulsar-manager-deployment.yaml", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "deployment/kubernetes/helm/pulsar/values.yaml", "insertions": 5, "deletions": 5, "lines": 10}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "ConcurrentModificationException in ModularLoadManagerImpl", "body": "**Describe the bug**\r\n\r\nSaw the following exception thrown in broker:\r\n\r\n```\r\n01:47:04.243 [pulsar-load-manager-6-1] WARN  org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl - Error writing broker data on ZooKeeper: {}\r\njava.util.ConcurrentModificationException: null\r\n        at java.util.HashMap$HashIterator.nextNode(HashMap.java:1445) ~[?:1.8.0_212]\r\n        at java.util.HashMap$EntryIterator.next(HashMap.java:1479) ~[?:1.8.0_212]\r\n        at java.util.HashMap$EntryIterator.next(HashMap.java:1477) ~[?:1.8.0_212]\r\n        at org.apache.pulsar.policies.data.loadbalancer.LocalBrokerData.updateBundleData(LocalBrokerData.java:175) ~[org.apache.pulsar-pulsar-common-2.4.1-streamlio-6.jar:2.4.1-streamlio-6]\r\n        at org.apache.pulsar.policies.data.loadbalancer.LocalBrokerData.update(LocalBrokerData.java:133) ~[org.apache.pulsar-pulsar-common-2.4.1-streamlio-6.jar:2.4.1-streamlio-6]\r\n        at org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl.writeBrokerDataOnZooKeeper(ModularLoadManagerImpl.java:876) [org.apache.pulsar-pulsar-broker-2.4.1-streamlio-6.jar:2.4.1-streamlio-6]\r\n        at org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerWrapper.writeLoadReportOnZookeeper(ModularLoadManagerWrapper.java:120) [org.apache.pulsar-pulsar-broker-2.4.1-streamlio-6.jar:2.4.1-streamlio-6]\r\n        at org.apache.pulsar.broker.loadbalance.LoadReportUpdaterTask.run(LoadReportUpdaterTask.java:41) [org.apache.pulsar-pulsar-broker-2.4.1-streamlio-6.jar:2.4.1-streamlio-6]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_212]\r\n        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [?:1.8.0_212]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_212]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [?:1.8.0_212]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n```\r\n\r\n**To Reproduce**\r\n\r\nNot sure\r\n", "url": "https://github.com/apache/pulsar/issues/5952", "user": "jerrypeng", "labels": ["triage/week-1", "type/bug"], "created": "2019-12-30 03:39:45", "closed": "2020-01-02 06:40:16", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "PulsarIO Sink \"topics-pattern\" regex is not filtering inputs topics correctly", "body": "**Describe the bug**\r\nPulsarIO Sink \"topics-pattern\" regex is not working as expected\r\n\r\n**To Reproduce**\r\nWe have two topics:\r\n\r\n1. ://public/default/topic1\r\n2. ://public/default/topic2\r\n\r\nWe are using the builtin **influxdb connector,** so check to have it installed before try to reproduce the behaviour. \r\n\r\nSteps to reproduce the behavior:\r\n1. We would like to create a new sink using a regex topic-pattern that has as inputs both topic1 and topic2 and all the topics that start with the character \"t\" using the pattern \"t.*\". So, create the Sink using the following command\r\n`pulsar-admin sinks create --tenant public --namespace default --name test-sink --sink-type influxdb  --sink-config-file influxdb.yaml  --topics-pattern \"t.*`\r\n\r\nThis is the influxdb.yaml configuration\r\n`configs:\r\n  influxdbUrl: \"http://localhost:8086\"\r\n  database: \"test_db\"\r\n  username: \"admin\"\r\n  password: \"Oncode01\"\r\n  consistencyLevel: \"ONE\"\r\n  logLevel: \"NONE\"\r\n  retentionPolicy: \"autogen\"\r\n  gzipEnable: true\r\n  batchTimeMs: 1000\r\n  batchSize: 200`\r\n\r\n2. I expcted to have as inputs both topic1 and topic2 but there are no topics as input\r\n3. If I use as topic pattern only \".*\" using this command\r\n`pulsar-admin sinks create --tenant public --namespace default --name test-sink --sink-type influxdb  --sink-config-file influxdb.yaml  --topics-pattern \"t.*` and the same influxdb.yaml configuration I have correctly topic1 and topic2 as inputs\r\n\r\n**Expected behavior**\r\nThe expected behaviour is to have both topic1 and topic2 as the sink inputs.\r\n\r\nI suspect this is a bug since I tried with many others regex pattern and no one is working. Only \".*\" is working. \r\n", "url": "https://github.com/apache/pulsar/issues/5944", "user": "nicolo-paganin", "labels": ["type/bug"], "created": "2019-12-26 12:42:13", "closed": "2019-12-26 14:40:43", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Is georeplication docs outdated since PIP-33 was released?", "body": "The [site](https://github.com/apache/pulsar/blob/master/site2/docs/administration-geo.md#subscriptions-are-local-to-a-cluster) says:\r\n\r\n> Subscriptions are local to a cluster\r\n> While producers and consumers can publish to and consume from any cluster in a Pulsar instance, subscriptions are local to the clusters in which the subscriptions are created and cannot be transferred between clusters. If you do need to transfer a subscription, you need to create a new subscription in the desired cluster.\r\n\r\nShould this be updated since [PIP-33](https://github.com/apache/pulsar/wiki/PIP-33%3A-Replicated-subscriptions) was released in 2.4.0?\r\n\r\nMy understanding is since PIP-33 was released then subscriptions are replicated so a consumer can fail over?", "url": "https://github.com/apache/pulsar/issues/5924", "user": "ograycode", "labels": ["component/documentation", "triage/week-16", "type/bug"], "created": "2019-12-23 17:11:30", "closed": "2020-06-09 23:07:44", "commits": {"96258f818cd9cf14777cad1d9ee6993cfc2b6860": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 169.00027777777777, "commitsDetails": [{"commitHash": "96258f818cd9cf14777cad1d9ee6993cfc2b6860", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["59f160792a6335988c8604e15345e234ef06acb3"], "nameRev": "96258f818cd9cf14777cad1d9ee6993cfc2b6860 master~76", "commitMessage": "[Issue 5924] [Doc]--Update geo-replication doc. (#7227)\n\nFixes #5924\r\n\r\n\r\n### Motivation\r\n\r\nSince PIP-33, we can configure a subscription to be replicated. hence it supports both local subscription and replicated subscription.\r\n\r\nThese updates are based on updates for the master, which have been approved and merged.\r\nThe following releases are updated: releases 2.5.2--2.4.0\r\n\r\n### Modifications\r\nFor releases 2.5.2--2.5.0: \r\nUpdate the administration > geo-replication: remove the remove the original note, which emphasize supporting local subscription only.\r\n\r\nFor releases 2.4.2--2.4.0:\r\nUpdate the administration > geo-replication: remove the remove the original note, which emphasize supporting local subscription only.\r\n\r\nUpdate the administration > geo-replication: add the replicated subscriptions and its sub sections, which are available for releases 2.5.0 and later releases.\r\n\r\n", "commitDateTime": "2020-06-16 10:23:23", "authoredDateTime": "2020-06-16 10:23:23", "commitGitStats": [{"filePath": "site2/website/versioned_docs/version-2.4.0/administration-geo.md", "insertions": 157, "deletions": 0, "lines": 157}, {"filePath": "site2/website/versioned_docs/version-2.4.1/administration-geo.md", "insertions": 157, "deletions": 0, "lines": 157}, {"filePath": "site2/website/versioned_docs/version-2.4.2/administration-geo.md", "insertions": 156, "deletions": 0, "lines": 156}, {"filePath": "site2/website/versioned_docs/version-2.5.0/administration-geo.md", "insertions": 1, "deletions": 2, "lines": 3}, {"filePath": "site2/website/versioned_docs/version-2.5.1/administration-geo.md", "insertions": 157, "deletions": 0, "lines": 157}, {"filePath": "site2/website/versioned_docs/version-2.5.2/administration-geo.md", "insertions": 157, "deletions": 0, "lines": 157}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "pop up \"Templating init failed \" when querying topics on grafana dashboard", "body": "**Describe the bug**\r\nversion: 2.4.2\r\nbug: pop up \"Templating init failed \" when querying topics on grafana dashboard, deployed by kubernetes.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'http://k8s_node_ip:grafana_node_port/dashboard/file/topic.json?refresh=5s&orgId=1'\r\n2. See error\r\n![image](https://user-images.githubusercontent.com/18047329/71344796-71a63580-259e-11ea-9952-0c6f950d447c.png)\r\n", "url": "https://github.com/apache/pulsar/issues/5918", "user": "dockerzhang", "labels": ["type/bug"], "created": "2019-12-23 08:13:07", "closed": "2020-04-14 09:12:21", "commits": {}, "ttf": 113.00027777777778, "commitsDetails": []}, {"title": "\"UNAVAILABLE: io exception\" pulsar functions", "body": "Pulsar functions keeps crashing in localrun and in cluster mode. \r\nI'm trying to execute a simple word count python [function](https://github.com/apache/pulsar/blob/master/pulsar-functions/python-examples/wordcount_function.py) but it never successfully executes.\r\n\r\n**Execution command**\r\n./pulsar-admin functions localrun --py  /home/vagrant/python_scripts/example_function.py --classname WordCountFunction --tenant test --namespace test --name excfunc --inputs persistent://test/test/test1 --output persistent://test/test/test2\r\n\r\n**Log from functions status**\r\n```\r\n{\r\n  \"numInstances\" : 1,\r\n  \"numRunning\" : 0,\r\n  \"instances\" : [ {\r\n    \"instanceId\" : 0,\r\n    \"status\" : {\r\n      \"running\" : false,\r\n      \"error\" : \"UNAVAILABLE: io exception\",\r\n      \"numRestarts\" : 0,\r\n      \"numReceived\" : 0,\r\n      \"numSuccessfullyProcessed\" : 0,\r\n      \"numUserExceptions\" : 0,\r\n      \"latestUserExceptions\" : [ ],\r\n      \"numSystemExceptions\" : 0,\r\n      \"latestSystemExceptions\" : [ ],\r\n      \"averageLatency\" : 0.0,\r\n      \"lastInvocationTime\" : 0,\r\n      \"workerId\" : \"c-standalone-fw-localhost-8080\"\r\n    }\r\n  } ]\r\n}\r\n```\r\n**Log from localrun**\r\n```\r\n23:10:47.895 [function-timer-thread-3-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully\r\n23:10:47.903 [Timer-0] INFO  org.apache.pulsar.functions.LocalRunner - {\r\n  \"numRestarts\": \"4\",\r\n  \"instanceId\": \"0\"\r\n}\r\n2019-12-20 23:10:48.127 INFO  ConnectionPool:85 | Created connection for pulsar://localhost:6650\r\n2019-12-20 23:10:48.128 INFO  ClientConnection:324 | [127.0.0.1:39360 -> 127.0.0.1:6650] Connected to broker\r\n2019-12-20 23:10:48.131 INFO  BatchMessageContainer:43 | { BatchContainer [size = 0] [batchSizeInBytes_ = 0] [maxAllowedMessageBatchSizeInBytes_ = 131072] [maxAllowedNumMessagesInBatch_ = 1000] [topicName = persistent://test/test/log] [producerName_ = ] [batchSizeInBytes_ = 0] [numberOfBatchesSent = 0] [averageBatchSize = 0]} BatchMessageContainer constructed\r\n2019-12-20 23:10:48.131 INFO  HandlerBase:53 | [persistent://test/test/log, ] Getting connection from pool\r\n2019-12-20 23:10:48.134 INFO  ProducerImpl:151 | [persistent://test/test/log, ] Created producer on broker [127.0.0.1:39360 -> 127.0.0.1:6650]\r\n2019-12-20 23:10:48.136 INFO  Client:88 | Subscribing on Topic :persistent://test/test/test1\r\n2019-12-20 23:10:48.138 INFO  HandlerBase:53 | [persistent://test/test/test1, test/test/excfunc, 0] Getting connection from pool\r\n2019-12-20 23:10:48.143 INFO  ConsumerImpl:170 | [persistent://test/test/test1, test/test/excfunc, 0] Created consumer on broker [127.0.0.1:39360 -> 127.0.0.1:6650]\r\n^C23:11:07.717 [Thread-1] INFO  org.apache.pulsar.functions.LocalRunner - Shutting down the localrun runtimeSpawner ...\r\n[vagrant@localhost bin]$ clear\r\n[vagrant@localhost bin]$ ./pulsar-admin functions localrun --py /home/vagrant/python_scripts/example_function.py --classname WordCountFunction --tenant test --namespace test --name excfunc --inputs persistent://test/test/test1 --output persistent://test/test/test2 --log-topic persistent://test/test/log\r\n23:11:14.305 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntimeFactory - Java instance jar location is not defined, using the location defined in system environment : /home/vagrant/apache-pulsar-2.4.2/instances/java-instance.jar\r\n23:11:14.309 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntimeFactory - Python instance file location is not defined using the location defined in system environment : /home/vagrant/apache-pulsar-2.4.2/instances/python-instance/python_instance_main.py\r\n23:11:14.310 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntimeFactory - No extra dependencies location is defined in either function worker config or system environment\r\n23:11:14.463 [main] INFO  org.apache.pulsar.functions.runtime.RuntimeSpawner - test/test/excfunc-0 RuntimeSpawner starting function\r\n23:11:14.464 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Creating function log directory /home/vagrant/apache-pulsar-2.4.2/logs/functions/test/test/excfunc\r\n23:11:14.466 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Created or found function log directory /home/vagrant/apache-pulsar-2.4.2/logs/functions/test/test/excfunc\r\n23:11:14.466 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - ProcessBuilder starting the process with args python /home/vagrant/apache-pulsar-2.4.2/instances/python-instance/python_instance_main.py --py /home/vagrant/python_scripts/example_function.py --logging_directory /home/vagrant/apache-pulsar-2.4.2/logs/functions --logging_file excfunc --logging_config_file /home/vagrant/apache-pulsar-2.4.2/conf/functions-logging/logging_config.ini --instance_id 0 --function_id bda8a6b3-7cb2-4d79-9602-7c164eb0aaef --function_version 683af9f6-4c2e-4e5b-888f-6bc5787cdb5e --function_details '{\"tenant\":\"test\",\"namespace\":\"test\",\"name\":\"excfunc\",\"className\":\"WordCountFunction\",\"logTopic\":\"persistent://test/test/log\",\"runtime\":\"PYTHON\",\"autoAck\":true,\"parallelism\":1,\"source\":{\"inputSpecs\":{\"persistent://test/test/test1\":{}},\"cleanupSubscription\":true},\"sink\":{\"topic\":\"persistent://test/test/test2\"},\"resources\":{\"cpu\":1.0,\"ram\":\"1073741824\",\"disk\":\"10737418240\"},\"componentType\":\"FUNCTION\"}' --pulsar_serviceurl pulsar://localhost:6650 --use_tls false --tls_allow_insecure false --hostname_verification_enabled false --max_buffered_tuples 1024 --port 33446 --metrics_port 32789 --expected_healthcheck_interval 30 --secrets_provider secretsprovider.ClearTextSecretsProvider --cluster_name local\r\n23:11:14.486 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully\r\n2019-12-20 23:11:14.957 INFO  ConnectionPool:85 | Created connection for pulsar://localhost:6650\r\n2019-12-20 23:11:14.958 INFO  ClientConnection:324 | [127.0.0.1:39378 -> 127.0.0.1:6650] Connected to broker\r\n2019-12-20 23:11:14.962 INFO  BatchMessageContainer:43 | { BatchContainer [size = 0] [batchSizeInBytes_ = 0] [maxAllowedMessageBatchSizeInBytes_ = 131072] [maxAllowedNumMessagesInBatch_ = 1000] [topicName = persistent://test/test/log] [producerName_ = ] [batchSizeInBytes_ = 0] [numberOfBatchesSent = 0] [averageBatchSize = 0]} BatchMessageContainer constructed\r\n2019-12-20 23:11:14.962 INFO  HandlerBase:53 | [persistent://test/test/log, ] Getting connection from pool\r\n2019-12-20 23:11:14.965 INFO  ProducerImpl:151 | [persistent://test/test/log, ] Created producer on broker [127.0.0.1:39378 -> 127.0.0.1:6650]\r\n2019-12-20 23:11:14.967 INFO  Client:88 | Subscribing on Topic :persistent://test/test/test1\r\n2019-12-20 23:11:14.969 INFO  HandlerBase:53 | [persistent://test/test/test1, test/test/excfunc, 0] Getting connection from pool\r\n2019-12-20 23:11:14.971 INFO  ConsumerImpl:170 | [persistent://test/test/test1, test/test/excfunc, 0] Created consumer on broker [127.0.0.1:39378 -> 127.0.0.1:6650]\r\n23:11:15.046 [main] INFO  org.apache.pulsar.functions.LocalRunner - RuntimeSpawner quit because of\r\n23:11:17.879 [function-timer-thread-3-1] ERROR org.apache.pulsar.functions.runtime.ProcessRuntime - Extracted Process death exception\r\njava.lang.RuntimeException:\r\n\tat org.apache.pulsar.functions.runtime.ProcessRuntime.tryExtractingDeathException(ProcessRuntime.java:381) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.functions.runtime.ProcessRuntime.isAlive(ProcessRuntime.java:368) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.functions.runtime.RuntimeSpawner.lambda$start$0(RuntimeSpawner.java:88) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.2.jar:2.4.2]\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_232]\r\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [?:1.8.0_232]\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_232]\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [?:1.8.0_232]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_232]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_232]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_232]\r\n23:11:17.880 [function-timer-thread-3-1] ERROR org.apache.pulsar.functions.runtime.RuntimeSpawner - test/test/excfunc-java.lang.RuntimeException:  Function Container is dead with exception.. restarting\r\n23:11:17.880 [function-timer-thread-3-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Creating function log directory /home/vagrant/apache-pulsar-2.4.2/logs/functions/test/test/excfunc\r\n23:11:17.881 [function-timer-thread-3-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Created or found function log directory /home/vagrant/apache-pulsar-2.4.2/logs/functions/test/test/excfunc\r\n23:11:17.881 [function-timer-thread-3-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - ProcessBuilder starting the process with args python /home/vagrant/apache-pulsar-2.4.2/instances/python-instance/python_instance_main.py --py /home/vagrant/python_scripts/example_function.py --logging_directory /home/vagrant/apache-pulsar-2.4.2/logs/functions --logging_file excfunc --logging_config_file /home/vagrant/apache-pulsar-2.4.2/conf/functions-logging/logging_config.ini --instance_id 0 --function_id bfd51266-09ad-40e5-84a1-1f77b6626935 --function_version a717f725-3164-4a1b-b88b-1415b6288af2 --function_details '{\"tenant\":\"test\",\"namespace\":\"test\",\"name\":\"excfunc\",\"className\":\"WordCountFunction\",\"logTopic\":\"persistent://test/test/log\",\"runtime\":\"PYTHON\",\"autoAck\":true,\"parallelism\":1,\"source\":{\"inputSpecs\":{\"persistent://test/test/test1\":{}},\"cleanupSubscription\":true},\"sink\":{\"topic\":\"persistent://test/test/test2\"},\"resources\":{\"cpu\":1.0,\"ram\":\"1073741824\",\"disk\":\"10737418240\"},\"componentType\":\"FUNCTION\"}' --pulsar_serviceurl pulsar://localhost:6650 --use_tls false --tls_allow_insecure false --hostname_verification_enabled false --max_buffered_tuples 1024 --port 44478 --metrics_port 40031 --expected_healthcheck_interval 30 --secrets_provider secretsprovider.ClearTextSecretsProvider --cluster_name local\r\n23:11:17.897 [function-timer-thread-3-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully\r\n23:11:17.904 [Timer-0] INFO  org.apache.pulsar.functions.LocalRunner - {\r\n  \"numRestarts\": \"5\",\r\n  \"instanceId\": \"0\"\r\n}\r\n2019-12-20 23:11:18.113 INFO  ConnectionPool:85 | Created connection for pulsar://localhost:6650\r\n2019-12-20 23:11:18.114 INFO  ClientConnection:324 | [127.0.0.1:39386 -> 127.0.0.1:6650] Connected to broker\r\n2019-12-20 23:11:18.117 INFO  BatchMessageContainer:43 | { BatchContainer [size = 0] [batchSizeInBytes_ = 0] [maxAllowedMessageBatchSizeInBytes_ = 131072] [maxAllowedNumMessagesInBatch_ = 1000] [topicName = persistent://test/test/log] [producerName_ = ] [batchSizeInBytes_ = 0] [numberOfBatchesSent = 0] [averageBatchSize = 0]} BatchMessageContainer constructed\r\n2019-12-20 23:11:18.117 INFO  HandlerBase:53 | [persistent://test/test/log, ] Getting connection from pool\r\n2019-12-20 23:11:18.121 INFO  ProducerImpl:151 | [persistent://test/test/log, ] Created producer on broker [127.0.0.1:39386 -> 127.0.0.1:6650]\r\n2019-12-20 23:11:18.122 INFO  Client:88 | Subscribing on Topic :persistent://test/test/test1\r\n2019-12-20 23:11:18.124 INFO  HandlerBase:53 | [persistent://test/test/test1, test/test/excfunc, 0] Getting connection from pool\r\n2019-12-20 23:11:18.127 INFO  ConsumerImpl:170 | [persistent://test/test/test1, test/test/excfunc, 0] Created consumer on broker [127.0.0.1:39386 -> 127.0.0.1:6650]\r\n\r\n```\r\n\r\n**Machine**\r\n - OS: CentOS 7\r\n - Python: 3.7.4\r\n - Openjdk: 1.8.0_232\r\n - Pulsar: 2.4.2.jar\r\n", "url": "https://github.com/apache/pulsar/issues/5912", "user": "thlautenschlaeger", "labels": ["type/bug"], "created": "2019-12-20 23:23:05", "closed": "2020-01-03 16:00:40", "commits": {}, "ttf": 13.000277777777777, "commitsDetails": []}, {"title": "Error when following getting started", "body": "* MacOS latest\r\n* Downloaded latest via `wget https://archive.apache.org/dist/pulsar/pulsar-2.4.2/apache-pulsar-2.4.2-bin.tar.gz`\r\n* Started via `bin/pulsar standalone`\r\n* Tried the following:\r\n\r\n```\r\nbin/pulsar-client produce my-topic --messages \"hello-pulsar\"\r\n19:46:37.284 [pulsar-client-io-1-1] WARN  org.apache.pulsar.client.impl.ConnectionPool - Failed to open connection to localhost:6650 : io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:6650\r\n19:46:37.287 [pulsar-client-io-1-1] WARN  org.apache.pulsar.client.impl.PulsarClientImpl - [my-topic] Failed to get partitioned topic metadata: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:6650\r\n19:46:37.288 [main] ERROR org.apache.pulsar.client.cli.PulsarClientTool - Error while producing messages\r\n19:46:37.288 [main] ERROR org.apache.pulsar.client.cli.PulsarClientTool - java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:6650\r\norg.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:6650\r\n\tat org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:296) ~[org.apache.pulsar-pulsar-client-api-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.client.impl.ProducerBuilderImpl.create(ProducerBuilderImpl.java:88) ~[org.apache.pulsar-pulsar-client-original-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.client.cli.CmdProduce.publish(CmdProduce.java:179) [org.apache.pulsar-pulsar-client-tools-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.client.cli.CmdProduce.run(CmdProduce.java:169) [org.apache.pulsar-pulsar-client-tools-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.client.cli.PulsarClientTool.run(PulsarClientTool.java:131) [org.apache.pulsar-pulsar-client-tools-2.4.2.jar:2.4.2]\r\n\tat org.apache.pulsar.client.cli.PulsarClientTool.main(PulsarClientTool.java:165) [org.apache.pulsar-pulsar-client-tools-2.4.2.jar:2.4.2]\r\nCaused by: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:6650\r\n\tat java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895) ~[?:1.8.0_202]\r\n\tat org.apache.pulsar.client.impl.ProducerBuilderImpl.create(ProducerBuilderImpl.java:86) ~[org.apache.pulsar-pulsar-client-original-2.4.2.jar:2.4.2]\r\n\t... 4 more\r\nCaused by: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:6650\r\n\tat org.apache.pulsar.client.impl.ConnectionPool.lambda$null$9(ConnectionPool.java:202) ~[org.apache.pulsar-pulsar-client-original-2.4.2.jar:2.4.2]\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:474) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) ~[?:1.8.0_202]\r\nCaused by: java.util.concurrent.CompletionException: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:6650\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:647) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:632) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_202]\r\n\tat org.apache.pulsar.client.impl.ConnectionPool.lambda$connectToAddress$17(ConnectionPool.java:275) ~[org.apache.pulsar-pulsar-client-original-2.4.2.jar:2.4.2]\r\n\tat io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:511) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:504) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:483) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:424) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:121) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.fulfillConnectPromise(AbstractNioChannel.java:327) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:343) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:644) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:591) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:508) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:470) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) ~[?:1.8.0_202]\r\nCaused by: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:6650\r\n\tat sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) ~[?:1.8.0_202]\r\n\tat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717) ~[?:1.8.0_202]\r\n\tat io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:327) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:340) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:644) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:591) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:508) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:470) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) ~[?:1.8.0_202]\r\nCaused by: java.net.ConnectException: Connection refused\r\n\tat sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) ~[?:1.8.0_202]\r\n\tat sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717) ~[?:1.8.0_202]\r\n\tat io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:327) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:340) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:644) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:591) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:508) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:470) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) ~[?:1.8.0_202]\r\n19:46:37.292 [main] INFO  org.apache.pulsar.client.cli.PulsarClientTool - 0 messages successfully produced\r\n$```", "url": "https://github.com/apache/pulsar/issues/5909", "user": "dodalovic", "labels": ["type/bug"], "created": "2019-12-20 18:53:32", "closed": "2020-01-14 12:48:39", "commits": {}, "ttf": 24.00027777777778, "commitsDetails": []}, {"title": "Cannot import Python pulsar-client==2.4.2 on Mac Os Catalina 10.15.2", "body": "**Describe the bug**\r\nWith correctly installed `libpulsar` and `protobuf` and pulsar-client 2.4.2 cannot import pulsar on Python 3.7.5. An attempt to import raises ```ImportError: dlopen(/tmp/check/.venv/lib/python3.7/site-packages/_pulsar.cpython-37m-darwin.so, 2): Library not loaded: /usr/local/opt/protobuf@2.6/lib/libprotobuf-lite.9.dylib```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Run:\r\n```\r\n# python3 -V\r\nPython 3.7.5\r\n# python3\r\nPython 3.7.5 (default, Dec 12 2019, 09:41:03)\r\n[Clang 11.0.0 (clang-1100.0.33.16)] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import pulsar\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/tmp/check/.venv/lib/python3.7/site-packages/pulsar/__init__.py\", line 102, in <module>\r\n    import _pulsar\r\nImportError: dlopen(/tmp/check/.venv/lib/python3.7/site-packages/_pulsar.cpython-37m-darwin.so, 2): Library not loaded: /usr/local/opt/protobuf@2.6/lib/libprotobuf-lite.9.dylib\r\n  Referenced from: /tmp/check/.venv/lib/python3.7/site-packages/_pulsar.cpython-37m-darwin.so\r\n  Reason: image not found\r\n```\r\n\r\n2. See the error\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Catalina 10.15.2\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5899", "user": "bry00", "labels": ["triage/week-51", "type/bug"], "created": "2019-12-19 23:22:46", "closed": "2020-01-17 17:30:12", "commits": {}, "ttf": 28.00027777777778, "commitsDetails": []}, {"title": "[Docs]Old version download link error", "body": "**Describe the bug**\r\n\r\nhttp://pulsar.apache.org/docs/en/2.3.0/standalone/\r\n\r\n![image](https://user-images.githubusercontent.com/1907867/71054469-1387e580-218d-11ea-9c08-289f509c8970.png)\r\n\r\nThe old version has been removed https://archive.apache.org/dist/pulsar/. Only the latest two versions are kept here in https://www-eu.apache.org/dist/pulsar/.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n\r\n**Expected behavior**\r\nDisplays the correct download link\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nWe should fix this script https://github.com/apache/pulsar/blob/master/site2/website/scripts/replace.js to solve this problem.\r\n\r\nTest\r\n\r\n```\r\ngit clone https://github.com/apache/pulsar.git\r\ncd pulsar/site2/website\r\nyarn install\r\nrm -rf build\r\nyarn build\r\nnode scripts/replace.js\r\n```\r\n\r\nCheck file build/pulsar/docs/en/2.3.0/standalone/index.html, search key `downloads page`:\r\n\r\n```\r\n<li><p>from the Pulsar <a href=\"/download\">downloads page</a></p></li>\r\n```", "url": "https://github.com/apache/pulsar/issues/5887", "user": "tuteng", "labels": ["help wanted", "triage/week-51", "type/bug"], "created": "2019-12-18 03:58:02", "closed": "2020-01-13 12:46:33", "commits": {"348cedd2309c38722e3ca0856d438c387e26f316": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 26.00027777777778, "commitsDetails": [{"commitHash": "348cedd2309c38722e3ca0856d438c387e26f316", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["fa71c497ecfdbfed44849470951524bd2f4b175d"], "nameRev": "348cedd2309c38722e3ca0856d438c387e26f316 tags/v2.6.0-candidate-1~629", "commitMessage": "[Issue 5887]Fix old version download link error (#5897)\n\nFix old version download link error\r\n\r\nFixes #5887 \r\n\r\n### Motivation\r\n\r\nOld version download link error\r\n\r\n### Modifications\r\n\r\nChange the download link to https://archive.apache.org/dist/pulsar/", "commitDateTime": "2020-01-13 20:46:32", "authoredDateTime": "2020-01-13 20:46:32", "commitGitStats": [{"filePath": "site2/website/scripts/replace.js", "insertions": 46, "deletions": 40, "lines": 86}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "run bin/pulsar-admin namespaces list public with 404 return", "body": "**Describe the bug**\r\nwhen I start pulsar in standalone model,I change conf *webServicePort* in file *conf/standalone.conf* from 8080 to 8081.\r\nI want to take a look at namespace list,when I run *bin/pulsar-admin namespaces list public*,pulsar gave me a reqponse with 404\r\n\r\n**To Reproduce**\r\ncd {pulsar_home}/\r\nbin/pulsar-admin namespaces list public\r\nreturn:\r\n```\r\n[resin@localhost apache-pulsar-2.4.2]$ bin/pulsar-admin namespaces list public\r\nHTTP 404 Not Found\r\n\r\nReason: HTTP 404 Not Found \r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: centos \r\n\r\n**Additional context**\r\nI also change conf in *pulsar_env.sh* from *PULSAR_MEM=${PULSAR_MEM:-\"-Xms2g -Xmx2g -XX:MaxDirectMemorySize=4g\"}* to *PULSAR_MEM=${PULSAR_MEM:-\"-Xms1g -Xmx1g -XX:MaxDirectMemorySize=4g\"}*,but I think this won't cause this 404\r\n\r\nThanks!\r\n", "url": "https://github.com/apache/pulsar/issues/5880", "user": "superbaobei", "labels": ["triage/week-51", "type/bug"], "created": "2019-12-17 10:16:01", "closed": "2019-12-18 03:53:26", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Shared subscription doesn't work well with partitioned topic in 2.4.2", "body": "**Describe the bug**\r\nShared subscription doesn't work well with partitioned topic in 2.4.2. It worked well with 2.4.1 release. To reproduce issue I use 2 consumers with shared subscription and a topic with 2 partitions. Most of the times I run the test messages from only one partition are successfully consumed, while only the first message from another partition is consumed.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Install 2.4.2 cluster (I used helm)\r\n2. Setup topic with 2 partitions\r\n3. Consume topic with 2 consumers in parallel that have shared subscription\r\n4. Produce 50 messages in two partitions (with round robin or with 2 producers)\r\n5. Observe issue\r\n\r\n**Expected behavior**\r\nAll messages are consumed\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n![image](https://user-images.githubusercontent.com/3329606/70981925-2506ba00-20c7-11ea-911f-7237b096d3c1.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - Helm chart on minikube\r\n - Reproduced with dotnet client as well as java 2.4.1 and 2.4.2 clients\r\n\r\n**Additional context**\r\nThe test that always worked on 2.4.1 now fails with 2.4.2 \r\nhttps://github.com/fsharplang-ru/pulsar-client-dotnet/blob/develop/tests/IntegrationTests/Partitions.fs#L65-L150\r\n", "url": "https://github.com/apache/pulsar/issues/5877", "user": "Lanayx", "labels": ["triage/week-51", "type/bug"], "created": "2019-12-17 09:21:30", "closed": "2020-01-19 13:45:37", "commits": {}, "ttf": 33.000277777777775, "commitsDetails": []}, {"title": "Helm chart does not allow ingress TLS to be enabled without a secretName", "body": "**Describe the bug**\r\nThe provided helm chart can create an Ingress with TLS, but it requires a `secretName` to be added. This is not an Ingress requirement and, in some cases, the ingress controller can provide a default certificate when the Ingress object does not declare one.\r\n\r\n**To Reproduce**\r\nDeploy the helm chart with an Ingress enabled and an empty tls `secretName`.\r\n\r\n**Expected behavior**\r\nI expect to be able to configure the Ingress TLS without the need to give it a `secretName`. My Ingress controller will use a default certificate.\r\n", "url": "https://github.com/apache/pulsar/issues/5858", "user": "juliohm1978", "labels": ["triage/week-51", "type/bug"], "created": "2019-12-13 20:52:07", "closed": "2019-12-17 11:40:26", "commits": {"3bc8299072e0635d59735c0646df71796dc31a58": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "3bc8299072e0635d59735c0646df71796dc31a58", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["dfc8c1cad3317e4eac671536a565d5b8b2c71a14"], "nameRev": "3bc8299072e0635d59735c0646df71796dc31a58 tags/v2.5.0-candidate-2~53", "commitMessage": "Provide better defaults for ingress tls and secretName configuration. (#5859)\n\nThis patch allows tls to be enabled with an empty secretName for ingress controllers might be able to provide a default certificate.\r\n\r\nFixes #5858, provides better defaults for the Ingress object and allows TLS to be enabled with an empty secretName.\r\n\r\n### Motivation\r\n\r\nThe current helm chart can create an Ingress with TLS, but it requires a secretName to be added. This is not an Ingress requirement and, in some cases, the ingress controller can provide a default certificate when the Ingress object does not declare one.\r\n\r\n### Modifications\r\n\r\nModifications include `values.yaml` and `dashboard-ingress.yaml` to address the issue.\r\n", "commitDateTime": "2019-12-17 19:40:25", "authoredDateTime": "2019-12-17 08:40:25", "commitGitStats": [{"filePath": "deployment/kubernetes/helm/pulsar/templates/dashboard-ingress.yaml", "insertions": 4, "deletions": 2, "lines": 6}, {"filePath": "deployment/kubernetes/helm/pulsar/values.yaml", "insertions": 7, "deletions": 1, "lines": 8}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "pulsar-admin get HTTP 403 Forbidden return with kubernetes", "body": "**Describe the bug**\r\n$pulsar-admin tenants list\r\nHTTP 403 Forbidden\r\n\r\nReason: HTTP 403 Forbidden\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. my kubernetes is up and fine\r\n$ kubectl get nodes\r\nNAME             STATUS   ROLES    AGE    VERSION\r\nk8s-node-141     Ready    <none>   2d3h   v1.13.2\r\nk8s-node-142     Ready    <none>   2d1h   v1.13.2\r\nk8s-node-143     Ready    <none>   22h    v1.13.2\r\nk8s-server-140   Ready    master   2d4h   v1.13.2\r\n\r\n2. pulsar deployment is up and running\r\n$kubectl get pods\r\nNAME                                 READY   STATUS      RESTARTS   AGE\r\nbookie-86nzz                         1/1     Running     1          102m\r\nbookie-vvqsn                         1/1     Running     1          102m\r\nbookie-wh6dv                         1/1     Running     1          102m\r\nbroker-55958769bd-bjfg2              1/1     Running     2          113m\r\nbroker-55958769bd-hpbwz              1/1     Running     2          113m\r\nbroker-55958769bd-qrrxh              1/1     Running     2          113m\r\ngrafana-6c6b796879-lqbvq             1/1     Running     2          2d3h\r\nprometheus-7548d7d545-b8hrp          1/1     Running     2          2d3h\r\nproxy-ff85bffd-8pdgs                 1/1     Running     2          2d3h\r\nproxy-ff85bffd-jtggr                 1/1     Running     2          2d3h\r\npulsar-admin                         1/1     Running     1          130m\r\npulsar-cluster-metadata-init-68zmm   0/1     Completed   0          2d3h\r\npulsar-dashboard-74b788ddd-7fntt     1/1     Running     1          27h\r\nzk-0                                 1/1     Running     2          2d3h\r\nzk-1                                 1/1     Running     2          2d3h\r\nzk-2                                 1/1     Running     2          2d3h\r\n\r\n3. alias made\r\n$alias pulsar-admin='kubectl exec pulsar-admin -it -- bin/pulsar-admin'\r\n4. changed pulsar-dashboard image to 2.3.0 because latest does't running.\r\n5. pulsar-admin will not work at all:\r\n$pulsar-admin tenants list\r\nHTTP 403 Forbidden\r\n\r\nReason: HTTP 403 Forbidden\r\ncommand terminated with exit code 1\r\n\r\n**Expected behavior**\r\npulsar-admin work.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.", "url": "https://github.com/apache/pulsar/issues/5849", "user": "tshh", "labels": ["triage/week-50", "type/bug"], "created": "2019-12-13 04:39:48", "closed": "2019-12-13 07:00:26", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Error at starting apachepulsar/pulsar-dashboard docker container within Kubernetes", "body": "Hi there!\r\n\r\n**Issue**\r\nI've used the helm chart available in the 2.4.2 Apache Pulsar project. Every pod is created and running correctly except `pulsar-dashboard` which has the `CrashLoopBackOff` status.\r\n\r\nIt looks like the initdb file from postgresql does not exist. Here what the logs are saying :\r\n\r\n```\r\nStarting Pulsar dasboard\r\n+ /pulsar/init-postgres.sh\r\n+ rm -rf '/data/*'\r\n+ chown -R postgres: /data\r\n+ chmod 700 /data\r\n+ sudo -u postgres /usr/lib/postgresql/9.6/bin/initdb /data/\r\nsudo: /usr/lib/postgresql/9.6/bin/initdb: command not found\r\n```\r\n\r\n**To Reproduce**\r\nSimply install the helm chart with values-mini.yaml and look at the pods in the pulsar namespace. To be sure, I've tried to run the container alone on my machine and I get the same error.\r\n\r\n**Expected behavior**\r\nI would expect Pulsar Dashboard to run properly :)\r\n\r\n**Cluster Kubernetes:**\r\n - Server version 1.12 on linux/amd64 platform", "url": "https://github.com/apache/pulsar/issues/5847", "user": "julio666", "labels": ["help wanted", "triage/week-50", "type/bug"], "created": "2019-12-12 19:06:27", "closed": "2020-01-10 15:30:17", "commits": {"c621d99b430ef6ddd379eb588eb5ed7ee4e85124": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "2aaf4d269c64c17c4dcd884cd7d5bc4d762d7a1a": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 28.00027777777778, "commitsDetails": [{"commitHash": "c621d99b430ef6ddd379eb588eb5ed7ee4e85124", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["4e6b2f09a08880faf8e8eb5753285ced0b3bf519"], "nameRev": "c621d99b430ef6ddd379eb588eb5ed7ee4e85124 tags/v2.6.0-candidate-1~232", "commitMessage": "Fixed dashboard start failed (#6857)\n\nMaster Issue: https://github.com/apache/pulsar/issues/5847\r\n\r\n### Motivation\r\n\r\nInstallation error of dashboard database postgres 11 resulted in startup failure.\r\n\r\n### Modifications\r\n\r\n* Update apachepulsar/pulsar-dashboard:2.5.1 image https://hub.docker.com/layers/apachepulsar/pulsar-dashboard/2.5.1/images/sha256-61b47a7302639aba1357d09ca69a842c4a67bff38b230753d6bd638df0461c6b?context=explore\r\n* Update Docker file for fix postgresql version 11.\r\n\r\n### Verifying this change\r\n\r\nLocal test pass", "commitDateTime": "2020-05-06 23:00:53", "authoredDateTime": "2020-05-07 14:00:53", "commitGitStats": [{"filePath": "dashboard/Dockerfile", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "dashboard/init-postgres.sh", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "2aaf4d269c64c17c4dcd884cd7d5bc4d762d7a1a", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["54329f2bdb010ed25849b076aab779db6c1ba531"], "nameRev": "2aaf4d269c64c17c4dcd884cd7d5bc4d762d7a1a tags/v2.5.2-candidate-1~26", "commitMessage": "Fixed dashboard start failed (#6857)\n\nMaster Issue: https://github.com/apache/pulsar/issues/5847\n\n### Motivation\n\nInstallation error of dashboard database postgres 11 resulted in startup failure.\n\n### Modifications\n\n* Update apachepulsar/pulsar-dashboard:2.5.1 image https://hub.docker.com/layers/apachepulsar/pulsar-dashboard/2.5.1/images/sha256-61b47a7302639aba1357d09ca69a842c4a67bff38b230753d6bd638df0461c6b?context=explore\n* Update Docker file for fix postgresql version 11.\n\n### Verifying this change\n\nLocal test pass\n(cherry picked from commit c621d99b430ef6ddd379eb588eb5ed7ee4e85124)\n", "commitDateTime": "2020-05-08 18:20:18", "authoredDateTime": "2020-05-07 14:00:53", "commitGitStats": [{"filePath": "dashboard/Dockerfile", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "dashboard/init-postgres.sh", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["c621d99b430ef6ddd379eb588eb5ed7ee4e85124"], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 5, "deletions": 2, "lines": 7, "gitFilesChange": 2}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["dashboard/init-postgres.sh", "dashboard/Dockerfile"]}, {"title": "pip can't find pulsar-client 2.4.2 for Python 3.8", "body": "**Describe the bug**\r\nCannot install [`pulsar-client==2.4.2`](https://pulsar.apache.org/docs/en/client-libraries-python/#installation-using-pip) on Python 3.8.0, receiving error: `No matching distribution found for pulsar-client`.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Try to install pulsar-client in the Python 3.8.0 environment:\r\n\r\n```Python\r\n(.venv) # python -V\r\nPython 3.8.0\r\n(.venv) # pip install pulsar-client\r\nERROR: Could not find a version that satisfies the requirement pulsar-client (from versions: none)\r\nERROR: No matching distribution found for pulsar-client\r\n```\r\n\r\n2. See error\r\n\r\n**Expected behavior**\r\nThe python-client should be installed.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: macOS Catalina (v. 10.15.2)\r\n", "url": "https://github.com/apache/pulsar/issues/5842", "user": "bry00", "labels": ["type/bug"], "created": "2019-12-12 08:28:07", "closed": "2019-12-13 03:55:30", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Biscuit customs authentication and authorization providers usages.", "body": "**Describe the bug**\r\npulsar-client java invalid connection state using custom authentication & authorization provider:\r\n\r\nHere are the breakpoints and their results:\r\n[\r\n![1](https://user-images.githubusercontent.com/7518245/70654540-d2587880-1c56-11ea-8251-520bdbc1a90b.png)\r\n](url)\r\n\r\n![Screenshot from 2019-12-11 20-41-53](https://user-images.githubusercontent.com/7518245/70654549-d5ebff80-1c56-11ea-938e-9823899a76ac.png)\r\n\r\nand throws:\r\n\r\n```\r\n19:55:25.068 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ConnectionPool - [[id: 0x88e0c178, L:/127.0.0.1:38446 - R:127.0.0.1/127.0.0.1:22022]] Connected to server\r\n19:55:25.120 [pulsar-client-io-1-1] DEBUG org.apache.pulsar.common.protocol.PulsarHandler - [[id: 0x88e0c178, L:/127.0.0.1:38446 - R:127.0.0.1/127.0.0.1:22022]] Scheduling keep-alive task every 30 s\r\n19:55:25.123 [pulsar-client-io-1-1] DEBUG org.apache.pulsar.client.impl.ClientCnx - [id: 0x88e0c178, L:/127.0.0.1:38446 - R:127.0.0.1/127.0.0.1:22022] Connected to broker\r\n19:55:25.143 [pulsar-client-io-1-1] DEBUG org.apache.pulsar.client.impl.ClientCnx - Complete: true\r\n19:55:25.163 [pulsar-client-io-1-1] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [127.0.0.1/127.0.0.1:22022] Received cmd ERROR\r\n20:34:55.905 [pulsar-client-io-1-1] WARN  org.apache.pulsar.client.impl.ClientCnx - [127.0.0.1/127.0.0.1:22022] Got exception IllegalArgumentException : null\r\njava.lang.IllegalArgumentException: null\r\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:108) ~[guava-21.0.jar:?]\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:588) ~[pulsar-client-original-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:154) ~[pulsar-common-2.4.1.jar:2.4.1]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:323) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:297) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1434) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:965) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:799) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:433) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:330) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_201]\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. `git clone git@github.com:CleverCloud/biscuit-pulsar.git`\r\n2. `mvn install` # it's using hadoop-unit which boot a pulsar\r\n3. `BiscuitPulsarIntegrationTest.java` should create a producer but it throws the quoted exception.\r\n\r\n**Expected behavior**\r\nCreate producer and produce messages using biscuit authentication & authorization.\r\n\r\n**Additional context**\r\nTo debug pulsar-client you probably needs to remove the hadoop-unit usage and use standalone. To do it you just need to boot a pulsar standalone and replace the needed configuration on pulsar client creation in `BiscuitPulsarIntegrationTest.java` and provide the built biscuit-plugin like:\r\n\r\n```\r\n# Enable authentication\r\nauthenticationEnabled=true\r\n\r\n# Autentication provider name list, which is comma separated list of class names\r\nauthenticationProviders=com.clevercloud.biscuitpulsar.AuthenticationProviderBiscuit\r\n\r\n# Enforce authorization\r\nauthorizationEnabled=true\r\n\r\n# Authorization provider fully qualified class-name\r\nauthorizationProvider=com.clevercloud.biscuitpulsar.AuthorizationProviderBiscuit\r\n\r\n# Biscuit root signing key\r\nbiscuitRootKey=da905388864659eb785877a319fbc42c48e2f8a40af0c5baea0ef8ff7c795253 #random string\r\n\r\nsuperUserRoles=admin\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/5841", "user": "KannarFr", "labels": ["triage/week-50", "type/bug"], "created": "2019-12-11 19:40:10", "closed": "2020-01-01 00:38:07", "commits": {"d6f90ddc535f24bc5cb061216bb47a97c9f086a8": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 20.00027777777778, "commitsDetails": [{"commitHash": "d6f90ddc535f24bc5cb061216bb47a97c9f086a8", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["babce5e02c9b82ae10947ba81ef46748c6f2c85a"], "nameRev": "d6f90ddc535f24bc5cb061216bb47a97c9f086a8 tags/v2.5.0-candidate-2~14", "commitMessage": "Fixes #5814: add SentConnectFrame state check when running `handleError` (#5913)\n\n\r\n\r\nFixes #5841\r\n\r\n*Motivation*\r\n\r\nwhen enabling authentication and authorization, if a user using\r\nthe wrong key to send to the server, the server will return an\r\n`Error` message. There is no `Connected` message return to the\r\nclient so the client is staying in `SentConnectFrame` and it can\r\nreceive the server `Error` message.\r\nWe need to check the `SentConnectFrame` state when receiving `Error` message.\r\n\r\nThe client will throw error:\r\n\r\n```\r\njava.lang.IllegalArgumentException: null\r\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:108) ~[guava-21.0.jar:?]\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:588) ~[pulsar-client-original-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:154) ~[pulsar-common-2.4.1.jar:2.4.1]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:323) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:297) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1434) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:965) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:799) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:433) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:330) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_201]\r\n```\r\n\r\n*Modifications*\r\n\r\n- Add `SentConnectFrame` check\r\n\r\n", "commitDateTime": "2020-01-01 08:38:06", "authoredDateTime": "2020-01-01 08:38:06", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ClientCnx.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/ClientCnxTest.java", "insertions": 35, "deletions": 0, "lines": 35}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ClientCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ClientCnx.handleError(org.apache.pulsar.common.api.proto.PulsarApi.CommandError)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ClientCnxTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ClientCnxTest.testReceiveErrorAtSendConnectFrameState()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Exception is thrown when generating javadoc for apache-kafka wrappers.", "body": "**Describe the bug**\r\n\r\nException is thrown when generating javadoc for apache-kafka wrappers.\r\n\r\n```\r\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-javadoc-plugin:2.10.3:jar (attach-javadocs) on project pulsar-client-kafka-original: MavenReportException: Error while generating Javadoc:\r\n[ERROR] Exit code: 1 - /Users/sijie/Workspaces/pulsar/pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/pulsar/client/kafka/compat/KafkaProducerInterceptorWrapper.java:63: warning - Tag @link:illegal character: \"60\" in \"ProducerInterceptor<byte[]>\"\r\n[ERROR] /Users/sijie/Workspaces/pulsar/pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/pulsar/client/kafka/compat/KafkaProducerInterceptorWrapper.java:63: warning - Tag @link:illegal character: \"62\" in \"ProducerInterceptor<byte[]>\"\r\n[ERROR] /Users/sijie/Workspaces/pulsar/pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/pulsar/client/kafka/compat/KafkaProducerInterceptorWrapper.java:63: warning - Tag @link: reference not found: ProducerInterceptor<byte[]>\r\n[ERROR] /Users/sijie/Workspaces/pulsar/pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/pulsar/client/kafka/compat/KafkaProducerInterceptorWrapper.java:93: warning - Tag @link:illegal character: \"60\" in \"org.apache.kafka.clients.producer.ProducerInterceptor<K, V>\"\r\n[ERROR] /Users/sijie/Workspaces/pulsar/pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/pulsar/client/kafka/compat/KafkaProducerInterceptorWrapper.java:93: warning - Tag @link: malformed: \"org.apache.kafka.clients.producer.ProducerInterceptor<K, V>\"\r\n[ERROR] /Users/sijie/Workspaces/pulsar/pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/pulsar/client/kafka/compat/KafkaProducerInterceptorWrapper.java:93: warning - Tag @link: reference not found: org.apache.kafka.clients.producer.ProducerInterceptor<K, V>\r\n[ERROR] /Users/sijie/Workspaces/pulsar/pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/pulsar/client/kafka/compat/KafkaProducerInterceptorWrapper.java:93: warning - @param argument \"keySerializer\" is not a parameter name.\r\n[ERROR] /Users/sijie/Workspaces/pulsar/pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/pulsar/client/kafka/compat/KafkaProducerInterceptorWrapper.java:93: warning - @param argument \"valueSerializer\" is not a parameter name.\r\n[ERROR] javadoc: error - class file for com.google.protobuf.GeneratedMessageV3 not found\r\n```\r\n\r\n**To Reproduce**\r\n\r\nrun `mvn deploy`\r\n\r\n**Expected behavior**\r\n\r\nThe command should succeed.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5835", "user": "sijie", "labels": ["component/build", "triage/week-50", "type/bug"], "created": "2019-12-10 16:55:17", "closed": "2020-01-14 13:13:40", "commits": {}, "ttf": 34.000277777777775, "commitsDetails": []}, {"title": "NullPointerException throwed by Debezium Connector  when  a row deleted", "body": "**Describe the bug**\r\nDebezium Connector will throw NullPointerException and shutdown  when a row is deleted anytime.\r\n\r\n**To Reproduce**\r\n1. run a new Debezium Connector  pulsar io instance\r\n2. delete a row in mysql\r\n3. NullPointerException is throwed by Connector  \r\n\r\n**Expected behavior**\r\ndelete transaction in bin log is write into pulsar normally\r\n\r\n**Screenshots**\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - k8s\r\n-  apachepulsar/pulsar-all:2.4.2\r\n\r\n**Additional context**\r\nlog\r\n```\r\n02:04:28.729 [iot/pipe/iot-mysql-log-test1-source-0] INFO  org.apache.pulsar.functions.instance.JavaInstanceRunnable - Encountered exception in sink write: \r\njava.lang.NullPointerException: null\r\n        at org.apache.pulsar.common.schema.KeyValue.encode(KeyValue.java:101) ~[java-instance.jar:?]\r\n        at org.apache.pulsar.client.impl.schema.KeyValueSchema.encode(KeyValueSchema.java:128) ~[org.apache.pulsar-pulsar-client-original-2.4.2.jar:2.4.2]\r\n        at org.apache.pulsar.client.impl.schema.KeyValueSchema.encode(KeyValueSchema.java:37) ~[org.apache.pulsar-pulsar-client-original-2.4.2.jar:2.4.2]\r\n        at org.apache.pulsar.client.impl.TypedMessageBuilderImpl.value(TypedMessageBuilderImpl.java:116) ~[org.apache.pulsar-pulsar-client-original-2.4.2.jar:2.4.2]\r\n        at org.apache.pulsar.functions.sink.PulsarSink.write(PulsarSink.java:282) ~[org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:2.4.2]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.sendOutputMessage(JavaInstanceRunnable.java:445) [org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.processResult(JavaInstanceRunnable.java:428) [org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:282) [org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_232]\r\n02:04:28.735 [iot/pipe/iot-mysql-log-test1-source-0] WARN  org.apache.pulsar.functions.instance.JavaInstanceRunnable - Failed to process result of message org.apache.pulsar.io.kafka.connect.KafkaConnectSource$KafkaSourceRecord@6b986037\r\njava.lang.RuntimeException: java.lang.NullPointerException\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.sendOutputMessage(JavaInstanceRunnable.java:449) ~[org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.processResult(JavaInstanceRunnable.java:428) ~[org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:282) [org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_232]\r\nCaused by: java.lang.NullPointerException\r\n        at org.apache.pulsar.common.schema.KeyValue.encode(KeyValue.java:101) ~[java-instance.jar:?]\r\n        at org.apache.pulsar.client.impl.schema.KeyValueSchema.encode(KeyValueSchema.java:128) ~[org.apache.pulsar-pulsar-client-original-2.4.2.jar:2.4.2]\r\n        at org.apache.pulsar.client.impl.schema.KeyValueSchema.encode(KeyValueSchema.java:37) ~[org.apache.pulsar-pulsar-client-original-2.4.2.jar:2.4.2]\r\n        at org.apache.pulsar.client.impl.TypedMessageBuilderImpl.value(TypedMessageBuilderImpl.java:116) ~[org.apache.pulsar-pulsar-client-original-2.4.2.jar:2.4.2]\r\n        at org.apache.pulsar.functions.sink.PulsarSink.write(PulsarSink.java:282) ~[org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:2.4.2]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.sendOutputMessage(JavaInstanceRunnable.java:445) ~[org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        ... 3 more\r\n02:04:28.742 [iot/pipe/iot-mysql-log-test1-source-0] INFO  org.apache.pulsar.functions.instance.JavaInstanceRunnable - Encountered exception in source read: \r\njava.util.concurrent.ExecutionException: java.lang.Exception: Sink Error\r\n        at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1908) ~[?:1.8.0_232]\r\n        at org.apache.pulsar.io.kafka.connect.KafkaConnectSource.read(KafkaConnectSource.java:148) ~[pulsar-io-kafka-connect-adaptor-2.4.2.jar:?]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.readInput(JavaInstanceRunnable.java:461) [org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:246) [org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_232]\r\nCaused by: java.lang.Exception: Sink Error\r\n        at org.apache.pulsar.io.kafka.connect.KafkaConnectSource$KafkaSourceRecord.fail(KafkaConnectSource.java:269) ~[pulsar-io-kafka-connect-adaptor-2.4.2.jar:?]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:285) ~[?:?]\r\n        ... 1 more\r\n02:04:28.743 [iot/pipe/iot-mysql-log-test1-source-0] ERROR org.apache.pulsar.functions.instance.JavaInstanceRunnable - [iot/pipe/iot-mysql-log-test1-source:0] Uncaught exception in Java Instance\r\njava.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.Exception: Sink Error\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.readInput(JavaInstanceRunnable.java:465) ~[org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:246) [org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_232]\r\nCaused by: java.util.concurrent.ExecutionException: java.lang.Exception: Sink Error\r\n        at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357) ~[?:1.8.0_232]\r\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1908) ~[?:1.8.0_232]\r\n        at org.apache.pulsar.io.kafka.connect.KafkaConnectSource.read(KafkaConnectSource.java:148) ~[?:?]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.readInput(JavaInstanceRunnable.java:461) ~[org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        ... 2 more\r\nCaused by: java.lang.Exception: Sink Error\r\n        at org.apache.pulsar.io.kafka.connect.KafkaConnectSource$KafkaSourceRecord.fail(KafkaConnectSource.java:269) ~[?:?]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:285) ~[org.apache.pulsar-pulsar-functions-instance-2.4.2.jar:?]\r\n        ... 1 more\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/5832", "user": "xiemeilong", "labels": ["component/connect", "triage/week-50", "type/bug"], "created": "2019-12-10 02:15:43", "closed": "2019-12-20 06:05:47", "commits": {"06076009e0cba36581730bb64781bfad825fa133": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 10.000277777777777, "commitsDetails": [{"commitHash": "06076009e0cba36581730bb64781bfad825fa133", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f7f218494d96cb82fa0062f47debb3c605b79665"], "nameRev": "06076009e0cba36581730bb64781bfad825fa133 tags/v2.5.0-candidate-2~29", "commitMessage": "[Issue 5832][Pulsar IO]Fix npe of debezium delete event (#5876)\n\nFixes https://github.com/apache/pulsar/issues/5832\r\n\r\nMaster Issue: https://github.com/apache/pulsar/issues/5832\r\n\r\n### Motivation\r\n\r\nCurrently, in debezium, for delete events, in order to be compatible with Kafka's compaction, each delete event will be followed by a record with a null value. For records with a null value, the null value is not currently processed in pulsar, resulting in an exception of throwing a null pointer. Now, we considered to ignore the null value or use it in combination with pulsar's compaction feature in the future.\r\n\r\n![image](https://user-images.githubusercontent.com/1907867/70976050-21cef680-20e6-11ea-963f-56471c915c98.png)\r\nhttps://debezium.io/documentation/reference/0.10/connectors/mysql.html\r\n\r\n### Modifications\r\n\r\n* Ignore the record of the null value.\r\n* Add more integrations, such as insert, delete, update.", "commitDateTime": "2019-12-19 22:05:46", "authoredDateTime": "2019-12-20 14:05:46", "commitGitStats": [{"filePath": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "insertions": 7, "deletions": 1, "lines": 8}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTest.java", "insertions": 57, "deletions": 3, "lines": 60}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/DebeziumMongoDbSourceTester.java", "insertions": 37, "deletions": 0, "lines": 37}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/DebeziumMySqlSourceTester.java", "insertions": 37, "deletions": 6, "lines": 43}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/DebeziumPostgreSqlSourceTester.java", "insertions": 29, "deletions": 5, "lines": 34}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/KafkaSourceTester.java", "insertions": 15, "deletions": 0, "lines": 15}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/SourceTester.java", "insertions": 26, "deletions": 1, "lines": 27}], "commitSpoonAstDiffStats": [{"spoonFilePath": "KafkaConnectSource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.kafka.connect.KafkaConnectSource.read()", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "PulsarFunctionsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumMySqlConnect()", "TOT": 7, "UPD": 0, "INS": 7, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumPostgreSqlConnect()", "TOT": 7, "UPD": 0, "INS": 7, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumMongoDbConnect()", "TOT": 7, "UPD": 0, "INS": 7, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "DebeziumMongoDbSourceTester.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.io.DebeziumMongoDbSourceTester.prepareInsertEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.DebeziumMongoDbSourceTester.prepareDeleteEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.DebeziumMongoDbSourceTester.prepareUpdateEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "DebeziumMySqlSourceTester.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.io.DebeziumMySqlSourceTester.prepareInsertEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.DebeziumMySqlSourceTester.prepareUpdateEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.DebeziumMySqlSourceTester.prepareDeleteEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "DebeziumPostgreSqlSourceTester.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.io.DebeziumPostgreSqlSourceTester.prepareInsertEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.DebeziumPostgreSqlSourceTester.prepareDeleteEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.DebeziumPostgreSqlSourceTester.prepareUpdateEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KafkaSourceTester.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.io.KafkaSourceTester.prepareInsertEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.KafkaSourceTester.prepareDeleteEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.KafkaSourceTester.prepareUpdateEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SourceTester.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester.prepareInsertEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester.prepareDeleteEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester.prepareUpdateEvent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester.eventContains(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester.validateSourceResult(org.apache.pulsar.client.api.Consumer,int,java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["06076009e0cba36581730bb64781bfad825fa133"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 7, "deletions": 1, "lines": 8, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 4, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka"], "changesInPackagesSPOON": ["org.apache.pulsar.io.kafka.connect.KafkaConnectSource.read()"]}, {"title": "Netty UDP connector doesn't work", "body": "NettyServerHandler doesn't work for UDP as it will receive DatagramPacket instead of byte[]\r\n\r\nI managed to make the UDP connector working using a new NettyUDPServerHandler :\r\n\r\npublic class NettyUDPServerHandler extends SimpleChannelInboundHandler<DatagramPacket> {\r\n\r\n    private static final Logger logger = LoggerFactory.getLogger(NettyUDPServerHandler.class);\r\n    private NettySource nettySource;\r\n\r\n    public NettyUDPServerHandler(NettySource nettySource) {\r\n        this.nettySource = nettySource;\r\n    }\r\n    \r\n    @Override\r\n    protected void channelRead0(ChannelHandlerContext channelHandlerContext, DatagramPacket packet) throws Exception {\r\n        ByteBuf buf = packet.content();\r\n        byte[] bytes = new byte[buf.readableBytes()];\r\n        buf.readBytes(bytes);\r\n        buf.retain();\r\n        nettySource.consume(new NettyRecord(Optional.ofNullable(\"\"), bytes));\r\n    }\r\n\r\n    @Override\r\n    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) {\r\n        logger.error(\"Error when processing incoming data\", cause);\r\n        ctx.close();\r\n    }\r\n\r\n    @Data\r\n    static private class NettyRecord implements Record<byte[]>, Serializable {\r\n        private final Optional<String> key;\r\n        private final byte[] value;\r\n    }\r\n\r\n}", "url": "https://github.com/apache/pulsar/issues/5828", "user": "gbensa", "labels": ["help wanted", "triage/week-50", "type/bug"], "created": "2019-12-09 14:46:19", "closed": "2019-12-14 02:40:39", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "Netty UDP connector ClassCastException", "body": "When trying to create a Netty udp connector, a ClassCastException is thrown\r\n\r\nconfigs:\r\n    type: \"udp\"\r\n    host: \"127.0.0.1\"\r\n    port: 10999\r\n    numberOfThreads: 1\r\n\r\nException : \r\n12:50:43.259 [nioEventLoopGroup-6-1] WARN  io.netty.channel.ChannelInitializer - Failed to initialize a channel. Closing: [id: 0xbeba8942]\r\njava.lang.ClassCastException: io.netty.channel.socket.nio.NioDatagramChannel cannot be cast to io.netty.channel.socket.SocketChannel\r\n\tat org.apache.pulsar.io.netty.server.NettyChannelInitializer.initChannel(NettyChannelInitializer.java:29) ~[pulsar-io-netty-2.4.2.nar-unpacked/:?]\r\n\tat io.netty.channel.ChannelInitializer.initChannel(ChannelInitializer.java:115) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.ChannelInitializer.handlerAdded(ChannelInitializer.java:107) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.callHandlerAdded0(DefaultChannelPipeline.java:637) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.access$000(DefaultChannelPipeline.java:46) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$PendingHandlerAddedTask.execute(DefaultChannelPipeline.java:1487) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.callHandlerAddedForAllHandlers(DefaultChannelPipeline.java:1161) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.invokeHandlerAddedIfNeeded(DefaultChannelPipeline.java:686) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe.register0(AbstractChannel.java:514) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe.access$200(AbstractChannel.java:427) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe$1.run(AbstractChannel.java:486) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:474) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_232]\r\n\r\n\r\nProposed solution :\r\nIn NettyChannelInitializer.java SocketChannel chould be replaced by Channel\r\n", "url": "https://github.com/apache/pulsar/issues/5827", "user": "gbensa", "labels": ["help wanted", "triage/week-50", "type/bug"], "created": "2019-12-09 12:52:07", "closed": "2019-12-14 02:40:39", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "2.4.2 on Kubernetes, can't start Brokers, functions.worker.WorkerService", "body": "**Describe the bug**\r\nStarting image 2.4.2 on Kubernetes config where 2.4.1 worked, puts the brokers into `CrashLoopBackOff`.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. in your k8s yamls, change your pulsar image ref from 2.4.1 to 2.4.2 and clean-deploy\r\n2. observe the pod initialization\r\n\r\n**Expected behavior**\r\nPulsar should start normally.\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/588573/70395931-9af68b80-1a0c-11ea-905a-fcd5b5222715.png)\r\n\r\n\r\n**Additional context**\r\nn/a\r\n", "url": "https://github.com/apache/pulsar/issues/5818", "user": "youurayy", "labels": ["component/functions", "component/k8s", "triage/week-50", "type/bug"], "created": "2019-12-08 20:50:37", "closed": "2020-01-02 07:52:40", "commits": {}, "ttf": 24.00027777777778, "commitsDetails": []}, {"title": "[docs] The example code does not display correctly", "body": "**Describe the bug**\r\nUnunderstood example code .\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'http://pulsar.apache.org/docs/en/schema-understand'\r\n2. Click on 'Understand schema'\r\n3. Scroll down to 'Complex type>Example'\r\n\r\n**Expected behavior**\r\nthis  example code is for java or other?\r\n**Screenshots**\r\n![\u56fe\u7247](https://user-images.githubusercontent.com/29513837/70309120-bebca480-1847-11ea-89ed-badf4ca9c5e2.png)\r\n\r\n\r\n**Additional context**\r\nFor JAVA , ``` Schema> ```  means ``` Schema<KeyValue<Integer, String>>```,right?\r\n", "url": "https://github.com/apache/pulsar/issues/5808", "user": "huangdx0726", "labels": ["component/documentation", "triage/week-50", "type/bug"], "created": "2019-12-06 08:49:13", "closed": "2019-12-17 11:48:07", "commits": {"a7e2f13e1cdfad2fc2deaebfb3593838149b0aa5": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 11.000277777777777, "commitsDetails": [{"commitHash": "a7e2f13e1cdfad2fc2deaebfb3593838149b0aa5", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["e0942b8d5392439b403041d5f30116754d8a9365"], "nameRev": "a7e2f13e1cdfad2fc2deaebfb3593838149b0aa5 tags/v2.5.0-candidate-2~51", "commitMessage": "[Issue 5808][documentation]fix example code (#5814)\n\nfix example code\r\n\r\nFixes #5808\r\n\r\nMotivation\r\nExample code display error.", "commitDateTime": "2019-12-17 19:48:06", "authoredDateTime": "2019-12-17 19:48:06", "commitGitStats": [{"filePath": "site2/docs/schema-understand.md", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "site2/website/versioned_docs/version-2.4.1/schema-understand.md", "insertions": 6, "deletions": 6, "lines": 12}, {"filePath": "site2/website/versioned_docs/version-2.4.2/schema-understand.md", "insertions": 4, "deletions": 4, "lines": 8}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "s3 offloading generates huge zk txn logs in some conditions", "body": "**Describe the bug**\r\nWhen s3 offloading is turned on but credentials is incorrect the zookeeper /managed-ledger znode entries grow to be fairly large (1MB), causing zk txn log to be in the range of multiple GBs, which could easily run out of the space on the zk log device under default log purging configuration.\r\n\r\nAn example of the content of such a znode:\r\n```\r\nk: localhost:2181(CONNECTED) 0] get /managed-ledgers/<topic-path>\r\n?????  ?????-*???????????????????2?*\r\ns34\r\nbucket*<bucket>\r\nregion  us-west-2.\r\nendpoint\"https://s3.us-west-2.amazonaws.com4\r\nbucket*<bucket>\r\nregion  us-west-2.\r\nendpoint\"https://s3.us-west-2.amazonaws.com4\r\nbucket*<bucket>\r\nregion  us-west-2.\r\n```\r\nwhere the bucket, endpoint, and region info appears to be duplicated many times. The entry size also grows under normal offloading operation conditions but slower.\r\n\r\n**To Reproduce**\r\nSee above. We reproduced the problem with fake topics\r\n\r\n**Expected behavior**\r\nznode entry size should be bounded. There appears no reason to duplicate offloading metadata.\r\n", "url": "https://github.com/apache/pulsar/issues/5798", "user": "vicaya", "labels": ["triage/week-49", "type/bug"], "created": "2019-12-05 00:12:02", "closed": "2019-12-20 07:18:01", "commits": {"3683b595b95bcadc55f691b0f9f1042b9ebf82b1": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 15.000277777777777, "commitsDetails": [{"commitHash": "3683b595b95bcadc55f691b0f9f1042b9ebf82b1", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["098ae44cdfc7c17540f130a66a447685320d695e"], "nameRev": "3683b595b95bcadc55f691b0f9f1042b9ebf82b1 tags/v2.5.0-candidate-2~48", "commitMessage": "To fix  the problem of repeated storage of offload driver metadata. (#5834)\n\nMotivation\r\nTo fix the #5798 , repeated storage of offload driver metadata.\r\n\r\nVerifying this change\r\nAdd the tests for it\r\n\r\n", "commitDateTime": "2019-12-17 20:03:37", "authoredDateTime": "2019-12-17 20:03:37", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/offload/OffloadUtils.java", "insertions": 6, "deletions": 7, "lines": 13}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/offload/OffloadUtilsTest.java", "insertions": 58, "deletions": 0, "lines": 58}], "commitSpoonAstDiffStats": [{"spoonFilePath": "OffloadUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.offload.OffloadUtils.setOffloadDriverMetadata(org.apache.bookkeeper.mledger.proto.MLDataFormats.ManagedLedgerInfo.LedgerInfo$Builder,java.lang.String,java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "OffloadUtilsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.offload.OffloadUtilsTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "deploy-kubernetes in minikube tutorial doc seems not work", "body": "**Describe the bug**\r\nIn Pulsar website: http://pulsar.apache.org/docs/en/deploy-kubernetes/#minikube\r\nIt is suggested use this command:\r\n> minikube start --memory=8192 --cpus=4 \\\r\n>    --kubernetes-version=v1.10.5\r\n\r\nbut this will report error in macos 10.14.2\r\n![image](https://user-images.githubusercontent.com/6348208/69974222-ca664d80-155f-11ea-99eb-f604d09ccec0.png)\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. follow instructions  in above like to install the latest minikube\r\n2. run 'minikube start --memory=8192 --cpus=4 \\\r\n    --kubernetes-version=v1.10.5'\r\n3. See error\r\n\r\n**Expected behavior**\r\nNo error happens\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5787", "user": "jiazhai", "labels": ["triage/week-49", "type/bug"], "created": "2019-12-02 16:01:43", "closed": "2019-12-06 08:19:38", "commits": {"eec4fa5e2d6df7b7a4b465118ac0227e0608fd79": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "eec4fa5e2d6df7b7a4b465118ac0227e0608fd79", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["180e28aceb39d1683df034c8c2234595d23ab935"], "nameRev": "eec4fa5e2d6df7b7a4b465118ac0227e0608fd79 tags/v2.5.0-candidate-1~18", "commitMessage": "[Issue:5787] Fix docs for creating a K8S cluster on Minikube fail (#5805)\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>\r\n\r\nSigned-off-by: xiaolong.ran <rxl@apache.org>\r\n\r\nFixes #5787 \r\n\r\n### Motivation\r\n\r\nWhen we creating a K8S cluster on Minikube, due to the different versions of Minikube in the local environment, the installation fails on `--kubernetes-version=v1.10.5`.\r\n\r\n### Modifications\r\n\r\n- Remove the `--kubernetes-version=v1.10.5` in docs.", "commitDateTime": "2019-12-06 16:19:37", "authoredDateTime": "2019-12-06 16:19:37", "commitGitStats": [{"filePath": "deployment/kubernetes/helm/README.md", "insertions": 1, "deletions": 2, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[docs] Reorganize \"Tiered storage\" content", "body": "**Describe the bug**\r\nThere are two sections about \"tiered storage\" under \"Concepts and Architecture\" and \"Cookbooks\", the information splits. It's better to reorganize the the content for \"tierage storage\" after merging https://github.com/apache/pulsar/pull/5762\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5779", "user": "Jennifer88huang", "labels": ["component/documentation", "triage/week-49", "type/bug"], "created": "2019-12-02 02:01:50", "closed": "2020-07-03 01:23:22", "commits": {}, "ttf": 213.00027777777777, "commitsDetails": []}, {"title": "Python API Docs are not updated", "body": "**Describe the bug**\r\nPython API docs do not represent the 2.4.1 code that the rest of the site is based on.\r\nSpecifically, the Client.subscribe method now takes an initial_position argument that is missing from the documentation. It appears that the doc generation pipeline is still broken from #5368 \r\n\r\n**To Reproduce**\r\nhttps://pulsar.apache.org/api/python/\r\n\r\n**Expected behavior**\r\nThe Python API documentation would show code and examples congruent with the rest of the documentation\r\n", "url": "https://github.com/apache/pulsar/issues/5778", "user": "acedrew", "labels": ["component/website", "triage/week-49", "type/bug"], "created": "2019-12-02 00:26:14", "closed": "2020-01-14 13:18:47", "commits": {}, "ttf": 43.000277777777775, "commitsDetails": []}, {"title": "Bump Lombok version to allow building with a JDK >=12", "body": "**Describe the bug**\r\nRunning `mvn clean install` on branch master using JDK13 results on a Lombok annotation failure.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Pull JDK13\r\n2. Run `mvn install`\r\n\r\n**Expected behavior**\r\nBuild success\r\n\r\n**Screenshots**\r\n```\r\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.8.0:testCompile (default-testCompile) on project integration: Compilation failure\r\n[ERROR] Lombok annotation handler class lombok.javac.handlers.HandleBuilder failed on /home/pierrez/workspace/java/pulsar/tests/integration/src/test/java/org/apache/pulsar/tests/integration/topologies/PulsarClusterSpec.java: \r\njava.lang.IllegalStateException: Lombok TreeMaker frontend issue: no match when looking for method: com.sun.tools.javac.tree.JCTree$JCCase com.sun.tools.javac.tree.TreeMaker.Case(com.sun.tools.javac.tree.JCTree$JCExpression, com.sun.tools.javac.util.List)\r\n```\r\n\r\nIt is an [closed Lombok issue](rzwitserloot/lombok/issues/1888), so we should be fine by upgrading Lombok.\r\n\r\n**Desktop (please complete the following information):**\r\n\r\n```bash\r\nuname -a\r\n# Linux pierrez-xps 5.3.0-23-generic #25-Ubuntu SMP Tue Nov 12 09:22:33 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\njava -version\r\n# openjdk version \"13.0.1\" 2019-10-15\r\n# OpenJDK Runtime Environment AdoptOpenJDK (build 13.0.1+9)\r\n# OpenJDK 64-Bit Server VM AdoptOpenJDK (build 13.0.1+9, mixed mode, sharing)\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/5772", "user": "PierreZ", "labels": ["help wanted", "triage/week-48", "type/bug"], "created": "2019-11-29 08:52:00", "closed": "2019-11-30 06:02:44", "commits": {"f0b34e79d53a909fcce31f3231b03a308b5a6120": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "f0b34e79d53a909fcce31f3231b03a308b5a6120", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["035743ffa13de200c0fb36500c70d10b4c523a35"], "nameRev": "f0b34e79d53a909fcce31f3231b03a308b5a6120 tags/v2.5.0-candidate-1~31", "commitMessage": "Bump Lombok version to allow building with a JDK12>=12 (#5772) (#5773)\n\nFixes #5772 \r\n\r\n### Motivation\r\n\r\nI would like to be able to build Pulsar with at least JDK12.\r\n\r\n### Modifications\r\n\r\nBumping lombok dep.\r\n\r\n### Verifying this change\r\n\r\n\r\nThis change is a trivial rework / code cleanup without any test coverage.", "commitDateTime": "2019-11-29 22:02:43", "authoredDateTime": "2019-11-30 07:02:43", "commitGitStats": [{"filePath": "pom.xml", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Broker graceful shutdown when znode of loadbalance disappeared", "body": "**Describe the bug**\r\n```\r\n00:03:35.345 [pulsar-load-manager-4-1] WARN  org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl - Error writing broker data on ZooKeeper: {}\r\norg.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /loadbalance/brokers/172.30.92.32:8080\r\n\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:114) ~[org.apache.pulsar-pulsar-zookeeper-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54) ~[org.apache.pulsar-pulsar-zookeeper-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.zookeeper.ZooKeeper.setData(ZooKeeper.java:1336) ~[org.apache.pulsar-pulsar-zookeeper-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient.access$3101(ZooKeeperClient.java:70) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient$21.call(ZooKeeperClient.java:1065) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient$21.call(ZooKeeperClient.java:1059) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.zookeeper.ZooWorker.syncCallWithRetries(ZooWorker.java:140) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient.setData(ZooKeeperClient.java:1059) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl.writeBrokerDataOnZooKeeper(ModularLoadManagerImpl.java:873) [org.apache.pulsar-pulsar-broker-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerWrapper.writeLoadReportOnZookeeper(ModularLoadManagerWrapper.java:120) [org.apache.pulsar-pulsar-broker-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.broker.loadbalance.LoadReportUpdaterTask.run(LoadReportUpdaterTask.java:41) [org.apache.pulsar-pulsar-broker-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_181]\r\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [?:1.8.0_181]\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_181]\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [?:1.8.0_181]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_181]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_181]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\n00:03:35.752 [pulsar-io-22-37] WARN  org.apache.pulsar.broker.MessagingServiceShutdownHook - Graceful shutdown timeout expired. Closing nowzh\r\n```\r\n\r\n**Expected behavior**\r\nCatch the no node exception and create the disappeared znode\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5763", "user": "codelipenghui", "labels": ["help wanted", "triage/week-48", "type/bug"], "created": "2019-11-28 07:04:41", "closed": "2019-12-07 15:01:53", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "IndexOutOfBoundsException in PerformanceProducer", "body": "**Describe the bug**\r\nHere is the error log:\r\n```\r\n00:04:50.603 [pulsar-client-io-2-22] WARN  org.apache.pulsar.testclient.PerformanceProducer - Write error on message\r\njava.util.concurrent.CompletionException: java.lang.ArrayIndexOutOfBoundsException: value outside of histogram covered range. Caused by: java.lang.IndexOutOfBoundsException: index 1442458\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273) ~[?:1.8.0_181]\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280) ~[?:1.8.0_181]\r\n\tat java.util.concurrent.CompletableFuture.uniRun(CompletableFuture.java:708) ~[?:1.8.0_181]\r\n\tat java.util.concurrent.CompletableFuture$UniRun.tryFire(CompletableFuture.java:687) ~[?:1.8.0_181]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) [?:1.8.0_181]\r\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1962) [?:1.8.0_181]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl$1.sendComplete(ProducerImpl.java:253) [org.apache.pulsar-pulsar-client-original-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.ackReceived(ProducerImpl.java:714) [org.apache.pulsar-pulsar-client-original-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleSendReceipt(ClientCnx.java:363) [org.apache.pulsar-pulsar-client-original-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:208) [org.apache.pulsar-pulsar-common-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:323) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:426) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:278) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1434) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:965) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:799) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:433) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:330) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\nCaused by: java.lang.ArrayIndexOutOfBoundsException: value outside of histogram covered range. Caused by: java.lang.IndexOutOfBoundsException: index 1442458\r\n\tat org.HdrHistogram.AbstractHistogram.handleRecordException(AbstractHistogram.java:492) ~[org.hdrhistogram-HdrHistogram-2.1.9.jar:2.1.9]\r\n\tat org.HdrHistogram.AbstractHistogram.recordSingleValue(AbstractHistogram.java:484) ~[org.hdrhistogram-HdrHistogram-2.1.9.jar:2.1.9]\r\n\tat org.HdrHistogram.AbstractHistogram.recordValue(AbstractHistogram.java:397) ~[org.hdrhistogram-HdrHistogram-2.1.9.jar:2.1.9]\r\n\tat org.HdrHistogram.Recorder.recordValue(Recorder.java:100) ~[org.hdrhistogram-HdrHistogram-2.1.9.jar:2.1.9]\r\n\tat org.apache.pulsar.testclient.PerformanceProducer.lambda$runProducer$2(PerformanceProducer.java:495) ~[org.apache.pulsar-pulsar-testclient-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat java.util.concurrent.CompletableFuture.uniRun(CompletableFuture.java:705) ~[?:1.8.0_181]\r\n\t... 27 more\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Use pulsar-perf to run long times(e.g. 8 hours)\r\n2. Can see the above error log\r\n3. The pulsar-perf will exit\r\n", "url": "https://github.com/apache/pulsar/issues/5760", "user": "codelipenghui", "labels": ["triage/week-48", "type/bug"], "created": "2019-11-28 02:25:33", "closed": "2019-12-07 09:05:29", "commits": {"54ec19423883e6c1ab3db828ab13ef92aba511a5": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 9.000277777777777, "commitsDetails": [{"commitHash": "54ec19423883e6c1ab3db828ab13ef92aba511a5", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["bfaa6ba39149bb17d606ce812a41eb39c46ca285"], "nameRev": "54ec19423883e6c1ab3db828ab13ef92aba511a5 tags/v2.5.0-candidate-1~11", "commitMessage": "Fix ArrayIndexOutOfBoundsException in PerformanceProducer. (#5786)\n\nFixes #5760\r\n\r\n### Motivation\r\n\r\nWe use `org.HdrHistogram.Recorder` to record write latency and `highestTrackableValue` is `TimeUnit.SECONDS.toMicros(120000)`, but we record the value in micros, the error happens when the latency in micros is a very large number, so this PR change the `highestTrackableValue` of Recorder to `TimeUnit.SECONDS.toMicros(120000)`\r\n", "commitDateTime": "2019-12-07 17:05:28", "authoredDateTime": "2019-12-07 17:05:28", "commitGitStats": [{"filePath": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/PerformanceProducer.java", "insertions": 7, "deletions": 2, "lines": 9}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PerformanceProducer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.testclient.PerformanceProducer", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.testclient.PerformanceProducer.runProducer(org.apache.pulsar.testclient.PerformanceProducer$Arguments,long,int,java.util.List,byte[],java.util.Random,java.util.concurrent.CountDownLatch)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "UnAckedMessages admin information not correct", "body": "We are trying to test UnAck message redelivery function. \r\n\r\nVersion: 2.4.1 standalone\r\n\r\n\r\n**Describe the bug**\r\nWe use pulsar admin CLI to check topic stats. The unackedMessages field number is negative which makes no sense to me.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Set \"maxUnackedMessagesPerConsumer\" to be 0 (Non 0 value won't trigger this bug) \r\n2. Start pulsar(standalone)\r\n3. Use java pulsar client to create topic and subscription.\r\n4. Utilize java pulsar client to produce 100000 messages.\r\n5. Start a consumer to consume messages, acknowledge 1 message for every 1000 messages.\r\n\r\n**Expected behavior**\r\n![image](https://user-images.githubusercontent.com/6291739/69706066-e322cd80-1131-11ea-8e11-a69bec77d92d.png)\r\n\r\n**Practice behavior**\r\n![image](https://user-images.githubusercontent.com/6291739/69706109-fa61bb00-1131-11ea-9819-4844b4a29247.png)\r\nIt is clear that the unackedMessages is a negative number.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Mac OS 10.14.6\r\n", "url": "https://github.com/apache/pulsar/issues/5755", "user": "Fomal-haut", "labels": ["help wanted", "triage/week-48", "type/bug"], "created": "2019-11-27 10:24:21", "closed": "2020-01-06 04:01:09", "commits": {"9d948600af665f13b1ae3a7ee5a24b1136aabbcc": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "e413d41d23d6c87a890dee45ac94788eaacb9755": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 39.000277777777775, "commitsDetails": [{"commitHash": "9d948600af665f13b1ae3a7ee5a24b1136aabbcc", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["0a259ab807544fdd28122cf232a1579c3d9f6292"], "nameRev": "9d948600af665f13b1ae3a7ee5a24b1136aabbcc tags/v2.6.0-candidate-1~651", "commitMessage": "Fix negative un-ack messages in consumer stats (#5929)\n\nFixes #5755\r\n\r\n### Motivation\r\n\r\nFix negative un-ack messages in consumer stats while set maxUnackedMessagesPerConsumer=0\r\n\r\n### Verifying this change\r\n\r\nAdded unit test", "commitDateTime": "2020-01-06 12:01:08", "authoredDateTime": "2020-01-06 12:01:08", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/ConsumerStatsTest.java", "insertions": 106, "deletions": 0, "lines": 106}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Consumer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.Consumer.incrementUnackedMessages(int)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ConsumerStatsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.stats.ConsumerStatsTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "e413d41d23d6c87a890dee45ac94788eaacb9755", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["9c68641f438617ef135f2e24830523847960b9d6"], "nameRev": "e413d41d23d6c87a890dee45ac94788eaacb9755 tags/v2.5.1-candidate-3~120", "commitMessage": "Fix negative un-ack messages in consumer stats (#5929)\n\nFixes #5755\r\n\r\n### Motivation\r\n\r\nFix negative un-ack messages in consumer stats while set maxUnackedMessagesPerConsumer=0\r\n\r\n### Verifying this change\r\n\r\nAdded unit test\n\n(cherry picked from commit 9d948600af665f13b1ae3a7ee5a24b1136aabbcc)\n", "commitDateTime": "2020-04-13 11:06:50", "authoredDateTime": "2020-01-06 12:01:08", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/ConsumerStatsTest.java", "insertions": 106, "deletions": 0, "lines": 106}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Consumer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.Consumer.incrementUnackedMessages(int)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ConsumerStatsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.stats.ConsumerStatsTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[Doc] link for  TLS Authentication on Proxies is dead", "body": "Expected behavior\r\nShow a page / Enabling TLS Authentication on Proxies \r\nActual behavior\r\n404\r\nSteps to reproduce\r\n1\u3001Open https://pulsar.apache.org/docs/zh-CN/security-authorization/\r\n2\u3001Click a link for  Enabling TLS Authentication on Proxies", "url": "https://github.com/apache/pulsar/issues/5753", "user": "wangyunpeng666", "labels": ["component/documentation", "triage/week-48", "type/bug"], "created": "2019-11-26 13:07:02", "closed": "2019-12-01 16:47:21", "commits": {"9137065ffcacc05471a31e930fb0155a44e5a088": {"commitGHEventType": "referenced", "commitUser": "Jennifer88huang"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "9137065ffcacc05471a31e930fb0155a44e5a088", "commitGHEventType": "referenced", "commitUser": "Jennifer88huang", "commitParents": ["e121108e01ac2a100552b63cbba491a2ae320b28"], "nameRev": "9137065ffcacc05471a31e930fb0155a44e5a088 tags/v2.5.0-candidate-1~23", "commitMessage": "[docs] Fix link issue for \"Authentication and authorization in Pulsar\" (#5764)\n\n* Update security-authorization.md\r\n\r\nFix the link issue #34\r\n\r\nsee [\"Enabling TLS Authentication on Proxies\"](security-tls-authentication.md#on-proxies)\r\n\r\n* Fixes #5753\r\n\r\nFixes the link for \"Enabling TLS Authentication on Proxies\".\r\n\r\n* Update security-authorization.md\r\n", "commitDateTime": "2019-12-03 11:30:40", "authoredDateTime": "2019-12-03 11:30:40", "commitGitStats": [{"filePath": "site2/website/versioned_docs/version-2.4.1/security-authorization.md", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Bookie does not start because of UnknownHostException", "body": "We are trying to set up Pulsar using 3 systems each with 8GB RAM and AMD A8 processors. We are planning on running bookkeeper, zookeeper, broker on the same machines.\r\n\r\n**Describe the bug**\r\n[main] ERROR org.apache.bookkeeper.server.Main - Failed to build bookie server\r\njava.net.UnknownHostException: Trying to listen on loopback address, 127.0.1.1:3181 but this is forbidden by default (see ServerConfiguration#getAllowLoopback()).\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Follow the setup steps given at https://pulsar.apache.org/docs/en/deploy-bare-metal/\r\n2. We added the servers to the zookeeper.conf file and create data directory and id. We are using the following Zookeper configuration\r\n```\r\nserver.1=10.6.8.14:2888:3888\r\nserver.2=10.6.8.13:2888:3888\r\nserver.3=10.6.8.15:2888:3888\r\n```\r\n\r\n3. We initialized cluster metadata as follows in the server.1 machine\r\n```\r\nbin/pulsar initialize-cluster-metadata --cluster pulsar-cluster-1 --zookeeper 10.6.8.14:2181 --web-service-url http://10.6.8.14:8080,10.6.8.13:8080,10.6.8.15:8080 --broker-service-url pulsar://10.6.8.14:6650,10.6.8.13:6650,10.6.8.15:6650 --configuration-store 10.6.8.14:2181\r\n```\r\n\r\n4. We changed bookkeeper.conf as follows\r\n```\r\nzkServers=10.6.8.14:2181,10.6.8.13:2181,10.6.8.15:2181\r\n```\r\n\r\n5. We started Bookie and got the following error\r\n```\r\nbin/bookkeeper bookie\r\nJMX enabled by default\r\nJAVA_HOME not set, using java from PATH. (/usr/bin/java)\r\n15:02:38.366 [main] INFO  org.apache.bookkeeper.server.Main - Using configuration file /home/slave1fyp/apache-pulsar-2.4.1/conf/bookkeeper.conf\r\n15:02:38.371 [main] INFO  org.apache.bookkeeper.server.Main - Hello, I'm your bookie, listening on port 3181. Metadata service uri is zk+null://10.6.8.14:2181;10.6.8.13:2181;10.6.8.15:2181/ledgers. Journals are in [data/bookkeeper/journal]. Ledgers are stored in data/bookkeeper/ledgers.\r\n15:02:38.394 [main] INFO  org.apache.bookkeeper.server.Main - Load lifecycle component : org.apache.bookkeeper.server.service.StatsProviderService\r\n15:02:38.741 [main] INFO  org.apache.bookkeeper.proto.BookieServer - {\r\n  \"readBufferSizeBytes\" : \"4096\",\r\n  \"statsProviderClass\" : \"org.apache.bookkeeper.stats.prometheus.PrometheusMetricsProvider\",\r\n  \"majorCompactionThreshold\" : \"0.5\",\r\n  \"numJournalCallbackThreads\" : \"8\",\r\n  \"httpServerPort\" : \"8000\",\r\n  \"lostBookieRecoveryDelay\" : \"0\",\r\n  \"journalAlignmentSize\" : \"4096\",\r\n  \"compactionRateByBytes\" : \"1000000\",\r\n  \"httpServerClass\" : \"org.apache.bookkeeper.http.vertx.VertxHttpServer\",\r\n  \"dbStorage_rocksDB_numFilesInLevel0\" : \"4\",\r\n  \"minUsableSizeForIndexFileCreation\" : \"1073741824\",\r\n  \"gcOverreplicatedLedgerWaitTime\" : \"86400000\",\r\n  \"journalMaxGroupWaitMSec\" : \"1\",\r\n  \"dbStorage_rocksDB_numLevels\" : \"-1\",\r\n  \"dbStorage_rocksDB_bloomFilterBitsPerKey\" : \"10\",\r\n  \"ledgerStorageClass\" : \"org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage\",\r\n  \"auditorPeriodicBookieCheckInterval\" : \"86400\",\r\n  \"gcWaitTime\" : \"900000\",\r\n  \"compactionRate\" : \"1000\",\r\n  \"fileInfoFormatVersionToWrite\" : \"0\",\r\n  \"entryLogFilePreallocationEnabled\" : \"true\",\r\n  \"journalSyncData\" : \"true\",\r\n  \"zkServers\" : \"[10.6.8.14:2181, 10.6.8.13:2181, 10.6.8.15:2181]\",\r\n  \"compactionRateByEntries\" : \"1000\",\r\n  \"dbStorage_rocksDB_maxSizeInLevel1MB\" : \"256\",\r\n  \"diskCheckInterval\" : \"10000\",\r\n  \"auditorPeriodicCheckInterval\" : \"604800\",\r\n  \"dbStorage_rocksDB_writeBufferSizeMB\" : \"64\",\r\n  \"autoRecoveryDaemonEnabled\" : \"true\",\r\n  \"maxPendingAddRequestsPerThread\" : \"10000\",\r\n  \"majorCompactionInterval\" : \"86400\",\r\n  \"httpServerEnabled\" : \"false\",\r\n  \"flushInterval\" : \"60000\",\r\n  \"journalFlushWhenQueueEmpty\" : \"false\",\r\n  \"minorCompactionInterval\" : \"3600\",\r\n  \"dbStorage_rocksDB_blockCacheSize\" : \"\",\r\n  \"isThrottleByBytes\" : \"false\",\r\n  \"numAddWorkerThreads\" : \"0\",\r\n  \"dbStorage_rocksDB_sstSizeInMB\" : \"64\",\r\n  \"journalDirectory\" : \"data/bookkeeper/journal\",\r\n  \"journalWriteBufferSizeKB\" : \"64\",\r\n  \"diskUsageThreshold\" : \"0.95\",\r\n  \"openFileLimit\" : \"0\",\r\n  \"prometheusStatsHttpPort\" : \"8000\",\r\n  \"zkLedgersRootPath\" : \"/ledgers\",\r\n  \"journalMaxSizeMB\" : \"2048\",\r\n  \"journalAdaptiveGroupWrites\" : \"true\",\r\n  \"openLedgerRereplicationGracePeriod\" : \"30\",\r\n  \"ledgerDirectories\" : \"data/bookkeeper/ledgers\",\r\n  \"zkTimeout\" : \"30000\",\r\n  \"dbStorage_rocksDB_blockSize\" : \"65536\",\r\n  \"journalMaxBackups\" : \"5\",\r\n  \"maxPendingReadRequestsPerThread\" : \"2500\",\r\n  \"useHostNameAsBookieID\" : \"false\",\r\n  \"rereplicationEntryBatchSize\" : \"100\",\r\n  \"allowLoopback\" : \"false\",\r\n  \"readOnlyModeEnabled\" : \"true\",\r\n  \"journalRemoveFromPageCache\" : \"true\",\r\n  \"dbStorage_readAheadCacheMaxSizeMb\" : \"\",\r\n  \"zkEnableSecurity\" : \"false\",\r\n  \"numHighPriorityWorkerThreads\" : \"8\",\r\n  \"dbStorage_readAheadCacheBatchSize\" : \"1000\",\r\n  \"journalFormatVersionToWrite\" : \"5\",\r\n  \"writeBufferSizeBytes\" : \"65536\",\r\n  \"bookiePort\" : \"3181\",\r\n  \"dbStorage_writeCacheMaxSizeMb\" : \"\",\r\n  \"pageLimit\" : \"0\",\r\n  \"logSizeLimit\" : \"1073741824\",\r\n  \"advertisedAddress\" : \"\",\r\n  \"bookieDeathWatchInterval\" : \"1000\",\r\n  \"numReadWorkerThreads\" : \"8\",\r\n  \"minorCompactionThreshold\" : \"0.2\",\r\n  \"serverTcpNoDelay\" : \"true\",\r\n  \"journalBufferedWritesThreshold\" : \"524288\",\r\n  \"compactionMaxOutstandingRequests\" : \"100000\",\r\n  \"journalPreAllocSizeMB\" : \"16\"\r\n}\r\n15:02:39.490 [main] ERROR org.apache.bookkeeper.server.Main - Failed to build bookie server\r\njava.net.UnknownHostException: Trying to listen on loopback address, 127.0.1.1:3181 but this is forbidden by default (see ServerConfiguration#getAllowLoopback()).\r\nIf this happen, you can consider specifying the network interface to listen on (e.g. listeningInterface=eth0) or specifying the advertised address (e.g. advertisedAddress=172.x.y.z)\r\n\tat org.apache.bookkeeper.bookie.Bookie.getBookieAddress(Bookie.java:570) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.proto.BookieNettyServer.<init>(BookieNettyServer.java:164) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.proto.BookieServer.<init>(BookieServer.java:104) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.server.service.BookieService.<init>(BookieService.java:43) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.server.Main.buildBookieServer(Main.java:301) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.server.Main.doMain(Main.java:221) [org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.server.Main.main(Main.java:203) [org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.proto.BookieServer.main(BookieServer.java:314) [org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n```\r\n\r\n**Expected behavior**\r\nBookkeeper starts\r\n\r\n**Desktop (please complete the following information):**\r\n - 3 PC's with 8GB RAM and AMD A8 processors\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5749", "user": "vishalananth07", "labels": ["triage/week-48", "type/bug"], "created": "2019-11-26 09:55:30", "closed": "2019-12-16 07:58:55", "commits": {}, "ttf": 19.00027777777778, "commitsDetails": []}, {"title": "Release ByteBuf failed when send a over size message in message batch container", "body": "**Describe the bug**\r\nHere is the error log when publish a over size message:\r\n```\r\nio.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1\r\n\tat io.netty.util.internal.ReferenceCountUpdater.toLiveRealRefCnt(ReferenceCountUpdater.java:74) ~[netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.util.internal.ReferenceCountUpdater.release(ReferenceCountUpdater.java:138) ~[netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:100) ~[netty-buffer-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.util.ReferenceCountUtil.release(ReferenceCountUtil.java:88) ~[netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.util.ReferenceCountUtil.safeRelease(ReferenceCountUtil.java:113) [netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer$KeyedBatch.discard(BatchMessageKeyBasedContainer.java:244) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.createOpSendMsg(BatchMessageKeyBasedContainer.java:125) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.createOpSendMsgs(BatchMessageKeyBasedContainer.java:145) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.batchMessageAndSend(ProducerImpl.java:1426) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.triggerFlush(ProducerImpl.java:1411) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:112) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:89) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:63) [classes/:?]\r\n\tat org.apache.pulsar.broker.service.BatchMessageTest.testSendOverSizeMessage(BatchMessageTest.java:875) [test-classes/:?]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_201]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_201]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_201]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_201]\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeMethod(Invoker.java:583) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:719) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:989) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestRunner.privateRun(TestRunner.java:648) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestRunner.run(TestRunner.java:505) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:455) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:450) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:415) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:364) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:84) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1208) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1137) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuites(TestNG.java:1049) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.run(TestNG.java:1017) [testng-6.14.3.jar:?]\r\n\tat org.testng.IDEARemoteTestNG.run(IDEARemoteTestNG.java:73) [testng-plugin.jar:?]\r\n\tat org.testng.RemoteTestNGStarter.main(RemoteTestNGStarter.java:123) [testng-plugin.jar:?]\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Send a message which over than 5MB\r\n2. check the client log\r\n3. See error\r\n\r\n**Expected behavior**\r\nDon't release the ByteBuf since it is already released\r\n\r\n**Additional context**\r\nin master branch\r\n", "url": "https://github.com/apache/pulsar/issues/5747", "user": "codelipenghui", "labels": ["triage/week-48", "type/bug"], "created": "2019-11-26 08:53:55", "closed": "2019-11-29 11:02:11", "commits": {"ecf779210c31d1051f9cd2c823a1a7d078cdfd75": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "ecf779210c31d1051f9cd2c823a1a7d078cdfd75", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["2e30c086b2461531c62164d09ea148928a0e3ae6"], "nameRev": "ecf779210c31d1051f9cd2c823a1a7d078cdfd75 tags/v2.5.0-candidate-1~36", "commitMessage": "Fix NPE when send a large message and don't release batchedMessageMetadataAndPayload when discard in batch message container. (#5748)\n\nFixes #5746 #5747\r\n\r\n### Motivation\r\n\r\nFix NPE and release an already released ByteBuf when publish an oversize message.\r\n\r\nHere is error log:\r\n```\r\nio.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1\r\n\tat io.netty.util.internal.ReferenceCountUpdater.toLiveRealRefCnt(ReferenceCountUpdater.java:74) ~[netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.util.internal.ReferenceCountUpdater.release(ReferenceCountUpdater.java:138) ~[netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:100) ~[netty-buffer-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.util.ReferenceCountUtil.release(ReferenceCountUtil.java:88) ~[netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.util.ReferenceCountUtil.safeRelease(ReferenceCountUtil.java:113) [netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer$KeyedBatch.discard(BatchMessageKeyBasedContainer.java:244) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.createOpSendMsg(BatchMessageKeyBasedContainer.java:125) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.createOpSendMsgs(BatchMessageKeyBasedContainer.java:145) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.batchMessageAndSend(ProducerImpl.java:1426) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.triggerFlush(ProducerImpl.java:1411) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:112) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:89) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:63) [classes/:?]\r\n\tat org.apache.pulsar.broker.service.BatchMessageTest.testSendOverSizeMessage(BatchMessageTest.java:875) [test-classes/:?]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_201]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_201]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_201]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_201]\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeMethod(Invoker.java:583) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:719) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:989) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestRunner.privateRun(TestRunner.java:648) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestRunner.run(TestRunner.java:505) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:455) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:450) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:415) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:364) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:84) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1208) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1137) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuites(TestNG.java:1049) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.run(TestNG.java:1017) [testng-6.14.3.jar:?]\r\n\tat org.testng.IDEARemoteTestNG.run(IDEARemoteTestNG.java:73) [testng-plugin.jar:?]\r\n\tat org.testng.RemoteTestNGStarter.main(RemoteTestNGStarter.java:123) [testng-plugin.jar:?]\r\n\r\n\r\n\r\n16:19:13.850 [main:org.apache.pulsar.client.impl.ProducerImpl@1439] WARN  org.apache.pulsar.client.impl.ProducerImpl - [persistent://prop/ns-abc/testSendOverSizeMessage-623833fc-d9f7-4b28-aead-27955928fae9] [test-0-0] error while create opSendMsg by batch message container\r\njava.lang.NullPointerException: null\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.releaseSemaphoreForSendOp(ProducerImpl.java:858) ~[classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.processOpSendMsg(ProducerImpl.java:1477) ~[classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.batchMessageAndSend(ProducerImpl.java:1432) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.triggerFlush(ProducerImpl.java:1411) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:112) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:89) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:63) [classes/:?]\r\n\tat org.apache.pulsar.broker.service.BatchMessageTest.testSendOverSizeMessage(BatchMessageTest.java:875) [test-classes/:?]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_201]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_201]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_201]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_201]\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeMethod(Invoker.java:583) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:719) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:989) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestRunner.privateRun(TestRunner.java:648) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestRunner.run(TestRunner.java:505) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:455) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:450) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:415) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:364) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:84) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1208) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1137) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuites(TestNG.java:1049) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.run(TestNG.java:1017) [testng-6.14.3.jar:?]\r\n\tat org.testng.IDEARemoteTestNG.run(IDEARemoteTestNG.java:73) [testng-plugin.jar:?]\r\n\tat org.testng.RemoteTestNGStarter.main(RemoteTestNGStarter.java:123) [testng-plugin.jar:?]\r\n```\r\n\r\n### Modifications\r\n\r\nAdd check for processOpSendMsg, if the op is null, just return.\r\nDon't release the batchedMessageMetadataAndPayload since it is already released in getCompressedBatchMetadataAndPayload() method.\r\n", "commitDateTime": "2019-11-28 14:38:23", "authoredDateTime": "2019-11-29 06:38:23", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageContainerImpl.java", "insertions": 5, "deletions": 11, "lines": 16}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageKeyBasedContainer.java", "insertions": 6, "deletions": 10, "lines": 16}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BatchMessageContainerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.discard(java.lang.Exception)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.createOpSendMsg()", "TOT": 5, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 2}]}, {"spoonFilePath": "BatchMessageKeyBasedContainer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.createOpSendMsg(org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer$KeyedBatch)", "TOT": 5, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.KeyedBatch.discard(java.lang.Exception)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.processOpSendMsg(org.apache.pulsar.client.impl.ProducerImpl$OpSendMsg)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "NPE occur when send an over size message.", "body": "**Describe the bug**\r\nHere is the error log:\r\n```\r\n16:19:13.850 [main:org.apache.pulsar.client.impl.ProducerImpl@1439] WARN  org.apache.pulsar.client.impl.ProducerImpl - [persistent://prop/ns-abc/testSendOverSizeMessage-623833fc-d9f7-4b28-aead-27955928fae9] [test-0-0] error while create opSendMsg by batch message container\r\njava.lang.NullPointerException: null\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.releaseSemaphoreForSendOp(ProducerImpl.java:858) ~[classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.processOpSendMsg(ProducerImpl.java:1477) ~[classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.batchMessageAndSend(ProducerImpl.java:1432) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.triggerFlush(ProducerImpl.java:1411) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:112) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:89) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:63) [classes/:?]\r\n\tat org.apache.pulsar.broker.service.BatchMessageTest.testSendOverSizeMessage(BatchMessageTest.java:875) [test-classes/:?]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_201]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_201]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_201]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_201]\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeMethod(Invoker.java:583) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:719) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:989) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestRunner.privateRun(TestRunner.java:648) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestRunner.run(TestRunner.java:505) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:455) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:450) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:415) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:364) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:84) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1208) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1137) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuites(TestNG.java:1049) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.run(TestNG.java:1017) [testng-6.14.3.jar:?]\r\n\tat org.testng.IDEARemoteTestNG.run(IDEARemoteTestNG.java:73) [testng-plugin.jar:?]\r\n\tat org.testng.RemoteTestNGStarter.main(RemoteTestNGStarter.java:123) [testng-plugin.jar:?]\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Send a message which over than 5MB\r\n2. check the client log\r\n3. See error\r\n\r\n**Expected behavior**\r\nAdd check not null when process send message op\r\n\r\n**Additional context**\r\nHappens in master branch\r\n", "url": "https://github.com/apache/pulsar/issues/5746", "user": "codelipenghui", "labels": ["triage/week-47", "type/bug"], "created": "2019-11-26 08:48:46", "closed": "2019-11-28 22:38:24", "commits": {"ecf779210c31d1051f9cd2c823a1a7d078cdfd75": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "ecf779210c31d1051f9cd2c823a1a7d078cdfd75", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["2e30c086b2461531c62164d09ea148928a0e3ae6"], "nameRev": "ecf779210c31d1051f9cd2c823a1a7d078cdfd75 tags/v2.5.0-candidate-1~36", "commitMessage": "Fix NPE when send a large message and don't release batchedMessageMetadataAndPayload when discard in batch message container. (#5748)\n\nFixes #5746 #5747\r\n\r\n### Motivation\r\n\r\nFix NPE and release an already released ByteBuf when publish an oversize message.\r\n\r\nHere is error log:\r\n```\r\nio.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1\r\n\tat io.netty.util.internal.ReferenceCountUpdater.toLiveRealRefCnt(ReferenceCountUpdater.java:74) ~[netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.util.internal.ReferenceCountUpdater.release(ReferenceCountUpdater.java:138) ~[netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:100) ~[netty-buffer-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.util.ReferenceCountUtil.release(ReferenceCountUtil.java:88) ~[netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat io.netty.util.ReferenceCountUtil.safeRelease(ReferenceCountUtil.java:113) [netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer$KeyedBatch.discard(BatchMessageKeyBasedContainer.java:244) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.createOpSendMsg(BatchMessageKeyBasedContainer.java:125) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.createOpSendMsgs(BatchMessageKeyBasedContainer.java:145) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.batchMessageAndSend(ProducerImpl.java:1426) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.triggerFlush(ProducerImpl.java:1411) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:112) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:89) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:63) [classes/:?]\r\n\tat org.apache.pulsar.broker.service.BatchMessageTest.testSendOverSizeMessage(BatchMessageTest.java:875) [test-classes/:?]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_201]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_201]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_201]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_201]\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeMethod(Invoker.java:583) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:719) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:989) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestRunner.privateRun(TestRunner.java:648) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestRunner.run(TestRunner.java:505) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:455) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:450) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:415) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:364) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:84) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1208) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1137) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuites(TestNG.java:1049) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.run(TestNG.java:1017) [testng-6.14.3.jar:?]\r\n\tat org.testng.IDEARemoteTestNG.run(IDEARemoteTestNG.java:73) [testng-plugin.jar:?]\r\n\tat org.testng.RemoteTestNGStarter.main(RemoteTestNGStarter.java:123) [testng-plugin.jar:?]\r\n\r\n\r\n\r\n16:19:13.850 [main:org.apache.pulsar.client.impl.ProducerImpl@1439] WARN  org.apache.pulsar.client.impl.ProducerImpl - [persistent://prop/ns-abc/testSendOverSizeMessage-623833fc-d9f7-4b28-aead-27955928fae9] [test-0-0] error while create opSendMsg by batch message container\r\njava.lang.NullPointerException: null\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.releaseSemaphoreForSendOp(ProducerImpl.java:858) ~[classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.processOpSendMsg(ProducerImpl.java:1477) ~[classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.batchMessageAndSend(ProducerImpl.java:1432) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.triggerFlush(ProducerImpl.java:1411) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:112) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:89) [classes/:?]\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:63) [classes/:?]\r\n\tat org.apache.pulsar.broker.service.BatchMessageTest.testSendOverSizeMessage(BatchMessageTest.java:875) [test-classes/:?]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_201]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_201]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_201]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_201]\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeMethod(Invoker.java:583) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:719) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:989) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125) [testng-6.14.3.jar:?]\r\n\tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestRunner.privateRun(TestRunner.java:648) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestRunner.run(TestRunner.java:505) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:455) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:450) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:415) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:364) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52) [testng-6.14.3.jar:?]\r\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:84) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1208) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1137) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.runSuites(TestNG.java:1049) [testng-6.14.3.jar:?]\r\n\tat org.testng.TestNG.run(TestNG.java:1017) [testng-6.14.3.jar:?]\r\n\tat org.testng.IDEARemoteTestNG.run(IDEARemoteTestNG.java:73) [testng-plugin.jar:?]\r\n\tat org.testng.RemoteTestNGStarter.main(RemoteTestNGStarter.java:123) [testng-plugin.jar:?]\r\n```\r\n\r\n### Modifications\r\n\r\nAdd check for processOpSendMsg, if the op is null, just return.\r\nDon't release the batchedMessageMetadataAndPayload since it is already released in getCompressedBatchMetadataAndPayload() method.\r\n", "commitDateTime": "2019-11-28 14:38:23", "authoredDateTime": "2019-11-29 06:38:23", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageContainerImpl.java", "insertions": 5, "deletions": 11, "lines": 16}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageKeyBasedContainer.java", "insertions": 6, "deletions": 10, "lines": 16}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BatchMessageContainerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.discard(java.lang.Exception)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.createOpSendMsg()", "TOT": 5, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 2}]}, {"spoonFilePath": "BatchMessageKeyBasedContainer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.createOpSendMsg(org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer$KeyedBatch)", "TOT": 5, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.KeyedBatch.discard(java.lang.Exception)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.processOpSendMsg(org.apache.pulsar.client.impl.ProducerImpl$OpSendMsg)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[doc] Picture and text are not match ", "body": "**Describe the bug**\r\nPicture and text are not match.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'http://pulsar.apache.org/docs/en/concepts-messaging/'\r\n2. Click on 'Messaging'\r\n3. Scroll down to 'Subscription modes > Exclusive'\r\n4. See error\r\n\r\n**Expected behavior**\r\n\r\nMay be the Consumer-A  should be Consumer A-0.\r\n\r\n**Screenshots**\r\n![\u56fe\u7247](https://user-images.githubusercontent.com/29513837/69472688-40441980-0de8-11ea-8d0c-0a8d98de4d36.png)\r\n", "url": "https://github.com/apache/pulsar/issues/5729", "user": "huangdx0726", "labels": ["component/documentation", "triage/week-47", "type/bug"], "created": "2019-11-23 03:58:17", "closed": "2019-11-27 18:38:40", "commits": {"531aab0cd297cc91c613d0fd53a8820cfe60d6da": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "531aab0cd297cc91c613d0fd53a8820cfe60d6da", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["0ce3371b4fa6a5e1acb9deda6d8927bf8cb6da98"], "nameRev": "531aab0cd297cc91c613d0fd53a8820cfe60d6da tags/v2.5.0-candidate-1~43", "commitMessage": "[Issue 5729]Picture and text are not match (#5737)\n\n\r\nFixes #5729 \r\n\r\n### Motivation\r\n\r\nPicture and text are not match.\r\n\r\n### Modifications\r\nchanged the ```Consumer-A``` to ```Consumer A-0```\r\n", "commitDateTime": "2019-11-27 10:38:39", "authoredDateTime": "2019-11-28 02:38:39", "commitGitStats": [{"filePath": "site2/docs/concepts-messaging.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/concepts-messaging.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.3.0/concepts-messaging.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.3.1/concepts-messaging.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.3.2/concepts-messaging.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.4.0/concepts-messaging.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.4.1/concepts-messaging.md", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[doc] Missing right Parentheses", "body": "**Describe the bug**\r\nMissing right Parentheses \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'http://pulsar.apache.org/docs/en/concepts-messaging/'\r\n2. Click on 'Messaging'\r\n3. Scroll down to 'Producers>Send modes'\r\n4. See error\r\n![\u56fe\u7247](https://user-images.githubusercontent.com/29513837/69471843-f571d400-0dde-11ea-932b-cefdd98d2f91.png)\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5728", "user": "huangdx0726", "labels": ["component/documentation", "type/bug"], "created": "2019-11-23 02:50:14", "closed": "2019-11-26 07:08:10", "commits": {"de2ff6b121de740635d89360e03899a99b41e34f": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "de2ff6b121de740635d89360e03899a99b41e34f", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["4207de67e49dc78f24b75a6211e11dbe27ad2f5d"], "nameRev": "de2ff6b121de740635d89360e03899a99b41e34f tags/v2.5.0-candidate-1~52", "commitMessage": "Add right parenthesis for \"(max size configurable\" (#5744)\n\nResolved issue #5728", "commitDateTime": "2019-11-26 14:06:14", "authoredDateTime": "2019-11-26 14:06:14", "commitGitStats": [{"filePath": "site2/docs/concepts-messaging.md", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Unhandled NoClassDefFoundError in SourceConfigUtils.java (and friends)", "body": "**Describe the bug**\r\n\r\nI am running a custom LocalRunner under the control of Gradle.\r\nThere is a problem in SourceConfigUtils::validate()\r\nWhen the jarClassLoader is used a ClassNotFoundException is caught.\r\nThe catch results in using the narClassLoader which would succeed. \r\nBut instead a  NoClassDefFoundError is produced for which there is no catch and consequently the narClassLoader is not used.\r\n\r\n**To Reproduce**\r\n\r\nIt is not entirely clear to me why NoClassDefFoundError is sometimes the thrown exception.\r\nThe issue is that it is not an unreasonable exception to expect when a classloader is\r\nunable to find a particular class.\r\n\r\n**Expected behavior**\r\n\r\nThe nar file does not have its sub-dependancies in the top level but in the bundled-dependencies.\r\nI expect it to not find the PushSource when read as a jar file and then process the file as a NAR.\r\nThe fact that the class is not found is as expected.\r\n\r\n**Operating Environment:**\r\n\r\n - run a variant of LocalRunner in a gradle task\r\n\r\n**Additional context**\r\n\r\nI have done some noodling around and have found that the narClassLoader would have succeeded had it been used.\r\nhttps://github.com/apache/pulsar/blob/413aa74ed68557284d6f4502456b3bef2dbd9618/pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/SourceConfigUtils.java#L282-L299\r\nThe following is a trivial (but repetitive) fix that has worked for  me.\r\n\r\n                try {\r\n                    typeArg = getSourceType(sourceClassName, jarClassLoader);\r\n                    classLoader = jarClassLoader;\r\n                } \r\n                catch (ClassNotFoundException e) {\r\n                    // class not found in JAR try loading as a NAR and searching for the class\r\n                    if (narClassLoader != null) {\r\n                        try {\r\n                            typeArg = getSourceType(sourceClassName, narClassLoader);\r\n                            classLoader = narClassLoader;\r\n                        } catch (ClassNotFoundException e1) {\r\n                            throw new IllegalArgumentException(\r\n                                    String.format(\"Source class %s must be in class path\", sourceClassName), e1);\r\n                        }\r\n                    } else {\r\n                        throw new IllegalArgumentException(\r\n                                String.format(\"Source class %s must be in class path\", sourceClassName), e);\r\n                    }\r\n               } \r\n               catch (NoClassDefFoundError e) {\r\n                    // class not found in JAR try loading as a NAR and searching for the class\r\n                    if (narClassLoader != null) {\r\n                        try {\r\n                            typeArg = getSourceType(sourceClassName, narClassLoader);\r\n                            classLoader = narClassLoader;\r\n                        } catch (ClassNotFoundException e1) {\r\n                            throw new IllegalArgumentException(\r\n                                    String.format(\"Source class %s must be in class path\", sourceClassName), e1);\r\n                        }\r\n                    } else {\r\n                        throw new IllegalArgumentException(\r\n                                String.format(\"Source class %s must be in class path\", sourceClassName), e);\r\n                    }\r\n                }\r\n", "url": "https://github.com/apache/pulsar/issues/5726", "user": "phreed", "labels": ["help wanted", "triage/week-47", "type/bug"], "created": "2019-11-22 22:46:29", "closed": "2019-12-20 05:28:50", "commits": {"17e22d1eb19e763b2e89dfd5bdf0b7479653a3d9": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 27.00027777777778, "commitsDetails": [{"commitHash": "17e22d1eb19e763b2e89dfd5bdf0b7479653a3d9", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["5ffca81e994962db3f3e2c3599354e20f1f616f9"], "nameRev": "17e22d1eb19e763b2e89dfd5bdf0b7479653a3d9 tags/v2.5.0-candidate-2~33", "commitMessage": "Added catch for NoClassDefFoundError wherever there was a ClassNotFoundException (#5870)\n\nFixes #5726 \r\n\r\n### Motivation\r\n\r\nWhen running pulsar-io connectors and functions from the Intellij IDE some actions fail\r\ndue to uncaught class-not-found throwables.\r\nThe expectation being that the class is being dynamically loaded and only the ClassNotFoundException will occur if the class is not found.\r\nWhen the function is created or run with https://pulsar.apache.org/docs/en/functions-deploying/#local-run-mode this is indeed the case.\r\nWhen running under the control https://pulsar.apache.org/docs/en/functions-debug/#debug-with-localrun-mode as a gradle plugin the class may already be known and throw a NoClassDefFoundError.\r\nIt seems to me that any time ClassNotFoundException is handled then NoClassDefFoundError should also be caught.\r\n\r\n### Modifications\r\n\r\nWherever there was a `catch (ClassNotFoundException ` I replaced it with \r\n`catch (ClassNotFoundException | NoClassDefFoundError ` .\r\nThere were multiple cases where the ClassNotFoundException were handled e.g. the jar loader failed so the nar loader was used to handle the jar loader's failure.", "commitDateTime": "2019-12-19 21:28:49", "authoredDateTime": "2019-12-19 23:28:49", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/internal/ReflectionUtils.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka_0_8/src/main/java/org/apache/kafka/clients/producer/PulsarKafkaProducer.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/nar/NarClassLoader.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/windowing/WindowFunctionExecutor.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-functions/runtime-all/src/main/java/org/apache/pulsar/functions/instance/JavaInstanceMain.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/FunctionCommon.java", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/FunctionConfigUtils.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/Reflections.java", "insertions": 7, "deletions": 7, "lines": 14}, {"filePath": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/SinkConfigUtils.java", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/SourceConfigUtils.java", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/ValidatorUtils.java", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-io/flume/src/main/java/org/apache/pulsar/io/flume/node/PropertiesFileConfigurationProvider.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-io/hdfs2/src/main/java/org/apache/pulsar/io/hdfs2/AbstractHdfsConnector.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-io/hdfs3/src/main/java/org/apache/pulsar/io/hdfs3/AbstractHdfsConnector.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-io/jdbc/src/test/java/org/apache/pulsar/io/jdbc/SqliteUtils.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarConnectorUtils.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.updateConfigurationAndRegisterListeners()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ReflectionUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.internal.ReflectionUtils.newClassInstance(java.lang.String)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarKafkaProducer.java", "spoonMethods": [{"spoonMethodName": "org.apache.kafka.clients.producer.PulsarKafkaProducer.newInstance(java.lang.String,java.lang.Class,kafka.utils.VerifiableProperties)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NarClassLoader.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.nar.NarClassLoader.getFromArchive(java.io.File,java.util.Set)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.nar.NarClassLoader.getFromArchive(java.io.File,java.util.Set,java.lang.ClassLoader)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.isProtobufClass(java.lang.Class)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "WindowFunctionExecutor.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.windowing.WindowFunctionExecutor.getTimeStampExtractor(org.apache.pulsar.common.functions.WindowConfig)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JavaInstanceMain.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.instance.JavaInstanceMain.createInstance(java.lang.String,java.lang.ClassLoader)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "FunctionCommon.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.utils.FunctionCommon.createInstance(java.lang.String,java.lang.ClassLoader)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.utils.FunctionCommon.implementsClass(java.lang.String,java.lang.Class,java.lang.ClassLoader)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.utils.FunctionCommon.loadClass(java.lang.String,java.lang.ClassLoader)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "FunctionConfigUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.utils.FunctionConfigUtils.doJavaChecks(org.apache.pulsar.common.functions.FunctionConfig,java.lang.ClassLoader)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.utils.FunctionConfigUtils.convert(org.apache.pulsar.common.functions.FunctionConfig,java.lang.ClassLoader)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Reflections.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.utils.Reflections.createInstance(java.lang.String,java.lang.Class,java.lang.ClassLoader)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.utils.Reflections.createInstance(java.lang.String,java.lang.ClassLoader)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.utils.Reflections.createInstance(java.lang.String,java.lang.ClassLoader,java.lang.Object[],java.lang.Class[])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "java.lang.ReflectiveOperationException", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.utils.Reflections.classImplementsIface(java.lang.String,java.lang.Class)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.utils.Reflections.loadClass(java.lang.String,java.lang.ClassLoader)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SinkConfigUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.utils.SinkConfigUtils.validate(org.apache.pulsar.common.io.SinkConfig,java.nio.file.Path,java.io.File)", "TOT": 4, "UPD": 4, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SourceConfigUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.utils.SourceConfigUtils.validate(org.apache.pulsar.common.io.SourceConfig,java.nio.file.Path,java.io.File)", "TOT": 4, "UPD": 4, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ValidatorUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.utils.ValidatorUtils.validateSerde(java.lang.String,java.lang.Class,java.lang.ClassLoader,boolean)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.utils.ValidatorUtils.validateSchemaType(java.lang.String,java.lang.Class,java.lang.ClassLoader,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.utils.ValidatorUtils.validateFunctionClassTypes(java.lang.ClassLoader,org.apache.pulsar.functions.proto.Function$FunctionDetails$Builder)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PropertiesFileConfigurationProvider.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.flume.node.PropertiesFileConfigurationProvider.getFlumeConfiguration()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AbstractHdfsConnector.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.hdfs3.AbstractHdfsConnector.ExtendedConfiguration.getClassByNameOrNull(java.lang.String)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SqliteUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.SqliteUtils", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarConnectorUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.PulsarConnectorUtils.createInstance(java.lang.String,java.lang.Class,java.lang.ClassLoader)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[pulsar-broker]Support batch authorization of partitioned topic", "body": "At present, if a topic is a partitioned topic, the sub-partition topic below it is not authorized when grant it, resulting in an error in connection creation. So if the topic is found to be a partitioned topic when authorizing or canceling permissions, all partitioned topics should be authorized or revoke permissions.\r\n\r\nImplement similar `pulsar-admin topics skip` https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java#L935\r\n\r\n1. Check topic type by `getPartitionedTopicMetadata`\r\n2. Non partitioned topic, the current logic remains unchanged.\r\n3. Partitioned topic, authorize each topic through the for a loop.\r\n4. Add unit test", "url": "https://github.com/apache/pulsar/issues/5724", "user": "tuteng", "labels": ["component/broker", "help wanted", "type/bug"], "created": "2019-11-22 14:26:28", "closed": "2019-12-17 11:57:04", "commits": {"098ae44cdfc7c17540f130a66a447685320d695e": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 24.00027777777778, "commitsDetails": [{"commitHash": "098ae44cdfc7c17540f130a66a447685320d695e", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["67fdfe2ab4058692f314768b8a78d9da407d0c6e"], "nameRev": "098ae44cdfc7c17540f130a66a447685320d695e tags/v2.5.0-candidate-2~49", "commitMessage": "Support batch authorization of partitioned topic (#5767)\n\nFixes #5724\r\n\r\nMotivation\r\nAt present, if a topic is a partitioned topic, the sub-partition topic below it is not authorized when grant it, resulting in an error in connection creation. So if the topic is found to be a partitioned topic when authorizing or canceling permissions, all partitioned topics should be authorized or revoke permissions.\r\n\r\nModifications\r\nsupport batch authorization of partitioned topic\r\n1 Non partitioned topic, the current logic remains unchanged\r\n2 Partitioned topic, authorize each topic through the for a loop\r\n", "commitDateTime": "2019-12-17 19:57:03", "authoredDateTime": "2019-12-17 19:57:03", "commitGitStats": [{"filePath": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java", "insertions": 11, "deletions": 9, "lines": 20}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 38, "deletions": 18, "lines": 56}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTest.java", "insertions": 7, "deletions": 0, "lines": 7}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 76, "deletions": 0, "lines": 76}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarAuthorizationProvider.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.authorization.PulsarAuthorizationProvider.checkWildcardPermission(java.lang.String,org.apache.pulsar.common.policies.data.AuthAction,java.util.Map)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalGrantPermissionsOnTopic(java.lang.String,java.util.Set)", "TOT": 6, "UPD": 1, "INS": 1, "MOV": 4, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalRevokePermissionsOnTopic(java.lang.String)", "TOT": 6, "UPD": 1, "INS": 1, "MOV": 4, "DEL": 0}]}, {"spoonFilePath": "AdminTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminTest.setup()", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGrantNonPartitionedTopic()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testGrantPartitionedTopic()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testRevokeNonPartitionedTopic()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testRevokePartitionedTopic()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "K8s: through pulsar proxy visit api return 502", "body": "**Describe the bug**\r\nthrough proxy call admin api return error_code 502\r\n```\r\ncurl -i http://proxy-address/admin/v2/persistent/public/default\r\nHTTP/1.1 502 Bad Gateway\r\nDate: Thu, 21 Nov 2019 03:09:30 GMT\r\nContent-Type: text/html;charset=iso-8859-1\r\nContent-Length: 355\r\nConnection: keep-alive\r\nCache-Control: must-revalidate,no-cache,no-store\r\n\r\n<html>\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\"/>\r\n<title>Error 502 Bad Gateway</title>\r\n</head>\r\n<body><h2>HTTP ERROR 502</h2>\r\n<p>Problem accessing /admin/v2/persistent/public/default. Reason:\r\n<pre>    Bad Gateway</pre></p><hr><a href=\"http://eclipse.org/jetty\">Powered by Jetty:// 9.4.12.v20180830</a><hr/>\r\n\r\n</body>\r\n</html>\r\n```\r\n\r\n**Expected behavior**\r\nexpect return 200 and valid response\r\n\r\n**Environment **\r\n - deploy in k8s and image is `pulsar-all:2.4.1`\r\n\r\n**Additional context**\r\npulsar proxy logs\r\n```\r\nat io.netty.channel.unix.FileDescriptor.readAddress(..)(Unknown Source) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n02:24:39.865 [pulsar-discovery-io-2-1] WARN  org.apache.pulsar.proxy.server.ProxyConnection - [/172.19.25.180:46476] Got exception NativeIoException : syscall:read(..) failed: Connection reset by peer\r\n02:24:39.865 [pulsar-discovery-io-2-1] INFO  org.apache.pulsar.proxy.server.ProxyConnection - [/172.19.25.180:46476] Connection closed\r\n02:24:40.057 [pulsar-discovery-io-2-1] INFO  org.apache.pulsar.proxy.server.ProxyConnection - [/172.19.25.229:53780] New connection opened\r\n02:24:40.057 [pulsar-discovery-io-2-1] WARN  io.netty.channel.DefaultChannelPipeline - An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception.\r\nio.netty.channel.unix.Errors$NativeIoException: syscall:read(..) failed: Connection reset by peer\r\n\tat io.netty.channel.unix.FileDescriptor.readAddress(..)(Unknown Source) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n02:24:40.057 [pulsar-discovery-io-2-1] WARN  org.apache.pulsar.proxy.server.ProxyConnection - [/172.19.25.229:53780] Got exception NativeIoException : syscall:read(..) failed: Connection reset by peer\r\n02:24:40.057 [pulsar-discovery-io-2-1] INFO  org.apache.pulsar.proxy.server.ProxyConnection - [/172.19.25.229:53780] Connection closed\r\n02:24:40.067 [pulsar-discovery-io-2-1] INFO  org.apache.pulsar.proxy.server.ProxyConnection - [/192.168.64.129:44812] New connection opened\r\n02:24:40.067 [pulsar-discovery-io-2-1] WARN  io.netty.channel.DefaultChannelPipeline - An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception.\r\nio.netty.channel.unix.Errors$NativeIoException: syscall:read(..) failed: Connection reset by peer\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/5711", "user": "lxkaka", "labels": ["component/k8s", "help wanted", "triage/week-47", "type/bug"], "created": "2019-11-21 03:15:11", "closed": "2020-04-14 09:15:43", "commits": {}, "ttf": 145.00027777777777, "commitsDetails": []}, {"title": "[docs] Fix persistent and non-persistent docs", "body": "**Describe the bug**\r\nSome information in persistent and non-persistent topics duplicate, and some info are not correct. For example, wrong info at https://pulsar.apache.org/docs/en/admin-api-persistent-topics/#get-stats\r\n\r\n**Expected behavior**\r\nThe information should be consistent, clear and correct.\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/47805623/69232148-6dfd4880-0bc5-11ea-8adf-00f348d0e8fe.png)", "url": "https://github.com/apache/pulsar/issues/5708", "user": "Jennifer88huang", "labels": ["component/admin", "component/documentation", "help wanted", "triage/week-46", "type/bug"], "created": "2019-11-20 10:43:07", "closed": "2019-12-12 05:48:57", "commits": {}, "ttf": 21.00027777777778, "commitsDetails": []}, {"title": "Apache Netbeans 11.1 Not Opening", "body": "The Apache Netbeans 11.1 never opens but keeps on creating error files in its application install directory(named hs_err_pid15684 or something similar).\r\n\r\n\r\nThis particular one *hs_err_pid15684* contents below:\r\n```\r\n#\r\n# A fatal error has been detected by the Java Runtime Environment:\r\n#\r\n#  EXCEPTION_ACCESS_VIOLATION (0xc0000005) at pc=0x00007ffb55616690, pid=15684, tid=18032\r\n#\r\n# JRE version: Java(TM) SE Runtime Environment (12.0.2+10) (build 12.0.2+10)\r\n# Java VM: Java HotSpot(TM) 64-Bit Server VM (12.0.2+10, mixed mode, sharing, tiered, compressed oops, g1 gc, windows-amd64)\r\n# Problematic frame:\r\n# C  0x00007ffb55616690\r\n[error occurred during error reporting (printing problematic frame), id 0xc0000005, EXCEPTION_ACCESS_VIOLATION (0xc0000005) at pc=0x00007ffb55616de0]\r\n\r\n# No core dump will be written. Minidumps are not enabled by default on client versions of Windows\r\n#\r\n# If you would like to submit a bug report, please visit:\r\n#   http://bugreport.java.com/bugreport/crash.jsp\r\n# The crash happened outside the Java Virtual Machine in native code.\r\n# See problematic frame for where to report the bug.\r\n#\r\n\r\n---------------  S U M M A R Y ------------\r\n\r\nCommand Line: -Dnetbeans.importclass=org.netbeans.upgrade.AutoUpgrade -XX:+UseStringDeduplication -Xss2m -Djdk.gtk.version=2.2 -Dapple.laf.useScreenMenuBar=true -Dapple.awt.graphics.UseQuartz=true -Dsun.java2d.noddraw=true -Dsun.java2d.dpiaware=true -Dsun.zip.disableMemoryMapping=true -Dplugin.manager.check.updates=false -Dnetbeans.extbrowser.manual_chrome_plugin_install=yes --add-opens=java.base/java.net=ALL-UNNAMED --add-opens=java.base/java.lang.ref=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/java.security=ALL-UNNAMED --add-opens=java.base/java.util=ALL-UNNAMED --add-opens=java.desktop/javax.swing.plaf.basic=ALL-UNNAMED --add-opens=java.desktop/javax.swing.text=ALL-UNNAMED --add-opens=java.desktop/javax.swing=ALL-UNNAMED --add-opens=java.desktop/java.awt=ALL-UNNAMED --add-opens=java.desktop/java.awt.event=ALL-UNNAMED --add-opens=java.prefs/java.util.prefs=ALL-UNNAMED --add-opens=jdk.jshell/jdk.jshell=ALL-UNNAMED --add-modules=jdk.jshell --add-exports=java.desktop/sun.awt=ALL-UNNAMED --add-exports=java.desktop/java.awt.peer=ALL-UNNAMED --add-exports=java.desktop/com.sun.beans.editors=ALL-UNNAMED --add-exports=java.desktop/sun.swing=ALL-UNNAMED --add-exports=java.desktop/sun.awt.im=ALL-UNNAMED --add-exports=jdk.internal.jvmstat/sun.jvmstat.monitor=ALL-UNNAMED --add-exports=java.management/sun.management=ALL-UNNAMED --add-exports=java.base/sun.reflect.annotation=ALL-UNNAMED --add-exports=jdk.javadoc/com.sun.tools.javadoc.main=ALL-UNNAMED -XX:+IgnoreUnrecognizedVMOptions -Djdk.home=C:\\Program Files\\Java\\jdk-12.0.2 -Dnetbeans.home=C:\\Program Files\\NetBeans-11.1\\netbeans\\platform -Dnetbeans.user=C:\\Users\\DANIEL\\AppData\\Roaming\\NetBeans\\11.1 -Dnetbeans.default_userdir_root=C:\\Users\\DANIEL\\AppData\\Roaming\\NetBeans -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=C:\\Users\\DANIEL\\AppData\\Roaming\\NetBeans\\11.1\\var\\log\\heapdump.hprof -Dsun.awt.keepWorkingSetOnMinimize=true -Dnetbeans.dirs=C:\\Program Files\\NetBeans-11.1\\netbeans\\nb;C:\\Program Files\\NetBeans-11.1\\netbeans\\ergonomics;C:\\Program Files\\NetBeans-11.1\\netbeans\\ide;C:\\Program Files\\NetBeans-11.1\\netbeans\\extide;C:\\Program Files\\NetBeans-11.1\\netbeans\\java;C:\\Program Files\\NetBeans-11.1\\netbeans\\apisupport;C:\\Program Files\\NetBeans-11.1\\netbeans\\webcommon;C:\\Program Files\\NetBeans-11.1\\netbeans\\websvccommon;C:\\Program Files\\NetBeans-11.1\\netbeans\\enterprise;C:\\Program Files\\NetBeans-11.1\\netbeans\\mobility;C:\\Program Files\\NetBeans-11.1\\netbeans\\profiler;C:\\Program Files\\NetBeans-11.1\\netbeans\\python;C:\\Program Files\\NetBeans-11.1\\netbeans\\php;C:\\Program Files\\NetBeans-11.1\\netbeans\\identity;C:\\Program Files\\NetBeans-11.1\\netbeans\\harness;C:\\Program Files\\NetBeans-11.1\\netbeans\\cnd;C:\\Program Files\\NetBeans-11.1\\netbeans\\cndext;C:\\Program Files\\NetBeans-11.1\\netbeans\\dlight;C:\\Program Files\\NetBeans-11.1\\netbeans\\groovy;C:\\Program Files\\NetBeans-11.1\\netbeans\\extra;C:\\Program Files\\NetBeans-11.1\\netbeans\\javacard;C:\\Program Files\\NetBeans-11.1\\netbeans\\javafx exit \r\n\r\nHost: Intel(R) Core(TM) i7-7500U CPU @ 2.70GHz, 4 cores, 15G,  Windows 10 , 64 bit Build 18362 (10.0.18362.86)\r\nTime: Thu Oct 31 11:52:38 2019 W. Central Africa Standard Time elapsed time: 1 seconds (0d 0h 0m 1s)\r\n\r\n---------------  T H R E A D  ---------------\r\n\r\nCurrent thread (0x0000000029a11000):  JavaThread \"AWT-EventQueue-0\" [_thread_in_native, id=18032, stack(0x000000002b0b0000,0x000000002b2b0000)]\r\n\r\nStack: [0x000000002b0b0000,0x000000002b2b0000],  sp=0x000000002b2ab2b8,  free space=2028k\r\nNative frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)\r\nC  0x00007ffb55616690\r\n[error occurred during error reporting (printing native stack), id 0xc0000005, EXCEPTION_ACCESS_VIOLATION (0xc0000005) at pc=0x00007ffb55616de0]\r\n\r\nJava frames: (J=compiled Java code, j=interpreted, Vv=VM code)\r\nj  java.lang.ClassLoader$NativeLibrary.load0(Ljava/lang/String;Z)Z+0 java.base@12.0.2\r\nj  java.lang.ClassLoader$NativeLibrary.load()Z+53 java.base@12.0.2\r\nj  java.lang.ClassLoader$NativeLibrary.loadLibrary(Ljava/lang/Class;Ljava/lang/String;Z)Z+216 java.base@12.0.2\r\nj  java.lang.ClassLoader.loadLibrary0(Ljava/lang/Class;Ljava/io/File;)Z+46 java.base@12.0.2\r\nj  java.lang.ClassLoader.loadLibrary(Ljava/lang/Class;Ljava/lang/String;Z)V+228 java.base@12.0.2\r\nj  java.lang.Runtime.loadLibrary0(Ljava/lang/Class;Ljava/lang/String;)V+54 java.base@12.0.2\r\nj  java.lang.System.loadLibrary(Ljava/lang/String;)V+7 java.base@12.0.2\r\nj  sun.font.FontManagerNativeLibrary$1.run()Ljava/lang/Object;+20 java.desktop@12.0.2\r\nJ 938 c1 java.security.AccessController.doPrivileged(Ljava/security/PrivilegedAction;)Ljava/lang/Object; java.base@12.0.2 (9 bytes) @ 0x000000000bfdfbec [0x000000000bfdfa80+0x000000000000016c]\r\nj  sun.font.FontManagerNativeLibrary.<clinit>()V+7 java.desktop@12.0.2\r\nv  ~StubRoutines::call_stub\r\nj  sun.font.SunFontManager$1.run()Ljava/lang/Object;+0 java.desktop@12.0.2\r\nJ 938 c1 java.security.AccessController.doPrivileged(Ljava/security/PrivilegedAction;)Ljava/lang/Object; java.base@12.0.2 (9 bytes) @ 0x000000000bfdfbec [0x000000000bfdfa80+0x000000000000016c]\r\nj  sun.font.SunFontManager.<clinit>()V+38 java.desktop@12.0.2\r\nv  ~StubRoutines::call_stub\r\nj  java.lang.Class.forName0(Ljava/lang/String;ZLjava/lang/ClassLoader;Ljava/lang/Class;)Ljava/lang/Class;+0 java.base@12.0.2\r\nj  java.lang.Class.forName(Ljava/lang/String;ZLjava/lang/ClassLoader;)Ljava/lang/Class;+43 java.base@12.0.2\r\nj  sun.font.FontManagerFactory$1.run()Ljava/lang/Object;+16 java.desktop@12.0.2\r\nJ 938 c1 java.security.AccessController.doPrivileged(Ljava/security/PrivilegedAction;)Ljava/lang/Object; java.base@12.0.2 (9 bytes) @ 0x000000000bfdfbec [0x000000000bfdfa80+0x000000000000016c]\r\nj  sun.font.FontManagerFactory.getInstance()Lsun/font/FontManager;+17 java.desktop@12.0.2\r\nj  java.awt.Font.getFont2D()Lsun/font/Font2D;+0 java.desktop@12.0.2\r\nj  java.awt.Font$FontAccessImpl.getFont2D(Ljava/awt/Font;)Lsun/font/Font2D;+1 java.desktop@12.0.2\r\nj  sun.font.FontUtilities.getFont2D(Ljava/awt/Font;)Lsun/font/Font2D;+4 java.desktop@12.0.2\r\nj  sun.font.FontUtilities.fontSupportsDefaultEncoding(Ljava/awt/Font;)Z+1 java.desktop@12.0.2\r\nj  com.sun.java.swing.plaf.windows.WindowsLookAndFeel$WindowsFontProperty.configureValue(Ljava/lang/Object;)Ljava/lang/Object;+146 java.desktop@12.0.2\r\nj  sun.swing.plaf.DesktopProperty.createValue(Ljavax/swing/UIDefaults;)Ljava/lang/Object;+13 java.desktop@12.0.2\r\nj  javax.swing.UIDefaults.getFromHashtable(Ljava/lang/Object;)Ljava/lang/Object;+231 java.desktop@12.0.2\r\nj  javax.swing.UIDefaults.get(Ljava/lang/Object;)Ljava/lang/Object;+2 java.desktop@12.0.2\r\nj  javax.swing.MultiUIDefaults.get(Ljava/lang/Object;)Ljava/lang/Object;+45 java.desktop@12.0.2\r\nj  javax.swing.UIDefaults.getFont(Ljava/lang/Object;)Ljava/awt/Font;+2 java.desktop@12.0.2\r\nj  javax.swing.UIManager.getFont(Ljava/lang/Object;)Ljava/awt/Font;+4 java.desktop@12.0.2\r\nj  javax.swing.LookAndFeel.installColorsAndFont(Ljavax/swing/JComponent;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V+21 java.desktop@12.0.2\r\nj  javax.swing.plaf.basic.BasicPanelUI.installDefaults(Ljavax/swing/JPanel;)V+7 java.desktop@12.0.2\r\nj  javax.swing.plaf.basic.BasicPanelUI.installUI(Ljavax/swing/JComponent;)V+12 java.desktop@12.0.2\r\nj  javax.swing.JComponent.setUI(Ljavax/swing/plaf/ComponentUI;)V+52 java.desktop@12.0.2\r\nj  javax.swing.JPanel.setUI(Ljavax/swing/plaf/PanelUI;)V+2 java.desktop@12.0.2\r\nj  javax.swing.JPanel.updateUI()V+8 java.desktop@12.0.2\r\nj  javax.swing.JPanel.<init>(Ljava/awt/LayoutManager;Z)V+24 java.desktop@12.0.2\r\nj  javax.swing.JPanel.<init>(Ljava/awt/LayoutManager;)V+3 java.desktop@12.0.2\r\nj  org.netbeans.upgrade.AutoUpgrade.showUpgradeDialog(Ljava/io/File;Ljava/lang/String;)Z+14\r\nj  org.netbeans.upgrade.AutoUpgrade.main([Ljava/lang/String;)V+48\r\nv  ~StubRoutines::call_stub\r\nj  jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Ljava/lang/reflect/Method;Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;+0 java.base@12.0.2\r\nj  jdk.internal.reflect.NativeMethodAccessorImpl.invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;+100 java.base@12.0.2\r\nj  jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;+6 java.base@12.0.2\r\nj  java.lang.reflect.Method.invoke(Ljava/lang/Object;[Ljava/lang/Object;)Ljava/lang/Object;+59 java.base@12.0.2\r\nj  org.netbeans.core.startup.Main$1ImportHandler.run()V+37\r\nj  java.awt.event.InvocationEvent.dispatch()V+11 java.desktop@12.0.2\r\nj  java.awt.EventQueue.dispatchEventImpl(Ljava/awt/AWTEvent;Ljava/lang/Object;)V+21 java.desktop@12.0.2\r\nj  java.awt.EventQueue$4.run()Ljava/lang/Void;+32 java.desktop@12.0.2\r\nj  java.awt.EventQueue$4.run()Ljava/lang/Object;+1 java.desktop@12.0.2\r\nJ 937 c1 java.security.AccessController.executePrivileged(Ljava/security/PrivilegedAction;Ljava/security/AccessControlContext;Ljava/lang/Class;)Ljava/lang/Object; java.base@12.0.2 (65 bytes) @ 0x000000000bfdf564 [0x000000000bfdf400+0x0000000000000164]\r\nj  java.security.AccessController.doPrivileged(Ljava/security/PrivilegedAction;Ljava/security/AccessControlContext;)Ljava/lang/Object;+13 java.base@12.0.2\r\nj  java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(Ljava/security/PrivilegedAction;Ljava/security/AccessControlContext;Ljava/security/AccessControlContext;)Ljava/lang/Object;+18 java.base@12.0.2\r\nj  java.awt.EventQueue.dispatchEvent(Ljava/awt/AWTEvent;)V+46 java.desktop@12.0.2\r\nj  java.awt.EventDispatchThread.pumpOneEventForFilters(I)V+78 java.desktop@12.0.2\r\nj  java.awt.EventDispatchThread.pumpEventsForFilter(ILjava/awt/Conditional;Ljava/awt/EventFilter;)V+35 java.desktop@12.0.2\r\nj  java.awt.EventDispatchThread.pumpEventsForHierarchy(ILjava/awt/Conditional;Ljava/awt/Component;)V+11 java.desktop@12.0.2\r\nj  java.awt.EventDispatchThread.pumpEvents(ILjava/awt/Conditional;)V+4 java.desktop@12.0.2\r\nj  java.awt.EventDispatchThread.pumpEvents(Ljava/awt/Conditional;)V+3 java.desktop@12.0.2\r\nj  java.awt.EventDispatchThread.run()V+9 java.desktop@12.0.2\r\nv  ~StubRoutines::call_stub\r\n\r\nsiginfo: EXCEPTION_ACCESS_VIOLATION (0xc0000005), data execution prevention violation at address 0x00007ffb55616690\r\n\r\n\r\nRegister to memory mapping:\r\n\r\nRIP=0x00007ffb55616690 is an unknown value\r\nRAX=0x00007ffb55616690 is an unknown value\r\nRBX=0x00000000000040ff is an unknown value\r\nRCX=0xffffffffffffffff is an unknown value\r\nRDX=0x00000000008be1e0 points into unknown readable memory: 2e 3b 43 3a 5c 50 72 6f\r\nRSP=0x000000002b2ab2b8 is pointing into the stack for thread: 0x0000000029a11000\r\nRBP=0x000000002996f780 points into unknown readable memory: 43 3a 5c 50 72 6f 67 72\r\nRSI=0xffffffffffffffff is an unknown value\r\nRDI=0x00000000008be1e0 points into unknown readable memory: 2e 3b 43 3a 5c 50 72 6f\r\nR8 =0x00000000000040ff is an unknown value\r\nR9 =0x0000000000000001 is an unknown value\r\nR10=0x0000000000008000 is an unknown value\r\nR11=0x000000002b2ab270 is pointing into the stack for thread: 0x0000000029a11000\r\nR12=0x0 is NULL\r\nR13=0x0 is NULL\r\nR14=0x000000002b2abe00 is pointing into the stack for thread: 0x0000000029a11000\r\nR15=0x000000002996f780 points into unknown readable memory: 43 3a 5c 50 72 6f 67 72\r\n\r\n\r\nRegisters:\r\nRAX=0x00007ffb55616690, RBX=0x00000000000040ff, RCX=0xffffffffffffffff, RDX=0x00000000008be1e0\r\nRSP=0x000000002b2ab2b8, RBP=0x000000002996f780, RSI=0xffffffffffffffff, RDI=0x00000000008be1e0\r\nR8 =0x00000000000040ff, R9 =0x0000000000000001, R10=0x0000000000008000, R11=0x000000002b2ab270\r\nR12=0x0000000000000000, R13=0x0000000000000000, R14=0x000000002b2abe00, R15=0x000000002996f780\r\nRIP=0x00007ffb55616690, EFLAGS=0x0000000000010206\r\n\r\nTop of Stack: (sp=0x000000002b2ab2b8)\r\n0x000000002b2ab2b8:   00007ffb007ab4ba 0000000000000000\r\n0x000000002b2ab2c8:   00007ffb56eccf6e 0000000000000000\r\n0x000000002b2ab2d8:   00007ffb59d69bc7 ffffffffffffffff\r\n0x000000002b2ab2e8:   00007ffb006ffae7 00007ffb0df80000\r\n0x000000002b2ab2f8:   0000000000000400 00007ffb0df80000\r\n0x000000002b2ab308:   00007ffb56ecca10 00007ffb00000000\r\n0x000000002b2ab318:   0000000000000400 0000000029a11000\r\n0x000000002b2ab328:   00007ffb0df80000 0000000000000000\r\n0x000000002b2ab338:   000000002b2abe90 0000000000000000\r\n0x000000002b2ab348:   00007ffb006ffa85 0000000029a11000\r\n0x000000002b2ab358:   ffffffffffffffff 0000000029aee780\r\n0x000000002b2ab368:   00000049a45d8fa6 000000002b2ab420\r\n0x000000002b2ab378:   00007ffb0062472a 00007ffb0df80000\r\n0x000000002b2ab388:   0000000000000400 00000000296679a0\r\n0x000000002b2ab398:   000000002b2ab430 000000002b2ab430\r\n0x000000002b2ab3a8:   00007ffb0018190e 000000002b2abd78 \r\n\r\nInstructions: (pc=0x00007ffb55616690)\r\n0x00007ffb55616590:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb556165a0:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb556165b0:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb556165c0:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb556165d0:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb556165e0:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb556165f0:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616600:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616610:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616620:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616630:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616640:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616650:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616660:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616670:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616680:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616690:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb556166a0:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb556166b0:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb556166c0:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb556166d0:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb556166e0:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb556166f0:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616700:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616710:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616720:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616730:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616740:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616750:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616760:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616770:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ??\r\n0x00007ffb55616780:   ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? \r\n\r\n\r\nStack slot to memory mapping:\r\nstack at sp + 0 slots: 0x00007ffb007ab4ba jvm.dll\r\n[error occurred during error reporting (inspecting top of stack), id 0xc0000005, EXCEPTION_ACCESS_VIOLATION (0xc0000005) at pc=0x00007ffb55616de0]\r\n\r\n\r\n---------------  P R O C E S S  ---------------\r\n\r\nThreads class SMR info:\r\n_java_thread_list=0x0000000029986430, length=19, elements={\r\n0x00000000034dd800, 0x00000000269de000, 0x0000000027987800, 0x00000000279a2000,\r\n0x00000000279a4000, 0x00000000279ad800, 0x00000000279b4000, 0x00000000279c5800,\r\n0x00000000269d6000, 0x0000000027c21800, 0x0000000027be0800, 0x000000002983c000,\r\n0x0000000027aa8800, 0x0000000029840000, 0x000000002996a800, 0x00000000299e1800,\r\n0x00000000297e1000, 0x000000002998d800, 0x0000000029a11000\r\n}\r\n\r\nJava Threads: ( => current thread )\r\n  0x00000000034dd800 JavaThread \"main\" [_thread_blocked, id=12836, stack(0x0000000000500000,0x0000000000700000)]\r\n  0x00000000269de000 JavaThread \"Reference Handler\" daemon [_thread_blocked, id=8984, stack(0x0000000027ef0000,0x00000000280f0000)]\r\n  0x0000000027987800 JavaThread \"Finalizer\" daemon [_thread_blocked, id=14568, stack(0x00000000280f0000,0x00000000282f0000)]\r\n  0x00000000279a2000 JavaThread \"Signal Dispatcher\" daemon [_thread_blocked, id=11504, stack(0x00000000283f0000,0x00000000285f0000)]\r\n  0x00000000279a4000 JavaThread \"Attach Listener\" daemon [_thread_blocked, id=20124, stack(0x00000000285f0000,0x00000000287f0000)]\r\n  0x00000000279ad800 JavaThread \"C2 CompilerThread0\" daemon [_thread_blocked, id=19708, stack(0x00000000287f0000,0x00000000289f0000)]\r\n  0x00000000279b4000 JavaThread \"C1 CompilerThread0\" daemon [_thread_blocked, id=19904, stack(0x00000000289f0000,0x0000000028bf0000)]\r\n  0x00000000279c5800 JavaThread \"Sweeper thread\" daemon [_thread_blocked, id=13732, stack(0x0000000028bf0000,0x0000000028df0000)]\r\n  0x00000000269d6000 JavaThread \"Common-Cleaner\" daemon [_thread_blocked, id=1456, stack(0x0000000028df0000,0x0000000028ff0000)]\r\n  0x0000000027c21800 JavaThread \"Service Thread\" daemon [_thread_blocked, id=15388, stack(0x00000000291f0000,0x00000000293f0000)]\r\n  0x0000000027be0800 JavaThread \"Active Reference Queue Daemon\" daemon [_thread_blocked, id=9904, stack(0x0000000029df0000,0x0000000029ff0000)]\r\n  0x000000002983c000 JavaThread \"CLI Requests Server\" daemon [_thread_in_native, id=3256, stack(0x0000000029ff0000,0x000000002a1f0000)]\r\n  0x0000000027aa8800 JavaThread \"Secure CLI Port\" daemon [_thread_in_native, id=18632, stack(0x0000000028ff0000,0x00000000291f0000)]\r\n  0x0000000029840000 JavaThread \"main\" [_thread_blocked, id=4880, stack(0x000000002a1f0000,0x000000002a3f0000)]\r\n  0x000000002996a800 JavaThread \"RequestProcessor queue manager\" daemon [_thread_blocked, id=11960, stack(0x000000002a3f0000,0x000000002a5f0000)]\r\n  0x00000000299e1800 JavaThread \"Java2D Disposer\" daemon [_thread_blocked, id=16848, stack(0x000000002a6b0000,0x000000002a8b0000)]\r\n  0x00000000297e1000 JavaThread \"AWT-Shutdown\" [_thread_blocked, id=13780, stack(0x000000002a8b0000,0x000000002aab0000)]\r\n  0x000000002998d800 JavaThread \"AWT-Windows\" daemon [_thread_in_native, id=8920, stack(0x000000002aab0000,0x000000002acb0000)]\r\n=>0x0000000029a11000 JavaThread \"AWT-EventQueue-0\" [_thread_in_native, id=18032, stack(0x000000002b0b0000,0x000000002b2b0000)]\r\n\r\nOther Threads:\r\n  0x000000002797d000 VMThread \"VM Thread\" [stack: 0x0000000027cf0000,0x0000000027ef0000] [id=18804]\r\n  0x0000000027c23000 WatcherThread [stack: 0x00000000293f0000,0x00000000295f0000] [id=7340]\r\n  0x0000000003540000 GCTaskThread \"GC Thread#0\" [stack: 0x0000000023fc0000,0x00000000241c0000] [id=3688]\r\n  0x000000002b2de800 GCTaskThread \"GC Thread#1\" [stack: 0x000000002aeb0000,0x000000002b0b0000] [id=19764]\r\n  0x000000002b3c4800 GCTaskThread \"GC Thread#2\" [stack: 0x000000002ca70000,0x000000002cc70000] [id=14072]\r\n  0x0000000029d41800 GCTaskThread \"GC Thread#3\" [stack: 0x000000002cc70000,0x000000002ce70000] [id=12576]\r\n  0x000000000355a000 ConcurrentGCThread \"G1 Main Marker\" [stack: 0x00000000241c0000,0x00000000243c0000] [id=16564]\r\n  0x000000000355b800 ConcurrentGCThread \"G1 Conc#0\" [stack: 0x00000000243c0000,0x00000000245c0000] [id=1420]\r\n  0x00000000268df800 ConcurrentGCThread \"G1 Refine#0\" [stack: 0x0000000026af0000,0x0000000026cf0000] [id=1704]\r\n  0x0000000027bcb800 ConcurrentGCThread \"G1 Refine#1\" [stack: 0x000000002ce70000,0x000000002d070000] [id=19984]\r\n  0x00000000268e2800 ConcurrentGCThread \"G1 Young RemSet Sampling\" [stack: 0x0000000026cf0000,0x0000000026ef0000] [id=15060]\r\n  0x00000000268ea000 ConcurrentGCThread \"StrDedup\" [stack: 0x0000000026ef0000,0x00000000270f0000] [id=8136]\r\n\r\nThreads with active compile tasks:\r\n\r\nVM state:not at safepoint (normal execution)\r\n\r\nVM Mutex/Monitor currently owned by a thread: None\r\n\r\nHeap address: 0x0000000701c00000, size: 4068 MB, Compressed Oops mode: Zero based, Oop shift amount: 3\r\nNarrow klass base: 0x0000000800000000, Narrow klass shift: 3\r\nCompressed class space size: 1073741824 Address: 0x0000000801190000\r\n\r\nHeap:\r\n garbage-first heap   total 262144K, used 4362K [0x0000000701c00000, 0x0000000800000000)\r\n  region size 1024K, 4 young (4096K), 2 survivors (2048K)\r\n Metaspace       used 7855K, capacity 8208K, committed 8448K, reserved 1056768K\r\n  class space    used 849K, capacity 1014K, committed 1024K, reserved 1048576K\r\nHeap Regions: E=young(eden), S=young(survivor), O=old, HS=humongous(starts), HC=humongous(continues), CS=collection set, F=free, A=archive, TAMS=top-at-mark-start (previous, next)\r\n|   0|0x0000000701c00000, 0x0000000701d00000, 0x0000000701d00000|100%| O|  |TAMS 0x0000000701c00000, 0x0000000701c00000| Untracked \r\n|   1|0x0000000701d00000, 0x0000000701d42800, 0x0000000701e00000| 25%| O|  |TAMS 0x0000000701d00000, 0x0000000701d00000| Untracked \r\n|   2|0x0000000701e00000, 0x0000000701e00000, 0x0000000701f00000|  0%| F|  |TAMS 0x0000000701e00000, 0x0000000701e00000| Untracked \r\n|   3|0x0000000701f00000, 0x0000000701f00000, 0x0000000702000000|  0%| F|  |TAMS 0x0000000701f00000, 0x0000000701f00000| Untracked \r\n|   4|0x0000000702000000, 0x0000000702000000, 0x0000000702100000|  0%| F|  |TAMS 0x0000000702000000, 0x0000000702000000| Untracked \r\n|   5|0x0000000702100000, 0x0000000702100000, 0x0000000702200000|  0%| F|  |TAMS 0x0000000702100000, 0x0000000702100000| Untracked \r\n|   6|0x0000000702200000, 0x0000000702200000, 0x0000000702300000|  0%| F|  |TAMS 0x0000000702200000, 0x0000000702200000| Untracked \r\n|   7|0x0000000702300000, 0x0000000702300000, 0x0000000702400000|  0%| F|  |TAMS 0x0000000702300000, 0x0000000702300000| Untracked \r\n|   8|0x0000000702400000, 0x0000000702400000, 0x0000000702500000|  0%| F|  |TAMS 0x0000000702400000, 0x0000000702400000| Untracked \r\n|   9|0x0000000702500000, 0x0000000702500000, 0x0000000702600000|  0%| F|  |TAMS 0x0000000702500000, 0x0000000702500000| Untracked \r\n|  10|0x0000000702600000, 0x0000000702600000, 0x0000000702700000|  0%| F|  |TAMS 0x0000000702600000, 0x0000000702600000| Untracked \r\n|  11|0x0000000702700000, 0x0000000702700000, 0x0000000702800000|  0%| F|  |TAMS 0x0000000702700000, 0x0000000702700000| Untracked \r\n|  12|0x0000000702800000, 0x0000000702800000, 0x0000000702900000|  0%| F|  |TAMS 0x0000000702800000, 0x0000000702800000| Untracked \r\n|  13|0x0000000702900000, 0x0000000702900000, 0x0000000702a00000|  0%| F|  |TAMS 0x0000000702900000, 0x0000000702900000| Untracked \r\n|  14|0x0000000702a00000, 0x0000000702a00000, 0x0000000702b00000|  0%| F|  |TAMS 0x0000000702a00000, 0x0000000702a00000| Untracked \r\n|  15|0x0000000702b00000, 0x0000000702b00000, 0x0000000702c00000|  0%| F|  |TAMS 0x0000000702b00000, 0x0000000702b00000| Untracked \r\n|  16|0x0000000702c00000, 0x0000000702c00000, 0x0000000702d00000|  0%| F|  |TAMS 0x0000000702c00000, 0x0000000702c00000| Untracked \r\n|  17|0x0000000702d00000, 0x0000000702d00000, 0x0000000702e00000|  0%| F|  |TAMS 0x0000000702d00000, 0x0000000702d00000| Untracked \r\n|  18|0x0000000702e00000, 0x0000000702e00000, 0x0000000702f00000|  0%| F|  |TAMS 0x0000000702e00000, 0x0000000702e00000| Untracked \r\n|  19|0x0000000702f00000, 0x0000000702f00000, 0x0000000703000000|  0%| F|  |TAMS 0x0000000702f00000, 0x0000000702f00000| Untracked \r\n|  20|0x0000000703000000, 0x0000000703000000, 0x0000000703100000|  0%| F|  |TAMS 0x0000000703000000, 0x0000000703000000| Untracked \r\n|  21|0x0000000703100000, 0x0000000703100000, 0x0000000703200000|  0%| F|  |TAMS 0x0000000703100000, 0x0000000703100000| Untracked \r\n|  22|0x0000000703200000, 0x0000000703200000, 0x0000000703300000|  0%| F|  |TAMS 0x0000000703200000, 0x0000000703200000| Untracked \r\n|  23|0x0000000703300000, 0x0000000703300000, 0x0000000703400000|  0%| F|  |TAMS 0x0000000703300000, 0x0000000703300000| Untracked \r\n|  24|0x0000000703400000, 0x0000000703400000, 0x0000000703500000|  0%| F|  |TAMS 0x0000000703400000, 0x0000000703400000| Untracked \r\n|  25|0x0000000703500000, 0x0000000703500000, 0x0000000703600000|  0%| F|  |TAMS 0x0000000703500000, 0x0000000703500000| Untracked \r\n|  26|0x0000000703600000, 0x0000000703600000, 0x0000000703700000|  0%| F|  |TAMS 0x0000000703600000, 0x0000000703600000| Untracked \r\n|  27|0x0000000703700000, 0x0000000703700000, 0x0000000703800000|  0%| F|  |TAMS 0x0000000703700000, 0x0000000703700000| Untracked \r\n|  28|0x0000000703800000, 0x0000000703800000, 0x0000000703900000|  0%| F|  |TAMS 0x0000000703800000, 0x0000000703800000| Untracked \r\n|  29|0x0000000703900000, 0x0000000703900000, 0x0000000703a00000|  0%| F|  |TAMS 0x0000000703900000, 0x0000000703900000| Untracked \r\n|  30|0x0000000703a00000, 0x0000000703a00000, 0x0000000703b00000|  0%| F|  |TAMS 0x0000000703a00000, 0x0000000703a00000| Untracked \r\n|  31|0x0000000703b00000, 0x0000000703b00000, 0x0000000703c00000|  0%| F|  |TAMS 0x0000000703b00000, 0x0000000703b00000| Untracked \r\n|  32|0x0000000703c00000, 0x0000000703c00000, 0x0000000703d00000|  0%| F|  |TAMS 0x0000000703c00000, 0x0000000703c00000| Untracked \r\n|  33|0x0000000703d00000, 0x0000000703d00000, 0x0000000703e00000|  0%| F|  |TAMS 0x0000000703d00000, 0x0000000703d00000| Untracked \r\n|  34|0x0000000703e00000, 0x0000000703e00000, 0x0000000703f00000|  0%| F|  |TAMS 0x0000000703e00000, 0x0000000703e00000| Untracked \r\n|  35|0x0000000703f00000, 0x0000000703f00000, 0x0000000704000000|  0%| F|  |TAMS 0x0000000703f00000, 0x0000000703f00000| Untracked \r\n|  36|0x0000000704000000, 0x0000000704000000, 0x0000000704100000|  0%| F|  |TAMS 0x0000000704000000, 0x0000000704000000| Untracked \r\n|  37|0x0000000704100000, 0x0000000704100000, 0x0000000704200000|  0%| F|  |TAMS 0x0000000704100000, 0x0000000704100000| Untracked \r\n|  38|0x0000000704200000, 0x0000000704200000, 0x0000000704300000|  0%| F|  |TAMS 0x0000000704200000, 0x0000000704200000| Untracked \r\n|  39|0x0000000704300000, 0x0000000704300000, 0x0000000704400000|  0%| F|  |TAMS 0x0000000704300000, 0x0000000704300000| Untracked \r\n|  40|0x0000000704400000, 0x0000000704400000, 0x0000000704500000|  0%| F|  |TAMS 0x0000000704400000, 0x0000000704400000| Untracked \r\n|  41|0x0000000704500000, 0x0000000704500000, 0x0000000704600000|  0%| F|  |TAMS 0x0000000704500000, 0x0000000704500000| Untracked \r\n|  42|0x0000000704600000, 0x0000000704600000, 0x0000000704700000|  0%| F|  |TAMS 0x0000000704600000, 0x0000000704600000| Untracked \r\n|  43|0x0000000704700000, 0x0000000704700000, 0x0000000704800000|  0%| F|  |TAMS 0x0000000704700000, 0x0000000704700000| Untracked \r\n|  44|0x0000000704800000, 0x0000000704800000, 0x0000000704900000|  0%| F|  |TAMS 0x0000000704800000, 0x0000000704800000| Untracked \r\n|  45|0x0000000704900000, 0x0000000704900000, 0x0000000704a00000|  0%| F|  |TAMS 0x0000000704900000, 0x0000000704900000| Untracked \r\n|  46|0x0000000704a00000, 0x0000000704a00000, 0x0000000704b00000|  0%| F|  |TAMS 0x0000000704a00000, 0x0000000704a00000| Untracked \r\n|  47|0x0000000704b00000, 0x0000000704b00000, 0x0000000704c00000|  0%| F|  |TAMS 0x0000000704b00000, 0x0000000704b00000| Untracked \r\n|  48|0x0000000704c00000, 0x0000000704c00000, 0x0000000704d00000|  0%| F|  |TAMS 0x0000000704c00000, 0x0000000704c00000| Untracked \r\n|  49|0x0000000704d00000, 0x0000000704d00000, 0x0000000704e00000|  0%| F|  |TAMS 0x0000000704d00000, 0x0000000704d00000| Untracked \r\n|  50|0x0000000704e00000, 0x0000000704e00000, 0x0000000704f00000|  0%| F|  |TAMS 0x0000000704e00000, 0x0000000704e00000| Untracked \r\n|  51|0x0000000704f00000, 0x0000000704f00000, 0x0000000705000000|  0%| F|  |TAMS 0x0000000704f00000, 0x0000000704f00000| Untracked \r\n|  52|0x0000000705000000, 0x0000000705000000, 0x0000000705100000|  0%| F|  |TAMS 0x0000000705000000, 0x0000000705000000| Untracked \r\n|  53|0x0000000705100000, 0x0000000705100000, 0x0000000705200000|  0%| F|  |TAMS 0x0000000705100000, 0x0000000705100000| Untracked \r\n|  54|0x0000000705200000, 0x0000000705200000, 0x0000000705300000|  0%| F|  |TAMS 0x0000000705200000, 0x0000000705200000| Untracked \r\n|  55|0x0000000705300000, 0x0000000705300000, 0x0000000705400000|  0%| F|  |TAMS 0x0000000705300000, 0x0000000705300000| Untracked \r\n|  56|0x0000000705400000, 0x0000000705400000, 0x0000000705500000|  0%| F|  |TAMS 0x0000000705400000, 0x0000000705400000| Untracked \r\n|  57|0x0000000705500000, 0x0000000705500000, 0x0000000705600000|  0%| F|  |TAMS 0x0000000705500000, 0x0000000705500000| Untracked \r\n|  58|0x0000000705600000, 0x0000000705600000, 0x0000000705700000|  0%| F|  |TAMS 0x0000000705600000, 0x0000000705600000| Untracked \r\n|  59|0x0000000705700000, 0x0000000705700000, 0x0000000705800000|  0%| F|  |TAMS 0x0000000705700000, 0x0000000705700000| Untracked \r\n|  60|0x0000000705800000, 0x0000000705800000, 0x0000000705900000|  0%| F|  |TAMS 0x0000000705800000, 0x0000000705800000| Untracked \r\n|  61|0x0000000705900000, 0x0000000705900000, 0x0000000705a00000|  0%| F|  |TAMS 0x0000000705900000, 0x0000000705900000| Untracked \r\n|  62|0x0000000705a00000, 0x0000000705a00000, 0x0000000705b00000|  0%| F|  |TAMS 0x0000000705a00000, 0x0000000705a00000| Untracked \r\n|  63|0x0000000705b00000, 0x0000000705b00000, 0x0000000705c00000|  0%| F|  |TAMS 0x0000000705b00000, 0x0000000705b00000| Untracked \r\n|  64|0x0000000705c00000, 0x0000000705c00000, 0x0000000705d00000|  0%| F|  |TAMS 0x0000000705c00000, 0x0000000705c00000| Untracked \r\n|  65|0x0000000705d00000, 0x0000000705d00000, 0x0000000705e00000|  0%| F|  |TAMS 0x0000000705d00000, 0x0000000705d00000| Untracked \r\n|  66|0x0000000705e00000, 0x0000000705e00000, 0x0000000705f00000|  0%| F|  |TAMS 0x0000000705e00000, 0x0000000705e00000| Untracked \r\n|  67|0x0000000705f00000, 0x0000000705f00000, 0x0000000706000000|  0%| F|  |TAMS 0x0000000705f00000, 0x0000000705f00000| Untracked \r\n|  68|0x0000000706000000, 0x0000000706000000, 0x0000000706100000|  0%| F|  |TAMS 0x0000000706000000, 0x0000000706000000| Untracked \r\n|  69|0x0000000706100000, 0x0000000706100000, 0x0000000706200000|  0%| F|  |TAMS 0x0000000706100000, 0x0000000706100000| Untracked \r\n|  70|0x0000000706200000, 0x0000000706200000, 0x0000000706300000|  0%| F|  |TAMS 0x0000000706200000, 0x0000000706200000| Untracked \r\n|  71|0x0000000706300000, 0x0000000706300000, 0x0000000706400000|  0%| F|  |TAMS 0x0000000706300000, 0x0000000706300000| Untracked \r\n|  72|0x0000000706400000, 0x0000000706400000, 0x0000000706500000|  0%| F|  |TAMS 0x0000000706400000, 0x0000000706400000| Untracked \r\n|  73|0x0000000706500000, 0x0000000706500000, 0x0000000706600000|  0%| F|  |TAMS 0x0000000706500000, 0x0000000706500000| Untracked \r\n|  74|0x0000000706600000, 0x0000000706600000, 0x0000000706700000|  0%| F|  |TAMS 0x0000000706600000, 0x0000000706600000| Untracked \r\n|  75|0x0000000706700000, 0x0000000706700000, 0x0000000706800000|  0%| F|  |TAMS 0x0000000706700000, 0x0000000706700000| Untracked \r\n|  76|0x0000000706800000, 0x0000000706800000, 0x0000000706900000|  0%| F|  |TAMS 0x0000000706800000, 0x0000000706800000| Untracked \r\n|  77|0x0000000706900000, 0x0000000706900000, 0x0000000706a00000|  0%| F|  |TAMS 0x0000000706900000, 0x0000000706900000| Untracked \r\n|  78|0x0000000706a00000, 0x0000000706a00000, 0x0000000706b00000|  0%| F|  |TAMS 0x0000000706a00000, 0x0000000706a00000| Untracked \r\n|  79|0x0000000706b00000, 0x0000000706b00000, 0x0000000706c00000|  0%| F|  |TAMS 0x0000000706b00000, 0x0000000706b00000| Untracked \r\n|  80|0x0000000706c00000, 0x0000000706c00000, 0x0000000706d00000|  0%| F|  |TAMS 0x0000000706c00000, 0x0000000706c00000| Untracked \r\n|  81|0x0000000706d00000, 0x0000000706d00000, 0x0000000706e00000|  0%| F|  |TAMS 0x0000000706d00000, 0x0000000706d00000| Untracked \r\n|  82|0x0000000706e00000, 0x0000000706e00000, 0x0000000706f00000|  0%| F|  |TAMS 0x0000000706e00000, 0x0000000706e00000| Untracked \r\n|  83|0x0000000706f00000, 0x0000000706f00000, 0x0000000707000000|  0%| F|  |TAMS 0x0000000706f00000, 0x0000000706f00000| Untracked \r\n|  84|0x0000000707000000, 0x0000000707000000, 0x0000000707100000|  0%| F|  |TAMS 0x0000000707000000, 0x0000000707000000| Untracked \r\n|  85|0x0000000707100000, 0x0000000707100000, 0x0000000707200000|  0%| F|  |TAMS 0x0000000707100000, 0x0000000707100000| Untracked \r\n|  86|0x0000000707200000, 0x0000000707200000, 0x0000000707300000|  0%| F|  |TAMS 0x0000000707200000, 0x0000000707200000| Untracked \r\n|  87|0x0000000707300000, 0x0000000707300000, 0x0000000707400000|  0%| F|  |TAMS 0x0000000707300000, 0x0000000707300000| Untracked \r\n|  88|0x0000000707400000, 0x0000000707400000, 0x0000000707500000|  0%| F|  |TAMS 0x0000000707400000, 0x0000000707400000| Untracked \r\n|  89|0x0000000707500000, 0x0000000707500000, 0x0000000707600000|  0%| F|  |TAMS 0x0000000707500000, 0x0000000707500000| Untracked \r\n|  90|0x0000000707600000, 0x0000000707600000, 0x0000000707700000|  0%| F|  |TAMS 0x0000000707600000, 0x0000000707600000| Untracked \r\n|  91|0x0000000707700000, 0x0000000707700000, 0x0000000707800000|  0%| F|  |TAMS 0x0000000707700000, 0x0000000707700000| Untracked \r\n|  92|0x0000000707800000, 0x0000000707800000, 0x0000000707900000|  0%| F|  |TAMS 0x0000000707800000, 0x0000000707800000| Untracked \r\n|  93|0x0000000707900000, 0x0000000707900000, 0x0000000707a00000|  0%| F|  |TAMS 0x0000000707900000, 0x0000000707900000| Untracked \r\n|  94|0x0000000707a00000, 0x0000000707a00000, 0x0000000707b00000|  0%| F|  |TAMS 0x0000000707a00000, 0x0000000707a00000| Untracked \r\n|  95|0x0000000707b00000, 0x0000000707b00000, 0x0000000707c00000|  0%| F|  |TAMS 0x0000000707b00000, 0x0000000707b00000| Untracked \r\n|  96|0x0000000707c00000, 0x0000000707c00000, 0x0000000707d00000|  0%| F|  |TAMS 0x0000000707c00000, 0x0000000707c00000| Untracked \r\n|  97|0x0000000707d00000, 0x0000000707d00000, 0x0000000707e00000|  0%| F|  |TAMS 0x0000000707d00000, 0x0000000707d00000| Untracked \r\n|  98|0x0000000707e00000, 0x0000000707e00000, 0x0000000707f00000|  0%| F|  |TAMS 0x0000000707e00000, 0x0000000707e00000| Untracked \r\n|  99|0x0000000707f00000, 0x0000000707f00000, 0x0000000708000000|  0%| F|  |TAMS 0x0000000707f00000, 0x0000000707f00000| Untracked \r\n| 100|0x0000000708000000, 0x0000000708000000, 0x0000000708100000|  0%| F|  |TAMS 0x0000000708000000, 0x0000000708000000| Untracked \r\n| 101|0x0000000708100000, 0x0000000708100000, 0x0000000708200000|  0%| F|  |TAMS 0x0000000708100000, 0x0000000708100000| Untracked \r\n| 102|0x0000000708200000, 0x0000000708200000, 0x0000000708300000|  0%| F|  |TAMS 0x0000000708200000, 0x0000000708200000| Untracked \r\n| 103|0x0000000708300000, 0x0000000708300000, 0x0000000708400000|  0%| F|  |TAMS 0x0000000708300000, 0x0000000708300000| Untracked \r\n| 104|0x0000000708400000, 0x0000000708400000, 0x0000000708500000|  0%| F|  |TAMS 0x0000000708400000, 0x0000000708400000| Untracked \r\n| 105|0x0000000708500000, 0x0000000708500000, 0x0000000708600000|  0%| F|  |TAMS 0x0000000708500000, 0x0000000708500000| Untracked \r\n| 106|0x0000000708600000, 0x0000000708600000, 0x0000000708700000|  0%| F|  |TAMS 0x0000000708600000, 0x0000000708600000| Untracked \r\n| 107|0x0000000708700000, 0x0000000708700000, 0x0000000708800000|  0%| F|  |TAMS 0x0000000708700000, 0x0000000708700000| Untracked \r\n| 108|0x0000000708800000, 0x0000000708800000, 0x0000000708900000|  0%| F|  |TAMS 0x0000000708800000, 0x0000000708800000| Untracked \r\n| 109|0x0000000708900000, 0x0000000708900000, 0x0000000708a00000|  0%| F|  |TAMS 0x0000000708900000, 0x0000000708900000| Untracked \r\n| 110|0x0000000708a00000, 0x0000000708a00000, 0x0000000708b00000|  0%| F|  |TAMS 0x0000000708a00000, 0x0000000708a00000| Untracked \r\n| 111|0x0000000708b00000, 0x0000000708b00000, 0x0000000708c00000|  0%| F|  |TAMS 0x0000000708b00000, 0x0000000708b00000| Untracked \r\n| 112|0x0000000708c00000, 0x0000000708c00000, 0x0000000708d00000|  0%| F|  |TAMS 0x0000000708c00000, 0x0000000708c00000| Untracked \r\n| 113|0x0000000708d00000, 0x0000000708d00000, 0x0000000708e00000|  0%| F|  |TAMS 0x0000000708d00000, 0x0000000708d00000| Untracked \r\n| 114|0x0000000708e00000, 0x0000000708e00000, 0x0000000708f00000|  0%| F|  |TAMS 0x0000000708e00000, 0x0000000708e00000| Untracked \r\n| 115|0x0000000708f00000, 0x0000000708f00000, 0x0000000709000000|  0%| F|  |TAMS 0x0000000708f00000, 0x0000000708f00000| Untracked \r\n| 116|0x0000000709000000, 0x0000000709000000, 0x0000000709100000|  0%| F|  |TAMS 0x0000000709000000, 0x0000000709000000| Untracked \r\n| 117|0x0000000709100000, 0x0000000709100000, 0x0000000709200000|  0%| F|  |TAMS 0x0000000709100000, 0x0000000709100000| Untracked \r\n| 118|0x0000000709200000, 0x0000000709200000, 0x0000000709300000|  0%| F|  |TAMS 0x0000000709200000, 0x0000000709200000| Untracked \r\n| 119|0x0000000709300000, 0x0000000709300000, 0x0000000709400000|  0%| F|  |TAMS 0x0000000709300000, 0x0000000709300000| Untracked \r\n| 120|0x0000000709400000, 0x0000000709400000, 0x0000000709500000|  0%| F|  |TAMS 0x0000000709400000, 0x0000000709400000| Untracked \r\n| 121|0x0000000709500000, 0x0000000709500000, 0x0000000709600000|  0%| F|  |TAMS 0x0000000709500000, 0x0000000709500000| Untracked \r\n| 122|0x0000000709600000, 0x0000000709600000, 0x0000000709700000|  0%| F|  |TAMS 0x0000000709600000, 0x0000000709600000| Untracked \r\n| 123|0x0000000709700000, 0x0000000709700000, 0x0000000709800000|  0%| F|  |TAMS 0x0000000709700000, 0x0000000709700000| Untracked \r\n| 124|0x0000000709800000, 0x0000000709800000, 0x0000000709900000|  0%| F|  |TAMS 0x0000000709800000, 0x0000000709800000| Untracked \r\n| 125|0x0000000709900000, 0x0000000709900000, 0x0000000709a00000|  0%| F|  |TAMS 0x0000000709900000, 0x0000000709900000| Untracked \r\n| 126|0x0000000709a00000, 0x0000000709a00000, 0x0000000709b00000|  0%| F|  |TAMS 0x0000000709a00000, 0x0000000709a00000| Untracked \r\n| 127|0x0000000709b00000, 0x0000000709b00000, 0x0000000709c00000|  0%| F|  |TAMS 0x0000000709b00000, 0x0000000709b00000| Untracked \r\n| 128|0x0000000709c00000, 0x0000000709c00000, 0x0000000709d00000|  0%| F|  |TAMS 0x0000000709c00000, 0x0000000709c00000| Untracked \r\n| 129|0x0000000709d00000, 0x0000000709d00000, 0x0000000709e00000|  0%| F|  |TAMS 0x0000000709d00000, 0x0000000709d00000| Untracked \r\n| 130|0x0000000709e00000, 0x0000000709e00000, 0x0000000709f00000|  0%| F|  |TAMS 0x0000000709e00000, 0x0000000709e00000| Untracked \r\n| 131|0x0000000709f00000, 0x0000000709f00000, 0x000000070a000000|  0%| F|  |TAMS 0x0000000709f00000, 0x0000000709f00000| Untracked \r\n| 132|0x000000070a000000, 0x000000070a000000, 0x000000070a100000|  0%| F|  |TAMS 0x000000070a000000, 0x000000070a000000| Untracked \r\n| 133|0x000000070a100000, 0x000000070a100000, 0x000000070a200000|  0%| F|  |TAMS 0x000000070a100000, 0x000000070a100000| Untracked \r\n| 134|0x000000070a200000, 0x000000070a200000, 0x000000070a300000|  0%| F|  |TAMS 0x000000070a200000, 0x000000070a200000| Untracked \r\n| 135|0x000000070a300000, 0x000000070a300000, 0x000000070a400000|  0%| F|  |TAMS 0x000000070a300000, 0x000000070a300000| Untracked \r\n| 136|0x000000070a400000, 0x000000070a400000, 0x000000070a500000|  0%| F|  |TAMS 0x000000070a400000, 0x000000070a400000| Untracked \r\n| 137|0x000000070a500000, 0x000000070a500000, 0x000000070a600000|  0%| F|  |TAMS 0x000000070a500000, 0x000000070a500000| Untracked \r\n| 138|0x000000070a600000, 0x000000070a600000, 0x000000070a700000|  0%| F|  |TAMS 0x000000070a600000, 0x000000070a600000| Untracked \r\n| 139|0x000000070a700000, 0x000000070a700000, 0x000000070a800000|  0%| F|  |TAMS 0x000000070a700000, 0x000000070a700000| Untracked \r\n| 140|0x000000070a800000, 0x000000070a800000, 0x000000070a900000|  0%| F|  |TAMS 0x000000070a800000, 0x000000070a800000| Untracked \r\n| 141|0x000000070a900000, 0x000000070a900000, 0x000000070aa00000|  0%| F|  |TAMS 0x000000070a900000, 0x000000070a900000| Untracked \r\n| 142|0x000000070aa00000, 0x000000070aa00000, 0x000000070ab00000|  0%| F|  |TAMS 0x000000070aa00000, 0x000000070aa00000| Untracked \r\n| 143|0x000000070ab00000, 0x000000070ab00000, 0x000000070ac00000|  0%| F|  |TAMS 0x000000070ab00000, 0x000000070ab00000| Untracked \r\n| 144|0x000000070ac00000, 0x000000070ac00000, 0x000000070ad00000|  0%| F|  |TAMS 0x000000070ac00000, 0x000000070ac00000| Untracked \r\n| 145|0x000000070ad00000, 0x000000070ad00000, 0x000000070ae00000|  0%| F|  |TAMS 0x000000070ad00000, 0x000000070ad00000| Untracked \r\n| 146|0x000000070ae00000, 0x000000070ae00000, 0x000000070af00000|  0%| F|  |TAMS 0x000000070ae00000, 0x000000070ae00000| Untracked \r\n| 147|0x000000070af00000, 0x000000070af00000, 0x000000070b000000|  0%| F|  |TAMS 0x000000070af00000, 0x000000070af00000| Untracked \r\n| 148|0x000000070b000000, 0x000000070b000000, 0x000000070b100000|  0%| F|  |TAMS 0x000000070b000000, 0x000000070b000000| Untracked \r\n| 149|0x000000070b100000, 0x000000070b100000, 0x000000070b200000|  0%| F|  |TAMS 0x000000070b100000, 0x000000070b100000| Untracked \r\n| 150|0x000000070b200000, 0x000000070b200000, 0x000000070b300000|  0%| F|  |TAMS 0x000000070b200000, 0x000000070b200000| Untracked \r\n| 151|0x000000070b300000, 0x000000070b300000, 0x000000070b400000|  0%| F|  |TAMS 0x000000070b300000, 0x000000070b300000| Untracked \r\n| 152|0x000000070b400000, 0x000000070b400000, 0x000000070b500000|  0%| F|  |TAMS 0x000000070b400000, 0x000000070b400000| Untracked \r\n| 153|0x000000070b500000, 0x000000070b500000, 0x000000070b600000|  0%| F|  |TAMS 0x000000070b500000, 0x000000070b500000| Untracked \r\n| 154|0x000000070b600000, 0x000000070b600000, 0x000000070b700000|  0%| F|  |TAMS 0x000000070b600000, 0x000000070b600000| Untracked \r\n| 155|0x000000070b700000, 0x000000070b700000, 0x000000070b800000|  0%| F|  |TAMS 0x000000070b700000, 0x000000070b700000| Untracked \r\n| 156|0x000000070b800000, 0x000000070b800000, 0x000000070b900000|  0%| F|  |TAMS 0x000000070b800000, 0x000000070b800000| Untracked \r\n| 157|0x000000070b900000, 0x000000070b900000, 0x000000070ba00000|  0%| F|  |TAMS 0x000000070b900000, 0x000000070b900000| Untracked \r\n| 158|0x000000070ba00000, 0x000000070ba00000, 0x000000070bb00000|  0%| F|  |TAMS 0x000000070ba00000, 0x000000070ba00000| Untracked \r\n| 159|0x000000070bb00000, 0x000000070bb00000, 0x000000070bc00000|  0%| F|  |TAMS 0x000000070bb00000, 0x000000070bb00000| Untracked \r\n| 160|0x000000070bc00000, 0x000000070bc00000, 0x000000070bd00000|  0%| F|  |TAMS 0x000000070bc00000, 0x000000070bc00000| Untracked \r\n| 161|0x000000070bd00000, 0x000000070bd00000, 0x000000070be00000|  0%| F|  |TAMS 0x000000070bd00000, 0x000000070bd00000| Untracked \r\n| 162|0x000000070be00000, 0x000000070be00000, 0x000000070bf00000|  0%| F|  |TAMS 0x000000070be00000, 0x000000070be00000| Untracked \r\n| 163|0x000000070bf00000, 0x000000070bf00000, 0x000000070c000000|  0%| F|  |TAMS 0x000000070bf00000, 0x000000070bf00000| Untracked \r\n| 164|0x000000070c000000, 0x000000070c000000, 0x000000070c100000|  0%| F|  |TAMS 0x000000070c000000, 0x000000070c000000| Untracked \r\n| 165|0x000000070c100000, 0x000000070c100000, 0x000000070c200000|  0%| F|  |TAMS 0x000000070c100000, 0x000000070c100000| Untracked \r\n| 166|0x000000070c200000, 0x000000070c200000, 0x000000070c300000|  0%| F|  |TAMS 0x000000070c200000, 0x000000070c200000| Untracked \r\n| 167|0x000000070c300000, 0x000000070c300000, 0x000000070c400000|  0%| F|  |TAMS 0x000000070c300000, 0x000000070c300000| Untracked \r\n| 168|0x000000070c400000, 0x000000070c400000, 0x000000070c500000|  0%| F|  |TAMS 0x000000070c400000, 0x000000070c400000| Untracked \r\n| 169|0x000000070c500000, 0x000000070c500000, 0x000000070c600000|  0%| F|  |TAMS 0x000000070c500000, 0x000000070c500000| Untracked \r\n| 170|0x000000070c600000, 0x000000070c600000, 0x000000070c700000|  0%| F|  |TAMS 0x000000070c600000, 0x000000070c600000| Untracked \r\n| 171|0x000000070c700000, 0x000000070c700000, 0x000000070c800000|  0%| F|  |TAMS 0x000000070c700000, 0x000000070c700000| Untracked \r\n| 172|0x000000070c800000, 0x000000070c800000, 0x000000070c900000|  0%| F|  |TAMS 0x000000070c800000, 0x000000070c800000| Untracked \r\n| 173|0x000000070c900000, 0x000000070c900000, 0x000000070ca00000|  0%| F|  |TAMS 0x000000070c900000, 0x000000070c900000| Untracked \r\n| 174|0x000000070ca00000, 0x000000070ca00000, 0x000000070cb00000|  0%| F|  |TAMS 0x000000070ca00000, 0x000000070ca00000| Untracked \r\n| 175|0x000000070cb00000, 0x000000070cb00000, 0x000000070cc00000|  0%| F|  |TAMS 0x000000070cb00000, 0x000000070cb00000| Untracked \r\n| 176|0x000000070cc00000, 0x000000070cc00000, 0x000000070cd00000|  0%| F|  |TAMS 0x000000070cc00000, 0x000000070cc00000| Untracked \r\n| 177|0x000000070cd00000, 0x000000070cd00000, 0x000000070ce00000|  0%| F|  |TAMS 0x000000070cd00000, 0x000000070cd00000| Untracked \r\n| 178|0x000000070ce00000, 0x000000070ce00000, 0x000000070cf00000|  0%| F|  |TAMS 0x000000070ce00000, 0x000000070ce00000| Untracked \r\n| 179|0x000000070cf00000, 0x000000070cf00000, 0x000000070d000000|  0%| F|  |TAMS 0x000000070cf00000, 0x000000070cf00000| Untracked \r\n| 180|0x000000070d000000, 0x000000070d000000, 0x000000070d100000|  0%| F|  |TAMS 0x000000070d000000, 0x000000070d000000| Untracked \r\n| 181|0x000000070d100000, 0x000000070d100000, 0x000000070d200000|  0%| F|  |TAMS 0x000000070d100000, 0x000000070d100000| Untracked \r\n| 182|0x000000070d200000, 0x000000070d200000, 0x000000070d300000|  0%| F|  |TAMS 0x000000070d200000, 0x000000070d200000| Untracked \r\n| 183|0x000000070d300000, 0x000000070d300000, 0x000000070d400000|  0%| F|  |TAMS 0x000000070d300000, 0x000000070d300000| Untracked \r\n| 184|0x000000070d400000, 0x000000070d400000, 0x000000070d500000|  0%| F|  |TAMS 0x000000070d400000, 0x000000070d400000| Untracked \r\n| 185|0x000000070d500000, 0x000000070d500000, 0x000000070d600000|  0%| F|  |TAMS 0x000000070d500000, 0x000000070d500000| Untracked \r\n| 186|0x000000070d600000, 0x000000070d600000, 0x000000070d700000|  0%| F|  |TAMS 0x000000070d600000, 0x000000070d600000| Untracked \r\n| 187|0x000000070d700000, 0x000000070d700000, 0x000000070d800000|  0%| F|  |TAMS 0x000000070d700000, 0x000000070d700000| Untracked \r\n| 188|0x000000070d800000, 0x000000070d800000, 0x000000070d900000|  0%| F|  |TAMS 0x000000070d800000, 0x000000070d800000| Untracked \r\n| 189|0x000000070d900000, 0x000000070d900000, 0x000000070da00000|  0%| F|  |TAMS 0x000000070d900000, 0x000000070d900000| Untracked \r\n| 190|0x000000070da00000, 0x000000070da00000, 0x000000070db00000|  0%| F|  |TAMS 0x000000070da00000, 0x000000070da00000| Untracked \r\n| 191|0x000000070db00000, 0x000000070db00000, 0x000000070dc00000|  0%| F|  |TAMS 0x000000070db00000, 0x000000070db00000| Untracked \r\n| 192|0x000000070dc00000, 0x000000070dc00000, 0x000000070dd00000|  0%| F|  |TAMS 0x000000070dc00000, 0x000000070dc00000| Untracked \r\n| 193|0x000000070dd00000, 0x000000070dd00000, 0x000000070de00000|  0%| F|  |TAMS 0x000000070dd00000, 0x000000070dd00000| Untracked \r\n| 194|0x000000070de00000, 0x000000070de00000, 0x000000070df00000|  0%| F|  |TAMS 0x000000070de00000, 0x000000070de00000| Untracked \r\n| 195|0x000000070df00000, 0x000000070df00000, 0x000000070e000000|  0%| F|  |TAMS 0x000000070df00000, 0x000000070df00000| Untracked \r\n| 196|0x000000070e000000, 0x000000070e000000, 0x000000070e100000|  0%| F|  |TAMS 0x000000070e000000, 0x000000070e000000| Untracked \r\n| 197|0x000000070e100000, 0x000000070e100000, 0x000000070e200000|  0%| F|  |TAMS 0x000000070e100000, 0x000000070e100000| Untracked \r\n| 198|0x000000070e200000, 0x000000070e200000, 0x000000070e300000|  0%| F|  |TAMS 0x000000070e200000, 0x000000070e200000| Untracked \r\n| 199|0x000000070e300000, 0x000000070e300000, 0x000000070e400000|  0%| F|  |TAMS 0x000000070e300000, 0x000000070e300000| Untracked \r\n| 200|0x000000070e400000, 0x000000070e400000, 0x000000070e500000|  0%| F|  |TAMS 0x000000070e400000, 0x000000070e400000| Untracked \r\n| 201|0x000000070e500000, 0x000000070e500000, 0x000000070e600000|  0%| F|  |TAMS 0x000000070e500000, 0x000000070e500000| Untracked \r\n| 202|0x000000070e600000, 0x000000070e600000, 0x000000070e700000|  0%| F|  |TAMS 0x000000070e600000, 0x000000070e600000| Untracked \r\n| 203|0x000000070e700000, 0x000000070e700000, 0x000000070e800000|  0%| F|  |TAMS 0x000000070e700000, 0x000000070e700000| Untracked \r\n| 204|0x000000070e800000, 0x000000070e800000, 0x000000070e900000|  0%| F|  |TAMS 0x000000070e800000, 0x000000070e800000| Untracked \r\n| 205|0x000000070e900000, 0x000000070e900000, 0x000000070ea00000|  0%| F|  |TAMS 0x000000070e900000, 0x000000070e900000| Untracked \r\n| 206|0x000000070ea00000, 0x000000070ea00000, 0x000000070eb00000|  0%| F|  |TAMS 0x000000070ea00000, 0x000000070ea00000| Untracked \r\n| 207|0x000000070eb00000, 0x000000070eb00000, 0x000000070ec00000|  0%| F|  |TAMS 0x000000070eb00000, 0x000000070eb00000| Untracked \r\n| 208|0x000000070ec00000, 0x000000070ec00000, 0x000000070ed00000|  0%| F|  |TAMS 0x000000070ec00000, 0x000000070ec00000| Untracked \r\n| 209|0x000000070ed00000, 0x000000070ed00000, 0x000000070ee00000|  0%| F|  |TAMS 0x000000070ed00000, 0x000000070ed00000| Untracked \r\n| 210|0x000000070ee00000, 0x000000070ee00000, 0x000000070ef00000|  0%| F|  |TAMS 0x000000070ee00000, 0x000000070ee00000| Untracked \r\n| 211|0x000000070ef00000, 0x000000070ef00000, 0x000000070f000000|  0%| F|  |TAMS 0x000000070ef00000, 0x000000070ef00000| Untracked \r\n| 212|0x000000070f000000, 0x000000070f000000, 0x000000070f100000|  0%| F|  |TAMS 0x000000070f000000, 0x000000070f000000| Untracked \r\n| 213|0x000000070f100000, 0x000000070f100000, 0x000000070f200000|  0%| F|  |TAMS 0x000000070f100000, 0x000000070f100000| Untracked \r\n| 214|0x000000070f200000, 0x000000070f200000, 0x000000070f300000|  0%| F|  |TAMS 0x000000070f200000, 0x000000070f200000| Untracked \r\n| 215|0x000000070f300000, 0x000000070f300000, 0x000000070f400000|  0%| F|  |TAMS 0x000000070f300000, 0x000000070f300000| Untracked \r\n| 216|0x000000070f400000, 0x000000070f400000, 0x000000070f500000|  0%| F|  |TAMS 0x000000070f400000, 0x000000070f400000| Untracked \r\n| 217|0x000000070f500000, 0x000000070f500000, 0x000000070f600000|  0%| F|  |TAMS 0x000000070f500000, 0x000000070f500000| Untracked \r\n| 218|0x000000070f600000, 0x000000070f600000, 0x000000070f700000|  0%| F|  |TAMS 0x000000070f600000, 0x000000070f600000| Untracked \r\n| 219|0x000000070f700000, 0x000000070f700000, 0x000000070f800000|  0%| F|  |TAMS 0x000000070f700000, 0x000000070f700000| Untracked \r\n| 220|0x000000070f800000, 0x000000070f800000, 0x000000070f900000|  0%| F|  |TAMS 0x000000070f800000, 0x000000070f800000| Untracked \r\n| 221|0x000000070f900000, 0x000000070f900000, 0x000000070fa00000|  0%| F|  |TAMS 0x000000070f900000, 0x000000070f900000| Untracked \r\n| 222|0x000000070fa00000, 0x000000070fa00000, 0x000000070fb00000|  0%| F|  |TAMS 0x000000070fa00000, 0x000000070fa00000| Untracked \r\n| 223|0x000000070fb00000, 0x000000070fb00000, 0x000000070fc00000|  0%| F|  |TAMS 0x000000070fb00000, 0x000000070fb00000| Untracked \r\n| 224|0x000000070fc00000, 0x000000070fc00000, 0x000000070fd00000|  0%| F|  |TAMS 0x000000070fc00000, 0x000000070fc00000| Untracked \r\n| 225|0x000000070fd00000, 0x000000070fd00000, 0x000000070fe00000|  0%| F|  |TAMS 0x000000070fd00000, 0x000000070fd00000| Untracked \r\n| 226|0x000000070fe00000, 0x000000070fe00000, 0x000000070ff00000|  0%| F|  |TAMS 0x000000070fe00000, 0x000000070fe00000| Untracked \r\n| 227|0x000000070ff00000, 0x000000070ff00000, 0x0000000710000000|  0%| F|  |TAMS 0x000000070ff00000, 0x000000070ff00000| Untracked \r\n| 228|0x0000000710000000, 0x0000000710000000, 0x0000000710100000|  0%| F|  |TAMS 0x0000000710000000, 0x0000000710000000| Untracked \r\n| 229|0x0000000710100000, 0x0000000710100000, 0x0000000710200000|  0%| F|  |TAMS 0x0000000710100000, 0x0000000710100000| Untracked \r\n| 230|0x0000000710200000, 0x0000000710200000, 0x0000000710300000|  0%| F|  |TAMS 0x0000000710200000, 0x0000000710200000| Untracked \r\n| 231|0x0000000710300000, 0x0000000710300000, 0x0000000710400000|  0%| F|  |TAMS 0x0000000710300000, 0x0000000710300000| Untracked \r\n| 232|0x0000000710400000, 0x0000000710400000, 0x0000000710500000|  0%| F|  |TAMS 0x0000000710400000, 0x0000000710400000| Untracked \r\n| 233|0x0000000710500000, 0x0000000710500000, 0x0000000710600000|  0%| F|  |TAMS 0x0000000710500000, 0x0000000710500000| Untracked \r\n| 234|0x0000000710600000, 0x0000000710600000, 0x0000000710700000|  0%| F|  |TAMS 0x0000000710600000, 0x0000000710600000| Untracked \r\n| 235|0x0000000710700000, 0x0000000710700000, 0x0000000710800000|  0%| F|  |TAMS 0x0000000710700000, 0x0000000710700000| Untracked \r\n| 236|0x0000000710800000, 0x0000000710800000, 0x0000000710900000|  0%| F|  |TAMS 0x0000000710800000, 0x0000000710800000| Untracked \r\n| 237|0x0000000710900000, 0x0000000710900000, 0x0000000710a00000|  0%| F|  |TAMS 0x0000000710900000, 0x0000000710900000| Untracked \r\n| 238|0x0000000710a00000, 0x0000000710a00000, 0x0000000710b00000|  0%| F|  |TAMS 0x0000000710a00000, 0x0000000710a00000| Untracked \r\n| 239|0x0000000710b00000, 0x0000000710b00000, 0x0000000710c00000|  0%| F|  |TAMS 0x0000000710b00000, 0x0000000710b00000| Untracked \r\n| 240|0x0000000710c00000, 0x0000000710d00000, 0x0000000710d00000|100%| S|CS|TAMS 0x0000000710c00000, 0x0000000710c00000| Complete \r\n| 241|0x0000000710d00000, 0x0000000710e00000, 0x0000000710e00000|100%| S|CS|TAMS 0x0000000710d00000, 0x0000000710d00000| Complete \r\n| 242|0x0000000710e00000, 0x0000000710e00000, 0x0000000710f00000|  0%| F|  |TAMS 0x0000000710e00000, 0x0000000710e00000| Untracked \r\n| 243|0x0000000710f00000, 0x0000000710f00000, 0x0000000711000000|  0%| F|  |TAMS 0x0000000710f00000, 0x0000000710f00000| Untracked \r\n| 244|0x0000000711000000, 0x0000000711000000, 0x0000000711100000|  0%| F|  |TAMS 0x0000000711000000, 0x0000000711000000| Untracked \r\n| 245|0x0000000711100000, 0x0000000711100000, 0x0000000711200000|  0%| F|  |TAMS 0x0000000711100000, 0x0000000711100000| Untracked \r\n| 246|0x0000000711200000, 0x0000000711200000, 0x0000000711300000|  0%| F|  |TAMS 0x0000000711200000, 0x0000000711200000| Untracked \r\n| 247|0x0000000711300000, 0x0000000711300000, 0x0000000711400000|  0%| F|  |TAMS 0x0000000711300000, 0x0000000711300000| Untracked \r\n| 248|0x0000000711400000, 0x0000000711400000, 0x0000000711500000|  0%| F|  |TAMS 0x0000000711400000, 0x0000000711400000| Untracked \r\n| 249|0x0000000711500000, 0x0000000711500000, 0x0000000711600000|  0%| F|  |TAMS 0x0000000711500000, 0x0000000711500000| Untracked \r\n| 250|0x0000000711600000, 0x0000000711600000, 0x0000000711700000|  0%| F|  |TAMS 0x0000000711600000, 0x0000000711600000| Untracked \r\n| 251|0x0000000711700000, 0x0000000711700000, 0x0000000711800000|  0%| F|  |TAMS 0x0000000711700000, 0x0000000711700000| Untracked \r\n| 252|0x0000000711800000, 0x0000000711800000, 0x0000000711900000|  0%| F|  |TAMS 0x0000000711800000, 0x0000000711800000| Untracked \r\n| 253|0x0000000711900000, 0x0000000711900000, 0x0000000711a00000|  0%| F|  |TAMS 0x0000000711900000, 0x0000000711900000| Untracked \r\n| 254|0x0000000711a00000, 0x0000000711b00000, 0x0000000711b00000|100%| E|  |TAMS 0x0000000711a00000, 0x0000000711a00000| Complete \r\n| 255|0x0000000711b00000, 0x0000000711c00000, 0x0000000711c00000|100%| E|CS|TAMS 0x0000000711b00000, 0x0000000711b00000| Complete \r\n\r\nCard table byte_map: [0x000000001b0a0000,0x000000001b8a0000] _byte_map_base: 0x0000000017892000\r\n\r\nMarking Bits (Prev, Next): (CMBitMap*) 0x00000000035412a8, (CMBitMap*) 0x00000000035412e8\r\n Prev Bits: [0x000000001c0a0000, 0x0000000020030000)\r\n Next Bits: [0x0000000020030000, 0x0000000023fc0000)\r\n\r\nPolling page: 0x00000000001f0000\r\n\r\nMetaspace:\r\n\r\nUsage:\r\n  Non-class:      7.03 MB capacity,     6.84 MB ( 97%) used,   158.57 KB (  2%) free+waste,    30.19 KB ( <1%) overhead. \r\n      Class:   1014.00 KB capacity,   849.94 KB ( 84%) used,   144.81 KB ( 14%) free+waste,    19.25 KB (  2%) overhead. \r\n       Both:      8.02 MB capacity,     7.67 MB ( 96%) used,   303.38 KB (  4%) free+waste,    49.44 KB ( <1%) overhead. \r\n\r\nVirtual space:\r\n  Non-class space:        8.00 MB reserved,       7.25 MB ( 91%) committed \r\n      Class space:        1.00 GB reserved,       1.00 MB ( <1%) committed \r\n             Both:        1.01 GB reserved,       8.25 MB ( <1%) committed \r\n\r\nChunk freelists:\r\n   Non-Class:  4.75 KB\r\n       Class:  1.25 KB\r\n        Both:  6.00 KB\r\n\r\nCodeHeap 'non-profiled nmethods': size=120064Kb used=327Kb max_used=327Kb free=119736Kb\r\n bounds [0x0000000013360000, 0x00000000135d0000, 0x000000001a8a0000]\r\nCodeHeap 'profiled nmethods': size=120000Kb used=2312Kb max_used=2312Kb free=117687Kb\r\n bounds [0x000000000be30000, 0x000000000c0a0000, 0x0000000013360000]\r\nCodeHeap 'non-nmethods': size=5696Kb used=1168Kb max_used=1177Kb free=4528Kb\r\n bounds [0x000000000b8a0000, 0x000000000bb10000, 0x000000000be30000]\r\n total_blobs=1847 nmethods=1154 adapters=408\r\n compilation: enabled\r\n              stopped_count=0, restarted_count=0\r\n full_count=0\r\n\r\nCompilation events (10 events):\r\nEvent: 1.315 Thread 0x00000000279b4000 1153       3       java.lang.invoke.LambdaFormEditor::getInCache (186 bytes)\r\nEvent: 1.316 Thread 0x00000000279b4000 nmethod 1153 0x000000000c06fb90 code [0x000000000c06fe20, 0x000000000c070f10]\r\nEvent: 1.316 Thread 0x00000000279b4000 1150       3       java.util.ListResourceBundle::handleGetObject (34 bytes)\r\nEvent: 1.317 Thread 0x00000000279b4000 nmethod 1150 0x000000000c071290 code [0x000000000c071480, 0x000000000c071870]\r\nEvent: 1.317 Thread 0x00000000279b4000 1154       3       java.lang.invoke.LambdaFormEditor$Transform::inRange (36 bytes)\r\nEvent: 1.317 Thread 0x00000000279b4000 nmethod 1154 0x000000000c071990 code [0x000000000c071b40, 0x000000000c071cf8]\r\nEvent: 1.317 Thread 0x00000000279b4000 1152       1       java.lang.invoke.StringConcatFactory$RecipeElement::getTag (5 bytes)\r\nEvent: 1.317 Thread 0x00000000279b4000 nmethod 1152 0x00000000133b1a90 code [0x00000000133b1c40, 0x00000000133b1d78]\r\nEvent: 1.317 Thread 0x00000000279b4000 1155       3       java.lang.reflect.Executable::<init> (5 bytes)\r\nEvent: 1.317 Thread 0x00000000279b4000 nmethod 1155 0x000000000c071d90 code [0x000000000c071f60, 0x000000000c072198]\r\n\r\nGC Heap History (2 events):\r\nEvent: 1.294 GC heap before\r\n{Heap before GC invocations=0 (full 0):\r\n garbage-first heap   total 262144K, used 14336K [0x0000000701c00000, 0x0000000800000000)\r\n  region size 1024K, 14 young (14336K), 0 survivors (0K)\r\n Metaspace       used 7556K, capacity 7972K, committed 8192K, reserved 1056768K\r\n  class space    used 805K, capacity 978K, committed 1024K, reserved 1048576K\r\n}\r\nEvent: 1.303 GC heap after\r\n{Heap after GC invocations=1 (full 0):\r\n garbage-first heap   total 262144K, used 3338K [0x0000000701c00000, 0x0000000800000000)\r\n  region size 1024K, 2 young (2048K), 2 survivors (2048K)\r\n Metaspace       used 7556K, capacity 7972K, committed 8192K, reserved 1056768K\r\n  class space    used 805K, capacity 978K, committed 1024K, reserved 1048576K\r\n}\r\n\r\nDeoptimization events (10 events):\r\nEvent: 0.207 Thread 0x00000000034dd800 Uncommon trap: reason=bimorphic_or_optimized_type_check action=maybe_recompile pc=0x0000000013369c44 method=java.util.AbstractCollection.isEmpty()Z @ 1 c2\r\nEvent: 0.261 Thread 0x00000000034dd800 Uncommon trap: reason=unstable_if action=reinterpret pc=0x00000000133745a4 method=java.util.HashMap.putVal(ILjava/lang/Object;Ljava/lang/Object;ZZ)Ljava/lang/Object; @ 181 c2\r\nEvent: 0.440 Thread 0x00000000034dd800 Uncommon trap: reason=unstable_if action=reinterpret pc=0x0000000013381c90 method=java.lang.String.startsWith(Ljava/lang/String;I)Z @ 14 c2\r\nEvent: 0.902 Thread 0x0000000027aa8800 Uncommon trap: reason=unstable_if action=reinterpret pc=0x00000000133958a0 method=java.lang.String.startsWith(Ljava/lang/String;I)Z @ 1 c2\r\nEvent: 0.969 Thread 0x0000000029840000 Uncommon trap: reason=unstable_if action=reinterpret pc=0x000000001336f5a4 method=java.lang.String.isLatin1()Z @ 10 c2\r\nEvent: 0.971 Thread 0x0000000029840000 Uncommon trap: reason=unstable_if action=reinterpret pc=0x000000001338a314 method=java.lang.StringLatin1.canEncode(I)Z @ 4 c2\r\nEvent: 0.972 Thread 0x0000000029840000 Uncommon trap: reason=unstable_if action=reinterpret pc=0x00000000133872f8 method=java.lang.AbstractStringBuilder.isLatin1()Z @ 10 c2\r\nEvent: 1.165 Thread 0x0000000029a11000 Uncommon trap: reason=unstable_if action=reinterpret pc=0x00000000133a12fc method=java.lang.StringLatin1.indexOf([BI[BII)I @ 27 c2\r\nEvent: 1.214 Thread 0x0000000029a11000 Uncommon trap: reason=unstable_if action=reinterpret pc=0x0000000013396688 method=java.lang.Integer.getChars(II[B)I @ 25 c2\r\nEvent: 1.305 Thread 0x0000000029a11000 Uncommon trap: reason=unstable_if action=reinterpret pc=0x00000000133a3288 method=java.lang.ref.ReferenceQueue.poll()Ljava/lang/ref/Reference; @ 4 c2\r\n\r\nClasses redefined (0 events):\r\nNo events\r\n\r\nInternal exceptions (10 events):\r\nEvent: 1.099 Thread 0x000000002998d800 Exception <a 'java/lang/NoSuchMethodError'{0x00000007111dc638}: java.lang.invoke.DirectMethodHandle$Holder.invokeSpecial(Ljava/lang/Object;Ljava/lang/Object;)V> (0x00000007111dc638) thrown at [t:/workspace/open/src/hotspot/share/interpreter/linkResolver.c\r\nEvent: 1.104 Thread 0x0000000029840000 Exception <a 'java/lang/NoSuchMethodError'{0x00000007111adfb0}: java.lang.invoke.DirectMethodHandle$Holder.invokeStatic(Ljava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;J)Ljava/l\r\nEvent: 1.199 Thread 0x0000000029a11000 Exception <a 'java/lang/NoSuchMethodError'{0x0000000710f7c498}: java.lang.invoke.DirectMethodHandle$Holder.invokeStatic(Ljava/lang/Object;ILjava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;> (0x0000000710f7c498) th\r\nEvent: 1.200 Thread 0x0000000029a11000 Exception <a 'java/lang/NoSuchMethodError'{0x0000000710f830c8}: java.lang.invoke.DirectMethodHandle$Holder.invokeStatic(Ljava/lang/Object;ILjava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;> (0x0000000710f830c8) thrown at [t:/worksp\r\nEvent: 1.201 Thread 0x0000000029a11000 Exception <a 'java/lang/NoSuchMethodError'{0x0000000710f86928}: java.lang.invoke.DirectMethodHandle$Holder.invokeSpecial(Ljava/lang/Object;Ljava/lang/Object;ILjava/lang/Object;Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;> (0x0000000710f86928) t\r\nEvent: 1.206 Thread 0x0000000029a11000 Exception <a 'java/lang/NoSuchMethodError'{0x0000000710f9cfc0}: java.lang.invoke.DirectMethodHandle$Holder.invokeStatic(Ljava/lang/Object;ILjava/lang/Object;)Ljava/lang/Object;> (0x0000000710f9cfc0) thrown at [t:/workspace/open/src/hotspot/share/interpret\r\nEvent: 1.254 Thread 0x0000000029a11000 Exception <a 'java/lang/ClassNotFoundException'{0x0000000710e4e620}: com/sun/swing/internal/plaf/metal/resources/spi/metalProvider> (0x0000000710e4e620) thrown at [t:/workspace/open/src/hotspot/share/classfile/systemDictionary.cpp, line 235]\r\nEvent: 1.255 Thread 0x0000000029a11000 Exception <a 'java/lang/ClassNotFoundException'{0x0000000710e52c28}: com/sun/swing/internal/plaf/basic/resources/spi/basicProvider> (0x0000000710e52c28) thrown at [t:/workspace/open/src/hotspot/share/classfile/systemDictionary.cpp, line 235]\r\nEvent: 1.259 Thread 0x0000000029a11000 Exception <a 'java/lang/NoSuchMethodError'{0x0000000710e60688}: java.lang.invoke.DirectMethodHandle$Holder.invokeStaticInit(Ljava/lang/Object;)V> (0x0000000710e60688) thrown at [t:/workspace/open/src/hotspot/share/interpreter/linkResolver.cpp, line 777]\r\nEvent: 1.309 Thread 0x0000000029a11000 Exception <a 'java/lang/ClassNotFoundException'{0x0000000711a01620}: com/sun/java/swing/plaf/windows/resources/spi/windowsProvider> (0x0000000711a01620) thrown at [t:/workspace/open/src/hotspot/share/classfile/systemDictionary.cpp, line 235]\r\n\r\nEvents (10 events):\r\nEvent: 1.322 loading class java/io/FilenameFilter done\r\nEvent: 1.322 loading class sun/font/SunFontManager$TTFilter done\r\nEvent: 1.322 loading class sun/font/SunFontManager$T1Filter\r\nEvent: 1.323 loading class sun/font/SunFontManager$T1Filter done\r\nEvent: 1.323 loading class sun/font/SunFontManager$1\r\nEvent: 1.323 loading class sun/font/SunFontManager$1 done\r\nEvent: 1.323 loading class sun/font/FontManagerNativeLibrary\r\nEvent: 1.323 loading class sun/font/FontManagerNativeLibrary done\r\nEvent: 1.323 loading class sun/font/FontManagerNativeLibrary$1\r\nEvent: 1.323 loading class sun/font/FontManagerNativeLibrary$1 done\r\n\r\n\r\nDynamic libraries:\r\n0x0000000000400000 - 0x00000000004f1000 \tC:\\Program Files\\NetBeans-11.1\\netbeans\\bin\\netbeans64.exe\r\n0x00007ffb59d40000 - 0x00007ffb59f30000 \tC:\\WINDOWS\\SYSTEM32\\ntdll.dll\r\n0x00007ffb59790000 - 0x00007ffb59842000 \tC:\\WINDOWS\\System32\\KERNEL32.DLL\r\n0x00007ffb56e70000 - 0x00007ffb57113000 \tC:\\WINDOWS\\System32\\KERNELBASE.dll\r\n0x00007ffb4d940000 - 0x00007ffb4d963000 \tC:\\WINDOWS\\system32\\atklshld64.dll\r\n0x00007ffb58aa0000 - 0x00007ffb58c33000 \tC:\\WINDOWS\\System32\\USER32.dll\r\n0x00007ffb574e0000 - 0x00007ffb57501000 \tC:\\WINDOWS\\System32\\win32u.dll\r\n0x00007ffb58a70000 - 0x00007ffb58a96000 \tC:\\WINDOWS\\System32\\GDI32.dll\r\n0x00007ffb57340000 - 0x00007ffb574d4000 \tC:\\WINDOWS\\System32\\gdi32full.dll\r\n0x00007ffb571a0000 - 0x00007ffb5723e000 \tC:\\WINDOWS\\System32\\msvcp_win.dll\r\n0x00007ffb57240000 - 0x00007ffb5733a000 \tC:\\WINDOWS\\System32\\ucrtbase.dll\r\n0x00007ffb583c0000 - 0x00007ffb58463000 \tC:\\WINDOWS\\System32\\ADVAPI32.dll\r\n0x00007ffb582c0000 - 0x00007ffb5835e000 \tC:\\WINDOWS\\System32\\msvcrt.dll\r\n0x00007ffb59850000 - 0x00007ffb598e7000 \tC:\\WINDOWS\\System32\\sechost.dll\r\n0x00007ffb58920000 - 0x00007ffb58a40000 \tC:\\WINDOWS\\System32\\RPCRT4.dll\r\n0x00007ffb58d80000 - 0x00007ffb59462000 \tC:\\WINDOWS\\System32\\SHELL32.dll\r\n0x00007ffb56cd0000 - 0x00007ffb56d1a000 \tC:\\WINDOWS\\System32\\cfgmgr32.dll\r\n0x00007ffb59b80000 - 0x00007ffb59c29000 \tC:\\WINDOWS\\System32\\shcore.dll\r\n0x00007ffb585d0000 - 0x00007ffb58906000 \tC:\\WINDOWS\\System32\\combase.dll\r\n0x00007ffb57d70000 - 0x00007ffb57df0000 \tC:\\WINDOWS\\System32\\bcryptPrimitives.dll\r\n0x00007ffb57510000 - 0x00007ffb57c8c000 \tC:\\WINDOWS\\System32\\windows.storage.dll\r\n0x00007ffb56c60000 - 0x00007ffb56c7f000 \tC:\\WINDOWS\\System32\\profapi.dll\r\n0x00007ffb56c80000 - 0x00007ffb56cca000 \tC:\\WINDOWS\\System32\\powrprof.dll\r\n0x00007ffb56c10000 - 0x00007ffb56c20000 \tC:\\WINDOWS\\System32\\UMPDC.dll\r\n0x00007ffb58360000 - 0x00007ffb583b2000 \tC:\\WINDOWS\\System32\\shlwapi.dll\r\n0x00007ffb56c40000 - 0x00007ffb56c51000 \tC:\\WINDOWS\\System32\\kernel.appcore.dll\r\n0x00007ffb57120000 - 0x00007ffb57137000 \tC:\\WINDOWS\\System32\\cryptsp.dll\r\n0x00007ffb58a40000 - 0x00007ffb58a6e000 \tC:\\WINDOWS\\System32\\IMM32.DLL\r\n0x0000000063c80000 - 0x0000000063d62000 \tC:\\Program Files\\NetBeans-11.1\\netbeans\\platform\\lib\\nbexec64.dll\r\n0x00007ffaffff0000 - 0x00007ffb00b67000 \tC:\\Program Files\\Java\\jdk-12.0.2\\bin\\server\\jvm.dll\r\n0x00007ffb59780000 - 0x00007ffb59788000 \tC:\\WINDOWS\\System32\\PSAPI.DLL\r\n0x00007ffb42d20000 - 0x00007ffb42d29000 \tC:\\WINDOWS\\SYSTEM32\\WSOCK32.dll\r\n0x00007ffb58c40000 - 0x00007ffb58caf000 \tC:\\WINDOWS\\System32\\WS2_32.dll\r\n0x00007ffb52660000 - 0x00007ffb52684000 \tC:\\WINDOWS\\SYSTEM32\\WINMM.dll\r\n0x00007ffb49c60000 - 0x00007ffb49c6a000 \tC:\\WINDOWS\\SYSTEM32\\VERSION.dll\r\n0x00007ffb4ab00000 - 0x00007ffb4ab16000 \tC:\\Program Files\\Java\\jdk-12.0.2\\bin\\VCRUNTIME140.dll\r\n0x00007ffb52630000 - 0x00007ffb5265d000 \tC:\\WINDOWS\\SYSTEM32\\WINMMBASE.dll\r\n0x00007ffb2c880000 - 0x00007ffb2c8bb000 \tC:\\Program Files\\Java\\jdk-12.0.2\\bin\\splashscreen.dll\r\n0x00007ffb48d90000 - 0x00007ffb48db6000 \tC:\\Program Files\\Java\\jdk-12.0.2\\bin\\java.dll\r\n0x00007ffb4e410000 - 0x00007ffb4e9d0000 \tC:\\WINDOWS\\SYSTEM32\\d2d1.dll\r\n0x00007ffb48c50000 - 0x00007ffb48c61000 \tC:\\Program Files\\Java\\jdk-12.0.2\\bin\\verify.dll\r\n0x00007ffb48bf0000 - 0x00007ffb48c07000 \tC:\\Program Files\\Java\\jdk-12.0.2\\bin\\zip.dll\r\n0x00007ffb54240000 - 0x00007ffb5424a000 \tC:\\Program Files\\Java\\jdk-12.0.2\\bin\\jimage.dll\r\n0x00007ffb46c60000 - 0x00007ffb46c79000 \tC:\\Program Files\\Java\\jdk-12.0.2\\bin\\net.dll\r\n0x00007ffb4a4c0000 - 0x00007ffb4a696000 \tC:\\WINDOWS\\SYSTEM32\\urlmon.dll\r\n0x00007ffb4b410000 - 0x00007ffb4b500000 \tC:\\WINDOWS\\SYSTEM32\\WINHTTP.dll\r\n0x00007ffb49ca0000 - 0x00007ffb49f46000 \tC:\\WINDOWS\\SYSTEM32\\iertutil.dll\r\n0x00007ffb56650000 - 0x00007ffb5665c000 \tC:\\WINDOWS\\SYSTEM32\\CRYPTBASE.DLL\r\n0x00007ffb56480000 - 0x00007ffb564e7000 \tC:\\WINDOWS\\system32\\mswsock.dll\r\n0x00007ffb34140000 - 0x00007ffb34153000 \tC:\\Program Files\\Java\\jdk-12.0.2\\bin\\nio.dll\r\n0x00007ffb56190000 - 0x00007ffb561ca000 \tC:\\WINDOWS\\SYSTEM32\\IPHLPAPI.DLL\r\n0x00007ffb59a30000 - 0x00007ffb59a38000 \tC:\\WINDOWS\\System32\\NSI.dll\r\n0x00007ffb54be0000 - 0x00007ffb54bf6000 \tC:\\WINDOWS\\SYSTEM32\\dhcpcsvc6.DLL\r\n0x00007ffb54bc0000 - 0x00007ffb54bdc000 \tC:\\WINDOWS\\SYSTEM32\\dhcpcsvc.DLL\r\n0x00007ffb561d0000 - 0x00007ffb5629a000 \tC:\\WINDOWS\\SYSTEM32\\DNSAPI.dll\r\n0x00007ffb0a2a0000 - 0x00007ffb0a43f000 \tC:\\Program Files\\Java\\jdk-12.0.2\\bin\\awt.dll\r\n0x00007ffb59960000 - 0x00007ffb59a24000 \tC:\\WINDOWS\\System32\\OLEAUT32.dll\r\n0x00007ffb0e930000 - 0x00007ffb0e9da000 \tC:\\Program Files\\Java\\jdk-12.0.2\\bin\\MSVCP140.dll\r\n0x00007ffb54250000 - 0x00007ffb542df000 \tC:\\WINDOWS\\SYSTEM32\\apphelp.dll\r\n0x00007ffb55ff0000 - 0x00007ffb56023000 \tC:\\WINDOWS\\system32\\rsaenh.dll\r\n0x00007ffb57d40000 - 0x00007ffb57d66000 \tC:\\WINDOWS\\System32\\bcrypt.dll\r\n0x00007ffb56b30000 - 0x00007ffb56b55000 \tC:\\WINDOWS\\SYSTEM32\\USERENV.dll\r\n0x00007ffb54fc0000 - 0x00007ffb54fed000 \tC:\\WINDOWS\\system32\\DWMAPI.DLL\r\n0x00007ffb54390000 - 0x00007ffb54429000 \tC:\\WINDOWS\\system32\\uxtheme.dll\r\n0x00007ffb3f220000 - 0x00007ffb3f4a5000 \tC:\\WINDOWS\\WinSxS\\amd64_microsoft.windows.common-controls_6595b64144ccf1df_6.0.18362.295_none_e6c3acbd13101292\\COMCTL32.dll\r\n0x00007ffb59a40000 - 0x00007ffb59b76000 \tC:\\WINDOWS\\System32\\MSCTF.dll\r\n0x00007ffb58470000 - 0x00007ffb585c6000 \tC:\\WINDOWS\\System32\\ole32.dll\r\n0x00007ffb0df80000 - 0x00007ffb0e000000 \tC:\\Program Files\\Java\\jdk-12.0.2\\bin\\freetype.dll\r\n\r\ndbghelp: loaded successfully - version: 4.0.5 - missing functions: none\r\nsymbol engine: initialized successfully\r\n[error occurred during error reporting (printing native decoder state), id 0xc0000005, EXCEPTION_ACCESS_VIOLATION (0xc0000005) at pc=0x00007ffb55507c10]\r\n\r\nVM Arguments:\r\njvm_args: -Dnetbeans.importclass=org.netbeans.upgrade.AutoUpgrade -XX:+UseStringDeduplication -Xss2m -Djdk.gtk.version=2.2 -Dapple.laf.useScreenMenuBar=true -Dapple.awt.graphics.UseQuartz=true -Dsun.java2d.noddraw=true -Dsun.java2d.dpiaware=true -Dsun.zip.disableMemoryMapping=true -Dplugin.manager.check.updates=false -Dnetbeans.extbrowser.manual_chrome_plugin_install=yes --add-opens=java.base/java.net=ALL-UNNAMED --add-opens=java.base/java.lang.ref=ALL-UNNAMED --add-opens=java.base/java.lang=ALL-UNNAMED --add-opens=java.base/java.security=ALL-UNNAMED --add-opens=java.base/java.util=ALL-UNNAMED --add-opens=java.desktop/javax.swing.plaf.basic=ALL-UNNAMED --add-opens=java.desktop/javax.swing.text=ALL-UNNAMED --add-opens=java.desktop/javax.swing=ALL-UNNAMED --add-opens=java.desktop/java.awt=ALL-UNNAMED --add-opens=java.desktop/java.awt.event=ALL-UNNAMED --add-opens=java.prefs/java.util.prefs=ALL-UNNAMED --add-opens=jdk.jshell/jdk.jshell=ALL-UNNAMED --add-modules=jdk.jshell --add-exports=java.desktop/sun.awt=ALL-UNNAMED --add-exports=java.desktop/java.awt.peer=ALL-UNNAMED --add-exports=java.desktop/com.sun.beans.editors=ALL-UNNAMED --add-exports=java.desktop/sun.swing=ALL-UNNAMED --add-exports=java.desktop/sun.awt.im=ALL-UNNAMED --add-exports=jdk.internal.jvmstat/sun.jvmstat.monitor=ALL-UNNAMED --add-exports=java.management/sun.management=ALL-UNNAMED --add-exports=java.base/sun.reflect.annotation=ALL-UNNAMED --add-exports=jdk.javadoc/com.sun.tools.javadoc.main=ALL-UNNAMED -XX:+IgnoreUnrecognizedVMOptions -Djdk.home=C:\\Program Files\\Java\\jdk-12.0.2 -Dnetbeans.home=C:\\Program Files\\NetBeans-11.1\\netbeans\\platform -Dnetbeans.user=C:\\Users\\DANIEL\\AppData\\Roaming\\NetBeans\\11.1 -Dnetbeans.default_userdir_root=C:\\Users\\DANIEL\\AppData\\Roaming\\NetBeans -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=C:\\Users\\DANIEL\\AppData\\Roaming\\NetBeans\\11.1\\var\\log\\heapdump.hprof -Dsun.awt.keepWorkingSetOnMinimize=true -Dnetbeans.dirs=C:\\Program Files\\NetBeans-11.1\\netbeans\\nb;C:\\Program Files\\NetBeans-11.1\\netbeans\\ergonomics;C:\\Program Files\\NetBeans-11.1\\netbeans\\ide;C:\\Program Files\\NetBeans-11.1\\netbeans\\extide;C:\\Program Files\\NetBeans-11.1\\netbeans\\java;C:\\Program Files\\NetBeans-11.1\\netbeans\\apisupport;C:\\Program Files\\NetBeans-11.1\\netbeans\\webcommon;C:\\Program Files\\NetBeans-11.1\\netbeans\\websvccommon;C:\\Program Files\\NetBeans-11.1\\netbeans\\enterprise;C:\\Program Files\\NetBeans-11.1\\netbeans\\mobility;C:\\Program Files\\NetBeans-11.1\\netbeans\\profiler;C:\\Program Files\\NetBeans-11.1\\netbeans\\python;C:\\Program Files\\NetBeans-11.1\\netbeans\\php;C:\\Program Files\\NetBeans-11.1\\netbeans\\identity;C:\\Program Files\\NetBeans-11.1\\netbeans\\harness;C:\\Program Files\\NetBeans-11.1\\netbeans\\cnd;C:\\Program Files\\NetBeans-11.1\\netbeans\\cndext;C:\\Program Files\\NetBeans-11.1\\netbeans\\dlight;C:\\Program Files\\NetBeans-11.1\\netbeans\\groovy;C:\\Program Files\\NetBeans-11.1\\netbeans\\extra;C:\\Program Files\\NetBeans-11.1\\netbeans\\javacard;C:\\Program Files\\NetBeans-11.1\\netbeans\\javafx exit \r\njava_command: <unknown>\r\njava_class_path (initial): C:\\Program Files\\NetBeans-11.1\\netbeans\\platform\\lib\\boot.jar;C:\\Program Files\\NetBeans-11.1\\netbeans\\platform\\lib\\org-openide-modules.jar;C:\\Program Files\\NetBeans-11.1\\netbeans\\platform\\lib\\org-openide-util-lookup.jar;C:\\Program Files\\NetBeans-11.1\\netbeans\\platform\\lib\\org-openide-util-ui.jar;C:\\Program Files\\NetBeans-11.1\\netbeans\\platform\\lib\\org-openide-util.jar\r\nLauncher Type: generic\r\n\r\n[Global flags]\r\n     intx CICompilerCount                          = 3                                         {product} {ergonomic}\r\n     uint ConcGCThreads                            = 1                                         {product} {ergonomic}\r\n     uint G1ConcRefinementThreads                  = 4                                         {product} {ergonomic}\r\n   size_t G1HeapRegionSize                         = 1048576                                   {product} {ergonomic}\r\n    uintx GCDrainStackTargetSize                   = 64                                        {product} {ergonomic}\r\n     bool HeapDumpOnOutOfMemoryError               = true                                   {manageable} {command line}\r\n    ccstr HeapDumpPath                             = C:\\Users\\DANIEL\\AppData\\Roaming\\NetBeans\\11.1\\var\\log\\heapdump.hprof         {manageable} {command line}\r\n     bool IgnoreUnrecognizedVMOptions              = true                                      {product} {command line}\r\n   size_t InitialHeapSize                          = 268435456                                 {product} {ergonomic}\r\n   size_t MarkStackSize                            = 4194304                                   {product} {ergonomic}\r\n   size_t MaxHeapSize                              = 4265607168                                {product} {ergonomic}\r\n   size_t MaxNewSize                               = 2558525440                                {product} {ergonomic}\r\n   size_t MinHeapDeltaBytes                        = 1048576                                   {product} {ergonomic}\r\n    uintx NonNMethodCodeHeapSize                   = 5830732                                {pd product} {ergonomic}\r\n    uintx NonProfiledCodeHeapSize                  = 122913754                              {pd product} {ergonomic}\r\n    uintx ProfiledCodeHeapSize                     = 122913754                              {pd product} {ergonomic}\r\n    uintx ReservedCodeCacheSize                    = 251658240                              {pd product} {ergonomic}\r\n     bool SegmentedCodeCache                       = true                                      {product} {ergonomic}\r\n     intx ThreadStackSize                          = 2048                                   {pd product} {command line}\r\n     bool UseCompressedClassPointers               = true                                 {lp64_product} {ergonomic}\r\n     bool UseCompressedOops                        = true                                 {lp64_product} {ergonomic}\r\n     bool UseG1GC                                  = true                                      {product} {ergonomic}\r\n     bool UseLargePagesIndividualAllocation        = false                                  {pd product} {ergonomic}\r\n     bool UseStringDeduplication                   = true                                      {product} {command line}\r\n\r\nLogging:\r\nLog output configuration:\r\n #0: stdout all=warning uptime,level,tags\r\n #1: stderr all=off uptime,level,tags\r\n\r\nEnvironment Variables:\r\nJAVA_HOME=C:\\Program Files\\Java\\jdk-12.0.2\r\nPATH=C:\\Program Files\\AdoptOpenJDK\\jdk-11.0.3.7-hotspot\\bin;C:\\ProgramData\\Oracle\\Java\\javapath;C:\\Program Files (x86)\\Common Files\\Intel\\Shared Files\\cpp\\bin\\Intel64;C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\Program Files\\Microsoft SQL Server\\120\\DTS\\Binn\\;C:\\Program Files\\Microsoft SQL Server\\Client SDK\\ODBC\\110\\Tools\\Binn\\;C:\\Program Files (x86)\\Microsoft SQL Server\\120\\Tools\\Binn\\;C:\\Program Files\\Microsoft SQL Server\\120\\Tools\\Binn\\;C:\\Program Files (x86)\\Microsoft SQL Server\\120\\Tools\\Binn\\ManagementStudio\\;C:\\Program Files (x86)\\Microsoft SQL Server\\120\\DTS\\Binn\\;C:\\Program Files\\dotnet\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\Users\\DANIEL\\AppData\\Local\\Programs\\Python\\Python37\\Scripts\\;C:\\Users\\DANIEL\\AppData\\Local\\Programs\\Python\\Python37\\;C:\\Users\\DANIEL\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\DANIEL\\AppData\\Local\\Programs\\Microsoft VS Code\\bin;C:\\Program Files\\JetBrains\\IntelliJ IDEA Community Edition 2019.1.2\\bin;C:\\Program Files\\JetBrains\\PyCharm Community Edition 2019.1.1\\bin;C:\\Users\\DANIEL\\.dotnet\\tools;C:\\Users\\DANIEL\\AppData\\Local\\Microsoft\\WindowsApps;C:\\xampp\\php;C:\\Program Files\\JetBrains\\IntelliJ IDEA Community Edition 2019.1.2\\bin;\r\nUSERNAME=DANIEL\r\nOS=Windows_NT\r\nPROCESSOR_IDENTIFIER=Intel64 Family 6 Model 142 Stepping 9, GenuineIntel\r\n\r\n\r\n\r\n---------------  S Y S T E M  ---------------\r\n\r\nOS: Windows 10 , 64 bit Build 18362 (10.0.18362.86)\r\n\r\nCPU:total 4 (initial active 4) (2 cores per cpu, 2 threads per core) family 6 model 142 stepping 9, cmov, cx8, fxsr, mmx, sse, sse2, sse3, ssse3, sse4.1, sse4.2, popcnt, avx, avx2, aes, clmul, erms, 3dnowpref, lzcnt, ht, tsc, tscinvbit, bmi1, bmi2, adx, fma\r\n\r\nMemory: 4k page, system-wide physical 16269M (9925M free)\r\nTotalPageFile size 23269M (AvailPageFile size 15851M)\r\ncurrent process WorkingSet (physical memory assigned to process): 78M, peak: 78M\r\ncurrent process commit charge (\"private bytes\"): 350M, peak: 350M\r\n\r\nvm_info: Java HotSpot(TM) 64-Bit Server VM (12.0.2+10) for windows-amd64 JRE (12.0.2+10), built on Jul 16 2019 01:56:17 by \"mach5one\" with MS VC++ 15.5 (VS2017)\r\nEND.\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/5703", "user": "danvixent", "labels": ["type/bug"], "created": "2019-11-19 22:41:36", "closed": "2019-11-21 03:01:50", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Geo replicator has ProducerBusyException", "body": "**Describe the bug**\r\nWe  replicate messages from Cluster A to Cluster B. The replicator failed when has exception.\r\n\r\n[2019-11-19 18:00:13]10.1.2.79\r\ncontent: 18:00:12.456 [pulsar-io-22-4] WARN org.apache.pulsar.broker.service.AbstractReplicator - [non-persistent://pxx/xx/ttt][pulsar-a -> pulsar-b] Failed to create remote producer (org.apache.pulsar.client.api.PulsarClientException$ProducerBusyException: Producer with name 'pulsar.repl.pulsar-a' is already connected to topic), retrying in 57.992 s\r\n\r\n\r\nwe use 2.4.1 .\r\n", "url": "https://github.com/apache/pulsar/issues/5698", "user": "weishuisheng", "labels": ["release/2.4.3", "type/bug"], "created": "2019-11-19 10:26:06", "closed": "2019-11-21 02:43:40", "commits": {"39f37c96bc2446440c66f35f197533f3eaa4a0cf": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "39f37c96bc2446440c66f35f197533f3eaa4a0cf", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["2de6a0fa7f672682b4e8584b4739e1e6f6f07f1a"], "nameRev": "39f37c96bc2446440c66f35f197533f3eaa4a0cf tags/v2.5.0-candidate-1~61", "commitMessage": "[issues 5698]Handle replicator producer as generated name producer (#5701)\n\nFixes #5698\r\n\r\nMotivation\r\nSince #5571 handle the generated producer name, the replicator producer was created by broker, only one producer for a replicated topic.\r\n\r\nSo, we can handle it simple by considered replicator producer as generated name producer.", "commitDateTime": "2019-11-21 10:43:39", "authoredDateTime": "2019-11-21 10:43:39", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java", "insertions": 8, "deletions": 3, "lines": 11}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentTopicTest.java", "insertions": 27, "deletions": 3, "lines": 30}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AbstractTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic.isUserProvidedProducerName(org.apache.pulsar.broker.service.Producer)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic.tryOverwriteOldProducer(org.apache.pulsar.broker.service.Producer,org.apache.pulsar.broker.service.Producer)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicTest.testUbsubscribeRaceConditions()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicTest.testDeleteTopicRaceConditions()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicTest.testProducerOverwrite()", "TOT": 13, "UPD": 0, "INS": 13, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Go: Segfault on messageId serialize after getting it from producer", "body": "**Describe the bug**\r\nLooks like the following Go code (also happens with async):\r\n```\r\nid, err := producer.SendAndGetMsgID(context.Background(), msg)\r\nif err != nil { log.Fatal(err) }\r\n\r\nfmt.Printf(\"the %s successfully published with id %v\\n\", string(msg.Payload), id.Serialize())\r\n```\r\ncauses the following:\r\n```\r\nfatal error: unexpected signal during runtime execution\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x49a2965]\r\n\r\nruntime stack:\r\nruntime.throw(0x44a9483, 0x2a)\r\n    /usr/local/Cellar/go/1.13.3/libexec/src/runtime/panic.go:774 +0x72\r\nruntime.sigpanic()\r\n    /usr/local/Cellar/go/1.13.3/libexec/src/runtime/signal_unix.go:378 +0x47c\r\n\r\ngoroutine 8 [syscall]:\r\nruntime.cgocall(0x43c0490, 0xc0000cfc28, 0x0)\r\n    /usr/local/Cellar/go/1.13.3/libexec/src/runtime/cgocall.go:128 +0x5b fp=0xc0000cfbf8 sp=0xc0000cfbc0 pc=0x400494b\r\ngithub.com/apache/pulsar/pulsar-client-go/pulsar._Cfunc_pulsar_message_id_serialize(0x700b7f0, 0xc00018a010, 0x0)\r\n    _cgo_gotypes.go:1265 +0x4e fp=0xc0000cfc28 sp=0xc0000cfbf8 pc=0x43a2eae\r\ngithub.com/apache/pulsar/pulsar-client-go/pulsar.(*messageID).Serialize.func1(0xc0000100a8, 0xc00018a010, 0x4528cc0)\r\n    /Users/me/go/pkg/mod/github.com/apache/pulsar/pulsar-client-go@v0.0.0-20191115070645-69cd6eb660af/pulsar/c_message.go:187 +0x68 fp=0xc0000cfc68 sp=0xc0000cfc28 pc=0x43b2378\r\ngithub.com/apache/pulsar/pulsar-client-go/pulsar.(*messageID).Serialize(0xc0000100a8, 0x0, 0x0, 0x0)\r\n    /Users/me/go/pkg/mod/github.com/apache/pulsar/pulsar-client-go@v0.0.0-20191115070645-69cd6eb660af/pulsar/c_message.go:187 +0x63 fp=0xc0000cfce8 sp=0xc0000cfc68 pc=0x43a9ff3\r\nmain.produceData(0x45352a0, 0xc000013420, 0x449b5fb, 0xa)\r\n    /Users/me/project/test/main.go:146 +0x40c fp=0xc0000cffc0 sp=0xc0000cfce8 pc=0x43be50c\r\nruntime.goexit()\r\n    /usr/local/Cellar/go/1.13.3/libexec/src/runtime/asm_amd64.s:1357 +0x1 fp=0xc0000cffc8 sp=0xc0000cffc0 pc=0x405caa1\r\ncreated by main.main\r\n    /Users/me/project/test/main.go:177 +0x269\r\n```\r\nNote: `id` is not null, it's a `*pulsar.messageId` pointer.\r\n\r\n**Desktop:**\r\nMac OS 10.14.6\r\ngithub.com/apache/pulsar/pulsar-client-go v0.0.0-20191115070645-69cd6eb660af\r\n\r\nThank you :) ", "url": "https://github.com/apache/pulsar/issues/5695", "user": "lspgn", "labels": ["component/go", "triage/week-46", "type/bug"], "created": "2019-11-19 06:11:08", "closed": "2019-12-25 04:16:04", "commits": {}, "ttf": 35.000277777777775, "commitsDetails": []}, {"title": "Elasticsearch 5.x Sink connector incompatible", "body": "**Describe the bug**\r\nWorks with ES 7.x version\r\nFails with ES 5.x version\r\n\r\nDidn't try other versions.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Configure and run ES Sink\r\n2. See error\r\n\r\n{\"error\":{\"root_cause\":[{\"type\":\"invalid_type_name_exception\",\"reason\":\"Document mapping type name can't start with '_', found: [_doc]\"}],\"type\":\"invalid_type_name_exception\",\"reason\":\"Document mapping type name can't start with '_', found: [_doc]\"},\"status\":400}\r\n                at org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:705) ~[?:?]\r\n                at org.elasticsearch.client.RestClient.performRequest(RestClient.java:235) ~[?:?]\r\n                at org.elasticsearch.client.RestClient.performRequest(RestClient.java:198) ~[?:?]\r\n                at org.elasticsearch.client.RestHighLevelClient.performRequest(RestHighLevelClient.java:522) ~[?:?]\r\n                at org.elasticsearch.client.RestHighLevelClient.performRequestAndParseEntity(RestHighLevelClient.java:508) ~[?:?]\r\n                at org.elasticsearch.client.RestHighLevelClient.index(RestHighLevelClient.java:348) ~[?:?]\r\n                at org.apache.pulsar.io.elasticsearch.ElasticSearchSink.write(ElasticSearchSink.java:91) ~[?:?]\r\n                at org.apache.pulsar.functions.instance.JavaInstanceRunnable.sendOutputMessage(JavaInstanceRunnable.java:435) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\r\n                at org.apache.pulsar.functions.instance.JavaInstanceRunnable.processResult(JavaInstanceRunnable.java:418) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\r\n                at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:272) [org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\r\n                at java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n        Caused by: org.elasticsearch.client.ResponseException: method [POST], host [http://135.91.35.218:9200], URI [/eventslist/_doc?timeout=1m], status line [HTTP/1.1 400 Bad Request]\r\n{\"error\":{\"root_cause\":[{\"type\":\"invalid_type_name_exception\",\"reason\":\"Document mapping type name can't start with '_', found: [_doc]\"}],\"type\":\"invalid_type_name_exception\",\"reason\":\"Document mapping type name can't start with '_', found: [_doc]\"},\"status\":400}\r\n\r\n\r\n**Expected behavior**\r\n\r\n**Screenshots**\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 16\r\n\r\n**Additional context**\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5690", "user": "jm7647", "labels": ["component/io", "help wanted", "triage/week-46", "type/bug"], "created": "2019-11-18 22:22:21", "closed": "2020-01-23 08:30:25", "commits": {"e23c6a8b2657d0db611c9c2bfd715a79aeb734b9": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 65.00027777777778, "commitsDetails": [{"commitHash": "e23c6a8b2657d0db611c9c2bfd715a79aeb734b9", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["138f662e23801033ec5228f27703e9b9c159552b"], "nameRev": "e23c6a8b2657d0db611c9c2bfd715a79aeb734b9 tags/v2.6.0-candidate-1~593", "commitMessage": "[Issue 5690][pulsar-io] Make type name of Elasticsearch sink connector configurable. (#6028)\n\nFixes https://github.com/apache/pulsar/issues/5690\r\n\r\n### Motivation\r\n\r\nThe default type name cannot be compatible with Elasticsearch versions both before 6.2 and after 7.0, so this change makes it configurable.\r\n\r\n### Modifications\r\n\r\nMake type name configurable, and set the default value to \"_doc\" to make it compatible with Elasticsearch versions after 6.2 by default.\r\n\r\n### Verifying this change\r\n\r\nAdded unit tests and local integration tests.", "commitDateTime": "2020-01-23 00:30:24", "authoredDateTime": "2020-01-23 16:30:25", "commitGitStats": [{"filePath": "pulsar-io/elastic-search/src/main/java/org/apache/pulsar/io/elasticsearch/ElasticSearchConfig.java", "insertions": 9, "deletions": 0, "lines": 9}, {"filePath": "pulsar-io/elastic-search/src/main/java/org/apache/pulsar/io/elasticsearch/ElasticSearchSink.java", "insertions": 1, "deletions": 3, "lines": 4}, {"filePath": "pulsar-io/elastic-search/src/test/java/org/apache/pulsar/io/elasticsearch/ElasticSearchConfigTests.java", "insertions": 19, "deletions": 1, "lines": 20}, {"filePath": "pulsar-io/elastic-search/src/test/resources/sinkConfig.yaml", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "site2/docs/io-elasticsearch-sink.md", "insertions": 95, "deletions": 5, "lines": 100}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ElasticSearchConfig.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.elasticsearch.ElasticSearchConfig", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ElasticSearchSink.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.elasticsearch.ElasticSearchSink.write(org.apache.pulsar.functions.api.Record)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.elasticsearch.ElasticSearchSink", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ElasticSearchConfigTests.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.elasticsearch.ElasticSearchConfigTests.defaultValueTest()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.elasticsearch.ElasticSearchConfigTests.loadFromYamlFileTest()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.elasticsearch.ElasticSearchConfigTests.loadFromMapTest()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["e23c6a8b2657d0db611c9c2bfd715a79aeb734b9"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 10, "deletions": 3, "lines": 13, "gitFilesChange": 2}, "spoonStatsSummary": {"TOT": 5, "UPD": 1, "INS": 2, "MOV": 1, "DEL": 1, "spoonFilesChanged": 2, "spoonMethodsChanged": 3}, "statsSkippedReason": "", "changesInPackagesGIT": ["pulsar-io/elastic-search/src/main/java/org/apache/pulsar/io/elasticsearch"], "changesInPackagesSPOON": ["org.apache.pulsar.io.elasticsearch.ElasticSearchSink.write(org.apache.pulsar.functions.api.Record)", "org.apache.pulsar.io.elasticsearch.ElasticSearchConfig", "org.apache.pulsar.io.elasticsearch.ElasticSearchSink"]}, {"title": "[Pulsar dashboard] dashboard docker image installs incorrect version of postgres", "body": "**Describe the bug**\r\nDocker image install postgres 11 instead of 9.6. This results in\r\n```\r\nStarting Pulsar dasboard\r\n+ /pulsar/init-postgres.sh\r\n+ rm -rf '/data/*'\r\n+ chown -R postgres: /data\r\n+ chmod 700 /data\r\n+ sudo -u postgres /usr/lib/postgresql/9.6/bin/initdb /data/\r\nsudo: /usr/lib/postgresql/9.6/bin/initdb: command not found\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Build dashboard docker image from master\r\n1. Run image\r\n\r\n**Expected behavior**\r\nDashboard running\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Docker\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/5688", "user": "frejonb", "labels": ["type/bug"], "created": "2019-11-18 20:09:42", "closed": "2019-11-19 06:15:14", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Failed to enable State API in K8s installation", "body": "**Describe the bug**\r\nCan't enable State API in a minikube-based installation of Pulsar, despite adding the appropriate property `extraServerComponents` to the values-mini.yaml in the bookkeeper.configData section.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Add the following line to values-mini.yaml under the bookkeeper.configData section:\r\n```yaml\r\nextraServerComponents: \"org.apache.bookkeeper.stream.server.StreamStorageLifecycleComponent\"\r\n```\r\n2. Launch pulsar cluster via helm (this is using the helm templates found in this repo):\r\n```\r\nhelm install . --values values-mini.yaml helm -n pulsar\r\n```\r\n3. When the K8s cluster is ready, check the configuration of the bookkeeper nodes and confirm that the `extraServerComponents` property in `conf/bookkeeper.conf` is not defined with the specified value.\r\n\r\n**Expected behavior**\r\nThat following the steps to reproduce the bookkeeper nodes would have this property defined.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 18.04\r\n - Minikube (v1.4.0) deployment\r\n - Pulsar version v2.4.1\r\n\r\n**Additional context**\r\nI believe this issue is due to https://github.com/apache/pulsar/commits/master/docker/pulsar/scripts/apply-config-from-env.py which ignores commented lines, as such to fix this issue, the extraServerComponents property should not be commented but defined with a default empty value. \r\n\r\nThis issue is not limited to the aforementioned property only but to all properties that are commented out, as the setup/procedure to enable such features are not working for K8s deployments.\r\n", "url": "https://github.com/apache/pulsar/issues/5687", "user": "pedro93", "labels": ["help wanted", "triage/week-46", "type/bug"], "created": "2019-11-18 15:53:43", "closed": "2019-12-06 10:07:09", "commits": {"d74c1acb0227939279696704b14e078d4942407f": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 17.00027777777778, "commitsDetails": [{"commitHash": "d74c1acb0227939279696704b14e078d4942407f", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["eec4fa5e2d6df7b7a4b465118ac0227e0608fd79"], "nameRev": "d74c1acb0227939279696704b14e078d4942407f tags/v2.5.0-candidate-1~17", "commitMessage": "[Issue:5687] Add prefix for new keys from Env (#5790)\n\nSigned-off-by: xiaolong.ran <rxl@apache.org>\r\n\r\nFixes #5687 \r\n\r\n### Motivation\r\n\r\nWhen the user wants to add new keys for Env, adding fails if no prefix is added. \r\n\r\nCurrently, add new keys for Env use the script of [apply-config-from-env.py](https://github.com/apache/pulsar/commits/master/docker/pulsar/scripts/apply-config-from-env.py), to ensure that the env set by the user can take effect, add the prefix(**PULSAR_PREFIX_**) for all keys.\r\n\r\n### Modifications\r\n\r\n- Add prefix for new keys from Env\r\n", "commitDateTime": "2019-12-06 18:07:08", "authoredDateTime": "2019-12-06 18:07:08", "commitGitStats": [{"filePath": "deployment/kubernetes/aws/bookkeeper.yaml", "insertions": 7, "deletions": 7, "lines": 14}, {"filePath": "deployment/kubernetes/aws/broker.yaml", "insertions": 7, "deletions": 7, "lines": 14}, {"filePath": "deployment/kubernetes/aws/proxy.yaml", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "deployment/kubernetes/generic/k8s-1-9-and-above/bookie.yaml", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "deployment/kubernetes/generic/k8s-1-9-and-above/broker.yaml", "insertions": 7, "deletions": 7, "lines": 14}, {"filePath": "deployment/kubernetes/generic/k8s-1-9-and-above/proxy.yaml", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "deployment/kubernetes/generic/original/bookie.yaml", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "deployment/kubernetes/generic/original/broker.yaml", "insertions": 7, "deletions": 7, "lines": 14}, {"filePath": "deployment/kubernetes/generic/original/proxy.yaml", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "deployment/kubernetes/google-kubernetes-engine/bookie.yaml", "insertions": 5, "deletions": 5, "lines": 10}, {"filePath": "deployment/kubernetes/google-kubernetes-engine/broker.yaml", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "deployment/kubernetes/google-kubernetes-engine/proxy.yaml", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "deployment/kubernetes/helm/pulsar/values-mini.yaml", "insertions": 10, "deletions": 10, "lines": 20}, {"filePath": "deployment/kubernetes/helm/pulsar/values.yaml", "insertions": 11, "deletions": 11, "lines": 22}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "NPE in RackwareEnsemblePlacementPolicyImpl.", "body": "**Describe the bug**\r\n```\r\njava.lang.NullPointerException: null\r\n\tat org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl.isEnsembleAdheringToPlacementPolicy(RackawareEnsemblePlacementPolicyImpl.java:1261) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl.replaceBookie(RackawareEnsemblePlacementPolicyImpl.java:681) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicy.replaceBookie(RackawareEnsemblePlacementPolicy.java:114) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.BookieWatcherImpl.replaceBookie(BookieWatcherImpl.java:278) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.EnsembleUtils.replaceBookiesInEnsemble(EnsembleUtils.java:71) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.LedgerHandle.lambda$ensembleChangeLoop$2(LedgerHandle.java:1908) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.MetadataUpdateLoop.writeLoop(MetadataUpdateLoop.java:122) [org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.MetadataUpdateLoop.run(MetadataUpdateLoop.java:111) [org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.LedgerHandle.ensembleChangeLoop(LedgerHandle.java:1927) [org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.LedgerHandle.handleBookieFailure(LedgerHandle.java:1876) [org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.PendingAddOp.writeComplete(PendingAddOp.java:360) [org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.proto.BookieClientImpl$1.safeRun(BookieClientImpl.java:280) [org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_171]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_171]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_171]\r\n```\r\n**To Reproduce**\r\nHave no idea to reproduce it.\r\n\r\n**Additional context**\r\nin master branch", "url": "https://github.com/apache/pulsar/issues/5686", "user": "codelipenghui", "labels": ["triage/week-46", "type/bug"], "created": "2019-11-18 15:24:48", "closed": "2019-11-30 06:06:20", "commits": {}, "ttf": 11.000277777777777, "commitsDetails": []}, {"title": "Documentation java client example error", "body": "**Describe the bug**\r\njava client example error\r\nversion:2.4.1\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'http://pulsar.apache.org/docs/en/client-libraries-java/'\r\n2. Scroll down to 'Subscription modes'\r\n\r\ncopy the example code \r\n```\r\nProducer<String> producer = client.newProducer(Schema.STRING)\r\n        .topic(\"my-topic\")\r\n        .enableBatch(false)\r\n        .create();\r\n// 3 messages with \"key-1\", 3 messages with \"key-2\", 2 messages with \"key-3\" and 2 messages with \"key-4\"\r\nproducer.newMessage().key(\"key-1\").value(\"message-1-1\").send();\r\nproducer.newMessage().key(\"key-1\").value(\"message-1-2\").send();\r\nproducer.newMessage().key(\"key-1\").value(\"message-1-3\").send();\r\nproducer.newMessage().key(\"key-2\").value(\"message-2-1\").send();\r\nproducer.newMessage().key(\"key-2\").value(\"message-2-2\").send();\r\nproducer.newMessage().key(\"key-2\").value(\"message-2-3\").send();\r\nproducer.newMessage().key(\"key-3\").value(\"message-3-1\").send();\r\nproducer.newMessage().key(\"key-3\").value(\"message-3-2\").send();\r\nproducer.newMessage().key(\"key-4\").value(\"message-4-1\").send();\r\nproducer.newMessage().key(\"key-4\").value(\"message-4-2\").send();\r\n```\r\n\r\ndisplay Cannot resolve method 'enableBatch(boolean)'.Maybe the methodName is enableBatching.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5681", "user": "huangdx0726", "labels": ["component/cli", "component/documentation", "triage/week-45", "type/bug"], "created": "2019-11-18 10:17:30", "closed": "2019-11-19 07:27:55", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Pulsar Broker restart fail owing to create functions/assignments topic fail", "body": "**Describe the bug**\r\nrestart pulsar broker\uff0cthrows nullponitexception at create functions/assignments topic\r\n\r\nerror log\uff1a\r\n\r\n```\r\n13:46:52.437 [pulsar-ordered-OrderedExecutor-4-0-EventThread] INFO  org.apache.bookkeeper.client.LedgerCreateOp - Ensemble: [xxxx:3181, xxxxx:3181] for ledger: 276\r\n13:46:52.438 [bookkeeper-ml-workers-OrderedExecutor-6-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [public/functions/persistent/coordinate] Created ledger 276\r\n13:46:52.437 [bookkeeper-ml-workers-OrderedExecutor-0-0] ERROR org.apache.pulsar.broker.service.ServerCnx - [/xxxxxxx:28514] Failed to create topic persistent://public/functions/assignments\r\njava.util.concurrent.CompletionException: java.lang.NullPointerException\r\n        at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273) ~[?:1.8.0_161]\r\n        at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:991) ~[?:1.8.0_161]\r\n        at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2124) ~[?:1.8.0_161]\r\n        at org.apache.pulsar.broker.service.persistent.MessageDeduplication.checkStatus(MessageDeduplication.java:178) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.broker.service.persistent.PersistentTopic.checkDeduplicationStatus(PersistentTopic.java:899) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.broker.service.BrokerService$2.lambda$openLedgerComplete$0(BrokerService.java:660) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n        at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:981) ~[?:1.8.0_161]\r\n        at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2124) ~[?:1.8.0_161]\r\n        at org.apache.pulsar.broker.service.BrokerService$2.openLedgerComplete(BrokerService.java:658) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.lambda$asyncOpen$7(ManagedLedgerFactoryImpl.java:328) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:656) ~[?:1.8.0_161]\r\n        at java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:632) ~[?:1.8.0_161]\r\n        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_161]\r\n        at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1962) ~[?:1.8.0_161]\r\n        at org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl$2.initializeComplete(ManagedLedgerFactoryImpl.java:316) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl$3$1.operationComplete(ManagedLedgerImpl.java:467) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$1.operationComplete(ManagedCursorImpl.java:271) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$1.operationComplete(ManagedCursorImpl.java:244) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper.lambda$null$7(MetaStoreImplZookeeper.java:241) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:32) [org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_161]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_161]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_161]\r\nCaused by: java.lang.NullPointerException\r\n        at org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.startReadOperationOnLedger(ManagedLedgerImpl.java:1781) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.mledger.impl.OpReadEntry.create(OpReadEntry.java:52) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncReadEntries(ManagedCursorImpl.java:475) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.broker.service.persistent.MessageDeduplication.replayCursor(MessageDeduplication.java:136) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.broker.service.persistent.MessageDeduplication.recoverSequenceIdsMap(MessageDeduplication.java:124) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.broker.service.persistent.MessageDeduplication.access$800(MessageDeduplication.java:55) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.broker.service.persistent.MessageDeduplication$3.openCursorComplete(MessageDeduplication.java:223) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.asyncOpenCursor(ManagedLedgerImpl.java:711) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.asyncOpenCursor(ManagedLedgerImpl.java:683) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.asyncOpenCursor(ManagedLedgerImpl.java:677) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.broker.service.persistent.MessageDeduplication.lambda$checkStatus$1(MessageDeduplication.java:216) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n        at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:981) ~[?:1.8.0_161]\r\n        ... 23 more\r\n13:46:52.446 [bookkeeper-ml-workers-OrderedExecutor-6-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [public/functions/persistent/coordinate] Recovering from bookkeeper ledger cursor: pulsar.dedup\r\n\r\n```", "url": "https://github.com/apache/pulsar/issues/5669", "user": "laxpio", "labels": ["component/functions", "triage/week-46", "type/bug"], "created": "2019-11-15 07:33:14", "closed": "2019-12-23 12:54:17", "commits": {}, "ttf": 38.000277777777775, "commitsDetails": []}, {"title": "bookie server's log error: Failed to restore rocksdb 000000000000000000/000000000000000001/000000000000000000", "body": "**Describe the bug**\r\ni have a pulsar instance consisting of two clusters, there is a bookie server background log in each cluster that continuously outputs the following error:\r\nFailed to restore rocksdb 000000000000000008/000000000000000001/000000000000000000\r\nNow producer and consumer are stopped, and bookie's heap memory usage reaches 90%.\r\n\r\n\r\n**To Reproduce**\r\n[root@iZbp1h590z6jc4f0ib1fjyZ logs]# pwd\r\n/opt/bookieCluster/logs\r\n[root@iZbp1h590z6jc4f0ib1fjyZ logs]# tail -f pulsar-bookie-iZbp1h590z6jc4f0ib1fjyZ.log\r\n\r\nget error:\r\n11:55:49.583 [io-write-scheduler-OrderedScheduler-1-0] WARN  org.apache.bookkeeper.stream.storage.impl.sc.ZkStorageContainerManager - Failed to start storage container (8)\r\njava.util.concurrent.CompletionException: org.apache.bookkeeper.statelib.api.exceptions.StateStoreException: Failed to restore rocksdb 000000000000000008/000000000000000001/000000000000000000\r\n        at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292) ~[?:1.8.0_221]\r\n        at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308) ~[?:1.8.0_221]\r\n        at java.util.concurrent.CompletableFuture.uniCompose(CompletableFuture.java:943) ~[?:1.8.0_221]\r\n        at java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:926) ~[?:1.8.0_221]\r\n        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_221]\r\n        at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_221]\r\n        at org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$executeIO$16(AbstractStateStoreWithJournal.java:474) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_221]\r\n        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:111) [com.google.guava-guava-21.0.jar:?]\r\n        at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:58) [com.google.guava-guava-21.0.jar:?]\r\n        at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:75) [com.google.guava-guava-21.0.jar:?]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_221]\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_221]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_221]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [?:1.8.0_221]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_221]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_221]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_221]\r\nCaused by: org.apache.bookkeeper.statelib.api.exceptions.StateStoreException: Failed to restore rocksdb 000000000000000008/000000000000000001/000000000000000000\r\n        at org.apache.bookkeeper.statelib.impl.rocksdb.checkpoint.RocksCheckpointer.restore(RocksCheckpointer.java:84) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.loadRocksdbFromCheckpointStore(RocksdbKVStore.java:161) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.init(RocksdbKVStore.java:223) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$initializeLocalStore$5(AbstractStateStoreWithJournal.java:202) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$executeIO$16(AbstractStateStoreWithJournal.java:471) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        ... 12 more\r\nCaused by: java.io.FileNotFoundException: 000000000000000008/000000000000000001/000000000000000000/checkpoints/7723596f-fd11-4342-93a1-69cd30afa9dc/metadata\r\n        at org.apache.bookkeeper.statelib.impl.rocksdb.checkpoint.dlog.DLCheckpointStore.openInputStream(DLCheckpointStore.java:92) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.statelib.impl.rocksdb.checkpoint.RocksCheckpointer.getLatestCheckpoint(RocksCheckpointer.java:117) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.statelib.impl.rocksdb.checkpoint.RocksCheckpointer.restore(RocksCheckpointer.java:52) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.loadRocksdbFromCheckpointStore(RocksdbKVStore.java:161) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.init(RocksdbKVStore.java:223) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$initializeLocalStore$5(AbstractStateStoreWithJournal.java:202) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$executeIO$16(AbstractStateStoreWithJournal.java:471) ~[org.apache.bookkeeper-statelib-4.9.2.jar:4.9.2]\r\n        ... 12 more\r\n\r\n\r\nI want to know what caused the issue.How should I solve it?\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5668", "user": "kaykillyou", "labels": ["triage/week-46", "type/bug"], "created": "2019-11-15 05:41:02", "closed": "2019-12-04 03:55:56", "commits": {}, "ttf": 18.00027777777778, "commitsDetails": []}, {"title": "Python, Go APIs: flush not blocking, send_async leaks memory", "body": "EDIT: INVALID. Please ignore.\r\n\r\n**Describe the bug**\r\n\r\n1. `producer.flush()` does not wait until all messages have been published\r\n2. `producer.send_async()` appears to leak memory\r\n\r\n**To Reproduce**\r\n\r\nThis program reproduces both behaviours.\r\n\r\n```\r\nfrom collections import defaultdict\r\nimport gc\r\nimport os\r\nimport pulsar\r\nimport subprocess\r\nimport time\r\n\r\nNUM_MESSAGES = 500\r\nMESSAGE_SIZE = 1_000_000\r\n\r\nclient = pulsar.Client('pulsar://localhost:6650')\r\n\r\nproducer = client.create_producer('temp', producer_name='fred')\r\n\r\n# Ensure that stdout is flushed on each line\r\nold_print = print\r\ndef print(*a, **b):\r\n    old_print(*a, flush=True, **b)\r\n\r\nsent = 0\r\nbytes = 0\r\nresults = defaultdict(lambda: 0)\r\ndef ack(res, msg):\r\n    global sent, bytes\r\n    sent += 1\r\n    bytes += len(msg.data())\r\n    results[str(res)] += 1\r\n\r\nfor i in range(NUM_MESSAGES):\r\n    data = b\"x\" * MESSAGE_SIZE\r\n    producer.send_async(data, callback=ack)\r\n\r\nprint(\"Flushing...\")\r\nproducer.flush()\r\nprint(\"Flush complete\")\r\nfor i in range(600):\r\n    print(\"Sent: %d messages %d bytes\" % (sent, bytes))\r\n    if sent == NUM_MESSAGES:\r\n        break\r\n    time.sleep(0.1)\r\nelse:\r\n    print(\"Never got all the messages!\")\r\nprint(\"Results: %r\" % dict(results))\r\n\r\ngc.collect()\r\nsubprocess.run([\"ps\",\"-eo\",\"vsz,rss,comm\",\"-q\",str(os.getpid())])\r\nprint(\"Sleeping...\")\r\ntime.sleep(5)\r\nsubprocess.run([\"ps\",\"-eo\",\"vsz,rss,comm\",\"-q\",str(os.getpid())])\r\n\r\nproducer.close()\r\nclient.close()\r\n```\r\n\r\nOutput:\r\n\r\n```\r\nFlushing...\r\nFlush complete\r\nSent: 150 messages 150000000 bytes\r\nSent: 172 messages 172000000 bytes\r\nSent: 180 messages 180000000 bytes\r\nSent: 197 messages 197000000 bytes\r\nSent: 215 messages 215000000 bytes\r\nSent: 226 messages 226000000 bytes\r\nSent: 226 messages 226000000 bytes\r\nSent: 226 messages 226000000 bytes\r\nSent: 226 messages 226000000 bytes\r\nSent: 226 messages 226000000 bytes\r\nSent: 226 messages 226000000 bytes\r\nSent: 226 messages 226000000 bytes\r\nSent: 226 messages 226000000 bytes\r\nSent: 226 messages 226000000 bytes\r\nSent: 228 messages 228000000 bytes\r\nSent: 242 messages 242000000 bytes\r\nSent: 258 messages 258000000 bytes\r\nSent: 268 messages 268000000 bytes\r\nSent: 269 messages 269000000 bytes\r\nSent: 273 messages 273000000 bytes\r\nSent: 279 messages 279000000 bytes\r\nSent: 314 messages 314000000 bytes\r\nSent: 331 messages 331000000 bytes\r\nSent: 331 messages 331000000 bytes\r\nSent: 341 messages 341000000 bytes\r\nSent: 356 messages 356000000 bytes\r\nSent: 367 messages 367000000 bytes\r\nSent: 380 messages 380000000 bytes\r\nSent: 396 messages 396000000 bytes\r\nSent: 426 messages 426000000 bytes\r\nSent: 438 messages 438000000 bytes\r\nSent: 452 messages 452000000 bytes\r\nSent: 470 messages 470000000 bytes\r\nSent: 479 messages 479000000 bytes\r\nSent: 480 messages 480000000 bytes\r\nSent: 500 messages 500000000 bytes\r\nResults: {'Ok': 500}\r\n   VSZ   RSS COMMAND\r\n591436 373396 python3\r\nSleeping...\r\n   VSZ   RSS COMMAND\r\n591436 373396 python3\r\n```\r\n\r\n**Expected behavior**\r\n\r\n1. The [documentation](https://github.com/apache/pulsar/blob/master/pulsar-client-cpp/python/pulsar/__init__.py#L892) for \"flush\" says:\r\n\r\n    > Flush all the messages buffered in the client and wait until all messages have been successfully persisted\r\n\r\n    Therefore I was expecting that by the time `producer.flush()` returns, all 500 messages would have been delivered.  This is clearly not happening.\r\n\r\n2. There appears to be a memory leak: once the callback has been invoked, the message buffer should be freed.\r\n\r\nIncreasing to 1000 messages (still at 1,000,000 bytes each) gives a larger memory footprint:\r\n\r\n```\r\nResults: {'Ok': 1000}\r\n   VSZ   RSS COMMAND\r\n881568 663396 python3\r\nSleeping...\r\n   VSZ   RSS COMMAND\r\n881568 663396 python3\r\n```\r\n\r\nHowever, if you change\r\n\r\n```\r\nproducer.send_async(data, callback=ack)\r\n```\r\n\r\nto\r\n\r\n```\r\nres = producer.send(data)\r\nack(res, data)\r\n```\r\n\r\nand adjust the callback to use `len(msg)` instead of `len(msg.data())`, then the memory leak goes away:\r\n\r\n```\r\nFlushing...\r\nFlush complete\r\nSent: 500 messages 500000000 bytes\r\nResults: {'None': 500}\r\n   VSZ   RSS COMMAND\r\n249544 30484 python3\r\nSleeping...\r\n   VSZ   RSS COMMAND\r\n249544 30484 python3\r\n```\r\n\r\n**Other info**\r\n\r\nFor comparison, here is a non-pulsar, pure python program which allocates callbacks but doesn't leak.\r\n\r\n```\r\nimport gc\r\nimport os\r\nimport subprocess\r\n\r\ncallbacks = []\r\ntotal = 0\r\n\r\ndef make_callback(buf):\r\n    def mycb():\r\n        global total\r\n        total += len(buf)\r\n    callbacks.append(mycb)\r\n\r\nfor i in range(500):\r\n    buf = bytes([i % 256]) * 1_000_000\r\n    make_callback(buf)\r\n\r\nprint(\"Waiting callbacks\")\r\nsubprocess.run([\"ps\",\"-eo\",\"vsz,rss,comm\",\"-q\",str(os.getpid())])\r\n\r\nwhile callbacks:\r\n    cb = callbacks.pop(0)\r\n    cb()\r\nprint(total)\r\nprint(\"After callbacks run and removed\")\r\nsubprocess.run([\"ps\",\"-eo\",\"vsz,rss,comm\",\"-q\",str(os.getpid())])\r\ngc.collect()\r\nprint(\"After gc\")\r\nsubprocess.run([\"ps\",\"-eo\",\"vsz,rss,comm\",\"-q\",str(os.getpid())])\r\n```\r\n\r\nOutput:\r\n\r\n```\r\nWaiting callbacks\r\n   VSZ   RSS COMMAND\r\n521180 500492 python3\r\n500000000\r\nAfter callbacks run and removed\r\n   VSZ   RSS COMMAND\r\n 32160 11472 python3\r\nAfter gc\r\n   VSZ   RSS COMMAND\r\n 32160 11472 python3\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/5664", "user": "candlerb", "labels": ["type/bug"], "created": "2019-11-14 11:00:49", "closed": "2019-11-14 12:51:58", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "typo error", "body": "**Describe the bug**\r\nA typo error of this website of pulsar\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to http://pulsar.apache.org/docs/en/standalone\r\n2. Click on 'Deployment > bare-metal-multi-cluster '\r\n3. Scroll down to 'Provisioning new tenants'\r\n4. See error\r\n```\r\n$ bin/pulsar-admin tenants create test-tentant \\\r\n  --allowed-clusters us-west \\\r\n  --admin-roles test-admin-role\r\n```\r\nthe test-tentant maybe typo test-tenant.  if we can't fix it\uff0cit can run normal .\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5661", "user": "huangdx0726", "labels": ["help wanted", "triage/week-45", "type/bug"], "created": "2019-11-14 07:47:31", "closed": "2019-11-15 07:06:46", "commits": {"69cd6eb660afc421828a525d2c8be677d7eebc6f": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "69cd6eb660afc421828a525d2c8be677d7eebc6f", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["8a7d690b394f2f4eaf6f82fb7727577120314dd7"], "nameRev": "69cd6eb660afc421828a525d2c8be677d7eebc6f tags/v2.5.0-candidate-1~80", "commitMessage": "fix typo error (#5663)\n\nfix typo error of website\r\n \r\nFixes #5661 \r\n\r\n \r\n\r\n### Motivation\r\nfix typo error of website\r\n\r\n### Modifications\r\nchanged test-tentant to test-tenant", "commitDateTime": "2019-11-15 15:06:45", "authoredDateTime": "2019-11-15 15:06:45", "commitGitStats": [{"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/deploy-bare-metal-multi-cluster.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.2.0/deploy-bare-metal-multi-cluster.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.3.1/deploy-bare-metal-multi-cluster.md", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Prometheus in kubernetes need all namespace access control", "body": "**Describe the bug**\r\nPrometheus in kubernetes need all namespace access control, but now access control not enough.\r\n\r\n**Expected behavior**\r\nPrometheus access metrics data success.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5658", "user": "sky-big", "labels": ["type/bug"], "created": "2019-11-14 03:10:50", "closed": "2019-11-21 19:37:01", "commits": {"0565c78069323a348f71e06b82c902eccdc5a558": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 7.000277777777778, "commitsDetails": [{"commitHash": "0565c78069323a348f71e06b82c902eccdc5a558", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f68ee8bf37b1a4b5eb2d314e12444f27f9e3bce9"], "nameRev": "0565c78069323a348f71e06b82c902eccdc5a558 tags/v2.5.0-candidate-1~58", "commitMessage": "fix prometheus need kubernetes all namespace access control bug (#5659)\n\nFixes #5658 \r\n\r\n### Motivation\r\nFix prometheus access control not enough in kubernetes\r\n\r\n### Modifications\r\nAdd service account for pulsar cluster prometheus, service account binding cluster role, cluster role have  access control.", "commitDateTime": "2019-11-21 11:37:00", "authoredDateTime": "2019-11-22 03:37:00", "commitGitStats": [{"filePath": "deployment/kubernetes/aws/monitoring.yaml", "insertions": 42, "deletions": 0, "lines": 42}, {"filePath": "deployment/kubernetes/generic/k8s-1-9-and-above/monitoring.yaml", "insertions": 42, "deletions": 0, "lines": 42}, {"filePath": "deployment/kubernetes/generic/original/monitoring.yaml", "insertions": 42, "deletions": 0, "lines": 42}, {"filePath": "deployment/kubernetes/google-kubernetes-engine/monitoring.yaml", "insertions": 42, "deletions": 0, "lines": 42}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[CLIENT SDK] The KeyShared is only supported in java SDK and not in python", "body": "**Describe the bug**\r\nThere is feature to have KeyShared implementation in apache pulsar. and it works as expected. but there is no equivalent implementation in python. Can you please add ?\r\nCan you also check and guarantee that c++ client also supports it ?\r\n\r\n**To Reproduce**\r\n![image](https://user-images.githubusercontent.com/5524260/68810298-ac719100-0622-11ea-98f9-71ee0e218dea.png)\r\n\r\n\r\n**Expected behavior**\r\nThe KeyShared should be supported in python  and c++\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/5524260/68810298-ac719100-0622-11ea-98f9-71ee0e218dea.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: linux\r\n\r\n**Additional context**\r\nI was not able to use KeyShared in python because of the lack of support.\r\n", "url": "https://github.com/apache/pulsar/issues/5656", "user": "HarishAtGitHub", "labels": ["triage/week-45", "type/bug"], "created": "2019-11-13 22:35:52", "closed": "2019-11-21 07:26:55", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "Python Pypi installation of pulsar-client broken because 2.4.1.post1 doesn't have Linux files", "body": "**Describe the bug**\r\nTrying to install pulsar-client on anything other than MacOS fails, because the 2.4.1.post1 published to Pypi only has MacOS files included. This means installing any package with Pipenv that declares a dependency on pulsar-client will result in strange failures, because Pypi says 2.4.1.post1 is available, but the the matching files for my arch (Linux) don't actually exist in the repo.\r\n\r\nIt is possible to work around this by explicitly installing 2.4.1, but this is not desirable for automatically tracking new versions.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. `Pipenv install pulsar-client` on any non MacOS system\r\n2. Observe installation failure\r\n\r\n**Expected behavior**\r\nSuccessful package installation\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 19.04\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5654", "user": "dtwright", "labels": ["triage/week-45", "type/bug"], "created": "2019-11-13 17:06:30", "closed": "2020-01-14 14:55:10", "commits": {}, "ttf": 61.000277777777775, "commitsDetails": []}, {"title": "Server wedged after deleting and recreating functions", "body": "**Describe the bug**\r\nI managed to get pulsar (standalone 2.4.1) into a wedged state reporting bookkeeper errors after deleting and recreating the same function.\r\n\r\n**To Reproduce**\r\n\r\n```\r\n$ cat womble.yaml\r\ntenant: public\r\nnamespace: default\r\nname: womble\r\npy: /home/ubuntu/func1.py\r\nclassName: func1.FirstFunction\r\ninputs: [my-topic]\r\nuserConfig:\r\n  wibble: bibble\r\n\r\n$ cat func1.py\r\nfrom pulsar import Function\r\n\r\nclass FirstFunction(Function):\r\n    def process(self, item, context):\r\n        log = context.get_logger()\r\n        log.info(\"(v%r) Got %r with properties %r\" % (context.get_function_version(), item, context.get_message_properties()))\r\n\r\n$ apache-pulsar-2.4.1/bin/pulsar-admin functions create --function-config-file /home/ubuntu/womble.yaml\r\n...\r\n$ apache-pulsar-2.4.1/bin/pulsar-admin functions delete --name womble\r\n```\r\n\r\nand repeat.\r\n\r\n**Expected behavior**\r\nObviously, should be able to delete and recreate the function as many times as required.\r\n\r\n**Actual behavior**\r\nI got into a state where pulsar commands are hanging, and timing out after 60 seconds.\r\n\r\ntcpdump for pulsar-admin create is in [this gist](https://gist.github.com/candlerb/e0d926ce3488f762fff91c8f1ddd8a4f).  Shows repeated `org.apache.bookkeeper.mledger.ManagedLedgerException: ManagedCursor not found: public%2Fdefault%2Fwomble`\r\n\r\nWith pulsar-admin delete, tcpdump shows nothing useful - it just times out. However, in the foreground output of the pulsar server itself, I see:\r\n\r\n```\r\n10:43:12.569 [cluster-service-coordinator-timer] ERROR org.apache.pulsar.functions.worker.MembershipManager - Failed to get status of coordinate topic persistent://public/functions/coordinate\r\norg.apache.pulsar.client.admin.PulsarAdminException$TimeoutException: java.util.concurrent.TimeoutException\r\n        at org.apache.pulsar.client.admin.internal.TopicsImpl.getStats(TopicsImpl.java:419) ~[org.apache.pulsar-pulsar-client-admin-original-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.worker.MembershipManager.getCurrentMembership(MembershipManager.java:126) ~[org.apache.pulsar-pulsar-functions-worker-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.worker.MembershipManager.checkFailures(MembershipManager.java:174) ~[org.apache.pulsar-pulsar-functions-worker-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.worker.WorkerService.lambda$start$0(WorkerService.java:191) ~[org.apache.pulsar-pulsar-functions-worker-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.worker.ClusterServiceCoordinator.lambda$start$0(ClusterServiceCoordinator.java:72) ~[org.apache.pulsar-pulsar-functions-worker-2.4.1.jar:2.4.1]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_222]\r\n        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [?:1.8.0_222]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_222]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [?:1.8.0_222]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_222]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_222]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_222]\r\nCaused by: java.util.concurrent.TimeoutException\r\n        at java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1771) ~[?:1.8.0_222]\r\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1915) ~[?:1.8.0_222]\r\n        at org.apache.pulsar.client.admin.internal.TopicsImpl.getStats(TopicsImpl.java:412) ~[org.apache.pulsar-pulsar-client-admin-original-2.4.1.jar:2.4.1]\r\n        ... 11 more\r\n10:43:12.570 [cluster-service-coordinator-timer] ERROR org.apache.pulsar.functions.worker.ClusterServiceCoordinator - Cluster timer task membership-monitor failed with exception.\r\njava.lang.RuntimeException: org.apache.pulsar.client.admin.PulsarAdminException$TimeoutException: java.util.concurrent.TimeoutException\r\n        at org.apache.pulsar.functions.worker.MembershipManager.getCurrentMembership(MembershipManager.java:130) ~[org.apache.pulsar-pulsar-functions-worker-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.worker.MembershipManager.checkFailures(MembershipManager.java:174) ~[org.apache.pulsar-pulsar-functions-worker-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.worker.WorkerService.lambda$start$0(WorkerService.java:191) ~[org.apache.pulsar-pulsar-functions-worker-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.worker.ClusterServiceCoordinator.lambda$start$0(ClusterServiceCoordinator.java:72) ~[org.apache.pulsar-pulsar-functions-worker-2.4.1.jar:2.4.1]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_222]\r\n        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [?:1.8.0_222]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_222]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [?:1.8.0_222]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_222]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_222]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_222]\r\nCaused by: org.apache.pulsar.client.admin.PulsarAdminException$TimeoutException: java.util.concurrent.TimeoutException\r\n        at org.apache.pulsar.client.admin.internal.TopicsImpl.getStats(TopicsImpl.java:419) ~[org.apache.pulsar-pulsar-client-admin-original-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.worker.MembershipManager.getCurrentMembership(MembershipManager.java:126) ~[org.apache.pulsar-pulsar-functions-worker-2.4.1.jar:2.4.1]\r\n        ... 10 more\r\nCaused by: java.util.concurrent.TimeoutException\r\n        at java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1771) ~[?:1.8.0_222]\r\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1915) ~[?:1.8.0_222]\r\n        at org.apache.pulsar.client.admin.internal.TopicsImpl.getStats(TopicsImpl.java:412) ~[org.apache.pulsar-pulsar-client-admin-original-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.worker.MembershipManager.getCurrentMembership(MembershipManager.java:126) ~[org.apache.pulsar-pulsar-functions-worker-2.4.1.jar:2.4.1]\r\n        ... 10 more\r\n```\r\n\r\nNow that the server is in this state, it seems completely wedged.  Even `apache-pulsar-2.4.1/bin/pulsar-admin functions list` times out.  There are some errors reported on pulsar output which may or may not be related: [gist](https://gist.github.com/candlerb/f984bc00c8e8a020a5993b83d2e13293).\r\n\r\n`apache-pulsar-2.4.1/bin/pulsar-admin topics list public/default` also times out.  While it was waiting, I hit ctrl-C on the server, and the backtrace is in this [gist](https://gist.github.com/candlerb/688db64659d5b248e3fa1e0874a2d8dd).\r\n\r\nAfter restarting the server, it seems happy.  I can list topics, successfully create function, delete  function, and repeat.\r\n\r\nSo actually reproducing this again may be harder.  I hope the backtraces contain some useful information about what went wrong.", "url": "https://github.com/apache/pulsar/issues/5652", "user": "candlerb", "labels": ["component/functions", "triage/week-45", "type/bug"], "created": "2019-11-13 10:59:35", "closed": "2019-12-03 03:29:31", "commits": {}, "ttf": 19.00027777777778, "commitsDetails": []}, {"title": "Python consumer does not accept receiver_queue_size=0", "body": "**Describe the bug**\r\nPython client does not accept receiver queue size equal to 0, but according to [documentation](https://pulsar.apache.org/docs/v2.0.1-incubating/cookbooks/message-queue#client-configuration-changes):\r\n> If you\u2019d like to have tight control over message dispatching across consumers, set the consumers\u2019 receiver queue size very low (potentially even to 0 if necessary).\r\nwhile other clients (e.g. C++ and Java clients) accept receiver queue size equal to 0 and work according to documentation.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Run the following Python code:\r\n\r\n```python\r\n#!/usr/bin/env python3\r\nimport sys\r\nimport pulsar\r\n\r\nclient = pulsar.Client('pulsar://localhost:6650')\r\nconsumer = client.subscribe('abcd', subscription_name='xyz',\r\n    consumer_type=pulsar.ConsumerType.Shared,\r\n    receiver_queue_size=0)\r\n\r\nmsg = consumer.receive()\r\nprint(\"Received message: %s\" % msg.data(), flush=True)\r\n\r\nconsumer.acknowledge(msg)\r\nclient.close()\r\n\r\n```\r\n\r\n2. See error\r\n\r\n**Expected behavior**\r\nPython client consumer API (` client.subscribe`) should accept parameter `receiver_queue_size=0` as described in [documentation](https://pulsar.apache.org/docs/v2.0.1-incubating/cookbooks/message-queue#client-configuration-changes) and as function correctly for other clients (C++, Java).\r\n\r\n**Screenshots**\r\n\r\n```console\r\n2019-11-12 15:11:57.331 INFO  Client:88 | Subscribing on Topic :abcd\r\n2019-11-12 15:11:57.331 INFO  ConnectionPool:72 | Created connection for pulsar://localhost:6650\r\n2019-11-12 15:11:57.333 INFO  ClientConnection:324 | [[::1]:51100 -> [::1]:6650] Connected to broker\r\n2019-11-12 15:11:57.398 INFO  HandlerBase:52 | [persistent://public/default/abcd, xyz, 0] Getting connection from pool\r\n2019-11-12 15:11:57.423 INFO  ConnectionPool:72 | Created connection for pulsar://cfc0ca6995fc:6650\r\n2019-11-12 15:11:57.424 INFO  ClientConnection:326 | [[::1]:51101 -> [::1]:6650] Connected to broker through proxy. Logical broker: pulsar://cfc0ca6995fc:6650\r\n2019-11-12 15:11:57.684 INFO  ConsumerImpl:170 | [persistent://public/default/abcd, xyz, 0] Created consumer on broker [[::1]:51101 -> [::1]:6650]\r\n2019-11-12 15:11:57.684 WARN  ConsumerImpl:631 | [persistent://public/default/abcd, xyz, 0] Can't use this function if the queue size is 0\r\nTraceback (most recent call last):\r\n  File \"tst.py\", line 10, in <module>\r\n    msg = consumer.receive()\r\n  File \"/python3.7/site-packages/pulsar/__init__.py\", line 930, in receive\r\n    msg = self._consumer.receive()\r\nException: Pulsar error: InvalidConfiguration\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: macOS Catalina (v: 10.15.1)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5634", "user": "bry00", "labels": ["component/python", "triage/week-45", "type/bug"], "created": "2019-11-12 14:26:55", "closed": "2019-11-21 06:41:39", "commits": {"fa029700d3edbc398356f6b74cad1120649d2494": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 8.000277777777777, "commitsDetails": [{"commitHash": "fa029700d3edbc398356f6b74cad1120649d2494", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["39f37c96bc2446440c66f35f197533f3eaa4a0cf"], "nameRev": "fa029700d3edbc398356f6b74cad1120649d2494 tags/v2.5.0-candidate-1~60", "commitMessage": "Fix consumer of python queue size is zero (#5706)\n\nFixes https://github.com/apache/pulsar/issues/5634\r\n\r\n\r\nMaster Issue: https://github.com/apache/pulsar/issues/5634\r\n\r\n### Motivation\r\n\r\nIn java clients, when we call the `receive`, we will block it until a message arrives. in python clients, when we call the `receive` function, we add a delay parameter of 100ms. when the queue size is 0, the `receive` will have a strict check on the queue size, causing the following exception to be thrown\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"tst.py\", line 10, in <module>\r\n    msg = consumer.receive()\r\n  File \"/python3.7/site-packages/pulsar/__init__.py\", line 930, in receive\r\n    msg = self._consumer.receive()\r\nException: Pulsar error: InvalidConfiguration\r\n```\r\n### Modifications\r\n\r\n* Removing timeout parameter in synchronous `receive`\r\n* Add test for queue size is 0\r\n\r\n### Verifying this change\r\n\r\nAdd Test\r\n", "commitDateTime": "2019-11-20 22:41:38", "authoredDateTime": "2019-11-21 14:41:39", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/pulsar_test.py", "insertions": 17, "deletions": 0, "lines": 17}, {"filePath": "pulsar-client-cpp/python/src/consumer.cc", "insertions": 1, "deletions": 3, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["fa029700d3edbc398356f6b74cad1120649d2494"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 18, "deletions": 3, "lines": 21, "gitFilesChange": 2}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["pulsar-client-cpp/python/src", "pulsar-client-cpp/python/pulsar_test.py"]}, {"title": "Support Avro schema from Debezium source connector", "body": "**Describe the bug**\r\nCurrently the Debezium postgres source produces KeyValueSchema to the topics. Support is required for Avro schema type.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. The connector configuration I used for the debezium source connector is:\r\n\r\n> tenant: \"public\"\r\nnamespace: \"default\"\r\nname: \"debezium-postgres-source\"\r\ntopicName: \"debezium-postgres-topic\"\r\narchive: \"connectors/pulsar-io-debezium-postgres-2.5.0-SNAPSHOT.nar\"\r\nschemaType: \"avro\"\r\nparallelism: 1\r\nconfigs:\r\n      database.hostname: \"localhost\"\r\n      database.port: \"5432\"\r\n      database.user: \"hq_gosecure\"\r\n      database.password: \"postgres\"\r\n      database.dbname: \"hq_gosecure\"\r\n      database.server.name: \"dbserver1\"\r\n      plugin.name: \"wal2json\"\r\n      pulsar.service.url: \"pulsar://127.0.0.1:6650\"\r\n\r\n\r\n2. Start the connector using the command :\r\n`bin/pulsar-admin sources localrun --source-config-file conf/debezium-postgres-source-config.yaml`\r\n3. See error\r\n\r\n**Expected behavior**\r\nThe connector should start producing messages in avro schema. But I'm getting the following error:\r\n`19:15:12.353 [main] INFO  org.apache.pulsar.functions.LocalRunner - RuntimeSpawner quit because of\r\norg.apache.avro.AvroRuntimeException: avro.shaded.com.google.common.util.concurrent.UncheckedExecutionException: org.apache.avro.AvroTypeException: Unknown type: K\r\n\tat org.apache.avro.specific.SpecificData.getSchema(SpecificData.java:227) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.pulsar.client.impl.schema.StructSchema.createAvroSchema(StructSchema.java:136) ~[pulsar-client-original-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.client.impl.schema.StructSchema.parseSchemaInfo(StructSchema.java:149) ~[pulsar-client-original-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.client.impl.schema.AvroSchema.of(AvroSchema.java:90) ~[pulsar-client-original-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(TopicSchema.java:144) ~[pulsar-functions-instance-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(TopicSchema.java:189) ~[pulsar-functions-instance-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(TopicSchema.java:209) ~[pulsar-functions-instance-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.lambda$getSchema$0(TopicSchema.java:65) ~[pulsar-functions-instance-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat java.util.HashMap.computeIfAbsent(HashMap.java:1127) ~[?:1.8.0_201]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.getSchema(TopicSchema.java:65) ~[pulsar-functions-instance-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.sink.PulsarSink.initializeSchema(PulsarSink.java:327) ~[pulsar-functions-instance-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.sink.PulsarSink.open(PulsarSink.java:255) ~[pulsar-functions-instance-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupOutput(JavaInstanceRunnable.java:787) ~[pulsar-functions-instance-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupJavaInstance(JavaInstanceRunnable.java:213) ~[pulsar-functions-instance-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:244) ~[pulsar-functions-instance-2.5.0-SNAPSHOT.jar:2.5.0-SNAPSHOT]\r\n\tat java.lang.Thread.run(Thread.java:748) ~[?:1.8.0_201]\r\nCaused by: avro.shaded.com.google.common.util.concurrent.UncheckedExecutionException: org.apache.avro.AvroTypeException: Unknown type: K\r\n\tat avro.shaded.com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2234) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat avro.shaded.com.google.common.cache.LocalCache.get(LocalCache.java:3965) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat avro.shaded.com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:3969) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat avro.shaded.com.google.common.cache.LocalCache$LocalManualCache.get(LocalCache.java:4829) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.avro.specific.SpecificData.getSchema(SpecificData.java:225) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\t... 15 more\r\nCaused by: org.apache.avro.AvroTypeException: Unknown type: K\r\n\tat org.apache.avro.specific.SpecificData.createSchema(SpecificData.java:292) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.avro.reflect.ReflectData.createSchema(ReflectData.java:646) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.avro.reflect.ReflectData.createFieldSchema(ReflectData.java:740) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.avro.reflect.ReflectData$AllowNull.createFieldSchema(ReflectData.java:81) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.avro.reflect.ReflectData.createSchema(ReflectData.java:604) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.avro.specific.SpecificData$2.load(SpecificData.java:218) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.avro.specific.SpecificData$2.load(SpecificData.java:215) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat avro.shaded.com.google.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3568) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat avro.shaded.com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2350) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat avro.shaded.com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2313) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat avro.shaded.com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2228) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat avro.shaded.com.google.common.cache.LocalCache.get(LocalCache.java:3965) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat avro.shaded.com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:3969) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat avro.shaded.com.google.common.cache.LocalCache$LocalManualCache.get(LocalCache.java:4829) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.avro.specific.SpecificData.getSchema(SpecificData.java:225) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\t... 15 more\r\n`\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 18.04\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5633", "user": "raghavi92", "labels": ["component/documentation", "triage/week-45", "type/bug"], "created": "2019-11-12 13:46:20", "closed": "2020-04-30 13:29:06", "commits": {"e08be96d98c7730a01be296aae38e39020ff485e": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 169.00027777777777, "commitsDetails": [{"commitHash": "e08be96d98c7730a01be296aae38e39020ff485e", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["466b0b89af61a0d9c7aa7e6220c91f366f2d3831"], "nameRev": "e08be96d98c7730a01be296aae38e39020ff485e tags/v2.6.0-candidate-1~240", "commitMessage": "[Pulsar IO][Issue 5633]Support avro schema for debezium connector (#6034)\n\nFixes #5633 \r\n\r\n\r\n### Motivation\r\n\r\nCurrently, some users want to support Avro schema in debezium, so this pr supports this feature.\r\nFor Kafka's Avro schema, it depends on the Avro 1.8 version, but Avro version has just been upgraded to 1.9 in pulsar, so shade is needed to avoid finding `addProp` function\r\n\r\n### Modifications\r\n\r\n* Add a package `kafka-connect-avro-converter-shaded`\r\n* Add class KafkaSchema to converter Kafka's Avro schema to pulsar's schema\r\n\r\n### Verifying this change \r\n\r\nUnit test and integration tests\r\n", "commitDateTime": "2020-04-30 21:29:05", "authoredDateTime": "2020-04-30 21:29:05", "commitGitStats": [{"filePath": "kafka-connect-avro-converter-shaded/pom.xml", "insertions": 128, "deletions": 0, "lines": 128}, {"filePath": "pom.xml", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/StructSchema.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericAvroReader.java", "insertions": 17, "deletions": 1, "lines": 18}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericAvroSchema.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/generic/GenericAvroReaderTest.java", "insertions": 23, "deletions": 1, "lines": 24}, {"filePath": "pulsar-functions/api-java/src/main/java/org/apache/pulsar/functions/api/KVRecord.java", "insertions": 35, "deletions": 0, "lines": 35}, {"filePath": "pulsar-functions/api-java/src/main/java/org/apache/pulsar/functions/api/Record.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/SinkRecord.java", "insertions": 25, "deletions": 0, "lines": 25}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/sink/PulsarSink.java", "insertions": 29, "deletions": 9, "lines": 38}, {"filePath": "pulsar-functions/localrun/src/main/java/org/apache/pulsar/functions/LocalRunner.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-io/kafka-connect-adaptor/pom.xml", "insertions": 16, "deletions": 0, "lines": 16}, {"filePath": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "insertions": 103, "deletions": 6, "lines": 109}, {"filePath": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/schema/KafkaSchemaWrappedSchema.java", "insertions": 69, "deletions": 0, "lines": 69}, {"filePath": "site2/docs/io-debezium-source.md", "insertions": 18, "deletions": 0, "lines": 18}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/containers/ChaosContainer.java", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTest.java", "insertions": 91, "deletions": 65, "lines": 156}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/DebeziumMongoDbSourceTester.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/DebeziumMySqlSourceTester.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/DebeziumPostgreSqlSourceTester.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/SourceTester.java", "insertions": 58, "deletions": 6, "lines": 64}], "commitSpoonAstDiffStats": [{"spoonFilePath": "StructSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.StructSchema", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "GenericAvroReader.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericAvroReader.read(byte[],int,int)", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericAvroReader", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericAvroReader.getOffset()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "GenericAvroSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericAvroSchema", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericAvroSchema.loadReader(org.apache.pulsar.common.protocol.schema.BytesSchemaVersion)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "GenericAvroReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericAvroReaderTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericAvroReaderTest.testOffsetSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericAvroReaderTest.setup()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KVRecord.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.api", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Record.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.api.getSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SinkRecord.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.instance.SinkRecord", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.instance.SinkRecord.getSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarSink.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.sink.PulsarSink.PulsarSinkProcessorBase.getProducer(java.lang.String,java.lang.String,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.functions.sink.PulsarSink.PulsarSinkEffectivelyOnceProcessor.newMessage(org.apache.pulsar.functions.api.Record)", "TOT": 8, "UPD": 0, "INS": 5, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.functions.sink.PulsarSink.PulsarSinkProcessorBase.getProducer(java.lang.String,org.apache.pulsar.client.api.Schema)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.sink.PulsarSink.PulsarSinkProcessorBase.getProducer(java.lang.String,java.lang.String,java.lang.String,org.apache.pulsar.client.api.Schema)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.sink.PulsarSink.PulsarSinkAtMostOnceProcessor.newMessage(org.apache.pulsar.functions.api.Record)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.sink.PulsarSink.write(org.apache.pulsar.functions.api.Record)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "LocalRunner.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.LocalRunner.start(boolean)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "KafkaConnectSource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.kafka.connect.KafkaConnectSource.KafkaSourceRecord", "TOT": 9, "UPD": 1, "INS": 7, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.kafka.connect.KafkaConnectSource", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.kafka.connect.KafkaConnectSource.open(java.util.Map,org.apache.pulsar.io.core.SourceContext)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.kafka.connect.KafkaConnectSource.close()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.kafka.connect.KafkaConnectSource.KafkaSourceRecord.getKeySchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.kafka.connect.KafkaConnectSource.KafkaSourceRecord.getValueSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.kafka.connect.KafkaConnectSource.KafkaSourceRecord.getKeyValueEncodingType()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.kafka.connect.KafkaConnectSource.KafkaSourceRecord.getSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KafkaSchemaWrappedSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.kafka.connect.schema.KafkaSchemaWrappedSchema", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ChaosContainer.java", "spoonMethods": []}, {"spoonFilePath": "PulsarFunctionsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumMySqlSource()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumMySqlConnect()", "TOT": 26, "UPD": 13, "INS": 0, "MOV": 10, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumPostgreSqlConnect()", "TOT": 7, "UPD": 5, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumMongoDbConnect()", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 3, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumMySqlSourceAvro()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.initNamespace(org.apache.pulsar.client.admin.PulsarAdmin)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.getSchema(boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumMongoDbSource()", "TOT": 6, "UPD": 0, "INS": 4, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumMySqlConnect(java.lang.String,boolean)", "TOT": 14, "UPD": 0, "INS": 14, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumPostgreSqlConnect(java.lang.String,boolean)", "TOT": 8, "UPD": 0, "INS": 8, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumMongoDbConnect(java.lang.String,boolean)", "TOT": 9, "UPD": 0, "INS": 9, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumMySqlSourceJson()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testDebeziumPostgreSqlSource()", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "DebeziumMongoDbSourceTester.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.io.DebeziumMongoDbSourceTester", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "DebeziumMySqlSourceTester.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.io.DebeziumMySqlSourceTester", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "DebeziumPostgreSqlSourceTester.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.io.DebeziumPostgreSqlSourceTester", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SourceTester.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester.validateSourceResult(org.apache.pulsar.client.api.Consumer,int,java.lang.String)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester.eventContains(java.lang.String)", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester.validateSourceResult(org.apache.pulsar.client.api.Consumer,int,java.lang.String,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester.validateSourceResultAvro(org.apache.pulsar.client.api.Consumer,int,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester.eventContains(java.lang.String,boolean)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.SourceTester.validateSourceResultJson(org.apache.pulsar.client.api.Consumer,int,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Memory leak of pulsar-function-go library regarding time.NewTimer()", "body": "**Describe the bug**\r\nThere is a memory leak in the pulsar-function-go library.\r\nI reported an issue regarding the package(#5589), but this report is another one.\r\n\r\nIt is related to KillAfterIdleMs configuration value. If I set the value to 0, time.NewTimer() function has occupied more memory indefinitely. Refer to `pprof ` result of that below.\r\n```\r\n# go tool pprof -top http://localhost:6060/debug/pprof/heap\r\nFetching profile over HTTP from http://localhost:6060/debug/pprof/heap\r\nSaved profile in /root/pprof/pprof.simple-worker.alloc_objects.alloc_space.inuse_objects.inuse_space.713.pb.gz\r\nFile: simple-worker\r\nBuild ID: 2a730ff40dbea9318c3ce868f33ecc2e69304de8\r\nType: inuse_space\r\nTime: Nov 12, 2019 at 12:27pm (KST)\r\nShowing nodes accounting for 31.29MB, 100% of 31.29MB total\r\n      flat  flat%   sum%        cum   cum%\r\n      30MB 95.88% 95.88%    31.29MB   100%  time.NewTimer\r\n    1.29MB  4.12%   100%     1.29MB  4.12%  time.startTimer\r\n         0     0%   100%    31.29MB   100%  github.com/apache/pulsar/pulsar-function-go/pf.(*goInstance).startFunction\r\n         0     0%   100%    31.29MB   100%  github.com/apache/pulsar/pulsar-function-go/pf.Start\r\n         0     0%   100%    31.29MB   100%  main.main\r\n         0     0%   100%    31.29MB   100%  runtime.main\r\n         0     0%   100%    31.29MB   100%  time.After\r\n```\r\nIf I set `KillAfterIdleMs` value higher than 0, the memory leak didn't appear.\r\n\r\nIn order to fix this issue, I investigated the source code and I could find the code that caused the problem. Fortunately, It seems has been fixed now. So I will send a pull request for that.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Prepare a pulsar cluster with standalone mode.\r\n2. Prepare a simple pulsar function worker. Refer to the codes below.\r\n```\r\n$ cat simple-worker.go \r\npackage main\r\n\r\nimport (\r\n        \"context\"\r\n        \"fmt\"\r\n        \"net/http\"\r\n        _ \"net/http/pprof\"\r\n\r\n        \"github.com/apache/pulsar/pulsar-function-go/pf\"\r\n)\r\n\r\nfunc main() {\r\n        // go routine for pprof\r\n        go func() {\r\n                fmt.Println(\"%+v\", http.ListenAndServe(\"localhost:6060\", nil))\r\n        }()\r\n\r\n        pf.Start(testFunction)\r\n}\r\n\r\nfunc testFunction(ctx context.Context) {\r\n        fmt.Printf(\"Hello\\n\")\r\n}\r\n```\r\n3. Prepare a conf.yaml file for the function worker.\r\n```\r\n---\r\npulsarServiceURL: \"pulsar://sunkwan-devpc:6650\"\r\ninstanceID: 0\r\nfuncID: \"ed5f48f4-8e76-4d30-8b88-6eea1ff3cbf3\"\r\nfuncVersion: \"12f361a0-67e5-4404-8177-8c328a33e3db\"\r\nmaxBufTuples: 1024\r\nport: 0\r\nclusterName: \"standalone\"\r\nkillAfterIdleMs: 0\r\ntenant: \"public\"\r\nnameSpace: \"default\"\r\nname: \"func-concat\"\r\nclassName: ''\r\n#logTopic: 'persistent://public/default/func-concat-logs'\r\nlogTopic: ''\r\nprocessingGuarantees: 0\r\nsecretsMap: ''\r\nruntime: 0\r\nautoAck: true\r\nparallelism: 3\r\nsubscriptionType: 0\r\ntimeoutMs: 0\r\nsubscriptionName: ''\r\ncleanupSubscription: true\r\nsourceSpecsTopic: \"persistent://public/default/func-concat\"\r\nsourceSchemaType: ''\r\nreceiverQueueSize: 1\r\n#sinkSpecsTopic: \"persistent://public/default/func-concat-output\"\r\n#sinkSpecsTopic: \"\"\r\n#sinkSchemaType: ''\r\n#cpu: 1\r\n#ram: 1073741824\r\n#disk: 10737418240\r\n#maxMessageRetries: 0\r\n#deadLetterTopic: ''\r\n#regexPatternSubscription: false\r\n```\r\n4. Execute the simple pulsar function worker by command line below.\r\n```\r\n./simple-worker --instance-conf-path ./conf.yaml\r\n```\r\n5. Send messages to the input topic consecutively.\r\n6. Check the memory usage and heap status using pprof.\r\n```\r\n# go tool pprof -top http://localhost:6060/debug/pprof/heap\r\nFetching profile over HTTP from http://localhost:6060/debug/pprof/heap\r\nSaved profile in /root/pprof/pprof.simple-worker.alloc_objects.alloc_space.inuse_objects.inuse_space.713.pb.gz\r\nFile: simple-worker\r\nBuild ID: 2a730ff40dbea9318c3ce868f33ecc2e69304de8\r\nType: inuse_space\r\nTime: Nov 12, 2019 at 12:27pm (KST)\r\nShowing nodes accounting for 31.29MB, 100% of 31.29MB total\r\n      flat  flat%   sum%        cum   cum%\r\n      30MB 95.88% 95.88%    31.29MB   100%  time.NewTimer\r\n    1.29MB  4.12%   100%     1.29MB  4.12%  time.startTimer\r\n         0     0%   100%    31.29MB   100%  github.com/apache/pulsar/pulsar-function-go/pf.(*goInstance).startFunction\r\n         0     0%   100%    31.29MB   100%  github.com/apache/pulsar/pulsar-function-go/pf.Start\r\n         0     0%   100%    31.29MB   100%  main.main\r\n         0     0%   100%    31.29MB   100%  runtime.main\r\n         0     0%   100%    31.29MB   100%  time.After\r\n```\r\n\r\n**Expected behavior**\r\n- Memory usage of pulsar worker process shouldn't be grown indefinitely.\r\n\r\n**Screenshots**\r\nN/A\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 18.04\r\n\r\n**Additional context**\r\nN/A\r\n", "url": "https://github.com/apache/pulsar/issues/5626", "user": "Sunkwan-Kwon", "labels": ["component/functions", "triage/week-45", "type/bug"], "created": "2019-11-12 06:22:09", "closed": "2019-12-02 07:09:07", "commits": {"f310ab0db4322de5f91a52560f33eafb531a5764": {"commitGHEventType": "closed", "commitUser": "wolfstudy"}}, "ttf": 20.00027777777778, "commitsDetails": [{"commitHash": "f310ab0db4322de5f91a52560f33eafb531a5764", "commitGHEventType": "closed", "commitUser": "wolfstudy", "commitParents": ["86a6be7a2d5a048e19e9944953dbfae697e77fc1"], "nameRev": "f310ab0db4322de5f91a52560f33eafb531a5764 tags/v2.5.0-candidate-1~26", "commitMessage": "Fixes #5626 (#5627)\n\nIf `killAfterIdleMs` is 0, time.After() function call makes memory leak.\r\nRefer to https://golang.org/pkg/time/#After. According to the document,\r\nthe underlying Timer object is not recovered by the garbage collector if\r\nthe timer is not fired. And It seems that if the duration is 0, it will\r\nnot be released. Therefore, use one Timer object for idle time checking\r\nexplicitly instead of the time.After() function.", "commitDateTime": "2019-12-02 15:09:05", "authoredDateTime": "2019-12-02 16:09:05", "commitGitStats": [{"filePath": "pulsar-function-go/pf/instance.go", "insertions": 8, "deletions": 2, "lines": 10}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Dashboard assets referenced from absolute path fail to load when running behind a proxy", "body": "**Describe the bug**\r\nAfter deploying the dashboard to kubernetes, and configuring the ingress from the chart correctly, the dashboard is referencing assets from an absolute server path instead of the path behind the proxy. \r\n\r\nI am running an nginx ingress controller in front of the dashboard, proxying to the dashboard based on the path `/pulsar`.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Configure the dashboard ingress values like: \r\n```\r\n  ingress:\r\n    enabled: true\r\n    annotations:\r\n      kubernetes.io/ingress.class: nginx\r\n      nginx.ingress.kubernetes.io/rewrite-target: \"/$2\"\r\n    tls: {}\r\n    hostname: \"example.com\" \r\n    path: \"/pulsar(/|$)(.*)\"\r\n    port: 80\r\n```\r\n2. Install the chart via helm, and an ingress controller separately.\r\n3. Visit the root of dashboard application via the ingress controller (`http://example.com/pulsar/`)\r\n4. View assets attempting to load from absolute path, instead of prefixed with `/pulsar`\r\n\r\n**Expected behavior**\r\nAssets will load properly through the ingress controller\r\n\r\n**Screenshots**\r\n<img width=\"1874\" alt=\"Screen Shot 2019-11-11 at 3 50 14 PM\" src=\"https://user-images.githubusercontent.com/2636805/68623842-05162200-049b-11ea-8626-12cc212cba0e.png\">\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: macOS (irrelevant)\r\n\r\n**Additional context**\r\nThis cluster is running in AKS, and the ingress is being deployed via the [nginx-ingress chart](https://github.com/helm/charts/tree/master/stable/nginx-ingress)\r\n\r\nI'm not very familiar with django and python, but after some searching I think this could be configured via a `uwsgi` parameter, but the chart has no such configurations. I also could forward all traffic for the dashboard-related assets (e.g. `/static/`, `/admin`) directly to the pulsar dashboard, but would strongly prefer to be able to run the complete server on the `/pulsar` path.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5623", "user": "trotman23", "labels": ["triage/week-45", "type/bug"], "created": "2019-11-11 21:54:01", "closed": "2020-02-19 23:25:10", "commits": {}, "ttf": 100.00027777777778, "commitsDetails": []}, {"title": "[Docs]The document of python function example is incorrect", "body": "**Describe the bug**\r\nThere was an error in the example of using [python function](http://pulsar.apache.org/docs/en/functions-develop/#example) that causes the following exception to be thrown:\r\n\r\n```\r\n2019-11-11 09:48:43 +0000] [ERROR] log.py: Traceback (most recent call last):\r\n[2019-11-11 09:48:43 +0000] [ERROR] log.py:   File \"/pulsar/instances/python-instance/python_instance_main.py\", line 211, in <module>\r\n[2019-11-11 09:48:43 +0000] [ERROR] log.py: main()\r\n[2019-11-11 09:48:43 +0000] [ERROR] log.py:   File \"/pulsar/instances/python-[instance/python_instance_main.py\", line 192, in main\r\n[2019-11-11 09:48:43 +0000] [ERROR] log.py: pyinstance.run()\r\n[2019-11-11 09:48:43 +0000] [ERROR] log.py:   File \"/pulsar/instances/python-instance/python_instance.py\", line 186, in run\r\n[2019-11-11 09:48:43 +0000] [ERROR] log.py: self.input_serdes[topic] = serde_kclass()\r\n[2019-11-11 09:48:43 +0000] [ERROR] log.py: TypeError\r\n[2019-11-11 09:48:43 +0000] [ERROR] log.py: :\r\n[2019-11-11 09:48:43 +0000] [ERROR] log.py: __init__() takes exactly 2 arguments (1 given)\r\n```\r\n\r\nParameters should not appear in the initialization function of class TweetSerDe, messages should come from the topic and should not be assigned during initialization. the document example is wrong, and the correct example should be:\r\n\r\n```\r\nclass Tweet(object):\r\n    def __init__(self, username, tweet_content):\r\n        self.username = username\r\n        self.tweet_content = tweet_content\r\n\r\n\r\nfrom pulsar import SerDe\r\n\r\nclass TweetSerDe(SerDe):\r\n    def __init__(self):\r\n        pass\r\n\r\n    def serialize(self, input):\r\n        return bytes(\"{0}|{1}\".format(input.username, input.tweet_content))\r\n\r\n    def deserialize(self, input_bytes):\r\n        tweet_components = str(input_bytes).split('|')\r\n        return Tweet(tweet_components[0], tweet_componentsp[1])\r\n```\r\n\r\nReference: https://github.com/apache/pulsar/blob/master/pulsar-functions/python-examples/custom_object_function.py\r\n\r\n\r\n**Expected behavior**\r\nFix document\r\n\r\n\r\n**Additional context**\r\nUse the correct example on the document\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5618", "user": "tuteng", "labels": ["component/documentation", "help wanted", "triage/week-45", "type/bug"], "created": "2019-11-11 13:34:10", "closed": "2019-11-13 00:33:25", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Deprecate `brokerDeleteInactiveTopicsFrequencySeconds` or `brokerServicePurgeInactiveFrequencyInSeconds`", "body": "**Describe the bug**\r\nThere are two similar parameters: `brokerDeleteInactiveTopicsFrequencySeconds` and `brokerServicePurgeInactiveFrequencyInSeconds`. \r\nIn documentation, `brokerDeleteInactiveTopicsFrequencySeconds` is recommended. However, `brokerServicePurgeInactiveFrequencyInSeconds` is implemented in code. \r\n\r\n![image](https://user-images.githubusercontent.com/47805623/68581697-ea03dc00-04b3-11ea-87a3-376178d9701d.png)\r\n\r\n**Additional context**\r\nWe need deprecate one of them, make it consistent in code and documentation.\r\n", "url": "https://github.com/apache/pulsar/issues/5614", "user": "Jennifer88huang", "labels": ["triage/week-45", "type/bug"], "created": "2019-11-11 10:51:33", "closed": "2019-11-28 13:33:56", "commits": {}, "ttf": 17.00027777777778, "commitsDetails": []}, {"title": "[Doc] unlinked pages", "body": "The following pages appear to be completely unlinked, both from other pages and from `website/sidebars.json`\r\n\r\n* developing-load-manager.md\r\n* functions-guarantees.md\r\n* io-cassandra.md\r\n* security-token-admin.md\r\n\r\nio-cassandra.md appears to have been superceded by io-cassandra-sink.md.\r\n\r\nsecurity-token-admin.md appears to have been superceded by security-jwt.md\r\n\r\nfunctions-guarantees.md content is already at the end of functions-overview.md\r\n\r\nSo I think those three files can simply be deleted; but I don't know about developing-load-manager.md.  Maybe it needs a link adding, or else its content needs to be merged somewhere else before deleting it.", "url": "https://github.com/apache/pulsar/issues/5611", "user": "candlerb", "labels": ["triage/week-45", "type/bug"], "created": "2019-11-11 08:32:34", "closed": "2020-01-14 14:52:09", "commits": {}, "ttf": 64.00027777777778, "commitsDetails": []}, {"title": "[Kubernetes] Fix zookeeper yaml prometheus pull metrics port", "body": "Zookeeper expose 8000 for prometheus pull metrics, however kubernetes yaml file is 8080.", "url": "https://github.com/apache/pulsar/issues/5600", "user": "sky-big", "labels": ["help wanted", "triage/week-45", "type/bug"], "created": "2019-11-09 05:44:06", "closed": "2019-11-11 03:13:03", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Memory leak of pulsar-function-go library", "body": "**Describe the bug**\r\nIt seems that there is a memory leak in the `pulsar-function-go` library.\r\n\r\nI implemented a simple pulsar function worker that just write logs using `pulsar-function-go/logutil` for sending logs to log topic. I tried to long-term test by sending request messages consecutively to the input topic to check the feasibility.\r\n\r\nAt the first time, I set `--log-topic` for the function worker, but I faced a `ProducerQueueIsFull` error after a few seconds later.\r\n\r\nAfter that I didn't set `--log-topic` option to find out the reason. From the second test, there was no more `ProducerQueueIsFull` error, but the memory of the pulsar function worker process had grown indefinitely.\r\n\r\nI used `pprof` to pinpoint the root cause of the problem. Please refer to the result below.\r\n```\r\n$ go tool pprof -top http://localhost:6060/debug/pprof/heap\r\nFetching profile over HTTP from http://localhost:6060/debug/pprof/heap\r\nFile: simple-worker\r\nBuild ID: bbb7d25540b7a482661b05e4c0da0a5ba2ef7bae\r\nType: inuse_space\r\nTime: Nov 8, 2019 at 3:44pm (KST)\r\nShowing nodes accounting for 12.51MB, 100% of 12.51MB total\r\n      flat  flat%   sum%        cum   cum%\r\n   12.51MB   100%   100%    12.51MB   100%  github.com/sirupsen/logrus.(*Entry).String\r\n         0     0%   100%    12.51MB   100%  github.com/apache/pulsar/pulsar-function-go/logutil.(*contextHook).Fire\r\n         0     0%   100%        1MB  7.99%  github.com/apache/pulsar/pulsar-function-go/logutil.Error\r\n         0     0%   100%    11.51MB 92.01%  github.com/apache/pulsar/pulsar-function-go/logutil.Infof\r\n         0     0%   100%        1MB  7.99%  github.com/apache/pulsar/pulsar-function-go/pf.(*goInstance).addLogTopicHandler\r\n         0     0%   100%    11.51MB 92.01%  github.com/apache/pulsar/pulsar-function-go/pf.(*goInstance).handlerMsg\r\n         0     0%   100%    12.51MB   100%  github.com/apache/pulsar/pulsar-function-go/pf.(*goInstance).startFunction\r\n         0     0%   100%    12.51MB   100%  github.com/apache/pulsar/pulsar-function-go/pf.Start\r\n         0     0%   100%    11.51MB 92.01%  github.com/apache/pulsar/pulsar-function-go/pf.newFunction.func1\r\n         0     0%   100%    11.51MB 92.01%  github.com/apache/pulsar/pulsar-function-go/pf.pulsarFunction.process\r\n         0     0%   100%    12.51MB   100%  github.com/sirupsen/logrus.(*Entry).Log\r\n         0     0%   100%    11.51MB 92.01%  github.com/sirupsen/logrus.(*Entry).Logf\r\n\r\n...\r\n...\r\n```\r\n\r\nAs you could see, a string object for logging had grown during the test.\r\n\r\nIt seems that `ProducerQueueIsFull` error with `--log-topic` option, and the memory leak without `--log-topic` option is caused by the same reason. So I modified `pulsar-go-function` codes to fix it. Fortunately, It seems has been fixed now. So I will send a pull request for that.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Prepare a pulsar cluster with standalone mode.\r\n2. Prepare a simple pulsar function worker. Refer to the codes below.\r\n```\r\n$ cat simple-worker.go \r\npackage main\r\n\r\nimport (\r\n        \"context\"\r\n        \"fmt\"\r\n        \"net/http\"\r\n        _ \"net/http/pprof\"\r\n\r\n        log \"github.com/apache/pulsar/pulsar-function-go/logutil\"\r\n        \"github.com/apache/pulsar/pulsar-function-go/pf\"\r\n)\r\n\r\nfunc main() {\r\n        // go routine for pprof\r\n        go func() {\r\n                fmt.Println(\"%+v\", http.ListenAndServe(\"localhost:6060\", nil))\r\n        }()\r\n\r\n        pf.Start(testFunction)\r\n}\r\n\r\nfunc testFunction(ctx context.Context) {\r\n        for i := 0; i < 10; i++ {\r\n                log.Infof(\"This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function. This is test of pulsar function.\\n\")\r\n        }\r\n}\r\n```\r\n3. Prepare a conf.yaml file for the function worker.\r\n```\r\n---\r\npulsarServiceURL: \"pulsar://sunkwan-devpc:6650\"\r\ninstanceID: 0\r\nfuncID: \"ed5f48f4-8e76-4d30-8b88-6eea1ff3cbf3\"\r\nfuncVersion: \"12f361a0-67e5-4404-8177-8c328a33e3db\"\r\nmaxBufTuples: 1024\r\nport: 0\r\nclusterName: \"standalone\"\r\nkillAfterIdleMs: 0\r\ntenant: \"public\"\r\nnameSpace: \"default\"\r\nname: \"func-concat\"\r\nclassName: ''\r\n#logTopic: 'persistent://public/default/func-concat-logs'\r\nlogTopic: ''\r\nprocessingGuarantees: 0\r\nsecretsMap: ''\r\nruntime: 0\r\nautoAck: true\r\nparallelism: 3\r\nsubscriptionType: 0\r\ntimeoutMs: 0\r\nsubscriptionName: ''\r\ncleanupSubscription: true\r\nsourceSpecsTopic: \"persistent://public/default/func-concat\"\r\nsourceSchemaType: ''\r\nreceiverQueueSize: 1\r\n#sinkSpecsTopic: \"persistent://public/default/func-concat-output\"\r\n#sinkSpecsTopic: \"\"\r\n#sinkSchemaType: ''\r\n#cpu: 1\r\n#ram: 1073741824\r\n#disk: 10737418240\r\n#maxMessageRetries: 0\r\n#deadLetterTopic: ''\r\n#regexPatternSubscription: false\r\n```\r\n4. Execute the simple pulsar function worker by command line below.\r\n```\r\n./simple-worker --instance-conf-path ./conf.yaml\r\n```\r\n5. Send messages to the input topic consecutively.\r\n6. Check the memory usage and heap status using pprof.\r\n```\r\n$ go tool pprof -top http://localhost:6060/debug/pprof/heap\r\nFetching profile over HTTP from http://localhost:6060/debug/pprof/heap\r\nSaved profile in /root/pprof/pprof.simple-worker.alloc_objects.alloc_space.inuse_objects.inuse_space.120.pb.gz\r\nFile: simple-worker\r\nBuild ID: bbb7d25540b7a482661b05e4c0da0a5ba2ef7bae\r\nType: inuse_space\r\nTime: Nov 8, 2019 at 3:48pm (KST)\r\nShowing nodes accounting for 30080.51kB, 100% of 30080.51kB total\r\n      flat  flat%   sum%        cum   cum%\r\n29211.22kB 97.11% 97.11% 29211.22kB 97.11%  github.com/sirupsen/logrus.(*Entry).String\r\n  869.29kB  2.89%   100% 30080.51kB   100%  github.com/apache/pulsar/pulsar-function-go/logutil.(*contextHook).Fire\r\n         0     0%   100%  1536.21kB  5.11%  github.com/apache/pulsar/pulsar-function-go/logutil.Error\r\n         0     0%   100% 28544.30kB 94.89%  github.com/apache/pulsar/pulsar-function-go/logutil.Infof\r\n         0     0%   100%  1536.21kB  5.11%  github.com/apache/pulsar/pulsar-function-go/pf.(*goInstance).addLogTopicHandler\r\n         0     0%   100% 28544.30kB 94.89%  github.com/apache/pulsar/pulsar-function-go/pf.(*goInstance).handlerMsg\r\n....\r\n\r\n```\r\n\r\n**Expected behavior**\r\n- `ProducerQueueIsFull` error shouldn't be occurred.\r\n- Memory usage of pulsar worker process shouldn't be grown indefinitely.\r\n\r\n**Screenshots**\r\nN/A\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 18.04\r\n\r\n**Additional context**\r\nN/A", "url": "https://github.com/apache/pulsar/issues/5589", "user": "Sunkwan-Kwon", "labels": ["triage/week-44", "type/bug"], "created": "2019-11-08 06:57:34", "closed": "2019-12-03 17:37:40", "commits": {}, "ttf": 25.00027777777778, "commitsDetails": []}, {"title": "java.lang.IllegalArgumentException: ledgerId doesn't match with acked ledgerId", "body": "**Describe the bug**\r\n\r\nBroker throws IllegalArgumentException on write failures.\r\n\r\n```\r\njava.lang.IllegalArgumentException: ledgerId 40 doesn't match with acked ledgerId 39\r\n        at com.google.common.base.Preconditions.checkArgument(Preconditions.java:323) ~[com.google.guava-guava-21.0.jar:?]\r\n        at org.apache.bookkeeper.mledger.impl.OpAddEntry.addComplete(OpAddEntry.java:116) ~[org.apache.pulsar-managed-ledger-original-2.4.1.jar:2.4.1]\r\n        at org.apache.bookkeeper.client.AsyncCallback$AddCallback.addCompleteWithLatency(AsyncCallback.java:91) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.client.PendingAddOp.submitCallback(PendingAddOp.java:390) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.client.LedgerHandle.errorOutPendingAdds(LedgerHandle.java:1772) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.client.LedgerHandle$5.safeRun(LedgerHandle.java:572) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_222]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_222]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_222]\r\n```\r\n\r\n**To Reproduce**\r\n\r\nHas seen this behavior on several stress tests.\r\n\r\n**Expected behavior**\r\n\r\nNo exception throw during stress tests.\r\n\r\n**Additional context**\r\n\r\nThe problem was introduced because we reuse OpAddEntry between two different ledgers. \r\n\r\n1) when a ledger fails to write an entry, the ledger is closed. but we didn't clear `pendingAddEntries` in managed ledger.  (https://github.com/apache/pulsar/blob/master/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/OpAddEntry.java#L228\uff09\r\n2) when a new ledger is opened, the `pendingAddEntries` will be re-sent by setting to the new ledger handle. (https://github.com/apache/pulsar/blob/master/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java#L1299)\r\n\r\nIf the callback of an `OpAddEntry` is triggered after the op is already re-sent to the new ledger, it will check if the ledger id in the callback is same as the ledger id in the `OpAddEntry` is same. If the ledger doesn't match, it will throw IllegalArgumentException (https://github.com/apache/pulsar/blob/master/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/OpAddEntry.java#L179)\r\n\r\nSince we are using recycler for managing OpAddEntry, we should avoid using same ops between different ledger handles.\r\n", "url": "https://github.com/apache/pulsar/issues/5588", "user": "sijie", "labels": ["component/broker", "release/2.5.1", "triage/week-44", "type/bug"], "created": "2019-11-07 13:11:15", "closed": "2020-01-09 06:18:02", "commits": {}, "ttf": 62.000277777777775, "commitsDetails": []}, {"title": "Non-persistent topic's replication has a deadlock", "body": "NonPersistentReplicator disable batching. If there is batch message,producer will acquire one,but release num in message's meta when process ack.\r\n\r\n```\r\n                    // When publishing during replication, we need to set the correct number of message in batch\r\n                    // This is only used in tracking the publish rate stats\r\n                    int numMessages = msg.getMessageBuilder().hasNumMessagesInBatch()\r\n                            ? msg.getMessageBuilder().getNumMessagesInBatch()\r\n                            : 1;\r\n                    ByteBufPair cmd = sendMessage(producerId, sequenceId, numMessages, msgMetadata, encryptedPayload);\r\n                    msgMetadataBuilder.recycle();\r\n                    msgMetadata.recycle();\r\n\r\n                    final OpSendMsg op = OpSendMsg.create(msg, cmd, sequenceId, callback);\r\n                    op.setNumMessagesInBatch(numMessages);\r\n                    op.setBatchSizeByte(encryptedPayload.readableBytes());\r\n                    pendingMessages.put(op);\r\n                    lastSendFuture = callback.getFuture();\r\n\r\n\r\n```\r\nSo the ProducerImpl's semaphore  no longer has any effect,  the ProducerImpl's sendAsync method maybe  blocked in pendingMessages's put method .\r\n\r\nThere may be a deadlock between ackReceived  and sendAsync .\r\n\r\nThe deadlock  is   between  pulsar-io-22-8  and pulsar-io-22-12 in jstack log.\r\n\r\n[broker jstack log](https://github.com/apache/pulsar/files/3818922/broker.txt)\r\n\r\n\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5585", "user": "weishuisheng", "labels": ["component/client", "triage/week-44", "type/bug"], "created": "2019-11-07 10:00:34", "closed": "2019-11-11 05:43:46", "commits": {"f2f801af9c4b16e4142078a556166e16317b2dd3": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "f2f801af9c4b16e4142078a556166e16317b2dd3", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["006f291b69ad49dbe0f682f6fe0d6a865f4c06fe"], "nameRev": "f2f801af9c4b16e4142078a556166e16317b2dd3 tags/v2.5.0-candidate-1~101", "commitMessage": "[Issue 5585][pulsar-client] Fix producer Semaphore release error  (#5587)\n\n### Motivation\r\n\r\nFixes #5585 \r\n\r\nThis PR is try to fix the dead lock issue which mentioned in #5585. The core problem is the semaphore release count calculation in replicate scenario.\r\n\r\nReplicator send a batch message(from the original producer) without batcher, so that the batch message acquire 1 each batch message but release it by number of messages in the batch. This PR will handle the semaphore release in replicate scenario.\r\n\r\n### Modifications\r\n\r\nRelease only one semaphore in replicate scenario.", "commitDateTime": "2019-11-11 13:43:45", "authoredDateTime": "2019-11-11 13:43:45", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/ProducerSemaphoreTest.java", "insertions": 135, "deletions": 0, "lines": 135}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 22, "deletions": 9, "lines": 31}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ProducerSemaphoreTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerSemaphoreTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.processOpSendMsg(org.apache.pulsar.client.impl.ProducerImpl$OpSendMsg)", "TOT": 3, "UPD": 2, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.ackReceived(org.apache.pulsar.client.impl.ClientCnx,long,long,long)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.recoverChecksumError(org.apache.pulsar.client.impl.ClientCnx,long)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.releaseSemaphoreForSendOp(org.apache.pulsar.client.impl.ProducerImpl$OpSendMsg)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.getSemaphore()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.failPendingBatchMessages(org.apache.pulsar.client.api.PulsarClientException)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.failPendingMessages(org.apache.pulsar.client.impl.ClientCnx,org.apache.pulsar.client.api.PulsarClientException)", "TOT": 6, "UPD": 0, "INS": 3, "MOV": 3, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "pulsar dashboard collector encountered error message", "body": "we deployed a cluster on bare metal, and running pulsar dashboard in docker, then we found some exceptions in /var/log/supervisor/collector-error.log, Is there a problem with this exception?\r\n\r\nTraceback (most recent call last):\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/backends/utils.py\", line 64, in execute\r\n    return self.cursor.execute(sql, params)\r\npsycopg2.errors.UniqueViolation: duplicate key value violates unique constraint \"stats_namespace_clusters_namespace_id_cluster_id_2d7f67e8_uniq\"\r\nDETAIL:  Key (namespace_id, cluster_id)=(17, 1) already exists.\r\n\r\n\r\nThe above exception was the direct cause of the following exception:\r\n\r\nTraceback (most recent call last):\r\n  File \"./collector.py\", line 64, in fetch_broker_stats\r\n    _fetch_broker_stats(cluster, broker_url, timestamp)\r\n  File \"./collector.py\", line 104, in _fetch_broker_stats\r\n    namespace.clusters.add(cluster)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/models/fields/related_descriptors.py\", line 934, in add\r\n    self._add_items(self.source_field_name, self.target_field_name, *objs)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/models/fields/related_descriptors.py\", line 1103, in _add_items\r\n    for obj_id in new_ids\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/models/query.py\", line 443, in bulk_create\r\n    ids = self._batched_insert(objs_without_pk, fields, batch_size)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/models/query.py\", line 1096, in _batched_insert\r\n    inserted_id = self._insert(item, fields=fields, using=self.db, return_id=True)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/models/query.py\", line 1079, in _insert\r\n    return query.get_compiler(using=using).execute_sql(return_id)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/models/sql/compiler.py\", line 1112, in execute_sql\r\n    cursor.execute(sql, params)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/backends/utils.py\", line 79, in execute\r\n    return super(CursorDebugWrapper, self).execute(sql, params)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/backends/utils.py\", line 64, in execute\r\n    return self.cursor.execute(sql, params)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/utils.py\", line 94, in __exit__\r\n    six.reraise(dj_exc_type, dj_exc_value, traceback)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/utils/six.py\", line 685, in reraise\r\n    raise value.with_traceback(tb)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/backends/utils.py\", line 64, in execute\r\n    return self.cursor.execute(sql, params)\r\ndjango.db.utils.IntegrityError: duplicate key value violates unique constraint \"stats_namespace_clusters_namespace_id_cluster_id_2d7f67e8_uniq\"\r\nDETAIL:  Key (namespace_id, cluster_id)=(17, 1) already exists.\r\n\r\nTraceback (most recent call last):\r\n  File \"./collector.py\", line 64, in fetch_broker_stats\r\n    _fetch_broker_stats(cluster, broker_url, timestamp)\r\n  File \"./collector.py\", line 336, in _fetch_broker_stats\r\n    timestamp=timestamp)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/models/manager.py\", line 85, in manager_method\r\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/models/query.py\", line 464, in get_or_create\r\n    return self.get(**lookup), False\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/models/query.py\", line 384, in get\r\n    (self.model._meta.object_name, num) \r\nstats.models.MultipleObjectsReturned: get() returned more than one Namespace -- it returned 2!\r\nTraceback (most recent call last):\r\n  File \"./collector.py\", line 64, in fetch_broker_stats\r\n    _fetch_broker_stats(cluster, broker_url, timestamp)\r\n  File \"./collector.py\", line 336, in _fetch_broker_stats\r\n    timestamp=timestamp)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/models/manager.py\", line 85, in manager_method\r\n    return getattr(self.get_queryset(), name)(*args, **kwargs)\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/models/query.py\", line 464, in get_or_create\r\n    return self.get(**lookup), False\r\n  File \"/usr/local/lib/python3.7/site-packages/django/db/models/query.py\", line 384, in get\r\n    (self.model._meta.object_name, num) \r\nstats.models.MultipleObjectsReturned: get() returned more than one Namespace -- it returned 2!\r\nProcess Process-11:\r\nmultiprocessing.pool.RemoteTraceback: \r\n\r\nenvironment: \r\n - OS: centos7.0\r\n - Docker version: 19.03.2\r\n", "url": "https://github.com/apache/pulsar/issues/5582", "user": "ltamber", "labels": ["triage/week-44", "type/bug"], "created": "2019-11-07 08:21:01", "closed": "2019-12-18 04:19:57", "commits": {}, "ttf": 40.000277777777775, "commitsDetails": []}, {"title": "error when using pulsar-client with Kerberos", "body": "**Describe the bug**\r\nI use kerberos in pulsar. And I want use pulsar cli tools, but occuring some error.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n bin/pulsar-client produce -m \"dog\" -n 10 persistent://test-tenant/test-sp/test-topic-partition-0\r\n\r\n**Screenshots**\r\n10:54:34.862 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ProducerStatsRecorderImpl - Starting Pulsar producer perf with config: {\r\n  \"topicName\" : \"persistent://test-tenant/test-sp/test-topic-partition-0\",\r\n  \"producerName\" : null,\r\n  \"sendTimeoutMs\" : 30000,\r\n  \"blockIfQueueFull\" : false,\r\n  \"maxPendingMessages\" : 1000,\r\n  \"maxPendingMessagesAcrossPartitions\" : 50000,\r\n  \"messageRoutingMode\" : \"RoundRobinPartition\",\r\n  \"hashingScheme\" : \"JavaStringHash\",\r\n  \"cryptoFailureAction\" : \"FAIL\",\r\n  \"batchingMaxPublishDelayMicros\" : 1000,\r\n  \"batchingMaxMessages\" : 1000,\r\n  \"batchingEnabled\" : true,\r\n  \"batcherBuilder\" : { },\r\n  \"compressionType\" : \"NONE\",\r\n  \"initialSequenceId\" : null,\r\n  \"autoUpdatePartitions\" : true,\r\n  \"properties\" : { }\r\n}\r\n10:54:34.864 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ProducerStatsRecorderImpl - Pulsar client config: {\r\n  \"serviceUrl\" : \"pulsar://localhost:6650/\",\r\n  \"authPluginClassName\" : null,\r\n  \"authParams\" : null,\r\n  \"operationTimeoutMs\" : 30000,\r\n  \"statsIntervalSeconds\" : 60,\r\n  \"numIoThreads\" : 1,\r\n  \"numListenerThreads\" : 1,\r\n  \"connectionsPerBroker\" : 1,\r\n  \"useTcpNoDelay\" : true,\r\n  \"useTls\" : false,\r\n  \"tlsTrustCertsFilePath\" : \"\",\r\n  \"tlsAllowInsecureConnection\" : false,\r\n  \"tlsHostnameVerificationEnable\" : false,\r\n  \"concurrentLookupRequest\" : 5000,\r\n  \"maxLookupRequest\" : 50000,\r\n  \"maxNumberOfRejectedRequestPerConnection\" : 50,\r\n  \"keepAliveIntervalSeconds\" : 30,\r\n  \"connectionTimeoutMs\" : 10000,\r\n  \"requestTimeoutMs\" : 60000,\r\n  \"defaultBackoffIntervalNanos\" : 100000000,\r\n  \"maxBackoffIntervalNanos\" : 30000000000\r\n}\r\n10:54:34.882 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ConnectionPool - [[id: 0xc7a6a676, L:/10.31.26.18:36758 - R:10.31.26.18/10.31.26.18:6650]] Connected to server\r\n10:54:34.882 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.auth.PulsarSaslClient - Using JAAS/SASL/GSSAPI auth to connect to server Principal broker/hadoop.hakafka.com,\r\n10:54:34.882 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.auth.PulsarSaslClient - \u5373\u5c06\u521b\u5efa\u4e00\u4e2a\u65b0\u7684SaslClient,clientPrincipal=brokerclient/hadoop.hakafka.com@HAKAFKA.COM,servicePrincipal=broker/hadoop.hakafka.com\r\n10:54:34.889 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ProducerImpl - [persistent://test-tenant/test-sp/test-topic-partition-0] [null] Creating producer on cnx [id: 0xc7a6a676, L:/10.31.26.18:36758 - R:10.31.26.18/10.31.26.18:6650]\r\n10:54:34.901 [pulsar-client-io-1-1] WARN  org.apache.pulsar.client.impl.ClientCnx - [id: 0xc7a6a676, L:/10.31.26.18:36758 - R:10.31.26.18/10.31.26.18:6650] Received error from server: org.apache.bookkeeper.mledger.ManagedLedgerException: Attempted to access ledger using the wrong password\r\n10:54:34.902 [pulsar-client-io-1-1] ERROR org.apache.pulsar.client.impl.ProducerImpl - [persistent://test-tenant/test-sp/test-topic-partition-0] [null] Failed to create producer: org.apache.bookkeeper.mledger.ManagedLedgerException: Attempted to access ledger using the wrong password\r\n10:54:34.903 [main] ERROR org.apache.pulsar.client.cli.PulsarClientTool - Error while producing messages\r\n10:54:34.903 [main] ERROR org.apache.pulsar.client.cli.PulsarClientTool - org.apache.bookkeeper.mledger.ManagedLedgerException: Attempted to access ledger using the wrong password\r\norg.apache.pulsar.client.api.PulsarClientException$BrokerPersistenceException: org.apache.bookkeeper.mledger.ManagedLedgerException: Attempted to access ledger using the wrong password\r\n\r\n**Additional context**\r\nclient.conf:\r\nauthPlugin=org.apache.pulsar.client.impl.auth.AuthenticationSasl\r\nauthParams={\"saslJaasClientSectionName\":\"PulsarClient\", \"serverType\":\"broker\"}\r\n\r\npulsar_tools_env.sh:\r\nPULSAR_EXTRA_OPTS=\"${PULSAR_EXTRA_OPTS} ${PULSAR_MEM} ${PULSAR_GC} -Dio.netty.leakDetectionLevel=disabled -Djava.security.auth.login.config=/home/pulsar/krbConfig/jaasFiles/pulsar_jaas.conf -Djava.security.krb5.conf=/home/pulsar/krbConfig/krb5.conf\"\r\n\r\npulsar_jaas.conf:\r\n PulsarBroker {\r\n   com.sun.security.auth.module.Krb5LoginModule required\r\n   useKeyTab=true\r\n   storeKey=true\r\n   useTicketCache=false\r\n   keyTab=\"/home/pulsar/krbConfig/keytabs/broker.keytab\"\r\n   principal=\"broker/hadoop.hakafka.com@HAKAFKA.COM\";\r\n};\r\n PulsarClient {\r\n   com.sun.security.auth.module.Krb5LoginModule required\r\n   useKeyTab=true\r\n   storeKey=true\r\n   useTicketCache=false\r\n   keyTab=\"/home/pulsar/krbConfig/keytabs/pulsarclient.keytab\"\r\n   principal=\"brokerclient/hadoop.hakafka.com@HAKAFKA.COM\";\r\n};\r\n Client {\r\n   com.sun.security.auth.module.Krb5LoginModule required\r\n   useKeyTab=true\r\n   storeKey=true\r\n   useTicketCache=false\r\n   keyTab=\"/home/pulsar/krbConfig/keytabs/zkClient.keytab\"\r\n   principal=\"zkcli/hadoop.hakafka.com@HAKAFKA.COM\";\r\n};\r\nBookKeeper {\r\n   com.sun.security.auth.module.Krb5LoginModule required\r\n   useKeyTab=true\r\n   storeKey=true\r\n   useTicketCache=false\r\n   keyTab=\"/home/pulsar/krbConfig/keytabs/bkClient.keytab\"\r\n   principal=\"bookkeepercli/hadoop.hakafka.com@HAKAFKA.COM\";\r\n};\r\n", "url": "https://github.com/apache/pulsar/issues/5580", "user": "ChangWinde", "labels": ["triage/week-44", "type/bug"], "created": "2019-11-07 03:07:50", "closed": "2019-12-02 11:38:10", "commits": {}, "ttf": 25.00027777777778, "commitsDetails": []}, {"title": "[broker] Every time PersistentMessageExpiryMonitor runs, it deletes a non-expired message when using TTL", "body": "**Describe the bug**\r\n\r\nI have a topic in a namespace with messageTtl set to 24 hours. The topic has a subscription without a connected consumer. I publish a handful of messages to the topic.  Within 5 minutes the oldest message in the topic is deleted. Every 5 minutes after that, one more message gets deleted from the topic even though none have expired yet.\r\n\r\nI configured the expiry monitor to run every minute. I published 4 messages into the topic. You can see from these logs, that every minute it is expiring one message:\r\n\r\n```21:55:39.997 [pulsar-msg-expiry-monitor-25-1] INFO  org.apache.pulsar.broker.service.persistent.PersistentMessageExpiryMonitor - [persistent://support-kafkaesque-io/local-useast2-aws/tc1-messages][tc2-consume] Starting message expiry check, ttl= 172800 seconds\r\n21:55:40.017 [bookkeeper-ml-workers-OrderedExecutor-6-0] INFO  org.apache.pulsar.broker.service.persistent.PersistentMessageExpiryMonitor - [persistent://support-kafkaesque-io/local-useast2-aws/tc1-messages][tc2-consume] Expiring all messages until position 292:15\r\n21:56:39.995 [pulsar-msg-expiry-monitor-25-1] INFO  org.apache.pulsar.broker.service.persistent.PersistentMessageExpiryMonitor - [persistent://support-kafkaesque-io/local-useast2-aws/tc1-messages][tc2-consume] Starting message expiry check, ttl= 172800 seconds\r\n21:56:39.999 [bookkeeper-ml-workers-OrderedExecutor-6-0] INFO  org.apache.pulsar.broker.service.persistent.PersistentMessageExpiryMonitor - [persistent://support-kafkaesque-io/local-useast2-aws/tc1-messages][tc2-consume] Expiring all messages until position 292:16\r\n21:57:39.995 [pulsar-msg-expiry-monitor-25-1] INFO  org.apache.pulsar.broker.service.persistent.PersistentMessageExpiryMonitor - [persistent://support-kafkaesque-io/local-useast2-aws/tc1-messages][tc2-consume] Starting message expiry check, ttl= 172800 seconds\r\n21:57:39.997 [bookkeeper-ml-workers-OrderedExecutor-6-0] INFO  org.apache.pulsar.broker.service.persistent.PersistentMessageExpiryMonitor - [persistent://support-kafkaesque-io/local-useast2-aws/tc1-messages][tc2-consume] Expiring all messages until position 292:17\r\n21:58:39.995 [pulsar-msg-expiry-monitor-25-1] INFO  org.apache.pulsar.broker.service.persistent.PersistentMessageExpiryMonitor - [persistent://support-kafkaesque-io/local-useast2-aws/tc1-messages][tc2-consume] Starting message expiry check, ttl= 172800 seconds\r\n21:58:39.997 [bookkeeper-ml-workers-OrderedExecutor-6-0] INFO  org.apache.pulsar.broker.service.persistent.PersistentMessageExpiryMonitor - [persistent://support-kafkaesque-io/local-useast2-aws/tc1-messages][tc2-consume] Expiring all messages until position 292:18\r\n```\r\n\r\nMy topic that started with 4 messages is now empty. None of these messages have actually expired so none should have been deleted.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\n1. Configure namespace with a TTL, for example, 24 hours.\r\n2. Create a topic in that namespace and add a subscription. Make sure there are no consumers so that messages are in the backlog.\r\n3. Publish messages to the topic. Check that they are all in the backlog.\r\n4. Every time the expiry monitor wakes up (5 minutes by default), it deletes one message from the backlog until they are all gone.\r\n\r\n**Expected behavior**\r\nNone of the messages should be deleted from the backlog until they actually expire.\r\n\r\n**Additional context**\r\nLooking at the PersistentMessageExpiryMonitor class, it searches for expired messages and is expecting that if no expired messages are found, the search returns `null` . However, the search appears to be returning the oldest position in the backlog when none have expired, not `null`. Since a position is returned, the code expires messages up to that position. \r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5579", "user": "cdbartholomew", "labels": ["component/broker", "help wanted", "triage/week-44", "type/bug"], "created": "2019-11-06 22:14:29", "closed": "2020-02-07 05:31:44", "commits": {"54b39e64f361a2ed5242259e04505bcfc66c1c8a": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "a49737dcc76caf1cbf105f15c723b05859127a9a": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 92.00027777777778, "commitsDetails": [{"commitHash": "54b39e64f361a2ed5242259e04505bcfc66c1c8a", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["125a5887e6ed79831a0602d7638928fd42b65b2a"], "nameRev": "54b39e64f361a2ed5242259e04505bcfc66c1c8a tags/v2.6.0-candidate-1~543", "commitMessage": "Fix bug that backlog message that has not yet expired could be deleted due to TTL (#6211)\n\nFixes #5579 \r\n\r\n### Motivation\r\n\r\nIn Pulsar 2.4.1 and later versions, if message TTL is enabled, `PersistentMessageExpiryMonitor` always deletes one non-expired message every 5 minutes.\r\n\r\nThe cause of this bug is https://github.com/apache/pulsar/pull/4744. `PersistentMessageExpiryMonitor` expects `ManagedCursor#asyncFindNewestMatching()` to pass null as its found position to itself as a callback if no expired messages exist.\r\nhttps://github.com/apache/pulsar/blob/c5ba52983fee994de61984aae7d1757e9b738caf/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentMessageExpiryMonitor.java#L119-L130\r\n\r\nHowever, due to the change in https://github.com/apache/pulsar/pull/4744, if no entry is found that matches the search condition, the callback will be passed `startPosition` instead of null now. For this reason, the earliest backlog message is always deleted by `PersistentMessageExpiryMonitor`.\r\n\r\nThis means that unexpected message loss can occur.\r\n\r\n### Modifications\r\n\r\nRevert the https://github.com/apache/pulsar/pull/4744 changes. The motivation of https://github.com/apache/pulsar/pull/4744 is to avoid NPE caused in pulse-sql, but that seems to be fixed in https://github.com/apache/pulsar/pull/4757.\r\nhttps://github.com/apache/pulsar/blob/2069f761753940ed6a1faca8999af70036f20fd6/pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarSplitManager.java#L363-L382", "commitDateTime": "2020-02-06 21:31:44", "authoredDateTime": "2020-02-07 14:31:44", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/OpFindNewest.java", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedCursorTest.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentMessageFinderTest.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "OpFindNewest.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.OpFindNewest.readEntryComplete(org.apache.bookkeeper.mledger.Entry,java.lang.Object)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ManagedCursorTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedCursorTest.testFindNewestMatching()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedCursorTest.internalTestFindNewestMatchingAllEntries(java.lang.String,int,int)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "PersistentMessageFinderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PersistentMessageFinderTest.testPersistentMessageFinder()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "a49737dcc76caf1cbf105f15c723b05859127a9a", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["9fc05c55c53aa245de060354c2e8d97d5ebb95e9"], "nameRev": "a49737dcc76caf1cbf105f15c723b05859127a9a tags/v2.5.1-candidate-3~84", "commitMessage": "Fix bug that backlog message that has not yet expired could be deleted due to TTL (#6211)\n\nFixes #5579 \r\n\r\n### Motivation\r\n\r\nIn Pulsar 2.4.1 and later versions, if message TTL is enabled, `PersistentMessageExpiryMonitor` always deletes one non-expired message every 5 minutes.\r\n\r\nThe cause of this bug is https://github.com/apache/pulsar/pull/4744. `PersistentMessageExpiryMonitor` expects `ManagedCursor#asyncFindNewestMatching()` to pass null as its found position to itself as a callback if no expired messages exist.\r\nhttps://github.com/apache/pulsar/blob/c5ba52983fee994de61984aae7d1757e9b738caf/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentMessageExpiryMonitor.java#L119-L130\r\n\r\nHowever, due to the change in https://github.com/apache/pulsar/pull/4744, if no entry is found that matches the search condition, the callback will be passed `startPosition` instead of null now. For this reason, the earliest backlog message is always deleted by `PersistentMessageExpiryMonitor`.\r\n\r\nThis means that unexpected message loss can occur.\r\n\r\n### Modifications\r\n\r\nRevert the https://github.com/apache/pulsar/pull/4744 changes. The motivation of https://github.com/apache/pulsar/pull/4744 is to avoid NPE caused in pulse-sql, but that seems to be fixed in https://github.com/apache/pulsar/pull/4757.\r\nhttps://github.com/apache/pulsar/blob/2069f761753940ed6a1faca8999af70036f20fd6/pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarSplitManager.java#L363-L382\n\n(cherry picked from commit 54b39e64f361a2ed5242259e04505bcfc66c1c8a)\n", "commitDateTime": "2020-04-13 11:10:25", "authoredDateTime": "2020-02-07 14:31:44", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/OpFindNewest.java", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedCursorTest.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentMessageFinderTest.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "OpFindNewest.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.OpFindNewest.readEntryComplete(org.apache.bookkeeper.mledger.Entry,java.lang.Object)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ManagedCursorTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedCursorTest.testFindNewestMatching()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedCursorTest.internalTestFindNewestMatchingAllEntries(java.lang.String,int,int)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "PersistentMessageFinderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PersistentMessageFinderTest.testPersistentMessageFinder()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[Java Functions] Use protobuf schema error", "body": "**Describe the bug**\r\n\r\nI am trying to write a Java function using the `protobuf` schema, code as follows:\r\n\r\n```\r\npackage functions;\r\n\r\nimport pb.TestOuterClass;\r\n\r\nimport java.util.function.Function;\r\n\r\npublic class ExampleProtoSchemaFunction implements Function<pb.TestOuterClass.Test, String> {\r\n\r\n    @Override\r\n    public String apply(TestOuterClass.Test test) {\r\n        System.out.println(test.getMsf());\r\n        System.out.println(test.getNum());\r\n        return \"test proto schema of function\";\r\n    }\r\n}\r\n```\r\n\r\nproto definition as follows:\r\n\r\n```\r\nsyntax = \"proto3\";\r\npackage pb;\r\n\r\nmessage Test {\r\n    int32 num = 1;\r\n    string msf = 2;\r\n}\r\n```\r\n\r\nCreate a function with the following command:\r\n\r\n```\r\n./bin/pulsar-admin functions localrun --name protobbuf-schema-function --tenant public --namespace default --inputs input-topic-1  --jar mysql-sink-io-tests-1.0-SNAPSHOT.jar --output output-topic --classname functions.ExampleProtoSchemaFunction\r\n```\r\n\r\nI have encountered the following error:\r\n\r\n```\r\n17:51:00.300 [main] INFO  org.apache.pulsar.functions.LocalRunner - RuntimeSpawner quit because of\r\njava.lang.UnsupportedOperationException: null\r\n\tat java.util.AbstractMap.put(AbstractMap.java:209) ~[?:1.8.0_201]\r\n\tat org.apache.pulsar.client.impl.schema.SchemaDefinitionBuilderImpl.build(SchemaDefinitionBuilderImpl.java:101) ~[pulsar-client-original.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.client.impl.schema.ProtobufSchema.ofGenericClass(ProtobufSchema.java:107) ~[pulsar-client-original.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(TopicSchema.java:154) ~[pulsar-functions-instance.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(TopicSchema.java:178) ~[pulsar-functions-instance.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(TopicSchema.java:210) ~[pulsar-functions-instance.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.lambda$getSchema$0(TopicSchema.java:66) ~[pulsar-functions-instance.jar:2.5.0-SNAPSHOT]\r\n\tat java.util.HashMap.computeIfAbsent(HashMap.java:1127) ~[?:1.8.0_201]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.getSchema(TopicSchema.java:66) ~[pulsar-functions-instance.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.source.PulsarSource.lambda$setupConsumerConfigs$5(PulsarSource.java:165) ~[pulsar-functions-instance.jar:2.5.0-SNAPSHOT]\r\n\tat java.util.TreeMap.forEach(TreeMap.java:1005) ~[?:1.8.0_201]\r\n\tat org.apache.pulsar.functions.source.PulsarSource.setupConsumerConfigs(PulsarSource.java:160) ~[pulsar-functions-instance.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.source.PulsarSource.open(PulsarSource.java:66) ~[pulsar-functions-instance.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupInput(JavaInstanceRunnable.java:733) ~[pulsar-functions-instance.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupJavaInstance(JavaInstanceRunnable.java:215) ~[pulsar-functions-instance.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:244) ~[pulsar-functions-instance.jar:2.5.0-SNAPSHOT]\r\n\tat java.lang.Thread.run(Thread.java:748) ~[?:1.8.0_201]\r\n17:51:29.813 [function-timer-thread-5-1] ERROR org.apache.pulsar.functions.runtime.RuntimeSpawner - public/default/protobbuf-schema-function-java.lang.UnsupportedOperationException Function Container is dead with exception.. restarting\r\n```\r\n\r\n**To Reproduce**\r\n\r\nBuild java function using the code example provided above.\r\n\r\n**Expected behavior**\r\n\r\nJava function was successfully created\r\n\r\n**Screenshots**\r\n\r\n![image](https://user-images.githubusercontent.com/20965307/68204676-81c08080-0003-11ea-875c-008800ffa26a.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Mac OS\r\n - Pulsar: 2.4.1\r\n\r\n**Additional context**\r\n\r\nThrough the error message, we can locate [SchemaDefinitionBuilderImpl#101](https://github.com/apache/pulsar/blob/master/pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java#L101)\r\n\r\nWhen I delete this line of code, this function is created successfully.\r\n", "url": "https://github.com/apache/pulsar/issues/5566", "user": "wolfstudy", "labels": ["type/bug"], "created": "2019-11-05 11:39:14", "closed": "2019-11-06 08:27:23", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Zookeeper znodes not created for partitioned topics if allowAutoTopicCreation=false", "body": "I've come into an issue when allowAutoTopicCreation is set to false and partitioned topic is created, then pulsar will not create znodes for partitions in managed ledgers and then subscriptions fails with error org.apache.pulsar.client.api.PulsarClientException: No value present\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. set allowAutoTopicCreation to false in broker.conf\r\n2. create partitioned topic\r\n3. subscribe to created topic\r\n4. See error\r\n\r\n**Expected behavior**\r\nPulsar should create znodes in managed-ledgers.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 18.04\r\n", "url": "https://github.com/apache/pulsar/issues/5565", "user": "verdaster", "labels": ["component/broker", "triage/week-44", "type/bug"], "created": "2019-11-05 10:01:33", "closed": "2020-01-09 02:40:16", "commits": {}, "ttf": 64.00027777777778, "commitsDetails": []}, {"title": "I can not recevie message and the msgBacklog is 1", "body": "**Describe the bug**\r\nI found some message lost in the pulsar , so I checked the stats of topic and the log of pulsar, and I found An error occurred. Any reason to explain it?\r\n\r\n**Screenshots**\r\nThe screenshots of the stats of topic\r\n![QQ\u622a\u56fe20191105175402](https://user-images.githubusercontent.com/24506890/68197537-62baf200-fff5-11e9-92d0-0e901cd8f9ca.png)\r\n\r\nThe screenshots of pulsar log\r\n![QQ\u622a\u56fe20191105174809](https://user-images.githubusercontent.com/24506890/68197566-71090e00-fff5-11e9-84b2-a5924ab15b76.png)\r\n\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5564", "user": "l786170309", "labels": ["component/broker", "triage/week-44", "type/bug"], "created": "2019-11-05 09:59:04", "closed": "2019-11-15 07:43:31", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "When we use the pulsar-admin.sh script to delete partitioned topic, it will throw the http error, error code is 500", "body": "**Describe the bug**\r\nWhen we use the pulsar-admin.sh script to delete partitioned topic, it will throw the http error, error code is 500.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. when we run the benchmark test, the cluster of bookie has one or more bookie state that is read only;\r\n2. and then we use the script to delete the partitioned topic, ../bin/pulsar-admin topics deleted-partition-topic persistent://tenant/namespace/topic;\r\n3. we receive the http error, error code is 500, we can't delete successfully;\r\n4. we restart all pulsar brokers of cluster,and then run the script to delete, it succeed.\r\n\r\n**Expected behavior**\r\nsucceed to delete the partitioned topic.\r\n\r\n**Screenshots**\r\nwe check the service log. find the error as follow:\r\n```\r\n15:15:29.005 [bookkeeper-ml-workers-OrderedExecutor-7-0] ERROR org.apache.bookkeeper.common.util.SafeRunnable - Unexpected throwable caught\r\njava.lang.IllegalArgumentException: inconsistent range\r\n        at java.util.concurrent.ConcurrentSkipListMap$SubMap.<init>(ConcurrentSkipListMap.java:2620) ~[?:1.8.0_171]\r\n        at java.util.concurrent.ConcurrentSkipListMap.subMap(ConcurrentSkipListMap.java:2078) ~[?:1.8.0_171]\r\n        at org.apache.bookkeeper.mledger.util.RangeCache.removeRange(RangeCache.java:132) ~[org.apache.pulsar-managed-ledger-2.5.0-d9ebec524.jar:2.5.0-d9ebec524]\r\n        at org.apache.bookkeeper.mledger.impl.EntryCacheImpl.invalidateEntries(EntryCacheImpl.java:151) ~[org.apache.pulsar-managed-ledger-2.5.0-d9ebec524.jar:2.5.0-d9ebec524]\r\n        at org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl$7.operationComplete(ManagedLedgerImpl.java:779) ~[org.apache.pulsar-managed-ledger-2.5.0-d9ebec524.jar:2.5.0-d9ebec524]\r\n        at org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl$7.operationComplete(ManagedLedgerImpl.java:767) ~[org.apache.pulsar-managed-ledger-2.5.0-d9ebec524.jar:2.5.0-d9ebec524]\r\n        at org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper.lambda$null$13(MetaStoreImplZookeeper.java:308) ~[org.apache.pulsar-managed-ledger-2.5.0-d9ebec524.jar:2.5.0-d9ebec524]\r\n        at org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:32) ~[org.apache.pulsar-managed-ledger-2.5.0-d9ebec524.jar:2.5.0-d9ebec524]\r\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_171]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_171]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.43.Final.jar:4.1.43.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_171]\r\n```\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/5558", "user": "yiyi1223", "labels": ["component/broker", "release/2.4.3", "triage/week-44", "type/bug"], "created": "2019-11-04 14:03:30", "closed": "2019-11-12 13:32:43", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "[website] Lack of a coding-guide page on Pulsar website", "body": "**Describe the bug**\r\nJennifer has added a `coding-guide.md` file in https://github.com/apache/pulsar/pull/5494, we need to add a coding-guide.js file to the `/pages/en` folder as well.", "url": "https://github.com/apache/pulsar/issues/5553", "user": "Jennifer88huang", "labels": ["component/website", "triage/week-44", "type/bug"], "created": "2019-11-04 09:14:49", "closed": "2019-11-11 03:04:01", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "C++ API: insufficient digits in reader temporary subscriptions", "body": "**Describe the bug**\r\nIn C++/python API, only [6 hex digits of ID](https://github.com/apache/pulsar/blob/master/pulsar-client-cpp/lib/ClientImpl.cc#L57) are used for the temporary subscription name for a reader.  This means that with 4,000 readers there is a ~40% chance of two readers picking the same subscription name.\r\n\r\nHowever in the Java client API, [10 hex digits of ID](https://github.com/apache/pulsar/blob/master/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ReaderImpl.java#L41) are used.  This would require about 1,000,000 readers before there were a similar chance of a clash. With 64K readers the chance is reduced to 0.2%\r\n\r\n**To Reproduce**\r\nWrite a python or C program which opens a `reader` on a topic and sleeps. Check the assigned reader name using pulsar-admin:\r\n\r\n```\r\n$ apache-pulsar-2.4.1/bin/pulsar-admin topics subscriptions pulsar-log\r\nreader-73bebe\r\n```\r\n\r\n**Expected behavior**\r\nSufficient randomness be included in the subscription name; consistency between Java and C++ clients\r\n\r\n**Screenshots**\r\nN/A\r\n\r\n**Desktop (please complete the following information):**\r\nN/A\r\n\r\n**Additional context**\r\nhttps://en.wikipedia.org/wiki/Birthday_problem\r\n\r\n```\r\n$ bc -l\r\nscale=10\r\nibase=16\r\n1 - e(-(1000^2)/(2*1000000))\r\n=> .3934693403\r\n\r\n1 - e(-(100000^2)/(2*10000000000))\r\n=> .3934693403\r\n\r\n1 - e(-(10000^2)/(2*10000000000))\r\n=> .0019512189\r\n\r\n10000\r\n=> 65536\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/5546", "user": "candlerb", "labels": ["triage/week-44", "type/bug"], "created": "2019-11-03 09:47:52", "closed": "2019-11-05 03:06:42", "commits": {"73861307ba09f51a5e8506ff82e80dd33982f3e3": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "73861307ba09f51a5e8506ff82e80dd33982f3e3", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["7d80ae8d8b09b4ec363cdb2b712a74dff270963d"], "nameRev": "73861307ba09f51a5e8506ff82e80dd33982f3e3 tags/v2.5.0-candidate-1~126", "commitMessage": "cpp/python: increase number of digits in temporary subscription name for readers (#5547)\n\nFixes #5546\r\n\r\n### Motivation\r\n\r\nReduce risk of subscription name clash between readers.  Equivalence with Java client.\r\n\r\n### Modifications\r\n\r\nIncrease number of random hex digits in reader subscription name from 6 to 10.", "commitDateTime": "2019-11-05 11:06:41", "authoredDateTime": "2019-11-05 03:06:41", "commitGitStats": [{"filePath": "pulsar-client-cpp/lib/ClientImpl.cc", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Is this normal\uff1fThe \"msgBacklog\" is \"-2\".", "body": "**Describe the bug**\r\nI use the exclusive consumer to receive messages and ack them, but I found some message lost. So I check the stats of the topic, and I found \"msgBacklog\" is \"-2\". I do not konw how this happened.  Is there any reason to explain it?\r\n\r\n**To Reproduce**\r\nI do not how to reproduce the behavio.\r\n\r\n**Screenshots**\r\n![96661a0accf3c50aa6e7d4a1b4ae31f](https://user-images.githubusercontent.com/24506890/68073691-a6cbae00-fdcd-11e9-9b53-9abcd4e51e44.png)\r\n\r\n\r\n\\", "url": "https://github.com/apache/pulsar/issues/5543", "user": "l786170309", "labels": ["triage/week-44", "type/bug"], "created": "2019-11-02 16:14:58", "closed": "2019-11-05 09:50:07", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "failed to add producer to topic after connection closed", "body": "Client timed out  while trying to send message to brokers, and failed to add producer to topic. Below are related logs.\r\n\r\nconnection closed log: \r\n![WeChatWorkScreenshot_9cd78c74-bd86-4bbd-bafa-1662679f50f7](https://user-images.githubusercontent.com/8382020/68020781-85d66080-fcda-11e9-8787-aed7ad57f9ef.png)\r\n\r\n\r\nclient log:\r\n![\u4f01\u4e1a\u5fae\u4fe1\u622a\u56fe_2065c1f1-3a3c-4703-b437-c6d35e9de62f](https://user-images.githubusercontent.com/8382020/68020689-398b2080-fcda-11e9-9537-6fcec8ba8cf2.png)\r\n![\u4f01\u4e1a\u5fae\u4fe1\u622a\u56fe_008d5a89-4c15-4dc6-ae21-1cd9db278c5b](https://user-images.githubusercontent.com/8382020/68020941-072df300-fcdb-11e9-8b93-7c914d4547ee.png)\r\n\r\n\r\nbroker log:\r\n![\u4f01\u4e1a\u5fae\u4fe1\u622a\u56fe_d3451b70-f576-418f-91e6-bbd1ea6662de](https://user-images.githubusercontent.com/8382020/68020691-3abc4d80-fcda-11e9-943d-c4ad07910dd7.png)\r\n", "url": "https://github.com/apache/pulsar/issues/5535", "user": "disanji", "labels": ["component/broker", "triage/week-44", "type/bug"], "created": "2019-11-01 11:10:49", "closed": "2019-11-19 03:59:20", "commits": {"75c7229bceccc6f70db192d221258cc86ae99f73": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 17.00027777777778, "commitsDetails": [{"commitHash": "75c7229bceccc6f70db192d221258cc86ae99f73", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["8d1f793b543250d44e97f29eb355c27ae900ffb7"], "nameRev": "75c7229bceccc6f70db192d221258cc86ae99f73 tags/v2.5.0-candidate-1~78", "commitMessage": "Add epoch for connection handler to handle create producer timeout. (#5571)\n\nFixes #5535\r\n\r\nMotivation\r\nCurrently, if user create producer timeout, the connection handler of producer will reconnect to the broker later, but if in broker already done the previous create producer request, the reconnection will failed with \"producer with name xxx is already connected\".\r\n\r\nSo this PR will introduce epoch for connection handler and add a field named isGeneratedName for producer to handle above problem.\r\n\r\nThis PR only handle the generated producer name scenario, so many users occur errors such like\r\n#5535, so we need to fix the generated producer name scenario first.\r\n\r\nFor the scenario of user specified producer name, we can discuss later and find a simple approach to handle it, i left my idea here: using producer id and producer name as the identity of producer, producer name used for EO producer and producer id can used by the producer reconnect, but this approach depends on globally unique producer id generator.\r\n\r\nModifications\r\nIf the producer with generated producer name and epoch of the producer is bigger than the exists producer, the new producer will overwrite the old producer, so the reconnect producer will create succeed.\r\n\r\nVerifying this change\r\nAdd unit tests to simulate producer timeout and reconnection", "commitDateTime": "2019-11-19 11:59:19", "authoredDateTime": "2019-11-19 11:59:19", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java", "insertions": 57, "deletions": 10, "lines": 67}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BacklogQuotaManager.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Producer.java", "insertions": 22, "deletions": 7, "lines": 29}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 7, "deletions": 5, "lines": 12}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Topic.java", "insertions": 1, "deletions": 2, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java", "insertions": 20, "deletions": 32, "lines": 52}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java", "insertions": 25, "deletions": 38, "lines": 63}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/NamespaceStatsAggregator.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentTopicTest.java", "insertions": 55, "deletions": 7, "lines": 62}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/ProducerCreationTest.java", "insertions": 95, "deletions": 0, "lines": 95}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/MessagePublishThrottlingTest.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConnectionHandler.java", "insertions": 15, "deletions": 3, "lines": 18}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 6, "deletions": 1, "lines": 7}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/proto/PulsarApi.java", "insertions": 114, "deletions": 0, "lines": 114}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Commands.java", "insertions": 5, "deletions": 2, "lines": 7}, {"filePath": "pulsar-common/src/main/proto/PulsarApi.proto", "insertions": 7, "deletions": 0, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AbstractTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic.enableProduerRead()", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic.getProducers()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic.resetPublishCountAndEnableReadIfRequired()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic.updatePublishDispatcher(org.apache.pulsar.common.policies.data.Policies)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic.checkTopicFenced()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic.internalAddProducer(org.apache.pulsar.broker.service.Producer)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic.tryOverwriteOldProducer(org.apache.pulsar.broker.service.Producer,org.apache.pulsar.broker.service.Producer)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic.handleProducerRemoved(org.apache.pulsar.broker.service.Producer)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic.hasLocalProducers()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.AbstractTopic.enableProducerRead()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BacklogQuotaManager.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BacklogQuotaManager.disconnectProducers(org.apache.pulsar.broker.service.persistent.PersistentTopic)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "Producer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.Producer", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.getEpoch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.isUserProvidedProducerName()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.close(boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.closeNow(boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.disconnect()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.publishOperationCompleted()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.closeNow()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleProducer(org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer)", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleCloseProducer(org.apache.pulsar.common.api.proto.PulsarApi.CommandCloseProducer)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.channelInactive(io.netty.channel.ChannelHandlerContext)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Topic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.getProducers()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NonPersistentTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentTopic.removeProducer(org.apache.pulsar.broker.service.Producer)", "TOT": 7, "UPD": 1, "INS": 2, "MOV": 4, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentTopic.addProducer(org.apache.pulsar.broker.service.Producer)", "TOT": 20, "UPD": 0, "INS": 1, "MOV": 17, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentTopic.close()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentTopic.updateRates(org.apache.pulsar.broker.stats.NamespaceStats,org.apache.pulsar.policies.data.loadbalancer.NamespaceBundleStats,org.apache.pulsar.utils.StatsOutputStream,org.apache.pulsar.broker.stats.ClusterReplicationMetrics,java.lang.String,boolean)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentTopic.getStats()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentTopic.onPoliciesUpdate(org.apache.pulsar.common.policies.data.Policies)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentTopic.delete(boolean,boolean,boolean)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PersistentTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.removeProducer(org.apache.pulsar.broker.service.Producer)", "TOT": 9, "UPD": 1, "INS": 2, "MOV": 6, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.publishMessage(io.netty.buffer.ByteBuf,org.apache.pulsar.broker.service.persistent.PublishContext)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.decrementPendingWriteOpsAndCheck()", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.addFailed(org.apache.bookkeeper.mledger.ManagedLedgerException,java.lang.Object)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.addProducer(org.apache.pulsar.broker.service.Producer)", "TOT": 23, "UPD": 0, "INS": 1, "MOV": 20, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.subscribe(org.apache.pulsar.broker.service.ServerCnx,java.lang.String,long,org.apache.pulsar.common.api.proto.PulsarApi.CommandSubscribe.SubType,int,java.lang.String,boolean,org.apache.pulsar.client.api.MessageId,java.util.Map,boolean,org.apache.pulsar.common.api.proto.PulsarApi.CommandSubscribe.InitialPosition,long,boolean,org.apache.pulsar.common.api.proto.PulsarApi$KeySharedMeta)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.delete(boolean,boolean,boolean)", "TOT": 9, "UPD": 0, "INS": 3, "MOV": 2, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.close()", "TOT": 6, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.hasRemoteProducers()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.updateRates(org.apache.pulsar.broker.stats.NamespaceStats,org.apache.pulsar.policies.data.loadbalancer.NamespaceBundleStats,org.apache.pulsar.utils.StatsOutputStream,org.apache.pulsar.broker.stats.ClusterReplicationMetrics,java.lang.String,boolean)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.getStats()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.onPoliciesUpdate(org.apache.pulsar.common.policies.data.Policies)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.terminate().5.terminateComplete(org.apache.bookkeeper.mledger.Position,java.lang.Object)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.delete(boolean,boolean,boolean).<unknown>.deleteLedgerFailed(org.apache.bookkeeper.mledger.ManagedLedgerException,java.lang.Object)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "NamespaceStatsAggregator.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.getTopicStats(org.apache.pulsar.broker.service.Topic,org.apache.pulsar.broker.stats.prometheus.TopicStats,boolean)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicTest.testUbsubscribeRaceConditions()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicTest.testDeleteTopicRaceConditions()", "TOT": 3, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicTest.testProducerOverwrite()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicTest.testAddRemoveProducer()", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicTest.testMaxProducers()", "TOT": 18, "UPD": 0, "INS": 12, "MOV": 6, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicTest.testDeleteTopic()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProducerCreationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.ProducerCreationTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MessagePublishThrottlingTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessagePublishThrottlingTest.testSimplePublishMessageThrottling()", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessagePublishThrottlingTest.testSimplePublishByteThrottling()", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ConnectionHandler.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConnectionHandler.connectionClosed(org.apache.pulsar.client.impl.ClientCnx)", "TOT": 3, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConnectionHandler.getClientCnx()", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConnectionHandler", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConnectionHandler.getEpoch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConnectionHandler.reconnectLater(java.lang.Throwable)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.connectionOpened(org.apache.pulsar.client.impl.ClientCnx)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarApi.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.hasEpoch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.getEpoch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.hasUserProvidedProducerName()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.getUserProvidedProducerName()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.hasEpoch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.getEpoch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.hasUserProvidedProducerName()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.getUserProvidedProducerName()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.initFields()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.writeTo(org.apache.pulsar.common.util.protobuf.ByteBufCodedOutputStream)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.getSerializedSize()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder.hasEpoch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder.getEpoch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder.setEpoch(long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder.clearEpoch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder.hasUserProvidedProducerName()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder.getUserProvidedProducerName()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder.setUserProvidedProducerName(boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder.clearUserProvidedProducerName()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder.clear()", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder.buildPartial()", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder.mergeFrom(org.apache.pulsar.common.api.proto.PulsarApi$CommandProducer)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandProducer.Builder.mergeFrom(org.apache.pulsar.common.util.protobuf.ByteBufCodedInputStream,org.apache.pulsar.shaded.com.google.protobuf.v241.ExtensionRegistryLite)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Commands.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.protocol.Commands.newProducer(java.lang.String,long,long,java.lang.String,boolean,java.util.Map,org.apache.pulsar.common.schema.SchemaInfo,long,boolean)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.protocol.Commands.newProducer(java.lang.String,long,long,java.lang.String,boolean,java.util.Map)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Missing CLI error handling in pulsar-admin", "body": "**Describe the bug**\r\npulsar-admin can raise Java exceptions in certain conditions\r\n\r\n**To Reproduce**\r\n\r\n(1) Giving an invalid command - e.g. \"functions getstate\" (should be \"functions querystate\"), with or without `--help` added\r\n\r\n```\r\n$ apache-pulsar-2.4.1/bin/pulsar-admin functions getstate\r\nExpected a command, got getstate\r\n\r\nException in thread \"main\" com.beust.jcommander.ParameterException: Asking description for unknown command: null\r\n\tat com.beust.jcommander.JCommander.getCommandDescription(JCommander.java:1003)\r\n\tat com.beust.jcommander.JCommander.usage(JCommander.java:988)\r\n\tat com.beust.jcommander.JCommander.usage(JCommander.java:980)\r\n\tat com.beust.jcommander.JCommander.usage(JCommander.java:972)\r\n\tat org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:49)\r\n\tat org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:218)\r\n\tat org.apache.pulsar.admin.cli.PulsarAdminTool.main(PulsarAdminTool.java:260)\r\n```\r\n(Hangs here, have to press `^C`)\r\n\r\n(2) Giving a querystate command without the \"--key\" option\r\n\r\n```\r\n$ apache-pulsar-2.4.1/bin/pulsar-admin functions querystate --name womble\r\nnull\r\n\r\nReason: java.lang.NullPointerException: path is 'null'.\r\n```\r\n\r\ntcpdump shows no traffic on port 8080, so this appears to be a local CLI issue.\r\n\r\n**Expected behavior**\r\nError message to be reported\r\n", "url": "https://github.com/apache/pulsar/issues/5533", "user": "candlerb", "labels": ["triage/week-44", "type/bug"], "created": "2019-11-01 09:28:25", "closed": "2019-11-19 05:10:21", "commits": {"d16e79a1d42f1ad92c144f80ce429c3479d280a7": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 17.00027777777778, "commitsDetails": [{"commitHash": "d16e79a1d42f1ad92c144f80ce429c3479d280a7", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["bfcfdf6357addf8dbdccb96c158bf4a8d516c9b4"], "nameRev": "d16e79a1d42f1ad92c144f80ce429c3479d280a7 tags/v2.5.0-candidate-1~75", "commitMessage": " Fix hangs when type invalid args at command-line (#5615)\n\nFixes #5533 \r\n\r\n*Motivation*\r\n\r\nWhen we using command-line tools, it hangs after type an invalid args.\r\n\r\n*Modifications*\r\n\r\nWe don't need to parse the command, just show the command usage.", "commitDateTime": "2019-11-18 21:10:20", "authoredDateTime": "2019-11-19 13:10:20", "commitGitStats": [{"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdBase.java", "insertions": 11, "deletions": 2, "lines": 13}], "commitSpoonAstDiffStats": [{"spoonFilePath": "CmdBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdBase.tryShowCommandUsage()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.admin.cli.CmdBase.run(java.lang.String[])", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "localrun fails to load python functions from correct file", "body": "**Describe the bug**\r\nIf you try to run a function like this:\r\n\r\n```\r\napache-pulsar-2.4.1/bin/pulsar-admin functions localrun ... --py /home/ubuntu/func1.py\r\n```\r\n\r\nThen the function fails to start.  Strace output shows that it's trying to read python code from `/home/ubuntu` instead of `/home/ubuntu/func1.py`\r\n\r\n**To Reproduce**\r\nAs per #5521 \r\n\r\nI have `func1.py` in the current directory:\r\n\r\n```\r\n$ pwd\r\n/home/ubuntu\r\n$ cat func1.py\r\nfrom pulsar import Function\r\n\r\nclass FirstFunction(Function):\r\n    def process(self, item, context):\r\n        log = context.get_logger()\r\n        log.info(\"Got %r with properties %r\" % (item, context.get_message_properties()))\r\n```\r\n\r\nWhat I originally wanted to do was run it like this:\r\n\r\n```\r\n$ apache-pulsar-2.4.1/bin/pulsar-admin functions localrun --name womble2 --inputs my-topic --py func1.py --classname FirstFunction --log-topic pulsar-log\r\nThe specified python file does not exist\r\n...\r\n```\r\n\r\nThat's because pulsar-admin changes the working directory, as almost the first thing it does.  So instead I gave an absolute path to the function:\r\n\r\n```\r\n$ apache-pulsar-2.4.1/bin/pulsar-admin functions localrun --name womble2 --inputs my-topic --py /home/ubuntu/func1.py --classname FirstFunction --log-topic pulsar-log\r\n```\r\n\r\nPulsar goes into a loop, attempting to start every 30 seconds, but not indicating why the python process fails.  (Full session logs in #5521, that ticket is about the error output beig discarded)\r\n\r\nSo I run under strace:\r\n\r\n```\r\n$ strace -f -s128 apache-pulsar-2.4.1/bin/pulsar-admin functions localrun --name womble2 --inputs my-topic --py /home/ubuntu/func1.py --classname FirstFunction --log-topic pulsar-log 2>/tmp/strace.out\r\n...\r\n13:14:07.229 [main] INFO  org.apache.pulsar.functions.LocalRunner - RuntimeSpawner quit because of\r\n^C\r\n```\r\n\r\nAnd buried in the strace is the error message:\r\n\r\n```\r\n$ grep \"Failed to import class\" /tmp/strace.out\r\n[pid 17173] write(3, \"[2019-10-31 12:48:33 +0000] [INFO] util.py: Failed to import class FirstFunction from path /home/ubuntu\\n\", 104) = 104\r\n```\r\n\r\nIt should be trying to read from `/home/ubuntu/func1.py`\r\n\r\nSo then I tried moving `func1.py` into the `apache-pulsar-2.4.1` directory, and running like this:\r\n\r\n```\r\n$ strace -s128 -f apache-pulsar-2.4.1/bin/pulsar-admin functions localrun --name womble2 --inputs my-topic --py func1.py --classname FirstFunction --log-topic pulsar-log 2>/tmp/strace.out\r\n```\r\n\r\nNow the file it is trying to read from is an empty filename!\r\n\r\n```\r\n$ grep \"Failed to import class\" /tmp/strace.out\r\n[pid 18278] write(3, \"[2019-10-31 13:14:07 +0000] [INFO] util.py: Failed to import class FirstFunction from path \\n\", 92) = 92\r\n```\r\n\r\n**Expected behavior**\r\nFunction to be loaded from the file I specified\r\n\r\n**Screenshots**\r\nSee above\r\n\r\n**Desktop (please complete the following information):**\r\n - Ubuntu 18.04\r\n\r\n**Additional context**\r\nN/A", "url": "https://github.com/apache/pulsar/issues/5522", "user": "candlerb", "labels": ["type/bug"], "created": "2019-10-31 13:23:00", "closed": "2019-10-31 13:50:28", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Python exception message not shown when python function fails to start", "body": "**Describe the bug**\r\nI have a problem starting a python function.  However, the actual python error message (reported on stderr) is being lost.  I can only see it if I \"strace\" the entire pulsar stack.\r\n\r\n**To Reproduce**\r\nI am using pulsar functions with pulsar 2.4.1 in standalone mode, base OS is Ubuntu 18.04, and I've done the frig to link \"python\" to \"python3\":\r\n\r\n```\r\nsudo update-alternatives --install /usr/bin/python python /usr/bin/python3 10\r\n```\r\n\r\nHere's my function:\r\n\r\n```\r\n$ cat func1.py\r\nfrom pulsar import Function\r\n\r\nclass FirstFunction(Function):\r\n    def process(self, item, context):\r\n        log = context.get_logger()\r\n        log.info(\"Got %r with properties %r\" % (item, context.get_message_properties()))\r\n```\r\n\r\nI can run it from the command line and it just returns without error.\r\n\r\nDeployed:\r\n\r\n```\r\n$ apache-pulsar-2.4.1/bin/pulsar-admin functions create --name womble --inputs my-topic --py /home/ubuntu/func1.py --classname FirstFunction --log-topic pulsar-log\r\n\r\n$ apache-pulsar-2.4.1/bin/pulsar-admin functions status --name womble\r\n{\r\n  \"numInstances\" : 1,\r\n  \"numRunning\" : 0,\r\n  \"instances\" : [ {\r\n    \"instanceId\" : 0,\r\n    \"status\" : {\r\n      \"running\" : false,\r\n      \"error\" : \"\",\r\n      \"numRestarts\" : 222,\r\n      \"numReceived\" : 0,\r\n      \"numSuccessfullyProcessed\" : 0,\r\n      \"numUserExceptions\" : 0,\r\n      \"latestUserExceptions\" : [ ],\r\n      \"numSystemExceptions\" : 0,\r\n      \"latestSystemExceptions\" : [ ],\r\n      \"averageLatency\" : 0.0,\r\n      \"lastInvocationTime\" : 0,\r\n      \"workerId\" : \"c-standalone-fw-ldex-pulsar.int.example.net-8080\"\r\n    }\r\n  } ]\r\n}\r\n```\r\n\r\nLooking at the pulsar process output, I see it restarting every 30 seconds but no indication of why it's dying.  There's a \"DeathException\" but no further info - not even the process exit code as fas as I can see.\r\n\r\n```\r\n12:39:45.003 [function-timer-thread-94-1] ERROR org.apache.pulsar.functions.runtime.RuntimeSpawner - public/default/womble-java.lang.RuntimeException:  Function\r\nContainer is dead with exception.. restarting\r\n12:39:45.003 [function-timer-thread-94-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Creating function log directory /home/ubuntu/apache-pulsar-2\r\n.4.1/logs/functions/public/default/womble\r\n12:39:45.003 [function-timer-thread-94-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Created or found function log directory /home/ubuntu/apache-\r\npulsar-2.4.1/logs/functions/public/default/womble\r\n12:39:45.003 [function-timer-thread-94-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - ProcessBuilder starting the process with args python /home/u\r\nbuntu/apache-pulsar-2.4.1/instances/python-instance/python_instance_main.py --py /tmp/pulsar_functions/public/default/womble/0/func1.py --logging_directory /home\r\n/ubuntu/apache-pulsar-2.4.1/logs/functions --logging_file womble --logging_config_file /home/ubuntu/apache-pulsar-2.4.1/conf/functions-logging/logging_config.ini\r\n --instance_id 0 --function_id 67fb9828-56ab-49ff-bbbc-56db9510d26c --function_version 4f01d696-28da-40b7-b9f5-2283fbe9bd7c --function_details '{\"tenant\":\"public\r\n\",\"namespace\":\"default\",\"name\":\"womble\",\"className\":\"FirstFunction\",\"logTopic\":\"pulsar-log\",\"runtime\":\"PYTHON\",\"autoAck\":true,\"parallelism\":1,\"source\":{\"inputSpe\r\ncs\":{\"my-topic\":{}},\"cleanupSubscription\":true},\"sink\":{},\"resources\":{\"cpu\":1.0,\"ram\":\"1073741824\",\"disk\":\"10737418240\"},\"componentType\":\"FUNCTION\"}' --pulsar_s\r\nerviceurl pulsar://ldex-pulsar.int.example.net:6650 --max_buffered_tuples 1024 --port 38423 --metrics_port 36591 --state_storage_serviceurl bk://127.0.0.1:418\r\n1 --expected_healthcheck_interval 30 --secrets_provider secretsprovider.ClearTextSecretsProvider --cluster_name standalone\r\n12:39:45.005 [function-timer-thread-94-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully\r\n2019-10-31 12:39:45.478 INFO  ConnectionPool:72 | Created connection for pulsar://ldex-pulsar.int.example.net:6650\r\n2019-10-31 12:39:45.480 INFO  ClientConnection:324 | [10.85.179.103:37476 -> 10.85.179.103:6650] Connected to broker\r\n12:39:45.480 [pulsar-io-50-6] INFO  org.apache.pulsar.broker.service.ServerCnx - New connection from /10.85.179.103:37476\r\n2019-10-31 12:39:45.481 INFO  BatchMessageContainer:43 | { BatchContainer [size = 0] [batchSizeInBytes_ = 0] [maxAllowedMessageBatchSizeInBytes_ = 131072] [maxAl\r\nlowedNumMessagesInBatch_ = 1000] [topicName = persistent://public/default/pulsar-log] [producerName_ = ] [batchSizeInBytes_ = 0] [numberOfBatchesSent = 0] [avera\r\ngeBatchSize = 0]} BatchMessageContainer constructed\r\n2019-10-31 12:39:45.481 INFO  HandlerBase:52 | [persistent://public/default/pulsar-log, ] Getting connection from pool\r\n12:39:45.482 [pulsar-io-50-6] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.85.179.103:37476][persistent://public/default/pulsar-log] Creating producer\r\n. producerId=0\r\n12:39:45.483 [ForkJoinPool.commonPool-worker-1] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.85.179.103:37476]-0 persistent://public/default/pulsar-lo\r\ng configured with schema false\r\n12:39:45.483 [ForkJoinPool.commonPool-worker-1] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.85.179.103:37476] Created new producer: Producer{topic=Pe\r\nrsistentTopic{topic=persistent://public/default/pulsar-log}, client=/10.85.179.103:37476, producerName=standalone-1-142, producerId=0}\r\n2019-10-31 12:39:45.483 INFO  ProducerImpl:155 | [persistent://public/default/pulsar-log, ] Created producer on broker [10.85.179.103:37476 -> 10.85.179.103:6650\r\n]\r\n2019-10-31 12:39:45.504 INFO  Client:88 | Subscribing on Topic :my-topic\r\n2019-10-31 12:39:45.505 INFO  HandlerBase:52 | [persistent://public/default/my-topic, public/default/womble, 0] Getting connection from pool\r\n12:39:45.505 [pulsar-io-50-6] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.85.179.103:37476] Subscribing on topic persistent://public/default/my-topic\r\n / public/default/womble\r\n12:39:45.505 [pulsar-io-50-6] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [public/default/persistent/my-topic-public%2Fdefault%2Fwomble] Rewind\r\nfrom 36531:29 to 36531:9\r\n12:39:45.506 [pulsar-io-50-6] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://public/default/my-topic] There are no replicated\r\nsubscriptions on the topic\r\n12:39:45.506 [pulsar-io-50-6] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://public/default/my-topic][public/default/womble] C\r\nreated new subscription for 0\r\n12:39:45.506 [pulsar-io-50-6] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.85.179.103:37476] Created subscription on topic persistent://public/default\r\n/my-topic / public/default/womble\r\n2019-10-31 12:39:45.506 INFO  ConsumerImpl:170 | [persistent://public/default/my-topic, public/default/womble, 0] Created consumer on broker [10.85.179.103:37476\r\n -> 10.85.179.103:6650]\r\n12:39:45.598 [pulsar-io-50-6] INFO  org.apache.pulsar.broker.service.ServerCnx - Closed connection from /10.85.179.103:37476\r\n12:39:45.598 [pulsar-io-50-6] INFO  org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers - Removed consumer Consumer{subscription=Pe\r\nrsistentSubscription{topic=persistent://public/default/my-topic, name=public/default/womble}, consumerId=0, consumerName=f01655, address=/10.85.179.103:37476} with pending 20 acks\r\n12:40:00.754 [pulsar-web-57-5] INFO  org.eclipse.jetty.server.RequestLog - 10.85.179.103 - - [31/Oct/2019:12:40:00 +0000] \"GET /admin/v2/persistent/public/functi\r\nons/coordinate/stats HTTP/1.1\" 200 851 \"-\" \"Pulsar-Java-v2.4.1\" 2\r\n12:40:15.002 [function-timer-thread-94-1] ERROR org.apache.pulsar.functions.runtime.ProcessRuntime - Extracted Process death exception\r\njava.lang.RuntimeException:\r\n        at org.apache.pulsar.functions.runtime.ProcessRuntime.tryExtractingDeathException(ProcessRuntime.java:380) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.runtime.ProcessRuntime.isAlive(ProcessRuntime.java:367) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.runtime.RuntimeSpawner.lambda$start$0(RuntimeSpawner.java:88) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.1.jar:2.4.1]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_222]\r\n        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [?:1.8.0_222]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_222]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [?:1.8.0_222]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_222]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_222]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_222]\r\n12:40:15.003 [function-timer-thread-94-1] ERROR org.apache.pulsar.functions.runtime.RuntimeSpawner - public/default/womble-java.lang.RuntimeException:  Function Container is dead with exception.. restarting\r\n12:40:15.003 [function-timer-thread-94-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Creating function log directory /home/ubuntu/apache-pulsar-2.4.1/logs/functions/public/default/womble\r\n12:40:15.003 [function-timer-thread-94-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Created or found function log directory /home/ubuntu/apache-pulsar-2.4.1/logs/functions/public/default/womble\r\n12:40:15.004 [function-timer-thread-94-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - ProcessBuilder starting the process with args python /home/ubuntu/apache-pulsar-2.4.1/instances/python-instance/python_instance_main.py --py /tmp/pulsar_functions/public/default/womble/0/func1.py --logging_directory /home/ubuntu/apache-pulsar-2.4.1/logs/functions --logging_file womble --logging_config_file /home/ubuntu/apache-pulsar-2.4.1/conf/functions-logging/logging_config.ini --instance_id 0 --function_id 67fb9828-56ab-49ff-bbbc-56db9510d26c --function_version 4f01d696-28da-40b7-b9f5-2283fbe9bd7c --function_details '{\"tenant\":\"public\",\"namespace\":\"default\",\"name\":\"womble\",\"className\":\"FirstFunction\",\"logTopic\":\"pulsar-log\",\"runtime\":\"PYTHON\",\"autoAck\":true,\"parallelism\":1,\"source\":{\"inputSpecs\":{\"my-topic\":{}},\"cleanupSubscription\":true},\"sink\":{},\"resources\":{\"cpu\":1.0,\"ram\":\"1073741824\",\"disk\":\"10737418240\"},\"componentType\":\"FUNCTION\"}' --pulsar_serviceurl pulsar://ldex-pulsar.int.example.net:6650 --max_buffered_tuples 1024 --port 38423 --metrics_port 36591 --state_storage_serviceurl bk://127.0.0.1:4181 --expected_healthcheck_interval 30 --secrets_provider secretsprovider.ClearTextSecretsProvider --cluster_name standalone\r\n12:40:15.010 [function-timer-thread-94-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully\r\n2019-10-31 12:40:15.481 INFO  ConnectionPool:72 | Created connection for pulsar://ldex-pulsar.int.example.net:6650\r\n2019-10-31 12:40:15.483 INFO  ClientConnection:324 | [10.85.179.103:37928 -> 10.85.179.103:6650] Connected to broker\r\n12:40:15.484 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - New connection from /10.85.179.103:37928\r\n2019-10-31 12:40:15.485 INFO  BatchMessageContainer:43 | { BatchContainer [size = 0] [batchSizeInBytes_ = 0] [maxAllowedMessageBatchSizeInBytes_ = 131072] [maxAllowedNumMessagesInBatch_ = 1000] [topicName = persistent://public/default/pulsar-log] [producerName_ = ] [batchSizeInBytes_ = 0] [numberOfBatchesSent = 0] [averageBatchSize = 0]} BatchMessageContainer constructed\r\n2019-10-31 12:40:15.485 INFO  HandlerBase:52 | [persistent://public/default/pulsar-log, ] Getting connection from pool\r\n12:40:15.487 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.85.179.103:37928][persistent://public/default/pulsar-log] Creating producer. producerId=0\r\n12:40:15.487 [ForkJoinPool.commonPool-worker-2] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.85.179.103:37928]-0 persistent://public/default/pulsar-log configured with schema false\r\n12:40:15.488 [ForkJoinPool.commonPool-worker-2] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.85.179.103:37928] Created new producer: Producer{topic=PersistentTopic{topic=persistent://public/default/pulsar-log}, client=/10.85.179.103:37928, producerName=standalone-1-143, producerId=0}\r\n2019-10-31 12:40:15.488 INFO  ProducerImpl:155 | [persistent://public/default/pulsar-log, ] Created producer on broker [10.85.179.103:37928 -> 10.85.179.103:6650]\r\n2019-10-31 12:40:15.521 INFO  Client:88 | Subscribing on Topic :my-topic\r\n2019-10-31 12:40:15.522 INFO  HandlerBase:52 | [persistent://public/default/my-topic, public/default/womble, 0] Getting connection from pool\r\n12:40:15.523 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.85.179.103:37928] Subscribing on topic persistent://public/default/my-topic / public/default/womble\r\n12:40:15.524 [pulsar-io-50-7] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [public/default/persistent/my-topic-public%2Fdefault%2Fwomble] Rewind from 36531:29 to 36531:9\r\n12:40:15.524 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://public/default/my-topic] There are no replicated subscriptions on the topic\r\n12:40:15.524 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://public/default/my-topic][public/default/womble] Created new subscription for 0\r\n12:40:15.524 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - [/10.85.179.103:37928] Created subscription on topic persistent://public/default/my-topic / public/default/womble\r\n2019-10-31 12:40:15.524 INFO  ConsumerImpl:170 | [persistent://public/default/my-topic, public/default/womble, 0] Created consumer on broker [10.85.179.103:37928 -> 10.85.179.103:6650]\r\n12:40:15.632 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - Closed connection from /10.85.179.103:37928\r\n12:40:15.633 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers - Removed consumer Consumer{subscription=PersistentSubscription{topic=persistent://public/default/my-topic, name=public/default/womble}, consumerId=0, consumerName=b4b94f, address=/10.85.179.103:37928} with pending 20 acks\r\n```\r\n\r\nAnd so on.\r\n\r\nUsing localrun mode isn't any better:\r\n\r\n```\r\n$ apache-pulsar-2.4.1/bin/pulsar-admin functions localrun --name womble2 --inputs my-topic --py /home/ubuntu/func1.py --classname FirstFunction --log-topic pulsar-log\r\n12:44:32.943 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntimeFactory - Java instance jar location is not defined, using the location defined in system environment : /home/ubuntu/apache-pulsar-2.4.1/instances/java-instance.jar\r\n12:44:32.947 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntimeFactory - Python instance file location is not defined using the location defined in system environment : /home/ubuntu/apache-pulsar-2.4.1/instances/python-instance/python_instance_main.py\r\n12:44:32.948 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntimeFactory - No extra dependencies location is defined in either function worker config or system environment\r\n12:44:33.085 [main] INFO  org.apache.pulsar.functions.runtime.RuntimeSpawner - public/default/womble2-0 RuntimeSpawner starting function\r\n12:44:33.086 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Creating function log directory /home/ubuntu/apache-pulsar-2.4.1/logs/functions/public/default/womble2\r\n12:44:33.088 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Created or found function log directory /home/ubuntu/apache-pulsar-2.4.1/logs/functions/public/default/womble2\r\n12:44:33.088 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - ProcessBuilder starting the process with args python /home/ubuntu/apache-pulsar-2.4.1/instances/python-instance/python_instance_main.py --py /home/ubuntu/func1.py --logging_directory /home/ubuntu/apache-pulsar-2.4.1/logs/functions --logging_file womble2 --logging_config_file /home/ubuntu/apache-pulsar-2.4.1/conf/functions-logging/logging_config.ini --instance_id 0 --function_id a776f9d5-db5e-4b59-9b01-ab7661ea0df2 --function_version 48bb96e4-69a9-43f9-b880-7ae89d41b0e3 --function_details '{\"tenant\":\"public\",\"namespace\":\"default\",\"name\":\"womble2\",\"className\":\"FirstFunction\",\"logTopic\":\"pulsar-log\",\"runtime\":\"PYTHON\",\"autoAck\":true,\"parallelism\":1,\"source\":{\"inputSpecs\":{\"my-topic\":{}},\"cleanupSubscription\":true},\"sink\":{},\"resources\":{\"cpu\":1.0,\"ram\":\"1073741824\",\"disk\":\"10737418240\"},\"componentType\":\"FUNCTION\"}' --pulsar_serviceurl pulsar://localhost:6650 --use_tls false --tls_allow_insecure false --hostname_verification_enabled false --max_buffered_tuples 1024 --port 46365 --metrics_port 44849 --expected_healthcheck_interval 30 --secrets_provider secretsprovider.ClearTextSecretsProvider --cluster_name local\r\n12:44:33.104 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully\r\n2019-10-31 12:44:33.546 INFO  ConnectionPool:72 | Created connection for pulsar://localhost:6650\r\n2019-10-31 12:44:33.547 INFO  ClientConnection:324 | [127.0.0.1:52338 -> 127.0.0.1:6650] Connected to broker\r\n2019-10-31 12:44:33.549 INFO  BatchMessageContainer:43 | { BatchContainer [size = 0] [batchSizeInBytes_ = 0] [maxAllowedMessageBatchSizeInBytes_ = 131072] [maxAllowedNumMessagesInBatch_ = 1000] [topicName = persistent://public/default/pulsar-log] [producerName_ = ] [batchSizeInBytes_ = 0] [numberOfBatchesSent = 0] [averageBatchSize = 0]} BatchMessageContainer constructed\r\n2019-10-31 12:44:33.549 INFO  HandlerBase:52 | [persistent://public/default/pulsar-log, ] Getting connection from pool\r\n2019-10-31 12:44:33.550 INFO  ConnectionPool:72 | Created connection for pulsar://ldex-pulsar.int.example.net:6650\r\n2019-10-31 12:44:33.550 INFO  ClientConnection:326 | [127.0.0.1:52340 -> 127.0.0.1:6650] Connected to broker through proxy. Logical broker: pulsar://ldex-pulsar.int.example.net:6650\r\n2019-10-31 12:44:33.551 INFO  ProducerImpl:155 | [persistent://public/default/pulsar-log, ] Created producer on broker [127.0.0.1:52340 -> 127.0.0.1:6650]\r\n2019-10-31 12:44:33.553 INFO  Client:88 | Subscribing on Topic :my-topic\r\n2019-10-31 12:44:33.554 INFO  HandlerBase:52 | [persistent://public/default/my-topic, public/default/womble2, 0] Getting connection from pool\r\n2019-10-31 12:44:33.626 INFO  ConsumerImpl:170 | [persistent://public/default/my-topic, public/default/womble2, 0] Created consumer on broker [127.0.0.1:52340 -> 127.0.0.1:6650]\r\n12:44:33.703 [main] INFO  org.apache.pulsar.functions.LocalRunner - RuntimeSpawner quit because of\r\n\r\n<< hangs for 30 seconds here - right after \"because of\" !! >>\r\n\r\n12:45:03.838 [function-timer-thread-3-1] ERROR org.apache.pulsar.functions.runtime.ProcessRuntime - Health check failed for womble2-0\r\njava.util.concurrent.ExecutionException: io.grpc.StatusRuntimeException: UNAVAILABLE: io exception\r\n    at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357) ~[?:1.8.0_222]\r\n    at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895) ~[?:1.8.0_222]\r\n    at org.apache.pulsar.functions.runtime.ProcessRuntime.lambda$start$1(ProcessRuntime.java:164) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.1.jar:2.4.1]\r\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_222]\r\n    at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [?:1.8.0_222]\r\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_222]\r\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [?:1.8.0_222]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_222]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_222]\r\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at java.lang.Thread.run(Thread.java:748) [?:1.8.0_222]\r\nCaused by: io.grpc.StatusRuntimeException: UNAVAILABLE: io exception\r\n    at io.grpc.Status.asRuntimeException(Status.java:530) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.stub.ClientCalls$UnaryStreamToFuture.onClose(ClientCalls.java:482) ~[io.grpc-grpc-stub-1.18.0.jar:1.18.0]\r\n    at io.grpc.PartialForwardingClientCallListener.onClose(PartialForwardingClientCallListener.java:39) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.ForwardingClientCallListener.onClose(ForwardingClientCallListener.java:23) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.ForwardingClientCallListener$SimpleForwardingClientCallListener.onClose(ForwardingClientCallListener.java:40) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.internal.CensusStatsModule$StatsClientInterceptor$1$1.onClose(CensusStatsModule.java:699) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.PartialForwardingClientCallListener.onClose(PartialForwardingClientCallListener.java:39) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.ForwardingClientCallListener.onClose(ForwardingClientCallListener.java:23) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.ForwardingClientCallListener$SimpleForwardingClientCallListener.onClose(ForwardingClientCallListener.java:40) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.internal.CensusTracingModule$TracingClientInterceptor$1$1.onClose(CensusTracingModule.java:397) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.internal.ClientCallImpl.closeObserver(ClientCallImpl.java:459) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.internal.ClientCallImpl.access$300(ClientCallImpl.java:63) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl.close(ClientCallImpl.java:546) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl.access$600(ClientCallImpl.java:467) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInContext(ClientCallImpl.java:584) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:123) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_222]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_222]\r\n    ... 1 more\r\nCaused by: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:46365\r\n    at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) ~[?:1.8.0_222]\r\n    at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717) ~[?:1.8.0_222]\r\n    at io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:327) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:340) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:644) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:591) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:508) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:470) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    ... 2 more\r\nCaused by: java.net.ConnectException: Connection refused\r\n    at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) ~[?:1.8.0_222]\r\n    at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717) ~[?:1.8.0_222]\r\n    at io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:327) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:340) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:644) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:591) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:508) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:470) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    ... 2 more\r\n12:45:03.864 [function-timer-thread-3-1] ERROR org.apache.pulsar.functions.runtime.ProcessRuntime - Extracted Process death exception\r\njava.lang.RuntimeException:\r\n    at org.apache.pulsar.functions.runtime.ProcessRuntime.tryExtractingDeathException(ProcessRuntime.java:380) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.1.jar:2.4.1]\r\n    at org.apache.pulsar.functions.runtime.ProcessRuntime.isAlive(ProcessRuntime.java:367) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.1.jar:2.4.1]\r\n    at org.apache.pulsar.functions.runtime.RuntimeSpawner.lambda$start$0(RuntimeSpawner.java:88) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.1.jar:2.4.1]\r\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_222]\r\n    at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [?:1.8.0_222]\r\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_222]\r\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [?:1.8.0_222]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_222]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_222]\r\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at java.lang.Thread.run(Thread.java:748) [?:1.8.0_222]\r\n12:45:03.866 [function-timer-thread-3-1] ERROR org.apache.pulsar.functions.runtime.RuntimeSpawner - public/default/womble2-java.lang.RuntimeException:  Function Container is dead with exception.. restarting\r\n12:45:03.872 [function-timer-thread-3-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Creating function log directory /home/ubuntu/apache-pulsar-2.4.1/logs/functions/public/default/womble2\r\n12:45:03.874 [function-timer-thread-3-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Created or found function log directory /home/ubuntu/apache-pulsar-2.4.1/logs/functions/public/default/womble2\r\n12:45:03.875 [function-timer-thread-3-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - ProcessBuilder starting the process with args python /home/ubuntu/apache-pulsar-2.4.1/instances/python-instance/python_instance_main.py --py /home/ubuntu/func1.py --logging_directory /home/ubuntu/apache-pulsar-2.4.1/logs/functions --logging_file womble2 --logging_config_file /home/ubuntu/apache-pulsar-2.4.1/conf/functions-logging/logging_config.ini --instance_id 0 --function_id a776f9d5-db5e-4b59-9b01-ab7661ea0df2 --function_version 48bb96e4-69a9-43f9-b880-7ae89d41b0e3 --function_details '{\"tenant\":\"public\",\"namespace\":\"default\",\"name\":\"womble2\",\"className\":\"FirstFunction\",\"logTopic\":\"pulsar-log\",\"runtime\":\"PYTHON\",\"autoAck\":true,\"parallelism\":1,\"source\":{\"inputSpecs\":{\"my-topic\":{}},\"cleanupSubscription\":true},\"sink\":{},\"resources\":{\"cpu\":1.0,\"ram\":\"1073741824\",\"disk\":\"10737418240\"},\"componentType\":\"FUNCTION\"}' --pulsar_serviceurl pulsar://localhost:6650 --use_tls false --tls_allow_insecure false --hostname_verification_enabled false --max_buffered_tuples 1024 --port 46365 --metrics_port 44849 --expected_healthcheck_interval 30 --secrets_provider secretsprovider.ClearTextSecretsProvider --cluster_name local\r\n12:45:03.886 [function-timer-thread-3-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully\r\n12:45:03.912 [Timer-0] INFO  org.apache.pulsar.functions.LocalRunner - {\r\n  \"failureException\": \"UNAVAILABLE: io exception\",\r\n  \"instanceId\": \"0\"\r\n}\r\n2019-10-31 12:45:04.859 INFO  ConnectionPool:72 | Created connection for pulsar://localhost:6650\r\n2019-10-31 12:45:04.867 INFO  ClientConnection:324 | [127.0.0.1:52910 -> 127.0.0.1:6650] Connected to broker\r\n2019-10-31 12:45:04.878 INFO  BatchMessageContainer:43 | { BatchContainer [size = 0] [batchSizeInBytes_ = 0] [maxAllowedMessageBatchSizeInBytes_ = 131072] [maxAllowedNumMessagesInBatch_ = 1000] [topicName = persistent://public/default/pulsar-log] [producerName_ = ] [batchSizeInBytes_ = 0] [numberOfBatchesSent = 0] [averageBatchSize = 0]} BatchMessageContainer constructed\r\n2019-10-31 12:45:04.878 INFO  HandlerBase:52 | [persistent://public/default/pulsar-log, ] Getting connection from pool\r\n2019-10-31 12:45:04.887 INFO  ConnectionPool:72 | Created connection for pulsar://ldex-pulsar.int.example.net:6650\r\n2019-10-31 12:45:04.887 INFO  ClientConnection:326 | [127.0.0.1:52912 -> 127.0.0.1:6650] Connected to broker through proxy. Logical broker: pulsar://ldex-pulsar.int.example.net:6650\r\n2019-10-31 12:45:04.890 INFO  ProducerImpl:155 | [persistent://public/default/pulsar-log, ] Created producer on broker [127.0.0.1:52912 -> 127.0.0.1:6650]\r\n2019-10-31 12:45:04.900 INFO  Client:88 | Subscribing on Topic :my-topic\r\n2019-10-31 12:45:04.902 INFO  HandlerBase:52 | [persistent://public/default/my-topic, public/default/womble2, 0] Getting connection from pool\r\n2019-10-31 12:45:04.914 INFO  ConsumerImpl:170 | [persistent://public/default/my-topic, public/default/womble2, 0] Created consumer on broker [127.0.0.1:52912 -> 127.0.0.1:6650]\r\n^C12:45:12.279 [Thread-1] INFO  org.apache.pulsar.functions.LocalRunner - Shutting down the localrun runtimeSpawner ...\r\n```\r\n\r\nNotice the 30 second delay as it was trying to report the exception.\r\n\r\nRunning localrun under strace, finally I can see the backtrace:\r\n\r\n```\r\n$ strace -f -s128 apache-pulsar-2.4.1/bin/pulsar-admin functions localrun --name womble2 --inputs my-topic --py /home/ubuntu/func1.py --classname FirstFunction --log-topic pulsar-log 2>/tmp/strace.out\r\n...\r\n\r\n...\r\n[pid 17173] read(10, \"#!/usr/bin/env python3\\n#\\n# Licensed to the Apache Software Foundation (ASF) under one\\n# or more contributor license agreements. \"..., 40\r\n96) = 4096\r\n[pid 17173] close(10)                   = 0\r\n[pid 17173] lseek(9, 0, SEEK_SET)       = 0\r\n[pid 17173] lseek(9, 0, SEEK_CUR)       = 0\r\n[pid 17173] read(9, \"#!/usr/bin/env python3\\n#\\n# Licensed to the Apache Software Foundation (ASF) under one\\n# or more contributor license agreements. \"..., 819\r\n2) = 8192\r\n[pid 17173] read(9, \"Function Module %s\\\" % self.instance_config.function_details.className)\\n      raise NameError(\\\"Could not import User Function Mod\"..., 819\r\n2) = 8192\r\n[pid 17173] close(9)                    = 0\r\n[pid 17173] getpid()                    = 17173\r\n[pid 17173] lseek(3, 0, SEEK_END)       = 16934\r\n[pid 17173] lseek(3, 0, SEEK_CUR)       = 16934\r\n[pid 17173] write(3, \"[2019-10-31 12:48:33 +0000] [ERROR] log.py: raise NameError(\\\"Could not import User Function Module %s\\\" % self.instance_config.fu\"..., 154\r\n) = 154\r\n[pid 17173] getpid()                    = 17173\r\n[pid 17173] lseek(3, 0, SEEK_END)       = 17088\r\n[pid 17173] lseek(3, 0, SEEK_CUR)       = 17088\r\n[pid 17173] write(3, \"[2019-10-31 12:48:33 +0000] [ERROR] log.py: NameError\\n\", 54) = 54\r\n[pid 17173] getpid()                    = 17173\r\n[pid 17173] lseek(3, 0, SEEK_END)       = 17142\r\n[pid 17173] lseek(3, 0, SEEK_CUR)       = 17142\r\n[pid 17173] write(3, \"[2019-10-31 12:48:33 +0000] [ERROR] log.py: :\\n\", 46) = 46\r\n[pid 17173] getpid()                    = 17173\r\n[pid 17173] lseek(3, 0, SEEK_END)       = 17188\r\n[pid 17173] lseek(3, 0, SEEK_CUR)       = 17188\r\n[pid 17173] write(3, \"[2019-10-31 12:48:33 +0000] [ERROR] log.py: Could not import User Function Module FirstFunction\\n\", 96) = 96\r\n[pid 17173] close(3)                    = 0\r\n\r\n...\r\n\r\n[pid 17174] read(3, \"\\312\\376\\272\\276\\0\\0\\0004\\0[\\7\\0*\\n\\0+\\0,\\n\\0\\1\\0-\\n\\0\\24\\0.\\7\\0/\\n\\0\\5\\0000\\t\\0\\23\\0001\\n\\0002\\0003\\n\\0004\\0005\\n\\0002\\0006\\t\\0\\23\\0007\\n\\0\r\n\\23\\0008\\n\\0002\\0009\\t\\0:\\0;\\7\\0<\\n\\0\\17\\0=\\7\\0>\\n\\0\\24\\0009\\7\\0?\\7\\0B\\1\\0\\tcloseLock\\1\\0\\22Ljava/lang/Obje\"..., 1711) = 1711\r\n[pid 17158] write(1, \"12:48:33.287 [main] INFO  org.apache.pulsar.functions.LocalRunner - RuntimeSpawner quit because of\\n\", 99 <unfinished ...>\r\n```\r\n\r\n**Expected behavior**\r\nI would expect the stderr which my function generates before it dies, to be captured and displayed in logs somewhere.\r\n\r\n**Screenshots**\r\nSee above\r\n\r\n**Desktop (please complete the following information):**\r\n - Ubuntu 18.04 (running in lxd container)\r\n\r\n**Additional context**\r\nThe fact that my function doesn't start could be a whole bunch of reasons - `log.py` suggests it's because I'm trying to use log-topic - but that's a separate issue that I need to debug.\r\n\r\nThe issue here is that the message which might help has not been kept.\r\n\r\nI can see there is other information which is being logged but lost.  That error comes from `python_instance.py` which in turn calls `import_class()` from `util.py`\r\n\r\n```\r\ndef import_class(from_path, full_class_name):\r\n  from_path = str(from_path)\r\n  full_class_name = str(full_class_name)\r\n  try:\r\n    return import_class_from_path(from_path, full_class_name)\r\n  except Exception as e:\r\n    our_dir = os.path.dirname(os.path.abspath(inspect.getfile(inspect.currentframe())))\r\n    api_dir = os.path.join(our_dir, PULSAR_API_ROOT, PULSAR_FUNCTIONS_API_ROOT)\r\n    try:\r\n      return import_class_from_path(api_dir, full_class_name)\r\n    except Exception as e:\r\n      Log.info(\"Failed to import class %s from path %s\" % (full_class_name, from_path))\r\n      Log.info(e, exc_info=True)\r\n      return None\r\n```\r\n\r\nWhen this function returns None there should be a Log.info().  Looking in the strace output I see the detail there:\r\n\r\n```\r\n$ grep \"Failed to import class\" /tmp/strace.out\r\n[pid 17173] write(3, \"[2019-10-31 12:48:33 +0000] [INFO] util.py: Failed to import class FirstFunction from path /home/ubuntu\\n\", 104) = 104\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/5521", "user": "candlerb", "labels": ["type/bug"], "created": "2019-10-31 13:05:08", "closed": "2019-10-31 13:32:30", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "COMPILATION ERROR:pulsar-kafka-compat-client-test", "body": "**Describe the bug**\r\npulsar-kafka-compat-client-test: Compilation failure\r\n`detail`:[ERROR] /Users/liyi/workspace_java/github/myrepo/pulsar/tests/pulsar-kafka-compat-client-test/src/test/java/org/apache/pulsar/tests/integration/compat/kafka/PulsarKafkaProducerThreadSafeTest.java:[24,41] \u627e\u4e0d\u5230\u7b26\u53f7\r\n[ERROR]   \u7b26\u53f7:   \u7c7b PulsarKafkaProducer\r\n[ERROR]   \u4f4d\u7f6e: \u7a0b\u5e8f\u5305 org.apache.kafka.clients.producer\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'pulsar/tests/pulsar-kafka-compat-client-test'\r\n2. Enter the command `mvn package`\r\n\r\n**Expected behavior**\r\nThe module build successfully.\r\n\r\n**Screenshots**\r\n![pulsar-kafka-test](https://user-images.githubusercontent.com/20899711/67934450-e4301000-fc02-11e9-9b33-dd82c13e1ca9.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: macOs Mojave 10.14.6\r\n\r\n**Additional context**\r\n- branch 2.4\r\n", "url": "https://github.com/apache/pulsar/issues/5516", "user": "kevenYLi", "labels": ["triage/week-44", "type/bug"], "created": "2019-10-31 09:23:06", "closed": "2020-01-14 16:47:27", "commits": {}, "ttf": 75.00027777777778, "commitsDetails": []}, {"title": "NPE occur when get partitioned topic stats", "body": "**Describe the bug**\r\n![image](https://user-images.githubusercontent.com/12592133/67863080-2eab8100-fb5e-11e9-8621-0c07c388757d.png)\r\n\r\n**Pulsar version**\r\n2.4.1\r\n", "url": "https://github.com/apache/pulsar/issues/5505", "user": "codelipenghui", "labels": ["type/bug"], "created": "2019-10-30 13:43:19", "closed": "2020-01-14 12:35:15", "commits": {}, "ttf": 75.00027777777778, "commitsDetails": []}, {"title": "[Schema]GenericData$Record cannot be cast ", "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to '...'\r\n```\r\n@Builder\r\n    @Data\r\n    @NoArgsConstructor\r\n    @AllArgsConstructor\r\n    public static class Foo2 {\r\n        private String name;\r\n        private Integer id;\r\n    }\r\nPulsarClient client = PulsarClient.builder()\r\n                        .serviceUrl(\"pulsar://localhost:6650\")\r\n                        .build();\r\n\r\n            AvroSchema<Foo2> schema = AvroSchema.of(SchemaDefinition.<Foo2>builder().withJsonDef(\"{\\n\" +\r\n                    \"    \\\"type\\\": \\\"record\\\",\\n\" +\r\n                    \"    \\\"name\\\": \\\"Test\\\",\\n\" +\r\n                    \"    \\\"fields\\\": [\\n\" +\r\n                    \"      {\\n\" +\r\n                    \"        \\\"name\\\": \\\"id\\\",\\n\" +\r\n                    \"        \\\"type\\\": [\\n\" +\r\n                    \"          \\\"null\\\",\\n\" +\r\n                    \"          \\\"int\\\"\\n\" +\r\n                    \"        ]\\n\" +\r\n                    \"      },\\n\" +\r\n                    \"      {\\n\" +\r\n                    \"        \\\"name\\\": \\\"name\\\",\\n\" +\r\n                    \"        \\\"type\\\": [\\n\" +\r\n                    \"          \\\"null\\\",\\n\" +\r\n                    \"          \\\"string\\\"\\n\" +\r\n                    \"        ]\\n\" +\r\n                    \"      }\\n\" +\r\n                    \"    ]\\n\" +\r\n                    \"  }\").withPojo(Foo2.class).build());\r\n            Consumer<Foo2> consumer = client.newConsumer(schema)\r\n                .topic(\"pulsar-mysql-jdbc-sink-topic\")\r\n                .subscriptionName(\"my-subscription-2\")\r\n                .subscribe();\r\n\r\n            while (true) {\r\n            // Wait for a message\r\n            Message<Foo2> msg = consumer.receive();\r\n                Foo2 f = msg.getValue();\r\n            }\r\n```\r\n\r\n\r\n2. See error\r\n\r\n```\r\nException in thread \"main\" java.lang.ClassCastException: org.apache.pulsar.shade.org.apache.avro.generic.GenericData$Record cannot be cast to io.streamnative.KeyValueSchemaTest$Foo2\r\n\tat io.streamnative.KeyValueSchemaTest.testConsumerByPythonProduce(KeyValueSchemaTest.java:412)\r\n\tat io.streamnative.KeyValueSchemaTest.main(KeyValueSchemaTest.java:305)\r\n```\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g.Mac]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/5503", "user": "tuteng", "labels": ["component/schemaregistry", "triage/week-44", "type/bug"], "created": "2019-10-30 10:39:37", "closed": "2020-04-05 00:33:43", "commits": {"52ae1823dbcbef95637580c5f3568843232cd379": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "0d16f7734511632970eeb0c7b1bf28c41ad29fa4": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "d60eebf48c48dc9f6d8135accf66c5440ceadfc5": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 157.00027777777777, "commitsDetails": [{"commitHash": "52ae1823dbcbef95637580c5f3568843232cd379", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["98344a711670919785fc581fc6056299ba60dcea"], "nameRev": "52ae1823dbcbef95637580c5f3568843232cd379 tags/v2.6.0-candidate-1~334", "commitMessage": "Fixed avro schema decode error in functions (#6662)\n\nFixes #5503 \r\nFrom #6445 \r\n\r\n# Motivation\r\nIn functions, it will encounter ```ClassCastException``` when using the Avro schema for topics.\r\n\r\n```\r\nException in thread \"main\" java.lang.ClassCastException: org.apache.pulsar.shade.org.apache.avro.generic.GenericData$Record cannot be cast to io.streamnative.KeyValueSchemaTest$Foo2\r\n\tat io.streamnative.KeyValueSchemaTest.testConsumerByPythonProduce(KeyValueSchemaTest.java:412)\r\n\tat io.streamnative.KeyValueSchemaTest.main(KeyValueSchemaTest.java:305)\r\n```\r\n\r\n# Modifications\r\nIn functions, when using Avro schema specific the ClassLoader for ReflectDatumReader.\r\n\r\nAdd integration test ```testAvroSchemaFunction``` in class ```PulsarFunctionsTest```.", "commitDateTime": "2020-04-05 08:33:42", "authoredDateTime": "2020-04-05 08:33:42", "commitGitStats": [{"filePath": ".github/workflows/ci-unit-broker.yml", "insertions": 31, "deletions": 1, "lines": 32}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AvroSchema.java", "insertions": 19, "deletions": 8, "lines": 27}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/reader/AvroReader.java", "insertions": 31, "deletions": 2, "lines": 33}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/JavaInstanceRunnable.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/PulsarSource.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/AvroSchemaTestFunction.java", "insertions": 36, "deletions": 0, "lines": 36}, {"filePath": "pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/WindowDurationFunction.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/pojo/AvroTestObject.java", "insertions": 32, "deletions": 0, "lines": 32}, {"filePath": "tests/docker-images/latest-version-image/conf/bookie.conf", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTest.java", "insertions": 128, "deletions": 3, "lines": 131}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleGetSchema(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetSchema)", "TOT": 4, "UPD": 1, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema", "TOT": 4, "UPD": 1, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.clone()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.of(java.lang.Class,java.util.Map)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.of(org.apache.pulsar.client.api.schema.SchemaDefinition)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.loadReader(org.apache.pulsar.common.protocol.schema.BytesSchemaVersion)", "TOT": 3, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroReader.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.reader.AvroReader", "TOT": 9, "UPD": 0, "INS": 5, "MOV": 4, "DEL": 0}]}, {"spoonFilePath": "JavaInstanceRunnable.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.instance.JavaInstanceRunnable.loadJars()", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarSource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.PulsarSource.open(java.util.Map,org.apache.pulsar.io.core.SourceContext)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroSchemaTestFunction.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.api.examples.AvroSchemaTestFunction", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "WindowDurationFunction.java", "spoonMethods": []}, {"spoonFilePath": "AvroTestObject.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.api.examples.pojo.AvroTestObject", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarFunctionsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testWindowFunction(java.lang.String,java.lang.String[])", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testAvroSchemaFunction()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "0d16f7734511632970eeb0c7b1bf28c41ad29fa4", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["0a8243eeeb17cc1d1ca52ecbad6763ec4543b52c"], "nameRev": "0d16f7734511632970eeb0c7b1bf28c41ad29fa4 tags/v2.5.1-candidate-1~3", "commitMessage": "Fixed avro schema decode error in functions (#6662)\n\nFixes #5503\nFrom #6445\n\nIn functions, it will encounter ```ClassCastException``` when using the Avro schema for topics.\n\n```\nException in thread \"main\" java.lang.ClassCastException: org.apache.pulsar.shade.org.apache.avro.generic.GenericData$Record cannot be cast to io.streamnative.KeyValueSchemaTest$Foo2\n\tat io.streamnative.KeyValueSchemaTest.testConsumerByPythonProduce(KeyValueSchemaTest.java:412)\n\tat io.streamnative.KeyValueSchemaTest.main(KeyValueSchemaTest.java:305)\n```\n\nIn functions, when using Avro schema specific the ClassLoader for ReflectDatumReader.\n\nAdd integration test ```testAvroSchemaFunction``` in class ```PulsarFunctionsTest```.\n\n(cherry picked from commit 52ae1823dbcbef95637580c5f3568843232cd379)\n\nHandle conflict\n", "commitDateTime": "2020-04-05 16:15:54", "authoredDateTime": "2020-04-05 08:33:42", "commitGitStats": [{"filePath": ".github/workflows/ci-unit-broker.yml", "insertions": 145, "deletions": 0, "lines": 145}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AvroSchema.java", "insertions": 19, "deletions": 8, "lines": 27}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/reader/AvroReader.java", "insertions": 31, "deletions": 2, "lines": 33}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/JavaInstanceRunnable.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/PulsarSource.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/AvroSchemaTestFunction.java", "insertions": 36, "deletions": 0, "lines": 36}, {"filePath": "pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/WindowDurationFunction.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/pojo/AvroTestObject.java", "insertions": 32, "deletions": 0, "lines": 32}, {"filePath": "tests/docker-images/latest-version-image/conf/bookie.conf", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTest.java", "insertions": 128, "deletions": 3, "lines": 131}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleGetSchema(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetSchema)", "TOT": 4, "UPD": 1, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema", "TOT": 4, "UPD": 1, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.clone()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.of(java.lang.Class,java.util.Map)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.of(org.apache.pulsar.client.api.schema.SchemaDefinition)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.loadReader(org.apache.pulsar.common.protocol.schema.BytesSchemaVersion)", "TOT": 3, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroReader.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.reader.AvroReader", "TOT": 9, "UPD": 0, "INS": 5, "MOV": 4, "DEL": 0}]}, {"spoonFilePath": "JavaInstanceRunnable.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.instance.JavaInstanceRunnable.loadJars()", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarSource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.PulsarSource.open(java.util.Map,org.apache.pulsar.io.core.SourceContext)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroSchemaTestFunction.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.api.examples.AvroSchemaTestFunction", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "WindowDurationFunction.java", "spoonMethods": []}, {"spoonFilePath": "AvroTestObject.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.api.examples.pojo.AvroTestObject", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarFunctionsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testWindowFunction(java.lang.String,java.lang.String[])", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testAvroSchemaFunction()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "d60eebf48c48dc9f6d8135accf66c5440ceadfc5", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["3f4c0e3393db47ee2a02185db2208c1581b22ad8"], "nameRev": "d60eebf48c48dc9f6d8135accf66c5440ceadfc5 tags/v2.5.1-candidate-3~9", "commitMessage": "Fixed avro schema decode error in functions (#6662)\n\nFixes #5503\nFrom #6445\n\nIn functions, it will encounter ```ClassCastException``` when using the Avro schema for topics.\n\n```\nException in thread \"main\" java.lang.ClassCastException: org.apache.pulsar.shade.org.apache.avro.generic.GenericData$Record cannot be cast to io.streamnative.KeyValueSchemaTest$Foo2\n\tat io.streamnative.KeyValueSchemaTest.testConsumerByPythonProduce(KeyValueSchemaTest.java:412)\n\tat io.streamnative.KeyValueSchemaTest.main(KeyValueSchemaTest.java:305)\n```\n\nIn functions, when using Avro schema specific the ClassLoader for ReflectDatumReader.\n\nAdd integration test ```testAvroSchemaFunction``` in class ```PulsarFunctionsTest```.\n\n(cherry picked from commit 52ae1823dbcbef95637580c5f3568843232cd379)\n\nHandle conflict\n", "commitDateTime": "2020-04-13 11:41:00", "authoredDateTime": "2020-04-05 08:33:42", "commitGitStats": [{"filePath": ".github/workflows/ci-unit-broker.yml", "insertions": 145, "deletions": 0, "lines": 145}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AvroSchema.java", "insertions": 19, "deletions": 8, "lines": 27}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/reader/AvroReader.java", "insertions": 31, "deletions": 2, "lines": 33}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/JavaInstanceRunnable.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/PulsarSource.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/AvroSchemaTestFunction.java", "insertions": 36, "deletions": 0, "lines": 36}, {"filePath": "pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/WindowDurationFunction.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-functions/java-examples/src/main/java/org/apache/pulsar/functions/api/examples/pojo/AvroTestObject.java", "insertions": 32, "deletions": 0, "lines": 32}, {"filePath": "tests/docker-images/latest-version-image/conf/bookie.conf", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTest.java", "insertions": 128, "deletions": 3, "lines": 131}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleGetSchema(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetSchema)", "TOT": 4, "UPD": 1, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema", "TOT": 4, "UPD": 1, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.clone()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.of(java.lang.Class,java.util.Map)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.of(org.apache.pulsar.client.api.schema.SchemaDefinition)", "TOT": 4, "UPD": 1, "INS": 2, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.loadReader(org.apache.pulsar.common.protocol.schema.BytesSchemaVersion)", "TOT": 3, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroReader.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.reader.AvroReader", "TOT": 9, "UPD": 0, "INS": 5, "MOV": 4, "DEL": 0}]}, {"spoonFilePath": "JavaInstanceRunnable.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.instance.JavaInstanceRunnable.loadJars()", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarSource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.PulsarSource.open(java.util.Map,org.apache.pulsar.io.core.SourceContext)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroSchemaTestFunction.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.api.examples.AvroSchemaTestFunction", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "WindowDurationFunction.java", "spoonMethods": []}, {"spoonFilePath": "AvroTestObject.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.api.examples.pojo.AvroTestObject", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarFunctionsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testWindowFunction(java.lang.String,java.lang.String[])", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.testAvroSchemaFunction()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[website] Broken links to some download packages", "body": "**Describe the bug**\r\nWhen I check the Pulsar website with link check tool, I've found some broken links to download packages. I've fixed the ones i could. Could someone give some help on the ones with red boxes? The following is part of the report from https://www.drlinkcheck.com/\r\n![image](https://user-images.githubusercontent.com/47805623/67756694-6be81400-fa75-11e9-9e3d-f66fefb33ad0.png)\r\n", "url": "https://github.com/apache/pulsar/issues/5493", "user": "Jennifer88huang", "labels": ["type/bug"], "created": "2019-10-29 09:57:09", "closed": "2019-10-30 14:39:39", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Python API: create_reader() argument `reader_listener` causes exception", "body": "**Describe the bug**\r\nPython API describes option `reader_listener` but it causes an exception when used.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\n```\r\nimport pulsar\r\n\r\nclient = pulsar.Client('pulsar://localhost:6650')\r\n\r\nmsg_id = pulsar.MessageId.earliest\r\n\r\ndef foo(*a, **b):\r\n    pass\r\nreader = client.create_reader('my-topic', msg_id, reader_listener=foo)\r\n\r\nwhile True:\r\n    msg = reader.read_next()\r\n    print(\"Received message %r id=%s\" % (msg.data(), msg.message_id()))\r\n```\r\n\r\nGenerates the following exception:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"read.py\", line 9, in <module>\r\n    reader = client.create_reader('my-topic', msg_id, reader_listener=foo)\r\n  File \"/usr/local/lib/python3.6/dist-packages/pulsar/__init__.py\", line 684, in create_reader\r\n    conf.reader_listener(_listener_wrapper(reader_listener, schema))\r\nAttributeError: 'ReaderConfiguration' object has no attribute 'reader_listener'\r\n```\r\n\r\n**Expected behavior**\r\nTo configure reader successfully\r\n\r\n**Screenshots**\r\nN/A\r\n\r\n**Desktop (please complete the following information):**\r\nN/A\r\n\r\n**Additional context**\r\n\r\nIssue separated out from #5365 \r\n\r\n`pulsar-client-cpp/python/src/config.cc` says:\r\n\r\n```\r\n    class_<ReaderConfiguration>(\"ReaderConfiguration\")\r\n            .def(\"message_listener\", &ReaderConfiguration_setReaderListener, return_self<>())\r\n```\r\n\r\nBut the python code in `pulsar-client-cpp/python/pulsar/__init__.py` calls `conf.reader_listener` instead:\r\n\r\n```\r\n        conf = _pulsar.ReaderConfiguration()\r\n        if reader_listener:\r\n            conf.reader_listener(_listener_wrapper(reader_listener, schema))\r\n```\r\n\r\nI suspect the former is a typo and should change to `.def(\"reader_listener\")`\r\n\r\n(I don't have a build env setup to test this.  Also, probably should have a test case adding to pick this problem up)", "url": "https://github.com/apache/pulsar/issues/5484", "user": "candlerb", "labels": ["component/python", "triage/week-43", "type/bug"], "created": "2019-10-28 13:45:05", "closed": "2019-10-29 15:01:36", "commits": {"6df7cec62148c75ff9eb6f162985eeb33891a3a0": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "4094d451057066cdc14de3a1d7ff9f06eb4c0cf1": {"commitGHEventType": "referenced", "commitUser": "wolfstudy"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "6df7cec62148c75ff9eb6f162985eeb33891a3a0", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["080d31e8f37bd12fc3ce83a33548accfd18b4421"], "nameRev": "6df7cec62148c75ff9eb6f162985eeb33891a3a0 tags/v2.5.0-candidate-1~161", "commitMessage": "Python API: fix reader_listener option (#5487)\n\nFixes #5484", "commitDateTime": "2019-10-29 23:01:35", "authoredDateTime": "2019-10-29 15:01:35", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/src/config.cc", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "4094d451057066cdc14de3a1d7ff9f06eb4c0cf1", "commitGHEventType": "referenced", "commitUser": "wolfstudy", "commitParents": ["153d190aed731529be2ddf65830fe028a2dbf2b0"], "nameRev": "4094d451057066cdc14de3a1d7ff9f06eb4c0cf1 tags/v2.4.2-candidate-1~22", "commitMessage": "Python API: fix reader_listener option (#5487)\n\nFixes #5484\n\n(cherry picked from commit 6df7cec62148c75ff9eb6f162985eeb33891a3a0)\n", "commitDateTime": "2019-11-19 19:53:03", "authoredDateTime": "2019-10-29 15:01:35", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/src/config.cc", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Message deduplication is not well handled when batching is enabled with external provided sequenceId", "body": "**Describe the bug**\r\n\r\nCurrent implementation of Pulsar producer doesn't check the sequenceId when adding messages to a batch container. That results in violations to idempotent producing with external sequenceId.\r\n\r\n**To Reproduce**\r\n\r\n- provide 10 message with sequenceId from 0-9\r\n- provide 10 message with sequenceId from 0-9 again\r\n- flush the producer\r\n- these 20 messages will be received by the consumer\r\n\r\n**Expected behavior**\r\n\r\nThe second 10 messages will not be added to container, because they are duplicated. We can throw exceptions to client to indicate that it adds out-of-order sequence ids.\r\n\r\n**Additional context**\r\n\r\nThere are a couple places requires attentions regarding handling batched messages with external sequenceId.\r\n\r\n1) The logic to maintain `lastPublishedSequenceId` is incorrect when using external sequenceId : `lastSequenceIdPublished = op.sequenceId + op.numMessagesInBatch - 1;`. Because the last sequence id is an external sequence id, which can't be computed by adding the number of messages in the batch.\r\n\r\n2) We only maintain `lastPublishedSequenceId` (which is the acked seequence id). We also need to maintain a `lastPushSequenceId` to indicate the last sequence id that a producer sends to the broker.\r\n\r\n3) the broker need to handle the first sequence id and last sequence id in a message batch.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5476", "user": "sijie", "labels": ["component/client", "triage/week-44", "type/bug"], "created": "2019-10-28 04:11:18", "closed": "2019-11-13 02:42:17", "commits": {"d3cb108590713735ef1b23ff61997bf68e0fd7f3": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 15.000277777777777, "commitsDetails": [{"commitHash": "d3cb108590713735ef1b23ff61997bf68e0fd7f3", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f8e91a261fe28337eb748887bdcd10677ab01ced"], "nameRev": "d3cb108590713735ef1b23ff61997bf68e0fd7f3 tags/v2.5.0-candidate-1~93", "commitMessage": "[Issue 5476]Fix message deduplicate issue while using external sequence id with batch produce (#5491)\n\nFixes #5476 \r\n\r\n### Motivation\r\n\r\nFix #5476\r\n\r\n### Modifications\r\n\r\n1. Add `last_sequence_id` in MessageMetadata and CommandSend, use sequence id and last_sequence_id  to indicate the batch `lowest_sequence_id` and `highest_sequence_id`.\r\n2. Handle batch message deduplicate check in MessageDeduplication\r\n3. Response the `last_sequence_id` to client and add message deduplicate check in client", "commitDateTime": "2019-11-13 10:42:16", "authoredDateTime": "2019-11-13 10:42:16", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Producer.java", "insertions": 74, "deletions": 8, "lines": 82}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 6, "deletions": 1, "lines": 7}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Topic.java", "insertions": 14, "deletions": 2, "lines": 16}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/MessageDeduplication.java", "insertions": 8, "deletions": 4, "lines": 12}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentReplicator.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/MessageDuplicationTest.java", "insertions": 43, "deletions": 0, "lines": 43}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/ClientDeduplicationTest.java", "insertions": 106, "deletions": 0, "lines": 106}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageContainerImpl.java", "insertions": 18, "deletions": 7, "lines": 25}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 65, "deletions": 21, "lines": 86}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/proto/PulsarApi.java", "insertions": 114, "deletions": 0, "lines": 114}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Commands.java", "insertions": 31, "deletions": 0, "lines": 31}, {"filePath": "pulsar-common/src/main/proto/PulsarApi.proto", "insertions": 6, "deletions": 0, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Producer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.Producer.publishMessage(long,long,io.netty.buffer.ByteBuf,long)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.MessagePublishContext.recycle()", "TOT": 14, "UPD": 5, "INS": 5, "MOV": 4, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.MessagePublishContext.get(org.apache.pulsar.broker.service.Producer,long,org.apache.bookkeeper.mledger.util.Rate,int,long,long)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.MessagePublishContext.completed(java.lang.Exception,long,long)", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.publishMessage(long,long,long,io.netty.buffer.ByteBuf,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.publishMessageToTopic(io.netty.buffer.ByteBuf,long,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.publishMessageToTopic(io.netty.buffer.ByteBuf,long,long,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.MessagePublishContext", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.MessagePublishContext.getHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.MessagePublishContext.setOriginalHighestSequenceId(long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.MessagePublishContext.getOriginalHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.MessagePublishContext.get(org.apache.pulsar.broker.service.Producer,long,long,org.apache.bookkeeper.mledger.util.Rate,int,long,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.Producer.MessagePublishContext.run()", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleSend(org.apache.pulsar.common.api.proto.PulsarApi.CommandSend,io.netty.buffer.ByteBuf)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "Topic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.getSequenceId()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.getOriginalSequenceId()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.getHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.setOriginalHighestSequenceId(long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.getOriginalHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MessageDeduplication.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.MessageDeduplication.isDuplicate(org.apache.pulsar.broker.service.Topic.PublishContext,io.netty.buffer.ByteBuf)", "TOT": 4, "UPD": 1, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.MessageDeduplication.recordMessagePersisted(org.apache.pulsar.broker.service.Topic.PublishContext,org.apache.bookkeeper.mledger.impl.PositionImpl)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.MessageDeduplication.replayCursor(java.util.concurrent.CompletableFuture).1.readEntriesComplete(java.util.List,java.lang.Object)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PersistentReplicator.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentReplicator.ProducerSendCallback.sendComplete(java.lang.Exception)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "MessageDuplicationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.MessageDuplicationTest.getPublishContext(java.lang.String,long,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.MessageDuplicationTest.testIsDuplicate()", "TOT": 15, "UPD": 0, "INS": 15, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ClientDeduplicationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.ClientDeduplicationTest.testProducerDeduplicationWithDiscontinuousSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.ClientDeduplicationTest.testProducerDeduplicationNonBatchAsync()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchMessageContainerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl", "TOT": 3, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.clear()", "TOT": 3, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.add(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.client.impl.SendCallback)", "TOT": 4, "UPD": 1, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.discard(java.lang.Exception)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.createOpSendMsg()", "TOT": 10, "UPD": 2, "INS": 6, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.sendMessage(long,long,int,org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata,io.netty.buffer.ByteBuf)", "TOT": 15, "UPD": 1, "INS": 1, "MOV": 9, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl", "TOT": 8, "UPD": 3, "INS": 3, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.OpSendMsg.recycle()", "TOT": 4, "UPD": 2, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.ackReceived(org.apache.pulsar.client.impl.ClientCnx,long,long,long)", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.getChecksumType()", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.getHighestSequenceId(org.apache.pulsar.client.impl.ProducerImpl$OpSendMsg)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.sendMessage(long,long,long,int,org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata,io.netty.buffer.ByteBuf)", "TOT": 9, "UPD": 0, "INS": 9, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.OpSendMsg", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.OpSendMsg.create(java.util.List,org.apache.pulsar.common.protocol.ByteBufPair,long,long,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.processOpSendMsg(org.apache.pulsar.client.impl.ProducerImpl$OpSendMsg)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.sendAsync(org.apache.pulsar.client.api.Message,org.apache.pulsar.client.impl.SendCallback)", "TOT": 12, "UPD": 0, "INS": 5, "MOV": 7, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.recoverChecksumError(org.apache.pulsar.client.impl.ClientCnx,long)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PulsarApi.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.hasHighestSequenceId()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.getHighestSequenceId()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.hasHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.getHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.hasHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.getHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.initFields()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.writeTo(org.apache.pulsar.common.util.protobuf.ByteBufCodedOutputStream)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.getSerializedSize()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.hasHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.getHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.setHighestSequenceId(long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.clearHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.initFields()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.writeTo(org.apache.pulsar.common.util.protobuf.ByteBufCodedOutputStream)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.getSerializedSize()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.Builder", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.Builder.hasHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.Builder.getHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.Builder.setHighestSequenceId(long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.Builder.clearHighestSequenceId()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.clear()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.buildPartial()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.mergeFrom(org.apache.pulsar.common.api.proto.PulsarApi$MessageMetadata)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.Builder.clear()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.Builder.buildPartial()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.Builder.mergeFrom(org.apache.pulsar.common.api.proto.PulsarApi$CommandSend)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.mergeFrom(org.apache.pulsar.common.util.protobuf.ByteBufCodedInputStream,org.apache.pulsar.shaded.com.google.protobuf.v241.ExtensionRegistryLite)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandSend.Builder.mergeFrom(org.apache.pulsar.common.util.protobuf.ByteBufCodedInputStream,org.apache.pulsar.shaded.com.google.protobuf.v241.ExtensionRegistryLite)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Commands.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.protocol.Commands.newSend(long,long,long,int,org.apache.pulsar.common.protocol.Commands$ChecksumType,org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata,io.netty.buffer.ByteBuf)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.protocol.Commands.newSend(long,long,long,int,long,long,org.apache.pulsar.common.protocol.Commands$ChecksumType,org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata,io.netty.buffer.ByteBuf)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Doc display issue on message deduplication page", "body": "**Describe the bug**\r\nThere are some display issues at http://pulsar.apache.org/docs/en/cookbooks-deduplication/\r\nSee the following images\r\n![image](https://user-images.githubusercontent.com/47805623/67651354-8ccc3e80-f97b-11e9-91d9-bdde4a990b3f.png)\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5475", "user": "Jennifer88huang", "labels": ["component/documentation", "type/bug"], "created": "2019-10-28 04:07:54", "closed": "2019-10-31 20:09:26", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "[Pulsar Functions] User class constructor throws exception", "body": "**Describe the bug**\r\n\r\nA few days ago, I could use this command to create a function instance correctly, \r\n```\r\n./bin/pulsar-admin functions create --retain-ordering --jar /Downloads/pulsar-util-function-api-pack-0.10.2-all.jar --classname ru.alfabank.api.utils.JournalBatchParseFunction --output-serde-classname ru.alfabank.api.utils.JournalBatchSerde --inputs test-input-topic --output test-output-topic --name test-serde-name\r\n```\r\n\r\nbut now I re-use the same command, the creation fails, the error is as follows:\r\n\r\n```\r\n12:00:50.493 [public/default/test-serde-xiaolong-0] INFO  org.apache.pulsar.functions.instance.JavaInstanceRunnable - Load JAR: /tmp/pulsar_functions/public/default/test-serde-xiaolong/0/pulsar-util-function-api-pack-0.10.2-all.jar\r\n12:00:50.548 [public/default/test-serde-xiaolong-0] WARN  org.apache.pulsar.common.nar.NarClassLoader - /var/folders/qz/g2fh76dx5rj4q_fbkfh1q3th0000gn/T/pulsar-nar/pulsar-util-function-api-pack-0.10.2-all.jar-unpacked does not contain META-INF/bundled-dependencies!\r\n12:00:50.549 [public/default/test-serde-xiaolong-0] INFO  org.apache.pulsar.functions.instance.JavaInstanceRunnable - Initialize function class loader for function test-serde-xiaolong at function cache manager\r\n12:00:50.553 [public/default/test-serde-xiaolong-0] ERROR org.apache.pulsar.functions.instance.JavaInstanceRunnable - [public/default/test-serde-xiaolong:0] Uncaught exception in Java Instance\r\njava.lang.RuntimeException: User class constructor throws exception\r\n\tat org.apache.pulsar.functions.utils.Reflections.createInstance(Reflections.java:131) ~[pulsar-functions-utils.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupJavaInstance(JavaInstanceRunnable.java:195) ~[pulsar-functions-instance.jar:?]\r\n\tat org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:242) [pulsar-functions-instance.jar:?]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_201]\r\nCaused by: java.lang.reflect.InvocationTargetException\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) ~[?:1.8.0_201]\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62) ~[?:1.8.0_201]\r\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) ~[?:1.8.0_201]\r\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:423) ~[?:1.8.0_201]\r\n\tat org.apache.pulsar.functions.utils.Reflections.createInstance(Reflections.java:123) ~[pulsar-functions-utils.jar:2.5.0-SNAPSHOT]\r\n\t... 3 more\r\nCaused by: java.lang.NoClassDefFoundError: com/ibm/as400/access/AS400Bin4\r\n\tat ru.alfabank.utils.eq.journal.JournalBatchParser.<init>(JournalBatchParser.java:24) ~[?:?]\r\n\tat ru.alfabank.utils.eq.journal.JournalBatchParser.defaultParser(JournalBatchParser.java:50) ~[?:?]\r\n\tat ru.alfabank.api.utils.JournalBatchParseFunction.<init>(JournalBatchParseFunction.java:13) ~[?:?]\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) ~[?:1.8.0_201]\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62) ~[?:1.8.0_201]\r\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) ~[?:1.8.0_201]\r\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:423) ~[?:1.8.0_201]\r\n\tat org.apache.pulsar.functions.utils.Reflections.createInstance(Reflections.java:123) ~[pulsar-functions-utils.jar:2.5.0-SNAPSHOT]\r\n\t... 3 more\r\n```\r\n\r\n**To Reproduce**\r\n\r\nThis problem does not seem to be stable and reproducible.\r\n\r\n**Expected behavior**\r\n\r\nCan always create functions correctly.\r\n\r\n**Screenshots**\r\n\r\n![image](https://user-images.githubusercontent.com/20965307/67563111-a3438180-f752-11e9-8f23-e7fe1eecac38.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Mac OS\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/5465", "user": "wolfstudy", "labels": ["triage/week-49", "type/bug"], "created": "2019-10-25 10:10:19", "closed": "2019-12-27 08:05:46", "commits": {}, "ttf": 62.000277777777775, "commitsDetails": []}, {"title": "macOS 10.15 support", "body": "**Describe the bug**\r\npip install pulsar-client==2.4.1 on macOS 10.15 results in:\r\nImportError: dlopen(/Users/ericnielson/venv/lib/python3.7/site-packages/_pulsar.cpython-37m-darwin.so, 2): Library not loaded: /usr/local/opt/protobuf/lib/libprotobuf-lite.20.dylib\r\n  Referenced from: /Users/ericnielson/venv/lib/python3.7/site-packages/_pulsar.cpython-37m-darwin.so\r\n  Reason: image not found\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. on macOS 10.15 $ pip install pulsar-client==2.4.1\r\n2. Write .py with \"import pulsar\"\r\n3. Try to run \r\n4. See error\r\n\r\n**Expected behavior**\r\ni would expect this to run\r\n\r\noutput from pip install:\r\nericnielson:~ ericnielson$ pip install pulsar-client==2.4.1\r\nRequirement already satisfied: pulsar-client==2.4.1 in /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (2.4.1)\r\nRequirement already satisfied: certifi in /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (from pulsar-client==2.4.1) (2018.11.29)\r\nRequirement already satisfied: protobuf>=3.6.1 in /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (from pulsar-client==2.4.1) (3.10.0)\r\nRequirement already satisfied: prometheus-client in /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (from pulsar-client==2.4.1) (0.7.1)\r\nRequirement already satisfied: six in ./Library/Python/3.7/lib/python/site-packages (from pulsar-client==2.4.1) (1.11.0)\r\nRequirement already satisfied: apache-bookkeeper-client>=4.9.2 in /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (from pulsar-client==2.4.1) (4.9.2)\r\nRequirement already satisfied: grpcio in /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (from pulsar-client==2.4.1) (1.18.0)\r\nRequirement already satisfied: ratelimit in /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (from pulsar-client==2.4.1) (2.2.1)\r\nRequirement already satisfied: fastavro in /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (from pulsar-client==2.4.1) (0.22.5)\r\nRequirement already satisfied: setuptools in /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (from protobuf>=3.6.1->pulsar-client==2.4.1) (40.6.2)\r\nRequirement already satisfied: pytz in ./Library/Python/3.7/lib/python/site-packages (from apache-bookkeeper-client>=4.9.2->pulsar-client==2.4.1) (2018.9)\r\nRequirement already satisfied: requests<3.0.0dev,>=2.18.0 in ./Library/Python/3.7/lib/python/site-packages (from apache-bookkeeper-client>=4.9.2->pulsar-client==2.4.1) (2.22.0)\r\nRequirement already satisfied: pymmh3>=0.0.3 in /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (from apache-bookkeeper-client>=4.9.2->pulsar-client==2.4.1) (0.0.5)\r\nRequirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (from requests<3.0.0dev,>=2.18.0->apache-bookkeeper-client>=4.9.2->pulsar-client==2.4.1) (1.24.1)\r\nRequirement already satisfied: chardet<3.1.0,>=3.0.2 in /Library/Frameworks/Python.framework/Versions/3.7/lib/python3.7/site-packages (from requests<3.0.0dev,>=2.18.0->apache-bookkeeper-client>=4.9.2->pulsar-client==2.4.1) (3.0.4)\r\nRequirement already satisfied: idna<2.9,>=2.5 in ./Library/Python/3.7/lib/python/site-packages (from requests<3.0.0dev,>=2.18.0->apache-bookkeeper-client>=4.9.2->pulsar-client==2.4.1) (2.7)\r\n", "url": "https://github.com/apache/pulsar/issues/5459", "user": "e14nielson", "labels": ["triage/week-43", "type/bug"], "created": "2019-10-24 18:55:33", "closed": "2020-04-21 16:59:34", "commits": {}, "ttf": 179.00027777777777, "commitsDetails": []}, {"title": "mysql JDBC Sink - consumer error", "body": "**Describe the bug**\r\nRunning mysql jdbc sink (helped in issue #5418)  but unable to receive data from producer.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Define Test schema and send producer data\r\n\r\n        class Test(Record):\r\n            id = Integer()\r\n            name = String()\r\n\r\n        producer = client.create_producer(\r\n                        'pulsar-mysql-jdbc-sink-topic',\r\n                        schema=AvroSchema(Test))\r\n\r\n2. Receiving error in SINK logs:\r\n\r\n19:25:55.712 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [pulsar-mysql-jdbc-sink-topic][public/default/pulsar-mysql-jdbc-sink] Subscribing to topic on cnx [id: 0x79b6a514, L:/135.25.67.33:33184 - R:mtn21cvaas04.mt.att.com/135.25.67.33:6650]\r\n19:25:55.734 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [pulsar-mysql-jdbc-sink-topic][public/default/pulsar-mysql-jdbc-sink] Subscribed to topic on mtn21cvaas04.mt.att.com/135.25.67.33:6650 -- consumer: 0\r\n\r\n\r\n19:29:41.376 [pulsar-client-io-1-1] WARN  com.scurrilous.circe.checksum.Crc32cIntChecksum - Failed to load Circe JNI library. Falling back to Java based CRC32c provider\r\n19:29:41.427 [public/default/pulsar-mysql-jdbc-sink-0] ERROR org.apache.pulsar.functions.instance.JavaInstanceRunnable - [public/default/pulsar-mysql-jdbc-sink:0] Uncaught exception in Java Instance\r\njava.lang.NullPointerException: null\r\n        at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:770) ~[com.google.guava-guava-21.0.jar:?]\r\n        at com.google.common.cache.LocalCache.get(LocalCache.java:4153) ~[com.google.guava-guava-21.0.jar:?]\r\n        at com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:4158) ~[com.google.guava-guava-21.0.jar:?]\r\n        at com.google.common.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:5147) ~[com.google.guava-guava-21.0.jar:?]\r\n        at org.apache.pulsar.client.impl.schema.StructSchema.decode(StructSchema.java:94) ~[org.apache.pulsar-pulsar-client-original-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.client.impl.schema.AutoConsumeSchema.decode(AutoConsumeSchema.java:72) ~[org.apache.pulsar-pulsar-client-original-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.client.impl.schema.AutoConsumeSchema.decode(AutoConsumeSchema.java:36) ~[org.apache.pulsar-pulsar-client-original-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.client.api.Schema.decode(Schema.java:97) ~[java-instance.jar:?]\r\n        at org.apache.pulsar.client.impl.MessageImpl.getValue(MessageImpl.java:268) ~[org.apache.pulsar-pulsar-client-original-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.source.PulsarRecord.getValue(PulsarRecord.java:74) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.readInput(JavaInstanceRunnable.java:463) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:236) [org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n19:29:41.504 [public/default/pulsar-mysql-jdbc-sink-0] INFO  org.apache.pulsar.functions.instance.JavaInstanceRunnable - Closing instance\r\n19:29:41.510 [public/default/pulsar-mysql-jdbc-sink-0] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [pulsar-mysql-jdbc-sink-topic] [public/default/pulsar-mysql-jdbc-sink] Closed consumer\r\n19:29:41.512 [public/default/pulsar-mysql-jdbc-sink-0] INFO  org.apache.pulsar.io.jdbc.JdbcAbstractSink - Closed jdbc connection: jdbc:mysql://127.0.0.1:3306/pulsar_mysql_jdbc_sink?useUnicode=true&characterEncoding=utf-8&useSSL=false\r\n19:29:41.518 [public/default/pulsar-mysql-jdbc-sink-0] INFO  org.apache.pulsar.functions.instance.JavaInstanceRunnable - Unloading JAR files for function InstanceConfig(instanceId=0, functionId=5703beea-ca01-446b-8d1a-35167aeb2cac, functionVersion=df4c3460-d718-4684-9109-3d081cfb6f1e, functionDetails=tenant: \"public\"\r\nnamespace: \"default\"\r\nname: \"pulsar-mysql-jdbc-sink\"\r\nclassName: \"org.apache.pulsar.functions.api.utils.IdentityFunction\"\r\nautoAck: true\r\nparallelism: 1\r\nsource {\r\n  typeClassName: \"org.apache.pulsar.client.api.schema.GenericRecord\"\r\n  inputSpecs {\r\n    key: \"pulsar-mysql-jdbc-sink-topic\"\r\n    value {\r\n    }\r\n  }\r\n  cleanupSubscription: true\r\n}\r\nsink {\r\n  className: \"org.apache.pulsar.io.jdbc.JdbcAutoSchemaSink\"\r\n  configs: \"{\\\"userName\\\":\\\"root\\\",\\\"password\\\":\\\"jdbc\\\",\\\"jdbcUrl\\\":\\\"jdbc:mysql://127.0.0.1:3306/pulsar_mysql_jdbc_sink?useUnicode\\\\u003dtrue\\\\u0026characterEncoding\\\\u003dutf-8\\\\u0026useSSL\\\\u003dfalse\\\",\\\"tableName\\\":\\\"pulsar_mysql_jdbc_sink\\\"}\"\r\n  typeClassName: \"org.apache.pulsar.client.api.schema.GenericRecord\"\r\n}\r\nresources {\r\n  cpu: 1.0\r\n  ram: 1073741824\r\n  disk: 10737418240\r\n}\r\ncomponentType: SINK\r\n, maxBufferedTuples=1024, functionAuthenticationSpec=null, port=37644, clusterName=standalone)\r\n19:29:41.518 [main] INFO  org.apache.pulsar.functions.runtime.JavaInstanceStarter - RuntimeSpawner quit, shutting down JavaInstance\r\n19:29:41.520 [main] INFO  org.apache.pulsar.client.impl.PulsarClientImpl - Client closing. URL: pulsar://mtn21cvaas04.mt.att.com:6650\r\n19:29:41.530 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ClientCnx - [id: 0x79b6a514, L:/135.25.67.33:33184 ! R:mtn21cvaas04.mt.att.com/135.25.67.33:6650]\r\nDisconnected\r\n\r\n\r\n**Expected behavior**\r\nExpect to see no error and some record in mysql DB.\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: ubuntu 16.4\r\n\r\n**Additional context**\r\nIt maybe some miss-configuration and not a bug.\r\nSINK is using sample schema provided by pulsar instructions:\r\n\r\n{\r\n  \"type\": \"AVRO\",\r\n  \"schema\": \"{\\\"type\\\":\\\"record\\\",\\\"name\\\":\\\"Test\\\",\\\"fields\\\":[{\\\"name\\\":\\\"id\\\",\\\"type\\\":[\\\"null\\\",\\\"int\\\"]},{\\\"name\\\":\\\"name\\\",\\\"type\\\":[\\\"null\\\",\\\"string\\\"]}]}\",\r\n  \"properties\": {}\r\n}\r\n", "url": "https://github.com/apache/pulsar/issues/5454", "user": "jm7647", "labels": ["triage/week-43", "type/bug"], "created": "2019-10-23 20:26:35", "closed": "2020-01-01 00:55:03", "commits": {"a26f67a2a0c05f7f7f2eb551ef1da9fdbb84ac3b": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "8003d08e5ca325867d2e825921f18ddda8d4e1d4": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "27b369bf451dfe3d511f0f5377a6356cdd07a1d9": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "7ff6b8b7e8cdb062aceca7160ad6806ee5ce9b63": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "13f898ea68f25026a422c6c3fb56bc7fceab21ee": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 69.00027777777778, "commitsDetails": [{"commitHash": "a26f67a2a0c05f7f7f2eb551ef1da9fdbb84ac3b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["d6f90ddc535f24bc5cb061216bb47a97c9f086a8"], "nameRev": "a26f67a2a0c05f7f7f2eb551ef1da9fdbb84ac3b tags/v2.5.0-candidate-2~13", "commitMessage": "[Issue 5454][pulsar-client-cpp]Fix cpp client schema version (#5930)\n\nFixes #5454 \r\n\r\n\r\n### Motivation\r\n\r\nThe current CPP client cannot correctly obtain the schema version, resulting in an error in parsing with java client when sending data with schema using python client.\r\n\r\nTest code:\r\n\r\n```\r\nimport pulsar\r\nimport json\r\n\r\nfrom pulsar.schema import *\r\n\r\nclass Test(Record):\r\n    name = String()\r\n    id = Integer()\r\n\r\nclient = pulsar.Client('pulsar://localhost:6650');\r\nproducer = client.create_producer('test-producer-schema', schema=AvroSchema(Test))\r\nproducer.send(Test(name='Hello', id=1))\r\nclient.close()\r\n```\r\n\r\n\r\n\r\n### Modifications\r\n\r\n* Add set schema version in msgmetadata\r\n\r\n### Verifying this change\r\n\r\nAdd check schema version in unit test SchemaTest", "commitDateTime": "2020-01-01 08:55:02", "authoredDateTime": "2020-01-01 08:55:02", "commitGitStats": [{"filePath": "pulsar-client-cpp/lib/ProducerImpl.cc", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-client-cpp/tests/SchemaTest.cc", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "8003d08e5ca325867d2e825921f18ddda8d4e1d4", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f33567ec6b805a7ae704520ab93ff87b0abb02b6"], "nameRev": "8003d08e5ca325867d2e825921f18ddda8d4e1d4 tags/v2.6.0-candidate-1~434", "commitMessage": "Independent schema is set for each consumer generated by topic (#6356)\n\n### Motivation\r\n\r\nMaster Issue: #5454 \r\n\r\nWhen one Consumer subscribe multi topic, setSchemaInfoPorvider() will be covered by the consumer generated by the last topic.\r\n\r\n### Modification\r\nclone schema for each consumer generated by topic.\r\n### Verifying this change\r\nAdd the schemaTest for it.", "commitDateTime": "2020-03-05 22:28:30", "authoredDateTime": "2020-03-06 14:28:30", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/JsonSchemaCompatibilityCheckTest.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/schema/SchemaTest.java", "insertions": 136, "deletions": 0, "lines": 136}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/schema/{compatibility => }/Schemas.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/schema/compatibility/SchemaCompatibilityCheckTest.java", "insertions": 11, "deletions": 11, "lines": 22}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/Schema.java", "insertions": 8, "deletions": 1, "lines": 9}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/pulsar/client/kafka/compat/PulsarKafkaSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka_0_9/src/main/java/org/apache/pulsar/client/kafka/compat/PulsarKafkaSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 4, "deletions": 3, "lines": 7}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "insertions": 11, "deletions": 10, "lines": 21}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AbstractSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AutoConsumeSchema.java", "insertions": 14, "deletions": 0, "lines": 14}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AutoProduceBytesSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AvroSchema.java", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/KeyValueSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/KeyValueSchemaInfo.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericAvroSchema.java", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericSchemaImpl.java", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/SerDeSchema.java", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "JsonSchemaCompatibilityCheckTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.JsonSchemaCompatibilityCheckTest.OldJSONSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.schema.SchemaTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Schemas.java", "spoonMethods": []}, {"spoonFilePath": "SchemaCompatibilityCheckTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.schema.compatibility.SchemaCompatibilityCheckTest.testConsumerCompatibilityCheckCanReadLastTest(org.apache.pulsar.common.policies.data.SchemaCompatibilityStrategy)", "TOT": 15, "UPD": 5, "INS": 5, "MOV": 0, "DEL": 5}, {"spoonMethodName": "org.apache.pulsar.schema.compatibility.SchemaCompatibilityCheckTest.testIsAutoUpdateSchema(org.apache.pulsar.common.policies.data.SchemaCompatibilityStrategy)", "TOT": 11, "UPD": 3, "INS": 4, "MOV": 0, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.schema.compatibility.SchemaCompatibilityCheckTest.testProducerSendWithOldSchemaAndConsumerCanRead(org.apache.pulsar.common.policies.data.SchemaCompatibilityStrategy)", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "Schema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarKafkaSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.kafka.compat.PulsarKafkaSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.subscribeTopicPartitions(java.util.concurrent.CompletableFuture,java.lang.String,int,boolean)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.doSubscribeTopicPartitions(java.util.concurrent.CompletableFuture,java.lang.String,int,boolean)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.doSubscribeTopicPartitions(org.apache.pulsar.client.api.Schema,java.util.concurrent.CompletableFuture,java.lang.String,int,boolean)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarClientImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.singleTopicSubscribeAsync(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.createReaderAsync(org.apache.pulsar.client.impl.conf.ReaderConfigurationData,org.apache.pulsar.client.api.Schema)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.preProcessSchemaBeforeSubscribe(org.apache.pulsar.client.impl.PulsarClientImpl,org.apache.pulsar.client.api.Schema,java.lang.String)", "TOT": 10, "UPD": 3, "INS": 5, "MOV": 0, "DEL": 2}]}, {"spoonFilePath": "AbstractSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AbstractSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AutoConsumeSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoConsumeSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AutoProduceBytesSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoProduceBytesSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KeyValueSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KeyValueSchemaInfo.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchemaInfo.1.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "GenericAvroSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericAvroSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "GenericSchemaImpl.java", "spoonMethods": []}, {"spoonFilePath": "SerDeSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.SerDeSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "27b369bf451dfe3d511f0f5377a6356cdd07a1d9", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "7ff6b8b7e8cdb062aceca7160ad6806ee5ce9b63", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["6af87b6651f89f6fe1748308d352dfa2a7b66a47"], "nameRev": "7ff6b8b7e8cdb062aceca7160ad6806ee5ce9b63 tags/v2.5.1-candidate-1~49", "commitMessage": "Independent schema is set for each consumer generated by topic (#6356)\n\n### Motivation\r\n\r\nMaster Issue: #5454 \r\n\r\nWhen one Consumer subscribe multi topic, setSchemaInfoPorvider() will be covered by the consumer generated by the last topic.\r\n\r\n### Modification\r\nclone schema for each consumer generated by topic.\r\n### Verifying this change\r\nAdd the schemaTest for it.\n\n(cherry picked from commit 8003d08e5ca325867d2e825921f18ddda8d4e1d4)\n", "commitDateTime": "2020-04-05 10:51:24", "authoredDateTime": "2020-03-06 14:28:30", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/JsonSchemaCompatibilityCheckTest.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/schema/SchemaTest.java", "insertions": 136, "deletions": 0, "lines": 136}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/schema/{compatibility => }/Schemas.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/schema/compatibility/SchemaCompatibilityCheckTest.java", "insertions": 11, "deletions": 11, "lines": 22}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/Schema.java", "insertions": 8, "deletions": 1, "lines": 9}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/pulsar/client/kafka/compat/PulsarKafkaSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka_0_9/src/main/java/org/apache/pulsar/client/kafka/compat/PulsarKafkaSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 4, "deletions": 3, "lines": 7}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "insertions": 11, "deletions": 10, "lines": 21}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AbstractSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AutoConsumeSchema.java", "insertions": 14, "deletions": 0, "lines": 14}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AutoProduceBytesSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AvroSchema.java", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/KeyValueSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/KeyValueSchemaInfo.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericAvroSchema.java", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericSchemaImpl.java", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/SerDeSchema.java", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "JsonSchemaCompatibilityCheckTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.JsonSchemaCompatibilityCheckTest.OldJSONSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.schema.SchemaTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Schemas.java", "spoonMethods": []}, {"spoonFilePath": "SchemaCompatibilityCheckTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.schema.compatibility.SchemaCompatibilityCheckTest.testConsumerCompatibilityCheckCanReadLastTest(org.apache.pulsar.common.policies.data.SchemaCompatibilityStrategy)", "TOT": 15, "UPD": 5, "INS": 5, "MOV": 0, "DEL": 5}, {"spoonMethodName": "org.apache.pulsar.schema.compatibility.SchemaCompatibilityCheckTest.testIsAutoUpdateSchema(org.apache.pulsar.common.policies.data.SchemaCompatibilityStrategy)", "TOT": 11, "UPD": 3, "INS": 4, "MOV": 0, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.schema.compatibility.SchemaCompatibilityCheckTest.testProducerSendWithOldSchemaAndConsumerCanRead(org.apache.pulsar.common.policies.data.SchemaCompatibilityStrategy)", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "Schema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarKafkaSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.kafka.compat.PulsarKafkaSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.subscribeTopicPartitions(java.util.concurrent.CompletableFuture,java.lang.String,int,boolean)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.doSubscribeTopicPartitions(java.util.concurrent.CompletableFuture,java.lang.String,int,boolean)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.doSubscribeTopicPartitions(org.apache.pulsar.client.api.Schema,java.util.concurrent.CompletableFuture,java.lang.String,int,boolean)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarClientImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.singleTopicSubscribeAsync(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.createReaderAsync(org.apache.pulsar.client.impl.conf.ReaderConfigurationData,org.apache.pulsar.client.api.Schema)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.preProcessSchemaBeforeSubscribe(org.apache.pulsar.client.impl.PulsarClientImpl,org.apache.pulsar.client.api.Schema,java.lang.String)", "TOT": 10, "UPD": 3, "INS": 5, "MOV": 0, "DEL": 2}]}, {"spoonFilePath": "AbstractSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AbstractSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AutoConsumeSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoConsumeSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AutoProduceBytesSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoProduceBytesSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KeyValueSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KeyValueSchemaInfo.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchemaInfo.1.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "GenericAvroSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericAvroSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "GenericSchemaImpl.java", "spoonMethods": []}, {"spoonFilePath": "SerDeSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.SerDeSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "13f898ea68f25026a422c6c3fb56bc7fceab21ee", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["b908316c93b59eb7d09ebfc75479a4c1068add99"], "nameRev": "13f898ea68f25026a422c6c3fb56bc7fceab21ee tags/v2.5.1-candidate-3~61", "commitMessage": "Independent schema is set for each consumer generated by topic (#6356)\n\n### Motivation\r\n\r\nMaster Issue: #5454 \r\n\r\nWhen one Consumer subscribe multi topic, setSchemaInfoPorvider() will be covered by the consumer generated by the last topic.\r\n\r\n### Modification\r\nclone schema for each consumer generated by topic.\r\n### Verifying this change\r\nAdd the schemaTest for it.\n\n(cherry picked from commit 8003d08e5ca325867d2e825921f18ddda8d4e1d4)\n", "commitDateTime": "2020-04-13 11:12:17", "authoredDateTime": "2020-03-06 14:28:30", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/JsonSchemaCompatibilityCheckTest.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/schema/SchemaTest.java", "insertions": 136, "deletions": 0, "lines": 136}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/schema/{compatibility => }/Schemas.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/schema/compatibility/SchemaCompatibilityCheckTest.java", "insertions": 11, "deletions": 11, "lines": 22}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/Schema.java", "insertions": 8, "deletions": 1, "lines": 9}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/pulsar/client/kafka/compat/PulsarKafkaSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka_0_9/src/main/java/org/apache/pulsar/client/kafka/compat/PulsarKafkaSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 4, "deletions": 3, "lines": 7}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "insertions": 11, "deletions": 10, "lines": 21}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AbstractSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AutoConsumeSchema.java", "insertions": 14, "deletions": 0, "lines": 14}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AutoProduceBytesSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AvroSchema.java", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/KeyValueSchema.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/KeyValueSchemaInfo.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericAvroSchema.java", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericSchemaImpl.java", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/SerDeSchema.java", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "JsonSchemaCompatibilityCheckTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.JsonSchemaCompatibilityCheckTest.OldJSONSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.schema.SchemaTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Schemas.java", "spoonMethods": []}, {"spoonFilePath": "SchemaCompatibilityCheckTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.schema.compatibility.SchemaCompatibilityCheckTest.testConsumerCompatibilityCheckCanReadLastTest(org.apache.pulsar.common.policies.data.SchemaCompatibilityStrategy)", "TOT": 15, "UPD": 5, "INS": 5, "MOV": 0, "DEL": 5}, {"spoonMethodName": "org.apache.pulsar.schema.compatibility.SchemaCompatibilityCheckTest.testIsAutoUpdateSchema(org.apache.pulsar.common.policies.data.SchemaCompatibilityStrategy)", "TOT": 11, "UPD": 3, "INS": 4, "MOV": 0, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.schema.compatibility.SchemaCompatibilityCheckTest.testProducerSendWithOldSchemaAndConsumerCanRead(org.apache.pulsar.common.policies.data.SchemaCompatibilityStrategy)", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "Schema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarKafkaSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.kafka.compat.PulsarKafkaSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.subscribeTopicPartitions(java.util.concurrent.CompletableFuture,java.lang.String,int,boolean)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.doSubscribeTopicPartitions(java.util.concurrent.CompletableFuture,java.lang.String,int,boolean)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.doSubscribeTopicPartitions(org.apache.pulsar.client.api.Schema,java.util.concurrent.CompletableFuture,java.lang.String,int,boolean)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarClientImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.singleTopicSubscribeAsync(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.createReaderAsync(org.apache.pulsar.client.impl.conf.ReaderConfigurationData,org.apache.pulsar.client.api.Schema)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.preProcessSchemaBeforeSubscribe(org.apache.pulsar.client.impl.PulsarClientImpl,org.apache.pulsar.client.api.Schema,java.lang.String)", "TOT": 10, "UPD": 3, "INS": 5, "MOV": 0, "DEL": 2}]}, {"spoonFilePath": "AbstractSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AbstractSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AutoConsumeSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoConsumeSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AutoProduceBytesSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoProduceBytesSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AvroSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AvroSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KeyValueSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KeyValueSchemaInfo.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchemaInfo.1.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "GenericAvroSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.generic.GenericAvroSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "GenericSchemaImpl.java", "spoonMethods": []}, {"spoonFilePath": "SerDeSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.SerDeSchema.clone()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 3, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 2, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0.0, "deletions": 0.0, "lines": 0.0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0.0, "UPD": 0.0, "INS": 0.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "PersistentTopicMessagingTest and NonPersistentTopicMessagingTest broken and not running", "body": "Describe the bug\r\nTopic integration tests in PersistentTopicMessagingTest and NonPersistentTopicMessagingTest are not run because they are not added in https://github.com/apache/pulsar/blob/master/tests/integration/src/test/resources/pulsar.xml.\r\n\r\nSome of the tests also appear to be broken", "url": "https://github.com/apache/pulsar/issues/5452", "user": "jerrypeng", "labels": ["triage/week-43", "type/bug"], "created": "2019-10-23 18:39:19", "closed": "2019-10-27 17:32:10", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "Topic do not always expire as expected", "body": "**Describe the bug**\r\nI have 5 pulsar clusters with geo-replication. All running version 2.4.1.\r\nThey are called \"region1\", \"region2\", \"region3\", \"region4\", \"region5\".\r\nEach cluster has 5 brokers / 3 bookies / 3 zookeeper / 3 global zookeeper\r\n\r\nMy brokers are configured with:\r\n```\r\n    managedLedgerDefaultEnsembleSize: \"2\"\r\n    managedLedgerDefaultWriteQuorum: \"2\"\r\n    managedLedgerDefaultAckQuorum: \"2\"\r\n    deduplicationEnabled: \"false\"\r\n    defaultNumberOfNamespaceBundles: \"24\"\r\n    loadBalancerSheddingEnabled: \"true\"\r\n    loadBalancerAutoBundleSplitEnabled: \"true\"\r\n    loadBalancerAutoUnloadSplitBundlesEnabled: \"true\"\r\n    loadBalancerNamespaceMaximumBundles: \"256\"\r\n    loadBalancerNamespaceBundleMaxTopics: \"4000\"\r\n    loadBalancerNamespaceBundleMaxSessions: \"10000\"\r\n    loadBalancerNamespaceBundleMaxMsgRate: \"75000\"\r\n    loadBalancerNamespaceBundleMaxBandwidthMbytes: \"100\"\r\n    ttlDurationDefaultInSeconds: \"300\"\r\n    brokerDeleteInactiveTopicsEnabled: \"true\"\r\n    brokerDeleteInactiveTopicsFrequencySeconds: \"60\"\r\n    brokerServicePurgeInactiveFrequencyInSeconds: \"30\"\r\n    subscriptionExpirationTimeMinutes: \"1\"\r\n    messageExpiryCheckIntervalInMinutes: \"1\"\r\n    subscriptionExpiryCheckIntervalInMinutes: \"1\"\r\n```\r\n\r\nI have non partitioned persistent topics in a namespace \"tenant/namespace\" allowed in all 5 regions. Everything worked well at the beginning. I sent quite some traffic to the services using pulsar and at some point it seems a broker in one region (\"region2\") got some issues (got like frozen, trying to see if related to some issues like 3630).\r\nSo re-routed all the traffic to previous system not involving pulsar and started to look to logs and stats. And I notice I have a lot of topics without any subscription that are not deleted after expiration (here from region2):\r\n\r\n```\r\npulsar-admin topics stats persistent://tenant/namespace/topic-056d26b5\r\n{\r\n  \"msgRateIn\" : 0.0,\r\n  \"msgThroughputIn\" : 0.0,\r\n  \"msgRateOut\" : 0.0,\r\n  \"msgThroughputOut\" : 0.0,\r\n  \"averageMsgSize\" : 0.0,\r\n  \"storageSize\" : 0,\r\n  \"publishers\" : [ ],\r\n  \"subscriptions\" : { },\r\n  \"replication\" : {\r\n    \"region1\" : {\r\n      \"msgRateIn\" : 0.0,\r\n      \"msgThroughputIn\" : 0.0,\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateExpired\" : 0.0,\r\n      \"replicationBacklog\" : 0,\r\n      \"connected\" : false,\r\n      \"replicationDelayInSeconds\" : 0,\r\n      \"inboundConnection\" : \"/10.10.3.135:34718\",\r\n      \"inboundConnectedSince\" : \"2019-10-19T23:16:41.231Z\"\r\n    },\r\n    \"region3\" : {\r\n      \"msgRateIn\" : 0.0,\r\n      \"msgThroughputIn\" : 0.0,\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateExpired\" : 0.0,\r\n      \"replicationBacklog\" : 0,\r\n      \"connected\" : false,\r\n      \"replicationDelayInSeconds\" : 0\r\n    },\r\n    \"region4\" : {\r\n      \"msgRateIn\" : 0.0,\r\n      \"msgThroughputIn\" : 0.0,\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateExpired\" : 0.0,\r\n      \"replicationBacklog\" : 0,\r\n      \"connected\" : false,\r\n      \"replicationDelayInSeconds\" : 0\r\n    },\r\n    \"region5\" : {\r\n      \"msgRateIn\" : 0.0,\r\n      \"msgThroughputIn\" : 0.0,\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateExpired\" : 0.0,\r\n      \"replicationBacklog\" : 0,\r\n      \"connected\" : false,\r\n      \"replicationDelayInSeconds\" : 0\r\n    }\r\n  },\r\n  \"deduplicationStatus\" : \"Disabled\"\r\n}\r\n```\r\nIndeed, those topics should have been deleted a long time ago since they have no subscription and no producer, only some inbound replication connection \r\n\r\n**To Reproduce**\r\nNo idea how to get there apart from stress testing a pulsar cluster with a lot of topic creation / subscription / publication and closing consumer.\r\nCould it be linked to the stress on topic creation / suppression ? To the fact one broker was probably frozen when topic was created ? To the fact some producers might not leave properly ?\r\n\r\n**Expected behavior**\r\nBefore `brokerDeleteInactiveTopicsFrequencySeconds+brokerServicePurgeInactiveFrequencyInSeconds` seconds after deleting the last subscription from a topic having no producer, topic should be deleted\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5436", "user": "f-ld", "labels": ["type/bug"], "created": "2019-10-22 08:49:34", "closed": "2019-10-22 09:59:02", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Flink connector sink doesn't work on blink SQL context", "body": "**Describe the bug**\r\nA clear and concise description of what the bug is.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a Flink SQL application in Flink 1.9.0, using the blink optimizer, and register a PulsarJsonTableSink (for instance as described in https://flink.apache.org/2019/05/03/pulsar-flink.html).\r\n2. Run the application.\r\n\r\n**Expected behavior**\r\nSink should be available for writing.\r\n\r\n**Actual output**\r\n```\r\n\r\nException in thread \"main\" org.apache.flink.table.api.TableException: The StreamTableSink#consumeDataStream(DataStream) must be implemented and return the sink transformation DataStreamSink.\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/5430", "user": "fhalim", "labels": ["component/flink", "triage/week-43", "type/bug"], "created": "2019-10-21 20:29:05", "closed": "2019-10-27 23:29:29", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "website page `coding_guide` return 404", "body": "As @Retardust reported on slack, when you click the link to \"coding guide\" at  http://pulsar.apache.org/en/contributing/#code, it returns `404`. \r\nActually, the link to http://pulsar.apache.org/en/coding_guide does not work.", "url": "https://github.com/apache/pulsar/issues/5425", "user": "jiazhai", "labels": ["component/documentation", "component/website", "triage/week-43", "type/bug"], "created": "2019-10-21 01:11:03", "closed": "2019-11-05 08:27:21", "commits": {}, "ttf": 15.000277777777777, "commitsDetails": []}, {"title": "Unable to Configure a JDBC sink", "body": "**Describe the bug**\r\nPulsar 2.4.1 docker image is missing IO file.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Get docker image:\r\n        docker pull apachepulsar/pulsar:2.4.1\r\n2. Make it running\r\n3. Start pulsar:\r\n        docker start pulsar\r\n4. List connectors folder: \r\n        docker exec -it pulsar /bin/bash -c \"ls -l connectors\"\r\n5. See error:\r\n        ls: cannot access 'connectors': No such file or directory\r\n\r\n**Expected behavior**\r\nFile(s) should be listed.\r\n\r\n**Screenshots**\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 14\r\n\r\n**Additional context**\r\nCreating sink connector will fail due to missing pulsar-io-jdbc-2.4.1.nar file:\r\n\r\n$ bin/pulsar-admin sinks create \\\r\n--archive ./**connectors/pulsar-io-jdbc-2.4.1.nar** \\\r\n--inputs pulsar-mysql-jdbc-sink-topic \\\r\n--name pulsar-mysql-jdbc-sink \\\r\n--sink-config-file ./connectors/pulsar-mysql-jdbc-sink.yaml \\\r\n--parallelism 1\r\n", "url": "https://github.com/apache/pulsar/issues/5418", "user": "jm7647", "labels": ["type/bug"], "created": "2019-10-18 21:37:29", "closed": "2019-10-22 18:24:20", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "list non-persistent topics shows the persistent topics", "body": "**Describe the bug**\r\nWhen using the REST API to request to list all the non-persistent topics, it will show the persistent topics.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1.  Start a standalone pulsar\r\n2. create a persistent topic\r\n3. curl http://localhost:8080/admin/v2/non-persistent/public/default\r\n4. See the persistent topics\r\n\r\n**Expected behavior**\r\n\r\nshow the non-persistent topics\r\n\r\n**Screenshots**\r\n\r\n![Screen Shot 2019-10-18 at 4 19 24 PM](https://user-images.githubusercontent.com/24502569/67078035-0ff2d500-f1c3-11e9-8cb3-77b1da2c6d28.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5414", "user": "zymap", "labels": ["triage/week-43", "type/bug"], "created": "2019-10-18 08:20:25", "closed": "2019-11-01 02:10:06", "commits": {"79f47106e56c34676497e91520d0d8446936abf7": {"commitGHEventType": "referenced", "commitUser": "wolfstudy"}, "9a9add7035f0ade1cac9ebb55862a178d636b81d": {"commitGHEventType": "referenced", "commitUser": "wolfstudy"}}, "ttf": 13.000277777777777, "commitsDetails": [{"commitHash": "79f47106e56c34676497e91520d0d8446936abf7", "commitGHEventType": "referenced", "commitUser": "wolfstudy", "commitParents": ["a4c330e0875f9512c19c9b37a1c8ec980b5ea037"], "nameRev": "79f47106e56c34676497e91520d0d8446936abf7 tags/v2.5.0-candidate-1~138", "commitMessage": "Fix list non-persistent topics shows the persistent topics (#5502)\n\n* Fix list non-persistent topics shows the persistent topics\r\n---\r\n\r\nFixes #5414\r\n\r\n*Motivation*\r\n\r\nWhen using the REST API to request to list all the non-persistent\r\ntopics, it will show the persistent topics.\r\n\r\n*Modifications*\r\n\r\n- Add a filter when before sending the response\r\n", "commitDateTime": "2019-11-01 10:10:06", "authoredDateTime": "2019-11-01 10:10:06", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/NonPersistentTopics.java", "insertions": 7, "deletions": 1, "lines": 8}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/cli/CLITest.java", "insertions": 17, "deletions": 0, "lines": 17}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NonPersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.NonPersistentTopics.getList(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CLITest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.cli.CLITest.testListNonPersistentTopicsCmd()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "9a9add7035f0ade1cac9ebb55862a178d636b81d", "commitGHEventType": "referenced", "commitUser": "wolfstudy", "commitParents": ["fcb7a5df158668407cc02402d901933e788efe81"], "nameRev": "9a9add7035f0ade1cac9ebb55862a178d636b81d tags/v2.4.2-candidate-1~14", "commitMessage": "Fix list non-persistent topics shows the persistent topics (#5502)\n\n* Fix list non-persistent topics shows the persistent topics\r\n---\r\n\r\nFixes #5414\r\n\r\n*Motivation*\r\n\r\nWhen using the REST API to request to list all the non-persistent\r\ntopics, it will show the persistent topics.\r\n\r\n*Modifications*\r\n\r\n- Add a filter when before sending the response\r\n\n(cherry picked from commit 79f47106e56c34676497e91520d0d8446936abf7)\n", "commitDateTime": "2019-11-19 20:26:05", "authoredDateTime": "2019-11-01 10:10:06", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/NonPersistentTopics.java", "insertions": 7, "deletions": 1, "lines": 8}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/cli/CLITest.java", "insertions": 17, "deletions": 0, "lines": 17}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NonPersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.NonPersistentTopics.getList(javax.ws.rs.container.AsyncResponse,java.lang.String,java.lang.String)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CLITest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.cli.CLITest.testListNonPersistentTopicsCmd()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Pulsar-io connectors not all showing up in releases", "body": "Pulsar-io connectors that have been advertised as released are not all available for download.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to http://apache.claz.org/pulsar/pulsar-2.4.1/connectors/ \r\nor https://pulsar.apache.org/en/download/\r\nor list the 'pulsar-all' container 'connectors' directory.\r\n\r\n2. Not all connectors in releases show up as NAR file artifacts as shown in\r\nRelease Notes or release branches.\r\nSee https://github.com/apache/pulsar/tree/branch-2.4/pulsar-io\r\nand https://pulsar.apache.org/en/release-notes/ \r\n\r\n**Expected behavior**\r\nNar files should be released (be in the release list) and available for download. It should also likely be in the released pulsar-all docker image which comes with the connectors. Documentation should list them and their download links.\r\n\r\n\r\n**Additional context**\r\nI was looking for the Redis sink, it looks like others are missing also (flume, solr, etc).\r\nThe advertised release of Redis and those other sinks was in 2.4.0 per release notes. \r\n", "url": "https://github.com/apache/pulsar/issues/5397", "user": "thps", "labels": ["component/documentation", "triage/week-43", "type/bug"], "created": "2019-10-16 19:54:49", "closed": "2019-12-17 11:44:49", "commits": {"e0942b8d5392439b403041d5f30116754d8a9365": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 61.000277777777775, "commitsDetails": [{"commitHash": "e0942b8d5392439b403041d5f30116754d8a9365", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["3bc8299072e0635d59735c0646df71796dc31a58"], "nameRev": "e0942b8d5392439b403041d5f30116754d8a9365 tags/v2.5.0-candidate-2~52", "commitMessage": "[Doc][Issue 5397] Generate a complete list of connectors on the Pulsar Download Page (#5852)\n\nFix https://github.com/apache/pulsar/issues/5397\r\n\r\nCurrently, the `Pulsar IO connectors` are incomplete on the Pulsar Download Page.\r\nFor example, `flume source`, `flume sink`, `redis sink`, and `solr sink` are not shown.\r\n\r\nI've added the missing ones.\r\n", "commitDateTime": "2019-12-17 19:44:49", "authoredDateTime": "2019-12-17 19:44:49", "commitGitStats": [{"filePath": "site2/website/data/connectors.js", "insertions": 83, "deletions": 29, "lines": 112}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["e0942b8d5392439b403041d5f30116754d8a9365"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 83, "deletions": 29, "lines": 112, "gitFilesChange": 1}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["site2/website/data/connectors.js"]}, {"title": "Error open RocksDB database when 'Set up a standalone Pulsar in Docker'", "body": "Hello, \r\n\r\nI am following the instruction on Set up a standalone Pulsar in Docker to setup Pular on windows 10 with the following command on both cmd.exe and powershell:\r\n\r\n`docker run -it  -p 6650:6650  -p 8080:8080 -v \"c:\\docker\\pulsar:/pulsar/data\" apachepulsar/pulsar:2.4.1 bin/pulsar standalone`\r\n\r\n I am getting this error as appeared to be fixed already - per https://github.com/apache/pulsar/issues/3031: \r\n\r\n```\r\n01:24:26.913 [main] INFO  org.apache.bookkeeper.discover.ZKRegistrationManager - INSTANCEID not exists in zookeeper. Not considering it for data verification\r\n01:24:26.998 [main] INFO  org.apache.bookkeeper.bookie.Bookie - instantiate ledger manager org.apache.bookkeeper.meta.HierarchicalLedgerManagerFactory\r\n01:24:27.019 [main] ERROR org.apache.bookkeeper.bookie.Journal - Problems reading from data/standalone/bookkeeper0/current/lastMark (this is okay if it is the first time starting this bookie\r\n01:24:27.021 [main] INFO  org.apache.bookkeeper.bookie.Bookie - Using ledger storage: org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage\r\n01:24:27.024 [main] INFO  org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage - Started Db Ledger Storage\r\n01:24:27.025 [main] INFO  org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage -  - Number of directories: 1\r\n01:24:27.025 [main] INFO  org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage -  - Write cache size: 1024 MB\r\n01:24:27.025 [main] INFO  org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage -  - Read Cache: 1024 MB\r\n01:24:27.028 [main] INFO  org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage - Creating single directory db ledger storage on data/standalone/bookkeeper0/current\r\n01:24:27.139 [main] INFO  org.apache.bookkeeper.proto.BookieNettyServer - Shutting down BookieNettyServer\r\n01:24:27.172 [main] ERROR org.apache.pulsar.PulsarStandaloneStarter - Failed to start pulsar service.\r\njava.io.IOException: Error open RocksDB database\r\n        at org.apache.bookkeeper.bookie.storage.ldb.KeyValueStorageRocksDB.<init>(KeyValueStorageRocksDB.java:182) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.bookie.storage.ldb.KeyValueStorageRocksDB.<init>(KeyValueStorageRocksDB.java:83) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.bookie.storage.ldb.KeyValueStorageRocksDB.lambda$static$0(KeyValueStorageRocksDB.java:58) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.bookie.storage.ldb.LedgerMetadataIndex.<init>(LedgerMetadataIndex.java:69) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.bookie.storage.ldb.SingleDirectoryDbLedgerStorage.<init>(SingleDirectoryDbLedgerStorage.java:160) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage.newSingleDirectoryDbLedgerStorage(DbLedgerStorage.java:148) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage.initialize(DbLedgerStorage.java:128) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.bookie.Bookie.<init>(Bookie.java:790) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.proto.BookieServer.newBookie(BookieServer.java:137) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.bookkeeper.proto.BookieServer.<init>(BookieServer.java:106) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        at org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.runBookies(LocalBookkeeperEnsemble.java:272) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.startStandalone(LocalBookkeeperEnsemble.java:396) ~[org.apache.pulsar-pulsar-zookeeper-utils-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.PulsarStandalone.start(PulsarStandalone.java:259) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n        at org.apache.pulsar.PulsarStandaloneStarter.main(PulsarStandaloneStarter.java:121) [org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\nCaused by: org.rocksdb.RocksDBException: While fsync: a directory: Invalid argument\r\n        at org.rocksdb.RocksDB.open(Native Method) ~[org.rocksdb-rocksdbjni-5.13.3.jar:?]\r\n        at org.rocksdb.RocksDB.open(RocksDB.java:231) ~[org.rocksdb-rocksdbjni-5.13.3.jar:?]\r\n        at org.apache.bookkeeper.bookie.storage.ldb.KeyValueStorageRocksDB.<init>(KeyValueStorageRocksDB.java:179) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n        ... 13 more\r\n01:24:27.182 [Thread-1] ERROR org.apache.pulsar.PulsarStandaloneStarter - Shutdown failed: null\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/5392", "user": "junlia", "labels": ["triage/week-43", "type/bug"], "created": "2019-10-16 01:56:25", "closed": "2020-01-14 17:06:08", "commits": {}, "ttf": 90.00027777777778, "commitsDetails": []}, {"title": "Topic compaction fails with 500 error", "body": "**Describe the bug**\r\nI'm running pulsar 2.4.1 on minikube installed with Helm template. I create topic in `retention` namespace where some retention is set ( in my case --time 3h --size 1G). Then I sent 100 messages to the topic with the same key, and then wanted to enable compacting for this topic. Tried several ways, \r\n\r\n`bin/pulsar-admin topics compact persistent://public/retention/topic-2`\r\nreturns\r\n```\r\nHTTP 500 Internal Server Error\r\n\r\nReason: HTTP 500 Internal Server Error\r\n```\r\nDirect REST call `PUT /admin/v2/persistent/public/retention/topic-2/compaction HTTP/1.1`\r\nreturns\r\n```\r\n --- An unexpected error occurred in the server ---\r\n\r\nMessage: org.apache.pulsar.broker.PulsarServerException: java.lang.IllegalArgumentException: Param serviceUrl must not be blank.\r\n\r\nStacktrace:\r\n\r\norg.apache.pulsar.broker.PulsarServerException: org.apache.pulsar.broker.PulsarServerException: java.lang.IllegalArgumentException: Param serviceUrl must not be blank.\r\n\tat org.apache.pulsar.broker.PulsarService.getCompactor(PulsarService.java:809)\r\n\tat org.apache.pulsar.broker.service.persistent.PersistentTopic.triggerCompaction(PersistentTopic.java:1775)\r\n\tat org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalTriggerCompaction(PersistentTopicsBase.java:1262)\r\n\tat org.apache.pulsar.broker.admin.v2.PersistentTopics.compact(PersistentTopics.java:838)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:76)\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:148)\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:191)\r\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:183)\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:103)\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:493)\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:415)\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:104)\r\n\tat org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:277)\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:272)\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:268)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:316)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:298)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:268)\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:289)\r\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:256)\r\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:703)\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:416)\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:370)\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:389)\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:342)\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:229)\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:865)\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1655)\r\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53)\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1642)\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533)\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255)\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595)\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255)\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1340)\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203)\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473)\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564)\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201)\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1242)\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144)\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:220)\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126)\r\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:174)\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132)\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:503)\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:364)\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260)\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:305)\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103)\r\n\tat org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118)\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333)\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310)\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168)\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126)\r\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: org.apache.pulsar.broker.PulsarServerException: java.lang.IllegalArgumentException: Param serviceUrl must not be blank.\r\n\tat org.apache.pulsar.broker.PulsarService.getClient(PulsarService.java:839)\r\n\tat org.apache.pulsar.broker.PulsarService.getCompactor(PulsarService.java:806)\r\n\t... 63 more\r\nCaused by: java.lang.IllegalArgumentException: Param serviceUrl must not be blank.\r\n\tat org.apache.pulsar.client.impl.ClientBuilderImpl.serviceUrl(ClientBuilderImpl.java:84)\r\n\tat org.apache.pulsar.broker.PulsarService.getClient(PulsarService.java:828)\r\n\t... 64 more\r\n```\r\nAlso tried to run this command\r\n`bin/pulsar compact-topic --topic persistent://public/retention/topic-2` which led to those errors: https://pastebin.com/ft8THHnC\r\n\r\n**Expected behavior**\r\nExpected comaction to succeed\r\n\r\n**Desktop (please complete the following information):**\r\n - minikube\r\n- 2.4.1 pulsar version\r\n\r\n**Additional context**\r\n[Slack discussion](https://apache-pulsar.slack.com/archives/C5Z4T36F7/p1571065681208400) \r\n", "url": "https://github.com/apache/pulsar/issues/5384", "user": "Lanayx", "labels": ["triage/week-43", "type/bug"], "created": "2019-10-14 19:45:22", "closed": "2019-11-29 15:00:03", "commits": {}, "ttf": 45.000277777777775, "commitsDetails": []}, {"title": "Kubernetes deployment: Pods from a service are being scheduled on the same node", "body": "I was trying to deploy pulsar using GKE. While I was deploying the ZooKeeper service I noticed that its pods were being scheduled on the same node. I am really new to Kubernetes but this looks a little odd to me:\r\n\r\n`deployment/kubernetes/google-kubernetes-engine/zookeeper.yaml` \r\n\r\n```yaml\r\nspec:\r\n    serviceName: zookeeper\r\n    replicas: 3\r\n    template:\r\n        metadata:\r\n            labels:\r\n                app: pulsar\r\n                component: zookeeper\r\n                cluster: pulsar-gke\r\n            annotations:\r\n                pod.alpha.kubernetes.io/initialized: \"true\"\r\n                prometheus.io/scrape: \"true\"\r\n                prometheus.io/port: \"8080\"\r\n\r\n        spec:\r\n            # Make sure multiple pods of ZK don't get scheduled on the\r\n            # same node, unless there are no other available nodes\r\n            affinity:\r\n                podAntiAffinity:\r\n                    preferredDuringSchedulingIgnoredDuringExecution:\r\n                      - weight: 1\r\n                        podAffinityTerm:\r\n                            labelSelector:\r\n                                matchExpressions:\r\n                                  - key: \"app\"\r\n                                    operator: In\r\n                                    values:\r\n                                      - zookeeper\r\n                            topologyKey: \"kubernetes.io/hostname\"\r\n```\r\n\r\nI read this [Kubernetes affinity example](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#an-example-of-a-pod-that-uses-pod-affinity) and I think that the `key` used in `matchExpressions`  should be `component`, not `app`. When I use `component` as the `key`, all the ZooKeeper pods are scheduled on different nodes.\r\n\r\nIf I am correct, this error is present in all the Kubernetes deployment files.\r\n\r\nIs there any Kubernetes expert willing to take a look at this?\r\n\r\nThank you!", "url": "https://github.com/apache/pulsar/issues/5380", "user": "stupidusername", "labels": ["type/bug"], "created": "2019-10-13 03:06:40", "closed": "2019-10-15 18:22:38", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Kafka Wrapper can NOT support new Kafka version, >=0.11+, 1.0+ and 2.0+ ", "body": "**Describe the bug**\r\nError: Failed to sample data: java.lang.UnsupportedOperationException\r\n\r\nlook like currently it only supports Kafka version <=0.10? \r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n![image](https://user-images.githubusercontent.com/17067653/66702857-c0358900-ed3e-11e9-9e2e-2fe3c17bfe96.png)\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5379", "user": "frank-dkvan", "labels": ["help wanted", "triage/week-43", "type/bug"], "created": "2019-10-12 14:23:16", "closed": "2020-03-26 07:34:05", "commits": {}, "ttf": 165.00027777777777, "commitsDetails": []}, {"title": "Old message continue redeliver after clear backlog.", "body": "**Describe the bug**\r\nWe have some messages can't be consume correctly, so i clear the backlog of that subscription, but message redelivery did not stop.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Producer send some messages\r\n2. Consumer receive messages but do not ack them\r\n3. Clear backlog of the subscription which consume use\r\n4. un-acked messages will redeliver continuously\r\n\r\n**Expected behavior**\r\nDon't redeliver messages which is less than mark delete position\r\n", "url": "https://github.com/apache/pulsar/issues/5377", "user": "codelipenghui", "labels": ["triage/week-43", "type/bug"], "created": "2019-10-12 07:19:14", "closed": "2019-10-30 09:02:01", "commits": {}, "ttf": 18.00027777777778, "commitsDetails": []}, {"title": "Pulsar Standalone is shutdown before complete starting", "body": "**Describe the bug**\r\nBefore this problem happened, I was using it normally. I had to restart the machine at brute force and after I restarted my computer the pulsar started to catch this problem. I removed and installed the pulsar from scratch and the problem continues.\r\n\r\n**To Reproduce**\r\n./pulsar standalone\r\n\r\n\r\n23:14:51.138 [BookKeeperClientWorker-OrderedExecutor-0-0] INFO  org.apache.distributedlog.BKLogSegmentWriter - Stream streams_000000000000000001_000000000000000001_000000000000000000:<default>:inprogress_000000000000000002 aborted 0 writes\r\n23:14:51.156 [main-EventThread] INFO  org.apache.zookeeper.ClientCnxn - EventThread shut down for session: 0x1000044fedc0007\r\n23:14:51.156 [Thread-1] INFO  org.apache.zookeeper.ZooKeeper - Session: 0x1000044fedc0007 closed\r\n23:14:51.158 [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181] INFO  org.apache.zookeeper.server.NIOServerCnxn - Closed socket connection for client /127.0.0.1:46064 which had sessionid 0x1000044fedc0007\r\n23:14:51.160 [Thread-1] INFO  org.apache.distributedlog.BookKeeperClient - BookKeeper Client closed bk:distributedlog://127.0.0.1:2181/stream/storage:factory_writer_shared\r\n23:14:51.160 [Thread-1] INFO  org.apache.bookkeeper.proto.PerChannelBookieClient - Closing the per channel bookie client for 127.0.0.1:3181\r\n23:14:51.164 [DL-io-0] INFO  org.apache.bookkeeper.proto.PerChannelBookieClient - Disconnected from bookie channel [id: 0x9988bc98, L:/127.0.0.1:37070 ! R:localhost/127.0.0.1:3181]\r\n23:14:51.165 [Thread-1] ERROR org.apache.bookkeeper.client.MetadataUpdateLoop - UpdateLoop(ledgerId=8,loopId=3d11891f) Error writing metadata to store\r\norg.apache.bookkeeper.client.BKException$BKClientClosedException: BookKeeper client is closed\r\n\tat org.apache.bookkeeper.meta.CleanupLedgerManager.close(CleanupLedgerManager.java:245) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.BookKeeper.close(BookKeeper.java:1410) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.BookKeeperClient.close(BookKeeperClient.java:270) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.doClose(BKNamespaceDriver.java:404) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.close(BKNamespaceDriver.java:385) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat com.google.common.io.Closeables.close(Closeables.java:76) ~[com.google.guava-guava-21.0.jar:?]\r\n\tat org.apache.distributedlog.util.Utils.close(Utils.java:544) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.BKDistributedLogNamespace.close(BKDistributedLogNamespace.java:341) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.stream.server.service.DLNamespaceProviderService.doClose(DLNamespaceProviderService.java:135) ~[org.apache.bookkeeper-stream-storage-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109) ~[org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.lambda$close$4(LifecycleComponentStack.java:123) ~[org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat com.google.common.collect.ImmutableList.forEach(ImmutableList.java:408) [com.google.guava-guava-21.0.jar:?]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.close(LifecycleComponentStack.java:123) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.stream.server.StreamStorageLifecycleComponent.doClose(StreamStorageLifecycleComponent.java:61) [org.apache.bookkeeper-stream-storage-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.stop(LocalBookkeeperEnsemble.java:405) [org.apache.pulsar-pulsar-zookeeper-utils-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.PulsarStandaloneStarter$1.run(PulsarStandaloneStarter.java:104) [org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n23:14:51.165 [Thread-1] ERROR org.apache.distributedlog.BKAbstractLogWriter - Completing Log segments encountered exception\r\njava.io.IOException: Failed to close ledger for streams_000000000000000000_000000000000000001_000000000000000000:<default>:inprogress_000000000000000002 : BookKeeper client is closed\r\n\tat org.apache.distributedlog.BKLogSegmentWriter$6.closeComplete(BKLogSegmentWriter.java:660) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.LedgerHandle$5.lambda$safeRun$0(LedgerHandle.java:550) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_202]\r\n\tat org.apache.bookkeeper.client.LedgerHandle$5.lambda$safeRun$3(LedgerHandle.java:612) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_202]\r\n\tat org.apache.bookkeeper.client.MetadataUpdateLoop.lambda$writeLoop$1(MetadataUpdateLoop.java:146) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_202]\r\n\tat org.apache.bookkeeper.meta.CleanupLedgerManager.lambda$close$1(CleanupLedgerManager.java:246) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.ConcurrentHashMap$KeySetView.forEach(ConcurrentHashMap.java:4649) ~[?:1.8.0_202]\r\n\tat org.apache.bookkeeper.meta.CleanupLedgerManager.close(CleanupLedgerManager.java:246) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.BookKeeper.close(BookKeeper.java:1410) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.BookKeeperClient.close(BookKeeperClient.java:270) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.doClose(BKNamespaceDriver.java:404) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.close(BKNamespaceDriver.java:385) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat com.google.common.io.Closeables.close(Closeables.java:76) ~[com.google.guava-guava-21.0.jar:?]\r\n\tat org.apache.distributedlog.util.Utils.close(Utils.java:544) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.BKDistributedLogNamespace.close(BKDistributedLogNamespace.java:341) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.stream.server.service.DLNamespaceProviderService.doClose(DLNamespaceProviderService.java:135) ~[org.apache.bookkeeper-stream-storage-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109) ~[org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.lambda$close$4(LifecycleComponentStack.java:123) ~[org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat com.google.common.collect.ImmutableList.forEach(ImmutableList.java:408) [com.google.guava-guava-21.0.jar:?]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.close(LifecycleComponentStack.java:123) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.stream.server.StreamStorageLifecycleComponent.doClose(StreamStorageLifecycleComponent.java:61) [org.apache.bookkeeper-stream-storage-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.stop(LocalBookkeeperEnsemble.java:405) [org.apache.pulsar-pulsar-zookeeper-utils-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.PulsarStandaloneStarter$1.run(PulsarStandaloneStarter.java:104) [org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n23:14:51.167 [bookie-io-1-2] INFO  org.apache.bookkeeper.proto.BookieRequestHandler - Channels disconnected: [id: 0x93825262, L:/127.0.0.1:3181 ! R:/127.0.0.1:37070]\r\n23:14:51.167 [DLM-/stream/storage-OrderedScheduler-1-0] INFO  org.apache.distributedlog.bk.SimpleLedgerAllocator - Abort ledger allocator without cleaning up on /stream/storage/streams_000000000000000000_000000000000000001_000000000000000000/<default>/allocation.\r\n23:14:51.169 [io-read-scheduler-OrderedScheduler-1-0] INFO  org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal - Successfully close the log stream of state store 000000000000000000/000000000000000001/000000000000000000\r\n23:14:51.170 [Thread-1] ERROR org.apache.bookkeeper.client.MetadataUpdateLoop - UpdateLoop(ledgerId=9,loopId=69cdb660) Error writing metadata to store\r\norg.apache.bookkeeper.client.BKException$BKClientClosedException: BookKeeper client is closed\r\n\tat org.apache.bookkeeper.meta.CleanupLedgerManager.close(CleanupLedgerManager.java:245) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.BookKeeper.close(BookKeeper.java:1410) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.BookKeeperClient.close(BookKeeperClient.java:270) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.doClose(BKNamespaceDriver.java:404) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.close(BKNamespaceDriver.java:385) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat com.google.common.io.Closeables.close(Closeables.java:76) ~[com.google.guava-guava-21.0.jar:?]\r\n\tat org.apache.distributedlog.util.Utils.close(Utils.java:544) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.BKDistributedLogNamespace.close(BKDistributedLogNamespace.java:341) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.stream.server.service.DLNamespaceProviderService.doClose(DLNamespaceProviderService.java:135) ~[org.apache.bookkeeper-stream-storage-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109) ~[org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.lambda$close$4(LifecycleComponentStack.java:123) ~[org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat com.google.common.collect.ImmutableList.forEach(ImmutableList.java:408) [com.google.guava-guava-21.0.jar:?]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.close(LifecycleComponentStack.java:123) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.stream.server.StreamStorageLifecycleComponent.doClose(StreamStorageLifecycleComponent.java:61) [org.apache.bookkeeper-stream-storage-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.stop(LocalBookkeeperEnsemble.java:405) [org.apache.pulsar-pulsar-zookeeper-utils-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.PulsarStandaloneStarter$1.run(PulsarStandaloneStarter.java:104) [org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n23:14:51.171 [Thread-1] ERROR org.apache.distributedlog.BKAbstractLogWriter - Completing Log segments encountered exception\r\njava.io.IOException: Failed to close ledger for streams_000000000000000001_000000000000000001_000000000000000000:<default>:inprogress_000000000000000002 : BookKeeper client is closed\r\n\tat org.apache.distributedlog.BKLogSegmentWriter$6.closeComplete(BKLogSegmentWriter.java:660) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.LedgerHandle$5.lambda$safeRun$0(LedgerHandle.java:550) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_202]\r\n\tat org.apache.bookkeeper.client.LedgerHandle$5.lambda$safeRun$3(LedgerHandle.java:612) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_202]\r\n\tat org.apache.bookkeeper.client.MetadataUpdateLoop.lambda$writeLoop$1(MetadataUpdateLoop.java:146) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_202]\r\n\tat org.apache.bookkeeper.meta.CleanupLedgerManager.lambda$close$1(CleanupLedgerManager.java:246) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.ConcurrentHashMap$KeySetView.forEach(ConcurrentHashMap.java:4649) ~[?:1.8.0_202]\r\n\tat org.apache.bookkeeper.meta.CleanupLedgerManager.close(CleanupLedgerManager.java:246) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.BookKeeper.close(BookKeeper.java:1410) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.BookKeeperClient.close(BookKeeperClient.java:270) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.doClose(BKNamespaceDriver.java:404) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.close(BKNamespaceDriver.java:385) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat com.google.common.io.Closeables.close(Closeables.java:76) ~[com.google.guava-guava-21.0.jar:?]\r\n\tat org.apache.distributedlog.util.Utils.close(Utils.java:544) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.BKDistributedLogNamespace.close(BKDistributedLogNamespace.java:341) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.stream.server.service.DLNamespaceProviderService.doClose(DLNamespaceProviderService.java:135) ~[org.apache.bookkeeper-stream-storage-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109) ~[org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.lambda$close$4(LifecycleComponentStack.java:123) ~[org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat com.google.common.collect.ImmutableList.forEach(ImmutableList.java:408) [com.google.guava-guava-21.0.jar:?]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.close(LifecycleComponentStack.java:123) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.stream.server.StreamStorageLifecycleComponent.doClose(StreamStorageLifecycleComponent.java:61) [org.apache.bookkeeper-stream-storage-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.stop(LocalBookkeeperEnsemble.java:405) [org.apache.pulsar-pulsar-zookeeper-utils-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.PulsarStandaloneStarter$1.run(PulsarStandaloneStarter.java:104) [org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n23:14:51.173 [DLM-/stream/storage-OrderedScheduler-0-0] INFO  org.apache.distributedlog.bk.SimpleLedgerAllocator - Abort ledger allocator without cleaning up on /stream/storage/streams_000000000000000001_000000000000000001_000000000000000000/<default>/allocation.\r\n23:14:51.173 [Thread-1] ERROR org.apache.bookkeeper.client.MetadataUpdateLoop - UpdateLoop(ledgerId=6,loopId=6610c33f) Error writing metadata to store\r\norg.apache.bookkeeper.client.BKException$BKClientClosedException: BookKeeper client is closed\r\n\tat org.apache.bookkeeper.meta.CleanupLedgerManager.close(CleanupLedgerManager.java:245) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.BookKeeper.close(BookKeeper.java:1410) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.BookKeeperClient.close(BookKeeperClient.java:270) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.doClose(BKNamespaceDriver.java:404) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.close(BKNamespaceDriver.java:385) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat com.google.common.io.Closeables.close(Closeables.java:76) ~[com.google.guava-guava-21.0.jar:?]\r\n\tat org.apache.distributedlog.util.Utils.close(Utils.java:544) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.BKDistributedLogNamespace.close(BKDistributedLogNamespace.java:341) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.stream.server.service.DLNamespaceProviderService.doClose(DLNamespaceProviderService.java:135) ~[org.apache.bookkeeper-stream-storage-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109) ~[org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.lambda$close$4(LifecycleComponentStack.java:123) ~[org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat com.google.common.collect.ImmutableList.forEach(ImmutableList.java:408) [com.google.guava-guava-21.0.jar:?]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.close(LifecycleComponentStack.java:123) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.stream.server.StreamStorageLifecycleComponent.doClose(StreamStorageLifecycleComponent.java:61) [org.apache.bookkeeper-stream-storage-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.stop(LocalBookkeeperEnsemble.java:405) [org.apache.pulsar-pulsar-zookeeper-utils-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.PulsarStandaloneStarter$1.run(PulsarStandaloneStarter.java:104) [org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n23:14:51.174 [io-read-scheduler-OrderedScheduler-1-0] INFO  org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal - Successfully close the log stream of state store 000000000000000001/000000000000000001/000000000000000000\r\n23:14:51.178 [io-read-scheduler-OrderedScheduler-1-0] INFO  org.apache.bookkeeper.stream.storage.impl.sc.StorageContainerImpl - Successfully stopped storage container (1).\r\n23:14:51.174 [Thread-1] ERROR org.apache.distributedlog.BKAbstractLogWriter - Completing Log segments encountered exception\r\njava.io.IOException: Failed to close ledger for streams_000000000000000000_000000000000000000_000000000000000000:<default>:inprogress_000000000000000002 : BookKeeper client is closed\r\n\tat org.apache.distributedlog.BKLogSegmentWriter$6.closeComplete(BKLogSegmentWriter.java:660) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.LedgerHandle$5.lambda$safeRun$0(LedgerHandle.java:550) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_202]\r\n\tat org.apache.bookkeeper.client.LedgerHandle$5.lambda$safeRun$3(LedgerHandle.java:612) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_202]\r\n\tat org.apache.bookkeeper.client.MetadataUpdateLoop.lambda$writeLoop$1(MetadataUpdateLoop.java:146) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_202]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_202]\r\n\tat org.apache.bookkeeper.meta.CleanupLedgerManager.lambda$close$1(CleanupLedgerManager.java:246) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.ConcurrentHashMap$KeySetView.forEach(ConcurrentHashMap.java:4649) ~[?:1.8.0_202]\r\n\tat org.apache.bookkeeper.meta.CleanupLedgerManager.close(CleanupLedgerManager.java:246) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.BookKeeper.close(BookKeeper.java:1410) ~[org.apache.bookkeeper-bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.BookKeeperClient.close(BookKeeperClient.java:270) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.doClose(BKNamespaceDriver.java:404) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.close(BKNamespaceDriver.java:385) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat com.google.common.io.Closeables.close(Closeables.java:76) ~[com.google.guava-guava-21.0.jar:?]\r\n\tat org.apache.distributedlog.util.Utils.close(Utils.java:544) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.distributedlog.BKDistributedLogNamespace.close(BKDistributedLogNamespace.java:341) ~[org.apache.distributedlog-distributedlog-core-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.stream.server.service.DLNamespaceProviderService.doClose(DLNamespaceProviderService.java:135) ~[org.apache.bookkeeper-stream-storage-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109) ~[org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.lambda$close$4(LifecycleComponentStack.java:123) ~[org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat com.google.common.collect.ImmutableList.forEach(ImmutableList.java:408) [com.google.guava-guava-21.0.jar:?]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.close(LifecycleComponentStack.java:123) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.stream.server.StreamStorageLifecycleComponent.doClose(StreamStorageLifecycleComponent.java:61) [org.apache.bookkeeper-stream-storage-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.stop(LocalBookkeeperEnsemble.java:405) [org.apache.pulsar-pulsar-zookeeper-utils-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.PulsarStandaloneStarter$1.run(PulsarStandaloneStarter.java:104) [org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n23:14:51.179 [io-read-scheduler-OrderedScheduler-1-0] INFO  org.apache.bookkeeper.stream.storage.impl.sc.ZkStorageContainerManager - Successfully stopped storage container (1)\r\n23:14:51.179 [io-read-scheduler-OrderedScheduler-1-0] INFO  org.apache.bookkeeper.stream.storage.impl.sc.ZkStorageContainerManager - Storage container (1) is removed from live set.\r\n23:14:51.179 [DLM-/stream/storage-OrderedScheduler-3-0] INFO  org.apache.distributedlog.bk.SimpleLedgerAllocator - Abort ledger allocator without cleaning up on /stream/storage/streams_000000000000000000_000000000000000000_000000000000000000/<default>/allocation.\r\n23:14:51.180 [io-read-scheduler-OrderedScheduler-0-0] INFO  org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal - Successfully close the log stream of state store 000000000000000000/000000000000000000/000000000000000000\r\n23:14:51.183 [Thread-1] INFO  org.apache.distributedlog.ZooKeeperClient - Close zookeeper client bk:distributedlog://127.0.0.1:2181/stream/storage:factory_writer_shared:zk.\r\n23:14:51.183 [Thread-1] INFO  org.apache.distributedlog.ZooKeeperClient - Closing zookeeper client bk:distributedlog://127.0.0.1:2181/stream/storage:factory_writer_shared:zk.\r\n23:14:51.184 [ProcessThread(sid:0 cport:2181):] INFO  org.apache.zookeeper.server.PrepRequestProcessor - Processed session termination for sessionid: 0x1000044fedc0008\r\n23:14:51.352 [Thread-1] INFO  org.apache.zookeeper.ZooKeeper - Session: 0x1000044fedc0008 closed\r\n23:14:51.352 [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181] INFO  org.apache.zookeeper.server.NIOServerCnxn - Closed socket connection for client /127.0.0.1:46070 which had sessionid 0x1000044fedc0008\r\n23:14:51.352 [Thread-1] INFO  org.apache.distributedlog.ZooKeeperClient - Closed zookeeper client bk:distributedlog://127.0.0.1:2181/stream/storage:factory_writer_shared:zk.\r\n23:14:51.352 [io-write-scheduler-OrderedScheduler-0-0-EventThread] INFO  org.apache.zookeeper.ClientCnxn - EventThread shut down for session: 0x1000044fedc0008\r\n23:14:51.352 [Thread-1] INFO  org.apache.distributedlog.ZooKeeperClient - Close zookeeper client dlzk:distributedlog://127.0.0.1:2181/stream/storage:factory_writer_shared.\r\n23:14:51.352 [Thread-1] INFO  org.apache.distributedlog.ZooKeeperClient - Closing zookeeper client dlzk:distributedlog://127.0.0.1:2181/stream/storage:factory_writer_shared.\r\n23:14:51.353 [ProcessThread(sid:0 cport:2181):] INFO  org.apache.zookeeper.server.PrepRequestProcessor - Processed session termination for sessionid: 0x1000044fedc0006\r\n23:14:51.465 [Thread-1] INFO  org.apache.zookeeper.ZooKeeper - Session: 0x1000044fedc0006 closed\r\n23:14:51.466 [Thread-1] INFO  org.apache.distributedlog.ZooKeeperClient - Closed zookeeper client dlzk:distributedlog://127.0.0.1:2181/stream/storage:factory_writer_shared.\r\n23:14:51.466 [main-EventThread] INFO  org.apache.zookeeper.ClientCnxn - EventThread shut down for session: 0x1000044fedc0006\r\n23:14:51.466 [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181] INFO  org.apache.zookeeper.server.NIOServerCnxn - Closed socket connection for client /127.0.0.1:46062 which had sessionid 0x1000044fedc0006\r\n23:14:51.467 [io-read-scheduler-OrderedScheduler-0-0] INFO  org.apache.bookkeeper.stream.storage.impl.sc.StorageContainerImpl - Successfully stopped storage container (0).\r\n23:14:51.467 [io-read-scheduler-OrderedScheduler-0-0] INFO  org.apache.bookkeeper.stream.storage.impl.sc.ZkStorageContainerManager - Successfully stopped storage container (0)\r\n23:14:51.467 [io-read-scheduler-OrderedScheduler-0-0] INFO  org.apache.bookkeeper.stream.storage.impl.sc.ZkStorageContainerManager - Storage container (0) is removed from live set.\r\n23:14:51.468 [Thread-1] INFO  org.apache.distributedlog.impl.BKNamespaceDriver - Release external resources used by channel factory.\r\n23:14:51.469 [Thread-1] INFO  org.apache.distributedlog.impl.BKNamespaceDriver - Stopped request timer\r\n23:14:51.470 [Thread-1] INFO  org.apache.distributedlog.BKDistributedLogNamespace - Executor Service Stopped.\r\n23:14:51.471 [Curator-Framework-0] INFO  org.apache.curator.framework.imps.CuratorFrameworkImpl - backgroundOperationsLoop exiting\r\n23:14:51.474 [ProcessThread(sid:0 cport:2181):] INFO  org.apache.zookeeper.server.PrepRequestProcessor - Processed session termination for sessionid: 0x1000044fedc0004\r\n23:14:51.794 [Thread-1] INFO  org.apache.zookeeper.ZooKeeper - Session: 0x1000044fedc0004 closed\r\n23:14:51.794 [Thread-1] INFO  org.apache.bookkeeper.proto.BookieServer - Shutting down BookieServer\r\n23:14:51.794 [main-EventThread] INFO  org.apache.zookeeper.ClientCnxn - EventThread shut down for session: 0x1000044fedc0004\r\n23:14:51.794 [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181] INFO  org.apache.zookeeper.server.NIOServerCnxn - Closed socket connection for client /127.0.0.1:46058 which had sessionid 0x1000044fedc0004\r\n23:14:51.795 [Thread-1] INFO  org.apache.bookkeeper.proto.BookieNettyServer - Shutting down BookieNettyServer\r\n23:14:51.823 [Thread-1] INFO  org.apache.bookkeeper.bookie.Bookie - Shutting down Bookie-3181 with exitCode 0\r\n23:14:51.823 [Thread-1] INFO  org.apache.bookkeeper.bookie.Bookie - Turning bookie to read only during shut down\r\n23:14:51.823 [Thread-1] INFO  org.apache.bookkeeper.bookie.SyncThread - Shutting down SyncThread\r\n23:14:51.827 [SyncThread-7-1] INFO  org.apache.bookkeeper.bookie.EntryLogManagerBase - Creating a new entry log file because current active log channel has not initialized yet\r\n23:14:51.836 [SyncThread-7-1] INFO  org.apache.bookkeeper.bookie.EntryLoggerAllocator - Created new entry log file data/standalone/bookkeeper0/current/2.log for logId 2.\r\n23:14:51.842 [pool-5-thread-1] INFO  org.apache.bookkeeper.bookie.EntryLoggerAllocator - Created new entry log file data/standalone/bookkeeper0/current/3.log for logId 3.\r\n23:14:52.351 [SyncThread-7-1] INFO  org.apache.bookkeeper.bookie.SyncThread - Flush ledger storage at checkpoint CheckpointList{checkpoints=[LogMark: logFileId - 1570846318841 , logFileOffset - 6656]}.\r\n23:14:52.454 [Thread-1] INFO  org.apache.bookkeeper.bookie.Journal - Shutting down Journal\r\n23:14:52.455 [ForceWriteThread] INFO  org.apache.bookkeeper.bookie.Journal - ForceWrite thread interrupted\r\n23:14:52.456 [BookieJournal-3181] INFO  org.apache.bookkeeper.bookie.Journal - Journal exits when shutting down\r\n23:14:52.456 [BookieJournal-3181] INFO  org.apache.bookkeeper.bookie.Journal - Journal exited loop!\r\n23:14:52.457 [Thread-1] INFO  org.apache.bookkeeper.bookie.Journal - Finished Shutting down Journal thread\r\n23:14:52.458 [Bookie-3181] INFO  org.apache.bookkeeper.bookie.Bookie - Journal thread(s) quit.\r\n23:14:52.843 [Thread-1] INFO  org.apache.bookkeeper.bookie.GarbageCollectorThread - Shutting down GarbageCollectorThread\r\n23:14:52.844 [Thread-1] INFO  org.apache.bookkeeper.bookie.EntryLogger - Stopping EntryLogger\r\n23:14:52.846 [Thread-1] INFO  org.apache.bookkeeper.bookie.EntryLoggerAllocator - Stopped entry logger preallocator.\r\n23:14:52.850 [Thread-1] INFO  org.apache.bookkeeper.bookie.LedgerDirsMonitor - Shutting down LedgerDirsMonitor\r\n23:14:52.853 [ProcessThread(sid:0 cport:2181):] INFO  org.apache.zookeeper.server.PrepRequestProcessor - Processed session termination for sessionid: 0x1000044fedc0001\r\n23:14:53.026 [Thread-1] INFO  org.apache.zookeeper.ZooKeeper - Session: 0x1000044fedc0001 closed\r\n23:14:53.026 [main-EventThread] INFO  org.apache.zookeeper.ClientCnxn - EventThread shut down for session: 0x1000044fedc0001\r\n23:14:53.026 [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181] INFO  org.apache.zookeeper.server.NIOServerCnxn - Closed socket connection for client /127.0.0.1:46052 which had sessionid 0x1000044fedc0001\r\n23:14:53.032 [ProcessThread(sid:0 cport:2181):] INFO  org.apache.zookeeper.server.PrepRequestProcessor - Processed session termination for sessionid: 0x1000044fedc0000\r\n23:14:53.059 [Thread-1] INFO  org.apache.zookeeper.ZooKeeper - Session: 0x1000044fedc0000 closed\r\n23:14:53.059 [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181] INFO  org.apache.zookeeper.server.NIOServerCnxn - Closed socket connection for client /127.0.0.1:46050 which had sessionid 0x1000044fedc0000\r\n23:14:53.059 [main-EventThread] INFO  org.apache.zookeeper.ClientCnxn - EventThread shut down for session: 0x1000044fedc0000\r\n23:14:53.059 [Thread-1] INFO  org.apache.zookeeper.server.ZooKeeperServer - shutting down\r\n23:14:53.059 [Thread-1] INFO  org.apache.zookeeper.server.SessionTrackerImpl - Shutting down\r\n23:14:53.060 [Thread-1] INFO  org.apache.zookeeper.server.PrepRequestProcessor - Shutting down\r\n23:14:53.060 [Thread-1] INFO  org.apache.zookeeper.server.SyncRequestProcessor - Shutting down\r\n23:14:53.060 [ProcessThread(sid:0 cport:2181):] INFO  org.apache.zookeeper.server.PrepRequestProcessor - PrepRequestProcessor exited loop!\r\n23:14:53.060 [SyncThread:0] INFO  org.apache.zookeeper.server.SyncRequestProcessor - SyncRequestProcessor exited!\r\n23:14:53.060 [Thread-1] INFO  org.apache.zookeeper.server.FinalRequestProcessor - shutdown of request processor complete\r\n23:14:53.063 [Thread-1] INFO  org.apache.zookeeper.server.NIOServerCnxn - Closed socket connection for client /127.0.0.1:46078 which had sessionid 0x1000044fedc000b\r\n23:14:53.063 [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181] INFO  org.apache.zookeeper.server.NIOServerCnxnFactory - NIOServerCnxn factory exited run method\r\n", "url": "https://github.com/apache/pulsar/issues/5373", "user": "ronaldofreitas", "labels": ["type/bug"], "created": "2019-10-12 02:21:51", "closed": "2020-04-16 22:33:16", "commits": {}, "ttf": 187.00027777777777, "commitsDetails": []}, {"title": "[docs] Contradictory information about what versions of python are supported", "body": "**Describe the bug**\r\nThere is contradictory information about what versions of python are supported.  \r\n1. It says that versions 3.4-3.7 are supported at http://pulsar.apache.org/docs/en/client-libraries-python/ \r\n2. It says that only version 2.7 is supported at http://pulsar.apache.org/api/python/ \r\nThe info is out-of-date and needs regenerating.\r\n3. python3 now being supported, there is other new functionality\r\nwhich is not shown: e.g.\r\n\r\n- Client.create_producer and Client.create_reader can take a \"schema\"\r\nargument\r\n- Message.value()   contains the object deserialized via schema\r\n\r\nNote: The issue is found and reported by Brian (b.candler@pobox.com). Thank Brian for his contribution.", "url": "https://github.com/apache/pulsar/issues/5368", "user": "Jennifer88huang", "labels": ["component/documentation", "triage/week-43", "type/bug"], "created": "2019-10-11 14:22:24", "closed": "2019-11-14 01:28:07", "commits": {}, "ttf": 33.000277777777775, "commitsDetails": []}, {"title": "python API missing `is_read_compacted` in create_reader()", "body": "**Describe the bug**\r\n\r\nThe python API has `is_read_compacted` in the Consumer API, but not in the Reader API.\r\n\r\nI think this may be an accidental omission.  I checked the Java API docs, both ConsumerBuilder and ReaderBuilder have [readCompacted](https://pulsar.apache.org/api/client/org/apache/pulsar/client/api/ReaderBuilder.html#readCompacted-boolean-)\r\n\r\nSimilarly, the C++ API has [setReadCompacted](https://github.com/apache/pulsar/blob/master/pulsar-client-cpp/lib/ReaderConfiguration.cc#L69) in [ReaderConfiguration.cc](https://github.com/apache/pulsar/blob/master/pulsar-client-cpp/lib/ReaderConfiguration.cc)\r\n\r\n**To Reproduce**\r\n\r\n```\r\nimport pulsar\r\n\r\nclient = pulsar.Client('pulsar://localhost:6650')\r\n\r\nmsg_id = pulsar.MessageId.earliest\r\n\r\nreader = client.create_reader('my-topic', msg_id, is_read_compacted=True)\r\n\r\nwhile True:\r\n    msg = reader.read_next()\r\n    print(\"Received message %r id=%s\" % (msg.data(), msg.message_id()))\r\n```\r\n\r\nGives `TypeError: create_reader() got an unexpected keyword argument 'is_read_compacted'`\r\n\r\n**Expected behavior**\r\n\r\nTo work the same as the consumer API.  The following works:\r\n\r\n```\r\nconsumer = client.subscribe('my-topic', 'my-subscription', is_read_compacted=True)\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 18.04, Pulsar 2.4.1, python 3.6.8, and pulsar-client==2.4.1\r\n", "url": "https://github.com/apache/pulsar/issues/5365", "user": "candlerb", "labels": ["component/python", "triage/week-43", "type/bug"], "created": "2019-10-11 13:24:08", "closed": "2019-10-28 16:16:30", "commits": {"49a8658cac4b8f842feae9a00ad3b2480c7916ac": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "d9ebec52482d7ca5e273f762b3828fb18f988f2c": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "153d190aed731529be2ddf65830fe028a2dbf2b0": {"commitGHEventType": "referenced", "commitUser": "wolfstudy"}}, "ttf": 17.00027777777778, "commitsDetails": [{"commitHash": "49a8658cac4b8f842feae9a00ad3b2480c7916ac", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["c59a37b2a718e45866dc5b6b23d8daef9aa1e307"], "nameRev": "49a8658cac4b8f842feae9a00ad3b2480c7916ac tags/v2.5.0-candidate-1~171", "commitMessage": "Add is_read_compacted to create_reader() in python API (#5483)\n\nFixes #5365", "commitDateTime": "2019-10-28 09:16:30", "authoredDateTime": "2019-10-28 16:16:30", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/pulsar/__init__.py", "insertions": 8, "deletions": 1, "lines": 9}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "d9ebec52482d7ca5e273f762b3828fb18f988f2c", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["0076a1bc2d8c3e0fbdd1d210cea17efcf086c034"], "nameRev": "d9ebec52482d7ca5e273f762b3828fb18f988f2c tags/v2.5.0-candidate-1~143", "commitMessage": "Python API: Add test case for create_reader(is_read_compacted) (#5488)\n\n* Add test case for PR #5483 / issue #5365\r\n\r\n* Python: apply timeout_millis to receive() and read_next() in tests\r\n", "commitDateTime": "2019-10-31 00:17:09", "authoredDateTime": "2019-10-31 07:17:09", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/pulsar_test.py", "insertions": 42, "deletions": 27, "lines": 69}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "153d190aed731529be2ddf65830fe028a2dbf2b0", "commitGHEventType": "referenced", "commitUser": "wolfstudy", "commitParents": ["6162a71fa0af93f8ffad055342fa47d7ab83c482"], "nameRev": "153d190aed731529be2ddf65830fe028a2dbf2b0 tags/v2.4.2-candidate-1~23", "commitMessage": "Add is_read_compacted to create_reader() in python API (#5483)\n\nFixes #5365\n\n(cherry picked from commit 49a8658cac4b8f842feae9a00ad3b2480c7916ac)\n", "commitDateTime": "2019-11-19 19:52:36", "authoredDateTime": "2019-10-28 16:16:30", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/pulsar/__init__.py", "insertions": 8, "deletions": 1, "lines": 9}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 2, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[website] Some company logos are not displayed well on poweredby website", "body": "**Describe the bug**\r\nSome company logos are not displayed well on website http://pulsar.apache.org/powered-by/\r\n\r\n![image](https://user-images.githubusercontent.com/47805623/66643570-9488a500-ec51-11e9-978a-aa3aad9e8547.png)\r\n![image](https://user-images.githubusercontent.com/47805623/66643578-9ce0e000-ec51-11e9-842e-f6fbd9362a99.png)\r\n![image](https://user-images.githubusercontent.com/47805623/66643597-a407ee00-ec51-11e9-9a04-68b3ed0d9bcd.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5362", "user": "Jennifer88huang", "labels": ["type/bug"], "created": "2019-10-11 10:05:04", "closed": "2019-10-23 11:03:30", "commits": {}, "ttf": 12.000277777777777, "commitsDetails": []}, {"title": "Proxy doesn't send request body on redirects", "body": "**Describe the bug**\r\nWhen using multiple brokers behind a proxy, requests with a request body from the client fail. See #3702 as an example. The following seems to be what happens:\r\n\r\n- The client makes a request to proxy\r\n- The proxy forward the requests to the broker\r\n- The broker is not authoritative for that request, so it responds with a redirect\r\n- The proxy follows the redirect but DOES NOT forward on the original request body\r\n- The second broker, seeing a content-length header but never getting a body, waits for a full response but then times out\r\n- The proxy responds with a 504 gateway timeout\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Run multiple brokers\r\n2. Run a proxy in front of the brokers\r\n3. make an admin request that takes a request body and must be routed to a specific broker, like creating a subscription to a specific ledger id (a default subscription doesn't send a request body)\r\n4. Try a few times, you should eventually get a gateway timeout\r\n\r\nThis appears to be the case with and without TLS. I haven't yet tried it without authentication\r\n\r\n**Expected behavior**\r\nThe request should succeed, with the request body being sent with the redirect\r\n\r\n**Screenshots**\r\nI validate this with tcp dumps:\r\n\r\nThe initial request to the first broker:\r\n```\r\nPUT /admin/v2/persistent/code/gerrit-events/message_bus%3Aref-updated/subscription/flink-pulsar-2a7cc468-6712-44b9-8b8f-0c8b86b78dae HTTP/1.1\r\nAuthorization: Bearer ...\r\nUser-Agent: Pulsar-Java-v2.4.1\r\nHost: pulsar-pdx.bus-beta.insk8s.net:8443\r\nAccept: application/json\r\nContent-Type: application/json\r\nVia: http/1.1 pulsar-beta-proxy-6b87d7f8cc-thmmp\r\nX-Forwarded-For: 10.11.62.69\r\nX-Forwarded-Proto: https\r\nX-Forwarded-Host: pulsar-pdx.bus-beta.insk8s.net:8443\r\nX-Forwarded-Server: 10.11.61.62\r\nX-Original-Principal: code-admin\r\nContent-Length: 82\r\n\r\n{\"ledgerId\":9223372036854775807,\"entryId\":9223372036854775807,\"partitionIndex\":-1}\r\n\r\nHTTP/1.1 307 Temporary Redirect\r\nDate: Thu, 10 Oct 2019 23:11:41 GMT\r\nLocation: http://10.11.41.134:8080/admin/v2/persistent/code/gerrit-events/message_bus%3Aref-updated/subscription/flink-pulsar-2a7cc468-6712-44b9-8b8f-0c8b86b78dae?authoritative=false\r\nbroker-address: 10.11.54.198\r\nContent-Length: 0\r\nServer: Jetty(9.4.12.v20180830)\r\n```\r\n\r\nThe redirect to the second broker (from the proxy)\r\n```\r\nPUT /admin/v2/persistent/code/gerrit-events/message_bus%3Aref-updated/subscription/flink-pulsar-2a7cc468-6712-44b9-8b8f-0c8b86b78dae?authoritative=false HTTP/1.1\r\nUser-Agent: Jetty/9.4.12.v20180830\r\nUser-Agent: Pulsar-Java-v2.4.1\r\nAccept: application/json\r\nContent-Type: application/json\r\nVia: http/1.1 pulsar-beta-proxy-6b87d7f8cc-thmmp\r\nX-Forwarded-For: 10.11.62.69\r\nX-Forwarded-Proto: https\r\nX-Forwarded-Host: pulsar-pdx.bus-beta.insk8s.net:8443\r\nX-Forwarded-Server: 10.11.61.62\r\nX-Original-Principal: code-admin\r\nAuthorization: Bearer ...\r\nHost: 10.11.41.134:8080\r\nContent-Length: 82\r\n\r\nHTTP/1.1 500 Request failed.\r\nDate: Thu, 10 Oct 2019 23:11:41 GMT\r\nContent-Length: 0\r\nServer: Jetty(9.4.12.v20180830)\r\n```\r\n\r\nNote that the content-length is set but no body is sent.\r\n\r\n\r\n**Desktop (please complete the following information):**\r\nOccurs with Pulsar 2.4.1 on linux\r\n\r\n**Additional context**\r\nI have spent a fair amount of time trying to debug this, here are some known details:\r\n\r\nIn `AdminProxyHandler`, we copy the request, see https://github.com/apache/pulsar/blob/v2.4.1/pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/AdminProxyHandler.java#L152\r\n\r\nThe super method here, https://github.com/eclipse/jetty.project/blob/jetty-9.4.12.v20180830/jetty-client/src/main/java/org/eclipse/jetty/client/HttpClient.java#L459, copies the content.\r\n\r\nHowever, the contentProvider may be an iterator, that depending on the implementation, can't be reset. It isn't clear what implementation would be used by the proxy. \r\n\r\nAdditionally, this is made more difficult as it seems like the admin proxy isn't logging as expected. With debug level logs turned on, I didn't see logs from the proxy for some code paths I am sure it should be in.\r\n\r\nI think the next step might be to have the AdminProxyHandler consume the request body before sending the first request and then re-attaching it for the first and any subsequent proxied requests\r\n", "url": "https://github.com/apache/pulsar/issues/5360", "user": "addisonj", "labels": ["type/bug"], "created": "2019-10-11 03:56:55", "closed": "2019-10-24 16:58:42", "commits": {"978efaf11359101042ea80aefad5dd6c9b78d58a": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "381fd6d5ceed740f7efee67b71958a659fdefdfe": {"commitGHEventType": "referenced", "commitUser": "wolfstudy"}}, "ttf": 13.000277777777777, "commitsDetails": [{"commitHash": "978efaf11359101042ea80aefad5dd6c9b78d58a", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["a71ac2084ba062b19c3b0a2238022459173b5092"], "nameRev": "978efaf11359101042ea80aefad5dd6c9b78d58a tags/v2.5.0-candidate-1~196", "commitMessage": "[proxy] Fix proxy to be able to re-send request body (#5361)\n\nFixes #5360\r\n\r\nThis adds a small cache of the request body to ensure that it can be\r\nre-sent.\r\n\r\nTODO: still needs tested", "commitDateTime": "2019-10-24 09:58:41", "authoredDateTime": "2019-10-24 10:58:41", "commitGitStats": [{"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/AdminProxyHandler.java", "insertions": 40, "deletions": 0, "lines": 40}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/proxy/TestProxy.java", "insertions": 24, "deletions": 0, "lines": 24}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminProxyHandler.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.AdminProxyHandler.ReplayableProxyContentProvider", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.AdminProxyHandler.proxyRequestContent(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse,org.eclipse.jetty.client.api.Request)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TestProxy.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.proxy.TestProxy.testProxyRequestBodyRedirect()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "381fd6d5ceed740f7efee67b71958a659fdefdfe", "commitGHEventType": "referenced", "commitUser": "wolfstudy", "commitParents": ["0884d7cc197e32da25ccdd4667a43595380dbfd9"], "nameRev": "381fd6d5ceed740f7efee67b71958a659fdefdfe tags/v2.4.2-candidate-1~43", "commitMessage": "[proxy] Fix proxy to be able to re-send request body (#5361)\n\nFixes #5360\r\n\r\nThis adds a small cache of the request body to ensure that it can be\r\nre-sent.\r\n\r\nTODO: still needs tested\n(cherry picked from commit 978efaf11359101042ea80aefad5dd6c9b78d58a)\n", "commitDateTime": "2019-11-19 19:12:48", "authoredDateTime": "2019-10-24 10:58:41", "commitGitStats": [{"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/AdminProxyHandler.java", "insertions": 40, "deletions": 0, "lines": 40}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/proxy/TestProxy.java", "insertions": 24, "deletions": 0, "lines": 24}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminProxyHandler.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.AdminProxyHandler.ReplayableProxyContentProvider", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.AdminProxyHandler.proxyRequestContent(javax.servlet.http.HttpServletRequest,javax.servlet.http.HttpServletResponse,org.eclipse.jetty.client.api.Request)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TestProxy.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.proxy.TestProxy.testProxyRequestBodyRedirect()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "UnAckedMessageTracker: 3600 messages have timed-out... but they haven't?", "body": "**Describe the bug**\r\n~I've deployed a topic into Pulsar 2.4.1 with default configuration for message TTL, which as I understand it should mean that unacked messages should be retained forever.~ \r\n\r\nUPDATE: I've realized the UnAckedMessageTracker does something different than I thought it did. The behavior is still unexplained though.\r\n\r\nI've deployed a topic into Pulsar and my consumers are configured with ackTimeout = 60 minutes. However, my consumers always either negative ack or ack messages. There may be rare situations in which neither of these happen (application crash or network problem), but for some reason my consumers consistently and periodically report:\r\n\r\n```\r\norg.apa.pul.cli.imp.UnAckedMessageTracker : [ConsumerBase{subscription='my-sub', consumerName='my-consumer', topic='persistent://dev/my-ns/q'}] 3600 messages have timed-out\r\n```\r\n\r\nI've seen this on 3 separate environments, starting the topic and associated subscriptions from scratch. Subscriptions are Shared, and configured to start at position \"earliest\".\r\n\r\nThe value is always 3600. In all 3 environments, which have vastly different numbers of messages in the topic, the number is always 3600. In some environments I don't believe 3600 messages were even placed into the topic, so it shouldn't be possible for there to be 3600 unacked messages.\r\n\r\nThis doesn't actually appear to cause any problems -- everything seems to be working normally. Its just an annoying message to see.\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a topic with default settings, change retention size to -1 and retention period to 1 hour (I can't see how these settings would be relevant, but that's what my topics have).\r\n2. Produce and consume some messages from the topic, ensure they are all acked or nacked.\r\n3. Wait until the warning is reported.\r\n\r\n**Expected behavior**\r\nNo warning.\r\n", "url": "https://github.com/apache/pulsar/issues/5349", "user": "rocketraman", "labels": ["triage/week-43", "type/bug"], "created": "2019-10-09 19:13:55", "closed": "2019-10-28 09:11:26", "commits": {"09360682953d0cbc154630a470492c11a4f83184": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "bd0752eeebf9788e23662895cffff5fdec551b46": {"commitGHEventType": "referenced", "commitUser": "wolfstudy"}}, "ttf": 18.00027777777778, "commitsDetails": [{"commitHash": "09360682953d0cbc154630a470492c11a4f83184", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["89e3f30d572362e8cf541e67729371eaa26c2002"], "nameRev": "09360682953d0cbc154630a470492c11a4f83184 tags/v2.5.0-candidate-1~180", "commitMessage": "Fix wrongly report \"3600 messages have timed-out\" (#5477)\n\nrelated issue #5349", "commitDateTime": "2019-10-28 17:11:25", "authoredDateTime": "2019-10-28 17:11:25", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/UnAckedMessageTracker.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "UnAckedMessageTracker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.UnAckedMessageTracker.2.run(io.netty.util.Timeout)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "bd0752eeebf9788e23662895cffff5fdec551b46", "commitGHEventType": "referenced", "commitUser": "wolfstudy", "commitParents": ["7914eb31bab006cc75b14216ac74ac0525e03148"], "nameRev": "bd0752eeebf9788e23662895cffff5fdec551b46 tags/v2.4.2-candidate-1~26", "commitMessage": "Fix wrongly report \"3600 messages have timed-out\" (#5477)\n\nrelated issue #5349\n\n(cherry picked from commit 09360682953d0cbc154630a470492c11a4f83184)\n", "commitDateTime": "2019-11-19 19:39:22", "authoredDateTime": "2019-10-28 17:11:25", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/UnAckedMessageTracker.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "UnAckedMessageTracker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.UnAckedMessageTracker.2.run(io.netty.util.Timeout)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Load tls file fail on Windows", "body": "**Describe the bug**\r\n\r\n```\r\n PulsarClient client = PulsarClient.builder()\r\n                .tlsTrustCertsFilePath(\"H:\\\\pulsar\\\\ssl\\\\1.11\\\\ca.cert.pem\")\r\n                .authentication(\"org.apache.pulsar.client.impl.auth.AuthenticationTls\",\"tlsCertFile:H:\\\\pulsar\\\\ssl\\\\1.11\\\\admin.cert.pem,tlsKeyFile:H:\\\\pulsar\\\\ssl\\\\1.11\\\\admin.key-pk8.pem\")\r\n                .serviceUrl(localClusterUrl)\r\n                .build();\r\n```\r\n\r\nI try to load tls file on windows,but i just got the error:\r\n```\r\norg.apache.pulsar.client.api.PulsarClientException: java.lang.IllegalArgumentException: certFilePath must not be null\r\n```\r\n\r\nI have debug the client code and i found that\r\n\r\n![image](https://user-images.githubusercontent.com/28711504/66500192-b704ac00-eaf3-11e9-98ed-c92096fd21e2.png)\r\n\r\n``org.apache.pulsar.client.api#AuthenticationUtil.configureFromPulsar1AuthParamString``\r\n\r\nIn Windows OS,kv.length = 3, so authParams put fail,\r\n\r\nIf i missed something, tell me please!\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. client load tls on windows\r\n\r\n**Expected behavior**\r\n\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n![image](https://user-images.githubusercontent.com/28711504/66499985-5ecdaa00-eaf3-11e9-9211-4c0c216e85a0.png)\r\n\r\n![image](https://user-images.githubusercontent.com/28711504/66500006-6b520280-eaf3-11e9-91c8-94e00a04cff1.png)\r\n\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Windows\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/5348", "user": "liangyuanpeng", "labels": ["triage/week-43", "type/bug"], "created": "2019-10-09 16:23:15", "closed": "2020-04-20 13:17:23", "commits": {}, "ttf": 193.00027777777777, "commitsDetails": []}, {"title": "bin/pulsar standalone --zookeeper-port 2183 does not work with version 2.4.1", "body": "I need to run Zookeeper in a different port number, so I specify \"--zookeeper-port 2183\" in the command line, but it is still using default port 2181 in the BookieServer configuration. As you can see in the attached log.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to Pulsar installation directory\r\n2. Run the command \"bin/pulsar standalone --zookeeper-port 2183\"\r\n3. Search for 2181 in the logs\r\n4. You will find it in the zookeeperServers property in the log generate for org.apache.bookkeeper.proto.BookieServer.\r\n\r\n**Expected behavior**\r\nIt should use the specified port in all places. I even tried to change the configuration in the bookkeeper.conf file, but it didn't help.\r\n\r\n**Desktop :**\r\n - OS: uname -a\r\nLinux GFT_BTB 3.10.0-1062.1.2.el7.x86_64 #1 SMP Mon Sep 30 14:19:46 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n[output.log](https://github.com/apache/pulsar/files/3707871/output.log)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5346", "user": "ccronemberger", "labels": ["help wanted", "triage/week-43", "type/bug"], "created": "2019-10-09 14:29:44", "closed": "2019-11-19 04:51:21", "commits": {"568df47f6ef603a292f48d0a3bda8a1cea185981": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 40.000277777777775, "commitsDetails": [{"commitHash": "568df47f6ef603a292f48d0a3bda8a1cea185981", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["75c7229bceccc6f70db192d221258cc86ae99f73"], "nameRev": "568df47f6ef603a292f48d0a3bda8a1cea185981 tags/v2.5.0-candidate-1~77", "commitMessage": "[Issue 5346]bin/pulsar standalone --zookeeper-port 2183 does not work with version 2.4.1 (#5679)\n\nFixes [#5346](https://github.com/apache/pulsar/issues/5346)\r\n\r\nWhen start pulsar in standalone mode, and specify zookeeper port using `bin/pulsar standalone --zookeeper-port 2183`, the pulsar will start failed if `configurationStoreServers` is set in conf/standalone.conf and the port not same with --zookeeper-port set in command line.\r\n\r\nThe reason is `--zookeeper-port` set in command line only override zkServer configuration and will not override `configurationStoreServers` in conf/standalone.conf.\r\n\r\nIn my fix, i will override `configurationStoreServers` if using `--zookeeper-port` to setup pulsar in standalone mode.", "commitDateTime": "2019-11-18 20:51:20", "authoredDateTime": "2019-11-19 12:51:20", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/PulsarStandaloneStarter.java", "insertions": 1, "deletions": 3, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarStandaloneStarter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.PulsarStandaloneStarter", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[Doc] Fix doc issues related to BookKeeper, Python Client, and so on", "body": "Fix some issues reported by @candlerb (b.candler@pobox.com):\r\n\r\n![image](https://user-images.githubusercontent.com/50226895/66488067-f0332100-eadf-11e9-9c4b-4a8c2bdf19c2.png)\r\n", "url": "https://github.com/apache/pulsar/issues/5345", "user": "Anonymitaet", "labels": ["component/documentation", "triage/week-43", "type/bug"], "created": "2019-10-09 14:01:36", "closed": "2019-11-04 09:31:40", "commits": {}, "ttf": 25.00027777777778, "commitsDetails": []}, {"title": "pulsar released package missing configuraion for ranges from bookkie", "body": "**Describe the bug**\r\nStandalone pulsar's bookie creates data/ranges folder even bookkeeper's data path is changed to another folder. This data/ranges folder is used by data.bookkeeper.ranges, which can be configured in the bookkeeper package downloaded from apache bookkeeper but not pulsar.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to the conf folder and change all data paths of the bookie. Don't use any path containing `data/`\r\n2. Execute standalone with `--bookkeeper-dir` pointing to other locations outside PULSAR_HOME for some time.\r\n\r\n**Expected behavior**\r\nNo data/ranges should exist because bookkeeper's data folder is changed to another location, but I can still see it.\r\n", "url": "https://github.com/apache/pulsar/issues/5326", "user": "hanbo1990", "labels": ["help wanted", "triage/week-43", "type/bug"], "created": "2019-10-07 18:24:19", "closed": "2020-01-25 03:21:01", "commits": {"5ae7a002edd12c9255f37e4f0b05bf1b374de947": {"commitGHEventType": "closed", "commitUser": "sijie"}}, "ttf": 109.00027777777778, "commitsDetails": [{"commitHash": "5ae7a002edd12c9255f37e4f0b05bf1b374de947", "commitGHEventType": "closed", "commitUser": "sijie", "commitParents": ["e1e252374ed4a9fab9b759391c32005d98bfbad8"], "nameRev": "5ae7a002edd12c9255f37e4f0b05bf1b374de947 tags/v2.6.0-candidate-1~579", "commitMessage": "make bookie ranges stored in path/to/bkdata/ranges (#6082)\n\nFixes #5326  \r\n\r\n### Motivation\r\n\r\nAfter this fix, pulsar will not create data/bookkeeper/ranges in the pulsar library folder after executing `bin/pulsar standalone --bookkeeper-dir dir1 --zookeeper-dir dir2`. All the bookie ranges will be stored in bookkeeper's data directory. \r\n\r\n### Modifications\r\nPass `storage.range.store.dirs` to storage server when starting pulsar. Hardcode ranges's dir to ${path/to/bookie/datadir}/ranges/data, just under bookie. \r\n\r\n### Verifying this change\r\nFollow the steps in [issue 5326](https://github.com/apache/pulsar/issues/5326) and start pulsar with `bin/pulsar standalone --bookkeeper-dir dir1 --zookeeper-dir dir2`", "commitDateTime": "2020-01-24 19:20:59", "authoredDateTime": "2020-01-25 04:20:59", "commitGitStats": [{"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/LocalBookkeeperEnsemble.java", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "LocalBookkeeperEnsemble.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.runStreamStorage(org.apache.commons.configuration.CompositeConfiguration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[go client] Producer::Close() may get stuck", "body": "**Describe the bug**\r\nIn the situation I confirmed, when entering [the logic](https://github.com/apache/pulsar/blob/v2.3.2/pulsar-client-cpp/lib/ProducerImpl.cc#L478-L484), [`C._pulsar_producer_close_async()`](https://github.com/apache/pulsar/blob/v2.3.2/pulsar-client-go/pulsar/c_producer.go#L228) gets stuck with [`c<-err` in callback](https://github.com/apache/pulsar/blob/v2.3.2/pulsar-client-go/pulsar/c_producer.go#L223) and [`<-c`](https://github.com/apache/pulsar/blob/v2.3.2/pulsar-client-go/pulsar/c_producer.go#L224) is not executed.\r\nTherefore, `Producer::Close()` does not finish.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Producer connects to broker\r\n2. Revoke the producer's permission to produce(e.g. `pulsar-admin namespaces revoke-permission  --role \"producer.role\" public/global/n1`)\r\n3. Execute `Producer.Close()`\r\n\r\n\r\nI confirmed I can avoid the issue in the following ways.\r\nBut I don\u2019t know the best way(Should we modify c++ code?).\r\n1. Use `go`\r\n```\r\nfunc (p *producer) CloseAsync(callback func(error)) {\r\n-\tC._pulsar_producer_close_async(p.ptr, savePointer(callback))\r\n+\tgo C._pulsar_producer_close_async(p.ptr, savePointer(callback))\r\n}\r\n```\r\n\r\n2. Use `C.pulsar_producer_close()` like `Client.Close()`\r\n```\r\nfunc (p *producer) Close() error {\r\n      res := C.pulsar_producer_close(p.ptr)\r\n      if res != C.pulsar_result_Ok {\r\n              return newError(res, \"Failed to close Pulsar client\")\r\n      } else {\r\n              return nil\r\n      }\r\n}\r\n```", "url": "https://github.com/apache/pulsar/issues/5324", "user": "hrsakai", "labels": ["type/bug"], "created": "2019-10-06 15:22:30", "closed": "2019-10-11 06:37:26", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "Pulsar 2.4.1 - Broker stops server Admin API at random", "body": "**Describe the bug**\r\nThe broker stops serving the Admin API.  When it stops serving the Admin API, there is a corresponding WARN message from org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.  Right now the issue is random but seems to be happening every few hours.  Restarting the Broker is the only way to recover.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\nThe cluster has two HAProxy load balancing to two Pulsar Proxies.  Behind the Proxies there are 3 Pulsar Brokers, and 4 Pulsar Bookies.  The behavior is random, though usually happens every 2-3 hours to a broker in the cluster.  If I let the problem go long enough, it will affect all 3 brokers.\r\n\r\n\r\n**Expected behavior**\r\nAdmi API is served without disruptions.\r\n\r\n**Screenshots**\r\nThe Log message below that corresponds with the time the broker stops serving HTTP(S) requests.\r\n\r\n```\r\n2019-10-04 13:58:12.292 [pulsar-web-29-5] WARN  org.eclipse.jetty.util.thread.strategy.EatWhatYouKill -\r\njava.nio.channels.CancelledKeyException: null\r\n        at sun.nio.ch.SelectionKeyImpl.ensureValid(SelectionKeyImpl.java:71) ~[?:?]\r\n        at sun.nio.ch.SelectionKeyImpl.readyOps(SelectionKeyImpl.java:130) ~[?:?]\r\n        at org.eclipse.jetty.io.ManagedSelector$SelectorProducer.processSelected(ManagedSelector.java:473) ~[org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at org.eclipse.jetty.io.ManagedSelector$SelectorProducer.produce(ManagedSelector.java:351) ~[org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.produceTask(EatWhatYouKill.java:357) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:181) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at java.lang.Thread.run(Thread.java:834) [?:?]\r\n```\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [Ubuntu]\r\n\r\n**Additional context**\r\nNone\r\n", "url": "https://github.com/apache/pulsar/issues/5318", "user": "digi691", "labels": ["type/bug"], "created": "2019-10-04 21:55:31", "closed": "2019-10-24 00:19:24", "commits": {}, "ttf": 19.00027777777778, "commitsDetails": []}, {"title": "Function REST API documentation is insufficient for Create POST action", "body": "**Describe the bug**\r\n\r\nI\u2019m attempting to create a function through the REST API, and I\u2019m getting a 415 Unsupported Media Type response. I had this same issue when creating a PUT to create a new tenant through the REST API, but I resolved that issue by setting the content type to \"application/json; charset=utf-8\". However, with the POST of the function, I\u2019m still getting this issue. \r\n\r\n**To Reproduce**\r\n\r\nIn the docs (https://pulsar.apache.org/functions-rest-api/?version=2.4.1#operation/registerFunction), the example of the expected POST body is this:\r\n```\r\n{\r\n  \"inputs\": persistent://public/default/input-topic,\r\n  \"parallelism\": 4\r\n  \"output\": persistent://public/default/output-topic\r\n  \"log-topic\": persistent://public/default/log-topic\r\n  \"classname\": org.example.test.ExclamationFunction\r\n  \"jar\": java-function-1.0-SNAPSHOT.jar\r\n}\r\n```\r\n\r\nI\u2019ve checked the POST body that I'm sending via Wireshark, and the content is valid JSON.\r\nThis is my post body:\r\n`{\"namespace\":\"exampleNamespace\",\"tenant\":\"exampleTenant\",\"name\":\"exampleFunction\",\"jar\":\"http://repository.domain.com/example-jar-1.0.1-20191001.001216-48-jar-with-dependencies.jar\",\"className\":\"com.overstock.path.to.class\",\"output\":\"persistent://exampleTenant/exampleNamespace/exampleOutputTopic\",\"logTopic\":\"persistent://exampleTenant/exampleNamespace/exampleLogTopic\",\"inputs\":[\"persistent://exampleTenant/exampleNamespace/exampleInputTopic\"],\"userConfig\":{\"hostname\":\"endpoint.domain.com\",\"port\":\"9082\"}}`\r\n\r\nThe method I'm using to send this JSON string is this (written in Golang):\r\n\r\n```\r\nfunc createPost(serviceURL string, messageBody string) *http.Response {\r\n    var netClient = &http.Client{\r\n        Timeout: time.Second * 10,\r\n    }\r\n    log.Println(\"This is the body of our POST:\")\r\n    log.Println(messageBody)\r\n    //msgBodyMarshalled, _ := json.Marshal(messageBody)\r\n    msgBodyMarshalled := []byte(messageBody)\r\n    resp, err := netClient.Post(serviceURL, \"application/json; charset=utf-8\", bytes.NewBuffer(msgBodyMarshalled))\r\n    if err != nil {\r\n        log.Fatalln(err)\r\n    }\r\n    defer resp.Body.Close()\r\n\r\n    body, err := ioutil.ReadAll(resp.Body)\r\n    if err != nil {\r\n        log.Fatalln(err)\r\n    }\r\n    log.Println(string(body))\r\n    return resp\r\n}\r\n```\r\n\r\nIn the source code for the endpoint, it\u2019s not clear how the post body is translated to the endpoint because the expected parameters do not match the docs cited above (https://pulsar.apache.org/functions-rest-api/?version=2.4.1#operation/registerFunction):\r\n\r\n```\r\npublic FunctionsApiV3Resource() {\r\n        this.functions = new FunctionsImpl(this);\r\n    }\r\n\r\n    @POST\r\n    @Path(\"/{tenant}/{namespace}/{functionName}\")\r\n    @Consumes(MediaType.MULTIPART_FORM_DATA)\r\n    public void registerFunction(final @PathParam(\"tenant\") String tenant,\r\n                                 final @PathParam(\"namespace\") String namespace,\r\n                                 final @PathParam(\"functionName\") String functionName,\r\n                                 final @FormDataParam(\"data\") InputStream uploadedInputStream,\r\n                                 final @FormDataParam(\"data\") FormDataContentDisposition fileDetail,\r\n                                 final @FormDataParam(\"url\") String functionPkgUrl,\r\n                                 final @FormDataParam(\"functionConfig\") FunctionConfig functionConfig) {\r\n\r\n        functions.registerFunction(tenant, namespace, functionName, uploadedInputStream, fileDetail,\r\n                functionPkgUrl, functionConfig, clientAppId(), clientAuthData());\r\n    }\r\n```\r\n\r\nFrom the Glassfish docs on @FormDataParam, it appears that the expected content type is actually `multipart/form-data`, not `application/json`. To investigate this, I created a Wireshark capture of a Functions Create message being sent from the Pulsar Admin CLI. Sure enough, the content of the message is `multipart/form-data`, not `application/json`. \r\n\r\n**Expected behavior**\r\nThe Pulsar docs should provide a clearer example of what is expected as the body for a POST for Functions Create. \r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/7418031/66170969-b9eb3280-e603-11e9-860d-c52b7c4d9b57.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5312", "user": "devinbost", "labels": ["component/documentation", "component/functions", "triage/week-43", "type/bug"], "created": "2019-10-03 23:34:34", "closed": "2019-11-25 12:04:39", "commits": {}, "ttf": 52.000277777777775, "commitsDetails": []}, {"title": "presto connection to pulsar issues", "body": "1.\r\n#hanging for more than 10mins so i killed it (presto .220 and pulsar 2.4.0)\r\nselect * from \"event-notification-test-topic\" limit 1;\r\n\r\n2.\r\n\r\npresto:public/default> show create table \"trade-status-test\";\r\nQuery 20191001_090836_00019_dq4m7 failed: Table has no columns: TableHandle{connectorId=pulsar, connectorHandle=PulsarTableHandle{connectorId=pulsar, schemaName=public/default, tableName=trade-status-test, topicName=trade-status-test}, layout=Optional.empty}\r\ncom.facebook.presto.spi.PrestoException: Table has no columns: TableHandle{connectorId=pulsar, connectorHandle=PulsarTableHandle{connectorId=pulsar, schemaName=public/default, tableName=trade-status-test, topicName=trade-status-test}, layout=Optional.empty}\r\n        at com.facebook.presto.metadata.MetadataManager.getTableMetadata(MetadataManager.java:480)\r\n        at com.facebook.presto.sql.rewrite.ShowQueriesRewrite$Visitor.visitShowCreate(ShowQueriesRewrite.java:449)\r\n        at com.facebook.presto.sql.rewrite.ShowQueriesRewrite$Visitor.visitShowCreate(ShowQueriesRewrite.java:151)\r\n        at com.facebook.presto.sql.tree.ShowCreate.accept(ShowCreate.java:67)\r\n        at com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:27)\r\n        at com.facebook.presto.sql.rewrite.ShowQueriesRewrite.rewrite(ShowQueriesRewrite.java:148)\r\n        at com.facebook.presto.sql.rewrite.StatementRewrite.rewrite(StatementRewrite.java:53)\r\n        at com.facebook.presto.sql.analyzer.Analyzer.analyze(Analyzer.java:76)\r\n        at com.facebook.presto.sql.analyzer.Analyzer.analyze(Analyzer.java:71)\r\n        at com.facebook.presto.execution.SqlQueryExecution.<init>(SqlQueryExecution.java:209)\r\n        at com.facebook.presto.execution.SqlQueryExecution.<init>(SqlQueryExecution.java:97)\r\n        at com.facebook.presto.execution.SqlQueryExecution$SqlQueryExecutionFactory.createQueryExecution(SqlQueryExecution.java:744)\r\n        at com.facebook.presto.execution.SqlQueryManager.createQueryInternal(SqlQueryManager.java:366)\r\n        at com.facebook.presto.execution.SqlQueryManager.lambda$createQuery$4(SqlQueryManager.java:305)\r\n        at com.facebook.presto.$gen.Presto_0_220_dirty__0_220____20191001_090225_1.run(Unknown Source)\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n        at java.lang.Thread.run(Thread.java:748)\r\n\r\n3.\r\n\r\npresto:public/default> select count(1) c, 'test' t from \"test\";\r\nQuery 20191001_084757_00078_y4kjh failed: name is null\r\njava.lang.NullPointerException: name is null\r\n        at com.facebook.presto.spi.SchemaUtil.checkNotEmpty(SchemaUtil.java:25)\r\n        at com.facebook.presto.spi.ColumnMetadata.<init>(ColumnMetadata.java:60)\r\n        at com.facebook.presto.spi.ColumnMetadata.<init>(ColumnMetadata.java:50)\r\n        at org.apache.pulsar.sql.presto.PulsarColumnMetadata.<init>(PulsarColumnMetadata.java:39)\r\n        at org.apache.pulsar.sql.presto.PulsarMetadata.getColumns(PulsarMetadata.java:449)\r\n        at org.apache.pulsar.sql.presto.PulsarMetadata.getPulsarColumnsFromStructSchema(PulsarMetadata.java:392)\r\n        at org.apache.pulsar.sql.presto.PulsarMetadata.getPulsarColumns(PulsarMetadata.java:342)\r\n        at org.apache.pulsar.sql.presto.PulsarMetadata.getTableMetadata(PulsarMetadata.java:326)\r\n        at org.apache.pulsar.sql.presto.PulsarMetadata.getTableMetadata(PulsarMetadata.java:159)\r\n        at com.facebook.presto.metadata.MetadataManager.getTableMetadata(MetadataManager.java:478)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.visitTable(StatementAnalyzer.java:926)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.visitTable(StatementAnalyzer.java:257)\r\n        at com.facebook.presto.sql.tree.Table.accept(Table.java:53)\r\n        at com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:27)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.process(StatementAnalyzer.java:271)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.analyzeFrom(StatementAnalyzer.java:1852)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.visitQuerySpecification(StatementAnalyzer.java:1031)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.visitQuerySpecification(StatementAnalyzer.java:257)\r\n        at com.facebook.presto.sql.tree.QuerySpecification.accept(QuerySpecification.java:127)\r\n        at com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:27)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.process(StatementAnalyzer.java:271)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.process(StatementAnalyzer.java:281)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.visitQuery(StatementAnalyzer.java:746)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.visitQuery(StatementAnalyzer.java:257)\r\n        at com.facebook.presto.sql.tree.Query.accept(Query.java:94)\r\n        at com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:27)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.process(StatementAnalyzer.java:271)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer.analyze(StatementAnalyzer.java:249)\r\n        at com.facebook.presto.sql.analyzer.Analyzer.analyze(Analyzer.java:79)\r\n        at com.facebook.presto.sql.analyzer.Analyzer.analyze(Analyzer.java:71)\r\n        at com.facebook.presto.execution.SqlQueryExecution.<init>(SqlQueryExecution.java:209)\r\n        at com.facebook.presto.execution.SqlQueryExecution.<init>(SqlQueryExecution.java:97)\r\n        at com.facebook.presto.execution.SqlQueryExecution$SqlQueryExecutionFactory.createQueryExecution(SqlQueryExecution.java:744)\r\n        at com.facebook.presto.execution.SqlQueryManager.createQueryInternal(SqlQueryManager.java:366)\r\n        at com.facebook.presto.execution.SqlQueryManager.lambda$createQuery$4(SqlQueryManager.java:305)\r\n        at com.facebook.presto.$gen.Presto_0_220_dirty__0_220____20191001_083044_1.run(Unknown Source)\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n        at java.lang.Thread.run(Thread.java:748)\r\n\r\n4.\r\n\r\npresto:public/default> select count(1) c, 'tradestore-deadletter-topic' t from \"tradestore-deadletter-topic\";\r\nQuery 20191001_084810_00081_y4kjh failed: org.apache.bookkeeper.mledger.ManagedLedgerException: java.util.concurrent.CompletionException: org.apache.bookkeeper.client.BKException$BKReadException: Error while reading ledger\r\njava.lang.RuntimeException: org.apache.bookkeeper.mledger.ManagedLedgerException: java.util.concurrent.CompletionException: org.apache.bookkeeper.client.BKException$BKReadException: Error while reading ledger\r\n        at org.apache.pulsar.sql.presto.PulsarSplitManager.getSplits(PulsarSplitManager.java:134)\r\n        at com.facebook.presto.split.SplitManager.getSplits(SplitManager.java:82)\r\n        at com.facebook.presto.split.CloseableSplitSourceProvider.getSplits(CloseableSplitSourceProvider.java:51)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory$Visitor.lambda$visitTableScan$0(SplitSourceFactory.java:126)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory$Visitor.visitTableScan(SplitSourceFactory.java:131)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory$Visitor.visitTableScan(SplitSourceFactory.java:102)\r\n        at com.facebook.presto.sql.planner.plan.TableScanNode.accept(TableScanNode.java:175)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory$Visitor.visitProject(SplitSourceFactory.java:258)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory$Visitor.visitProject(SplitSourceFactory.java:102)\r\n        at com.facebook.presto.sql.planner.plan.ProjectNode.accept(ProjectNode.java:77)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory$Visitor.visitAggregation(SplitSourceFactory.java:222)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory$Visitor.visitAggregation(SplitSourceFactory.java:102)\r\n        at com.facebook.presto.sql.planner.plan.AggregationNode.accept(AggregationNode.java:198)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory$Visitor.processSources(SplitSourceFactory.java:356)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory$Visitor.visitExchange(SplitSourceFactory.java:349)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory$Visitor.visitExchange(SplitSourceFactory.java:102)\r\n        at com.facebook.presto.sql.planner.plan.ExchangeNode.accept(ExchangeNode.java:281)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory$Visitor.visitAggregation(SplitSourceFactory.java:222)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory$Visitor.visitAggregation(SplitSourceFactory.java:102)\r\n        at com.facebook.presto.sql.planner.plan.AggregationNode.accept(AggregationNode.java:198)\r\n        at com.facebook.presto.sql.planner.SplitSourceFactory.createSplitSources(SplitSourceFactory.java:84)\r\n        at com.facebook.presto.execution.scheduler.SqlQueryScheduler.createStreamingLinkedStages(SqlQueryScheduler.java:411)\r\n        at com.facebook.presto.execution.scheduler.SqlQueryScheduler.createStreamingLinkedStages(SqlQueryScheduler.java:500)\r\n        at com.facebook.presto.execution.scheduler.SqlQueryScheduler.createStages(SqlQueryScheduler.java:327)\r\n        at com.facebook.presto.execution.scheduler.SqlQueryScheduler.<init>(SqlQueryScheduler.java:207)\r\n        at com.facebook.presto.execution.scheduler.SqlQueryScheduler.createSqlQueryScheduler(SqlQueryScheduler.java:154)\r\n        at com.facebook.presto.execution.SqlQueryExecution.planDistribution(SqlQueryExecution.java:490)\r\n        at com.facebook.presto.execution.SqlQueryExecution.startExecution(SqlQueryExecution.java:359)\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n        at java.lang.Thread.run(Thread.java:748)\r\nCaused by: org.apache.bookkeeper.mledger.ManagedLedgerException: java.util.concurrent.CompletionException: org.apache.bookkeeper.client.BKException$BKReadException: Error while reading ledger\r\nCaused by: java.util.concurrent.CompletionException: org.apache.bookkeeper.client.BKException$BKReadException: Error while reading ledger\r\n        at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)\r\n        at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)\r\n        at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:647)\r\n        at java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:632)\r\n        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n        at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)\r\n        at org.apache.bookkeeper.client.SyncCallbackUtils.finish(SyncCallbackUtils.java:83)\r\n        at org.apache.bookkeeper.client.SyncCallbackUtils$SyncOpenCallback.openComplete(SyncCallbackUtils.java:157)\r\n        at org.apache.bookkeeper.client.LedgerOpenOp.openComplete(LedgerOpenOp.java:232)\r\n        at org.apache.bookkeeper.client.LedgerOpenOp$2.readLastConfirmedComplete(LedgerOpenOp.java:215)\r\n        at org.apache.bookkeeper.client.LedgerHandle$10.readLastConfirmedDataComplete(LedgerHandle.java:1393)\r\n        at org.apache.bookkeeper.client.ReadLastConfirmedOp.readEntryComplete(ReadLastConfirmedOp.java:142)\r\n        at org.apache.bookkeeper.proto.BookieClientImpl$2.safeRun(BookieClientImpl.java:330)\r\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.lang.Thread.run(Thread.java:748)\r\nCaused by: org.apache.bookkeeper.client.BKException.BKReadException: Error while reading ledger\r\n        ... 12 more\r\n\r\n5.\r\n\r\npresto:public/default> select * from \"myenvoysampletopic\";\r\nQuery 20191001_090442_00008_dq4m7 failed: Table 'public/default.myenvoysampletopic' not found\r\ncom.facebook.presto.spi.TableNotFoundException: Table 'public/default.myenvoysampletopic' not found\r\n        at org.apache.pulsar.sql.presto.PulsarMetadata.getTableMetadata(PulsarMetadata.java:282)\r\n        at org.apache.pulsar.sql.presto.PulsarMetadata.getTableMetadata(PulsarMetadata.java:141)\r\n        at com.facebook.presto.metadata.MetadataManager.getTableMetadata(MetadataManager.java:478)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.visitTable(StatementAnalyzer.java:926)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.visitTable(StatementAnalyzer.java:257)\r\n        at com.facebook.presto.sql.tree.Table.accept(Table.java:53)\r\n        at com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:27)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.process(StatementAnalyzer.java:271)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.analyzeFrom(StatementAnalyzer.java:1852)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.visitQuerySpecification(StatementAnalyzer.java:1031)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.visitQuerySpecification(StatementAnalyzer.java:257)\r\n        at com.facebook.presto.sql.tree.QuerySpecification.accept(QuerySpecification.java:127)\r\n        at com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:27)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.process(StatementAnalyzer.java:271)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.process(StatementAnalyzer.java:281)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.visitQuery(StatementAnalyzer.java:746)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.visitQuery(StatementAnalyzer.java:257)\r\n        at com.facebook.presto.sql.tree.Query.accept(Query.java:94)\r\n        at com.facebook.presto.sql.tree.AstVisitor.process(AstVisitor.java:27)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer$Visitor.process(StatementAnalyzer.java:271)\r\n        at com.facebook.presto.sql.analyzer.StatementAnalyzer.analyze(StatementAnalyzer.java:249)\r\n        at com.facebook.presto.sql.analyzer.Analyzer.analyze(Analyzer.java:79)\r\n        at com.facebook.presto.sql.analyzer.Analyzer.analyze(Analyzer.java:71)\r\n        at com.facebook.presto.execution.SqlQueryExecution.<init>(SqlQueryExecution.java:209)\r\n        at com.facebook.presto.execution.SqlQueryExecution.<init>(SqlQueryExecution.java:97)\r\n        at com.facebook.presto.execution.SqlQueryExecution$SqlQueryExecutionFactory.createQueryExecution(SqlQueryExecution.java:744)\r\n        at com.facebook.presto.execution.SqlQueryManager.createQueryInternal(SqlQueryManager.java:366)\r\n        at com.facebook.presto.execution.SqlQueryManager.lambda$createQuery$4(SqlQueryManager.java:305)\r\n        at com.facebook.presto.$gen.Presto_0_220_dirty__0_220____20191001_090225_1.run(Unknown Source)\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n        at java.lang.Thread.run(Thread.java:748)\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5300", "user": "tooptoop4", "labels": ["type/bug"], "created": "2019-10-01 09:26:53", "closed": "2020-04-16 22:25:19", "commits": {}, "ttf": 198.00027777777777, "commitsDetails": []}, {"title": "Getting errors when creating JWT", "body": "**Describe the bug**\r\nI created private/public key pairs using :\r\n\r\n`$ bin/pulsar tokens create-key-pair --output-private-key my-private.key --output-public-key my-public.key`\r\n\r\nAnd I couldn't create a token using the secretkey \ud83d\udc4e \r\n\r\n`bin/pulsar tokens create --private-key file:///path/to/my-private.key \\\r\n            --subject test-user`\r\n\r\n**To Reproduce**\r\n1. `$ bin/pulsar tokens create-key-pair --output-private-key my-private.key --output-public-key my-public.key`\r\n\r\n2.`bin/pulsar tokens create --private-key file:///path/to/my-private.key \\\r\n            --subject test-user`\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 18.04\r\n\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5294", "user": "Loghijiaha", "labels": ["type/bug"], "created": "2019-09-30 08:27:37", "closed": "2020-04-16 22:20:25", "commits": {}, "ttf": 199.00027777777777, "commitsDetails": []}, {"title": "presto connector - how to specify cluster (multi broker/zk) connection", "body": "**Describe the bug**\r\nTrying to connect existing presto (not part of pulsar distro) to pulsar (multi host cluster)\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\ncatalog/pulsar.properties in presto has\r\n\r\n```\r\nconnector.name=pulsar\r\n# the url of Pulsar broker service\r\npulsar.broker-service-url=http://yy:8080;xx:8080\r\n# URI of Zookeeper cluster\r\npulsar.zookeeper-uri=yy,xx:2181\r\n# minimum number of entries to read at a single time\r\n#pulsar.entry-read-batch-size=100\r\n# default number of splits to use per query\r\npulsar.target-num-splits=4\r\n```\r\n\r\n\r\nmajor (1st issue)\r\n```\r\npresto> select * from pulsar.\"public/functions\".assignments;\r\nQuery 20190927_164934_00002_q7acj failed: Failed to get topics in schema public/functions: For input string: \"8080;xx:8080\"\r\n```\r\n\r\nThere is no documentation about how to provide multi hosts for brokers or zk\r\n\r\nminor (2nd issue)\r\n`pulsar.entry-read-batch-size=100 --> this config causes error`\r\n\r\n**Expected behavior**\r\npresto can connect to pulsar/zk cluster (multi hosts)\r\n\r\nenv: using presto .220 and pulsar 2.41\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5287", "user": "tooptoop4", "labels": ["component/documentation", "triage/week-43", "type/bug"], "created": "2019-09-27 17:12:54", "closed": "2019-11-26 16:51:33", "commits": {"14f3eee33b386150bc9a00ecb8d1169df738fc0f": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 59.000277777777775, "commitsDetails": [{"commitHash": "14f3eee33b386150bc9a00ecb8d1169df738fc0f", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f83793ee7f3b3e10ebe50170f492cdfc36e87612"], "nameRev": "14f3eee33b386150bc9a00ecb8d1169df738fc0f tags/v2.5.0-candidate-1~48", "commitMessage": "[Issue 5287][docs] Add documentation on how to configure multiple broker services (#5722)\n\nFixes #5287 \r\n\r\n### Motivation\r\nUsers do not know how to specify cluster (multi broker/zk) connection for presto.\r\n\r\n### Modifications\r\nAdd content on how to configure multiple hosts for `pulsar.broker-service-url`.", "commitDateTime": "2019-11-26 08:51:32", "authoredDateTime": "2019-11-27 00:51:32", "commitGitStats": [{"filePath": "site2/docs/sql-deployment-configurations.md", "insertions": 7, "deletions": 0, "lines": 7}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "JAAS login in broker failed", "body": "**Describe the problem\uff1a**\r\nI followed the guidance of the docs[https://pulsar.apache.org/docs/en/security-kerberos/] and try to use kerberos for authentication in pulsar. But I encountered following problem.\r\n\r\nThe information of exception\uff1a\r\nERROR org.apache.pulsar.broker.authentication.AuthenticationProviderSasl - JAAS login in broker failed: {}\r\njavax.security.auth.login.LoginException: Unrecognized SASL GSSAPI Server Callback. not available to garner  authentication information from the user\r\n        at com.sun.security.auth.module.Krb5LoginModule.promptForPass(Krb5LoginModule.java:940) ~[?:1.8.0_221]\r\n        at com.sun.security.auth.module.Krb5LoginModule.attemptAuthentication(Krb5LoginModule.java:760) ~[?:1.8.0_221]\r\n        at com.sun.security.auth.module.Krb5LoginModule.login(Krb5LoginModule.java:617) ~[?:1.8.0_221]\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_221]\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_221]\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_221]\r\n        at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_221]\r\n        at javax.security.auth.login.LoginContext.invoke(LoginContext.java:755) ~[?:1.8.0_221]\r\n        at javax.security.auth.login.LoginContext.access$000(LoginContext.java:195) ~[?:1.8.0_221]\r\n        at javax.security.auth.login.LoginContext$4.run(LoginContext.java:682) ~[?:1.8.0_221]\r\n        at javax.security.auth.login.LoginContext$4.run(LoginContext.java:680) ~[?:1.8.0_221]\r\n        at java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_221]\r\n        at javax.security.auth.login.LoginContext.invokePriv(LoginContext.java:680) ~[?:1.8.0_221]\r\n        at javax.security.auth.login.LoginContext.login(LoginContext.java:587) ~[?:1.8.0_221]\r\n        at org.apache.pulsar.common.sasl.JAASCredentialsContainer.<init>(JAASCredentialsContainer.java:72) ~[org.apache.pulsar-pulsar-common-2.4.0.jar:2.4.0]\r\n        at org.apache.pulsar.broker.authentication.AuthenticationProviderSasl.initialize(AuthenticationProviderSasl.java:88) [org.apache.pulsar-pulsar-broker-auth-sasl-2.4.0.jar:2.4.0]\r\n        at org.apache.pulsar.broker.authentication.AuthenticationService.<init>(AuthenticationService.java:57) [org.apache.pulsar-pulsar-broker-common-2.4.0.jar:2.4.0]\r\n        at org.apache.pulsar.broker.service.BrokerService.<init>(BrokerService.java:242) [org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n        at org.apache.pulsar.broker.PulsarService.start(PulsarService.java:366) [org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n        at org.apache.pulsar.PulsarBrokerStarter$BrokerStarter.start(PulsarBrokerStarter.java:273) [org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n        at org.apache.pulsar.PulsarBrokerStarter.main(PulsarBrokerStarter.java:332) [org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n10:57:32.153 [main] ERROR org.apache.pulsar.broker.PulsarService - Failed to load an authentication provider.\r\norg.apache.pulsar.broker.PulsarServerException: Failed to load an authentication provider.\r\n        at org.apache.pulsar.broker.authentication.AuthenticationService.<init>(AuthenticationService.java:65) ~[org.apache.pulsar-pulsar-broker-common-2.4.0.jar:2.4.0]\r\n        at org.apache.pulsar.broker.service.BrokerService.<init>(BrokerService.java:242) ~[org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n        at org.apache.pulsar.broker.PulsarService.start(PulsarService.java:366) [org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n        at org.apache.pulsar.PulsarBrokerStarter$BrokerStarter.start(PulsarBrokerStarter.java:273) [org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n\r\n**Environment\uff1a**\r\npulsar: 2.4.0\r\njava: 1.8.0\r\nkerberos: 1.17\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5283", "user": "ChangWinde", "labels": ["type/bug"], "created": "2019-09-26 04:17:32", "closed": "2019-10-09 08:05:22", "commits": {}, "ttf": 13.000277777777777, "commitsDetails": []}, {"title": "Producer blocked after send an over size message while batch enabled", "body": "**Describe the bug**\r\nHere is the error log at client side:\r\n```\r\n11:21:47.535 [pulsar-timer-35-1:org.apache.pulsar.client.impl.ProducerImpl@1306] WARN  org.apache.pulsar.client.impl.ProducerImpl - [persistent://prop/ns-abc/testSendOverSizeMessage-03ea226a-2b72-4897-b86b-51a485ad80d0] [test-0-0] error while create opSendMsg by batch message container -- io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n11:21:47.538 [pulsar-timer-35-1:org.apache.pulsar.client.impl.ProducerImpl@1306] WARN  org.apache.pulsar.client.impl.ProducerImpl - [persistent://prop/ns-abc/testSendOverSizeMessage-03ea226a-2b72-4897-b86b-51a485ad80d0] [test-0-0] error while create opSendMsg by batch message container -- io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n11:21:47.541 [pulsar-timer-35-1:org.apache.pulsar.client.impl.ProducerImpl@1306] WARN  org.apache.pulsar.client.impl.ProducerImpl - [persistent://prop/ns-abc/testSendOverSizeMessage-03ea226a-2b72-4897-b86b-51a485ad80d0] [test-0-0] error while create opSendMsg by batch message container -- io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n11:21:47.543 [pulsar-timer-35-1:org.apache.pulsar.client.impl.ProducerImpl@1306] WARN  org.apache.pulsar.client.impl.ProducerImpl - [persistent://prop/ns-abc/testSendOverSizeMessage-03ea226a-2b72-4897-b86b-51a485ad80d0] [test-0-0] error while create opSendMsg by batch message container -- io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n11:21:47.545 [pulsar-timer-35-1:org.apache.pulsar.client.impl.ProducerImpl@1306] WARN  org.apache.pulsar.client.impl.ProducerImpl - [persistent://prop/ns-abc/testSendOverSizeMessage-03ea226a-2b72-4897-b86b-51a485ad80d0] [test-0-0] error while create opSendMsg by batch message container -- io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n11:21:47.547 [pulsar-timer-35-1:org.apache.pulsar.client.impl.ProducerImpl@1306] WARN  org.apache.pulsar.client.impl.ProducerImpl - [persistent://prop/ns-abc/testSendOverSizeMessage-03ea226a-2b72-4897-b86b-51a485ad80d0] [test-0-0] error while create opSendMsg by batch message container -- io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n11:21:47.549 [pulsar-timer-35-1:org.apache.pulsar.client.impl.ProducerImpl@1306] WARN  org.apache.pulsar.client.impl.ProducerImpl - [persistent://prop/ns-abc/testSendOverSizeMessage-03ea226a-2b72-4897-b86b-51a485ad80d0] [test-0-0] error while create opSendMsg by batch message container -- io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n```\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a producer and enable batch producing\r\n2. Send a over size message\r\n3. Send any not over size messages\r\n4. not over size message will be blocked and above logs appear\r\n", "url": "https://github.com/apache/pulsar/issues/5281", "user": "codelipenghui", "labels": ["type/bug"], "created": "2019-09-26 03:32:29", "closed": "2019-09-28 03:09:43", "commits": {"d62fad04e2e7f2db6b88dd5249c810b05f453cb1": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "b0c6a5f0c69de796da5f3fc9783015243c17eb47": {"commitGHEventType": "referenced", "commitUser": "wolfstudy"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "d62fad04e2e7f2db6b88dd5249c810b05f453cb1", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["8b6a3df1ceb66a80c44949e9278a05d8ef2e64a7"], "nameRev": "d62fad04e2e7f2db6b88dd5249c810b05f453cb1 tags/v2.5.0-candidate-1~273", "commitMessage": "[Java-Client] Fix producer blocked after send an over size message while batch enabled #5282\n\nMaster Issue: #5281\r\n\r\n### Motivation\r\n\r\nFix producer blocked after send an over size message while batch enabled\r\n\r\n### Modifications\r\n\r\nDiscard the batch message container while cause PulsarClientException.InvalidMessageException\r\n\r\n### Verifying this change\r\n\r\nAdded a unit test to verify the change\r\n", "commitDateTime": "2019-09-27 15:37:21", "authoredDateTime": "2019-09-27 15:37:21", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BatchMessageTest.java", "insertions": 30, "deletions": 2, "lines": 32}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageContainerImpl.java", "insertions": 5, "deletions": 3, "lines": 8}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageKeyBasedContainer.java", "insertions": 29, "deletions": 2, "lines": 31}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BatchMessageTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BatchMessageTest.testRetrieveSequenceIdGenerated(org.apache.pulsar.client.api.BatcherBuilder)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BatchMessageTest.testRetrieveSequenceIdSpecify(org.apache.pulsar.client.api.BatcherBuilder)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BatchMessageTest.testSendOverSizeMessage(org.apache.pulsar.client.api.CompressionType,org.apache.pulsar.client.api.BatcherBuilder)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchMessageContainerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.createOpSendMsg()", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.discard(java.lang.Exception)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "BatchMessageKeyBasedContainer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.createOpSendMsg(org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer$KeyedBatch)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.KeyedBatch", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.KeyedBatch.discard(java.lang.Exception)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.KeyedBatch.clear()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.add(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.client.impl.SendCallback)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "b0c6a5f0c69de796da5f3fc9783015243c17eb47", "commitGHEventType": "referenced", "commitUser": "wolfstudy", "commitParents": ["e12ac7f0f823141247ec3da0424a480042c5a4e9"], "nameRev": "b0c6a5f0c69de796da5f3fc9783015243c17eb47 tags/v2.4.2-candidate-1~65", "commitMessage": "[Java-Client] Fix producer blocked after send an over size message while batch enabled #5282\n\nMaster Issue: #5281\r\n\r\n### Motivation\r\n\r\nFix producer blocked after send an over size message while batch enabled\r\n\r\n### Modifications\r\n\r\nDiscard the batch message container while cause PulsarClientException.InvalidMessageException\r\n\r\n### Verifying this change\r\n\r\nAdded a unit test to verify the change\r\n\n(cherry picked from commit d62fad04e2e7f2db6b88dd5249c810b05f453cb1)\n", "commitDateTime": "2019-11-19 17:36:35", "authoredDateTime": "2019-09-27 15:37:21", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BatchMessageTest.java", "insertions": 30, "deletions": 2, "lines": 32}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageContainerImpl.java", "insertions": 5, "deletions": 3, "lines": 8}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageKeyBasedContainer.java", "insertions": 29, "deletions": 2, "lines": 31}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BatchMessageTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BatchMessageTest.testRetrieveSequenceIdGenerated(org.apache.pulsar.client.api.BatcherBuilder)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BatchMessageTest.testRetrieveSequenceIdSpecify(org.apache.pulsar.client.api.BatcherBuilder)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.BatchMessageTest.testSendOverSizeMessage(org.apache.pulsar.client.api.CompressionType,org.apache.pulsar.client.api.BatcherBuilder)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchMessageContainerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.createOpSendMsg()", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainerImpl.discard(java.lang.Exception)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "BatchMessageKeyBasedContainer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.createOpSendMsg(org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer$KeyedBatch)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.KeyedBatch", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.KeyedBatch.discard(java.lang.Exception)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.KeyedBatch.clear()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageKeyBasedContainer.add(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.client.impl.SendCallback)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "How do I test Pulsar Functions Locally? ModuleNotFoundError: No module named '_pulsar'", "body": "**Describe the bug**\r\nHow do I run functions on my local Mac OS(Mojave) machine? It fails with `ModuleNotFoundError: No module named '_pulsar'`\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n- In Terminal 1, I run `bin/pulsar functions-worker`\r\n- In Terminal 2, \r\n```bash\r\n\u279c  apache-pulsar-2.4.1 bin/pulsar-admin functions localrun \\\r\n  --py /Users/rabraham/Documents/dev/fifteenrock/fifteenrock-connector/pulsar_lib/functions.py \\\r\n  --className functions.ArrowFunction \\\r\n  --inputs persistent://public/default/file-topic \\\r\n  --output persistent://public/default/result-topic\r\n12:19:14.644 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntimeFactory - Java instance jar location is not defined, using the location defined in system environment : /Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/instances/java-instance.jar\r\n12:19:14.647 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntimeFactory - Python instance file location is not defined using the location defined in system environment : /Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/instances/python-instance/python_instance_main.py\r\n12:19:14.654 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntimeFactory - No extra dependencies location is defined in either function worker config or system environment\r\n12:19:14.859 [main] INFO  org.apache.pulsar.functions.runtime.RuntimeSpawner - public/default/ArrowFunction-0 RuntimeSpawner starting function\r\n12:19:14.861 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Creating function log directory /Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/logs/functions/public/default/ArrowFunction\r\n12:19:14.868 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Created or found function log directory /Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/logs/functions/public/default/ArrowFunction\r\n12:19:14.869 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - ProcessBuilder starting the process with args python /Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/instances/python-instance/python_instance_main.py --py /Users/rabraham/Documents/dev/fifteenrock/fifteenrock-connector/pulsar_lib/functions.py --logging_directory /Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/logs/functions --logging_file ArrowFunction --logging_config_file /Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/conf/functions-logging/logging_config.ini --instance_id 0 --function_id 5373e0b5-9b1c-4656-8ab5-dba7de1c4bfb --function_version 74f6460f-8573-4ff4-a875-ae0acba78aef --function_details '{\"tenant\":\"public\",\"namespace\":\"default\",\"name\":\"ArrowFunction\",\"className\":\"functions.ArrowFunction\",\"runtime\":\"PYTHON\",\"autoAck\":true,\"parallelism\":1,\"source\":{\"inputSpecs\":{\"persistent://public/default/file-topic\":{}},\"cleanupSubscription\":true},\"sink\":{\"topic\":\"persistent://public/default/result-topic\"},\"resources\":{\"cpu\":1.0,\"ram\":\"1073741824\",\"disk\":\"10737418240\"},\"componentType\":\"FUNCTION\"}' --pulsar_serviceurl pulsar://localhost:6650 --use_tls false --tls_allow_insecure false --hostname_verification_enabled false --max_buffered_tuples 1024 --port 52463 --metrics_port 52464 --expected_healthcheck_interval 30 --secrets_provider secretsprovider.ClearTextSecretsProvider --cluster_name local\r\n12:19:14.879 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully\r\nTraceback (most recent call last):\r\n  File \"/Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/instances/python-instance/python_instance_main.py\", line 36, in <module>\r\n    import pulsar\r\n  File \"/Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/instances/python-instance/pulsar/__init__.py\", line 102, in <module>\r\n    import _pulsar\r\nModuleNotFoundError: No module named '_pulsar'\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Mac OS (Mojave)\r\n\r\n**Additional context**\r\nI don't have `pulsar-client` on my machine. I thought that local cluster would have it's own version of pulsar python code?\r\n", "url": "https://github.com/apache/pulsar/issues/5260", "user": "RAbraham", "labels": ["type/bug"], "created": "2019-09-23 16:28:10", "closed": "2019-09-23 18:25:15", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Segmentation Fault: Mac OS Mojave", "body": "```bash\r\n\u279c fifteenrock-connector> pyenv local 3.7.4\r\n\u279c  fifteenrock-connector> python\r\nPython 3.7.4 (default, Sep  5 2019, 18:48:02)\r\n[Clang 10.0.1 (clang-1001.0.46.4)] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> quit()\r\n\u279c  fifteenrock-connector> python -m venv venv\r\n\u279c  fifteenrock-connector> source venv/bin/activate\r\n(venv) \u279c  fifteenrock-connector> pip install pulsar-client  --no-cache-dir\r\nCollecting pulsar-client\r\n  Downloading https://files.pythonhosted.org/packages/76/96/41ec33004a99f2a4eb8b7a0577a5c3e69c7400e139a8753724fde7ae03cb/pulsar_client-2.4.0-cp37-cp37m-macosx_10_14_x86_64.whl (15.5MB)\r\n.....\r\nYou are using pip version 19.0.3, however version 19.2.3 is available.\r\nYou should consider upgrading via the 'pip install --upgrade pip' command.\r\n(venv) \u279c  fifteenrock-connector> python\r\nPython 3.7.4 (default, Sep  5 2019, 18:48:02)\r\n[Clang 10.0.1 (clang-1001.0.46.4)] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import pulsar\r\n[1]    3856 segmentation fault  python\r\n\r\n```\r\n\r\nNote: I was trying to install from source earlier if that made any difference. I did `brew uninstall libpulsar` before doing the above", "url": "https://github.com/apache/pulsar/issues/5248", "user": "RAbraham", "labels": ["type/bug"], "created": "2019-09-22 21:59:35", "closed": "2019-09-23 20:03:58", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Consumer fails to retrieve messages when using multi-host connection with Avro schema and one broker is down in cluster.", "body": "**Describe the bug**\r\nWhen using multi-host connection in java client and also using schema registry for example Avro schema. Then it's not possible to retrieve messages when 1 broker is down from cluster. It's not happening without schema eh.g. using byte[] as message content.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Set up pulsar cluster with multiple brokers.\r\n2. Send few messages to to some topic using Avro Schema\r\n3. Kill 1 broker\r\n4. Try to retrieve messages from same topic with same schema\r\n\r\n**Expected behavior**\r\nConsumer starts to retrieving messages\r\n\r\n**Screenshots**\r\n019-09-20 17:16:38 WARN  ConnectionPool:200 - Failed to open connection to host-nr-3:6651 : org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: syscall:getsockopt(..) failed: Connection refused: host-nr-3/host-nr-3-IP:6651\r\n2019-09-20 17:16:38 WARN  PulsarClientImpl:269 - [test-event] Failed to get partitioned topic metadata: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: syscall:getsockopt(..) failed: Connection refused: host-nr-3/host-nr-3-IP:6651\r\n2019-09-20 17:16:38 INFO  PulsarClientImpl:531 - Client closing. URL: pulsar+ssl://host-nr-1:6651,host-nr-2:6651,host-nr-3:6651\r\norg.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: syscall:getsockopt(..) failed: Connection refused: host-nr-3/host-nr-3-IP:6651\r\n\tat org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:297)\r\n\tat org.apache.pulsar.client.impl.ProducerBuilderImpl.create(ProducerBuilderImpl.java:88)\r\n\tat eu.leapin.eventbus.pulsarproducer.PulsarProducer.doMain(PulsarProducer.java:84)\r\n\tat eu.leapin.eventbus.pulsarproducer.PulsarProducer.main(PulsarProducer.java:67)\r\nCaused by: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: syscall:getsockopt(..) failed: Connection refused: host-nr-3/host-nr-3-IP:6651\r\n\tat java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)\r\n\tat org.apache.pulsar.client.impl.ProducerBuilderImpl.create(ProducerBuilderImpl.java:86)\r\n\t... 2 more\r\nCaused by: org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: syscall:getsockopt(..) failed: Connection refused: host-nr-3/host-nr-3-IP:6651\r\n\tat org.apache.pulsar.client.impl.ConnectionPool.lambda$null$9(ConnectionPool.java:202)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404)\r\n\tat org.apache.pulsar.shade.io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:335)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: syscall:getsockopt(..) failed: Connection refused: host-nr-3/host-nr-3-IP:6651\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:647)\r\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:632)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)\r\n\tat org.apache.pulsar.client.impl.ConnectionPool.lambda$connectToAddress$17(ConnectionPool.java:275)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:511)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:504)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:483)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:424)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:121)\r\n\tat org.apache.pulsar.shade.io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe.fulfillConnectPromise(AbstractEpollChannel.java:629)\r\n\tat org.apache.pulsar.shade.io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe.finishConnect(AbstractEpollChannel.java:648)\r\n\tat org.apache.pulsar.shade.io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe.epollOutReady(AbstractEpollChannel.java:522)\r\n\tat org.apache.pulsar.shade.io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:423)\r\n\tat org.apache.pulsar.shade.io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:330)\r\n\t... 3 more\r\nCaused by: org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AnnotatedConnectException: syscall:getsockopt(..) failed: Connection refused: host-nr-3/host-nr-3-IP:6651\r\n\tat org.apache.pulsar.shade.io.netty.channel.unix.Socket.finishConnect(..)(Unknown Source)\r\nCaused by: org.apache.pulsar.shade.io.netty.channel.unix.Errors$NativeConnectException: syscall:getsockopt(..) failed: Connection refused\r\n\t... 1 more\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: ubuntu 18.04 LTS\r\n\r\n**Additional context**\r\nSame problem is for producing messages too.\r\nAnd I'm using Pulsar 2.4.1 and java client library is also 2.4.1\r\n", "url": "https://github.com/apache/pulsar/issues/5242", "user": "kuido85", "labels": ["type/bug"], "created": "2019-09-20 14:29:21", "closed": "2019-10-22 11:33:33", "commits": {}, "ttf": 31.00027777777778, "commitsDetails": []}, {"title": "schema scheme BACKWARD should permit removing fields", "body": "**Describe the bug**\r\nWith schema scheme set to `backward` I should be able to upload a new schema containing one less field. However uploading  a schema with one less fields fails 500\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nI wrote a small script:\r\n[3_to_2.sh.txt](https://github.com/apache/pulsar/files/3633152/3_to_2.sh.txt)\r\n\r\n**Expected behavior**\r\nupdated schema should not contain `lakitu`\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - macOS Catalina, \r\n - docker -> pulsar:2.4.1 in standalone mode\r\n\r\n** Stack trace\r\n```\r\n20:51:14.986 [ForkJoinPool.commonPool-worker-0] ERROR org.apache.pulsar.broker.service.schema.AvroSchemaBasedCompatibilityCheck - Error during schema compatibility check: Unable to read schema:\r\n{\r\n  \"type\" : \"record\",\r\n  \"name\" : \"ZSchema\",\r\n  \"fields\" : [ {\r\n    \"name\" : \"goumba\",\r\n    \"type\" : \"string\"\r\n  }, {\r\n    \"name\" : \"yoshi\",\r\n    \"type\" : \"string\"\r\n  } ]\r\n}\r\nusing schema:\r\n{\r\n  \"type\" : \"record\",\r\n  \"name\" : \"ZSchema\",\r\n  \"fields\" : [ {\r\n    \"name\" : \"goumba\",\r\n    \"type\" : \"string\"\r\n  }, {\r\n    \"name\" : \"yoshi\",\r\n    \"type\" : \"string\"\r\n  }, {\r\n    \"name\" : \"lakitu\",\r\n    \"type\" : \"string\"\r\n  } ]\r\n}\r\norg.apache.avro.SchemaValidationException: Unable to read schema:\r\n{\r\n  \"type\" : \"record\",\r\n  \"name\" : \"ZSchema\",\r\n  \"fields\" : [ {\r\n    \"name\" : \"goumba\",\r\n    \"type\" : \"string\"\r\n  }, {\r\n    \"name\" : \"yoshi\",\r\n    \"type\" : \"string\"\r\n  } ]\r\n}\r\nusing schema:\r\n{\r\n  \"type\" : \"record\",\r\n  \"name\" : \"ZSchema\",\r\n  \"fields\" : [ {\r\n    \"name\" : \"goumba\",\r\n    \"type\" : \"string\"\r\n  }, {\r\n    \"name\" : \"yoshi\",\r\n    \"type\" : \"string\"\r\n  }, {\r\n    \"name\" : \"lakitu\",\r\n    \"type\" : \"string\"\r\n  } ]\r\n}\r\n\tat org.apache.avro.ValidateMutualRead.canRead(ValidateMutualRead.java:70) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.avro.ValidateMutualRead.validate(ValidateMutualRead.java:43) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.avro.ValidateLatest.validate(ValidateLatest.java:51) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.pulsar.broker.service.schema.AvroSchemaBasedCompatibilityCheck.isCompatible(AvroSchemaBasedCompatibilityCheck.java:56) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.broker.service.schema.AvroSchemaCompatibilityCheck.isCompatible(AvroSchemaCompatibilityCheck.java:26) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.broker.service.schema.AvroSchemaBasedCompatibilityCheck.isCompatible(AvroSchemaBasedCompatibilityCheck.java:42) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.broker.service.schema.AvroSchemaCompatibilityCheck.isCompatible(AvroSchemaCompatibilityCheck.java:26) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.isCompatible(SchemaRegistryServiceImpl.java:220) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n\tat org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.lambda$checkCompatibilityWithLatest$14(SchemaRegistryServiceImpl.java:229) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n\tat java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:602) ~[?:1.8.0_212]\r\n\tat java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577) ~[?:1.8.0_212]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_212]\r\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1962) ~[?:1.8.0_212]\r\n\tat org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.lambda$null$5(BookkeeperSchemaStorage.java:188) ~[org.apache.pulsar-pulsar-broker-2.4.1.jar:2.4.1]\r\n\tat java.util.concurrent.CompletableFuture.uniHandle(CompletableFuture.java:822) [?:1.8.0_212]\r\n\tat java.util.concurrent.CompletableFuture$UniHandle.tryFire(CompletableFuture.java:797) [?:1.8.0_212]\r\n\tat java.util.concurrent.CompletableFuture$Completion.exec(CompletableFuture.java:443) [?:1.8.0_212]\r\n\tat java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289) [?:1.8.0_212]\r\n\tat java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056) [?:1.8.0_212]\r\n\tat java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692) [?:1.8.0_212]\r\n\tat java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:157) [?:1.8.0_212]\r\n\r\n```\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5231", "user": "pouledodue", "labels": ["type/bug"], "created": "2019-09-19 20:38:59", "closed": "2019-09-20 01:10:14", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "2.4.1 pulsar-admin should have 8 schema compatibility check strategies", "body": "**Describe the bug**\r\n2.4.1 `pulsar-admin` should have 8 schema compat check strategy, it only has 3.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n```\r\nwget -c https://archive.apache.org/dist/pulsar/pulsar-2.4.1/apache-pulsar-2.4.1-bin.tar.gz\r\ntar mxvfz apache-pulsar-2.4.1-bin.tar.gz\r\n./apache-pulsar-2.4.1/bin/pulsar-admin tenants create a\r\n./apache-pulsar-2.4.1/bin/pulsar-admin namespaces create a/b\r\n./apache-pulsar-2.4.1/bin/pulsar-admin namespaces set-schema-autoupdate-strategy --compatibility always_compatible  a/b\r\n```\r\ngives:\r\n```\r\nnull\r\n\r\nReason: Either --compatibility or --disabled must be specified\r\n```\r\n**Expected behavior**\r\nA change of strategy\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: catalina\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5222", "user": "pouledodue", "labels": ["component/cli", "component/documentation", "component/schemaregistry", "triage/week-38", "type/bug"], "created": "2019-09-19 07:53:16", "closed": "2019-12-03 08:31:11", "commits": {}, "ttf": 75.00027777777778, "commitsDetails": []}, {"title": "how to safely delete bookie of pulsar cluster? ", "body": "**Describe the bug**\r\nI have a pulsar cluster with four bookie, and ledger set like this:\r\n```\r\n# Number of bookies to use when creating a ledger\r\nmanagedLedgerDefaultEnsembleSize=2\r\n\r\n# Number of copies to store for each message\r\nmanagedLedgerDefaultWriteQuorum=2\r\n\r\n# Number of guaranteed copies (acks to wait before write is complete)\r\nmanagedLedgerDefaultAckQuorum=2\r\n```\r\nwhen I publish some message to topic.(witch is already has subscriptions but no comsumer)\r\nI close tow of the bookie and run the follow command which wait until the closed bookie's ledger is re-replicated to other bokie.\uff08I do this step one by one)\r\n```\r\n    ./bookkeeper shell decommissionbookie  --bookieid closedbookieip:3181\r\n```\r\nafter that  i couldn't  receive message on it any more, but i can produce to it.\r\n\r\nthe stats of topic like this:\r\n```\r\n{\r\n  \"msgRateIn\" : 0.0,\r\n  \"msgThroughputIn\" : 0.0,\r\n  \"msgRateOut\" : 0.0,\r\n  \"msgThroughputOut\" : 0.0,\r\n  \"averageMsgSize\" : 0.0,\r\n  \"storageSize\" : 318091591,\r\n  \"publishers\" : [ ],\r\n  \"subscriptions\" : {\r\n    \"subscription-1\" : {\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateRedeliver\" : 0.0,\r\n      \"msgBacklog\" : 2379,\r\n      \"blockedSubscriptionOnUnackedMsgs\" : false,\r\n      \"msgDelayed\" : 0,\r\n      \"unackedMessages\" : 0,\r\n      \"type\" : \"Exclusive\",\r\n      \"msgRateExpired\" : 0.0,\r\n      \"consumers\" : [ ],\r\n      \"isReplicated\" : false\r\n    }\r\n  },\r\n  \"replication\" : { },\r\n  \"deduplicationStatus\" : \"Disabled\"\r\n}\r\n```\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. start a pulsar with four bookie\r\n2. publish message to topic witch has subscription .\r\n3. close the a bookie and run `./bookkeeper shell decommissionbookie  --bookieid  closedbookieip:3181` , then wait it report success message.\r\n4. delete data of the bookie, and then restart the bookie.\r\n5. repeat 3-4 one all bookie.\r\n\r\n**Expected behavior**\r\nI want i can receive message after the upon steps.\r\n\r\n**Screenshots**\r\nand after that i got some error when do some command\r\n```\r\n$ bin/pulsar-admin namespaces list public\r\npublic/default\r\n$ bin/pulsar-admin topics list public/default\r\nHTTP 500 Internal Server Error\r\n\r\nReason: HTTP 500 Internal Server Error\r\n```\r\nin he log file I find this errmsg:\r\n\r\n```\r\n14:59:03.405 [pulsar-web-30-2] ERROR org.apache.pulsar.broker.admin.v2.NonPersistentTopics - [null] Failed to get list of topics under namespace public/default\r\njava.util.concurrent.ExecutionException: org.apache.pulsar.client.admin.PulsarAdminException$ServerSideErrorException: HTTP 500 Internal Server Error\r\n        at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357) ~[?:1.8.0_212]\r\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895) ~[?:1.8.0_212]\r\n        at org.apache.pulsar.broker.admin.v2.NonPersistentTopics.getList(NonPersistentTopics.java:184) ~[org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n...\r\n```\r\nbut i can use topics stats get the topics stats.\r\n```\r\n$ bin/pulsar-admin topics stats persistent://public/default/topic-test1\r\n{\r\n  \"msgRateIn\" : 0.0,\r\n  \"msgThroughputIn\" : 0.0,\r\n  \"msgRateOut\" : 0.0,\r\n  \"msgThroughputOut\" : 0.0,\r\n  \"averageMsgSize\" : 0.0,\r\n  \"storageSize\" : 318091591,\r\n  \"publishers\" : [ ],\r\n  \"subscriptions\" : {\r\n    \"123\" : {\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateRedeliver\" : 0.0,\r\n      \"msgBacklog\" : 0,\r\n      \"blockedSubscriptionOnUnackedMsgs\" : false,\r\n      \"msgDelayed\" : 0,\r\n      \"unackedMessages\" : 0,\r\n      \"type\" : \"Exclusive\",\r\n      \"msgRateExpired\" : 0.0,\r\n      \"consumers\" : [ ],\r\n      \"isReplicated\" : false\r\n    },\r\n    \"subscription-1\" : {\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateRedeliver\" : 0.0,\r\n      \"msgBacklog\" : 2379,\r\n      \"blockedSubscriptionOnUnackedMsgs\" : false,\r\n      \"msgDelayed\" : 0,\r\n      \"unackedMessages\" : 0,\r\n      \"type\" : \"Exclusive\",\r\n      \"msgRateExpired\" : 0.0,\r\n      \"consumers\" : [ ],\r\n      \"isReplicated\" : false\r\n    }\r\n  },\r\n  \"replication\" : { },\r\n  \"deduplicationStatus\" : \"Disabled\"\r\n}\r\n```\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS:  linux centos \r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5220", "user": "sydnash", "labels": ["triage/week-38", "type/bug"], "created": "2019-09-19 06:52:03", "closed": "2019-09-24 08:29:59", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "Enabling Deduplication may drop messages", "body": "**Describe the bug**\r\nSince deduplication drops messages based on the the largest sequence id recorded pre-persist, if there\u2019s an error persisting to BK, a retry attempt will just be \u201cdeduplicated\u201d with no message ever getting persisted.\r\n<img width=\"801\" alt=\"dedupe_fail_case\" src=\"https://user-images.githubusercontent.com/7429691/65181039-2a068f80-da2c-11e9-9d24-550ab3c0a220.png\">\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Client connects successfully, producer send retry enabled (i.e. sendTimeoutMs at default of 30s)\r\n2. Produce messages at something like 1msg/s and consume them, verifying messages were not lost.\r\n3. Cause some BK failures by shut down of some nodes or a rolling restart\r\n4. While that happens, Client reports `Received send error from server` (note it's send error, not just a normal connection error). One example of the several resulting errors are `PersistenceError : org.apache.bookkeeper.mledger.ManagedLedgerException: Waiting for new ledger creation to complete`\r\n5. Looking at broker logs, will see `Message has been dropped for non-persistent topic producer-id ...` even though the first attempt was unsuccessful\r\n6. Message was lost due to dedupe logic counting 2nd retry attempt as duplicate.\r\n\r\n**Expected behavior**\r\nMessages should not be dropped\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: OSX, AWS Linux\r\n\r\n**Additional context**\r\nInstructions for dedupe at this link, but the same problem can occur with those settings. Also, does setting sendTimeoutMs to 0 make it try forever, or does it drop the message on first fail? https://pulsar.apache.org/docs/en/cookbooks-deduplication/#message-deduplication-and-pulsar-clients-clients\r\nLogic for dedupe in `MessageDeduplication.java`\r\n", "url": "https://github.com/apache/pulsar/issues/5218", "user": "sleungtoast", "labels": ["triage/week-38", "type/bug"], "created": "2019-09-18 19:59:57", "closed": "2019-09-24 15:40:38", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "Python pulsar-client==2.4.0 segfaults on macOS Catalina beta 8 (19A558d)", "body": "**Describe the bug**\r\n```\r\n\u279c ~ python\r\nPython 3.7.4 (v3.7.4:e09359112e, Jul  8 2019, 14:54:52)\r\n[Clang 6.0 (clang-600.0.57)] on darwin\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import pulsar\r\n[1]    28547 segmentation fault  python\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Install macOS Catalina beta 8\r\n2. install python3.7\r\n3. `pip install pulsar-client==2.4.0`\r\n4. execute in Terminal `python -c 'from pulsar.schema import Record'`\r\n\r\n**Expected behavior**\r\nno segfault message\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - macOS Catalina beta 8 (19A558d)\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/5217", "user": "pouledodue", "labels": ["component/build", "component/python", "triage/week-38", "type/bug"], "created": "2019-09-18 19:25:29", "closed": "2019-09-28 08:49:16", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "Broker high cpu usage under light load", "body": "**Describe the bug**\r\nAll 3 of the brokers in a cluster gradually consume ~3 cores/vcpus (per broker) and went into load balancing mode (according to the broker log, it was using 90+% cpu, which is over the 85% threshold) under very light load (sum of pulsar_rate_in of the cluster is under 1000msg/s with average message size under 200 bytes with a few producers and a few hundred consumers). Restarting the brokers resolved the high cpu usage. They went back consuming only a fraction of a core under the same load.\r\n\r\n**To Reproduce**\r\nNot able to reproduce the problem in a separate cluster yet.\r\n\r\n**Expected behavior**\r\nBroker cpu usage should be kept low under light load.\r\n\r\n**Profile information**\r\nOutput of https://github.com/stevegury/jstack-profiler when the broker was pegging ~3 cores.\r\n```\r\nRunnable methods breakout\r\n-------------------------\r\nrank    time    name\r\n0       84.66%  java.lang.Thread.run(Thread.java:748)\r\n1       84.66%  io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n2       76.68%  io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909)\r\n3       54.47%  io.netty.channel.epoll.Native.epollWait(Native.java:114)\r\n4       54.47%  io.netty.channel.epoll.Native.epollWait0(Native Method)\r\n5       54.47%  io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:278)\r\n6       54.47%  io.netty.channel.epoll.EpollEventLoop.epollWait(EpollEventLoop.java:253)\r\n7       15.34%  io.netty.channel.nio.NioEventLoop.select(NioEventLoop.java:765)\r\n8       15.34%  sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:86)\r\n9       15.34%  org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1145)\r\n10      15.34%  org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:349)\r\n11      15.34%  sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:93)\r\n12      15.34%  sun.nio.ch.SelectorImpl.select(SelectorImpl.java:97)\r\n13      15.34%  sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)\r\n14      15.34%  io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:413)\r\n15      15.34%  io.netty.channel.nio.SelectedSelectionKeySetSelector.select(SelectedSelectionKeySetSelector.java:62)\r\n16      7.99%   java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n17      7.99%   java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n18      5.75%   io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:335)\r\n19      3.83%   sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:250)\r\n20      3.83%   sun.nio.ch.ServerSocketChannelImpl.accept0(Native Method)\r\n21      3.83%   org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126)\r\n22      3.83%   org.eclipse.jetty.server.AbstractConnector$Acceptor.run(AbstractConnector.java:648)\r\n23      3.83%   org.eclipse.jetty.server.ServerConnector.accept(ServerConnector.java:377)\r\n24      3.83%   sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:422)\r\n25      3.83%   org.apache.pulsar.broker.web.PulsarServerConnector.accept(PulsarServerConnector.java:57)\r\n26      3.83%   org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168)\r\n27      3.83%   org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366)\r\n28      3.67%   org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.produceTask(EatWhatYouKill.java:357)\r\n29      3.67%   org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:181)\r\n30      3.51%   sun.nio.ch.SelectorImpl.select(SelectorImpl.java:101)\r\n31      3.51%   org.eclipse.jetty.io.ManagedSelector$SelectorProducer.produce(ManagedSelector.java:359)\r\n32      3.51%   sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:269)\r\n33      3.51%   org.eclipse.jetty.io.ManagedSelector$SelectorProducer.select(ManagedSelector.java:422)\r\n34      3.35%   io.netty.util.concurrent.AbstractScheduledEventExecutor.pollScheduledTask(AbstractScheduledEventExecutor.java:111)\r\n35      3.35%   io.netty.util.concurrent.SingleThreadEventExecutor.fetchFromScheduledTaskQueue(SingleThreadEventExecutor.java:282)\r\n36      3.35%   io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:393)\r\n37      3.35%   io.netty.util.internal.DefaultPriorityQueue.poll(DefaultPriorityQueue.java:31)\r\n38      3.35%   io.netty.util.internal.DefaultPriorityQueue.poll(DefaultPriorityQueue.java:116)\r\n39      3.35%   java.util.AbstractQueue.remove(AbstractQueue.java:113)\r\n40      3.04%   io.netty.util.internal.DefaultPriorityQueue.bubbleDown(DefaultPriorityQueue.java:266)\r\n41      2.40%   io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163)\r\n42      2.40%   io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404)\r\n43      2.08%   org.apache.pulsar.client.impl.PersistentAcknowledgmentsGroupingTracker$$Lambda$413/1524624927.run(Unknown Source)\r\n44      2.08%   io.netty.util.concurrent.ScheduledFutureTask.run(ScheduledFutureTask.java:133)\r\n45      2.08%   java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n46      1.12%   io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:268)\r\n47      1.12%   io.netty.channel.DefaultSelectStrategy.calculateStrategy(DefaultSelectStrategy.java:30)\r\n48      1.12%   io.netty.channel.epoll.EpollEventLoop.epollWaitNow(EpollEventLoop.java:257)\r\n49      1.12%   io.netty.channel.epoll.EpollEventLoop.access$000(EpollEventLoop.java:46)\r\n50      1.12%   io.netty.channel.epoll.EpollEventLoop$1.get(EpollEventLoop.java:74)\r\n51      0.16%   org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl$$Lambda$42/65438140.run(Unknown Source)\r\n52      0.16%   org.apache.bookkeeper.proto.BookieClientImpl.lambda$new$0(BookieClientImpl.java:121)\r\n53      0.16%   org.slf4j.helpers.MessageFormatter.safeObjectAppend(MessageFormatter.java:299)\r\n54      0.16%   io.netty.channel.AbstractChannelHandlerContext.writeAndFlush(AbstractChannelHandlerContext.java:794)\r\n55      0.16%   org.eclipse.jetty.util.log.Slf4jLog.debug(Slf4jLog.java:97)\r\n```\r\n\r\n**Additional context**\r\nThe brokers were using the official container image: apachepulsar/pulsar-all:2.4.0", "url": "https://github.com/apache/pulsar/issues/5200", "user": "vicaya", "labels": ["triage/week-38", "type/bug", "type/performance"], "created": "2019-09-17 07:16:34", "closed": "2019-10-03 16:03:51", "commits": {}, "ttf": 16.00027777777778, "commitsDetails": []}, {"title": "2.4.1 - Pulsar standalone + debezium mysql do not work", "body": "Hello !\r\n\r\n**Describe the bug**\r\nI tried to connect pulsar with CDC debezium on MySQL database. So, I'm following this tutorial : https://pulsar.apache.org/docs/en/io-cdc-debezium/\r\n\r\nBut, when I start my local run with my source file, it crashes. \r\n\r\nLogs on pulsar standalone : \r\n```\r\n0:16:53.687 [ForkJoinPool.commonPool-worker-6] ERROR org.apache.pulsar.broker.web.PulsarWebResource - Policies not found for pubilc/default namespace\r\n10:16:53.687 [ForkJoinPool.commonPool-worker-6] WARN  org.apache.pulsar.broker.service.ServerCnx - Failed to get Partitioned Metadata [/127.0.0.1:53926] persistent://pubilc/default/dbserver1.inventory.products_on_hand: Policies not found for pubilc/default namespace\r\norg.apache.pulsar.broker.web.RestException: Policies not found for pubilc/default namespace\r\n```\r\n\r\nLogs on source loading : \r\n```\r\n10:15:38.186 [pulsar-client-io-1-1] WARN  org.apache.pulsar.client.impl.BinaryProtoLookupService - [persistent://pubilc/default/dbserver1.inventory.products_on_hand] failed to get Partitioned metadata : Policies not found for pubilc/default namespace\r\n...\r\n10:15:38.205 [main] INFO  org.apache.pulsar.functions.LocalRunner - RuntimeSpawner quit because of\r\njava.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.Exception: Sink Error\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior (all config in tutorial link) :\r\n1. Download pulsar 2.4.1\r\n2. Download debezium mysql connector 2.4.1\r\n3. Install connector by creating connectors folder on pulsar install dir\r\n4. Create configuration file \r\n5. Run mysql docker\r\n6. Run pulsar standalone : `bin/pulsar standalone`\r\n7. Run configuration : `bin/pulsar-admin source localrun  --sourceConfigFile debezium-mysql-source-config.yaml`\r\n\r\n**Expected behavior**\r\nTopics are created and database events are loaded to topics.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 18.04\r\n\r\nThanks !\r\n", "url": "https://github.com/apache/pulsar/issues/5189", "user": "SirBigoo", "labels": ["type/bug"], "created": "2019-09-13 08:19:46", "closed": "2019-09-14 14:30:01", "commits": {"bbdf14bd66305758ba5731cef55f4d2547f009cc": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "bbdf14bd66305758ba5731cef55f4d2547f009cc", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["c377865cd5698b89c0870fcc30d30a4bc7191470"], "nameRev": "bbdf14bd66305758ba5731cef55f4d2547f009cc tags/v2.5.0-candidate-1~331", "commitMessage": "Fix tenant typo from pubilc to public (#5190)\n\nMaster Issue: #5189\r\n\r\nMotivation\r\nCurrently, the tenant name for the new version of the document is incorrectly written, resulting in that the tenant cannot be found.\r\n\r\nModifications\r\nFix tenant name from pubilc to public", "commitDateTime": "2019-09-14 22:30:00", "authoredDateTime": "2019-09-14 22:30:00", "commitGitStats": [{"filePath": "site2/docs/io-cdc-debezium.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.4.1/io-cdc-debezium.md", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "NPE occurs while searching for namespace bundle", "body": "The other day, stopping a broker caused an NPE on another broker in the same cluster. At this time, the client continued to fail to lookup the topic. The following is the log of the broker where NPE occurred:\r\n\r\n```\r\n11:27:17.757 [pulsar-1-1] WARN  o.a.p.b.namespace.NamespaceService   - Error when searching for candidate broker to acquire tenant/global/ns/0xa3ffffff_0xa7ffffff: null\r\njava.lang.NullPointerException: null\r\n        at org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.lambda$removeMostServicingBrokersForNamespace$3(LoadManagerShared.java:294)\r\n        at java.util.Collection.removeIf(Collection.java:414)\r\n        at org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.removeMostServicingBrokersForNamespace(LoadManagerShared.java:293)\r\n        at org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl.selectBrokerForAssignment(ModularLoadManagerImpl.java:721)\r\n        at org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerWrapper.getLeastLoaded(ModularLoadManagerWrapper.java:69)\r\n        at org.apache.pulsar.broker.namespace.NamespaceService.getLeastLoadedFromLoadManager(NamespaceService.java:519)\r\n        at org.apache.pulsar.broker.namespace.NamespaceService.searchForCandidateBroker(NamespaceService.java:394)\r\n        at org.apache.pulsar.broker.namespace.NamespaceService.lambda$null$4(NamespaceService.java:347)\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.lang.Thread.run(Thread.java:748)\r\n...\r\n11:27:17.761 [pulsar-io-20-27] WARN  o.a.p.broker.lookup.TopicLookupBase  - Failed to lookup xxx for topic persistent://tenant/global/ns/dest-partition-6 with error java.lang.NullPointerException\r\njava.util.concurrent.CompletionException: java.lang.NullPointerException\r\n        at java.util.concurrent.CompletableFuture.encodeRelay(CompletableFuture.java:326)\r\n        at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:984)\r\n        at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2124)\r\n        at org.apache.pulsar.broker.namespace.NamespaceService.getBrokerServiceUrlAsync(NamespaceService.java:158)\r\n        at org.apache.pulsar.broker.lookup.TopicLookupBase.lambda$lookupTopicAsync$8(TopicLookupBase.java:225)\r\n        at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:656)\r\n        at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:669)\r\n        at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:1997)\r\n        at org.apache.pulsar.broker.lookup.TopicLookupBase.lookupTopicAsync(TopicLookupBase.java:221)\r\n        at org.apache.pulsar.broker.service.ServerCnx.lambda$handleLookup$3(ServerCnx.java:263)\r\n        at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:602)\r\n        at java.util.concurrent.CompletableFuture.uniApplyStage(CompletableFuture.java:614)\r\n        at java.util.concurrent.CompletableFuture.thenApply(CompletableFuture.java:1983)\r\n        at org.apache.pulsar.broker.service.ServerCnx.handleLookup(ServerCnx.java:261)\r\n        at org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:112)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:323)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:297)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n        at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1436)\r\n        at io.netty.handler.ssl.SslHandler.decodeNonJdkCompatible(SslHandler.java:1215)\r\n        at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1249)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:502)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:441)\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:278)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1434)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:965)\r\n        at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:799)\r\n        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:433)\r\n        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:330)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.lang.NullPointerException: null\r\n        at org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.lambda$removeMostServicingBrokersForNamespace$3(LoadManagerShared.java:294)\r\n        at java.util.Collection.removeIf(Collection.java:414)\r\n        at org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.removeMostServicingBrokersForNamespace(LoadManagerShared.java:293)\r\n        at org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl.selectBrokerForAssignment(ModularLoadManagerImpl.java:721)\r\n        at org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerWrapper.getLeastLoaded(ModularLoadManagerWrapper.java:69)\r\n        at org.apache.pulsar.broker.namespace.NamespaceService.getLeastLoadedFromLoadManager(NamespaceService.java:519)\r\n        at org.apache.pulsar.broker.namespace.NamespaceService.searchForCandidateBroker(NamespaceService.java:394)\r\n        at org.apache.pulsar.broker.namespace.NamespaceService.lambda$null$4(NamespaceService.java:347)\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n        ... 2 common frames omitted\r\n```\r\n\r\nNPE was occurring on this line:\r\nhttps://github.com/apache/pulsar/blob/v2.3.2/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/LoadManagerShared.java#L294\r\n\r\nThis means that `brokerToNamespaceToBundleRange.get(broker).get(namespaceName)` returned null. However, it had been made sure in [this part](https://github.com/apache/pulsar/blob/v2.3.2/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/LoadManagerShared.java#L269-L275) that `brokerToNamespaceToBundleRange.get(broker).get(namespaceName)` is not null, and it is mysterious that NPE occurred.\r\n\r\nThe version of Pulsar is 2.3.2.", "url": "https://github.com/apache/pulsar/issues/5176", "user": "massakam", "labels": ["component/broker", "type/bug"], "created": "2019-09-11 07:03:49", "closed": "2019-09-15 12:31:06", "commits": {"412c8fdb5ea61593017c395a7c8e291c922d6bf5": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "850b12321ca115b7bf2fbc10aad1db1dc206e8e5": {"commitGHEventType": "referenced", "commitUser": "wolfstudy"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "412c8fdb5ea61593017c395a7c8e291c922d6bf5", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["a43a9339da886cc51c57465770dd2c71b83358d4"], "nameRev": "412c8fdb5ea61593017c395a7c8e291c922d6bf5 tags/v2.5.0-candidate-1~329", "commitMessage": "Fix bug that fails to search namespace bundle due to NPE (#5191)\n\nFixes #5176\r\n\r\n### Motivation\r\n\r\nAs mentioned in #5176, NPE may occur in the load manager and fail to search for namespace bundles. This is because multiple threads may update a map named `brokerToNamespaceToBundleRange` at the same time.\r\n\r\n### Modifications\r\n\r\n- Changed `brokerToNamespaceToBundleRange` to ConcurrentOpenHashMap instead of HashMap which is not thread safe.\r\n- Fixed `LoadManagerShared.removeMostServicingBrokersForNamespace()` logic so that NPE does not occur.\r\n", "commitDateTime": "2019-09-15 20:31:05", "authoredDateTime": "2019-09-15 21:31:05", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/LoadManagerShared.java", "insertions": 33, "deletions": 33, "lines": 66}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/ModularLoadManagerImpl.java", "insertions": 12, "deletions": 6, "lines": 18}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/SimpleLoadManagerImpl.java", "insertions": 9, "deletions": 6, "lines": 15}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/AntiAffinityNamespaceGroupTest.java", "insertions": 11, "deletions": 6, "lines": 17}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/impl/LoadManagerSharedTest.java", "insertions": 86, "deletions": 0, "lines": 86}], "commitSpoonAstDiffStats": [{"spoonFilePath": "LoadManagerShared.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.fillNamespaceToBundlesMap(java.util.Set,java.util.Map)", "TOT": 4, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.removeMostServicingBrokersForNamespace(java.lang.String,java.util.Set,java.util.Map)", "TOT": 20, "UPD": 8, "INS": 0, "MOV": 9, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.filterAntiAffinityGroupOwnedBrokers(org.apache.pulsar.broker.PulsarService,java.lang.String,java.util.Set,java.util.Map,java.util.Map)", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.filterDomainsNotHavingLeastNumberAntiAffinityNamespaces(java.util.Map,java.util.Set,java.util.Map)", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.getAntiAffinityNamespaceOwnedBrokers(org.apache.pulsar.broker.PulsarService,java.lang.String,java.util.Map)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.shouldAntiAffinityNamespaceUnload(java.lang.String,java.lang.String,java.lang.String,org.apache.pulsar.broker.PulsarService,java.util.Map,java.util.Set)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.filterBrokersWithLargeTopicCount(java.util.Set,org.apache.pulsar.broker.loadbalance.LoadData,int)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.removeMostServicingBrokersForNamespace(java.lang.String,java.util.Set,org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.getAntiAffinityNamespaceOwnedBrokers(org.apache.pulsar.broker.PulsarService,java.lang.String,org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.shouldAntiAffinityNamespaceUnload(java.lang.String,java.lang.String,java.lang.String,org.apache.pulsar.broker.PulsarService,org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap,java.util.Set)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ModularLoadManagerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl.updateBundleData()", "TOT": 4, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl.selectBrokerForAssignment(org.apache.pulsar.common.naming.ServiceUnitId)", "TOT": 10, "UPD": 2, "INS": 3, "MOV": 3, "DEL": 2}]}, {"spoonFilePath": "SimpleLoadManagerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.SimpleLoadManagerImpl", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.SimpleLoadManagerImpl.updateBrokerToNamespaceToBundle()", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.SimpleLoadManagerImpl.findBrokerForPlacement(com.google.common.collect.Multimap,org.apache.pulsar.common.naming.ServiceUnitId)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AntiAffinityNamespaceGroupTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.loadbalance.AntiAffinityNamespaceGroupTest.testAntiAffinityNamespaceFilteringWithDomain()", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.AntiAffinityNamespaceGroupTest.testAntiAffinityNamespaceFilteringWithoutDomain()", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.AntiAffinityNamespaceGroupTest.selectBrokerForNamespace(java.util.Map,java.lang.String,java.lang.String,java.lang.String)", "TOT": 6, "UPD": 3, "INS": 0, "MOV": 1, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.AntiAffinityNamespaceGroupTest.testLoadSheddingUtilWithAntiAffinityNamespace()", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.AntiAffinityNamespaceGroupTest.selectBrokerForNamespace(org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap,java.lang.String,java.lang.String,java.lang.String)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "LoadManagerSharedTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerSharedTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "850b12321ca115b7bf2fbc10aad1db1dc206e8e5", "commitGHEventType": "referenced", "commitUser": "wolfstudy", "commitParents": ["d546f67a20ac990e08e4056366f69921d17b7aa0"], "nameRev": "850b12321ca115b7bf2fbc10aad1db1dc206e8e5 tags/v2.4.2-candidate-1~77", "commitMessage": "Fix bug that fails to search namespace bundle due to NPE (#5191)\n\nFixes #5176\r\n\r\n### Motivation\r\n\r\nAs mentioned in #5176, NPE may occur in the load manager and fail to search for namespace bundles. This is because multiple threads may update a map named `brokerToNamespaceToBundleRange` at the same time.\r\n\r\n### Modifications\r\n\r\n- Changed `brokerToNamespaceToBundleRange` to ConcurrentOpenHashMap instead of HashMap which is not thread safe.\r\n- Fixed `LoadManagerShared.removeMostServicingBrokersForNamespace()` logic so that NPE does not occur.\r\n\n(cherry picked from commit 412c8fdb5ea61593017c395a7c8e291c922d6bf5)\n", "commitDateTime": "2019-11-19 15:58:42", "authoredDateTime": "2019-09-15 21:31:05", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/LoadManagerShared.java", "insertions": 33, "deletions": 33, "lines": 66}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/ModularLoadManagerImpl.java", "insertions": 12, "deletions": 6, "lines": 18}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/SimpleLoadManagerImpl.java", "insertions": 9, "deletions": 6, "lines": 15}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/AntiAffinityNamespaceGroupTest.java", "insertions": 11, "deletions": 6, "lines": 17}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/impl/LoadManagerSharedTest.java", "insertions": 86, "deletions": 0, "lines": 86}], "commitSpoonAstDiffStats": [{"spoonFilePath": "LoadManagerShared.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.fillNamespaceToBundlesMap(java.util.Set,java.util.Map)", "TOT": 4, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.removeMostServicingBrokersForNamespace(java.lang.String,java.util.Set,java.util.Map)", "TOT": 20, "UPD": 8, "INS": 0, "MOV": 9, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.filterAntiAffinityGroupOwnedBrokers(org.apache.pulsar.broker.PulsarService,java.lang.String,java.util.Set,java.util.Map,java.util.Map)", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.filterDomainsNotHavingLeastNumberAntiAffinityNamespaces(java.util.Map,java.util.Set,java.util.Map)", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.getAntiAffinityNamespaceOwnedBrokers(org.apache.pulsar.broker.PulsarService,java.lang.String,java.util.Map)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.shouldAntiAffinityNamespaceUnload(java.lang.String,java.lang.String,java.lang.String,org.apache.pulsar.broker.PulsarService,java.util.Map,java.util.Set)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.filterBrokersWithLargeTopicCount(java.util.Set,org.apache.pulsar.broker.loadbalance.LoadData,int)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.removeMostServicingBrokersForNamespace(java.lang.String,java.util.Set,org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.getAntiAffinityNamespaceOwnedBrokers(org.apache.pulsar.broker.PulsarService,java.lang.String,org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerShared.shouldAntiAffinityNamespaceUnload(java.lang.String,java.lang.String,java.lang.String,org.apache.pulsar.broker.PulsarService,org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap,java.util.Set)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ModularLoadManagerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl.updateBundleData()", "TOT": 4, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.ModularLoadManagerImpl.selectBrokerForAssignment(org.apache.pulsar.common.naming.ServiceUnitId)", "TOT": 10, "UPD": 2, "INS": 3, "MOV": 3, "DEL": 2}]}, {"spoonFilePath": "SimpleLoadManagerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.SimpleLoadManagerImpl", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.SimpleLoadManagerImpl.updateBrokerToNamespaceToBundle()", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.SimpleLoadManagerImpl.findBrokerForPlacement(com.google.common.collect.Multimap,org.apache.pulsar.common.naming.ServiceUnitId)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AntiAffinityNamespaceGroupTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.loadbalance.AntiAffinityNamespaceGroupTest.testAntiAffinityNamespaceFilteringWithDomain()", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.AntiAffinityNamespaceGroupTest.testAntiAffinityNamespaceFilteringWithoutDomain()", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.AntiAffinityNamespaceGroupTest.selectBrokerForNamespace(java.util.Map,java.lang.String,java.lang.String,java.lang.String)", "TOT": 6, "UPD": 3, "INS": 0, "MOV": 1, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.AntiAffinityNamespaceGroupTest.testLoadSheddingUtilWithAntiAffinityNamespace()", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.loadbalance.AntiAffinityNamespaceGroupTest.selectBrokerForNamespace(org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap,java.lang.String,java.lang.String,java.lang.String)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "LoadManagerSharedTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.loadbalance.impl.LoadManagerSharedTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Kinesis source stalls on startup", "body": "**Describe the bug**\r\nKinesis source function appears to just stall on startup.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create kinesis source, tied to actual kinesis stream\r\n2. Write records to kinesis stream\r\n3. Notice kinesis source pulsar function attempts to read from source kinesis stream, and stalls indefinitely.\r\n\r\n**Expected behavior**\r\nKinesis source pulsar function should process records from kinesis stream and write them to target topic.\r\n\r\n\r\n**Additional context**\r\nSee #3784 where kinesis source functionality was introduced.\r\n", "url": "https://github.com/apache/pulsar/issues/5170", "user": "feathj", "labels": ["component/io", "triage/week-38", "type/bug", "type/enhancement"], "created": "2019-09-10 17:29:23", "closed": "2019-09-28 03:33:10", "commits": {}, "ttf": 17.00027777777778, "commitsDetails": []}, {"title": "Mac(Mojave). Standalone quits. Failed to start pulsar service.", "body": "**Describe the bug**\r\nHi, \r\nWhen I run `bin/pulsar standalone` it quits.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n```bash\r\nwget https://archive.apache.org/dist/pulsar/pulsar-2.4.1/apache-pulsar-2.4.1-bin.tar.gz\r\nwget https://archive.apache.org/dist/pulsar/pulsar-2.4.1/connectors/pulsar-io-kafka-connect-adaptor-2.4.1.nar\r\ntar zxf apache-pulsar-2.4.1-bin.tar.gz && cd apache-pulsar-2.4.1 && mkdir connectors && cp ../pulsar-io-kafka-connect-adaptor-2.4.1.nar connectors\r\nbin/pulsar standalone\r\n```\r\n**Expected behavior**\r\nI expected it to continue to run\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: MacOS(Mojave)\r\n\r\n**Additional context**\r\nThe error dump is in [error.txt](https://github.com/apache/pulsar/files/3585220/error.txt). My etc/hosts file just in case\r\n```bash\r\n# Host Database\r\n#\r\n# localhost is used to configure the loopback interface\r\n# when the system is booting.  Do not change this entry.\r\n##\r\n127.0.0.1       localhost\r\n255.255.255.255 broadcasthost\r\n::1             localhost\r\n127.0.0.1       SomeName-MacBook-Pro-Personal.local\r\n# Added by Docker Desktop\r\n# To allow the same kube context to work on the host and the container:\r\n127.0.0.1 kubernetes.docker.internal\r\n# End of section\r\n```\r\n\r\nWhat was published in my console in addition was:\r\n```bash\r\nbin/pulsar standalone > error.txt\r\nobjc[29991]: Class JavaLaunchHelper is implemented in both /Library/Java/JavaVirtualMachines/jdk1.8.0_05.jdk/Contents/Home/bin/java (0x1020514c0) and /Library/Java/JavaVirtualMachines/jdk1.8.0_05.jdk/Contents/Home/jre/lib/libinstrument.dylib (0x1020d04e0). One of the two will be used. Which one is undefined.\r\n[AppClassLoader@58644d46] info AspectJ Weaver Version 1.9.2 built on Wednesday Oct 24, 2018 at 15:43:33 GMT\r\n[AppClassLoader@58644d46] info register classloader sun.misc.Launcher$AppClassLoader@58644d46\r\n[AppClassLoader@58644d46] info using configuration file:/Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/lib/org.apache.pulsar-pulsar-zookeeper-2.4.1.jar!/META-INF/aop.xml\r\n[AppClassLoader@58644d46] info using configuration file:/Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/lib/org.apache.pulsar-pulsar-zookeeper-utils-2.4.1.jar!/META-INF/aop.xml\r\n[AppClassLoader@58644d46] info register aspect org.apache.pulsar.zookeeper.FinalRequestProcessorAspect\r\n[AppClassLoader@58644d46] info register aspect org.apache.pulsar.zookeeper.ZooKeeperServerAspect\r\n[AppClassLoader@58644d46] info register aspect org.apache.pulsar.zookeeper.SerializeUtilsAspect\r\n[AppClassLoader@58644d46] info register aspect org.apache.pulsar.broker.zookeeper.aspectj.ClientCnxnAspect\r\n[ScriptLoader@517d4a0d] info AspectJ Weaver Version 1.9.2 built on Wednesday Oct 24, 2018 at 15:43:33 GMT\r\n[ScriptLoader@517d4a0d] info register classloader jdk.nashorn.internal.runtime.ScriptLoader@517d4a0d\r\n[ScriptLoader@517d4a0d] info using configuration file:/Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/lib/org.apache.pulsar-pulsar-zookeeper-2.4.1.jar!/META-INF/aop.xml\r\n[ScriptLoader@517d4a0d] info using configuration file:/Users/rabraham/Documents/dev/trial/pulsar-trial/apache-pulsar-2.4.1/lib/org.apache.pulsar-pulsar-zookeeper-utils-2.4.1.jar!/META-INF/aop.xml\r\n[ScriptLoader@517d4a0d] info register aspect org.apache.pulsar.zookeeper.FinalRequestProcessorAspect\r\n[ScriptLoader@517d4a0d] info register aspect org.apache.pulsar.zookeeper.ZooKeeperServerAspect\r\n[ScriptLoader@517d4a0d] info register aspect org.apache.pulsar.zookeeper.SerializeUtilsAspect\r\n[ScriptLoader@517d4a0d] info register aspect org.apache.pulsar.broker.zookeeper.aspectj.ClientCnxnAspect\r\n[AppClassLoader@58644d46] info processing reweavable type org.apache.zookeeper.server.ZooKeeperServer: org/apache/zookeeper/server/ZooKeeperServer.java\r\n[AppClassLoader@58644d46] info successfully verified type org.apache.pulsar.zookeeper.ZooKeeperServerAspect exists.  Originates from org/apache/pulsar/zookeeper/ZooKeeperServerAspect.java\r\n[AppClassLoader@58644d46] info processing reweavable type org.apache.zookeeper.server.FinalRequestProcessor: org/apache/zookeeper/server/FinalRequestProcessor.java\r\n[AppClassLoader@58644d46] info successfully verified type org.apache.pulsar.zookeeper.FinalRequestProcessorAspect exists.  Originates from org/apache/pulsar/zookeeper/FinalRequestProcessorAspect.java\r\n```\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5144", "user": "RAbraham", "labels": ["type/bug"], "created": "2019-09-06 18:33:49", "closed": "2019-09-06 21:29:36", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[docs] Managing partitioned topics page has odd \"Nonpartitioned topics resources\" section", "body": "**Describe the bug**\r\n\r\nThe docs about managing partitioned topics has an odd sub-heading \"Nonpartitioned topics resources\". However, everything under that sub-heading except the first \"Create\" sub-heading seems to be related to partitioned topics (as one would expect for this page). The \"Nonpartitioned topics resources\" and the \"Create\" subheading under that seem to be a copy/paste error or something.\r\n\r\n![image](https://user-images.githubusercontent.com/53049/64441829-9d0f1e00-d09c-11e9-867b-d03e7a78165b.png)\r\n", "url": "https://github.com/apache/pulsar/issues/5142", "user": "rocketraman", "labels": ["type/bug"], "created": "2019-09-06 15:52:59", "closed": "2019-09-16 10:55:00", "commits": {"711501409223a0ba13e9b4e1387556533c80a623": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 9.000277777777777, "commitsDetails": [{"commitHash": "711501409223a0ba13e9b4e1387556533c80a623", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["b392776e12aeacbc5a086b04a715587cc617f92b"], "nameRev": "711501409223a0ba13e9b4e1387556533c80a623 tags/v2.5.0-candidate-1~326", "commitMessage": "[Issue 5142][docs] Remove non-partitioned topic info from partitioned topic docs (#5143)\n\nFixes #5142\r\n\r\n### Motivation\r\n\r\nDocs are confusing.\r\n\r\n### Modifications\r\n\r\nEdited out the incorrect section in the docs. Moved section into its documentation page, with additional related docs.", "commitDateTime": "2019-09-16 03:55:00", "authoredDateTime": "2019-09-16 06:55:00", "commitGitStats": [{"filePath": "site2/docs/admin-api-non-partitioned-topics.md", "insertions": 97, "deletions": 0, "lines": 97}, {"filePath": "site2/docs/admin-api-partitioned-topics.md", "insertions": 0, "deletions": 37, "lines": 37}, {"filePath": "site2/website/sidebars.json", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Java Function cannot work with any JSON parser JAR", "body": "**Describe the bug**\r\nWhen I use any json.jar ,such as Gson, fastjson, org.json, the Pulsar Java function with JSONObject/JsonObject will crash.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Add JSON parse process based a function example ,such as ContextWindowFunction.java or AddWindowFunction.java:\r\ncat AddWindowFunction.java\r\n-----------------------------------------------------------------------------------\r\npackage org.apache.pulsar.functions.api.examples;\r\nimport lombok.extern.slf4j.Slf4j;\r\nimport java.util.Collection;\r\nimport java.util.function.Function;\r\nimport java.util.Set;\r\nimport java.util.Map;\r\nimport java.util.HashMap;\r\nimport java.util.Optional;\r\nimport java.util.concurrent.CompletableFuture;\r\n//import com.alibaba.fastjson.JSON;\r\n//import com.alibaba.fastjson.JSONObject;\r\n//import org.json.JSONObject;\r\nimport com.google.gson.Gson;\r\nimport com.google.gson.JsonObject;\r\nimport org.apache.pulsar.functions.api.examples.pojo.MoteStatValue;\r\n@Slf4j\r\n//public class AddWindowFunction implements Function <Collection<String>, String> {\r\n//    @Override\r\n//    public String apply(Collection<String> LogItems) {\r\npublic class AddWindowFunction implements Function <String, String> {\r\n    @Override\r\n    public String apply(String LogItems) {\r\n\tString result = \"\";\r\n        Map<String, MoteStatValue > mapMoteStat = new HashMap<String, MoteStatValue>();\r\n        String record = LogItems;\r\n        //for (String record : LogItems) \r\n        {\r\n\t\t\tJsonObject jsonObject = new Gson().fromJson(record, JsonObject.class);\r\n\t\t\tString s = jsonObject.get(\"pktype\").getAsString();\r\n\t\t\tif (s.equals(\"motetx\"))\r\n\t\t\t{\r\n\t\t\t\t\tString eui = jsonObject.get(\"eui\").getAsString();//jsonObject.getString(\"eui\");\r\n\t\t\t\t\tMoteStatValue statValue = mapMoteStat.get(eui);\r\n\t\t\t\t\tif (statValue == null)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tstatValue = new MoteStatValue(0,0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstatValue.incUpNbs();\r\n\t\t\t\t\tstatValue.incUpThroughput(jsonObject.get(\"payloadlen\").getAsInt());\r\n\t\t\t\t\tmapMoteStat.put(eui,statValue);\r\n\t\t\t\t\tresult = eui ;\r\n\t\t\t}\r\n        }\r\n        MoteStatValue statValue =  mapMoteStat.get(result);\r\n        return result +  \"=\" + statValue.getUpNbs() + \",\" + statValue.getUpThroughput();\r\n    }\r\n}\r\n\r\n2. Make and Unit Test .....................................OK\r\n[INFO] -------------------------------------------------------\r\n[INFO]  T E S T S\r\n[INFO] -------------------------------------------------------\r\n[INFO] Running org.apache.pulsar.functions.api.examples.TestAddWindowFunction\r\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.342 s - in org.apache.pulsar.functions.api.examples.TestAddWindowFunction\r\ncat  TestAddWindowFunction.java\r\n-------------------------------------------------------------------------------\r\npackage org.apache.pulsar.functions.api.examples;\r\nimport org.junit.*;\r\nimport static junit.framework.Assert.*;\r\nimport org.apache.pulsar.functions.api.examples.AddWindowFunction;\r\npublic class TestAddWindowFunction{\r\n     @Test\r\n     public void testAddWindowFunction(){     \r\n\t\t\t   AddWindowFunction myWindowFunction = new AddWindowFunction();\r\n\t\t\t   String output = myWindowFunction.apply(\"{\\\"pktype\\\":\\\"motetx\\\",\\\"eui\\\":\\\"abcdefg\\\",\\\"payloadlen\\\":100}\");\r\n\t\t\t   Assert.assertEquals(output, \"abcdefg=1,100\");\r\n     }\r\n}\r\n\r\n3. Set schema of input and output topic \r\nBecause function-related input and output topic schema is Integer by default, and the schema defined by function can not be installed automatically, It is necessary to set up input and output topic schema first.\r\nbin/pulsar-admin schemas upload --filename /home/Pulsar/apache-pulsar-2.4.0/examples/strschema.json test_src1\r\nbin/pulsar-admin schemas upload --filename /home/Pulsar/apache-pulsar-2.4.0/examples/strschema.json test_result1\r\ncat examples/strschema.json \r\n------------------------------------------------------------------------------\r\n{\"type\": \"STRING\",\"schema\": \"\",\"properties\": {}}\r\n\r\n4. Deploy the function\r\nbin/pulsar-admin functions create --function-config-file examples/java-window-function-config.yaml\r\ncat  examples/java-window-function-config.yaml\r\n-----------------------------------------------------------------------------------------\r\njar: \"/home/Pulsar/apache-pulsar-2.4.0-src/pulsar-functions/java-examples/target/pulsar-functions-api-examples.jar\"\r\ntenant: \"public\"\r\nnamespace: \"default\"\r\nname: \"AddWindowFunction\"\r\nclassName: \"org.apache.pulsar.functions.api.examples.AddWindowFunction\"\r\ninputs: [\"test_src1\"]\r\nuserConfig:\r\n  \"PublishTopic\": \"test_result1\"\r\noutput: \"test_result1\"\r\nautoAck: true\r\nparallelism: 1\r\n\r\n5. Produce JSON message\r\nbin/pulsar-client produce test_src1  --files /home/Pulsar/apache-pulsar-2.4.0/examples/test.json\r\ncat examples/test.json\r\n-------------------------------------------------------------------------------------------\r\n{\"pktype\":\"motetx\",\"eui\":\"abcdefg\",\"payloadlen\":100}\r\n\r\n6. See error\r\n**Expected behavior**\r\nThe Pulsar function, such as AddWindowFunction, can parse JSON message correctly.\r\n\r\n**Screenshots**\r\nWhile executing \"bin/pulsar-client produce test_src1  --files /home/Pulsar/apache-pulsar-2.4.0/examples/test.json\", the Pulsar function is bound to die with following log: \r\n--------------------------------------------------------------------------------\r\n14:55:08.187 [pulsar-web-57-5] INFO  org.eclipse.jetty.server.RequestLog - 192.168.0.128 - - [06/Sep/2019:14:55:08 +0800] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 804 \"-\" \"Pulsar-Java-v2.4.0\" 38\r\n14:55:10.467 [pulsar-io-50-6] INFO  org.apache.pulsar.broker.service.ServerCnx - New connection from /127.0.0.1:56952\r\n14:55:10.990 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - New connection from /127.0.0.1:56958\r\n14:55:11.009 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - [/127.0.0.1:56958][persistent://public/default/test_src1] Creating producer. producerId=0\r\n14:55:11.034 [ForkJoinPool.commonPool-worker-0] INFO  org.apache.pulsar.broker.service.ServerCnx - [/127.0.0.1:56958]-0 persistent://public/default/test_src1 configured with schema true\r\n14:55:11.040 [ForkJoinPool.commonPool-worker-0] INFO  org.apache.pulsar.broker.service.ServerCnx - [/127.0.0.1:56958] Created new producer: Producer{topic=PersistentTopic{topic=persistent://public/default/test_src1}, client=/127.0.0.1:56958, producerName=standalone-0-3, producerId=0}\r\n14:55:11.390 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - [PersistentTopic{topic=persistent://public/default/test_src1}][standalone-0-3] Closing producer on cnx /127.0.0.1:56958\r\n14:55:11.405 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - [PersistentTopic{topic=persistent://public/default/test_src1}][standalone-0-3] Closed producer on cnx /127.0.0.1:56958\r\n14:55:11.530 [pulsar-io-50-6] INFO  org.apache.pulsar.broker.service.ServerCnx - Closed connection from /127.0.0.1:56952\r\n14:55:11.530 [pulsar-io-50-7] INFO  org.apache.pulsar.broker.service.ServerCnx - Closed connection from /127.0.0.1:56958\r\n14:55:11.542 [pulsar-io-50-5] INFO  org.apache.pulsar.broker.service.ServerCnx - [/192.168.0.128:45986] Closing consumer: 0\r\n14:55:11.543 [pulsar-io-50-5] INFO  org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers - Removed consumer Consumer{subscription=PersistentSubscription{topic=persistent://public/default/test_src1, name=public/default/AddWindowFunction}, consumerId=0, consumerName=66bd6, address=/192.168.0.128:45986} with pending 1 acks\r\n14:55:11.546 [pulsar-io-50-5] INFO  org.apache.pulsar.broker.service.ServerCnx - [/192.168.0.128:45986] Closed consumer Consumer{subscription=PersistentSubscription{topic=persistent://public/default/test_src1, name=public/default/AddWindowFunction}, consumerId=0, consumerName=66bd6, address=/192.168.0.128:45986}\r\n14:55:11.560 [pulsar-io-50-5] INFO  org.apache.pulsar.broker.service.ServerCnx - [PersistentTopic{topic=persistent://public/default/test_result1}][standalone-0-2] Closing producer on cnx /192.168.0.128:45986\r\n14:55:11.561 [pulsar-io-50-5] INFO  org.apache.pulsar.broker.service.ServerCnx - [PersistentTopic{topic=persistent://public/default/test_result1}][standalone-0-2] Closed producer on cnx /192.168.0.128:45986\r\n14:55:11.628 [pulsar-io-50-5] INFO  org.apache.pulsar.broker.service.ServerCnx - Closed connection from /192.168.0.128:45986\r\n14:55:26.946 [function-timer-thread-90-1] ERROR org.apache.pulsar.functions.runtime.ProcessRuntime - Health check failed for AddWindowFunction-0\r\njava.util.concurrent.ExecutionException: io.grpc.StatusRuntimeException: UNAVAILABLE: io exception\r\n        at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357) ~[?:1.8.0_222]\r\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895) ~[?:1.8.0_222]\r\n        at org.apache.pulsar.functions.runtime.ProcessRuntime.lambda$start$1(ProcessRuntime.java:164) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.0.jar:2.4.0]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_222]\r\n        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [?:1.8.0_222]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_222]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [?:1.8.0_222]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_222]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_222]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_222]\r\nCaused by: io.grpc.StatusRuntimeException: UNAVAILABLE: io exception\r\n        at io.grpc.Status.asRuntimeException(Status.java:530) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.stub.ClientCalls$UnaryStreamToFuture.onClose(ClientCalls.java:482) ~[io.grpc-grpc-stub-1.18.0.jar:1.18.0]\r\n        at io.grpc.PartialForwardingClientCallListener.onClose(PartialForwardingClientCallListener.java:39) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.ForwardingClientCallListener.onClose(ForwardingClientCallListener.java:23) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.ForwardingClientCallListener$SimpleForwardingClientCallListener.onClose(ForwardingClientCallListener.java:40) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.internal.CensusStatsModule$StatsClientInterceptor$1$1.onClose(CensusStatsModule.java:699) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.PartialForwardingClientCallListener.onClose(PartialForwardingClientCallListener.java:39) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.ForwardingClientCallListener.onClose(ForwardingClientCallListener.java:23) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.ForwardingClientCallListener$SimpleForwardingClientCallListener.onClose(ForwardingClientCallListener.java:40) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.internal.CensusTracingModule$TracingClientInterceptor$1$1.onClose(CensusTracingModule.java:397) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.internal.ClientCallImpl.closeObserver(ClientCallImpl.java:459) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.internal.ClientCallImpl.access$300(ClientCallImpl.java:63) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl.close(ClientCallImpl.java:546) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl.access$600(ClientCallImpl.java:467) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInContext(ClientCallImpl.java:584) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:123) ~[io.grpc-grpc-core-1.18.0.jar:1.18.0]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_222]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_222]\r\n        ... 1 more\r\nCaused by: io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: /127.0.0.1:33568\r\n        at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) ~[?:1.8.0_222]\r\n        at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717) ~[?:1.8.0_222]\r\n        at io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:327) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:340) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:644) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:591) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:508) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:470) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        ... 2 more\r\nCaused by: java.net.ConnectException: Connection refused\r\n        at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method) ~[?:1.8.0_222]\r\n        at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717) ~[?:1.8.0_222]\r\n        at io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:327) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:340) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:644) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:591) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:508) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:470) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        ... 2 more\r\n14:55:26.992 [function-timer-thread-90-1] ERROR org.apache.pulsar.functions.runtime.ProcessRuntime - Extracted Process death exception\r\njava.lang.RuntimeException: \r\n        at org.apache.pulsar.functions.runtime.ProcessRuntime.tryExtractingDeathException(ProcessRuntime.java:380) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.0.jar:2.4.0]\r\n        at org.apache.pulsar.functions.runtime.ProcessRuntime.isAlive(ProcessRuntime.java:367) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.0.jar:2.4.0]\r\n        at org.apache.pulsar.functions.runtime.RuntimeSpawner.lambda$start$0(RuntimeSpawner.java:88) ~[org.apache.pulsar-pulsar-functions-runtime-2.4.0.jar:2.4.0]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_222]\r\n        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308) [?:1.8.0_222]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_222]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294) [?:1.8.0_222]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_222]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_222]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_222]\r\n14:55:26.997 [function-timer-thread-90-1] ERROR org.apache.pulsar.functions.runtime.RuntimeSpawner - public/default/AddWindowFunction-java.lang.RuntimeException:  Function Container is dead with exception.. restarting\r\n14:55:26.999 [function-timer-thread-90-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Creating function log directory /home/Pulsar/apache-pulsar-2.4.0/logs/functions/public/default/AddWindowFunction\r\n14:55:27.005 [function-timer-thread-90-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Created or found function log directory /home/Pulsar/apache-pulsar-2.4.0/logs/functions/public/default/AddWindowFunction\r\n14:55:27.006 [function-timer-thread-90-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - ProcessBuilder starting the process with args java -cp /home/Pulsar/apache-pulsar-2.4.0/instances/java-instance.jar:/home/Pulsar/apache-pulsar-2.4.0/instances/deps/* -Dpulsar.functions.java.instance.jar=/home/Pulsar/apache-pulsar-2.4.0/instances/java-instance.jar -Dpulsar.functions.extra.dependencies.dir=/home/Pulsar/apache-pulsar-2.4.0/instances/deps -Dlog4j.configurationFile=java_instance_log4j2.yml -Dpulsar.function.log.dir=/home/Pulsar/apache-pulsar-2.4.0/logs/functions/public/default/AddWindowFunction -Dpulsar.function.log.file=AddWindowFunction-0 -Xmx1073741824 org.apache.pulsar.functions.runtime.JavaInstanceMain --jar /tmp/pulsar_functions/public/default/AddWindowFunction/0/pulsar-functions-api-examples.jar --instance_id 0 --function_id 68145a82-a243-4b55-8b98-76eda32e60e7 --function_version e585d105-ac58-49bb-9765-4d47aaa03d32 --function_details '{\"tenant\":\"public\",\"namespace\":\"default\",\"name\":\"AddWindowFunction\",\"className\":\"org.apache.pulsar.functions.api.examples.AddWindowFunction\",\"userConfig\":\"{\\\"PublishTopic\\\":\\\"test_result1\\\"}\",\"autoAck\":true,\"parallelism\":1,\"source\":{\"typeClassName\":\"java.util.Collection\",\"inputSpecs\":{\"test_src1\":{}},\"cleanupSubscription\":true},\"sink\":{\"topic\":\"test_result1\",\"typeClassName\":\"java.lang.Integer\"},\"resources\":{\"cpu\":1.0,\"ram\":\"1073741824\",\"disk\":\"10737418240\"},\"componentType\":\"FUNCTION\"}' --pulsar_serviceurl pulsar://msp2:6650 --max_buffered_tuples 1024 --port 33568 --metrics_port 42630 --state_storage_serviceurl bk://127.0.0.1:4181 --expected_healthcheck_interval 30 --secrets_provider org.apache.pulsar.functions.secretsprovider.ClearTextSecretsProvider --cluster_name standalone\r\n14:55:27.021 [function-timer-thread-90-1] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully\r\n14:55:35.048 [pulsar-io-50-8] INFO  org.apache.pulsar.broker.service.ServerCnx - New connection from /192.168.0.128:46350\r\n14:55:35.708 [pulsar-io-50-8] INFO  org.apache.pulsar.broker.service.ServerCnx - [/192.168.0.128:46350][persistent://public/default/test_result1] Creating producer. producerId=0\r\n14:55:35.751 [ForkJoinPool.commonPool-worker-2] INFO  org.apache.pulsar.broker.service.ServerCnx - [/192.168.0.128:46350] Created new producer: Producer{topic=PersistentTopic{topic=persistent://public/default/test_result1}, client=/192.168.0.128:46350, producerName=standalone-0-4, producerId=0}\r\n14:55:36.101 [pulsar-io-50-8] INFO  org.apache.pulsar.broker.service.ServerCnx - [/192.168.0.128:46350] Subscribing on topic persistent://public/default/test_src1 / public/default/AddWindowFunction\r\n14:55:36.151 [ForkJoinPool.commonPool-worker-1] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [public/default/persistent/test_src1-public%2Fdefault%2FAddWindowFunction] Rewind from 16:1 to 16:0\r\n14:55:36.154 [ForkJoinPool.commonPool-worker-1] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://public/default/test_src1] There are no replicated subscriptions on the topic\r\n14:55:36.155 [ForkJoinPool.commonPool-worker-1] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://public/default/test_src1][public/default/AddWindowFunction] Created new subscription for 0\r\n14:55:36.155 [ForkJoinPool.commonPool-worker-1] INFO  org.apache.pulsar.broker.service.ServerCnx - [/192.168.0.128:46350] Created subscription on topic persistent://public/default/test_src1 / public/default/AddWindowFunction\r\n14:55:36.583 [pulsar-io-50-8] INFO  org.apache.pulsar.broker.service.ServerCnx - [/192.168.0.128:46350] Closing consumer: 0\r\n14:55:36.584 [pulsar-io-50-8] INFO  org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers - Removed consumer Consumer{subscription=PersistentSubscription{topic=persistent://public/default/test_src1, name=public/default/AddWindowFunction}, consumerId=0, consumerName=3fb47, address=/192.168.0.128:46350} with pending 1 acks\r\n14:55:36.590 [pulsar-io-50-8] INFO  org.apache.pulsar.broker.service.ServerCnx - [/192.168.0.128:46350] Closed consumer Consumer{subscription=PersistentSubscription{topic=persistent://public/default/test_src1, name=public/default/AddWindowFunction}, consumerId=0, consumerName=3fb47, address=/192.168.0.128:46350}\r\n14:55:36.603 [pulsar-io-50-8] INFO  org.apache.pulsar.broker.service.ServerCnx - [PersistentTopic{topic=persistent://public/default/test_result1}][standalone-0-4] Closing producer on cnx /192.168.0.128:46350\r\n14:55:36.603 [pulsar-io-50-8] INFO  org.apache.pulsar.broker.service.ServerCnx - [PersistentTopic{topic=persistent://public/default/test_result1}][standalone-0-4] Closed producer on cnx /192.168.0.128:46350\r\n14:55:36.670 [pulsar-io-50-8] INFO  org.apache.pulsar.broker.service.ServerCnx - Closed connection from /192.168.0.128:46350\r\n14:55:38.183 [pulsar-web-57-8] INFO  org.eclipse.jetty.server.RequestLog - 192.168.0.128 - - [06/Sep/2019:14:55:38 +0800] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 804 \"-\" \"Pulsar-Java-v2.4.0\" 24\r\n\r\n**Additional context**\r\n1. This problem occurs in either Window functon or None-Window function.\r\n2. This problem occurs in either Context functon or None-Context function.\r\n3. While deploying the function, its input and output topic schemas are all Integer, but not String in the Pulsar log:\r\n14:53:56.324 [pulsar-external-listener-77-1] INFO  org.apache.pulsar.functions.worker.FunctionAssignmentTailer - Received assignment update: instance {\r\n  functionMetaData {\r\n    functionDetails {\r\n      tenant: \"public\"\r\n      namespace: \"default\"\r\n      name: \"AddWindowFunction\"\r\n      className: \"org.apache.pulsar.functions.api.examples.AddWindowFunction\"\r\n      userConfig: \"{\\\"PublishTopic\\\":\\\"test_result1\\\"}\"\r\n      autoAck: true\r\n      parallelism: 1\r\n      source {\r\n        typeClassName: \"java.util.Collection\"\r\n        inputSpecs {\r\n          key: \"test_src1\"\r\n          value {\r\n          }\r\n        }\r\n        cleanupSubscription: true\r\n      }\r\n      sink {\r\n        topic: \"test_result1\"\r\n        typeClassName: \"java.lang.Integer\"\r\n      }\r\n      resources {\r\n        cpu: 1.0\r\n        ram: 1073741824\r\n        disk: 10737418240\r\n      }\r\n      componentType: FUNCTION\r\n    }\r\n    packageLocation {\r\n      packagePath: \"public/default/AddWindowFunction/1a83d3a0-a550-484b-b1e4-6ea1436df8f2-pulsar-functions-api-examples.jar\"\r\n      originalFileName: \"pulsar-functions-api-examples.jar\"\r\n    }\r\n    createTime: 1567752835453\r\n  }\r\n}\r\nworkerId: \"c-standalone-fw-msp2-8080\"\r\n", "url": "https://github.com/apache/pulsar/issues/5136", "user": "borlandor", "labels": ["component/functions", "triage/week-38", "type/bug"], "created": "2019-09-06 07:04:32", "closed": "2019-10-11 03:59:06", "commits": {}, "ttf": 34.000277777777775, "commitsDetails": []}, {"title": "[Documentation] Add Geo Replicated subscriptions documentation in website", "body": "In [PIP-33](https://github.com/apache/pulsar/wiki/PIP-33%3A-Replicated-subscriptions), Geo Replicated subscriptions, feature is added, but documentation is not updated.\r\nrelated PRs: #4396 #4299 #4340 #4354\r\n\r\nThis issue tries to track the documentation work.\r\n", "url": "https://github.com/apache/pulsar/issues/5134", "user": "jiazhai", "labels": ["component/documentation", "help wanted", "triage/week-38", "type/bug"], "created": "2019-09-06 03:02:28", "closed": "2019-09-27 06:23:51", "commits": {}, "ttf": 21.00027777777778, "commitsDetails": []}, {"title": "Pip can't find pulsar-client 2.4.1 for Python 3.7", "body": "**Describe the bug**\r\nHi,\r\nI'm on python 3.7.4 and when I do a `pip install pulsar-client==2.4.1` according to the [docs](https://pulsar.apache.org/docs/en/client-libraries-python/#installation-using-pip), I get the following error.\r\n\r\n```bash\r\n(venv) \u279c   python --version\r\nPython 3.7.4\r\n(venv) \u279c   pip install pulsar-client==2.4.1\r\nCollecting pulsar-client==2.4.1\r\n  ERROR: Could not find a version that satisfies the requirement pulsar-client==2.4.1 (from versions: 2.1.0, 2.1.1, 2.2.0, 2.2.1, 2.3.0, 2.3.0.post1, 2.3.1, 2.3.2, 2.4.0)\r\nERROR: No matching distribution found for pulsar-client==2.4.1\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: MacOS Mojave\r\n\r\n**Additional context**\r\nI'm using `pyenv`\r\n", "url": "https://github.com/apache/pulsar/issues/5129", "user": "RAbraham", "labels": ["type/bug"], "created": "2019-09-05 23:54:38", "closed": "2019-09-06 16:44:18", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Client may not work well when using invalid multi-hosts", "body": "**Describe the bug**\r\nSome users especially the new ones may be puzzled when using multi-hosts in `client.conf`, such as:\r\n```\r\n$ cat conf/client.conf\r\nwebServiceUrl=http://host1:8080,http://host2:8080\r\n\r\n$ bin/pulsar-admin brokers list pulsar-cluster-test\r\nclass java.lang.IllegalArgumentException: port out of range:-1\r\n```\r\n\r\nor\r\n\r\n```\r\n$ cat conf/client.conf\r\nwebServiceUrl=http://host1:8080/,http://host2:8080/\r\n\r\n$ bin/pulsar-admin brokers list pulsar-cluster-test\r\nHTTP 404 Not Found\r\n\r\nReason: HTTP 404 Not Found\r\n```\r\nIt would be better to add the configuration example when using multi-hosts. More details can be found in unit test `ServiceURITest.java`.\r\n", "url": "https://github.com/apache/pulsar/issues/5120", "user": "murong00", "labels": ["component/client", "component/documentation", "triage/week-36", "type/bug"], "created": "2019-09-05 07:00:01", "closed": "2019-09-06 01:15:42", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[Doc] Wrong reference in kubernetes deployment README.md", "body": "![image](https://user-images.githubusercontent.com/5338550/64142532-ee21d680-ce3e-11e9-8980-3606e708b168.png)\r\nThe reference of Kubernetes.md seems linked to the wrong path.", "url": "https://github.com/apache/pulsar/issues/5098", "user": "f7753", "labels": ["component/documentation", "triage/week-36", "type/bug"], "created": "2019-09-03 03:37:00", "closed": "2019-09-05 21:48:48", "commits": {"b6f89c38e59aa6c80276f1f2bd958c7c3e998e1b": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "b6f89c38e59aa6c80276f1f2bd958c7c3e998e1b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["5fa40cb284f2250991464135069ea6e980774c3f"], "nameRev": "b6f89c38e59aa6c80276f1f2bd958c7c3e998e1b tags/v2.5.0-candidate-1~372", "commitMessage": "Fix wrong reference in kubernetes deployment README.md (#5110)\n\n### Motivation\r\n\r\nFixes #5098\r\n\r\n### Modifications\r\n\r\nModify the relative path in README.md (pulsar/deployment/kubernetes/README.md)", "commitDateTime": "2019-09-05 14:48:47", "authoredDateTime": "2019-09-06 05:48:47", "commitGitStats": [{"filePath": "deployment/kubernetes/README.md", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Improve response of REST API on AvroSchemaBasedCompatibilityCheck", "body": "posting (non-compatible?) schema outputs a unuseful html page with 500 code.\r\nIt should output maybe a 409 with the compatibility error shown in json output or something beautifully helpful for a developer\r\n\r\nPOST to \r\n```\r\n'http://localhost:8080/admin/v2/schemas/abc/def/x2/schema'\r\n```\r\nGet response\r\n```\r\nb'<html>\\n<head>\\n<meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\"/>\\n<title>Error 500 Internal Server Error</title>\\n</head>\\n<body><h2>HTTP ERROR 500</h2>\\n<p>Problem accessing /admin/v2/schemas/abc/def/x2/schema. Reason:\\n<pre>    Internal Server Error</pre></p><hr><a href=\"http://eclipse.org/jetty\">Powered by Jetty:// 9.4.12.v20180830</a><hr/>\\n\\n</body>\\n</html>\\n'\r\n```\r\nDeveloper needs to read the logs to understand the error\r\n```\r\n17:59:36.291 [ForkJoinPool.commonPool-worker-0] ERROR org.apache.pulsar.broker.service.schema.AvroSchemaBasedCompatibilityCheck - Error during schema compatibility check: Unable to read schema:\r\n{\r\n  \"type\" : \"record\",\r\n  \"name\" : \"XSchemaV0\",\r\n  \"fields\" : [ {\r\n    \"name\" : \"fur4\",\r\n    \"type\" : \"string\"\r\n  } ]\r\n}\r\nusing schema:\r\n{\r\n  \"type\" : \"record\",\r\n  \"name\" : \"XSchemaV0\",\r\n  \"fields\" : [ {\r\n    \"name\" : \"fur2\",\r\n    \"type\" : \"string\"\r\n  } ]\r\n}\r\norg.apache.avro.SchemaValidationException: Unable to read schema:\r\n{\r\n  \"type\" : \"record\",\r\n  \"name\" : \"XSchemaV0\",\r\n  \"fields\" : [ {\r\n    \"name\" : \"fur4\",\r\n    \"type\" : \"string\"\r\n  } ]\r\n}\r\nusing schema:\r\n{\r\n  \"type\" : \"record\",\r\n  \"name\" : \"XSchemaV0\",\r\n  \"fields\" : [ {\r\n    \"name\" : \"fur2\",\r\n    \"type\" : \"string\"\r\n  } ]\r\n}\r\n\tat org.apache.avro.ValidateMutualRead.canRead(ValidateMutualRead.java:70) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.avro.ValidateMutualRead.validate(ValidateMutualRead.java:43) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.avro.ValidateLatest.validate(ValidateLatest.java:51) ~[org.apache.avro-avro-1.8.2.jar:1.8.2]\r\n\tat org.apache.pulsar.broker.service.schema.AvroSchemaBasedCompatibilityCheck.isCompatible(AvroSchemaBasedCompatibilityCheck.java:56) ~[org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n\tat org.apache.pulsar.broker.service.schema.AvroSchemaCompatibilityCheck.isCompatible(AvroSchemaCompatibilityCheck.java:26) ~[org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n\tat org.apache.pulsar.broker.service.schema.AvroSchemaBasedCompatibilityCheck.isCompatible(AvroSchemaBasedCompatibilityCheck.java:42) ~[org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n\tat org.apache.pulsar.broker.service.schema.AvroSchemaCompatibilityCheck.isCompatible(AvroSchemaCompatibilityCheck.java:26) ~[org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n\tat org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.isCompatible(SchemaRegistryServiceImpl.java:180) ~[org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n\tat org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.lambda$checkCompatibilityWithLatest$8(SchemaRegistryServiceImpl.java:189) ~[org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n\tat java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:602) ~[?:1.8.0_212]\r\n\tat java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:577) ~[?:1.8.0_212]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_212]\r\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1962) ~[?:1.8.0_212]\r\n\tat org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.lambda$null$5(BookkeeperSchemaStorage.java:187) ~[org.apache.pulsar-pulsar-broker-2.4.0.jar:2.4.0]\r\n\tat java.util.concurrent.CompletableFuture.uniHandle(CompletableFuture.java:822) [?:1.8.0_212]\r\n\tat java.util.concurrent.CompletableFuture$UniHandle.tryFire(CompletableFuture.java:797) [?:1.8.0_212]\r\n\tat java.util.concurrent.CompletableFuture$Completion.exec(CompletableFuture.java:443) [?:1.8.0_212]\r\n\tat java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:289) [?:1.8.0_212]\r\n\tat java.util.concurrent.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1056) [?:1.8.0_212]\r\n\tat java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1692) [?:1.8.0_212]\r\n\tat java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:157) [?:1.8.0_212]\r\n\r\n```", "url": "https://github.com/apache/pulsar/issues/5094", "user": "pouledodue", "labels": ["component/schemaregistry", "triage/week-36", "type/bug"], "created": "2019-09-02 18:07:42", "closed": "2019-09-05 08:06:55", "commits": {"b19628394629c9b04bfc3a8f7e066bb4bad018e2": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "b19628394629c9b04bfc3a8f7e066bb4bad018e2", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["53fb0554e8411a0b65701936864e6d91666a4ef1"], "nameRev": "b19628394629c9b04bfc3a8f7e066bb4bad018e2 tags/v2.5.0-candidate-1~376", "commitMessage": "Improve response of Rest API for create schema. (#5103)\n\nFixes #5094\r\n### Motivation\r\n\r\nCurrently, can't get some detail messages about incompatible while use REST API to create a new schema. This PR let users to get the detail messages.\r\n\r\n### Future more\r\nUse pulsar-admin or pulsar-client also can get the detail messages about incompatible. This PR only handle the REST way.\r\n", "commitDateTime": "2019-09-05 01:06:54", "authoredDateTime": "2019-09-05 16:06:54", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/SchemasResource.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/AvroSchemaBasedCompatibilityCheck.java", "insertions": 7, "deletions": 7, "lines": 14}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/DefaultSchemaRegistryService.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/JsonSchemaCompatibilityCheck.java", "insertions": 12, "deletions": 11, "lines": 23}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/KeyValueSchemaCompatibilityCheck.java", "insertions": 15, "deletions": 9, "lines": 24}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaCompatibilityCheck.java", "insertions": 27, "deletions": 11, "lines": 38}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistry.java", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java", "insertions": 80, "deletions": 58, "lines": 138}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/exceptions/IncompatibleSchemaException.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/exceptions/SchemaException.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/validator/SchemaRegistryServiceWithSchemaDataValidator.java", "insertions": 12, "deletions": 2, "lines": 14}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SchemasResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.SchemasResource.postSchema(java.lang.String,java.lang.String,java.lang.String,org.apache.pulsar.common.protocol.schema.PostSchemaPayload,boolean,javax.ws.rs.container.AsyncResponse)", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "AvroSchemaBasedCompatibilityCheck.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.AvroSchemaBasedCompatibilityCheck.isCompatible(org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 6, "UPD": 2, "INS": 0, "MOV": 4, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.AvroSchemaBasedCompatibilityCheck.isCompatible(java.lang.Iterable,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 4, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.AvroSchemaBasedCompatibilityCheck.createSchemaValidator(org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.AvroSchemaBasedCompatibilityCheck.checkCompatible(java.lang.Iterable,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "DefaultSchemaRegistryService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.DefaultSchemaRegistryService.checkCompatible(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JsonSchemaCompatibilityCheck.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.JsonSchemaCompatibilityCheck.isCompatible(org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 14, "UPD": 2, "INS": 0, "MOV": 5, "DEL": 7}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.JsonSchemaCompatibilityCheck.isCompatibleJsonSchema(org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.common.protocol.schema.SchemaData)", "TOT": 8, "UPD": 1, "INS": 3, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.JsonSchemaCompatibilityCheck.checkCompatible(org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KeyValueSchemaCompatibilityCheck.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.KeyValueSchemaCompatibilityCheck.isCompatible(org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 6, "UPD": 2, "INS": 0, "MOV": 4, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.KeyValueSchemaCompatibilityCheck.isCompatible(java.lang.Iterable,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 14, "UPD": 2, "INS": 0, "MOV": 8, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.KeyValueSchemaCompatibilityCheck.checkCompatible(java.lang.Iterable,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaCompatibilityCheck.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.1.isCompatible(org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 10, "UPD": 2, "INS": 0, "MOV": 7, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.1.isCompatible(java.lang.Iterable,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 10, "UPD": 2, "INS": 0, "MOV": 7, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.checkCompatible(org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.checkCompatible(java.lang.Iterable,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.isCompatible(org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 4, "UPD": 0, "INS": 1, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.isCompatible(java.lang.Iterable,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 4, "UPD": 0, "INS": 1, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.1.checkCompatible(org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.1.checkCompatible(java.lang.Iterable,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaRegistry.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.checkCompatible(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaRegistryServiceImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.isCompatible(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 5, "UPD": 3, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.isCompatible(org.apache.pulsar.broker.service.schema.SchemaAndMetadata,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 12, "UPD": 3, "INS": 0, "MOV": 8, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.checkCompatibilityWithLatest(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 10, "UPD": 2, "INS": 1, "MOV": 6, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.putSchemaIfAbsent(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 32, "UPD": 11, "INS": 6, "MOV": 9, "DEL": 6}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.checkCompatibilityWithAll(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 7, "UPD": 1, "INS": 3, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.checkCompatible(org.apache.pulsar.broker.service.schema.SchemaAndMetadata,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.checkCompatible(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "IncompatibleSchemaException.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.exceptions.IncompatibleSchemaException", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaException.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.exceptions.SchemaException", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaRegistryServiceWithSchemaDataValidator.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.validator.SchemaRegistryServiceWithSchemaDataValidator.checkCompatible(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[doc] Admin Rest Api page do not show", "body": "\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to`http://pulsar.apache.org/admin-rest-api/`\r\n2. Stare at a blank page for 5 minutes\r\n3. go make coffee\r\n4. Page is still blank\r\n5. cry\r\n\r\n**Desktop (please complete the following information):**\r\n - macos, safari, chrome\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5089", "user": "pouledodue", "labels": ["component/website", "triage/week-36", "type/bug"], "created": "2019-09-01 20:20:29", "closed": "2019-09-08 20:16:29", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "can't update JSON Schema to AVRO with pulsar-admin", "body": "**Describe the bug**\r\nChanging just the type of schema does not work\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. create a file `/tmp/yoshi` containing:\r\n```\r\n{\r\n    \"type\": \"JSON\",\r\n    \"schema\": \"{\\\"type\\\":\\\"record\\\",\\\"name\\\":\\\"User\\\",\\\"namespace\\\":\\\"com.foo\\\",\\\"fields\\\":[{\\\"name\\\":\\\"file1\\\",\\\"type\\\":[\\\"null\\\",\\\"string\\\"],\\\"default\\\":null},{\\\"name\\\":\\\"file2\\\",\\\"type\\\":\\\"string\\\",\\\"default\\\":null},{\\\"name\\\":\\\"file3\\\",\\\"type\\\":[\\\"null\\\",\\\"string\\\"],\\\"default\\\":\\\"dfdf\\\"}]}\",\r\n    \"properties\": {}\r\n}\r\n```\r\n2. now type `pulsar-admin schemas upload -f /tmp/yoshi persistent://public/default/yoshi` to upload the schema\r\n3. now type `pulsar-admin schemas get persistent://public/default/yoshi`\r\nthe result will say:\r\n```\r\n...\r\n \"type\": \"JSON\",\r\n...\r\n``` \r\nwhich is ok\r\n4. edit `/tmp/yoshi` and change\r\n```\r\n...\r\n  \"type\": \"AVRO\",\r\n...\r\n```\r\n5. now type `pulsar-admin schemas upload -f /tmp/yoshi persistent://public/default/yoshi` to upload the schema\r\n6. now type `pulsar-admin schemas get persistent://public/default/yoshi`\r\nthe result will say:\r\n```\r\n...\r\n \"type\": \"JSON\",\r\n...\r\n``` \r\nit should say instead 'AVRO'\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - macos, pulsar-all docker image 2.4.0 standalone\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5088", "user": "pouledodue", "labels": ["component/schemaregistry", "triage/week-36", "type/bug"], "created": "2019-09-01 20:09:22", "closed": "2019-09-18 01:56:55", "commits": {}, "ttf": 16.00027777777778, "commitsDetails": []}, {"title": "PulsarClientException NO SHUCH METHOD ERROR", "body": "**Describe the bug**\r\nHi, i'm trying to send data to pulsar broker via Apache Nifi flow. I'm able to get connection to pulsar but when i tried to send my data i get an exception that is may be a dependency issue ...\r\nThe pulsar client generate this error and more precisly that happen when producer class is called and the not found method is com.scurrilous.circe.checksum.Crc32cIntChecksum.computeChecksum.\r\nAny hint, suggestion ? or a dependency exclusion needed ? \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nuse nifi 1.9 version\r\nmake a flow that connect to pulsar broker. I'm using this [nifi pulsar processor](https://github.com/streamlio/nifi-pulsar-bundle) that use the pulsar client api.\r\nWhen the flow is configured, and a data is coming and when we try to send it, an exception is thrown:\r\nFollowing exception is:\r\n\r\n> 2019-08-29 09:15:26,749 ERROR [Timer-Driven Process Thread-5] o.a.n.p.pulsar.pubsub.PublishPulsar PublishPulsar[id=de260534-016c-1000-5f3d-db6103ca25d8] Unable to publish message to Pulsar broker pulsar://localhost:6650: org.apache.pulsar.client.api.PulsarClientException: java.lang.NoSuchMethodError: com.scurrilous.circe.checksum.Crc32cIntChecksum.computeChecksum(Lorg/apache/pulsar/shade/io/netty/buffer/ByteBuf;)I\r\norg.apache.pulsar.client.api.PulsarClientException: java.lang.NoSuchMethodError: com.scurrilous.circe.checksum.Crc32cIntChecksum.computeChecksum(Lorg/apache/pulsar/shade/io/netty/buffer/ByteBuf;)I\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.sendAsync(ProducerImpl.java:413)\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.internalSendAsync(ProducerImpl.java:215)\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:78)\r\n\tat org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:55)\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:52)\r\n\tat org.apache.nifi.processors.pulsar.pubsub.PublishPulsar.send(PublishPulsar.java:115)\r\n\tat org.apache.nifi.processors.pulsar.pubsub.PublishPulsar.onTrigger(PublishPulsar.java:83)\r\n\tat org.apache.nifi.processor.AbstractProcessor.onTrigger(AbstractProcessor.java:27)\r\n\tat org.apache.nifi.controller.StandardProcessorNode.onTrigger(StandardProcessorNode.java:1162)\r\n\tat org.apache.nifi.controller.tasks.ConnectableTask.invoke(ConnectableTask.java:205)\r\n\tat org.apache.nifi.controller.scheduling.TimerDrivenSchedulingAgent$1.run(TimerDrivenSchedulingAgent.java:117)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.lang.NoSuchMethodError: com.scurrilous.circe.checksum.Crc32cIntChecksum.computeChecksum(Lorg/apache/pulsar/shade/io/netty/buffer/ByteBuf;)I\r\n\tat org.apache.pulsar.common.api.Commands.serializeCommandSendWithSize(Commands.java:948)\r\n\tat org.apache.pulsar.common.api.Commands.newSend(Commands.java:315)\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.sendMessage(ProducerImpl.java:449)\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.sendAsync(ProducerImpl.java:376)\r\n\t... 17 common frames omitted\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: linux ubuntu 18.04\r\n\r\n**Additional context**\r\nI'm working in nifi context\r\n\r\nBelow more logs before the exception was thrown:\r\n\r\n> 2019-08-29 09:15:10,972 INFO [Timer-Driven Process Thread-1] o.a.nifi.amqp.processors.AMQPConsumer Successfully connected AMQPConsumer to amqp://admin_rabbit@127.0.0.1:5672/ and 'test_queue' queue\r\n2019-08-29 09:15:24,747 INFO [pulsar-client-io-1-1] o.a.pulsar.client.impl.ConnectionPool [[id: 0x567a352e, L:/127.0.0.1:58138 - R:localhost/127.0.0.1:6650]] Connected to server\r\n2019-08-29 09:15:26,485 INFO [pulsar-client-io-1-1] o.a.p.c.impl.ProducerStatsRecorderImpl Starting Pulsar producer perf with config: {\r\n  \"topicName\" : \"testOtman\",\r\n  \"producerName\" : null,\r\n  \"sendTimeoutMs\" : 30000,\r\n  \"blockIfQueueFull\" : false,\r\n  \"maxPendingMessages\" : 1000,\r\n  \"maxPendingMessagesAcrossPartitions\" : 50000,\r\n  \"messageRoutingMode\" : \"RoundRobinPartition\",\r\n  \"hashingScheme\" : \"JavaStringHash\",\r\n  \"cryptoFailureAction\" : \"FAIL\",\r\n  \"batchingMaxPublishDelayMicros\" : 10000,\r\n  \"batchingMaxMessages\" : 1000,\r\n  \"batchingEnabled\" : false,\r\n  \"compressionType\" : \"NONE\",\r\n  \"initialSequenceId\" : null,\r\n  \"autoUpdatePartitions\" : true,\r\n  \"properties\" : { }\r\n}\r\n2019-08-29 09:15:26,502 INFO [pulsar-client-io-1-1] o.a.p.c.impl.ProducerStatsRecorderImpl Pulsar client config: {\r\n  \"serviceUrl\" : \"pulsar://localhost:6650\",\r\n  \"operationTimeoutMs\" : 30000,\r\n  \"statsIntervalSeconds\" : 60,\r\n  \"numIoThreads\" : 1,\r\n  \"numListenerThreads\" : 1,\r\n  \"connectionsPerBroker\" : 1,\r\n  \"useTcpNoDelay\" : false,\r\n  \"useTls\" : false,\r\n  \"tlsTrustCertsFilePath\" : \"\",\r\n  \"tlsAllowInsecureConnection\" : false,\r\n  \"tlsHostnameVerificationEnable\" : false,\r\n  \"concurrentLookupRequest\" : 5000,\r\n  \"maxLookupRequest\" : 50000,\r\n  \"maxNumberOfRejectedRequestPerConnection\" : 50,\r\n  \"keepAliveIntervalSeconds\" : 30,\r\n  \"connectionTimeoutMs\" : 10000\r\n}\r\n2019-08-29 09:15:26,587 INFO [pulsar-client-io-1-1] o.a.pulsar.client.impl.ConnectionPool [[id: 0x9f4e2038, L:/127.0.0.1:58140 - R:localhost/127.0.0.1:6650]] Connected to server\r\n2019-08-29 09:15:26,590 INFO [pulsar-client-io-1-1] org.apache.pulsar.client.impl.ClientCnx [id: 0x9f4e2038, L:/127.0.0.1:58140 - R:localhost/127.0.0.1:6650] Connected through proxy to target broker at allinone:6650\r\n2019-08-29 09:15:26,627 INFO [pulsar-client-io-1-1] o.apache.pulsar.client.impl.ProducerImpl [testOtman] [null] Creating producer on cnx [id: 0x9f4e2038, L:/127.0.0.1:58140 - R:localhost/127.0.0.1:6650]\r\n2019-08-29 09:15:26,664 INFO [pulsar-client-io-1-1] o.apache.pulsar.client.impl.ProducerImpl [testOtman] [standalone-7-725] Created producer on cnx [id: 0x9f4e2038, L:/127.0.0.1:58140 - R:localhost/127.0.0.1:6650]\r\n2019-08-29 09:15:26,749 ERROR [Timer-Driven Process Thread-5] o.a.n.p.pulsar.pubsub.PublishPulsar PublishPulsar[id=de260534-016c-1000-5f3d-db6103ca25d8] Unable to publish message to Pulsar broker pulsar://localhost:6650: org.apache.pulsar.client.api.PulsarClientException: java.lang.NoSuchMethodError: com.scurrilous.circe.checksum.Crc32cIntChecksum.computeChecksum(Lorg/apache/pulsar/shade/io/netty/buffer/ByteBuf;)I\r\norg.apache.pulsar.client.api.PulsarClientException: java.lang.NoSuchMethodError: com.scurrilous.circe.checksum.Crc32cIntChecksum.computeChecksum(Lorg/apache/pulsar/shade/io/netty/buffer/ByteBuf;)I\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.sendAsync(ProducerImpl.java:413)\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.internalSendAsync(ProducerImpl.java:215)\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:78)\r\n\tat org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:55)\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:52)\r\n\tat org.apache.nifi.processors.pulsar.pubsub.PublishPulsar.send(PublishPulsar.java:115)\r\n\tat org.apache.nifi.processors.pulsar.pubsub.PublishPulsar.onTrigger(PublishPulsar.java:83)\r\n\tat org.apache.nifi.processor.AbstractProcessor.onTrigger(AbstractProcessor.java:27)\r\n\tat org.apache.nifi.controller.StandardProcessorNode.onTrigger(StandardProcessorNode.java:1162)\r\n\tat org.apache.nifi.controller.tasks.ConnectableTask.invoke(ConnectableTask.java:205)\r\n\tat org.apache.nifi.controller.scheduling.TimerDrivenSchedulingAgent$1.run(TimerDrivenSchedulingAgent.java:117)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.lang.NoSuchMethodError: com.scurrilous.circe.checksum.Crc32cIntChecksum.computeChecksum(Lorg/apache/pulsar/shade/io/netty/buffer/ByteBuf;)I\r\n\tat org.apache.pulsar.common.api.Commands.serializeCommandSendWithSize(Commands.java:948)\r\n\tat org.apache.pulsar.common.api.Commands.newSend(Commands.java:315)\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.sendMessage(ProducerImpl.java:449)\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.sendAsync(ProducerImpl.java:376)\r\n\t... 17 common frames omitted\r\n", "url": "https://github.com/apache/pulsar/issues/5081", "user": "otmanel31", "labels": ["triage/week-35", "type/bug"], "created": "2019-08-30 10:43:34", "closed": "2019-09-02 08:46:24", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "pulsar-admin topics skip-all is missing", "body": "**Describe the bug**\r\nAccording to the pulsar-admin doc, skip-all should work. But it throws unknown command.\r\n\r\n**To Reproduce**\r\npulsar-admin topics skip-all some-topic -s some-sub\r\n\r\n**Expected behavior**\r\nSucceeds\r\n\r\n**Additional context**\r\nIt's available under the persistent command. It appears that the topics command unification commit forgot to add skip-all: https://github.com/apache/pulsar/pull/1634\r\n", "url": "https://github.com/apache/pulsar/issues/5060", "user": "vicaya", "labels": ["help wanted", "triage/week-35", "type/bug"], "created": "2019-08-28 00:03:41", "closed": "2019-09-15 20:41:33", "commits": {"8f75f5849ca1ce9ff2bb68662bc2ca64fbffde70": {"commitGHEventType": "referenced", "commitUser": "aahmed-se"}}, "ttf": 18.00027777777778, "commitsDetails": [{"commitHash": "8f75f5849ca1ce9ff2bb68662bc2ca64fbffde70", "commitGHEventType": "referenced", "commitUser": "aahmed-se", "commitParents": ["412c8fdb5ea61593017c395a7c8e291c922d6bf5"], "nameRev": "8f75f5849ca1ce9ff2bb68662bc2ca64fbffde70 tags/v2.5.0-candidate-1~328", "commitMessage": "skip-all is clear-backlog after topics unification (#5194)\n\nResolves #5060", "commitDateTime": "2019-09-15 13:41:32", "authoredDateTime": "2019-09-15 13:41:32", "commitGitStats": [{"filePath": "site2/docs/reference-pulsar-admin.md", "insertions": 4, "deletions": 4, "lines": 8}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "ProducerStats invalid stat values", "body": "Producer latency stat values are actually in microseconds, but ProducerStats method names state that it should be milliseconds.", "url": "https://github.com/apache/pulsar/issues/5025", "user": "zubchenok", "labels": ["help wanted", "triage/week-34", "type/bug"], "created": "2019-08-23 02:57:03", "closed": "2019-09-05 21:50:33", "commits": {}, "ttf": 13.000277777777777, "commitsDetails": []}, {"title": "[INSTALL FAILURE] pulsar/pulsar-client-cpp/python", "body": "**Describe the bug**\r\npulsar/pulsar-client-cpp/python\r\n\r\n**To Reproduce**\r\n\r\n\r\nI install client-libraries-python from source following [document](http://pulsar.apache.org/docs/en/client-libraries-python/).\r\n\r\nRun... then...failure\r\n\r\n```Bash\r\n$ cd pulsar/pulsar-client-cpp/python\r\n$ sudo python setup.py install\r\n```\r\n```\r\nrunning install\r\nChecking .pth file support in /Library/Python/2.7/site-packages/\r\n/usr/bin/python -E -c pass\r\nTEST PASSED: /Library/Python/2.7/site-packages/ appears to support .pth files\r\nrunning bdist_egg\r\nrunning egg_info\r\ncreating pulsar_client.egg-info\r\nwriting requirements to pulsar_client.egg-info/requires.txt\r\nwriting pulsar_client.egg-info/PKG-INFO\r\nwriting top-level names to pulsar_client.egg-info/top_level.txt\r\nwriting dependency_links to pulsar_client.egg-info/dependency_links.txt\r\nwriting manifest file 'pulsar_client.egg-info/SOURCES.txt'\r\nreading manifest file 'pulsar_client.egg-info/SOURCES.txt'\r\nwriting manifest file 'pulsar_client.egg-info/SOURCES.txt'\r\ninstalling library code to build/bdist.macosx-10.14-intel/egg\r\nrunning install_lib\r\nrunning build_py\r\ncreating build\r\ncreating build/lib.macosx-10.14-intel-2.7\r\ncreating build/lib.macosx-10.14-intel-2.7/pulsar\r\ncopying pulsar/__init__.py -> build/lib.macosx-10.14-intel-2.7/pulsar\r\ncreating build/lib.macosx-10.14-intel-2.7/pulsar/schema\r\ncopying pulsar/schema/__init__.py -> build/lib.macosx-10.14-intel-2.7/pulsar/schema\r\ncopying pulsar/schema/definition.py -> build/lib.macosx-10.14-intel-2.7/pulsar/schema\r\ncopying pulsar/schema/schema.py -> build/lib.macosx-10.14-intel-2.7/pulsar/schema\r\ncreating build/lib.macosx-10.14-intel-2.7/pulsar/functions\r\ncopying pulsar/functions/serde.py -> build/lib.macosx-10.14-intel-2.7/pulsar/functions\r\ncopying pulsar/functions/__init__.py -> build/lib.macosx-10.14-intel-2.7/pulsar/functions\r\ncopying pulsar/functions/context.py -> build/lib.macosx-10.14-intel-2.7/pulsar/functions\r\ncopying pulsar/functions/function.py -> build/lib.macosx-10.14-intel-2.7/pulsar/functions\r\nrunning build_ext\r\nerror: [Errno 2] No such file or directory: '_pulsar.so'\r\n```\r\n**Desktop (please complete the following information):**\r\n - OS: \r\n    - 18.7.0 Darwin Kernel Version 18.7.0\r\n    - Mojave 10.14.6 (18G87)\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/5009", "user": "pierre94", "labels": ["component/client", "component/python", "triage/week-33", "type/bug"], "created": "2019-08-22 06:41:28", "closed": "2020-01-14 17:38:17", "commits": {}, "ttf": 145.00027777777777, "commitsDetails": []}, {"title": "AvroSchema in pulsar function producer doesn't output correct message", "body": "**Describe the bug**\r\nI'm using pulsar4s (pulsar scala client) and `pulsar-client consume` to debug.\r\n\r\nWhen I produce and consume using pulsar4s-avro, I've got the following message using `pulsar-client consume`:\r\n\r\n```\r\n----- got message -----\r\nObjavro.schema\ufffd\r\n               {\"type\":\"record\",\"name\":\"ApplicationLog\",\"namespace\":\"models.logs.application_log_module\",\"fields\":[{\"name\":\"syslog_pri\",\"type\":\"string\"},{\"name\":\"syslog_facility\",\"type\":\"string\"},{\"name\":\"syslog_facility_code\",\"type\":\"int\"},{\"name\":\"syslog_severity_code\",\"type\":\"int\"},{\"name\":\"syslog_severity\",\"type\":\"string\"},{\"name\":\"version\",\"type\":\"string\"},{\"name\":\"host\",\"type\":\"string\"},{\"name\":\"zone\",\"type\":\"string\"},{\"name\":\"tags\",\"type\":{\"type\":\"array\",\"items\":\"string\"}},{\"name\":\"timestamp\",\"type\":\"string\"},{\"name\":\"ownerId\",\"type\":\"string\"},{\"name\":\"data\",\"type\":\"string\"},{\"name\":\"deploymentId\",\"type\":\"string\"},{\"name\":\"program\",\"type\":\"string\"},{\"name\":\"instanceId\",\"type\":\"string\"},{\"name\":\"appId\",\"type\":\"string\"}]}avro.codenull\r\n                                                                                                                                                                                                                                                                                                                                   >:k\ufffd\ufffd\ufffdHRC\ufffd\ufffd30yoyoversiohoszontagtimeowneridatadeployid\r\n                                                                                                                                                                                                                                                                                                                                                                                         prograinstanceid\r\nappId\r\n     >:k\ufffd\ufffd\ufffdHRC\ufffd\r\n```\r\nThis one is well parsed to the wanted type using pulsar4s subscription.\r\n\r\nNow, if I produce using pulsar-function Context like:\r\n\r\n```\r\nReflectData REFLECT = new ReflectData();\r\nSchema schema = REFLECT.getSchema(ApplicationLog.class);\r\nAvroSchema<ApplicationLog> pulsarSchema = AvroSchema.of(SchemaDefinition.<ApplicationLog>builder().withJsonDef(schema.toString()).withAlwaysAllowNull(false).build());\r\n```\r\n\r\nI used this native avro method to ensure that I'm using exactly the same schema that works with pulsar4s produce. So both test have exactly the same `pulsar-admin schemas get` result.\r\n\r\n```\r\ncontext.newOutputMessage(\r\n    topic,\r\n    pulsarSchema\r\n).value(log).sendAsync();\r\n```\r\n\r\nUsing `pulsar-client consume` I've got:\r\n\r\n```\r\n----- got message -----\r\n30\r\n  daemon\r\n        informational1pbinaries-yo-yo.services.yo.copar0tcp\r\n                                                                                     appLogcustomers02019-08-20T14:32:37.058ZRorga_858600a8-74f4-4d75-a8a3-f5b868be093c02019-08-20T14:32:36.690Z^deployment_1760e083-9f7a-433f-bddf-8cac43a4768adeploy-node.shH6607e717-8dad-4551-bdab-d021792715acPapp_3b65d74f-66f2-4218-bc91-6bce8d1e486a\r\n```\r\n\r\nAnd when I subscribe using pulsar4s, I've got `InvalidAvroMagicException: Not an Avro data file` during the avro decode. This is due to the incorrect avro's magic length. **Note that the subscription is done so the schema compatibility is already verified, just the decode fails**.\r\n\r\nI don't know if it's a bug or if I just have a bad usage during pulsar-function producing.", "url": "https://github.com/apache/pulsar/issues/5006", "user": "KannarFr", "labels": ["component/functions", "component/schemaregistry", "triage/week-33", "type/bug"], "created": "2019-08-21 21:08:36", "closed": "2019-08-30 14:53:05", "commits": {}, "ttf": 8.000277777777777, "commitsDetails": []}, {"title": "RedeliverUnacknowledgedMessages by ids returns more messages than requested", "body": "**Describe the bug**\r\nI'm writing a [.net client](https://github.com/fsharplang-ru/pulsar-client-dotnet) and got an issues while implementing _AckTimeout_ logic. When ack is not received [RedeliverUnacknowledgedMessages ](https://github.com/apache/pulsar/blob/master/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java#L1266)function is called. \r\nLet's say 100 messages where produced (without any batching) and 90 messages where acknowledged individually. After _AckTimeout_ I make RedeliverUnacknowledgedMessages call for messages 91-95 and expect only them to be redelivered. But what I see is messages 91-100 get redelived.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nUnfortunately I was unable to run Java source code to confirm this, so [this is](https://github.com/fsharplang-ru/pulsar-client-dotnet/blob/develop/tests/IntegrationTests/Tests.fs#L241-L293) integration test for .NET at least for some reference. It works fine most of the times, because all 10 messages get in one [timePartition ](https://github.com/apache/pulsar/blob/master/pulsar-client/src/main/java/org/apache/pulsar/client/impl/UnAckedMessageTracker.java#L115) but otherwise I see the warning in logs which clearly show that all messages were redelivered, not only requested ones\r\n\r\n**Expected behavior**\r\nOnly requested messages get redelivered\r\n\r\n**Screenshots**\r\nnot applicable\r\n\r\n**Desktop (please complete the following information):**\r\n - Windows 10\r\n - minikube (2 bookees, 2 brokers, 1 proxy) \r\n\r\n**Additional context**\r\nPulsar version 2.4.0 (installed from helm chart)\r\n", "url": "https://github.com/apache/pulsar/issues/5004", "user": "Lanayx", "labels": ["component/client", "triage/week-33", "type/bug"], "created": "2019-08-21 16:22:28", "closed": "2019-08-22 08:14:56", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[BUILD FAILURE] pulsar-broker-auth-athenz of 2.5.0-SNAPSHOT[master], due to wrong maven repository", "body": "**Describe the bug**\r\ndon't have jar in the maven repository: http://repo1.maven.org/maven2/com/yahoo/\r\n\r\nthe building error info below for reference: \r\n\r\n[ERROR] Failed to execute goal on project pulsar-broker-auth-athenz: Could not resolve dependencies for project org.apache.pulsar:pulsar-broker-auth-athenz:jar:2.5.0-SNAPSHOT: Failed to collect dependencies at com.yahoo.athenz:athenz-zpe-java-client:jar:1.8.17: Failed to read artifact descriptor for com.yahoo.athenz:athenz-zpe-java-client:jar:1.8.17: Failure to find com.yahoo.athenz:athenz:pom:1.8.17 in http://repo1.maven.org/maven2/ was cached in the local repository, resolution will not be reattempted until the update interval of Central has elapsed or updates are forced -> [Help 1]\r\n\r\n**To Reproduce**\r\ngit clone latest master code, just build...then...failure\r\n\r\n**Expected behavior**\r\n![image](https://user-images.githubusercontent.com/17067653/63420436-3bfb0f80-c439-11e9-9481-d66ab798ce9e.png)\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/17067653/63420491-5af9a180-c439-11e9-811f-12496375e1a8.png)\r\n\r\n**Additional context**\r\nmay need change to right maven repository\r\n", "url": "https://github.com/apache/pulsar/issues/4998", "user": "frank-dkvan", "labels": ["triage/week-33", "type/bug"], "created": "2019-08-21 09:31:37", "closed": "2019-08-23 05:42:04", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "[Pulsar-IO]Nar package for connector not generated for Flume, Redis, Solr and InfluxDB", "body": "**Describe the bug**\r\nAt this download address http://apache.communilink.net/pulsar/pulsar-2.4.0/connectors/, Nar package of Flume, Redis, Solr, and InfluxDB was not generated.\r\n\r\n**Additional context**\r\nThese connectors were not correctly added to the configuration file.\r\n", "url": "https://github.com/apache/pulsar/issues/4997", "user": "tuteng", "labels": ["type/bug"], "created": "2019-08-21 08:45:55", "closed": "2019-08-21 20:44:13", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[website]Tab page, click no response", "body": "**Describe the bug**\r\n![image](https://user-images.githubusercontent.com/1907867/63401926-b44adc00-c40b-11e9-93e9-86b7e78572ea.png)\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to http://pulsar.apache.org/docs/en/next/concepts-messaging/\r\n2. Click sidebar => Manage schema\r\n3. Open Chrome Developer Tool to View Errors\r\n\r\n**Expected behavior**\r\nClick OK, no error\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4990", "user": "tuteng", "labels": ["component/website", "triage/week-33", "type/bug"], "created": "2019-08-21 04:06:36", "closed": "2019-08-23 16:15:29", "commits": {"c3cb5ebb5b122593d5903923f506738fd6b2cbef": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "c3cb5ebb5b122593d5903923f506738fd6b2cbef", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["40fbf5d625412f7c71feea66000a9d756f81048d"], "nameRev": "c3cb5ebb5b122593d5903923f506738fd6b2cbef tags/v2.5.0-candidate-1~434", "commitMessage": "### Motivation (#4991)\n\nFixes https://github.com/apache/pulsar/issues/4990\r\n\r\nMaster Issue: https://github.com/apache/pulsar/issues/4990\r\n\r\n### Motivation\r\n[pjax-api](https://github.com/falsandtru/pjax-api) conflicts with [scrollSpy](https://github.com/facebook/docusaurus/blob/e486d3d1b0e0a397f242368357fbedbe767104c7/packages/docusaurus-1.x/lib/static/js/scrollSpy.js). Cause that cache headingsCache used by variable findHeadings to not be update correctly.\r\n\r\nModifications\r\n* Delete file pjax-api.min.js\r\n\r\n### Verifying this change\r\n\r\nRun ok locally\r\n\r\n", "commitDateTime": "2019-08-23 09:15:28", "authoredDateTime": "2019-08-24 00:15:28", "commitGitStats": [{"filePath": "site2/website/core/Footer.js", "insertions": 0, "deletions": 16, "lines": 16}, {"filePath": "site2/website/static/js/pjax-api.min.js", "insertions": 0, "deletions": 4, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["c3cb5ebb5b122593d5903923f506738fd6b2cbef"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 0, "deletions": 20, "lines": 20, "gitFilesChange": 2}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["site2/website/static/js/pjax-api.min.js", "site2/website/core/Footer.js"]}, {"title": "AdminMultiHostTest, CLITest, HealthcheckTest and PulsarFunctionsProcessTest failed", "body": "Details:\r\n\r\nhttps://builds.apache.org/job/pulsar_precommit_integrationtests/10076/console\r\n\r\n\r\n```bash\r\n2019-08-20\\T\\09:17:15.789 [ERROR] Failures: \r\n2019-08-20\\T\\09:17:15.789 [ERROR] org.apache.pulsar.tests.integration.cli.AdminMultiHostTest.testAdminMultiHost(org.apache.pulsar.tests.integration.cli.AdminMultiHostTest)\r\n2019-08-20\\T\\09:17:15.789 [INFO]   Run 1: PASS\r\n2019-08-20\\T\\09:17:15.790 [ERROR]   Run 2: AdminMultiHostTest.testAdminMultiHost:69->waitBrokerDown:90 \u00bb Execution org.ap...\r\n2019-08-20\\T\\09:17:15.790 [INFO] \r\n2019-08-20\\T\\09:17:15.790 [ERROR] org.apache.pulsar.tests.integration.cli.CLITest.pulsar-test-suite(org.apache.pulsar.tests.integration.cli.CLITest)\r\n2019-08-20\\T\\09:17:15.790 [INFO]   Run 1: PASS\r\n2019-08-20\\T\\09:17:15.790 [INFO]   Run 2: PASS\r\n2019-08-20\\T\\09:17:15.791 [INFO]   Run 3: PASS\r\n2019-08-20\\T\\09:17:15.791 [INFO]   Run 4: PASS\r\n2019-08-20\\T\\09:17:15.791 [INFO]   Run 5: PASS\r\n2019-08-20\\T\\09:17:15.791 [INFO]   Run 6: PASS\r\n2019-08-20\\T\\09:17:15.791 [INFO]   Run 7: PASS\r\n2019-08-20\\T\\09:17:15.791 [INFO]   Run 8: PASS\r\n2019-08-20\\T\\09:17:15.792 [ERROR]   Run 9: CLITest.testTopicTerminationOnTopicsWithoutConnectedConsumers \u00bb ContainerExec ...\r\n2019-08-20\\T\\09:17:15.792 [INFO] \r\n2019-08-20\\T\\09:17:15.792 [ERROR] org.apache.pulsar.tests.integration.cli.HealthcheckTest.testEverythingOK(org.apache.pulsar.tests.integration.cli.HealthcheckTest)\r\n2019-08-20\\T\\09:17:15.792 [INFO]   Run 1: PASS\r\n2019-08-20\\T\\09:17:15.793 [ERROR]   Run 2: HealthcheckTest.testEverythingOK \u00bb ContainerExec /pulsar/bin/pulsar-admin brok...\r\n2019-08-20\\T\\09:17:15.793 [INFO] \r\n2019-08-20\\T\\09:17:15.793 [ERROR] org.apache.pulsar.tests.integration.functions.PulsarFunctionsProcessTest.pulsar-test-suite(org.apache.pulsar.tests.integration.functions.PulsarFunctionsProcessTest)\r\n2019-08-20\\T\\09:17:15.793 [ERROR]   Run 1: PulsarFunctionsProcessTest>PulsarFunctionsTestBase.setupFunctionWorkers:58 \u00bb ContainerLaunch\r\n```", "url": "https://github.com/apache/pulsar/issues/4984", "user": "fxbing", "labels": ["flaky-tests", "triage/week-33", "type/bug"], "created": "2019-08-20 09:44:30", "closed": "2019-08-27 07:31:59", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "[cgo client] The function Send(ctx, msg) performance is not good", "body": "#### Expected behavior\r\n\r\nI want to send a quantity of messages using [pulsar-client-go](https://github.com/apache/pulsar-client-go) (not cgo), and I hope it can be done in less than 1 second\r\n\r\n#### Actual behavior\r\n\r\nI call Send(ctx,msg) about 2000 times in a loop, it costs me 6 seconds to finish totally.\r\nOne message's capacity is 60 Bytes or so.\r\n\r\n#### Steps to reproduce\r\n\r\n```\r\n       for i:=0; i<2000; i++ {\t\t\r\n                        ..........\r\n\t\tmsg, err := proto.Marshal(&xxx)\r\n\t\tif err != nil {\r\n\t\t\tfmt.Println(err)\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif err := producer.Send(context.Background(), &pulsar.ProducerMessage{Payload: msg}); err != nil {\r\n\t\t\tfmt.Println(err)\r\n\t\t} else {\r\n\t\t\t//fmt.Printf(\"[%d]success\\n\", i)\r\n\t\t}\r\n\t}\r\n```\r\n\r\n#### System configuration\r\nOS: macOS 10.14\r\ndocker in localhost: apachepulsar/pulsar-standalone:2.3.1 bin/pulsar standalone", "url": "https://github.com/apache/pulsar/issues/4983", "user": "banishee", "labels": ["component/client", "component/go", "type/bug"], "created": "2019-08-20 05:56:53", "closed": "2019-08-20 09:16:49", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Pulsar SQL can not query the latest ingested event in a topic , but  Pulsar Consumer/Read always can.   ", "body": "**Describe the bug**\r\nPulsar SQL can not query the latest ingested event in a topic , but  Pulsar Consumer/Read always can.   \r\n\r\nthe testing Pulsar version is 2.4.0\r\n\r\nfrom the two screenshots below, we can see the latest event is always missed in Palsar SQL. but Pulsar reader client can fetch the latest one correctly.\r\n\r\nI am new to Pulsar but very interested in Pulsar. don't know this is a bug, or just a kind interesting feature which needs some hidden config I don't know yet?\r\n\r\n**Screenshots**\r\nthis is the testing code and screenshot of Pulsar Reader:\r\n![image](https://user-images.githubusercontent.com/17067653/63247250-29e16b80-c297-11e9-95be-b5ec5322a36e.png)\r\nthis is the testing query SQL and  screenshot in Pulsar SQL CLI:\r\n![image](https://user-images.githubusercontent.com/17067653/63247438-a116ff80-c297-11e9-8354-534b0fb52ddc.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4976", "user": "frank-dkvan", "labels": ["component/sql", "triage/week-33", "type/bug"], "created": "2019-08-19 07:47:08", "closed": "2020-02-10 00:33:28", "commits": {"4fd17d412c7368f79bf6c82497403e70d17474a6": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "c421d26e4d7a0de96fa186a844fc92991e60165c": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 174.00027777777777, "commitsDetails": [{"commitHash": "4fd17d412c7368f79bf6c82497403e70d17474a6", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["04ed23c019eec7e15dccc780bf6ee8e2e987cb24"], "nameRev": "4fd17d412c7368f79bf6c82497403e70d17474a6 tags/v2.6.0-candidate-1~532", "commitMessage": "Expose bookkeeper expose explicit lac in broker.conf (#5822)\n\n### Motivation\r\n\r\nExpose bookkeeper expose explicit lac configuration in broker.conf\r\nIt's related to #3828 #4976, some Pulsar SQL users need to enable the explicitLacInterval, so that they can get the last message in Pulsar SQL.", "commitDateTime": "2020-02-10 08:31:21", "authoredDateTime": "2020-02-10 08:31:21", "commitGitStats": [{"filePath": "conf/broker.conf", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "conf/standalone.conf", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/BookKeeperClientFactoryImpl.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/PulsarBrokerStarterTest.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/BookKeeperClientFactoryImplTest.java", "insertions": 9, "deletions": 0, "lines": 9}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServiceConfiguration.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.ServiceConfiguration", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BookKeeperClientFactoryImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.BookKeeperClientFactoryImpl.createBkClientConfiguration(org.apache.pulsar.broker.ServiceConfiguration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarBrokerStarterTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.PulsarBrokerStarterTest.createValidBrokerConfigFile()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.PulsarBrokerStarterTest.testLoadConfig()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BookKeeperClientFactoryImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.BookKeeperClientFactoryImplTest.testSetExplicitLacInterval()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "c421d26e4d7a0de96fa186a844fc92991e60165c", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["f95aebb6799bf43731f4e321ec4d9f523a2cd3ba"], "nameRev": "c421d26e4d7a0de96fa186a844fc92991e60165c tags/v2.5.1-candidate-3~124", "commitMessage": "Expose bookkeeper expose explicit lac in broker.conf (#5822)\n\n### Motivation\r\n\r\nExpose bookkeeper expose explicit lac configuration in broker.conf\r\nIt's related to #3828 #4976, some Pulsar SQL users need to enable the explicitLacInterval, so that they can get the last message in Pulsar SQL.\n\n(cherry picked from commit 4fd17d412c7368f79bf6c82497403e70d17474a6)\n", "commitDateTime": "2020-04-13 11:06:28", "authoredDateTime": "2020-02-10 08:31:21", "commitGitStats": [{"filePath": "conf/broker.conf", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "conf/standalone.conf", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/BookKeeperClientFactoryImpl.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/PulsarBrokerStarterTest.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/BookKeeperClientFactoryImplTest.java", "insertions": 9, "deletions": 0, "lines": 9}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServiceConfiguration.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.ServiceConfiguration", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BookKeeperClientFactoryImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.BookKeeperClientFactoryImpl.createBkClientConfiguration(org.apache.pulsar.broker.ServiceConfiguration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarBrokerStarterTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.PulsarBrokerStarterTest.createValidBrokerConfigFile()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.PulsarBrokerStarterTest.testLoadConfig()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BookKeeperClientFactoryImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.BookKeeperClientFactoryImplTest.testSetExplicitLacInterval()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "docker image should have C++ client installed", "body": "**Describe the bug**\r\npulsar standalone v2.4.0 docker image do not have C++ client installed, we have to manually install C++ client from deb package from https://pulsar.apache.org/docs/en/client-libraries-cpp/#deb. The lack of C++ client caused go function cannot be executed. following logs shown that the elf do not have required lib `libpulsar.so.2.4.0`.\r\n\r\n```\r\nldd steady-voltage-handler\r\n\tlinux-vdso.so.1 (0x00007ffe4b5fe000)\r\n\tlibpulsar.so.2.4.0 => not found\r\n\tlibpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f1631147000)\r\n\tlibc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f1630da8000)\r\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f1631364000)\r\n```\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4971", "user": "freeznet", "labels": ["triage/week-33", "type/bug"], "created": "2019-08-16 09:28:50", "closed": "2019-08-21 20:44:48", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "FD leakage found in FunctionActioner.downloadFile", "body": "**Describe the bug**\r\nWhen function package downloaded from bookkeeper, a new `FileOutputStream` passed to `WorkerUtils.downloadFromBookkeeper`, but `WorkerUtils.downloadFromBookkeeper` dosent close `FileOutputStream`, which cause the `FileOutputStream` as a leaked fd.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n- docker standalone pulsar v2.4.0\r\n- use pulsar admin to create a new function with golang\r\n- wait for pulsar finish the command and tries to run the function as a process\r\n- got error `java.io.IOException: Cannot run program \"/tmp/pulsar_functions/transient/stream/steady-voltage-handler/0/steady-voltage-handler\": error=26, Text file busy`\r\n- using `lsof` to check who is using the fd, we can see possible fd leakage shown below.\r\n```\r\nroot@f7e2600f85bc:/tmp/pulsar_functions/transient/stream/steady-voltage-handler/0# lsof ./steady-voltage-handler\r\nCOMMAND PID USER   FD   TYPE DEVICE SIZE/OFF     NODE NAME\r\njava      1 root 1027w   REG   8,18 13332768 32374801 ./steady-voltage-handler\r\nroot@f7e2600f85bc:/tmp/pulsar_functions/transient/stream/steady-voltage-handler/0# lsof -a -p 1 | grep \"(deleted)\"\r\njava      1 root 1027w      REG               8,18  13332768  32374801 /tmp/pulsar_functions/transient/stream/steady-voltage-handler/0/steady-voltage-handler.0.da02f683-854f-4049-9512-da1fa667b2d0 (deleted)\r\njava      1 root 1035w      REG               8,18     13179  32374810 /tmp/pulsar_functions/public/default/wheeltest/0/pulsar_function_test-1.0-py3-none-any.whl.0.6c9273c9-7405-4d0f-a227-7baaf6dc55cb (deleted)\r\njava      1 root 1036w      REG               8,18     13835  32374817 /tmp/pulsar_functions/transient/stream/transientHandler/0/transient_handler-1.0-py3-none-any.whl.0.3ca67b27-0dd3-44bb-97a0-37abc359c789 (deleted)\r\n```\r\n- we use `gdb --pid=1` and `p close(1027)` (1027 was the fd bind to our golang function executable) to test if `Text file busy` was caused by fd leaked, and after we close the fd and quit `gdb`, the function can be execute.\r\n", "url": "https://github.com/apache/pulsar/issues/4969", "user": "freeznet", "labels": ["component/functions", "triage/week-33", "type/bug"], "created": "2019-08-16 09:21:46", "closed": "2019-08-18 12:36:01", "commits": {"2c2150014708e6bd2522ee4525f36195d911acae": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "5a5533fa9990b123d0a1e4a723fd0785229175a1": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "2c2150014708e6bd2522ee4525f36195d911acae", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["93d95c74890b69ef79dce280d4e407f3fc9cdfb8"], "nameRev": "2c2150014708e6bd2522ee4525f36195d911acae tags/v2.5.0-candidate-1~451", "commitMessage": "prevent fd leakage when WorkerUtils.downloadFromBookkeeper (#4970)\n\nFixes #4969\r\n\r\n### Motivation\r\n\r\nclose `FileOutputStream` after `WorkerUtils.downloadFromBookkeeper`", "commitDateTime": "2019-08-18 20:36:00", "authoredDateTime": "2019-08-18 20:36:00", "commitGitStats": [{"filePath": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/FunctionActioner.java", "insertions": 5, "deletions": 1, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "FunctionActioner.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.worker.FunctionActioner.downloadFile(java.io.File,boolean,org.apache.pulsar.functions.proto.Function.FunctionMetaData,int)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "5a5533fa9990b123d0a1e4a723fd0785229175a1", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["daa951e3d93215f72bb7956860da7c53bfd4af2a"], "nameRev": "5a5533fa9990b123d0a1e4a723fd0785229175a1 tags/v2.4.1-candidate-1~14", "commitMessage": "prevent fd leakage when WorkerUtils.downloadFromBookkeeper (#4970)\n\nFixes #4969\n\n### Motivation\n\nclose `FileOutputStream` after `WorkerUtils.downloadFromBookkeeper`\n(cherry picked from commit 2c2150014708e6bd2522ee4525f36195d911acae)\n", "commitDateTime": "2019-08-28 14:37:24", "authoredDateTime": "2019-08-18 20:36:00", "commitGitStats": [{"filePath": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/FunctionActioner.java", "insertions": 5, "deletions": 1, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "FunctionActioner.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.worker.FunctionActioner.downloadFile(java.io.File,boolean,org.apache.pulsar.functions.proto.Function.FunctionMetaData,int)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Static linking for c/c++ libraries broken for osx", "body": "unable to generated statically linked libraries on osx.\r\n```\r\ncmake . -DLINK_STATIC=ON -DBUILD_TESTS=OFF -DPYTHON_LIBRARY=/usr/local/Frameworks/Python.framework/Versions/2.7/lib/libpython2.7.dylib -DPYTHON_INCLUDE_DIR=/usr/local/Frameworks/Python.framework/Versions/2.7/include/python2.7\r\n```\r\n\r\n```\r\n[ 97%] Building CXX object python/CMakeFiles/_pulsar.dir/src/reader.cc.o\r\n[100%] Building CXX object python/CMakeFiles/_pulsar.dir/src/schema.cc.o\r\n[100%] Linking CXX shared library _pulsar.so\r\nUndefined symbols for architecture x86_64:\r\n  \"_BrotliDecoderCreateInstance\", referenced from:\r\n      _brotli_init_writer in libcurl.a(libcurl_la-content_encoding.o)\r\n  \"_BrotliDecoderDecompressStream\", referenced from:\r\n      _brotli_unencode_write in libcurl.a(libcurl_la-content_encoding.o)\r\n  \"_BrotliDecoderDestroyInstance\", referenced from:\r\n      _brotli_unencode_write in libcurl.a(libcurl_la-content_encoding.o)\r\n      _brotli_close_writer in libcurl.a(libcurl_la-content_encoding.o)\r\n  \"_BrotliDecoderGetErrorCode\", referenced from:\r\n      _brotli_unencode_write in libcurl.a(libcurl_la-content_encoding.o)\r\n  \"_BrotliDecoderVersion\", referenced from:\r\n      _curl_version_info in libcurl.a(libcurl_la-version.o)\r\n      _brotli_version in libcurl.a(libcurl_la-version.o)\r\n  \"_RTMP_Alloc\", referenced from:\r\n      _rtmp_setup_connection in libcurl.a(libcurl_la-curl_rtmp.o)\r\n  \"_RTMP_Close\", referenced from:\r\n      _rtmp_disconnect in libcurl.a(libcurl_la-curl_rtmp.o)\r\n  \"_RTMP_Connect1\", referenced from:\r\n      _rtmp_connect in libcurl.a(libcurl_la-curl_rtmp.o)\r\n  \"_RTMP_ConnectStream\", referenced from:\r\n      _rtmp_do in libcurl.a(libcurl_la-curl_rtmp.o)\r\n  \"_RTMP_Free\", referenced from:\r\n      _rtmp_setup_connection in libcurl.a(libcurl_la-curl_rtmp.o)\r\n      _rtmp_disconnect in libcurl.a(libcurl_la-curl_rtmp.o)\r\n  \"_RTMP_Init\", referenced from:\r\n      _rtmp_setup_connection in libcurl.a(libcurl_la-curl_rtmp.o)\r\n  \"_RTMP_Read\", referenced from:\r\n      _rtmp_recv in libcurl.a(libcurl_la-curl_rtmp.o)\r\n  \"_RTMP_SetBufferMS\", referenced from:\r\n      _rtmp_setup_connection in libcurl.a(libcurl_la-curl_rtmp.o)\r\n  \"_RTMP_SetupURL\", referenced from:\r\n      _rtmp_setup_connection in libcurl.a(libcurl_la-curl_rtmp.o)\r\n  \"_RTMP_Write\", referenced from:\r\n      _rtmp_send in libcurl.a(libcurl_la-curl_rtmp.o)\r\n  \"_ber_free\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_idn2_check_version\", referenced from:\r\n      _idnconvert_hostname in libcurl.a(libcurl_la-url.o)\r\n      _curl_version in libcurl.a(libcurl_la-version.o)\r\n      _curl_version_info in libcurl.a(libcurl_la-version.o)\r\n  \"_idn2_free\", referenced from:\r\n      _conn_free in libcurl.a(libcurl_la-url.o)\r\n      _create_conn in libcurl.a(libcurl_la-url.o)\r\n  \"_idn2_lookup_ul\", referenced from:\r\n      _idnconvert_hostname in libcurl.a(libcurl_la-url.o)\r\n  \"_idn2_strerror\", referenced from:\r\n      _idnconvert_hostname in libcurl.a(libcurl_la-url.o)\r\n  \"_ldap_err2string\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_first_attribute\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_first_entry\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_free_urldesc\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_get_dn\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_get_values_len\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_init\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_memfree\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_msgfree\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_next_attribute\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_next_entry\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_search_s\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_set_option\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_simple_bind_s\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_unbind_s\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_url_parse\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_ldap_value_free_len\", referenced from:\r\n      _Curl_ldap in libcurl.a(libcurl_la-ldap.o)\r\n  \"_nghttp2_http2_strerror\", referenced from:\r\n      _http2_handle_stream_close in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_is_fatal\", referenced from:\r\n      _Curl_http2_switched in libcurl.a(libcurl_la-http2.o)\r\n      _http2_recv in libcurl.a(libcurl_la-http2.o)\r\n      _http2_send in libcurl.a(libcurl_la-http2.o)\r\n      _on_frame_recv in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_pack_settings_payload\", referenced from:\r\n      _Curl_http2_request_upgrade in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_priority_spec_init\", referenced from:\r\n      _h2_pri_spec in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_callbacks_del\", referenced from:\r\n      _Curl_http2_setup in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_callbacks_new\", referenced from:\r\n      _Curl_http2_setup in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_callbacks_set_error_callback\", referenced from:\r\n      _Curl_http2_setup in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_callbacks_set_on_begin_headers_callback\", referenced from:\r\n      _Curl_http2_setup in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_callbacks_set_on_data_chunk_recv_callback\", referenced from:\r\n      _Curl_http2_setup in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_callbacks_set_on_frame_recv_callback\", referenced from:\r\n      _Curl_http2_setup in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_callbacks_set_on_header_callback\", referenced from:\r\n      _Curl_http2_setup in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_callbacks_set_on_stream_close_callback\", referenced from:\r\n      _Curl_http2_setup in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_callbacks_set_send_callback\", referenced from:\r\n      _Curl_http2_setup in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_client_new\", referenced from:\r\n      _Curl_http2_setup in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_del\", referenced from:\r\n      _http2_disconnect in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_get_remote_settings\", referenced from:\r\n      _on_frame_recv in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_get_stream_user_data\", referenced from:\r\n      _on_frame_recv in libcurl.a(libcurl_la-http2.o)\r\n      _on_data_chunk_recv in libcurl.a(libcurl_la-http2.o)\r\n      _on_stream_close in libcurl.a(libcurl_la-http2.o)\r\n      _on_begin_headers in libcurl.a(libcurl_la-http2.o)\r\n      _on_header in libcurl.a(libcurl_la-http2.o)\r\n      _data_source_read_callback in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_mem_recv\", referenced from:\r\n      _h2_process_pending_input in libcurl.a(libcurl_la-http2.o)\r\n      _Curl_http2_switched in libcurl.a(libcurl_la-http2.o)\r\n      _http2_recv in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_resume_data\", referenced from:\r\n      _Curl_http2_done_sending in libcurl.a(libcurl_la-http2.o)\r\n      _http2_send in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_send\", referenced from:\r\n      _Curl_http2_done in libcurl.a(libcurl_la-http2.o)\r\n      _http2_send in libcurl.a(libcurl_la-http2.o)\r\n      _h2_session_send in libcurl.a(libcurl_la-http2.o)\r\n      _http2_conncheck in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_set_local_window_size\", referenced from:\r\n      _Curl_http2_switched in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_set_stream_user_data\", referenced from:\r\n      _Curl_http2_done in libcurl.a(libcurl_la-http2.o)\r\n      _Curl_http2_switched in libcurl.a(libcurl_la-http2.o)\r\n      _on_frame_recv in libcurl.a(libcurl_la-http2.o)\r\n      _on_stream_close in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_upgrade\", referenced from:\r\n      _Curl_http2_switched in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_want_read\", referenced from:\r\n      _should_close_session in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_session_want_write\", referenced from:\r\n      _should_close_session in libcurl.a(libcurl_la-http2.o)\r\n      _http2_getsock in libcurl.a(libcurl_la-http2.o)\r\n      _http2_perform_getsock in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_strerror\", referenced from:\r\n      _h2_process_pending_input in libcurl.a(libcurl_la-http2.o)\r\n      _Curl_http2_switched in libcurl.a(libcurl_la-http2.o)\r\n      _http2_recv in libcurl.a(libcurl_la-http2.o)\r\n      _http2_conncheck in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_submit_ping\", referenced from:\r\n      _http2_conncheck in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_submit_priority\", referenced from:\r\n      _h2_session_send in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_submit_request\", referenced from:\r\n      _http2_send in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_submit_rst_stream\", referenced from:\r\n      _Curl_http2_done in libcurl.a(libcurl_la-http2.o)\r\n      _on_frame_recv in libcurl.a(libcurl_la-http2.o)\r\n      _on_header in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_submit_settings\", referenced from:\r\n      _Curl_http2_switched in libcurl.a(libcurl_la-http2.o)\r\n  \"_nghttp2_version\", referenced from:\r\n      _Curl_http2_ver in libcurl.a(libcurl_la-http2.o)\r\nld: symbol(s) not found for architecture x86_64\r\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\r\nmake[3]: *** [python/_pulsar.so] Error 1\r\nmake[2]: *** [python/CMakeFiles/_pulsar.dir/all] Error 2\r\nmake[1]: *** [python/CMakeFiles/_pulsar.dir/rule] Error 2\r\nmake: *** [_pulsar] Error 2\r\n```", "url": "https://github.com/apache/pulsar/issues/4967", "user": "aahmed-se", "labels": ["component/c++", "triage/week-33", "type/bug"], "created": "2019-08-16 02:54:11", "closed": "2019-10-30 21:49:27", "commits": {}, "ttf": 75.00027777777778, "commitsDetails": []}, {"title": "docker image needs to install 'less'", "body": "I'm getting this message when running `pulsar sql`\r\n\r\n```\r\npresto> show schemas in pulsar;\r\nERROR: failed to open pager: Cannot run program \"less\": error=2, No such file or directory\r\n```\r\n\r\nI was able to temporarily resolve this by running `apt-get update && apt-get install -y less`", "url": "https://github.com/apache/pulsar/issues/4957", "user": "mingfang", "labels": ["component/build", "triage/week-33", "type/bug"], "created": "2019-08-15 07:55:19", "closed": "2019-08-25 22:10:02", "commits": {"dd5b4d08ead655dd4917944779bff1702f48f52c": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "fac28efb6f7d80b49308658126224600e6b84cb0": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 10.000277777777777, "commitsDetails": [{"commitHash": "dd5b4d08ead655dd4917944779bff1702f48f52c", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["d3f30fcf242df3088700ff4ef25c3557933c9a55"], "nameRev": "dd5b4d08ead655dd4917944779bff1702f48f52c tags/v2.5.0-candidate-1~431", "commitMessage": "[docker]Fix the problem of missing dependencies less (#5034)\n\nFixes https://github.com/apache/pulsar/issues/4957\r\n\r\nMaster Issue: https://github.com/apache/pulsar/issues/4957\r\n\r\n### Motivation\r\n\r\nCurrently, when packaging the docker image, the dependency less is lost, resulting in the following exception being thrown when presto SQL is running\r\n```\r\nCannot run program \"less\": error=2, No such file or directory\r\n```\r\n\r\n### Modifications\r\n\r\n* Add dependency less\r\n\r\n", "commitDateTime": "2019-08-25 15:10:01", "authoredDateTime": "2019-08-26 06:10:01", "commitGitStats": [{"filePath": "docker/pulsar/Dockerfile", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "fac28efb6f7d80b49308658126224600e6b84cb0", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["dbab57e453e000fd84f367ea6336cca8704b895e"], "nameRev": "fac28efb6f7d80b49308658126224600e6b84cb0 tags/v2.4.1-candidate-1~6", "commitMessage": "[docker]Fix the problem of missing dependencies less (#5034)\n\nFixes https://github.com/apache/pulsar/issues/4957\n\nMaster Issue: https://github.com/apache/pulsar/issues/4957\n\n### Motivation\n\nCurrently, when packaging the docker image, the dependency less is lost, resulting in the following exception being thrown when presto SQL is running\n```\nCannot run program \"less\": error=2, No such file or directory\n```\n\n### Modifications\n\n* Add dependency less\n\n(cherry picked from commit dd5b4d08ead655dd4917944779bff1702f48f52c)\n", "commitDateTime": "2019-08-28 14:46:31", "authoredDateTime": "2019-08-26 06:10:01", "commitGitStats": [{"filePath": "docker/pulsar/Dockerfile", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["dd5b4d08ead655dd4917944779bff1702f48f52c"], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 1, "deletions": 1, "lines": 2, "gitFilesChange": 1}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["docker/pulsar/Dockerfile"]}, {"title": " pulsar-admin functions querystate => Reason: java.lang.NullPointerException: path is 'null'.", "body": "**Describe the bug**\r\n```\r\n$ pulsar-admin functions status --fqfn public/default/yoshi\r\n{\r\n  \"numInstances\" : 1,\r\n  \"numRunning\" : 1,\r\n  \"instances\" : [ {\r\n    \"instanceId\" : 0,\r\n    \"status\" : {\r\n      \"running\" : true,\r\n      \"error\" : \"\",\r\n      \"numRestarts\" : 0,\r\n      \"numReceived\" : 0,\r\n      \"numSuccessfullyProcessed\" : 0,\r\n      \"numUserExceptions\" : 0,\r\n      \"latestUserExceptions\" : [ ],\r\n      \"numSystemExceptions\" : 0,\r\n      \"latestSystemExceptions\" : [ ],\r\n      \"averageLatency\" : 0.0,\r\n      \"lastInvocationTime\" : 0,\r\n      \"workerId\" : \"c-standalone-fw-30729612b9b2-8080\"\r\n    }\r\n  } ]\r\n}\r\n\r\n$ pulsar-admin functions querystate --fqfn public/default/yoshi\r\nnull\r\n\r\nReason: java.lang.NullPointerException: path is 'null'.\r\n```\r\n- docker apachepulsar/pulsar:2.4.0\r\n - OS: mac\r\n", "url": "https://github.com/apache/pulsar/issues/4943", "user": "pouledodue", "labels": ["component/admin", "help wanted", "triage/week-33", "type/bug"], "created": "2019-08-13 02:54:29", "closed": "2019-09-08 19:04:40", "commits": {}, "ttf": 26.00027777777778, "commitsDetails": []}, {"title": "Unable to delete topic when both consumer (subscription) and reader has been connected", "body": "**Describe the bug**\r\nAfter connecting and closing one subscription and one reader it's not possible to delete a topic through the java admin client. The bug will not manifest if either only subscriptions or only readers are connected, only if a combination of them are.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Start a local standalone pulsar and make sure the admin and broker ports in the test code below match\r\n1. Run the following java code to reproduce the error:\r\n```java\r\npackage sample;\r\n\r\nimport org.apache.pulsar.client.admin.PulsarAdmin;\r\nimport org.apache.pulsar.client.admin.PulsarAdminException;\r\nimport org.apache.pulsar.client.api.Consumer;\r\nimport org.apache.pulsar.client.api.MessageId;\r\nimport org.apache.pulsar.client.api.PulsarClient;\r\nimport org.apache.pulsar.client.api.Reader;\r\nimport org.apache.pulsar.client.api.SubscriptionInitialPosition;\r\nimport org.apache.pulsar.client.api.SubscriptionType;\r\nimport org.apache.pulsar.client.impl.auth.AuthenticationDisabled;\r\nimport org.apache.pulsar.common.policies.data.TenantInfo;\r\nimport org.testng.annotations.Test;\r\n\r\nimport java.util.Collections;\r\nimport java.util.LinkedHashSet;\r\nimport java.util.List;\r\nimport java.util.Set;\r\nimport java.util.concurrent.TimeUnit;\r\n\r\npublic class ConsumerAndReaderCombinationTest {\r\n\r\n    void deleteTenantIfPresent(PulsarAdmin admin, String tenant) throws PulsarAdminException {\r\n        if (admin.tenants().getTenants().contains(tenant)) {\r\n            for (String namespace : admin.namespaces().getNamespaces(tenant)) {\r\n                List<String> existingTopics = admin.namespaces().getTopics(namespace);\r\n                for (String topic : existingTopics) {\r\n                    admin.topics().delete(topic);\r\n                }\r\n                admin.namespaces().deleteNamespace(namespace);\r\n            }\r\n            admin.tenants().deleteTenant(tenant);\r\n        }\r\n    }\r\n\r\n    @Test\r\n    public void provokeBug() throws Exception {\r\n        final String adminUrl = \"http://localhost:8080\";\r\n        final String brokerUrl = \"pulsar://localhost:6650\";\r\n\r\n        final String tenant = \"delete-topic-test-magic48295\";\r\n        final String namespace = \"ns\";\r\n        final String topic = \"the-topic\";\r\n        final String qualifiedTopic = \"persistent://\" + tenant + \"/\" + namespace + \"/\" + topic;\r\n\r\n        /*\r\n         * Ensure a clean tenant\r\n         */\r\n        try (PulsarAdmin admin = PulsarAdmin.builder().serviceHttpUrl(adminUrl).authentication(new AuthenticationDisabled()).build()) {\r\n            deleteTenantIfPresent(admin, tenant);\r\n            Set<String> allowedClusters = new LinkedHashSet<>();\r\n            allowedClusters.add(\"standalone\");\r\n            admin.tenants().createTenant(tenant, new TenantInfo(Collections.emptySet(), allowedClusters));\r\n            admin.namespaces().createNamespace(tenant + \"/\" + namespace);\r\n        }\r\n\r\n        /*\r\n         * Open and close both a consumer on a subscription and a reader on the same topic\r\n         */\r\n        try (PulsarClient client = PulsarClient.builder().serviceUrl(brokerUrl).build()) {\r\n            try (Consumer<byte[]> consumer = client.newConsumer()\r\n                    .topic(qualifiedTopic)\r\n                    .subscriptionType(SubscriptionType.Exclusive)\r\n                    .consumerName(\"testng\")\r\n                    .subscriptionName(\"s1\")\r\n                    .subscriptionInitialPosition(SubscriptionInitialPosition.Earliest)\r\n                    .subscribe()) {\r\n                // no need to do anything with the consumer, just close it again\r\n            }\r\n            try (Reader<byte[]> reader = client.newReader().topic(qualifiedTopic).startMessageId(MessageId.earliest).create()) {\r\n                // no need to do anything with the reader, just close it again\r\n            }\r\n        }\r\n\r\n        try (PulsarAdmin admin = PulsarAdmin.builder()\r\n                .serviceHttpUrl(adminUrl)\r\n                .readTimeout(3, TimeUnit.SECONDS)\r\n                .authentication(new AuthenticationDisabled())\r\n                .build()) {\r\n\r\n            /*\r\n             * When bug is present, this call will throw a TimeoutException (read-timeout) after 3 seconds\r\n             */\r\n            admin.topics().delete(qualifiedTopic);\r\n        }\r\n    }\r\n}\r\n```\r\n1. Observe lines similiar to the following in the broker log.\r\n```\r\n16:48:45.579 [pulsar-web-57-3] INFO  org.apache.pulsar.broker.service.persistent.PersistentSubscription - [persistent://delete-topic-test-magic48295/ns/the-topic][s1] Unsubscribing\r\n16:48:45.579 [pulsar-web-57-3] INFO  org.apache.pulsar.broker.service.persistent.PersistentSubscription - [persistent://delete-topic-test-magic48295/ns/the-topic][s1] Successfully closed subscription [ManagedCursorImpl{ledger=delete-topic-test-magic48295/ns/persistent/the-topic, name=s1, ackPos=10:-1, readPos=10:0}]\r\n16:48:45.583 [pulsar-web-57-3] INFO  org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper - [delete-topic-test-magic48295/ns/persistent/the-topic] Remove consumer=s1\r\n16:48:45.592 [ProcessThread(sid:0 cport:2181):] INFO  org.apache.zookeeper.server.PrepRequestProcessor - Got user-level KeeperException when processing sessionid:0x10000f989b00009 type:delete cxid:0xe3 zxid:0xba txntype:-1 reqpath:n/a Error Path:/ledgers/00/0000 Error:KeeperErrorCode = Directory not empty for /ledgers/00/0000\r\n16:48:45.591 [bookkeeper-ml-workers-OrderedExecutor-2-0] ERROR org.apache.bookkeeper.common.util.SafeRunnable - Unexpected throwable caught \r\njava.lang.IllegalArgumentException: inconsistent range\r\n\tat java.util.concurrent.ConcurrentSkipListMap$SubMap.<init>(ConcurrentSkipListMap.java:2620) ~[?:1.8.0_212]\r\n\tat java.util.concurrent.ConcurrentSkipListMap.subMap(ConcurrentSkipListMap.java:2078) ~[?:1.8.0_212]\r\n\tat org.apache.bookkeeper.mledger.util.RangeCache.removeRange(RangeCache.java:132) ~[org.apache.pulsar-managed-ledger-original-2.4.0.jar:2.4.0]\r\n\tat org.apache.bookkeeper.mledger.impl.EntryCacheImpl.invalidateEntries(EntryCacheImpl.java:151) ~[org.apache.pulsar-managed-ledger-original-2.4.0.jar:2.4.0]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl$7.operationComplete(ManagedLedgerImpl.java:776) ~[org.apache.pulsar-managed-ledger-original-2.4.0.jar:2.4.0]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl$7.operationComplete(ManagedLedgerImpl.java:764) ~[org.apache.pulsar-managed-ledger-original-2.4.0.jar:2.4.0]\r\n\tat org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper.lambda$null$13(MetaStoreImplZookeeper.java:308) ~[org.apache.pulsar-managed-ledger-original-2.4.0.jar:2.4.0]\r\n\tat org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:32) ~[org.apache.pulsar-managed-ledger-original-2.4.0.jar:2.4.0]\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n16:48:45.610 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [delete-topic-test-magic48295/ns/persistent/the-topic][s1] Deleted cursor ledger 11\r\n16:48:47.557 [pulsar-web-57-11] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.2 - - [12/Aug/2019:16:48:47 +0000] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 813 \"-\" \"Pulsar-Java-v2.4.0\" 5\r\n```\r\n**Expected behavior**\r\nit's always expected to be possible to delete a topic that has no connected clients.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: macOS\r\n", "url": "https://github.com/apache/pulsar/issues/4941", "user": "kimcs", "labels": ["component/client", "triage/week-33", "type/bug"], "created": "2019-08-12 17:02:16", "closed": "2019-11-20 21:42:49", "commits": {}, "ttf": 100.00027777777778, "commitsDetails": []}, {"title": "Retrieve schema instance from schema info for type 'NONE' ", "body": "```\r\npulsar-admin functions trigger --fqfn test/app/func1 --trigger-value yoshi\r\n\r\njava.util.concurrent.ExecutionException: java.lang.IllegalArgumentException:\r\n Retrieve schema instance from schema info for type 'NONE' is not supported yet\r\n\r\nReason: HTTP 500 Internal Server Error\r\n```\r\n\r\nWhat am I doing wrong?", "url": "https://github.com/apache/pulsar/issues/4937", "user": "pouledodue", "labels": ["component/functions", "component/schemaregistry", "triage/week-33", "type/bug"], "created": "2019-08-12 06:49:26", "closed": "2019-11-21 01:26:23", "commits": {}, "ttf": 100.00027777777778, "commitsDetails": []}, {"title": "Backlog size calculation errors can result in unlimited messages being produced ", "body": "**Describe the bug**\r\nBacklogs are sets of unacknowledged messages for a topic that have been stored by bookies even if not consumed. But in fact, if the topic has not been consumed, you can produce unlimited messages.\r\nhttps://github.com/apache/pulsar/blob/be7b24f9f8aa67b2235e523485249aef8d2a611a/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java#L921-L926\r\n\r\n\r\n**To Reproduce**\r\nSet a limited BaclogQuotaSize to produce unlimited messages without consuming.\r\n\r\n**Expected behavior**\r\nLimited production message\r\n", "url": "https://github.com/apache/pulsar/issues/4933", "user": "fxbing", "labels": ["type/bug"], "created": "2019-08-12 03:31:17", "closed": "2019-08-12 07:52:34", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "`/metrics` endpoint in proxy is behind authentication ", "body": "**Describe the bug**\r\nIn 2.4.0, the `/metrics` endpoint in the proxy service requires authentication when the authentication is enabled. This is different from the broker, where `/metrics` can be fetched even if authentication is enabled.\r\n\r\nThis isn't clear if this is intentional or not, with @sijie of the opinion that it likely wasn't intended.\r\n\r\nThere may be some reasons to want to authenticate that endpoint, particularly if running pulsar over the open internet, but it would seem like it should be controlled via configuration with it optionally be unauthenticated like the broker is.\r\n\r\n**To Reproduce**\r\n1. Enable the proxy with token authentication\r\n2. `HTTP GET /metrics`\r\n3. See you get an unauthorized response\r\n\r\n**Expected behavior**\r\nI should be able to have no authentication or optionally disable authentication for the `/metrics` endpoint.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4920", "user": "addisonj", "labels": ["type/bug"], "created": "2019-08-08 17:22:57", "closed": "2019-08-12 02:01:54", "commits": {"be7b24f9f8aa67b2235e523485249aef8d2a611a": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "3bf901bf5bd351cfafcd8f09bf619aefb51798b8": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "be7b24f9f8aa67b2235e523485249aef8d2a611a", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["02f9fd3e055f404501e41413ec1081331ff945c3"], "nameRev": "be7b24f9f8aa67b2235e523485249aef8d2a611a tags/v2.5.0-candidate-1~462", "commitMessage": "Add option to disable authentication for proxy /metrics (#4921)\n\nThis commit adds a new option optionally disable authentication for the\r\n`/metrics` endpoint in the pulsar-proxy.\r\n\r\nCurrently, authentication is required for the metrics endpoint when\r\nauthentication is enabled, which makes monitoring more difficult.\r\nHowever, rather than just disable it completely and allow for metrics to\r\nbe exposed to any unknown user, this makes it opt in.\r\n\r\nIt could be argued that it should default to false, but as it is likely\r\nthat the proxy is the only component potentially exposed to the public internet, we\r\ndefault to not exposing data.\r\n\r\nFixes #4920", "commitDateTime": "2019-08-12 10:01:53", "authoredDateTime": "2019-08-11 20:01:53", "commitGitStats": [{"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyConfiguration.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyServiceStarter.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/WebServer.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "site2/docs/reference-configuration.md", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ProxyConfiguration.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyConfiguration", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProxyServiceStarter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyServiceStarter.addWebServerHandlers(org.apache.pulsar.proxy.server.WebServer,org.apache.pulsar.proxy.server.ProxyConfiguration,org.apache.pulsar.proxy.server.BrokerDiscoveryProvider)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "WebServer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.WebServer.addServlet(java.lang.String,org.eclipse.jetty.servlet.ServletHolder,java.util.List)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.WebServer.addServlet(java.lang.String,org.eclipse.jetty.servlet.ServletHolder,java.util.List,boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "3bf901bf5bd351cfafcd8f09bf619aefb51798b8", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["036be6f78dd5f05e13320491792d1cc8583d45fd"], "nameRev": "3bf901bf5bd351cfafcd8f09bf619aefb51798b8 tags/v2.4.1-candidate-1~17", "commitMessage": "Add option to disable authentication for proxy /metrics (#4921)\n\nThis commit adds a new option optionally disable authentication for the\n`/metrics` endpoint in the pulsar-proxy.\n\nCurrently, authentication is required for the metrics endpoint when\nauthentication is enabled, which makes monitoring more difficult.\nHowever, rather than just disable it completely and allow for metrics to\nbe exposed to any unknown user, this makes it opt in.\n\nIt could be argued that it should default to false, but as it is likely\nthat the proxy is the only component potentially exposed to the public internet, we\ndefault to not exposing data.\n\nFixes #4920\n(cherry picked from commit be7b24f9f8aa67b2235e523485249aef8d2a611a)\n", "commitDateTime": "2019-08-28 14:28:06", "authoredDateTime": "2019-08-11 20:01:53", "commitGitStats": [{"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyConfiguration.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyServiceStarter.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/WebServer.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "site2/docs/reference-configuration.md", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ProxyConfiguration.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyConfiguration", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProxyServiceStarter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyServiceStarter.addWebServerHandlers(org.apache.pulsar.proxy.server.WebServer,org.apache.pulsar.proxy.server.ProxyConfiguration,org.apache.pulsar.proxy.server.BrokerDiscoveryProvider)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "WebServer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.WebServer.addServlet(java.lang.String,org.eclipse.jetty.servlet.ServletHolder,java.util.List)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.WebServer.addServlet(java.lang.String,org.eclipse.jetty.servlet.ServletHolder,java.util.List,boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[dashboard] peek parse response raise exception", "body": "**Describe the bug**\r\ndashboard peek message api parse response raise exception cause treat all message as a json string\r\n\r\n**To Reproduce**\r\nproduce a literal string like `something` to a topic and peek it on dashboard, which would raise a `ValueError: substring not found`.\r\n\r\n**Expected behavior**\r\nRIGHT response\r\n", "url": "https://github.com/apache/pulsar/issues/4917", "user": "yittg", "labels": ["type/bug"], "created": "2019-08-08 15:32:40", "closed": "2019-08-14 01:25:50", "commits": {"a8b57c97c058862bce1c5b9d3435768d2071f09b": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "a8b57c97c058862bce1c5b9d3435768d2071f09b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["be7b24f9f8aa67b2235e523485249aef8d2a611a"], "nameRev": "a8b57c97c058862bce1c5b9d3435768d2071f09b tags/v2.5.0-candidate-1~461", "commitMessage": "[dashboard] fix peek parse message error (#4918)\n\nFixes #4917 \r\n\r\n### Motivation\r\n\r\ndashboard peek message api raise exception when format response cause treat all message as a JSON string\r\n\r\n### Modifications\r\n\r\n* format as JSON only if message is a JSON, \r\n* otherwise if message is printable, return the original message,\r\n* otherwise print hex like command with --hex option.", "commitDateTime": "2019-08-14 09:25:50", "authoredDateTime": "2019-08-14 09:25:50", "commitGitStats": [{"filePath": "dashboard/Dockerfile", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "dashboard/django/stats/templates/stats/peek.html", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "dashboard/django/stats/views.py", "insertions": 44, "deletions": 3, "lines": 47}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "The requested URL /api/admin/org/apache/pulsar/client/admin/ClientConfiguration was not found on this server.", "body": "1. Go to 'http://pulsar.apache.org/docs/en/admin-api-overview'\r\n2. Scroll down to 'Java admin client' and click ClientConfiguration link\r\n3. 404 not found error is displayed \"The requested URL /api/admin/org/apache/pulsar/client/admin/ClientConfiguration was not found on this server.\"\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4914", "user": "huangdx0726", "labels": ["help wanted", "type/bug"], "created": "2019-08-08 08:29:59", "closed": "2019-08-10 09:13:10", "commits": {"2ea530e73835c789acf57663b465fe94a6007534": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "2ea530e73835c789acf57663b465fe94a6007534", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["1ad632d691959f2d657bac8303edd500e8e75703"], "nameRev": "2ea530e73835c789acf57663b465fe94a6007534 tags/v2.5.0-candidate-1~469", "commitMessage": "Update admin-api-overview.md (#4922)\n\nFixes #4914\r\n\r\n### Motivation\r\n   1.Go to 'http://pulsar.apache.org/docs/en/admin-api-overview'\r\n   2.Scroll down to 'Java admin client' and click ClientConfiguration link\r\n   3.404 not found error is displayed \"The requested URL /api/admin/org/apache/pulsar/client/admin/ClientConfiguration was not found on this server.\"\r\n   4.the examples can't work.\r\n\r\n### Modifications\r\n1.The link to ClientConfiguration  changed to PulsarAdminBuilder.\r\n2.The example changed to \r\n```\r\nString url = \"http://localhost:8080\";\r\n// Pass auth-plugin class fully-qualified name if Pulsar-security enabled\r\nString authPluginClassName = \"com.org.MyAuthPluginClass\";\r\n// Pass auth-param if auth-plugin class requires it\r\nString authParams = \"param1=value1\";\r\nboolean useTls = false;\r\nboolean tlsAllowInsecureConnection = false;\r\nString tlsTrustCertsFilePath = null;\r\nPulsarAdmin admin = PulsarAdmin.builder()\r\n.authentication(authPluginClassName,authParams)\r\n.serviceHttpUrl(url)\r\n.tlsTrustCertsFilePath(tlsTrustCertsFilePath)\r\n.allowTlsInsecureConnection(tlsAllowInsecureConnection)\r\n.build();\r\n```", "commitDateTime": "2019-08-10 17:13:09", "authoredDateTime": "2019-08-10 17:13:09", "commitGitStats": [{"filePath": "site2/docs/admin-api-overview.md", "insertions": 18, "deletions": 22, "lines": 40}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[dashboard doc]seems likely to mislead user no ready docker image", "body": "**Describe the bug**\r\nAbout the dashboard document, it seems likely to mislead user there is no ready docker image and do build one from scratch.\r\n\r\n>To generate the Docker image:\r\n>```shell\r\n>$ docker build -t apachepulsar/pulsar-dashboard dashboard\r\n>```", "url": "https://github.com/apache/pulsar/issues/4913", "user": "yittg", "labels": ["type/bug"], "created": "2019-08-08 06:58:43", "closed": "2019-08-10 02:08:20", "commits": {"18d21acd6885db53417cbad6a18a93082da59cb2": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "18d21acd6885db53417cbad6a18a93082da59cb2", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["5adc522e992d64ff564a187a4d08a5a408bed8de"], "nameRev": "18d21acd6885db53417cbad6a18a93082da59cb2 tags/v2.5.0-candidate-1~471", "commitMessage": "[doc] dashboard docker relative clarity (#4915)\n\nFixes #4913 \r\n\r\n### Motivation\r\n\r\nThe original document may mislead users into thinking that there is no any ready-made docker image and building one from scratch.", "commitDateTime": "2019-08-10 10:08:19", "authoredDateTime": "2019-08-10 10:08:19", "commitGitStats": [{"filePath": "site2/docs/administration-dashboard.md", "insertions": 8, "deletions": 9, "lines": 17}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Java client Reader readNext and hasMessageAvailable not working when attempting to find last message in topic", "body": "**Describe the bug**\r\nTest3: When configuring Reader with startMessageIdInclusive and positioning stream at MessageId.latest, then the next call to Reader.readNext(timeout) should have returned the last message of the topic, but it times out and returns null (without a configured timeout it blocks forever).\r\nTest4: When configuring Reader without startMessageIdInclusive and positioning stream at MessageId.latest, then the next call to Reader.hasMessageAvailable should have returned false, but it returns true. Reader.readNext(timeout) however cannot find a message (as expected but inconsistent with the hasMessageAvailable result).\r\n\r\n**To Reproduce**\r\n1. Start a local standalone pulsar and make sure the broker port in the test code below match\r\n1. Run the following java code to reproduce bug:\r\n```java\r\npackage sample;\r\n\r\nimport org.apache.pulsar.client.admin.PulsarAdmin;\r\nimport org.apache.pulsar.client.admin.PulsarAdminException;\r\nimport org.apache.pulsar.client.api.Message;\r\nimport org.apache.pulsar.client.api.MessageId;\r\nimport org.apache.pulsar.client.api.Producer;\r\nimport org.apache.pulsar.client.api.PulsarClient;\r\nimport org.apache.pulsar.client.api.PulsarClientException;\r\nimport org.apache.pulsar.client.api.Reader;\r\nimport org.apache.pulsar.client.api.ReaderBuilder;\r\nimport org.apache.pulsar.client.impl.auth.AuthenticationDisabled;\r\nimport org.apache.pulsar.client.impl.conf.ClientConfigurationData;\r\nimport org.apache.pulsar.client.impl.schema.JSONSchema;\r\nimport org.testng.annotations.Test;\r\n\r\nimport java.io.IOException;\r\nimport java.util.List;\r\nimport java.util.concurrent.TimeUnit;\r\n\r\nimport static org.testng.Assert.assertEquals;\r\n\r\npublic class MessageIdInclusiveTest {\r\n\r\n    static final String topic = \"public/default/test-start-message-id-inclusive-magic-m6km32j\";\r\n\r\n    void deleteTopic(String topic) throws PulsarClientException {\r\n        ClientConfigurationData config = new ClientConfigurationData();\r\n        config.setAuthentication(new AuthenticationDisabled());\r\n        config.setServiceUrl(\"http://localhost:8080\");\r\n        try (PulsarAdmin admin = new PulsarAdmin(\"http://localhost:8080\", config)) {\r\n            List<String> topics = admin.namespaces().getTopics(\"public/default\");\r\n            if (topics.contains(topic)) {\r\n                admin.topics().delete(topic);\r\n            }\r\n        } catch (PulsarAdminException e) {\r\n            throw new RuntimeException(e);\r\n        }\r\n    }\r\n\r\n    Reader<byte[]> newReader(PulsarClient client, boolean startMessageIdInclusive, MessageId startMessageId) throws PulsarClientException {\r\n        ReaderBuilder<byte[]> builder = client.newReader(JSONSchema.of(byte[].class)).topic(MessageIdInclusiveTest.topic).startMessageId(startMessageId);\r\n        if (startMessageIdInclusive) {\r\n            builder.startMessageIdInclusive();\r\n        }\r\n        return builder.create();\r\n    }\r\n\r\n    int readMessage(PulsarClient client, int timeoutInSeconds, boolean startMessageIdInclusive, MessageId startMessageId) {\r\n        try (Reader<byte[]> reader = newReader(client, startMessageIdInclusive, startMessageId)) {\r\n\r\n            if (reader.hasMessageAvailable() == false) {\r\n                return -1;\r\n            }\r\n\r\n            Message<byte[]> message = reader.readNext(timeoutInSeconds, TimeUnit.SECONDS);\r\n            if (message == null) {\r\n                System.out.println(\"ERROR! hasMessageAvailable returned true, but no message was read after \" + timeoutInSeconds + \" seconds\");\r\n                return -2;\r\n            }\r\n\r\n            return message.getValue()[0];\r\n        } catch (IOException e) {\r\n            throw new RuntimeException(e);\r\n        }\r\n    }\r\n\r\n    void produceMessages(PulsarClient client, int n) throws PulsarClientException {\r\n        try (Producer<byte[]> producer = client.newProducer(JSONSchema.of(byte[].class)).topic(topic).create()) {\r\n            for (int i = 0; i < n; i++) {\r\n                producer.send(new byte[]{(byte) (1 + i)});\r\n            }\r\n        }\r\n    }\r\n\r\n    @Test\r\n    public void test1() throws PulsarClientException {\r\n        deleteTopic(topic);\r\n\r\n        try (PulsarClient client = PulsarClient.builder().serviceUrl(\"pulsar://localhost:6650\").build()) {\r\n            produceMessages(client, 3);\r\n\r\n            // expect to find the very first message on the topic, which has a value of 1\r\n            assertEquals(readMessage(client, 5, true, MessageId.earliest), 1);\r\n        }\r\n    }\r\n\r\n    @Test\r\n    public void test2() throws PulsarClientException {\r\n        deleteTopic(topic);\r\n\r\n        try (PulsarClient client = PulsarClient.builder().serviceUrl(\"pulsar://localhost:6650\").build()) {\r\n            produceMessages(client, 3);\r\n\r\n            // expect to find the very first message on the topic, which has a value of 1\r\n            assertEquals(readMessage(client, 5, false, MessageId.earliest), 1);\r\n        }\r\n    }\r\n\r\n    @Test\r\n    public void test3() throws PulsarClientException {\r\n        deleteTopic(topic);\r\n\r\n        try (PulsarClient client = PulsarClient.builder().serviceUrl(\"pulsar://localhost:6650\").build()) {\r\n            produceMessages(client, 3);\r\n\r\n            // expect to find the very last message on the topic, which has a value of 3\r\n            assertEquals(readMessage(client, 5, true, MessageId.latest), 3);\r\n        }\r\n    }\r\n\r\n    @Test\r\n    public void test4() throws PulsarClientException {\r\n        deleteTopic(topic);\r\n\r\n        try (PulsarClient client = PulsarClient.builder().serviceUrl(\"pulsar://localhost:6650\").build()) {\r\n            produceMessages(client, 3);\r\n\r\n            // expect to not find any message, which is signified by a value of -1\r\n            assertEquals(readMessage(client, 5, false, MessageId.latest), -1);\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n**Expected behavior**\r\ntest3 expected to return the last message in topic, test4 hasMessageAvailable expected to be false.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: macOS Mojave 10.14.6\r\n\r\n**Additional context**\r\nThe bug was found when trying to use the Reader interface to read the last message in the topic. It could be that the bug is also present if attempting to find a specific message in the middle of the topic.\r\n", "url": "https://github.com/apache/pulsar/issues/4912", "user": "kimcs", "labels": ["component/client", "triage/week-33", "type/bug"], "created": "2019-08-08 06:13:41", "closed": "2019-11-19 05:08:17", "commits": {"bfcfdf6357addf8dbdccb96c158bf4a8d516c9b4": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 102.00027777777778, "commitsDetails": [{"commitHash": "bfcfdf6357addf8dbdccb96c158bf4a8d516c9b4", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["568df47f6ef603a292f48d0a3bda8a1cea185981"], "nameRev": "bfcfdf6357addf8dbdccb96c158bf4a8d516c9b4 tags/v2.5.0-candidate-1~76", "commitMessage": "`hasMessageAvailable` should return false when Reader read from latest messages (#5023)\n\nFixes #4912\r\n\r\n*Motivation*\r\n\r\nWhen the reader read from the latest message, `hasMessageAvailable` will timeout or hang on.\r\n\r\n*Modifications*\r\n\r\nMake `lastDequeuedMessage` start position should keep with `startMessageId`.\r\n\r\n", "commitDateTime": "2019-11-18 21:08:16", "authoredDateTime": "2019-11-19 13:08:16", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/ReaderTest.java", "insertions": 32, "deletions": 0, "lines": 32}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 7, "deletions": 0, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ReaderTest.testReadMessageWithoutBatchingWithMessageInclusive()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ReaderTest.testReadMessageWithBatchingWithMessageInclusive()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ReaderTest.testReadMessages(java.lang.String,boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.hasMessageAvailable()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "PulsarBrokerStatsClientTest.testTopicInternalStats is flaky", "body": "```\r\nError Message\r\nexpected [true] but found [false]\r\nStacktrace\r\njava.lang.AssertionError: expected [true] but found [false]\r\n\tat org.testng.Assert.fail(Assert.java:96)\r\n\tat org.testng.Assert.failNotEquals(Assert.java:776)\r\n\tat org.testng.Assert.assertTrue(Assert.java:44)\r\n\tat org.testng.Assert.assertTrue(Assert.java:54)\r\n\tat org.apache.pulsar.stats.client.PulsarBrokerStatsClientTest.testTopicInternalStats(PulsarBrokerStatsClientTest.java:127)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124)\r\n\tat org.testng.internal.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:54)\r\n\tat org.testng.internal.InvokeMethodRunnable.run(InvokeMethodRunnable.java:44)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n\r\n```", "url": "https://github.com/apache/pulsar/issues/4895", "user": "sijie", "labels": ["component/test", "flaky-tests", "triage/week-33", "type/bug"], "created": "2019-08-06 03:08:29", "closed": "2019-08-29 16:17:04", "commits": {}, "ttf": 23.00027777777778, "commitsDetails": []}, {"title": "ConsumerStatsTest.testAsyncCallOnPartitionedTopic is flaky", "body": "```\r\n2019-08-05 13:46:30.473 INFO  ConsumerStatsTest:246 | res = 204\r\n2019-08-05 13:46:30.473 INFO  Client:88 | Subscribing on Topic :persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788\r\n2019-08-05 13:46:30.475 INFO  ConnectionPool:72 | Created connection for pulsar://localhost:6650\r\n2019-08-05 13:46:30.476 INFO  ClientConnection:324 | [127.0.0.1:41422 -> 127.0.0.1:6650] Connected to broker\r\n2019-08-05 13:46:30.662 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-0, subscription-name, 0] Getting connection from pool\r\n2019-08-05 13:46:30.663 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-1, subscription-name, 1] Getting connection from pool\r\n2019-08-05 13:46:30.663 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-2, subscription-name, 2] Getting connection from pool\r\n2019-08-05 13:46:30.663 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-3, subscription-name, 3] Getting connection from pool\r\n2019-08-05 13:46:30.664 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-4, subscription-name, 4] Getting connection from pool\r\n2019-08-05 13:46:30.664 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-5, subscription-name, 5] Getting connection from pool\r\n2019-08-05 13:46:30.664 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-6, subscription-name, 6] Getting connection from pool\r\n2019-08-05 13:46:31.909 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-2, subscription-name, 2] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:32.010 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-3, subscription-name, 3] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:32.069 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-5, subscription-name, 5] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:32.069 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-0, subscription-name, 0] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:32.069 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-4, subscription-name, 4] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:32.069 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-1, subscription-name, 1] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:32.171 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-6, subscription-name, 6] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:32.172 INFO  PartitionedConsumerImpl:252 | Successfully Subscribed to Partitioned Topic - persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788 with - 7 Partitions.\r\n2019-08-05 13:46:32.172 INFO  PartitionedConsumerImpl:121 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788,subscription-name] Unsubscribing\r\n2019-08-05 13:46:32.172 INFO  ConsumerImpl:222 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-0, subscription-name, 0] Unsubscribing\r\n2019-08-05 13:46:32.172 INFO  ConsumerImpl:222 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-1, subscription-name, 1] Unsubscribing\r\n2019-08-05 13:46:32.172 INFO  ConsumerImpl:222 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-2, subscription-name, 2] Unsubscribing\r\n2019-08-05 13:46:32.172 INFO  ConsumerImpl:222 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-3, subscription-name, 3] Unsubscribing\r\n2019-08-05 13:46:32.172 INFO  ConsumerImpl:222 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-4, subscription-name, 4] Unsubscribing\r\n2019-08-05 13:46:32.173 INFO  ConsumerImpl:222 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-5, subscription-name, 5] Unsubscribing\r\n2019-08-05 13:46:32.173 INFO  ConsumerImpl:222 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-6, subscription-name, 6] Unsubscribing\r\n2019-08-05 13:46:32.409 INFO  ConsumerImpl:255 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-0, subscription-name, 0] Unsubscribed successfully\r\n2019-08-05 13:46:32.409 INFO  PartitionedConsumerImpl:165 | Successfully Unsubscribed Consumer - 0 for Subscription - subscription-name for Topic - persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788\r\n2019-08-05 13:46:32.412 INFO  ConsumerImpl:255 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-1, subscription-name, 1] Unsubscribed successfully\r\n2019-08-05 13:46:32.412 INFO  PartitionedConsumerImpl:165 | Successfully Unsubscribed Consumer - 1 for Subscription - subscription-name for Topic - persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788\r\n2019-08-05 13:46:32.412 INFO  ConsumerImpl:255 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-2, subscription-name, 2] Unsubscribed successfully\r\n2019-08-05 13:46:32.413 INFO  PartitionedConsumerImpl:165 | Successfully Unsubscribed Consumer - 2 for Subscription - subscription-name for Topic - persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788\r\n2019-08-05 13:46:32.413 INFO  ConsumerImpl:255 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-3, subscription-name, 3] Unsubscribed successfully\r\n2019-08-05 13:46:32.413 INFO  PartitionedConsumerImpl:165 | Successfully Unsubscribed Consumer - 3 for Subscription - subscription-name for Topic - persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788\r\n2019-08-05 13:46:32.413 INFO  ConsumerImpl:255 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-4, subscription-name, 4] Unsubscribed successfully\r\n2019-08-05 13:46:32.413 INFO  PartitionedConsumerImpl:165 | Successfully Unsubscribed Consumer - 4 for Subscription - subscription-name for Topic - persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788\r\n2019-08-05 13:46:32.415 INFO  ConsumerImpl:255 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-6, subscription-name, 6] Unsubscribed successfully\r\n2019-08-05 13:46:32.415 INFO  PartitionedConsumerImpl:165 | Successfully Unsubscribed Consumer - 6 for Subscription - subscription-name for Topic - persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788\r\n2019-08-05 13:46:32.415 INFO  ConsumerImpl:255 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-5, subscription-name, 5] Unsubscribed successfully\r\n2019-08-05 13:46:32.415 INFO  PartitionedConsumerImpl:165 | Successfully Unsubscribed Consumer - 5 for Subscription - subscription-name for Topic - persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788\r\n2019-08-05 13:46:32.415 INFO  Client:88 | Subscribing on Topic :persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788\r\n2019-08-05 13:46:32.418 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-0, subscription-name, 7] Getting connection from pool\r\n2019-08-05 13:46:32.418 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-1, subscription-name, 8] Getting connection from pool\r\n2019-08-05 13:46:32.419 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-2, subscription-name, 9] Getting connection from pool\r\n2019-08-05 13:46:32.419 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-3, subscription-name, 10] Getting connection from pool\r\n2019-08-05 13:46:32.419 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-4, subscription-name, 11] Getting connection from pool\r\n2019-08-05 13:46:32.420 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-5, subscription-name, 12] Getting connection from pool\r\n2019-08-05 13:46:32.420 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-6, subscription-name, 13] Getting connection from pool\r\n2019-08-05 13:46:33.204 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-0, subscription-name, 7] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.204 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-4, subscription-name, 11] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.204 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-6, subscription-name, 13] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.206 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-5, subscription-name, 12] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.208 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-2, subscription-name, 9] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.212 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-1, subscription-name, 8] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.212 INFO  ConsumerImpl:170 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-3, subscription-name, 10] Created consumer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.212 INFO  PartitionedConsumerImpl:252 | Successfully Subscribed to Partitioned Topic - persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788 with - 7 Partitions.\r\n2019-08-05 13:46:33.220 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-0, ] Getting connection from pool\r\n2019-08-05 13:46:33.220 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-1, ] Getting connection from pool\r\n2019-08-05 13:46:33.220 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-2, ] Getting connection from pool\r\n2019-08-05 13:46:33.221 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-3, ] Getting connection from pool\r\n2019-08-05 13:46:33.221 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-4, ] Getting connection from pool\r\n2019-08-05 13:46:33.221 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-5, ] Getting connection from pool\r\n2019-08-05 13:46:33.221 INFO  HandlerBase:52 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-6, ] Getting connection from pool\r\n2019-08-05 13:46:33.355 INFO  ProducerImpl:155 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-6, ] Created producer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.356 INFO  ProducerImpl:155 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-5, ] Created producer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.356 INFO  ProducerImpl:155 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-4, ] Created producer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.356 INFO  ProducerImpl:155 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-3, ] Created producer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.360 INFO  ProducerImpl:155 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-1, ] Created producer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.362 INFO  ProducerImpl:155 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-2, ] Created producer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n2019-08-05 13:46:33.363 INFO  ProducerImpl:155 | [persistent://public/default/testAsyncCallOnPartitionedTopic-1565012788-partition-0, ] Created producer on broker [127.0.0.1:41422 -> 127.0.0.1:6650]\r\n/pulsar/pulsar-client-cpp/tests/ConsumerStatsTest.cc:48: Failure\r\nValue of: statsPtr->getBrokerConsumerStats(index).getMsgBacklog()\r\n  Actual: 10\r\nExpected: expectedBacklog\r\nWhich is: 5\r\n/pulsar/pulsar-client-cpp/tests/ConsumerStatsTest.cc:315: Failure\r\nValue of: latch.wait(std::chrono::seconds(10))\r\n  Actual: false\r\nExpected: true\r\n\u001b[0;31m[  FAILED  ] \u001b[mConsumerStatsTest.testAsyncCallOnPartitionedTopic (30469 ms)\r\n\u001b[0;32m[----------] \u001b[m1 test from ConsumerStatsTest (30470 ms total)\r\n\r\n\u001b[0;32m[----------] \u001b[mGlobal test environment tear-down\r\n\u001b[0;32m[==========] \u001b[m1 test from 1 test case ran. (30470 ms total)\r\n\u001b[0;32m[  PASSED  ] \u001b[m0 tests.\r\n\u001b[0;31m[  FAILED  ] \u001b[m1 test, listed below:\r\n\u001b[0;31m[  FAILED  ] \u001b[mConsumerStatsTest.testAsyncCallOnPartitionedTopic\r\n\r\n 1 FAILED TEST\r\n```", "url": "https://github.com/apache/pulsar/issues/4894", "user": "sijie", "labels": ["component/test", "triage/week-31", "type/bug"], "created": "2019-08-06 01:31:35", "closed": "2019-08-30 03:00:06", "commits": {"bc766130c3add0e9ba2e3f1e4c4c59cefb1e15ea": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 24.00027777777778, "commitsDetails": [{"commitHash": "bc766130c3add0e9ba2e3f1e4c4c59cefb1e15ea", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["e78beaaf4815509dc906838aaf4057a6c1445d0b"], "nameRev": "bc766130c3add0e9ba2e3f1e4c4c59cefb1e15ea tags/v2.5.0-candidate-1~399", "commitMessage": "Fix : ConsumerStatsTest.testAsyncCallOnPartitionedTopic is flaky (#5066)\n\nfix #4894\r\n\r\n### Motivation\r\n\r\nDue to the concurrent execution of the program, when checking whether the \u2018BrokerConsumerStats\u2019's cache is in effect, there is no guarantee that the cache time will not be exceeded.\r\n\r\n### Modifications\r\n\r\n- Check the cache in an inexact way.\r\n- Increase waiting time\r\n", "commitDateTime": "2019-08-30 11:00:05", "authoredDateTime": "2019-08-30 11:00:05", "commitGitStats": [{"filePath": "pulsar-client-cpp/tests/ConsumerStatsTest.cc", "insertions": 17, "deletions": 11, "lines": 28}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Cmake error when compiling pulsar-client-cpp", "body": "**Describe the bug**\r\n```\r\nCMake Error at CMakeLists.txt:151 (MESSAGE):\r\n  Could not find Boost Python library\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: MacOS 10.14.5\r\n", "url": "https://github.com/apache/pulsar/issues/4880", "user": "zymap", "labels": ["component/build", "component/documentation", "triage/week-31", "type/bug"], "created": "2019-08-03 11:33:34", "closed": "2019-12-03 11:40:02", "commits": {}, "ttf": 122.00027777777778, "commitsDetails": []}, {"title": "MacOS clang/llvm compiler imcompatible code in Unit test case BasicEndToEndTest.cc", "body": "**Describe the bug**\r\nThere are 2 compiler errors while compiling BasicEndToEndTest.cc under MacOS with clang/LLVM:\r\n\"variable length array of non-POD element type of Consumer\"\r\n\r\nBasically, this is introduced by announcing an array of elements, with a variable length.\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Try build BasicEndToEndTest.cc under clang/llvm\r\n\r\n**Expected behavior**\r\nbuild BasicEndToEndTest.cc pass under clang/llvm, with no error report.\r\n", "url": "https://github.com/apache/pulsar/issues/4871", "user": "easyfan", "labels": ["type/bug"], "created": "2019-08-02 04:20:21", "closed": "2019-08-05 06:45:45", "commits": {"ce681dfd706cd47057f24ad57e13e9f60f6ff14f": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "ce681dfd706cd47057f24ad57e13e9f60f6ff14f", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["5bf319e46f70350cc162210c1583e608be581b4e"], "nameRev": "ce681dfd706cd47057f24ad57e13e9f60f6ff14f tags/v2.5.0-candidate-1~483", "commitMessage": "Merge Request for #4871: change unittest code for support LLVM. (#4878)\n\n MacOS clang/llvm compiler imcompatible code in Unit test case BasicEndToEndTest.cc #4871\r\n", "commitDateTime": "2019-08-05 14:45:44", "authoredDateTime": "2019-08-05 14:45:44", "commitGitStats": [{"filePath": "pulsar-client-cpp/tests/BasicEndToEndTest.cc", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "The jenkins always failed immediately", "body": "**Describe the bug**\r\nWhen I create a pull request. The jenkins always failed immediately.\r\n\r\n**Additional context**\r\n```\r\n > git checkout -f aef075c8bacdccd3e30ed83268f87e7766ddd384\r\nCommit message: \"Merge 83d18e6fbd548d1fd2c20cf107ac993b7212ed5a into 434c3956e9da86704f49b52e05bd15c143d89624\"\r\nFirst time build. Skipping changelog.\r\nFATAL: Couldn?t find any executable in /home/jenkins/tools/maven/apache-maven-3.5.0\r\nBuild step 'Invoke top-level Maven targets' marked build as failure\r\nArchiving artifacts\r\nRecording test results\r\nSetting status of 83d18e6fbd548d1fd2c20cf107ac993b7212ed5a to FAILURE with url https://builds.apache.org/job/pulsar_precommit_cpp/8898/ and message: 'FAILURE\r\n '\r\nUsing context: Jenkins: C++ / Python Tests\r\nFinished: FAILURE\r\n```", "url": "https://github.com/apache/pulsar/issues/4870", "user": "zymap", "labels": ["type/bug"], "created": "2019-08-02 04:00:27", "closed": "2019-08-02 12:58:41", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "pulsar-functions-local-runner(v2.4.0)", "body": "I use pulsar-2.4.0, and try to debug functions in localrun mode with 'pulsar-functions-local-runner'.\r\n\r\nMy code is just like: [https://github.com/jerrypeng/pulsar-functions-demos/tree/master/debugging](url)\r\nBut when I run my code , it got errors like bellow:\r\n\r\n_[ERROR] 2019-08-01 14:29:33.107 [public/default/exclamation-0] JavaInstanceRunnable - [public/default/exclamation:0] Uncaught exception in Java Instance\r\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$IncompatibleSchemaException: Trying to subscribe with incompatible schema\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292) ~[?:1.8.0_161]\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308) ~[?:1.8.0_161]\r\n\tat java.util.concurrent.CompletableFuture.uniRun(CompletableFuture.java:700) ~[?:1.8.0_161]\r\n\tat java.util.concurrent.CompletableFuture$UniRun.tryFire$$$capture(CompletableFuture.java:687) ~[?:1.8.0_161]\r\n\tat java.util.concurrent.CompletableFuture$UniRun.tryFire(CompletableFuture.java) ~[?:1.8.0_161]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_161]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_161]\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:597) ~[pulsar-functions-local-runner-2.4.0.jar:2.4.0]\r\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:154) ~[pulsar-functions-local-runner-2.4.0.jar:2.4.0]_\r\n\r\nI alse see a issue at [https://github.com/apache/pulsar/issues/4857](url), and I set my pulsar-2.4.0 with Sijie's suggestion, but the error also came.\r\nFinally,  I chang my pulsar's version to 2.3.1, use the same code, but it's all right, no error come.\r\nSo, I think is it a bug in pulsar-2.4.0?\r\nThanks a lot.", "url": "https://github.com/apache/pulsar/issues/4864", "user": "cumtwwei", "labels": ["type/bug"], "created": "2019-08-01 06:35:50", "closed": "2019-08-01 16:22:05", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Error: \"Trying to subscribe with incompatible schema\" even though isSchemaValidationEnforced=false ", "body": "**Describe the bug**\r\n\r\nWe are getting the error: `Trying to subscribe with incompatible schema`\r\neven though:\r\n`isSchemaValidationEnforced=false `\r\nis set on the broker after deploying a new Pulsar Source and simple passthrough Pulsar Function. Here is the more detailed exception:\r\n\r\n> java.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$IncompatibleSchemaException: Trying to subscribe with incompatible schema\r\n> \tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292) ~[?:1.8.0_212]\r\n> \tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308) ~[?:1.8.0_212]\r\n> \tat java.util.concurrent.CompletableFuture.uniRun(CompletableFuture.java:700) ~[?:1.8.0_212]\r\n> \tat java.util.concurrent.CompletableFuture$UniRun.tryFire(CompletableFuture.java:687) ~[?:1.8.0_212]\r\n> \tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_212]\r\n> \tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_212]\r\n> \tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:582) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:159) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:323) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:297) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1434) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:965) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:656) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:591) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:508) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:470) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat org.apache.pulsar.functions.runtime.shaded.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n> Caused by: org.apache.pulsar.client.api.PulsarClientException$IncompatibleSchemaException: Trying to subscribe with incompatible schema\r\n> \tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:890) ~[java-instance.jar:2.4.0-streamlio-24]\r\n> \t... 22 more\r\n\r\n\r\n**To Reproduce**\r\n\r\n1. Ensure that the schemas from the input topics and output topics have been deleted.\r\n2. Ensure that the source and function with the information below have been deleted.\r\n3. Deploy the Pulsar Source with the below configs:\r\n```\r\n{  \"type\": \"source\",\r\n    \"sourceType\": \"kafka\",\r\n    \"runtimeFlags\":\"-Djava.security.krb5.conf=/pulsar/conf/krb5-dev.conf\",\r\n    \"destinationTopicName\": \"persistent://example-tenant/ingest/example-kafka-topic\",\r\n    \"configs\": {\r\n\t\t\"bootstrapServers\": \"kafka06.example.domain.com:9092,kafka07.example.domain.com:9092,kafka08.example.domain.com:9092\",\r\n\t\t\"consumerConfigProperties\": {\r\n\t\t\t\"auto.offset.reset\": \"latest\",\r\n\t\t\t\"sasl.jaas.config\": \"com.sun.security.auth.module.Krb5LoginModule required doNotPrompt=true\\nuseTicketCache=false serviceName=\\\"kafka\\\" principal=\\\"pulsar_runtime@EXAMPLE.DOMAIN.COM\\\"\\nuseKeyTab=true keyTab=\\\"/pulsar/conf/auth/pulsar_runtime_dev.keytab\\\" client=true;\",\r\n\t\t\t\"sasl.kerberos.service.name\": \"kafka\",\r\n\t\t\t\"security.protocol\": \"SASL_PLAINTEXT\"\r\n\t\t},\r\n\t\t\"groupId\": \"pulsar-example-tenant-example-kafka-topic-group\",\r\n\t\t\"topic\": \"example-kafka-topic\"\r\n\t},\r\n    \"namespace\": \"ingest\",\r\n    \"name\": \"kafka-example-kafka-topic-source\",\r\n    \"tenant\": \"example-tenant\"\r\n}\r\n```\r\n4. Deploy the Pulsar function with the configs below:\r\n```\r\n{\r\n    \"type\": \"function\",\r\n    \"tenant\": \"example-tenant\",\r\n    \"namespace\": \"ingest\",\r\n    \"name\": \"example-kafka-topic-SimplePassthroughFunction\",\r\n    \"artifactPathOrUrl\": \"http://repository.domain.com/path/to/jar-build-129875312.jar\",\r\n    \"className\": \"com.path.to.pulsar.functions.SimplePassthroughFunction\",\r\n    \"inputs\": [\r\n        \"persistent://example-tenant/ingest/example-kafka-topic\"\r\n    ],\r\n    \"output\": \"persistent://feeds/example-namespace/example-kafka-topic\",\r\n    \"logTopic\": \"persistent://example-tenant/ingest/function-logs\"\r\n}\r\n```\r\n\r\nThe same problem occurs if the tenant and namespace are all set to public/default.\r\n\r\nAll of our functions and sources just take a string and return a string, so there's nothing complex in terms of the schemas.\r\n\r\n**Expected behavior**\r\nWe expect the Pulsar Source to collect data from our Kafka topic without error. We also expect the function to process data from our Pulsar Source without error.\r\n\r\n**Screenshots**\r\n\r\nWe've noticed that when we deploy the passthrough function and start querying its status, we initially notice an error that states \"UNAVAILABLE: io exception,\" like this:\r\n\r\n```\r\n$ pulsar-admin functions status --fqfn public/default/example-kafka-topic-SimplePassthroughFunction\r\n{\r\n  \"numInstances\" : 1,\r\n  \"numRunning\" : 1,\r\n  \"instances\" : [ {\r\n    \"instanceId\" : 0,\r\n    \"status\" : {\r\n      \"running\" : true,\r\n      \"error\" : \"\",\r\n      \"numRestarts\" : 0,\r\n      \"numReceived\" : 0,\r\n      \"numSuccessfullyProcessed\" : 0,\r\n      \"numUserExceptions\" : 0,\r\n      \"latestUserExceptions\" : [ ],\r\n      \"numSystemExceptions\" : 0,\r\n      \"latestSystemExceptions\" : [ ],\r\n      \"averageLatency\" : 0.0,\r\n      \"lastInvocationTime\" : 0,\r\n      \"workerId\" : \"c-pulsar-example.cluster.com-8080\"\r\n    }\r\n  } ]\r\n}\r\n$ pulsar-admin functions status --fqfn public/default/example-kafka-topic-SimplePassthroughFunction\r\n{\r\n  \"numInstances\" : 1,\r\n  \"numRunning\" : 0,\r\n  \"instances\" : [ {\r\n    \"instanceId\" : 0,\r\n    \"status\" : {\r\n      \"running\" : false,\r\n      \"error\" : \"UNAVAILABLE: io exception\",\r\n      \"numRestarts\" : 0,\r\n      \"numReceived\" : 0,\r\n      \"numSuccessfullyProcessed\" : 0,\r\n      \"numUserExceptions\" : 0,\r\n      \"latestUserExceptions\" : [ ],\r\n      \"numSystemExceptions\" : 0,\r\n      \"latestSystemExceptions\" : [ ],\r\n      \"averageLatency\" : 0.0,\r\n      \"lastInvocationTime\" : 0,\r\n      \"workerId\" : \"c-pulsar-example.cluster.com-8080\"\r\n    }\r\n  } ]\r\n}\r\n$ pulsar-admin functions status --fqfn public/default/example-kafka-topic-SimplePassthroughFunction\r\n{\r\n  \"numInstances\" : 1,\r\n  \"numRunning\" : 0,\r\n  \"instances\" : [ {\r\n    \"instanceId\" : 0,\r\n    \"status\" : {\r\n      \"running\" : false,\r\n      \"error\" : \"\",\r\n      \"numRestarts\" : 1,\r\n      \"numReceived\" : 0,\r\n      \"numSuccessfullyProcessed\" : 0,\r\n      \"numUserExceptions\" : 0,\r\n      \"latestUserExceptions\" : [ ],\r\n      \"numSystemExceptions\" : 0,\r\n      \"latestSystemExceptions\" : [ ],\r\n      \"averageLatency\" : 0.0,\r\n      \"lastInvocationTime\" : 0,\r\n      \"workerId\" : \"c-pulsar-example.cluster.com-8080\"\r\n    }\r\n  } ]\r\n}\r\n```\r\n\r\n**Environment:**\r\n - OS: `docker standalone run -it --net=host -v /etc/pulsar:/pulsar/conf -v /data/provisioning:/pulsar/data  apachepulsar/pulsar-all:2.3.2 /bin/bash`\r\n- Pulsar version: Using Pulsar 2.3.2.\r\n\r\n**Additional context**\r\nWe experienced this error also with a sink. \r\n", "url": "https://github.com/apache/pulsar/issues/4857", "user": "devinbost", "labels": ["component/functions", "component/io", "triage/week-31", "type/bug"], "created": "2019-07-30 23:41:59", "closed": "2019-09-01 01:08:30", "commits": {}, "ttf": 32.000277777777775, "commitsDetails": []}, {"title": "The frist position in managedLedger is ahead of the last", "body": "**Describe the bug**\r\nAfter create a empty ledger by sub/unsub and trim ledgers, the frist position in managedLedger is ahead of the last when create a consumer and don't reopen the managed ledger.\r\n\r\n**To Reproduce**\r\nrun test and set the retention policy to 0.\r\n\r\n**Expected behavior**\r\n\r\nno bug and \"all message\" output none.\r\n\r\n**Screenshots**\r\n\r\n```bash\r\n16:05:50.795 [pulsar-io-50-2] INFO  org.apache.pulsar.broker.service.ServerCnx - [/127.0.0.1:45808] Subscribing on topic persistent://public/default/my-topic / my-sub\r\n16:05:50.796 [pulsar-io-50-2] WARN  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [public/default/persistent/my-topic] [my-sub] Current position 15:-1 is ahead of last position 13:0\r\n16:05:50.797 [pulsar-io-50-2] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [public/default/persistent/my-topic] Cursor my-sub recovered to position 13:0\r\n16:05:50.797 [pulsar-io-50-2] WARN  org.apache.bookkeeper.client.BookieWatcherImpl - New ensemble: [127.0.0.1:3181] is not adhering to Placement Policy. quarantinedBookies: []\r\n16:05:50.801 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.bookkeeper.client.LedgerCreateOp - Ensemble: [127.0.0.1:3181] for ledger: 17\r\n16:05:50.804 [BookKeeperClientWorker-OrderedExecutor-1-0] INFO  org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper - [public/default/persistent/my-topic] [my-sub] Updating cursor info ledgerId=17 mark-delete=13:0\r\n16:05:50.806 [bookkeeper-ml-workers-OrderedExecutor-2-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [public/default/persistent/my-topic] Updated cursor my-sub with ledger id 17 md-position=13:0 rd-position=13:1\r\n16:05:50.806 [bookkeeper-ml-workers-OrderedExecutor-2-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [public/default/persistent/my-topic] Opened new cursor: ManagedCursorImpl{ledger=public/default/persistent/my-topic, name=my-sub, ackPos=13:0, readPos=13:1}\r\n16:05:50.806 [bookkeeper-ml-workers-OrderedExecutor-2-0] ERROR org.apache.bookkeeper.common.util.SafeRunnable - Unexpected throwable caught \r\njava.lang.IllegalArgumentException: Invalid range: (15:-1..13:0]\r\n\tat com.google.common.collect.Range.<init>(Range.java:352) ~[guava-21.0.jar:?]\r\n\tat com.google.common.collect.Range.create(Range.java:146) ~[guava-21.0.jar:?]\r\n\tat com.google.common.collect.Range.openClosed(Range.java:194) ~[guava-21.0.jar:?]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.getFirstPositionAndCounter(ManagedLedgerImpl.java:2809) ~[managed-ledger-original.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl$6.operationComplete(ManagedLedgerImpl.java:722) ~[managed-ledger-original.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$2.operationComplete(ManagedCursorImpl.java:420) ~[managed-ledger-original.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$25$1.operationComplete(ManagedCursorImpl.java:2137) ~[managed-ledger-original.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$27.operationComplete(ManagedCursorImpl.java:2306) ~[managed-ledger-original.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$27.operationComplete(ManagedCursorImpl.java:2296) ~[managed-ledger-original.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$23.operationComplete(ManagedCursorImpl.java:2009) ~[managed-ledger-original.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$23.operationComplete(ManagedCursorImpl.java:2005) ~[managed-ledger-original.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper.lambda$null$9(MetaStoreImplZookeeper.java:277) ~[managed-ledger-ono bug and \"all messages\" output none.riginal.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:32) ~[managed-ledger-original.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n```\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n\r\n - pulsar-2.4.0/master\r\n\r\n**Additional context**\r\n\r\n```java\r\npublic class BugTest {\r\n    static void consume(String topicName, String subName) throws Exception {\r\n        try (\r\n                PulsarClient client = PulsarClient.builder()\r\n                        .serviceUrl(\"pulsar://localhost:6650\")\r\n                        .build();\r\n                Consumer<byte[]> consumer = client.newConsumer()\r\n                        .topic(\"persistent://public/default/\" + topicName)\r\n                        .subscriptionInitialPosition(SubscriptionInitialPosition.Earliest)\r\n                        .subscriptionType(SubscriptionType.Exclusive)\r\n                        .subscriptionName(subName)\r\n                        .subscribe()) {\r\n\r\n            Message<byte[]> msg = consumer.receive(10, TimeUnit.SECONDS);\r\n            while (msg != null) {\r\n                System.out.println(\"receive message,  value: \" + new String(msg.getValue()));\r\n                consumer.acknowledge(msg);\r\n                msg = consumer.receive(10, TimeUnit.SECONDS);\r\n            }\r\n            consumer.unsubscribe();\r\n        }\r\n    }\r\n\r\n    static void produceAndConsumeMessage(String topicName, String message, String subName) throws Exception {\r\n        try (PulsarClient client = PulsarClient.builder()\r\n                .serviceUrl(\"pulsar://localhost:6650\")\r\n                .build()) {\r\n            try (Producer<String> producer = client.newProducer(Schema.STRING)\r\n                    .topic(\"persistent://public/default/\" + topicName)\r\n                    .enableBatching(false)\r\n                    .create();\r\n                 Consumer<String> consumer = client.newConsumer(Schema.STRING)\r\n                         .topic(\"persistent://public/default/\" + topicName)\r\n                         .subscriptionType(SubscriptionType.Exclusive)\r\n                         .subscriptionName(subName)\r\n                         .subscribe()) {\r\n                producer.newMessage()\r\n                        .value(message)\r\n                        .send();\r\n                producer.flush();\r\n                System.out.println(\"produce message: \" + message);\r\n\r\n                Message<String> msg = consumer.receive();\r\n                consumer.acknowledge(msg);\r\n                consumer.unsubscribe();\r\n                System.out.println(\"consume and ack message : \" + msg.getValue());\r\n            }\r\n        }\r\n        try (PulsarAdmin admin = PulsarAdmin.builder()\r\n                .serviceHttpUrl(\"http://localhost:8080\")\r\n                .build()) {\r\n            admin.topics().unload(\"persistent://public/default/\" + topicName);\r\n        }\r\n    }\r\n\r\n    static void test(String topicName, int n, String subName) throws Exception {\r\n        try (PulsarAdmin admin = PulsarAdmin.builder()\r\n                .serviceHttpUrl(\"http://localhost:8080\")\r\n                .build()) {\r\n            admin.namespaces().setRetention(\"public/default\", new RetentionPolicies(0, 0));\r\n        }\r\n        int i = 0;\r\n        while (i++ < n) {\r\n            System.out.println(new Date().toString());\r\n            produceAndConsumeMessage(topicName, \"value-\" + i, subName);\r\n            Thread.sleep(1000 * 60);\r\n        }\r\n        // sub and unSub to trigger trim ledgers\r\n        try (\r\n                PulsarClient client = PulsarClient.builder()\r\n                        .serviceUrl(\"pulsar://localhost:6650\")\r\n                        .build();\r\n                Consumer<String> consumer = client.newConsumer(Schema.STRING)\r\n                        .topic(\"persistent://public/default/\" + topicName)\r\n                        .subscriptionType(SubscriptionType.Exclusive)\r\n                        .subscriptionName(subName)\r\n                        .subscribe()) {\r\n            consumer.unsubscribe();\r\n        }\r\n        // The bug disappears after enabling the code below\r\n\r\n//        try (PulsarAdmin admin = PulsarAdmin.builder()\r\n//                .serviceHttpUrl(\"http://localhost:8080\")\r\n//                .build()) {\r\n//            admin.topics().unload(\"persistent://public/default/\" + topicName);\r\n//        }\r\n        System.out.println(\"-------------------------------------\");\r\n        System.out.println(\"all messages :\");\r\n        consume(topicName, subName);\r\n        System.out.println(\"-------------------------------------\");\r\n    }\r\n\r\n    public static void main(String[] args) {\r\n        try {\r\n            test(\"my-topic\", 3, \"my-sub\");\r\n        } catch (Exception e) {\r\n            e.printStackTrace();\r\n        }\r\n    }\r\n}\r\n```", "url": "https://github.com/apache/pulsar/issues/4852", "user": "fxbing", "labels": ["type/bug"], "created": "2019-07-30 14:55:26", "closed": "2019-08-02 13:01:45", "commits": {"46bfb2c21b9f96866238c79b886458dcde6685c8": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "7ec92b6d80ccfb6a503c3888d7309ebbd02315c1": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "46bfb2c21b9f96866238c79b886458dcde6685c8", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["9c68f19670676f50f4f1fd5019aa1ca89cdb09c6"], "nameRev": "46bfb2c21b9f96866238c79b886458dcde6685c8 tags/v2.5.0-candidate-1~492", "commitMessage": "Fix : The frist position in managedLedger is ahead of the last (#4853)\n\nFixes #4852\r\n\r\nBug:\r\n\r\nAfter create an empty ledger by sub/unsub and trim ledgers, the first position in managedLedger is ahead of the last when create a consumer without reopen the managed ledger.\r\n\r\nReason\uff1a\r\n\r\nLast position will be update when opening managedLedger.\r\nBecause when creating an empty Ledger without reopening managedLedger, the last position is not be updated. Since the ledger pointed of the last position has been deleted, the first position point to the new ledger.\r\n\r\nFix:\r\n\r\nThe first position should fall back to last position.", "commitDateTime": "2019-08-02 21:01:45", "authoredDateTime": "2019-08-02 21:01:45", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java", "insertions": 9, "deletions": 1, "lines": 10}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerTest.java", "insertions": 27, "deletions": 0, "lines": 27}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ManagedLedgerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.getFirstPosition()", "TOT": 6, "UPD": 0, "INS": 3, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "ManagedLedgerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerTest.testRetention0WithEmptyLedger()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "7ec92b6d80ccfb6a503c3888d7309ebbd02315c1", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["2725ef3e103a9308b1c7bd162206d069cfaa8202"], "nameRev": "7ec92b6d80ccfb6a503c3888d7309ebbd02315c1 tags/v2.4.1-candidate-1~29", "commitMessage": "Fix : The frist position in managedLedger is ahead of the last (#4853)\n\nFixes #4852\n\nBug:\n\nAfter create an empty ledger by sub/unsub and trim ledgers, the first position in managedLedger is ahead of the last when create a consumer without reopen the managed ledger.\n\nReason\uff1a\n\nLast position will be update when opening managedLedger.\nBecause when creating an empty Ledger without reopening managedLedger, the last position is not be updated. Since the ledger pointed of the last position has been deleted, the first position point to the new ledger.\n\nFix:\n\nThe first position should fall back to last position.\n(cherry picked from commit 46bfb2c21b9f96866238c79b886458dcde6685c8)\n", "commitDateTime": "2019-08-28 11:21:11", "authoredDateTime": "2019-08-02 21:01:45", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java", "insertions": 9, "deletions": 1, "lines": 10}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerTest.java", "insertions": 27, "deletions": 0, "lines": 27}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ManagedLedgerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.getFirstPosition()", "TOT": 6, "UPD": 0, "INS": 3, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "ManagedLedgerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerTest.testRetention0WithEmptyLedger()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Pulsar Function in Java NPE when implementing wrong interface", "body": "If a user submits a Pulsar Function written in java that is not implementing the correct interface, the following NPE could happen:\r\n\r\n```\r\njava.lang.NullPointerException: null\r\n\tat org.apache.pulsar.functions.utils.FunctionConfigUtils.doJavaChecks(FunctionConfigUtils.java:416) ~[pulsar-functions-utils.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.utils.FunctionConfigUtils.validate(FunctionConfigUtils.java:630) ~[pulsar-functions-utils.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.worker.rest.api.FunctionsImpl.validateUpdateRequestParams(FunctionsImpl.java:652) ~[pulsar-functions-worker.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.functions.worker.rest.api.FunctionsImpl.registerFunction(FunctionsImpl.java:163) ~[pulsar-functions-worker.jar:2.5.0-SNAPSHOT]\r\n\tat org.apache.pulsar.broker.admin.impl.FunctionsBase.registerFunction(FunctionsBase.java:173) ~[pulsar-broker.jar:2.5.0-SNAPSHOT]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_201]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_201]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_201]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_201]\r\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:76) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:148) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:191) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:183) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:103) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:493) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:415) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:104) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:277) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) [jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) [jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:316) [jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:298) [jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:268) [jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:289) [jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:256) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:703) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:416) [jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:370) [jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:389) [jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:342) [jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:229) [jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:865) [jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1655) [jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53) [pulsar-broker.jar:2.5.0-SNAPSHOT]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1642) [jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533) [jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1340) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1242) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:220) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:174) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:503) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:364) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:305) [jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) [jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118) [jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_201]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_201]\r\n```\r\n\r\n\r\nWe need to check whether the function is implementing the correct interface before we do some checks\r\n", "url": "https://github.com/apache/pulsar/issues/4843", "user": "jerrypeng", "labels": ["type/bug"], "created": "2019-07-29 21:44:28", "closed": "2019-08-02 04:17:44", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "Pulsar schema admin API doesn't support uploading key/value schema", "body": "**Describe the bug**\r\n\r\nCurrently Pulsar schema api converts schema data (bytes) to string and uploads the string to Pulsar admin endpoint. It works for struct schemas and primitive schemas. Primitive schemas doesn't contain any schema data and struct schemas store UTF_8 encoded data. \r\n\r\nHowever it doesn't work for key/value schema because it will contain illegal bytes in schema data.\r\n\r\n**To Reproduce**\r\n\r\n```\r\nSchema<KeyValue<User, User>> schema = Schema.KeyValue(\r\n    Schema.AVRO(User.class),\r\n    Schema.AVRO(User.class)\r\n);\r\n\r\nadmin.schema().createSchema(topic, schema.getSchemaInfo());\r\n```\r\n\r\n**Expected behavior**\r\n\r\nAdmin api should be able to upload key/value schema.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4840", "user": "sijie", "labels": ["component/schemaregistry", "triage/week-31", "type/bug"], "created": "2019-07-28 12:56:51", "closed": "2019-08-27 23:31:56", "commits": {"588b166db9a0fa13d7046bf26066dbbe6c96b468": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 30.00027777777778, "commitsDetails": [{"commitHash": "588b166db9a0fa13d7046bf26066dbbe6c96b468", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["41430ce01e3c6128c20591f62608d5bb1d442e26"], "nameRev": "588b166db9a0fa13d7046bf26066dbbe6c96b468 tags/v2.5.0-candidate-1~414", "commitMessage": "[schema] support uploading key/value schema using Pulsar admin (#5000)\n\n### Motivation\r\nTo fix #4840", "commitDateTime": "2019-08-27 16:31:55", "authoredDateTime": "2019-08-28 07:31:55", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/SchemasResource.java", "insertions": 41, "deletions": 35, "lines": 76}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiSchemaTest.java", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/SchemasImpl.java", "insertions": 9, "deletions": 3, "lines": 12}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SchemasResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.SchemasResource.postSchema(java.lang.String,java.lang.String,java.lang.String,org.apache.pulsar.common.protocol.schema.PostSchemaPayload,boolean,javax.ws.rs.container.AsyncResponse)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "AdminApiSchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiSchemaTest.createKeyValueSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemasImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.internal.SchemasImpl.convertSchemaDataToStringLegacy(byte[])", "TOT": 3, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.SchemasImpl.convertSchemaDataToStringLegacy(org.apache.pulsar.common.schema.SchemaInfo)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.SchemasImpl.convertSchemaInfoToPostSchemaPayload(org.apache.pulsar.common.schema.SchemaInfo)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "NPE is thrown when a consumer consumes a partitioned topic with struct schema", "body": "**Describe the bug**\r\n\r\nNPE is thrown when a consumer consumes a partitioned topic (which doesn't have any registered schema) with struct schema.\r\n\r\n```\r\nCaused by: java.util.concurrent.ExecutionException: java.lang.NullPointerException\r\n\tat java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)\r\n\tat org.apache.pulsar.client.impl.ConsumerBuilderImpl.subscribe(ConsumerBuilderImpl.java:89)\r\n\t... 29 more\r\nCaused by: java.lang.NullPointerException\r\n\tat org.apache.pulsar.client.impl.PulsarClientImpl.preProcessSchemaBeforeSubscribe(PulsarClientImpl.java:749)\r\n\tat org.apache.pulsar.client.impl.PulsarClientImpl.singleTopicSubscribeAsync(PulsarClientImpl.java:332)\r\n\tat org.apache.pulsar.client.impl.PulsarClientImpl.subscribeAsync(PulsarClientImpl.java:324)\r\n\tat org.apache.pulsar.client.impl.ConsumerBuilderImpl.subscribeAsync(ConsumerBuilderImpl.java:107)\r\n\t... 30 more\r\n```", "url": "https://github.com/apache/pulsar/issues/4838", "user": "sijie", "labels": ["component/schemaregistry", "triage/week-31", "type/bug"], "created": "2019-07-28 08:38:04", "closed": "2019-08-25 22:13:06", "commits": {"a3609ef0947a0d2c3fe7c2ad3a8f9cda7d4ebd62": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 28.00027777777778, "commitsDetails": [{"commitHash": "a3609ef0947a0d2c3fe7c2ad3a8f9cda7d4ebd62", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["dd5b4d08ead655dd4917944779bff1702f48f52c"], "nameRev": "a3609ef0947a0d2c3fe7c2ad3a8f9cda7d4ebd62 tags/v2.5.0-candidate-1~430", "commitMessage": "Consumer subscribe with AutoConsumeSchema will throw npe  (#4960)\n\n### Motivation\r\nTo fix #4838 \r\n", "commitDateTime": "2019-08-25 15:13:05", "authoredDateTime": "2019-08-26 06:13:05", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MessageImpl.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "insertions": 7, "deletions": 4, "lines": 11}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AutoConsumeSchema.java", "insertions": 45, "deletions": 8, "lines": 53}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/SchemaTest.java", "insertions": 82, "deletions": 39, "lines": 121}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/Schemas.java", "insertions": 6, "deletions": 0, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "MessageImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl.getValue()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PulsarClientImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.preProcessSchemaBeforeSubscribe(org.apache.pulsar.client.impl.PulsarClientImpl,org.apache.pulsar.client.api.Schema,java.lang.String)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "AutoConsumeSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoConsumeSchema.getSchemaInfo()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoConsumeSchema.configureSchemaInfo(java.lang.String,java.lang.String,org.apache.pulsar.common.schema.SchemaInfo)", "TOT": 11, "UPD": 0, "INS": 4, "MOV": 6, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoConsumeSchema", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoConsumeSchema.generateSchema(org.apache.pulsar.common.schema.SchemaInfo)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoConsumeSchema.decode(byte[],byte[])", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoConsumeSchema.setSchemaInfoProvider(org.apache.pulsar.client.api.schema.SchemaInfoProvider)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "SchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.schema.SchemaTest.testMultiVersionSchema()", "TOT": 26, "UPD": 3, "INS": 4, "MOV": 15, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.tests.integration.schema.SchemaTest.testAvroLogicalType()", "TOT": 21, "UPD": 1, "INS": 3, "MOV": 14, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.tests.integration.schema.SchemaTest.testAutoConsumeSchemaSubscribeFirst()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Schemas.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.schema.Schemas.AvroLogicalType", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Pulsar schema doesn't do compatibility check for primitive types", "body": "**Describe the bug**\r\n\r\nCurrently Pulsar schema doesn't do compatibility check for primitive types. That says if a consumer connect to a topic with a different schema type. It still can connect and receive messages. Exception is only thrown when retrieving the values from the received messages.\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\n1. Send messages with `Schema.STRING`\r\n2. Consume messages with `Schema.INT32`\r\n\r\n**Expected behavior**\r\n\r\nThe consumer should be rejected when subscribing.\r\n", "url": "https://github.com/apache/pulsar/issues/4831", "user": "sijie", "labels": ["component/schemaregistry", "triage/week-31", "type/bug"], "created": "2019-07-27 06:46:50", "closed": "2019-08-27 22:57:05", "commits": {"147c3c8d29b9e1feda5f976c0d00503750538551": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 31.00027777777778, "commitsDetails": [{"commitHash": "147c3c8d29b9e1feda5f976c0d00503750538551", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["d22e0143513c61fe7584deef2eeba913189153c1"], "nameRev": "147c3c8d29b9e1feda5f976c0d00503750538551 tags/v2.5.0-candidate-1~416", "commitMessage": "Add compatibility check for primitive schema types (#5051)\n\n### Motivation\r\nTo fix #4831", "commitDateTime": "2019-08-27 15:57:04", "authoredDateTime": "2019-08-28 06:57:04", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/SchemaTest.java", "insertions": 61, "deletions": 0, "lines": 61}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SchemaRegistryServiceImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.isCompatible(org.apache.pulsar.broker.service.schema.SchemaAndMetadata,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "SchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.schema.SchemaTest.testPrimitiveSchemaTypeCompatibilityCheck()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Pulsar-CPP-client-TLS : publish gets stuck when multiple producers publish on same ssl connection", "body": "### Bug\r\nPulsar-CPP client:\r\nwhen multiple producers try to publish messages using same tls connection then publish gets stuck as boost::asio is not [thread-safe](https://stackoverflow.com/questions/15352472/using-boosts-ssl-asio-code-async-write-some-hangs)\r\nthread stack-trace when process gets stuck on publish\r\n```\r\nThread 7 (Thread 0x7fe51a1ff700 (LWP 8684)):\r\n#0  0x0000003b984e4e5b in ?? () from /usr/lib64/libcrypto.so.10\r\n#1  0x0000003b984dd047 in BIO_write () from /usr/lib64/libcrypto.so.10\r\n\r\n#2  0x0000003b9c02b7a4 in ssl3_write_pending () from /usr/lib64/libssl.so.10\r\n\r\n#3  0x0000003b9c02c015 in ssl3_write_bytes () from /usr/lib64/libssl.so.10\r\n\r\n#4  0x00007fe556772612 in boost::asio::ssl::detail::engine::perform (this=0x7fe516537e08, op=<optimized out>, data=0x7fe516ad384d, length=862, ec=..., \r\n    bytes_transferred=0x7fe51a1fca20) at /home/y/include/boost/asio/ssl/detail/impl/engine.ipp:238\r\n\r\n#5  0x00007fe556784c75 in boost::asio::ssl::detail::engine::write (bytes_transferred=@0x7fe51a1fca20: 0, ec=..., data=<synthetic pointer>..., this=<optimized out>)\r\n    at /home/y/include/boost/asio/ssl/detail/impl/engine.ipp:157\r\n\r\n#6  boost::asio::ssl::detail::write_op<boost::asio::detail::consuming_buffers<boost::asio::const_buffer, pulsar::CompositeSharedBuffer<2> > >::operator() (\r\n    bytes_transferred=@0x7fe51a1fca20: 0, ec=..., eng=..., this=0x7fe51a1fc970) at /home/y/include/boost/asio/ssl/detail/write_op.hpp:51\r\n\r\n#7  boost::asio::ssl::detail::io_op<boost::asio::basic_stream_socket<boost::asio::ip::tcp, boost::asio::stream_socket_service<boost::asio::ip::tcp> >, boost::asio::ssl::detail::write_op<boost::asio::detail::consuming_buffers<boost::asio::const_buffer, pulsar::CompositeSharedBuffer<2> > >, boost::asio::detail::write_op<boost::asio::ssl::stream<boost::asio::basic_stream_socket<boost::asio::ip::tcp, boost::asio::stream_socket_service<boost::asio::ip::tcp> >&>, pulsar::CompositeSharedBuffer<2>, boost::asio::detail::transfer_all_t, AllocHandler<boost::_bi::bind_t<void, boost::_mfi::mf1<void, pulsar::ClientConnection, boost::system::error_code const&>, boost::_bi::list2<boost::_bi::value<std::shared_ptr<pulsar::ClientConnection> >, boost::arg<1> > > > > >::operator() (this=0x7fe51a1fc960, ec=..., bytes_transferred=<optimized out>, start=1)\r\n    at /home/y/include/boost/asio/ssl/detail/io.hpp:140\r\n```\r\n\r\n**Fix:**\r\nAvoid concurrent threads writing using ssl and it can work with boost 1.60 and 1.66 both version: https://stackoverflow.com/questions/12794107/why-do-i-need-strand-per-connection-when-using-boostasio/12801042#12801042\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4830", "user": "rdhabalia", "labels": ["type/bug"], "created": "2019-07-27 00:37:02", "closed": "2019-07-29 04:30:38", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Regex patten based topic consumers prevent topic deletion", "body": "**Describe the bug**\r\nI am using Java client libraries. I created a consumer using `topicsPattern` for a regex pattern. As new topics matching the pattern get created, the consumer starts consuming from it. This is expected. However, I delete a topic that the consumer is consuming (even with an -f option); the topic does not get deleted (looks like it gets re-created). This is NOT EXPECTED, and is a DEFECT.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a consumer using `topicsPattern` for a regex pattern say `persistent://public/default/test.*`\r\n2. Create producers to start sending messages to topics test01, test02, test03 etc.\r\n3. Once the consumer consumes the messages, stop producing to these topics\r\n4. Execute `./pulsar-admin topics list public/default` and verify that these topics do exist.\r\n5. Execute `./pulsar-admin topics delete -f persistent://public/default/test02` to delete the topic. \r\n6. No errors are shown.\r\n7. However, execute `./pulsar-admin topics list public/default` again and notice that test02 continues to exist. \r\n\r\n**Expected behavior**\r\nThe system should allow deletion of topics even if regex pattern-based consumers have been attached to a topic.\r\n\r\n**Screenshots**\r\nNA\r\n\r\n**Desktop (please complete the following information):**\r\n - Java\r\n\r\n**Additional context**\r\nThis problem gains importance as we want some listeners to ALL topics matching a certain pattern. And we have strong business reasons for the topics to be ephemeral in nature (create on demand, and delete when the work for that named topic is over)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4824", "user": "AnandSinha", "labels": ["component/client", "triage/week-31", "type/bug"], "created": "2019-07-26 06:33:05", "closed": "2020-05-18 23:24:18", "commits": {}, "ttf": 297.0002777777778, "commitsDetails": []}, {"title": "Pulsar schema api should respect to namespace level compatibility", "body": "**Describe the bug**\r\nCurrently the schema restful api is using `SchemaCompatibilityStrategy.FULL`\r\n\r\nhttps://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/SchemasResource.java#L268\r\n\r\nIt should use the compatibility strategy configured at namespace level.\r\n", "url": "https://github.com/apache/pulsar/issues/4821", "user": "sijie", "labels": ["component/schemaregistry", "triage/week-30", "type/bug"], "created": "2019-07-26 03:51:30", "closed": "2019-08-22 23:44:36", "commits": {"958dcfee764285f12044d2b626960968569c7302": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "85a5b18e0092796b4e88cff3d2ab127cd527ef20": {"commitGHEventType": "referenced", "commitUser": "wolfstudy"}}, "ttf": 27.00027777777778, "commitsDetails": [{"commitHash": "958dcfee764285f12044d2b626960968569c7302", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["ee158d9fe558457fa4ad3ff057b15ebecc1871a7"], "nameRev": "958dcfee764285f12044d2b626960968569c7302 tags/v2.5.0-candidate-1~437", "commitMessage": "Modify rest api post schema compatibility strategy (#4950)\n\n### Motivation\r\nTo fix #4821 \r\n", "commitDateTime": "2019-08-22 16:44:35", "authoredDateTime": "2019-08-23 07:44:35", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 31, "deletions": 0, "lines": 31}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/SchemasResource.java", "insertions": 42, "deletions": 24, "lines": 66}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiSchemaTest.java", "insertions": 42, "deletions": 0, "lines": 42}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.getPartitionedTopicList(org.apache.pulsar.common.naming.TopicDomain)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.getNamespacePoliciesAsync(org.apache.pulsar.common.naming.NamespaceName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemasResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.SchemasResource.postSchema(java.lang.String,java.lang.String,java.lang.String,org.apache.pulsar.common.protocol.schema.PostSchemaPayload,boolean,javax.ws.rs.container.AsyncResponse)", "TOT": 16, "UPD": 4, "INS": 5, "MOV": 2, "DEL": 5}]}, {"spoonFilePath": "AdminApiSchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiSchemaTest.Foo1", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiSchemaTest.testPostSchemaCompatibilityStrategy()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "85a5b18e0092796b4e88cff3d2ab127cd527ef20", "commitGHEventType": "referenced", "commitUser": "wolfstudy", "commitParents": ["45eb10a03b7c4dec47c7e29e8c6e0554ab13524b"], "nameRev": "85a5b18e0092796b4e88cff3d2ab127cd527ef20 tags/v2.4.2-candidate-1~83", "commitMessage": "Modify rest api post schema compatibility strategy (#4950)\n\n### Motivation\r\nTo fix #4821 \r\n\n(cherry picked from commit 958dcfee764285f12044d2b626960968569c7302)\n", "commitDateTime": "2019-11-19 13:37:41", "authoredDateTime": "2019-08-23 07:44:35", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 31, "deletions": 0, "lines": 31}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/SchemasResource.java", "insertions": 42, "deletions": 24, "lines": 66}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiSchemaTest.java", "insertions": 42, "deletions": 0, "lines": 42}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.getPartitionedTopicList(org.apache.pulsar.common.naming.TopicDomain)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.getNamespacePoliciesAsync(org.apache.pulsar.common.naming.NamespaceName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemasResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.SchemasResource.postSchema(java.lang.String,java.lang.String,java.lang.String,org.apache.pulsar.common.protocol.schema.PostSchemaPayload,boolean,javax.ws.rs.container.AsyncResponse)", "TOT": 16, "UPD": 4, "INS": 5, "MOV": 2, "DEL": 5}]}, {"spoonFilePath": "AdminApiSchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiSchemaTest.Foo1", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiSchemaTest.testPostSchemaCompatibilityStrategy()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Pulsar cannot resolve AWS ELB URL", "body": "**Describe the bug**\r\nPulsar libraries cannot connect to Pulsar via a Load Balancer URL setup as a part of the 'streamlio-admin ingress create' command. If you directly use one of the IP addresses that the URL resolves to the code is able to connect to Pulsar. However, AWS recommends against the use of individual IP addresses directly and to use the ELB LoadBalancer URL. \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n**Java code:** \r\ntry {\r\n    client = PulsarClient.builder()\r\n            .serviceUrl(\"pulsar://a5b327ee3ad6d11e989f80a0e47fe403-954928901.us-east-1.elb.amazonaws.com:6650\")\r\n            .build();\r\n}\r\n\r\n**Error:**\r\nWARNING: sun.reflect.Reflection.getCallerClass is not supported. This will impact performance.\r\nERROR StatusLogger No log4j2 configuration file found. Using default configuration: logging only errors to the console. Set system property 'log4j2.debug' to show Log4j2 internal initialization logging.\r\norg.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext$SearchDomainUnknownHostException: Search domain query failed. Original hostname: 'a5b327ee3ad6d11e989f80a0e47fe403-954928901.us-east-1.elb.amazonaws.com' failed to resolve 'a5b327ee3ad6d11e989f80a0e47fe403-954928901.us-east-1.elb.amazonaws.com' after 6 queries\r\n        at org.apache.pulsar.client.impl.ConnectionPool.lambda$null$9(ConnectionPool.java:202)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404)\r\n        at org.apache.pulsar.shade.io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:335)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:834)\r\nCaused by: java.util.concurrent.CompletionException: org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext$SearchDomainUnknownHostException: Search domain query failed. Original hostname: 'a5b327ee3ad6d11e989f80a0e47fe403-954928901.us-east-1.elb.amazonaws.com' failed to resolve 'a5b327ee3ad6d11e989f80a0e47fe403-954928901.us-east-1.elb.amazonaws.com' after 6 queries\r\n        at java.base/java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:331)\r\n        at java.base/java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:346)\r\n        at java.base/java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:1063)\r\n        at java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506)\r\n        at java.base/java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088)\r\n        at org.apache.pulsar.client.impl.ConnectionPool.lambda$resolveName$16(ConnectionPool.java:259)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:511)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:485)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:424)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:121)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext$2.operationComplete(DnsResolveContext.java:198)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:511)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:485)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:424)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:121)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext.finishResolve(DnsResolveContext.java:856)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext.tryToFinishResolve(DnsResolveContext.java:809)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext.query(DnsResolveContext.java:332)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext.access$600(DnsResolveContext.java:62)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext$3.operationComplete(DnsResolveContext.java:381)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:511)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:485)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:424)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.addListener(DefaultPromise.java:162)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.addListener(DefaultPromise.java:33)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext.query(DnsResolveContext.java:356)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext.access$600(DnsResolveContext.java:62)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext$3.operationComplete(DnsResolveContext.java:381)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:511)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:504)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:483)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:424)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:121)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsQueryContext.setFailure(DnsQueryContext.java:220)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsQueryContext.access$300(DnsQueryContext.java:43)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsQueryContext$4.run(DnsQueryContext.java:170)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.PromiseTask$RunnableAdapter.call(PromiseTask.java:38)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.ScheduledFutureTask.run(ScheduledFutureTask.java:127)\r\n        ... 6 more\r\nCaused by: org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext$SearchDomainUnknownHostException: Search domain query failed. Original hostname: 'a5b327ee3ad6d11e989f80a0e47fe403-954928901.us-east-1.elb.amazonaws.com' failed to resolve 'a5b327ee3ad6d11e989f80a0e47fe403-954928901.us-east-1.elb.amazonaws.com' after 6 queries\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext.finishResolve(DnsResolveContext.java:848)\r\n        ... 28 more\r\nCaused by: org.apache.pulsar.shade.io.netty.resolver.dns.DnsNameResolverException: [/fec0:0:0:ffff:0:0:0:1:53] failed to send a query (no stack trace available)\r\nCaused by: org.apache.pulsar.shade.io.netty.channel.unix.Errors$NativeIoException: sendToAddress(..) failed: Network is unreachable\r\n        at org.apache.pulsar.shade.io.netty.channel.unix.Errors.newIOException(Errors.java:122)\r\n        at org.apache.pulsar.shade.io.netty.channel.unix.Errors.ioResult(Errors.java:146)\r\n        at org.apache.pulsar.shade.io.netty.channel.unix.Socket.sendToAddress(Socket.java:175)\r\n        at org.apache.pulsar.shade.io.netty.channel.epoll.EpollDatagramChannel.doWriteMessage(EpollDatagramChannel.java:347)\r\n        at org.apache.pulsar.shade.io.netty.channel.epoll.EpollDatagramChannel.doWrite(EpollDatagramChannel.java:300)\r\n        at org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AbstractUnsafe.flush0(AbstractChannel.java:938)\r\n        at org.apache.pulsar.shade.io.netty.channel.epoll.AbstractEpollChannel$AbstractEpollUnsafe.flush0(AbstractEpollChannel.java:512)\r\n        at org.apache.pulsar.shade.io.netty.channel.AbstractChannel$AbstractUnsafe.flush(AbstractChannel.java:905)\r\n        at org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.flush(DefaultChannelPipeline.java:1396)\r\n        at org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeFlush0(AbstractChannelHandlerContext.java:776)\r\n        at org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeFlush(AbstractChannelHandlerContext.java:768)\r\n        at org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.flush(AbstractChannelHandlerContext.java:749)\r\n        at org.apache.pulsar.shade.io.netty.channel.ChannelOutboundHandlerAdapter.flush(ChannelOutboundHandlerAdapter.java:115)\r\n        at org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeFlush0(AbstractChannelHandlerContext.java:776)\r\n        at org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeWriteAndFlush(AbstractChannelHandlerContext.java:802)\r\n        at org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:814)\r\n        at org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.writeAndFlush(AbstractChannelHandlerContext.java:794)\r\n        at org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.writeAndFlush(DefaultChannelPipeline.java:1066)\r\n        at org.apache.pulsar.shade.io.netty.channel.AbstractChannel.writeAndFlush(AbstractChannel.java:309)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsQueryContext.writeQuery(DnsQueryContext.java:139)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsQueryContext.sendQuery(DnsQueryContext.java:118)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsQueryContext.query(DnsQueryContext.java:113)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsNameResolver.query0(DnsNameResolver.java:1109)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext.query(DnsResolveContext.java:350)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext.access$600(DnsResolveContext.java:62)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext$3.operationComplete(DnsResolveContext.java:381)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:511)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:504)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:483)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:424)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:121)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsQueryContext.setFailure(DnsQueryContext.java:220)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsQueryContext.access$300(DnsQueryContext.java:43)\r\n        at org.apache.pulsar.shade.io.netty.resolver.dns.DnsQueryContext$4.run(DnsQueryContext.java:170)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.PromiseTask$RunnableAdapter.call(PromiseTask.java:38)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.ScheduledFutureTask.run(ScheduledFutureTask.java:127)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404)\r\n        at org.apache.pulsar.shade.io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:335)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:834)\r\n\r\nnslookup on the LoadBalancer URL gives the following:\r\n nslookup ab30d3c79aee611e9acf102a8b3fc243-31673255.us-east-1.elb.amazonaws.com\r\nServer:         172.31.0.2\r\nAddress:        172.31.0.2#53\r\n\r\nNon-authoritative answer:\r\nName:   ab30d3c79aee611e9acf102a8b3fc243-31673255.us-east-1.elb.amazonaws.com\r\nAddress: 23.23.22.177\r\nName:   ab30d3c79aee611e9acf102a8b3fc243-31673255.us-east-1.elb.amazonaws.com\r\nAddress: 34.199.105.217\r\nName:   ab30d3c79aee611e9acf102a8b3fc243-31673255.us-east-1.elb.amazonaws.com\r\nAddress: 3.210.69.95\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 18.04\r\n\r\n**Additional context**\r\n\r\nLooks like the issue is with 'org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext$' not being able to handle multiple URLs when the LoadBalancer IP address resolves to multiple addresses. When the code uses individual IP addresses the code works without issues. But as mentioned above AWS recommends against using individual addresses directly as it defeats the purpose of loadbalancing. \r\n", "url": "https://github.com/apache/pulsar/issues/4812", "user": "sudeepamin", "labels": ["type/bug"], "created": "2019-07-25 16:25:11", "closed": "2019-07-26 03:53:27", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "TYPO in C++ client producer method for processing failure case", "body": "**Describe the bug**\r\nInside file pulsar/pulsar-client-cpp/lib/ProducerImpl.cc, the method:\r\n`void ProducerImpl::failPendingMessages(Result result) `\r\nis designed for processing all the failure cases on publishing messages. As the exact result is given by parameter, so every registered message callback should be invoked with exactly the same result. But actually, In the final line of this method, the given code like this:\r\n`    BatchMessageContainer::batchMessageCallBack(ResultTimeout, messageContainerListPtr, NULL);\r\n`\r\nDefinitely, this a typo, as the method should report the callback with the GIVEN result stat, but not a CERTAIN result stat.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4808", "user": "easyfan", "labels": ["component/c++", "component/client", "triage/week-30", "type/bug"], "created": "2019-07-25 11:23:01", "closed": "2020-01-14 17:50:53", "commits": {"b90b4ea1d1397e3707e6f51151492feff5a75ba6": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "e4790f374d1036be43d1c091baae95b017ecd47c": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 173.00027777777777, "commitsDetails": [{"commitHash": "b90b4ea1d1397e3707e6f51151492feff5a75ba6", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["5ff464b58acf4a96cbee4e68e3889021b5574ceb"], "nameRev": "b90b4ea1d1397e3707e6f51151492feff5a75ba6 tags/v2.5.0-candidate-1~487", "commitMessage": "Merge Request for #4808: TYPO in C++ client producer method for processing failure case, and add corresponding unit test case. (#4873)\n\nDefinitely, this is a typo. This method is dealing with the Failed Message with the GIVEN result, but not a CERTAIN result.\r\n\r\nContribution Checklist\r\n#4808 : TYPO in C++ client producer method for processing failure case\r\nAdd c++ client producer failure message unit test case.\r\n\r\nUT passed:\r\n\r\nBatchMessageTest", "commitDateTime": "2019-08-05 14:41:42", "authoredDateTime": "2019-08-05 14:41:42", "commitGitStats": [{"filePath": "pulsar-client-cpp/include/pulsar/Producer.h", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-client-cpp/lib/Producer.cc", "insertions": 7, "deletions": 0, "lines": 7}, {"filePath": "pulsar-client-cpp/lib/ProducerImpl.cc", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-cpp/lib/ProducerImpl.h", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-client-cpp/tests/BatchMessageTest.cc", "insertions": 34, "deletions": 0, "lines": 34}, {"filePath": "pulsar-client-cpp/tests/PulsarFriend.h", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "e4790f374d1036be43d1c091baae95b017ecd47c", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["ade9542385175295423ac2aedd169c53cfb5a436"], "nameRev": "e4790f374d1036be43d1c091baae95b017ecd47c tags/v2.4.1-candidate-1~1", "commitMessage": "Merge Request for #4808: TYPO in C++ client producer method for processing failure case, and add corresponding unit test case. (#4873)\n\nDefinitely, this is a typo. This method is dealing with the Failed Message with the GIVEN result, but not a CERTAIN result.\n\nContribution Checklist\n#4808 : TYPO in C++ client producer method for processing failure case\nAdd c++ client producer failure message unit test case.\n\nUT passed:\n\nBatchMessageTest\n(cherry picked from commit b90b4ea1d1397e3707e6f51151492feff5a75ba6)\n", "commitDateTime": "2019-08-28 16:00:16", "authoredDateTime": "2019-08-05 14:41:42", "commitGitStats": [{"filePath": "pulsar-client-cpp/include/pulsar/Producer.h", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-client-cpp/lib/Producer.cc", "insertions": 7, "deletions": 0, "lines": 7}, {"filePath": "pulsar-client-cpp/lib/ProducerImpl.cc", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-cpp/lib/ProducerImpl.h", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-client-cpp/tests/BatchMessageTest.cc", "insertions": 34, "deletions": 0, "lines": 34}, {"filePath": "pulsar-client-cpp/tests/PulsarFriend.h", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "KeyValue schema doesn't handle null key and null value well", "body": "**Describe the bug**\r\n\r\nSimilar as #4803, it is impossible to specify null key or null value in KeyValue schema. It throws exception as below:\r\n\r\n```\r\njava.lang.NullPointerException\r\n\tat java.util.Base64$Encoder.encode(Base64.java:261)\r\n\tat java.util.Base64$Encoder.encodeToString(Base64.java:315)\r\n\tat org.apache.pulsar.client.impl.TypedMessageBuilderImpl.value(TypedMessageBuilderImpl.java:109)\r\n```\r\n\r\n\r\n**To Reproduce**\r\n\r\n```\r\nproducer.newMessage().value(new KeyValue(null, \"test-value\")).send();\r\n```\r\n\r\n**Expected behavior**\r\n\r\nBe able to support `null` key and `null` value.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4804", "user": "sijie", "labels": ["component/client", "component/schemaregistry", "triage/week-30", "type/bug"], "created": "2019-07-25 06:40:09", "closed": "2020-06-04 14:01:14", "commits": {"1d5ff26ba42fb7ce6d9284d5bcffc1e3686a6f64": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 315.0002777777778, "commitsDetails": [{"commitHash": "1d5ff26ba42fb7ce6d9284d5bcffc1e3686a6f64", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["971ab0e2777900b2e8cf9d11c60e60bfd8842ffc"], "nameRev": "1d5ff26ba42fb7ce6d9284d5bcffc1e3686a6f64 tags/v2.6.0-candidate-1~52", "commitMessage": "Support KeyValue Schema Use Null Key And Null Value (#7139)\n\nFixes #4804  \r\n\r\nThanks, @nlu90, work at #6384.\r\n\r\n### Motivation\r\n\r\nCurrently, the KeyValue schema doesn't handle `null` key and `null` value well.", "commitDateTime": "2020-06-04 22:01:13", "authoredDateTime": "2020-06-04 22:01:13", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/NullValueTest.java", "insertions": 93, "deletions": 0, "lines": 93}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/common/schema/KeyValue.java", "insertions": 26, "deletions": 7, "lines": 33}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MessageImpl.java", "insertions": 13, "deletions": 5, "lines": 18}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TypedMessageBuilderImpl.java", "insertions": 21, "deletions": 4, "lines": 25}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/KeyValueSchema.java", "insertions": 18, "deletions": 6, "lines": 24}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/proto/PulsarApi.java", "insertions": 114, "deletions": 0, "lines": 114}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Commands.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-common/src/main/proto/PulsarApi.proto", "insertions": 5, "deletions": 0, "lines": 5}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NullValueTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.NullValueTest.keyValueNullInlineTest()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.NullValueTest.keyValueNullSeparatedTest()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KeyValue.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.schema.KeyValue.encode(java.lang.Object,org.apache.pulsar.client.api.Schema,java.lang.Object,org.apache.pulsar.client.api.Schema)", "TOT": 8, "UPD": 0, "INS": 4, "MOV": 4, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.schema.KeyValue.decode(byte[],org.apache.pulsar.common.schema.KeyValue$KeyValueDecoder)", "TOT": 8, "UPD": 0, "INS": 4, "MOV": 4, "DEL": 0}]}, {"spoonFilePath": "MessageImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl.getKeyValue()", "TOT": 6, "UPD": 0, "INS": 3, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl.getKeyValueBySchemaVersion()", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl.getValue()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "TypedMessageBuilderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TypedMessageBuilderImpl.key(java.lang.String)", "TOT": 8, "UPD": 0, "INS": 3, "MOV": 4, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TypedMessageBuilderImpl.keyBytes(byte[])", "TOT": 8, "UPD": 0, "INS": 3, "MOV": 4, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TypedMessageBuilderImpl.value(java.lang.Object)", "TOT": 9, "UPD": 0, "INS": 4, "MOV": 5, "DEL": 0}]}, {"spoonFilePath": "KeyValueSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchema.decode(byte[],byte[],byte[])", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchema.encode(org.apache.pulsar.common.schema.KeyValue)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarApi.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.hasNullPartitionKey()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.getNullPartitionKey()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.hasNullPartitionKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.getNullPartitionKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.hasNullPartitionKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.getNullPartitionKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.initFields()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.writeTo(org.apache.pulsar.common.util.protobuf.ByteBufCodedOutputStream)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.getSerializedSize()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.hasNullPartitionKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.getNullPartitionKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.setNullPartitionKey(boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.clearNullPartitionKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.initFields()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.writeTo(org.apache.pulsar.common.util.protobuf.ByteBufCodedOutputStream)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.getSerializedSize()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.hasNullPartitionKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.getNullPartitionKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.setNullPartitionKey(boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.clearNullPartitionKey()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.clear()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.buildPartial()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.mergeFrom(org.apache.pulsar.common.api.proto.PulsarApi$MessageMetadata)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.clear()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.buildPartial()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.mergeFrom(org.apache.pulsar.common.api.proto.PulsarApi$SingleMessageMetadata)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.mergeFrom(org.apache.pulsar.common.util.protobuf.ByteBufCodedInputStream,org.apache.pulsar.shaded.com.google.protobuf.v241.ExtensionRegistryLite)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.mergeFrom(org.apache.pulsar.common.util.protobuf.ByteBufCodedInputStream,org.apache.pulsar.shaded.com.google.protobuf.v241.ExtensionRegistryLite)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Commands.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.protocol.Commands.serializeSingleMessageInBatchWithPayload(org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata$Builder,io.netty.buffer.ByteBuf,io.netty.buffer.ByteBuf)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Pulsar schema doesn't support null value", "body": "**Describe the bug**\r\n\r\nIf a Pulsar producer sends messages without payload, Pulsar consumer is not able to consume the messages without payload. Because the payload passed to schema is an empty array not `null`. Hence exceptions are thrown. An example exception is shown as below:\r\n\r\n```\r\norg.apache.pulsar.client.api.SchemaSerializationException: Size of data received by BooleanSchema is not 1\r\n\r\n\tat org.apache.pulsar.client.impl.schema.BooleanSchema.validate(BooleanSchema.java:44)\r\n\tat org.apache.pulsar.client.impl.schema.BooleanSchema.decode(BooleanSchema.java:62)\r\n\tat org.apache.pulsar.client.impl.schema.BooleanSchema.decode(BooleanSchema.java:29)\r\n\tat org.apache.pulsar.client.impl.MessageImpl.getValue(MessageImpl.java:273)\r\n\tat org.apache.pulsar.client.impl.TopicMessageImpl.getValue(TopicMessageImpl.java:143)\r\n```\r\n\r\n**To Reproduce**\r\n\r\n1. Use a typed producer to send messages without setting value.\r\n2. Use a typed consumer to receive messages.\r\n\r\n**Expected behavior**\r\n\r\nThe typed consumer should receive messages with a `null` value.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4803", "user": "sijie", "labels": ["component/client", "component/schemaregistry", "triage/week-30", "type/bug"], "created": "2019-07-25 06:21:09", "closed": "2020-05-19 06:11:43", "commits": {"d55bc00f34a2fa763a3756fa0adbb1366ae319bd": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 298.0002777777778, "commitsDetails": [{"commitHash": "d55bc00f34a2fa763a3756fa0adbb1366ae319bd", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["1d5c418ccf3f2dc0844e735e5ff4bf0dd2f5738f"], "nameRev": "d55bc00f34a2fa763a3756fa0adbb1366ae319bd tags/v2.6.0-candidate-1~173", "commitMessage": "[Issue 4803][client] return null if the message value/data is not set by producer (#6379)\n\nFixes #4803 \r\n\r\n### Motivation\r\nAllow the typed consumer receive messages with `null` value if the producer sends message without payload.\r\n\r\n### Modifications\r\n- add a flag in `MessageMetadata` to indicate if the payload is set when the message is created\r\n- check and return `null` if the flag is not set when reading data from a message", "commitDateTime": "2020-05-19 14:11:42", "authoredDateTime": "2020-05-18 23:11:42", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java", "insertions": 34, "deletions": 14, "lines": 48}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/NullValueTest.java", "insertions": 148, "deletions": 0, "lines": 148}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/TopicsImpl.java", "insertions": 12, "deletions": 4, "lines": 16}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MessageImpl.java", "insertions": 16, "deletions": 3, "lines": 19}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TypedMessageBuilderImpl.java", "insertions": 4, "deletions": 2, "lines": 6}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/MessageImplTest.java", "insertions": 15, "deletions": 0, "lines": 15}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/proto/PulsarApi.java", "insertions": 114, "deletions": 0, "lines": 114}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Commands.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-common/src/main/proto/PulsarApi.proto", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-flink/src/test/java/org/apache/flink/streaming/connectors/pulsar/PulsarConsumerSourceTests.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-functions/worker/src/test/java/org/apache/pulsar/functions/worker/FunctionRuntimeManagerTest.java", "insertions": 5, "deletions": 3, "lines": 8}, {"filePath": "pulsar-storm/src/test/java/org/apache/pulsar/storm/PulsarSpoutTest.java", "insertions": 5, "deletions": 2, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.generateResponseWithEntry(org.apache.bookkeeper.mledger.Entry)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.publishNullValueMessageOnPersistentTopic(java.lang.String,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.persistentTopics(java.lang.String)", "TOT": 8, "UPD": 0, "INS": 7, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.publishMessagesOnPersistentTopic(java.lang.String,int,int,boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.publishMessagesOnPersistentTopic(java.lang.String,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.persistentTopicsCursorReset(java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.persistentTopicsCursorResetAfterReset(java.lang.String)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.persistentTopicsCursorResetAndFailover()", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.partitionedTopicsCursorReset(java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.publishMessagesOnPersistentTopic(java.lang.String,int,int)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "NullValueTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.NullValueTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicsImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getMessagesFromHttpResponse(java.lang.String,javax.ws.rs.core.Response)", "TOT": 5, "UPD": 0, "INS": 5, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.TopicsImpl.getIndividualMsgsFromBatch(java.lang.String,java.lang.String,byte[],java.util.Map,org.apache.pulsar.common.api.proto.PulsarApi$MessageMetadata$Builder)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.enqueueMessageAndCheckBatchReceive(org.apache.pulsar.client.api.Message)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.messageProcessed(org.apache.pulsar.client.api.Message)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "MessageImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl", "TOT": 5, "UPD": 0, "INS": 5, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl.getData()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageImpl.getValue()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TypedMessageBuilderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TypedMessageBuilderImpl.value(java.lang.Object)", "TOT": 6, "UPD": 1, "INS": 1, "MOV": 3, "DEL": 1}]}, {"spoonFilePath": "MessageImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessageImplTest.testTypedSchemaGetNullValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarApi.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.hasNullValue()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.getNullValue()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.hasNullValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.getNullValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.hasNullValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.getNullValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.initFields()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.writeTo(org.apache.pulsar.common.util.protobuf.ByteBufCodedOutputStream)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.getSerializedSize()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.hasNullValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.getNullValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.setNullValue(boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.clearNullValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.initFields()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.writeTo(org.apache.pulsar.common.util.protobuf.ByteBufCodedOutputStream)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.getSerializedSize()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.hasNullValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.getNullValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.setNullValue(boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.clearNullValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.clear()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.buildPartial()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.mergeFrom(org.apache.pulsar.common.api.proto.PulsarApi$MessageMetadata)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.clear()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.buildPartial()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.mergeFrom(org.apache.pulsar.common.api.proto.PulsarApi$SingleMessageMetadata)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata.Builder.mergeFrom(org.apache.pulsar.common.util.protobuf.ByteBufCodedInputStream,org.apache.pulsar.shaded.com.google.protobuf.v241.ExtensionRegistryLite)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.SingleMessageMetadata.Builder.mergeFrom(org.apache.pulsar.common.util.protobuf.ByteBufCodedInputStream,org.apache.pulsar.shaded.com.google.protobuf.v241.ExtensionRegistryLite)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Commands.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.protocol.Commands.serializeSingleMessageInBatchWithPayload(org.apache.pulsar.common.api.proto.PulsarApi.MessageMetadata$Builder,io.netty.buffer.ByteBuf,io.netty.buffer.ByteBuf)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarConsumerSourceTests.java", "spoonMethods": [{"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarConsumerSourceTests.createMessage(java.lang.String,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "FunctionRuntimeManagerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.worker.FunctionRuntimeManagerTest.testRuntimeManagerInitialize()", "TOT": 5, "UPD": 0, "INS": 4, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PulsarSpoutTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.storm.PulsarSpoutTest.testAckFailedMessage()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.storm.PulsarSpoutTest.testPulsarSpout(boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[documentation] Add documentation for delayed message delivery", "body": "The documentation for delayed message delivery is missing.\r\n", "url": "https://github.com/apache/pulsar/issues/4794", "user": "sijie", "labels": ["component/documentation", "triage/week-30", "type/bug"], "created": "2019-07-24 10:54:57", "closed": "2019-07-26 04:15:35", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "[documentation] Add documentation for replicated subscription", "body": "The replicated subscription documentation is missing.\r\n", "url": "https://github.com/apache/pulsar/issues/4793", "user": "sijie", "labels": ["component/documentation", "triage/week-30", "type/bug"], "created": "2019-07-24 10:52:01", "closed": "2020-06-10 04:51:40", "commits": {}, "ttf": 321.0002777777778, "commitsDetails": []}, {"title": "healthcheck report error: Trying to subscribe with incompatible schema", "body": "**Describe the bug**\r\nhealthcheck api report error\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. access http://127.0.0.1:8080/admin/v2/brokers/health\r\n2. see errors\r\n```\r\n --- An unexpected error occurred in the server ---\r\n\r\nMessage: org.apache.pulsar.client.api.PulsarClientException$IncompatibleSchemaException: Trying to subscribe with incompatible schema\r\n\r\nStacktrace:\r\n\r\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$IncompatibleSchemaException: Trying to subscribe with incompatible schema\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)\r\n\tat java.util.concurrent.CompletableFuture.uniRun(CompletableFuture.java:700)\r\n\tat java.util.concurrent.CompletableFuture$UniRun.tryFire(CompletableFuture.java:687)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:597)\r\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:154)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:323)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:297)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1434)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:965)\r\n\tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:799)\r\n\tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:433)\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:330)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\nCaused by: org.apache.pulsar.client.api.PulsarClientException$IncompatibleSchemaException: Trying to subscribe with incompatible schema\r\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:905)\r\n\t... 20 more\r\n```\r\n\r\n**Expected behavior**\r\n\r\n**Screenshots**\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [Linux]\r\n\r\n**Additional context**\r\nversion: apache-pulsar-2.4.0\r\naccess other broker/cluster api not encounter errors, like get http://127.0.0.1:8080/admin/v2/clusters successfully\r\nuse bin/pulsar-client to produce or consume data is ok", "url": "https://github.com/apache/pulsar/issues/4790", "user": "HeChuanXUPT", "labels": ["component/schemaregistry", "triage/week-30", "type/bug"], "created": "2019-07-24 08:45:56", "closed": "2019-11-06 06:05:18", "commits": {"86ccfe877e483cce8c8481f5933dfb906f92ab42": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 104.00027777777778, "commitsDetails": [{"commitHash": "86ccfe877e483cce8c8481f5933dfb906f92ab42", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["e0b36f9cc95aebb7767d4864e46026dfb7e89e08"], "nameRev": "86ccfe877e483cce8c8481f5933dfb906f92ab42 tags/v2.5.0-candidate-1~119", "commitMessage": "Add handle exception KeeperException.BadVersionException (#5563)\n\nFixes https://github.com/apache/pulsar/issues/4790\r\n\r\n\r\nMaster Issue: https://github.com/apache/pulsar/issues/4790\r\n\r\n### Motivation\r\nCurrently, when the brokerDeleteInactiveTopicsEnabled policy is enabled, the topic pulsar/standalone/127.0.0.1:8080/healthcheck will be deleted periodically, when creating producer and consumer for the second time https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/BrokersBase.java#L272, because both producer and consumer call putSchema in a short period of time, resulting in race conditions, Throwing exceptions of schema badVersion, only one of them could succeed. therefore, when badVersion exception occurs, call putSchema should be performed again. \r\n### Modifications\r\n\r\n* Add operation to handle exception KeeperException.BadVersionException\r\n\r\n### Verifying this change\r\n\r\n```\r\n./bin/pulsar standalone -nss -a 127.0.0.1\r\ncurl -v http://127.0.0.1:8080/admin/v2/brokers/health\r\n\r\n# Waiting for more than 60 seconds, waiting for the topic pulsar/standalone/127.0.0.1:8080/healthcheck to be deleted\r\n\r\ncurl -v http://127.0.0.1:8080/admin/v2/brokers/health\r\n```", "commitDateTime": "2019-11-06 14:05:17", "authoredDateTime": "2019-11-06 14:05:17", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorage.java", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BookkeeperSchemaStorage.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.putSchema(java.lang.String,byte[],byte[])", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["86ccfe877e483cce8c8481f5933dfb906f92ab42"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2, "deletions": 1, "lines": 3, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema"], "changesInPackagesSPOON": ["org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.putSchema(java.lang.String,byte[],byte[])"]}, {"title": "Sink ignores inputSpecs in configuration yaml on create", "body": "**Describe the bug**\r\nWhen creating a sink with an accompanying configuration yaml, I want to increase the receiverQueueSize so I have the following set in my configuration yaml\r\n\r\n```\r\ninputSpecs:\r\n  sample_topic_name:\r\n    receiverQueueSize: 1000000\r\n```\r\n\r\nhowever, my inputSpecs configuration settings are ignored after creation of the sink and receiverQueueSize is set to the default of 1000\r\n\r\n**To Reproduce**\r\n- **Create sink with pulsar admin cli**\r\n[solr_kerberos_io-2.3.2.yml](https://github.com/apache/pulsar/files/3423473/sink_config.txt)\r\n```\r\npulsar-admin --admin-url https://sample-admin:6751 sink create \\\r\n--sink-config-file /data/connectors/solr_kerberos_io-2.3.2.yml\r\n```\r\n\r\n`\"Created Successfully\"`\r\n\r\n- **Confirm sink settings**\r\n\r\n```\r\npulsar-admin --admin-url https://sample-admin:6751 sink get \\\r\n--tenant public \\\r\n--namespace default \\\r\n--name solr_kerberos\r\n\r\n{\r\n  \"tenant\": \"public\",\r\n  \"namespace\": \"default\",\r\n  \"name\": \"solr_kerberos\",\r\n  \"className\": \"org.apache.pulsar.io.solrcloud.SolrCloudSink\",\r\n  \"inputSpecs\": {\r\n    \"sample_topic_name\": {\r\n      \"isRegexPattern\": false\r\n    }\r\n  },\r\n  \"configs\": {\r\n    \"solrUrl\": \"http://sample-solr:8983/solr\",\r\n    \"loginConfigurationLocation\": \"/data/connectors/solr_kerberos_io_jaas.conf\",\r\n    \"collectionName\": \"sample_collection\",\r\n    \"documentQueueSize\": \"5000.0\",\r\n    \"concurrentThreadCount\": \"25.0\"\r\n  },\r\n  \"parallelism\": 3,\r\n  \"processingGuarantees\": \"ATLEAST_ONCE\",\r\n  \"retainOrdering\": false,\r\n  \"autoAck\": true,\r\n  \"archive\": \"builtin://solr_kerberos\"\r\n}\r\n```\r\n\r\n\r\n**Expected behavior**\r\nI expect the receiverQueueSize to be set to what I define it to be in the configuration yaml and not be overridden and/or ignored.\r\n\r\n**Desktop (please complete the following information):**\r\nNAME=\"Oracle Linux Server\"\r\nVERSION=\"7.6\"\r\nID=\"ol\"\r\nVARIANT=\"Server\"\r\nVARIANT_ID=\"server\"\r\nVERSION_ID=\"7.6\"\r\nPRETTY_NAME=\"Oracle Linux Server 7.6\"\r\n\r\n\r\n**Additional context**\r\nPulsar Version 2.3.2. Sink is running on a cluster of function workers/brokers/proxies. When creating a function using the same inputSpecs yaml entry the receiverQueueSize is set correctly. This issue only seems to be related to sinks\r\n", "url": "https://github.com/apache/pulsar/issues/4787", "user": "evanhlavaty", "labels": ["component/io", "triage/week-30", "type/bug"], "created": "2019-07-23 18:31:45", "closed": "2019-07-31 18:10:20", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "get the list of schema should return non-deleted schemas", "body": "#### Describe the bug\r\n\r\nget schema list is all schema is last version schema\r\n\r\n#### To Reproduce\r\nhttps://github.com/apache/pulsar/blob/cc5f25bf1a97609ad065908b9a60866c382ee2e0/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorage.java#L142\r\n", "url": "https://github.com/apache/pulsar/issues/4763", "user": "congbobo184", "labels": ["type/bug"], "created": "2019-07-19 02:55:09", "closed": "2019-07-21 07:28:12", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "[pulsar-test] Could not resolve host: github.com", "body": "**Describe the bug**\r\nDuring the test, the following exceptions are thrown frequently, causing the test to be interrupted. \r\n```\r\nNo credentials specified\r\nCloning the remote Git repository\r\nCloning repository https://github.com/apache/pulsar.git\r\n > git init /home/jenkins/jenkins-slave/workspace/pulsar_precommit_cpp # timeout=10\r\nFetching upstream changes from https://github.com/apache/pulsar.git\r\n > git --version # timeout=10\r\n > git fetch --tags --progress https://github.com/apache/pulsar.git +refs/heads/*:refs/remotes/origin/*\r\nERROR: Error cloning remote repo 'origin'\r\nhudson.plugins.git.GitException: Command \"git fetch --tags --progress https://github.com/apache/pulsar.git +refs/heads/*:refs/remotes/origin/*\" returned status code 128:\r\nstdout: \r\nstderr: fatal: unable to access 'https://github.com/apache/pulsar.git/': Could not resolve host: github.com\r\n\r\n\tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl.launchCommandIn(CliGitAPIImpl.java:2042)\r\n\tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl.launchCommandWithCredentials(CliGitAPIImpl.java:1761)\r\n\tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl.access$400(CliGitAPIImpl.java:72)\r\n\tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl$1.execute(CliGitAPIImpl.java:442)\r\n\tat org.jenkinsci.plugins.gitclient.CliGitAPIImpl$2.execute(CliGitAPIImpl.java:655)\r\n\tat org.jenkinsci.plugins.gitclient.RemoteGitImpl$CommandInvocationHandler$1.call(RemoteGitImpl.java:153)\r\n\tat org.jenkinsci.plugins.gitclient.RemoteGitImpl$CommandInvocationHandler$1.call(RemoteGitImpl.java:146)\r\n\tat hudson.remoting.UserRequest.perform(UserRequest.java:212)\r\n\tat hudson.remoting.UserRequest.perform(UserRequest.java:54)\r\n\tat hudson.remoting.Request$2.run(Request.java:369)\r\n\tat hudson.remoting.InterceptingExecutorService$1.call(InterceptingExecutorService.java:72)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n\tSuppressed: hudson.remoting.Channel$CallSiteStackTrace: Remote call to H27\r\n\t\tat hudson.remoting.Channel.attachCallSiteStackTrace(Channel.java:1741)\r\n\t\tat hudson.remoting.UserRequest$ExceptionResponse.retrieve(UserRequest.java:357)\r\n\t\tat hudson.remoting.Channel.call(Channel.java:955)\r\n\t\tat org.jenkinsci.plugins.gitclient.RemoteGitImpl$CommandInvocationHandler.execute(RemoteGitImpl.java:146)\r\n\t\tat sun.reflect.GeneratedMethodAccessor974.invoke(Unknown Source)\r\n\t\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\t\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\t\tat org.jenkinsci.plugins.gitclient.RemoteGitImpl$CommandInvocationHandler.invoke(RemoteGitImpl.java:132)\r\n\t\tat com.sun.proxy.$Proxy135.execute(Unknown Source)\r\n\t\tat hudson.plugins.git.GitSCM.retrieveChanges(GitSCM.java:1152)\r\n\t\tat hudson.plugins.git.GitSCM.checkout(GitSCM.java:1192)\r\n\t\tat hudson.scm.SCM.checkout(SCM.java:504)\r\n\t\tat hudson.model.AbstractProject.checkout(AbstractProject.java:1208)\r\n\t\tat hudson.model.AbstractBuild$AbstractBuildExecution.defaultCheckout(AbstractBuild.java:574)\r\n\t\tat jenkins.scm.SCMCheckoutStrategy.checkout(SCMCheckoutStrategy.java:86)\r\n\t\tat hudson.model.AbstractBuild$AbstractBuildExecution.run(AbstractBuild.java:499)\r\n\t\tat hudson.model.Run.execute(Run.java:1810)\r\n\t\tat hudson.model.FreeStyleBuild.run(FreeStyleBuild.java:43)\r\n\t\tat hudson.model.ResourceController.execute(ResourceController.java:97)\r\n\t\tat hudson.model.Executor.run(Executor.java:429)\r\n```\r\n\r\n**To Reproduce**\r\nSome example:\r\nhttps://builds.apache.org/job/pulsar_precommit_cpp/8613/console\r\nhttps://builds.apache.org/job/pulsar_precommit_cpp/8615/console\r\n\r\n**Expected behavior**\r\nThe test can pass.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4761", "user": "tuteng", "labels": ["component/test", "triage/week-29", "type/bug"], "created": "2019-07-19 01:50:36", "closed": "2020-01-14 17:57:52", "commits": {}, "ttf": 179.00027777777777, "commitsDetails": []}, {"title": "Broker's web threads get stuck", "body": "The other day, one of our broker servers became unable to respond to any HTTP request. The following is a part of the thread dump at that time.\r\n\r\n[threaddump.txt](https://github.com/apache/pulsar/files/3405487/threaddump.txt)\r\n\r\nIt seems that many `pulsar-web-x-x` threads are blocked trying to get a list of subscriptions.\r\n```\r\npulsar-web-28-70\" #8062317 prio=5 os_prio=0 tid=0x00007fb54c001000 nid=0xd261 waiting on condition [0x00007fb48d0b4000]\r\n   java.lang.Thread.State: WAITING (parking)\r\n    at sun.misc.Unsafe.park(Native Method)\r\n    - parking to wait for  <0x00007fc91e010000> (a java.util.concurrent.CompletableFuture$Signaller)\r\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\r\n    at java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1693)\r\n    at java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3323)\r\n    at java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1729)\r\n    at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)\r\n    at org.apache.pulsar.client.admin.internal.TopicsImpl.getSubscriptions(TopicsImpl.java:349)\r\n    at org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalGetSubscriptions(PersistentTopicsBase.java:532)\r\n    at org.apache.pulsar.broker.admin.v1.PersistentTopics.getSubscriptions(PersistentTopics.java:230)\r\n    at sun.reflect.GeneratedMethodAccessor131.invoke(Unknown Source)\r\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n    at java.lang.reflect.Method.invoke(Method.java:498)\r\n    at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81)\r\n    at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144)\r\n    at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161)\r\n    at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$TypeOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:205)\r\n    at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99)\r\n    at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389)\r\n    at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347)\r\n    at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102)\r\n    at org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326)\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:271)\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:267)\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:315)\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:297)\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:267)\r\n    at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317)\r\n    at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305)\r\n    at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154)\r\n    at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473)\r\n    at org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:427)\r\n    at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:388)\r\n    at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:341)\r\n    at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:228)\r\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:845)\r\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1689)\r\n    at org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53)\r\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\r\n    at org.apache.pulsar.broker.web.AuthenticationFilter.doFilter(AuthenticationFilter.java:74)\r\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\r\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)\r\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)\r\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\r\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\r\n    at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\r\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)\r\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\r\n    at org.eclipse.jetty.server.Server.handle(Server.java:524)\r\n    at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:319)\r\n    at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:253)\r\n    at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\r\n    at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\r\n    at org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:202)\r\n    at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\r\n    at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\r\n    at org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\r\n    at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)\r\n    at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)\r\n    at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n    at java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n**Pulsar version**\r\n- broker: 2.2.1\r\n\r\nWe have already backported #4484 to Pulsar-2.2.1, but the REST API that returns a list of subscriptions does not seem to time out.", "url": "https://github.com/apache/pulsar/issues/4756", "user": "massakam", "labels": ["triage/week-29", "type/bug"], "created": "2019-07-18 08:27:15", "closed": "2020-01-28 09:37:22", "commits": {"2cc34afc0320e66a996b9517d6729a495563fc54": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "87c02a9f8e36bae853d68543e17d93d70a2cbef6": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "f24c1b0bfd9f35d8e36521e080275c86bd252083": {"commitGHEventType": "referenced", "commitUser": "wolfstudy"}, "e52b15bdd859e3d885289eb91892f99b41793593": {"commitGHEventType": "referenced", "commitUser": "wolfstudy"}}, "ttf": 194.00027777777777, "commitsDetails": [{"commitHash": "2cc34afc0320e66a996b9517d6729a495563fc54", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["8e1d00ffabf3cf75ec69c504334934a3b4caa4af"], "nameRev": "2cc34afc0320e66a996b9517d6729a495563fc54 tags/v2.5.0-candidate-1~527", "commitMessage": "Process requests asynchronously on some REST APIs (2) (#4778)\n\nMaster Issue: #4756\r\n\r\n### Motivation\r\n\r\nThis is a continuation of https://github.com/apache/pulsar/pull/4765.\r\n\r\n### Modifications\r\n\r\nAdded async rest handlers to the following APIs:\r\n```\r\nDELETE /admin/namespaces/{tenant}/{cluster}/{namespace}\r\nPUT    /admin/namespaces/{tenant}/{cluster}/{namespace}/unload\r\nPOST   /admin/namespaces/{tenant}/{cluster}/{namespace}/clearBacklog\r\nPOST   /admin/namespaces/{tenant}/{cluster}/{namespace}/clearBacklog/{subscription}\r\nPOST   /admin/namespaces/{tenant}/{cluster}/{namespace}/unsubscribe/{subscription}\r\n\r\nDELETE /admin/v2/namespaces/{tenant}/{namespace}\r\nPUT    /admin/v2/namespaces/{tenant}/{namespace}/unload\r\nPOST   /admin/v2/namespaces/{tenant}/{namespace}/clearBacklog\r\nPOST   /admin/v2/namespaces/{tenant}/{namespace}/clearBacklog/{subscription}\r\nPOST   /admin/v2/namespaces/{tenant}/{namespace}/unsubscribe/{subscription}\r\n```", "commitDateTime": "2019-07-23 13:40:48", "authoredDateTime": "2019-07-23 14:40:48", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java", "insertions": 162, "deletions": 98, "lines": 260}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/Namespaces.java", "insertions": 54, "deletions": 19, "lines": 73}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/NonPersistentTopics.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/PersistentTopics.java", "insertions": 8, "deletions": 1, "lines": 9}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Namespaces.java", "insertions": 55, "deletions": 17, "lines": 72}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/NonPersistentTopics.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 8, "deletions": 1, "lines": 9}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTest.java", "insertions": 8, "deletions": 2, "lines": 10}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/NamespacesTest.java", "insertions": 78, "deletions": 61, "lines": 139}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/Namespaces.java", "insertions": 61, "deletions": 1, "lines": 62}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/NamespacesImpl.java", "insertions": 69, "deletions": 25, "lines": 94}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyChanges"}, {"commitHash": "87c02a9f8e36bae853d68543e17d93d70a2cbef6", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["075f28b71c8fd9259ce8e136dbb81c0629c3f271"], "nameRev": "87c02a9f8e36bae853d68543e17d93d70a2cbef6 tags/v2.5.0-candidate-1~520", "commitMessage": "[Issue #4756][broker] Process requests asynchronously on some REST APIs (3) (#4795)\n\n* Process requests asynchronously on some REST APIs (3)\r\n\r\n* Add async rest handler to API for expiring message on single topic subscription\r\n", "commitDateTime": "2019-07-25 09:12:26", "authoredDateTime": "2019-07-26 01:12:26", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java", "insertions": 5, "deletions": 5, "lines": 10}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 478, "deletions": 204, "lines": 682}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/PersistentTopics.java", "insertions": 89, "deletions": 36, "lines": 125}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 73, "deletions": 17, "lines": 90}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTest.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/NamespacesTest.java", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 93, "deletions": 33, "lines": 126}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyChanges"}, {"commitHash": "f24c1b0bfd9f35d8e36521e080275c86bd252083", "commitGHEventType": "referenced", "commitUser": "wolfstudy", "commitParents": ["97627f2406aa79bb422bb6ecb31bfa8d7d1f4c54"], "nameRev": "f24c1b0bfd9f35d8e36521e080275c86bd252083 tags/v2.4.2-candidate-1~81", "commitMessage": "Process requests asynchronously on some REST APIs (2) (#4778)\n\nMaster Issue: #4756\r\n\r\n### Motivation\r\n\r\nThis is a continuation of https://github.com/apache/pulsar/pull/4765.\r\n\r\n### Modifications\r\n\r\nAdded async rest handlers to the following APIs:\r\n```\r\nDELETE /admin/namespaces/{tenant}/{cluster}/{namespace}\r\nPUT    /admin/namespaces/{tenant}/{cluster}/{namespace}/unload\r\nPOST   /admin/namespaces/{tenant}/{cluster}/{namespace}/clearBacklog\r\nPOST   /admin/namespaces/{tenant}/{cluster}/{namespace}/clearBacklog/{subscription}\r\nPOST   /admin/namespaces/{tenant}/{cluster}/{namespace}/unsubscribe/{subscription}\r\n\r\nDELETE /admin/v2/namespaces/{tenant}/{namespace}\r\nPUT    /admin/v2/namespaces/{tenant}/{namespace}/unload\r\nPOST   /admin/v2/namespaces/{tenant}/{namespace}/clearBacklog\r\nPOST   /admin/v2/namespaces/{tenant}/{namespace}/clearBacklog/{subscription}\r\nPOST   /admin/v2/namespaces/{tenant}/{namespace}/unsubscribe/{subscription}\r\n```\n\n(cherry picked from commit 2cc34afc0320e66a996b9517d6729a495563fc54)\n", "commitDateTime": "2019-11-19 15:53:48", "authoredDateTime": "2019-07-23 14:40:48", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java", "insertions": 162, "deletions": 98, "lines": 260}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/Namespaces.java", "insertions": 54, "deletions": 19, "lines": 73}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/NonPersistentTopics.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/PersistentTopics.java", "insertions": 8, "deletions": 1, "lines": 9}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Namespaces.java", "insertions": 55, "deletions": 17, "lines": 72}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/NonPersistentTopics.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 8, "deletions": 1, "lines": 9}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTest.java", "insertions": 8, "deletions": 2, "lines": 10}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/NamespacesTest.java", "insertions": 78, "deletions": 61, "lines": 139}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/Namespaces.java", "insertions": 61, "deletions": 1, "lines": 62}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/NamespacesImpl.java", "insertions": 69, "deletions": 25, "lines": 94}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyChanges"}, {"commitHash": "e52b15bdd859e3d885289eb91892f99b41793593", "commitGHEventType": "referenced", "commitUser": "wolfstudy", "commitParents": ["f24c1b0bfd9f35d8e36521e080275c86bd252083"], "nameRev": "e52b15bdd859e3d885289eb91892f99b41793593 tags/v2.4.2-candidate-1~80", "commitMessage": "[Issue #4756][broker] Process requests asynchronously on some REST APIs (3) (#4795)\n\n* Process requests asynchronously on some REST APIs (3)\r\n\r\n* Add async rest handler to API for expiring message on single topic subscription\r\n\n(cherry picked from commit 87c02a9f8e36bae853d68543e17d93d70a2cbef6)\n", "commitDateTime": "2019-11-19 15:54:31", "authoredDateTime": "2019-07-26 01:12:26", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java", "insertions": 5, "deletions": 5, "lines": 10}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 478, "deletions": 204, "lines": 682}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/PersistentTopics.java", "insertions": 89, "deletions": 36, "lines": 125}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 73, "deletions": 17, "lines": 90}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTest.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/NamespacesTest.java", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 93, "deletions": 33, "lines": 126}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyChanges"}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 2, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "defaultRetentionTimeInMinutes from conf/standalone.conf doesn't do nothing", "body": "**Describe the bug**\r\n```defaultRetentionTimeInMinutes``` from ```standalone.conf``` doesn't affect to the real behavior\r\nBut ```bin/pulsar-admin namespaces set-retention public/default --size -1 --time -1```\r\nworks fine\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behaviour:\r\n1. mount volume in ```docker-compose.yaml``` file ```'docker/pulsar/conf/standalone.conf:/pulsar/conf/standalone.conf'``` and set retention policy \r\n```\r\n   defaultRetentionTimeInMinutes=-1\r\n   defaultRetentionSizeInMB=-1\r\n```\r\n2. execute ```docker-compose.yaml``` with standalone option ```command: bash -c \"bin/pulsar standalone\"```\r\n3. check variables ```bin/pulsar-admin namespaces get-retention public/default```\r\n```json\r\n{\r\n  \"retentionTimeInMinutes\" : -1,\r\n  \"retentionSizeInMB\" : -1\r\n}\r\n```\r\n4. send message \"test\" to public/default/my-topic\r\n5. create reader from public/default/my-topic\r\n6. message is there\r\n7. wait about 3 minutes and read again\r\n8. the topic is empty\r\n9. stop ```docker-compose.yaml``` and clean volumes\r\n\r\n10. execute ```docker-compose.yaml``` again\r\n11. set retention policy through pulsar-admin ```bin/pulsar-admin namespaces set-retention public/default --size -1 --time -1```\r\n12. check variables ```bin/pulsar-admin namespaces get-retention public/default```\r\n```json\r\n{\r\n  \"retentionTimeInMinutes\" : -1,\r\n  \"retentionSizeInMB\" : -1\r\n}\r\n```\r\n13. send message \"test\" to public/default/my-topic\r\n14. create reader from public/default/my-topic\r\n15. message is there\r\n16. wait about 3 minutes and read again\r\n17. message is still there\r\n\r\n**Expected behavior**\r\nThe message should be in topic after 2 minutes when ```defaultRetentionTimeInMinutes=-1``` configured in ```standalone.conf```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Official docker 2.4.0\r\n\r\n**Additional context**\r\ndocker-compose.yaml\r\n```yaml\r\nversion: '3'\r\nservices:\r\n    zookeeper:\r\n        container_name: zookeeper\r\n        image: confluentinc/cp-zookeeper:latest\r\n        environment:\r\n            ZOOKEEPER_CLIENT_PORT: 2181\r\n            ZOOKEEPER_TICK_TIME: 2000\r\n        volumes:\r\n            - './docker/zookeeper/data:/var/lib/zookeeper/data'\r\n            - './docker/zookeeper/log:/var/lib/zookeeper/log'\r\n    pulsar:\r\n        container_name: pulsar\r\n        hostname: pulsar\r\n        ports:\r\n            - '6650:6650'\r\n            - '9000:8080'\r\n        volumes:\r\n            - './docker/pulsar/data:/pulsar/data'\r\n            - './docker/pulsar/conf/standalone.conf:/pulsar/conf/standalone.conf'\r\n        depends_on:\r\n            - zookeeper\r\n        image: 'apachepulsar/pulsar:2.4.0'\r\n        command: bash -c \"bin/pulsar standalone\"\r\n    pulsar-dashboard:\r\n        container_name: pulsar-dashboard\r\n        image: apachepulsar/pulsar-dashboard\r\n        ports:\r\n            - '9001:80'\r\n        environment:\r\n            SERVICE_URL: http://pulsar:9000\r\n        depends_on:\r\n            - pulsar\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/4755", "user": "freeart", "labels": ["component/broker", "triage/week-29", "type/bug"], "created": "2019-07-18 08:27:04", "closed": "2019-07-27 03:12:23", "commits": {"1dcac8cc8413493c32bba0184e9598db1e515b39": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "33a7c23949350b209121e971297ec3ea53ec4379": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 8.000277777777777, "commitsDetails": [{"commitHash": "1dcac8cc8413493c32bba0184e9598db1e515b39", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["b2c503a7156002e66ef601f118208fc72ff105be"], "nameRev": "1dcac8cc8413493c32bba0184e9598db1e515b39 tags/v2.5.0-candidate-1~511", "commitMessage": "Fix : default retention policy in configuration do nothing (#4810)\n\nfix #4755 \r\nRetention policy is used in Ledger GC and Topic GC.\r\nDefault retention policy is not uploaded to zookeeper, but it is getted from zookeeper when it is used.\r\nSo, if zookeeper doesn't have retention policy, we should load it from default config file.\r\nIn Ledger GC configuration, it's OK.\r\nhttps://github.com/apache/pulsar/blob/075f28b71c8fd9259ce8e136dbb81c0629c3f271/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java#L739-L742\r\nBut in Topic GC, do nothing.", "commitDateTime": "2019-07-27 11:12:23", "authoredDateTime": "2019-07-27 11:12:23", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java", "insertions": 22, "deletions": 22, "lines": 44}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentTopicE2ETest.java", "insertions": 47, "deletions": 3, "lines": 50}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.shouldTopicBeRetained()", "TOT": 13, "UPD": 1, "INS": 5, "MOV": 4, "DEL": 3}]}, {"spoonFilePath": "PersistentTopicE2ETest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicE2ETest.testServiceConfigurationRetentionPolicy()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "33a7c23949350b209121e971297ec3ea53ec4379", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["2b5bb18353899e042505fa4e20b3f1242a646815"], "nameRev": "33a7c23949350b209121e971297ec3ea53ec4379 tags/v2.4.1-candidate-1~35", "commitMessage": "Fix : default retention policy in configuration do nothing (#4810)\n\nfix #4755\nRetention policy is used in Ledger GC and Topic GC.\nDefault retention policy is not uploaded to zookeeper, but it is getted from zookeeper when it is used.\nSo, if zookeeper doesn't have retention policy, we should load it from default config file.\nIn Ledger GC configuration, it's OK.\nhttps://github.com/apache/pulsar/blob/075f28b71c8fd9259ce8e136dbb81c0629c3f271/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java#L739-L742\nBut in Topic GC, do nothing.\n(cherry picked from commit 1dcac8cc8413493c32bba0184e9598db1e515b39)\n", "commitDateTime": "2019-08-28 11:13:08", "authoredDateTime": "2019-07-27 11:12:23", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java", "insertions": 22, "deletions": 22, "lines": 44}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentTopicE2ETest.java", "insertions": 47, "deletions": 3, "lines": 50}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.shouldTopicBeRetained()", "TOT": 13, "UPD": 1, "INS": 5, "MOV": 4, "DEL": 3}]}, {"spoonFilePath": "PersistentTopicE2ETest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicE2ETest.testServiceConfigurationRetentionPolicy()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "function apply protobuf input.", "body": "\r\n\r\nHello. I'm testing pulsar function for easy ETL job recently, but i encountered some errors that i couldn't figure it out.  there is my snippet.\r\n![image](https://user-images.githubusercontent.com/13885249/61344372-9d9cec80-a883-11e9-909a-e096e6c55210.png)\r\n\r\nand producer is:\r\n![image](https://user-images.githubusercontent.com/13885249/61344415-c1603280-a883-11e9-933a-fbf223470c3f.png)\r\n\r\n#### Expected behavior\r\nI assumed that localrunner could established a function process the deserialized messages with schema from schema registry, then produce to target topic.\r\n\r\n#### Actual behavior\r\n![image](https://user-images.githubusercontent.com/13885249/61344831-4ef05200-a885-11e9-8baf-4fece09c2aa8.png)\r\n```log\r\n[ERROR] 2019-07-17 11:19:20.175 [public/default/Addressbook-0] JavaInstanceRunnable - [public/default/Addressbook:0] Uncaught exception in Java Instance\r\njava.lang.UnsupportedOperationException: null\r\n\tat java.util.AbstractMap.put(AbstractMap.java:209) ~[?:1.8.0_201]\r\n\tat org.apache.pulsar.client.impl.schema.SchemaDefinitionBuilderImpl.build(SchemaDefinitionBuilderImpl.java:101) ~[pulsar-client-2.4.0.jar:2.4.0]\r\n\tat org.apache.pulsar.client.impl.schema.ProtobufSchema.ofGenericClass(ProtobufSchema.java:106) ~[pulsar-client-2.4.0.jar:2.4.0]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(TopicSchema.java:149) ~[pulsar-functions-local-runner-2.4.0.jar:2.4.0]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(TopicSchema.java:173) ~[pulsar-functions-local-runner-2.4.0.jar:2.4.0]\r\n\tat org.apache.pulsar.functions.source.TopicSchema.lambda$getSchema$0(TopicSchema.java:66) ~[pulsar-functions-local-runner-2.4.0.jar:2.4.0]\r\n\tat java.util.HashMap.computeIfAbsent(HashMap.java:1127) ~[?:1.8.0_201]\r\n```\r\nCould anyone telling what to do, cause I could not find any document or example showing how it work.\r\n\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.4\r\n", "url": "https://github.com/apache/pulsar/issues/4742", "user": "YangZunYu", "labels": ["component/functions", "component/schemaregistry", "triage/week-29", "type/bug"], "created": "2019-07-17 03:28:19", "closed": "2019-11-25 22:37:10", "commits": {}, "ttf": 131.00027777777777, "commitsDetails": []}, {"title": "Producer can't produce messages with an old schema version.", "body": "**Describe the bug**\r\n\r\nProducer can't produce messages with an old schema version.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Use pulsar-admin to set-schema-autoupdate-strategy -c Backward public/default\r\n2. Run following test case:\r\n```java\r\n\r\nimport org.apache.pulsar.client.api.PulsarClient;\r\nimport org.apache.pulsar.client.api.PulsarClientException;\r\nimport org.apache.pulsar.client.api.Schema;\r\n\r\npublic class SchemaTests {\r\n\r\n    public static void main(String[] args) throws PulsarClientException {\r\n\r\n        PulsarClient client = PulsarClient.builder().serviceUrl(\"pulsar://127.0.0.1:6650\").build();\r\n        client.newProducer(Schema.AVRO(UserV1.class)).topic(\"topic-1\").create();\r\n        client.newProducer(Schema.AVRO(UserV2.class)).topic(\"topic-1\").create();\r\n        client.newProducer(Schema.AVRO(UserV1.class)).topic(\"topic-1\").create();\r\n\r\n    }\r\n\r\n\r\n    private static class UserV1 {\r\n\r\n        private String username;\r\n        private int age;\r\n\r\n        public String getUsername() {\r\n            return username;\r\n        }\r\n\r\n        public void setUsername(String username) {\r\n            this.username = username;\r\n        }\r\n\r\n        public int getAge() {\r\n            return age;\r\n        }\r\n\r\n        public void setAge(int age) {\r\n            this.age = age;\r\n        }\r\n    }\r\n\r\n    private static class UserV2 {\r\n\r\n        public String getUsername() {\r\n            return username;\r\n        }\r\n\r\n        public void setUsername(String username) {\r\n            this.username = username;\r\n        }\r\n\r\n        private String username;\r\n\r\n    }\r\n\r\n}\r\n```\r\n\r\nWill produce the following error:\r\n\r\n```\r\nException in thread \"main\" org.apache.pulsar.client.api.PulsarClientException$IncompatibleSchemaException: org.apache.pulsar.broker.service.schema.exceptions.IncompatibleSchemaException: Incompatible schema used\r\n\tat org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:253)\r\n\tat org.apache.pulsar.client.impl.ProducerBuilderImpl.create(ProducerBuilderImpl.java:88)\r\n\tat org.apache.pulsar.issue.SchemaTests.main(SchemaTests.java:12)\r\n```\r\n\r\n**Expected behavior**\r\n\r\nAt producer side, producer can send messages using an old version schema.\r\n", "url": "https://github.com/apache/pulsar/issues/4737", "user": "codelipenghui", "labels": ["component/schemaregistry", "triage/week-29", "type/bug"], "created": "2019-07-16 09:46:33", "closed": "2019-11-25 20:09:59", "commits": {}, "ttf": 132.00027777777777, "commitsDetails": []}, {"title": "Use timestamp as \"__publish_time__\" type in Pulsar SQL.", "body": "### Motivation\r\n\"__publish_time__\" is Pulsar SQL internal column, as Pulsar only stores timestamps, it doesn\u2019t store the timezone information. Use timestamp  as \"__publish_time__\" type is more correct way in Pulsar SQL.", "url": "https://github.com/apache/pulsar/issues/4734", "user": "codelipenghui", "labels": ["component/sql", "triage/week-29", "type/bug", "type/feature"], "created": "2019-07-16 02:29:15", "closed": "2019-07-19 01:13:15", "commits": {"6f5416eea0e7010c26091d9cbe72122b1fd94268": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "522f715fbbcff949a046d2c468f9483787280c20": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "6f5416eea0e7010c26091d9cbe72122b1fd94268", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f5b20cd3f08513fb82d93a22b2019753ae698e44"], "nameRev": "6f5416eea0e7010c26091d9cbe72122b1fd94268 tags/v2.5.0-candidate-1~555", "commitMessage": "Change type of publish_time to timestamp (#4757)\n\nFixes #4734\r\n\r\n### Motivation\r\n\r\n\"publish_time\" is Pulsar SQL internal column, as Pulsar only stores timestamps, it doesn\u2019t store the timezone information. Use timestamp as \"publish_time\" type is more correct way in Pulsar SQL.\r\n\r\n### Modifications\r\n\r\nChange type of publish_time to timestamp.\r\n\r\n### Verifying this change\r\n\r\npredicate of publish_time is pushdown\r\n\r\nUse `__publish_time__` to trim messages:\r\n```\r\nSELECT COUNT(*)\r\nFROM \"sql-test-1\" \r\nWHERE \"__publish_time__\" >= TIMESTAMP '2019-07-18 17:26:50.119' \r\nAND  \"__publish_time__\" < TIMESTAMP '2019-07-18 17:26:51.119';\r\n```\r\n![image](https://user-images.githubusercontent.com/12592133/61447301-43835080-a983-11e9-814b-bc2b378f02b9.png)\r\n\r\nWithout `__publish_time__` predicate:\r\n```\r\nSELECT COUNT(*)\r\nFROM \"sql-test-1\";\r\n```\r\n![image](https://user-images.githubusercontent.com/12592133/61447427-82190b00-a983-11e9-8d3f-3bf2a4798047.png)\r\n", "commitDateTime": "2019-07-19 09:13:14", "authoredDateTime": "2019-07-19 09:13:14", "commitGitStats": [{"filePath": "pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarInternalColumn.java", "insertions": 1, "deletions": 2, "lines": 3}, {"filePath": "pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarSplitManager.java", "insertions": 11, "deletions": 5, "lines": 16}, {"filePath": "pulsar-sql/presto-pulsar/src/test/java/org/apache/pulsar/sql/presto/TestPulsarSplitManager.java", "insertions": 5, "deletions": 9, "lines": 14}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarInternalColumn.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.PulsarInternalColumn", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarSplitManager.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.PulsarSplitManager.PredicatePushdownInfo.getPredicatePushdownInfo(java.lang.String,com.facebook.presto.spi.predicate.TupleDomain,org.apache.bookkeeper.mledger.ManagedLedgerFactory,java.lang.String,long)", "TOT": 6, "UPD": 4, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TestPulsarSplitManager.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.TestPulsarSplitManager.testPublishTimePredicatePushdown()", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.sql.presto.TestPulsarSplitManager.testPublishTimePredicatePushdownPartitionedTopic()", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 2}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "522f715fbbcff949a046d2c468f9483787280c20", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["a5df26b9d73a5fe6ccf58a69e41c53923f427895"], "nameRev": "522f715fbbcff949a046d2c468f9483787280c20 tags/v2.4.1-candidate-1~55", "commitMessage": "Change type of publish_time to timestamp (#4757)\n\nFixes #4734\n\n### Motivation\n\n\"publish_time\" is Pulsar SQL internal column, as Pulsar only stores timestamps, it doesn\u2019t store the timezone information. Use timestamp as \"publish_time\" type is more correct way in Pulsar SQL.\n\n### Modifications\n\nChange type of publish_time to timestamp.\n\n### Verifying this change\n\npredicate of publish_time is pushdown\n\nUse `__publish_time__` to trim messages:\n```\nSELECT COUNT(*)\nFROM \"sql-test-1\"\nWHERE \"__publish_time__\" >= TIMESTAMP '2019-07-18 17:26:50.119'\nAND  \"__publish_time__\" < TIMESTAMP '2019-07-18 17:26:51.119';\n```\n![image](https://user-images.githubusercontent.com/12592133/61447301-43835080-a983-11e9-814b-bc2b378f02b9.png)\n\nWithout `__publish_time__` predicate:\n```\nSELECT COUNT(*)\nFROM \"sql-test-1\";\n```\n![image](https://user-images.githubusercontent.com/12592133/61447427-82190b00-a983-11e9-8d3f-3bf2a4798047.png)\n\n(cherry picked from commit 6f5416eea0e7010c26091d9cbe72122b1fd94268)\n", "commitDateTime": "2019-08-28 00:07:55", "authoredDateTime": "2019-07-19 09:13:14", "commitGitStats": [{"filePath": "pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarInternalColumn.java", "insertions": 1, "deletions": 2, "lines": 3}, {"filePath": "pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarSplitManager.java", "insertions": 11, "deletions": 5, "lines": 16}, {"filePath": "pulsar-sql/presto-pulsar/src/test/java/org/apache/pulsar/sql/presto/TestPulsarSplitManager.java", "insertions": 5, "deletions": 9, "lines": 14}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarInternalColumn.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.PulsarInternalColumn", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarSplitManager.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.PulsarSplitManager.PredicatePushdownInfo.getPredicatePushdownInfo(java.lang.String,com.facebook.presto.spi.predicate.TupleDomain,org.apache.bookkeeper.mledger.ManagedLedgerFactory,java.lang.String,long)", "TOT": 6, "UPD": 4, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TestPulsarSplitManager.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.TestPulsarSplitManager.testPublishTimePredicatePushdown()", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.sql.presto.TestPulsarSplitManager.testPublishTimePredicatePushdownPartitionedTopic()", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 2}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Can't get schema info with topic partition", "body": "**Describe the bug**\r\n\r\nIf topic is a partitioned topic, use topic name can get schema info correct. But if use topic partition (e.g. persistent://my-tenant/my-namespace/my-topic-partitiion-0), can't get a schema info.\r\n\r\n**To Reproduce**\r\n1.create a new partitioned topic\r\n2.create producer with schema\r\n3.use pulsar admin to get schema info with topic partition\r\n\r\n**Expected behavior**\r\n\r\nIf use topic partition to get schema info should return the partitioned topic schema info.", "url": "https://github.com/apache/pulsar/issues/4730", "user": "codelipenghui", "labels": ["component/schemaregistry", "triage/week-29", "type/bug"], "created": "2019-07-15 12:25:44", "closed": "2019-07-19 10:22:23", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "libpulsar for osx is not updated to v2.4.0", "body": "**Describe the bug**\r\nlibpulsar from homebrew is not updated to v2.4.0\r\n\r\n**To Reproduce**\r\n```\r\n$ brew install libpulsar\r\nUpdating Homebrew...\r\nWarning: libpulsar 2.3.2_1 is already installed and up-to-date\r\nTo reinstall 2.3.2_1, run `brew reinstall libpulsar`\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/4727", "user": "freeznet", "labels": ["component/build", "triage/week-29", "type/bug"], "created": "2019-07-15 07:31:59", "closed": "2019-08-29 13:31:37", "commits": {}, "ttf": 45.000277777777775, "commitsDetails": []}, {"title": "pulsar-function-go/log is not exist", "body": "**Describe the bug**\r\n`pulsar-function-go/log` is not exist, trying to compile example failed.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\ncreate a new pulsar go function and compile\r\n```\r\ngo build -o examplepulsar helloFunc.go\r\n```\r\n\r\nget the error:\r\n\r\n```\r\n$ go build -o examplepulsar helloFunc.go\r\ngo: finding github.com/apache/pulsar/pulsar-function-go/log latest\r\ngo: finding github.com/apache/pulsar/pulsar-function-go latest\r\nbuild command-line-arguments: cannot load github.com/apache/pulsar/pulsar-function-go/log: cannot find module providing package github.com/apache/pulsar/pulsar-function-go/log\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/4726", "user": "freeznet", "labels": ["component/functions", "component/go", "component/website", "triage/week-29", "type/bug"], "created": "2019-07-15 07:15:50", "closed": "2019-07-18 16:36:33", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "New schemas should overwrite deleted schemas", "body": "**Describe the bug**\r\nFor what I observed deleting schemas currently just marks a schema deleted rather than actually delete it. Now for some reason schemas are simply ignored writing to a once-existing-but-now-deleted topic. Querying a schema for such a topic always returns a 404. The only workaround I found so far is to manually delete the schema in zookeeper. \r\n\r\n**To Reproduce**\r\n1. Write some messages to topic `tenant/ns/topic` using an AvroSchema for example\r\n2. Query schema: `pulsar-admin schemas get persistent://tenant/ns/topic` -> Result ok\r\n3. Delete topic including schema: `pulsar-admin topics delete persistent://tenant/ns/topic -d`\r\n4. Again write messages to `tenant/ns/topic` with same AvroSchema as above\r\n5.  Query schema: `pulsar-admin schemas get persistent://tenant/ns/topic` -> Error 404 Not Found \r\n\r\n**Expected behavior**\r\nDeleted schemas should be overwritten by new schemas.\r\n\r\n**Desktop (please complete the following information):**\r\n - Pulsar version 2.4.0\r\n\r\n**Additional context**\r\nThe same behavior can be observed when a topic is deleted automatically due to inactivity.\r\n", "url": "https://github.com/apache/pulsar/issues/4724", "user": "rfuerst87", "labels": ["component/schemaregistry", "triage/week-29", "type/bug"], "created": "2019-07-14 14:43:10", "closed": "2019-07-19 16:52:08", "commits": {"6ec2e16b6bd68ad51e2841277164a53fcfb1260b": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "1ba26094b6aa87a55f6a6a5776f1146d46bfcab8": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "6ec2e16b6bd68ad51e2841277164a53fcfb1260b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["81ab4eed382aa9641b24164723798db85cb1e28f"], "nameRev": "6ec2e16b6bd68ad51e2841277164a53fcfb1260b tags/v2.5.0-candidate-1~549", "commitMessage": "Add deleted schema judgment when adding schema  (#4731)\n\n### Motivation\r\nto fix #4724\r\n\r\n### Verifying this change\r\nAdd the tests for it\r\n", "commitDateTime": "2019-07-20 00:52:07", "authoredDateTime": "2019-07-20 00:52:07", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorage.java", "insertions": 15, "deletions": 9, "lines": 24}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java", "insertions": 69, "deletions": 32, "lines": 101}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaStorage.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/SchemaServiceTest.java", "insertions": 17, "deletions": 0, "lines": 17}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BookkeeperSchemaStorage.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.getAll(java.lang.String)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.putSchemaIfAbsent(java.lang.String,byte[],byte[])", "TOT": 4, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.findSchemaEntryByHash(java.util.List,byte[])", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.put(java.lang.String,byte[],byte[],long)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.putSchemaIfAbsent(java.lang.String,byte[],byte[],long)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.findSchemaEntryByHash(java.util.List,byte[],long)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaRegistryServiceImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.checkCompatibilityWithAll(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 8, "UPD": 1, "INS": 1, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.putSchemaIfAbsent(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 19, "UPD": 1, "INS": 8, "MOV": 6, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.deleteSchema(java.lang.String,java.lang.String)", "TOT": 7, "UPD": 0, "INS": 1, "MOV": 4, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.isTransitiveStrategy(org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.isCompatible(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "SchemaStorage.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.put(java.lang.String,byte[],byte[],long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaServiceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaServiceTest.deleteSchemaAndAddSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "1ba26094b6aa87a55f6a6a5776f1146d46bfcab8", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["198e154eb733f77ca47d988b09d39dc7a6868771"], "nameRev": "1ba26094b6aa87a55f6a6a5776f1146d46bfcab8 tags/v2.4.1-candidate-1~51", "commitMessage": "Add deleted schema judgment when adding schema  (#4731)\n\n### Motivation\nto fix #4724\n\n### Verifying this change\nAdd the tests for it\n\n(cherry picked from commit 6ec2e16b6bd68ad51e2841277164a53fcfb1260b)\n", "commitDateTime": "2019-08-28 00:08:33", "authoredDateTime": "2019-07-20 00:52:07", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorage.java", "insertions": 15, "deletions": 9, "lines": 24}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java", "insertions": 69, "deletions": 32, "lines": 101}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaStorage.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/SchemaServiceTest.java", "insertions": 17, "deletions": 0, "lines": 17}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BookkeeperSchemaStorage.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.getAll(java.lang.String)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.putSchemaIfAbsent(java.lang.String,byte[],byte[])", "TOT": 4, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.findSchemaEntryByHash(java.util.List,byte[])", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.put(java.lang.String,byte[],byte[],long)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.putSchemaIfAbsent(java.lang.String,byte[],byte[],long)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.findSchemaEntryByHash(java.util.List,byte[],long)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaRegistryServiceImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.checkCompatibilityWithAll(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 8, "UPD": 1, "INS": 1, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.putSchemaIfAbsent(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 19, "UPD": 1, "INS": 8, "MOV": 6, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.deleteSchema(java.lang.String,java.lang.String)", "TOT": 7, "UPD": 0, "INS": 1, "MOV": 4, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.isTransitiveStrategy(org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.isCompatible(java.lang.String,org.apache.pulsar.common.protocol.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "SchemaStorage.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.put(java.lang.String,byte[],byte[],long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaServiceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaServiceTest.deleteSchemaAndAddSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Pulsar SQL incompatible with Open JDK", "body": "**Describe the bug**\r\nPulsar SQL incompatible with open JDK\r\n\r\n**To Reproduce**\r\n\r\n1. java -version openjdk version \"1.8.0_202\"\r\n\r\n2. bin/pulsar sql-worker run\r\n\r\n3. ERROR: ld.so: object '/usr/local/brokers-2.4/lib/presto/bin/procname/Linux-x86_64/libprocname.so' from LD_PRELOAD cannot be preloaded: ignored.\r\nPresto requires an Oracle or OpenJDK JVM (found Azul Systems, Inc.)", "url": "https://github.com/apache/pulsar/issues/4723", "user": "helicopter18", "labels": ["component/sql", "triage/week-29", "type/bug"], "created": "2019-07-14 09:59:46", "closed": "2019-07-15 05:51:14", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Flink pulsar sink NotSerializableException", "body": "   <dependency>\r\n            <groupId>org.apache.pulsar</groupId>\r\n            <artifactId>pulsar-flink</artifactId>\r\n            <version>2.4.0</version>\r\n        </dependency>\r\nException in thread \"main\" org.apache.flink.api.common.InvalidProgramException: The implementation of the RichSinkFunction is not serializable. The object probably contains or references non serializable fields.\r\n\tat org.apache.flink.api.java.ClosureCleaner.clean(ClosureCleaner.java:99)\r\n\tat org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.clean(StreamExecutionEnvironment.java:1559)\r\n\tat org.apache.flink.streaming.api.datastream.DataStream.clean(DataStream.java:185)\r\n\tat org.apache.flink.streaming.api.datastream.DataStream.addSink(DataStream.java:1225)\r\n\tat wordcount.WordCountProcess.main(WordCountProcess.java:63)\r\nCaused by: java.io.NotSerializableException: org.apache.pulsar.client.impl.DefaultBatcherBuilder\r\n\tat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1184)\r\n\tat java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)\r\n\tat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)\r\n\tat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\r\n\tat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\r\n\tat java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548)\r\n\tat java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509)\r\n\tat java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432)\r\n\tat java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178)\r\n\tat java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348)\r\n\tat org.apache.flink.util.InstantiationUtil.serializeObject(InstantiationUtil.java:534)\r\n\tat org.apache.flink.api.java.ClosureCleaner.clean(ClosureCleaner.java:81)\r\n`\r\n\r\n        stream.addSink(new FlinkPulsarProducer<>(\r\n                SERVICE_URL,\r\n                OUT_TOPIC,\r\n                new AuthenticationDisabled(),\r\n                wordWithCount -> wordWithCount.toString().getBytes(),\r\n                wordWithCount -> wordWithCount.getWord()\r\n        ));\r\n        env.execute(\"flink window count!\");`", "url": "https://github.com/apache/pulsar/issues/4721", "user": "cnicy", "labels": ["component/flink", "triage/week-29", "type/bug"], "created": "2019-07-13 01:48:55", "closed": "2020-01-14 17:56:07", "commits": {}, "ttf": 185.00027777777777, "commitsDetails": []}, {"title": "Compilation errors in `pulsar-client-cpp`", "body": "**Describe the bug**\r\nWhen attempting to compile `pulsar-client-cpp`, I get these compilation errors:\r\n\r\n```\r\n[  7%] Building CXX object lib/CMakeFiles/pulsarStatic.dir/CompressionCodecSnappy.cc.o                                                                                                                                                         \r\n/home/mediocregopher/src/pulsar/pulsar-client-cpp/lib/CompressionCodecSnappy.cc: In member function \u2018virtual pulsar::SharedBuffer pulsar::CompressionCodecSnappy::encode(const pulsar::SharedBuffer&)\u2019:                                     \r\n/home/mediocregopher/src/pulsar/pulsar-client-cpp/lib/CompressionCodecSnappy.cc:38:59: error: \u2018res\u2019 was not declared in this scope\r\n   38 |         LOG_ERROR(\"Failed to compress to snappy. res=\" << res);\r\n      |                                                           ^~~\r\n/home/mediocregopher/src/pulsar/pulsar-client-cpp/lib/CompressionCodecSnappy.cc:38:9: error: \u2018LOG_ERROR\u2019 was not declared in this scope; did you mean \u2018SO_ERROR\u2019?\r\n   38 |         LOG_ERROR(\"Failed to compress to snappy. res=\" << res);\r\n      |         ^~~~~~~~~\r\n      |         SO_ERROR\r\n/home/mediocregopher/src/pulsar/pulsar-client-cpp/lib/CompressionCodecSnappy.cc: In member function \u2018virtual bool pulsar::CompressionCodecSnappy::decode(const pulsar::SharedBuffer&, uint32_t, pulsar::SharedBuffer&)\u2019:\r\n/home/mediocregopher/src/pulsar/pulsar-client-cpp/lib/CompressionCodecSnappy.cc:52:74: error: invalid conversion from \u2018uint32_t\u2019 {aka \u2018unsigned int\u2019} to \u2018size_t*\u2019 {aka \u2018long unsigned int*\u2019} [-fpermissive]\r\n   52 |                                              decompressed.mutableData(), uncompressedSize);\r\n      |                                                                          ^~~~~~~~~~~~~~~~\r\n      |                                                                          |\r\n      |                                                                          uint32_t {aka unsigned int}\r\nIn file included from /home/mediocregopher/src/pulsar/pulsar-client-cpp/lib/CompressionCodecSnappy.cc:23:\r\n/usr/include/snappy-c.h:106:41: note:   initializing argument 4 of \u2018snappy_status snappy_uncompress(const char*, size_t, char*, size_t*)\u2019\r\n  106 |                                 size_t* uncompressed_length);\r\n      |                                 ~~~~~~~~^~~~~~~~~~~~~~~~~~~\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n```\r\ngit clone https://github.com/apache/pulsar.git\r\n# git checkout v2.4.0 (optional)\r\ncd pulsar/pulsar-client-cpp\r\ncmake .\r\nmake\r\n```\r\nAs shown, this happens on both the `v2.4.0` tag and `master`\r\n\r\n**Expected behavior**\r\nThe build successfully finishes.\r\n\r\n**Desktop (please complete the following information):**\r\n```\r\n ~ :: uname -a\r\nLinux very-cool-thinkpad 5.1.16-arch1-1-ARCH #1 SMP PREEMPT Wed Jul 3 20:23:07 UTC 2019 x86_64 GNU/Linux\r\n\r\n ~ :: pacman -Q | grep boost\r\nboost 1.69.0-2\r\nboost-libs 1.69.0-2\r\n\r\n ~ :: pacman -Q | grep proto\r\nprotobuf 3.7.0-1\r\n\r\n ~ :: pacman -Q | grep log4cxx\r\nlog4cxx 0.10.0-4\r\n\r\n ~ :: pacman -Q | grep curl\r\ncurl 7.65.1-3\r\nlibcurl-compat 7.65.1-1\r\n\r\n ~ :: pacman -Q | grep gtest\r\ngtest 1.8.1-3\r\n\r\n ~ :: pacman -Q | grep jsoncpp\r\njsoncpp 1.8.4-2\r\n\r\n ~ :: pacman -Q | grep clang\r\nclang 8.0.0-4\r\n\r\n ~ :: pacman -Q | grep glibc\r\nglibc 2.29-3\r\n```\r\n\r\n**Additional context**\r\nI am able to build the library files using the `docker-build.sh` script, but the built files aren't usable on my system because they are not statically compiled, and the versions of libraries they link to are different.\r\n", "url": "https://github.com/apache/pulsar/issues/4720", "user": "mediocregopher", "labels": ["component/c++", "component/client", "triage/week-29", "type/bug"], "created": "2019-07-12 19:47:04", "closed": "2019-08-20 04:00:55", "commits": {"385a0368c3b878c49b8e907395eedf180f6e9d3c": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "057e7d2833f51e4715b98756d16e74719479f5f5": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 38.000277777777775, "commitsDetails": [{"commitHash": "385a0368c3b878c49b8e907395eedf180f6e9d3c", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["d49e61e0907c30d71184da4eb769c9761456a80f"], "nameRev": "385a0368c3b878c49b8e907395eedf180f6e9d3c tags/v2.5.0-candidate-1~445", "commitMessage": "[pulsar-client-cpp] fix snappy compressor compile error (#4972)\n\nFixes #4720 \r\n### Motivation\r\n\r\nfor now, the snappy compressor can not be compiled successfully,\r\nwhich raise undeclared identifier and no matching function errors.\r\n\r\n### Modifications\r\n\r\nfix compile errors, use snappy c++ apis.", "commitDateTime": "2019-08-20 12:00:54", "authoredDateTime": "2019-08-20 12:00:54", "commitGitStats": [{"filePath": "pulsar-client-cpp/docker-build.sh", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-cpp/docker-lib-check.sh", "insertions": 23, "deletions": 0, "lines": 23}, {"filePath": "pulsar-client-cpp/docker-tests.sh", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-cpp/lib/CompressionCodecSnappy.cc", "insertions": 12, "deletions": 23, "lines": 35}, {"filePath": "pulsar-client-cpp/lib/CompressionCodecSnappy.h", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-cpp/tests/CompressionCodecSnappyTest.cc", "insertions": 38, "deletions": 0, "lines": 38}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "057e7d2833f51e4715b98756d16e74719479f5f5", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["f03544f908fd25c33102d618602c335a9fcf815a"], "nameRev": "057e7d2833f51e4715b98756d16e74719479f5f5 tags/v2.4.1-candidate-1~9", "commitMessage": "[pulsar-client-cpp] fix snappy compressor compile error (#4972)\n\nFixes #4720\n### Motivation\n\nfor now, the snappy compressor can not be compiled successfully,\nwhich raise undeclared identifier and no matching function errors.\n\n### Modifications\n\nfix compile errors, use snappy c++ apis.\n(cherry picked from commit 385a0368c3b878c49b8e907395eedf180f6e9d3c)\n", "commitDateTime": "2019-08-28 14:38:31", "authoredDateTime": "2019-08-20 12:00:54", "commitGitStats": [{"filePath": "pulsar-client-cpp/docker-build.sh", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-cpp/docker-lib-check.sh", "insertions": 23, "deletions": 0, "lines": 23}, {"filePath": "pulsar-client-cpp/docker-tests.sh", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-cpp/lib/CompressionCodecSnappy.cc", "insertions": 12, "deletions": 23, "lines": 35}, {"filePath": "pulsar-client-cpp/lib/CompressionCodecSnappy.h", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-cpp/tests/CompressionCodecSnappyTest.cc", "insertions": 38, "deletions": 0, "lines": 38}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[pulsar-sql] BKNoSuchLedgerExistsException when using custom ZooKeeper path for pulsar", "body": "**Describe the bug**\r\nI have an existing ZooKeeper cluster where I store any Pulsar related stuff under `/pulsar` setting `zkServers` to `zk-url:2181/pulsar`. This works fine for brokers and bookies, but not for pulsar-sql. When querying a table I always get a `BKNoSuchLedgerExistsException`:\r\n\r\n```\r\n// pulsar-sql logfile\r\n2019-07-12T08:44:13.062Z\tERROR\tQuery-20190712_084408_00001_k8t7u-140\torg.apache.pulsar.sql.presto.PulsarSplitManager\tFailed to get splits\r\norg.apache.bookkeeper.mledger.ManagedLedgerException: java.util.concurrent.CompletionException: org.apache.bookkeeper.client.BKException$BKNoSuchLedgerExistsException: No such ledger exists\r\nCaused by: java.util.concurrent.CompletionException: org.apache.bookkeeper.client.BKException$BKNoSuchLedgerExistsException: No such ledger exists\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:647)\r\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:632)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)\r\n\tat org.apache.bookkeeper.client.SyncCallbackUtils.finish(SyncCallbackUtils.java:83)\r\n\tat org.apache.bookkeeper.client.SyncCallbackUtils$SyncOpenCallback.openComplete(SyncCallbackUtils.java:157)\r\n\tat org.apache.bookkeeper.client.LedgerOpenOp.openComplete(LedgerOpenOp.java:232)\r\n\tat org.apache.bookkeeper.client.LedgerOpenOp.lambda$initiate$0(LedgerOpenOp.java:117)\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760)\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)\r\n\tat org.apache.bookkeeper.meta.AbstractZkLedgerManager$3.processResult(AbstractZkLedgerManager.java:396)\r\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient$19$1.processResult(ZooKeeperClient.java:994)\r\n\tat org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:575)\r\n\tat org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:508)\r\nCaused by: org.apache.bookkeeper.client.BKException$BKNoSuchLedgerExistsException: No such ledger exists\r\n\t... 12 more\r\n```\r\n\r\nIndeed I did set `pulsar.zookeeper-uri` to `zk-url:2181/pulsar` in the pulsar-sql config (see below) but this seems to be ignored when a query is executed.\r\n\r\n```\r\n// pulsar-sql logfile\r\n2019-07-12T08:42:23.754Z\tINFO\tmain\tBootstrap\tpulsar.zookeeper-uri                       localhost:2181                                 master.mesos:2181/pulsar\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Set up a pulsar cluster in an existing ZK environment under `/pulsar`\r\n2. Create some test data in a topic\r\n3. Use presto to query data --> `BKNoSuchLedgerExistsException`\r\n\r\n**Expected behavior**\r\nSeeing query results as expected.\r\n\r\n**Desktop (please complete the following information):**\r\n - Issue observed in docker image `apachepulsar/pulsar-all:2.4.0`\r\n\r\n**Additional context**\r\nAs said above I suspect paths in ZooKeeper connection strings are simply ignored in pulsar-sql. If you point me to the relevant bits in the code I maybe could contribute a patch here. Let me know when I can help.", "url": "https://github.com/apache/pulsar/issues/4715", "user": "rfuerst87", "labels": ["component/sql", "component/tieredstorage", "triage/week-29", "type/bug"], "created": "2019-07-12 09:19:36", "closed": "2019-11-27 22:04:18", "commits": {"e00ad114d2fc4c547a1c9863bc333891d914261d": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 138.00027777777777, "commitsDetails": [{"commitHash": "e00ad114d2fc4c547a1c9863bc333891d914261d", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["3295f8094907a4e6628ec1bc16536be699101940"], "nameRev": "e00ad114d2fc4c547a1c9863bc333891d914261d tags/v2.5.0-candidate-1~41", "commitMessage": "[Pulsar-sql]Using pulsar SQL query messages will appear `NoSuchLedger` when zk root directory changed (#5001)\n\nFixes #4715 \r\n\r\n*Motivation*\r\n\r\nWhen zookeeper ledgers root path is changed, using pulsar-sql to query messages will cause `BKNoSuchLedgerExistsException`.\r\n\r\n*Modifications*\r\n\r\nMake bookie using `setMetadataServiceUri` to set zookeeper uri.\r\n", "commitDateTime": "2019-11-27 14:04:16", "authoredDateTime": "2019-11-28 06:04:16", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerFactoryImpl.java", "insertions": 15, "deletions": 2, "lines": 17}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerBkTest.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerFactoryChangeLedgerPathTest.java", "insertions": 79, "deletions": 0, "lines": 79}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerFactoryTest.java", "insertions": 8, "deletions": 0, "lines": 8}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/test/BookKeeperClusterTestCase.java", "insertions": 40, "deletions": 14, "lines": 54}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/test/ZooKeeperUtil.java", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarConnectorCache.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ManagedLedgerFactoryImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.DefaultBkFactory", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ManagedLedgerBkTest.java", "spoonMethods": []}, {"spoonFilePath": "ManagedLedgerFactoryChangeLedgerPathTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryChangeLedgerPathTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ManagedLedgerFactoryTest.java", "spoonMethods": []}, {"spoonFilePath": "BookKeeperClusterTestCase.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.startBKCluster()", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.startBookie(org.apache.bookkeeper.conf.ServerConfiguration)", "TOT": 4, "UPD": 1, "INS": 1, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.setUp()", "TOT": 5, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.changeLedgerPath()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.startZKCluster()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.newServerConfiguration()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.startZKCluster(java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.startBKCluster(java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.newServerConfiguration(java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.newServerConfiguration(int,java.lang.String,java.io.File,java.io.File[],java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.startBookie(org.apache.bookkeeper.conf.ServerConfiguration,java.lang.String)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.newServerConfiguration(int,java.lang.String,java.io.File,java.io.File[])", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ZooKeeperUtil.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.test.ZooKeeperUtil.startServer(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarConnectorCache.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.sql.presto.PulsarConnectorCache.initManagedLedgerFactory(org.apache.pulsar.sql.presto.PulsarConnectorConfig)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[pulsar-io]Connector download link of debezium not found ", "body": "**Describe the bug**\r\nDownloads link of debezium not found \r\n\r\n![image](https://user-images.githubusercontent.com/1907867/61104611-9bb0e300-a4a9-11e9-8dd0-2ab74f80bb34.png)\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/4712", "user": "tuteng", "labels": ["component/website", "triage/week-29", "type/bug"], "created": "2019-07-12 05:34:43", "closed": "2019-07-19 15:57:26", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "[Doc]Documentation on upgrading Pulsar is missing", "body": "Upgrading guide is missing, these are two items related to cluster upgrading:\r\n-  https://github.com/apache/pulsar/commit/197e22c50ed4c09a550705259ddbb3e8eed10894\r\n- https://github.com/apache/pulsar/blob/master/faq.md#is-there-any-sort-of-order-of-operations-or-best-practices-on-the-upgrade-procedure-for-a-geo-replicated-pulsar-cluster\r\n\r\nAny plans on merging these two and update in the doc?\r\n\r\ncc @sijie @Anonymitaet ", "url": "https://github.com/apache/pulsar/issues/4711", "user": "yjshen", "labels": ["component/documentation", "triage/week-29", "type/bug"], "created": "2019-07-12 02:42:06", "closed": "2019-07-22 00:56:46", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "standalone mode cannot sync MaxMessageSize to bookkeeper", "body": "**Describe the bug**\r\nafter upgrade to v2.4, a new setting `MaxMessageSize` was introduced to make messagesize more than 5MB, but bookkeeper still using 5M as `nettyMaxFrameSizeBytes`, which should be sync with `MaxMessageSize`\r\n\r\n**Additional context**\r\n```\r\nio.netty.handler.codec.TooLongFrameException: Adjusted frame length exceeds 5242880: 18405407 - discarded\r\n\tat io.netty.handler.codec.LengthFieldBasedFrameDecoder.fail(LengthFieldBasedFrameDecoder.java:522) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.LengthFieldBasedFrameDecoder.failIfNecessary(LengthFieldBasedFrameDecoder.java:500) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.LengthFieldBasedFrameDecoder.exceededFrameLength(LengthFieldBasedFrameDecoder.java:387) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.LengthFieldBasedFrameDecoder.decode(LengthFieldBasedFrameDecoder.java:430) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.LengthFieldBasedFrameDecoder.decode(LengthFieldBasedFrameDecoder.java:343) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:502) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:441) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:278) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1434) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:965) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:799) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:433) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:330) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/4708", "user": "freeznet", "labels": ["component/config", "component/documentation", "triage/week-29", "type/bug"], "created": "2019-07-11 09:20:37", "closed": "2019-07-18 06:45:35", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "PulsarKafkaProducer is not thread safe", "body": "**Is your feature request related to a problem? Please describe.**\r\nI replaced kafka client with pulsar-client-kafka, referring to this document.\r\nhttp://pulsar.apache.org/docs/en/adaptors-kafka/\r\n\r\nThen, sending messages to multiple topics at the same time caused an exception(NullPointerException).\r\nThis exception does not occur in version 2.2.1, but does occur in version 2.3.2 and later.\r\n\r\nI think that the change made in this [PR](https://github.com/apache/pulsar/pull/3462) is the cause.\r\nEach time you send a message to a new topic, the cluster object is regenerated.\r\nhttps://github.com/apache/pulsar/blob/v2.3.2/pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/kafka/clients/producer/PulsarKafkaProducer.java#L229\r\n\r\nThe javadoc states that KafkaProducer is thread safe.\r\nhttps://kafka.apache.org/20/javadoc/org/apache/kafka/clients/producer/KafkaProducer.html\r\nI want to use pulsar-client-kafka without modifying the code that used Kafka client.\r\n\r\n**To Reproduce**\r\n```\r\n# build.gradle\r\ndependencies {\r\n    testCompile group: 'junit', name: 'junit', version: '4.12'\r\n    compile (group: 'org.apache.pulsar', name: 'pulsar-client-kafka-original', version: '2.3.2')\r\n    compile (group: 'org.apache.pulsar', name: 'pulsar-client-auth-athenz', version: '2.3.2') \r\n}\r\n```\r\n\r\n```\r\n    public static void main(String[] args) throws Exception {\r\n\r\n        Properties properties = new Properties();\r\n        properties.setProperty(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \"pulsar+ssl://server:6651\");\r\n        properties.setProperty(ProducerConfig.RETRIES_CONFIG, \"5\");\r\n        properties.setProperty(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\r\n        properties.setProperty(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());\r\n\r\n        properties.setProperty(PulsarClientKafkaConfig.USE_TLS, \"true\");\r\n        properties.setProperty(PulsarClientKafkaConfig.TLS_TRUST_CERTS_FILE_PATH, filePath(\"trust\", \".crt\", CERT));\r\n        properties.setProperty(PulsarClientKafkaConfig.AUTHENTICATION_CLASS, AuthenticationAthenz.class.getName());\r\n        properties.setProperty(PulsarClientKafkaConfig.AUTHENTICATION_PARAMS_STRING, authParams());\r\n\r\n        properties.setProperty(\"security-protocol\", \"PLAINTEXT\");\r\n\r\n        properties.setProperty(ProducerConfig.REQUEST_TIMEOUT_MS_CONFIG, \"30000\");\r\n        properties.setProperty(ProducerConfig.ACKS_CONFIG, \"1\");\r\n        properties.setProperty(ProducerConfig.METADATA_MAX_AGE_CONFIG, \"15000\");\r\n        producer = new PulsarKafkaProducer<>(properties, new StringSerializer(), new StringSerializer());\r\n\r\n        Thread thread1 = new Thread(() -> {\r\n            String topic1 = \"persistent://topic1\";\r\n            ProducerRecord<String, String> record1 = new ProducerRecord<>(topic1, \"Hello\");\r\n            producer.send(record1, (recordMetadata, e) -> {\r\n                System.out.println(recordMetadata);\r\n            });\r\n        });\r\n\r\n        Thread thread2 = new Thread(() -> {\r\n            String topic2 = \"persistent://topic2\";\r\n            ProducerRecord<String, String> record2 = new ProducerRecord<>(topic2, \"Hello\");\r\n            producer.send(record2, (recordMetadata, e) -> {\r\n                System.out.println(recordMetadata);\r\n            });\r\n        });\r\n\r\n        thread1.start();\r\n        thread2.start();\r\n    }\r\n```\r\n\r\n```\r\n Exception in thread \"Thread-2\" java.lang.NullPointerException\r\n\tat org.apache.kafka.clients.producer.internals.DefaultPartitioner.partition(DefaultPartitioner.java:56)\r\n\tat org.apache.kafka.clients.producer.PulsarKafkaProducer.buildMessage(PulsarKafkaProducer.java:270)\r\n\tat org.apache.kafka.clients.producer.PulsarKafkaProducer.send(PulsarKafkaProducer.java:172)\r\n\tat Main.lambda$main$3(Main.java:156)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/4707", "user": "ssunorz", "labels": ["component/kafka", "triage/week-29", "type/bug", "type/feature"], "created": "2019-07-11 03:48:34", "closed": "2019-07-24 01:51:38", "commits": {"0362944f6f7d610dd5b54d3724958e0bb9cb7abc": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "cc746322d51cea14b04092370bcebf695721fe70": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 12.000277777777777, "commitsDetails": [{"commitHash": "0362944f6f7d610dd5b54d3724958e0bb9cb7abc", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["e8a95e5ba57107c1e08a2610b7c55361a09f812b"], "nameRev": "0362944f6f7d610dd5b54d3724958e0bb9cb7abc tags/v2.5.0-candidate-1~525", "commitMessage": "Fix\uff1aPulsarKafkaProducer is not thread safe (#4745)\n\nfix #4707 \r\n\r\n", "commitDateTime": "2019-07-24 09:51:38", "authoredDateTime": "2019-07-24 09:51:38", "commitGitStats": [{"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/kafka/clients/producer/PulsarKafkaProducer.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "tests/pulsar-kafka-compat-client-test/src/test/java/org/apache/pulsar/tests/integration/compat/kafka/PulsarKafkaProducerThreadSafeTest.java", "insertions": 61, "deletions": 0, "lines": 61}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarKafkaProducer.java", "spoonMethods": [{"spoonMethodName": "org.apache.kafka.clients.producer.PulsarKafkaProducer.createNewProducer(java.lang.String)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PulsarKafkaProducerThreadSafeTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.compat.kafka.PulsarKafkaProducerThreadSafeTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "cc746322d51cea14b04092370bcebf695721fe70", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["e4790f374d1036be43d1c091baae95b017ecd47c"], "nameRev": "cc746322d51cea14b04092370bcebf695721fe70 tags/v2.4.1-candidate-1^0", "commitMessage": "Fix\uff1aPulsarKafkaProducer is not thread safe (#4745)\n\nfix #4707\n\n(cherry picked from commit 0362944f6f7d610dd5b54d3724958e0bb9cb7abc)\n", "commitDateTime": "2019-08-28 16:02:25", "authoredDateTime": "2019-07-24 09:51:38", "commitGitStats": [{"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/kafka/clients/producer/PulsarKafkaProducer.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "tests/pulsar-kafka-compat-client-test/src/test/java/org/apache/pulsar/tests/integration/compat/kafka/PulsarKafkaProducerThreadSafeTest.java", "insertions": 61, "deletions": 0, "lines": 61}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarKafkaProducer.java", "spoonMethods": [{"spoonMethodName": "org.apache.kafka.clients.producer.PulsarKafkaProducer.createNewProducer(java.lang.String)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PulsarKafkaProducerThreadSafeTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.compat.kafka.PulsarKafkaProducerThreadSafeTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Search bar on 2.4.0 documentation page doesn't work", "body": "**Describe the bug**\r\nSearch bar on 2.4.0 documentation page doesn't work\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to http://pulsar.apache.org/docs/en/standalone/\r\n2. Enter a search term in the search box in the upper right hand corner\r\n3. Hit enter, click on search icon\r\n4. See no search results\r\n\r\n**Expected behavior**\r\nExpect a search box to pop up with search results\r\n\r\n**Screenshots**\r\n\r\n![Screen Shot 2019-07-10 at 2 19 39 PM](https://user-images.githubusercontent.com/35466513/61004345-a7ba6a80-a31a-11e9-8e9a-891045db4258.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4706", "user": "david-streamlio", "labels": ["type/bug"], "created": "2019-07-10 20:57:35", "closed": "2019-07-11 01:06:17", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Search box on website stopped working", "body": "After the update of Docusaurus to 1.11 in #4682, the search box stopped working.\r\n\r\n@tuteng @sijie ", "url": "https://github.com/apache/pulsar/issues/4695", "user": "merlimat", "labels": ["component/website", "type/bug"], "created": "2019-07-09 16:11:38", "closed": "2019-07-12 01:52:36", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Configuration `allowAutoTopicCreation` is not documented", "body": "- It should be documented in `broker.conf`\r\n- It should be documented in website", "url": "https://github.com/apache/pulsar/issues/4693", "user": "sijie", "labels": ["component/config", "triage/week-28", "type/bug"], "created": "2019-07-09 10:00:09", "closed": "2019-07-09 16:01:58", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[Docker] docker image for v2.4.0 is not available on dockerhub", "body": "Could someone have permission publish it there?", "url": "https://github.com/apache/pulsar/issues/4688", "user": "yjshen", "labels": ["component/build", "triage/week-28", "type/bug"], "created": "2019-07-08 12:50:48", "closed": "2019-07-11 01:36:24", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Error open RocksDB database : Compression type LZ4 is not linked with the binary", "body": "- Windows 10\r\n- fresh repo clone\r\n- mvn install\r\n\r\nTried to start pulsar, launching the script :\r\n- bin/pulsar standalone\r\n\r\nI got the following error :\r\n\r\n```\r\n21:35:04.476 [main] ERROR org.apache.bookkeeper.bookie.Journal - Problems reading from data\\standalone\\bookkeeper0\\current\\lastMark (this is okay if it is the first time starting this bookie\r\n21:35:04.859 [main] ERROR org.apache.pulsar.PulsarStandaloneStarter - Failed to start pulsar service.\r\njava.io.IOException: Error open RocksDB database\r\n\tat org.apache.bookkeeper.bookie.storage.ldb.KeyValueStorageRocksDB.<init>(KeyValueStorageRocksDB.java:182) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.bookie.storage.ldb.KeyValueStorageRocksDB.<init>(KeyValueStorageRocksDB.java:83) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.bookie.storage.ldb.KeyValueStorageRocksDB.lambda$static$0(KeyValueStorageRocksDB.java:58) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex.<init>(EntryLocationIndex.java:58) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.bookie.storage.ldb.SingleDirectoryDbLedgerStorage.<init>(SingleDirectoryDbLedgerStorage.java:161) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage.newSingleDirectoryDbLedgerStorage(DbLedgerStorage.java:148) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage.initialize(DbLedgerStorage.java:128) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.bookie.Bookie.<init>(Bookie.java:790) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.proto.BookieServer.newBookie(BookieServer.java:137) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.proto.BookieServer.<init>(BookieServer.java:106) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.runBookies(LocalBookkeeperEnsemble.java:272) ~[classes/:?]\r\n\tat org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.startStandalone(LocalBookkeeperEnsemble.java:396) ~[classes/:?]\r\n\tat org.apache.pulsar.PulsarStandalone.start(PulsarStandalone.java:259) ~[classes/:?]\r\n\tat org.apache.pulsar.PulsarStandaloneStarter.main(PulsarStandaloneStarter.java:121) [classes/:?]\r\nCaused by: org.rocksdb.RocksDBException: Compression type LZ4 is not linked with the binary.\r\n\tat org.rocksdb.RocksDB.open(Native Method) ~[rocksdbjni-5.13.3.jar:?]\r\n\tat org.rocksdb.RocksDB.open(RocksDB.java:231) ~[rocksdbjni-5.13.3.jar:?]\r\n\tat org.apache.bookkeeper.bookie.storage.ldb.KeyValueStorageRocksDB.<init>(KeyValueStorageRocksDB.java:179) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\t... 13 more\r\n21:35:04.865 [Thread-1] ERROR org.apache.pulsar.PulsarStandaloneStarter - Shutdown failed: null\r\n\r\n```\r\n\r\nCan you help me ?\r\n\r\nThank you in advance.\r\n", "url": "https://github.com/apache/pulsar/issues/4684", "user": "GoX1337", "labels": ["component/build", "triage/week-28", "type/bug"], "created": "2019-07-07 19:36:49", "closed": "2019-07-09 10:36:21", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Broken link on the \"Develop Connectors\" page", "body": "**Describe the bug**\r\nOn the following page, https://pulsar.apache.org/docs/en/io-develop/ , the link pointing to the KafkaSource as a good example to follow takes us to a 404 => https://github.com/apache/pulsar/tree/master/master/pulsar-io/kafka/src/main/java/org/apache/pulsar/io/kafka/KafkaAbstractSource.java\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to  https://pulsar.apache.org/docs/en/io-develop/\r\n2. Click on \"Source Connector\" link\r\n3. See error\r\n\r\n**Expected behavior**\r\nWe expect to be taken to the https://github.com/apache/pulsar/blob/master/pulsar-io/kafka/src/main/java/org/apache/pulsar/io/kafka/KafkaStringSource.java page\r\n\r\n**Screenshots**\r\n\r\n<img width=\"880\" alt=\"Screen Shot 2019-07-02 at 8 48 59 AM\" src=\"https://user-images.githubusercontent.com/35466513/60527045-5b31b800-9ca6-11e9-8366-c961bec92493.png\">\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4661", "user": "david-streamlio", "labels": ["type/bug"], "created": "2019-07-02 15:49:58", "closed": "2019-07-09 10:06:08", "commits": {"270af329cc31ef4f24243acd6c6983a6006d20ac": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "270af329cc31ef4f24243acd6c6983a6006d20ac", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["0217fb0e1e0302dfa3a22582ee229d5bb72e40ea"], "nameRev": "270af329cc31ef4f24243acd6c6983a6006d20ac tags/v2.5.0-candidate-1~580", "commitMessage": "[doc] [Issue #4661] fix broken links on 'Develop connectors' page (#4674)\n\n", "commitDateTime": "2019-07-05 13:00:35", "authoredDateTime": "2019-07-05 07:00:35", "commitGitStats": [{"filePath": "site2/docs/io-develop.md", "insertions": 5, "deletions": 5, "lines": 10}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "C++ consumer's connection is often closed", "body": "**Describe the bug**\r\n\r\nIf C++ consumer subscribes to a topic that a lot of messages are published to, the connection with the broker is often closed and reconnection occurs. This phenomenon seems to occur only when connecting to the broker using TLS.\r\n\r\nThe following is the client side log at that time:\r\n\r\n```\r\n2019-07-02 20:07:13.455 INFO  ClientConnection:1274 | [xxx.xxx.xxx.xxx:46586 -> xxx.xxx.xxx.xxx:6651] Connection closed\r\n2019-07-02 20:07:13.456 INFO  HandlerBase:129 | [persistent://massakam/global/test/t1, sub1, 0] Schedule reconnection in 0.1 s\r\n2019-07-02 20:07:13.456 WARN  ClientConnection:1153 | [xxx.xxx.xxx.xxx:46586 -> xxx.xxx.xxx.xxx:6651] Could not send message on connection: system:9 Bad file descriptor\r\n2019-07-02 20:07:13.456 INFO  ClientConnection:1274 | [xxx.xxx.xxx.xxx:46586 -> xxx.xxx.xxx.xxx:6651] Connection closed\r\n2019-07-02 20:07:13.456 INFO  ClientConnection:211 | [xxx.xxx.xxx.xxx:46586 -> xxx.xxx.xxx.xxx:6651] Destroyed connection\r\n2019-07-02 20:07:13.556 INFO  HandlerBase:52 | [persistent://massakam/global/test/t1, sub1, 0] Getting connection from pool\r\n2019-07-02 20:07:13.567 INFO  ConnectionPool:62 | Deleting stale connection from pool for pulsar+ssl://dev-broker11.xxx.xxx.xxx.yahoo.co.jp:6651 use_count: -1 @ 0\r\n2019-07-02 20:07:13.567 INFO  ConnectionPool:72 | Created connection for pulsar+ssl://dev-broker11.xxx.xxx.xxx.yahoo.co.jp:6651\r\n2019-07-02 20:07:13.578 INFO  ClientConnection:300 | [xxx.xxx.xxx.xxx:46596 -> xxx.xxx.xxx.xxx:6651] Connected to broker\r\n2019-07-02 20:07:13.624 INFO  ConsumerImpl:169 | [persistent://massakam/global/test/t1, sub1, 0] Created consumer on broker [xxx.xxx.xxx.xxx:46596 -> xxx.xxx.xxx.xxx:6651]\r\n```\r\n\r\nThere are no errors or warnings in the broker side log.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Compile and execute the following code:\r\n```cpp\r\n#include <iostream>\r\n#include <pulsar/Client.h>\r\n\r\nusing namespace std;\r\nusing namespace pulsar;\r\n\r\nvoid messageListener(Consumer consumer, const Message& msg) {\r\n    //cout << \"Receive: \" << msg.getDataAsString() << endl;\r\n    consumer.acknowledge(msg);\r\n}\r\n\r\nint main() {\r\n    ClientConfiguration config = ClientConfiguration();\r\n    config.setTlsTrustCertsFilePath(\"<TRUST_CERT_FILE>\");\r\n    Client client(\"pulsar+ssl://<BROKER>:6651\", config);\r\n\r\n    ConsumerConfiguration consumerConfig;\r\n    consumerConfig.setMessageListener(messageListener);\r\n    Consumer consumer;\r\n    Result result = client.subscribe(\"<TOPIC>\", \"<SUBSCRIPTION>\", consumerConfig, consumer);\r\n\r\n    if (result != ResultOk) {\r\n        cerr << \"Failed to create consumer: \" << result << endl;\r\n        return -1;\r\n    }\r\n\r\n    int n;\r\n    cin >> n;\r\n\r\n    consumer.close();\r\n    client.close();\r\n}\r\n```\r\n2. Publish 1KB messages at a rate of about 5000 msg/sec to the topic that the consumer is connecting to.\r\n```sh\r\n$ ./bin/pulsar-perf produce -n 1 -f payload.txt -r 5000 -s 1024 -time 60 <TOPIC>\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: CentOS 7\r\n\r\n**Pulsar version**\r\n- broker: 2.3.2\r\n- client: 2.3.2", "url": "https://github.com/apache/pulsar/issues/4658", "user": "massakam", "labels": ["triage/week-28", "type/bug"], "created": "2019-07-02 11:38:44", "closed": "2019-07-20 00:25:25", "commits": {}, "ttf": 17.00027777777778, "commitsDetails": []}, {"title": "C++ client producer sendAsync() timeout check method seems too arbitrary", "body": "**C++ client producer sendAsync() timeout check method seems too arbitrary**\r\n\r\n\r\n**Analysis**\r\nIn general, the c++ client producer timeout check was implemented in pulsar/pulsar-client-cpp/lib/ProducerImpl.cc, `ProducerImpl::handleSendTimeout(...)`, which is registered as a handler of `ProducerImpl::sendTimer_`;\r\nIn any performing phase of `ProducerImpl::sendTimer_`, the very first `pulsar::OpSendMsg` element inside `ProducerImpl::pendingMessagesQueue_` will be picked up and compare the  OpSendMsg::timeout_ with current tick. If the time diff is less than 0, there is a sending timeout happens. \r\n\r\nSo far so good.\r\n\r\nBut then, it invokes the method `ProducerImpl::failPendingMessages(...)` for dealing the message failure stuff. Definitely, it works, but not only on the message it already checked as we hoped, but just all the messages inside `ProducerImpl::pendingMessagesQueue_`.\r\n\r\nResult: Inside a sending timeout check, if the very oldest message inside the pending queue timeout, will lead all the messages inside the pending queue to be processed as a timeout\r\n\r\n**Expected behavior**\r\nA more specifical check on every message timeout. \r\n\r\n**Desktop (please complete the following information):**\r\n - OS: centOS\r\n\r\n**About the performance**\r\nAs there are much more performing of check and compare than it was, the performance will downgrade undoubtedly. We may have a discussion of it, and make a decision then.\r\n", "url": "https://github.com/apache/pulsar/issues/4656", "user": "easyfan", "labels": ["type/bug"], "created": "2019-07-02 02:58:03", "closed": "2019-07-04 12:37:08", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "[doc] cause deadlock while use subscribeAsync demo in java client doc.", "body": "Here is the example in http://pulsar.apache.org/docs/en/client-libraries-java/#multi-topic-subscriptions\r\n![image](https://user-images.githubusercontent.com/12592133/60428130-c473e580-9c2a-11e9-9c2b-1539d7945b28.png)\r\n\r\nUse receive() to get message in subscribeAsync.thenAccept() will cause deadlock, because thread will block at receive() and can't call sendFlowPermitsToBroker(), so the thread will block forever.\r\n\r\nNeed to update doc http://pulsar.apache.org/docs/en/client-libraries-java/#multi-topic-subscriptions", "url": "https://github.com/apache/pulsar/issues/4648", "user": "codelipenghui", "labels": ["type/bug"], "created": "2019-07-01 10:10:19", "closed": "2019-07-01 22:20:10", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[cpp client] fatal error: google/protobuf/port_def.inc: No such file or directory", "body": "**Describe the bug**\r\nWhen I use `./docker-build.sh` building cpp client, encountered the following error:\r\n\r\n```\r\n/pulsar/pulsar-client-cpp/lib/PulsarApi.pb.h:10:40: fatal error: google/protobuf/port_def.inc: No such file or directory\r\ncompilation terminated.\r\nlib/CMakeFiles/pulsarStatic.dir/build.make:237: recipe for target 'lib/CMakeFiles/pulsarStatic.dir/CompressionCodecZstd.cc.o' failed\r\nmake[2]: *** [lib/CMakeFiles/pulsarStatic.dir/CompressionCodecZstd.cc.o] Error 1\r\nmake[2]: *** Waiting for unfinished jobs....\r\nIn file included from /pulsar/pulsar-client-cpp/lib/ClientConnection.h:36:0,\r\n                 from /pulsar/pulsar-client-cpp/lib/ConnectionPool.h:25,\r\n                 from /pulsar/pulsar-client-cpp/lib/ConnectionPool.cc:19:\r\n/pulsar/pulsar-client-cpp/lib/PulsarApi.pb.h:10:40: fatal error: google/protobuf/port_def.inc: No such file or directory\r\ncompilation terminated.\r\n[  4%] Building CXX object lib/CMakeFiles/pulsarStatic.dir/Schema.cc.o\r\nlib/CMakeFiles/pulsarStatic.dir/build.make:261: recipe for target 'lib/CMakeFiles/pulsarStatic.dir/ConnectionPool.cc.o' failed\r\nmake[2]: *** [lib/CMakeFiles/pulsarStatic.dir/ConnectionPool.cc.o] Error 1\r\nIn file included from /pulsar/pulsar-client-cpp/lib/ClientConnection.h:36:0,\r\n                 from /pulsar/pulsar-client-cpp/lib/ConnectionPool.h:25,\r\n                 from /pulsar/pulsar-client-cpp/lib/BinaryProtoLookupService.h:25,\r\n                 from /pulsar/pulsar-client-cpp/lib/ClientImpl.h:24,\r\n                 from /pulsar/pulsar-client-cpp/lib/UnAckedMessageTrackerInterface.h:27,\r\n                 from /pulsar/pulsar-client-cpp/lib/UnAckedMessageTrackerEnabled.h:21,\r\n                 from /pulsar/pulsar-client-cpp/lib/UnAckedMessageTrackerEnabled.cc:19:\r\n/pulsar/pulsar-client-cpp/lib/PulsarApi.pb.h:10:40: fatal error: google/protobuf/port_def.inc: No such file or directory\r\ncompilation terminated.\r\nIn file included from /pulsar/pulsar-client-cpp/lib/ClientConnection.h:36:0,\r\n                 from /pulsar/pulsar-client-cpp/lib/ConnectionPool.h:25,\r\n                 from /pulsar/pulsar-client-cpp/lib/BinaryProtoLookupService.h:25,\r\n                 from /pulsar/pulsar-client-cpp/lib/ClientImpl.h:24,\r\n                 from /pulsar/pulsar-client-cpp/lib/ReaderImpl.cc:20:\r\n/pulsar/pulsar-client-cpp/lib/PulsarApi.pb.h:10:40: fatal error: google/protobuf/port_def.inc: No such file or directory\r\ncompilation terminated.\r\nlib/CMakeFiles/pulsarShared.dir/build.make:69: recipe for target 'lib/CMakeFiles/pulsarShared.dir/UnAckedMessageTrackerEnabled.cc.o' failed\r\nmake[2]: *** [lib/CMakeFiles/pulsarShared.dir/UnAckedMessageTrackerEnabled.cc.o] Error 1\r\nlib/CMakeFiles/pulsarShared.dir/build.make:189: recipe for target 'lib/CMakeFiles/pulsarShared.dir/ReaderImpl.cc.o' failed\r\nmake[2]: *** [lib/CMakeFiles/pulsarShared.dir/ReaderImpl.cc.o] Error 1\r\nIn file included from /pulsar/pulsar-client-cpp/lib/ClientConnection.h:36:0,\r\n                 from /pulsar/pulsar-client-cpp/lib/ConnectionPool.h:25,\r\n                 from /pulsar/pulsar-client-cpp/lib/ConnectionPool.cc:19:\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/4647", "user": "wolfstudy", "labels": ["type/bug"], "created": "2019-07-01 09:43:31", "closed": "2019-07-01 10:05:28", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Per message sequence id is lost in message batch", "body": "**Describe the bug**\r\n\r\nProduce 10 messages using following code:\r\n\r\n```\r\n                for (int i = 1; i <= numMessages; i++) {\r\n                    producer.newMessage()\r\n                        .value(\"value-\" + i)\r\n                        .sequenceId(i)\r\n                        .sendAsync();\r\n                }\r\n                producer.flush();\r\n```\r\n\r\nThe 10 messages will return the same sequence id `1`. Because currently we only store the sequence id for the first message in the message batch.\r\n\r\n**To Reproduce**\r\n\r\nRun the code example\r\n\r\n**Expected behavior**\r\n\r\nUser might be using offset as sequence id when copying a file into pulsar topic. The sequence id will be dropped by Pulsar and the consumers can't retrieve the sequence id that the producer set.\r\n\r\n**Additional context**\r\n\r\nN/A", "url": "https://github.com/apache/pulsar/issues/4643", "user": "sijie", "labels": ["type/bug"], "created": "2019-06-30 11:51:21", "closed": "2019-07-02 18:46:51", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "CDC/Debezium : Unexpected exception with an optional Postgis.Geometry column", "body": "When using Postgres Debezium connector with an **nullable \"Postgis.Geometry\"** column, we receive an **Unexpected exception** on startup (during the **RecordsRecordsSnapshotProducer**). Everything is working fine if the column is **NOT** nullable.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a schema like this\r\n```\r\nCREATE EXTENSION postgis;\r\nCREATE TABLE t_coordonnees\r\n(\r\n  id SERIAL NOT NULL PRIMARY KEY,\r\n  wgs84 geometry(Geometry,4326)\r\n);\r\n```\r\n2. Start ```pulsar standalone```\r\n3. Add connector :  ```bin/pulsar-admin source localrun  --sourceConfigFile debezium-postgres-source-config.yaml```\r\n\r\n4. Error\r\n```\r\nio.debezium.connector.postgresql.RecordsSnapshotProducer - unexpected exception\r\norg.apache.kafka.connect.errors.SchemaBuilderException: Invalid SchemaBuilder call: optional has already been set.\r\n\tat org.apache.kafka.connect.data.SchemaBuilder.checkNull(SchemaBuilder.java:406) ~[connect-api-0.10.2.1.jar:?]\r\n\tat org.apache.kafka.connect.data.SchemaBuilder.optional(SchemaBuilder.java:98) ~[connect-api-0.10.2.1.jar:?]\r\n\tat io.debezium.relational.TableSchemaBuilder.addField(TableSchemaBuilder.java:361) ~[debezium-core-0.10.0.Beta2.jar:0.10.0.Beta2]\r\n\tat io.debezium.relational.TableSchemaBuilder.lambda$create$0(TableSchemaBuilder.java:108) ~[debezium-core-0.10.0.Beta2.jar:0.10.0.Beta2]\r\n\tat java.util.ArrayList.forEach(ArrayList.java:1257) ~[?:1.8.0_191]\r\n\tat java.util.Collections$UnmodifiableCollection.forEach(Collections.java:1080) ~[?:1.8.0_191]\r\n\tat io.debezium.relational.TableSchemaBuilder.create(TableSchemaBuilder.java:99) ~[debezium-core-0.10.0.Beta2.jar:0.10.0.Beta2]\r\n\tat io.debezium.relational.RelationalDatabaseSchema.buildAndRegisterSchema(RelationalDatabaseSchema.java:126) ~[debezium-core-0.10.0.Beta2.jar:0.10.0.Beta2]\r\n\tat io.debezium.connector.postgresql.PostgresSchema.refreshSchema(PostgresSchema.java:171) ~[debezium-connector-postgres-0.10.0.Beta2.jar:0.10.0.Beta2]\r\n\tat java.util.concurrent.ConcurrentHashMap$KeySetView.forEach(ConcurrentHashMap.java:4649) ~[?:1.8.0_191]\r\n\tat java.util.Collections$UnmodifiableCollection.forEach(Collections.java:1080) ~[?:1.8.0_191]\r\n\tat io.debezium.connector.postgresql.PostgresSchema.refreshSchemas(PostgresSchema.java:162) ~[debezium-connector-postgres-0.10.0.Beta2.jar:0.10.0.Beta2]\r\n\tat io.debezium.connector.postgresql.PostgresSchema.refresh(PostgresSchema.java:95) ~[debezium-connector-postgres-0.10.0.Beta2.jar:0.10.0.Beta2]\r\n\tat io.debezium.connector.postgresql.RecordsSnapshotProducer.takeSnapshot(RecordsSnapshotProducer.java:189) ~[debezium-connector-postgres-0.10.0.Beta2.jar:0.10.0.Beta2]\r\n\tat io.debezium.connector.postgresql.RecordsSnapshotProducer.lambda$start$0(RecordsSnapshotProducer.java:87) ~[debezium-connector-postgres-0.10.0.Beta2.jar:0.10.0.Beta2]\r\n```\r\n\r\n**Additional context**\r\nI was thinking that the problem was coming from Debezium first (see https://issues.jboss.org/browse/DBZ-1364), but the problem is probably related to the kafka connect-api version used by Pulsar (**connect-api-0.10.2.1**) which is quite old. Actually the last version is **2.3.0**. We should probably update the version expecting to fix this behaviour.\r\n", "url": "https://github.com/apache/pulsar/issues/4638", "user": "willome", "labels": ["type/bug"], "created": "2019-06-28 12:45:02", "closed": "2019-07-09 10:04:04", "commits": {"deb6492b579a062c3b6d8b0e611461d8c26f87d9": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 10.000277777777777, "commitsDetails": [{"commitHash": "deb6492b579a062c3b6d8b0e611461d8c26f87d9", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["bbaf2d9eadbf678fd22e1541cc583b2607499714"], "nameRev": "deb6492b579a062c3b6d8b0e611461d8c26f87d9 tags/v2.5.0-candidate-1~594", "commitMessage": "Issue #4638 : Update Kafka connect-api to version 2.3.0 (#4650)\n\n* Issue #4638: Update Kafka connect-api to version 2.3.0\r\n\r\n* remove 'block.on.buffer.full' property (already removed from kafka)\r\n", "commitDateTime": "2019-07-02 08:51:39", "authoredDateTime": "2019-07-02 17:51:39", "commitGitStats": [{"filePath": "pom.xml", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/kafka/clients/consumer/PulsarKafkaConsumer.java", "insertions": 66, "deletions": 0, "lines": 66}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/kafka/clients/producer/PulsarKafkaProducer.java", "insertions": 35, "deletions": 23, "lines": 58}, {"filePath": "pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/pulsar/client/kafka/compat/KafkaProducerInterceptorWrapper.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSource.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "pulsar-io/kafka-connect-adaptor/src/main/java/org/apache/pulsar/io/kafka/connect/PulsarIOSourceTaskContext.java", "insertions": 10, "deletions": 1, "lines": 11}, {"filePath": "pulsar-io/kafka-connect-adaptor/src/test/java/org/apache/pulsar/io/kafka/connect/KafkaConnectSourceTest.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "site2/docs/adaptors-kafka.md", "insertions": 0, "deletions": 1, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarKafkaConsumer.java", "spoonMethods": [{"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.subscribe(java.util.regex.Pattern)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.poll(java.time.Duration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.commitSync(java.time.Duration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.commitSync(java.util.Map,java.time.Duration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.seek(org.apache.kafka.common.TopicPartition,org.apache.kafka.clients.consumer.OffsetAndMetadata)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.position(org.apache.kafka.common.TopicPartition,java.time.Duration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.committed(org.apache.kafka.common.TopicPartition,java.time.Duration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.partitionsFor(java.lang.String,java.time.Duration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.listTopics(java.time.Duration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.offsetsForTimes(java.util.Map,java.time.Duration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.beginningOffsets(java.util.Collection,java.time.Duration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.endOffsets(java.util.Collection,java.time.Duration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.consumer.PulsarKafkaConsumer.close(java.time.Duration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarKafkaProducer.java", "spoonMethods": [{"spoonMethodName": "org.apache.kafka.clients.producer.PulsarKafkaProducer.createKafkaProducerInterceptor(java.lang.String)", "TOT": 16, "UPD": 8, "INS": 0, "MOV": 7, "DEL": 1}, {"spoonMethodName": "org.apache.kafka.clients.producer.PulsarKafkaProducer.getRecordMetadata(java.lang.String,org.apache.pulsar.client.api.TypedMessageBuilder,org.apache.pulsar.client.api.MessageId,int)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.producer.PulsarKafkaProducer", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 2}, {"spoonMethodName": "org.apache.kafka.clients.producer.PulsarKafkaProducer.initTransactions()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.producer.PulsarKafkaProducer.beginTransaction()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.producer.PulsarKafkaProducer.sendOffsetsToTransaction(java.util.Map,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.producer.PulsarKafkaProducer.commitTransaction()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.producer.PulsarKafkaProducer.abortTransaction()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.kafka.clients.producer.PulsarKafkaProducer.close(java.time.Duration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KafkaProducerInterceptorWrapper.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.kafka.compat.KafkaProducerInterceptorWrapper.onSendAcknowledgement(org.apache.pulsar.client.api.Producer,org.apache.pulsar.client.api.Message,org.apache.pulsar.client.api.MessageId,java.lang.Throwable)", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KafkaConnectSource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.kafka.connect.KafkaConnectSource.open(java.util.Map,org.apache.pulsar.io.core.SourceContext)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PulsarIOSourceTaskContext.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.kafka.connect.PulsarIOSourceTaskContext", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.kafka.connect.PulsarIOSourceTaskContext.configs()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KafkaConnectSourceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.kafka.connect.KafkaConnectSourceTest.setup()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[pulsar-dashboard]Dashboard Count of bundles on brokers page too high", "body": "**Describe the bug**\r\nOn the brokers page the count of bundles equals the count of topics.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behaviour:\r\n1. Open the pulsar dashboard web page\r\n2. Click on 'Brokers'\r\n3. The count of bundles equals the count of topics\r\n\r\n**Expected behavior**\r\nThe count of bundles should equal the number of bundles on the broker.\r\n\r\n**Screenshots**\r\n![WrongBundleCount](https://user-images.githubusercontent.com/48561471/60338000-8497ce80-999c-11e9-9249-8912eca65bd0.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4636", "user": "rshermanTHG", "labels": ["type/bug"], "created": "2019-06-28 11:02:27", "closed": "2019-06-28 18:29:19", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Delivery of messages to consumers stops until broker is restarted", "body": "In our Pulsar cluster, an event that delivery of messages of a specific topic stopped happened twice a day. The topics that caused the problem in each event are different, but they have the following common points.\r\n\r\n- They are topics under the same namespace. The namespace policy is as follows:\r\n```js\r\n{\r\n  \"auth_policies\" : {\r\n    \"namespace_auth\" : {\r\n      \"xxx.xxx.xxx\" : [ \"consume\", \"produce\" ],\r\n      \"xxx.xxx.xxx\" : [ \"consume\", \"produce\" ]\r\n    },\r\n    \"destination_auth\" : { },\r\n    \"subscription_auth_roles\" : { }\r\n  },\r\n  \"replication_clusters\" : [ \"cluster-a\", \"cluster-b\" ],\r\n  \"bundles\" : {\r\n    \"boundaries\" : [ \"0x00000000\", \"0x20000000\", \"0x30000000\", \"0x34000000\", \"0x36000000\", \"0x36400000\", \"0x36600000\", \"0x36608000\", \"0x3660c000\", \"0x3660e000\", \"0x3660e800\", \"0x3660ea00\", \"0x3660eb00\", \"0x3660ec00\", \"0x3660f000\", \"0x36610000\", \"0x36620000\", \"0x36640000\", \"0x36680000\", \"0x36700000\", \"0x36800000\", \"0x37000000\", \"0x38000000\", \"0x40000000\", \"0x44000000\", \"0x46000000\", \"0x46080000\", \"0x460a0000\", \"0x460a1000\", \"0x460a1800\", \"0x460a1c00\", \"0x460a1e00\", \"0x460a1e40\", \"0x460a1e80\", \"0x460a1f00\", \"0x460a2000\", \"0x460a4000\", \"0x460a8000\", \"0x460b0000\", \"0x460c0000\", \"0x46100000\", \"0x46200000\", \"0x46400000\", \"0x46800000\", \"0x47000000\", \"0x48000000\", \"0x50000000\", \"0x60000000\", \"0x80000000\", \"0xa0000000\", \"0xa4000000\", \"0xa6000000\", \"0xa6800000\", \"0xa6c00000\", \"0xa6c40000\", \"0xa6c48000\", \"0xa6c4c000\", \"0xa6c4d000\", \"0xa6c4d800\", \"0xa6c4dc00\", \"0xa6c4dc40\", \"0xa6c4dc41\", \"0xa6c4dc42\", \"0xa6c4dc44\", \"0xa6c4dc48\", \"0xa6c4dc50\", \"0xa6c4dc60\", \"0xa6c4dc80\", \"0xa6c4dd00\", \"0xa6c4de00\", \"0xa6c4e000\", \"0xa6c50000\", \"0xa6c60000\", \"0xa6c80000\", \"0xa6d00000\", \"0xa6e00000\", \"0xa7000000\", \"0xa8000000\", \"0xac000000\", \"0xae000000\", \"0xaf000000\", \"0xaf400000\", \"0xaf600000\", \"0xaf680000\", \"0xaf690000\", \"0xaf698000\", \"0xaf69a000\", \"0xaf69b000\", \"0xaf69b800\", \"0xaf69ba00\", \"0xaf69bb00\", \"0xaf69bb10\", \"0xaf69bb20\", \"0xaf69bb40\", \"0xaf69bb80\", \"0xaf69bc00\", \"0xaf69c000\", \"0xaf6a0000\", \"0xaf6c0000\", \"0xaf700000\", \"0xaf800000\", \"0xb0000000\", \"0xc0000000\", \"0xcfffffff\", \"0xd7ffffff\", \"0xd83fffff\", \"0xd85fffff\", \"0xd867ffff\", \"0xd86bffff\", \"0xd86dffff\", \"0xd86e7fff\", \"0xd86e87ff\", \"0xd86e89ff\", \"0xd86e8aff\", \"0xd86e8b7f\", \"0xd86e8b9f\", \"0xd86e8bbf\", \"0xd86e8bff\", \"0xd86e8fff\", \"0xd86e9fff\", \"0xd86ebfff\", \"0xd86effff\", \"0xd86fffff\", \"0xd87fffff\", \"0xd8ffffff\", \"0xd9ffffff\", \"0xdbffffff\", \"0xdfffffff\", \"0xffffffff\" ],\r\n    \"numBundles\" : 128\r\n  },\r\n  \"backlog_quota_map\" : {\r\n    \"destination_storage\" : {\r\n      \"limit\" : 107374182400,\r\n      \"policy\" : \"consumer_backlog_eviction\"\r\n    }\r\n  },\r\n  \"clusterDispatchRate\" : {\r\n    \"kks\" : {\r\n      \"dispatchThrottlingRateInMsg\" : 40000,\r\n      \"dispatchThrottlingRateInByte\" : 40960000,\r\n      \"ratePeriodInSecond\" : 1\r\n    },\r\n    \"ssk\" : {\r\n      \"dispatchThrottlingRateInMsg\" : 40000,\r\n      \"dispatchThrottlingRateInByte\" : 40960000,\r\n      \"ratePeriodInSecond\" : 1\r\n    }\r\n  },\r\n  \"subscriptionDispatchRate\" : {\r\n    \"kks\" : {\r\n      \"dispatchThrottlingRateInMsg\" : 1000,\r\n      \"dispatchThrottlingRateInByte\" : -1,\r\n      \"ratePeriodInSecond\" : 1\r\n    },\r\n    \"ssk\" : {\r\n      \"dispatchThrottlingRateInMsg\" : 1000,\r\n      \"dispatchThrottlingRateInByte\" : -1,\r\n      \"ratePeriodInSecond\" : 1\r\n    }\r\n  },\r\n  \"clusterSubscribeRate\" : { },\r\n  \"deduplicationEnabled\" : false,\r\n  \"latency_stats_sample_rate\" : { },\r\n  \"message_ttl_in_seconds\" : 0,\r\n  \"retention_policies\" : {\r\n    \"retentionTimeInMinutes\" : 10080,\r\n    \"retentionSizeInMB\" : 102401\r\n  },\r\n  \"deleted\" : false,\r\n  \"encryption_required\" : false,\r\n  \"subscription_auth_mode\" : \"None\",\r\n  \"max_producers_per_topic\" : 0,\r\n  \"max_consumers_per_topic\" : 0,\r\n  \"max_consumers_per_subscription\" : 0,\r\n  \"compaction_threshold\" : 0,\r\n  \"offload_threshold\" : -1,\r\n  \"schema_auto_update_compatibility_strategy\" : \"Full\"\r\n}\r\n```\r\n- They are both partitioned topics that have 16 partitions.\r\n- There are a large number of exclusive subscriptions to which one consumer connects.\r\n\r\nWe tried to reproduce these phenomena but did not succeed.\r\n\r\n# 1st event\r\n\r\nUsers of the topic in question did the following:\r\n\r\n1. Create subscriptions with REST API\r\n2. Reset the cursors for the created subscriptions to the past position\r\n3. Consumer start connecting to the topic\r\n\r\nThen, in one of the internal topics, messages were not delivered to the added consumers, and the backlog messages did not decrease. The stats for the internal topic at that time is here: [stats1.txt](https://github.com/apache/pulsar/files/3338390/stats1.txt)\r\n\r\nWe ran the jstack command on the broker that owns the internal topic in question, but it failed.\r\n```sh\r\n$ sudo jstack 56617\r\n\r\n56617: Unable to open socket file: target process not responding or HotSpot VM not loaded\r\nThe -F option can be used when the target process is not responding\r\n```\r\n\r\nHowever, we noticed that the result had been output to `/var/log` later. This is that thread dump: [threaddump1.txt](https://github.com/apache/pulsar/files/3338409/threaddump1.txt)\r\n\r\nThis phenomenon was solved by restarting the broker.\r\n\r\n# 2nd event\r\n\r\nThe second event occurred several hours after the first event. Backlog messages continued to increase in a different topic under the same namespace. We confirmed that the delivery of messages was stopped for all subscriptions in one of the internal topics.\r\n\r\nBelow is the stats and metadata of the internal topic. As you can see in stats-internal, all cursors stopped at the same position except for the cursor for geo-replication.\r\n\r\n- [stats2.txt](https://github.com/apache/pulsar/files/3338411/stats2.txt)\r\n- [stats-internal2.txt](https://github.com/apache/pulsar/files/3338412/stats-internal2.txt)\r\n- [info-internal2.txt](https://github.com/apache/pulsar/files/3338419/info-internal2.txt)\r\n\r\nThe jstack command on the broker also failed, but the result was output to `/var/log`.\r\n\r\n[threaddump2.txt](https://github.com/apache/pulsar/files/3338420/threaddump2.txt)\r\n\r\nAs with the first one, the problem was solved by restarting the broker.\r\n\r\n**Pulsar version**\r\nbroker: 2.2.1\r\nclient: 2.1.1-incubating", "url": "https://github.com/apache/pulsar/issues/4634", "user": "massakam", "labels": ["triage/week-28", "type/bug"], "created": "2019-06-28 09:08:25", "closed": "2020-05-19 07:27:18", "commits": {}, "ttf": 325.0002777777778, "commitsDetails": []}, {"title": "[pulsar-sql] Pulsar SQL deserializes Avro schema message is incorrect", "body": "Now, Pulsar SQL read Avro schema message by the last schema of the topic, this will cause errors in messages that read the old schema", "url": "https://github.com/apache/pulsar/issues/4607", "user": "congbobo184", "labels": ["component/sql", "triage/week-28", "type/bug"], "created": "2019-06-26 10:57:53", "closed": "2019-11-25 22:31:55", "commits": {}, "ttf": 152.00027777777777, "commitsDetails": []}, {"title": "[Schema] SchemaInfo properties are lost", "body": "When created a schema like\r\n``` scala\r\nval schemaInfo = StringSchema.utf8().getSchemaInfo\r\nval pl = new PostSchemaPayload()\r\n      pl.setType(schemaInfo.getType.name())\r\n      pl.setSchema(new String(schemaInfo.getSchema, UTF_8))\r\n      pl.setProperties(schemaInfo.getProperties)\r\n      try {\r\n        admin.schemas().createSchema(TopicName.get(topic).toString, pl)\r\n```\r\nand get schema using\r\n```scala\r\nval siReturn = admin.schemas().getSchemaInfo(TopicName.get(topic).toString)\r\n```\r\n\r\n`siReturn` I got doesn't contain `__charset` properties that `StringSchema.utf8().getSchemaInfo` contains.", "url": "https://github.com/apache/pulsar/issues/4602", "user": "yjshen", "labels": ["type/bug"], "created": "2019-06-26 03:19:53", "closed": "2019-06-27 17:47:32", "commits": {"aeb4c3d61fa151f9c99cfa89a096cded080986fa": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "372ab3259518f2b7130d091a40133d5c2cadd1b9": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "aeb4c3d61fa151f9c99cfa89a096cded080986fa", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["22f1d7d1bea3a0f8746694be824081ed06ef9912"], "nameRev": "aeb4c3d61fa151f9c99cfa89a096cded080986fa tags/v2.5.0-candidate-1~608", "commitMessage": "Issue #4602: SchemaInfo properties are lost when registering schema using admin api (#4617)\n\n* Issue #4602: SchemaInfo properties are lost when registering schema using admin api\r\n\r\n*Motivation*\r\n\r\nThe properties are not uploaded when using admin api.\r\n\r\n*Modifications*\r\n\r\nAdd the missing `properties`\r\n\r\n*Verify this change*\r\n\r\nAdd unit test to cover this change\r\n\r\n* Change protected method to public method\r\n", "commitDateTime": "2019-06-27 10:47:31", "authoredDateTime": "2019-06-28 01:47:32", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/SchemasResource.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiSchemaTest.java", "insertions": 125, "deletions": 0, "lines": 125}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SchemasResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.SchemasResource.postSchema(java.lang.String,java.lang.String,java.lang.String,org.apache.pulsar.common.protocol.schema.PostSchemaPayload,boolean,javax.ws.rs.container.AsyncResponse)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "AdminApiSchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiSchemaTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "372ab3259518f2b7130d091a40133d5c2cadd1b9", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["983b6ed4d1f11509fe8d69e53ffb0fb9eedfc835"], "nameRev": "372ab3259518f2b7130d091a40133d5c2cadd1b9 tags/v2.4.1-candidate-1~89", "commitMessage": "Issue #4602: SchemaInfo properties are lost when registering schema using admin api (#4617)\n\n* Issue #4602: SchemaInfo properties are lost when registering schema using admin api\n\n*Motivation*\n\nThe properties are not uploaded when using admin api.\n\n*Modifications*\n\nAdd the missing `properties`\n\n*Verify this change*\n\nAdd unit test to cover this change\n\n* Change protected method to public method\n\n(cherry picked from commit aeb4c3d61fa151f9c99cfa89a096cded080986fa)\n", "commitDateTime": "2019-08-27 20:14:54", "authoredDateTime": "2019-06-28 01:47:32", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/SchemasResource.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiSchemaTest.java", "insertions": 125, "deletions": 0, "lines": 125}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SchemasResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.SchemasResource.postSchema(java.lang.String,java.lang.String,java.lang.String,org.apache.pulsar.common.protocol.schema.PostSchemaPayload,boolean,javax.ws.rs.container.AsyncResponse)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "AdminApiSchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiSchemaTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "In Go client 2.3.2, can't get re-delivered message after add AckTimeout in ConsumerOptions", "body": "**Describe the bug**\r\nIn Go client, after I set ack timeout in the consumer side; when I send messages and didn't ack them, I can't get the re-delivered messages\r\n\r\n**To Reproduce**\r\n```\r\n./pulsar-admin topics create-partitioned-topic --partitions 4 persistent://public/default/some_partition_topic\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\t\"fmt\"\r\n\t\"log\"\r\n\t\"time\"\r\n\r\n\t\"github.com/apache/pulsar/pulsar-client-go/pulsar\"\r\n)\r\n\r\nfunc main() {\r\n\ttopic := \"persistent://public/default/some_partition_topic\"\r\n\r\n\t// Instantiate a Pulsar client\r\n\tclient, err := pulsar.NewClient(pulsar.ClientOptions{\r\n\t\tURL: \"pulsar://localhost:6650\",\r\n\t})\r\n\r\n\tif err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n\r\n\t// Use the client to instantiate a producer\r\n\tproducer, err := client.CreateProducer(pulsar.ProducerOptions{\r\n\t\tTopic: topic,\r\n\t})\r\n\r\n\tif err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n\r\n\t// Use the client object to instantiate a consumer\r\n\tconsumer, err := client.Subscribe(pulsar.ConsumerOptions{\r\n\t\tTopic:            topic,\r\n\t\tSubscriptionName: \"subName\",\r\n\t\tType:             pulsar.Shared,\r\n\t\tAckTimeout:       60 * time.Second,\r\n\t})\r\n\r\n\tctx := context.Background()\r\n\t// Send 10 messages synchronously and 10 messages asynchronously\r\n\tfor i := 0; i < 5; i++ {\r\n\t\t// Create a message\r\n\t\tmsg := pulsar.ProducerMessage{\r\n\t\t\tPayload: []byte(fmt.Sprintf(\"message-%d\", i)),\r\n\t\t}\r\n\t\t// Attempt to send the message\r\n\t\tif err := producer.Send(ctx, msg); err != nil {\r\n\t\t\tlog.Fatal(err)\r\n\t\t}\r\n\t}\r\n\r\n\t// Listen indefinitely on the topic\r\n\tfor {\r\n\t\tmsg, err := consumer.Receive(ctx)\r\n\t\tif err != nil {\r\n\t\t\tlog.Fatal(err)\r\n\t\t}\r\n\t\t// Do something with the message\r\n\t\tfmt.Println(\"\" + time.Now().Format(time.RFC850) + \" consume \" + string(msg.Payload()))\r\n\t\t//consumer.Ack(msg)\r\n\t}\r\n}\r\n\r\n```\r\n\r\n**Expected behavior**\r\nI can get re-delivered message.\r\n\r\n**Screenshots**\r\n```\r\n2019/06/25 13:40:55.168 c_client.go:68: [info] INFO  | PartitionedConsumerImpl:246 | Successfully Subscribed to Partitioned Topic - persistent://dev/genericfileproc/npulsar_test_input_topic with - 4 Partitions.\r\nTuesday, 25-Jun-19 13:40:55 NZST consume message-0\r\nTuesday, 25-Jun-19 13:40:55 NZST consume message-1\r\nTuesday, 25-Jun-19 13:40:55 NZST consume message-2\r\nTuesday, 25-Jun-19 13:40:55 NZST consume message-3\r\nTuesday, 25-Jun-19 13:40:55 NZST consume message-4\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Linux\r\n\r\n**Additional context**\r\nIn Java Client I can get re-delivered message.\r\n```\r\n/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/bin/java \"-javaagent:/Applications/IntelliJ IDEA.app/Contents/lib/idea_rt.jar=52644:/Applications/IntelliJ IDEA.app/Contents/bin\" -Dfile.encoding=UTF-8 -classpath /Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/charsets.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/deploy.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/ext/cldrdata.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/ext/dnsns.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/ext/jaccess.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/ext/jfxrt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/ext/localedata.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/ext/nashorn.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/ext/sunec.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/ext/sunjce_provider.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/ext/sunpkcs11.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/ext/zipfs.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/javaws.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/jce.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/jfr.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/jfxswt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/jsse.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/management-agent.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/plugin.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/resources.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/jre/lib/rt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/lib/ant-javafx.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/lib/dt.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/lib/javafx-mx.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/lib/jconsole.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/lib/packager.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/lib/sa-jdi.jar:/Library/Java/JavaVirtualMachines/jdk1.8.0_212.jdk/Contents/Home/lib/tools.jar:/Users/stevenwang/Projects/Java/target/classes:/Users/stevenwang/.m2/repository/org/apache/pulsar/pulsar-client/2.3.2/pulsar-client-2.3.2.jar:/Users/stevenwang/.m2/repository/org/apache/pulsar/pulsar-client-api/2.3.2/pulsar-client-api-2.3.2.jar:/Users/stevenwang/.m2/repository/org/apache/pulsar/protobuf-shaded/2.1.0-incubating/protobuf-shaded-2.1.0-incubating.jar:/Users/stevenwang/.m2/repository/org/lz4/lz4-java/1.5.0/lz4-java-1.5.0.jar:/Users/stevenwang/.m2/repository/com/github/luben/zstd-jni/1.3.7-3/zstd-jni-1.3.7-3.jar:/Users/stevenwang/.m2/repository/org/bouncycastle/bcpkix-jdk15on/1.60/bcpkix-jdk15on-1.60.jar:/Users/stevenwang/.m2/repository/org/bouncycastle/bcprov-jdk15on/1.60/bcprov-jdk15on-1.60.jar:/Users/stevenwang/.m2/repository/com/sun/activation/javax.activation/1.2.0/javax.activation-1.2.0.jar:/Users/stevenwang/.m2/repository/org/slf4j/slf4j-api/1.7.25/slf4j-api-1.7.25.jar:/Users/stevenwang/.m2/repository/javax/validation/validation-api/1.1.0.Final/validation-api-1.1.0.Final.jar UnackedTrackerIssue\r\nSLF4J: Failed to load class \"org.slf4j.impl.StaticLoggerBinder\".\r\nSLF4J: Defaulting to no-operation (NOP) logger implementation\r\nSLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.\r\n2019-06-25T01:42:31.590Z consume java 0\r\n2019-06-25T01:42:32.596Z consume java 1\r\n2019-06-25T01:42:33.608Z consume java 2\r\n2019-06-25T01:42:34.616Z consume java 3\r\n2019-06-25T01:42:35.628Z consume java 4\r\n2019-06-25T01:43:12.076Z consume java 0\r\n2019-06-25T01:43:13.076Z consume java 1\r\n2019-06-25T01:43:14.076Z consume java 2\r\n2019-06-25T01:43:15.082Z consume java 3\r\n2019-06-25T01:43:16.079Z consume java 4\r\n2019-06-25T01:43:53.122Z consume java 0\r\n2019-06-25T01:43:54.122Z consume java 1\r\n2019-06-25T01:43:55.123Z consume java 2\r\n2019-06-25T01:43:56.125Z consume java 3\r\n2019-06-25T01:43:57.126Z consume java 4\r\n2019-06-25T01:44:34.172Z consume java 0\r\n2019-06-25T01:44:35.173Z consume java 1\r\n2019-06-25T01:44:36.175Z consume java 2\r\n2019-06-25T01:44:37.176Z consume java 3\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/4589", "user": "stevenwangnarvar", "labels": ["component/go", "type/bug"], "created": "2019-06-25 01:49:56", "closed": "2019-07-19 01:51:40", "commits": {"cc5f25bf1a97609ad065908b9a60866c382ee2e0": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "04e11bb475cb02b204c5bd3203d87ad45542aafb": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 24.00027777777778, "commitsDetails": [{"commitHash": "cc5f25bf1a97609ad065908b9a60866c382ee2e0", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["6f5416eea0e7010c26091d9cbe72122b1fd94268"], "nameRev": "cc5f25bf1a97609ad065908b9a60866c382ee2e0 tags/v2.5.0-candidate-1~554", "commitMessage": "[issue 4589] Fix redelivered message logic of partition topic (#4653)\n\nFixes #4589\r\n\r\nMotivation\r\nWhen using Partition-topic, the logic of redeliver messages will not be triggered when the time of ackTimeout arrives.\r\n\r\nThis is because the unAckedMessageTrackerPtr_->add(msg.getMessageId()) is not call in the listener handling of partitioned topic in cpp code", "commitDateTime": "2019-07-19 09:51:39", "authoredDateTime": "2019-07-19 09:51:39", "commitGitStats": [{"filePath": "pulsar-client-cpp/lib/PartitionedConsumerImpl.cc", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-client-cpp/tests/BasicEndToEndTest.cc", "insertions": 51, "deletions": 0, "lines": 51}, {"filePath": "pulsar-client-go/pulsar/c_consumer.go", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-go/pulsar/c_error.go", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-go/pulsar/consumer_test.go", "insertions": 62, "deletions": 0, "lines": 62}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "04e11bb475cb02b204c5bd3203d87ad45542aafb", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["522f715fbbcff949a046d2c468f9483787280c20"], "nameRev": "04e11bb475cb02b204c5bd3203d87ad45542aafb tags/v2.4.1-candidate-1~54", "commitMessage": "[issue 4589] Fix redelivered message logic of partition topic (#4653)\n\nFixes #4589\n\nMotivation\nWhen using Partition-topic, the logic of redeliver messages will not be triggered when the time of ackTimeout arrives.\n\nThis is because the unAckedMessageTrackerPtr_->add(msg.getMessageId()) is not call in the listener handling of partitioned topic in cpp code\n(cherry picked from commit cc5f25bf1a97609ad065908b9a60866c382ee2e0)\n", "commitDateTime": "2019-08-28 00:07:55", "authoredDateTime": "2019-07-19 09:51:39", "commitGitStats": [{"filePath": "pulsar-client-cpp/lib/PartitionedConsumerImpl.cc", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-client-cpp/tests/BasicEndToEndTest.cc", "insertions": 51, "deletions": 0, "lines": 51}, {"filePath": "pulsar-client-go/pulsar/c_consumer.go", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-go/pulsar/c_error.go", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-go/pulsar/consumer_test.go", "insertions": 62, "deletions": 0, "lines": 62}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[Consumer] Subscribe and read from a single partition of a PartitionedTopic will get MessageId's partitionIdx as -1", "body": "When we subscribe to a single partition from a partitioned topic, received messages will have all their `MessageId`'s `partitionIndex` as -1, instead, they should have `partitionIdx` set correctly. ", "url": "https://github.com/apache/pulsar/issues/4586", "user": "yjshen", "labels": ["component/client", "type/bug"], "created": "2019-06-24 02:55:54", "closed": "2019-06-29 15:16:29", "commits": {"5de6e6ba9b566754f099fd1bd96809ed75ac1543": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "e7d4f29aa07017086b2f8ecef36f2730f354ada3": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "5de6e6ba9b566754f099fd1bd96809ed75ac1543", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["fd5d5c2f6d755086b3d3081925f2bf86b92db9c0"], "nameRev": "5de6e6ba9b566754f099fd1bd96809ed75ac1543 tags/v2.5.0-candidate-1~600", "commitMessage": "[Client] Consumer for a single partition of a PartitionedTopic should be set with correct partitionIndex (#4591)\n\nThis PR fixes #4586 by getting `partitionIndex` from topic name.", "commitDateTime": "2019-06-29 23:16:28", "authoredDateTime": "2019-06-29 23:16:28", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/client/impl/RawReaderImpl.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/PartitionedProducerConsumerTest.java", "insertions": 69, "deletions": 3, "lines": 72}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 10, "deletions": 8, "lines": 18}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ReaderImpl.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ZeroQueueConsumerImpl.java", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/ConsumerImplTest.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RawReaderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderImpl.RawConsumerImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PartitionedProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testInvalidSequence()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testDeletePartitionedTopic()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testMessageIdForSubscribeToSinglePartition()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.newConsumerImpl(org.apache.pulsar.client.impl.PulsarClientImpl,java.lang.String,org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,java.util.concurrent.ExecutorService,int,java.util.concurrent.CompletableFuture,org.apache.pulsar.client.impl.ConsumerImpl$SubscriptionMode,org.apache.pulsar.client.api.MessageId,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors,long,long)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.connectionOpened(org.apache.pulsar.client.impl.ClientCnx)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.trackMessage(org.apache.pulsar.client.api.Message)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.newConsumerImpl(org.apache.pulsar.client.impl.PulsarClientImpl,java.lang.String,org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,java.util.concurrent.ExecutorService,int,boolean,java.util.concurrent.CompletableFuture,org.apache.pulsar.client.impl.ConsumerImpl$SubscriptionMode,org.apache.pulsar.client.api.MessageId,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.newConsumerImpl(org.apache.pulsar.client.impl.PulsarClientImpl,java.lang.String,org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,java.util.concurrent.ExecutorService,int,boolean,java.util.concurrent.CompletableFuture,org.apache.pulsar.client.impl.ConsumerImpl$SubscriptionMode,org.apache.pulsar.client.api.MessageId,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors,long,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.subscribeTopicPartitions(java.util.concurrent.CompletableFuture,java.lang.String,int)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.subscribeIncreasedTopicPartitions(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarClientImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.doSingleTopicSubscribeAsync(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ReaderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ReaderImpl", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ZeroQueueConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ZeroQueueConsumerImpl", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImplTest.setUp()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "e7d4f29aa07017086b2f8ecef36f2730f354ada3", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["145dd8845f828e153a408673445fe3e5b8df07ff"], "nameRev": "e7d4f29aa07017086b2f8ecef36f2730f354ada3 tags/v2.4.1-candidate-1~80", "commitMessage": "[Client] Consumer for a single partition of a PartitionedTopic should be set with correct partitionIndex (#4591)\n\nThis PR fixes #4586 by getting `partitionIndex` from topic name.\n(cherry picked from commit 5de6e6ba9b566754f099fd1bd96809ed75ac1543)\n", "commitDateTime": "2019-08-27 20:39:07", "authoredDateTime": "2019-06-29 23:16:28", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/client/impl/RawReaderImpl.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/PartitionedProducerConsumerTest.java", "insertions": 69, "deletions": 3, "lines": 72}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 10, "deletions": 8, "lines": 18}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ReaderImpl.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ZeroQueueConsumerImpl.java", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/ConsumerImplTest.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RawReaderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.RawReaderImpl.RawConsumerImpl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PartitionedProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testInvalidSequence()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testDeletePartitionedTopic()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testMessageIdForSubscribeToSinglePartition()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.newConsumerImpl(org.apache.pulsar.client.impl.PulsarClientImpl,java.lang.String,org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,java.util.concurrent.ExecutorService,int,java.util.concurrent.CompletableFuture,org.apache.pulsar.client.impl.ConsumerImpl$SubscriptionMode,org.apache.pulsar.client.api.MessageId,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors,long,long)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.connectionOpened(org.apache.pulsar.client.impl.ClientCnx)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.trackMessage(org.apache.pulsar.client.api.Message)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.newConsumerImpl(org.apache.pulsar.client.impl.PulsarClientImpl,java.lang.String,org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,java.util.concurrent.ExecutorService,int,boolean,java.util.concurrent.CompletableFuture,org.apache.pulsar.client.impl.ConsumerImpl$SubscriptionMode,org.apache.pulsar.client.api.MessageId,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.newConsumerImpl(org.apache.pulsar.client.impl.PulsarClientImpl,java.lang.String,org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,java.util.concurrent.ExecutorService,int,boolean,java.util.concurrent.CompletableFuture,org.apache.pulsar.client.impl.ConsumerImpl$SubscriptionMode,org.apache.pulsar.client.api.MessageId,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors,long,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.subscribeTopicPartitions(java.util.concurrent.CompletableFuture,java.lang.String,int)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.subscribeIncreasedTopicPartitions(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarClientImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.doSingleTopicSubscribeAsync(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ReaderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ReaderImpl", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ZeroQueueConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ZeroQueueConsumerImpl", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImplTest.setUp()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Unable to publish data to Topic in this format", "body": "We use Pulsar of 2.3.2 and enable JWT authorization. Client publishers use the Topic of this format, such as 'persistent://public/default/weather/001/025/0015/C', to report the following error:\r\n\r\norg.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$AuthorizationException: Don't have permission to connect to this namespace\r\n\tat org.apache.pulsar.client.impl.ConnectionHandler.handleConnectionError(ConnectionHandler.java:75)\r\n\tat java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)\r\n\tat java.util.concurrent.CompletableFuture$UniExceptionally.tryFire(CompletableFuture.java:852)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)\r\n\tat org.apache.pulsar.client.impl.BinaryProtoLookupService.lambda$null$3(BinaryProtoLookupService.java:144)\r\n\tat java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)\r\n\tat java.util.concurrent.CompletableFuture$UniExceptionally.tryFire(CompletableFuture.java:852)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleLookupResponse(ClientCnx.java:402)\r\n\tat org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:118)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:323)\r\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:297)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1434)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:965)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:656)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:591)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:508)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:470)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$AuthorizationException: Don't have permission to connect to this namespace\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:647)\r\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire$$$capture(CompletableFuture.java:632)\r\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java)\r\n\t... 24 more", "url": "https://github.com/apache/pulsar/issues/4574", "user": "shenweiran", "labels": ["type/bug"], "created": "2019-06-21 02:40:13", "closed": "2019-06-21 06:39:18", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[managed-ledger] create bookkeeper client during ManagedLedger shutdown", "body": "During `ManagedLedgerFactoryImpl.shutdown()`, the zookeeper client is closed first and when `isBookkeeperManager`, it will get a bookkeeper from `bookkeeperFactory.get()` which result in creating new BookKeeper client using closed zk client, which caused this bug.\r\n\r\n```\r\njava.lang.IllegalStateException: java.io.IOException: org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss\r\n\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.lambda$new$0(ManagedLedgerFactoryImpl.java:125)\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl$BookkeeperFactoryForCustomEnsemblePlacementPolicy.get(ManagedLedgerFactoryImpl.java:614)\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.shutdown(ManagedLedgerFactoryImpl.java:431)\r\n\tat org.apache.pulsar.segment.pulsar.PulsarSegmentSourceBuilder.build(PulsarSegmentSourceBuilder.java:143)\r\n\tat org.apache.pulsar.segment.impl.SegmentEntryReaderImplTest.getNonPartitionedTopicSegments(SegmentEntryReaderImplTest.java:137)\r\n\tat org.apache.pulsar.segment.impl.SegmentEntryReaderImplTest.testReadEntriesFromCompleteLogSegment(SegmentEntryReaderImplTest.java:151)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\r\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\r\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n\tat org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)\r\n\tat org.junit.rules.RunRules.evaluate(RunRules.java:20)\r\n\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\r\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)\r\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)\r\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\r\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\r\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\r\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\r\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\r\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\r\n\tat org.junit.runner.JUnitCore.run(JUnitCore.java:137)\r\n\tat com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)\r\n\tat com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)\r\n\tat com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)\r\n\tat com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)\r\nCaused by: java.io.IOException: org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss\r\n\tat org.apache.bookkeeper.client.BookKeeper.validateZooKeeper(BookKeeper.java:342)\r\n\tat org.apache.bookkeeper.client.BookKeeper.<init>(BookKeeper.java:368)\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.lambda$new$0(ManagedLedgerFactoryImpl.java:123)\r\n\t... 33 more\r\nCaused by: org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss\r\n\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:102)\r\n\t... 36 more\r\n```\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4573", "user": "yjshen", "labels": ["type/bug"], "created": "2019-06-21 01:46:18", "closed": "2019-06-25 01:58:22", "commits": {"156682a7609ba416552160ee5cbf5fe774ade1a7": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "c8b257397f989dc5fef2344b71d01fd4a228a606": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "156682a7609ba416552160ee5cbf5fe774ade1a7", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["95df092832a3633a81fd719a5c096919141cc4f9"], "nameRev": "156682a7609ba416552160ee5cbf5fe774ade1a7 tags/v2.5.0-candidate-1~623", "commitMessage": "[managed-ledger] close bk-client factory gracefully (#4580)\n\n### Motivation\r\nUser can create tools on bookkeeper using ManagedLedger factory which provides [constructor](https://github.com/apache/pulsar/blob/master/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerFactoryImpl.java#L121) to create ml-factory using self-managed bookkeeper (it's not used by broker).\r\nSo, in case of self-managed bk-client, ML-Factory couldn't shutdown it gracefully and we see issue: #4573\r\n\r\n### Modification\r\n- ML-Factory creates `DefaultBkFactory` to create self-managed bk-client and shutdowns same bk-client while closing the resource. ", "commitDateTime": "2019-06-25 09:16:12", "authoredDateTime": "2019-06-24 18:16:12", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerFactoryImpl.java", "insertions": 21, "deletions": 12, "lines": 33}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ManagedLedgerFactoryImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.shutdown()", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl", "TOT": 4, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.DefaultBkFactory", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "c8b257397f989dc5fef2344b71d01fd4a228a606", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["d332815649a53a8e952d5ad75296caf92efa2e1d"], "nameRev": "c8b257397f989dc5fef2344b71d01fd4a228a606 tags/v2.4.0-candidate-2~2", "commitMessage": "[managed-ledger] close bk-client factory gracefully (#4580)\n\n### Motivation\r\nUser can create tools on bookkeeper using ManagedLedger factory which provides [constructor](https://github.com/apache/pulsar/blob/master/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerFactoryImpl.java#L121) to create ml-factory using self-managed bookkeeper (it's not used by broker).\r\nSo, in case of self-managed bk-client, ML-Factory couldn't shutdown it gracefully and we see issue: #4573\r\n\r\n### Modification\r\n- ML-Factory creates `DefaultBkFactory` to create self-managed bk-client and shutdowns same bk-client while closing the resource. ", "commitDateTime": "2019-06-26 09:46:49", "authoredDateTime": "2019-06-24 18:16:12", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerFactoryImpl.java", "insertions": 21, "deletions": 12, "lines": 33}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ManagedLedgerFactoryImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.shutdown()", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl", "TOT": 4, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.DefaultBkFactory", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "C++ client producer sendAsync() method will be blocked forever, if enough batched messages sent timeout.", "body": "**Describe the bug**\r\nC++ client producer sendAsync() method will be blocked forever, if enough batched messages sent timeout.\r\n**To Reproduce**\r\n\r\n1. Using the following producer configures: \r\nsetBatchingEnabled(true)\r\nsetBlockIfQueueFull(true)\r\nsetSendTimeout(100) (shorter timeout interval would help reproduce the issue)\r\n2. Producing huge plant of messages (better in a pressure test env.);\r\n3. Try to made some producer timeout happens (with shorter timeout interval for example)\r\n4. After accumulating enough timeout captured, the pulsar::Producer::sendAsync method will be blocked and will nerver turned back to available.\r\n\r\n**Expected behavior**\r\nThe method pulsar::Producer::sendAsync(...) might be blocked for a while, if the pending messages reached the max value, but it shall be returned back available if previous pending messages acked or reaching timeout point.\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Centos \r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4569", "user": "easyfan", "labels": ["type/bug"], "created": "2019-06-20 11:07:26", "closed": "2019-07-03 19:16:57", "commits": {"2f6861579c0bfc370abd9ecf5409c683eaa96ee7": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "c9d5b4a8f5b39d3212fe0383d5e601972219e62d": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 13.000277777777777, "commitsDetails": [{"commitHash": "2f6861579c0bfc370abd9ecf5409c683eaa96ee7", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["b367206ef32e34ca666388d8f517328ad9f6b28b"], "nameRev": "2f6861579c0bfc370abd9ecf5409c683eaa96ee7 tags/v2.5.0-candidate-1~584", "commitMessage": "C++ client producer sendAsync() method will be blocked forever, if enough batched messages sent timeout. (#4569) (#4657)\n\n", "commitDateTime": "2019-07-03 12:16:56", "authoredDateTime": "2019-07-04 03:16:56", "commitGitStats": [{"filePath": "pulsar-client-cpp/lib/ProducerImpl.cc", "insertions": 8, "deletions": 0, "lines": 8}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "c9d5b4a8f5b39d3212fe0383d5e601972219e62d", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["f0c18c994dacc8051565156ca922b6c18ec25b1e"], "nameRev": "c9d5b4a8f5b39d3212fe0383d5e601972219e62d tags/v2.4.1-candidate-1~71", "commitMessage": "C++ client producer sendAsync() method will be blocked forever, if enough batched messages sent timeout. (#4569) (#4657)\n\n(cherry picked from commit 2f6861579c0bfc370abd9ecf5409c683eaa96ee7)\n", "commitDateTime": "2019-08-27 20:42:08", "authoredDateTime": "2019-07-04 03:16:56", "commitGitStats": [{"filePath": "pulsar-client-cpp/lib/ProducerImpl.cc", "insertions": 8, "deletions": 0, "lines": 8}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Broker can't start when enable kerberos running with functions", "body": "**Describe the bug**\r\nIf running functions with brokers and enable kerberos authentication, broker can't start due to the following auth error:\r\n```\r\n10:46:41.367 [main] INFO  org.apache.pulsar.functions.worker.WorkerService - Created Pulsar client\r\n10:46:41.567 [pulsar-client-io-47-1] INFO  org.apache.pulsar.client.impl.ConnectionPool - [[id: 0x790bd42c, L:/127.0.0.1:47850 - R:127.0.0.1/127.0.0.1:6650]] Connected to server\r\n10:46:41.580 [pulsar-io-24-1] INFO  org.apache.pulsar.broker.service.ServerCnx - New connection from /127.0.0.1:47850\r\n10:46:41.586 [pulsar-client-io-47-1] INFO  org.apache.pulsar.client.impl.auth.PulsarSaslClient - Using JAAS/SASL/GSSAPI auth to connect to server Principal broker/127.0.0.1,\r\n10:46:42.195 [pulsar-client-io-47-1] ERROR org.apache.pulsar.client.impl.auth.PulsarSaslClient - SASL error\r\njavax.security.sasl.SaslException: GSS initiate failed\r\n\tat com.sun.security.sasl.gsskerb.GssKrb5Client.evaluateChallenge(GssKrb5Client.java:211) ~[?:1.8.0_112]\r\n\tat org.apache.pulsar.client.impl.auth.PulsarSaslClient$2.run(PulsarSaslClient.java:105) ~[org.apache.pulsar-pulsar-client-auth-sasl-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n\tat org.apache.pulsar.client.impl.auth.PulsarSaslClient$2.run(PulsarSaslClient.java:102) ~[org.apache.pulsar-pulsar-client-auth-sasl-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n\tat java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_112]\r\n\tat javax.security.auth.Subject.doAs(Subject.java:422) ~[?:1.8.0_112]\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/4564", "user": "murong00", "labels": ["type/bug"], "created": "2019-06-20 06:11:56", "closed": "2019-06-20 15:33:09", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "when authentication enabled pulsar-admin topics list will fail for nonpersistent topics", "body": "**Describe the bug**\r\nwhen user enable authentication, pulsar-admin topics list will fail. \r\n![image](https://user-images.githubusercontent.com/6348208/59756375-2d1ea200-92bc-11e9-984a-5d4e9a66688b.png)\r\n\r\nin the code path, persistent topic list could pass the auth, but nonPersistent topic will fail with error code 401\r\n\r\n![image](https://user-images.githubusercontent.com/6348208/59756464-563f3280-92bc-11e9-8f91-bbd41302a9d8.png)\r\n\r\nother command like tenants/namespaces list works fine.\r\n\r\nThis could reproduce when authentication is enabled", "url": "https://github.com/apache/pulsar/issues/4560", "user": "jiazhai", "labels": ["component/cli", "component/security", "type/bug"], "created": "2019-06-19 10:03:21", "closed": "2019-09-12 03:59:20", "commits": {}, "ttf": 84.00027777777778, "commitsDetails": []}, {"title": "Failed to build c++ client at first time in linux", "body": "**Describe the bug**\r\nFollowing the [doc ](http://pulsar.apache.org/docs/en/next/develop-cpp/), someone may encounter the below building error:\r\n```\r\nroot@hdp1:/opt/project/pulsar/pulsar-client-cpp# make\r\n[  1%] Generating PulsarApi.pb.h, PulsarApi.pb.cc\r\n/bin/sh: 1: protoc: not found\r\nlib/CMakeFiles/pulsarShared.dir/build.make:61: recipe for target 'lib/PulsarApi.pb.h' failed\r\nmake[2]: *** [lib/PulsarApi.pb.h] Error 127\r\nCMakeFiles/Makefile2:151: recipe for target 'lib/CMakeFiles/pulsarShared.dir/all' failed\r\nmake[1]: *** [lib/CMakeFiles/pulsarShared.dir/all] Error 2\r\nMakefile:127: recipe for target 'all' failed\r\nmake: *** [all] Error 2\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS:ubuntu16.04\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4551", "user": "murong00", "labels": ["type/bug"], "created": "2019-06-18 02:47:56", "closed": "2019-06-18 07:05:32", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Dashboard shows data only after running pulsar-admin command (docker, standalone)", "body": "**Describe the bug**\r\nI am using docker-compose to run pulsar in standalone mode together with dashboard. However, my dashboard stays empty until I run `bin/pulsar-admin clusters list` inside the pulsar container.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create docker-compose.yaml\r\n```\r\n# docker-compose.yaml\r\nversion: \"3.7\"\r\nservices:\r\n  apache-pulsar:\r\n    hostname: apache-pulsar\r\n    image: apachepulsar/pulsar:2.3.2\r\n    command: [\"bin/pulsar\", \"standalone\"]\r\n    ports:\r\n      - \"6650:6650\"\r\n      - \"8080:8080\"\r\n  apache-pulsar-dashboard:\r\n    hostname: apache-pulsar-dashboard\r\n    image: apachepulsar/pulsar-dashboard\r\n    ports:\r\n      - \"80:80\"\r\n    environment:\r\n      - SERVICE_URL=http://apache-pulsar:8080\r\n```\r\n\r\n2. Run `docker-compose up`\r\n3. Go to `http://locahost` and check the dashboard. It does not show data.\r\n4. Run `docker exec apache-pulsar /bin/bash`\r\n5. Run `bin/pulsar-admin cluster list` inside the container\r\n6. The dashboard now shows data (might need a refresh).\r\n\r\n**Expected behavior**\r\nHave the dashboard show data without running a command in the container.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: macOS but running in docker containers\r\n\r\n**Additional context**\r\nMight be related to #3367\r\n", "url": "https://github.com/apache/pulsar/issues/4550", "user": "langep", "labels": ["component/dashboard", "type/bug"], "created": "2019-06-18 01:17:09", "closed": "2020-06-09 01:28:10", "commits": {}, "ttf": 357.0002777777778, "commitsDetails": []}, {"title": "Go client: Missing ability to retrieve MessageID from pulsar.ProducerMessage", "body": "**Describe the bug**\r\nThere's no way to get the MessageID after publishing a pulsar.ProducerMessage.\r\nThis should be available and is documented here: https://pulsar.apache.org/docs/en/client-libraries-go/#producer-operations\r\n```\r\n // Attempt to send the message asynchronously and handle the response\r\n        producer.SendAsync(ctx, asyncMsg, func(msg pulsar.ProducerMessage, err error) {\r\n            if err != nil { log.Fatal(err) }\r\n\r\n            fmt.Printf(\"Message %s succesfully published\", msg.ID())\r\n        })\r\n```\r\n**Expected behavior**\r\nI think, this is a defect and is available in other clients that wrap the C++ library\r\n\r\n**Additional context**\r\npulsar v2.3.1 go client and libpulsar", "url": "https://github.com/apache/pulsar/issues/4537", "user": "Jim-Lambert-Bose", "labels": ["type/bug"], "created": "2019-06-14 17:01:30", "closed": "2019-06-20 15:30:54", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "[pulsar-client] NPE in UnAckedMessageTrackerDisabled#size()", "body": "**Describe the bug**\r\nNPE in UnAckedMessageTrackerDisabled#size()\r\n\r\nIf `ackTimeout` is not set, `unAckedMessageTracker` will be assigned the value `UNACKED_MESSAGE_TRACKER_DISABLED`.\r\n\r\nLook `UnAckedMessageTrackerDisabled` not Override the `size()` method.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a consumer and do not set `ackTimeout`\r\n2. Call the size() use the following code.\r\n`((ConsumerImpl<byte[]>) consumer).getUnAckedMessageTracker().size()`\r\n\r\n**Expected behavior**\r\nThis is a disabled method. We can get a default value. Such as 0. \r\n\r\n**Desktop (please complete the following information):**\r\n - OS: MacOS\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4535", "user": "hellozepp", "labels": ["type/bug"], "created": "2019-06-14 12:54:44", "closed": "2019-06-15 00:03:54", "commits": {"f452e6f817b5a613ded49a20ab2549fd5e34718c": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "f452e6f817b5a613ded49a20ab2549fd5e34718c", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["0fd988d32f64ba7a8fde5f74ba18056af35d302c"], "nameRev": "f452e6f817b5a613ded49a20ab2549fd5e34718c tags/v2.4.0-candidate-1~33", "commitMessage": "NPE in UnAckedMessageTrackerDisabled#size (#4535) (#4536)\n\n", "commitDateTime": "2019-06-14 17:03:53", "authoredDateTime": "2019-06-15 08:03:53", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/PerMessageUnAcknowledgedRedeliveryTest.java", "insertions": 43, "deletions": 0, "lines": 43}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/UnAckedMessageTracker.java", "insertions": 5, "deletions": 0, "lines": 5}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PerMessageUnAcknowledgedRedeliveryTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PerMessageUnAcknowledgedRedeliveryTest.testUnAckedMessageTrackerSize()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "UnAckedMessageTracker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.UnAckedMessageTracker.UnAckedMessageTrackerDisabled.size()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "AvroSchema withAlwaysAllowNull false encode occur SchemaSerializationException: java.lang.NullPointerException", "body": "**Describe the bug**\r\n```java\r\npublic static class Foo {\r\n        @Nullable\r\n        private String field1;\r\n        @Nullable\r\n        private String field2;\r\n        private int field3;\r\n        @Nullable\r\n        private Bar field4;\r\n        @Nullable\r\n        private Color color;\r\n        @AvroDefault(\"\\\"defaultValue\\\"\")\r\n        private String fieldUnableNull;\r\n    }\r\n```\r\nthis class avro Schema should be:\r\n```\r\n{\"type\":\"record\",\"name\":\"Foo\",\"namespace\":\"org.apache.pulsar.client.impl.schema.SchemaTestUtils\",\"fields\":[{\"name\":\"field1\",\"type\":[\"null\",\"string\"],\"default\":null},{\"name\":\"field2\",\"type\":[\"null\",\"string\"],\"default\":null},{\"name\":\"field3\",\"type\":\"int\"},{\"name\":\"field4\",\"type\":[\"null\",{\"type\":\"record\",\"name\":\"Bar\",\"fields\":[{\"name\":\"field1\",\"type\":\"boolean\"}]}],\"default\":null},{\"name\":\"color\",\"type\":[\"null\",{\"type\":\"enum\",\"name\":\"Color\",\"symbols\":[\"RED\",\"BLUE\"]}],\"default\":null},{\"name\":\"fieldUnableNull\",\"type\":\"string\",\"default\":\"defaultValue\"}]}\r\n```\r\nbut AvroSchemaTest.testAllowNullEncodeAndDecode avro schema is :\r\n```\r\n{\"type\":\"record\",\"name\":\"Foo\",\"namespace\":\"org.apache.pulsar.client.impl.schema.SchemaTestUtils$\",\"fields\":[{\"name\":\"field1\",\"type\":[\"null\",\"string\"],\"default\":null},{\"name\":\"field2\",\"type\":[\"null\",\"string\"],\"default\":null},{\"name\":\"field3\",\"type\":\"int\"},{\"name\":\"field4\",\"type\":[\"null\",{\"type\":\"record\",\"name\":\"Bar\",\"fields\":[{\"name\":\"field1\",\"type\":\"boolean\"}]}],\"default\":null},{\"name\":\"color\",\"type\":[\"null\",{\"type\":\"enum\",\"name\":\"Color\",\"symbols\":[\"RED\",\"BLUE\"]}],\"default\":null},{\"name\":\"fieldUnableNull\",\"type\":[\"null\",\"string\"],\"default\":\"defaultValue\"}]}\r\n```\r\n`{\"name\":\"fieldUnableNull\",\"type\":[\"null\",\"string\"],\"default\":\"defaultValue\"}` when fix code like\uff1a\r\n```java\r\nAvroSchema<Foo> avroSchema = AvroSchema.of(SchemaDefinition.<Foo>builder().withPojo(Foo.class).withAlwaysAllowNull(false).build()); \r\n```\r\nthe avro schema is correct `{\"name\":\"fieldUnableNull\",\"type\":\"string\",\"default\":\"defaultValue\"}`\uff0c but avroSchema.encode occur exception\uff1a\r\n```java\r\norg.apache.pulsar.client.api.SchemaSerializationException: java.lang.NullPointerException: in org.apache.pulsar.client.impl.schema.SchemaTestUtils$.Foo in string null of string in field fieldUnableNull of org.apache.pulsar.client.impl.schema.SchemaTestUtils$.Foo\r\n\r\n\tat org.apache.pulsar.client.impl.schema.writer.AvroWriter.write(AvroWriter.java:48)\r\n\tat org.apache.pulsar.client.impl.schema.StructSchema.encode(StructSchema.java:81)\r\n\tat org.apache.pulsar.client.impl.schema.AvroSchemaTest.testAllowNullEncodeAndDecode(AvroSchemaTest.java:231)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124)\r\n\tat org.testng.internal.Invoker.invokeMethod(Invoker.java:583)\r\n\tat org.testng.internal.Invoker.invokeTestMethod(Invoker.java:719)\r\n\tat org.testng.internal.Invoker.invokeTestMethods(Invoker.java:989)\r\n\tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125)\r\n\tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109)\r\n\tat org.testng.TestRunner.privateRun(TestRunner.java:648)\r\n\tat org.testng.TestRunner.run(TestRunner.java:505)\r\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:455)\r\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:450)\r\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:415)\r\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:364)\r\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\r\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:84)\r\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1208)\r\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1137)\r\n\tat org.testng.TestNG.runSuites(TestNG.java:1049)\r\n\tat org.testng.TestNG.run(TestNG.java:1017)\r\n\tat org.testng.IDEARemoteTestNG.run(IDEARemoteTestNG.java:72)\r\n\tat org.testng.RemoteTestNGStarter.main(RemoteTestNGStarter.java:123)\r\n```\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1.  fix AvroSchemaTest.testAllowNullEncodeAndDecode  code like:\r\n```java\r\nAvroSchema<Foo> avroSchema = AvroSchema.of(SchemaDefinition.<Foo>builder().withPojo(Foo.class).withAlwaysAllowNull(false).build()); \r\n```\r\n2. occur exception\r\n\r\n**Expected behavior**\r\nno exception happen.\r\n\r\n![image](https://user-images.githubusercontent.com/20353043/59480023-97d17700-8e91-11e9-962a-a95e4ee1e8ad.png)\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4530", "user": "ambition119", "labels": ["type/bug"], "created": "2019-06-14 02:46:46", "closed": "2019-06-14 10:49:07", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Not enough non-faulty bookies available when sending a message that exceeds defaultMaxMessageSize", "body": "**Describe the bug**\r\n\r\nLink the issue to https://github.com/apache/bookkeeper/issues/2357\r\n\r\nAll configurations are the default configuration.\r\nAfter starting, send a message that exceeds `defaultMaxMessageSize`, pulsar's broker is unavailable.\r\n\r\n**To Reproduce**\r\n\r\ntest code:\r\n\r\n```\r\nfunc main() {\r\n    client, err := pulsar.NewClient(pulsar.ClientOptions{\r\n        URL:       \"pulsar://localhost:6650\",\r\n        IOThreads: 5,\r\n    })\r\n\r\n    if err != nil {\r\n        log.Fatal(err)\r\n    }\r\n\r\n    defer client.Close()\r\n\r\n    producer, err := client.CreateProducer(pulsar.ProducerOptions{\r\n        Topic:           \"my-topic\",\r\n        CompressionType: pulsar.NoCompression,\r\n        Batching:        false,\r\n    })\r\n    if err != nil {\r\n        log.Fatal(err)\r\n    }\r\n\r\n    defer producer.Close()\r\n\r\n    ctx := context.Background()\r\n    buf := make([]byte, 10*1024*1024)\r\n    arrays := [1024*1024*5]byte{}\r\n    buf = arrays[:]\r\n    fmt.Printf(\"the buf length is:[%d]\\n\", len(buf))\r\n\r\n    producer.SendAsync(ctx, pulsar.ProducerMessage{\r\n        Payload: buf,\r\n    }, func(producerMessage pulsar.ProducerMessage, e error) {\r\n        fmt.Printf(\"send complete. err=%v,\\n\", e)\r\n    })\r\n}\r\n```\r\n\r\nerror as follows:\r\n\r\n```\r\n16:37:42.874 [BookKeeperClientWorker-OrderedExecutor-1-0] WARN  org.apache.bookkeeper.client.PendingAddOp - Failed to write entry (7213, 0): Bookie handle is not available\r\n16:37:42.874 [BookKeeperClientWorker-OrderedExecutor-1-0] WARN  org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl - Failed to find 1 bookies : excludeBookies [<Bookie:127.0.0.1:3181>], allBookies [<Bookie:127.0.0.1:3181>].\r\n16:37:42.874 [BookKeeperClientWorker-OrderedExecutor-1-0] WARN  org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl - Failed to choose a bookie: excluded [<Bookie:127.0.0.1:3181>], fallback to choose bookie randomly from the cluster.\r\n16:37:42.874 [BookKeeperClientWorker-OrderedExecutor-1-0] WARN  org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl - Failed to find 1 bookies : excludeBookies [<Bookie:127.0.0.1:3181>], allBookies [<Bookie:127.0.0.1:3181>].\r\n16:37:42.874 [BookKeeperClientWorker-OrderedExecutor-1-0] WARN  org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl - Failed to find 1 bookies : excludeBookies [<Bookie:127.0.0.1:3181>], allBookies [<Bookie:127.0.0.1:3181>].\r\n16:37:42.874 [BookKeeperClientWorker-OrderedExecutor-1-0] WARN  org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl - Failed to choose a bookie: excluded [<Bookie:127.0.0.1:3181>], fallback to choose bookie randomly from the cluster.\r\n16:37:42.874 [BookKeeperClientWorker-OrderedExecutor-1-0] WARN  org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl - Failed to find 1 bookies : excludeBookies [<Bookie:127.0.0.1:3181>], allBookies [<Bookie:127.0.0.1:3181>].\r\n16:37:42.874 [BookKeeperClientWorker-OrderedExecutor-1-0] ERROR org.apache.bookkeeper.client.MetadataUpdateLoop - UpdateLoop(ledgerId=7213,loopId=3f741063) Exception updating\r\norg.apache.bookkeeper.client.BKException$BKNotEnoughBookiesException: Not enough non-faulty bookies available\r\n\tat org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl.selectRandomInternal(RackawareEnsemblePlacementPolicyImpl.java:989) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl.selectRandom(RackawareEnsemblePlacementPolicyImpl.java:907) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl.selectFromNetworkLocation(RackawareEnsemblePlacementPolicyImpl.java:797) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicy.selectFromNetworkLocation(RackawareEnsemblePlacementPolicy.java:200) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl.selectFromNetworkLocation(RackawareEnsemblePlacementPolicyImpl.java:757) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicy.selectFromNetworkLocation(RackawareEnsemblePlacementPolicy.java:221) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl.replaceBookie(RackawareEnsemblePlacementPolicyImpl.java:659) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicy.replaceBookie(RackawareEnsemblePlacementPolicy.java:114) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.BookieWatcherImpl.replaceBookie(BookieWatcherImpl.java:295) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.EnsembleUtils.replaceBookiesInEnsemble(EnsembleUtils.java:71) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.LedgerHandle.lambda$ensembleChangeLoop$2(LedgerHandle.java:1908) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.MetadataUpdateLoop.writeLoop(MetadataUpdateLoop.java:122) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.MetadataUpdateLoop.run(MetadataUpdateLoop.java:111) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.LedgerHandle.ensembleChangeLoop(LedgerHandle.java:1927) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.LedgerHandle.handleBookieFailure(LedgerHandle.java:1876) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.client.PendingAddOp.writeComplete(PendingAddOp.java:360) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$AddCompletion.writeComplete(PerChannelBookieClient.java:2028) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$AddCompletion.lambda$errorOut$0(PerChannelBookieClient.java:2051) ~[bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$CompletionValue$1.safeRun(PerChannelBookieClient.java:1606) [bookkeeper-server-4.9.2.jar:4.9.2]\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [bookkeeper-common-4.9.2.jar:4.9.2]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_201]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_201]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_201]\r\n16:37:42.874 [BookKeeperClientWorker-OrderedExecutor-1-0] WARN  org.apache.bookkeeper.client.PendingAddOp - Failed to write entry (7213, 1): Bookie handle is not available\r\n16:37:42.874 [BookKeeperClientWorker-OrderedExecutor-1-0] WARN  org.apache.bookkeeper.client.LedgerHandle - [EnsembleChange(ledger:7213, change-id:0000000001)][attempt:1] Exception changing ensemble\r\n```\r\n\r\n**Expected behavior**\r\n\r\nWhen I send a message that exceeds the maximum message allowed by pulsar, I expect pulsar's broker to fail the message instead of causing the entire broker to be unavailable.\r\n\r\n**Screenshots**\r\n\r\n![image](https://user-images.githubusercontent.com/20965307/59418664-ff3ce780-8dfb-11e9-8f62-c2ce1fcc655b.png)\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [Mac OS]\r\n - Go version: 1.11.4\r\n - Pulsar version: latest\r\n", "url": "https://github.com/apache/pulsar/issues/4525", "user": "wolfstudy", "labels": ["component/storage", "triage/week-24", "type/bug"], "created": "2019-06-13 08:58:31", "closed": "2020-06-09 01:54:33", "commits": {}, "ttf": 361.0002777777778, "commitsDetails": []}, {"title": "pulsar function update: reduce parallelism", "body": "**Describe the bug**\r\nWhen using `bin/pulsar-admin function update` with option `--parallelism` doesn't work to reduce the parallelism.", "url": "https://github.com/apache/pulsar/issues/4522", "user": "KannarFr", "labels": ["component/functions", "type/bug"], "created": "2019-06-12 14:57:06", "closed": "2019-06-18 06:56:50", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "[Documentation][Client Lib Configuration] A full list configuration for Producer/Consumer/Client on website", "body": "**Is your feature request related to a problem? Please describe.**\r\nCurrently, when I am building a Java consumer, and want to check all available configurations. I am asked to `see the Javadoc for the ProducerBuilder class`. However, when I have checked that doc, I still need to know what kind of configuration should I pass to `loadConf(Map<String,Object>\u00a0config)`. It's really frustrate.\r\n\r\n**Describe the solution you'd like**\r\nA full list of all available configuration option for consumer/producer/client somewhere on the website,  just like what we have for cluster configuration at `https://pulsar.apache.org/docs/en/reference-configuration/`\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4509", "user": "yjshen", "labels": ["component/client", "component/documentation", "type/bug"], "created": "2019-06-11 07:09:40", "closed": "2019-09-12 06:36:17", "commits": {}, "ttf": 92.00027777777778, "commitsDetails": []}, {"title": "2.3.2 website content is not aligned with code", "body": "the content of 2.3.2 website is not aligned with code. \r\nlike [`negative acknowledgement `](https://pulsar.apache.org/docs/en/concepts-messaging/#acknowledgement-timeout) is not in 2.3.2 code, but is in the documentation.\r\nThe main reason is that the website is always cut from master. It should cut 2.3.2 base on 2.3.1 instead of master.\r\n", "url": "https://github.com/apache/pulsar/issues/4508", "user": "jiazhai", "labels": ["component/build", "component/documentation", "triage/week-46", "type/bug"], "created": "2019-06-11 06:38:41", "closed": "2020-01-14 14:46:54", "commits": {}, "ttf": 217.00027777777777, "commitsDetails": []}, {"title": "[cpp]not clear log", "body": "**Describe the bug**\r\n\r\n i try to code\r\n```\r\n    Client client(\"pulsar+ssl://**.com:6650\");\r\n```\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to \r\n```  \r\npulsar-client-cpp/example/SampleProducer.cc\r\n```  \r\n\r\n2. change \r\n```  \r\nClient client(\"pulsar://localhost:6650\"); \r\n```\r\n  to \r\n```  \r\nClient client(\"pulsar+ssl://yoururl:6650\");\r\n```  \r\n\r\n\r\n3. run SampleProducer  \r\n\r\n4. See error\r\n```\r\nlibc++abi.dylib: terminating with uncaught exception of type boost::wrapexcept<boost::system::system_error>: load_verify_file: No such file or directory\r\nAbort trap: 6\r\n```\r\n\r\n**Expected behavior**\r\n \r\nprint ```No such trustCertFile```\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/4504", "user": "liangyuanpeng", "labels": ["component/c++", "component/client", "type/bug"], "created": "2019-06-10 14:32:04", "closed": "2019-06-14 00:10:55", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "Consumer stop consume messages in Exclusive subscription", "body": "**Describe the bug**\r\nSubscription has backlog but consumer can't consume messages.\r\n\r\nHere is topic internal stats:\r\n```\r\n{\r\n  \"entriesAddedCounter\" : 441007,\r\n  \"numberOfEntries\" : 441006,\r\n  \"totalSize\" : 192462854,\r\n  \"currentLedgerEntries\" : 41006,\r\n  \"currentLedgerSize\" : 17684520,\r\n  \"lastLedgerCreatedTimestamp\" : \"2019-06-09T21:27:41.34+08:00\",\r\n  \"waitingCursorsCount\" : 0,\r\n  \"pendingAddEntriesCount\" : 0,\r\n  \"lastConfirmedEntry\" : \"35422:41005\",\r\n  \"state\" : \"LedgerOpened\",\r\n  \"ledgers\" : [ {\r\n    \"ledgerId\" : 35080,\r\n    \"entries\" : 50000,\r\n    \"size\" : 21842638,\r\n    \"offloaded\" : false\r\n  }, {\r\n    \"ledgerId\" : 35138,\r\n    \"entries\" : 50000,\r\n    \"size\" : 21962861,\r\n    \"offloaded\" : false\r\n  }, {\r\n    \"ledgerId\" : 35180,\r\n    \"entries\" : 50000,\r\n    \"size\" : 21873789,\r\n    \"offloaded\" : false\r\n  }, {\r\n    \"ledgerId\" : 35217,\r\n    \"entries\" : 50000,\r\n    \"size\" : 21909420,\r\n    \"offloaded\" : false\r\n  }, {\r\n    \"ledgerId\" : 35248,\r\n    \"entries\" : 50000,\r\n    \"size\" : 21858432,\r\n    \"offloaded\" : false\r\n  }, {\r\n    \"ledgerId\" : 35288,\r\n    \"entries\" : 50000,\r\n    \"size\" : 21754235,\r\n    \"offloaded\" : false\r\n  }, {\r\n    \"ledgerId\" : 35336,\r\n    \"entries\" : 50000,\r\n    \"size\" : 21736912,\r\n    \"offloaded\" : false\r\n  }, {\r\n    \"ledgerId\" : 35374,\r\n    \"entries\" : 50000,\r\n    \"size\" : 21840047,\r\n    \"offloaded\" : false\r\n  }, {\r\n    \"ledgerId\" : 35422,\r\n    \"entries\" : 0,\r\n    \"size\" : 0,\r\n    \"offloaded\" : false\r\n  } ],\r\n  \"cursors\" : {\r\n    \"test-sub\" : {\r\n      \"markDeletePosition\" : \"35422:36450\",\r\n      \"readPosition\" : \"35422:36451\",\r\n      \"waitingReadOp\" : false,\r\n      \"pendingReadOps\" : 1,\r\n      \"messagesConsumedCounter\" : 436452,\r\n      \"cursorLedger\" : 35405,\r\n      \"cursorLedgerLastEntry\" : 10782,\r\n      \"individuallyDeletedMessages\" : \"[]\",\r\n      \"lastLedgerSwitchTimestamp\" : \"2019-06-09T20:43:41.812+08:00\",\r\n      \"state\" : \"Open\",\r\n      \"numberOfEntriesSinceFirstNotAckedMessage\" : 1,\r\n      \"totalNonContiguousDeletedMessagesRange\" : 0,\r\n      \"properties\" : { }\r\n    }\r\n  }\r\n}\r\n```\r\nand topic stats:\r\n```\r\n{\r\n  \"msgRateIn\" : 0.0,\r\n  \"msgThroughputIn\" : 0.0,\r\n  \"msgRateOut\" : 0.0,\r\n  \"msgThroughputOut\" : 0.0,\r\n  \"averageMsgSize\" : 0.0,\r\n  \"storageSize\" : 1974139,\r\n  \"publishers\" : [ {\r\n    \"msgRateIn\" : 0.0,\r\n    \"msgThroughputIn\" : 0.0,\r\n    \"averageMsgSize\" : 0.0,\r\n    \"producerId\" : 9,\r\n    \"metadata\" : { },\r\n    \"producerName\" : \"65-2103\",\r\n    \"connectedSince\" : \"2019-06-08T20:43:38.072+08:00\",\r\n    \"clientVersion\" : \"2.3.1\",\r\n    \"address\" : \"/10.1.1.130:58110\"\r\n  }, {\r\n    \"msgRateIn\" : 0.0,\r\n    \"msgThroughputIn\" : 0.0,\r\n    \"averageMsgSize\" : 0.0,\r\n    \"producerId\" : 16,\r\n    \"metadata\" : { },\r\n    \"producerName\" : \"65-2105\",\r\n    \"connectedSince\" : \"2019-06-08T20:43:39.287+08:00\",\r\n    \"clientVersion\" : \"2.3.1\",\r\n    \"address\" : \"/10.1.2.239:34895\"\r\n  }, {\r\n    \"msgRateIn\" : 0.0,\r\n    \"msgThroughputIn\" : 0.0,\r\n    \"averageMsgSize\" : 0.0,\r\n    \"producerId\" : 17,\r\n    \"metadata\" : { },\r\n    \"producerName\" : \"65-2106\",\r\n    \"connectedSince\" : \"2019-06-08T20:43:40.458+08:00\",\r\n    \"clientVersion\" : \"2.3.1\",\r\n    \"address\" : \"/10.1.1.63:3963\"\r\n  }, {\r\n    \"msgRateIn\" : 0.0,\r\n    \"msgThroughputIn\" : 0.0,\r\n    \"averageMsgSize\" : 0.0,\r\n    \"producerId\" : 27,\r\n    \"metadata\" : { },\r\n    \"producerName\" : \"65-2104\",\r\n    \"connectedSince\" : \"2019-06-08T20:43:38.111+08:00\",\r\n    \"clientVersion\" : \"2.3.1\",\r\n    \"address\" : \"/10.1.2.165:43102\"\r\n  } ],\r\n  \"subscriptions\" : {\r\n    \"test-sub\" : {\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateRedeliver\" : 0.0,\r\n      \"msgBacklog\" : 4555,\r\n      \"blockedSubscriptionOnUnackedMsgs\" : false,\r\n      \"unackedMessages\" : 0,\r\n      \"type\" : \"Exclusive\",\r\n      \"activeConsumerName\" : \"61d6d\",\r\n      \"msgRateExpired\" : 0.0,\r\n      \"consumers\" : [ {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"61d6d\",\r\n        \"availablePermits\" : 1000,\r\n        \"unackedMessages\" : 0,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"metadata\" : { },\r\n        \"connectedSince\" : \"2019-06-10T01:12:51.666+08:00\",\r\n        \"clientVersion\" : \"2.3.1\",\r\n        \"address\" : \"/10.1.1.226:48925\"\r\n      } ]\r\n    }\r\n  },\r\n  \"replication\" : { },\r\n  \"deduplicationStatus\" : \"Disabled\"\r\n}\r\n```\r\nWhen i peek messages by pulsar admin, i got timeout error. check the broker's log, found some exceptions logs:\r\n```\r\n20:06:39.464 [bookkeeper-ml-scheduler-OrderedScheduler-1-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [public/default/persistent/113]-35422 read entry timeout for 36451-36451 after 120 sec\r\n20:06:39.464 [bookkeeper-ml-scheduler-OrderedScheduler-1-0] WARN  org.apache.bookkeeper.mledger.impl.OpReadEntry - [public/default/persistent/113][test-sub] read failed from ledger at position:35422:36451 : Bookie operation timeout\r\n20:06:39.464 [broker-topic-workers-OrderedScheduler-5-0] ERROR org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer - [persistent://public/default/113 / test-sub-Consumer{subscription=PersistentSubscription{topic=persistent://public/default/113, name=test-sub}, consumerId=69167, consumerName=61d6d, address=/10.1.1.226:48925}] Error reading entries at 35422:36451 : Bookie operation timeout - Retrying to read in 59.0 seconds\r\n20:06:50.674 [pulsar-web-28-15] INFO  org.eclipse.jetty.server.RequestLog - 10.1.2.2 - - [10/Jun/2019:20:06:50 +0800] \"GET /metrics HTTP/1.1\" 302 0 \"-\" \"Prometheus/2.7.2\" 0\r\n20:06:50.679 [prometheus-stats-37-1] INFO  org.eclipse.jetty.server.RequestLog - 10.1.2.2 - - [10/Jun/2019:20:06:50 +0800] \"GET /metrics/ HTTP/1.1\" 200 156435 \"http://10.1.2.88:7790/metrics\" \"Prometheus/2.7.2\" 5\r\n20:06:58.380 [bookkeeper-ml-scheduler-OrderedScheduler-6-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [public/default/persistent/113]-35422 read entry timeout for 35422:36451 after 120 sec\r\n20:06:58.380 [pulsar-web-28-18] ERROR org.apache.pulsar.broker.admin.impl.PersistentTopicsBase - [null] Failed to get message at position 1 from persistent://public/default/113 test-sub\r\njava.util.concurrent.ExecutionException: org.apache.bookkeeper.mledger.ManagedLedgerException: Bookie operation timeout\r\n\tat java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357) ~[?:1.8.0_121]\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895) ~[?:1.8.0_121]\r\n\tat org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalPeekNthMessage(PersistentTopicsBase.java:1045) ~[org.apache.pulsar-pulsar-broker-2.3.2.jar:2.3.2]\r\n\tat org.apache.pulsar.broker.admin.v2.PersistentTopics.peekNthMessage(PersistentTopics.java:417) ~[org.apache.pulsar-pulsar-broker-2.3.2.jar:2.3.2]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_121]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_121]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_121]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_121]\r\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:76) ~[org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:148) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:191) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$ResponseOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:200) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:103) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:493) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:415) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:104) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:277) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:316) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:298) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:268) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:289) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:256) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:703) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:416) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:370) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:389) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:342) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:229) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:865) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1655) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53) [org.apache.pulsar-pulsar-broker-2.3.2.jar:2.3.2]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1642) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1340) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1242) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:220) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:174) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:503) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:364) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:305) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_121]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_121]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_121]\r\nCaused by: org.apache.bookkeeper.mledger.ManagedLedgerException: Bookie operation timeout\r\n20:07:38.465 [broker-topic-workers-OrderedScheduler-5-0] ERROR org.apache.bookkeeper.common.util.SafeRunnable - Unexpected throwable caught \r\njava.lang.ArrayIndexOutOfBoundsException: null\r\n```\r\n\r\n**Pulsar version**\r\nbroker: 2.3.2\r\nclient: 2.3.1\r\n", "url": "https://github.com/apache/pulsar/issues/4503", "user": "codelipenghui", "labels": ["type/bug"], "created": "2019-06-10 12:45:30", "closed": "2020-06-08 02:06:26", "commits": {}, "ttf": 363.0002777777778, "commitsDetails": []}, {"title": "pulsar transient maven dependencies have conflicts", "body": "**Describe the bug**\r\nIt is not possible to use pulsar-broker as a maven dependency.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\ncreate maven pom file\r\n```\r\n       <dependency>\r\n            <groupId>org.apache.pulsar</groupId>\r\n            <artifactId>pulsar-broker</artifactId>\r\n            <version>2.3.2</version>\r\n       </dependency>\r\n```\r\n\r\nit then fails due to:\r\n```\r\nFailed to collect dependencies for kic.data:stream-pulsar:jar:0.0.1-SNAPSHOT: Could not reso\r\nlve version conflict among [org.apache.pulsar:pulsar-broker:jar:2.3.2 -> org.apache.pulsar:pulsar-zookeeper-utils:jar:2.3.2 -> org.apache.bookkeeper:stream-storage-server:jar:4.9.2 -> org.apache.bookkeeper:stream-storage-java-client:ja\r\nr:4.9.2 -> io.grpc:grpc-core:jar:1.12.0, org.apache.pulsar:pulsar-broker:jar:2.3.2 -> org.apache.pulsar:pulsar-zookeeper-utils:jar:2.3.2 -> org.apache.bookkeeper:stream-storage-server:jar:4.9.2 -> org.apache.bookkeeper:stream-storage-j\r\nava-client:jar:4.9.2 -> io.grpc:grpc-protobuf-lite:jar:1.12.0 -> io.grpc:grpc-core:jar:1.12.0, org.apache.pulsar:pulsar-broker:jar:2.3.2 -> org.apache.pulsar:pulsar-zookeeper-utils:jar:2.3.2 -> org.apache.bookkeeper:stream-storage-serv\r\ner:jar:4.9.2 -> org.apache.bookkeeper:stream-storage-java-client:jar:4.9.2 -> io.grpc:grpc-testing:jar:1.12.0 -> io.grpc:grpc-core:jar:[1.12.0,1.12.0], org.apache.pulsar:pulsar-broker:jar:2.3.2 -> org.apache.pulsar:pulsar-zookeeper-uti\r\nls:jar:2.3.2 -> io.grpc:grpc-all:jar:1.18.0 -> io.grpc:grpc-auth:jar:1.18.0 -> io.grpc:grpc-core:jar:[1.18.0,1.18.0], org.apache.pulsar:pulsar-broker:jar:2.3.2 -> org.apache.pulsar:pulsar-zookeeper-utils:jar:2.3.2 -> io.grpc:grpc-all:j\r\nar:1.18.0 -> io.grpc:grpc-core:jar:[1.18.0,1.18.0], org.apache.pulsar:pulsar-broker:jar:2.3.2 -> org.apache.pulsar:pulsar-zookeeper-utils:jar:2.3.2 -> io.grpc:grpc-all:jar:1.18.0 -> io.grpc:grpc-netty:jar:1.18.0 -> io.grpc:grpc-core:ja\r\nr:[1.18.0,1.18.0], org.apache.pulsar:pulsar-broker:jar:2.3.2 -> org.apache.pulsar:pulsar-zookeeper-utils:jar:2.3.2 -> io.grpc:grpc-all:jar:1.18.0 -> io.grpc:grpc-okhttp:jar:1.18.0 -> io.grpc:grpc-core:jar:[1.18.0,1.18.0], org.apache.pu\r\nlsar:pulsar-broker:jar:2.3.2 -> org.apache.pulsar:pulsar-zookeeper-utils:jar:2.3.2 -> io.grpc:grpc-all:jar:1.18.0 -> io.grpc:grpc-protobuf:jar:1.18.0 -> io.grpc:grpc-core:jar:1.18.0, org.apache.pulsar:pulsar-broker:jar:2.3.2 -> org.apa\r\nche.pulsar:pulsar-zookeeper-utils:jar:2.3.2 -> io.grpc:grpc-all:jar:1.18.0 -> io.grpc:grpc-protobuf-nano:jar:1.18.0 -> io.grpc:grpc-core:jar:1.18.0, org.apache.pulsar:pulsar-broker:jar:2.3.2 -> org.apache.pulsar:pulsar-zookeeper-utils:\r\njar:2.3.2 -> io.grpc:grpc-all:jar:1.18.0 -> io.grpc:grpc-stub:jar:1.18.0 -> io.grpc:grpc-core:jar:1.18.0] -> [Help 1]\r\n[ERROR]\r\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\r\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\r\n[ERROR]\r\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\r\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/DependencyResolutionException\r\n[ERROR]\r\n[ERROR] After correcting the problems, you can resume the build with the command\r\n[ERROR]   mvn <goals> -rf :stream-pulsar\r\n```\r\n\r\n**Expected behavior**\r\ndependency loaded\r\n", "url": "https://github.com/apache/pulsar/issues/4490", "user": "KIC", "labels": ["type/bug"], "created": "2019-06-06 17:25:52", "closed": "2019-06-06 18:21:25", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Specify zk chroot path failed when initialize cluster metadata", "body": "When trying to initialize cluster metadata via the following shell:\r\n```\r\nbin/pulsar initialize-cluster-metadata \\\r\n  --cluster pulsar-cluster-test\\\r\n  --zookeeper hdp1:2181/kobe \\\r\n  --configuration-store hdp1:2181/kobe \\\r\n  --web-service-url http://hdp1:8080 \\\r\n  --web-service-url-tls https://hdp1:8443 \\\r\n  --broker-service-url pulsar://hdp1:6650 \\\r\n  --broker-service-url-tls pulsar+ssl://hdp1:6651\r\n```\r\nand the config in `bookkeeper.conf` likes this:\r\n```\r\nzkServers=hdp1:2181\r\nzkLedgersRootPath=/kobe/ledgers\r\n```\r\nIt doesn't work well as below:\r\n```\r\nException in thread \"main\" java.util.concurrent.ExecutionException: KeeperErrorCode = NoNode for /kobe/ledgers\r\n\tat org.apache.bookkeeper.meta.MetadataDrivers.runFunctionWithMetadataBookieDriver(MetadataDrivers.java:378)\r\n\tat org.apache.bookkeeper.client.BookKeeperAdmin.format(BookKeeperAdmin.java:1150)\r\n\tat org.apache.pulsar.PulsarClusterMetadataSetup.main(PulsarClusterMetadataSetup.java:152)\r\nCaused by: org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /kobe/ledgers\r\n\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:114)\r\n\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\r\n\tat org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:792)\r\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient.access$1901(ZooKeeperClient.java:70)\r\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient$9.call(ZooKeeperClient.java:711)\r\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient$9.call(ZooKeeperClient.java:705)\r\n\tat org.apache.bookkeeper.zookeeper.ZooWorker.syncCallWithRetries(ZooWorker.java:140)\r\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient.create(ZooKeeperClient.java:705)\r\n\tat org.apache.bookkeeper.discover.ZKRegistrationManager.prepareFormat(ZKRegistrationManager.java:403)\r\n\tat org.apache.bookkeeper.client.BookKeeperAdmin.lambda$format$2(BookKeeperAdmin.java:1152)\r\n\tat org.apache.bookkeeper.meta.MetadataDrivers.runFunctionWithMetadataBookieDriver(MetadataDrivers.java:373)\r\n```\r\nAs a workaround, you should `create /kobe` through the zk shell at first, it is better to avoid to create the prefix path manually.", "url": "https://github.com/apache/pulsar/issues/4480", "user": "murong00", "labels": ["component/cli", "help wanted", "type/bug"], "created": "2019-06-05 10:26:31", "closed": "2019-06-14 01:28:48", "commits": {"e19e5ba2f059383c7ac2b4ffca75e251b94f5b1e": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 8.000277777777777, "commitsDetails": [{"commitHash": "e19e5ba2f059383c7ac2b4ffca75e251b94f5b1e", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["d99e95c2a65ecb43df06bd742ecf0ff5e05d3afe"], "nameRev": "e19e5ba2f059383c7ac2b4ffca75e251b94f5b1e tags/v2.4.0-candidate-1~40", "commitMessage": "[Issue 4480] Support setting zk chroot path when initialize cluster metadata (#4502)\n\nFixes #4480\r\nModifications\r\nCreate the zookeeper chroot path at first if it doesn't exist.\r\n\r\n* Support setting zk chroot path when initialize cluster metadata.\r\n\r\n* Add a unit test for initZk\r\n", "commitDateTime": "2019-06-14 09:28:47", "authoredDateTime": "2019-06-14 09:28:47", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/PulsarClusterMetadataSetup.java", "insertions": 28, "deletions": 8, "lines": 36}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/zookeeper/ZooKeeperClientAspectJTest.java", "insertions": 26, "deletions": 0, "lines": 26}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarClusterMetadataSetup.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.PulsarClusterMetadataSetup.main(java.lang.String[])", "TOT": 10, "UPD": 1, "INS": 2, "MOV": 5, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.PulsarClusterMetadataSetup.Arguments", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.PulsarClusterMetadataSetup.initZk(java.lang.String,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ZooKeeperClientAspectJTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.zookeeper.ZooKeeperClientAspectJTest.testInitZk()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[Go client]MessageID output order error", "body": "**Describe the bug**\r\n\r\nMessageID output order error\r\n\r\n\r\n**To Reproduce**\r\n\r\n`PulsarApi.proto` file definition:\r\n\r\n```\r\nmessage MessageIdData {\r\n\trequired uint64 ledgerId = 1;\r\n\trequired uint64 entryId  = 2;\r\n\toptional int32 partition = 3 [default = -1];\r\n\toptional int32 batch_index = 4 [default = -1];\r\n}\r\n```\r\n\r\ntest code (enable batch and batch size is 5, the topic no partition) :\r\n\r\n```\r\n(11,16,0,-1)\r\n(11,16,1,-1)\r\n(11,16,2,-1)\r\n(11,16,3,-1)\r\n(11,16,4,-1)\r\n(11,17,0,-1)\r\n(11,17,1,-1)\r\n(11,17,2,-1)\r\n(11,17,3,-1)\r\n(11,17,4,-1)\r\n```\r\n\r\nWe can see that the order of `batch_size` is opposite to the order of `partitions`.\r\n\r\n**Expected behavior**\r\n\r\n```\r\n(11,16,-1,0)\r\n(11,16,-1,1)\r\n(11,16,-1,2)\r\n(11,16,-1,3)\r\n(11,16,-1,4)\r\n(11,17,-1,0)\r\n(11,17,-1,1)\r\n(11,17,-1,2)\r\n(11,17,-1,3)\r\n(11,17,-1,4)\r\n```", "url": "https://github.com/apache/pulsar/issues/4476", "user": "wolfstudy", "labels": ["type/bug"], "created": "2019-06-05 05:35:14", "closed": "2019-06-05 16:24:39", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Failed to create token", "body": "**Describe the bug**\r\nWhen create a token, the pulsar attempts to decodes the url of provided key instead of its content.\r\n\r\n**To Reproduce**\r\nRun: `bin/pulsar tokens create --private-key ./my-private.key --subject test-user`\r\n\r\n**Expected behavior**\r\nOutputs token.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/4474", "user": "ypyf", "labels": ["type/bug"], "created": "2019-06-05 04:14:37", "closed": "2019-06-05 04:50:51", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "standalone failed to start for token auth in function worker client", "body": "**Describe the bug**\r\nwhen it is setting to use token authn, standalone pulsar will failed to start because of function worker authentication fail.\r\n\r\nit happens like this:\r\nstandalone will start function `WorkerService`, then `WorkerService` will create a pulsar client to create topics. But this pulsar client is not properly configured, and caused failure when it connects to server\r\n\r\n![image](https://user-images.githubusercontent.com/6348208/58889006-d2614400-871a-11e9-8b32-3c2ce5d2a53d.png)\r\n", "url": "https://github.com/apache/pulsar/issues/4469", "user": "jiazhai", "labels": ["type/bug"], "created": "2019-06-04 14:48:20", "closed": "2019-06-06 20:17:54", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Lists all Functions deployed in a given namespace using API does not work", "body": "**Describe the bug**\r\nContext: the function workers are not in the brokers.\r\nWhen invoking the service URL of a function worker to get the list of deployed functions in a given namespace, the response is 404 Not Found (while there are functions deployed). \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Run a function worker\r\n2. Deploy a function using the admin url of the function worker\r\n3. Get the list of currently deployed functions in a namespace (`pulsar-admin --admin-url http://my-host:6750 functions list --namespace my-namespace --tenant my-tenant`)\r\n4. The response is `HTTP 404 Not Found`\r\n\r\nAlso test with curl, same result. \r\nIf the worker run in a broker, the response is correct.\r\nThe other pulsar-admin commands such as `functions create` are working.\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Screenshots**\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: MacOS\r\n\r\n**Additional context**\r\n- Pulsar Version: 2.3.2\r\n- Java Version: 1.8.0_202\r\n", "url": "https://github.com/apache/pulsar/issues/4467", "user": "bbonnin", "labels": ["component/cli", "component/functions", "triage/week-24", "type/bug"], "created": "2019-06-04 13:10:12", "closed": "2020-06-10 05:02:15", "commits": {}, "ttf": 371.0002777777778, "commitsDetails": []}, {"title": "token auth not work well for non-persistent topic get", "body": "**Describe the bug**\r\nThis happens in 2.3.2\r\nuser report token auth not worked well for non-persistent topic get\r\n\r\nwhen token auth configured, get tentant and get namespace both worked well, but get non-persistent topic failed: \r\n![WechatIMG175](https://user-images.githubusercontent.com/26834121/58881190-40523f00-870c-11e9-89eb-362ec97ccb47.png)\r\n\r\n![WechatIMG172](https://user-images.githubusercontent.com/26834121/58881137-1ef15300-870c-11e9-86b1-3d4e36d482a4.png)\r\n", "url": "https://github.com/apache/pulsar/issues/4466", "user": "zhaijack", "labels": ["component/broker", "component/security", "type/bug"], "created": "2019-06-04 13:03:58", "closed": "2019-07-01 09:23:48", "commits": {}, "ttf": 26.00027777777778, "commitsDetails": []}, {"title": "[Go Client] The default value of batch is always true", "body": "**Describe the bug**\r\n\r\nIn java and cpp client, the default value of `batch` is `true`, but in go client the value is `false`.\r\n\r\nIn `c_producer.go` file:\r\n\r\n```\r\nif options.Batching {\r\n\tC.pulsar_producer_configuration_set_batching_enabled(conf, cBool(options.Batching))\r\n}\r\n```\r\n\r\nBecause the implementation of the go client depends on the cpp client, in the above code, when the user sets the value of batch to `false`, the batch of the go client is still true. So, no matter how the user sets it, the batch is always true in the go client.", "url": "https://github.com/apache/pulsar/issues/4464", "user": "wolfstudy", "labels": ["type/bug"], "created": "2019-06-04 10:28:28", "closed": "2019-06-06 05:44:21", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Build fails with boost 1.70.0", "body": "**Describe the bug**\r\nThis package fails to compile with boost 1.70.0. I noticed this in the test logs of boost 1.70.0 in homebrew-core:\r\n\r\n* https://github.com/Homebrew/homebrew-core/pull/38890\r\n* https://jenkins.brew.sh/job/Homebrew%20Core%20Pull%20Requests/43080/version=sierra/testReport/junit/brew-test-bot/sierra/install___build_bottle_libpulsar/\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Using macOS 10.12, 10.13, or 10.14 with homebrew\r\n2. `brew pull 38890`\r\n3. `brew install libpulsar`\r\n4. Build fails: https://gist.github.com/scpeters/d7c04bf3e531c994284c89135bf1147f\r\n\r\n~~~\r\nlib/ExecutorService.cc:37:17:\r\n note: in instantiation of function template specialization\r\n 'std::__1::make_shared<boost::asio::basic_stream_socket<boost::asio::ip::tcp, boost::asio::executor>, std::__1::reference_wrapper<boost::asio::io_context> >' requested here\r\n    return std::make_shared<boost::asio::ip::tcp::socket>(std::ref(io_service_));\r\n                ^\r\n~~~\r\n\r\n**Expected behavior**\r\nSuccessful compilation.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: macOS 10.12, 10.13, 10.14\r\n\r\n**Additional context**\r\nSeveral other packages have had similar build failures with boost 1.70. The most relevant one to me seems to be websocketpp, which also has a problem with using `std::make_shared`. There is an open pull request changing from `make_shared` to `new`: https://github.com/zaphoyd/websocketpp/pull/814", "url": "https://github.com/apache/pulsar/issues/4449", "user": "scpeters", "labels": ["type/bug"], "created": "2019-06-03 17:53:14", "closed": "2019-06-04 03:57:10", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Broker gets stuck when getting partitioned stats", "body": "**Describe the bug**\r\n\r\nBrokers in our cluster get stuck when executing `internalGetPartitionedStats`:\r\nhttps://github.com/apache/pulsar/blob/3cfa81250e49b24b4b195f8e2d510fcd24b93745/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java#L609-L610\r\n\r\nthread dump:\r\nhttps://gist.github.com/nkurihar/5d90ce683802390cdec2d9fb65cc0297\r\n```\r\n\"pulsar-web-28-32\" #531 prio=5 os_prio=0 tid=0x00007f31a4001000 nid=0x3b69 waiting on condition [0x00007f30db1c6000]\r\n   java.lang.Thread.State: WAITING (parking)\r\n\tat sun.misc.Unsafe.park(Native Method)\r\n\t- parking to wait for  <0x00007f512c8e2d80> (a java.util.concurrent.CompletableFuture$Signaller)\r\n\tat java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\r\n\tat java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1693)\r\n\tat java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3323)\r\n\tat java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1729)\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)\r\n\tat org.apache.pulsar.client.admin.internal.TopicsImpl.getStats(TopicsImpl.java:380)\r\n\tat org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalGetPartitionedStats(PersistentTopicsBase.java:610)\r\n\tat org.apache.pulsar.broker.admin.v1.PersistentTopics.getPartitionedStats(PersistentTopics.java:279)\r\n\tat sun.reflect.GeneratedMethodAccessor56.invoke(Unknown Source)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81)\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144)\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161)\r\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$TypeOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:205)\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99)\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389)\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347)\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102)\r\n\tat org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326)\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:271)\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:267)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:315)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:297)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:267)\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317)\r\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305)\r\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154)\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473)\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:427)\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:388)\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:341)\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:228)\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:845)\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1689)\r\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53)\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\r\n\tat org.apache.pulsar.broker.web.AuthenticationFilter.doFilter(AuthenticationFilter.java:74)\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676)\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581)\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:524)\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:319)\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:253)\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\r\n\tat org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:202)\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\r\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n**To Reproduce**\r\nWe haven't found the way to reproduce yet.\r\n\r\n**Additional context**\r\nBroker OS: CentOS Linux release 7.6.1810\r\nBroker version: 2.2.1\r\nBroker spec: Real server / 2.10GHz / 2CPU / 256GBMEM / SATA SSD 240GB x1 / 10G Base-T*2port", "url": "https://github.com/apache/pulsar/issues/4447", "user": "nkurihar", "labels": ["component/broker", "type/bug"], "created": "2019-06-03 14:58:33", "closed": "2019-06-13 09:17:51", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "[cgo client] Shared subscribe type error", "body": "**Describe the bug**\r\n\r\ngo test:\r\n\r\n```\r\nfunc TestConsumerShared(t *testing.T) {\r\n\tclient, err := NewClient(ClientOptions{\r\n\t\tURL: \"pulsar://localhost:6650\",\r\n\t})\r\n\tassert.Nil(t, err)\r\n\tdefer client.Close()\r\n\r\n\ttopic := \"persistent://public/default/multi-topic-1\"\r\n\r\n\tconsumer1, err := client.Subscribe(ConsumerOptions{\r\n\t\tTopic:            topic,\r\n\t\tSubscriptionName: \"key-sub3\",\r\n\t\tType:             Shared,\r\n\t})\r\n\tassert.Nil(t, err)\r\n\tdefer consumer1.Close()\r\n\r\n\tconsumer2, err := client.Subscribe(ConsumerOptions{\r\n\t\tTopic:            topic,\r\n\t\tSubscriptionName: \"key-sub3\",\r\n\t\tType:             Shared,\r\n\t})\r\n\tassert.Nil(t, err)\r\n\tdefer consumer2.Close()\r\n\r\n\t// create producer\r\n\tproducer, err := client.CreateProducerWithSchema(ProducerOptions{\r\n\t\tTopic:    topic,\r\n\t\tBatching: false,\r\n\t}, NewBytesSchema(nil))\r\n\tassert.Nil(t, err)\r\n\tdefer producer.Close()\r\n\r\n\tctx := context.Background()\r\n\tfor i := 0; i < 20; i++ {\r\n\t\tproducer.SendAsync(ctx, ProducerMessage{\r\n\t\t\tKey:   fmt.Sprintf(\"key-%d\", i%3),\r\n\t\t\tValue: []byte(fmt.Sprintf(\"value-%d\", i)),\r\n\t\t}, func(producerMessage ProducerMessage, e error) {\r\n\t\t\tfmt.Printf(\"send complete. err = %v \\n\", e)\r\n\t\t})\r\n\t}\r\n\r\n\tfor i := 0; i < 10; i++ {\r\n\t\tmsg, err := consumer1.Receive(ctx)\r\n\t\tfmt.Printf(\"consumer1 key is: %s, value is: %s\\n\", msg.Key(), string(msg.Payload()))\r\n\t\tassert.Nil(t, err)\r\n\t\terr = consumer1.Ack(msg)\r\n\t\tassert.Nil(t, err)\r\n\t}\r\n\r\n\tfor i := 0; i < 10; i++ {\r\n\t\tmsg2, err := consumer2.Receive(ctx)\r\n\t\tassert.Nil(t, err)\r\n\t\tfmt.Printf(\"consumer2 key is:%s, value is: %s\\n\", msg2.Key(), string(msg2.Payload()))\r\n\t\terr = consumer2.Ack(msg2)\r\n\t\tassert.Nil(t, err)\r\n\t}\r\n}\r\n```\r\n\r\n**To Reproduce**\r\n\r\ncopy the code above, and run it.\r\n\r\n**Expected behavior**\r\n\r\nIn go test code, `consumer1` and `consumer2` each receive 10 messages. In fact, only `consumer1` receives 10 messages, and then remains blocked, and `consumer2` does not receive any messages.\r\n\r\nIn cpp test code, `consumer` and `consumer1` each receive 1 messages. In fact, only `consumer` receives 1 message, and then `consumer1` receives timeout.\r\n\r\nIn my test scenario, cpp and go behave in the same way, so I guess this may be a bug in cpp. For the same topic, start multiple consumers to share with the shared subscription type, only one consumer can receive To data.\r\n\r\n```\r\n$ ./bin/pulsar-admin topics stats [topic-name]\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/20965307/58794973-17f31380-862c-11e9-9925-c9a23eade7c3.png)\r\n\r\nUsing the `stats` command, you can see that all messages are sent to the same consumer under the shared subscription type.\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Mac ios\r\n - go version: 1.11.4\r\n - pulsar version: latest\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/4444", "user": "wolfstudy", "labels": ["type/bug"], "created": "2019-06-03 10:21:19", "closed": "2019-06-03 12:42:28", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Like PulsarClient.buiilder, ClientConfigurationData.java should enable tls if  pulsar+ssl ", "body": "**Describe the bug**\r\nThere are two ways of instantiating a java client and both should behave in similar ways. As of now, PulsarClient.builder assumes tls enabled if the pulsar+ssl or https is used in the service url. In fact, the builder marks enableTls() as deprecated.\r\n\r\nClientConfigurationData.java lags a bit that way. It does not enable tls if pulsar+ssl or https is used in service url.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Initialise PULSAR_BROKER_URL as pulsar+ssl:// *\r\n2. Instantiate the pulsar client with client config POJO.\r\n\r\n>             ClientConfigurationData clientConfig = new ClientConfigurationData();\r\n>             clientConfig.setServiceUrl(PULSAR_BROKER_URL);\r\n>             clientConfig.setTlsTrustCertsFilePath(PULSAR_CA_CERT_PATH);\r\n> \r\n>             client = new PulsarClientImpl(clientConfig);\r\n\r\n**Expected behavior**\r\nClient should use tls if service url is pulsar+ssl://* or https://*\r\n", "url": "https://github.com/apache/pulsar/issues/4441", "user": "shiv4289", "labels": ["type/bug"], "created": "2019-06-03 05:50:01", "closed": "2020-04-24 11:52:20", "commits": {}, "ttf": 326.0002777777778, "commitsDetails": []}, {"title": "Bookie can't start in the background by pulsar-daemon when passing extra opts", "body": "When trying to pass extra settings via `bkenv.sh` (e.g. set `BOOKIE_EXTRA_OPTS` when enable kerberos) and starting in the background via `bin/pulsar-daemon start bookie`, it failed to get the corresponding settings since `bin/pulsar-daemon` i.e. `bin/pulsar` use `pulsar_env.sh` by default. \r\n\r\nOne way is to start the bookie in the foreground via `bin/bookkeeper bookie`, or as a workaround, you can just source the `bkenv.sh` and pass the `BOOKIE_EXTRA_OPTS` to `OPTS` in the shell `bin/pulsar` when command is `bookie`.\r\n\r\nIt would be better to support `pulsar-daemon` which seems more popular to start bookie in the background when passing extra opt.", "url": "https://github.com/apache/pulsar/issues/4422", "user": "murong00", "labels": ["type/bug", "type/enhancement"], "created": "2019-05-31 02:27:04", "closed": "2019-06-19 03:11:29", "commits": {}, "ttf": 19.00027777777778, "commitsDetails": []}, {"title": "Consumer subscribe memory leak when server not reachable", "body": "**Describe the bug**\r\nIf you continually create new Consumers that fail to subscribe due to an unresponsive host, a memory leak in some resource inside ClientCnx happens. I'd assume something similar can happen for other clients. Let me know if I should upload a heap dump somewhere. Possibly related to https://github.com/apache/pulsar/pull/3422 \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nRun a loop like\r\n```\r\n    @Test\r\n    fun consumerStartupFailMemoryLeak() {\r\n        val client = PulsarClient.builder()\r\n            .serviceUrl(\"pulsar://localhost:9999\")\r\n            .build()\r\n\r\n        var i = 0\r\n        while (true) {\r\n            try {\r\n                client.newConsumer()\r\n                    .topic(\"topic\")\r\n                    .subscriptionName(\"subscription\")\r\n                    .subscribe()\r\n            } catch (ignored: Exception) {}\r\n\r\n            if (i % 1000 == 0) {\r\n                val r = Runtime.getRuntime()\r\n                val heapused = r.totalMemory() - r.freeMemory()\r\n                LOG.info(\"Heap used: ${heapused/1024/1024}MB\")\r\n            }\r\n            i++\r\n        }\r\n    }\r\n```\r\nWithin minutes the heap used will balloon\r\n```\r\n15:26:32.609 [main] INFO   Heap used: 107MB\r\n15:26:40.164 [main] INFO   Heap used: 194MB\r\n15:26:48.272 [main] INFO   Heap used: 378MB\r\n15:26:56.301 [main] INFO   Heap used: 573MB\r\n15:27:04.759 [main] INFO   Heap used: 726MB\r\n15:27:12.703 [main] INFO   Heap used: 917MB\r\n15:27:20.848 [main] INFO   Heap used: 1065MB\r\n```\r\n\r\n**Expected behavior**\r\nConsumer subscribe should be able to retry basically forever without hitting memory problems.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4413", "user": "sleungtoast", "labels": ["type/bug"], "created": "2019-05-30 19:48:47", "closed": "2019-05-31 01:39:17", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[pulsar-broker][pulsar-common][pulsar-client]Incorrect log parameters", "body": "\r\n1. File: /pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/NonPersistentTopics.java\r\n```java\r\n//line165\r\nlog.info(\"[{}] list of topics on namespace {}/{}/{}/{}\", clientAppId(), property, cluster, namespace);\r\n```\r\n2. File:pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java\r\n```java\r\n//line1315\r\nlog.warn(\"[{]] Error GetTopicsOfNamespace for namespace [//{}] by {}\",\r\n                remoteAddress, namespace, requestId);\r\n```\r\n3. File:pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java\r\n```java\r\n//line178\r\n//One 'should' word should be deleted\r\ncheckState(topics != null && topics.size() >= 1,\r\n            \"topics should should contain more than 1 topic\");\r\n\r\n//line199\r\nlog.warn(\"[{}] Received invalid topic name.  {}/{}\", result.get());\r\n```\r\n\r\n4. File: pulsar-common/src/main/java/org/apache/pulsar/common/naming/NamespaceName.java\r\n\r\n```java\r\n//line178\r\nthrow new IllegalArgumentException(\r\n                    String.format(\"Invalid namespace format. namespace: %s/%s/%s\", tenant, namespace), e);\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/4408", "user": "hapihu", "labels": ["type/bug"], "created": "2019-05-30 14:42:56", "closed": "2019-06-10 01:53:47", "commits": {"af88a360df72b5fde221fe183ecbc9e13a4c578d": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 10.000277777777777, "commitsDetails": [{"commitHash": "af88a360df72b5fde221fe183ecbc9e13a4c578d", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["ef3514c65c7509a32561297ae6e9f17551c1ee52"], "nameRev": "af88a360df72b5fde221fe183ecbc9e13a4c578d tags/v2.4.0-candidate-1~57", "commitMessage": "Fix issue for incorrect log parameters (#4409)\n\nFix issue for incorrect log parameters\r\n* When calling Logger's method, set the appropriate parameters\r\n* Fix #4408.", "commitDateTime": "2019-06-09 18:53:46", "authoredDateTime": "2019-06-10 09:53:46", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/NonPersistentTopics.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/naming/NamespaceName.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NonPersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v1.NonPersistentTopics.getList(java.lang.String,java.lang.String,java.lang.String)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleGetTopicsOfNamespace(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.topicNamesValid(java.util.Collection)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NamespaceName.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceName.validateNamespaceName(java.lang.String,java.lang.String)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Broker start error", "body": "When I started the broker,  some error happened. What should I do about this problem\uff1f\r\nERROR org.apache.pulsar.broker.PulsarService - keyCertChain required for servers\r\njava.lang.NullPointerException: keyCertChain required for servers\r\n        at io.netty.util.internal.ObjectUtil.checkNotNull(ObjectUtil.java:33) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.handler.ssl.SslContextBuilder.keyManager(SslContextBuilder.java:312) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.handler.ssl.SslContextBuilder.keyManager(SslContextBuilder.java:247) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at io.netty.handler.ssl.SslContextBuilder.forServer(SslContextBuilder.java:76) ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at org.apache.pulsar.common.util.SecurityUtility.createNettySslContextForServer(SecurityUtility.java:109) ~[org.apache.pulsar-pulsar-common-2.3.1.jar:2.3.1]\r\n        at org.apache.pulsar.broker.service.PulsarChannelInitializer.<init>", "url": "https://github.com/apache/pulsar/issues/4394", "user": "guozili520", "labels": ["component/broker", "component/security", "type/bug"], "created": "2019-05-28 09:36:03", "closed": "2020-06-08 01:49:34", "commits": {}, "ttf": 376.0002777777778, "commitsDetails": []}, {"title": "pulsar consumption ack strange behavior", "body": "**Describe the bug**\r\nI create Exclusive consumer on persistent topic. I consume all the messages using pulsar4s (the scala library), which sends an ack directly after received the message with its ConsumerMessage class.\r\n\r\nAnyway, it uses the java pulsar client, and it produce this log: ```10:43:45.806 [pulsar-timer-4-1] INFO  o.a.p.c.i.ConsumerStatsRecorderImpl - [persistent://clevercloud/logs/communications-paths] [towarp10] [18114] Prefetched messages: 0 --- Consume throughput received: 53.68 msgs/s --- 0.10 Mbit/s --- Ack sent rate: 68.68 ack/s --- Failed messages: 0 --- Failed acks: 0```.\r\n\r\nSo all messages of the topic are consumed, because my consumer is waiting for new input at this moment. So all seems good.\r\n\r\nBut, if I rerun my program (my consumer), all these messages are here again. I don't understand why.\r\n\r\nHere are a part of the debug logs:\r\n\r\n```\r\n...\r\n10:53:08.265 [warp10-akka.actor.default-dispatcher-6] DEBUG o.a.pulsar.client.impl.ConsumerImpl - [towarp10] [1e334] acknowledging message - 642:4099:-1:0, acktype Individual\r\n10:53:08.265 [warp10-akka.actor.default-dispatcher-7] DEBUG c.s.p.a.s.PulsarSourceGraphStage - Pull received; asking consumer for message\r\n10:53:08.267 [pulsar-client-io-1-1] DEBUG o.a.p.c.i.PersistentAcknowledgmentsGroupingTracker - [ConsumerBase{subscription='towarp10', consumerName='1e334', topic='persistent://clevercloud/logs/communications-paths'}] Flushing pending acks to broker: last-cumulative-ack: -1:-1:-1 -- individual-acks: [642:4002:-1:0, 642:4003:-1:0, 642:4004:-1:0, 642:4005:-1:0, 642:4006:-1:0, 642:4007:-1:0, 642:4008:-1:0, 642:4009:-1:0, 642:4010:-1:0, 642:4011:-1:0, 642:4012:-1:0, 642:4013:-1:0, 642:4014:-1:0, 642:4015:-1:0, 642:4016:-1:0, 642:4017:-1:0, 642:4018:-1:0, 642:4019:-1:0, 642:4020:-1:0, 642:4021:-1:0, 642:4022:-1:0, 642:4023:-1:0, 642:4024:-1:0, 642:4025:-1:0, 642:4026:-1:0, 642:4027:-1:0, 642:4028:-1:0, 642:4029:-1:0, 642:4030:-1:0, 642:4031:-1:0, 642:4032:-1:0, 642:4033:-1:0, 642:4034:-1:0, 642:4035:-1:0, 642:4036:-1:0, 642:4037:-1:0, 642:4038:-1:0, 642:4039:-1:0, 642:4040:-1:0, 642:4041:-1:0, 642:4042:-1:0, 642:4043:-1:0, 642:4044:-1:0, 642:4045:-1:0, 642:4046:-1:0, 642:4047:-1:0, 642:4048:-1:0, 642:4049:-1:0, 642:4050:-1:0, 642:4051:-1:0, 642:4052:-1:0, 642:4053:-1:0, 642:4054:-1:0, 642:4055:-1:0, 642:4056:-1:0, 642:4057:-1:0, 642:4058:-1:0, 642:4059:-1:0, 642:4060:-1:0, 642:4061:-1:0, 642:4062:-1:0, 642:4063:-1:0, 642:4064:-1:0, 642:4065:-1:0, 642:4066:-1:0, 642:4067:-1:0, 642:4068:-1:0, 642:4069:-1:0, 642:4070:-1:0, 642:4071:-1:0, 642:4072:-1:0, 642:4073:-1:0, 642:4074:-1:0, 642:4075:-1:0, 642:4076:-1:0, 642:4077:-1:0, 642:4078:-1:0, 642:4079:-1:0, 642:4080:-1:0, 642:4081:-1:0, 642:4082:-1:0, 642:4083:-1:0, 642:4084:-1:0, 642:4085:-1:0, 642:4086:-1:0, 642:4087:-1:0, 642:4088:-1:0, 642:4089:-1:0, 642:4090:-1:0, 642:4091:-1:0, 642:4092:-1:0, 642:4093:-1:0, 642:4094:-1:0, 642:4095:-1:0, 642:4096:-1:0, 642:4097:-1:0, 642:4098:-1:0, 642:4099:-1:0]\r\n10:53:08.281 [warp10-akka.actor.default-dispatcher-6] DEBUG c.s.p.a.s.PulsarSourceGraphStage - Msg received DefaultConsumerMessage(Some(),{\"s\":{\"ip\":\"43.34.34.34\",\"lt\":3.453252,\"lg\":2.2134331,\"ct\":\"Rouen\",\"co\":\"France\"},\"d\":{\"ip\":\"143.134.134.134\",\"lt\":13.453252,\"lg\":12.2134331,\"ct\":\"Paris\",\"co\":\"France\"},\"vb\":\"GET\",\"path\":\"/\",\"scheme\":\"http\",\"a\":\"app_123456342141\",\"o\":\"orga_33\"}\r\n,[B@25d58f05,Map(),Pulsar4sMessageIdImpl(642:4100:-1:0),SequenceId(979),ProducerName(c1-42-140),PublishTime(1558619780340),EventTime(0),Topic(persistent://clevercloud/logs/communications-paths))\r\n10:53:08.282 [warp10-akka.actor.default-dispatcher-6] DEBUG o.a.pulsar.client.impl.ConsumerImpl - [towarp10] [1e334] can ack message to broker 642:4100:-1:0, acktype Individual, cardinality 0, length 1\r\n10:53:08.282 [warp10-akka.actor.default-dispatcher-6] DEBUG o.a.pulsar.client.impl.ConsumerImpl - [towarp10] [1e334] acknowledging message - 642:4100:-1:0, acktype Individual\r\n10:53:08.282 [warp10-akka.actor.default-dispatcher-7] DEBUG c.s.p.a.s.PulsarSourceGraphStage - Pull received; asking consumer for message\r\n10:53:08.282 [warp10-akka.actor.default-dispatcher-7] DEBUG c.s.p.a.s.PulsarSourceGraphStage - Msg received DefaultConsumerMessage(Some(),{\"s\":{\"ip\":\"43.34.34.34\",\"lt\":3.453252,\"lg\":2.2134331,\"ct\":\"Rouen\",\"co\":\"France\"},\"d\":{\"ip\":\"143.134.134.134\",\"lt\":13.453252,\"lg\":12.2134331,\"ct\":\"Paris\",\"co\":\"France\"},\"vb\":\"GET\",\"path\":\"/\",\"scheme\":\"http\",\"a\":\"app_123456342141\",\"o\":\"orga_33\"}\r\n,[B@3a2729c,Map(),Pulsar4sMessageIdImpl(642:4101:-1:0),SequenceId(980),ProducerName(c1-42-140),PublishTime(1558619780346),EventTime(0),Topic(persistent://clevercloud/logs/communications-paths))\r\n10:53:08.282 [warp10-akka.actor.default-dispatcher-7] DEBUG o.a.pulsar.client.impl.ConsumerImpl - [towarp10] [1e334] can ack message to broker 642:4101:-1:0, acktype Individual, cardinality 0, length 1\r\n...\r\n```\r\n\r\nIf you need more informations, do not hesitate to ask me.", "url": "https://github.com/apache/pulsar/issues/4391", "user": "KannarFr", "labels": ["component/broker", "component/client", "type/bug"], "created": "2019-05-28 08:55:47", "closed": "2019-10-02 12:16:29", "commits": {}, "ttf": 127.00027777777778, "commitsDetails": []}, {"title": "Could NOT find PythonLibs (missing: PYTHON_LIBRARIES PYTHON_INCLUDE_DIRS)", "body": "**Describe the bug**\r\nWhen I ran the order, pulsar-client-cpp/pkg/rpm/docker-build-rpm.sh , to build master, I got these:\r\n```\r\nCMake Error at /usr/local/share/cmake-3.8/Modules/FindPackageHandleStandardArgs.cmake:137 (message):\r\n  Could NOT find PythonLibs (missing: PYTHON_LIBRARIES PYTHON_INCLUDE_DIRS)\r\nCall Stack (most recent call first):\r\n  /usr/local/share/cmake-3.8/Modules/FindPackageHandleStandardArgs.cmake:377 (_FPHSA_FAILURE_MESSAGE)\r\n  /usr/local/share/cmake-3.8/Modules/FindPythonLibs.cmake:262 (FIND_PACKAGE_HANDLE_STANDARD_ARGS)\r\n  CMakeLists.txt:126 (find_package)\r\n\r\n-- Configuring incomplete, errors occurred!\r\nSee also \"/pulsar/pulsar-client-cpp/pkg/rpm/BUILD/apache-pulsar-2.4.0-SNAPSHOT/pulsar-client-cpp/CMakeFiles/CMakeOutput.log\".\r\nSee also \"/pulsar/pulsar-client-cpp/pkg/rpm/BUILD/apache-pulsar-2.4.0-SNAPSHOT/pulsar-client-cpp/CMakeFiles/CMakeError.log\".\r\nerror: Bad exit status from /var/tmp/rpm-tmp.lAcmL2 (%build)\r\n```\r\n\r\n\r\n**To Reproduce**\r\nreference: https://pulsar.apache.org/docs/en/client-libraries-cpp/\r\n\r\n**Expected behavior**\r\nbulid success\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: centos7\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4389", "user": "lsy180829", "labels": ["type/bug"], "created": "2019-05-28 02:54:20", "closed": "2019-05-29 15:50:09", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "ClientConfigurationData Authentication not set in PulsarClientImpl", "body": "**Describe the bug**\r\n1. Setting Auth class and auth param does not build authentication instance in ClientConfigurationData.java\r\n2. The lombok builders don't set default values set to attributes in class ClientConfigurationData.java. So PulsarClientImpl(conf) crashes.\r\n", "url": "https://github.com/apache/pulsar/issues/4379", "user": "shiv4289", "labels": ["type/bug"], "created": "2019-05-26 17:32:44", "closed": "2019-06-06 15:47:01", "commits": {}, "ttf": 10.000277777777777, "commitsDetails": []}, {"title": "Authentication provider getAuthData called before initialization", "body": "**Describe the bug**\r\nWhen I wrote a custom authentication provider, I expected `.getAuthData()` to not be called before `.start()` was called. When I turned on TLS, it hit a codepath where that happened.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Add an Authentication provider that throws an exception if `start()` has not been called.\r\n2. Use a TLS broker url\r\n3. Create a consumer\r\n4. On consumer `build()`, the Authentication provider will throw the exception.\r\n\r\n**Expected behavior**\r\nDo not call `Authentication.getAuthData()` before `Authentication.start()` so the consumer starts up successfully.\r\n\r\n**Additional context**\r\nIn a `PulsarClientImpl` constructor, a new `ConnectionPool` is created, then a new `PulsarChannelInitializer` is created, which has the following code that doesn't use my auth data anyway.\r\n```\r\nif (conf.isUseTls()) {\r\n    // Set client certificate if available\r\n    AuthenticationDataProvider authData = conf.getAuthentication().getAuthData();\r\n    if (authData.hasDataForTls()) {\r\n        this.sslCtx = SecurityUtility.createNettySslContextForClient(conf.isTlsAllowInsecureConnection(),\r\n                conf.getTlsTrustCertsFilePath(), (X509Certificate[]) authData.getTlsCertificates(),\r\n                authData.getTlsPrivateKey());\r\n    } else {\r\n        this.sslCtx = SecurityUtility.createNettySslContextForClient(conf.isTlsAllowInsecureConnection(),\r\n                conf.getTlsTrustCertsFilePath());\r\n    }\r\n} else {\r\n    this.sslCtx = null;\r\n}\r\n```", "url": "https://github.com/apache/pulsar/issues/4365", "user": "sleungtoast", "labels": ["type/bug"], "created": "2019-05-24 21:06:36", "closed": "2019-05-29 23:20:50", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "Go client: multi-topic unsubscribe hangs when regex does not match any topics", "body": "**Describe the bug**\r\nWhen performing multi-topic unsubscribe on a topic regex that does not not match any topics, then Unsubscribe call will block indefinitely.\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. launch container ```apachepulsar/pulsar``` and listen on port 6650 on host\r\n\r\n2. use ```github.com/apache/pulsar/pulsar-client-go v0.0.0-20190517092409-1f4a836a46483db408e0bf39903215974262d946``` in go.mod which pulls 2.3.1 + build fix from #4212 for example:\r\n\r\n```\r\nmodule pulsartest\r\n\r\nrequire github.com/apache/pulsar/pulsar-client-go v0.0.0-20190517092409-1f4a836a46483db408e0bf39903215974262d946\r\n```\r\n\r\n3.  create test code to subscribe to erroneous multi-topic pattern \r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"github.com/apache/pulsar/pulsar-client-go/pulsar\"\r\n\t\"log\"\r\n\t\"runtime\"\r\n)\r\n\r\nfunc main() {\r\n\tclient, err := pulsar.NewClient(pulsar.ClientOptions{\r\n\t\tURL: \"pulsar://localhost:6650\",\r\n\t\tOperationTimeoutSeconds: 5,\r\n\t\tMessageListenerThreads: runtime.NumCPU(),\r\n\t})\r\n\tif err != nil {\r\n\t\tlog.Fatalf(\"Could not instantiate Pulsar client: %v\", err)\r\n\t}\r\n\tmsgChannel := make(chan pulsar.ConsumerMessage)\r\n\tconsumerOpts := pulsar.ConsumerOptions{\r\n\t\tTopicsPattern:            \"persistent://public/default/1-.*-fakefakefake\",\r\n\t\tSubscriptionName: \"my-subscription-1\",\r\n\t\tType:             pulsar.Exclusive,\r\n\t\tMessageChannel:   msgChannel,\r\n\t}\r\n\tconsumer, err := client.Subscribe(consumerOpts)\r\n\tif err != nil {\r\n\t\tlog.Fatalf(\"Could not establish subscription: %v\", err)\r\n\t}\r\n\terr = consumer.Unsubscribe()\r\n\tif err != nil {\r\n\t\tlog.Fatalf(\"Could not establish subscription: %v\", err)\r\n\t}\r\n}\r\n```\r\n3. ```go build && ./pulsartest``` to reproduce\r\n\r\n**Expected behavior**\r\npulsartest will return\r\n\r\n**Actual behavior**\r\npulsartest hangs indefinitely ", "url": "https://github.com/apache/pulsar/issues/4361", "user": "BJTiso", "labels": ["type/bug"], "created": "2019-05-24 17:04:30", "closed": "2019-05-29 01:29:46", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "Proxy doesn't start on machines with <= 2 CPUs with default proxy.conf", "body": "**Describe the bug**\r\nThe proxy fails to start with 'Uncaught exception in thread main: Failed to start HTTP server on ports [8082]' with default proxy.conf (httpNumThreads=) on machines with <= 2 CPUs.\r\n\r\n**To Reproduce**\r\nSet 'httpNumThreads=' (default) and start the proxy on a machine with <= 2 CPUs.\r\n\r\n**Expected behavior**\r\nThe proxy should start with the default httpNumThreads setting in proxy.conf.\r\n\r\n**Additional context**\r\nWork around is simple: Set httpNumThreads=8. But this will catch people out testing Pulsar on small cloud servers.\r\n", "url": "https://github.com/apache/pulsar/issues/4359", "user": "davidtinker", "labels": ["type/bug"], "created": "2019-05-24 09:38:11", "closed": "2019-05-28 18:32:17", "commits": {"e5873ef26259c1d4e0e0b61ae4a6548b503f9718": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "e5873ef26259c1d4e0e0b61ae4a6548b503f9718", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["8ab6b1bf34e0e5653e68a53e47c2942a47675c24"], "nameRev": "e5873ef26259c1d4e0e0b61ae4a6548b503f9718 tags/v2.4.0-candidate-1~140", "commitMessage": "Use at least 8 threads in Jetty thread pool in pulsar proxy (#4375)\n\nfixes #4359\r\n\r\nsame as #3776\r\n\r\nUse at least 8 threads to avoid having Jetty go into threads starving and\r\nhaving the possibility of getting into a deadlock where a Jetty thread is\r\nwaiting for another HTTP call to complete in same thread.", "commitDateTime": "2019-05-28 11:32:16", "authoredDateTime": "2019-05-29 02:32:16", "commitGitStats": [{"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyConfiguration.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ProxyConfiguration.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyConfiguration", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "tenants list not match between brokers", "body": "**Describe the bug**\r\nuser report data not match when run `pulsar-admin tenants list` on different brokers. And after reboot broker, it get syned.\r\n\r\n**Expected behavior**\r\nget same result when run `pulsar-admin tenants list` on different brokers.\r\n\r\n**Screenshots**\r\n![941558667436_ pic_hd](https://user-images.githubusercontent.com/6348208/58301223-2a916f80-7e18-11e9-8b16-387933b2aea3.jpg)\r\n", "url": "https://github.com/apache/pulsar/issues/4357", "user": "jiazhai", "labels": ["type/bug"], "created": "2019-05-24 03:39:54", "closed": "2019-05-26 09:21:30", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Not enough arguments for Logger's method", "body": "There is not enough parameters when calling the Logger interface.\r\n\r\n1. File: pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/ClustersBase.java\r\n```java\r\n//line373 \r\nlog.info(\"[{}] Cannot find NamespaceIsolationPolicy {} for cluster {}\", policyName, cluster);\r\n```\r\n2. File:pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java\r\n```java\r\n//line577\r\nlog.info(\"[{}] Successfully unloaded all the bundles in namespace {}/{}/{}\", clientAppId(), namespaceName);\r\n\r\n//line1220\r\nlog.warn(\"[{}] Failed to update subscription auth mode for namespace {}/{}/{}: concurrent modification\",\r\n                    clientAppId(), namespaceName);\r\n\r\n//line1226\r\nlog.error(\"[{}] Failed to update subscription auth mode for namespace {}/{}/{}\", clientAppId(),\r\n                    namespaceName, e);\r\n```\r\n3. File:pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/LoadManager.java\r\n```java\r\n//line146\r\nlog.warn(\"Error when trying to create load manager: {}\");\r\n```", "url": "https://github.com/apache/pulsar/issues/4350", "user": "hapihu", "labels": ["type/bug"], "created": "2019-05-23 09:29:30", "closed": "2019-05-25 00:41:59", "commits": {"27eb5cac48a52c69966a68e8391ba3d4b9e3f98f": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "27eb5cac48a52c69966a68e8391ba3d4b9e3f98f", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["71f3928722fc702f2f8699c68dd7262d53d0a630"], "nameRev": "27eb5cac48a52c69966a68e8391ba3d4b9e3f98f tags/v2.4.0-candidate-1~154", "commitMessage": "[pulsar-broker] When calling Logger's method, set the appropriate parameters.(#4350) (#4351)\n\n", "commitDateTime": "2019-05-24 14:27:48", "authoredDateTime": "2019-05-25 05:27:48", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/ClustersBase.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/LoadManager.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ClustersBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.ClustersBase.getNamespaceIsolationPolicy(java.lang.String,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NamespacesBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.NamespacesBase.internalUnloadNamespace()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.NamespacesBase.internalSetSubscriptionAuthMode(org.apache.pulsar.common.policies.data.SubscriptionAuthMode)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "LoadManager.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.loadbalance.create(org.apache.pulsar.broker.PulsarService)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[ClientAPI]ReaderBuilder.loadConf() not working", "body": "**Describe the bug**\r\nCannot create new reader while using loadConf method in reader builder chain.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create PulsarClient\r\n2. `client.newReader().topic(tp).startMessageId(start).loadConf(readerConf).create()`\r\n\r\n**Expected behavior**\r\nCreate a reader with both settings specified using methods as well as `loadConf`.\r\n\r\n**Screenshots**\r\n```\r\njava.lang.RuntimeException: Failed to load config into existing configuration data\r\n.....\r\nCaused by: org.apache.pulsar.shade.com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Cannot construct instance of `org.apache.pulsar.client.api.MessageId` (no Creators, like default construct, exist): abstract types either need to be mapped to concrete types, have custom deserializer, or contain additional type information\r\n at [Source: (String)\"{\"cryptoFailureAction\":\"FAIL\",\"topicName\":\"topic-0\",\"readCompacted\":false,\"startMessageId\":{\"ledgerId\":-1,\"entryId\":-1,\"partitionIndex\":-1},\"receiverQueueSize\":1000}\"; line: 1, column: 92] (through reference chain: org.apache.pulsar.client.impl.conf.ReaderConfigurationData[\"startMessageId\"])\r\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.exc.InvalidDefinitionException.from(InvalidDefinitionException.java:67) ~[pulsar-client-all-2.4.0-c509f86ba.jar:2.4.0-c509f86ba]\r\n```\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: MacOS\r\n\r\n**Additional context**\r\nThis may caused by `ReaderConfigurationData` contains a `startMessageId` of `MessageId` field that cannot be constructed. \r\nAs `abstract types either need to be mapped to concrete types, have custom deserializer, or contain additional type information` implies.\r\n", "url": "https://github.com/apache/pulsar/issues/4347", "user": "yjshen", "labels": ["type/bug"], "created": "2019-05-23 06:50:25", "closed": "2019-06-13 02:26:13", "commits": {}, "ttf": 20.00027777777778, "commitsDetails": []}, {"title": "Ledger directory is 100% used", "body": "**Describe the bug**\r\nA single ledger directory is 100% used, but other directories are used very low\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/12592133/58229119-674f5f00-7d63-11e9-8710-f97142fd7748.png)\r\n\r\n**Heap dump**\r\nhttps://drive.google.com/open?id=11J9OQjCj-pYgJxu0MLzEWg8ge63H71Te\r\n\r\n**Pulsar version**\r\n2.2.0", "url": "https://github.com/apache/pulsar/issues/4346", "user": "codelipenghui", "labels": ["component/storage", "type/bug"], "created": "2019-05-23 03:41:33", "closed": "2020-06-08 01:58:40", "commits": {}, "ttf": 381.0002777777778, "commitsDetails": []}, {"title": "[go client] max message size error", "body": "**Describe the bug**\r\n\r\nEncountered a very magical problem, when I use java-client to send data, the maximum size of the message is `MaxMessageSize=5 * 1024 * 1024 - 10 * 1024` can be sent normally, as follows:\r\n\r\n```\r\nimport java.util.concurrent.TimeUnit;\r\n\r\nimport org.apache.pulsar.client.api.Consumer;\r\nimport org.apache.pulsar.client.api.Message;\r\nimport org.apache.pulsar.client.api.Producer;\r\nimport org.apache.pulsar.client.api.PulsarClient;\r\nimport org.apache.pulsar.client.api.PulsarClientException;\r\nimport org.apache.pulsar.client.api.SubscriptionInitialPosition;\r\n\r\npublic class MsgSizeTests {\r\n    public static void main(String[] args) throws PulsarClientException, InterruptedException {\r\n        PulsarClient client = PulsarClient.builder().serviceUrl(\"pulsar://localhost:6650\").build();\r\n        Producer producer = client.newProducer().topic(\"test1\").enableBatching(false).create();\r\n\r\n        Consumer consumer =\r\n                client.newConsumer().topic(\"test1\").subscriptionName(\"test-sub\").subscriptionInitialPosition(\r\n                        SubscriptionInitialPosition.Latest).subscribe();\r\n\r\n        byte[] msg = new byte[5 * 1024 * 1024 - 10 * 1024];\r\n        System.out.println(new String(msg));\r\n        try {\r\n            System.out.println(\"sending over....\");\r\n            producer.send(msg);\r\n        } catch (PulsarClientException e) {\r\n            e.printStackTrace();\r\n        }\r\n        System.out.println(\"sending....\");\r\n        TimeUnit.SECONDS.sleep(1);\r\n        Message message = null;\r\n        try {\r\n            message = consumer.receive();\r\n        } catch (PulsarClientException e) {\r\n            e.printStackTrace();\r\n        }\r\n        System.out.println(\"receive....\");\r\n        TimeUnit.SECONDS.sleep(1);\r\n        System.out.println(new String((byte[]) message.getValue()));\r\n        if (message.getValue().equals(msg)) {\r\n            System.out.println(new String((byte[]) message.getValue()));\r\n            System.out.println(\"error\");\r\n        }\r\n\r\n        producer.close();\r\n        consumer.unsubscribe();\r\n        consumer.close();\r\n        client.close();\r\n    }\r\n}\r\n```\r\n\r\nWhen I send it using `pulsar-client-go`,  will tell me `MessageTooBig`, code as follows:\r\n\r\n```\r\nfunc main() {\r\n\tclient, err := pulsar.NewClient(pulsar.ClientOptions{\r\n\t\tURL:       \"pulsar://localhost:6650\",\r\n\t\tIOThreads: 5,\r\n\t})\r\n\r\n\tif err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n\r\n\tdefer client.Close()\r\n\r\n\tproducer, err := client.CreateProducer(pulsar.ProducerOptions{\r\n\t\tTopic:           \"my-topic\",\r\n\t\tCompressionType: pulsar.NoCompression,\r\n\t\t//Batching: false,\r\n\t})\r\n\tif err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n\r\n\tdefer producer.Close()\r\n\r\n\tctx := context.Background()\r\n\tbuf := make([]byte, 10*1024*1024)\r\n\tarrays := [1024*1024*5 - 10*1024 - 1]byte{}\r\n\tbuf = arrays[:]\r\n\tfmt.Println(len(buf)) // len: 5232639\r\n\r\n\tproducer.SendAsync(ctx, pulsar.ProducerMessage{\r\n\t\tPayload: buf,\r\n\t}, func(producerMessage pulsar.ProducerMessage, e error) {\r\n\t\tfmt.Print(\"send complete. err=\", e)\r\n\t})\r\n}\r\n```\r\n\r\nerror as follows:\r\n\r\n```\r\nsend complete. err=Failed to send message: MessageTooBig\r\n```\r\n\r\nerror location as follows:\r\n\r\n**c_producer.go #line:257**\r\n```\r\n252:  //export pulsarProducerSendCallbackProxy\r\n253: func pulsarProducerSendCallbackProxy(res C.pulsar_result, message *C.pulsar_message_t, ctx unsafe.Pointer) {\r\n254:\tsendCallback := restorePointer(ctx).(sendCallback)\r\n255:\r\n256: \tif res != C.pulsar_result_Ok {\r\n257: \t\tsendCallback.callback(sendCallback.message, newError(res, \"Failed to send message\"))\r\n258: \t} else {\r\n259: \t\tsendCallback.callback(sendCallback.message, nil)\r\n260: \t}\r\n261: }\r\n```\r\n\r\nWhen I continue to try to reduce the size of the message until `arrays := [1024*1024*5 - 10*1024 - 20]byte{}`, the message can be sent normally. What I can't explain is that what 20 bytes are used for.\r\n\r\nAt first I guess it might be the reason for **batch**, but opening and closing the batch is the same effect.\r\n", "url": "https://github.com/apache/pulsar/issues/4339", "user": "wolfstudy", "labels": ["component/client", "component/go", "type/bug"], "created": "2019-05-22 13:40:58", "closed": "2019-06-13 08:50:28", "commits": {}, "ttf": 21.00027777777778, "commitsDetails": []}, {"title": "Duplicate metrics Prometheus", "body": "**Describe the bug**\r\nThe default metrics stay present even though there is an other metrics with more information.\r\nPrometheus only processes this default metric.\r\n\r\n**To Reproduce**\r\n* Produce and consumer on your cluster\r\n* Do a curl on metrics url : \r\n```\r\ncurl -s server01:8080/metrics/ | grep -e pulsar_consumers_count\r\n```\r\n* The result :\r\n```\r\npulsar_consumers_count{cluster=\"pulsar_bdx\"} 0 1558518241858\r\npulsar_consumers_count{cluster=\"pulsar_bdx\",namespace=\"ns/global\",topic=\"persistent://ns/global/queue\"} 1.0 1558518241859\r\n```\r\n* Next, in prometheus you find only :\r\n```\r\npulsar_consumers_count{cluster=\"pulsar_bdx\",instance=\"server01:8080\",job=\"Pulsar-broker-exporter\"} 0\r\n```\r\n\r\n**Expected behavior**\r\n\r\n* In Prometheus, you should find :\r\n```\r\npulsar_consumers_count{cluster=\"pulsar_bdx\",instance=\"server01:8080\",job=\"Pulsar-broker-exporter\",namespace=\"ns/global\",topic=\"persistent://ns/global/queue1\"} 1\r\n```\r\n\r\n**Additional context**\r\n\r\nIn my test, I solved this problem by commenting on the next line of the file \"pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/NamespaceStatsAggregator.java\" :\r\n```\r\n// printDefaultBrokerStats(stream, cluster);\r\n```\r\nAn other solution should be the next line :\r\n```\r\nif (pulsar.getBrokerService().getMultiLayerTopicMap().isEmpty()) {\r\n    printDefaultBrokerStats(stream, cluster);\r\n}\r\n```\r\n\r\n\r\nWhy do these metrics remain constantly instead of being overrided by new values?", "url": "https://github.com/apache/pulsar/issues/4337", "user": "rcastagnet", "labels": ["component/stats", "type/bug"], "created": "2019-05-22 13:22:37", "closed": "2019-09-27 14:19:25", "commits": {}, "ttf": 128.00027777777777, "commitsDetails": []}, {"title": "Go client: consumer.Unsubscribe() places topic in unusable state.", "body": "**Describe the bug**\r\nMy unit tests use a static subscription name and topic name.  My test does a: create, publish, consume messages and then unsubscribe at the end.  This works the first time with no problem, but subsequent runs fail and the subscription is in an odd state.   I am able to clear the issue be running: `pulsar-client consume --subscription-name my-sub  --num-messages 0 my-topic` \r\nThen the next iteration of my test succeeds... and we repeat the process all over again.\r\n\r\nIf you don't Unsubscribe() then the test always succeeds.\r\nIf you create a new subscription name every time, the test always succeed. \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\nI created a repo with my Go tests: https://github.com/Jim-Lambert-Bose/go-test-pulsar-consumer\r\nTo recreate:\r\n1. clone repo\r\n2. run `go test -v` multiple times.\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\nI believe that you should be able to subscribe/unsubscribe as many times as you wish from the same static subscription name.  As long as you create a new subscriber, it should just work.\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: macOS Mojave v10.14.4\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4324", "user": "Jim-Lambert-Bose", "labels": ["component/client", "component/go", "type/bug"], "created": "2019-05-21 12:30:14", "closed": "2020-06-08 01:57:18", "commits": {}, "ttf": 383.0002777777778, "commitsDetails": []}, {"title": "multi consumer client subscribe partitioned topic by Exclusive subscriptionType don't throw Exception ", "body": "**Describe the bug**\r\nfirst, create **partitioned topic**  A with 4 partitions,\r\nthen, start first consumer  client by Exclusive subscriptionType, and then start second consumer client with the same subscription name, but the second client don't throw exception as except just log WARN message\uff1a\r\n```\r\n2019-05-21 17:35:47,053 WARN  [MultiTopicsConsumerImpl#777] [pulsar-client-io-1-1] [TopicsConsumerFakeTopicNameeb1cc] Failed to subscribe for topic [topic-partitioned] in topics consumer org.apache.pulsar.client.api.PulsarClientException$ConsumerBusyException: Exclusive consumer is already connected\r\n```\r\n\r\n**Expected behavior**\r\nthrow exception as consumer the none partitioned topic \r\n\r\n```\r\n2019-05-21 17:50:11,037 WARN  [ConsumerImpl#608] [pulsar-client-io-1-1] [tutorial-topic][tutorial-subscription2] Failed to subscribe to topic on localhost/127.0.0.1:6650\r\nException in thread \"main\" org.apache.pulsar.client.api.PulsarClientException$ConsumerBusyException: Exclusive consumer is already connected\r\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:826)\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:537)\r\n\tat org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:157)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:323)\r\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:297)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1434)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:965)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:163)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:656)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:591)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:508)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:470)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n\r\n```\r\n\r\n**Additional context**\r\nversion: 2.3.1 or master\r\n", "url": "https://github.com/apache/pulsar/issues/4323", "user": "yangl", "labels": ["component/client", "type/bug"], "created": "2019-05-21 09:52:27", "closed": "2019-07-16 02:42:15", "commits": {}, "ttf": 55.000277777777775, "commitsDetails": []}, {"title": "[pulsar functions] import java class conflicts", "body": "**Describe the bug**\r\nAdd a dedicated JerseyClient dependency on functions throws conflicts during import.\r\n\r\n```\r\njava.lang.RuntimeException: java.lang.ClassNotFoundException: org.apache.pulsar.functions.runtime.shaded.org.glassfish.jersey.client.JerseyClientBuilder\r\n        at javax.ws.rs.client.ClientBuilder.newBuilder(ClientBuilder.java:110) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at javax.ws.rs.client.ClientBuilder.newClient(ClientBuilder.java:121) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at com.clevercloud.pulsar.util.PulsarRESTAPIUtils.createTenant(PulsarRESTAPIUtils.java:22) ~[pulsar-functions-0.1.0-SNAPSHOT.jar-unpacked/:?]\r\n        at com.clevercloud.pulsar.function.RouteApplicationsAddonsLogs.lambda$publishToUser$0(RouteApplicationsAddonsLogs.java:83) ~[pulsar-functions-0.1.0-SNAPSHOT.jar-unpacked/:?]\r\n        at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870) ~[?:1.8.0_192]\r\n        at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884) ~[?:1.8.0_192]\r\n        at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196) ~[?:1.8.0_192]\r\n        at com.clevercloud.pulsar.function.RouteApplicationsAddonsLogs.publishToUser(RouteApplicationsAddonsLogs.java:77) ~[pulsar-functions-0.1.0-SNAPSHOT.jar-unpacked/:?]\r\n        at com.clevercloud.pulsar.function.RouteApplicationsAddonsLogs.lambda$publishToUser$0(RouteApplicationsAddonsLogs.java:88) ~[pulsar-functions-0.1.0-SNAPSHOT.jar-unpacked/:?]\r\n        at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870) ~[?:1.8.0_192]\r\n        at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884) ~[?:1.8.0_192]\r\n        at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196) ~[?:1.8.0_192]\r\n        at com.clevercloud.pulsar.function.RouteApplicationsAddonsLogs.publishToUser(RouteApplicationsAddonsLogs.java:77) ~[pulsar-functions-0.1.0-SNAPSHOT.jar-unpacked/:?]\r\n        at com.clevercloud.pulsar.function.RouteApplicationsAddonsLogs.lambda$publishToUser$0(RouteApplicationsAddonsLogs.java:88) ~[pulsar-functions-0.1.0-SNAPSHOT.jar-unpacked/:?]\r\n        at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870) ~[?:1.8.0_192]\r\n        at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884) ~[?:1.8.0_192]\r\n        at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196) ~[?:1.8.0_192]\r\n        at com.clevercloud.pulsar.function.RouteApplicationsAddonsLogs.publishToUser(RouteApplicationsAddonsLogs.java:77) ~[pulsar-functions-0.1.0-SNAPSHOT.jar-unpacked/:?]\r\n        at com.clevercloud.pulsar.function.RouteApplicationsAddonsLogs.lambda$publishToUser$0(RouteApplicationsAddonsLogs.java:88) ~[pulsar-functions-0.1.0-SNAPSHOT.jar-unpacked/:?]\r\n        at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870) [?:1.8.0_192]\r\n        at java.util.concurrent.CompletableFuture.uniExceptionallyStage(CompletableFuture.java:884) [?:1.8.0_192]\r\n        at java.util.concurrent.CompletableFuture.exceptionally(CompletableFuture.java:2196) [?:1.8.0_192]\r\n        at com.clevercloud.pulsar.function.RouteApplicationsAddonsLogs.publishToUser(RouteApplicationsAddonsLogs.java:77) [pulsar-functions-0.1.0-SNAPSHOT.jar-unpacked/:?]\r\n        at com.clevercloud.pulsar.function.RouteApplicationsAddonsLogs.process(RouteApplicationsAddonsLogs.java:56) [pulsar-functions-0.1.0-SNAPSHOT.jar-unpacked/:?]\r\n        at com.clevercloud.pulsar.function.RouteApplicationsAddonsLogs.process(RouteApplicationsAddonsLogs.java:22) [pulsar-functions-0.1.0-SNAPSHOT.jar-unpacked/:?]\r\n        at org.apache.pulsar.functions.instance.JavaInstance.handleMessage(JavaInstance.java:63) [java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:257) [java-instance.jar:2.4.0-SNAPSHOT]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_192]\r\nCaused by: java.lang.ClassNotFoundException: org.apache.pulsar.functions.runtime.shaded.org.glassfish.jersey.client.JerseyClientBuilder\r\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:382) ~[?:1.8.0_192]\r\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:424) ~[?:1.8.0_192]\r\n        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349) ~[?:1.8.0_192]\r\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:357) ~[?:1.8.0_192]\r\n        at java.lang.Class.forName0(Native Method) ~[?:1.8.0_192]\r\n        at java.lang.Class.forName(Class.java:264) ~[?:1.8.0_192]\r\n        at javax.ws.rs.client.FactoryFinder.newInstance(FactoryFinder.java:111) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at javax.ws.rs.client.FactoryFinder.find(FactoryFinder.java:209) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at javax.ws.rs.client.ClientBuilder.newBuilder(ClientBuilder.java:94) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        ... 27 more\r\n```\r\n\r\n`pom.xml` looks like:\r\n```\r\n<dependency>\r\n  <groupId>org.glassfish.jersey.core</groupId>\r\n  <artifactId>jersey-client</artifactId>\r\n  <version>2.28</version>\r\n</dependency>\r\n<dependency>\r\n  <groupId>org.glassfish.jersey.inject</groupId>\r\n  <artifactId>jersey-hk2</artifactId>\r\n  <version>2.28</version>\r\n</dependency>\r\n```\r\n\r\nAnd the imports of the function:\r\n```\r\nimport javax.ws.rs.client.ClientBuilder;\r\nimport javax.ws.rs.client.Entity;\r\nimport javax.ws.rs.core.MediaType;\r\nimport javax.ws.rs.core.Response;\r\n\r\nimport org.apache.commons.codec.binary.Base64;\r\n\r\nimport org.glassfish.jersey.client.authentication.HttpAuthenticationFeature;\r\nimport org.glassfish.jersey.client.ClientConfig;\r\nimport org.glassfish.jersey.logging.LoggingFeature;\r\n```\r\n\r\nI think it's about reflections on `javax.ws.rs.client.ClientBuilder` when it needs the jerserbuilder. \r\n", "url": "https://github.com/apache/pulsar/issues/4321", "user": "KannarFr", "labels": ["type/bug"], "created": "2019-05-21 08:29:09", "closed": "2019-05-28 22:45:43", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "Number of placeholder and arguments mismatch in log message", "body": "**Describe the bug**\r\nWe have some log like:\r\n```\r\nlog.debug(\"[{}] Redirecting the rest call to {}: cluster={}\", redirect, peerClusterData);\r\n```\r\nThe number of ```{}``` is different to arguments count.  And for exception logging:\r\n```\r\nlog.warn(\"Failed to offload: {}\", e.getCause());\r\n```\r\nThe last argument type is ```Throwable``` , here is last argument will not be treated as a format argument even there is a placeholder. \r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4304", "user": "liketic", "labels": ["type/bug"], "created": "2019-05-18 14:07:00", "closed": "2020-01-14 07:59:12", "commits": {"39551bb7518bd7196d9f94adf2b5ebf20c139bf0": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 240.00027777777777, "commitsDetails": [{"commitHash": "39551bb7518bd7196d9f94adf2b5ebf20c139bf0", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["fc59074e9a563a7952ae9fd18e8a2e8bbb1e72a9"], "nameRev": "39551bb7518bd7196d9f94adf2b5ebf20c139bf0 tags/v2.4.0-candidate-1~84", "commitMessage": "Fix log format for module pulsar-client (#4436)\n\nFix log format for module pulsar-client. \r\n\r\nPart of #4304", "commitDateTime": "2019-06-04 11:46:57", "authoredDateTime": "2019-06-05 02:46:57", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PartitionedProducerImpl.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerStatsRecorderImpl.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarServiceNameResolver.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PartitionedProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PartitionedProducerImpl.1.run(io.netty.util.Timeout)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProducerStatsRecorderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerStatsRecorderImpl.init(org.apache.pulsar.client.impl.conf.ProducerConfigurationData)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarServiceNameResolver.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PulsarServiceNameResolver.updateServiceUrl(java.lang.String)", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 2}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "flink job crashes when serializing auth in pulsar client", "body": "**Describe the bug**\r\npulsar flink connector now uses ClientConfigData to instantiate pulsar client. Pulsar client composes Authentication which can not be serialized. In an environment with Auth there is no way to set auth in pulsar client.\r\n\r\n**To Reproduce**\r\nThe below code crashes on last line:\r\n\r\n>         ClientConfigurationData clientConfig = new ClientConfigurationData();\r\n>         clientConfig.setServiceUrl(PULSAR_BROKER_URL);\r\n>         clientConfig.setAuthPluginClassName(AuthenticationToken.class.getName());\r\n>         clientConfig.setAuthParams(ImmutableMap.of(\"token\", PULSAR_AUTH_TOKEN));\r\n> \r\n>         ConsumerConfigurationData consumerConfig = new ConsumerConfigurationData();\r\n>         consumerConfig.setSubscriptionInitialPosition(SubscriptionInitialPosition.Earliest);\r\n>         consumerConfig.setTopicNames(new HashSet<>(Arrays.asList(PULSAR_TOPIC)));\r\n>         consumerConfig.setSubscriptionName(PULSAR_SUBSCRIPTION_NAME);\r\n> \r\n>         PulsarSourceBuilder pulsarSourceBuilder = PulsarSourceBuilder.builder(new SimpleStringSchema())\r\n>                 .pulsarAllClientConf(clientConfig)\r\n>                 .pulsarAllConsumerConf(consumerConfig);\r\n> \r\n>         StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\r\n> \r\n>         env.setStreamTimeCharacteristic(TimeCharacteristic.ProcessingTime);\r\n> \r\n>         SourceFunction src = pulsarSourceBuilder.build();\r\n>         DataStream dataStream = env.addSource(src).uid(\"testStream\");\r\n\r\n**Expected behavior**\r\nProvide a way to set Auth for pulsar client from pulsar flink connector\r\n", "url": "https://github.com/apache/pulsar/issues/4283", "user": "shiv4289", "labels": ["type/bug"], "created": "2019-05-16 07:11:39", "closed": "2019-05-18 12:27:05", "commits": {"353ca73b11124f3df58934f4f496d370545d8a05": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "353ca73b11124f3df58934f4f496d370545d8a05", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["ce685dc3b359674941f02f81185651645012e80a"], "nameRev": "353ca73b11124f3df58934f4f496d370545d8a05 tags/v2.4.0-candidate-1~198", "commitMessage": "[Issue 4283][flink] construct auth when building pulsar source (#4284)\n\nFixes #4283\r\n\r\n### Motivation\r\n\r\npulsar flink connector now uses ClientConfigData to instantiate pulsar client. Pulsar client composes Authentication which can not be serialized. In an environment with Auth there is no way to set auth in pulsar client.\r\n\r\n### Modifications\r\n\r\nKeep auth params away from persistence and serialization. Construct auth when building pulsar source\r\n", "commitDateTime": "2019-05-18 05:27:04", "authoredDateTime": "2019-05-18 17:45:04", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/conf/ClientConfigurationData.java", "insertions": 12, "deletions": 8, "lines": 20}, {"filePath": "pulsar-flink/src/main/java/org/apache/flink/streaming/connectors/pulsar/FlinkPulsarProducer.java", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-flink/src/main/java/org/apache/flink/streaming/connectors/pulsar/PulsarSourceBuilder.java", "insertions": 20, "deletions": 1, "lines": 21}, {"filePath": "pulsar-flink/src/test/java/org/apache/flink/streaming/connectors/pulsar/PulsarSourceBuilderTest.java", "insertions": 10, "deletions": 9, "lines": 19}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ClientConfigurationData.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.conf.ClientConfigurationData", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "FlinkPulsarProducer.java", "spoonMethods": []}, {"spoonFilePath": "PulsarSourceBuilder.java", "spoonMethods": [{"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarSourceBuilder.setTransientFields()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarSourceBuilder.setAuth()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarSourceBuilder.build()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarSourceBuilderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarSourceBuilderTest.testBuild()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarSourceBuilderTest.testBuildWithConfPojo()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarSourceBuilderTest.testBuildWithoutSettingRequiredProperties()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarSourceBuilderTest.testServiceUrlNullWithConfPojo()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarSourceBuilderTest.testServiceUrlWithBlankWithConfPojo()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarSourceBuilderTest.testTopicPatternWithNullWithConfPojo()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarSourceBuilderTest.testSubscriptionNameWithNullWithConfPojo()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarSourceBuilderTest.testSubscriptionNameWithBlankWithConfPojo()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.flink.streaming.connectors.pulsar.PulsarSourceBuilderTest.testSubscriptionInitialPositionWithConfPojo()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "zookeeper leader log file grows and fills up disk space", "body": "### Issue\r\n\r\nWhen Bk-client deletes the ledger, it also tries to delete ledger's parent nodes blindly and because of that ZK's entire log file fills up  with below log `Directory not empty for`. Broker rollovers cursor's metadata-ledger at every few configured hours. Broker with large number of global topics and cursors it generates really huge log (>10GB/day) file at zk-leader which consumes most of the disk space.\r\n\r\n```\r\nTue May 14 00:00:00 2019: 2019-05-14 00:00:00,297 - INFO  [ProcessThread(sid:5 cport:-1)::PrepRequestProcessor@645] - Got user-level KeeperException when processing sessionid:0x123454567 type:delete cxid:0xc655f6 zxid:0x123454567 txntype:-1 reqpath:n/a Error Path:/ledgers/000/0000/0123/4567 Error:KeeperErrorCode = Directory not empty for /ledgers/000/0000/0123/4567\r\n```\r\n\r\n### Possible fix\r\n1. Logging configuration change at ZK/Change log level but then it will prevent us to store important logs when it needs for troubleshooting.\r\n2. Better solution :  BK-client should only delete parent node if it's empty. It also prevents unexpected data-loss due to unseen zk's bug while deleting non-empty znode.\r\n", "url": "https://github.com/apache/pulsar/issues/4276", "user": "rdhabalia", "labels": ["type/bug"], "created": "2019-05-14 23:14:48", "closed": "2020-01-14 09:01:35", "commits": {}, "ttf": 244.00027777777777, "commitsDetails": []}, {"title": "Prometheus Topic stats with remote cluster issue", "body": "**Describe the bug**\r\nThe remote cluster label is appended without closing the topic label \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to Prometheus broker metrics in which the topic has remote cluster\r\n2. check the pulsar_replication_* types\r\n4. The topic label has value like\r\npulsar_replication_rate_in{cluster=\"cluster\",namespace=\"ns\",topic=\"persistent://ns/ns/topicnameremote_cluster=\"vmb-us-west-rocklin-cluster\"} 0.0 1557859327946\r\n\r\n**Expected behavior**\r\nClass:: pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/TopicStats.java\r\nMethod :: metricWithRemoteCluster\r\nthe current code is \r\nstream.write(\"\\\\\",topic=\\\"\").write(topic).write(\"remote_cluster=\\\\\"\").write(remoteCluster).write(\"\\\\\"} \");\r\n\r\nit should be\r\nstream.write(\"\\\\\",topic=\\\"\").write(topic).write(\"\\\\\",\"remote_cluster=\\\\\"\").write(remoteCluster).write(\"\\\\\"} \");\r\n ", "url": "https://github.com/apache/pulsar/issues/4274", "user": "VagulaSundararajan", "labels": ["type/bug"], "created": "2019-05-14 20:26:05", "closed": "2019-05-17 17:00:48", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Not exist default tenants `public` and namespace `default`", "body": "**Describe the bug**\r\nWhen I start a broker there is not exist default tenants and namespace:\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Start a zookeeper\r\n2. Start a broker `bin/pulsar broker`\r\n\r\n**Expected behavior**\r\nstart a broker successfully\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/24502569/57524219-c1125b00-7359-11e9-8e3f-cccd5230d315.png)\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [macOS]\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4260", "user": "zymap", "labels": ["type/bug"], "created": "2019-05-10 11:28:30", "closed": "2019-05-15 08:08:07", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "Schema parsing validation", "body": "**Describe the bug**\r\nWhen you put a schema which has parsing issues using Avro, there is a 500 without stacktrace.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4251", "user": "KannarFr", "labels": ["type/bug"], "created": "2019-05-09 18:10:00", "closed": "2019-05-15 21:22:05", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "pulsar source localrun command report error: IllegalArgumentException", "body": "**Describe the bug**\r\nWhen I run the following command\r\n```\r\n./bin/pulsar-admin source localrun --sourceConfigFile pulsar-io/debezium/mysql/src/main/resources/debezium-mysql-source-config.yaml\r\n```\r\nThis error occurred:\r\n\r\n```\r\nException in thread \"main\" java.lang.IllegalArgumentException: Source Package is not provided\r\n\tat org.apache.pulsar.functions.utils.SourceConfigUtils.validate(SourceConfigUtils.java:261)\r\n\tat org.apache.pulsar.functions.runtime.LocalRunner.start(LocalRunner.java:136)\r\n\tat org.apache.pulsar.functions.runtime.LocalRunner.main(LocalRunner.java:88)\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Use the latest code\r\n\r\n2. Configuration file debezium-mysql-source-config.yaml\r\n\r\n```\r\ntenant: \"test\"\r\nnamespace: \"test-namespace\"\r\nname: \"debezium-mysql-source\"\r\ntopicName: \"debezium-mysql-topic\"\r\narchive: \"connectors/pulsar-io-debezium-mysql-2.4.0-SNAPSHOT.nar\"\r\n\r\nparallelism: 1\r\n\r\nconfigs:\r\n  ## config for mysql, docker image: debezium/example-mysql:0.8\r\n  ## sourceTask\r\n  task.class: \"io.debezium.connector.mysql.MySqlConnectorTask\"\r\n  database.hostname: \"localhost\"\r\n  database.port: \"3306\"\r\n  database.user: \"debezium\"\r\n  database.password: \"dbz\"\r\n  database.server.id: \"184054\"\r\n  database.server.name: \"dbserver1\"\r\n  database.whitelist: \"inventory\"\r\n\r\n  ## PULSAR_SERVICE_URL_CONFIG\r\n  pulsar.service.url: \"pulsar://127.0.0.1:6650\"\r\n  database.history.pulsar.topic: \"mysql-history-topic\"\r\n  offset.storage.topic: \"mysql-offset-topic\"\r\n```\r\n\r\n3. \r\n```\r\ndocker run -it --rm --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=debezium -e MYSQL_USER=mysqluser -e MYSQL_PASSWORD=mysqlpw debezium/example-mysql:0.8\r\n\r\ncp pulsar-io/debezium/mysql/target/pulsar-io-debezium-mysql-2.4.0-SNAPSHOT.nar ./connectors\r\n\r\n./bin/pulsar-admin source localrun --sourceConfigFile debezium-mysql-source-config.yaml\r\n\r\nException in thread \"main\" java.lang.IllegalArgumentException: Source Package is not provided\r\n\tat org.apache.pulsar.functions.utils.SourceConfigUtils.validate(SourceConfigUtils.java:261)\r\n\tat org.apache.pulsar.functions.runtime.LocalRunner.start(LocalRunner.java:136)\r\n\tat org.apache.pulsar.functions.runtime.LocalRunner.main(LocalRunner.java:88)\r\n```\r\n\r\n**Expected behavior**\r\nlocalrun success\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [Mac]\r\n\r\n**Additional context**\r\nI feel it has something to do with this pull request https://github.com/apache/pulsar/pull/3969.\r\n@jerrypeng \r\n", "url": "https://github.com/apache/pulsar/issues/4248", "user": "tuteng", "labels": ["component/functions", "type/bug"], "created": "2019-05-09 14:48:49", "closed": "2019-05-19 13:04:10", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "Message size is bigger than 5232640 bytes", "body": "**use pulsar-2.3.1 run in standalone,  and sync mysql binlog from canal(1.1.3), when message size more than 5M  cause IllegalReferenceCountException**\r\n\r\n# ENV\r\n1. pulsar 2.3.1\r\n2. Centos 7.6.1810\r\n3. canal-mysql-source-config.yaml \r\n```yaml\r\nconfigs:\r\n  zkServers: \"\"\r\n  batchSize: \"5120\"\r\n  destination: \"item_0\"\r\n  username: \"\"\r\n  password: \"\"\r\n  cluster: false\r\n  singleHostname: \"192.168.1.174\"\r\n  singlePort: \"11111\"\r\n```\r\n4. Command\r\n```bash\r\n/opt/apache-pulsar-2.3.1/bin/pulsar-admin source create --archive /opt/apache-pulsar-2.3.1/connectors/pulsar-io-canal-2.3.1.nar --classname org.apache.pulsar.io.canal.CanalStringSource --tenant public --namespace default --name canal --destination-topic-name my-topic --source-config-file /opt/apache-pulsar-2.3.1/conf/canal-mysql-source-config.yaml --parallelism 1\r\n```\r\n\r\n**/opt/apache-pulsar-2.3.1/logs/functions/public/default/canal/canal-0.log**\r\n```bash filename=/opt/apache-pulsar-2.3.1/logs/functions/public/default/canal/canal-0.log\r\n00:01:37.844 [pulsar-client-io-1-1] INFO  org.apache.pulsar.io.canal.CanalAbstractSource - CanalRecord ack id is 159877\r\n00:01:37.986 [pulsar-client-io-1-1] INFO  org.apache.pulsar.io.canal.CanalAbstractSource - CanalRecord ack id is 159878\r\n00:01:38.058 [pulsar-timer-4-1] ERROR org.apache.pulsar.functions.sink.PulsarSink - Failed to publish to topic [my-topic] with error [org.apache.pulsar.client.api.PulsarClientException$InvalidMessageException: Message size is bigger than 5232640 bytes] with sr\r\nc sequence id [159879]\r\n00:01:38.079 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.091 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.102 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.113 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.124 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.135 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.146 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.157 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.168 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.169 [public/default/canal-0] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.169 [public/default/canal-0] ERROR org.apache.pulsar.functions.sink.PulsarSink - Failed to publish to topic [my-topic] with error [org.apache.pulsar.client.api.PulsarClientException: org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalRefe\r\nrenceCountException: refCnt: 0] with src sequence id [159880]\r\n00:01:38.179 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.189 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.200 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.211 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.252 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.263 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.270 [public/default/canal-0] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.271 [public/default/canal-0] ERROR org.apache.pulsar.functions.sink.PulsarSink - Failed to publish to topic [my-topic] with error [org.apache.pulsar.client.api.PulsarClientException: org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalRefe\r\nrenceCountException: refCnt: 0] with src sequence id [159881]\r\n00:01:38.273 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.284 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.295 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.296 [public/default/canal-0] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.297 [public/default/canal-0] ERROR org.apache.pulsar.functions.sink.PulsarSink - Failed to publish to topic [my-topic] with error [org.apache.pulsar.client.api.PulsarClientException: org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalRefe\r\nrenceCountException: refCnt: 0] with src sequence id [159882]\r\n00:01:38.307 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.319 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.331 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.343 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.355 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.367 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.379 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.390 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n00:01:38.401 [pulsar-timer-4-1] WARN  org.apache.pulsar.client.impl.ProducerImpl - [my-topic] [standalone-8-2] error while closing out batch -- org.apache.pulsar.functions.runtime.shaded.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n\r\n```\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4243", "user": "zhengqz", "labels": ["type/bug"], "created": "2019-05-09 03:12:05", "closed": "2019-05-19 13:02:51", "commits": {}, "ttf": 10.000277777777777, "commitsDetails": []}, {"title": "c++ client too many files opens", "body": "**Describe the bug**\r\nopen too many files.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. create client&consumer, subscribe, close and destroy client.   \r\n2. do `Step1` in a loop for many times\r\n3. use `netstat` i find that the number of opened socket is increasing.\r\n4. See error,  too many files open, when create client  \r\n\r\n**Expected behavior**\r\nnothing.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4240", "user": "18852996112", "labels": ["type/bug"], "created": "2019-05-09 01:03:38", "closed": "2019-05-10 01:36:55", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "`rereplicationEntryBatchSize` should be smaller than `maxPendingReadRequestsPerThread`", "body": "*Problems*\r\n\r\nIf you have only a small number of bookies, when a bookie crashes, auto recovery kicks in and it will quickly overwhelm the other bookies.\r\n\r\n*Solution*\r\n\r\nIt would be good to set a reasonable value.", "url": "https://github.com/apache/pulsar/issues/4213", "user": "sijie", "labels": ["component/config", "help wanted", "type/bug"], "created": "2019-05-06 09:19:06", "closed": "2019-05-23 09:39:58", "commits": {"f82441018ac21a81f2bbbf8a11e5d29c22a3197b": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 17.00027777777778, "commitsDetails": [{"commitHash": "f82441018ac21a81f2bbbf8a11e5d29c22a3197b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["4f9eecca4d28985c7fe6c18a158254675f1a9f31"], "nameRev": "f82441018ac21a81f2bbbf8a11e5d29c22a3197b tags/v2.4.0-candidate-1~161", "commitMessage": "`rereplicationEntryBatchSize` should be smaller than `maxPendingReadR\u2026 (#4314)\n\nFixes #4213 \r\n", "commitDateTime": "2019-05-23 17:39:57", "authoredDateTime": "2019-05-23 17:39:57", "commitGitStats": [{"filePath": "conf/bookkeeper.conf", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/PulsarBrokerStarter.java", "insertions": 5, "deletions": 0, "lines": 5}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarBrokerStarter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.PulsarBrokerStarter.readBookieConfFile(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Download links for 2.3.1 rpm packages are broken", "body": "![image (2)](https://user-images.githubusercontent.com/1217863/57190693-f977fa80-6f4f-11e9-8b20-2fffd580bf50.png)\r\n![image (1)](https://user-images.githubusercontent.com/1217863/57190694-fa109100-6f4f-11e9-92f5-dc7d4bca8ade.png)\r\n", "url": "https://github.com/apache/pulsar/issues/4206", "user": "sijie", "labels": ["component/documentation", "help wanted", "type/bug"], "created": "2019-05-05 08:08:34", "closed": "2019-05-05 15:29:28", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[schema] java.lang.NoClassDefFoundError: org/joda/time/ReadablePartial", "body": "**Describe the bug**\r\n\r\nWhen using AvroSchema from latest master, it throws following exceptions:\r\n\r\n```\r\njava.lang.RuntimeException: java.lang.NoClassDefFoundError: org/joda/time/ReadablePartial\r\n\r\n\tat org.apache.pulsar.client.internal.ReflectionUtils.catchExceptions(ReflectionUtils.java:36)\r\n\tat org.apache.pulsar.client.internal.DefaultImplementation.newAvroSchema(DefaultImplementation.java:212)\r\n\tat org.apache.pulsar.client.api.Schema.AVRO(Schema.java:196)\r\n\tat io.streamnative.tests.pulsar.schema.CreateDifferentSchemaAfterDeleteSchemaTest.testCreateSchemaAfterDeletion(CreateDifferentSchemaAfterDeleteSchemaTest.java:84)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\r\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\r\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\r\n\tat io.streamnative.tests.common.framework.SystemTestRunner.invokeTest(SystemTestRunner.java:219)\r\n\tat io.streamnative.tests.common.framework.SystemTestRunner.runChild(SystemTestRunner.java:212)\r\n\tat io.streamnative.tests.common.framework.SystemTestRunner.runChild(SystemTestRunner.java:52)\r\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\r\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\r\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\r\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\r\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\r\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\r\n\tat org.junit.runner.JUnitCore.run(JUnitCore.java:137)\r\n\tat com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)\r\n\tat com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)\r\n\tat com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)\r\n\tat com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)\r\nCaused by: java.lang.NoClassDefFoundError: org/joda/time/ReadablePartial\r\n\tat org.apache.pulsar.client.impl.schema.AvroSchema.<clinit>(AvroSchema.java:60)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.apache.pulsar.client.internal.DefaultImplementation.lambda$newAvroSchema$24(DefaultImplementation.java:214)\r\n\tat org.apache.pulsar.client.internal.ReflectionUtils.catchExceptions(ReflectionUtils.java:34)\r\n\t... 30 more\r\nCaused by: java.lang.ClassNotFoundException: org.joda.time.ReadablePartial\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:382)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\n\t... 37 more\r\n```\r\n\r\n**To Reproduce**\r\n\r\n1. Build the latest master.\r\n2. Use the AvroSchema from latest master. It will throws the above exception.\r\n\r\n**Expected behavior**\r\n\r\nNo exception should be thrown.\r\n\r\n**Additional context**\r\n\r\nI think the problem introduced by #3900. It doesn't shade the joda library properly. \r\n", "url": "https://github.com/apache/pulsar/issues/4179", "user": "sijie", "labels": ["component/schemaregistry", "type/bug"], "created": "2019-04-30 11:37:53", "closed": "2019-05-18 14:41:38", "commits": {}, "ttf": 18.00027777777778, "commitsDetails": []}, {"title": "Pulsar Functions documentation does not mention deploying Functions workers in containers", "body": "**Describe the bug**\r\nThe current Pulsar Functions deployment documentation (https://pulsar.apache.org/docs/latest/functions/deployment/) lists only localrun and cluster mode as the deployment options for Functions. Should also note that Functions can be deployed to run in containers/nodes that are separate from the broker nodes.\r\n\r\n**Expected behavior**\r\nFunctions deployment documentation needs to indicate that Functions can be deployed to run in containers/nodes that are separate from the broker nodes.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4171", "user": "jonb-streamlio", "labels": ["component/documentation", "type/bug"], "created": "2019-04-29 18:11:39", "closed": "2019-05-22 09:49:21", "commits": {}, "ttf": 22.00027777777778, "commitsDetails": []}, {"title": "The superuser cannot obtain lastMessageId", "body": "partition-0 get lastMessageId `401 Authentication required`\r\n![image](https://user-images.githubusercontent.com/34467450/56876049-456dff80-6a77-11e9-8df7-f49a88a5e4e6.png)\r\n\r\npartition-1 get lastMessageId is ok\r\n![image](https://user-images.githubusercontent.com/34467450/56876036-30916c00-6a77-11e9-9f82-807362b2e35b.png)\r\n", "url": "https://github.com/apache/pulsar/issues/4164", "user": "Xlingxiao", "labels": ["component/cli", "triage/week-3", "type/bug"], "created": "2019-04-29 04:08:20", "closed": "2020-01-14 11:16:34", "commits": {}, "ttf": 260.0002777777778, "commitsDetails": []}, {"title": "The maximum number of outstanding messages (--max-outstanding) configuration may be inaccurate when the topic is multi-partitioned", "body": "In the Producer Performance Benchmark, Topic has a partition number of 1024, specifying the parameter [-o 20000], and found that the maximum number of outstanding messages per producer is 48.\r\n```shell\r\n02:23:10.036 [pulsar-client-io-2-1] INFO  org.apache.pulsar.client.impl.ProducerStatsRecorderImpl - Starting Pulsar producer perf with config: {\r\n  \"topicName\" : \"persistent://xxxx/internal/benchmark2\",\r\n  \"producerName\" : null,\r\n  \"sendTimeoutMs\" : 0,\r\n  \"blockIfQueueFull\" : true,\r\n  \"maxPendingMessages\" : 48,\r\n  \"maxPendingMessagesAcrossPartitions\" : 50000,\r\n  \"messageRoutingMode\" : \"RoundRobinPartition\",\r\n  \"hashingScheme\" : \"JavaStringHash\",\r\n  \"cryptoFailureAction\" : \"FAIL\",\r\n  \"batchingMaxPublishDelayMicros\" : 1000,\r\n  \"batchingMaxMessages\" : 1000,\r\n  \"batchingEnabled\" : true,\r\n  \"compressionType\" : \"NONE\",\r\n  \"initialSequenceId\" : null,\r\n  \"autoUpdatePartitions\" : true,\r\n  \"properties\" : { }\r\n}\r\n```\r\n\r\n1. Created a Topic with 1024 partitions.\r\n2. Test with the following command:\r\n```shell\r\n/pulsar-perf produce persistent://xxxx/internal/benchmark2 -m 10000000 -n 10 -i 5 -time 600 -o 20000 -u pulsar://10.0.231.202:6650,10.0.219.35:6650,10.0.250.94:6650> 0428-002-producer.log\r\n```\r\n**Expected**\r\nThe number of outstanding consumption messages per partition is 20000 or 20000/partition number.\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4159", "user": "kuangye098", "labels": ["type/bug"], "created": "2019-04-28 09:18:24", "closed": "2019-04-29 06:01:12", "commits": {"d85b0c93ceb4aa868108b6b16027d304fd873747": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "d85b0c93ceb4aa868108b6b16027d304fd873747", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["d5ff0828d222775d0562a1b5d589e3f231a1716f"], "nameRev": "d85b0c93ceb4aa868108b6b16027d304fd873747 tags/v2.4.0-candidate-1~275", "commitMessage": "[Issue#4159][pulsar-testclient] Added ['-p','--max-outstanding-across-partitions'] parameter to the producer performance benchmark (#4160)\n\nFixes: #4159 \r\n\r\nMaster Issue: #4159 \r\n\r\n**Modifications**\r\n\r\n* Added ['-p','--max-multiPartition-outstanding'] parameter to the producer performance benchmark", "commitDateTime": "2019-04-29 14:01:11", "authoredDateTime": "2019-04-29 14:01:11", "commitGitStats": [{"filePath": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/PerformanceProducer.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "site2/docs/reference-cli-tools.md", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PerformanceProducer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.testclient.PerformanceProducer.Arguments", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.testclient.PerformanceProducer.main(java.lang.String[])", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "UNAVAILABLE: io exception in a elasticsearch sink", "body": "define a sink to elastic search. \r\n/pulsar/bin/pulsar-admin sink create --sink-type elastic_search --sink-config-file /var/exconf/sinkConfigElastic.yml\r\n\r\n20:05:21.878 [main] INFO  org.apache.pulsar.admin.cli.CmdSinks - The sinkConfig read from file is SinkConfig(tenant=public, namespace=default, name=elastic-test-sink, className=null, sourceSubscriptionName=null, inputs=[assignments, my-topic], topicToSerdeClassName=null, topicsPattern=null, topicToSchemaType=null, inputSpecs={}, configs={elasticSearchUrl=http://localhost:9200, indexName=myIndex}, secrets=null, parallelism=null, processingGuarantees=null, retainOrdering=null, resources=null, autoAck=null, timeoutMs=null, archive=null, cleanupSubscription=null, runtimeFlags=null)\r\n\"Created successfully\"\r\n\r\nThis sink never reaches rinnung state.\r\n\r\nFetching the status of sink shows Unavailable: IO exception.\r\nThe sink keeps re-starting to no benefit.\r\n\r\n\r\n/pulsar/bin/pulsar-admin sink status --tenant public --namespace default --name elastic-test-sink\r\n{\r\n  \"numInstances\" : 1,\r\n  \"numRunning\" : 0,\r\n  \"instances\" : [ {\r\n    \"instanceId\" : 0,\r\n    \"status\" : {\r\n      \"running\" : false,\r\n      \"error\" : \"UNAVAILABLE: io exception\",\r\n      \"numRestarts\" : 0,\r\n      \"numReadFromPulsar\" : 0,\r\n      \"numSystemExceptions\" : 0,\r\n      \"latestSystemExceptions\" : [ ],\r\n      \"numSinkExceptions\" : 0,\r\n      \"latestSinkExceptions\" : [ ],\r\n      \"numWrittenToSink\" : 0,\r\n      \"lastReceivedTime\" : 0,\r\n      \"workerId\" : \"c-standalone-fw-3ee9b3d7c888-8080\"\r\n    }\r\n  } ]\r\n}\r\n\r\n\r\n\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 18.04, using apachepulsar/pulsar-standalone latest official docker image\r\n\r\nelasticsearch running on same localhost using official docker image version 7.0.0.", "url": "https://github.com/apache/pulsar/issues/4156", "user": "readall", "labels": ["type/bug"], "created": "2019-04-27 20:22:38", "closed": "2019-04-29 16:55:32", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Incorrect behavior single Pulsar Client creating multiple consumers", "body": "**Describe the bug**\r\n\r\nAfter the introduction https://github.com/apache/pulsar/pull/3312 where the pulsar client try to return the same consumer on multiple consumer creates, incorrect and unexpected consumer creation behavior can occur.\r\n\r\nIf a single Pulsar client creates multiple consumers, some of the consumers retuned will be the the same consumer.  \r\n\r\nThis is not the expected behavior, since if I try to create N consumers for a topic, I somehow get less consumers.  This really gets to be a issue, in multi-thread applications in which different threads might create multiple instances of consumers at or near the same time.  I will get fewer actual consumers than requested.  Some threads will get new consumers while others might get the same consumer.\r\n\r\nWhat I described above is what is happening for running Pulsar Functions in threaded mode.  When I create/update/delete functions, this situation can occur and some functions instances doesn't get a valid consumer.\r\n\r\nFor example I have 5 instances of a function and I print out the consumer that is created for each of them\r\n\r\n```\r\n# instance 0\r\n13:27:56,971 INFO [public/default/generator-function-0] [instance: 0] PulsarSource - consumer: ConsumerBase{subscription='public/default/generator-function', consumerName='d2505', topic='persistent://public/default/jerry-input'} - Object Id: 1083103426\r\n\r\n\r\n# instance 1\r\n13:27:56,971 INFO [public/default/generator-function-1] [instance: 1] PulsarSource - consumer: ConsumerBase{subscription='public/default/generator-function', consumerName='d2505', topic='persistent://public/default/jerry-input'} - Object Id: 1083103426\r\n\r\n#instance 2\r\n13:27:56,896 INFO [public/default/generator-function-2] [instance: 2] PulsarSource - consumer: ConsumerBase{subscription='public/default/generator-function', consumerName='61f68', topic='persistent://public/default/jerry-input'} - Object Id: 1143398780\r\n\r\n#instance 3\r\n13:27:56,915 INFO [public/default/generator-function-3] [instance: 3] PulsarSource - consumer: ConsumerBase{subscription='public/default/generator-function', consumerName='d2505', topic='persistent://public/default/jerry-input'} -  Object Id: 1083103426\r\n\r\n#instance 4\r\n13:27:56,896 INFO [public/default/generator-function-4] [instance: 4] PulsarSource - consumer: ConsumerBase{subscription='public/default/generator-function', consumerName='d2505', topic='persistent://public/default/jerry-input'} -  Object Id: 1083103426\r\n```\r\n\r\nAs you can see from the printed ```Object Id```, some of the function instances get retuned the same consumer object.\r\n\r\nWhen I do topic stats on the input topic:\r\n\r\n```\r\n$ ./bin/pulsar-admin topics stats jerry-input\r\n{\r\n  \"msgRateIn\" : 0.0,\r\n  \"msgThroughputIn\" : 0.0,\r\n  \"msgRateOut\" : 0.0,\r\n  \"msgThroughputOut\" : 0.0,\r\n  \"averageMsgSize\" : 0.0,\r\n  \"storageSize\" : 0,\r\n  \"publishers\" : [ ],\r\n  \"subscriptions\" : {\r\n    \"public/default/generator-function\" : {\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateRedeliver\" : 0.0,\r\n      \"msgBacklog\" : 0,\r\n      \"blockedSubscriptionOnUnackedMsgs\" : false,\r\n      \"unackedMessages\" : 0,\r\n      \"type\" : \"Shared\",\r\n      \"msgRateExpired\" : 0.0,\r\n      \"consumers\" : [ {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"61f68\",\r\n        \"availablePermits\" : 1000,\r\n        \"unackedMessages\" : 0,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"metadata\" : {\r\n          \"instance_id\" : \"2\",\r\n          \"application\" : \"pulsar-function\",\r\n          \"id\" : \"public/default/generator-function\"\r\n        },\r\n        \"address\" : \"/127.0.0.1:64784\",\r\n        \"connectedSince\" : \"2019-04-25T13:27:56.892-07:00\",\r\n        \"clientVersion\" : \"2.4.0-SNAPSHOT\"\r\n      }, {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"d2505\",\r\n        \"availablePermits\" : 1000,\r\n        \"unackedMessages\" : 0,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"metadata\" : {\r\n          \"instance_id\" : \"4\",\r\n          \"application\" : \"pulsar-function\",\r\n          \"id\" : \"public/default/generator-function\"\r\n        },\r\n        \"address\" : \"/127.0.0.1:64784\",\r\n        \"connectedSince\" : \"2019-04-25T13:27:56.892-07:00\",\r\n        \"clientVersion\" : \"2.4.0-SNAPSHOT\"\r\n      } ]\r\n    }\r\n  },\r\n  \"replication\" : { },\r\n  \"deduplicationStatus\" : \"Disabled\"\r\n}\r\n\r\n```\r\n\r\nOnly 2 out of the 5 instances' consumers gets connected because 3 of the instances all have the same consumer object.\r\n\r\nThis creates big issues for functions.  In the worse case, I can have a function of N instances and only one of the instances gets data which I have observed happen personally.\r\n\r\nI propose we roll back these changes in the pulsar client.\r\n\r\nPerhaps @sijie @jiazhai @lovelle can comment since you guys implemented/approved the PRs related to this feature\r\n\r\n### How to recreate\r\n\r\n1. Configure functions to run in ThreadRuntime\r\n2. Submit function with multiple instances\r\n3. Check topics stats for number consumers\r\n4. Repeat above steps a couple of times and eventually you will see that the number of consumer for the topic be less the the number of instances for the function\r\n\r\n\r\nI have also recreated the issue by only using pulsar client and consumer:\r\n\r\nhttps://gist.github.com/jerrypeng/dba515c9748849dd4d51c2b5dbd865ed", "url": "https://github.com/apache/pulsar/issues/4137", "user": "jerrypeng", "labels": ["type/bug"], "created": "2019-04-25 22:44:48", "closed": "2019-06-18 01:03:28", "commits": {}, "ttf": 53.000277777777775, "commitsDetails": []}, {"title": "Warning: Nashorn engine is planned to be removed from a future JDK release", "body": "When using the latest `pulsar-admin` commands I get this message every time:\r\n```\r\nWarning: Nashorn engine is planned to be removed from a future JDK release\r\n```\r\n\r\nCan it be removed / ignored?", "url": "https://github.com/apache/pulsar/issues/4131", "user": "ruudk", "labels": ["triage/week-3", "type/bug"], "created": "2019-04-25 07:43:29", "closed": "2020-01-14 10:06:21", "commits": {}, "ttf": 264.0002777777778, "commitsDetails": []}, {"title": "Policies not found && ServiceNotReady", "body": "**Describe the bug**\r\n\r\npulsar 2.3.0\r\n\r\n1. When i produce or consumer the topic named `persistent://tenant/namespace1/topic1`,\r\npulsar returns the error `Policies not found for tenant/namespace1 namespace`. If the topic named `persistent://tenant/namespace1/ns/topic1`, it is fine.\r\n\r\n2. When I produce a message to a new topic(`persistent://tenant/namespace1/ns/topic1`), I must subscribe to this topic first. Otherwise I will get this error: ServiceNotReady: `Namespace bundle for topic (persistent://tenant/namespace1/ns/topic1) not served by this instance. Please redo the lookup. Request is denied: namespace=tenant/namespace1/ns`\r\n\r\n**Expected behavior**\r\n1.  The naming convention for topic, consistent with the document [doc](https://pulsar.apache.org/docs/zh-CN/next/concepts-messaging/#topics)\r\n\r\n2. If the client attempts to write or accept a message from a topic that does not yet exist, pulsar will automatically create\r\n", "url": "https://github.com/apache/pulsar/issues/4128", "user": "LvBay", "labels": ["type/bug"], "created": "2019-04-25 03:53:20", "closed": "2019-05-08 06:58:19", "commits": {}, "ttf": 13.000277777777777, "commitsDetails": []}, {"title": "Improve usage hints for pulsar-perf subcommands", "body": "**Describe the bug**\r\nWhen running the subcommands of `pulsar-perf` without any parameters someone may encounter as below:\r\n```\r\n$ bin/pulsar-perf managed-ledger\r\n...\r\nException in thread \"main\" java.lang.NullPointerException\r\n\tat com.google.common.base.Preconditions.checkNotNull(Preconditions.java:770)\r\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient$Builder.build(ZooKeeperClient.java:225)\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerFactoryImpl.<init>(ManagedLedgerFactoryImpl.java:104)\r\n\tat org.apache.pulsar.testclient.ManagedLedgerWriter.main(ManagedLedgerWriter.java:171)\r\n\r\n$ bin/pulsar-perf monitor-brokers\r\nException in thread \"main\" java.lang.RuntimeException: com.beust.jcommander.ParameterException: The following option is required: --connect-string\r\n\r\n$ bin/pulsar-perf read\r\nMain parameters are required (\"persistent://prop/ns/my-topic\")\r\nUsage: pulsar-perf-reader [options] persistent://prop/ns/my-topic \r\n```\r\nWe should optimize the description for better usage.\r\n", "url": "https://github.com/apache/pulsar/issues/4106", "user": "murong00", "labels": ["type/bug"], "created": "2019-04-23 06:39:42", "closed": "2019-04-24 04:37:25", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "[flaky unit test] testUnsupportedBatchMessageConsumer NullPointerException", "body": "**Describe the bug**\r\n\r\n```\r\n2019-04-22\\T\\03:52:53.868 [ERROR] testUnsupportedBatchMessageConsumer(org.apache.pulsar.client.impl.BrokerClientIntegrationTest)  Time elapsed: 1.36 s  <<< FAILURE!\r\njava.lang.NullPointerException\r\n\tat org.apache.pulsar.client.impl.BrokerClientIntegrationTest.testUnsupportedBatchMessageConsumer(BrokerClientIntegrationTest.java:382)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124)\r\n\tat org.testng.internal.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:54)\r\n\tat org.testng.internal.InvokeMethodRunnable.run(InvokeMethodRunnable.java:44)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nwhen i run java unit tests of Jenkins, there will always be some strange mistakes. In java unit tests of pulsar, there are a lot of test cases that use the same topicName, I was wondering if it is related to this reason? Because, when I go to run this test alone, it can run correctly.\r\n\r\n```\r\nfinal String topicName = \"persistent://my-property/my-ns/my-topic1\";\r\n```\r\n\r\n**Screenshots**\r\n\r\n![image](https://user-images.githubusercontent.com/20965307/56490763-de04fc80-6518-11e9-83e4-15335f905d7b.png)\r\n\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4099", "user": "wolfstudy", "labels": ["type/bug"], "created": "2019-04-22 08:09:00", "closed": "2019-07-11 06:08:43", "commits": {}, "ttf": 79.00027777777778, "commitsDetails": []}, {"title": "go client use Ctype_int as type _C type_ulong", "body": "**Describe the bug**\r\nWhen I use pulsar go client in ubuntu (windows subsystem), I install cpp client 2.3.1 and use go client tagged v2.3.1, but I got an error:\r\n`\r\n/home/chris/.gvm/pkgsets/go1.12.1/global/pkg/mod/github.com/kenorld/pulsar-client-go@v0.0.0-20190421093301-10f7ec0db253/pulsar/c_message.go:91:63: cannot use size (type _Ctype_int) as type _C\r\ntype_ulong in assignment\r\n`\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. download and install cpp client from official site.\r\n2. use go client in pulsar repository in tag 2.3.1\r\n3. run my app\r\n4. See error \r\n`\r\n/home/chris/.gvm/pkgsets/go1.12.1/global/pkg/mod/github.com/kenorld/pulsar-client-go@v0.0.0-20190421093301-10f7ec0db253/pulsar/c_message.go:91:63: cannot use size (type _Ctype_int) as type _C\r\ntype_ulong in assignment\r\n`\r\n\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/5874864/56470286-266bde00-6477-11e9-9ae1-b9536890d27d.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu installed in Windows 10 subsystem\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4095", "user": "chrislearn", "labels": ["type/bug"], "created": "2019-04-21 13:12:06", "closed": "2019-11-04 05:48:47", "commits": {}, "ttf": 196.00027777777777, "commitsDetails": []}, {"title": "Migrate ledgers,admin,bookies,managed-ledgers,namespace Zookeeper directories to pulsar", "body": "**Situation:**\r\nThis problem occurred when I tried to delete the metadata in Zookeeper. I found that Pulsar store the metadata in the root directory, such as `ledgers\u3001admin\u3001bookies\u3001managed-ledgers\u3001namespace`, this may lead to conflict with other middlewares and cause inappropriate operations, I think it is very dangerous.\r\nBesides, it is also very difficult to delete those metadata.\r\n\r\n**Expectation:**\r\n\r\n- Migrate those directories to `pulsar`\r\n- Provide a tool to delete metadata, it is very useful when deploying a cluster for a green hand.\r\n\r\n**Consideration:**\r\nOf course, a new zookeeper a cluster can avoid this problem, but it also means more costs, not every company is willing to accept.\r\n", "url": "https://github.com/apache/pulsar/issues/4078", "user": "RedBlackTreei", "labels": ["component/documentation", "type/bug"], "created": "2019-04-18 12:02:25", "closed": "2019-11-04 05:46:14", "commits": {}, "ttf": 199.00027777777777, "commitsDetails": []}, {"title": "Debezium postgres connector will hang when create snap", "body": "**Describe the bug**\r\nDebezium postgres connector will first create a snap for current table. And this step will hang if the table is too big.\r\n\r\n**To Reproduce**\r\n1. start pulsar standalone;\r\n2. start debezium pg server: \r\n> docker run --rm --name postgres -p 5432:5432 -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=postgres  debezium/example-postgres:0.8\r\n3. start a pg connect, and add 1 table with 10K lines: \r\n> docker  exec -it  postgres env PGOPTIONS=\"--search_path=inventory\" bash -c 'psql -U $POSTGRES_USER postgres'\r\n```\r\nCREATE TABLE inventory.test04 (\r\n id serial NOT NULL,\r\n col1 varchar(20) NOT NULL,\r\n i_time timestamp NULL DEFAULT now(),\r\n CONSTRAINT test04_pkey PRIMARY KEY (id)\r\n);\r\n\r\n CREATE OR REPLACE FUNCTION public.insert_test04(x integer)\r\n RETURNS void\r\n LANGUAGE plpgsql\r\nAS $function$\r\n\r\ndeclare i int;\r\nlater time;\r\nthetime time; \r\n\r\nbegin\r\n\r\ni:=1; \r\n\r\nfor i in 1..x loop \r\n\r\ninsert into test04(col1, i_time) values( repeat( chr(int4(random()*26)+65),(random()*(2^2))::integer), now()); \r\n\r\n\r\ni = i+1;\r\n\r\nend loop; \r\n\r\nend;  -- end function\r\n\r\n$function$\r\n;\r\nselect public.insert_test04(10000);\r\n\r\n```\r\n4. using current default config of debezium [pg config](https://github.com/apache/pulsar/tree/master/pulsar-io/debezium/postgres/src/main/resources)\r\n, start debezium local run it will hang when create snapshot.\r\n> bin/pulsar-admin source localrun  --sourceConfigFile debezium-postgres-source-config.yaml\r\n\r\n\r\n**Other information**\r\nthis is hang in this stack:\r\n```\r\n \"public/default/debezium-postgres-source-0\" #18 prio=5 os_prio=31 tid=0x00007fd83096f800 nid=0xa403 waiting on condition [0x000070000f534000]\r\n    java.lang.Thread.State: WAITING (parking)\r\n     at sun.misc.Unsafe.park(Native Method)\r\n     - parking to wait for  <0x00000007ab025a58> (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)\r\n     at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\r\n     at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)\r\n     at java.util.concurrent.LinkedBlockingDeque.putLast(LinkedBlockingDeque.java:396)\r\n     at java.util.concurrent.LinkedBlockingDeque.put(LinkedBlockingDeque.java:649)\r\n     at io.debezium.connector.base.ChangeEventQueue.enqueue(ChangeEventQueue.java:132)\r\n     at io.debezium.connector.postgresql.PostgresConnectorTask$$Lambda$203/385424085.accept(Unknown Source)\r\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer.sendCurrentRecord(RecordsSnapshotProducer.java:402)\r\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer.readTable(RecordsSnapshotProducer.java:321)\r\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer.lambda$takeSnapshot$6(RecordsSnapshotProducer.java:226)\r\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer$$Lambda$240/1347039967.accept(Unknown Source)\r\n     at io.debezium.jdbc.JdbcConnection.queryWithBlockingConsumer(JdbcConnection.java:535)\r\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer.takeSnapshot(RecordsSnapshotProducer.java:224)\r\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer.lambda$start$0(RecordsSnapshotProducer.java:87)\r\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer$$Lambda$206/589332928.run(Unknown Source)\r\n     at java.util.concurrent.CompletableFuture.uniRun(CompletableFuture.java:705)\r\n     at java.util.concurrent.CompletableFuture.uniRunStage(CompletableFuture.java:717)\r\n     at java.util.concurrent.CompletableFuture.thenRun(CompletableFuture.java:2010)\r\n     at io.debezium.connector.postgresql.RecordsSnapshotProducer.start(RecordsSnapshotProducer.java:87)\r\n     at io.debezium.connector.postgresql.PostgresConnectorTask.start(PostgresConnectorTask.java:126)\r\n     at io.debezium.connector.common.BaseSourceTask.start(BaseSourceTask.java:47)\r\n     at org.apache.pulsar.io.kafka.connect.KafkaConnectSource.open(KafkaConnectSource.java:127)\r\n     at org.apache.pulsar.io.debezium.DebeziumSource.open(DebeziumSource.java:100)\r\n     at org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupInput(JavaInstanceRunnable.java:690)\r\n     at org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupJavaInstance(JavaInstanceRunnable.java:200)\r\n     at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:230)\r\n     at java.lang.Thread.run(Thread.java:748)\r\n```\r\nAnd the default value for the block queue is: \r\n> public static final int DEFAULT_MAX_QUEUE_SIZE = 8192; <== which is smaller than 10K\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4075", "user": "jiazhai", "labels": ["component/io", "triage/week-44", "type/bug"], "created": "2019-04-18 06:52:51", "closed": "2020-01-03 04:12:16", "commits": {"cff311c264430e0490a158c442eed3c9b1b2521a": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 259.0002777777778, "commitsDetails": [{"commitHash": "cff311c264430e0490a158c442eed3c9b1b2521a", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["d98562dbedf1bfce31aa42fe9e823d129a95fb39"], "nameRev": "cff311c264430e0490a158c442eed3c9b1b2521a tags/v2.5.0-candidate-2~8", "commitMessage": "Update document for debezium (#5973)\n\nFixes #4075\r\n\r\nMotivation\r\nDebezium Postgres connector will first create a snap for the current table. And this step will hang if the table is too big.\r\n\r\nModifications\r\nAdd an introduction to parameter max.queue.size\r\nVerifying this change\r\nIntegration tests\r\nyarn build", "commitDateTime": "2020-01-03 12:12:16", "authoredDateTime": "2020-01-03 12:12:16", "commitGitStats": [{"filePath": "site2/docs/io-cdc-debezium.md", "insertions": 44, "deletions": 1, "lines": 45}, {"filePath": "site2/docs/io-debezium-source.md", "insertions": 43, "deletions": 0, "lines": 43}, {"filePath": "site2/website/versioned_docs/version-2.3.0/io-cdc-debezium.md", "insertions": 44, "deletions": 1, "lines": 45}, {"filePath": "site2/website/versioned_docs/version-2.4.0/io-cdc-debezium.md", "insertions": 43, "deletions": 0, "lines": 43}, {"filePath": "site2/website/versioned_docs/version-2.4.1/io-cdc-debezium.md", "insertions": 43, "deletions": 0, "lines": 43}, {"filePath": "site2/website/versioned_docs/version-2.4.2/io-cdc-debezium.md", "insertions": 44, "deletions": 0, "lines": 44}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "update debezium connector documentation", "body": "After move it out of Kafka-connect-source, debezium connector documentation need some update. \r\nMay need provide doc for debezium postgres connector, and update debezium mysql connector", "url": "https://github.com/apache/pulsar/issues/4074", "user": "jiazhai", "labels": ["component/documentation", "help wanted", "type/bug"], "created": "2019-04-18 06:40:37", "closed": "2019-05-22 00:12:44", "commits": {"0d700a9d436d6c10804dfa90dd3620696b84b8da": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "ef834ae8e60f0707ba10b2852d2e56a46d30a13f": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 33.000277777777775, "commitsDetails": [{"commitHash": "0d700a9d436d6c10804dfa90dd3620696b84b8da", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["5556f1b7e01040bd78c7e7736383812eb12217ad"], "nameRev": "0d700a9d436d6c10804dfa90dd3620696b84b8da tags/v2.4.0-candidate-1~170", "commitMessage": "[issue 4074][pulsar-io]debezium document udpate (#4296)\n\nFixes #4074\r\n\r\nMaster Issue: #4074\r\n\r\n### Motivation\r\n\r\nAfter move it out of Kafka-connect-source, debezium connector documentation need some update.\r\nUpdate debezium mysql connector.\r\n\r\n### Modifications\r\n\r\nMove kafka-connect-adaptor to debezium-mysql\r\n", "commitDateTime": "2019-05-22 08:12:43", "authoredDateTime": "2019-05-22 08:12:43", "commitGitStats": [{"filePath": "site2/docs/io-cdc-debezium.md", "insertions": 3, "deletions": 3, "lines": 6}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "ef834ae8e60f0707ba10b2852d2e56a46d30a13f", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["e7162732a9806f6702ca0610ffead7e8cedc958f"], "nameRev": "ef834ae8e60f0707ba10b2852d2e56a46d30a13f tags/v2.4.0-candidate-1~79", "commitMessage": "[issue #4074][pulsar-io]Update document of PostgreSQL for debezium (#4376)\n\nFixes #4074\r\n\r\nMaster Issue: #4074 \r\n\r\n### Motivation\r\nThere is currently a lack of documentation on PostgreSQL. Therefore, some useful documents about PostgreSQL are added.\r\n\r\n### Modifications\r\nUpdate document of PostgreSQL for debezium", "commitDateTime": "2019-06-04 23:03:29", "authoredDateTime": "2019-06-05 14:03:29", "commitGitStats": [{"filePath": "site2/docs/io-cdc-debezium.md", "insertions": 186, "deletions": 64, "lines": 250}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 2, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Add Document for jdbc sink connector ", "body": "Add Document for jdbc sink connector ", "url": "https://github.com/apache/pulsar/issues/4073", "user": "jiazhai", "labels": ["component/documentation", "type/bug"], "created": "2019-04-18 06:37:45", "closed": "2019-05-26 09:24:17", "commits": {"7924846211e7796f4b17529353380e2e85664bf4": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "7d2141b92d28117bee05499caca4c7a27839d025": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "6c6fbfd43994a124ce39da4811049c7aedc47f08": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 38.000277777777775, "commitsDetails": [{"commitHash": "7924846211e7796f4b17529353380e2e85664bf4", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["ddb100a6e0dc81f5c5db6624c855d93851e51b5a"], "nameRev": "7924846211e7796f4b17529353380e2e85664bf4 tags/v2.4.0-candidate-1~148", "commitMessage": "[Doc] Add *Connect Pulsar to MySQL* (#4338)\n\nFix #4073", "commitDateTime": "2019-05-26 17:24:16", "authoredDateTime": "2019-05-26 17:24:16", "commitGitStats": [{"filePath": "site2/docs/functions-api.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/docs/functions-quickstart.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/docs/io-quickstart.md", "insertions": 466, "deletions": 104, "lines": 570}, {"filePath": "site2/docs/sql-getting-started.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/website/sidebars.json", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "7d2141b92d28117bee05499caca4c7a27839d025", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["99d3c11ec551dccbf85fbb77e268e1a97f3a806c"], "nameRev": "7d2141b92d28117bee05499caca4c7a27839d025 tags/v2.5.0-candidate-1~575", "commitMessage": "[pulsar-io][jdbc sink]Support delete and update event for JDBC Sink (#4358)\n\n### Motivation\r\n\r\nCurrently our JDBC Sink not support deletion and update events.\r\nSupport for delete and update events.\r\n\r\n### Modifications\r\n\r\nSupport for delete and update events.\r\nAdd some document for JDBC Sink. https://github.com/apache/pulsar/issues/4073\r\n\r\n### Verifying this change\r\n\r\nlocal Unit Test pass.\r\nIntegration test pass", "commitDateTime": "2019-07-07 12:04:11", "authoredDateTime": "2019-07-08 00:04:11", "commitGitStats": [{"filePath": "pulsar-io/jdbc/src/main/java/org/apache/pulsar/io/jdbc/JdbcAbstractSink.java", "insertions": 53, "deletions": 22, "lines": 75}, {"filePath": "pulsar-io/jdbc/src/main/java/org/apache/pulsar/io/jdbc/JdbcAutoSchemaSink.java", "insertions": 16, "deletions": 5, "lines": 21}, {"filePath": "pulsar-io/jdbc/src/main/java/org/apache/pulsar/io/jdbc/JdbcSinkConfig.java", "insertions": 13, "deletions": 1, "lines": 14}, {"filePath": "pulsar-io/jdbc/src/main/java/org/apache/pulsar/io/jdbc/JdbcUtils.java", "insertions": 96, "deletions": 4, "lines": 100}, {"filePath": "pulsar-io/jdbc/src/test/java/org/apache/pulsar/io/jdbc/JdbcSinkTest.java", "insertions": 146, "deletions": 45, "lines": 191}, {"filePath": "pulsar-io/jdbc/src/test/java/org/apache/pulsar/io/jdbc/JdbcUtilsTest.java", "insertions": 31, "deletions": 5, "lines": 36}, {"filePath": "site2/docs/io-connectors.md", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "site2/docs/io-jdbc.md", "insertions": 23, "deletions": 0, "lines": 23}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTest.java", "insertions": 107, "deletions": 12, "lines": 119}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/JdbcSinkTester.java", "insertions": 9, "deletions": 3, "lines": 12}], "commitSpoonAstDiffStats": [{"spoonFilePath": "JdbcAbstractSink.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAbstractSink.open(java.util.Map,org.apache.pulsar.io.core.SinkContext)", "TOT": 8, "UPD": 1, "INS": 1, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAbstractSink.flush()", "TOT": 32, "UPD": 8, "INS": 5, "MOV": 14, "DEL": 5}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAbstractSink.write(org.apache.pulsar.functions.api.Record)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAbstractSink", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAbstractSink.initStatement()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAbstractSink.bindValue(java.sql.PreparedStatement,org.apache.pulsar.functions.api.Record,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JdbcAutoSchemaSink.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAutoSchemaSink", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAutoSchemaSink.bindValue(java.sql.PreparedStatement,org.apache.pulsar.functions.api.Record)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAutoSchemaSink.bindValue(java.sql.PreparedStatement,org.apache.pulsar.functions.api.Record,java.lang.String)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JdbcSinkConfig.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkConfig", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JdbcUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.buildInsertSql(org.apache.pulsar.io.jdbc.JdbcUtils$TableDefinition)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.TableDefinition", "TOT": 6, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.combationWhere(java.util.List)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.buildUpdateSql(org.apache.pulsar.io.jdbc.JdbcUtils$TableDefinition)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.buildUpdateStatement(java.sql.Connection,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.buildDeleteSql(org.apache.pulsar.io.jdbc.JdbcUtils$TableDefinition)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.buildDeleteStatement(java.sql.Connection,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.TableDefinition.of(org.apache.pulsar.io.jdbc.JdbcUtils$TableId,java.util.List)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.TableDefinition.of(org.apache.pulsar.io.jdbc.JdbcUtils$TableId,java.util.List,java.util.List,java.util.List)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.getTableDefinition(java.sql.Connection,org.apache.pulsar.io.jdbc.JdbcUtils$TableId,java.util.List,java.util.List)", "TOT": 8, "UPD": 0, "INS": 8, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.getTableDefinition(java.sql.Connection,org.apache.pulsar.io.jdbc.JdbcUtils$TableId)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "JdbcSinkTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkTest", "TOT": 3, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkTest.TestOpenAndWriteSink()", "TOT": 81, "UPD": 31, "INS": 3, "MOV": 40, "DEL": 7}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkTest.TestUpdateAction()", "TOT": 11, "UPD": 0, "INS": 11, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkTest.TestDeleteAction()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkTest.setUp()", "TOT": 12, "UPD": 0, "INS": 11, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkTest.tearDown()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JdbcUtilsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtilsTest.TestGetTableId()", "TOT": 28, "UPD": 4, "INS": 24, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarFunctionsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.produceSchemaMessagesToInputTopic(java.lang.String,int,org.apache.pulsar.client.api.Schema)", "TOT": 4, "UPD": 3, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.runSinkTester(org.apache.pulsar.tests.integration.io.SinkTester,boolean)", "TOT": 11, "UPD": 1, "INS": 8, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.produceSchemaUpdateMessagesToInputTopic(java.lang.String,int,org.apache.pulsar.client.api.Schema)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.produceSchemaDeleteMessagesToInputTopic(java.lang.String,int,org.apache.pulsar.client.api.Schema)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.produceSchemaInsertMessagesToInputTopic(java.lang.String,int,org.apache.pulsar.client.api.Schema)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JdbcSinkTester.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.io.JdbcSinkTester", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.JdbcSinkTester.validateSinkResult(java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "6c6fbfd43994a124ce39da4811049c7aedc47f08", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["cb486966ffcdfd3038d2c22791afcdd79e1f0995"], "nameRev": "6c6fbfd43994a124ce39da4811049c7aedc47f08 tags/v2.4.1-candidate-1~42", "commitMessage": "[pulsar-io][jdbc sink]Support delete and update event for JDBC Sink (#4358)\n\n### Motivation\r\n\r\nCurrently our JDBC Sink not support deletion and update events.\r\nSupport for delete and update events.\r\n\r\n### Modifications\r\n\r\nSupport for delete and update events.\r\nAdd some document for JDBC Sink. https://github.com/apache/pulsar/issues/4073\r\n\r\n### Verifying this change\r\n\r\nlocal Unit Test pass.\r\nIntegration test pass", "commitDateTime": "2019-08-28 11:07:08", "authoredDateTime": "2019-07-08 00:04:11", "commitGitStats": [{"filePath": "pulsar-io/jdbc/src/main/java/org/apache/pulsar/io/jdbc/JdbcAbstractSink.java", "insertions": 53, "deletions": 22, "lines": 75}, {"filePath": "pulsar-io/jdbc/src/main/java/org/apache/pulsar/io/jdbc/JdbcAutoSchemaSink.java", "insertions": 16, "deletions": 5, "lines": 21}, {"filePath": "pulsar-io/jdbc/src/main/java/org/apache/pulsar/io/jdbc/JdbcSinkConfig.java", "insertions": 13, "deletions": 1, "lines": 14}, {"filePath": "pulsar-io/jdbc/src/main/java/org/apache/pulsar/io/jdbc/JdbcUtils.java", "insertions": 96, "deletions": 4, "lines": 100}, {"filePath": "pulsar-io/jdbc/src/test/java/org/apache/pulsar/io/jdbc/JdbcSinkTest.java", "insertions": 146, "deletions": 45, "lines": 191}, {"filePath": "pulsar-io/jdbc/src/test/java/org/apache/pulsar/io/jdbc/JdbcUtilsTest.java", "insertions": 31, "deletions": 5, "lines": 36}, {"filePath": "site2/docs/io-connectors.md", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "site2/docs/io-jdbc.md", "insertions": 23, "deletions": 0, "lines": 23}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTest.java", "insertions": 107, "deletions": 12, "lines": 119}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/JdbcSinkTester.java", "insertions": 9, "deletions": 3, "lines": 12}], "commitSpoonAstDiffStats": [{"spoonFilePath": "JdbcAbstractSink.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAbstractSink.open(java.util.Map,org.apache.pulsar.io.core.SinkContext)", "TOT": 8, "UPD": 1, "INS": 1, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAbstractSink.flush()", "TOT": 32, "UPD": 8, "INS": 5, "MOV": 14, "DEL": 5}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAbstractSink.write(org.apache.pulsar.functions.api.Record)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAbstractSink", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAbstractSink.initStatement()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAbstractSink.bindValue(java.sql.PreparedStatement,org.apache.pulsar.functions.api.Record,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JdbcAutoSchemaSink.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAutoSchemaSink", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAutoSchemaSink.bindValue(java.sql.PreparedStatement,org.apache.pulsar.functions.api.Record)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcAutoSchemaSink.bindValue(java.sql.PreparedStatement,org.apache.pulsar.functions.api.Record,java.lang.String)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JdbcSinkConfig.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkConfig", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JdbcUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.buildInsertSql(org.apache.pulsar.io.jdbc.JdbcUtils$TableDefinition)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.TableDefinition", "TOT": 6, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.combationWhere(java.util.List)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.buildUpdateSql(org.apache.pulsar.io.jdbc.JdbcUtils$TableDefinition)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.buildUpdateStatement(java.sql.Connection,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.buildDeleteSql(org.apache.pulsar.io.jdbc.JdbcUtils$TableDefinition)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.buildDeleteStatement(java.sql.Connection,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.TableDefinition.of(org.apache.pulsar.io.jdbc.JdbcUtils$TableId,java.util.List)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.TableDefinition.of(org.apache.pulsar.io.jdbc.JdbcUtils$TableId,java.util.List,java.util.List,java.util.List)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.getTableDefinition(java.sql.Connection,org.apache.pulsar.io.jdbc.JdbcUtils$TableId,java.util.List,java.util.List)", "TOT": 8, "UPD": 0, "INS": 8, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtils.getTableDefinition(java.sql.Connection,org.apache.pulsar.io.jdbc.JdbcUtils$TableId)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "JdbcSinkTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkTest", "TOT": 3, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkTest.TestOpenAndWriteSink()", "TOT": 81, "UPD": 31, "INS": 3, "MOV": 40, "DEL": 7}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkTest.TestUpdateAction()", "TOT": 11, "UPD": 0, "INS": 11, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkTest.TestDeleteAction()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkTest.setUp()", "TOT": 12, "UPD": 0, "INS": 11, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcSinkTest.tearDown()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JdbcUtilsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.jdbc.JdbcUtilsTest.TestGetTableId()", "TOT": 28, "UPD": 4, "INS": 24, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarFunctionsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.produceSchemaMessagesToInputTopic(java.lang.String,int,org.apache.pulsar.client.api.Schema)", "TOT": 4, "UPD": 3, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.runSinkTester(org.apache.pulsar.tests.integration.io.SinkTester,boolean)", "TOT": 11, "UPD": 1, "INS": 8, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.produceSchemaUpdateMessagesToInputTopic(java.lang.String,int,org.apache.pulsar.client.api.Schema)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.produceSchemaDeleteMessagesToInputTopic(java.lang.String,int,org.apache.pulsar.client.api.Schema)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.functions.PulsarFunctionsTest.produceSchemaInsertMessagesToInputTopic(java.lang.String,int,org.apache.pulsar.client.api.Schema)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "JdbcSinkTester.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.io.JdbcSinkTester", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.io.JdbcSinkTester.validateSinkResult(java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["7d2141b92d28117bee05499caca4c7a27839d025"], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 178, "deletions": 32, "lines": 210, "gitFilesChange": 4}, "spoonStatsSummary": {"TOT": 83.0, "UPD": 12.0, "INS": 40.0, "MOV": 21.0, "DEL": 10.0, "spoonFilesChanged": 4, "spoonMethodsChanged": 21}, "statsSkippedReason": "", "changesInPackagesGIT": ["pulsar-io/jdbc/src/main/java/org/apache/pulsar/io/jdbc"], "changesInPackagesSPOON": ["org.apache.pulsar.io.jdbc.JdbcAutoSchemaSink.bindValue(java.sql.PreparedStatement,org.apache.pulsar.functions.api.Record)", "org.apache.pulsar.io.jdbc.JdbcAbstractSink.initStatement()", "org.apache.pulsar.io.jdbc.JdbcUtils.buildDeleteSql(org.apache.pulsar.io.jdbc.JdbcUtils$TableDefinition)", "org.apache.pulsar.io.jdbc.JdbcAbstractSink.write(org.apache.pulsar.functions.api.Record)", "org.apache.pulsar.io.jdbc.JdbcUtils.buildInsertSql(org.apache.pulsar.io.jdbc.JdbcUtils$TableDefinition)", "org.apache.pulsar.io.jdbc.JdbcUtils.combationWhere(java.util.List)", "org.apache.pulsar.io.jdbc.JdbcUtils.getTableDefinition(java.sql.Connection,org.apache.pulsar.io.jdbc.JdbcUtils$TableId,java.util.List,java.util.List)", "org.apache.pulsar.io.jdbc.JdbcAbstractSink.open(java.util.Map,org.apache.pulsar.io.core.SinkContext)", "org.apache.pulsar.io.jdbc.JdbcAbstractSink", "org.apache.pulsar.io.jdbc.JdbcAbstractSink.flush()", "org.apache.pulsar.io.jdbc.JdbcUtils.buildUpdateStatement(java.sql.Connection,java.lang.String)", "org.apache.pulsar.io.jdbc.JdbcAutoSchemaSink.bindValue(java.sql.PreparedStatement,org.apache.pulsar.functions.api.Record,java.lang.String)", "org.apache.pulsar.io.jdbc.JdbcAbstractSink.bindValue(java.sql.PreparedStatement,org.apache.pulsar.functions.api.Record,java.lang.String)", "org.apache.pulsar.io.jdbc.JdbcUtils.TableDefinition.of(org.apache.pulsar.io.jdbc.JdbcUtils$TableId,java.util.List,java.util.List,java.util.List)", "org.apache.pulsar.io.jdbc.JdbcUtils.buildUpdateSql(org.apache.pulsar.io.jdbc.JdbcUtils$TableDefinition)", "org.apache.pulsar.io.jdbc.JdbcUtils.TableDefinition.of(org.apache.pulsar.io.jdbc.JdbcUtils$TableId,java.util.List)", "org.apache.pulsar.io.jdbc.JdbcSinkConfig", "org.apache.pulsar.io.jdbc.JdbcUtils.getTableDefinition(java.sql.Connection,org.apache.pulsar.io.jdbc.JdbcUtils$TableId)", "org.apache.pulsar.io.jdbc.JdbcUtils.TableDefinition", "org.apache.pulsar.io.jdbc.JdbcUtils.buildDeleteStatement(java.sql.Connection,java.lang.String)", "org.apache.pulsar.io.jdbc.JdbcAutoSchemaSink"]}, {"title": "Exception in bookie when Function state enabled", "body": "**Describe the bug**\r\n\r\nThese exception are thrown in bookies when function state is enabled.  Seems like there is something wrong with table service.  May have something to do with uploading large files for functions.\r\n\r\n\r\n```\r\n05:26:27.202 [io-write-scheduler-OrderedScheduler-1-0] ERROR org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore - Failed to open rocksdb at dir /streamlio/pulsar/data/bookkeeper/ranges/ranges/000000000000000010/000000000000000001/000000000000000000\r\norg.rocksdb.RocksDBException: While lock file: /streamlio/pulsar/data/bookkeeper/ranges/ranges/000000000000000010/000000000000000001/000000000000000000/current/LOCK: No locks available\r\n    at org.rocksdb.RocksDB.open(Native Method) ~[org.rocksdb-rocksdbjni-5.13.3.jar:?]\r\n    at org.rocksdb.RocksDB.open(RocksDB.java:286) ~[org.rocksdb-rocksdbjni-5.13.3.jar:?]\r\n    at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.openRocksdb(RocksdbKVStore.java:323) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.openLocalDB(RocksdbKVStore.java:298) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.openRocksdb(RocksdbKVStore.java:288) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.init(RocksdbKVStore.java:233) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$initializeLocalStore$5(AbstractStateStoreWithJournal.java:202) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$executeIO$16(AbstractStateStoreWithJournal.java:471) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_212]\r\n    at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:111) [com.google.guava-guava-21.0.jar:?]\r\n    at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:58) [com.google.guava-guava-21.0.jar:?]\r\n    at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:75) [com.google.guava-guava-21.0.jar:?]\r\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_212]\r\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_212]\r\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_212]\r\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [?:1.8.0_212]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\n05:26:27.202 [io-write-scheduler-OrderedScheduler-1-0] WARN  org.apache.bookkeeper.stream.storage.impl.sc.StorageContainerRegistryImpl - De-registered StorageContainer ('10') when failed to start\r\njava.util.concurrent.CompletionException: org.apache.bookkeeper.statelib.api.exceptions.StateStoreException: org.rocksdb.RocksDBException: While lock file: /streamlio/pulsar/data/bookkeeper/ranges/ranges/000000000000000010/000000000000000001/000000000000000000/current/LOCK: No locks available\r\n    at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292) ~[?:1.8.0_212]\r\n    at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308) ~[?:1.8.0_212]\r\n    at java.util.concurrent.CompletableFuture.uniCompose(CompletableFuture.java:943) ~[?:1.8.0_212]\r\n    at java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:926) ~[?:1.8.0_212]\r\n    at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_212]\r\n    at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_212]\r\n    at org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$executeIO$16(AbstractStateStoreWithJournal.java:474) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_212]\r\n    at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:111) [com.google.guava-guava-21.0.jar:?]\r\n    at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:58) [com.google.guava-guava-21.0.jar:?]\r\n    at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:75) [com.google.guava-guava-21.0.jar:?]\r\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_212]\r\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_212]\r\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_212]\r\n    at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [?:1.8.0_212]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_212]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_212]\r\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\r\nCaused by: org.apache.bookkeeper.statelib.api.exceptions.StateStoreException: org.rocksdb.RocksDBException: While lock file: /streamlio/pulsar/data/bookkeeper/ranges/ranges/000000000000000010/000000000000000001/000000000000000000/current/LOCK: No locks available\r\n    at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.openRocksdb(RocksdbKVStore.java:334) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.openLocalDB(RocksdbKVStore.java:298) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.openRocksdb(RocksdbKVStore.java:288) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.init(RocksdbKVStore.java:233) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$initializeLocalStore$5(AbstractStateStoreWithJournal.java:202) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$executeIO$16(AbstractStateStoreWithJournal.java:471) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    ... 12 more\r\nCaused by: org.rocksdb.RocksDBException: While lock file: /streamlio/pulsar/data/bookkeeper/ranges/ranges/000000000000000010/000000000000000001/000000000000000000/current/LOCK: No locks available\r\n    at org.rocksdb.RocksDB.open(Native Method) ~[org.rocksdb-rocksdbjni-5.13.3.jar:?]\r\n    at org.rocksdb.RocksDB.open(RocksDB.java:286) ~[org.rocksdb-rocksdbjni-5.13.3.jar:?]\r\n    at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.openRocksdb(RocksdbKVStore.java:323) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.openLocalDB(RocksdbKVStore.java:298) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.openRocksdb(RocksdbKVStore.java:288) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.init(RocksdbKVStore.java:233) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$initializeLocalStore$5(AbstractStateStoreWithJournal.java:202) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    at org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$executeIO$16(AbstractStateStoreWithJournal.java:471) ~[org.apache.bookkeeper-statelib-4.9.1-streamlio-2.jar:4.9.1-streamlio-2]\r\n    ... 12 more\r\n```\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4072", "user": "jerrypeng", "labels": ["component/functions", "type/bug"], "created": "2019-04-18 06:00:58", "closed": "2019-11-04 05:43:43", "commits": {}, "ttf": 199.00027777777777, "commitsDetails": []}, {"title": "[pulsar-client-cpp] Deadlock when closing the pulsar Client", "body": "**Describe the bug**\r\nThere is a consistent deadlock when closing an instance of pulsar::Client if there is an active Consumer subscription. This is caused by the ExecutorService worker thread attempting to join() itself when a message is received from the broker that signals the Consumer is closed. The deadlock is not apparent on Unix because in the case of a thread joining itself, pthread_join returns the error code EDEADLK and continues execution.\r\n\r\n**To Reproduce**\r\nCreate a simple test app that does any action on a Consumer subscription. Here is what my test app does...\r\n1. Create a pulsar::Client instance that connects to a broker with existing messages on a topic (e.g. \"test_topic\").\r\n2. Subscribe to \"test_topic\" and seek to earliest message.\r\n3. receive() and acknowledge() at least one message.\r\n4. Close the client ( client.close() ).\r\n5. Deadlock. \r\n\r\nMost likely the only way to confirm this deadlock on Linux is to step into the call to worker_.join() within ExecutorService::close() after client.close() has been called. Then you will see the EDEADLK error code being returned from pthread_join()\r\n\r\n**Expected behavior**\r\nThe expectation is that closing the pulsar::Client does not result in a deadlocked thread.\r\n\r\n**Desktop:**\r\n- Ubuntu 18.04\r\n- Windows 10\r\nI encountered this on my fork where I made pulsar-client-cpp compile for Windows, but it occurs on Ubuntu as well with the caveat that execution continues after pthread.join() returns the EDEADLK error thus hiding the problem. \r\n\r\n**Additional context**\r\nI have attached a text file with the callstack observed. \r\n[DeadlockStack.txt](https://github.com/apache/pulsar/files/3092736/DeadlockStack.txt)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4070", "user": "heronr", "labels": ["component/c++", "component/client", "triage/week-44", "type/bug"], "created": "2019-04-18 04:23:40", "closed": "2020-02-14 01:14:40", "commits": {}, "ttf": 301.0002777777778, "commitsDetails": []}, {"title": "Security Vulnerabilities - Black Duck Scan - Pulsar v.2.3.1", "body": "## Issue\r\nBlack Duck, a product by Synopsys that scans for open source security threats, uncovered a few issues with dependencies for the Pulsar 2.3.1 binaries. Just posting the results here to make the community aware for future releases, I know this stuff is like a moving target.\r\n\r\n ### Apache Commons Compress - 1.15\r\n- CVE-2018-11771\r\n- CVE-2018-1324\r\n\r\n### Apache Maven 2 - 3.0.4\r\n- CVE-2013-0253\r\n- CVE-2016-4469\r\n- CVE-2016-5005\r\n- CVE-2017-5657\r\n\r\n### AsyncHttpClient - 1.6.5\r\n- CVE-2013-7397\r\n- CVE-2013-7398\r\n\r\n### Guava: Google Core Libraries for Java - 21.0\r\n- CVE-2018-10237\r\n\r\n### Guava: Google Core Libraries for Java - 24.1-jre\r\n- CVE-2018-10237\r\n\r\n### jackson-databind - 2.8.11.3\r\n- CVE-2018-1000873\r\n- CVE-2018-14719\r\n- CVE-2018-14720\r\n- CVE-2018-14721\r\n- CVE-2018-19360\r\n- CVE-2018-19361\r\n- CVE-2018-19362\r\n\r\n### Jetty: Java based HTTP, Servlet, SPDY, WebSocket Server - 9.4.11.v20180605\r\n- CVE-2017-9735\r\n- CVE-2018-12545\r\n\r\n### jQuery - 2.2.3\r\n- CVE-2011-4969\r\n\r\n### jQuery UI - 1.11.4\r\n- CVE-2016-7103\r\n\r\n### Netty Project - 3.10.1.Final\r\n- CVE-2015-2156\r\n\r\n### Netty Project - 3.6.2.Final\r\n- CVE-2015-2156\r\n- CVE-2014-0193\r\n\r\nIt looks like upgrading to the latest versions of each of these dependencies might patch things, but I am not certain.\r\n\r\nThanks!", "url": "https://github.com/apache/pulsar/issues/4057", "user": "one70six", "labels": ["component/security", "type/bug"], "created": "2019-04-16 14:54:45", "closed": "2019-10-31 06:38:28", "commits": {}, "ttf": 197.00027777777777, "commitsDetails": []}, {"title": "Download lastest version in old version page", "body": "https://pulsar.apache.org/docs/en/2.2.0/client-libraries-cpp/\r\nWhen I clicked `deb cpp client` link in old version page,  I downloaded latest version of client.\r\nIs that mistake?\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4053", "user": "k2la", "labels": ["component/documentation", "component/website", "help wanted", "triage/week-44", "type/bug"], "created": "2019-04-16 03:53:21", "closed": "2020-01-14 16:51:05", "commits": {}, "ttf": 273.0002777777778, "commitsDetails": []}, {"title": "Need to catch up docs for functions/sink/source in Admin CLI", "body": "**Describe the bug**\r\nSome of the subcommands of functions/sink/source are not documented in [Pulsar admin CLI](http://pulsar.apache.org/docs/en/pulsar-admin/), such as `sink/source status`. We need update the doc to catch up the work.", "url": "https://github.com/apache/pulsar/issues/4047", "user": "murong00", "labels": ["type/bug"], "created": "2019-04-15 09:54:30", "closed": "2019-04-16 08:22:25", "commits": {"d72079d0ffe73c975bd92344d21646882c2a7c16": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "d72079d0ffe73c975bd92344d21646882c2a7c16", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["76aacd3c3477342d9cb6709098cd4a2724b78f77"], "nameRev": "d72079d0ffe73c975bd92344d21646882c2a7c16 tags/v2.4.0-candidate-1~330", "commitMessage": "[Issue 4047] Catch up docs for functions/sink/source in Admin CLI (#4048)\n\n### Motivation\r\n\r\nFixes #4047\r\n\r\n### Modifications\r\n\r\nAdd the missing doc for functions/sink/source and some minor updates.", "commitDateTime": "2019-04-16 16:22:24", "authoredDateTime": "2019-04-16 16:22:24", "commitGitStats": [{"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdFunctions.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdSinks.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/docs/reference-pulsar-admin.md", "insertions": 454, "deletions": 160, "lines": 614}], "commitSpoonAstDiffStats": [{"spoonFilePath": "CmdFunctions.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdFunctions.FunctionDetailsCommand", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.admin.cli.CmdFunctions.GetFunctionStats", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CmdSinks.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdSinks.SinkDetailsCommand", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Pulsar Dashboard Displays Very Little Information", "body": "**Describe the bug**\r\n\r\nThe pulsar-dashboard does not display the information published by the pulsar cluster.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Install a [bare metal pulsar](https://pulsar.apache.org/docs/en/deploy-bare-metal/)\r\n    1. on an openstack cloud\r\n    2. rather than a DNS server distribute identical /etc/hosts files to each of the vm's and the development machine\r\n    2. 3 zookeeper each on their own vm\r\n    3. 3 bookie/broker each pair on their own vm\r\n2. On the development machine: Git [clone the pulsar](https://github.com/apache/pulsar/tree/v2.3.0)\r\n    1. build the docker image : docker build -t apachepulsar/pulsar-dashboard dashboard\r\n    2: export SERVICE_URL=http://ledge2:8080/\r\n    3: docker run -p 80:80   -e SERVICE_URL=$SERVICE_URL   apachepulsar/pulsar-dashboard\r\n3. Construct a \r\n    1. single tenant \r\n    2. several namespaces\r\n    3. several topics\r\n\r\n**Expected behavior**\r\nThe pulsar-dashboard should show clusters, tenants, namespaces, etc.\r\n\r\n**Screenshots**\r\nThe pulsar  http server shows the presence of the cluster ...\r\n![image(2)](https://user-images.githubusercontent.com/211644/56085932-cb504080-5e11-11e9-9937-6d0021605128.png)\r\n\r\nThe pulsar-dashboard apparently does not know about the cluster...\r\n![image(1)](https://user-images.githubusercontent.com/211644/56085934-d014f480-5e11-11e9-95eb-7405442c48f9.png)\r\n\r\nBut no if you bring up one of the tabs having a CLUSTERS menu on the right there is the missing cluster...\r\n![image](https://user-images.githubusercontent.com/211644/56085937-d5723f00-5e11-11e9-89ca-56dacef064ae.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu 18.04 for the development machine and vm's\r\n\r\n**Additional context**\r\nBecause /etc/hosts is used instead of DNS it is necessary to use the ledger2 ipaddr.\r\n```\r\n export SERVICE_URL=http://128.60.107.171:8080/ \r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/4044", "user": "phreed", "labels": ["component/dashboard", "triage/week-44", "type/bug"], "created": "2019-04-13 22:48:05", "closed": "2019-11-04 05:36:34", "commits": {}, "ttf": 204.00027777777777, "commitsDetails": []}, {"title": "go build faild with go mod", "body": "When I compiled the code in go-client/samples using go-mod mode, I got some error messages.\r\n\r\nI checked the history of the relevant issue, is it because cpp-client is not compiled? But from the error message, I think it seems that there are fewer documents.\r\n\r\nAlso, can I help write a go-client that doesn't depend on cgo ?\r\n\r\nMy work-dir :\r\n\r\n.\r\n\u251c\u2500\u2500 data\r\n\u251c\u2500\u2500 go.mod\r\n\u251c\u2500\u2500 go.sum\r\n\u251c\u2500\u2500 pulsar_pub.go\r\n\u251c\u2500\u2500 pulsar_sub.go\r\n\u2514\u2500\u2500 pulsar_sub_channel.go\r\n\r\nWhen go build pulsar_pub.go ,the error message:\r\n\r\n` github.com/apache/pulsar/pulsar-client-go/pulsar\r\nIn file included from ../../go/pkg/mod/github.com/apache/pulsar/pulsar-client-go@v0.0.0-20190412185135-6983359a4aaf/pulsar/c_client.go:24:\r\n./c_go_pulsar.h:22:10: fatal error: 'pulsar/c/client.h' file not found\r\n#include <pulsar/c/client.h>\r\n         ^~~~~~~~~~~~~~~~~~~\r\n1 error generated.`", "url": "https://github.com/apache/pulsar/issues/4043", "user": "LvBay", "labels": ["type/bug"], "created": "2019-04-13 09:04:25", "closed": "2019-04-15 03:38:34", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Pulsar-admin commands do not support parallelization", "body": "## Describe the bug\r\nExecuting pulsar-admin commands in parallel via bash results in only the last command succeeding. The other commands are ignored.\r\n\r\n## To Reproduce\r\nSteps to reproduce the behavior:\r\n1. Start docker standalone via:\r\n`docker run -it -p 80:80 -p 8080:8080 -p 6650:6650 apachepulsar/pulsar-standalone`\r\n2. Ensure that /etc/pulsar/client.conf is pointed to the standalone instance.\r\n3. Execute: \r\n`pulsar-admin tenants create t1 & pulsar-admin tenants create t2 & pulsar-admin tenants create t3 & pulsar-admin tenants create t4 & pulsar-admin tenants create t5 & pulsar-admin tenants create t6 & pulsar-admin tenants create t7 & pulsar-admin tenants create t8 & pulsar-admin tenants create t9 & pulsar-admin tenants create t10 & pulsar-admin tenants create t11 & pulsar-admin tenants create t12 & pulsar-admin tenants create t13 & pulsar-admin tenants create t14 & pulsar-admin tenants create t15 & pulsar-admin tenants create t16 & pulsar-admin tenants create t17 & pulsar-admin tenants create t18 & pulsar-admin tenants create t19 & pulsar-admin tenants create t20 & pulsar-admin tenants create t21 & pulsar-admin tenants create t22 & pulsar-admin tenants create t23 & pulsar-admin tenants create t24 & pulsar-admin tenants create t25 & pulsar-admin tenants create t26 & pulsar-admin tenants create t27 & pulsar-admin tenants create t28 & pulsar-admin tenants create t29 & pulsar-admin tenants create t30 & pulsar-admin tenants create t31 & pulsar-admin tenants create t32 & pulsar-admin tenants create t33 & pulsar-admin tenants create t34 & pulsar-admin tenants create t35 & pulsar-admin tenants create t36 & pulsar-admin tenants create t37 & pulsar-admin tenants create t38 & pulsar-admin tenants create t39 & pulsar-admin tenants create t40`\r\n4. Execute: \r\n`pulsar-admin tenants list`\r\n5. Notice that only the tenant `t40` was created. \r\n\r\nNamespaces have the same issue. Observe:\r\n\r\n6. Execute:\r\n`pulsar-admin namespaces create t40/ns1 & pulsar-admin namespaces create t40/ns2 & pulsar-admin namespaces create t40/ns3 & pulsar-admin namespaces create t40/ns4 & pulsar-admin namespaces create t40/ns5 & pulsar-admin namespaces create t40/ns6 & pulsar-admin namespaces create t40/ns7 & pulsar-admin namespaces create t40/ns8 & pulsar-admin namespaces create t40/ns9 & pulsar-admin namespaces create t40/ns10 & pulsar-admin namespaces create t40/ns11 & pulsar-admin namespaces create t40/ns12 & pulsar-admin namespaces create t40/ns13 & pulsar-admin namespaces create t40/ns14 & pulsar-admin namespaces create t40/ns15 & pulsar-admin namespaces create t40/ns16 & pulsar-admin namespaces create t40/ns17 & pulsar-admin namespaces create t40/ns18 & pulsar-admin namespaces create t40/ns19 & pulsar-admin namespaces create t40/ns20 & pulsar-admin namespaces create t40/ns21 & pulsar-admin namespaces create t40/ns22 & pulsar-admin namespaces create t40/ns23 & pulsar-admin namespaces create t40/ns24 & pulsar-admin namespaces create t40/ns25 & pulsar-admin namespaces create t40/ns26 & pulsar-admin namespaces create t40/ns27 & pulsar-admin namespaces create t40/ns28 & pulsar-admin namespaces create t40/ns29 & pulsar-admin namespaces create t40/ns30 & pulsar-admin namespaces create t40/ns31 & pulsar-admin namespaces create t40/ns32 & pulsar-admin namespaces create t40/ns33 & pulsar-admin namespaces create t40/ns34 & pulsar-admin namespaces create t40/ns35 & pulsar-admin namespaces create t40/ns36 & pulsar-admin namespaces create t40/ns37 & pulsar-admin namespaces create t40/ns38`\r\n\r\n7. Execute:\r\n`pulsar-admin namespaces list t40`\r\n8. Notice that only t40/ns38 was created. \r\n\r\n**Expected behavior**\r\n\r\n- Tenants t1, t2, ..., t40 should all be created in parallel.\r\n- Namespaces t40/ns1, t40/ns2, ..., t40/ns38 should all be created in parallel.\r\n\r\n**Note: This issue impacts fast/seamless continuous deployments.**\r\n\r\n## Additional context\r\nThis issue relates to my comment in PR 4012: https://github.com/apache/pulsar/pull/4012#issuecomment-481472762\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/4021", "user": "devinbost", "labels": ["type/bug"], "created": "2019-04-10 17:43:12", "closed": "2019-04-17 21:10:53", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "[Release 2.3.1] go version error in DEB package", "body": "**Describe the bug**\r\n\r\nnow, `pulsar-client-go` uses the package management method of `go mod`, `go mod` requires that the version of go must be 1.11 or higher\r\n\r\nwe can fix it , as follows:\r\n\r\n ```shell\r\n610 # apt-get update\r\n611 # apt-get -y upgrade\r\n612 # apt-get install -y git curl gcc\r\n613 # curl -O https://storage.googleapis.com/golang/go1.11.4.linux-amd64.tar.gz\r\n614 # tar -xvf go1.11.4.linux-amd64.tar.gz\r\n615 # mv go /usr/local\r\n616 # export GOROOT=/usr/local/go\r\n617 # export PATH=$PATH:$GOROOT/bin\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/4001", "user": "wolfstudy", "labels": ["component/go", "type/bug"], "created": "2019-04-08 03:39:46", "closed": "2019-07-11 06:10:42", "commits": {}, "ttf": 94.00027777777778, "commitsDetails": []}, {"title": "Failed to build pulsar docker image", "body": "**Describe the bug**\r\n\r\n```\r\n2019-04-08\\T\\01:48:35.008 [INFO] Step 4/14 : RUN pip install uwsgi 'Django<2.0' psycopg2 pytz requests\r\n2019-04-08\\T\\01:48:35.480 [INFO]  ---> Running in cf304a2e9b71\r\n2019-04-08\\T\\01:48:37.899 [INFO] Collecting uwsgi\r\n2019-04-08\\T\\01:48:38.280 [INFO]   Downloading https://files.pythonhosted.org/packages/e7/1e/3dcca007f974fe4eb369bf1b8629d5e342bb3055e2001b2e5340aaefae7a/uwsgi-2.0.18.tar.gz (801kB)\r\n2019-04-08\\T\\01:48:39.429 [INFO] Collecting Django<2.0\r\n2019-04-08\\T\\01:48:39.764 [INFO]   Downloading https://files.pythonhosted.org/packages/8e/1f/20bbc601c442d02cc8d9b25a399a18ef573077e3350acdf5da3743ff7da1/Django-1.11.20-py2.py3-none-any.whl (6.9MB)\r\n2019-04-08\\T\\01:48:42.100 [INFO] Collecting psycopg2\r\n2019-04-08\\T\\01:48:42.398 [INFO]   Downloading https://files.pythonhosted.org/packages/52/be/f898e712f5f08131d651a62754fca82a1deb42e4e9889ad01932f770a2be/psycopg2-2.8.1.tar.gz (367kB)\r\n2019-04-08\\T\\01:48:42.913 [INFO]     Complete output from command python setup.py egg_info:\r\n2019-04-08\\T\\01:48:42.913 [INFO]     running egg_info\r\n2019-04-08\\T\\01:48:42.914 [INFO]     creating pip-egg-info/psycopg2.egg-info\r\n2019-04-08\\T\\01:48:42.914 [INFO]     writing pip-egg-info/psycopg2.egg-info/PKG-INFO\r\n2019-04-08\\T\\01:48:42.914 [INFO]     writing top-level names to pip-egg-info/psycopg2.egg-info/top_level.txt\r\n2019-04-08\\T\\01:48:42.914 [INFO]     writing dependency_links to pip-egg-info/psycopg2.egg-info/dependency_links.txt\r\n2019-04-08\\T\\01:48:42.914 [INFO]     writing manifest file 'pip-egg-info/psycopg2.egg-info/SOURCES.txt'\r\n2019-04-08\\T\\01:48:42.914 [INFO]     Error: You need to install postgresql-server-dev-X.Y for building a server-side extension or libpq-dev for building a client-side application.\r\n```\r\n\r\n**To Reproduce**\r\n\r\nBuild pulsar docker image\r\n\r\n**Expected behavior**\r\n\r\nBuilding pulsar docker image should succeed.", "url": "https://github.com/apache/pulsar/issues/3998", "user": "sijie", "labels": ["component/build", "type/bug"], "created": "2019-04-08 02:03:18", "closed": "2019-04-08 04:49:11", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Fail to update functions in Effectively-once mode", "body": "**Describe the bug**\r\n\r\nCannot update a function that was started in effectively-once mode.\r\n\r\n\r\n**To Reproduce**\r\n\r\nIf I submit a function with function config:\r\n\r\n```\r\nname: java-jerry-test\r\ntenant: public\r\nnamespace: default\r\njar: pulsar-functions/java-examples/target/pulsar-functions-api-examples.jar\r\nclassName: org.apache.pulsar.functions.api.examples.TestFunction\r\ninputSpecs:\r\n  persistent://public/default/java-input:\r\n    receiverQueueSize: 100\r\noutput: persistent://public/default/java-output\r\nparallelism: 1\r\nprocessingGuarantees: EFFECTIVELY_ONCE\r\n~                                        \r\n```\r\n\r\nAttempting to update the parallelism:\r\n\r\n```\r\nJerrys-MBP:incubator-pulsar jerrypeng$ ./bin/pulsar-admin functions update --name java-jerry-test --parallelism 4\r\nRetain Orderning cannot be altered\r\n\r\nReason: Retain Orderning cannot be altered\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/3993", "user": "jerrypeng", "labels": ["type/bug"], "created": "2019-04-06 20:16:48", "closed": "2019-04-09 15:43:23", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "[Question] Geo Replication docs out of date?", "body": "The documentation on [Geo Replication](https://pulsar.apache.org/docs/latest/admin/GeoReplication/#creating-global-namespaces) mentions: \r\n\r\n> Replication must be used with global topics, meaning topics that belong to a global namespace and are thus not tied to any particular cluster... **Global namespaces need to be created in the global virtual cluster.**\r\n\r\nIs this part of documentation still valid? It seems I can create namespaces that replicate between two clusters (i.e. creating a namespace for a given tenant and then using set-clusters to set both ) without having to use the virtual cluster notation mentioned on this page.. Replication seems to work fine.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3989", "user": "wmccarley", "labels": ["component/documentation", "type/bug"], "created": "2019-04-05 18:07:26", "closed": "2019-04-15 18:15:46", "commits": {}, "ttf": 10.000277777777777, "commitsDetails": []}, {"title": "admin REST API serves 404 response to GET /admin/v2/tenants/{tenant} even though tenant exists", "body": "**Describe the bug**\r\n\r\nThe admin REST API returns a 404 Not Found response to `GET /admin/v2/tenants/$TENANT` even when `GET /admin/v2/tenants` shows that `$TENANT` exists.\r\n\r\n**To Reproduce**\r\n\r\nUsing Pulsar 2.3.0:\r\n\r\n```\r\n# Create tenant with an empty request body\r\n$ curl -X PUT http://host/admin/v2/tenants/foo\r\n\r\n# List tenants shows the newly created tenant\r\n$ curl -X GET http://host/admin/v2/tenants\r\n[\"foo\",\"public\"]\r\n\r\n# Trying to get the newly created tenant returns 404 Not Found\r\n$ curl -X GET http://host/admin/v2/tenants/foo\r\n{\"reason\":\"Tenant does not exist\"}\r\n```\r\n\r\nAfter I update the tenant so that it has a valid `allowedClusters`, the get request returns a 200 OK response:\r\n\r\n```\r\n$ curl -X POST -v -H 'Content-Type: application/json' -d '{\"adminRoles\":[],\"allowedClusters\":[\"mycluster\"]}' http://host/admin/v2/tenants/foo\r\n\r\n$ curl -X GET http://host/admin/v2/tenants/foo\r\n{\"adminRoles\":[],\"allowedClusters\":[\"mycluster\"]}\r\n\r\n```\r\n\r\n**Expected behavior**\r\n\r\nI expect a 200 OK response with an empty response body, like\r\n```\r\n{\"adminRoles\":[],\"allowedClusters\":[]}\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/3987", "user": "chairmank", "labels": ["component/cli", "type/bug"], "created": "2019-04-05 16:07:17", "closed": "2019-04-11 06:08:24", "commits": {"61e9e1b75f0ff0d38744c6afa90091936b7410d0": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "d22c993f301a50036f8a2f1b51d8d3ef43edf8e0": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "61e9e1b75f0ff0d38744c6afa90091936b7410d0", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["9c0937b85da38d25d6b0dbbcc2a58b0178dbf09f"], "nameRev": "61e9e1b75f0ff0d38744c6afa90091936b7410d0 tags/v2.4.0-candidate-1~350", "commitMessage": "[Issue 3987][pulsar-broker]Handle config is null when create tenant (#4019)\n\nFixes #3987 \r\n\r\n### Motivation\r\n\r\nConfig will not appear null when create tenant use pulsar-admin create foo3, but use the following command, config is null.\r\n```\r\ncurl -X PUT http://localhost:8080/admin/v2/tenants/foo3\r\n```\r\n\r\n### Modifications\r\n\r\nHandle config is null when create tenant use curl.\r\n\r\n### Verifying this change\r\nTest pass\r\n```\r\ncurl -X PUT http://localhost:8080/admin/v2/tenants/foo3\r\ncurl -X GET http://localhost:8080/admin/v2/tenants/foo3\r\n{\"adminRoles\":[],\"allowedClusters\":[]}\r\n```", "commitDateTime": "2019-04-11 14:08:23", "authoredDateTime": "2019-04-11 14:08:23", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/TenantsBase.java", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTest.java", "insertions": 7, "deletions": 0, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "TenantsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.TenantsBase.createTenant(java.lang.String,org.apache.pulsar.common.policies.data.TenantInfo)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminTest.properties()", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "d22c993f301a50036f8a2f1b51d8d3ef43edf8e0", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["c0f7f1c45ca20db1c28ee8c7b5239539ec424c85"], "nameRev": "d22c993f301a50036f8a2f1b51d8d3ef43edf8e0 tags/v2.3.2-candidate-1~23", "commitMessage": "[Issue 3987][pulsar-broker]Handle config is null when create tenant (#4019)\n\nFixes #3987 \r\n\r\n### Motivation\r\n\r\nConfig will not appear null when create tenant use pulsar-admin create foo3, but use the following command, config is null.\r\n```\r\ncurl -X PUT http://localhost:8080/admin/v2/tenants/foo3\r\n```\r\n\r\n### Modifications\r\n\r\nHandle config is null when create tenant use curl.\r\n\r\n### Verifying this change\r\nTest pass\r\n```\r\ncurl -X PUT http://localhost:8080/admin/v2/tenants/foo3\r\ncurl -X GET http://localhost:8080/admin/v2/tenants/foo3\r\n{\"adminRoles\":[],\"allowedClusters\":[]}\r\n```", "commitDateTime": "2019-05-18 17:31:35", "authoredDateTime": "2019-04-11 14:08:23", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/TenantsBase.java", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminTest.java", "insertions": 7, "deletions": 0, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "TenantsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.TenantsBase.createTenant(java.lang.String,org.apache.pulsar.common.policies.data.TenantInfo)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminTest.properties()", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Error during handshake for tls auth by apache pulsar client on ubuntu server", "body": "I have setup the `apache pulsar v2.3` on Ubuntu 18.04.2 LTS from [Run Pulsar locally](https://pulsar.apache.org/docs/en/standalone/). It sends message successfully without any authentication. \r\nBut i would like to send message using tls authentication , so configuring tls certificate using [security-tls-transport](https://pulsar.apache.org/docs/en/security-tls-transport/) and [security-tls-authentication](https://pulsar.apache.org/docs/en/security-tls-authentication/). \r\n\r\nUsing above link I have created the certificates and modified following config files `broker.conf`,`client.conf` and `standalone.conf`. I am trying to  send message by CLI with below command.\r\n` bin/pulsar-client produce my-topic --messages \"hello-pulsar\"`\r\n\r\nBut it throws the following error\r\n\r\n ```\r\n[pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ConnectionPool -           \r\n [[id: 0x8010c4f5, L:/127.0.0.1:42840 - R:localhost/127.0.0.1:6651]] \r\n Connected to server\r\n 09:47:17.686 [pulsar-client-io-1-1] WARN  \r\n org.apache.pulsar.client.impl.ClientCnx - Error during handshake\r\n java.nio.channels.ClosedChannelException: null\r\n    at io.netty.handler.ssl.SslHandler.channelInactive(...)(Unknown Source) \r\n ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n 09:47:17.691 [pulsar-client-io-1-1] INFO  \r\n org.apache.pulsar.client.impl.ClientCnx - [id: 0x8010c4f5, \r\n L:/127.0.0.1:42840 ! R:localhost/127.0.0.1:6651] Disconnected\r\n 09:47:17.692 [pulsar-client-io-1-1] WARN  \r\n org.apache.pulsar.client.impl.ConnectionPool - [[id: 0x8010c4f5, \r\n L:/127.0.0.1:42840 ! R:localhost/127.0.0.1:6651]] Connection handshake \r\n failed: org.apache.pulsar.client.api.PulsarClientException: Connection \r\n already closed\r\n 09:47:17.692 [pulsar-client-io-1-1] WARN  \r\n org.apache.pulsar.client.impl.PulsarClientImpl - [my-topic] Failed to get \r\n partitioned topic metadata: \r\n org.apache.pulsar.client.api.PulsarClientException: Connection already \r\n closed\r\n 09:47:17.692 [main] ERROR org.apache.pulsar.client.cli.PulsarClientTool - \r\n Error while producing messages\r\n 09:47:17.692 [main] ERROR org.apache.pulsar.client.cli.PulsarClientTool - \r\n Connection already closed\r\n org.apache.pulsar.client.api.PulsarClientException: Connection already \r\n closed at \r\n org.apache.pulsar.client.impl.ClientCnx.channelInactive(ClientCnx.java:204) \r\n ~[org.apache.pulsar-pulsar-client-original-2.3.0.jar:2.3.0]\r\n    at \r\n io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive\r\n (AbstractChannelHandlerContext.java:245) ~[io.netty-netty-all- \r\n 4.1.32.Final.jar:4.1.32.Final]\r\n    at \r\n io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive\r\n(AbstractChannelHandlerContext.java:231) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at \r\nio.netty.channel.AbstractChannelHandlerContext.fireChannelInactive\r\n(AbstractChannelHandlerContext.java:224) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at \r\nio.netty.handler.codec.ByteToMessageDecoder.channelInputClosed\r\n(ByteToMessageDecoder.java:390) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at \r\nio.netty.handler.codec.ByteToMessageDecoder.channelInactive\r\n   (ByteToMessageDecoder.java:355) ~[io.netty-netty-all- \r\n  4.1.32.Final.jar:4.1.32.Final]\r\n    at \r\n  io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive\r\n   (AbstractChannelHandlerContext.java:245) ~[io.netty-netty-all- \r\n  4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive\r\n  (AbstractChannelHandlerContext.java:231) ~[io.netty-netty-all- \r\n  4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive\r\n  (AbstractChannelHandlerContext.java:224) ~[io.netty-netty-all- \r\n 4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.handler.codec.ByteToMessageDecoder.channelInputClosed\r\n (ByteToMessageDecoder.java:390) ~[io.netty-netty-all- \r\n 4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.handler.codec.ByteToMessageDecoder.channelInactive\r\n     (ByteToMessageDecoder.java:355) ~[io.netty-netty-all- \r\n  4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.handler.ssl.SslHandler.channelInactive(SslHandler.java:1054) \r\n ~[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive\r\n  (AbstractChannelHandlerContext.java:245) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive\r\n (AbstractChannelHandlerContext.java:231) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive\r\n(AbstractChannelHandlerContext.java:224) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.DefaultChannelPipeline$HeadContext.channelInactive\r\n(DefaultChannelPipeline.java:1429) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive\r\n(AbstractChannelHandlerContext.java:245) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive\r\n(AbstractChannelHandlerContext.java:231) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.DefaultChannelPipeline.fireChannelInactive\r\n(DefaultChannelPipeline.java:947) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.AbstractChannel$AbstractUnsafe$8.run\r\n(AbstractChannel.java:826) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.util.concurrent.AbstractEventExecutor.safeExecute\r\n(AbstractEventExecutor.java:163) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks\r\n(SingleThreadEventExecutor.java:404) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:335) ~ \r\n[io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.util.concurrent.SingleThreadEventExecutor$5.run\r\n(SingleThreadEventExecutor.java:909) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run\r\n(FastThreadLocalRunnable.java:30) ~[io.netty-netty-all- \r\n4.1.32.Final.jar:4.1.32.Final]\r\n    at java.lang.Thread.run(Thread.java:748) ~[?:1.8.0_201]\r\n09:47:17.694 [main] INFO  org.apache.pulsar.client.cli.PulsarClientTool - 0 \r\nmessages successfully produced\r\n```\r\n\r\nCould anyone please help to resolve this ?", "url": "https://github.com/apache/pulsar/issues/3981", "user": "shan2015seyfert", "labels": ["component/security", "triage/week-44", "type/bug"], "created": "2019-04-04 07:06:22", "closed": "2020-01-14 16:54:42", "commits": {}, "ttf": 285.0002777777778, "commitsDetails": []}, {"title": "Failed to reset subscription: Message id was not present", "body": "**Describe the bug**\r\n\r\nCurrently Reader doesn't support seek-by-time. User has to down cast to get to consumer.seek and perform the cursor adjustment\r\n\r\n```\r\n((ReaderImpl) reader).getConsumer().seekAsync(RelativeTimeUtil.parseRelativeTimeInSeconds(\"-10m\"));\r\n```\r\n\r\nBut it always seems to come up with \u201cFailed to reset subscription: Message id was not present\u201d\r\n\r\n**Expected behavior**\r\n\r\nIt should position at the first message whose timestamp is larger than or equal to the provided timestamp.\r\n\r\n**Additional context**\r\n\r\nN/A", "url": "https://github.com/apache/pulsar/issues/3975", "user": "sijie", "labels": ["component/client", "type/bug"], "created": "2019-04-03 18:30:53", "closed": "2019-04-09 02:01:20", "commits": {"372575a9877bf50e8f55a9568ef6c07fcae86644": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "503114219807d2a887d73114e2b76fa82fbdf2ee": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "372575a9877bf50e8f55a9568ef6c07fcae86644", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["6bce00bd177cc6c1d78dcbcf6cc3355d09456c6b"], "nameRev": "372575a9877bf50e8f55a9568ef6c07fcae86644 tags/v2.4.0-candidate-1~361", "commitMessage": "[issue #3975] Bugfix NPE on non durable consumer (#3988)\n\n*Motivation*\r\n\r\nTrying to fix #3975\r\n\r\nWhen a reset of a cursor is performed with some timestamp on a non-durable\r\nconsumer the message finder will fail with null pointer exception due to\r\n`cursor.getName()` being null.\r\n\r\n*Modifications*\r\n\r\n  - Add method overloading for `newNonDurableCursor()` with subscription name.\r\n  - Fix method getNonDurableSubscription to call `newNonDurableCursor()` with\r\n    proper subscription name\r\n  - Add test to assert issue.", "commitDateTime": "2019-04-08 19:01:19", "authoredDateTime": "2019-04-08 23:01:19", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/ManagedLedger.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicReaderTest.java", "insertions": 27, "deletions": 1, "lines": 28}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ManagedLedger.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.newNonDurableCursor(org.apache.bookkeeper.mledger.Position,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ManagedLedgerImpl.java", "spoonMethods": []}, {"spoonFilePath": "PersistentTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.getNonDurableSubscription(java.lang.String,org.apache.pulsar.client.api.MessageId)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testMessageAvailableAfterRestart()", "TOT": 5, "UPD": 3, "INS": 0, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testReaderNonDurableIsAbleToSeekRelativeTime()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "503114219807d2a887d73114e2b76fa82fbdf2ee", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["6a8d8389d8d37ca5bdc9fa379220206e431904e7"], "nameRev": "503114219807d2a887d73114e2b76fa82fbdf2ee tags/v2.3.2-candidate-1~26", "commitMessage": "[issue #3975] Bugfix NPE on non durable consumer (#3988)\n\n*Motivation*\n\nTrying to fix #3975\n\nWhen a reset of a cursor is performed with some timestamp on a non-durable\nconsumer the message finder will fail with null pointer exception due to\n`cursor.getName()` being null.\n\n*Modifications*\n\n  - Add method overloading for `newNonDurableCursor()` with subscription name.\n  - Fix method getNonDurableSubscription to call `newNonDurableCursor()` with\n    proper subscription name\n  - Add test to assert issue.\n", "commitDateTime": "2019-05-18 17:31:35", "authoredDateTime": "2019-04-08 23:01:19", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/ManagedLedger.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicReaderTest.java", "insertions": 3, "deletions": 1, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ManagedLedger.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.newNonDurableCursor(org.apache.bookkeeper.mledger.Position,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ManagedLedgerImpl.java", "spoonMethods": []}, {"spoonFilePath": "PersistentTopic.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentTopic.getNonDurableSubscription(java.lang.String,org.apache.pulsar.client.api.MessageId)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicReaderTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.TopicReaderTest.testMessageAvailableAfterRestart()", "TOT": 5, "UPD": 3, "INS": 0, "MOV": 2, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Add steps to build Pulsar function to docs", "body": "**Describe the bug**\r\nCurrently the instructions for developing Java based Pulsar functions does not include any documentation on how to bundle and build the jar file that gets deployed.\r\n\r\n**To Reproduce**\r\nIf you scroll down to the \"Programming Model\" section of the https://pulsar.apache.org/docs/en/functions-overview/ page, you will see a section that describes the function code, followed by a section that shows how to deploy it from a fat jar file.\r\n\r\nIt leaves out steps on how to actually build the fat jar (which is crucial)\r\n\r\n\r\n**Expected behavior**\r\n\r\nLet's add a section that covers bundling the function as a NAR or fat JAR.\r\n\r\n**Screenshots**\r\n\r\n![Screen Shot 2019-04-03 at 10 11 57 AM](https://user-images.githubusercontent.com/35466513/55498826-61f25580-55f9-11e9-864b-b907a91ee8da.png)\r\n", "url": "https://github.com/apache/pulsar/issues/3974", "user": "david-streamlio", "labels": ["component/documentation", "type/bug"], "created": "2019-04-03 17:15:45", "closed": "2019-04-12 18:51:36", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "In Pulsar 2.3,` pulsar-admin topics list` will report read timed out", "body": "**Describe the bug**\r\nuser reported error while using `pulsar-admin topics list`, in cluster deploy.\r\n![image](https://user-images.githubusercontent.com/6348208/55448017-bfd26d80-55f8-11e9-8dec-0b5797942b6e.png)\r\n\r\nnamespaces/tenants list works well\r\n![image](https://user-images.githubusercontent.com/6348208/55448042-d4166a80-55f8-11e9-9c0a-acc1554a0d50.png)\r\n", "url": "https://github.com/apache/pulsar/issues/3970", "user": "jiazhai", "labels": ["component/cli", "help wanted", "type/bug"], "created": "2019-04-03 02:11:57", "closed": "2019-04-04 23:11:54", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Can`t get pulsar-client-go lib", "body": "Hello!\r\nCentos 7\r\ngo version go1.12.1 linux/amd64\r\n\r\nReproduce:\r\n```\r\nyum install apache-pulsar-client-2.3.0-1.x86_64.rpm\r\nyum install apache-pulsar-client-devel-2.3.0-1.x86_64.rpm\r\ngo get github.com/apache/pulsar/pulsar-client-go/pulsar\r\n```\r\n\r\nResult:\r\n```\r\nError:\r\n# github.com/apache/pulsar/pulsar-client-go/pulsar\r\nsrc/github.com/apache/pulsar/pulsar-client-go/pulsar/c_consumer.go:101:3: could not determine kind of name for C.pulsar_configure_set_negative_ack_redelivery_delay_ms\r\nsrc/github.com/apache/pulsar/pulsar-client-go/pulsar/c_consumer.go:263:2: could not determine kind of name for C.pulsar_consumer_negative_acknowledge\r\nsrc/github.com/apache/pulsar/pulsar-client-go/pulsar/c_consumer.go:268:2: could not determine kind of name for C.pulsar_consumer_negative_acknowledge_id\r\n```\r\n\r\nHow to fix it?", "url": "https://github.com/apache/pulsar/issues/3968", "user": "xrayid", "labels": ["type/bug"], "created": "2019-04-02 15:43:12", "closed": "2019-04-02 21:32:14", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "UNAVAILABLE: io exception in a Sink which accepts pulsar messages as bytes", "body": "**Describe the bug**\r\nWhen trying to send a single string message to the topic occupied in a sink that treats the message as bytes, such as `RedisSink`, it occurs the following error:\r\n```\r\n$ bin/pulsar-admin sink status --tenant public --namespace default --name redis-test-sink\r\n{\r\n  \"numInstances\" : 1,\r\n  \"numRunning\" : 0,\r\n  \"instances\" : [ {\r\n    \"instanceId\" : 0,\r\n    \"status\" : {\r\n      \"running\" : false,\r\n      \"error\" : \"UNAVAILABLE: io exception\",\r\n      \"numRestarts\" : 0,\r\n      \"numReadFromPulsar\" : 0,\r\n      \"numSystemExceptions\" : 0,\r\n      \"latestSystemExceptions\" : [ ],\r\n      \"numSinkExceptions\" : 0,\r\n      \"latestSinkExceptions\" : [ ],\r\n      \"numWrittenToSink\" : 0,\r\n      \"lastReceivedTime\" : 0,\r\n      \"workerId\" : \"c-pulsar-cluster-test-fw-localhost-8080\"\r\n    }\r\n  } ]\r\n}\r\n```\r\nThe functions log shows below:\r\n```\r\n15:26:13.565 [public/default/redis-test-sink-0] ERROR org.apache.pulsar.functions.instance.JavaInstanceRunnable - [public/default/redis-test-sink:0] Uncaught exception in Java Instance\r\norg.apache.pulsar.client.api.SchemaSerializationException: org.apache.pulsar.functions.runtime.shaded.com.fasterxml.jackson.core.JsonParseException: Unrecognized token 'Hello': was expecting ('true', 'false' or 'null')\r\n at [Source: (byte[])\"Hello Pulsar\"; line: 1, column: 7]\r\n        at org.apache.pulsar.client.impl.schema.JSONSchema.decode(JSONSchema.java:77) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.client.impl.MessageImpl.getValue(MessageImpl.java:247) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.functions.source.PulsarRecord.getValue(PulsarRecord.java:74) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.readInput(JavaInstanceRunnable.java:451) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:236) [java-instance.jar:2.4.0-SNAPSHOT]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_171]\r\nCaused by: org.apache.pulsar.functions.runtime.shaded.com.fasterxml.jackson.core.JsonParseException: Unrecognized token 'Hello': was expecting ('true', 'false' or 'null')\r\n at [Source: (byte[])\"Hello Pulsar\"; line: 1, column: 7]\r\n        at org.apache.pulsar.functions.runtime.shaded.com.fasterxml.jackson.core.JsonParser._constructError(JsonParser.java:1804) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.functions.runtime.shaded.com.fasterxml.jackson.core.base.ParserMinimalBase._reportError(ParserMinimalBase.java:703) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.functions.runtime.shaded.com.fasterxml.jackson.core.json.UTF8StreamJsonParser._reportInvalidToken(UTF8StreamJsonParser.java:3532) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.functions.runtime.shaded.com.fasterxml.jackson.core.json.UTF8StreamJsonParser._handleUnexpectedValue(UTF8StreamJsonParser.java:2627) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.functions.runtime.shaded.com.fasterxml.jackson.core.json.UTF8StreamJsonParser._nextTokenNotInObject(UTF8StreamJsonParser.java:832) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.functions.runtime.shaded.com.fasterxml.jackson.core.json.UTF8StreamJsonParser.nextToken(UTF8StreamJsonParser.java:729) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.functions.runtime.shaded.com.fasterxml.jackson.databind.ObjectMapper._initForReading(ObjectMapper.java:4141) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.functions.runtime.shaded.com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:4000) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.functions.runtime.shaded.com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3091) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.client.impl.schema.JSONSchema.decode(JSONSchema.java:75) ~[java-instance.jar:2.4.0-SNAPSHOT]\r\n        ... 5 more\r\n15:26:13.574 [public/default/redis-test-sink-0] INFO  org.apache.pulsar.functions.instance.JavaInstanceRunnable - Closing instance\r\n15:26:13.581 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [test_redis] [public/default/redis-test-sink] Closed consumer\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/3966", "user": "murong00", "labels": ["type/bug"], "created": "2019-04-02 08:54:59", "closed": "2019-04-04 15:51:34", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "[java client] run PulsarFunctionE2ETest failed", "body": "**Describe the bug**\r\n\r\n```\r\n2019-04-02\\T\\05:07:32.953 [INFO] Running org.apache.pulsar.io.PulsarFunctionE2ETest\r\n2019-04-02\\T\\05:09:37.953 [ERROR] Tests run: 14, Failures: 1, Errors: 0, Skipped: 2, Time elapsed: 124.972 s <<< FAILURE! - in org.apache.pulsar.io.PulsarFunctionE2ETest\r\n2019-04-02\\T\\05:09:37.953 [ERROR] testPulsarSourceStatsWithUrl(org.apache.pulsar.io.PulsarFunctionE2ETest)  Time elapsed: 1.325 s  <<< FAILURE!\r\njava.lang.AssertionError: expected [1] but found [0]\r\n\tat org.testng.Assert.fail(Assert.java:96)\r\n\tat org.testng.Assert.failNotEquals(Assert.java:776)\r\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:137)\r\n\tat org.testng.Assert.assertEquals(Assert.java:118)\r\n\tat org.testng.Assert.assertEquals(Assert.java:652)\r\n\tat org.testng.Assert.assertEquals(Assert.java:662)\r\n\tat org.apache.pulsar.io.PulsarFunctionE2ETest.testPulsarSourceStats(PulsarFunctionE2ETest.java:706)\r\n\tat org.apache.pulsar.io.PulsarFunctionE2ETest.testPulsarSourceStatsWithUrl(PulsarFunctionE2ETest.java:786)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124)\r\n\tat org.testng.internal.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:54)\r\n\tat org.testng.internal.InvokeMethodRunnable.run(InvokeMethodRunnable.java:44)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```", "url": "https://github.com/apache/pulsar/issues/3964", "user": "wolfstudy", "labels": ["component/test", "type/bug"], "created": "2019-04-02 07:03:30", "closed": "2019-07-11 06:12:51", "commits": {}, "ttf": 99.00027777777778, "commitsDetails": []}, {"title": "RedisSink not available", "body": "**Describe the bug**\r\nWhen trying to copy the `pulsar-io-redis-2.4.0-SNAPSHOT.nar` to the existing directory `connectors` and restart the broker, it failed to list the redis connector by the following script:\r\n```\r\n$ curl -s http://localhost:8080/admin/v2/functions/connectors\r\n```", "url": "https://github.com/apache/pulsar/issues/3963", "user": "ayolivia", "labels": ["type/bug"], "created": "2019-04-02 05:58:21", "closed": "2019-04-02 21:31:46", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "can not download pulsar c++ client-devel, link url is wrong.", "body": "**Describe the bug**\r\ndownload pulsar c++ client-devel, the true url must:\r\nhttps://archive.apache.org/dist/pulsar/pulsar-2.3.0/RPMS/apache-pulsar-client-devel-2.3.0-1.x86_64.rpm\r\n\r\nbut the link is \r\nhttps://archive.apache.org/dist/pulsar/pulsar-2.3.0/RPMS/apache-pulsar-client-devel-2.3.0.x86_64.rpm\r\n\r\nso 404 not found\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to '...'\r\n2. Click on '....'\r\n3. Scroll down to '....'\r\n4. See error\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/3953", "user": "weishangkai", "labels": ["type/bug"], "created": "2019-04-01 03:39:09", "closed": "2019-04-09 15:31:40", "commits": {}, "ttf": 8.000277777777777, "commitsDetails": []}, {"title": "unload an non-existent topic returns 500", "body": "**Describe the bug**\r\n\r\nunload an non-existent topic returns 500\r\n\r\n```\r\n$ bin/pulsar-admin topics unload persistent://public/default/non-existent\r\n21:29:45.570 [jersey-client-async-executor-0] WARN  org.apache.pulsar.client.admin.internal.BaseResource - [http://localhost:8080/admin/v2/persistent/public/default/non-existent/unload] Failed to perform http put request: javax.ws.rs.InternalServerErrorException: HTTP 500 Request failed.\r\nHTTP 500 Request failed.\r\n\r\nReason: HTTP 500 Request failed.\r\n```\r\n\r\n```\r\n21:21:00.058 [pulsar-ordered-OrderedExecutor-6-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - Opening managed ledger public/default/persistent/test1\r\n21:21:00.061 [pulsar-web-55-21] WARN  org.eclipse.jetty.server.HttpChannel - /admin/v2/persistent/public/default/test1/unload\r\njavax.servlet.ServletException: javax.servlet.ServletException: java.lang.NullPointerException\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146) ~[org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:174) ~[org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) ~[org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:503) ~[org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:364) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:305) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n```\r\n\r\n**To Reproduce**\r\n\r\n```\r\n$ bin/pulsar-admin topics unload persistent://public/default/non-existent\r\n```\r\n\r\n**Expected behavior**\r\n\r\nit should return 404\r\n", "url": "https://github.com/apache/pulsar/issues/3935", "user": "sijie", "labels": ["component/cli", "type/bug"], "created": "2019-03-29 04:31:18", "closed": "2019-04-01 07:14:55", "commits": {"e36ae702ea051913a723a7206e0bad7ae7e1949e": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "e36ae702ea051913a723a7206e0bad7ae7e1949e", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["b6c509a561402b7e2acf64829e2b964a9197b5ea"], "nameRev": "e36ae702ea051913a723a7206e0bad7ae7e1949e tags/v2.4.0-candidate-1~396", "commitMessage": "Bugfix an unload non-existent topic (#3946)\n\n*Motivation*\r\n\r\nFixes #3935\r\n\r\nWhen an unload operation is being made to an non-existent topic a null pointer\r\nexception is thrown due to bad handling exception on general catch clause.\r\n\r\n*Modifications*\r\n\r\n  - Refactor getTopicReference() for a simplified version.\r\n  - Simplify exception thrown when partitioned topics was not found.\r\n  - Fix NPE when unload operation is being made with a non-existent topic.\r\n  - Add test in order to assert unload on normal situation.\r\n  - Add test to assert npe from unload with non existent topic.", "commitDateTime": "2019-04-01 15:14:55", "authoredDateTime": "2019-04-01 04:14:55", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 21, "deletions": 20, "lines": 41}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 18, "deletions": 0, "lines": 18}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.getTopicReference(org.apache.pulsar.common.naming.TopicName)", "TOT": 28, "UPD": 5, "INS": 1, "MOV": 16, "DEL": 6}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.unloadTopic(org.apache.pulsar.common.naming.TopicName,boolean)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.topicNotFoundReason(org.apache.pulsar.common.naming.TopicName)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testUnloadTopic()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testUnloadTopicShallThrowNotFoundWhenTopicNotExist()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Ledger offload to tiered storage fails with NoClassDefFoundError: com/jamesmurty/utils/XMLBuilder", "body": "We see this stacktrace on brokers when we trigger offload to tiered storage:\r\n\r\n```\r\n13:35:26.044 [offloader-OrderedScheduler-1-0] ERROR org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader - Failed delete Blob\r\njava.lang.NoClassDefFoundError: com/jamesmurty/utils/XMLBuilder\r\n        at org.jclouds.s3.binders.BindIterableAsPayloadToDeleteRequest.bindToRequest(BindIterableAsPayloadToDeleteRequest.java:54) ~[jclouds-shaded-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT\r\n]\r\n        at org.jclouds.rest.internal.RestAnnotationProcessor.decorateRequest(RestAnnotationProcessor.java:660) ~[jclouds-shaded-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at org.jclouds.rest.internal.RestAnnotationProcessor.apply(RestAnnotationProcessor.java:354) ~[jclouds-shaded-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at org.jclouds.rest.internal.RestAnnotationProcessor.apply(RestAnnotationProcessor.java:137) ~[jclouds-shaded-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at org.jclouds.rest.internal.InvokeHttpMethod.toCommand(InvokeHttpMethod.java:189) ~[jclouds-shaded-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at org.jclouds.rest.internal.InvokeHttpMethod.invoke(InvokeHttpMethod.java:85) ~[jclouds-shaded-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at org.jclouds.rest.internal.InvokeHttpMethod.apply(InvokeHttpMethod.java:74) ~[jclouds-shaded-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at org.jclouds.rest.internal.InvokeHttpMethod.apply(InvokeHttpMethod.java:45) ~[jclouds-shaded-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at org.jclouds.rest.internal.DelegatesToInvocationFunction.handle(DelegatesToInvocationFunction.java:156) ~[jclouds-shaded-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at org.jclouds.rest.internal.DelegatesToInvocationFunction.invoke(DelegatesToInvocationFunction.java:123) ~[jclouds-shaded-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at com.sun.proxy.$Proxy72.deleteObjects(Unknown Source) ~[?:?]\r\n        at org.jclouds.s3.blobstore.S3BlobStore.removeBlobs(S3BlobStore.java:343) ~[jclouds-shaded-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$deleteOffloaded$4(BlobStoreManagedLedgerOffloader.java:561) [tiered-storage-jclou\r\nd-2.4.0-SNAPSHOT.nar-unpacked/:?]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\r\n        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:111) [com.google.guava-guav\r\na-21.0.jar:?]\r\n        at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:58) [com.google.guava-guava-21.0.jar:?]\r\n        at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:75) [com.google.guava-guava-21.0.jar:?]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n        at java.lang.Thread.run(Thread.java:834) [?:?]\r\nCaused by: java.lang.ClassNotFoundException: com.jamesmurty.utils.XMLBuilder\r\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:471) ~[?:?]\r\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:588) ~[?:?]\r\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:521) ~[?:?]\r\n        ... 24 more\r\n```\r\n\r\nIt seems that `com.jamesmurty.utils.XMLBuilder` is missing from the tiered-storage-jcloud NAR file.", "url": "https://github.com/apache/pulsar/issues/3928", "user": "chairmank", "labels": ["type/bug"], "created": "2019-03-28 12:20:45", "closed": "2019-03-28 20:23:24", "commits": {"625649fb0a1de2cfc39b889dec411e412aefca73": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "ec3d635819d2367f1c4661dddf0af8cd702aa641": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "625649fb0a1de2cfc39b889dec411e412aefca73", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["70cc68229de6c3e6620b60a20f2f4faa4b93ce6a"], "nameRev": "625649fb0a1de2cfc39b889dec411e412aefca73 tags/v2.4.0-candidate-1~416", "commitMessage": "Include java-xmlbuilder in tiered-storage-jcloud NAR (#3928) (#3929)\n\nIn the POM file for tiered-storage-jcloud, the dependency on\r\ncom.jamesmurty.utils/java-xmlbuilder was marked with test scope, but in\r\nfact this dependency is needed during normal use. This commit changes\r\nthe POM file so that the java-xmlbuilder dependency is packaged in the\r\nNAR file.", "commitDateTime": "2019-03-28 13:23:23", "authoredDateTime": "2019-03-28 15:23:23", "commitGitStats": [{"filePath": "tiered-storage/jcloud/pom.xml", "insertions": 5, "deletions": 6, "lines": 11}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "ec3d635819d2367f1c4661dddf0af8cd702aa641", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["ee760785ab9a0e785d3c8339f065562d71ec4e80"], "nameRev": "ec3d635819d2367f1c4661dddf0af8cd702aa641 tags/v2.3.1-candidate-1~21", "commitMessage": "Include java-xmlbuilder in tiered-storage-jcloud NAR (#3928) (#3929)\n\nIn the POM file for tiered-storage-jcloud, the dependency on\r\ncom.jamesmurty.utils/java-xmlbuilder was marked with test scope, but in\r\nfact this dependency is needed during normal use. This commit changes\r\nthe POM file so that the java-xmlbuilder dependency is packaged in the\r\nNAR file.", "commitDateTime": "2019-03-29 12:00:17", "authoredDateTime": "2019-03-28 15:23:23", "commitGitStats": [{"filePath": "tiered-storage/jcloud/pom.xml", "insertions": 5, "deletions": 6, "lines": 11}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Meet schema error while using debezium source.", "body": "**Describe the bug**\r\nIf a debezium source connector stop and start again. the internal PulsarSink's schema type is changed.\r\n\r\nIn PulsarSink.open(), the schema is changed while restart the source.\r\nAdd a log after initializeSchema(): \r\n```\r\n    public void open(Map<String, Object> config, SinkContext sinkContext) throws Exception {\r\n        log.info(\"Opening pulsar sink with config: {}\", pulsarSinkConfig);\r\n       Schema<T> schema = initializeSchema();\r\n       log.error(\"++++ schemainfo: name:{}, type:{}, string:{}\", info.getName(), info.getType(), info.toString())\r\n```\r\nHere is the log of first run, the schema is KeyValue schema, which is right.\r\n```\r\n 17:11:31.557 [public/default/debezium-postgres-source-0] INFO  org.apache.pulsar.functions.sink.PulsarSink - Opening pulsar sink with config: PulsarSinkConfig(processingGuarantees=ATLEAST_ONCE,        topic=debezium-postgres-topic, serdeClassName=null, schemaType=null, typeClassName=org.apache.pulsar.common.schema.KeyValue)\r\n 17:11:31.707 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ConnectionPool - [[id: 0x4b095a03, L:/127.0.0.1:49721 - R:localhost/127.0.0.1:6650]] Connected to server\r\n 17:11:31.731 [public/default/debezium-postgres-source-0] ERROR org.apache.pulsar.functions.sink.PulsarSink - ++++ schemainfo: name:KeyValue, type:KEY_VALUE, string:SchemaInfo(name=KeyValue,            schema=[0, 0, 0, 0, 0, 0, 0, 0], type=KEY_VALUE, properties={})\r\n```\r\nHere is the log of second run, get a wrong Bytes Schema:\r\n```\r\n17:16:31.409 [public/default/debezium-postgres-source-0] INFO  org.apache.pulsar.functions.sink.PulsarSink - Opening pulsar sink with config: PulsarSinkConfig(processingGuarantees=ATLEAST_ONCE,        topic=debezium-postgres-topic, serdeClassName=null, schemaType=null, typeClassName=org.apache.pulsar.common.schema.KeyValue)\r\n 17:16:31.526 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ConnectionPool - [[id: 0x4519d8a5, L:/127.0.0.1:50018 - R:localhost/127.0.0.1:6650]] Connected to server\r\n 17:16:31.547 [public/default/debezium-postgres-source-0] ERROR org.apache.pulsar.functions.sink.PulsarSink - ++++ schemainfo: name:Bytes, type:BYTES, string:SchemaInfo(name=Bytes, schema=[],           type=BYTES, properties={})\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/3925", "user": "jiazhai", "labels": ["type/bug"], "created": "2019-03-28 10:44:35", "closed": "2019-03-29 16:11:41", "commits": {"7e7175db004a9f724d788ecace4beb76ff482c95": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "ea94ba0f6cf18a11898a640c89d16c4540abf027": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "7e7175db004a9f724d788ecace4beb76ff482c95", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["08c97f703a5bf1de2330c4c6ae00a2fe170ed692"], "nameRev": "7e7175db004a9f724d788ecace4beb76ff482c95 tags/v2.4.0-candidate-1~406", "commitMessage": "[schema] store schema type correctly in schema registry (#3940)\n\n*Motivation*\r\n\r\nFixes #3925\r\n\r\nWe have 3 places of defining schema type enums. We kept adding\r\nnew schema type in pulsar-common. However we don't update the schema type\r\nin wire protocol and schema storage.\r\n\r\nThis causes `SchemaType.NONE` is stored in SchemaRegistry.\r\nIt fails debeizum connector on restarting.\r\n\r\n*Modifications*\r\n\r\nMake sure all 3 places have consistent schema type definitions.\r\nRecord the correct schema type.", "commitDateTime": "2019-03-29 09:11:40", "authoredDateTime": "2019-03-29 09:11:40", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 1, "deletions": 18, "lines": 19}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java", "insertions": 8, "deletions": 25, "lines": 33}, {"filePath": "pulsar-broker/src/main/proto/SchemaRegistryFormat.proto", "insertions": 11, "deletions": 0, "lines": 11}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/common/schema/SchemaType.java", "insertions": 85, "deletions": 36, "lines": 121}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AutoConsumeSchema.java", "insertions": 8, "deletions": 0, "lines": 8}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/Commands.java", "insertions": 10, "deletions": 27, "lines": 37}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/proto/PulsarApi.java", "insertions": 33, "deletions": 0, "lines": 33}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/schema/SchemaData.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-common/src/main/proto/PulsarApi.proto", "insertions": 11, "deletions": 0, "lines": 11}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java", "insertions": 15, "deletions": 3, "lines": 18}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.getSchema(org.apache.pulsar.common.api.proto.PulsarApi$Schema)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.getType(org.apache.pulsar.common.api.proto.PulsarApi$Schema$Type)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "SchemaRegistryServiceImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.convertToDomainType(org.apache.pulsar.broker.service.schema.proto.SchemaRegistryFormat$SchemaInfo$SchemaType)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.convertFromDomainType(org.apache.pulsar.common.schema.SchemaType)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "SchemaType.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.schema.SchemaType", "TOT": 44, "UPD": 4, "INS": 18, "MOV": 19, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.common.schema.SchemaType.getValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.schema.SchemaType.valueOf(int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.connectionOpened(org.apache.pulsar.client.impl.ClientCnx)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.connectionOpened(org.apache.pulsar.client.impl.ClientCnx)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "AutoConsumeSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoConsumeSchema.getSchema(org.apache.pulsar.common.schema.SchemaInfo)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Commands.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.Commands.getSchema(org.apache.pulsar.common.schema.SchemaInfo)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.Commands.getSchemaType(org.apache.pulsar.common.schema.SchemaType)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.common.api.Commands.getSchemaType(org.apache.pulsar.common.api.proto.PulsarApi$Schema$Type)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "PulsarApi.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.Schema.Type", "TOT": 22, "UPD": 0, "INS": 22, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.Schema.Type.valueOf(int)", "TOT": 11, "UPD": 0, "INS": 11, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaData.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.schema.SchemaData", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.getSchemaTypeOrDefault(java.lang.String,java.lang.Class)", "TOT": 9, "UPD": 0, "INS": 3, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.getDefaultSchemaType(java.lang.Class)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "ea94ba0f6cf18a11898a640c89d16c4540abf027", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["2fecbd6a2df651b8d4a54487a718fb06a51db5cc"], "nameRev": "ea94ba0f6cf18a11898a640c89d16c4540abf027 tags/v2.3.1-candidate-1~16", "commitMessage": "[schema] store schema type correctly in schema registry (#3940)\n\n*Motivation*\r\n\r\nFixes #3925\r\n\r\nWe have 3 places of defining schema type enums. We kept adding\r\nnew schema type in pulsar-common. However we don't update the schema type\r\nin wire protocol and schema storage.\r\n\r\nThis causes `SchemaType.NONE` is stored in SchemaRegistry.\r\nIt fails debeizum connector on restarting.\r\n\r\n*Modifications*\r\n\r\nMake sure all 3 places have consistent schema type definitions.\r\nRecord the correct schema type.", "commitDateTime": "2019-03-29 12:00:17", "authoredDateTime": "2019-03-29 09:11:40", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 1, "deletions": 18, "lines": 19}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java", "insertions": 8, "deletions": 25, "lines": 33}, {"filePath": "pulsar-broker/src/main/proto/SchemaRegistryFormat.proto", "insertions": 11, "deletions": 0, "lines": 11}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/common/schema/SchemaType.java", "insertions": 85, "deletions": 36, "lines": 121}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AutoConsumeSchema.java", "insertions": 8, "deletions": 0, "lines": 8}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/Commands.java", "insertions": 10, "deletions": 27, "lines": 37}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/proto/PulsarApi.java", "insertions": 33, "deletions": 0, "lines": 33}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/schema/SchemaData.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-common/src/main/proto/PulsarApi.proto", "insertions": 11, "deletions": 0, "lines": 11}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java", "insertions": 15, "deletions": 3, "lines": 18}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.getSchema(org.apache.pulsar.common.api.proto.PulsarApi$Schema)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.getType(org.apache.pulsar.common.api.proto.PulsarApi$Schema$Type)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "SchemaRegistryServiceImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.convertToDomainType(org.apache.pulsar.broker.service.schema.proto.SchemaRegistryFormat$SchemaInfo$SchemaType)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.convertFromDomainType(org.apache.pulsar.common.schema.SchemaType)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "SchemaType.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.schema.SchemaType", "TOT": 44, "UPD": 4, "INS": 18, "MOV": 19, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.common.schema.SchemaType.getValue()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.schema.SchemaType.valueOf(int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.connectionOpened(org.apache.pulsar.client.impl.ClientCnx)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.connectionOpened(org.apache.pulsar.client.impl.ClientCnx)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "AutoConsumeSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.AutoConsumeSchema.getSchema(org.apache.pulsar.common.schema.SchemaInfo)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Commands.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.Commands.getSchema(org.apache.pulsar.common.schema.SchemaInfo)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.Commands.getSchemaType(org.apache.pulsar.common.schema.SchemaType)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.common.api.Commands.getSchemaType(org.apache.pulsar.common.api.proto.PulsarApi$Schema$Type)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "PulsarApi.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.Schema.Type", "TOT": 22, "UPD": 0, "INS": 22, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.Schema.Type.valueOf(int)", "TOT": 11, "UPD": 0, "INS": 11, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SchemaData.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.schema.SchemaData", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.getSchemaTypeOrDefault(java.lang.String,java.lang.Class)", "TOT": 9, "UPD": 0, "INS": 3, "MOV": 5, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.getDefaultSchemaType(java.lang.Class)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Serialization error when encoding schema with subrecords in python client", "body": "It seems that the schema support in the client 2.3.0 on python 3.7 is not working with subrecords.\r\n\r\nThis example produces an error when encoding ():\r\n\r\n> \"TypeError: Object of type MySubRecord is not JSON serializable\"\r\n\r\n```python\r\nimport json\r\nfrom pulsar.schema import Record, String, JsonSchema\r\n\r\ndef test_complex():\r\n    class MySubRecord(Record):\r\n        a = String()\r\n\r\n    class Example(Record):\r\n        sub = MySubRecord() # Test with instance\r\n\r\n    r = Example(sub = MySubRecord( a = 'string' ))\r\n    assert r.sub.a == 'string'\r\n\r\n    s = JsonSchema(Example)\r\n\r\n    # Produces \"TypeError: Object of type MySubRecord is not JSON serializable\"\r\n    data = s.encode(r)\r\n\r\n    assert json.loads(data)['sub']['a'] == 'string'\r\n```\r\nIs there something I missed in the implementation? I tested with `AvroSchema` with no success.\r\n\r\nI expected the client to use a custom encoder that would have encoded the subrecord.\r\n\r\nWhat do you think?\r\n", "url": "https://github.com/apache/pulsar/issues/3916", "user": "yciabaud", "labels": ["component/python", "component/schemaregistry", "type/bug"], "created": "2019-03-27 18:10:39", "closed": "2019-04-12 00:09:22", "commits": {}, "ttf": 15.000277777777777, "commitsDetails": []}, {"title": "Pulsar source/sink creation fails when using JSON config values", "body": "**Description**\r\nWhen executing `pulsar-admin source create` or `pulsar-admin sink create`, the created source/sink fails to operate as expected when config values are specified via JSON rather than via a config file. \r\nBeing able to create sources and sinks with inline JSON is particularly important for our CI/CD automation because it gets complicated if we need to track a lot of config files\r\n\r\n**To Reproduce**\r\nExecute a command like this:\r\n\r\n```\r\nbin/pulsar-admin source create \\\r\n          --source-type 'kafka' \\\r\n          --destinationTopicName  exampleTopic \\\r\n          --sourceConfig '{\"bootstrapServers\": \"kafka01.FQDN.com:9092,kafka02.FQDN.com:9092,kafka03.FQDN.com:9092\", \"consumerConfigProperties.auto.offset.reset\": \"earliest\", \"consumerConfigProperties.sasl.jaas.config\": \"com.sun.security.auth.module.Krb5LoginModule required doNotPrompt=true useTicketCache=false serviceName=\\\"kafka\\\" principal=\\\"pulsar_runtime@FQDN.COM\\\" useKeyTab=true keyTab=\\\"/pulsar/conf/auth/pulsar_runtime_test.keytab\\\" client=true; \", \"consumerConfigProperties.sasl.kerberos.service.name\": \"kafka\", \"consumerConfigProperties.security.protocol\": \"SASL_PLAINTEXT\", \"groupId\": \"abandoned-site-group\", \"topic\": \" exampleTopic\"}' \\\r\n          --source-type 'kafka' \\\r\n          --namespace  exampleNamespace \\\r\n          --name campaign-kafka-source \\\r\n          --tenant osp\r\n```\r\n\r\nThe command will report that the source was created successfully; however, the source will not operate as desired. However, the source will operate as desired if the config-file approach is used, like this:\r\n\r\n```\r\nbin/pulsar-admin source create \\\r\n          --source-type 'kafka' \\\r\n          --destinationTopicName  exampleTopic \\\r\n          --sourceConfigFile /path/to/file.yml  \\\r\n          --source-type 'kafka' \\\r\n          --namespace  exampleNamespace \\\r\n          --name campaign-kafka-source \\\r\n          --tenant osp\r\n```\r\nwhere the config file is like this:\r\n\r\n```bootstrapServers: \"kafka01.FQDN.com:9092,kafka02.FQDN.com:9092,kafka03.FQDN.com:9092\"\r\ngroupId: \"abandoned-site-group\"\r\ntopic: \" exampleTopic\"\r\nconsumerConfigProperties:\r\n    security.protocol: \"SASL_PLAINTEXT\"\r\n    sasl.kerberos.service.name: \"kafka\"\r\n    auto.offset.reset: \"earliest\"\r\n    sasl.jaas.config: \"com.sun.security.auth.module.Krb5LoginModule required doNotPrompt=true useTicketCache=false serviceName=\\\"kafka\\\" principal=\\\"pulsar_runtime@FQDN.COM\\\" useKeyTab=true keyTab=\\\"/pulsar/conf/auth/pulsar_runtime_test.keytab\\\" client=true; \"\r\n```\r\n\r\nNotice that the JSON is flattened in comparison to the config file. We initially tried having the JSON match the hierarchy in the YAML, but we got errors. So, we flattened it by combining `consumerConfigProperties` with the properties under it like: `security.protocol` to produce properties like `consumerConfigProperties.security.protocol`, which match the \"key/value\" requirements specified in Pulsar documentation. \r\n\r\n**Expected behavior**\r\nThe source should function correctly when executing a command with inline JSON.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: https://github.com/apache/pulsar/tree/branch-2.3/docker/pulsar-all\r\n(Docker using `pulsar-all` container with release `2.3.0`\r\n\r\n**Additional context**\r\nWe're running Pulsar in a cluster.", "url": "https://github.com/apache/pulsar/issues/3908", "user": "devinbost", "labels": ["component/io", "type/bug"], "created": "2019-03-27 00:12:24", "closed": "2019-03-28 20:33:17", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "link failure", "body": "An error occurred while installing the Pulsar-connectors\r\n\r\n$ wget https://archive.apache.org/dist/pulsar/pulsar-2.3.0/apache-pulsar-io-connectors-2.3.0-bin.tar.gz\r\n\r\nHTTP Code is 404", "url": "https://github.com/apache/pulsar/issues/3903", "user": "Xlingxiao", "labels": ["type/bug", "type/question"], "created": "2019-03-26 11:20:49", "closed": "2019-04-09 15:27:39", "commits": {}, "ttf": 14.000277777777777, "commitsDetails": []}, {"title": "Functions/Source/Sink REST API page can't be loaded", "body": "**Describe the bug**\r\n\r\nhttp://pulsar.apache.org/functions-rest-api/ isn't loaded.\r\n\r\n**Screenshots**\r\n<img width=\"1666\" alt=\"Screen Shot 2019-03-25 at 10 39 18 PM\" src=\"https://user-images.githubusercontent.com/1217863/54973883-1a136480-4f4f-11e9-8cfd-d3757e6cc8e6.png\">\r\n\r\n**Context**\r\n\r\nIt might be related to #3871 \r\n\r\nSee comment at https://github.com/apache/pulsar/pull/3871#pullrequestreview-217072136", "url": "https://github.com/apache/pulsar/issues/3901", "user": "sijie", "labels": ["component/documentation", "type/bug"], "created": "2019-03-26 05:42:39", "closed": "2019-04-22 04:15:12", "commits": {}, "ttf": 26.00027777777778, "commitsDetails": []}, {"title": "ElasticSearchSink throws an NPE on records having a null key", "body": "**Describe the bug**\r\nElasticSearchSink throws NPEs on records having an empty key. There is an error in the extractKeyValue() method on the line extracting the key:\r\n`String key = record.getKey().orElseGet(null);`\r\nThis probably should be corrected to:\r\n`String key = record.getKey().orElse(null);`\r\n\r\n**To Reproduce**\r\nRun an ElasticSearchSink on a topic which records have empty keys\r\n\r\n**Expected behavior**\r\nNull keys should be ignored and records successfully pushed into elastic search\r\n\r\n\r\n**Additional context**\r\nTested with Pulsar v2.3.0\r\n", "url": "https://github.com/apache/pulsar/issues/3896", "user": "sv5d", "labels": ["type/bug"], "created": "2019-03-25 13:49:39", "closed": "2019-03-26 17:22:52", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "master branch non-partitioned topics create 500 Request failed", "body": "**Describe the bug**\r\ntopic create \r\n```shell\r\n$ ./bin/pulsar-admin topics create persistent://public/default/topic_1\r\n [jersey-client-async-executor-0] WARN  org.apache.pulsar.client.admin.internal.BaseResource - [http://localhost:8080/admin/v2/persistent/public/default/topic_1] Failed to perform http put request: javax.ws.rs.InternalServerErrorException: HTTP 500 Request failed.\r\nHTTP 500 Request failed.\r\n\r\nReason: HTTP 500 Request failed.\r\n```\r\nthen standalone info :\r\n``` shell \r\n$ bin/pulsar standalone\r\n...\r\n17:44:25.472 [pulsar-web-55-6] WARN  org.eclipse.jetty.server.HttpChannel - /admin/v2/persistent/public/default/topic_1\r\njavax.servlet.ServletException: javax.servlet.ServletException: java.lang.NullPointerException\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:174) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:503) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:364) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:305) [jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) [jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118) [jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_171]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_171]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_171]\r\nCaused by: javax.servlet.ServletException: java.lang.NullPointerException\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:432) ~[jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:370) ~[jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:389) ~[jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:342) ~[jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:229) ~[jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:865) ~[jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1655) ~[jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53) ~[pulsar-broker.jar:2.4.0-SNAPSHOT]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1642) ~[jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533) ~[jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1340) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) ~[jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1242) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:220) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\t... 17 more\r\nCaused by: java.lang.NullPointerException\r\n\tat org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreateNonPartitionedTopic(PersistentTopicsBase.java:402) ~[pulsar-broker.jar:2.4.0-SNAPSHOT]\r\n\tat org.apache.pulsar.broker.admin.v2.PersistentTopics.createNonPartitionedTopic(PersistentTopics.java:156) ~[pulsar-broker.jar:2.4.0-SNAPSHOT]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_171]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_171]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_171]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_171]\r\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:76) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:148) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:191) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:183) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:103) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:493) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:415) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:104) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:277) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) ~[jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) ~[jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:316) ~[jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:298) ~[jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:268) ~[jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:289) ~[jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:256) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:703) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:416) ~[jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:370) ~[jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:389) ~[jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:342) ~[jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:229) ~[jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:865) ~[jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1655) ~[jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53) ~[pulsar-broker.jar:2.4.0-SNAPSHOT]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1642) ~[jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533) ~[jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1340) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) ~[jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1242) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:220) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) ~[jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\t... 17 more\r\n```\r\n\r\n**To Reproduce**\r\n$ bin/pulsar standalone\r\n$ bin/pulsar-admin topics create persistent://public/default/topic_1\r\n\r\n**Expected behavior**\r\ncreate topic success.\r\n", "url": "https://github.com/apache/pulsar/issues/3895", "user": "ambition119", "labels": ["component/cli", "type/bug"], "created": "2019-03-25 10:04:53", "closed": "2019-03-27 15:47:03", "commits": {"ee7b6a44b0f9866a2e66c7b2f848b74804044c07": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "ee7b6a44b0f9866a2e66c7b2f848b74804044c07", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["ee98e8b28ce1397c056757fe73115d21320ed883"], "nameRev": "ee7b6a44b0f9866a2e66c7b2f848b74804044c07 tags/v2.4.0-candidate-1~425", "commitMessage": "[issue #3895] Bugfix for non partitioned topic create (#3910)\n\n**Motivation**\r\n\r\nProvide a different approach from #3902 trying to fix #3895.\r\n\r\n**Modifications**\r\n\r\n  - Add unit test in order to exploit issue.\r\n  - Do proper validations for non topic create.\r\n  - Add missing validateTopicName() method on create non partitioned topic.", "commitDateTime": "2019-03-27 08:47:02", "authoredDateTime": "2019-03-27 12:47:02", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 8, "deletions": 6, "lines": 14}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java", "insertions": 10, "deletions": 0, "lines": 10}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreateNonPartitionedTopic(boolean)", "TOT": 6, "UPD": 0, "INS": 4, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "PersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createNonPartitionedTopic(java.lang.String,java.lang.String,java.lang.String,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.PersistentTopicsTest.testCreateNonPartitionedTopic()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Running pulsar 2.3.0 locally as standalone throws an exception", "body": "**Describe the bug**\r\nI am trying to run pulsar 2.3.0 locally as standalone but i am getting an exception upon startup. I have successfully run it with pulsar 2.2.1. This is the corresponding [stack trace](https://github.com/apache/pulsar/files/2997143/pulsar-logs.txt).\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n\r\nFollow the instructions [here](https://pulsar.apache.org/docs/en/standalone/) to run pulsar 2.3.0 locally as standalone:\r\n\r\n```\r\nwget https://archive.apache.org/dist/pulsar/pulsar-2.3.0/apache-pulsar-2.3.0-bin.tar.gz\r\n$ tar xvfz apache-pulsar-2.3.0-bin.tar.gz\r\n$ cd apache-pulsar-2.3.0\r\n$ bin/pulsar standalone\r\n```\r\n**Expected behavior**\r\nStartup pulsar 2.3.0 locally as standalone successfully.\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Linux\r\n", "url": "https://github.com/apache/pulsar/issues/3886", "user": "gkatiforis", "labels": ["type/bug"], "created": "2019-03-22 15:33:43", "closed": "2019-03-24 09:40:58", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Error go get pulsar: fatal: unable to access 'https://gopkg.in/natefinch/lumberjack.v2/'", "body": "**Describe the bug**\r\nI executed the command:\r\n```shell\r\ngo get -u github.com/apache/pulsar/pulsar-client-go/pulsar\r\n```\r\nOutput:\r\n```shell\r\nfatal: unable to access 'https://gopkg.in/natefinch/lumberjack.v2/': Operation timed out after 300015 milliseconds with 0 out of 0 bytes received\r\npackage gopkg.in/natefinch/lumberjack.v2: exit status 1\r\n```", "url": "https://github.com/apache/pulsar/issues/3883", "user": "fananchong", "labels": ["type/bug"], "created": "2019-03-22 10:40:23", "closed": "2019-03-25 03:40:28", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Read timeout on Presto query", "body": "**Describe the bug**\r\nUnable to retrieve schema for a persistent topic using the Presto SQL engine\r\n\r\n**To Reproduce**\r\n1. Start Pulsar in Standalone mode\r\n2. Create a persistent topic named persistent://auto/electric/tesla`\r\n3. Start the Presto SQL engine\r\n4. Run the following command using the admin CLI tool ./pulsar-admin topics list auto/electric\r\n\r\npresto> show schemas in pulsar;\r\n       Schema\r\n-----------------------\r\nauto/electric\r\ninformation_schema\r\nnest/cicd\r\nnest/testnamespace\r\npublic/default\r\npublic/functions\r\nsample/standalone/ns1\r\n(7 rows)\r\n\r\nQuery 20190321_153056_00000_zmkw9, FINISHED, 1 node\r\nSplits: 19 total, 19 done (100.00%)\r\n0:04 [7 rows, 144B] [1 rows/s, 36B/s]\r\n\r\npresto> show tables in pulsar.\"auto/electric\";\r\nQuery 20190321_153118_00001_zmkw9 failed: Failed to get tables/topics in auto/electric: Read timed out\r\n\r\n5. Look in the standalone log file (should be the session window where you started pulsar)\r\n6. See the following stack trace\r\n\r\n15:32:19.327 [pulsar-web-56-4] ERROR org.apache.pulsar.broker.admin.v2.NonPersistentTopics - [null] Failed to get list of topics under namespace auto/electric\r\njava.util.concurrent.ExecutionException: org.apache.pulsar.client.admin.PulsarAdminException: java.net.SocketTimeoutException: Read timed out\r\n    at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357) ~[?:1.8.0_111]\r\n    at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895) ~[?:1.8.0_111]\r\n    at org.apache.pulsar.broker.admin.v2.NonPersistentTopics.getList(NonPersistentTopics.java:186) ~[org.apache.pulsar-pulsar-broker-2.3.0.jar:2.3.0]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_111]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_111]\r\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_111]\r\n    at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_111]\r\n    at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:76) ~[org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:148) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:191) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$TypeOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:243) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:103) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:493) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:415) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:104) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:277) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:316) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:298) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:268) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:289) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:256) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:703) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:416) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n    at org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:370) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n    at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:389) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n    at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:342) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n    at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:229) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:865) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1655) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53) [org.apache.pulsar-pulsar-broker-2.3.0.jar:2.3.0]\r\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1642) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1340) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1242) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:220) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:174) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.Server.handle(Server.java:503) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:364) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:305) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_111]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_111]\r\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at java.lang.Thread.run(Thread.java:745) [?:1.8.0_111]\r\nCaused by: org.apache.pulsar.client.admin.PulsarAdminException: java.net.SocketTimeoutException: Read timed out\r\n    at org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:187) ~[org.apache.pulsar-pulsar-client-admin-original-2.3.0.jar:2.3.0]\r\n    at org.apache.pulsar.client.admin.internal.TopicsImpl$5.failed(TopicsImpl.java:157) ~[org.apache.pulsar-pulsar-client-admin-original-2.3.0.jar:2.3.0]\r\n    at org.glassfish.jersey.client.JerseyInvocation$4.failed(JerseyInvocation.java:1030) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime.processFailure(ClientRuntime.java:231) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime.access$100(ClientRuntime.java:85) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime$2.lambda$failure$1(ClientRuntime.java:183) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:316) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:298) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:312) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime$2.failure(ClientRuntime.java:183) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.internal.HttpUrlConnector.apply(HttpUrlConnector.java:294) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime.lambda$null$3(ClientRuntime.java:187) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:316) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:298) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:312) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime.lambda$createRunnableForAsyncProcessing$4(ClientRuntime.java:163) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_111]\r\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_111]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_111]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_111]\r\n    ... 1 more\r\nCaused by: java.net.SocketTimeoutException: Read timed out\r\n    at java.net.SocketInputStream.socketRead0(Native Method) ~[?:1.8.0_111]\r\n    at java.net.SocketInputStream.socketRead(SocketInputStream.java:116) ~[?:1.8.0_111]\r\n    at java.net.SocketInputStream.read(SocketInputStream.java:170) ~[?:1.8.0_111]\r\n    at java.net.SocketInputStream.read(SocketInputStream.java:141) ~[?:1.8.0_111]\r\n    at java.io.BufferedInputStream.fill(BufferedInputStream.java:246) ~[?:1.8.0_111]\r\n    at java.io.BufferedInputStream.read1(BufferedInputStream.java:286) ~[?:1.8.0_111]\r\n    at java.io.BufferedInputStream.read(BufferedInputStream.java:345) ~[?:1.8.0_111]\r\n    at sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:704) ~[?:1.8.0_111]\r\n    at sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:647) ~[?:1.8.0_111]\r\n    at sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1569) ~[?:1.8.0_111]\r\n    at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1474) ~[?:1.8.0_111]\r\n    at java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:480) ~[?:1.8.0_111]\r\n    at org.glassfish.jersey.client.internal.HttpUrlConnector._apply(HttpUrlConnector.java:390) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.internal.HttpUrlConnector.apply(HttpUrlConnector.java:292) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime.lambda$null$3(ClientRuntime.java:187) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:316) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:298) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:312) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime.lambda$createRunnableForAsyncProcessing$4(ClientRuntime.java:163) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_111]\r\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_111]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_111]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_111]\r\n    ... 1 more\r\n15:32:19.338 [pulsar-web-56-4] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:31:19 +0000] \"GET /admin/v2/non-persistent/auto/electric HTTP/1.1\" 500 3400 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 60111\r\n15:32:19.351 [pulsar-web-56-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:32:19 +0000] \"GET /admin/v2/non-persistent/auto/electric/0x80000000_0xc0000000 HTTP/1.1\" 200 36 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 3\r\n15:32:19.359 [pulsar-web-56-3] INFO  org.apache.pulsar.broker.admin.v2.NonPersistentTopics - [null] Namespace bundle is not owned by any broker auto/electric/0xc0000000_0xffffffff\r\n15:32:19.359 [pulsar-web-56-3] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:32:19 +0000] \"GET /admin/v2/non-persistent/auto/electric/0xc0000000_0xffffffff HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 8\r\n15:32:19.359 [pulsar-web-56-1] INFO  org.apache.pulsar.broker.admin.v2.NonPersistentTopics - [null] Namespace bundle is not owned by any broker auto/electric/0x00000000_0x40000000\r\n15:32:19.360 [pulsar-web-56-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:32:19 +0000] \"GET /admin/v2/non-persistent/auto/electric/0x00000000_0x40000000 HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 9\r\n15:32:19.370 [pulsar-web-56-1] INFO  org.apache.pulsar.broker.admin.v2.NonPersistentTopics - [null] Namespace bundle is not owned by any broker auto/electric/0x40000000_0x80000000\r\n15:32:19.371 [pulsar-web-56-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:32:19 +0000] \"GET /admin/v2/non-persistent/auto/electric/0x40000000_0x80000000 HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 11\r\n15:32:19.373 [pulsar-web-56-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:32:19 +0000] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 824 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 2\r\n15:32:19.442 [pulsar-web-56-4] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:32:19 +0000] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 824 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 3\r\n15:32:47.992 [pulsar-web-56-3] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:32:47 +0000] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 824 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 3\r\n\r\n**Expected behavior**\r\nWe expect a list of the schemas to be returned\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Linux\r\n- EC2 instance\r\n", "url": "https://github.com/apache/pulsar/issues/3878", "user": "david-streamlio", "labels": ["component/sql", "type/bug"], "created": "2019-03-21 16:04:19", "closed": "2019-11-04 04:59:31", "commits": {}, "ttf": 227.00027777777777, "commitsDetails": []}, {"title": "Read timeout when listing topics ", "body": "**Describe the bug**\r\nA socket timeout occurs when we issue the following command from the pulsar-admin CLI:\r\n\r\n./pulsar-admin topics list auto/electric\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Start Pulsar in Standalone mode\r\n2. Create a persistent topic named persistent://auto/electric/tesla`\r\n3. Run the following command using the admin CLI tool `./pulsar-admin topics list auto/electric`\r\n4. Look in the standalone log file (should be the session window where you started pulsar)\r\n5. See the following stack trace\r\n\r\n15:26:16.684 [pulsar-web-56-1] ERROR org.apache.pulsar.broker.admin.v2.NonPersistentTopics - [null] Failed to get list of topics under namespace auto/electric\r\njava.util.concurrent.ExecutionException: org.apache.pulsar.client.admin.PulsarAdminException: java.net.SocketTimeoutException: Read timed out\r\n    at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357) ~[?:1.8.0_111]\r\n    at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895) ~[?:1.8.0_111]\r\n    at org.apache.pulsar.broker.admin.v2.NonPersistentTopics.getList(NonPersistentTopics.java:186) ~[org.apache.pulsar-pulsar-broker-2.3.0.jar:2.3.0]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_111]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_111]\r\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_111]\r\n    at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_111]\r\n    at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:76) ~[org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:148) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:191) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$TypeOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:243) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:103) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:493) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:415) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:104) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:277) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:316) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:298) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:268) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:289) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:256) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:703) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n    at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:416) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n    at org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:370) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n    at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:389) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n    at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:342) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n    at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:229) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:865) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1655) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53) [org.apache.pulsar-pulsar-broker-2.3.0.jar:2.3.0]\r\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1642) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1340) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1242) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:220) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:174) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.Server.handle(Server.java:503) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:364) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:305) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_111]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_111]\r\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at java.lang.Thread.run(Thread.java:745) [?:1.8.0_111]\r\nCaused by: org.apache.pulsar.client.admin.PulsarAdminException: java.net.SocketTimeoutException: Read timed out\r\n    at org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:187) ~[org.apache.pulsar-pulsar-client-admin-original-2.3.0.jar:2.3.0]\r\n    at org.apache.pulsar.client.admin.internal.TopicsImpl$5.failed(TopicsImpl.java:157) ~[org.apache.pulsar-pulsar-client-admin-original-2.3.0.jar:2.3.0]\r\n    at org.glassfish.jersey.client.JerseyInvocation$4.failed(JerseyInvocation.java:1030) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime.processFailure(ClientRuntime.java:231) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime.access$100(ClientRuntime.java:85) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime$2.lambda$failure$1(ClientRuntime.java:183) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:316) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:298) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:312) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime$2.failure(ClientRuntime.java:183) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.internal.HttpUrlConnector.apply(HttpUrlConnector.java:294) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime.lambda$null$3(ClientRuntime.java:187) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:316) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:298) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:312) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime.lambda$createRunnableForAsyncProcessing$4(ClientRuntime.java:163) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_111]\r\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_111]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_111]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_111]\r\n    ... 1 more\r\nCaused by: java.net.SocketTimeoutException: Read timed out\r\n    at java.net.SocketInputStream.socketRead0(Native Method) ~[?:1.8.0_111]\r\n    at java.net.SocketInputStream.socketRead(SocketInputStream.java:116) ~[?:1.8.0_111]\r\n    at java.net.SocketInputStream.read(SocketInputStream.java:170) ~[?:1.8.0_111]\r\n    at java.net.SocketInputStream.read(SocketInputStream.java:141) ~[?:1.8.0_111]\r\n    at java.io.BufferedInputStream.fill(BufferedInputStream.java:246) ~[?:1.8.0_111]\r\n    at java.io.BufferedInputStream.read1(BufferedInputStream.java:286) ~[?:1.8.0_111]\r\n    at java.io.BufferedInputStream.read(BufferedInputStream.java:345) ~[?:1.8.0_111]\r\n    at sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:704) ~[?:1.8.0_111]\r\n    at sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:647) ~[?:1.8.0_111]\r\n    at sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1569) ~[?:1.8.0_111]\r\n    at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1474) ~[?:1.8.0_111]\r\n    at java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:480) ~[?:1.8.0_111]\r\n    at org.glassfish.jersey.client.internal.HttpUrlConnector._apply(HttpUrlConnector.java:390) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.internal.HttpUrlConnector.apply(HttpUrlConnector.java:292) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime.lambda$null$3(ClientRuntime.java:187) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:316) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:298) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.internal.Errors.process(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:312) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n    at org.glassfish.jersey.client.ClientRuntime.lambda$createRunnableForAsyncProcessing$4(ClientRuntime.java:163) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_111]\r\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_111]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_111]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_111]\r\n    ... 1 more\r\n15:26:16.696 [pulsar-web-56-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:25:16 +0000] \"GET /admin/v2/non-persistent/auto/electric HTTP/1.1\" 500 3400 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 60206\r\n15:26:16.703 [pulsar-web-56-1] INFO  org.apache.pulsar.broker.admin.v2.NonPersistentTopics - [null] Namespace bundle is not owned by any broker auto/electric/0x40000000_0x80000000\r\n15:26:16.704 [pulsar-web-56-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:26:16 +0000] \"GET /admin/v2/non-persistent/auto/electric/0x40000000_0x80000000 HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 7\r\n15:26:16.706 [pulsar-web-56-1] INFO  org.apache.pulsar.broker.admin.v2.NonPersistentTopics - [null] Namespace bundle is not owned by any broker auto/electric/0x00000000_0x40000000\r\n15:26:16.707 [pulsar-web-56-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:26:16 +0000] \"GET /admin/v2/non-persistent/auto/electric/0x00000000_0x40000000 HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 3\r\n15:26:16.709 [pulsar-web-56-1] INFO  org.apache.pulsar.broker.admin.v2.NonPersistentTopics - [null] Namespace bundle is not owned by any broker auto/electric/0xc0000000_0xffffffff\r\n15:26:16.709 [pulsar-web-56-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:26:16 +0000] \"GET /admin/v2/non-persistent/auto/electric/0xc0000000_0xffffffff HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 2\r\n15:26:16.711 [pulsar-web-56-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:26:16 +0000] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 824 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 1\r\n15:26:16.714 [pulsar-web-56-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:26:16 +0000] \"GET /admin/v2/non-persistent/auto/electric/0x80000000_0xc0000000 HTTP/1.1\" 200 36 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 2\r\n15:26:16.745 [pulsar-web-56-4] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:26:16 +0000] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 824 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 2\r\n15:26:17.993 [pulsar-web-56-4] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:26:17 +0000] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 824 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 2\r\n15:26:47.992 [pulsar-web-56-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:26:47 +0000] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 824 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 3\r\n15:27:17.991 [pulsar-web-56-4] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:27:17 +0000] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 824 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 2\r\n15:27:47.992 [pulsar-web-56-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:27:47 +0000] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 824 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 3\r\n15:28:17.995 [pulsar-web-56-4] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [21/Mar/2019:15:28:17 +0000] \"GET /admin/v2/persistent/public/functions/coordinate/stats HTTP/1.1\" 200 824 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_111)\" 5\r\n\r\n**Expected behavior**\r\nThe command should return the value `tesla`, as that is the only topic in that namespace\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Linux\r\nEC2 instance\r\n", "url": "https://github.com/apache/pulsar/issues/3877", "user": "david-streamlio", "labels": ["component/sql", "type/bug"], "created": "2019-03-21 15:59:33", "closed": "2019-11-04 04:58:33", "commits": {}, "ttf": 227.00027777777777, "commitsDetails": []}, {"title": "Exception when getting function stats", "body": "**Describe the bug**\r\nException when getting function stats\r\n\r\n```\r\n21:05:21.008 [pulsar-web-69-13:org.apache.pulsar.functions.worker.rest.api.FunctionsImpl@255] ERROR org.apache.pulsar.functions.worker.rest.api.FunctionsImpl - external-repl-prop/test-ns/PulsarFunction-test Got Exception Getting Status\r\njava.lang.NullPointerException: null\r\n\tat org.apache.pulsar.functions.instance.JavaInstanceRunnable.getFunctionStatus(JavaInstanceRunnable.java:554) ~[classes/:?]\r\n\tat org.apache.pulsar.functions.runtime.ThreadRuntime.getFunctionStatus(ThreadRuntime.java:153) ~[classes/:?]\r\n\tat org.apache.pulsar.functions.runtime.RuntimeSpawner.getFunctionStatus(RuntimeSpawner.java:117) ~[classes/:?]\r\n\tat org.apache.pulsar.functions.worker.rest.api.ComponentImpl$GetStatus.getComponentInstanceStatus(ComponentImpl.java:183) ~[classes/:?]\r\n\tat org.apache.pulsar.functions.worker.rest.api.FunctionsImpl$GetFunctionStatus.getStatus(FunctionsImpl.java:119) ~[classes/:?]\r\n\tat org.apache.pulsar.functions.worker.rest.api.FunctionsImpl$GetFunctionStatus.getStatus(FunctionsImpl.java:42) ~[classes/:?]\r\n\tat org.apache.pulsar.functions.worker.rest.api.ComponentImpl$GetStatus.getComponentStatus(ComponentImpl.java:267) ~[classes/:?]\r\n\tat org.apache.pulsar.functions.worker.rest.api.FunctionsImpl.getFunctionStatus(FunctionsImpl.java:251) ~[classes/:?]\r\n\tat org.apache.pulsar.broker.admin.impl.FunctionsBase.getFunctionStatus(FunctionsBase.java:180) ~[classes/:?]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_144]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_144]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_144]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_144]\r\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:76) ~[jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:148) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:191) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$TypeOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:243) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:103) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:493) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:415) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:104) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:277) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) [jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) [jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:316) [jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:298) [jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:268) [jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:289) [jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:256) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:703) [jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:416) [jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:370) [jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:389) [jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:342) [jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:229) [jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:865) [jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1655) [jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53) [classes/:?]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1642) [jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.apache.pulsar.broker.web.AuthenticationFilter.doFilter(AuthenticationFilter.java:75) [classes/:?]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1642) [jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533) [jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1340) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1242) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:220) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:174) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:503) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:364) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260) [jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:305) [jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) [jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118) [jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366) [jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_144]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_144]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_144]\r\n```\r\n\r\nMay happen when instance is not fully initialized?  Need to check null", "url": "https://github.com/apache/pulsar/issues/3873", "user": "jerrypeng", "labels": ["type/bug"], "created": "2019-03-21 02:10:05", "closed": "2019-03-27 06:21:59", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "Provide the description of sink/source command for better usage", "body": "**Describe the bug**\r\nCurrently, it shows as bellow when providing zero args in command `sink` or `source`:\r\n```\r\n$ bin/pulsar-admin sink create\r\nSink archive not specfied\r\n\r\n$ bin/pulsar-admin sink update\r\nnull\r\n\r\nReason: java.lang.NullPointerException: path is 'null'\r\n\r\n$ bin/pulsar-admin sink get\r\njava.lang.RuntimeException: You must specify a name for the sink\r\n\tat org.apache.pulsar.admin.cli.CmdSinks$SinkCommand.processArguments(CmdSinks.java:488)\r\n\tat org.apache.pulsar.admin.cli.CmdSinks$BaseCommand.run(CmdSinks.java:105)\r\n\tat org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:62)\r\n\tat org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:193)\r\n\tat org.apache.pulsar.admin.cli.PulsarAdminTool.main(PulsarAdminTool.java:235)\r\n```\r\nIt is better to show the description of subcommands when missing some parameters.\r\n\r\n**Expected behavior**\r\n```\r\n$ bin/pulsar-admin sink get\r\nYou must specify a name for the sink\r\n\r\nGets the information about a Pulsar IO sink connector\r\nUsage: get [options]\r\n  Options:\r\n    --name\r\n       The sink's name\r\n    --namespace\r\n       The sink's namespace\r\n    --tenant\r\n       The sink's tenant\r\n\r\n$ bin/pulsar-admin sink create\r\nSink archive not specfied\r\n\r\nSubmit a Pulsar IO sink connector to run in a Pulsar cluster\r\nUsage: create [options]\r\n  Options:\r\n    -a, --archive\r\n       Path to the archive file for the sink. It also supports url-path\r\n       [http/https/file (file protocol assumes that file already exists on worker host)] from\r\n       which worker can download the package.\r\n    --auto-ack\r\n       Whether or not the framework will automatically acknowleges messages\r\n    --classname\r\n       The sink's class name if archive is file-url-path (file://)\r\n    ... ...\r\n\r\n$ bin/pulsar-admin sink update\r\nSink archive not specfied\r\n\r\nUpdate a Pulsar IO sink connector\r\nUsage: update [options]\r\n  Options:\r\n    -a, --archive\r\n       Path to the archive file for the sink. It also supports url-path\r\n       [http/https/file (file protocol assumes that file already exists on worker host)] from\r\n       which worker can download the package.\r\n    --auto-ack\r\n       Whether or not the framework will automatically acknowleges messages\r\n    ... ...\r\n```\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3867", "user": "murong00", "labels": ["component/io", "type/bug", "type/enhancement"], "created": "2019-03-20 06:42:59", "closed": "2019-03-29 04:39:55", "commits": {"07030e3af46f0f22805a1f51869501bee37bbe1b": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 8.000277777777777, "commitsDetails": [{"commitHash": "07030e3af46f0f22805a1f51869501bee37bbe1b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f3095d8697ccbe62e4676f94e671047a82bebe40"], "nameRev": "07030e3af46f0f22805a1f51869501bee37bbe1b tags/v2.4.0-candidate-1~408", "commitMessage": "[Issue 3867] Provide the description of sink/source command for better usage (#3868)\n\n### Motivation\r\n\r\nFixes #3867\r\n\r\n### Modifications\r\n\r\nAdd the usage of chosen subcommand when `processArguments` failed.\r\n", "commitDateTime": "2019-03-28 21:39:54", "authoredDateTime": "2019-03-29 12:39:54", "commitGitStats": [{"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdSinks.java", "insertions": 9, "deletions": 1, "lines": 10}, {"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdSources.java", "insertions": 9, "deletions": 1, "lines": 10}], "commitSpoonAstDiffStats": [{"spoonFilePath": "CmdSinks.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdSinks.BaseCommand.run()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "CmdSources.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdSources.BaseCommand.run()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Unable to update builtin sink/source from cli or rest api", "body": "**Describe the bug**\r\nUpdating a builtin sink/source from the cli does not work\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n`CLI`\r\n1. Create a builtin sink/source\r\n```\r\n/bin/pulsar-admin sink create --tenant public --namespace default --name test --inputs source-topic --sink-type data-generator\r\n```\r\n2. Try up update the sink with cli\r\n```\r\n./bin/pulsar-admin sink update --tenant public --namespace default --name test-sink  --parallelism 2\r\n```\r\noutput:\r\n```\r\nInvalid stream name : 'Invalid log name \"/builtin://data-generator\" caused by empty node name specified @10'\r\n\r\nReason: Invalid stream name : 'Invalid log name \"/builtin://data-generator\" caused by empty node name specified @10'\r\n```\r\n\r\n3. Try to update the sink through the rest endpoint\r\n\r\ndata-gen-sink-config.json\r\n```\r\n{\r\n  \"tenant\": \"public\",\r\n  \"namespace\": \"default\",\r\n  \"name\": \"test-sink\",\r\n  \"className\": \"org.apache.pulsar.io.datagenerator.DataGeneratorPrintSink\",\r\n  \"inputSpecs\": {\r\n    \"source-topic\": {\r\n      \"regexPattern\": false\r\n    }\r\n  },\r\n  \"parallelism\": 2,\r\n  \"processingGuarantees\": \"ATLEAST_ONCE\",\r\n  \"retainOrdering\": false,\r\n  \"autoAck\": true,\r\n  \"archive\": \"builtin://data-generator\"\r\n}\r\n```\r\n\r\n\r\n```\r\nChriss-MacBook-Pro:apps chris$ curl  -v -X PUT -F sinkConfig=@data-gen-sink-config.json http://localhost:8080/admin/v3/sink/public/default/test-sink\r\n*   Trying ::1...\r\n* TCP_NODELAY set\r\n* Connection failed\r\n* connect to ::1 port 8080 failed: Connection refused\r\n*   Trying 127.0.0.1...\r\n* TCP_NODELAY set\r\n* Connected to localhost (127.0.0.1) port 8080 (#0)\r\n> PUT /admin/v3/sink/public/default/test-sink HTTP/1.1\r\n> Host: localhost:8080\r\n> User-Agent: curl/7.54.0\r\n> Accept: */*\r\n> Content-Length: 602\r\n> Expect: 100-continue\r\n> Content-Type: multipart/form-data; boundary=------------------------03ae3a9959723916\r\n> \r\n< HTTP/1.1 100 Continue\r\n< HTTP/1.1 400 Bad Request\r\n< Date: Mon, 18 Mar 2019 22:36:33 GMT\r\n< Content-Type: application/json\r\n< Content-Length: 123\r\n< Server: Jetty(9.4.12.v20180830)\r\n* HTTP error before end of send, stop sending\r\n< \r\n* Closing connection 0\r\n{\"reason\":\"Invalid stream name : 'Invalid log name \\\"/builtin://data-generator\\\" caused by empty node name specified @10'\"}Chriss-MacBook-Pro:apps chris$ \r\n```\r\n\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3860", "user": "cckellogg", "labels": ["component/io", "type/bug"], "created": "2019-03-18 22:41:01", "closed": "2019-03-30 01:35:19", "commits": {}, "ttf": 11.000277777777777, "commitsDetails": []}, {"title": "java.net.BindException when starting broker via the config initialized in cluster metadata", "body": "**Describe the bug**\r\nSomeone may change the port of service urls via `initialize-cluster-metadata` following the [Deploying a Pulsar instance](https://pulsar.apache.org/docs/en/deploy-bare-metal/) guide when the default ports (e.g. `8080`) have been already used:\r\n```\r\n$ bin/pulsar initialize-cluster-metadata \\\r\n  --cluster pulsar-cluster-test \\\r\n  --zookeeper localhost:2181 \\\r\n  --configuration-store localhost:2181 \\\r\n  --web-service-url http://localhost:8181 \\\r\n  --web-service-url-tls https://localhost:8443 \\\r\n  --broker-service-url pulsar://localhost:6656 \\\r\n  --broker-service-url-tls pulsar+ssl://localhost:6651\r\n```\r\nHowever, when trying to start a broker after initializing the above cluster metadata, it results in the following Exception:\r\n```\r\n13:50:37.308 [main] ERROR org.apache.pulsar.PulsarBrokerStarter - Failed to start pulsar service.\r\norg.apache.pulsar.broker.PulsarServerException: org.apache.pulsar.broker.PulsarServerException: java.net.BindException: Address already in use\r\n        at org.apache.pulsar.broker.PulsarService.start(PulsarService.java:448) ~[org.apache.pulsar-pulsar-broker-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.PulsarBrokerStarter$BrokerStarter.start(PulsarBrokerStarter.java:239) ~[org.apache.pulsar-pulsar-broker-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.PulsarBrokerStarter.main(PulsarBrokerStarter.java:293) [org.apache.pulsar-pulsar-broker-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\nCaused by: org.apache.pulsar.broker.PulsarServerException: java.net.BindException: Address already in use\r\n        at org.apache.pulsar.broker.web.WebService.start(WebService.java:192) ~[org.apache.pulsar-pulsar-broker-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        at org.apache.pulsar.broker.PulsarService.start(PulsarService.java:427) ~[org.apache.pulsar-pulsar-broker-2.4.0-SNAPSHOT.jar:2.4.0-SNAPSHOT]\r\n        ... 2 more\r\nCaused by: java.net.BindException: Address already in use\r\n        at sun.nio.ch.Net.bind0(Native Method) ~[?:1.8.0_112]\r\n        at sun.nio.ch.Net.bind(Net.java:433) ~[?:1.8.0_112]\r\n        at sun.nio.ch.Net.bind(Net.java:425) ~[?:1.8.0_112]\r\n        at sun.nio.ch.ServerSocketChannelImpl.bind(ServerSocketChannelImpl.java:223) ~[?:1.8.0_112]\r\n        at sun.nio.ch.ServerSocketAdaptor.bind(ServerSocketAdaptor.java:74) ~[?:1.8.0_112]\r\n        at org.eclipse.jetty.server.ServerConnector.openAcceptChannel(ServerConnector.java:339) ~[org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at org.eclipse.jetty.server.ServerConnector.open(ServerConnector.java:307) ~[org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at org.eclipse.jetty.server.AbstractNetworkConnector.doStart(AbstractNetworkConnector.java:80) ~[org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at org.eclipse.jetty.server.ServerConnector.doStart(ServerConnector.java:235) ~[org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68) ~[org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at org.eclipse.jetty.server.Server.doStart(Server.java:395) ~[org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n        at org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:68) ~[org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n```", "url": "https://github.com/apache/pulsar/issues/3851", "user": "murong00", "labels": ["component/broker", "type/bug"], "created": "2019-03-18 09:34:40", "closed": "2019-04-02 04:21:49", "commits": {"2e934529d940bdd1b271ea0913249d787fc78ec4": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 14.000277777777777, "commitsDetails": [{"commitHash": "2e934529d940bdd1b271ea0913249d787fc78ec4", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["4101168fbf5689af0eac37e1fc03195778f544d5"], "nameRev": "2e934529d940bdd1b271ea0913249d787fc78ec4 tags/v2.4.0-candidate-1~385", "commitMessage": "[Issue 3851] [pulsar-broker] Support to start broker use the port initialized in cluster metadata (#3853)\n\n### Motivation\r\n\r\nFixes #3851\r\n\r\n### Modifications\r\n\r\nOverride the port of service urls in brokerConfig by the config initialized in cluster metadata.", "commitDateTime": "2019-04-01 21:21:48", "authoredDateTime": "2019-04-02 12:21:48", "commitGitStats": [{"filePath": "site2/docs/deploy-bare-metal-multi-cluster.md", "insertions": 13, "deletions": 1, "lines": 14}, {"filePath": "site2/docs/deploy-bare-metal.md", "insertions": 11, "deletions": 2, "lines": 13}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "The numberOfRecords is always not more than 1 in pulsar-kafka-wrapper-consumer", "body": "**Describe the bug**\r\n- When the loop begin, \"++numberOfRecords \" is 1, so  \"[++numberOfRecords < MAX_RECORDS_IN_SINGLE_POLL](https://github.com/apache/pulsar/blob/da2bb660461345f11446635298c2fdd35955ac32/pulsar-client-kafka-compat/pulsar-client-kafka/src/main/java/org/apache/kafka/clients/consumer/PulsarKafkaConsumer.java#L357)\" is true, which will lead to the loop exit right now. \r\n- As a result, the value of numberOfRecords is always not more than 1.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. **++numberOfRecords > MAX_RECORDS_IN_SINGLE_POLL**\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3850", "user": "se7enkings", "labels": ["component/kafka", "help wanted", "type/bug"], "created": "2019-03-18 08:38:33", "closed": "2019-03-19 17:37:02", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Document default of schema-autoupdate-strategy : FULL", "body": "**Describe the bug**\r\nDoc bug. The document is missing default value for schema-autoupdate-strategy compatibilty\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to https://pulsar.apache.org/docs/en/pulsar-admin/#set-schema-autoupdate-strategy\r\n2. In the options sections see the empty default box in front of compatibility.\r\n\r\n**Expected behavior**\r\nDocument default value which is FULL\r\n\r\n**Screenshots**\r\n<img width=\"831\" alt=\"Screenshot 2019-03-16 at 9 09 30 PM\" src=\"https://user-images.githubusercontent.com/5674919/54477689-03269100-4830-11e9-9e0e-5f21a9172f80.png\">\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3839", "user": "shiv4289", "labels": ["type/bug"], "created": "2019-03-16 15:41:29", "closed": "2019-03-19 19:13:31", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "Pulsar SQL is not able to read the latest message", "body": "**Describe the bug**\r\n\r\nPulsar SQL is always lacking one message when querying pulsar topics.\r\n\r\n**Expected behavior**\r\n\r\n\"read-my-write\" semantic.\r\n\r\nif I write a bunch of messages to pulsar topics, and issue a query after \"my-write\", I should be able to query all the messages I written.\r\n\r\n**Reason**\r\n\r\nThe problem is due to broker doesn't advance LAC, so when pulsar sql bypasses broker to query the data, it can only read entries up to the LAC that all the bookies learned. \r\n\r\n**Fixes**\r\n\r\nEnable periodically write lac on broker.\r\n", "url": "https://github.com/apache/pulsar/issues/3828", "user": "sijie", "labels": ["component/sql", "release/2.5.2", "triage/week-44", "type/bug"], "created": "2019-03-15 03:40:25", "closed": "2020-02-10 00:34:18", "commits": {"4fd17d412c7368f79bf6c82497403e70d17474a6": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "c421d26e4d7a0de96fa186a844fc92991e60165c": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 331.0002777777778, "commitsDetails": [{"commitHash": "4fd17d412c7368f79bf6c82497403e70d17474a6", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["04ed23c019eec7e15dccc780bf6ee8e2e987cb24"], "nameRev": "4fd17d412c7368f79bf6c82497403e70d17474a6 tags/v2.6.0-candidate-1~532", "commitMessage": "Expose bookkeeper expose explicit lac in broker.conf (#5822)\n\n### Motivation\r\n\r\nExpose bookkeeper expose explicit lac configuration in broker.conf\r\nIt's related to #3828 #4976, some Pulsar SQL users need to enable the explicitLacInterval, so that they can get the last message in Pulsar SQL.", "commitDateTime": "2020-02-10 08:31:21", "authoredDateTime": "2020-02-10 08:31:21", "commitGitStats": [{"filePath": "conf/broker.conf", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "conf/standalone.conf", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/BookKeeperClientFactoryImpl.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/PulsarBrokerStarterTest.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/BookKeeperClientFactoryImplTest.java", "insertions": 9, "deletions": 0, "lines": 9}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServiceConfiguration.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.ServiceConfiguration", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BookKeeperClientFactoryImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.BookKeeperClientFactoryImpl.createBkClientConfiguration(org.apache.pulsar.broker.ServiceConfiguration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarBrokerStarterTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.PulsarBrokerStarterTest.createValidBrokerConfigFile()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.PulsarBrokerStarterTest.testLoadConfig()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BookKeeperClientFactoryImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.BookKeeperClientFactoryImplTest.testSetExplicitLacInterval()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "c421d26e4d7a0de96fa186a844fc92991e60165c", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["f95aebb6799bf43731f4e321ec4d9f523a2cd3ba"], "nameRev": "c421d26e4d7a0de96fa186a844fc92991e60165c tags/v2.5.1-candidate-3~124", "commitMessage": "Expose bookkeeper expose explicit lac in broker.conf (#5822)\n\n### Motivation\r\n\r\nExpose bookkeeper expose explicit lac configuration in broker.conf\r\nIt's related to #3828 #4976, some Pulsar SQL users need to enable the explicitLacInterval, so that they can get the last message in Pulsar SQL.\n\n(cherry picked from commit 4fd17d412c7368f79bf6c82497403e70d17474a6)\n", "commitDateTime": "2020-04-13 11:06:28", "authoredDateTime": "2020-02-10 08:31:21", "commitGitStats": [{"filePath": "conf/broker.conf", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "conf/standalone.conf", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/BookKeeperClientFactoryImpl.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/PulsarBrokerStarterTest.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/BookKeeperClientFactoryImplTest.java", "insertions": 9, "deletions": 0, "lines": 9}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ServiceConfiguration.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.ServiceConfiguration", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BookKeeperClientFactoryImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.BookKeeperClientFactoryImpl.createBkClientConfiguration(org.apache.pulsar.broker.ServiceConfiguration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarBrokerStarterTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.PulsarBrokerStarterTest.createValidBrokerConfigFile()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.PulsarBrokerStarterTest.testLoadConfig()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BookKeeperClientFactoryImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.BookKeeperClientFactoryImplTest.testSetExplicitLacInterval()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "failed to load RocksDB jni library", "body": "pulsar version 2.3\r\njava version java8\r\nrocksdbjni-5.13.1\r\n\r\nAt first I got an error: \"invalid -XX:MaxDirectMemory=4g\"  (default config) and  \"The specified size exceeds the maximum representable size.\".\r\nThen I changed it to 3g and I got \"failed to load RocksDB jni library\"\r\n\r\nHere's the error now:\r\nException in thread \"main\" java.io.IOException: Failed to load RocksDB JNI library\r\n\tat org.apache.bookkeeper.bookie.storage.ldb.KeyValueStorageRocksDB.<init>(KeyValueStorageRocksDB.java:91)\r\n\tat org.apache.bookkeeper.bookie.storage.ldb.KeyValueStorageRocksDB.<init>(KeyValueStorageRocksDB.java:83)\r\n\tat org.apache.bookkeeper.bookie.storage.ldb.KeyValueStorageRocksDB.lambda$static$0(KeyValueStorageRocksDB.java:58)\r\n\r\nwhat should I do?\r\n \r\n", "url": "https://github.com/apache/pulsar/issues/3820", "user": "Archerxy", "labels": ["type/bug"], "created": "2019-03-14 07:50:08", "closed": "2019-03-14 08:06:22", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Ledger Offload error when use S3 type", "body": "**Describe the bug**\r\nUser use setting : \r\n```\r\nmanagedLedgerOffloadDriver=S3\r\ns3ManagedLedgerOffloadRegion=us\r\ns3ManagedLedgerOffloadBucket=fio-dev-pulsar-topic-offload\r\ns3ManagedLedgerOffloadServiceEndpoint=https://us-chhq.ceph.*****\r\n``` \r\nfor ledgerOffload, and meet error when start broker:\r\n```\r\n16:53:31.930 [main] INFO  org.apache.bookkeeper.mledger.offload.OffloaderUtils - Found offloader OffloaderDefinition(name=jcloud, description=JCloud based offloader implementation, offloaderFactoryClass=org.apache.bookkeeper.mledger.offload.jcloud.JCloudLedgerOffloaderFactory) from /pulsar/./offloaders/tiered-storage-jcloud-2.2.1.nar\r\n16:53:32.094 [load-factory-class org.apache.bookkeeper.mledger.offload.jcloud.JCloudLedgerOffloaderFactory] INFO  org.apache.bookkeeper.mledger.offload.OffloaderUtils - Loading offloader factory class org.apache.bookkeeper.mledger.offload.jcloud.JCloudLedgerOffloaderFactory using class loader org.apache.pulsar.common.nar.NarClassLoader[/tmp/pulsar-nar/tiered-storage-jcloud-2.2.1.nar-unpacked]\r\n16:53:32.133 [main] INFO  org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader - Constructor offload driver: aws-s3, host: https://us-chhq.ceph.*****, container: fio-dev-pulsar-topic-offload, region: us\r\n\r\n16:53:33.565 [main] INFO  org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader - Connect to blobstore : driver: aws-s3, region: us, endpoint: https://us-chhq.ceph.*****\r\n17:04:35.723 [bookkeeper-ml-scheduler-OrderedScheduler-4-0] INFO  org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader - Connect to blobstore : driver: aws-s3, region: , endpoint: https://us-chhq.ceph.*****\r\n17:05:30.681 [offloader-OrderedScheduler-1-0] ERROR org.jclouds.http.handlers.BackoffLimitedRetryHandler - Cannot retry after server error, command has exceeded retry limit 100: [method=org.jclouds.aws.s3.AWSS3Client.public abstract java.lang.String org.jclouds.s3.S3Client.getBucketLocation(java.lang.String)[fio-dev-pulsar-topic-offload], request=GET https://s3.amazonaws.com/fio-dev-pulsar-topic-offload?location HTTP/1.1]\r\n```  \r\n**Additional context**\r\nIn Offload, we leverage [jclouds](https://jclouds.apache.org/reference/providers/#blobstore-providers) to support different blob store provider, in which type \"s3\" and \"aws-s3\" are different. \r\n\"aws-s3\" is for service provided by Amazon S3;\r\nwhile \"s3\" is for service that supported S3 API, but may not provided by Amazon S3.\r\nIn this code, we need to keep \"s3\" instead of change it into \"aws-s3\"\r\n```\r\n    public static BlobStoreManagedLedgerOffloader create(TieredStorageConfigurationData conf,\r\n                                                         Map<String, String> userMetadata,\r\n                                                         OrderedScheduler scheduler)\r\n            throws IOException {\r\n        String driver = conf.getManagedLedgerOffloadDriver();\r\n        if (\"s3\".equals(driver.toLowerCase())) {\r\n            driver = \"aws-s3\";       < ====\r\n        }\r\n        if (!driverSupported(driver)) {\r\n            throw new IOException(\r\n                \"Not support this kind of driver as offload backend: \" + driver);\r\n        }\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/3807", "user": "jiazhai", "labels": ["component/tieredstorage", "help wanted", "type/bug"], "created": "2019-03-12 10:05:17", "closed": "2019-03-19 13:08:59", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "NPE in PartitionedProducerImpl##ProducerStatsRecorderImpl", "body": "**Describe the bug**\r\nmeet NPE while call PartitionedProducerImpl.getStats()\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/6348208/54190161-4ad6b100-44ee-11e9-8044-03cdf725c177.png)\r\n\r\n**Additional context**\r\n\r\nIn PartitionedProducerImpl, the stats instance(ProducerStatsRecorderImpl) is init like this.\r\n```\r\nstats = client.getConfiguration().getStatsIntervalSeconds() > 0 ? new ProducerStatsRecorderImpl() : null;\r\n```\r\n\r\nwhile  in ProducerStatsRecorderImpl(), all member is set to null;\r\n```\r\npublic ProducerStatsRecorderImpl() {\r\n    numMsgsSent = null;\r\n    numBytesSent = null;\r\n    numSendFailed = null;\r\n    numAcksReceived = null;\r\n    totalMsgsSent = null;\r\n    totalBytesSent = null;\r\n    totalSendFailed = null;\r\n    totalAcksReceived = null;\r\n    ds = null;\r\n}\r\n```\r\nso when call PartitionedProducerImpl.getStats(), it will meet NPE\r\n```\r\n@Override\r\npublic synchronized ProducerStatsRecorderImpl getStats() {\r\n    if (stats == null) {\r\n        return null;\r\n    }\r\n    stats.reset();      < === \r\n    for (int i = 0; i < topicMetadata.numPartitions(); i++) {\r\n        stats.updateCumulativeStats(producers.get(i).getStats());\r\n    }\r\n    return stats;\r\n}\r\n\r\nvoid reset() {\r\n    numMsgsSent.reset();   < === \r\n    numBytesSent.reset();\r\n    numSendFailed.reset();\r\n    numAcksReceived.reset();\r\n    totalMsgsSent.reset();\r\n    totalBytesSent.reset();\r\n    totalSendFailed.reset();\r\n    totalAcksReceived.reset();\r\n}\r\n\r\n```", "url": "https://github.com/apache/pulsar/issues/3806", "user": "jiazhai", "labels": ["component/client", "help wanted", "type/bug"], "created": "2019-03-12 09:50:47", "closed": "2019-03-19 17:37:58", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "[go client] cannot use size (type _Ctype_int) as type _Ctype_ulong", "body": "**Describe the bug**\r\n\r\n```\r\n# github.com/apache/pulsar/pulsar-client-go/pulsar\r\n../../pulsar/c_message.go:91:213: cannot use size (type _Ctype_int) as type _Ctype_ulong in argument to func literal\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n```\r\n1. git clone git@github.com:apache/pulsar.git\r\n2. cd apache/pulsar/pulsar-client-cpp\r\n3. cmake .\r\n4. make\r\n5. make install\r\n6. cd ../pulsar-client-go/examples/producer\r\n7. go build -o main producer.go\r\n```\r\n**Expected behavior**\r\n\r\nbuild success\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: MAC OS\r\n - go: go 1.11.4\r\n", "url": "https://github.com/apache/pulsar/issues/3802", "user": "wolfstudy", "labels": ["type/bug"], "created": "2019-03-12 07:07:29", "closed": "2019-03-25 06:45:49", "commits": {}, "ttf": 12.000277777777777, "commitsDetails": []}, {"title": "[java client] main class location problem with pulsar-client-admin 2.3.0", "body": "**Description:**\r\nIn gradle project having these two files \r\n```\r\npackage examplepackage;\r\n\r\npublic class Launcher {\r\n    public static void main(String[] args) {}\r\n}\r\n```\r\n```\r\nrepositories {\r\n    mavenCentral()\r\n}\r\n\r\ndependencies {\r\n    compile group: 'org.apache.pulsar', name: 'pulsar-client-admin', version: '2.3.0'\r\n    testCompile group: 'junit', name: 'junit', version: '4.12'\r\n}\r\n```\r\nthere is problem after building jar: `java -cp jar-with-dependencies.jar examplepackage.Launcher` results in `Error: Could not find or load main class examplepackage.Launcher`. \r\n\r\nI guess the reason is in transitive `org.bouncycastle` dependency, because excluding it eliminates the problem.\r\n\r\n**Desktop:**\r\n - OS: Mac OS & Ubuntu\r\n - pulsar-client-admin version: 2.3.0", "url": "https://github.com/apache/pulsar/issues/3799", "user": "evgmitskevich", "labels": ["component/build", "type/bug"], "created": "2019-03-11 18:06:13", "closed": "2019-10-28 02:08:20", "commits": {}, "ttf": 230.00027777777777, "commitsDetails": []}, {"title": "Pulsar standalone does not read zk port form conf/standalone.conf", "body": "\r\n**Describe the bug**\r\nWhen we run the order bin/pulsar standalone, it does not read the zookeeper port form the file in conf/standalone.conf.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Modify the file in conf/standalone.conf. Add zookeeperServers like this: \r\nzookeeperServers=127.0.0.1:2182\r\n2. run the order: sh bin/pulsar standalone \r\n3. See error.\r\n09:59:20.184 [main] INFO  org.apache.zookeeper.server.ZooKeeperServer - Server environment:user.dir=/usr/local/pulsar/apache-pulsar-2.4.0-SNAPSHOT\r\n09:59:20.204 [main] INFO  org.apache.zookeeper.server.ZooKeeperServer - Created server with tickTime 3000 minSessionTimeout 6000 maxSessionTimeout 60000 datadir /usr/local/pulsar/apache-pulsar-2.4.0-SNAPSHOT/data/standalone/zookeeper/version-2 snapdir /usr/local/pulsar/apache-pulsar-2.4.0-SNAPSHOT/data/standalone/zookeeper/version-2\r\n09:59:20.225 [main] INFO  org.apache.zookeeper.server.NIOServerCnxnFactory - binding to port 0.0.0.0/0.0.0.0:2181\r\n\r\n**Expected behavior**\r\nThe priority is args > standalone.conf > default (args is the order \u201c--zookeeper-port\u201d). It means:\r\n1. If the user uses \u201c--zookeeper-port\u201d to run pulsar in standalone (order: sh bin/pulsar standalone --zookeeper-port 2183), the zk port should be 2183. It does not care the zookeeperServers setting in conf/stanalone.\r\n2. If the user run pulsar in standalone straightly (order: sh bin/pulsar standalone), after the user sets zookeeperServers in conf/stanalone ( like this zookeeperServers=127.0.0.1:2182 ) . The zk port should be 2182\r\n3. If the user run pulsar in standalone straightly (order: sh bin/pulsar standalone), and does not set zookeeperServers in conf/stanalone. The zk port should be default port 2181.\r\n\r\n**Desktop**\r\n - OS: Linux\r\n", "url": "https://github.com/apache/pulsar/issues/3788", "user": "lsy180829", "labels": ["component/broker", "component/test", "type/bug"], "created": "2019-03-08 03:09:46", "closed": "2019-03-11 05:09:33", "commits": {"a48f1d1cead4dc9c2683aee2f7536f809b610b94": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "a48f1d1cead4dc9c2683aee2f7536f809b610b94", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["5fe446eb28256df3d68f99c6e4c804c5bf76cac4"], "nameRev": "a48f1d1cead4dc9c2683aee2f7536f809b610b94 tags/v2.4.0-candidate-1~490", "commitMessage": "Pulsar standalone does not read zk port form conf/standalone.conf (#3790)\n\n### Motivation\r\nFixes #3788\r\n\r\n### Modifications\r\nAdd codes make it read zk port from standalone.conf. And it follow the Priority: args > conf > default\r\n", "commitDateTime": "2019-03-11 13:09:32", "authoredDateTime": "2019-03-11 13:09:32", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/PulsarStandaloneStarter.java", "insertions": 19, "deletions": 2, "lines": 21}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarStandaloneStarter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.PulsarStandaloneStarter.argsContains(java.lang.String[],java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.PulsarStandaloneStarter", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 2, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Inaccurate documentation for `availablePermits` in the admin-api-non-persistent-topics documentation", "body": "**Describe the bug**\r\nThe current definition of the `availablePermits` property on the http://pulsar.apache.org/docs/en/admin-api-non-persistent-topics.html#get-stats page is as follows:\r\n\r\n\"availablePermits: The number of messages this consumer has space for in the client library's listen queue. A value of 0 means the client library's queue is full and receive() isn't being called. A nonzero value means this consumer is ready to be dispatched messages.\"\r\n\r\nHowever, this is incorrect, as we often times see a value of -1 for that setting, which is a nonzero value but is also indicative of the queue being full. Therefore I have corrected the definition to include that particular case as well.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to 'http://pulsar.apache.org/docs/en/admin-api-non-persistent-topics.html#get-stats'\r\n2. Scroll down to ' availablePermits'\r\n3. See error\r\n\r\n**Expected behavior**\r\n\r\nThe definition for availablePermits should read as follows:\r\n\r\n\"availablePermits: The number of messages this consumer has space for in the client library's listen queue. A value less than 1 means the client library's queue is full and receive() isn't being called. A non-negative value means this consumer is ready to be dispatched messages.\"\r\n\r\n**Screenshots**\r\n![screen shot 2019-03-06 at 6 01 02 pm](https://user-images.githubusercontent.com/35466513/53973536-cd5a0d80-40b5-11e9-91b2-5b34f7d8f8d2.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - All\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3780", "user": "david-streamlio", "labels": ["component/client", "component/documentation", "type/bug"], "created": "2019-03-07 16:48:59", "closed": "2019-03-11 08:26:26", "commits": {"e283940d00f25784b248a9d04b2baea4983b03b5": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "e283940d00f25784b248a9d04b2baea4983b03b5", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["7d97043d76174ecedf4060afbc49bf2ec4fc2ebd"], "nameRev": "e283940d00f25784b248a9d04b2baea4983b03b5 tags/v2.4.0-candidate-1~488", "commitMessage": "Fixed admin-api-non-persistent-topics documentation (#3781)\n\nFixes #3780\r\n\r\n\r\n### Motivation\r\n\r\nUpdate the documentation to more accurately reflect the condition of the queue when the availablePermits value is negative. The current documentation indicates that condition means the consumer is ready to receive more messages, when, in fact, it is NOT.\r\n\r\n### Modifications\r\n\r\nUpdated the http://pulsar.apache.org/docs/en/admin-api-non-persistent-topics.html#get-stats page", "commitDateTime": "2019-03-11 16:26:25", "authoredDateTime": "2019-03-11 01:26:25", "commitGitStats": [{"filePath": "site2/docs/admin-api-non-persistent-topics.md", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Pulsar Client: Ack Over Closed Connection With Broker", "body": "**Describe the bug**\r\nThis is an issue with the Python client. In the case that the connection to the broker node has been closed unexpectedly, when `consumer.acknowledge` is called the client (sometimes?) tries to send an ack over the closed connection.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\nWe haven't been able to reliably reproduce this behavior. We've observed it in the wild with a shared subscription.\r\n\r\n**Expected behavior**\r\nThe client should reestablish a connection with the broker and then send the ack.\r\n\r\n**Desktop:**\r\n - OS: macOS Mojave Version 10.14\r\n- Python 3.7.0\r\n- pulsar-client 2.2.0\r\n\r\n**Additional context: Pseudocode**\r\n```\r\ndef setup_pulsar():\r\n    consumer_cert = PATH_TO_PULSAR_CONSUMER_CERT\r\n    consumer_key = PATH_TO_PULSAR_CONSUMER_KEY\r\n    ca_cert = PATH_TO_PULSAR_CA_CERT\r\n\r\n    auth = pulsar.AuthenticationTLS(consumer_cert, consumer_key)\r\n\r\n    topics = [\"persistent://qq/qq-core/notify.one\",\r\n              \"persistent://qq/qq-core/notify.two\",\r\n              \"persistent://qq/qq-core/notify.three\"]\r\n\r\n    sub_name = \"msg-processor-subscription\"\r\n\r\n    client = pulsar.Client(PULSAR_BROKER_URL,\r\n                            tls_trust_certs_file_path = ca_cert,\r\n                            authentication = auth,\r\n                            use_tls = True,\r\n                            tls_allow_insecure_connection = False\r\n    )\r\n\r\n    consumer = client.subscribe(topics,\r\n                                subscription_name=sub_name,\r\n                                receiver_queue_size=0,\r\n                                consumer_type=pulsar.ConsumerType.Shared)\r\n    return client, consumer\r\n\r\n\r\ndef consume_messages():\r\n    client, consumer = setup_pulsar()\r\n    while True:\r\n        msg = consumer.receive()\r\n        MessageProcessor().process_message(msg)\r\n        consumer.acknowledge(msg)\r\n\r\n\r\nif __name__ == '__main__':\r\n    consume_messages()\r\n```\r\n\r\n**Additional context: Log Snippet**\r\n\r\n```\r\n2019-02-20 21:48:26.580 INFO  ClientConnection:1237 | [a.a.a.a:38452 -> b.b.b.b:6651] Connection closed\r\n                MSG PROCESSOR [2019-02-20 21:48:26] INFO     Message Topic: notify.one; Message Environment: stage\r\n2019-02-20 21:48:26.580 INFO  HandlerBase:129 | [persistent://qq/qq-core/notify.one, msg-processor-subscription, 0] Schedule reconnection in 0.1 s\r\n2019-02-20 21:48:26.580 INFO  HandlerBase:129 | [persistent://qq/qq-core/notify.two, msg-processor-subscription, 1] Schedule reconnection in 0.1 s\r\n2019-02-20 21:48:26.581 INFO  HandlerBase:129 | [persistent://qq/qq-core/notify.three, msg-processor-subscription, 2] Schedule reconnection in 0.1 s\r\n                MSG PROCESSOR [2019-02-20 21:48:26] INFO     This message is not in your environment (integration), the env is stage\r\n2019-02-20 21:48:26.581 WARN  ClientConnection:1122 | [a.a.a.a:38452 -> b.b.b.b:6651] Could not send message on connection: system:9 Bad file descriptor\r\n2019-02-20 21:48:26.581 INFO  ClientConnection:1237 | [a.a.a.a:38452 -> b.b.b.b:6651] Connection closed\r\n2019-02-20 21:48:26.581 INFO  ClientConnection:195 | [a.a.a.a:38452 -> b.b.b.b:6651] Destroyed connection\r\n                MSG PROCESSOR [2019-02-20 21:48:26] ERROR    MSG_PROCESSING_ERROR: Failed to Ack Message Traceback (most recent call last):\r\n  File \"/app/worker/consumer.py\", line 60, in consume_messages\r\n    consumer.acknowledge(msg)\r\n  File \"/usr/local/lib/python3.7/site-packages/pulsar/__init__.py\", line 814, in acknowledge\r\n    self._consumer.acknowledge(message)\r\nException: Pulsar error: NotConnected\r\n```", "url": "https://github.com/apache/pulsar/issues/3779", "user": "Brenda-Rickards-Bose", "labels": ["component/python", "type/bug"], "created": "2019-03-07 10:15:51", "closed": "2019-03-08 11:06:01", "commits": {"d89c8d605991cae56bb057e3347c63bb65ad027b": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "15d2c3cb00b7e7c1ddb6c3f79f911b2c56fb5ee6": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "d89c8d605991cae56bb057e3347c63bb65ad027b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["a337e0482e4f20a3b2b0ff21cf614741ce295777"], "nameRev": "d89c8d605991cae56bb057e3347c63bb65ad027b tags/v2.4.0-candidate-1~500", "commitMessage": "Make Python consumers acks async (#3782)\n\n### Motivation\r\n\r\nFixes #3779 \r\n\r\nThe behavior of acknowledgment has always been to throw exception if consumer is not connected.\r\n\r\nIn reality it doesn't make much sense to bubble back exception to user in this case because: \r\n * There's no ack on the ack anyway\r\n * The only reason for ack to fail is if consumer is disconnected\r\n * If consumer is disconnected, messages are going to be replayed in any case\r\n * Therefore, there's no action to do when acking while disconnected\r\n\r\nThis is already the case in the Java and Go clients (additionally Java client performs client side grouping of acks based on time). \r\n\r\nChanging the Python client behavior to be the same.", "commitDateTime": "2019-03-08 19:06:00", "authoredDateTime": "2019-03-08 03:06:00", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/src/consumer.cc", "insertions": 4, "deletions": 24, "lines": 28}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "15d2c3cb00b7e7c1ddb6c3f79f911b2c56fb5ee6", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["2d924ab1f5710b58eb435b0a54471a1918fe27a4"], "nameRev": "15d2c3cb00b7e7c1ddb6c3f79f911b2c56fb5ee6 tags/v2.3.1-candidate-1~58", "commitMessage": "Make Python consumers acks async (#3782)\n\n### Motivation\r\n\r\nFixes #3779 \r\n\r\nThe behavior of acknowledgment has always been to throw exception if consumer is not connected.\r\n\r\nIn reality it doesn't make much sense to bubble back exception to user in this case because: \r\n * There's no ack on the ack anyway\r\n * The only reason for ack to fail is if consumer is disconnected\r\n * If consumer is disconnected, messages are going to be replayed in any case\r\n * Therefore, there's no action to do when acking while disconnected\r\n\r\nThis is already the case in the Java and Go clients (additionally Java client performs client side grouping of acks based on time). \r\n\r\nChanging the Python client behavior to be the same.", "commitDateTime": "2019-03-29 10:37:52", "authoredDateTime": "2019-03-08 03:06:00", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/src/consumer.cc", "insertions": 4, "deletions": 24, "lines": 28}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Documentation: link in standalone page failed", "body": "http://pulsar.apache.org/docs/en/standalone/\r\n\r\n![image](https://user-images.githubusercontent.com/6348208/53940813-94d82500-40f1-11e9-8648-466d5e344143.png)\r\n\r\nThis is because in 2.3.0 each connector is packaged into a separate nar.\r\nWe need to change the link from old: \r\n`https://archive.apache.org/dist/pulsar/pulsar-2.3.0/apache-pulsar-io-connectors-2.3.0-bin.tar.gz`\r\ninto \r\n`https://archive.apache.org/dist/pulsar/pulsar-2.3.0/connectors/`", "url": "https://github.com/apache/pulsar/issues/3777", "user": "jiazhai", "labels": ["component/documentation", "help wanted", "type/bug"], "created": "2019-03-07 07:59:08", "closed": "2019-04-01 17:49:35", "commits": {"2782dcf36124b3544ffc013697cd637e2fd7ad1c": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 25.00027777777778, "commitsDetails": [{"commitHash": "2782dcf36124b3544ffc013697cd637e2fd7ad1c", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["6f70043183e2c3e7259ba515266a97caa711b321"], "nameRev": "2782dcf36124b3544ffc013697cd637e2fd7ad1c tags/v2.4.0-candidate-1~388", "commitMessage": "Update connector download URL (#3793)\n\nCloses #3777 ", "commitDateTime": "2019-04-01 10:49:34", "authoredDateTime": "2019-04-02 01:49:34", "commitGitStats": [{"filePath": "site2/docs/deploy-bare-metal.md", "insertions": 5, "deletions": 14, "lines": 19}, {"filePath": "site2/docs/getting-started-standalone.md", "insertions": 5, "deletions": 14, "lines": 19}, {"filePath": "site2/website/scripts/replace.js", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.3.0/deploy-bare-metal.md", "insertions": 5, "deletions": 14, "lines": 19}, {"filePath": "site2/website/versioned_docs/version-2.3.0/getting-started-standalone.md", "insertions": 5, "deletions": 14, "lines": 19}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Update documentation for topic partitions auto update", "body": "Update documentation for topic partitions auto update", "url": "https://github.com/apache/pulsar/issues/3773", "user": "jiazhai", "labels": ["component/client", "component/documentation", "type/bug"], "created": "2019-03-06 23:38:44", "closed": "2019-03-19 17:41:46", "commits": {}, "ttf": 12.000277777777777, "commitsDetails": []}, {"title": "Shading Avro in pulsar-client", "body": "**Describe the bug**\r\n\r\nBecause we shade Avro in the pulsar-client, the ReflectData API to get a schema from a POJO fails to get the correct schema for generated Avro java classes\r\n\r\n\r\n**To Reproduce**\r\n\r\nGiven an avro schema:\r\n\r\n```\r\n{\r\n  \"namespace\": \"example.avro\",\r\n  \"type\": \"record\",\r\n  \"name\": \"User\",\r\n  \"fields\": [\r\n    {\r\n      \"name\": \"name\",\r\n      \"type\": \"string\"\r\n    },\r\n    {\r\n      \"name\": \"favorite_number\",\r\n      \"type\": [\r\n        \"int\",\r\n        \"null\"\r\n      ]\r\n    },\r\n    {\r\n      \"name\": \"favorite_color\",\r\n      \"type\": \"string\"\r\n    },\r\n    {\r\n      \"name\": \"age\",\r\n      \"type\": \"int\",\r\n      \"default\": 19\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nPassing the generated java class from the above schema to the AvroSchema in pulsar-client produces the following result:\r\n\r\n```\r\nSystem.out.println(new String(org.apache.pulsar.client.impl.schema.AvroSchema.of(User.class).getSchemaInfo().getSchema()));\r\n```\r\n\r\noutputs:\r\n\r\n```\r\n{\"type\":\"record\",\"name\":\"User\",\"namespace\":\"example.avro\",\"fields\":[{\"name\":\"name\",\"type\":[\"null\",\"string\"],\"default\":null},{\"name\":\"favorite_number\",\"type\":[\"null\",\"int\"],\"default\":null},{\"name\":\"favorite_color\",\"type\":[\"null\",\"string\"],\"default\":null},{\"name\":\"age\",\"type\":\"int\"}]}\r\n```\r\n\r\nwhich is incorrect while\r\n\r\n```\r\nSystem.out.println(ReflectData.get().getSchema(User.class));\r\n```\r\n\r\noutputs the correct schema that matches the original schema:\r\n\r\n```\r\n{\"type\":\"record\",\"name\":\"User\",\"namespace\":\"example.avro\",\"fields\":[{\"name\":\"name\",\"type\":\"string\"},{\"name\":\"favorite_number\",\"type\":[\"int\",\"null\"]},{\"name\":\"favorite_color\",\"type\":\"string\"},{\"name\":\"age\",\"type\":\"int\",\"default\":19}]}\r\n\r\n```\r\n\r\nHere is the line in Avro responsible for getting the schema from generated classes:\r\nhttps://github.com/apache/avro/blob/release-1.8.2/lang/java/avro/src/main/java/org/apache/avro/specific/SpecificData.java#L277\r\n\r\nHere is a project I created that demonstrates this problem:\r\n\r\nhttps://github.com/jerrypeng/TestAvro\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3762", "user": "jerrypeng", "labels": ["component/client", "component/schemaregistry", "triage/week-35", "type/bug"], "created": "2019-03-06 00:26:41", "closed": "2020-02-25 04:00:15", "commits": {"dab14acdddf4218eb15d6537ec4a5aa2098a5248": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}, "3c9a442b6273e8bf375f77a09222a393f3d60702": {"commitGHEventType": "referenced", "commitUser": "tuteng"}, "337cdc520ace0f6695af85663050f17d2332eaee": {"commitGHEventType": "referenced", "commitUser": "tuteng"}}, "ttf": 356.0002777777778, "commitsDetails": [{"commitHash": "dab14acdddf4218eb15d6537ec4a5aa2098a5248", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["1fcccd62ac9566f3506fad2e2abd3debd54918ee"], "nameRev": "dab14acdddf4218eb15d6537ec4a5aa2098a5248 tags/v2.6.0-candidate-1~464", "commitMessage": "[Issue 3762][Schema] Fix the problem with parsing of an Avro schema related to shading in pulsar-client. (#6406)\n\nMotivation\r\nAvro schemas are quite important for proper data flow and it is a pity that the #3762 issue stayed untouched for so long. There were some workarounds on how to make Pulsar use an original avro schema, but in the end, it is pretty hard to run an enterprise solution on workarounds. With this PR I would like to find a solution to the problem caused by shading avro in pulsar-client. As it was discussed in the issue, there are two possible solutions for this problem:\r\n\r\nUnshade the avro library in the pulsar-client library. (IMHO it seems like a proper solution for this problem, but it also brings a risk of unknown side-effects)\r\nUse reflection to get original schemas from generated classes. (I went for this solution)\r\nCould you please comment if this is a proper solution for the problem? I will add tests when my approach will be confirmed.\r\n\r\nModifications\r\nFirst, we try to extract an original avro schema from the \"$SCHEMA\" field using reflection. If it doesn't work, the process falls back generation of the schema from POJO.", "commitDateTime": "2020-02-25 12:00:14", "authoredDateTime": "2020-02-25 05:00:14", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/StructSchema.java", "insertions": 10, "deletions": 2, "lines": 12}], "commitSpoonAstDiffStats": [{"spoonFilePath": "StructSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.StructSchema.extractAvroSchema(org.apache.pulsar.client.api.schema.SchemaDefinition,java.lang.Class)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.StructSchema.createAvroSchema(org.apache.pulsar.client.api.schema.SchemaDefinition)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "3c9a442b6273e8bf375f77a09222a393f3d60702", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["4ca6ab1df7779078c096b57485c1d6034b7a563d"], "nameRev": "3c9a442b6273e8bf375f77a09222a393f3d60702 tags/v2.5.1-candidate-1~34", "commitMessage": "[Issue 3762][Schema] Fix the problem with parsing of an Avro schema related to shading in pulsar-client. (#6406)\n\nMotivation\r\nAvro schemas are quite important for proper data flow and it is a pity that the #3762 issue stayed untouched for so long. There were some workarounds on how to make Pulsar use an original avro schema, but in the end, it is pretty hard to run an enterprise solution on workarounds. With this PR I would like to find a solution to the problem caused by shading avro in pulsar-client. As it was discussed in the issue, there are two possible solutions for this problem:\r\n\r\nUnshade the avro library in the pulsar-client library. (IMHO it seems like a proper solution for this problem, but it also brings a risk of unknown side-effects)\r\nUse reflection to get original schemas from generated classes. (I went for this solution)\r\nCould you please comment if this is a proper solution for the problem? I will add tests when my approach will be confirmed.\r\n\r\nModifications\r\nFirst, we try to extract an original avro schema from the \"$SCHEMA\" field using reflection. If it doesn't work, the process falls back generation of the schema from POJO.\n\n(cherry picked from commit dab14acdddf4218eb15d6537ec4a5aa2098a5248)\n", "commitDateTime": "2020-04-05 10:52:41", "authoredDateTime": "2020-02-25 05:00:14", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/StructSchema.java", "insertions": 10, "deletions": 2, "lines": 12}], "commitSpoonAstDiffStats": [{"spoonFilePath": "StructSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.StructSchema.extractAvroSchema(org.apache.pulsar.client.api.schema.SchemaDefinition,java.lang.Class)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.StructSchema.createAvroSchema(org.apache.pulsar.client.api.schema.SchemaDefinition)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "337cdc520ace0f6695af85663050f17d2332eaee", "commitGHEventType": "referenced", "commitUser": "tuteng", "commitParents": ["81f44600fdaee6dc150d6aeae4411875750b661a"], "nameRev": "337cdc520ace0f6695af85663050f17d2332eaee tags/v2.5.1-candidate-3~45", "commitMessage": "[Issue 3762][Schema] Fix the problem with parsing of an Avro schema related to shading in pulsar-client. (#6406)\n\nMotivation\r\nAvro schemas are quite important for proper data flow and it is a pity that the #3762 issue stayed untouched for so long. There were some workarounds on how to make Pulsar use an original avro schema, but in the end, it is pretty hard to run an enterprise solution on workarounds. With this PR I would like to find a solution to the problem caused by shading avro in pulsar-client. As it was discussed in the issue, there are two possible solutions for this problem:\r\n\r\nUnshade the avro library in the pulsar-client library. (IMHO it seems like a proper solution for this problem, but it also brings a risk of unknown side-effects)\r\nUse reflection to get original schemas from generated classes. (I went for this solution)\r\nCould you please comment if this is a proper solution for the problem? I will add tests when my approach will be confirmed.\r\n\r\nModifications\r\nFirst, we try to extract an original avro schema from the \"$SCHEMA\" field using reflection. If it doesn't work, the process falls back generation of the schema from POJO.\n\n(cherry picked from commit dab14acdddf4218eb15d6537ec4a5aa2098a5248)\n", "commitDateTime": "2020-04-13 11:13:30", "authoredDateTime": "2020-02-25 05:00:14", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/StructSchema.java", "insertions": 10, "deletions": 2, "lines": 12}], "commitSpoonAstDiffStats": [{"spoonFilePath": "StructSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.StructSchema.extractAvroSchema(org.apache.pulsar.client.api.schema.SchemaDefinition,java.lang.Class)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.StructSchema.createAvroSchema(org.apache.pulsar.client.api.schema.SchemaDefinition)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "pulsar docs codebase Not Found", "body": "**Describe the bug**\r\npulsar codebase web html show info:\r\n```\r\nNot Found\r\nThe requested URL /docs/en/standalone/developing-codebase.md was not found on this server.\r\n````\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. https://pulsar.apache.org/docs/en/standalone/\r\n2. Click on codebase\r\n![image](https://user-images.githubusercontent.com/20353043/53798232-c971a280-3f72-11e9-8aea-cfe1e7cd09bd.png)\r\n3. see error\r\n![image](https://user-images.githubusercontent.com/20353043/53798274-d9898200-3f72-11e9-8a6a-f1b9230e26e6.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3755", "user": "ambition119", "labels": ["component/documentation", "component/website", "help wanted", "type/bug"], "created": "2019-03-05 10:17:12", "closed": "2019-03-11 01:23:26", "commits": {"5fe446eb28256df3d68f99c6e4c804c5bf76cac4": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "5fe446eb28256df3d68f99c6e4c804c5bf76cac4", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["b46e3e3789eaa008b79af56521fe55f93763f46f"], "nameRev": "5fe446eb28256df3d68f99c6e4c804c5bf76cac4 tags/v2.4.0-candidate-1~491", "commitMessage": "Fix codebase url (#3794)\n\nCloses #3755", "commitDateTime": "2019-03-11 09:23:25", "authoredDateTime": "2019-03-11 09:23:25", "commitGitStats": [{"filePath": "site2/docs/getting-started-standalone.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.3.0/getting-started-standalone.md", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "AvroSchema should be constructed using writer schema and reader schema", "body": "**Is your feature request related to a problem? Please describe.**\r\n\r\nCurrently POJO Avro Schema is using one schema for both its writer schema and reader schema. This implementation doesn't work well with BC story.\r\n\r\nA better approach is:\r\n\r\nfor producer: we should use the user supplied schema as writer schema, and use the schema stored at broker as reader schema to construct the AvroSchema. In this way, Avro can do the BC at client side to make sure the produced message is compatible with broker side.\r\n\r\nfor consumer: we should use the user supplied schema as reader schema, and use the schema stored at broker as writer schema to construct AvroSchema.\r\n\r\n**Describe the solution you'd like**\r\n\r\nThe solution is described above as `a better approach`.\r\n\r\n**Describe alternatives you've considered**\r\n\r\nN/A\r\n\r\n**Additional context**\r\n\r\nN/A", "url": "https://github.com/apache/pulsar/issues/3742", "user": "sijie", "labels": ["component/schemaregistry", "type/bug"], "created": "2019-03-04 08:15:12", "closed": "2019-04-28 04:04:45", "commits": {"1e097cbced91789d8515744cb20d1fecc17b3b41": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "d5ff0828d222775d0562a1b5d589e3f231a1716f": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 54.000277777777775, "commitsDetails": [{"commitHash": "1e097cbced91789d8515744cb20d1fecc17b3b41", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["7b2bf95cbd87515adb679323b05276ae6a335362"], "nameRev": "1e097cbced91789d8515744cb20d1fecc17b3b41 tags/v2.4.0-candidate-1~315", "commitMessage": "[pulsar-proxy]Add the LookupProxyHandler handle getSchema request and test (#4083)\n\n### Motivation\r\nIn order to support #3742 #3876.\r\nNow, proxy handle ProxyLookupRequests don't support GetSchema.\r\n\r\n### Modifications\r\nAdd the getSchema method implementation in ProxyConnection \r\n\r\n### Verifying this change\r\nAdd new a test in ProxyTest testGetSchema()\r\n\r\n### Dependencies (does it add or upgrade a dependency): (yes / no)\r\nThe public API: (no)\r\nThe schema: (no)\r\nThe default values of configurations: (no)\r\nThe wire protocol: (no)\r\nThe rest endpoints: (yes)\r\nThe admin cli options: (no)\r\nAnything that affects deployment: (no)\r\n### Documentation\r\nDoes this pull request introduce a new feature? (no)\r\nIf yes, how is the feature documented? (no)\r\nIf a feature is not documented yet in this PR, please create a followup issue for adding the documentation", "commitDateTime": "2019-04-21 22:06:34", "authoredDateTime": "2019-04-21 22:06:34", "commitGitStats": [{"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/LookupProxyHandler.java", "insertions": 100, "deletions": 25, "lines": 125}, {"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyConnection.java", "insertions": 7, "deletions": 0, "lines": 7}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyTest.java", "insertions": 44, "deletions": 0, "lines": 44}], "commitSpoonAstDiffStats": [{"spoonFilePath": "LookupProxyHandler.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.LookupProxyHandler.handleGetTopicsOfNamespace(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace,long)", "TOT": 10, "UPD": 2, "INS": 1, "MOV": 5, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.proxy.server.LookupProxyHandler", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.LookupProxyHandler.handleGetSchema(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetSchema)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.LookupProxyHandler.getAddr(java.lang.String,long)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.LookupProxyHandler.performGetTopicsOfNamespace(long,java.lang.String,java.lang.String,int,org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace$Mode)", "TOT": 5, "UPD": 0, "INS": 2, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.LookupProxyHandler.getServiceUrl(long)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProxyConnection.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyConnection.handleGetSchema(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetSchema)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProxyTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyTest.Foo", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyTest.testGetSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "d5ff0828d222775d0562a1b5d589e3f231a1716f", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["d1d5aba085490ce26f0c19873b87381677596258"], "nameRev": "d5ff0828d222775d0562a1b5d589e3f231a1716f tags/v2.4.0-candidate-1~276", "commitMessage": "Add the multi version schema support (#3876)\n\n### Motivation\r\n\r\nFix #3742\r\n\r\nIn order to decode the message correctly by AVRO schema, we need to know the schema what the message is.\r\n\r\n### Modification\r\n\r\n- Introduced Schema Reader and Schema Writer for StructSchema.\r\n   - Reader is used to decode message\r\n   - Writer is used to encode message\r\n- The implementations of StructSchema, provides their schema reader and writer implementations. \r\n- Introduced a schema reader cache for caching the readers for different schema versions. ", "commitDateTime": "2019-04-28 12:04:45", "authoredDateTime": "2019-04-28 12:04:45", "commitGitStats": [{"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/Schema.java", "insertions": 16, "deletions": 2, "lines": 18}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/GenericSchema.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaDefinition.java", "insertions": 7, "deletions": 0, "lines": 7}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaDefinitionBuilder.java", "insertions": 12, "deletions": 3, "lines": 15}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaInfoProvider.java", "insertions": 50, "deletions": 0, "lines": 50}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/SchemaProvider.java => pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaReader.java", "insertions": 6, "deletions": 12, "lines": 18}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaWriter.java", "insertions": 30, "deletions": 0, "lines": 30}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/internal/DefaultImplementation.java", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/common/schema/SchemaInfo.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MessageImpl.java", "insertions": 4, "deletions": 3, "lines": 7}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 7, "deletions": 0, "lines": 7}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "insertions": 60, "deletions": 34, "lines": 94}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AutoConsumeSchema.java", "insertions": 11, "deletions": 0, "lines": 11}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AvroSchema.java", "insertions": 26, "deletions": 59, "lines": 85}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/JSONSchema.java", "insertions": 12, "deletions": 34, "lines": 46}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/ProtobufSchema.java", "insertions": 43, "deletions": 44, "lines": 87}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "insertions": 11, "deletions": 1, "lines": 12}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionImpl.java", "insertions": 11, "deletions": 8, "lines": 19}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/StructSchema.java", "insertions": 88, "deletions": 16, "lines": 104}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericAvroReader.java", "insertions": 79, "deletions": 0, "lines": 79}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericAvroSchema.java", "insertions": 17, "deletions": 47, "lines": 64}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericAvroWriter.java", "insertions": 55, "deletions": 0, "lines": 55}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericJsonReader.java", "insertions": 59, "deletions": 0, "lines": 59}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericJsonSchema.java", "insertions": 17, "deletions": 26, "lines": 43}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericJsonWriter.java", "insertions": 44, "deletions": 0, "lines": 44}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericSchemaImpl.java", "insertions": 9, "deletions": 23, "lines": 32}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/MultiVersionGenericSchema.java", "insertions": 0, "deletions": 62, "lines": 62}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/{MultiVersionGenericSchemaProvider.java => MultiVersionSchemaInfoProvider.java}", "insertions": 29, "deletions": 16, "lines": 45}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/reader/AvroReader.java", "insertions": 58, "deletions": 0, "lines": 58}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/reader/JsonReader.java", "insertions": 44, "deletions": 0, "lines": 44}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/reader/ProtobufReader.java", "insertions": 42, "deletions": 0, "lines": 42}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/writer/AvroWriter.java", "insertions": 53, "deletions": 0, "lines": 53}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/writer/JsonWriter.java", "insertions": 42, "deletions": 0, "lines": 42}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/writer/ProtobufWriter.java", "insertions": 29, "deletions": 0, "lines": 29}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/ProtobufSchemaTest.java", "insertions": 10, "deletions": 11, "lines": 21}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/SchemaBuilderTest.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/SchemaTestUtils.java", "insertions": 12, "deletions": 0, "lines": 12}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/SupportVersioningAvroSchemaTest.java", "insertions": 66, "deletions": 0, "lines": 66}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/generic/GenericAvroReaderTest.java", "insertions": 86, "deletions": 0, "lines": 86}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/generic/GenericSchemaImplTest.java", "insertions": 56, "deletions": 8, "lines": 64}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/generic/MultiVersionGenericSchemaTest.java", "insertions": 0, "deletions": 90, "lines": 90}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/generic/{MultiVersionGenericSchemaProviderTest.java => MultiVersionSchemaInfoProviderTest.java}", "insertions": 6, "deletions": 7, "lines": 13}, {"filePath": "pulsar-io/hbase/src/test/java/org/apache/pulsar/io/hbase/sink/HbaseGenericRecordSinkTest.java", "insertions": 14, "deletions": 4, "lines": 18}, {"filePath": "pulsar-io/influxdb/src/test/java/org/apache/pulsar/io/influxdb/InfluxDBGenericRecordSinkTest.java", "insertions": 11, "deletions": 3, "lines": 14}, {"filePath": "pulsar-io/jdbc/src/test/java/org/apache/pulsar/io/jdbc/JdbcSinkTest.java", "insertions": 13, "deletions": 8, "lines": 21}, {"filePath": "pulsar-io/solr/src/test/java/org/apache/pulsar/io/solr/SolrGenericRecordSinkTest.java", "insertions": 13, "deletions": 4, "lines": 17}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/SchemaTest.java", "insertions": 53, "deletions": 3, "lines": 56}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/Schemas.java", "insertions": 18, "deletions": 0, "lines": 18}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyFiles"}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 2, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0.0, "UPD": 0.0, "INS": 0.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "POJO AvroSchema always allowNull", "body": "**Describe the bug**\r\n\r\nCurrently AvroSchema makes all fields allowNull, which makes the generated schema doesn't respect what POJO defines.\r\n\r\n**Expected behavior**\r\n\r\nAvroSchema should respect to what POJO defines\r\n\r\n**Additional context**\r\n\r\nN/A\r\n", "url": "https://github.com/apache/pulsar/issues/3741", "user": "sijie", "labels": ["component/schemaregistry", "type/bug"], "created": "2019-03-04 08:05:49", "closed": "2019-03-19 15:25:34", "commits": {"1a1c557b27bdc4e48fcd4a2da6f71e0d78873697": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "6e76af2fff425102b46945f2597c2eee438b180e": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 15.000277777777777, "commitsDetails": [{"commitHash": "1a1c557b27bdc4e48fcd4a2da6f71e0d78873697", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["6e0c11e58f20333a24118cd30ad2c7f69a8b423b"], "nameRev": "1a1c557b27bdc4e48fcd4a2da6f71e0d78873697 tags/v2.4.0-candidate-1~458", "commitMessage": "revise the schema default type not null (#3752)\n\n### Motivation\r\nFix #3741 \r\n\r\n### Modifications\r\nSupport define not not allow null field in schema\r\n\r\n### Verifying this change\r\nAdd not allow null field schema verify\r\n\r\nDoes this pull request potentially affect one of the following parts:\r\nIf yes was chosen, please highlight the changes\r\n\r\nDependencies (does it add or upgrade a dependency): (no)\r\nThe public API: (no)\r\nThe schema: (yes)\r\nThe default values of configurations: (no)\r\nThe wire protocol: (no)\r\nThe rest endpoints: (no)\r\nThe admin cli options: (no)\r\nAnything that affects deployment: (no)", "commitDateTime": "2019-03-19 23:25:33", "authoredDateTime": "2019-03-19 23:25:34", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/ClientGetSchemaTest.java", "insertions": 8, "deletions": 0, "lines": 8}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/JsonSchemaCompatibilityCheckTest.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleTypedProducerConsumerTest.java", "insertions": 18, "deletions": 10, "lines": 28}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/Schema.java", "insertions": 17, "deletions": 32, "lines": 49}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaDefinition.java", "insertions": 64, "deletions": 0, "lines": 64}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaDefinitionBuilder.java", "insertions": 81, "deletions": 0, "lines": 81}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/internal/DefaultImplementation.java", "insertions": 14, "deletions": 23, "lines": 37}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AvroSchema.java", "insertions": 17, "deletions": 17, "lines": 34}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/JSONSchema.java", "insertions": 14, "deletions": 22, "lines": 36}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "insertions": 95, "deletions": 0, "lines": 95}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionImpl.java", "insertions": 98, "deletions": 0, "lines": 98}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/StructSchema.java", "insertions": 6, "deletions": 4, "lines": 10}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/AvroSchemaTest.java", "insertions": 70, "deletions": 9, "lines": 79}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/JSONSchemaTest.java", "insertions": 151, "deletions": 16, "lines": 167}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/KeyValueSchemaTest.java", "insertions": 140, "deletions": 24, "lines": 164}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/SchemaBuilderTest.java", "insertions": 7, "deletions": 0, "lines": 7}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/SchemaTestUtils.java", "insertions": 31, "deletions": 9, "lines": 40}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/generic/GenericSchemaImplTest.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/generic/MultiVersionGenericSchemaProviderTest.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/tutorial/SampleAsyncProducerWithSchema.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/tutorial/SampleConsumerWithSchema.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "pulsar-io/hbase/src/test/java/org/apache/pulsar/io/hbase/sink/HbaseGenericRecordSinkTest.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-io/jdbc/src/test/java/org/apache/pulsar/io/jdbc/JdbcSinkTest.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-sql/presto-pulsar/src/test/java/org/apache/pulsar/sql/presto/TestPulsarConnector.java", "insertions": 14, "deletions": 13, "lines": 27}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/JdbcSinkTester.java", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyFiles"}, {"commitHash": "6e76af2fff425102b46945f2597c2eee438b180e", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["41d09796830c91a8c25df5791adfc36fd4545de8"], "nameRev": "6e76af2fff425102b46945f2597c2eee438b180e tags/v2.3.1-candidate-1~36", "commitMessage": "revise the schema default type not null (#3752)\n\nFix #3741\n\nSupport define not not allow null field in schema\n\nAdd not allow null field schema verify\n\nDoes this pull request potentially affect one of the following parts:\nIf yes was chosen, please highlight the changes\n\nDependencies (does it add or upgrade a dependency): (no)\nThe public API: (no)\nThe schema: (yes)\nThe default values of configurations: (no)\nThe wire protocol: (no)\nThe rest endpoints: (no)\nThe admin cli options: (no)\nAnything that affects deployment: (no)\n", "commitDateTime": "2019-03-29 11:15:23", "authoredDateTime": "2019-03-19 23:25:34", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/ClientGetSchemaTest.java", "insertions": 8, "deletions": 0, "lines": 8}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/JsonSchemaCompatibilityCheckTest.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleTypedProducerConsumerTest.java", "insertions": 18, "deletions": 10, "lines": 28}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/Schema.java", "insertions": 17, "deletions": 32, "lines": 49}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaDefinition.java", "insertions": 64, "deletions": 0, "lines": 64}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/schema/SchemaDefinitionBuilder.java", "insertions": 81, "deletions": 0, "lines": 81}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/internal/DefaultImplementation.java", "insertions": 14, "deletions": 23, "lines": 37}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AvroSchema.java", "insertions": 17, "deletions": 17, "lines": 34}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/JSONSchema.java", "insertions": 14, "deletions": 22, "lines": 36}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java", "insertions": 95, "deletions": 0, "lines": 95}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionImpl.java", "insertions": 98, "deletions": 0, "lines": 98}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/StructSchema.java", "insertions": 6, "deletions": 4, "lines": 10}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/AvroSchemaTest.java", "insertions": 70, "deletions": 9, "lines": 79}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/JSONSchemaTest.java", "insertions": 151, "deletions": 16, "lines": 167}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/KeyValueSchemaTest.java", "insertions": 140, "deletions": 24, "lines": 164}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/SchemaBuilderTest.java", "insertions": 7, "deletions": 0, "lines": 7}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/SchemaTestUtils.java", "insertions": 31, "deletions": 9, "lines": 40}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/generic/GenericSchemaImplTest.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/tutorial/SampleAsyncProducerWithSchema.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/tutorial/SampleConsumerWithSchema.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "pulsar-io/hbase/src/test/java/org/apache/pulsar/io/hbase/sink/HbaseGenericRecordSinkTest.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-io/jdbc/src/test/java/org/apache/pulsar/io/jdbc/JdbcSinkTest.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-sql/presto-pulsar/src/test/java/org/apache/pulsar/sql/presto/TestPulsarConnector.java", "insertions": 14, "deletions": 13, "lines": 27}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/JdbcSinkTester.java", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyFiles"}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "NullPointerException at using BytesSchema.of()", "body": "**Describe the bug**\r\n\r\nException occurred when using `BytesSchema.of()`\r\n\r\n```\r\nException in thread \"main\" java.lang.ExceptionInInitializerError\r\n\tat org.apache.pulsar.examples.simple.ProducerExample.main(ProducerExample.java:32)\r\nCaused by: java.lang.RuntimeException: java.lang.reflect.InvocationTargetException\r\n\tat org.apache.pulsar.client.internal.ReflectionUtils.catchExceptions(ReflectionUtils.java:36)\r\n\tat org.apache.pulsar.client.internal.DefaultImplementation.newKeyValueSchema(DefaultImplementation.java:158)\r\n\tat org.apache.pulsar.client.api.Schema.<clinit>(Schema.java:123)\r\n\t... 1 more\r\nCaused by: java.lang.reflect.InvocationTargetException\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\r\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:423)\r\n\tat org.apache.pulsar.client.internal.DefaultImplementation.lambda$newKeyValueSchema$16(DefaultImplementation.java:160)\r\n\tat org.apache.pulsar.client.internal.ReflectionUtils.catchExceptions(ReflectionUtils.java:34)\r\n\t... 3 more\r\nCaused by: java.lang.NullPointerException\r\n\tat org.apache.pulsar.client.impl.schema.KeyValueSchema.<init>(KeyValueSchema.java:68)\r\n\t... 9 more\r\n```\r\n\r\n**To Reproduce**\r\n\r\nYou can use following code to reproduce\r\n```\r\ntry (PulsarClient client = PulsarClient.builder()\r\n             .serviceUrl(pulsarServiceUrl)\r\n             .build()) {\r\n            try (Producer<byte[]> producer = client.newProducer(BytesSchema.of())\r\n                 .topic(topic)\r\n                 .create()\r\n            ) {\r\n                producer.send(\"hello world\".getBytes(UTF_8));\r\n            }\r\n        } catch (PulsarClientException pce) {\r\n            LOG.error(\"Failed to produce messages to \" + pulsarServiceUrl, pce);\r\n        }\r\n```\r\n\r\n**Expected behavior**\r\n\r\nNo exceptions should be thrown.\r\n\r\n**Additional context**\r\n\r\nThis happens on 2.3.0. It is related to #3309 . After separating api module from client module, we are using reflection to construct implementations. This approach caused some static initialization are not executed correctly. \r\n", "url": "https://github.com/apache/pulsar/issues/3734", "user": "sijie", "labels": ["component/client", "component/schemaregistry", "type/bug"], "created": "2019-03-02 13:09:29", "closed": "2019-03-08 16:33:40", "commits": {"85afd6e49912996e594047193811826031134f9a": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "01f868c988945fc6c35da1864e2db6eb317d1c89": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "85afd6e49912996e594047193811826031134f9a", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["adc4c1da340fe1ac285b1c91a211f48b90b7031e"], "nameRev": "85afd6e49912996e594047193811826031134f9a tags/v2.4.0-candidate-1~497", "commitMessage": "NullPointerException at using BytesSchema.of() (#3754)\n\nFixes #3734\r\n\r\n*Motivation*\r\n\r\nException occurred when using `BytesSchema.of()`\r\n\r\n```\r\nException in thread \"main\" java.lang.ExceptionInInitializerError\r\n\tat org.apache.pulsar.examples.simple.ProducerExample.main(ProducerExample.java:32)\r\nCaused by: java.lang.RuntimeException: java.lang.reflect.InvocationTargetException\r\n\tat org.apache.pulsar.client.internal.ReflectionUtils.catchExceptions(ReflectionUtils.java:36)\r\n\tat org.apache.pulsar.client.internal.DefaultImplementation.newKeyValueSchema(DefaultImplementation.java:158)\r\n\tat org.apache.pulsar.client.api.Schema.<clinit>(Schema.java:123)\r\n\t... 1 more\r\nCaused by: java.lang.reflect.InvocationTargetException\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\r\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:423)\r\n\tat org.apache.pulsar.client.internal.DefaultImplementation.lambda$newKeyValueSchema$16(DefaultImplementation.java:160)\r\n\tat org.apache.pulsar.client.internal.ReflectionUtils.catchExceptions(ReflectionUtils.java:34)\r\n\t... 3 more\r\nCaused by: java.lang.NullPointerException\r\n\tat org.apache.pulsar.client.impl.schema.KeyValueSchema.<init>(KeyValueSchema.java:68)\r\n\t... 9 more\r\n```\r\n\r\nThe problem introduced because the weird class loading and reflection sequence.\r\n\r\nWhen accessing `BytesSchema`, `BytesSchema` will try to initialize `Schema`. When initializing Schema, it will attempts\r\nto initialize `KV_BYTES` using reflection, and initializing KV_BYTES requires `BytesSchema`. Hence it causes KV_BYTES not being\r\ninitialized correctly.\r\n\r\nThe change is to avoid this recursive class loading.\r\n\r\n", "commitDateTime": "2019-03-09 00:33:39", "authoredDateTime": "2019-03-09 00:33:39", "commitGitStats": [{"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/Schema.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/internal/DefaultImplementation.java", "insertions": 8, "deletions": 2, "lines": 10}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/KeyValueSchema.java", "insertions": 14, "deletions": 2, "lines": 16}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/BytesSchemaTest.java", "insertions": 52, "deletions": 0, "lines": 52}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/KeyValueSchemaTest.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Schema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.KV_BYTES()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "DefaultImplementation.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.internal.DefaultImplementation.newKeyValueSchema(org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.api.Schema)", "TOT": 3, "UPD": 2, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.internal.DefaultImplementation.newKeyValueBytesSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KeyValueSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchema", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchema.of(org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.api.Schema)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchema.kvBytes()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BytesSchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.BytesSchemaTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KeyValueSchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchemaTest.testBytesSchemaEncodeAndDecode()", "TOT": 6, "UPD": 2, "INS": 2, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "TopicSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(java.lang.Class,org.apache.pulsar.common.schema.SchemaType)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "01f868c988945fc6c35da1864e2db6eb317d1c89", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["15d2c3cb00b7e7c1ddb6c3f79f911b2c56fb5ee6"], "nameRev": "01f868c988945fc6c35da1864e2db6eb317d1c89 tags/v2.3.1-candidate-1~57", "commitMessage": "NullPointerException at using BytesSchema.of() (#3754)\n\nFixes #3734\r\n\r\n*Motivation*\r\n\r\nException occurred when using `BytesSchema.of()`\r\n\r\n```\r\nException in thread \"main\" java.lang.ExceptionInInitializerError\r\n\tat org.apache.pulsar.examples.simple.ProducerExample.main(ProducerExample.java:32)\r\nCaused by: java.lang.RuntimeException: java.lang.reflect.InvocationTargetException\r\n\tat org.apache.pulsar.client.internal.ReflectionUtils.catchExceptions(ReflectionUtils.java:36)\r\n\tat org.apache.pulsar.client.internal.DefaultImplementation.newKeyValueSchema(DefaultImplementation.java:158)\r\n\tat org.apache.pulsar.client.api.Schema.<clinit>(Schema.java:123)\r\n\t... 1 more\r\nCaused by: java.lang.reflect.InvocationTargetException\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)\r\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:423)\r\n\tat org.apache.pulsar.client.internal.DefaultImplementation.lambda$newKeyValueSchema$16(DefaultImplementation.java:160)\r\n\tat org.apache.pulsar.client.internal.ReflectionUtils.catchExceptions(ReflectionUtils.java:34)\r\n\t... 3 more\r\nCaused by: java.lang.NullPointerException\r\n\tat org.apache.pulsar.client.impl.schema.KeyValueSchema.<init>(KeyValueSchema.java:68)\r\n\t... 9 more\r\n```\r\n\r\nThe problem introduced because the weird class loading and reflection sequence.\r\n\r\nWhen accessing `BytesSchema`, `BytesSchema` will try to initialize `Schema`. When initializing Schema, it will attempts\r\nto initialize `KV_BYTES` using reflection, and initializing KV_BYTES requires `BytesSchema`. Hence it causes KV_BYTES not being\r\ninitialized correctly.\r\n\r\nThe change is to avoid this recursive class loading.\r\n\r\n", "commitDateTime": "2019-03-29 10:37:59", "authoredDateTime": "2019-03-09 00:33:39", "commitGitStats": [{"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/Schema.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client-api/src/main/java/org/apache/pulsar/client/internal/DefaultImplementation.java", "insertions": 8, "deletions": 2, "lines": 10}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/KeyValueSchema.java", "insertions": 14, "deletions": 2, "lines": 16}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/BytesSchemaTest.java", "insertions": 52, "deletions": 0, "lines": 52}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/KeyValueSchemaTest.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Schema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.KV_BYTES()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "DefaultImplementation.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.internal.DefaultImplementation.newKeyValueSchema(org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.api.Schema)", "TOT": 3, "UPD": 2, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.internal.DefaultImplementation.newKeyValueBytesSchema()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KeyValueSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchema", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchema.of(org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.api.Schema)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchema.kvBytes()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BytesSchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.BytesSchemaTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KeyValueSchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.schema.KeyValueSchemaTest.testBytesSchemaEncodeAndDecode()", "TOT": 6, "UPD": 2, "INS": 2, "MOV": 2, "DEL": 0}]}, {"spoonFilePath": "TopicSchema.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(java.lang.Class,org.apache.pulsar.common.schema.SchemaType)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Need to catchup doc for IO Connectors.", "body": "**Describe the bug**\r\nsome of the connectors are not documented in this link:\r\nhttp://pulsar.apache.org/docs/en/io-connectors.html#docsNav\r\nsuch as\uff1a\r\n- [x] canal #3664 \r\n- [ ] elastic\r\n- [ ] file\r\n- [ ] hdfs2/3\r\n- [ ] mongo\r\n\r\nwe need catch up the work.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3728", "user": "jiazhai", "labels": ["component/documentation", "component/io", "help wanted", "type/bug"], "created": "2019-03-01 12:14:51", "closed": "2019-03-07 13:47:46", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "functions cli received HTTP 404 when trying to inspect a build-in I/O connector", "body": "**Describe the bug**\r\n\r\nWhen trying to use `pulsar-admin functions` CLI (e.g. `getstatus`) for inspecting a submitted build-in I/O sink connector by following the tutorial for Pulsar IO, someone will receive HTTP 404 like follows:\r\n```\r\n$ bin/pulsar-admin functions getstatus \\\r\n>     --tenant public \\\r\n>     --namespace default \\\r\n>     --name test-sink\r\nHTTP 404 Not Found\r\n\r\nReason: Function test-sink doesn't exist\r\n```\r\nHowever, use `pulsar-admin sink` CLI can get the correct result.", "url": "https://github.com/apache/pulsar/issues/3726", "user": "murong00", "labels": ["type/bug"], "created": "2019-03-01 08:34:47", "closed": "2019-03-01 17:03:34", "commits": {"b191035c2f1e1860e0202aca6f908e4376690c0b": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "b191035c2f1e1860e0202aca6f908e4376690c0b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["61e9e1b75f0ff0d38744c6afa90091936b7410d0"], "nameRev": "b191035c2f1e1860e0202aca6f908e4376690c0b tags/v2.4.0-candidate-1~349", "commitMessage": "[Issue #3726] Modify the usage of Connector CLI for better guidance (#3745)\n\n* Modify the usage of Connector CLI for better guidance\r\n\r\n* Add the missing io-quickstart of version 2.3.0\r\n\r\n* Add the original_id\r\n", "commitDateTime": "2019-04-11 18:44:31", "authoredDateTime": "2019-04-11 18:44:31", "commitGitStats": [{"filePath": "site2/docs/io-quickstart.md", "insertions": 53, "deletions": 57, "lines": 110}, {"filePath": "site2/website/versioned_docs/version-2.3.0/io-quickstart.md", "insertions": 389, "deletions": 0, "lines": 389}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Documentation generation issues", "body": "**Describe the bug**\r\nHi, the documentation of v2.2.1 normally available right there: https://pulsar.apache.org/docs/en/2.2.1/standalone/ has content of v2.3.0. More, how to choose the javadoc from pulsar version? What is the version of: https://pulsar.apache.org/api/client/?\r\n", "url": "https://github.com/apache/pulsar/issues/3725", "user": "KannarFr", "labels": ["component/documentation", "component/website", "triage/week-35", "type/bug"], "created": "2019-03-01 07:47:12", "closed": "2019-09-06 10:13:49", "commits": {}, "ttf": 189.00027777777777, "commitsDetails": []}, {"title": "Pulsar functions worker fails to initialize", "body": "**Describe the bug**\r\nThe Pulsar functions worker fails to initialize.  This breaks Pulsar Functions functionality.\r\n\r\n```\r\n19:41:53.512 [BookKeeperClientWorker-OrderedExecutor-1-0] ERROR org.apache.bookkeeper.common.util.SafeRunnable - Unexpected throwable caught \r\njava.lang.ArrayIndexOutOfBoundsException: -2\r\n    at com.google.common.collect.RegularImmutableList.get(RegularImmutableList.java:60) ~[com.google.guava-guava-21.0.jar:?]\r\n    at org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest.sendNextRead(PendingReadOp.java:400) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest.read(PendingReadOp.java:382) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.client.PendingReadOp.initiate(PendingReadOp.java:526) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.client.LedgerRecoveryOp.doRecoveryRead(LedgerRecoveryOp.java:148) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.client.LedgerRecoveryOp.access$000(LedgerRecoveryOp.java:37) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.client.LedgerRecoveryOp$1.readLastConfirmedDataComplete(LedgerRecoveryOp.java:109) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.client.ReadLastConfirmedOp.readEntryComplete(ReadLastConfirmedOp.java:135) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion$1.readEntryComplete(PerChannelBookieClient.java:1797) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion.handleReadResponse(PerChannelBookieClient.java:1878) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion.handleV2Response(PerChannelBookieClient.java:1831) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.proto.PerChannelBookieClient$ReadV2ResponseCallback.safeRun(PerChannelBookieClient.java:1321) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.9.0.jar:4.9.0]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_181]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_181]\r\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\n```\r\n\r\n```\r\n**root@pulsar-broker-56d59cf97d-zwtxf:/pulsar# bin/pulsar-admin functions list\r\nFunction worker service is not done initializing. Please try again in a little while.\r\n\r\nReason: HTTP 503 Service Unavailable\r\n```\r\nNote: this issue persisted for a time period on the scale of hours until I gave up and tore down the cluster.\r\n\r\n**To Reproduce**\r\nReproduction steps unclear.  Could possibly be related to updating existing functions.\r\n\r\n**Expected behavior**\r\nExpect Pulsar functions to behave as expected - pulsar-admin functions list should not say there's an HTTP 503, etc.\r\n\r\n**Platform (please complete the following information):**\r\n - Using the pulsar-all image tagged 2.3.0.", "url": "https://github.com/apache/pulsar/issues/3715", "user": "grantwwu", "labels": ["component/functions", "triage/week-35", "type/bug"], "created": "2019-02-28 19:21:38", "closed": "2019-11-25 22:24:48", "commits": {"d99e95c2a65ecb43df06bd742ecf0ff5e05d3afe": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 270.0002777777778, "commitsDetails": [{"commitHash": "d99e95c2a65ecb43df06bd742ecf0ff5e05d3afe", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["2fb8cfe13130b87cb011c1e37ac5b8dfd5605acb"], "nameRev": "d99e95c2a65ecb43df06bd742ecf0ff5e05d3afe tags/v2.4.0-candidate-1~41", "commitMessage": "Disable sticky read by default (#4526)\n\n*Motivation*\r\n\r\n2.3.x releases turn on StickyRead by default.\r\nBut StickyRead causes a lot of ArrayIndexOutOfBoundException.\r\n\r\nSee: apache/bookkeeper#1970 and apache/pulsar#3715\r\n\r\n*Modifications*\r\n\r\nDisable sticy read by default until the bug is fixed and a new bookkeeper version is released.", "commitDateTime": "2019-06-14 09:21:29", "authoredDateTime": "2019-06-14 09:21:29", "commitGitStats": [{"filePath": "conf/broker.conf", "insertions": 3, "deletions": 1, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Admin create subscription intermittently fails in multi-broker config", "body": "**Describe the bug**\r\nWhen I try to create a subscription using pulsar-admin it intermittently fails with 504 Gateway Timeout. If I try again later, the creation will eventually succeed. I see the following exception in the broker log when it fails:\r\n\r\n`17:38:07.080 [pulsar-web-28-28] INFO  org.apache.pulsar.broker.admin.impl.PersistentTopicsBase - [null][persistent://public/useast1-gcp/test5] Creating subscription testsub3 at message id 9223372036854775807:9223372036854775807:-1\r\n17:38:07.081 [pulsar-web-28-28] WARN  org.apache.pulsar.broker.admin.impl.PersistentTopicsBase - [null] [persistent://public/useast1-gcp/test5] Failed to create subscription testsub3 at message id 9223372036854775807:9223372036854775807:-1\r\njavax.ws.rs.WebApplicationException: HTTP 307 Temporary Redirect\r\n        at org.apache.pulsar.broker.web.PulsarWebResource.validateTopicOwnership(PulsarWebResource.java:557) ~[org.apache.pulsar-pulsar-broker-2.2.1.jar:2.2.1]\r\n        at org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.validateAdminOperationOnTopic(PersistentTopicsBase.java:253) ~[org.apache.pulsar-pulsar-broker-2.2.1.jar:2.2.1]\r\n        at org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalCreateSubscription(PersistentTopicsBase.java:904) [org.apache.pulsar-pulsar-broker-2.2.1.jar:2.2.1]\r\n        at org.apache.pulsar.broker.admin.v2.PersistentTopics.createSubscription(PersistentTopics.java:376) [org.apache.pulsar-pulsar-broker-2.2.1.jar:2.2.1]\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_181]\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_181]\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_181]\r\n        at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_181]\r\n        at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81) [org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n`\r\n\r\nThis is similar to #1615, which is closed. \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Set up a multi-broker cluster.\r\n2. Try to add a subscription to an existing topic.\r\n\r\npulsar-admin topics create-subscription -s testsub3 persistent://public/useast1-gcp/test5\r\n\r\n3. Repeat step 2 with new subscriptions until the command fails\r\n\r\n**Expected behavior**\r\nSubscription creation should always succeed. If it is going to fail, it shouldn't just time out, but return a meaningful error code/message.\r\n\r\n**Screen capture**\r\nHere are the commands I ran:\r\n$ pulsar-admin topics create-subscription -s testsub3 persistent://public/useast1-gcp/test5\r\nHTTP 504 Gateway Timeout\r\n\r\nReason: HTTP 504 Gateway Timeout\r\n$ pulsar-admin topics create-subscription -s testsub3 persistent://public/useast1-gcp/test5\r\n\r\nThis second attempt succeeded.\r\n\r\n**Additional context**\r\nI am running 2.2.1 in k8s. I have 3 brokers and 3 proxies.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3702", "user": "cdbartholomew", "labels": ["component/broker", "triage/week-35", "type/bug"], "created": "2019-02-27 18:19:33", "closed": "2020-01-05 22:34:33", "commits": {}, "ttf": 312.0002777777778, "commitsDetails": []}, {"title": "build failed without lombok ", "body": "why use lombok plugin ?\r\n\r\nthis plugin cause source build failed , not friendly to read source. \r\n\r\nvery very not friendly ~~ \r\n\r\ntrash", "url": "https://github.com/apache/pulsar/issues/3699", "user": "jarkata", "labels": ["type/bug"], "created": "2019-02-27 06:35:40", "closed": "2019-02-28 14:48:36", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Unable to build Docker images", "body": "**Describe the bug**\r\n\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Check out the latest version from the master branch\r\n2. run `mvn clean install -Pdocker -DskipTests`\r\n3. Error occurs\r\n\r\n**Expected behavior**\r\nExpected the build to complete successfully without errors\r\n\r\n**Screenshots**\r\n\r\n[ERROR] Failed to execute goal com.spotify:dockerfile-maven-plugin:1.4.9:build (default) on project pulsar-standalone-docker-image: Could not build image: The command '/bin/sh -c apt-get update' returned a non-zero code: 100 -> [Help 1]\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Mac 10.14.3\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3692", "user": "david-streamlio", "labels": ["type/bug"], "created": "2019-02-26 16:16:25", "closed": "2019-02-26 17:06:45", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Via the python client I am unable to consume messages with a multi-topic regex consumer", "body": "**Describe the bug**\r\nVia the python client I am unable to consume messages with a multi-topic regex consumer\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. bring up pulsar standalone instance via docker \r\n```\r\ndocker run -it -p 80:80 -p 8080:8080 -p 6650:6650 apachepulsar/pulsar-standalone\r\n```\r\n2. init python client\r\n```python\r\npulsar_client = pulsar.Client('pulsar://localhost:6650')\r\n```\r\n3. create subscriber \r\n```python\r\nconsumer = pulsar_client.subscribe(re.compile('test_.*'), 'sub1')\r\n```\r\n4. create producer \r\n```python\r\nproducer = pulsar_client.create_producer('test_1')\r\n```\r\n5. via 2 different python instances / threads / processes attempt to send + read\r\n```python\r\nwhile Ture:\r\n    producer.send(b'test')\r\n```\r\n```python\r\nconsumer.receive()\r\n```\r\n6. ERROR: consumer never received any messages \r\n\r\n**Expected behavior**\r\ntopic `test_1` should be read by subscription `test_.*`\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: mac OS (pulsar running in docker)\r\n - pulsar version: latest master from docker (should be 2.2.0?)\r\n - python version: 3.7\r\n - pulsar-client (pip lib) version: 2.3.0.post1 (latest)\r\n", "url": "https://github.com/apache/pulsar/issues/3681", "user": "matansh", "labels": ["component/documentation", "triage/week-3", "type/bug"], "created": "2019-02-25 13:14:58", "closed": "2020-01-22 14:12:48", "commits": {"992fc1eff12838794486a3d46db729477e6e0775": {"commitGHEventType": "referenced", "commitUser": "codelipenghui"}}, "ttf": 331.0002777777778, "commitsDetails": [{"commitHash": "992fc1eff12838794486a3d46db729477e6e0775", "commitGHEventType": "referenced", "commitUser": "codelipenghui", "commitParents": ["cb19ee87b7a6eb01e382ba3d6576f825de0aa3d4"], "nameRev": "992fc1eff12838794486a3d46db729477e6e0775 tags/v2.6.0-candidate-1~601", "commitMessage": "[Issue 3681][docs] Update client-libraries in Get Started chapter (#6050)\n\nFixes #3681 \r\n\r\n### Motivation\r\nThe client library doc content is out of date.\r\n\r\n### Modifications\r\n1. Pulsar supports more clients, add links to the new clients.\r\n2. Remove redundant information, and will update each client respectively.\r\n3. Update Pulsar client go info.\r\n4. Proofread parts of the Python/Go client content while reading.\r\n5. Fixes #3681 by adding examples in Python client.\r\n6. Update Python API.", "commitDateTime": "2020-01-22 22:12:47", "authoredDateTime": "2020-01-22 22:12:47", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/pulsar/__init__.py", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/docs/client-libraries-cpp.md", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "site2/docs/client-libraries-go.md", "insertions": 14, "deletions": 8, "lines": 22}, {"filePath": "site2/docs/client-libraries-python.md", "insertions": 45, "deletions": 32, "lines": 77}, {"filePath": "site2/docs/getting-started-clients.md", "insertions": 11, "deletions": 38, "lines": 49}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Pulsar SQL queries fail with \"failed: refCnt: 0\"", "body": "**Describe the bug**\r\nWhen querying topics via Pulsar SQL all queries return `failed: refCnt: 0`\r\n\r\n**To Reproduce**\r\nA topic is created and data is input via the python client version 2.3.0 with: \r\n```\r\nclass SimpleRecord(Record):\r\n    field1 = String()\r\n\t\r\nclient = pulsar.Client(PULSAR_ADDRESS)\r\nproducer = client.create_producer(PULSAR_TOPIC,                                 schema=JsonSchema(SimpleRecord))\r\n\r\nproducer.send(SimpleRecord(field1 = 'hello'))\r\n```\r\n\r\nThis data is then queried via Pulsar SQL e.g. `select * from pulsar.\"tenant/namespace\".topic\";`\r\n\r\nThis returns something along the lines of `Query 20190225_054406_00025_mvftm failed: refCnt: 0`\r\n\r\n\r\n**Logs from presto-coordinator**\r\n\r\n```\r\n2019-02-25T05:44:06.304Z\tINFO\t20190225_054406_00025_mvftm.1.0-0-116\torg.apache.pulsar.sql.presto.PulsarRecordCursor\tInitializing split with parameters: PulsarSplit{splitId=0, connectorId='pulsar', schemaName='{TENANT}/{NAMESPACE}', tableName='[REDACTED]', splitSize=2, schema='{\r\n \"name\": \"SimpleRecord\",\r\n \"type\": \"record\",\r\n \"fields\": [\r\n  {\r\n   \"name\": \"field1\",\r\n   \"type\": [\r\n    \"null\",\r\n    \"string\"\r\n   ]\r\n  }\r\n ]\r\n}', schemaType=JSON, startPositionEntryId=0, endPositionEntryId=2, startPositionLedgerId=819, endPositionLedgerId=819}\r\n2019-02-25T05:44:06.314Z\tERROR\tSplitRunner-12-116\tcom.facebook.presto.execution.executor.TaskExecutor\tError processing Split 20190225_054406_00025_mvftm.1.0-0 PulsarSplit{splitId=0, connectorId='pulsar', schemaName={TENANT}/{NAMESPACE}', tableName='[REDACTED]', splitSize=2, schema='{\r\n \"name\": \"SimpleRecord\",\r\n \"type\": \"record\",\r\n \"fields\": [\r\n  {\r\n   \"name\": \"field1\",\r\n   \"type\": [\r\n    \"null\",\r\n    \"string\"\r\n   ]\r\n  }\r\n ]\r\n}', schemaType=JSON, startPositionEntryId=0, endPositionEntryId=2, startPositionLedgerId=819, endPositionLedgerId=819} (start = 6.21978132751379E8, wall = 23 ms, cpu = 0 ms, wait = 1 ms, calls = 1)\r\norg.apache.pulsar.shade.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n\tat org.apache.pulsar.shade.io.netty.buffer.AbstractByteBuf.ensureAccessible(AbstractByteBuf.java:1450)\r\n\tat org.apache.pulsar.shade.io.netty.buffer.AbstractByteBuf.checkReadableBytes0(AbstractByteBuf.java:1434)\r\n\tat org.apache.pulsar.shade.io.netty.buffer.AbstractByteBuf.checkReadableBytes(AbstractByteBuf.java:1420)\r\n\tat org.apache.pulsar.shade.io.netty.buffer.AbstractByteBuf.readBytes(AbstractByteBuf.java:895)\r\n\tat org.apache.pulsar.sql.presto.JSONSchemaHandler.deserialize(JSONSchemaHandler.java:66)\r\n\tat org.apache.pulsar.sql.presto.PulsarRecordCursor.advanceNextPosition(PulsarRecordCursor.java:403)\r\n\tat com.facebook.presto.spi.RecordPageSource.getNextPage(RecordPageSource.java:93)\r\n\tat com.facebook.presto.operator.TableScanOperator.getOutput(TableScanOperator.java:242)\r\n\tat com.facebook.presto.operator.Driver.processInternal(Driver.java:373)\r\n\tat com.facebook.presto.operator.Driver.lambda$processFor$8(Driver.java:282)\r\n\tat com.facebook.presto.operator.Driver.tryWithLock(Driver.java:672)\r\n\tat com.facebook.presto.operator.Driver.processFor(Driver.java:276)\r\n\tat com.facebook.presto.execution.SqlTaskExecution$DriverSplitRunner.processFor(SqlTaskExecution.java:973)\r\n\tat com.facebook.presto.execution.executor.PrioritizedSplitRunner.process(PrioritizedSplitRunner.java:162)\r\n\tat com.facebook.presto.execution.executor.TaskExecutor$TaskRunner.run(TaskExecutor.java:477)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n\r\n\r\n2019-02-25T05:44:06.315Z\tINFO\tSplitRunner-12-116\torg.apache.pulsar.sql.presto.PulsarRecordCursor\tClosing cursor record\r\n2019-02-25T05:44:06.316Z\tERROR\tSplitRunner-12-116\tcom.facebook.presto.operator.Driver\tError closing operator 0 for task 20190225_054406_00025_mvftm.1.0\r\norg.apache.pulsar.shade.io.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1\r\n\tat org.apache.pulsar.shade.io.netty.buffer.AbstractReferenceCountedByteBuf.release0(AbstractReferenceCountedByteBuf.java:124)\r\n\tat org.apache.pulsar.shade.io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:107)\r\n\tat org.apache.pulsar.shade.io.netty.buffer.AbstractPooledDerivedByteBuf$PooledNonRetainedSlicedByteBuf.release0(AbstractPooledDerivedByteBuf.java:271)\r\n\tat org.apache.pulsar.shade.io.netty.buffer.AbstractDerivedByteBuf.release(AbstractDerivedByteBuf.java:85)\r\n\tat org.apache.pulsar.common.api.raw.RawMessageImpl.release(RawMessageImpl.java:65)\r\n\tat org.apache.pulsar.sql.presto.PulsarRecordCursor.close(PulsarRecordCursor.java:507)\r\n\tat com.facebook.presto.spi.RecordPageSource.close(RecordPageSource.java:74)\r\n\tat com.facebook.presto.operator.TableScanOperator.finish(TableScanOperator.java:185)\r\n\tat com.facebook.presto.operator.TableScanOperator.close(TableScanOperator.java:174)\r\n\tat com.facebook.presto.operator.Driver.closeAndDestroyOperators(Driver.java:543)\r\n\tat com.facebook.presto.operator.Driver.destroyIfNecessary(Driver.java:506)\r\n\tat com.facebook.presto.operator.Driver.tryWithLock(Driver.java:680)\r\n\tat com.facebook.presto.operator.Driver.tryWithLock(Driver.java:650)\r\n\tat com.facebook.presto.operator.Driver.close(Driver.java:180)\r\n\tat com.facebook.presto.execution.SqlTaskExecution$DriverSplitRunner.close(SqlTaskExecution.java:992)\r\n\tat com.facebook.presto.execution.executor.PrioritizedSplitRunner.destroy(PrioritizedSplitRunner.java:115)\r\n\tat com.facebook.presto.execution.executor.TaskExecutor.splitFinished(TaskExecutor.java:355)\r\n\tat com.facebook.presto.execution.executor.TaskExecutor.access$800(TaskExecutor.java:75)\r\n\tat com.facebook.presto.execution.executor.TaskExecutor$TaskRunner.run(TaskExecutor.java:514)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n\r\n\r\n2019-02-25T05:44:06.316Z\tERROR\tremote-task-callback-60\tcom.facebook.presto.execution.StageStateMachine\tStage 20190225_054406_00025_mvftm.1 failed\r\norg.apache.pulsar.shade.io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n\tat org.apache.pulsar.shade.io.netty.buffer.AbstractByteBuf.ensureAccessible(AbstractByteBuf.java:1450)\r\n\tat org.apache.pulsar.shade.io.netty.buffer.AbstractByteBuf.checkReadableBytes0(AbstractByteBuf.java:1434)\r\n\tat org.apache.pulsar.shade.io.netty.buffer.AbstractByteBuf.checkReadableBytes(AbstractByteBuf.java:1420)\r\n\tat org.apache.pulsar.shade.io.netty.buffer.AbstractByteBuf.readBytes(AbstractByteBuf.java:895)\r\n\tat org.apache.pulsar.sql.presto.JSONSchemaHandler.deserialize(JSONSchemaHandler.java:66)\r\n\tat org.apache.pulsar.sql.presto.PulsarRecordCursor.advanceNextPosition(PulsarRecordCursor.java:403)\r\n\tat com.facebook.presto.spi.RecordPageSource.getNextPage(RecordPageSource.java:93)\r\n\tat com.facebook.presto.operator.TableScanOperator.getOutput(TableScanOperator.java:242)\r\n\tat com.facebook.presto.operator.Driver.processInternal(Driver.java:373)\r\n\tat com.facebook.presto.operator.Driver.lambda$processFor$8(Driver.java:282)\r\n\tat com.facebook.presto.operator.Driver.tryWithLock(Driver.java:672)\r\n\tat com.facebook.presto.operator.Driver.processFor(Driver.java:276)\r\n\tat com.facebook.presto.execution.SqlTaskExecution$DriverSplitRunner.processFor(SqlTaskExecution.java:973)\r\n\tat com.facebook.presto.execution.executor.PrioritizedSplitRunner.process(PrioritizedSplitRunner.java:162)\r\n\tat com.facebook.presto.execution.executor.TaskExecutor$TaskRunner.run(TaskExecutor.java:477)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n\r\n\r\n2019-02-25T05:44:06.339Z\tINFO\tquery-execution-22\tcom.facebook.presto.event.query.QueryMonitor\tTIMELINE: Query 20190225_054406_00025_mvftm :: Transaction:[63d6212b-6394-4a8b-9a8d-486f7c4690e0] :: elapsed 140ms :: planning 56ms :: scheduling 60ms :: running 32ms :: finishing 0ms :: begin 2019-02-25T05:44:06.177Z :: end 2019-02-25T05:44:06.317Z\r\n\r\n```\r\n\r\n**Pulsar version**\r\nAll components are using the docker image `pulsar-all:2.3.0` \r\n\r\nClient that creates topic & associated schema etc is the Python client pulsar-client 2.3.0 pulled from Pip\r\n\r\nIssue created off the back of discussions in #general in the Pulsar Slack with @sijie and others\r\n", "url": "https://github.com/apache/pulsar/issues/3679", "user": "ofaz", "labels": ["component/sql", "type/bug"], "created": "2019-02-25 05:58:14", "closed": "2019-02-27 05:16:21", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "pulsar-admin topics list public/default fails", "body": "**Describe the bug**\r\npulsar-admin topics list public/default\r\nOs Ubuntu 16 04\r\nPulsar 2.3.0\r\n\r\n\r\nFailed with following error in log \r\n```\r\n[2019-02-22T13:59:00.704Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.5 - - [22/Feb/2019:13:59:00 +0000] \"GET /admin/clusters/stage HTTP/1.1\" 200 224 \"-\" \"python-requests/2.19.1\" 2\r\n[2019-02-22T13:59:00.746Z] INFO pulsar-web-29-3 RequestLog:60 10.10.58.5 - - [22/Feb/2019:13:59:00 +0000] \"GET /admin/broker-stats/destinations HTTP/1.1\" 200 1266 \"-\" \"python-requests/2.19.1\" 2\r\n[2019-02-22T13:59:05.706Z] INFO pulsar-web-29-4 RequestLog:60 10.10.58.5 - - [22/Feb/2019:13:59:05 +0000] \"GET /admin/clusters/stage HTTP/1.1\" 200 224 \"-\" \"python-requests/2.19.1\" 2\r\n[2019-02-22T13:59:05.750Z] INFO pulsar-web-29-3 RequestLog:60 10.10.58.5 - - [22/Feb/2019:13:59:05 +0000] \"GET /admin/broker-stats/destinations HTTP/1.1\" 200 1266 \"-\" \"python-requests/2.19.1\" 1\r\n[2019-02-22T13:59:06.354Z] INFO pulsar-web-29-1 RequestLog:60 127.0.0.1 - - [22/Feb/2019:13:59:06 +0000] \"GET /admin/v2/persistent/public/default HTTP/1.1\" 200 396 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_201)\" 8\r\n[2019-02-22T14:00:06.407Z] INFO pulsar-web-29-4 RequestLog:60 10.10.58.5 - - [22/Feb/2019:14:00:06 +0000] \"GET /admin/brokers/stage HTTP/1.1\" 200 91 \"-\" \"python-requests/2.19.1\" 3\r\n[2019-02-22T14:01:01.902Z] INFO pulsar-ordered-OrderedExecutor-5-0-EventThread ZooKeeperDataCache:153 [State:CONNECTED Timeout:30000 sessionid:0x1049b573fba001a local:/10.10.58.7:39486 remoteserver:zk-node-1.bm.infra/10.10.58.15:2181 lastZxid:4294968305 xid:532 sent:532 recv:538 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/loadbalance/brokers/pulsar-node-1.bm.infra:8080\r\n[2019-02-22T14:01:06.526Z] ERROR pulsar-web-29-3 NonPersistentTopics:198 [null] Failed to get list of topics under namespace public/default\r\njava.util.concurrent.ExecutionException: org.apache.pulsar.client.admin.PulsarAdminException: java.net.SocketTimeoutException: Read timed out\r\n\tat java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357) ~[?:1.8.0_201]\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895) ~[?:1.8.0_201]\r\n\tat org.apache.pulsar.broker.admin.v2.NonPersistentTopics.getList(NonPersistentTopics.java:186) ~[org.apache.pulsar-pulsar-broker-2.3.0.jar:2.3.0]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_201]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_201]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_201]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_201]\r\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:76) ~[org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:148) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:191) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$TypeOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:243) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:103) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:493) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:415) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:104) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:277) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:316) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:298) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:268) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:289) [org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:256) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:703) [org.glassfish.jersey.core-jersey-server-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:416) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:370) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:389) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:342) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:229) [org.glassfish.jersey.containers-jersey-container-servlet-core-2.27.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:865) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1655) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53) [org.apache.pulsar-pulsar-broker-2.3.0.jar:2.3.0]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1642) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1340) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [org.eclipse.jetty-jetty-servlet-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1242) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:220) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:174) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:503) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:364) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260) [org.eclipse.jetty-jetty-server-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:305) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118) [org.eclipse.jetty-jetty-io-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366) [org.eclipse.jetty-jetty-util-9.4.12.v20180830.jar:9.4.12.v20180830]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_201]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_201]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_201]\r\nCaused by: org.apache.pulsar.client.admin.PulsarAdminException: java.net.SocketTimeoutException: Read timed out\r\n\tat org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:187) ~[org.apache.pulsar-pulsar-client-admin-original-2.3.0.jar:2.3.0]\r\n\tat org.apache.pulsar.client.admin.internal.TopicsImpl$5.failed(TopicsImpl.java:157) ~[org.apache.pulsar-pulsar-client-admin-original-2.3.0.jar:2.3.0]\r\n\tat org.glassfish.jersey.client.JerseyInvocation$4.failed(JerseyInvocation.java:1030) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.ClientRuntime.processFailure(ClientRuntime.java:231) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.ClientRuntime.access$100(ClientRuntime.java:85) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.ClientRuntime$2.lambda$failure$1(ClientRuntime.java:183) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:316) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:298) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:312) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.ClientRuntime$2.failure(ClientRuntime.java:183) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.internal.HttpUrlConnector.apply(HttpUrlConnector.java:294) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.ClientRuntime.lambda$null$3(ClientRuntime.java:187) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:316) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:298) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:312) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.ClientRuntime.lambda$createRunnableForAsyncProcessing$4(ClientRuntime.java:163) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_201]\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_201]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_201]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_201]\r\n\t... 1 more\r\nCaused by: java.net.SocketTimeoutException: Read timed out\r\n\tat java.net.SocketInputStream.socketRead0(Native Method) ~[?:1.8.0_201]\r\n\tat java.net.SocketInputStream.socketRead(SocketInputStream.java:116) ~[?:1.8.0_201]\r\n\tat java.net.SocketInputStream.read(SocketInputStream.java:171) ~[?:1.8.0_201]\r\n\tat java.net.SocketInputStream.read(SocketInputStream.java:141) ~[?:1.8.0_201]\r\n\tat java.io.BufferedInputStream.fill(BufferedInputStream.java:246) ~[?:1.8.0_201]\r\n\tat java.io.BufferedInputStream.read1(BufferedInputStream.java:286) ~[?:1.8.0_201]\r\n\tat java.io.BufferedInputStream.read(BufferedInputStream.java:345) ~[?:1.8.0_201]\r\n\tat sun.net.www.http.HttpClient.parseHTTPHeader(HttpClient.java:735) ~[?:1.8.0_201]\r\n\tat sun.net.www.http.HttpClient.parseHTTP(HttpClient.java:678) ~[?:1.8.0_201]\r\n\tat sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:1587) ~[?:1.8.0_201]\r\n\tat sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1492) ~[?:1.8.0_201]\r\n\tat java.net.HttpURLConnection.getResponseCode(HttpURLConnection.java:480) ~[?:1.8.0_201]\r\n\tat org.glassfish.jersey.client.internal.HttpUrlConnector._apply(HttpUrlConnector.java:390) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.internal.HttpUrlConnector.apply(HttpUrlConnector.java:292) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.ClientRuntime.lambda$null$3(ClientRuntime.java:187) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:272) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:316) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:298) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:268) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:312) ~[org.glassfish.jersey.core-jersey-common-2.27.jar:?]\r\n\tat org.glassfish.jersey.client.ClientRuntime.lambda$createRunnableForAsyncProcessing$4(ClientRuntime.java:163) ~[org.glassfish.jersey.core-jersey-client-2.27.jar:?]\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_201]\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_201]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) ~[?:1.8.0_201]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) ~[?:1.8.0_201]\r\n\t... 1 more\r\n[2019-02-22T14:01:06.530Z] INFO pulsar-web-29-3 RequestLog:60 127.0.0.1 - - [22/Feb/2019:13:59:06 +0000] \"GET /admin/v2/non-persistent/public/default HTTP/1.1\" 500 3400 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_201)\" 120127\r\n[2019-02-22T14:01:06.535Z] INFO pulsar-web-29-1 NonPersistentTopics:225 [null] Namespace bundle is not owned by any broker public/default/0x80000000_0x90000000\r\n[2019-02-22T14:01:06.536Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.7 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/v2/non-persistent/public/default/0x80000000_0x90000000 HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_201)\" 5\r\n[2019-02-22T14:01:06.537Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.5 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/broker-stats/destinations HTTP/1.1\" 200 1266 \"-\" \"python-requests/2.19.1\" 1\r\n[2019-02-22T14:01:06.541Z] INFO pulsar-web-29-1 NonPersistentTopics:225 [null] Namespace bundle is not owned by any broker public/default/0x90000000_0xa0000000\r\n[2019-02-22T14:01:06.542Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.7 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/v2/non-persistent/public/default/0x90000000_0xa0000000 HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_201)\" 4\r\n[2019-02-22T14:01:06.544Z] INFO pulsar-web-29-1 NonPersistentTopics:225 [null] Namespace bundle is not owned by any broker public/default/0xb0000000_0xc0000000\r\n[2019-02-22T14:01:06.545Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.7 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/v2/non-persistent/public/default/0xb0000000_0xc0000000 HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_201)\" 3\r\n[2019-02-22T14:01:06.547Z] INFO pulsar-web-29-1 NonPersistentTopics:225 [null] Namespace bundle is not owned by any broker public/default/0xc0000000_0xd0000000\r\n[2019-02-22T14:01:06.547Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.7 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/v2/non-persistent/public/default/0xc0000000_0xd0000000 HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_201)\" 2\r\n[2019-02-22T14:01:06.549Z] INFO pulsar-web-29-1 NonPersistentTopics:225 [null] Namespace bundle is not owned by any broker public/default/0xa0000000_0xb0000000\r\n[2019-02-22T14:01:06.549Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.7 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/v2/non-persistent/public/default/0xa0000000_0xb0000000 HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_201)\" 2\r\n[2019-02-22T14:01:06.551Z] INFO pulsar-web-29-1 NonPersistentTopics:225 [null] Namespace bundle is not owned by any broker public/default/0xd0000000_0xe0000000\r\n[2019-02-22T14:01:06.552Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.7 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/v2/non-persistent/public/default/0xd0000000_0xe0000000 HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_201)\" 2\r\n[2019-02-22T14:01:06.554Z] INFO pulsar-web-29-1 NonPersistentTopics:225 [null] Namespace bundle is not owned by any broker public/default/0xe0000000_0xf0000000\r\n[2019-02-22T14:01:06.555Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.7 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/v2/non-persistent/public/default/0xe0000000_0xf0000000 HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_201)\" 3\r\n[2019-02-22T14:01:06.557Z] INFO pulsar-web-29-1 NonPersistentTopics:225 [null] Namespace bundle is not owned by any broker public/default/0xf0000000_0xffffffff\r\n[2019-02-22T14:01:06.557Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.7 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/v2/non-persistent/public/default/0xf0000000_0xffffffff HTTP/1.1\" 204 0 \"-\" \"Jersey/2.27 (HttpUrlConnection 1.8.0_201)\" 2\r\n[2019-02-22T14:01:06.559Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.5 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/brokers/stage HTTP/1.1\" 200 91 \"-\" \"python-requests/2.19.1\" 1\r\n[2019-02-22T14:01:06.560Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.5 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/brokers/stage HTTP/1.1\" 200 91 \"-\" \"python-requests/2.19.1\" 1\r\n[2019-02-22T14:01:06.562Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.5 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/brokers/stage HTTP/1.1\" 200 91 \"-\" \"python-requests/2.19.1\" 1\r\n[2019-02-22T14:01:06.563Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.5 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/brokers/stage HTTP/1.1\" 200 91 \"-\" \"python-requests/2.19.1\" 1\r\n[2019-02-22T14:01:06.564Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.5 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/brokers/stage HTTP/1.1\" 200 91 \"-\" \"python-requests/2.19.1\" 1\r\n[2019-02-22T14:01:06.566Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.5 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/brokers/stage HTTP/1.1\" 200 91 \"-\" \"python-requests/2.19.1\" 1\r\n[2019-02-22T14:01:06.569Z] INFO pulsar-web-29-1 RequestLog:60 10.10.58.5 - - [22/Feb/2019:14:01:06 +0000] \"GET /admin/v2/persistent/public/default/my-topic/stats?authoritative=true HTTP/1.1\" 200 1302 \"-\" \"curl/7.47.0\" 3\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/3671", "user": "skyrocknroll", "labels": ["component/broker", "type/bug"], "created": "2019-02-22 14:04:10", "closed": "2019-03-11 05:08:31", "commits": {}, "ttf": 16.00027777777778, "commitsDetails": []}, {"title": "Debezium connector is broken in 2.3.0", "body": "Steps to reproduce\r\n\r\n```docker run -it -p 6650:6650 -p 8080:8080 apachepulsar/pulsar-all:2.3.0  /pulsar/bin/pulsar standalone```\r\n\r\nError Log\r\n```\r\n00:06:01.073 [main] WARN  org.apache.pulsar.functions.utils.io.ConnectorUtils - Failed to load connector from /pulsar/./connectors/pulsar-io-debezium-2.3.0.nar\r\njava.nio.file.NoSuchFileException: /tmp/pulsar-nar/pulsar-io-debezium-2.3.0.nar-unpacked/META-INF/services/pulsar-io.yaml\r\n\tat sun.nio.fs.UnixException.translateToIOException(UnixException.java:86) ~[?:1.8.0_181]\r\n\tat sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102) ~[?:1.8.0_181]\r\n\tat sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107) ~[?:1.8.0_181]\r\n\tat sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:214) ~[?:1.8.0_181]\r\n\tat java.nio.file.Files.newByteChannel(Files.java:361) ~[?:1.8.0_181]\r\n\tat java.nio.file.Files.newByteChannel(Files.java:407) ~[?:1.8.0_181]\r\n\tat java.nio.file.Files.readAllBytes(Files.java:3152) ~[?:1.8.0_181]\r\n\tat org.apache.pulsar.common.nar.NarClassLoader.getServiceDefinition(NarClassLoader.java:198) ~[org.apache.pulsar-pulsar-common-2.3.0.jar:2.3.0]\r\n\tat org.apache.pulsar.functions.utils.io.ConnectorUtils.getConnectorDefinition(ConnectorUtils.java:103) ~[org.apache.pulsar-pulsar-functions-utils-2.3.0.jar:2.3.0]\r\n\tat org.apache.pulsar.functions.utils.io.ConnectorUtils.searchForConnectors(ConnectorUtils.java:123) [org.apache.pulsar-pulsar-functions-utils-2.3.0.jar:2.3.0]\r\n\tat org.apache.pulsar.functions.worker.ConnectorsManager.<init>(ConnectorsManager.java:34) [org.apache.pulsar-pulsar-functions-worker-2.3.0.jar:2.3.0]\r\n\tat org.apache.pulsar.functions.worker.WorkerService.start(WorkerService.java:159) [org.apache.pulsar-pulsar-functions-worker-2.3.0.jar:2.3.0]\r\n\tat org.apache.pulsar.broker.PulsarService.startWorkerService(PulsarService.java:1042) [org.apache.pulsar-pulsar-broker-2.3.0.jar:2.3.0]\r\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:441) [org.apache.pulsar-pulsar-broker-2.3.0.jar:2.3.0]\r\n\tat org.apache.pulsar.PulsarStandalone.start(PulsarStandalone.java:305) [org.apache.pulsar-pulsar-broker-2.3.0.jar:2.3.0]\r\n\tat org.apache.pulsar.PulsarStandaloneStarter.main(PulsarStandaloneStarter.java:102) [org.apache.pulsar-pulsar-broker-2.3.0.jar:2.3.0]\r\n```", "url": "https://github.com/apache/pulsar/issues/3651", "user": "aahmed-se", "labels": ["type/bug"], "created": "2019-02-22 00:07:39", "closed": "2019-02-22 08:36:50", "commits": {"bd62dab661e5339e3440aea273d76606e5146fdb": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "d270056d2abc752d87f789799759266fbd70367c": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "bd62dab661e5339e3440aea273d76606e5146fdb", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["40b374d3e3009808aed2060c293d78e051ba5a9d"], "nameRev": "bd62dab661e5339e3440aea273d76606e5146fdb tags/v2.4.0-candidate-1~568", "commitMessage": "[distribution] remove pulsar-io-debezium nar package (#3656)\n\n*Motivation*\r\n\r\nFixes #3651\r\n\r\n`pulsar-io-debezium` is a normal module but not a connector package.\r\nit was added as a connector package by mistake at #3601. This would\r\ncause failing to load connectors during broker starts up.\r\n\r\n*Changes*\r\n\r\n- remove nar plugin from `pulsar-io-debezium`\r\n- remove `pulsar-io-debezium` from distribution\r\n- add `pulsar-io-kafka-connect-adaptor` in the website", "commitDateTime": "2019-02-22 00:36:49", "authoredDateTime": "2019-02-22 16:36:49", "commitGitStats": [{"filePath": "distribution/io/src/assemble/io.xml", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-io/debezium/pom.xml", "insertions": 0, "deletions": 10, "lines": 10}, {"filePath": "site2/website/data/connectors.js", "insertions": 6, "deletions": 0, "lines": 6}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "d270056d2abc752d87f789799759266fbd70367c", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["4e9a4a4478f079fcebd66d2d22ba772d9190a46c"], "nameRev": "d270056d2abc752d87f789799759266fbd70367c tags/v2.3.1-candidate-1~90", "commitMessage": "[distribution] remove pulsar-io-debezium nar package (#3656)\n\n*Motivation*\n\nFixes #3651\n\n`pulsar-io-debezium` is a normal module but not a connector package.\nit was added as a connector package by mistake at #3601. This would\ncause failing to load connectors during broker starts up.\n\n*Changes*\n\n- remove nar plugin from `pulsar-io-debezium`\n- remove `pulsar-io-debezium` from distribution\n- add `pulsar-io-kafka-connect-adaptor` in the website\n", "commitDateTime": "2019-03-29 09:29:05", "authoredDateTime": "2019-02-22 16:36:49", "commitGitStats": [{"filePath": "distribution/io/src/assemble/io.xml", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-io/debezium/pom.xml", "insertions": 0, "deletions": 10, "lines": 10}, {"filePath": "site2/website/data/connectors.js", "insertions": 98, "deletions": 0, "lines": 98}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Schema in JSON ", "body": "**Describe the bug**\r\nthis is the first time schema\r\n![image](https://user-images.githubusercontent.com/39078850/53084016-f6699280-353a-11e9-930b-8e0d088fb707.png)\r\nthis is the second time schema\r\n![image](https://user-images.githubusercontent.com/39078850/53084084-16995180-353b-11e9-804e-5a0290368f90.png)\r\nbut it report an error\r\n![image](https://user-images.githubusercontent.com/39078850/53084158-37fa3d80-353b-11e9-892c-a78667c617f9.png)\r\nwhen I revise the ddd field to String type,it can create producer and send message\r\n", "url": "https://github.com/apache/pulsar/issues/3631", "user": "congbobo184", "labels": ["type/bug"], "created": "2019-02-20 10:16:33", "closed": "2019-02-21 03:31:24", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "No documentation on how to get connector logs", "body": "**Describe the bug**\r\n\r\nLets say you start a connector. It isn't working for some reason. How do you get detailed logging of what is happening? Same goes for functions. There are files on the filesystem, but you have to look at the running process to see what they are. With k8s this is probably even harder.", "url": "https://github.com/apache/pulsar/issues/3624", "user": "ivankelly", "labels": ["component/connect", "component/documentation", "triage/week-35", "type/bug"], "created": "2019-02-19 09:16:38", "closed": "2019-09-03 03:56:16", "commits": {"2ed7d6e66aab676210def079751f979c68d5e8f9": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 195.00027777777777, "commitsDetails": [{"commitHash": "2ed7d6e66aab676210def079751f979c68d5e8f9", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["b8aa2c9e6e6e9e76a1b724c8e23b6c6965a0d1aa"], "nameRev": "2ed7d6e66aab676210def079751f979c68d5e8f9 tags/v2.5.0-candidate-1~385", "commitMessage": "[doc]Add document for debug connector (#5041)\n\nFixes #3624 \r\n\r\nMaster Issue: #3624\r\n\r\n### Motivation\r\n\r\nIf the current user encounters problems when using the connector, there is not a reasonable debugging process. This document attempts to provide a debugging process for the connector.\r\n\r\n### Modifications\r\n\r\n* Add debugging document for the connector.", "commitDateTime": "2019-09-02 20:56:15", "authoredDateTime": "2019-09-03 11:56:15", "commitGitStats": [{"filePath": "site2/docs/io-debug.md", "insertions": 328, "deletions": 0, "lines": 328}, {"filePath": "site2/website/sidebars.json", "insertions": 3, "deletions": 2, "lines": 5}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Pulsar C++/Python consumer performance issue, if producing message in batch mode, consuming ACK in single mode", "body": "#### Expected behavior\r\nPulsar C++/Python client consuming  performance should keep at a stable level;\r\n\r\n#### Actual behavior\r\n\r\n Pulsar C++/Python client consuming  performance  downgrade obviously;\r\n\r\n#### Steps to reproduce\r\n1. Producing messages in batch mode (locally with batch count as 1000);\r\n2. Consuming messages with ACK in single mode (as appose to the cumulative mode) with C++ or Python clients;\r\n3. Keep the consuming process running for a while (say, with producing message 5000-8000 per second, run at least 15 minutes) and see the consuming messages per seconds, it downgrades very obviously; At the same time, the Pulsar Java client consuming performance could keep in a stable level.\r\nSee the attached monitor screen below:\r\n![image](https://user-images.githubusercontent.com/7017849/53001501-bd132300-3465-11e9-9dff-7d382030284a.png)\r\n\r\n\r\n#### System configuration\r\norg.apache.pulsar:pulsar-client-cpp: 2.2.0\r\n", "url": "https://github.com/apache/pulsar/issues/3623", "user": "easyfan", "labels": ["component/c++", "component/client", "type/bug"], "created": "2019-02-19 08:33:40", "closed": "2019-02-21 09:17:38", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Several broken links in spark adaptor docs", "body": "**Describe the bug**\r\nSeveral links to SparkStreamingPulsarReceiverExample are broken in spark adaptor mds\r\n\r\n**To Reproduce**\r\nclick on those links will get 404 error\r\n\r\n**Expected behavior**\r\nlinks to the right files\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3586", "user": "VinceShieh", "labels": ["type/bug"], "created": "2019-02-13 02:29:12", "closed": "2019-02-14 09:12:57", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Unexpected ZooKeeper disconnection and finally Brokers shutdown", "body": "**Describe the bug**\r\nA Bookie (1 of 10 in one cluster) suddenly went down:\r\n```\r\n21:07:04.804 [BookieJournal-3181] INFO  o.a.bookkeeper.bookie.JournalChannel - Opening journal /journal/current/16227802a46.txn\r\n21:08:05.761 [bookie-io-1-20] INFO  o.a.bookkeeper.proto.AuthHandler     - Authentication success on server side\r\n21:08:05.761 [bookie-io-1-20] INFO  o.a.b.proto.BookieRequestHandler     - Channel connected  [id: 0x68f20463, L:/<bookie ip>:3181 - R:/<bookie ip>:50480]\r\n21:08:07.668 [bookie-io-1-21] INFO  o.a.bookkeeper.proto.AuthHandler     - Authentication success on server side\r\n21:08:07.668 [bookie-io-1-21] INFO  o.a.b.proto.BookieRequestHandler     - Channel connected  [id: 0x2d93aca1, L:/<bookie ip>:3181 - R:/<bookie ip>:50488]\r\n21:08:07.798 [BookieHighPriorityThread-3181-OrderedExecutor-1-0] INFO  o.a.b.proto.ReadEntryProcessorV3     - Ledger fence request received for ledger: 9358129 from address: /<bookie ip>:50488\r\n21:08:08.061 [bookie-io-1-21] INFO  o.a.b.proto.BookieRequestHandler     - Channels disconnected: [id: 0x2d93aca1, L:/<bookie ip>:3181 ! R:/<bookie ip>:50488]\r\n21:08:10.133 [bookie-io-1-20] INFO  o.a.b.proto.BookieRequestHandler     - Channels disconnected: [id: 0x68f20463, L:/<bookie ip>:3181 ! R:/<bookie ip>:50480]\r\n21:09:24.324 [GarbageCollectorThread-11-1] INFO  o.a.b.bookie.GarbageCollectorThread  - Extracting entry log meta from entryLogId: 4417\r\n# manually restarted\r\n22:18:37.445 [main] INFO  org.apache.bookkeeper.server.Main    - Using configuration file /path/to/pulsar-bookie.conf\r\n22:18:37.453 [main] INFO  org.apache.bookkeeper.server.Main    - Hello, I'm your bookie, listening on port 3181. Metadata service uri is zk+hierarchical://zk100.xx.xx;zk101.xx.xx;zk102.xx.xx;zk103.xx.xx;zk104.xx.xx/ledgers. Journals are in [/journal]. Ledgers are stored in /ledgers.\r\n```\r\n\r\nAfter that, we have seen unexpected Broker shutdown with ZooKeeper disconnection:\r\n```\r\n21:33:32.903 [pulsar-zk-session-watcher-5-1] WARN  o.a.p.z.ZooKeeperSessionWatcher      - zoo keeper disconnected, waiting to reconnect, time remaining = 25 seconds\r\n21:33:34.903 [pulsar-zk-session-watcher-5-1] WARN  o.a.p.z.ZooKeeperSessionWatcher      - zoo keeper disconnected, waiting to reconnect, time remaining = 23 seconds\r\n.\r\n.\r\n.\r\n21:33:56.905 [pulsar-zk-session-watcher-5-1] WARN  o.a.p.z.ZooKeeperSessionWatcher      - zoo keeper disconnected, waiting to reconnect, time remaining = 0 seconds\r\n21:33:58.905 [pulsar-zk-session-watcher-5-1] ERROR o.a.p.z.ZooKeeperSessionWatcher      - timeout expired for reconnecting, invoking shutdown service\r\n21:33:58.906 [pulsar-zk-session-watcher-5-1] INFO  org.apache.zookeeper.ZooKeeper       - Session: 0x204f225a3fbaf49 closed\r\n21:33:58.906 [pulsar-zk-session-watcher-5-1] INFO  o.a.p.b.MessagingServiceShutdownHook - Invoking Runtime.halt(-1)\r\n```\r\n* This was happen on all Brokers (actually 14) in one cluster at the almost same time (21:32-35). \r\n* All ZooKeepers seemed to be running normally at that time\r\n* Any network error was not detected\r\n\r\nI know when ZooKeeper is truly down, the befavior of Broker(shutdown) is natural.\r\nHowever, we found no ZooKeeper down and network error etc., so we suspect some bugs or lack of tunings of Broker.\r\n\r\n**Additional context**\r\nBroker OS: CentOS Linux release 7.6.1810\r\nBroker version: 2.1.1\r\nBroker spec: Real server / 2.10GHz / 2CPU / 256GBMEM / SATA SSD 240GB x1 / 10G Base-T*2port\r\n\r\nIt looks similar to https://github.com/apache/pulsar/issues/3535 , however for now deduplication is disabled and we have seen no Full GCs.\r\n", "url": "https://github.com/apache/pulsar/issues/3566", "user": "nkurihar", "labels": ["component/broker", "type/bug"], "created": "2019-02-11 09:45:40", "closed": "2019-02-14 05:36:57", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Deduplication causes a lot of Full GCs", "body": "**Describe the bug**\r\n\r\n**2019/02/14 Added**\r\n\r\nIn our experiments, we found that enabling deduplication causes a lot of Full GCs in Brokers, which \r\n seems to cause session expiration from ZooKeepers and finally shutdown.\r\n\r\n**2019/02/07 Original report of unexpected Broker shutdown**\r\n\r\nWe have seen unexpected Broker shutdown.\r\n\r\n1. There were LedgerFencedExceptions for a lot of ledgers:\r\n```\r\n01:47:09.430 [BookKeeperClientWorker-OrderedExecutor-43-0] WARN  o.a.bookkeeper.client.PendingAddOp   - Fencing exception on write: L9104171 E28233 on xxx.xx.xx.xx:3181\r\n01:47:09.430 [BookKeeperClientWorker-OrderedExecutor-43-0] ERROR o.a.bookkeeper.client.LedgerHandle   - Closing ledger 9104171 due to LedgerFencedException: Ledger has been fenced off. Some other client must have opened it to read\r\n01:47:09.430 [BookKeeperClientWorker-OrderedExecutor-43-0] WARN  o.a.bookkeeper.client.PendingAddOp   - Fencing exception on write: L9104171 E28234 on xxx.xx.xx.xx:3181\r\n01:47:09.430 [BookKeeperClientWorker-OrderedExecutor-43-0] ERROR o.a.bookkeeper.client.LedgerHandle   - Closing ledger 9104171 due to LedgerFencedException: Ledger has been fenced off. Some other client must have opened it to read\r\n01:47:09.430 [BookKeeperClientWorker-OrderedExecutor-43-0] WARN  o.a.bookkeeper.client.PendingAddOp   - Fencing exception on write: L9104171 E28235 on xxx.xx.xx.xx:3181\r\n01:47:09.430 [BookKeeperClientWorker-OrderedExecutor-43-0] ERROR o.a.bookkeeper.client.LedgerHandle   - Closing ledger 9104171 due to LedgerFencedException: Ledger has been fenced off. Some other client must have opened it to read\r\n...\r\n```\r\n\r\n2. There were a lot of \"Failed to create producer: Producer with name geo-replicator\".\r\n```\r\n01:47:09.907 [pulsar-io-21-31] ERROR o.a.pulsar.client.impl.ProducerImpl  - [persistent://<topicname>] [pulsar.repl.<localcluster>] Failed to create producer: Producer with name 'pulsar.repl.<localcluster>' is already connected to topic\r\n```\r\n\r\n3. Finally, Broker suddenly stopped with\r\n```\r\n01:47:09.963 [pulsar-ordered-OrderedExecutor-4-0-EventThread] ERROR o.a.p.z.ZooKeeperSessionWatcher      - ZooKeeper session already expired, invoking shutdown\r\n```\r\n\r\n**Additional context**\r\nBroker OS: CentOS Linux release 7.6.1810\r\nBroker version: 2.1.1", "url": "https://github.com/apache/pulsar/issues/3535", "user": "nkurihar", "labels": ["component/broker", "type/bug"], "created": "2019-02-07 00:43:29", "closed": "2019-03-08 11:05:36", "commits": {}, "ttf": 29.00027777777778, "commitsDetails": []}, {"title": "Message.properties() not working as expected in Python.", "body": "### **Describe the bug**\r\n\r\nTL;DR:\r\n\r\n1. \r\n\r\n`<class '_pulsar.map_indexing_suite_MessageStringMap_entry'>.data()`\r\n is rising the following exception:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Applications/PyCharm.app/Contents/helpers/pydev/_pydevd_bundle/pydevd_exec2.py\", line 3, in Exec\r\n    exec(exp, global_vars, local_vars)\r\n  File \"<input>\", line 1, in <module>\r\nBoost.Python.ArgumentError: Python argument types in\r\n    None.data()\r\ndid not match C++ signature:\r\n    data(std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > {lvalue})\r\n```\r\n\r\n2. \r\n\r\nIf you want message properties as a dictionary, use the following line of code:\r\n`properties = {property.key(): msg.properties()[property.key()] for property in msg.properties()}`\r\n\r\n### **The problem details**\r\n\r\nThe method description in the documentation:\r\n\r\n> Return the properties attached to the message. Properties are application-defined key/value pairs that will be attached to the message.\r\n\r\n\r\nIn python, key/value implicitly mean that the method should return a dictionary or dictionary-like object, right ?\r\n\r\n**The Message.properties() does not.** It return an object which is under the hood generated by boost in the [cpp-python interface](https://github.com/apache/pulsar/blob/master/pulsar-client-cpp/python/src/message.cc):\r\n\r\n`    class_<Message::StringMap>(\"MessageStringMap\").def(map_indexing_suite<Message::StringMap>());`\r\n\r\nIt is pretty hard to find a good documentation on what is actually generated in python and the object is hard to inspect correctly.\r\n\r\nI will describe what is actually available and what should be expected:\r\n\r\n\r\n\r\n### **Setup**\r\nProducer:\r\n```\r\nimport pulsar\r\n\r\nclient = pulsar.Client('pulsar://localhost:6650')\r\nproducer = client.create_producer('my-topic')\r\nproducer.send(('Hello you-%d' % i).encode('utf-8'), properties=dict(key1=\"value1\", key2=\"value2\"))\r\nclient.close()\r\n```\r\nConsumer:\r\n```\r\nimport pulsar\r\n\r\nclient = pulsar.Client('pulsar://localhost:6650')\r\nconsumer = client.subscribe('my-topic', 'my-subscription')\r\nmsg = consumer.receive()\r\n```\r\n\r\n### **Lets dive in**\r\n\r\nOk, from the [python api doc](https://pulsar.apache.org/api/python/), the message properties sent with the producer should be accessible with the following code:\r\n```\r\n>>> msg.properties()\r\n<_pulsar.MessageStringMap object at 0x1057435d0>\r\n```\r\n\r\nSo the method return a unknown object from the cpp library.\r\nIt is not a dict, so lets try to cast it...\r\n\r\n```\r\n>>> dict(msg.properties())\r\nTraceback (most recent call last):\r\n  File \"/Applications/PyCharm.app/Contents/helpers/pydev/_pydevd_bundle/pydevd_exec2.py\", line 3, in Exec\r\n    exec(exp, global_vars, local_vars)\r\n  File \"<input>\", line 1, in <module>\r\nTypeError: cannot convert dictionary update sequence element #0 to a sequence\r\n```\r\n\r\nThis object does not support dict().\r\nHowever it does support list() which allows us to start accessing the content of this std::map.\r\n\r\n```\r\n>>> list(msg.properties())\r\n[(key1, value1), (key2, value2)]\r\n\r\n>>> list(msg.properties())[0]\r\n(key1, value1)\r\n```\r\n\r\nThe objects contained in std::map are std::pairs, translated by boost we have an object that looks like a tuple but it can not be used directly with index or by casting to a real list/tuple.\r\n```\r\n>>> type(list(msg.properties())[0])\r\n<class '_pulsar.map_indexing_suite_MessageStringMap_entry'>\r\n\r\n>>> list(msg.properties())[0][0]\r\nTraceback (most recent call last):\r\n  File \"/Applications/PyCharm.app/Contents/helpers/pydev/_pydevd_bundle/pydevd_exec2.py\", line 3, in Exec\r\n    exec(exp, global_vars, local_vars)\r\n  File \"<input>\", line 1, in <module>\r\nTypeError: 'map_indexing_suite_MessageStringMap_entry' object does not support indexing\r\n\r\n>>> list(list(msg.properties())[0])\r\nTraceback (most recent call last):\r\n  File \"/Applications/PyCharm.app/Contents/helpers/pydev/_pydevd_bundle/pydevd_exec2.py\", line 3, in Exec\r\n    exec(exp, global_vars, local_vars)\r\n  File \"<input>\", line 1, in <module>\r\nTypeError: 'map_indexing_suite_MessageStringMap_entry' object is not iterable\r\n```\r\n\r\nBy inspecting the object with an IDE, two methods seems available: key() and data().\r\nThe first one is working as expected but the second one is not. It is raising an error because some mapping from C++ to Python is missing.\r\n```\r\n>>> list(msg.properties())[0].key()\r\n'key1'\r\n\r\n>>> list(msg.properties())[0].data()\r\nTraceback (most recent call last):\r\n  File \"/Applications/PyCharm.app/Contents/helpers/pydev/_pydevd_bundle/pydevd_exec2.py\", line 3, in Exec\r\n    exec(exp, global_vars, local_vars)\r\n  File \"<input>\", line 1, in <module>\r\nTypeError: No Python class registered for C++ class std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >\r\n```\r\n\r\nThis is the main problem with this method. Ok it may not behave like a dictionary but it should work as expected when using the available methods.\r\n\r\nThe only way available to access the value of the properties is:\r\n\r\n`msg.properties()['key1']`\r\n\r\nThus the given methods to be able to extract keys, values and build a python dict.\r\n\r\n```\r\n>>> keys = [property.key() for property in msg.properties()]\r\n['key1', 'key2']\r\n\r\n>>> values = [msg.properties()[key] for key in keys]\r\n['value1', 'value2']\r\n\r\n>>> properties = {property.key(): msg.properties()[property.key()] for property in msg.properties()}\r\n{'key1': 'value1', 'key2': 'value2'}\r\n```\r\n\r\n###**Expected behavior / Possible fixes**\r\n\r\n- [ ] More information in the doc on which type of object is returned and how to use it.\r\n- [ ] Fix the data() method and the mapping issues.\r\n- [ ] Make Message.properties() return a python dict, created for example using the method:\r\n`properties = {property.key(): msg.properties()[property.key()] for property in msg.properties()}`\r\n\r\n\r\n### **Desktop**\r\n - OS: Mac OS\r\n\r\n### **Additional context**\r\n- I tried the python client available with pip (2.2.1).\r\n- I tried to compile and install it from the github/master branch.", "url": "https://github.com/apache/pulsar/issues/3524", "user": "lelabo-marc", "labels": ["component/client", "component/python", "type/bug"], "created": "2019-02-05 13:03:24", "closed": "2019-02-14 04:03:02", "commits": {}, "ttf": 8.000277777777777, "commitsDetails": []}, {"title": "Python intermittent test failure on test_publish_compact_and_consume", "body": "```\r\n.\r\n======================================================================\r\nFAIL: test_publish_compact_and_consume (__main__.PulsarTest)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"pulsar_test.py\", line 577, in test_publish_compact_and_consume\r\n    self.assertEqual(msg0.data(), b'hello-1')\r\nAssertionError: 'hello-0' != 'hello-1'\r\n\r\n----------------------------------------------------------------------\r\nRan 48 tests in 28.537s\r\n\r\n```", "url": "https://github.com/apache/pulsar/issues/3518", "user": "merlimat", "labels": ["component/test", "type/bug"], "created": "2019-02-04 19:56:15", "closed": "2019-02-07 19:36:26", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Tiered Storage Offloaders download link is dead in the Docs", "body": "**Describe the bug**\r\nWhen trying to download the Pulsar Tiered Storage Offloaders 2.2.1 release, the download link appears to be dead.  In the browser it's giving a Not Found Error page, wget produces a 404.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Go to http://pulsar.apache.org/docs/en/standalone.html#installing-tiered-storage-offloaders-optional\r\n2. Try downloading the release from the web page with the link: https://archive.apache.org/dist/pulsar/pulsar-2.2.1/apache-pulsar-offloaders-2.2.1-bin.tar.gz\r\n3. Or use wget\r\n`wget https://archive.apache.org/dist/pulsar/pulsar-2.2.1/apache-pulsar-offloaders-2.2.1-bin.tar.gz`\r\n\r\n**Expected behavior**\r\ntarball should begin download\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [Archlinux]\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3510", "user": "digi691", "labels": ["component/documentation", "help wanted", "type/bug"], "created": "2019-02-02 15:19:33", "closed": "2019-08-18 12:27:46", "commits": {}, "ttf": 196.00027777777777, "commitsDetails": []}, {"title": "Functions missing from REST api docs", "body": "http://pulsar.apache.org/en/admin-rest-api/\r\n\r\nThere's no mention of the functions endpoints.", "url": "https://github.com/apache/pulsar/issues/3506", "user": "ivankelly", "labels": ["component/documentation", "type/bug"], "created": "2019-02-01 10:40:36", "closed": "2019-08-18 12:31:32", "commits": {}, "ttf": 198.00027777777777, "commitsDetails": []}, {"title": "REST api documentation not scoped by version", "body": "http://pulsar.apache.org/en/admin-rest-api/\r\n\r\nI can't switch to master, or 2.1.2, etc. It's unclear which version of the software the documentation is documenting.\r\n", "url": "https://github.com/apache/pulsar/issues/3505", "user": "ivankelly", "labels": ["component/documentation", "triage/week-33", "type/bug"], "created": "2019-02-01 10:35:20", "closed": "2019-08-29 17:01:21", "commits": {}, "ttf": 209.00027777777777, "commitsDetails": []}, {"title": "Failover mode consumer has inconsistent behaviour", "body": "When using failover subscription mode with multiple Pulsar consumers, with partitioned topics, it is possible to have multiple consumers reading from the same partition.\r\n\r\n**Steps to reproduce the behavior:**\r\nSet up 3 consumers, pulling from the same topic and partition with the same subscription name, all in Failover mode, all with different consumer names, A, B, C.\r\n\r\nE.g. (I added a consumer-name parameter to the client tool to demo this)\r\npulsar-client consume persistent://public/default/topicXYZ-partition-0 --subscription-name sub1 --num-messages 0 --subscription-type Failover --rate 1 --consumer-name [A|B|C]\r\n\r\nStart consumer A first, then C, then B... let A run for a while, B and C will be suspended, then kill A, B takes over, C stays suspended...kill B, C takes over.... all good.\r\nStart consumer B first, then A... B starts consuming, but A does also!!\r\n\r\nThis defeats the point of Failover mode, which should ensure ordering of a partition is retained. It appears to have reverted back to Shared mode.\r\n\r\n**Expected behavior**\r\nI would expect to start consumer B first, then A, then C... B starts consuming, A and C will be suspended, then kill B, A takes over, C stays suspended.... kill A, C takes over.\r\n\r\nThis would ensure only one consumer was ever reading from that partition.\r\n\r\n**Additional context**\r\nWe have an extremely high throughput partitioned topic. It is being read by consumers split across 3 machines. We need to retain ordering of the topic within a partition and have failover. This is not straightforward to configure (compared to Kafka).\r\n\r\nThanks", "url": "https://github.com/apache/pulsar/issues/3504", "user": "narkedboy", "labels": ["type/bug"], "created": "2019-02-01 09:03:00", "closed": "2019-02-05 12:35:18", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "Feature: Allows multiple topics consumer to be able to listen to the earliest message in topics discovered.", "body": "**Is your feature request related to a problem? Please describe.**\r\nI am working with the python client and a MultiTopicsConsumer in order to listen to events in streams following a specific pattern. I then archive any new events based on the incoming topics.\r\nIt allows us to split the routing and the archiving process into two different micro-services.\r\n\r\n**Describe the solution you'd like**\r\nI'd like to be able to create a consumer that start listening to topics from the start. The current behavior only allows me to listen to new messages.\r\nThe auto-discovery feature can take some time to discover a new topic and therefore, I am missing a few messages each time.\r\n\r\nI'd like the MultiTopicsConsumer to be able to support seek() or to be able to pass to Client.subscribe() a parameter that create a consumer that will listen to the earliest message in the topic discovered.\r\n\r\n**Describe alternatives you've considered**\r\nI took a look to reader interface but it does not allow to multiple topics subscription.\r\nWe will be forced to channel every message to the same channel to use a normal consumer and do the routing just before the archive. It will be an important overload to our archiving process.\r\n\r\n\r\nFor the moment, I am running in the following exception that I found in the CPP library (see link):\r\n\r\n[Exception: Pulsar error: OperationNotSupported](https://github.com/apache/pulsar/blob/master/pulsar-client-cpp/lib/MultiTopicsConsumerImpl.cc)\r\n", "url": "https://github.com/apache/pulsar/issues/3494", "user": "lelabo-marc", "labels": ["type/bug", "type/feature"], "created": "2019-01-31 17:43:04", "closed": "2019-02-12 20:43:58", "commits": {"d0a3d5f328cee22501b90389977a39d3a71f99cb": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 12.000277777777777, "commitsDetails": [{"commitHash": "d0a3d5f328cee22501b90389977a39d3a71f99cb", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["ae239069bfb5dcb976087b8f80b05bc6e757313c"], "nameRev": "d0a3d5f328cee22501b90389977a39d3a71f99cb tags/v2.3.0-candidate-1~21", "commitMessage": "[cpp-client] add SubscriptionInitialPosition option in ConsumerConfiguration  #3494 (#3567)\n\n* [cpp-client] add multi topic for consumer #3494\r\n\r\nSigned-off-by: xiaolong.ran <ranxiaolong716@gmail.com>\r\n\r\n* use initial_position instead to multi-topics\r\n\r\nSigned-off-by: xiaolong.ran <ranxiaolong716@gmail.com>\r\n", "commitDateTime": "2019-02-12 12:43:57", "authoredDateTime": "2019-02-13 04:43:57", "commitGitStats": [{"filePath": "pulsar-client-cpp/include/pulsar/ConsumerConfiguration.h", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "pulsar-client-cpp/include/pulsar/InitialPosition.h", "insertions": 31, "deletions": 0, "lines": 31}, {"filePath": "pulsar-client-cpp/include/pulsar/c/consumer_configuration.h", "insertions": 19, "deletions": 0, "lines": 19}, {"filePath": "pulsar-client-cpp/lib/Commands.cc", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client-cpp/lib/Commands.h", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client-cpp/lib/ConsumerConfiguration.cc", "insertions": 8, "deletions": 0, "lines": 8}, {"filePath": "pulsar-client-cpp/lib/ConsumerConfigurationImpl.h", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-client-cpp/lib/ConsumerImpl.cc", "insertions": 14, "deletions": 3, "lines": 17}, {"filePath": "pulsar-client-cpp/lib/ConsumerImpl.h", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-client-cpp/lib/c/c_ConsumerConfiguration.cc", "insertions": 11, "deletions": 0, "lines": 11}, {"filePath": "pulsar-client-cpp/tests/ConsumerConfigurationTest.cc", "insertions": 50, "deletions": 1, "lines": 51}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": " Intermittent test failure in `BasicEndToEndTest.testDupConsumersOnSharedModeNotThrowsExcOnUnsubscribe`", "body": "\r\nIntermittent test failure in `BasicEndToEndTest.testDupConsumersOnSharedModeNotThrowsExcOnUnsubscribe`\r\n\r\nhttps://builds.apache.org/job/pulsar_precommit_cpp/5598/console\r\n\r\n```\r\n[93/145] BasicEndToEndTest.testDupConsumersOnSharedModeNotThrowsExcOnUnsubscribe (236 ms)\r\n\u001b[0;33mNote: Google Test filter = BasicEndToEndTest.testDupConsumersOnSharedModeNotThrowsExcOnUnsubscribe\r\n\u001b[m\u001b[0;32m[==========] \u001b[mRunning 1 test from 1 test case.\r\n\u001b[0;32m[----------] \u001b[mGlobal test environment set-up.\r\n\u001b[0;32m[----------] \u001b[m1 test from BasicEndToEndTest\r\n\u001b[0;32m[ RUN      ] \u001b[mBasicEndToEndTest.testDupConsumersOnSharedModeNotThrowsExcOnUnsubscribe\r\n2019-01-30 03:37:01.986 INFO  Client:88 | Subscribing on Topic :persistent://public/default/test-prevent-dup-consumers\r\n2019-01-30 03:37:01.988 INFO  ConnectionPool:63 | Created connection for pulsar://localhost:6650\r\n2019-01-30 03:37:01.989 INFO  ClientConnection:293 | [127.0.0.1:60310 -> 127.0.0.1:6650] Connected to broker\r\n2019-01-30 03:37:01.996 INFO  HandlerBase:53 | [persistent://public/default/test-prevent-dup-consumers, my-only-sub, 0] Getting connection from pool\r\n2019-01-30 03:37:02.179 INFO  ConsumerImpl:170 | [persistent://public/default/test-prevent-dup-consumers, my-only-sub, 0] Created consumer on broker [127.0.0.1:60310 -> 127.0.0.1:6650]\r\n2019-01-30 03:37:02.179 INFO  Client:88 | Subscribing on Topic :persistent://public/default/test-prevent-dup-consumers\r\n2019-01-30 03:37:02.180 INFO  ConsumerImpl:222 | [persistent://public/default/test-prevent-dup-consumers, my-only-sub, 0] Unsubscribing\r\n2019-01-30 03:37:02.192 WARN  ClientConnection:870 | [127.0.0.1:60310 -> 127.0.0.1:6650] Received error response from server: 10 -- req_id: 1\r\n2019-01-30 03:37:02.193 WARN  ConsumerImpl:257 | [persistent://public/default/test-prevent-dup-consumers, my-only-sub, 0] Failed to unsubscribe: BrokerMetadataError\r\n/pulsar/pulsar-client-cpp/tests/BasicEndToEndTest.cc:2783: Failure\r\nValue of: consumerA.unsubscribe()\r\n  Actual: BrokerMetadataError\r\nExpected: ResultOk\r\nWhich is: Ok\r\n2019-01-30 03:37:02.193 WARN  ConsumerImpl:98 | [persistent://public/default/test-prevent-dup-consumers, my-only-sub, 0] Destroyed consumer which was not properly closed\r\n2019-01-30 03:37:02.193 INFO  ConsumerImpl:813 | [persistent://public/default/test-prevent-dup-consumers, my-only-sub, 0] Closing consumer for topic persistent://public/default/test-prevent-dup-consumers\r\n\u001b[0;31m[  FAILED  ] \u001b[mBasicEndToEndTest.testDupConsumersOnSharedModeNotThrowsExcOnUnsubscribe (208 ms)\r\n\u001b[0;32m[----------] \u001b[m1 test from BasicEndToEndTest (208 ms total)\r\n\r\n\u001b[0;32m[----------] \u001b[mGlobal test environment tear-down\r\n\u001b[0;32m[==========] \u001b[m1 test from 1 test case ran. (208 ms total)\r\n\u001b[0;32m[  PASSED  ] \u001b[m0 tests.\r\n\u001b[0;31m[  FAILED  ] \u001b[m1 test, listed below:\r\n\u001b[0;31m[  FAILED  ] \u001b[mBasicEndToEndTest.testDupConsumersOnSharedModeNotThrowsExcOnUnsubscribe\r\n\r\n 1 FAILED TEST\r\n[93/145] BasicEndToEndTest.testDupConsumersOnSharedModeNotThrowsExcOnUnsubscribe returned/aborted with exit code 1 (236 ms)\r\n```\r\n\r\n@lovelle Can you take a look at this one?", "url": "https://github.com/apache/pulsar/issues/3481", "user": "merlimat", "labels": ["component/test", "type/bug"], "created": "2019-01-30 17:30:51", "closed": "2019-02-07 16:47:30", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "ack not return error when consumer closed", "body": "**Describe the bug**\r\njust like the title\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Send 10 or more msg\r\n2. Run code\r\n3. You can still receive a message when consumer closes\uff08ReceiverQueueSize = -1 invalid\uff1f\uff09\r\n    and `consumer.Ack(msg)` not return an error\r\n4. Run code again to validate\r\n\r\ncunsumer code:\r\n```\r\npackage main\r\n\r\nimport (\r\n\t\"log\"\r\n\t\"runtime\"\r\n\r\n\t\"fmt\"\r\n\t\"github.com/apache/pulsar/pulsar-client-go/pulsar\"\r\n\t\"time\"\r\n)\r\n\r\nfunc main() {\r\n\t// Creating a client\r\n\tclient, err := pulsar.NewClient(pulsar.ClientOptions{\r\n\t\tURL: \"pulsar://localhost:6650\",\r\n\t\tOperationTimeoutSeconds: 5,\r\n\t\tMessageListenerThreads:  runtime.NumCPU(),\r\n\t})\r\n\r\n\tif err != nil {\r\n\t\tlog.Fatalf(\"Could not instantiate Pulsar client: %v\", err)\r\n\t}\r\n\r\n\t// Creating a consumer\r\n\tmsgChannel := make(chan pulsar.ConsumerMessage)\r\n\r\n\tconsumerOpts := pulsar.ConsumerOptions{\r\n\t\tTopic:             \"my-topic\",\r\n\t\tSubscriptionName:  \"my-subscription-1\",\r\n\t\tType:              pulsar.Exclusive,\r\n\t\tMessageChannel:    msgChannel,\r\n\t\tReceiverQueueSize: -1,\r\n\t}\r\n\r\n\tconsumer, err := client.Subscribe(consumerOpts)\r\n\r\n\tif err != nil {\r\n\t\tlog.Fatalf(\"Could not establish subscription: %v\", err)\r\n\t}\r\n\r\n\tgo func() {\r\n\t\ttime.Sleep(time.Second * 5)\r\n\t\tconsumer.Close()\r\n\t}()\r\n\r\n\tfor cm := range msgChannel {\r\n\t\tmsg := cm.Message\r\n\t\terr := consumer.Ack(msg)\r\n\r\n\t\tfmt.Printf(\"Message value: %s; err: %v\\n\", string(msg.Payload()), err)\r\n\r\n\t\ttime.Sleep(time.Second)\r\n\t}\r\n}\r\n\r\n```\r\nResult:\r\n```\r\n# First run\r\nMessage value: Hello, Pulsar 0; err: <nil>\r\nMessage value: Hello, Pulsar 1; err: <nil>\r\nMessage value: Hello, Pulsar 2; err: <nil>\r\nMessage value: Hello, Pulsar 3; err: <nil>\r\nMessage value: Hello, Pulsar 4; err: <nil>\r\n2019/01/30 17:55:08 INFO  | ConsumerImpl:761 | [persistent://public/default/my-topic, my-subscription-1, 0] Closed consumer 0\r\nMessage value: Hello, Pulsar 5; err: <nil>\r\n\r\n# Second run\r\nMessage value: Hello, Pulsar 5; err: <nil>\r\nMessage value: Hello, Pulsar 6; err: <nil>\r\n...\r\n```\r\n**Expected behavior**\r\n`consumer.Ack(msg)` return an error but not nil when consumer closed\r\n\r\n**Desktop**\r\n- OS: ubuntu18.04\r\n- version: 2.2.0\r\n", "url": "https://github.com/apache/pulsar/issues/3480", "user": "tfhappy", "labels": ["component/go", "type/bug"], "created": "2019-01-30 10:15:53", "closed": "2019-08-18 12:22:44", "commits": {}, "ttf": 200.00027777777777, "commitsDetails": []}, {"title": "Create or update tenants with clusters that do not exist should not be allowed", "body": "**Describe the bug**\r\nCurrently, it is allowed to run `pulsar-admin tenants` with clusters that do not exist as below:\r\n```\r\n$ bin/pulsar-admin clusters list\r\npulsar-cluster-test\r\n$ bin/pulsar-admin tenants list\r\npublic\r\n$ bin/pulsar-admin tenants create test-tenant --admin-roles role1,role2 --allowed-clusters pulsar-cluster-test-11\r\n$ bin/pulsar-admin tenants list\r\ntest-tenant\r\npublic\r\n```\r\nIt is better to check that the cluster exists before operating tenants with it.\r\n", "url": "https://github.com/apache/pulsar/issues/3475", "user": "murong00", "labels": ["type/bug"], "created": "2019-01-29 15:16:26", "closed": "2019-05-17 05:57:09", "commits": {}, "ttf": 107.00027777777778, "commitsDetails": []}, {"title": "Unable to delete a namespace using pulsar-admin CLI", "body": "**Expected behavior**\r\nDelete a namespace created in tenant/namespace format after running namespaces command using pulsar-admin CLI. \r\n\r\n**Actual behavior**\r\nI can only delete namespace created in tenant/cluster/namespace format. \r\n\r\nReturns below error when deleting namespace created with tenant/namespace format.\r\n\r\n```\r\nnull\r\nReason: javax.ws.rs.ProcessingException: java.net.ProtocolException: Server redirected too many  times (20)\r\ncommand terminated with exit code 1\r\n```\r\n\r\n**Steps to reproduce** \r\n1. pulsar-admin tenants create sample --admin-roles admin\r\n2. pulsar-admin namespaces create sample/ns\r\n3. pulsar-admin namespaces set-clusters sample/ns --clusters us-central\r\n4. pulsar-admin namespaces delete sample/ns\r\n\r\n**System configuration**\r\napache-pulsar-2.2.1 on google kubernetes cluster. Pulsar cluster name us-central. ", "url": "https://github.com/apache/pulsar/issues/3463", "user": "shrikant-pa", "labels": ["component/cli", "help wanted", "type/bug"], "created": "2019-01-28 21:24:49", "closed": "2019-08-18 12:21:57", "commits": {}, "ttf": 201.00027777777777, "commitsDetails": []}, {"title": "Running commands pulsar-admin source localrun report class java.lang.NullPointerException: null", "body": "**Describe the bug**\r\nRunning commands pulsar-admin source localrun report class java.lang.NullPointerException: null\r\n\r\n```\r\n$ /data/pulsar/pulsar/bin/pulsar-admin source localrun\r\nclass java.lang.NullPointerException: null\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. The latest master branch used\r\n2. Run pulsar-admin source localrun\r\n\r\n\r\n**Additional context**\r\nI found it was for this pull request https://github.com/apache/pulsar/pull/3429.\r\nIn the following function setupCommands, admin is null, causing class CmdTopics initialization failure:\r\n```\r\nPulsarAdmin admin = adminFactory.apply(adminBuilder);\r\nfor (Map.Entry<String, Class<?>> c : commandMap.entrySet()) {\r\n    jcommander.addCommand(c.getKey(), c.getValue().getConstructor(PulsarAdmin.class).newInstance(admin));\r\n}\r\n```\r\nIn the function CmdTopics:\r\n```\r\nsuper(\"topics\", admin);\r\n// admin is null in the localrun mode\r\ntopics = admin.topics();\r\n```\r\nIf constructing admin client in the localrun mode, localrun mode is useless. I don't know if I understand it correctly. The test code is as follows https://github.com/AmateurEvents/pulsar/commit/53948980b2dedf754a60ced9cb9e383eb9c8938b.", "url": "https://github.com/apache/pulsar/issues/3447", "user": "tuteng", "labels": ["component/functions", "type/bug"], "created": "2019-01-26 14:54:40", "closed": "2019-02-04 07:31:47", "commits": {"eadf722dc6d5298a0b9cbcb48248bd79801a6d11": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 8.000277777777777, "commitsDetails": [{"commitHash": "eadf722dc6d5298a0b9cbcb48248bd79801a6d11", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["93e9720c7001133eac1eaf84b7cd6c8f170b9e06"], "nameRev": "eadf722dc6d5298a0b9cbcb48248bd79801a6d11 tags/v2.3.0-candidate-1~66", "commitMessage": "Remove the judgment of the localrun mode (#3447) (#3456)\n\n### Motivation\r\n\r\nAdmin client need to be built in both localrun mode and non-localrun mode.\r\nInitialization Admin client is required in class CmdTopics.\r\nexample:\r\n```\r\ntopics = admin.topics();\r\n```\r\nMore information: https://github.com/apache/pulsar/issues/3447\r\n\r\n### Modifications\r\n\r\nRemove the judgement of localrun mode\r\n\r\n\r\n### Verifying this change\r\nTest ok\r\n", "commitDateTime": "2019-02-04 15:02:41", "authoredDateTime": "2019-02-04 15:02:41", "commitGitStats": [{"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/PulsarAdminTool.java", "insertions": 7, "deletions": 1, "lines": 8}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarAdminTool.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.PulsarAdminTool.setupCommands(java.util.function.Function)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Can't run Pulsar locally on Mac, Bookkeeper throws \"ZK exception checking and wait ephemeral znode expired\"", "body": "Attempting to run latest Pulsar locally on Mac (latest Mojave OS 10.14.2) results in:\r\n\r\n```\r\n08:13:48.440 [BookieStateManagerService-0] ERROR org.apache.bookkeeper.discover.ZKRegistrationManager - ZK exception checking and wait ephemeral znode /stream/servers/available/172.20.10.5:4181 expired : \r\nException in thread \"main\" java.lang.RuntimeException: Failed to intiailize a registration state service\r\n\tat org.apache.bookkeeper.stream.server.service.RegistrationStateService.doStart(RegistrationStateService.java:88)\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.start(AbstractLifecycleComponent.java:78)\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.lambda$start$2(LifecycleComponentStack.java:113)\r\n\tat com.google.common.collect.ImmutableList.forEach(ImmutableList.java:408)\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.start(LifecycleComponentStack.java:113)\r\n\tat org.apache.bookkeeper.stream.server.StreamStorageLifecycleComponent.doStart(StreamStorageLifecycleComponent.java:51)\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.start(AbstractLifecycleComponent.java:78)\r\n\tat org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.runStreamStorage(LocalBookkeeperEnsemble.java:317)\r\n\tat org.apache.pulsar.zookeeper.LocalBookkeeperEnsemble.startStandalone(LocalBookkeeperEnsemble.java:386)\r\n\tat org.apache.pulsar.PulsarStandalone.start(PulsarStandalone.java:265)\r\n\tat org.apache.pulsar.PulsarStandaloneStarter.main(PulsarStandaloneStarter.java:102)\r\nCaused by: java.util.concurrent.ExecutionException: java.io.IOException: org.apache.bookkeeper.bookie.BookieException$MetadataStoreException: java.io.IOException: ZK exception checking and wait ephemeral znode /stream/servers/available/172.20.10.5:4181 expired\r\n\tat java.util.concurrent.FutureTask.report(FutureTask.java:122)\r\n\tat java.util.concurrent.FutureTask.get(FutureTask.java:192)\r\n\tat org.apache.bookkeeper.stream.server.service.RegistrationStateService.doStart(RegistrationStateService.java:84)\r\n\t... 10 more\r\nCaused by: java.io.IOException: org.apache.bookkeeper.bookie.BookieException$MetadataStoreException: java.io.IOException: ZK exception checking and wait ephemeral znode /stream/servers/available/172.20.10.5:4181 expired\r\n\tat org.apache.bookkeeper.bookie.BookieStateManager.doRegisterBookie(BookieStateManager.java:257)\r\n\tat org.apache.bookkeeper.bookie.BookieStateManager.doRegisterBookie(BookieStateManager.java:242)\r\n\tat org.apache.bookkeeper.bookie.BookieStateManager$2.call(BookieStateManager.java:205)\r\n\tat org.apache.bookkeeper.bookie.BookieStateManager$2.call(BookieStateManager.java:201)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\nCaused by: org.apache.bookkeeper.bookie.BookieException$MetadataStoreException: java.io.IOException: ZK exception checking and wait ephemeral znode /stream/servers/available/172.20.10.5:4181 expired\r\n\tat org.apache.bookkeeper.discover.ZKRegistrationManager.doRegisterBookie(ZKRegistrationManager.java:246)\r\n\tat org.apache.bookkeeper.discover.ZKRegistrationManager.registerBookie(ZKRegistrationManager.java:218)\r\n\tat org.apache.bookkeeper.bookie.BookieStateManager.doRegisterBookie(BookieStateManager.java:254)\r\n\t... 7 more\r\nCaused by: java.io.IOException: ZK exception checking and wait ephemeral znode /stream/servers/available/172.20.10.5:4181 expired\r\n\tat org.apache.bookkeeper.discover.ZKRegistrationManager.checkRegNodeAndWaitExpired(ZKRegistrationManager.java:204)\r\n\tat org.apache.bookkeeper.discover.ZKRegistrationManager.doRegisterBookie(ZKRegistrationManager.java:227)\r\n\t... 9 more\r\nCaused by: org.apache.zookeeper.KeeperException$NodeExistsException: KeeperErrorCode = NodeExists for /stream/servers/available/172.20.10.5:4181\r\n\tat org.apache.bookkeeper.discover.ZKRegistrationManager.checkRegNodeAndWaitExpired(ZKRegistrationManager.java:193)\r\n\t... 10 more\r\n```\r\n\r\nBookeeper has a current issue reported that is similar:\r\nhttps://github.com/apache/bookkeeper/issues/1019\r\n", "url": "https://github.com/apache/pulsar/issues/3435", "user": "bretlowery", "labels": ["type/bug"], "created": "2019-01-25 13:21:58", "closed": "2019-01-26 22:15:36", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Created a partitioned topic and a non-partitioned topic with same name", "body": "**Describe the bug**\r\nCreated a partitioned topic and a non-partitioned topic with same name, which should fail. but got success. reported by user @bilahepan\r\n\r\n**To Reproduce**\r\nThis seems a race condition and not able to reproduce easily.\r\n\r\nThis is meet like this steps:\r\n1. Start to produce data:\r\n```\r\nsudo -u docker ./bin/pulsar-client  produce persistent://my-tenant/my-namespace/my-topic-test -m \"hello-pulsar\u201d\r\n```\r\nAnd this will create a non-partitioned topic automatically.\r\n\r\n2. create a partitioned topic with same name:(this in my test will not success, but in the online environment, it got success)\r\n```\r\n./bin/pulsar-admin topics  create-partitioned-topic  persistent://my-tenant/my-namespace/my-topic-test -p 20\r\n```\r\n\r\n3. Could consume data produced by this command:\r\n```\r\n./bin/pulsar-client  produce persistent://my-tenant/my-namespace/my-topic-test -m \"hello-pulsar-1\u201d\r\n ```\r\nbut not able to consume data by:\r\n```\r\n./bin/pulsar-client  produce persistent://my-tenant/my-namespace/my-topic-test-partition-10 -m \"hello-pulsar\"\r\n```\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/6348208/51723987-38b3c700-2096-11e9-8ae4-4f1704d6d111.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3430", "user": "jiazhai", "labels": ["triage/week-33", "type/bug"], "created": "2019-01-25 04:45:40", "closed": "2020-01-14 17:40:51", "commits": {}, "ttf": 354.0002777777778, "commitsDetails": []}, {"title": "Possible message loss when peer-cluster names changed into replication-clusters", "body": "### Issue\r\nThere could be possible data-loss when user is using peer-cluster feature and changes replication cluster from peer1-cluster to peer2-cluster. \r\n\r\n- Sometimes, broker never receives a zk-watch for namespace policies change so, if replication cluster list has been changed then there is a possibility that broker which is owning bundle of that namespace, might not see the change and still serving the namespace bundle.\r\n- if the replication cluster has been changed from peer-cluster1 to peer-cluster2 then peer-cluster1 will continue to serve namespace and will not redirect lookup-request to peer-cluster2. in that case there will be ownership discrepancy and peer-cluster2 might not receive the traffic which will cause in data-loss.\r\n\r\n\r\n\r\n### Fix\r\n- this issue happens when one of broker doesn't receive the zk-watch.\r\n- To fix the issue, whichever broker receives the watch, that unloads the namespace if it's already owned by local cluster and broker invalidates namespace-policy cache before owning the namespace bundle to avoid any discrepancy.", "url": "https://github.com/apache/pulsar/issues/3425", "user": "rdhabalia", "labels": ["type/bug"], "created": "2019-01-24 22:46:55", "closed": "2019-01-28 18:03:09", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "Pulsar 2.2.1 compile fails", "body": "**Describe the bug**\r\nPulsar compile from source is failing with jcloud issues `org.jclouds does not exist`\r\n`Apache Pulsar :: Tiered Storage :: JCloud .......... FAILURE`\r\n\r\nPlease note that specific project build like `mvn clean compile -pl pulsar-broker` succeeds.\r\n\r\n**To Reproduce**\r\n```\r\ngit clone https://github.com/apache/pulsar.git\r\ncd pulsar\r\ngit checkout v2.2.1\r\nmvn clean compile\r\n```\r\n\r\n**Expected behavior**\r\nCompile should succeed without any failures.\r\n\r\n**Screenshots**\r\n- \r\n\r\n**Desktop (please complete the following information):**\r\n - osx-x86_64 10.14.2\r\n - Java 1.8_181\r\n - Maven: 3.5.4 \r\n", "url": "https://github.com/apache/pulsar/issues/3420", "user": "ambud", "labels": ["type/bug"], "created": "2019-01-24 17:39:35", "closed": "2019-01-24 18:36:43", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "pulsar-admin - HTTP 401 Authentication required / 500 Internal Server Error", "body": "**Describe the bug**\r\nWhen issuing some commands via the pulsar-admin CLI or REST API, you will receive a HTTP 401 Authentication required or 500 Internal Server Error.\r\n\r\n**Version**\r\n2.2.0\r\n\r\n**To Reproduce**\r\nOur cluster has TLS enabled and certs issued for use by the pulsar-admin CLI. The certs and settings are picked up by the  $PULSAR_HOME/conf/client.conf file.\r\n\r\nExample $PULSAR_HOME/conf/client.conf\r\n```sh\r\n# Configuration for pulsar-client and pulsar-admin CLI tools\r\n\r\n# URL for Pulsar REST API (for admin operations)\r\n# For TLS:\r\nwebServiceUrl=https://mypulsar.cluster.com:8443/\r\n\r\n# URL for Pulsar Binary Protocol (for produce and consume operations)\r\n# For TLS:\r\nbrokerServiceUrl=pulsar+ssl://mypulsar.cluster.com:6651/\r\n\r\n# Authentication plugin to authenticate with servers\r\n# e.g. for TLS\r\nuseTLS=true\r\nauthPlugin=org.apache.pulsar.client.impl.auth.AuthenticationTls\r\n\r\n# Parameters passed to authentication plugin.\r\n# A comma separated list of key:value pairs.\r\n# Keys depend on the configured authPlugin.\r\n# e.g. for TLS\r\nauthParams=tlsCertFile:/opt/pulsar/certificates/admin.cert.pem,tlsKeyFile:/opt/pulsar/certificates/admin.key-pk8.pem\r\n\r\n# Allow TLS connections to servers whose certificate cannot be\r\n# be verified to have been signed by a trusted certificate\r\n# authority.\r\ntlsAllowInsecureConnection=false\r\n\r\n# Whether server hostname must match the common name of the certificate\r\n# the server is using.\r\ntlsEnableHostnameVerification=false\r\n\r\n# Path for the trusted TLS certificate file.\r\n# This cert is used to verify that any cert presented by a server\r\n# is signed by a certificate authority. If this verification\r\n# fails, then the cert is untrusted and the connection is dropped.\r\ntlsTrustCertsFilePath=/opt/pulsar/certificates/ca.cert.pem\r\n```\r\n\r\nYou can create tenants, namespaces, and perform most admin functions with no problem but when it comes to partitioned topics, that seems to be where the trouble kicks in.\r\n\r\nIf you execute an admin command that deals with partitioned topics like deletes or unsubscribes, etc., for example:\r\n```sh\r\n$PULSAR_HOME/bin/pulsar-admin topics delete-partitioned-topic persistent://my-tenant/my-namespace/my-topic\r\n```\r\n\r\nYou receive:\r\n```sh\r\nFailed to perform http delete request: javax.ws.rs.InternalServerErrorException: HTTP 500 Internal Server Error\r\nHTTP 500 Internal Server Error\r\n\r\nReason: HTTP 500 Internal Server Error`\r\n```\r\n\r\nAnd the logs for the broker show:\r\n```sh\r\n`17:29:34.932 [jersey-client-async-executor-1] ERROR org.apache.pulsar.broker.admin.impl.PersistentTopicsBase - [null] Failed to delete partition persistent://my-tenant/my-namespace/my-topic-partition-18\r\norg.apache.pulsar.client.admin.PulsarAdminException$NotAuthorizedException: HTTP 401 Authentication required\r\n        at org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:170) ~[org.apache.pulsar-pulsar-client-admin-original-2.2.0.jar:2.2.0]\r\n        at org.apache.pulsar.client.admin.internal.BaseResource$3.failed(BaseResource.java:142) [org.apache.pulsar-pulsar-client-admin-original-2.2.0.jar:2.2.0]\r\n        at org.glassfish.jersey.client.JerseyInvocation$7.failed(JerseyInvocation.java:965) [org.glassfish.jersey.core-jersey-client-2.25.jar:?]\r\n        at org.glassfish.jersey.client.JerseyInvocation$7.completed(JerseyInvocation.java:952) [org.glassfish.jersey.core-jersey-client-2.25.jar:?]\r\n        at org.glassfish.jersey.client.ClientRuntime.processResponse(ClientRuntime.java:196) [org.glassfish.jersey.core-jersey-client-2.25.jar:?]\r\n        at org.glassfish.jersey.client.ClientRuntime.access$300(ClientRuntime.java:74) [org.glassfish.jersey.core-jersey-client-2.25.jar:?]\r\n        at org.glassfish.jersey.client.ClientRuntime$2$1$1.run(ClientRuntime.java:166) [org.glassfish.jersey.core-jersey-client-2.25.jar:?]\r\n        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:271) [org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:267) [org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:315) [org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:297) [org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:267) [org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n        at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:340) [org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n        at org.glassfish.jersey.client.ClientRuntime$2$1.response(ClientRuntime.java:164) [org.glassfish.jersey.core-jersey-client-2.25.jar:?]\r\n        at org.glassfish.jersey.client.internal.HttpUrlConnector$3.run(HttpUrlConnector.java:297) [org.glassfish.jersey.core-jersey-client-2.25.jar:?]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_192]\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_192]\r\n        at jersey.repackaged.com.google.common.util.concurrent.MoreExecutors$DirectExecutorService.execute(MoreExecutors.java:299) [org.glassfish.jersey.bundles.repackaged-jersey-guava-2.25.jar:?]\r\n        at java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:112) [?:1.8.0_192]\r\n        at jersey.repackaged.com.google.common.util.concurrent.AbstractListeningExecutorService.submit(AbstractListeningExecutorService.java:50) [org.glassfish.jersey.bundles.repackaged-jersey-guava-2.25.jar:?]\r\n        at jersey.repackaged.com.google.common.util.concurrent.AbstractListeningExecutorService.submit(AbstractListeningExecutorService.java:37) [org.glassfish.jersey.bundles.repackaged-jersey-guava-2.25.jar:?]\r\n        at org.glassfish.jersey.client.internal.HttpUrlConnector.apply(HttpUrlConnector.java:293) [org.glassfish.jersey.core-jersey-client-2.25.jar:?]\r\n        at org.glassfish.jersey.client.ClientRuntime$2.run(ClientRuntime.java:180) [org.glassfish.jersey.core-jersey-client-2.25.jar:?]\r\n        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:271) [org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:267) [org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:315) [org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:297) [org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:267) [org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n        at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:340) [org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n        at org.glassfish.jersey.client.ClientRuntime$3.run(ClientRuntime.java:208) [org.glassfish.jersey.core-jersey-client-2.25.jar:?]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_192]\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_192]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_192]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_192]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_192]\r\nCaused by: javax.ws.rs.NotAuthorizedException: HTTP 401 Authentication required\r\n        at org.glassfish.jersey.client.JerseyInvocation.convertToException(JerseyInvocation.java:1014) ~[org.glassfish.jersey.core-jersey-client-2.25.jar:?]\r\n        at org.glassfish.jersey.client.JerseyInvocation.access$900(JerseyInvocation.java:92) ~[org.glassfish.jersey.core-jersey-client-2.25.jar:?]\r\n        ... 32 more\r\n```\r\n\r\nIf you attempt to execute:\r\n```sh\r\n$PULSAR_HOME/bin/pulsar-admin topics partitioned-stats my-tenant/my-namespace/my-topic\r\n```\r\n\r\nyou get:\r\n```sh\r\nHTTP 401 Authentication required\r\n\r\nReason: HTTP 401 Authentication required\r\n```\r\n\r\nand the logs show:\r\n```sh\r\n17:42:58.463 [pulsar-web-28-8] WARN  org.apache.pulsar.broker.web.AuthenticationFilter - [10.126.64.36] Failed to authenticate HTTP request: Authentication required\r\n```\r\n\r\nIf I try to delete the partitions one at a time, the commands seem to succeed but the metadata still shows the partitions exist. I can also issue unsubscribes for each partition one at a time but not bulk.\r\n\r\n**Expected behavior**\r\nDeletes, unsubscribes, etc. of anything dealing with partitioned topics should work as the pulsar-admin CLI help menu instructs.\r\n\r\n**Additional context**\r\nTLS Authentication and Authorization Enabled cluster wide\r\nCerts provided to the admin CLI via the client.conf file\r\nbrokers and proxys all have working certs\r\n\r\n\r\nAny help you guys might provide would be appreciated. Thanks!", "url": "https://github.com/apache/pulsar/issues/3414", "user": "one70six", "labels": ["triage/week-33", "type/bug"], "created": "2019-01-23 22:50:47", "closed": "2019-10-29 12:11:36", "commits": {}, "ttf": 278.0002777777778, "commitsDetails": []}, {"title": "Some of the \"-help\" options in the pulsar command line tool may not perform as expected", "body": "**Describe the bug**\r\n\r\nIt may confuse novices as below when using '--help' option of Pulsar command-line tools to get help:\r\n```\r\n$ bin/pulsar --help\r\n-- Invalid command '--help' -- Use 'bin/pulsar help' to get a list of valid commands\r\n\r\n$ bin/pulsar-daemon --help\r\nError: no enough arguments provided.\r\n\r\n$ bin/pulsar-perf --help\r\nUsage: pulsar <command>\r\n\r\n$ bin/bookkeeper --help\r\nUnrecognized option: --help\r\n```", "url": "https://github.com/apache/pulsar/issues/3409", "user": "murong00", "labels": ["component/cli", "type/bug"], "created": "2019-01-23 11:58:47", "closed": "2019-02-22 17:18:06", "commits": {}, "ttf": 30.00027777777778, "commitsDetails": []}, {"title": "pulsar golang error", "body": "when client connect pulsar broker:\r\n**Describe the bug**\r\n```\r\nterminate called after throwing an instance of 'boost::exception_detail::clone_impl<boost::exception_detail::error_info_injector<boost::bad_function_call> >'\r\n  what():  call to empty boost::function\r\n```\r\n\r\n - OS: ubuntu16.04\r\n- golang: 1.11\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3408", "user": "chowyu08", "labels": ["triage/week-33", "type/bug"], "created": "2019-01-23 09:02:40", "closed": "2020-01-14 17:32:42", "commits": {}, "ttf": 356.0002777777778, "commitsDetails": []}, {"title": "OutOfDirectMemoryError", "body": "**Describe the bug**\r\nWe're using a proxy to connect to our pulsar cluster and the proxy was failing to send messages to our broker. The error on the broker is:\r\n\r\n```\r\nWARN io.netty.channel.ChannelInitializer - Failed to initialize a channel. Closing: [id: .... ]\r\nio.netty.util.internal.OutOfDirectMemoryError: failed to allocated 866 byte(s) of direct memory (used: 4Gb, max: 4Gb)\r\nat io.netty.util.internal.PlatformDependent.incrementMemoryCounter(PlatformDependent.java:640)\r\nat io.netty.util.internal.PlatformDependent.allocatedDirectNoCleaner(PlatformDependent.java:594)\r\n...\r\n```\r\n\r\n**Expected behavior**\r\nI'd expect the proxy to send data to another broker, but I also don't see why this broker would have an OOM when it should be persisting to disk for the most part?\r\n\r\n**Desktop (please complete the following information):**\r\nCentOS 7.6\r\nPulsar 2.2.1\r\n\r\n**Additional context**\r\n```-Xms4g -Xmx16g -XX:MaxDirectMemorySize=4g```\r\n", "url": "https://github.com/apache/pulsar/issues/3402", "user": "bputt", "labels": ["type/bug"], "created": "2019-01-22 17:25:36", "closed": "2019-08-18 12:18:43", "commits": {}, "ttf": 207.00027777777777, "commitsDetails": []}, {"title": "pulsar-daemon start broker without setting mandatory parameter failed without any errors", "body": "**Describe the bug**\r\nfor the **./pulsar-daemon start broker** command, the mandatory configuration like **zookeeperServers**, **configurationStoreServers** and **clusterName** are not check in the code .\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1.  remove the **zookeeperServers** or **configurationStoreServers** or **clusterName** in broker.conf\r\n2. ./pulsar-daemon start broker\r\n3. broker start failed without any errors\r\n\r\n**Expected behavior**\r\npulsar broker start failed with errors like,\" no configuration for **zookeeperServers** or **configurationStoreServers** or **clusterName**, start failed\"\r\n\r\n**Screenshots**\r\nno\r\n**Desktop (please complete the following information):**\r\npulsar version 2.2.1\r\n\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n", "url": "https://github.com/apache/pulsar/issues/3390", "user": "foreversunyao", "labels": ["type/bug"], "created": "2019-01-20 11:08:47", "closed": "2019-01-27 17:18:15", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "Websocket example not working - Throwing Unexpected server response: 500", "body": "**Describe the bug**\r\nSince there's no client available for Node.js, I tried to using WebSocket API for creating producers/consumers. When I tried the example given in the documentation, it throws me the \"Unexpected server response: 500\" error.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Run \"Pulsar standalone\" in docker container(WebSocket service is enabled by default in standalone mode)\r\n2. Check the service is working fine by checking the admin REST APIs\r\n3. Run the Websocket (node.js) examples given [here](https://pulsar.apache.org/docs/en/client-libraries-websocket/#nodejs-producer).\r\n4. You will be able to see the error.\r\n\r\n**Expected behavior**\r\nShould be able produce/consume messages using Websocket clients.\r\n\r\n**Screenshots**\r\n![pulsar-websocket-error](https://user-images.githubusercontent.com/29608822/51245380-800ec900-19ad-11e9-8a58-3fbc7dd61fac.png)\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Windows 10(but running pulsar in docker container)\r\n\r\n**Additional context**\r\nNo", "url": "https://github.com/apache/pulsar/issues/3375", "user": "pruthvivrp", "labels": ["help wanted", "type/bug"], "created": "2019-01-16 11:11:45", "closed": "2019-01-21 05:59:17", "commits": {"7460e5ad235981f1c633a8ed780991c15e7eb81f": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "7460e5ad235981f1c633a8ed780991c15e7eb81f", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["da232c27d47a22f088bf0ffd04615c214fa34b40"], "nameRev": "7460e5ad235981f1c633a8ed780991c15e7eb81f tags/v2.3.0-candidate-1~131", "commitMessage": "Issue #3375 Websocket example not working (#3393)\n\n* Fix #3375 Websocket example not working\r\n\r\n* Fix #3375 Websocket example not working\r\n\r\n* Fix Websocket example not working\r\n", "commitDateTime": "2019-01-21 07:09:59", "authoredDateTime": "2019-01-21 23:09:59", "commitGitStats": [{"filePath": "site/docs/latest/clients/WebSocket.md", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "site/ja/clients/WebSocket.md", "insertions": 18, "deletions": 5, "lines": 23}, {"filePath": "site2/docs/client-libraries-websocket.md", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/client-libraries-websocket.md", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "site2/website/versioned_docs/version-2.2.0/client-libraries-websocket.md", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "site2/website/versioned_docs/version-2.2.1/client-libraries-websocket.md", "insertions": 3, "deletions": 3, "lines": 6}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "pulsar/master branch run SampleProducer class occur RemotelyClosedException: Remotely closed", "body": "**Describe the bug**\r\nSampleProducer class info:\r\n```java\r\nException in thread \"main\" org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.ExecutionException: org.asynchttpclient.exception.RemotelyClosedException: Remotely closed\r\n\tat org.apache.pulsar.client.impl.HttpClient.lambda$get$0(HttpClient.java:179)\r\n\tat org.asynchttpclient.netty.NettyResponseFuture.lambda$addListener$0(NettyResponseFuture.java:298)\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:760)\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736)\r\n\tat java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:442)\r\n\tat com.google.common.util.concurrent.MoreExecutors$DirectExecutor.execute(MoreExecutors.java:399)\r\n\tat java.util.concurrent.CompletableFuture$UniCompletion.claim(CompletableFuture.java:529)\r\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:751)\r\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:736)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)\r\n\tat org.asynchttpclient.netty.NettyResponseFuture.abort(NettyResponseFuture.java:277)\r\n\tat org.asynchttpclient.netty.request.NettyRequestSender.abort(NettyRequestSender.java:462)\r\n\tat org.asynchttpclient.netty.request.NettyRequestSender.handleUnexpectedClosedChannel(NettyRequestSender.java:473)\r\n\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.channelInactive(AsyncHttpClientHandler.java:143)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:245)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:231)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:224)\r\n\tat io.netty.handler.stream.ChunkedWriteHandler.channelInactive(ChunkedWriteHandler.java:143)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:245)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:231)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:224)\r\n\tat io.netty.channel.ChannelInboundHandlerAdapter.channelInactive(ChannelInboundHandlerAdapter.java:75)\r\n\tat io.netty.handler.codec.http.HttpContentDecoder.channelInactive(HttpContentDecoder.java:205)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:245)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:231)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:224)\r\n\tat io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelInactive(CombinedChannelDuplexHandler.java:420)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelInputClosed(ByteToMessageDecoder.java:377)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelInactive(ByteToMessageDecoder.java:342)\r\n\tat io.netty.handler.codec.http.HttpClientCodec$Decoder.channelInactive(HttpClientCodec.java:282)\r\n\tat io.netty.channel.CombinedChannelDuplexHandler.channelInactive(CombinedChannelDuplexHandler.java:223)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:245)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:231)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelInactive(AbstractChannelHandlerContext.java:224)\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelInactive(DefaultChannelPipeline.java:1409)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:245)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelInactive(AbstractChannelHandlerContext.java:231)\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelInactive(DefaultChannelPipeline.java:927)\r\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe$8.run(AbstractChannel.java:822)\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404)\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:463)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.util.concurrent.ExecutionException: org.asynchttpclient.exception.RemotelyClosedException: Remotely closed\r\n\tat java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)\r\n\tat org.asynchttpclient.netty.NettyResponseFuture.get(NettyResponseFuture.java:205)\r\n\tat org.apache.pulsar.client.impl.HttpClient.lambda$get$0(HttpClient.java:162)\r\n\t... 45 more\r\nCaused by: org.asynchttpclient.exception.RemotelyClosedException: Remotely closed\r\n\tat org.asynchttpclient.exception.RemotelyClosedException.INSTANCE(Unknown Source)\r\n```\r\n\r\nbin/pulsar standalone info:\r\n```java\r\n21:07:05.089 [ProcessThread(sid:0 cport:2181):] INFO  org.apache.zookeeper.server.PrepRequestProcessor - Got user-level KeeperException when processing sessionid:0x10002102a900004 type:delete cxid:0x1b zxid:0xb8 txntype:-1 reqpath:n/a Error Path:/stream/controller/_c_7f3b4036-8006-40e3-8b98-d8ee85d9c99a-lock-0000000000 Error:KeeperErrorCode = NoNode for /stream/controller/_c_7f3b4036-8006-40e3-8b98-d8ee85d9c99a-lock-0000000000\r\n21:07:05.089 [Curator-LeaderSelector-0] ERROR org.apache.curator.framework.recipes.leader.LeaderSelector - The leader threw an exception\r\njava.lang.InterruptedException: null\r\n        at java.lang.Object.wait(Native Method) ~[?:1.8.0_171]\r\n        at java.lang.Object.wait(Object.java:502) ~[?:1.8.0_171]\r\n        at org.apache.zookeeper.ClientCnxn.submitRequest(ClientCnxn.java:1411) ~[zookeeper-3.4.13.jar:3.4.13-2d71af4dbe22557fda74f9a9b4309b15a7487f03]\r\n        at org.apache.zookeeper.ZooKeeper.delete(ZooKeeper.java:880) ~[zookeeper-3.4.13.jar:3.4.13-2d71af4dbe22557fda74f9a9b4309b15a7487f03]\r\n        at org.apache.curator.framework.imps.DeleteBuilderImpl$5.call(DeleteBuilderImpl.java:274) ~[curator-framework-4.0.1.jar:4.0.1]\r\n        at org.apache.curator.framework.imps.DeleteBuilderImpl$5.call(DeleteBuilderImpl.java:268) ~[curator-framework-4.0.1.jar:4.0.1]\r\n        at org.apache.curator.connection.StandardConnectionHandlingPolicy.callWithRetry(StandardConnectionHandlingPolicy.java:64) ~[curator-client-4.0.1.jar:?]\r\n        at org.apache.curator.RetryLoop.callWithRetry(RetryLoop.java:100) ~[curator-client-4.0.1.jar:?]\r\n        at org.apache.curator.framework.imps.DeleteBuilderImpl.pathInForeground(DeleteBuilderImpl.java:265) ~[curator-framework-4.0.1.jar:4.0.1]\r\n        at org.apache.curator.framework.imps.DeleteBuilderImpl.forPath(DeleteBuilderImpl.java:249) ~[curator-framework-4.0.1.jar:4.0.1]\r\n        at org.apache.curator.framework.imps.DeleteBuilderImpl.forPath(DeleteBuilderImpl.java:34) ~[curator-framework-4.0.1.jar:4.0.1]\r\n        at org.apache.curator.framework.recipes.locks.LockInternals.deleteOurPath(LockInternals.java:347) ~[curator-recipes-4.0.1.jar:4.0.1]\r\n        at org.apache.curator.framework.recipes.locks.LockInternals.releaseLock(LockInternals.java:124) ~[curator-recipes-4.0.1.jar:4.0.1]\r\n        at org.apache.curator.framework.recipes.locks.InterProcessMutex.release(InterProcessMutex.java:154) ~[curator-recipes-4.0.1.jar:4.0.1]\r\n        at org.apache.curator.framework.recipes.leader.LeaderSelector.doWork(LeaderSelector.java:449) [curator-recipes-4.0.1.jar:4.0.1]\r\n        at org.apache.curator.framework.recipes.leader.LeaderSelector.doWorkLoop(LeaderSelector.java:466) [curator-recipes-4.0.1.jar:4.0.1]\r\n        at org.apache.curator.framework.recipes.leader.LeaderSelector.access$100(LeaderSelector.java:65) [curator-recipes-4.0.1.jar:4.0.1]\r\n        at org.apache.curator.framework.recipes.leader.LeaderSelector$2.call(LeaderSelector.java:246) [curator-recipes-4.0.1.jar:4.0.1]\r\n        at org.apache.curator.framework.recipes.leader.LeaderSelector$2.call(LeaderSelector.java:240) [curator-recipes-4.0.1.jar:4.0.1]\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_171]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_171]\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_171]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_171]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_171]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_171]\r\n```\r\n\r\n**To Reproduce**\r\n```shell\r\nbin/pulsar standalone\r\n```\r\nrun org.apache.pulsar.client.tutorial.SampleProducer, update code info\r\n```java\r\nProducer<byte[]> producer = client.newProducer().topic(\"my-topic\").create();\r\n```\r\nbut shell run ok.\r\n```shell\r\nbin/pulsar-client produce -m \"hello world test again\" -n 10 my-topic\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/3373", "user": "ambition119", "labels": ["component/examples", "type/bug"], "created": "2019-01-15 13:09:09", "closed": "2019-01-17 07:36:48", "commits": {"757c3f925ce5c216a733d3a7150e844a320c1e2b": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "757c3f925ce5c216a733d3a7150e844a320c1e2b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["9e5d9dee7db83ba79b206f4c5241cad9838f755d"], "nameRev": "757c3f925ce5c216a733d3a7150e844a320c1e2b tags/v2.3.0-candidate-1~141", "commitMessage": "Issue #3373: RemotelyClosedException when running SampleProducer\n\n*Motivation*\r\n\r\nFixes #3373 \r\n\r\nThe service url in SampleProducer is wrong.\r\n\r\n*Modification*\r\n\r\nFix the service url in SampleProducer and SampleConsumer.\r\n", "commitDateTime": "2019-01-17 15:36:47", "authoredDateTime": "2019-01-17 15:36:47", "commitGitStats": [{"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/tutorial/SampleConsumer.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/tutorial/SampleProducer.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SampleConsumer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.tutorial.SampleConsumer.main(java.lang.String[])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SampleProducer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.tutorial.SampleProducer.main(java.lang.String[])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["757c3f925ce5c216a733d3a7150e844a320c1e2b"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 2, "spoonMethodsChanged": 2}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": ["org.apache.pulsar.client.tutorial.SampleConsumer.main(java.lang.String[])", "org.apache.pulsar.client.tutorial.SampleProducer.main(java.lang.String[])"]}, {"title": "CPP Client RPM sha512 links are broken", "body": "Hey folks,\r\n\r\nsha512 signature RPM links for cpp client (the ones here: https://pulsar.apache.org/docs/en/client-libraries-cpp/) are broken on some mirrors, e.g. a mirror link for devel RPM is leading to 404: http://ftp.tudelft.nl/apache/pulsar/pulsar-2.2.1/RPMS/apache-pulsar-client-devel-2.2.1-1.x86_64.rpm.sha512\r\n\r\nAs mentioned by @merlimat these should only be fetched from Apache servers to guarantee authenticity, so website links need to be fixed.", "url": "https://github.com/apache/pulsar/issues/3370", "user": "alexandrfox", "labels": ["type/bug"], "created": "2019-01-14 16:46:43", "closed": "2019-01-17 00:40:01", "commits": {"934d80d4e24c54eaa6bac59bd99bfc8d352db661": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "934d80d4e24c54eaa6bac59bd99bfc8d352db661", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["a704afd1946c5648f06b12031320359d5aef623d"], "nameRev": "934d80d4e24c54eaa6bac59bd99bfc8d352db661 tags/v2.3.0-candidate-1~144", "commitMessage": "Fixed links to RPM/Deb package signature files (#3371)\n\nMotivation\r\nFixes #3370 . The links should point to ASF dist server as the source of truth for package signatures.", "commitDateTime": "2019-01-17 08:40:01", "authoredDateTime": "2019-01-16 16:40:01", "commitGitStats": [{"filePath": "site2/docs/client-libraries-cpp.md", "insertions": 5, "deletions": 5, "lines": 10}, {"filePath": "site2/website/scripts/replace.js", "insertions": 29, "deletions": 0, "lines": 29}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "IndexOutOfBoundsException in kafka ConsumerExample", "body": "Steps:\r\n1. unzip tar ball: tar -xf apache-pulsar-2.2.1-bin.tar.gz , cd the directory\r\n2. ./pulsar standalone\r\n3. change the topic to  following in \r\n    org.apache.pulsar.client.kafka.compat.examples.ConsumerExample.java\r\n        String topic = \"persistent://public/default/test\";\r\n 4. Run  ConsumerExample\r\n\r\nServer will have the following error\r\n```\r\n11:18:36.355 [zk-storage-container-manager] INFO  org.apache.bookkeeper.stream.storage.impl.sc.ZkStorageContainerManager - Servers left : []\r\n11:18:36.355 [zk-storage-container-manager] INFO  org.apache.bookkeeper.stream.storage.impl.sc.ZkStorageContainerManager - Servers joined : []\r\n11:18:36.355 [zk-storage-container-manager] INFO  org.apache.bookkeeper.stream.storage.impl.sc.ZkStorageContainerManager - Process container changes:\r\n\tIdeal = [0, 1]\r\n\tLive = [0, 1]\r\n\tPending = []\r\n\tToStart = []\r\n\tToStop = []\r\n11:18:49.553 [pulsar-io-49-4] INFO  org.apache.pulsar.broker.service.ServerCnx - New connection from /xx.xx.xx.xx:64591\r\n11:18:49.582 [pulsar-io-49-4] WARN  org.apache.pulsar.broker.service.ServerCnx - [/xx.xx.xx.xx:64591] Got exception IndexOutOfBoundsException : writerIndex: 1179652 (expected: readerIndex(4) <= writerIndex <= capacity(20))\r\njava.lang.IndexOutOfBoundsException: writerIndex: 1179652 (expected: readerIndex(4) <= writerIndex <= capacity(20))\r\n\tat io.netty.buffer.AbstractByteBuf.writerIndex(AbstractByteBuf.java:118) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:83) ~[org.apache.pulsar-pulsar-common-2.2.1.jar:2.2.1]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:284) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1414) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:945) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:806) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:413) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:313) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_191]\r\n11:18:49.586 [pulsar-io-49-4] INFO  org.apache.pulsar.broker.service.ServerCnx - Closed connection from /xx.xx.xx.xx:64591\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/3369", "user": "sautran", "labels": ["help wanted", "type/bug"], "created": "2019-01-14 16:28:55", "closed": "2019-03-08 16:40:56", "commits": {}, "ttf": 53.000277777777775, "commitsDetails": []}, {"title": "Dashboard docker shows no data", "body": "**Describe the bug**\r\nSome user reported that Dashboard docker  shows no data by following instruction of [dashboard](http://pulsar.apache.org/docs/en/administration-dashboard.html#docsNav)\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. following instruction of [dashboard](http://pulsar.apache.org/docs/en/administration-dashboard.html#docsNav) to start docker.\r\n\r\n**Expected behavior**\r\ndashboard could show data\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/6348208/51119765-a4a05f00-184e-11e9-87da-a501ea007ea9.png)\r\n![image](https://user-images.githubusercontent.com/6348208/51119774-ab2ed680-184e-11e9-9d67-ab51323265ae.png)\r\n![image](https://user-images.githubusercontent.com/6348208/51119777-ae29c700-184e-11e9-9c8e-a3d04a61bd6f.png)\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: [e.g. iOS]\r\n", "url": "https://github.com/apache/pulsar/issues/3367", "user": "jiazhai", "labels": ["type/bug"], "created": "2019-01-14 14:51:02", "closed": "2019-08-18 12:09:53", "commits": {}, "ttf": 215.00027777777777, "commitsDetails": []}, {"title": "Failed to build Golang client.", "body": "**Describe the bug**\r\nFailed to build Golang client, returning an error.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Use Go v1.11.4\r\n2. Use `go mod init`\r\n3. `go build`\r\n\r\n**Expected behavior**\r\nBuilding my program should work without error\r\n\r\n**Screenshots**\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: macOS Mojave 10.14.3\r\n\r\n**Additional context**\r\nThe output of the build:\r\n```\r\nIn file included from ../../../../../go/pkg/mod/github.com/apache/incubator-pulsar@v2.2.1+incompatible/pulsar-client-go/pulsar/c_client.go:24:\r\n./c_go_pulsar.h:22:10: fatal error: 'pulsar/c/client.h' file not found\r\n#include <pulsar/c/client.h>\r\n         ^~~~~~~~~~~~~~~~~~~\r\n1 error generated.\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/3359", "user": "JesusIslam", "labels": ["type/bug"], "created": "2019-01-11 07:56:28", "closed": "2019-01-11 08:01:44", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Documentation error for title of page cookbooks-partitioned", "body": "**Describe the bug**\r\nDocumentation error for tile of page: http://pulsar.apache.org/docs/en/cookbooks-partitioned/\r\n\r\n**To Reproduce**\r\nopen link: \r\nhttp://pulsar.apache.org/docs/en/cookbooks-partitioned/\r\n\r\n\r\n**Expected behavior**\r\ntile and content match.\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/6348208/50961653-3b91b200-1503-11e9-86db-206706ce809d.png)\r\n", "url": "https://github.com/apache/pulsar/issues/3349", "user": "jiazhai", "labels": ["component/documentation", "help wanted", "type/bug"], "created": "2019-01-10 10:15:05", "closed": "2019-01-17 01:15:50", "commits": {"aa2036309c4804c08976675ecdf7f2abcf0ddd0e": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "aa2036309c4804c08976675ecdf7f2abcf0ddd0e", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["aa3fd10c87f6b2cc0a3d57dd67b4e205bb49a0d0"], "nameRev": "aa2036309c4804c08976675ecdf7f2abcf0ddd0e tags/v2.3.0-candidate-1~160", "commitMessage": "Fix title and content mismatch issue in cookbooks-partitioned.md (#3349) (#3353)\n\n* Fix title and content mismatch issue in cookbooks-partitioned.md (#3349)\r\n\r\nSigned-off-by: Vincent Xie <vinceshieh@gmail.com>\r\n\r\n* Update site2/docs/cookbooks-partitioned.md\r\n\r\nCo-Authored-By: VinceShieh <vinceshieh@gmail.com>\r\n", "commitDateTime": "2019-01-11 10:28:22", "authoredDateTime": "2019-01-12 02:28:22", "commitGitStats": [{"filePath": "site2/docs/cookbooks-partitioned.md", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Cannot use topics regex pattern with using Go package (v2.2.1)", "body": "I'm trying to subscribe to multiple topics specified by regex pattern using following code:\r\n\r\n```go\r\npackage main\r\n\r\nimport (\r\n  \"context\"\r\n  \"fmt\"\r\n\r\n  \"github.com/apache/incubator-pulsar/pulsar-client-go/pulsar\"\r\n)\r\n\r\nfunc main() {\r\n  client, err := pulsar.NewClient(pulsar.ClientOptions{\r\n    URL: \"http://127.0.0.1:8080\",\r\n  })\r\n  if err != nil {\r\n    panic(err)\r\n  }\r\n  defer client.Close()\r\n\r\n  consumer, err := client.Subscribe(pulsar.ConsumerOptions{\r\n    TopicsPattern:    \"persistent://foo/bar/test-\\\\d\\\\d\",\r\n    SubscriptionName: \"test\",\r\n    Type:             pulsar.Shared,\r\n  })\r\n  if err != nil {\r\n    panic(err)\r\n  }\r\n  defer consumer.Close()\r\n\r\n  for {\r\n    cm, err := consumer.Receive(context.Background())\r\n    if err != nil {\r\n      panic(err)\r\n    }\r\n\r\n    fmt.Println(cm)\r\n    consumer.Ack(cm)\r\n  }\r\n}\r\n```\r\n\r\nHowever the program immediately fails with:\r\n\r\n```\r\nINFO  | HTTPLookupService:222 | Curl Lookup Request sent for http://127.0.0.1:8080/admin/v2/namespaces/foo/bar/topics\r\nINFO  | HTTPLookupService:236 | Response received for url http://127.0.0.1:8080/admin/v2/namespaces/foo/bar/topics code 200\r\nterminate called after throwing an instance of 'Json::LogicError'\r\n  what():  in Json::Value::resolveReference(key, end): requires objectValue\r\nsignal: aborted (core dumped)\r\n```\r\n\r\nIt seems that it successfully retrieves the list of topics for tenant/namespace but fails to parse the response. When curling the endpoint I get:\r\n\r\n```\r\n$ curl -L 'http://127.0.0.1:8080/admin/v2/namespaces/foo/bar/topics'\r\n[\"persistent://foo/bar/test-aa\",\"persistent://foo/bar/test-ab\"]\r\n```\r\n\r\nThis is not what the undelying C++ library expects as seen [here](https://github.com/apache/pulsar/blob/v2.2.1/pulsar-client-cpp/lib/HTTPLookupService.cc#L319). It seems that it looks for a document with key `topics` in it but all it gets is JSON array.", "url": "https://github.com/apache/pulsar/issues/3332", "user": "stepanbujnak", "labels": ["component/client", "type/bug"], "created": "2019-01-08 15:22:27", "closed": "2019-01-24 16:38:00", "commits": {"0ec897f7348bc5c7262b2dcce6e6b5f9a5343b0f": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 16.00027777777778, "commitsDetails": [{"commitHash": "0ec897f7348bc5c7262b2dcce6e6b5f9a5343b0f", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["358d4e75d73314a380202ab0302ede84567215ab"], "nameRev": "0ec897f7348bc5c7262b2dcce6e6b5f9a5343b0f tags/v2.3.0-candidate-1~126", "commitMessage": "Issue #3332: fix httplookup issue for get ns/topics in cpp (#3407)\n\n* fix httplookup issue for get ns/topics\r\n\r\n* change following comments\r\n", "commitDateTime": "2019-01-24 08:38:00", "authoredDateTime": "2019-01-25 00:38:00", "commitGitStats": [{"filePath": "pulsar-client-cpp/lib/HTTPLookupService.cc", "insertions": 6, "deletions": 3, "lines": 9}, {"filePath": "pulsar-client-cpp/tests/BasicEndToEndTest.cc", "insertions": 95, "deletions": 0, "lines": 95}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "unable to set unacked_messages_timeout_ms  in python client", "body": "**Describe the bug**\r\nWhen the value is set for `unacked_messages_timeout_ms` in python consumer client then we get \r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/yuvaraj.loganathan/PycharmProjects/pulsar/MyConsumer.py\", line 9, in <module>\r\n    consumer_name=\"Lappie\", consumer_type=pulsar.ConsumerType.Failover,unacked_messages_timeout_ms=5000)\r\n  File \"/Users/yuvaraj.loganathan/PycharmProjects/pulsar/venv/lib/python3.7/site-packages/pulsar/__init__.py\", line 505, in subscribe\r\n    conf.unacked_messages_timeout_ms(unacked_messages_timeout_ms)\r\nRuntimeError: unidentifiable C++ exception\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n```import re\r\n\r\nimport pulsar\r\n\r\nclient = pulsar.Client('pulsar://10.10.58.5:6650/')\r\ntopic = re.compile('persistent://public/support/my-topic.*')\r\nconsumer = client.subscribe(topic=topic, subscription_name='my-subscription1234',\r\n                            consumer_name=\"Lappie\", consumer_type=pulsar.ConsumerType.Failover,\r\n                            unacked_messages_timeout_ms=5000)\r\n```\r\n\r\n**Expected behavior**\r\nThe message should be redelivered after the unacked_messages_timeout_ms. \r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: MAC OS High siera.\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3320", "user": "skyrocknroll", "labels": ["type/bug"], "created": "2019-01-07 13:59:41", "closed": "2019-01-09 12:19:11", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Broken KEYS link on https://pulsar.apache.org/download/", "body": "The KEYS link still points to incubator", "url": "https://github.com/apache/pulsar/issues/3319", "user": "sebbASF", "labels": ["component/website", "type/bug"], "created": "2019-01-07 12:05:46", "closed": "2019-01-25 20:04:50", "commits": {}, "ttf": 18.00027777777778, "commitsDetails": []}, {"title": "Unable to find python client in pip.", "body": "**Describe the bug**\r\nNo matching distribution for pulsar-client 2.2.1\r\nOS : macos High Siera (10.13.6)\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. pip install pulsar-client==2.2.1\r\n\r\n\r\n**Error**\r\n\r\nLooking in indexes: https://pypi.org/simple\r\nCollecting pulsar-client==2.2.1\r\n  Could not find a version that satisfies the requirement pulsar-client==2.2.1 (from versions: 1.19.0, 1.20.0, 1.21.0, 1.22.0, 2.0.1)\r\nNo matching distribution found for pulsar-client==2.2.1\r\nYou are using pip version 10.0.1, however version 18.1 is available.\r\nYou should consider upgrading via the 'pip install --upgrade pip' command.\r\n\r\n**Expected behavior**\r\nPackage getting installed successfully\r\n\r\n**Additional context**\r\nIt would be great if we do pushing the client to pypi automated as part of the release process \r\n", "url": "https://github.com/apache/pulsar/issues/3317", "user": "skyrocknroll", "labels": ["type/bug"], "created": "2019-01-07 10:18:21", "closed": "2019-01-07 12:39:03", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "\"--global-zookeeper\" already deprecated and hidden but still referenced in documentation", "body": "**Describe the bug**\r\n\r\n`--global-zookeeper` has been deprecated and hidden since 2.0 release. However it is still\r\nreferenced in pulsar's documentation.\r\n\r\n**Screenshots**\r\n\r\n<img width=\"825\" alt=\"screen shot 2019-01-04 at 9 48 41 pm\" src=\"https://user-images.githubusercontent.com/1217863/50720883-a60da280-106a-11e9-9bfb-6f5e8fa53ba4.png\">\r\n\r\n**Additional context**\r\n\r\nWe should clean up the references of \"--global-zookeeper\" across pulsar's codebase and website.\r\n", "url": "https://github.com/apache/pulsar/issues/3305", "user": "sijie", "labels": ["component/documentation", "help wanted", "type/bug"], "created": "2019-01-05 05:51:17", "closed": "2019-08-18 12:06:10", "commits": {"547883e1c01aa4c7bb375d457f5a582379f4bd75": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 225.00027777777777, "commitsDetails": [{"commitHash": "547883e1c01aa4c7bb375d457f5a582379f4bd75", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["c8b274a223b7bfdcbefd21748c81affa8b178eaa"], "nameRev": "547883e1c01aa4c7bb375d457f5a582379f4bd75 tags/v2.3.0-candidate-1~133", "commitMessage": "Remove global-zookeeper in documentation (#3307)\n\n### Motivation\r\n\r\nReplace all ```global zookeeper``` with  ```configuration store``` in all documents.\r\n\r\nRelates to #3338\r\nCloses #3305 \r\n", "commitDateTime": "2019-01-20 11:12:47", "authoredDateTime": "2019-01-20 11:12:47", "commitGitStats": [{"filePath": "site/_data/config/broker.yaml", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site/_data/config/discovery.yaml", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site/_data/config/standalone.yaml", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site/_data/config/websocket.yaml", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site/_data/popovers-ja.yaml", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "site/_includes/explanations/deploying-zk.md", "insertions": 6, "deletions": 6, "lines": 12}, {"filePath": "site/_includes/explanations/ja/cluster-admin.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site/_includes/explanations/ja/deploying-zk.md", "insertions": 10, "deletions": 10, "lines": 20}, {"filePath": "site/_includes/explanations/ja/service-discovery-setup.md", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "site/docs/latest/admin-api/clusters.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site/docs/latest/admin/Proxy.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site/docs/latest/admin/ZooKeeperBookKeeper.md", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "site/docs/latest/clients/WebSocket.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site/docs/latest/deployment/Kubernetes.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site/docs/latest/deployment/Monitoring.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site/docs/latest/deployment/instance.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site/docs/latest/getting-started/LocalCluster.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site/ja/admin/ZooKeeperBookKeeper.md", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "site/ja/clients/WebSocket.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site/ja/deployment/InstanceSetup.md", "insertions": 7, "deletions": 7, "lines": 14}, {"filePath": "site/ja/deployment/Kubernetes.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site/ja/getting-started/ConceptsAndArchitecture.md", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "site/ja/getting-started/LocalCluster.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site/ja/reference/Configuration.md", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "site2/docs/admin-api-clusters.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/docs/administration-zk-bk.md", "insertions": 9, "deletions": 9, "lines": 18}, {"filePath": "site2/docs/client-libraries-websocket.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/docs/deploy-bare-metal-multi-cluster.md", "insertions": 7, "deletions": 7, "lines": 14}, {"filePath": "site2/docs/deploy-kubernetes.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/docs/deploy-monitoring.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/docs/getting-started-standalone.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/docs/reference-configuration.md", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "site2/docs/reference-terminology.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/admin-api-clusters.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/administration-proxy.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/administration-zk-bk.md", "insertions": 9, "deletions": 9, "lines": 18}, {"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/client-libraries-websocket.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/deploy-bare-metal-multi-cluster.md", "insertions": 7, "deletions": 7, "lines": 14}, {"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/deploy-kubernetes.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/deploy-monitoring.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/getting-started-standalone.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/reference-configuration.md", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "site2/website/versioned_docs/version-2.1.1-incubating/administration-proxy.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.1.1-incubating/getting-started-standalone.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.1.1-incubating/reference-configuration.md", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "site2/website/versioned_docs/version-2.2.0/client-libraries-websocket.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/website/versioned_docs/version-2.2.0/deploy-bare-metal-multi-cluster.md", "insertions": 7, "deletions": 7, "lines": 14}, {"filePath": "site2/website/versioned_docs/version-2.2.0/getting-started-standalone.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.2.0/reference-configuration.md", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "site2/website/versioned_docs/version-2.2.1/client-libraries-websocket.md", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "site2/website/versioned_docs/version-2.2.1/getting-started-standalone.md", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/website/versioned_docs/version-2.2.1/reference-configuration.md", "insertions": 4, "deletions": 4, "lines": 8}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[IO] [Kafka] a Kafka source submitted with invalid configuration stucks without consuming from Kafka topics", "body": "#### Expected behavior\r\n\r\nCreate a Kafka source connector with invalid configuration should fail \r\n\r\n#### Actual behavior\r\n\r\nCreate a Kafka source connector with invalid configuration succeed.\r\n\r\n`getstatus` show the connector is running.\r\nthe function log doesn't show any exceptions.\r\n\r\n#### Steps to reproduce\r\n\r\nYou can use the same steps in #3293  to repro this issue. Change `localrun` to `create`.\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.2.0", "url": "https://github.com/apache/pulsar/issues/3294", "user": "sijie", "labels": ["component/io", "help wanted", "type/bug"], "created": "2019-01-03 09:15:43", "closed": "2019-08-18 12:05:34", "commits": {}, "ttf": 227.00027777777777, "commitsDetails": []}, {"title": "[IO] [Kafka] Heartbeat must be set lower than the session timeout", "body": "#### Expected behavior\r\n\r\nKafka source connector should be able to run when changing session timeout ms to be less than 10s\r\n\r\n#### Actual behavior\r\n\r\nlocalrun throws exception.\r\n\r\n```\r\nException in thread \"Kafka Source Thread\" org.apache.kafka.common.KafkaException: Failed to construct kafka consumer\r\n\tat org.apache.kafka.clients.consumer.KafkaConsumer.<init>(KafkaConsumer.java:717)\r\n\tat org.apache.kafka.clients.consumer.KafkaConsumer.<init>(KafkaConsumer.java:597)\r\n\tat org.apache.kafka.clients.consumer.KafkaConsumer.<init>(KafkaConsumer.java:579)\r\n\tat org.apache.pulsar.io.kafka.KafkaAbstractSource.lambda$start$0(KafkaAbstractSource.java:103)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.lang.IllegalArgumentException: Heartbeat must be set lower than the session timeout\r\n\tat org.apache.kafka.clients.consumer.internals.Heartbeat.<init>(Heartbeat.java:35)\r\n\tat org.apache.kafka.clients.consumer.internals.AbstractCoordinator.<init>(AbstractCoordinator.java:135)\r\n\tat org.apache.kafka.clients.consumer.internals.ConsumerCoordinator.<init>(ConsumerCoordinator.java:108)\r\n\tat org.apache.kafka.clients.consumer.KafkaConsumer.<init>(KafkaConsumer.java:676)\r\n\t... 4 more\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\n1. Prepare a kafka yaml file and make sure `sessionTimeoutMs` to be less than 10s.\r\n\r\n```\r\nconfigs:\r\n    bootstrapServers: \"127.0.0.1:9092\"\r\n    groupId: \"pulsarUTset\"\r\n    topic: \"test_kafka_topic\"\r\n    fetchMinBytes: 1\r\n    autoCommitEnabled: \"true\"\r\n    autoCommitIntervalMs: 1000\r\n    sessionTimeoutMs: 3000\r\n```\r\n\r\n2. Start pulsar standalone\r\n\r\n3. Localrun a Kafka source connector\r\n\r\n```\r\nbin/pulsar-admin source localrun --source-config-file kafka.yaml -t kafka --destination-topic-name dest_topic --name kafka_fn\r\n```\r\n\r\n#### System configuration\r\n**Pulsar version**:  any released version and master\r\n", "url": "https://github.com/apache/pulsar/issues/3293", "user": "sijie", "labels": ["component/io", "help wanted", "type/bug"], "created": "2019-01-03 08:41:41", "closed": "2019-01-06 20:52:38", "commits": {"b79bb9211d739c3e850641000a9cbadf6e785aa7": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "b79bb9211d739c3e850641000a9cbadf6e785aa7", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["9e68dda47e96c8d4211390464c9a3ff753b7c5b9"], "nameRev": "b79bb9211d739c3e850641000a9cbadf6e785aa7 tags/v2.3.0-candidate-1~184", "commitMessage": "Add heartbeat interval for kafka connector (#3308)\n\n### Motivation\r\n\r\nThe default value of ```heartbeat.interval.ms``` is 3000 in latest kafka consumer config, which cannot be customized in kafka source config now.  When user set ```sessionTimeoutMs``` to a value less than or equal to 3000, an exception will thrown. So we'd better to provide the ability to support this option. \r\n\r\nCloses #3293 ", "commitDateTime": "2019-01-07 05:52:37", "authoredDateTime": "2019-01-07 04:52:37", "commitGitStats": [{"filePath": "pulsar-io/kafka/src/main/java/org/apache/pulsar/io/kafka/KafkaAbstractSource.java", "insertions": 6, "deletions": 1, "lines": 7}, {"filePath": "pulsar-io/kafka/src/main/java/org/apache/pulsar/io/kafka/KafkaSourceConfig.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "site2/docs/io-kafka.md", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/KafkaSourceTester.java", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "KafkaAbstractSource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.kafka.KafkaAbstractSource", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.io.kafka.KafkaAbstractSource.open(java.util.Map,org.apache.pulsar.io.core.SourceContext)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KafkaSourceConfig.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.io.kafka.KafkaSourceConfig", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "KafkaSourceTester.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.io.KafkaSourceTester", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Connectors and offloaders are not available in download pages", "body": "#### Expected behavior\r\n\r\nConnectors and offloaders should be available to be downloaded in download page\r\n\r\n#### Actual behavior\r\n\r\nThere is no simple way to find the connectors and offloaders packages.\r\n\r\nhttp://pulsar.apache.org/en/download/\r\n\r\n#### Steps to reproduce\r\n", "url": "https://github.com/apache/pulsar/issues/3292", "user": "sijie", "labels": ["component/website", "help wanted", "type/bug"], "created": "2019-01-03 08:15:46", "closed": "2019-04-22 04:16:51", "commits": {}, "ttf": 108.00027777777778, "commitsDetails": []}, {"title": "curl http://localhost:8080/metrics return nothing", "body": "#### Expected behavior\r\n\r\nFollowing instructions in this page:\r\nhttp://pulsar.apache.org/docs/en/next/deploy-monitoring.html\r\n\r\n`curl http://localhost:8080/metrics`\r\nshould return some metrics info.\r\n\r\n#### Actual behavior\r\n\r\nnothing returned.\r\n\r\n#### Steps to reproduce\r\n\r\n1. start pulsar standalone\r\n2. use `bin/pulsar-admin broker-stats monitoring-metrics` could return metrics info.\r\n3. use `curl http://localhost:8080/metrics` returns nothing\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.2\r\n", "url": "https://github.com/apache/pulsar/issues/3289", "user": "jiazhai", "labels": ["help wanted", "type/bug"], "created": "2019-01-03 06:51:58", "closed": "2019-01-17 00:42:48", "commits": {}, "ttf": 13.000277777777777, "commitsDetails": []}, {"title": "ConsumerImpl.redeliverUnacknowledgedMessages() get empty messageids", "body": "#### Expected behavior\r\n\r\nno panic and error.\r\n\r\n#### Actual behavior\r\nmeet error info:\r\n```\r\njava.util.NoSuchElementException: No value present\r\n        at java.util.Optional.get(Optional.java:135)\r\n        at org.apache.pulsar.client.impl.ConsumerImpl.redeliverUnacknowledgedMessages(ConsumerImpl.java:1246)\r\n        at org.apache.pulsar.client.impl.UnAckedMessageTracker$1.run(UnAckedMessageTracker.java:96)\r\n        at org.apache.pulsar.shade.io.netty.util.HashedWheelTimer$HashedWheelTimeout.expire(HashedWheelTimer.java:663)\r\n        at org.apache.pulsar.shade.io.netty.util.HashedWheelTimer$HashedWheelBucket.expireTimeouts(HashedWheelTimer.java:738)\r\n        at org.apache.pulsar.shade.io.netty.util.HashedWheelTimer$Worker.run(HashedWheelTimer.java:466)\r\n        at org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n```\r\n\r\nAnd some times, there is log: `0 messages have timed-out`.\r\n\r\n#### Steps to reproduce\r\n\r\nHow can we reproduce the issue\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.2.1\r\n", "url": "https://github.com/apache/pulsar/issues/3287", "user": "jiazhai", "labels": ["component/client", "type/bug"], "created": "2019-01-03 02:03:17", "closed": "2019-01-07 08:04:08", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "Error while recovering ledger when send messages by producer", "body": "This is a transient exception while send messages by producer.\r\nStack trace:\r\n```\r\n15:10:00.028 [main] ERROR org.apache.pulsar.client.cli.PulsarClientTool - Error while producing messages\r\n15:10:00.028 [main] ERROR org.apache.pulsar.client.cli.PulsarClientTool - org.apache.bookkeeper.client.BKException$BKLedgerRecoveryException: Error while recovering ledger\r\norg.apache.pulsar.client.api.PulsarClientException: org.apache.bookkeeper.client.BKException$BKLedgerRecoveryException: Error while recovering ledger\r\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:760) ~[org.apache.pulsar-pulsar-client-original-2.1.0-incubating.jar:2.1.0-incubating]\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:497) ~[org.apache.pulsar-pulsar-client-original-2.1.0-incubating.jar:2.1.0-incubating]\r\n\tat org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:154) ~[org.apache.pulsar-pulsar-common-2.1.0-incubating.jar:2.1.0-incubating]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:284) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1414) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:945) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:806) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:404) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:304) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_111]\r\n15:10:00.033 [main] INFO  org.apache.pulsar.client.cli.PulsarClientTool - 0 messages successfully produced\r\n```\r\nRestart the client, send messages will be ok!\r\n#### System configuration\r\n**Pulsar version**: 2.1.0\r\n", "url": "https://github.com/apache/pulsar/issues/3279", "user": "codelipenghui", "labels": ["component/broker", "triage/week-33", "type/bug"], "created": "2019-01-02 08:48:59", "closed": "2020-01-14 17:34:25", "commits": {}, "ttf": 377.0002777777778, "commitsDetails": []}, {"title": "The left menubar in the website for 2.2.1 release is missing", "body": "In 2.2.1 website, the left sidebar is missing.\r\nhttp://pulsar.apache.org/docs/en/io-overview/\r\n\r\n![image](https://user-images.githubusercontent.com/6348208/50583798-66965900-0ea6-11e9-994a-3652b57c1398.png)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3277", "user": "jiazhai", "labels": ["type/bug"], "created": "2019-01-02 07:53:29", "closed": "2019-01-02 15:52:58", "commits": {"99bd3164d9aea7154e904ac17a8b7f892d123c1c": {"commitGHEventType": "closed", "commitUser": "sijie"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "99bd3164d9aea7154e904ac17a8b7f892d123c1c", "commitGHEventType": "closed", "commitUser": "sijie", "commitParents": ["1c7a7a48fe7f1ee7582184e85cec3f6bfc77161e"], "nameRev": "99bd3164d9aea7154e904ac17a8b7f892d123c1c tags/v2.3.0-candidate-1~202", "commitMessage": "Issue #3277: left sidebar missing for 2.2.1 website\n\n### Motivation\r\n\r\nFixes #3277 \r\n\r\nwebsite of 2.2.1 is missing left sidebar \r\n\r\n### Modifications\r\n\r\nchange version from 2.2.0 to 2.2.1\r\n\r\n### Result\r\n\r\nwebsite fixed.", "commitDateTime": "2019-01-02 07:52:50", "authoredDateTime": "2019-01-02 23:52:50", "commitGitStats": [{"filePath": "site2/website/versioned_sidebars/version-2.2.1-sidebars.json", "insertions": 87, "deletions": 87, "lines": 174}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["99bd3164d9aea7154e904ac17a8b7f892d123c1c"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 87, "deletions": 87, "lines": 174, "gitFilesChange": 1}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["site2/website/versioned_sidebars/version-2.2.1-sidebars.json"]}, {"title": "partitioned-stats reporting errors not match", "body": "#### Expected behavior\r\n\r\nUser report error message mis-leading. \r\nuse command `create-partitioned-topic` created topic, but  command `partitioned-stats` report topics not been generated.\r\n\r\n```\r\npulsar-admin topics create-partitioned-topic\r\npulsar-admin topics partitioned-stats\r\n```\r\n\r\nIt should not report \"topics not been generated\".  \r\n\r\n#### Actual behavior\r\n\r\n![image](https://user-images.githubusercontent.com/6348208/50538654-6c8df080-0bad-11e9-9984-2f8430be576f.png)\r\n\r\n\r\n#### Steps to reproduce\r\n\r\nUse command as above picture\r\n\r\n#### System configuration\r\npulsar 2.2.0\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3264", "user": "jiazhai", "labels": ["help wanted", "type/bug"], "created": "2018-12-29 13:44:54", "closed": "2019-01-13 01:26:37", "commits": {"221e5c72ec8e72b8f4e39c38c6a75790dec1217f": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 14.000277777777777, "commitsDetails": [{"commitHash": "221e5c72ec8e72b8f4e39c38c6a75790dec1217f", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["272725a9ca4d0334df54aff4b751105949d2c253"], "nameRev": "221e5c72ec8e72b8f4e39c38c6a75790dec1217f tags/v2.3.0-candidate-1~153", "commitMessage": "issues #3264 fix partitioned-stats reporting errors not match (#3339)\n\nfixes #3264 ", "commitDateTime": "2019-01-13 10:26:36", "authoredDateTime": "2019-01-13 09:26:36", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 9, "deletions": 0, "lines": 9}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 13, "deletions": 1, "lines": 14}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java", "insertions": 6, "deletions": 9, "lines": 15}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.zkPathExists(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicsBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.internalGetPartitionedStats(boolean)", "TOT": 7, "UPD": 0, "INS": 2, "MOV": 4, "DEL": 1}]}, {"spoonFilePath": "AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.partitionedTopics(java.lang.String)", "TOT": 10, "UPD": 2, "INS": 2, "MOV": 5, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Unclosed consumer after calling closeAsync", "body": "#### Expected behavior\r\n\r\nConsumer should be closed, and disappear in Pulsar Dashboard after we call closeAsync().\r\n\r\n#### Actual behavior\r\n\r\nConsumer still there, and if we create a new consumer to the topic (same subscription shared mode), we see two (and more and more) consumers (with same addresses and ports)\r\n\r\n#### Steps to reproduce\r\n\r\nCreate two consumers (maybe in different JVMs) in shared mode to the same topic. One of them called unsubscriptionAsync(), when the future failed, call closeAsync(), it will succeed, but the consumer will remain in the Dashboard (and pulsar admin stats). Then create a new consumer in that process, will see two consumers.\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.2.0\r\nJava version: 1.8\r\nOS: Linux\r\n", "url": "https://github.com/apache/pulsar/issues/3226", "user": "ntysdd", "labels": ["help wanted", "type/bug"], "created": "2018-12-20 12:01:11", "closed": "2019-01-07 08:46:48", "commits": {"21037920be99efdfd24d55d09c38b2b3caf94e14": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "719eab8a039b4533bc0ab13a3ffb530bf261ddb3": {"commitGHEventType": "closed", "commitUser": "sijie"}, "762e0ab9a52e2665a106766c211d45474adc833b": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "231db030b9529737237721059b2a5b3044d4cab1": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "1e5b3dd98eba136a68a99bf8106d3258cb1f283d": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "164d237cbe597908aa8e9cda5a7b920a3b342777": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 17.00027777777778, "commitsDetails": [{"commitHash": "21037920be99efdfd24d55d09c38b2b3caf94e14", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["1d2257110ed30012096ec5ef783805d0f1f09a78"], "nameRev": "21037920be99efdfd24d55d09c38b2b3caf94e14 tags/v2.3.0-candidate-1~189", "commitMessage": "Add logic in the dashboard to handle cases where Bundle,Topic,Subscription,Consumer already exists\n\n### Motivation\r\n\r\nRelated Issue : #3226 \r\n\r\nAdd logic in the dashboard to handle cases where Bundle,Topic,Subscription,Consumer already exists\r\n\r\n### Modifications\r\n\r\nUpdate Consumer, Bundle,Subscription,Topic if exist\r\n", "commitDateTime": "2019-01-05 01:36:10", "authoredDateTime": "2019-01-05 17:36:10", "commitGitStats": [{"filePath": "dashboard/django/collector.py", "insertions": 167, "deletions": 82, "lines": 249}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "719eab8a039b4533bc0ab13a3ffb530bf261ddb3", "commitGHEventType": "closed", "commitUser": "sijie", "commitParents": ["b79bb9211d739c3e850641000a9cbadf6e785aa7"], "nameRev": "719eab8a039b4533bc0ab13a3ffb530bf261ddb3 tags/v2.3.0-candidate-1~183", "commitMessage": "Issue 3226: Unclosed consumer after calling closeAsync\n\nFixes #3226 ", "commitDateTime": "2019-01-07 17:46:39", "authoredDateTime": "2019-01-07 16:46:39", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.unsubscribeAsync()", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "762e0ab9a52e2665a106766c211d45474adc833b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["ca690ad6f0ac0102eada79d0a36e0c2a0dc6cf42"], "nameRev": "762e0ab9a52e2665a106766c211d45474adc833b tags/v2.3.0-candidate-1~114", "commitMessage": "[Issue #3226][cpp client] Prevent dup consumers on same client cnx (#3403)\n\nPrevent same consumer subscription over the same client connection for cpp\r\nclient. For more details please see explanation on commit 44e1a23.\r\n\r\n### Motivation\r\n\r\nFix #3226 for cpp client.\r\n\r\n### Modifications\r\n\r\nAdd check for `ClientImpl.cc` to know whether new shared consumer subscribe is already present\r\non consumers vector or not.\r\n\r\nFor further explanation please see #3312 \r\n\r\n### Verifying this change\r\n\r\nThis change added tests and can be verified as follows:\r\n\r\n  - Add unit test asserting if duplicated consumers are allowed for shared\r\n    subscription.\r\n  - Add test preventing broker metadata error by closing a duplicate consumer\r\n    over the same connection.\r\n\r\n", "commitDateTime": "2019-01-26 19:40:03", "authoredDateTime": "2019-01-27 00:40:03", "commitGitStats": [{"filePath": "pulsar-client-cpp/lib/ClientImpl.cc", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-client-cpp/tests/BasicEndToEndTest.cc", "insertions": 47, "deletions": 0, "lines": 47}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "231db030b9529737237721059b2a5b3044d4cab1", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["762e0ab9a52e2665a106766c211d45474adc833b"], "nameRev": "231db030b9529737237721059b2a5b3044d4cab1 tags/v2.3.0-candidate-1~113", "commitMessage": "Prevent dup consumers on same client cnx with shared subscription (#3312)\n\n* Prevent dup consumers on same client cnx with shared subscription\r\n\r\nProviding help trying to fix issue #3226. Bug description:\r\n\r\nWhen a client attempts to setup more than one consumer subscription on shared\r\nmode with the same subscription name, due to the validation at broker level of\r\n`consumerList.size() == 1` on canUnsubscribe() method, broker will throw an\r\nexception at the moment the client tries to unsubscribe the consumer.\r\n\r\nIn order to prevent this, the proposed solution (probably not the best one) is\r\nto detect when the user is trying to setup an already subscribed consumer and\r\nreturn this exact same consumer instance.\r\n\r\nI believe that is quite strange to have two or more consumers with shared mode\r\non the same connection for the same subscription, this might be due to the user\r\nconfusing about consumer shared mode or behaviour, another good solution to\r\nprevent this from happening might be just throwing an invalid configuration\r\nexception.\r\n\r\n* Adapt tests for bugfix introduced in commit 44e1a23\r\n\r\n* Add test case exploiting issue 3326 described in commit 44e1a23\r\n", "commitDateTime": "2019-01-27 16:24:53", "authoredDateTime": "2019-01-27 05:24:53", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/auth/MockedPulsarServiceBaseTest.java", "insertions": 7, "deletions": 2, "lines": 9}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentQueueE2ETest.java", "insertions": 19, "deletions": 15, "lines": 34}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentTopicE2ETest.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/ResendRequestTest.java", "insertions": 16, "deletions": 13, "lines": 29}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/DeadLetterTopicTest.java", "insertions": 10, "deletions": 4, "lines": 14}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/DispatcherBlockConsumerTest.java", "insertions": 6, "deletions": 2, "lines": 8}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/PartitionedProducerConsumerTest.java", "insertions": 14, "deletions": 0, "lines": 14}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java", "insertions": 110, "deletions": 22, "lines": 132}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/v1/V1_ProducerConsumerTest.java", "insertions": 53, "deletions": 24, "lines": 77}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/BrokerClientIntegrationTest.java", "insertions": 4, "deletions": 2, "lines": 6}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "insertions": 25, "deletions": 7, "lines": 32}, {"filePath": "tests/pulsar-storm-test/src/test/java/org/apache/pulsar/storm/PulsarSpoutTest.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "MockedPulsarServiceBaseTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.auth.MockedPulsarServiceBaseTest.internalSetupForStatsTest()", "TOT": 6, "UPD": 1, "INS": 1, "MOV": 3, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.auth.MockedPulsarServiceBaseTest.internalSetup()", "TOT": 6, "UPD": 0, "INS": 1, "MOV": 4, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.auth.MockedPulsarServiceBaseTest.newPulsarClient(java.lang.String,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentQueueE2ETest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PersistentQueueE2ETest.testSimpleConsumerEvents()", "TOT": 16, "UPD": 11, "INS": 2, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.PersistentQueueE2ETest.testSharedSingleAckedNormalTopic()", "TOT": 9, "UPD": 6, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.PersistentQueueE2ETest.testRoundRobinBatchDistribution()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.PersistentQueueE2ETest.testCancelReadRequestOnLastDisconnect()", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.PersistentQueueE2ETest.testUnackedCountWithRedeliveries()", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.PersistentQueueE2ETest.testReplayOnConsumerDisconnect()", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PersistentTopicE2ETest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PersistentTopicE2ETest.testSubscriptionTypeTransitions()", "TOT": 18, "UPD": 0, "INS": 12, "MOV": 0, "DEL": 6}]}, {"spoonFilePath": "ResendRequestTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ResendRequestTest.testSharedSingleAckedNormalTopic()", "TOT": 11, "UPD": 7, "INS": 2, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ResendRequestTest.testSharedSingleAckedPartitionedTopic()", "TOT": 11, "UPD": 7, "INS": 2, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ResendRequestTest.testExclusiveSingleAckedNormalTopic()", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ResendRequestTest.testFailoverSingleAckedNormalTopic()", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ResendRequestTest.testExclusiveCumulativeAckedNormalTopic()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ResendRequestTest.testExclusiveSingleAckedPartitionedTopic()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ResendRequestTest.testFailoverSingleAckedPartitionedTopic()", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.ResendRequestTest.testFailoverInactiveConsumer()", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "DeadLetterTopicTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.DeadLetterTopicTest.testDeadLetterTopic()", "TOT": 5, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.DeadLetterTopicTest.testDeadLetterTopicByCustomTopicName()", "TOT": 8, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 2}]}, {"spoonFilePath": "DispatcherBlockConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.DispatcherBlockConsumerTest.testBlockBrokerDispatching()", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.DispatcherBlockConsumerTest.testBrokerDispatchBlockAndSubAckBackRequiredMsgs()", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "PartitionedProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testRoundRobinProducer()", "TOT": 8, "UPD": 0, "INS": 4, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testCustomPartitionProducer()", "TOT": 8, "UPD": 0, "INS": 4, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testSinglePartitionProducer()", "TOT": 8, "UPD": 0, "INS": 4, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testKeyBasedProducer()", "TOT": 8, "UPD": 0, "INS": 4, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testPauseAndResume()", "TOT": 6, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testAsyncPartitionedProducerConsumerQueueSizeOne()", "TOT": 8, "UPD": 0, "INS": 4, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.api.PartitionedProducerConsumerTest.testFairDistributionForPartitionConsumers()", "TOT": 8, "UPD": 0, "INS": 5, "MOV": 0, "DEL": 3}]}, {"spoonFilePath": "SimpleProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testPriorityConsumer()", "TOT": 21, "UPD": 8, "INS": 8, "MOV": 5, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testSharedSamePriorityConsumer()", "TOT": 31, "UPD": 8, "INS": 14, "MOV": 8, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testMutlipleSharedConsumerBlockingWithUnAckedMessages()", "TOT": 9, "UPD": 5, "INS": 2, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testRedeliveryOfFailedMessages()", "TOT": 18, "UPD": 0, "INS": 9, "MOV": 8, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testPreventDupConsumersOnClientCnx()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "V1_ProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.v1.V1_ProducerConsumerTest.testPriorityConsumer()", "TOT": 33, "UPD": 14, "INS": 10, "MOV": 8, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.v1.V1_ProducerConsumerTest.testSharedSamePriorityConsumer()", "TOT": 24, "UPD": 8, "INS": 11, "MOV": 5, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.api.v1.V1_ProducerConsumerTest.testMutlipleSharedConsumerBlockingWithUnAckedMessages()", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "BrokerClientIntegrationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BrokerClientIntegrationTest.testUnsupportedBatchMessageConsumer(org.apache.pulsar.client.api.SubscriptionType)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "PulsarClientImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.timer()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.getPartitionsForTopic(java.lang.String)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.subscriptionExist(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.doSingleTopicSubscribeAsync(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.multiTopicSubscribeAsync(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.patternTopicSubscribeAsync(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarSpoutTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.storm.PulsarSpoutTest.testNoSharedConsumer()", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "1e5b3dd98eba136a68a99bf8106d3258cb1f283d", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["8561e02c70772ff34bbbedb78b1f0b55776fe512"], "nameRev": "1e5b3dd98eba136a68a99bf8106d3258cb1f283d tags/v2.4.0-candidate-1~273", "commitMessage": "Revert dup consumer and related code (#4142)\n\n* Revert \"[cpp client] implement reference count for close() (#3863)\"\r\n\r\nThis reverts commit ee98e8b28ce1397c056757fe73115d21320ed883.\r\n\r\n* Revert Prevent dup consumers and refCount for cpp client\r\n\r\nRevert \"[cpp client] Bugfix prevent dup consumer for same topic subscription\"\r\nRevert \"[Issue #3226][cpp client] Prevent dup consumers on same client cnx\"\r\n\r\nThis reverts commit fff02e2aa2064412dbae18b973eb2bb2abab25d8.\r\nThis reverts commit 762e0ab9a52e2665a106766c211d45474adc833b.\r\n\r\n* Revert \"Feature - implement reference count for ConsumerImpl (#3795)\"\r\n\r\nThis reverts commit ff4db8db12be2eb79d910e2b286306298f71320e.\r\n\r\n* Revert Prevent dup consumers and refCount for java client\r\n\r\nRevert \"Prevent dup consumers on same client cnx with shared subscription\"\r\nRevert \"[java client] Bugfix prevent dup consumers for same topic subscribe\"\r\n\r\nThis reverts commit 231db030b9529737237721059b2a5b3044d4cab1.\r\nThis reverts commit fb5dcd9a58524686f2f6208d41a1e82b5bbb8111.\r\n", "commitDateTime": "2019-04-29 11:06:14", "authoredDateTime": "2019-04-29 15:06:14", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java", "insertions": 0, "deletions": 112, "lines": 112}, {"filePath": "pulsar-client-cpp/lib/ClientImpl.cc", "insertions": 0, "deletions": 13, "lines": 13}, {"filePath": "pulsar-client-cpp/lib/ConsumerImpl.cc", "insertions": 0, "deletions": 12, "lines": 12}, {"filePath": "pulsar-client-cpp/lib/ConsumerImpl.h", "insertions": 0, "deletions": 3, "lines": 3}, {"filePath": "pulsar-client-cpp/lib/ConsumerImplBase.h", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-client-cpp/tests/BasicEndToEndTest.cc", "insertions": 0, "deletions": 82, "lines": 82}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 0, "deletions": 9, "lines": 9}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 0, "deletions": 4, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "insertions": 0, "deletions": 19, "lines": 19}, {"filePath": "tests/pulsar-storm-test/src/test/java/org/apache/pulsar/storm/PulsarSpoutTest.java", "insertions": 1, "deletions": 6, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SimpleProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testPreventDupConsumersOnClientCnxForSingleSub()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testPreventDupConsumersOnClientCnxForSingleSub_AllowDifferentTopics()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testRefCount_OnCloseConsumer()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.incrRefCount()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.shouldTearDown()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.closeAsync()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "PulsarClientImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.doSingleTopicSubscribeAsync(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.subscriptionExist(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "PulsarSpoutTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.storm.PulsarSpoutTest.testNoSharedConsumer()", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 3}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "164d237cbe597908aa8e9cda5a7b920a3b342777", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["4c2bb0cecad7ea9f537f5790d049ec5b3f2d994c"], "nameRev": "164d237cbe597908aa8e9cda5a7b920a3b342777 tags/v2.3.2-candidate-1~9", "commitMessage": "Revert dup consumer and related code (#4142)\n\n* Revert \"[cpp client] implement reference count for close() (#3863)\"\n\nThis reverts commit ee98e8b28ce1397c056757fe73115d21320ed883.\n\n* Revert Prevent dup consumers and refCount for cpp client\n\nRevert \"[cpp client] Bugfix prevent dup consumer for same topic subscription\"\nRevert \"[Issue #3226][cpp client] Prevent dup consumers on same client cnx\"\n\nThis reverts commit fff02e2aa2064412dbae18b973eb2bb2abab25d8.\nThis reverts commit 762e0ab9a52e2665a106766c211d45474adc833b.\n\n* Revert \"Feature - implement reference count for ConsumerImpl (#3795)\"\n\nThis reverts commit ff4db8db12be2eb79d910e2b286306298f71320e.\n\n* Revert Prevent dup consumers and refCount for java client\n\nRevert \"Prevent dup consumers on same client cnx with shared subscription\"\nRevert \"[java client] Bugfix prevent dup consumers for same topic subscribe\"\n\nThis reverts commit 231db030b9529737237721059b2a5b3044d4cab1.\nThis reverts commit fb5dcd9a58524686f2f6208d41a1e82b5bbb8111.\n", "commitDateTime": "2019-05-18 17:31:36", "authoredDateTime": "2019-04-29 15:06:14", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java", "insertions": 0, "deletions": 112, "lines": 112}, {"filePath": "pulsar-client-cpp/lib/ClientImpl.cc", "insertions": 0, "deletions": 13, "lines": 13}, {"filePath": "pulsar-client-cpp/lib/ConsumerImpl.cc", "insertions": 0, "deletions": 12, "lines": 12}, {"filePath": "pulsar-client-cpp/lib/ConsumerImpl.h", "insertions": 0, "deletions": 3, "lines": 3}, {"filePath": "pulsar-client-cpp/lib/ConsumerImplBase.h", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-client-cpp/tests/BasicEndToEndTest.cc", "insertions": 0, "deletions": 82, "lines": 82}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java", "insertions": 0, "deletions": 9, "lines": 9}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 0, "deletions": 4, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "insertions": 0, "deletions": 19, "lines": 19}, {"filePath": "tests/pulsar-storm-test/src/test/java/org/apache/pulsar/storm/PulsarSpoutTest.java", "insertions": 1, "deletions": 6, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SimpleProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testPreventDupConsumersOnClientCnxForSingleSub()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testPreventDupConsumersOnClientCnxForSingleSub_AllowDifferentTopics()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testRefCount_OnCloseConsumer()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.incrRefCount()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBase.shouldTearDown()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.closeAsync()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "PulsarClientImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.doSingleTopicSubscribeAsync(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.subscriptionExist(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "PulsarSpoutTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.storm.PulsarSpoutTest.testNoSharedConsumer()", "TOT": 5, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 3}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["21037920be99efdfd24d55d09c38b2b3caf94e14", "719eab8a039b4533bc0ab13a3ffb530bf261ddb3"], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 3, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 2, "gitStatsSummary": {"insertions": 169, "deletions": 84, "lines": 253, "gitFilesChange": 2}, "spoonStatsSummary": {"TOT": 2.0, "UPD": 0.0, "INS": 0.0, "MOV": 2.0, "DEL": 0.0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["dashboard/django/collector.py", "pulsar-client/src/main/java/org/apache/pulsar/client/impl"], "changesInPackagesSPOON": ["org.apache.pulsar.client.impl.ConsumerImpl.unsubscribeAsync()"]}, {"title": "Function option --subscription-type does not work", "body": "The option is documented at https://pulsar.apache.org/docs/en/pulsar-admin/#create-1, but it is actually an invalid option. I find it was once supported in the CmdFunctions.java source code but was deleted later. Will it be supported again?\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.2.0\r\n", "url": "https://github.com/apache/pulsar/issues/3224", "user": "ngjaying", "labels": ["component/documentation", "component/io", "triage/week-31", "type/bug"], "created": "2018-12-20 08:49:55", "closed": "2020-07-01 06:16:59", "commits": {}, "ttf": 558.0002777777778, "commitsDetails": []}, {"title": "Info shown on Dashboard is not accurate", "body": "1\u3001\u6309\u7167\u5b98\u7f51\u7684\u96c6\u7fa4\u90e8\u7f72\u642d\u5efa\u96c6\u7fa4\u3002\r\n2\u3001\u901a\u8fc7\u8be5\u547d\u4ee4\u5411\u6d88\u606f\u961f\u5217\u91cc\u9762\u53d1\u751f\u6570\u636e\r\n  bin/pulsar-client produce \\\r\n  persistent://public/default/test \\\r\n  -n 1 \\\r\n  -m \"Hello, Pulsar\"\r\n3\u3001\u518d\u901a\u8fc7\u8be5\u547d\u4ee4\u6d88\u8d39\r\nbin/pulsar-client consume   persistent://public/default/test -s hei \r\n4\u3001\u95ee\u9898\u4e00\u3001\u901a\u8fc7dashboard \u8bbf\u95eehttp://172.19.36.119/admin/stats/topic/\r\n\u5982\u4e0b\u9762\u6240\u793a\u51fa\u73b0\u5f88\u591a\u91cd\u590d\u7684tipic \r\n\r\nTOPIC\r\n--\r\npersistent://public/default/test\r\npersistent://public/default/test\r\npersistent://public/default/test\r\npersistent://public/default/test\r\n\u95ee\u9898\u4e8c\u3001http://172.19.36.119 \u901a\u8fc7\u67e5\u770b\u7684\u8fd9\u4e2a\u5730\u5740\r\n\u8bbf\u95ee\u770b\u5230\u7684\u79df\u6237\uff0c namespace topic \u4e0d\u4e00\u6837\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3223", "user": "xinln", "labels": ["component/dashboard", "type/bug"], "created": "2018-12-20 06:04:19", "closed": "2019-08-05 08:11:23", "commits": {}, "ttf": 228.00027777777777, "commitsDetails": []}, {"title": "Make pulsar compile on windows", "body": "#### Expected behavior\r\n\r\nCompile successfully on windows\r\n\r\n#### Actual behavior\r\n\r\nCompilation failed on windows.\r\n\r\nThere are some bash scripts executed during compilation. We should add corresponding scripts for running on windows. \r\n\r\n#### System configuration\r\n**Pulsar version**: master\r\n", "url": "https://github.com/apache/pulsar/issues/3219", "user": "sijie", "labels": ["component/build", "type/bug"], "created": "2018-12-19 08:04:51", "closed": "2018-12-20 16:18:16", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "document co-run zookeeper and bookie on same machine", "body": "#### Expected behavior\r\n\r\nzookeeper and bookie should be able to co-run on same machine\r\n\r\n#### Actual behavior\r\n\r\nbookie will fail to start because zookeeper and bookie are using same prometheus port\r\n\r\n#### Steps to reproduce\r\n\r\n- start zookeeper\r\n- start bookie\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.2\r\n", "url": "https://github.com/apache/pulsar/issues/3213", "user": "sijie", "labels": ["component/documentation", "type/bug"], "created": "2018-12-19 03:04:17", "closed": "2018-12-27 10:20:52", "commits": {"c3a7d6a89eaf6c7cb1ff226ffc9b7c67bc418bc4": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 8.000277777777777, "commitsDetails": [{"commitHash": "c3a7d6a89eaf6c7cb1ff226ffc9b7c67bc418bc4", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f24a0b191f178369b253642d89f28e5115008142"], "nameRev": "c3a7d6a89eaf6c7cb1ff226ffc9b7c67bc418bc4 tags/v2.3.0-candidate-1~223", "commitMessage": "document co-run zookeeper and bookie on same machine (#3242)\n\n### Motivation\r\n\r\nIssue: https://github.com/apache/pulsar/issues/3213\r\n\r\n### Modifications\r\n\r\nupdate the readme to highlight this part\r\n\r\n### Result\r\n\r\nAfter your change, what will change.", "commitDateTime": "2018-12-23 20:40:52", "authoredDateTime": "2018-12-24 12:40:52", "commitGitStats": [{"filePath": "site2/docs/deploy-bare-metal.md", "insertions": 9, "deletions": 0, "lines": 9}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["c3a7d6a89eaf6c7cb1ff226ffc9b7c67bc418bc4"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "pulsar producer create fail, get error :Received error from server: java.lang.NullPointerException", "body": "#### Actual behavior\r\n\r\nI have create a producer with JSON schema of Person object for topic named /xh/test/demo8, in the code review, we need to update Person to Student, the Student extends Person, so i delete the schema for persistent://xh/test/demo8, then i create the producer by pulsarClient, but the server response the error Received error from server: java.lang.NullPointerException. Then, i delete the topic persistent://xh/test/demo8, and create producer ,i get a same error from server, so that, I use pulsar-admin to upload a new schema by conf file, the server response a 500 bad code for me\r\n\r\n#### Steps to reproduce\r\n\r\n1\u3001create a producer with Json schema with a pojo object\r\n2\u3001delete the topic schema\r\n3\u3001create producer \r\n\r\n#### System configuration\r\n**Pulsar version**: 2.2.0\r\n", "url": "https://github.com/apache/pulsar/issues/3211", "user": "Michael-YuSha", "labels": ["component/schemaregistry", "type/bug"], "created": "2018-12-19 02:44:28", "closed": "2019-03-19 15:19:06", "commits": {"8997375ef6a0b6c6286478b495c0ca785ae41710": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "47f85a1ddf27ca2b952ac8820537e9e0abd667b7": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 90.00027777777778, "commitsDetails": [{"commitHash": "8997375ef6a0b6c6286478b495c0ca785ae41710", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["05dc8c88aba193d64002ff8cc229c01790fcef72"], "nameRev": "8997375ef6a0b6c6286478b495c0ca785ae41710 tags/v2.4.0-candidate-1~461", "commitMessage": "Issue #3211: Fix NPE when creating schema after deleting a schema (#3836)\n\nFixes #3211\r\nFixes #2786 \r\n\r\n*Motivation*\r\n\r\nWhen a schema is deleted, the schema is not removed directly.\r\nYou can still fetch the latest schema but its state is marked as `deleted`.\r\n\r\nSo when we apply schema compatibility check, we should ignore deleted schema.\r\n\r\n*Modifications*\r\n\r\nIgnore deleted schema when doing schema compatibility check\r\n\r\n", "commitDateTime": "2019-03-19 23:19:05", "authoredDateTime": "2019-03-19 23:19:05", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java", "insertions": 11, "deletions": 4, "lines": 15}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/SchemaTest.java", "insertions": 110, "deletions": 0, "lines": 110}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/Schemas.java", "insertions": 79, "deletions": 0, "lines": 79}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SchemaRegistryServiceImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.checkCompatibilityWithLatest(java.lang.String,org.apache.pulsar.common.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.putSchemaIfAbsent(java.lang.String,org.apache.pulsar.common.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "SchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.schema.SchemaTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Schemas.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.schema.Schemas", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "47f85a1ddf27ca2b952ac8820537e9e0abd667b7", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["1c6563eb81fdff69b8f6507881497a95659165d7"], "nameRev": "47f85a1ddf27ca2b952ac8820537e9e0abd667b7 tags/v2.3.1-candidate-1~11", "commitMessage": "Issue #3211: Fix NPE when creating schema after deleting a schema (#3836)\n\nFixes #3211\r\nFixes #2786 \r\n\r\n*Motivation*\r\n\r\nWhen a schema is deleted, the schema is not removed directly.\r\nYou can still fetch the latest schema but its state is marked as `deleted`.\r\n\r\nSo when we apply schema compatibility check, we should ignore deleted schema.\r\n\r\n*Modifications*\r\n\r\nIgnore deleted schema when doing schema compatibility check\r\n\r\n", "commitDateTime": "2019-04-01 10:53:51", "authoredDateTime": "2019-03-19 23:19:05", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java", "insertions": 11, "deletions": 4, "lines": 15}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/SchemaTest.java", "insertions": 110, "deletions": 0, "lines": 110}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/Schemas.java", "insertions": 79, "deletions": 0, "lines": 79}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SchemaRegistryServiceImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.checkCompatibilityWithLatest(java.lang.String,org.apache.pulsar.common.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.putSchemaIfAbsent(java.lang.String,org.apache.pulsar.common.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "SchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.schema.SchemaTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Schemas.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.schema.Schemas", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Re-delivery un-acked message repeated in different consumers", "body": "#### Expected behavior\r\n\r\nRe-delivery un-acked message should dispatch message to one consumer in a period of ack timout.\r\n\r\n#### Actual behavior\r\n\r\nFound that more than one consumer receive the redelivery message at the same time.\r\n\r\n```\r\n[Thu Dec 13 16:55:22 CST 2018] [f48e8] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:27 CST 2018] [0338e] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:27 CST 2018] [f48e8] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:32 CST 2018] [0338e] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:32 CST 2018] [f48e8] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:37 CST 2018] [0338e] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:37 CST 2018] [f48e8] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:42 CST 2018] [0338e] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:42 CST 2018] [f48e8] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:47 CST 2018] [0338e] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:47 CST 2018] [f48e8] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:52 CST 2018] [0338e] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:52 CST 2018] [f48e8] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:57 CST 2018] [0338e] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:55:57 CST 2018] [f48e8] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:56:02 CST 2018] [0338e] Hello Pulsar15.610505468878621\r\n[Thu Dec 13 16:56:02 CST 2018] [f48e8] Hello Pulsar15.610505468878621\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\nHere is the test case:\r\n\r\n```java\r\npackage com.zhaopin.pulsar.issues;\r\n\r\nimport org.apache.pulsar.client.api.Consumer;\r\nimport org.apache.pulsar.client.api.Message;\r\nimport org.apache.pulsar.client.api.Producer;\r\nimport org.apache.pulsar.client.api.PulsarClient;\r\nimport org.apache.pulsar.client.api.PulsarClientException;\r\nimport org.apache.pulsar.client.api.Schema;\r\nimport org.apache.pulsar.client.api.SubscriptionType;\r\n\r\nimport java.util.Date;\r\nimport java.util.concurrent.TimeUnit;\r\n\r\npublic class MultiConsumerRedeliveryIssue {\r\n\r\n    public static void main(String[] args) throws PulsarClientException {\r\n\r\n        String TOPIC = \"persistent://public/default/multi-consumer-redelivery-test3\";\r\n\r\n        PulsarClient client = PulsarClient.builder()\r\n                .maxNumberOfRejectedRequestPerConnection(50)\r\n                .serviceUrl(\"pulsar://172.17.5.175:6650\")\r\n                .build();\r\n\r\n        Producer<byte[]> producer = client.newProducer(Schema.BYTES)\r\n                .topic(TOPIC)\r\n                .sendTimeout(500, TimeUnit.MILLISECONDS)\r\n                .create();\r\n\r\n        Consumer<byte[]> consumer = client.newConsumer(Schema.BYTES)\r\n                .topic(TOPIC)\r\n                .subscriptionName(\"test\")\r\n                .subscriptionType(SubscriptionType.Shared)\r\n                .ackTimeout(5, TimeUnit.SECONDS)\r\n                .subscribe();\r\n\r\n        Consumer<byte[]> consumer2 = client.newConsumer(Schema.BYTES)\r\n                .topic(TOPIC)\r\n                .subscriptionName(\"test\")\r\n                .subscriptionType(SubscriptionType.Shared)\r\n                .ackTimeout(5, TimeUnit.SECONDS)\r\n                .subscribe();\r\n\r\n        new Thread(() -> {\r\n            try {\r\n                do {\r\n                    Message<byte[]> message = consumer.receive();\r\n                    System.out.println(\"[\" + new Date() + \"] [\" + consumer.getConsumerName() + \"] \"\r\n                            + new String(message.getValue()));\r\n                } while (true);\r\n            } catch (PulsarClientException e) {\r\n                e.printStackTrace();\r\n            }\r\n        }).start();\r\n\r\n        new Thread(() -> {\r\n            try {\r\n                do {\r\n                    Message<byte[]> message = consumer2.receive();\r\n                    System.out.println(\"[\" + new Date() + \"] [\" + consumer2.getConsumerName() + \"] \"\r\n                            + new String(message.getValue()));\r\n                } while (true);\r\n            } catch (PulsarClientException e) {\r\n                e.printStackTrace();\r\n            }\r\n        }).start();\r\n\r\n        producer.send((\"Hello Pulsar\" + Math.random() * 100).getBytes());\r\n\r\n    }\r\n}\r\n\r\n```\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.2.0\r\n", "url": "https://github.com/apache/pulsar/issues/3185", "user": "codelipenghui", "labels": ["component/client", "type/bug"], "created": "2018-12-13 09:01:25", "closed": "2018-12-18 01:56:41", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "MessageID always seems to serialize to empty slice in Go client Reader", "body": "#### Expected behavior\r\n\r\n```go\r\n// Error checks left for brevity, these are checked in real code\r\nreader, _ := client.CreateReader(pulsar.ReaderOptions{\r\n\tTopic:          \"foo\",\r\n\tStartMessageID: pulsar.LatestMessage})\r\n\r\nctx, cancel := context.WithTimeout(context.Background(), 1000 * time.Millisecond)\r\ndefer cancel()\r\nmsg, err := r.reader.Next(ctx)\r\nif err != nil {\r\n   // I would expect this to print a byte slice with length > 0 but it's\r\n   // always an empty slice...\r\n   fmt.Printf(\"ID: %v\", msg.ID().Serialize())\r\n}\r\n```\r\n#### Actual behavior\r\n\r\nMessage ID always seems to be empty.\r\n\r\n#### Steps to reproduce\r\nSee example above. The behaviour is the same on a standalone cluster and a full blown cluster with 3 x zookeeper, 3 x broker and 3 x bookie.\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.2.0\r\n**Go client version**:\r\ngithub.com/apache/pulsar v2.2.0+incompatible h1:i2dfg67DNdHRgdzdIiSObTb9VRavAtZStxC4YIySxAI=\r\ngithub.com/apache/pulsar v2.2.0+incompatible/go.mod h1:7npmYEEu+jEeIMdpGSJwrTxUB86OW/UM5IkJCAyfl5Y=\r\ng\r\n", "url": "https://github.com/apache/pulsar/issues/3177", "user": "tobgu", "labels": ["component/go", "type/bug"], "created": "2018-12-12 21:31:25", "closed": "2019-05-19 13:46:38", "commits": {}, "ttf": 157.00027777777777, "commitsDetails": []}, {"title": "Function state does not work", "body": "#### Expected behavior\r\n\r\nFunction context getState can read the state set by putState\r\n\r\n#### Actual behavior\r\n\r\nFunction context getState does not return the state set by putState\r\n\r\n#### Steps to reproduce\r\nRun the following function on the cluster.  The incrCounter/getCounter works fine; but the getState always return empty string.\r\n```\r\nimport static java.nio.charset.StandardCharsets.UTF_8;\r\n\r\nimport java.nio.ByteBuffer;\r\n\r\nimport org.apache.pulsar.functions.api.Context;\r\nimport org.apache.pulsar.functions.api.Function;\r\nimport org.slf4j.Logger;\r\n\r\npublic class StateFunction implements Function<String, Void> {\r\n\r\n\tprivate Logger logger;\r\n\t@Override\r\n\tpublic Void process(String input, Context context) throws Exception {\r\n\t\tlogger = context.getLogger();\r\n\t\tlogger.info(\"received {}\", input);\r\n\t\tcontext.incrCounter(\"ac\", 1);\r\n\t\tlong currentCount = context.getCounter(\"ac\");\r\n\t\tlogger.info(\"current count: {}\", currentCount);\r\n\t\t\r\n\t\ttry {\r\n\t\t\tByteBuffer rulesState = context.getState(\"last\");\r\n\t\t\tif(rulesState != null) {\r\n\t\t\t\tlogger.info(\"last: {}\", UTF_8.decode(rulesState).toString());\r\n\t\t\t}\r\n\t\t}catch(Exception e) {\r\n\t\t\te.printStackTrace();\r\n\t\t}\r\n\t\t\r\n\t\tcontext.putState(\"last\", ByteBuffer.wrap(input.getBytes(UTF_8)));\r\n\t\t\r\n\t\ttry {\r\n\t\t\tByteBuffer rulesState = context.getState(\"last\");\r\n\t\t\tif(rulesState != null) {\r\n\t\t\t\tlogger.info(\"new last: {}\", UTF_8.decode(rulesState).toString());\r\n\t\t\t}\r\n\t\t}catch(Exception e) {\r\n\t\t\te.printStackTrace();\r\n\t\t}\r\n\t\t\r\n\t\treturn null;\r\n\t}\r\n\r\n}\r\n```\r\nA sample log produced by this function:\r\n```\r\n09:04:04.921 [public/default/statefunc-0] INFO  function-statefunc - received hello-pulsar-1\r\n09:04:04.929 [public/default/statefunc-0] INFO  function-statefunc - current count: 41\r\n09:04:04.934 [public/default/statefunc-0] INFO  function-statefunc - last: \r\n09:04:04.942 [public/default/statefunc-0] INFO  function-statefunc - new last: \r\n```\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.2.0\r\n", "url": "https://github.com/apache/pulsar/issues/3140", "user": "ngjaying", "labels": ["triage/week-29", "type/bug"], "created": "2018-12-07 09:11:48", "closed": "2019-07-21 07:34:03", "commits": {}, "ttf": 225.00027777777777, "commitsDetails": []}, {"title": "Consumer stop receive messages from broker", "body": "#### Actual behavior\r\n\r\nA process subscribe a topic with 2 subscriptionName. After a few hours, we found backlog of 1 subscriptionName growing continuous, then check the broker stats:\r\n\r\n![image](https://user-images.githubusercontent.com/12592133/49558266-6a859880-f945-11e8-9786-8f4cc9dc24c1.png)\r\n\r\n![image](https://user-images.githubusercontent.com/12592133/49558323-9739b000-f945-11e8-8a6e-6f368e6bf7c3.png)\r\n\r\nStats of unackedMessages and availablePermits looks weird, i don't understand why both of them is 0 at the same time.\r\n\r\nThen make the heap dump of client, but did not find anything abnormal. I'm already upload the heap dump to slack:\r\n\r\nhttps://apache-pulsar.slack.com/files/UC0BYCXKQ/FELNFAZ6W/heap.hprof\r\n\r\n#### System configuration\r\n\r\n**Pulsar Broker version**: 2.2.0\r\n**Pulsar Client version**: 2.2.0\r\n", "url": "https://github.com/apache/pulsar/issues/3131", "user": "codelipenghui", "labels": ["type/bug"], "created": "2018-12-06 03:03:58", "closed": "2019-01-17 00:40:41", "commits": {"8e4b27d6d73d18a9ef4b124f7b66e8d468ead691": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 41.000277777777775, "commitsDetails": [{"commitHash": "8e4b27d6d73d18a9ef4b124f7b66e8d468ead691", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["934d80d4e24c54eaa6bac59bd99bfc8d352db661"], "nameRev": "8e4b27d6d73d18a9ef4b124f7b66e8d468ead691 tags/v2.3.0-candidate-1~143", "commitMessage": "Fix bug consumer stop consume(issue-3131) (#3358)\n\nMotivation\r\nFix #3131\r\nWhen dispatcher is blocked and consumer blocked by un-ack messages, if consumer redelivery count < permitsReceivedWhileConsumerBlocked will cause dispatcher never send a message to the consumer again.\r\n\r\nModifications\r\nUse permitsReceivedWhileConsumerBlocked to release dispatcher permits control.\r\n\r\nResult\r\nUT Passed.", "commitDateTime": "2019-01-17 08:40:40", "authoredDateTime": "2019-01-17 08:40:40", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java", "insertions": 1, "deletions": 3, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Consumer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.Consumer.redeliverUnacknowledgedMessages(java.util.List)", "TOT": 5, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 2}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "kubernetes fucntion labels are not formatted correctly", "body": "Kubernetes does not allow \"/\" in the label or selector values\r\n\r\n* spec.selector: Invalid value: \"public/default/log\": a valid label must be an empty string or consist of alphanumeric characters, '-', '_' or '.', and must start and end with an alphanumeric character (e.g. 'MyValue',  or 'my_value',  or '12345', regex used for validation is '(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])?')\r\n* spec.selector: Invalid value: \"public/default\": a valid label must be an empty string or consist of alphanumeric characters, '-', '_' or '.', and must start and end with an alphanumeric character (e.g. 'MyValue',  or 'my_value',  or '12345', regex used for validation is '(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])?')\r\n", "url": "https://github.com/apache/pulsar/issues/3122", "user": "cckellogg", "labels": ["component/deploy", "type/bug"], "created": "2018-12-04 19:30:34", "closed": "2019-05-19 13:42:39", "commits": {}, "ttf": 165.00027777777777, "commitsDetails": []}, {"title": "Several issues with the kubernetes generic example", "body": "#### Expected behavior\r\nIt should be able to be adjusted to run more then one bookie.\r\n\r\n#### Actual behavior\r\nWhen you adjust the kubernetes example to run more then one bookie without multiple kubernetes nodes, the second bookie will crash with `There are directories without a cookie, and this is neither a new environment, nor is storage expansion enabled. Empty directories are [data/bookkeeper/journal/current, data/bookkeeper/ledgers/current]`\r\nnow it's just on bookie-0 instead of bookie-1`\r\n\r\n#### Steps to reproduce\r\nChange the DaemonSet to be a Statefulset, and change replicas to 2\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.2.0\r\n\r\n\r\n### More info\r\nDebugged together with @ivankelly.\r\nSeveral suggestions:\r\n- change from DaemonSet to Statefulset as in the GKE example\r\n- remove the environment to set the advertisedAddress from the hostIP, let it just use it's POD ip (like the GKE example)\r\n- Remove the initContainer as there is a job to initialize the cluster metadata\r\n- Change the container to wait for zookeeper to be up (apparently there is a script for this), as this removes the need to spin up zookeeper first as the documentation suggests.\r\n- have PVC's for all zookeeper and bookie instances (not really part of the issue)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3121", "user": "pvanderlinden", "labels": ["component/deploy", "type/bug"], "created": "2018-12-04 15:19:29", "closed": "2020-06-09 01:34:46", "commits": {}, "ttf": 552.0002777777778, "commitsDetails": []}, {"title": "broker error for prometheus metrics", "body": "#### Expected behavior\r\nI deployed pulsar with helm and minikube configuration in kubernetes. I tried multiple times, I having problem with one of the brokers, sometimes both brokers.  The problem has been consistent for three deployments so far.\r\n\r\n#### Steps to reproduce\r\ndeploy pulsar with helm\r\n\r\n#### System configuration\r\n**Pulsar version**: x.y\r\nimage: apachepulsar/pulsar-all\r\n\r\n#### Error in Broker.log\r\n06:40:34.280 [pulsar-web-30-30] INFO  org.eclipse.jetty.server.RequestLog - 10.244.6.29 - - [03/Dec/2018:06:40:34 +0000] \"GET //xx.xx.xx.xx:8080/metrics HTTP/1.1\" 302 0 \"-\" \"Prometheus/1.6.3\" 1\r\n06:40:34.287 [prometheus-stats-31-1] ERROR org.apache.pulsar.broker.stats.prometheus.PrometheusMetricsServlet - Failed to generate prometheus stats\r\norg.eclipse.jetty.io.EofException: null\r\n        at org.eclipse.jetty.io.ChannelEndPoint.flush(ChannelEndPoint.java:197) ~[org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n        at org.eclipse.jetty.io.WriteFlusher.flush(WriteFlusher.java:420) ~[org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n        at org.eclipse.jetty.io.WriteFlusher.completeWrite(WriteFlusher.java:375) ~[org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n        at org.eclipse.jetty.io.SelectChannelEndPoint$3.run(SelectChannelEndPoint.java:107) ~[org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n        at org.eclipse.jetty.io.SelectChannelEndPoint.onSelected(SelectChannelEndPoint.java:193) ~[org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n        at org.eclipse.jetty.io.ManagedSelector$SelectorProducer.processSelected(ManagedSelector.java:283) ~[org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n        at org.eclipse.jetty.io.ManagedSelector$SelectorProducer.produce(ManagedSelector.java:181) ~[org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n        at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:249) ~[org.eclipse.jetty-jetty-util-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n        at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148) ~[org.eclipse.jetty-jetty-util-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n        at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136) ~[org.eclipse.jetty-jetty-util-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_171]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_171]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [org.apache.pulsar-pulsar-functions-metrics-2.2.0.jar:?]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_171]\r\nCaused by: java.io.IOException: Connection reset by peer\r\n        at sun.nio.ch.FileDispatcherImpl.write0(Native Method) ~[?:1.8.0_171]\r\n        at sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:47) ~[?:1.8.0_171]\r\n        at sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:93) ~[?:1.8.0_171]\r\n        at sun.nio.ch.IOUtil.write(IOUtil.java:65) ~[?:1.8.0_171]\r\n        at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:471) ~[?:1.8.0_171]\r\n        at org.eclipse.jetty.io.ChannelEndPoint.flush(ChannelEndPoint.java:175) ~[org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n        ... 13 more\r\n\r\n#### Error in Prometheus\r\ntext format parsing error in line 182: second TYPE line for metric name \"pulsar_subscription_back_log\", or TYPE reported after samples", "url": "https://github.com/apache/pulsar/issues/3112", "user": "yifan", "labels": ["component/deploy", "type/bug"], "created": "2018-12-03 14:46:18", "closed": "2020-06-09 01:49:22", "commits": {"8d32b588e2ccba31fbd41e7d508400de20a71405": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "d71ea8658be00c5dc053d7f5a6062c0c9e5c9c34": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 553.0002777777778, "commitsDetails": [{"commitHash": "8d32b588e2ccba31fbd41e7d508400de20a71405", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["bf9489093639facb8f86e37a87b47bb82bcde5ce"], "nameRev": "8d32b588e2ccba31fbd41e7d508400de20a71405 tags/v2.5.0-candidate-1~425", "commitMessage": "Adding back Prometheus TYPE definitions; fixed duplicate TYPE errors; fixed format issue in metricWithRemoteCluster; added test for Prometheus types (#4183)\n\nFixes #3112 \r\n\r\n### Motivation\r\n\r\nIn this pull request, I set out to fix #3112, which is caused by duplicate TYPE statements in the metrics output which leads to parsing of Prometheus metrics to fail in recent versions of Prometheus. Because of this, Prometheus will report the broker target as down.\r\n\r\nSince I started looking at this, the type definitions have been removed (#4136) from topics metric output. I think these types are useful in Prometheus and have added them back in. \r\n\r\nWhile testing this fix in my geo-replicated setup, I found a format in error (missing quote and comma) in the TopicStats.metricWithRemoteCluster method. This pull request includes a fix for that issue.\r\n\r\nI have also added a new test to PrometheusMetricsTest.java that fails without these changes but passed with them.\r\n\r\n### Modifications\r\n\r\nI added a static HashMap to TopicStats to keep track of the TYPEs that have been output. All writing of the TYPE for topics and namespaces is done with the TopicStats.metricType method. I modified that method to update the HashMap and only print the TYPE out for the first occurrence of the metric name.  I also added a method reset the HashMap, which gets called in NamespaceStatsAggregator.generate. \r\n\r\n### Verifying this change\r\n\r\nThis change added tests and can be verified as follows:\r\n  - Added testDuplicateMetricTypeDefinitions which checks for:\r\n       - duplicate TYPE definitions in the Prometheus output\r\n       - validates that no TYPE definition appears after the first metric sample\r\n       - ensures that all metrics have a defined type\r\n\r\nI execute the test twice to make sure the resetting of the HashMap of the already seen metric type definitions works correctly. This test passes for me reliably (both occurrences).\r\n\r\nI have confirmed using promtool that the metrics output will now parse without error using versions 2.7.1 and 2.9.2 (which is the latest). There are many warnings around missing HELP definitions and metrics using reserved suffixes (ex. _count), but no errors.\r\n\r\nIn addition, I have patched 2.3.1 with this fix and am currently running it in my cluster. Prometheus (2.7.1) successfully parses the metrics and I am able to see namespace and topic-level metrics.\r\n", "commitDateTime": "2019-08-26 14:36:01", "authoredDateTime": "2019-08-26 02:36:01", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/NamespaceStatsAggregator.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/TopicStats.java", "insertions": 23, "deletions": 0, "lines": 23}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/PrometheusMetricsTest.java", "insertions": 97, "deletions": 0, "lines": 97}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NamespaceStatsAggregator.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.generate(org.apache.pulsar.broker.PulsarService,boolean,boolean,org.apache.pulsar.common.util.SimpleTextOutputStream)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,double)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.metricWithRemoteCluster(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,double)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicStats.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.resetTypes()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metricType(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,double)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,long)", "TOT": 4, "UPD": 0, "INS": 1, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,double)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,long,java.lang.String,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,long,java.lang.String,double)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metricWithRemoteCluster(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,double)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PrometheusMetricsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.stats.PrometheusMetricsTest.parseMetrics(java.lang.String)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.PrometheusMetricsTest.testDuplicateMetricTypeDefinitions()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "d71ea8658be00c5dc053d7f5a6062c0c9e5c9c34", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["71362137e3eb4b7cac21f14ef1d9c3b51bf8e644"], "nameRev": "d71ea8658be00c5dc053d7f5a6062c0c9e5c9c34 tags/v2.4.1-candidate-1~4", "commitMessage": "Adding back Prometheus TYPE definitions; fixed duplicate TYPE errors; fixed format issue in metricWithRemoteCluster; added test for Prometheus types (#4183)\n\nFixes #3112\n\nIn this pull request, I set out to fix #3112, which is caused by duplicate TYPE statements in the metrics output which leads to parsing of Prometheus metrics to fail in recent versions of Prometheus. Because of this, Prometheus will report the broker target as down.\n\nSince I started looking at this, the type definitions have been removed (#4136) from topics metric output. I think these types are useful in Prometheus and have added them back in.\n\nWhile testing this fix in my geo-replicated setup, I found a format in error (missing quote and comma) in the TopicStats.metricWithRemoteCluster method. This pull request includes a fix for that issue.\n\nI have also added a new test to PrometheusMetricsTest.java that fails without these changes but passed with them.\n\nI added a static HashMap to TopicStats to keep track of the TYPEs that have been output. All writing of the TYPE for topics and namespaces is done with the TopicStats.metricType method. I modified that method to update the HashMap and only print the TYPE out for the first occurrence of the metric name.  I also added a method reset the HashMap, which gets called in NamespaceStatsAggregator.generate.\n\nThis change added tests and can be verified as follows:\n  - Added testDuplicateMetricTypeDefinitions which checks for:\n       - duplicate TYPE definitions in the Prometheus output\n       - validates that no TYPE definition appears after the first metric sample\n       - ensures that all metrics have a defined type\n\nI execute the test twice to make sure the resetting of the HashMap of the already seen metric type definitions works correctly. This test passes for me reliably (both occurrences).\n\nI have confirmed using promtool that the metrics output will now parse without error using versions 2.7.1 and 2.9.2 (which is the latest). There are many warnings around missing HELP definitions and metrics using reserved suffixes (ex. _count), but no errors.\n\nIn addition, I have patched 2.3.1 with this fix and am currently running it in my cluster. Prometheus (2.7.1) successfully parses the metrics and I am able to see namespace and topic-level metrics.\n\n(cherry picked from commit 8d32b588e2ccba31fbd41e7d508400de20a71405)\n", "commitDateTime": "2019-08-28 15:10:32", "authoredDateTime": "2019-08-26 02:36:01", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/NamespaceStatsAggregator.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/TopicStats.java", "insertions": 23, "deletions": 0, "lines": 23}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/PrometheusMetricsTest.java", "insertions": 98, "deletions": 0, "lines": 98}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Commands.java", "insertions": 2, "deletions": 0, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NamespaceStatsAggregator.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.generate(org.apache.pulsar.broker.PulsarService,boolean,boolean,org.apache.pulsar.common.util.SimpleTextOutputStream)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,double)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.NamespaceStatsAggregator.metricWithRemoteCluster(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,double)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicStats.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.resetTypes()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metricType(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,double)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,long)", "TOT": 4, "UPD": 0, "INS": 1, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,double)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,long,java.lang.String,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metric(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,long,java.lang.String,double)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.prometheus.TopicStats.metricWithRemoteCluster(org.apache.pulsar.common.util.SimpleTextOutputStream,java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,double)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PrometheusMetricsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.stats.PrometheusMetricsTest.parseMetrics(java.lang.String)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.stats.PrometheusMetricsTest.testDuplicateMetricTypeDefinitions()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Commands.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.protocol.Commands.newGetSchema(long,java.lang.String,java.util.Optional)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.protocol.Commands.newGetSchemaResponse(long,org.apache.pulsar.common.protocol.CommandGetSchemaResponse)", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Error go get pulsar: Unknown type  `pulsar_string_list_t` and `pulsarGetTopicPartitionsCallbackProxy`", "body": "#### Expected behavior\r\n\r\nSo I would like to use pulsar in go and I expect the package to be installed by `go get -u github.com/apache/pulsar/pulsar-client-go/pulsar\r\n`\r\n#### Actual behavior\r\n\r\nSo it seems there is some library version incompatibility. \r\n```\r\n# github.com/apache/pulsar/pulsar-client-go/pulsar\r\n/home/gao/.gvm/pkgsets/go1.9/global/src/github.com/apache/pulsar/pulsar-client-go/pulsar/c_client.go:135:8: could not determine kind of name for C.pulsar_authentication_token_create\r\n/home/gao/.gvm/pkgsets/go1.9/global/src/github.com/apache/pulsar/pulsar-client-go/pulsar/c_client.go:263:3: could not determine kind of name for C.pulsar_string_list_free\r\n/home/gao/.gvm/pkgsets/go1.9/global/src/github.com/apache/pulsar/pulsar-client-go/pulsar/c_client.go:260:31: could not determine kind of name for C.pulsar_string_list_get\r\n/home/gao/.gvm/pkgsets/go1.9/global/src/github.com/apache/pulsar/pulsar-client-go/pulsar/c_client.go:257:24: could not determine kind of name for C.pulsar_string_list_size\r\n/home/gao/.gvm/pkgsets/go1.9/global/src/github.com/apache/pulsar/pulsar-client-go/pulsar/c_client.go:251:78: could not determine kind of name for C.pulsar_string_list_t\r\n\r\ngcc errors for preamble:\r\nIn file included from /home/gao/.gvm/pkgsets/go1.9/global/src/github.com/apache/pulsar/pulsar-client-go/pulsar/c_client.go:24:\r\n./c_go_pulsar.h:139:66: error: unknown type name 'pulsar_string_list_t'; did you mean 'pulsar_string_map_t'?\r\n void pulsarGetTopicPartitionsCallbackProxy(pulsar_result result, pulsar_string_list_t* partitions, void *ctx);\r\n                                                                  ^~~~~~~~~~~~~~~~~~~~\r\n                                                                  pulsar_string_map_t\r\n./c_go_pulsar.h: In function '_pulsar_client_get_topic_partitions':\r\n./c_go_pulsar.h:143:61: error: 'pulsarGetTopicPartitionsCallbackProxy' undeclared (first use in this function); did you mean 'pulsarProducerSendCallbackProxy'?\r\n     pulsar_client_get_topic_partitions_async(client, topic, pulsarGetTopicPartitionsCallbackProxy, ctx);\r\n                                                             ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n                                                             pulsarProducerSendCallbackProxy\r\n./c_go_pulsar.h:143:61: note: each undeclared identifier is reported only once for each function it appears in\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\n- Download two packages `apache-pulsar-client-2.2.0-1.x86_64.rpm  apache-pulsar-client-devel-2.2.0-1.x86_64.rpm` from https://pulsar.apache.org/docs/en/client-libraries-cpp/\r\n- rpm -ivh apache-pulsar-client-*.rpm\r\n- go get -u github.com/apache/pulsar/pulsar-client-go/pulsar\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.22\r\n**go version**: 1.11, 1.10, 1.9\r\n**os**: opensuse tumbleweed", "url": "https://github.com/apache/pulsar/issues/3094", "user": "alapha23", "labels": ["component/build", "component/client", "component/go", "type/bug"], "created": "2018-11-29 13:48:39", "closed": "2018-12-13 04:22:57", "commits": {}, "ttf": 13.000277777777777, "commitsDetails": []}, {"title": "javadoc doesn't respect the docusaurus versioning", "body": "http://pulsar.apache.org/docs/en/client-libraries/ points to http://pulsar.apache.org/api/client\r\nhttp://pulsar.apache.org/docs/en/next/client-libraries/ points to http://pulsar.apache.org/api/client\r\n\r\nOf all the things that should be sensitive to version, javadoc is probably number 1.", "url": "https://github.com/apache/pulsar/issues/3087", "user": "ivankelly", "labels": ["component/documentation", "type/bug"], "created": "2018-11-28 22:55:29", "closed": "2020-05-29 01:12:58", "commits": {}, "ttf": 547.0002777777778, "commitsDetails": []}, {"title": "Behavior of redelivery and ackTimeout in Java client", "body": "#### Expected behavior\r\n\r\nWith the Java client, when `ackTimeout` is specified for a consumer, unacked individual messages should be resent only after `ackTimeout` has expired.\r\n\r\n#### Actual behavior\r\n\r\nUnacked messages are all resent at once every `ackTimeout` period.\r\n\r\n#### Steps to reproduce\r\n\r\nRun this program\r\n```java\r\npublic class UnackedTrackerIssue {\r\n    private static ExecutorService executor = Executors.newFixedThreadPool(10);\r\n\r\n    public static void main(String[] args) throws PulsarClientException, InterruptedException {\r\n\r\n        final String topic = \"my-topic\";\r\n\r\n        PulsarClient client = PulsarClient.builder()\r\n                .serviceUrl(\"pulsar://localhost:6650\")\r\n                .build();\r\n\r\n        Consumer<byte[]> consumer = client.newConsumer()\r\n                .topic(topic)\r\n                .subscriptionName(UUID.randomUUID().toString())\r\n                .ackTimeout(5, TimeUnit.SECONDS)\r\n                .subscribe();\r\n\r\n        receive(consumer);\r\n\r\n        Producer<byte[]> producer = client.newProducer()\r\n                .topic(topic)\r\n                .create();\r\n\r\n        for(int i=0;i<5; i++) {\r\n            Thread.sleep(1000);\r\n            producer.send((\"\" + i).getBytes());\r\n        }\r\n\r\n    }\r\n\r\n    private static void receive(Consumer<byte[]> consumer) {\r\n        consumer.receiveAsync()\r\n                .thenAccept(msg -> {\r\n                    System.out.println(\"\" + Instant.now() + \" consume \" + new String(msg.getData()));\r\n                    executor.execute(() -> receive(consumer));\r\n                });\r\n    }\r\n}\r\n```\r\nOutput is something like:\r\n\r\n2018-11-26T16:51:04.555Z consume 0\r\n2018-11-26T16:51:05.552Z consume 1\r\n2018-11-26T16:51:06.558Z consume 2\r\n**2018-11-26T16:51:07.565Z consume 3**\r\n2018-11-26T16:51:08.323Z consume 0\r\n2018-11-26T16:51:08.324Z consume 1\r\n2018-11-26T16:51:08.325Z consume 2\r\n**2018-11-26T16:51:08.329Z consume 3**\r\n2018-11-26T16:51:08.574Z consume 4\r\n2018-11-26T16:51:13.327Z consume 0\r\n2018-11-26T16:51:13.329Z consume 1\r\n2018-11-26T16:51:13.330Z consume 2\r\n**2018-11-26T16:51:13.330Z consume 3**\r\n2018-11-26T16:51:13.331Z consume 4\r\n\r\nThe delay of redelivery between the message \"3\" occurences should be about 5 seconds but the first time there's only 1s.\r\n\r\nCode that results in this behavior : https://github.com/apache/pulsar/blob/0ab2325fa33231f1c69782e081483012467dfcab/pulsar-client/src/main/java/org/apache/pulsar/client/impl/UnAckedMessageTracker.java#L87\r\n\r\n#### System configuration\r\n**Pulsar version**: master https://github.com/apache/pulsar/commit/fe2c8ee4d37e2a45dfb528592915746827416e18\r\n", "url": "https://github.com/apache/pulsar/issues/3059", "user": "cbornet", "labels": ["component/client", "type/bug"], "created": "2018-11-26 17:07:29", "closed": "2019-01-23 02:13:50", "commits": {}, "ttf": 57.000277777777775, "commitsDetails": []}, {"title": "Get stats on a exist topic but got topic not found error", "body": "#### Expected behavior\r\n\r\nGet a blank stats data rather than `Topic not found` error by `get partitioned stats` or `get stats` on a topic when topic have no stats data on broker.\r\n\r\n#### Actual behavior\r\n\r\nThe topic is already created but no message in or out will get a error of `Topic not found` by get stats rest api or admin cli.\r\n\r\n```\r\n--- An unexpected error occurred in the server ---\r\n\r\nMessage: Topic not found\r\n\r\nStacktrace:\r\n\r\norg.apache.pulsar.client.admin.PulsarAdminException$NotFoundException: Topic not found\r\n\tat org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:172)\r\n\tat org.apache.pulsar.client.admin.internal.TopicsImpl$9.failed(TopicsImpl.java:403)\r\n\tat org.glassfish.jersey.client.JerseyInvocation$7.failed(JerseyInvocation.java:965)\r\n\tat org.glassfish.jersey.client.JerseyInvocation$7.completed(JerseyInvocation.java:952)\r\n\tat org.glassfish.jersey.client.ClientRuntime.processResponse(ClientRuntime.java:196)\r\n\tat org.glassfish.jersey.client.ClientRuntime.access$300(ClientRuntime.java:74)\r\n\tat org.glassfish.jersey.client.ClientRuntime$2$1$1.run(ClientRuntime.java:166)\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:271)\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:267)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:315)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:297)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:267)\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:340)\r\n\tat org.glassfish.jersey.client.ClientRuntime$2$1.response(ClientRuntime.java:164)\r\n\tat org.glassfish.jersey.client.internal.HttpUrlConnector$3.run(HttpUrlConnector.java:297)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat jersey.repackaged.com.google.common.util.concurrent.MoreExecutors$DirectExecutorService.execute(MoreExecutors.java:299)\r\n\tat java.util.concurrent.AbstractExecutorService.submit(AbstractExecutorService.java:112)\r\n\tat jersey.repackaged.com.google.common.util.concurrent.AbstractListeningExecutorService.submit(AbstractListeningExecutorService.java:50)\r\n\tat jersey.repackaged.com.google.common.util.concurrent.AbstractListeningExecutorService.submit(AbstractListeningExecutorService.java:37)\r\n\tat org.glassfish.jersey.client.internal.HttpUrlConnector.apply(HttpUrlConnector.java:293)\r\n\tat org.glassfish.jersey.client.ClientRuntime$2.run(ClientRuntime.java:180)\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:271)\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:267)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:315)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:297)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:267)\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:340)\r\n\tat org.glassfish.jersey.client.ClientRuntime$3.run(ClientRuntime.java:208)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: javax.ws.rs.NotFoundException: HTTP 404 Not Found\r\n\tat org.glassfish.jersey.client.JerseyInvocation.convertToException(JerseyInvocation.java:1020)\r\n\tat org.glassfish.jersey.client.JerseyInvocation.access$900(JerseyInvocation.java:92)\r\n\t... 32 more\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\n1. Create a new topic\r\n2. $ ./pulsar-admin topics stats {topic_name}\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.1.0-incubating and 2.2.0\r\n\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/3042", "user": "codelipenghui", "labels": ["component/cli", "type/bug"], "created": "2018-11-22 07:01:45", "closed": "2018-12-07 04:13:30", "commits": {}, "ttf": 14.000277777777777, "commitsDetails": []}, {"title": "documentation request: document presto http endpoint", "body": "\r\nI asked on slack (cc @sijie) if it was possible to use the Java client to make SQL requests.\r\nApparently there are presto HTTP endpoints that would work as well, but they are not documented at the moment.\r\n\r\nThis is a request to document them.", "url": "https://github.com/apache/pulsar/issues/3009", "user": "nha", "labels": ["component/documentation", "triage/week-45", "type/bug"], "created": "2018-11-18 13:11:49", "closed": "2019-11-28 22:04:52", "commits": {"b23c732012f7ddce97422ad6651ae66bf16b0f0e": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 375.0002777777778, "commitsDetails": [{"commitHash": "b23c732012f7ddce97422ad6651ae66bf16b0f0e", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["da80606a62a225bad7862a73ba6ecac96b1c1360"], "nameRev": "b23c732012f7ddce97422ad6651ae66bf16b0f0e tags/v2.5.0-candidate-1~38", "commitMessage": "[Issue 3009][docs] Add presto sql REST APIs doc (#5376)\n\nFixes #3009\r\n\r\n*Motivation*\r\n\r\nThere are no REST APIs usage docs for the presto SQL.", "commitDateTime": "2019-11-28 14:04:51", "authoredDateTime": "2019-11-29 06:04:51", "commitGitStats": [{"filePath": "site2/docs/sql-rest-api.md", "insertions": 185, "deletions": 0, "lines": 185}, {"filePath": "site2/website/sidebars.json", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[io] \"User class must be in class path\" in pulsar io localrun", "body": "#### Expected behavior\r\n\r\nlocalrun should pass with `file://` package url.\r\n\r\n```\r\n/data/pulsar/pulsar/bin/pulsar-admin source localrun --archive file:///data/pulsar/pulsar/pulsar-io/canal/target/pulsar-io-canal-2.3.0-SNAPSHOT.nar --classname org.apache.pulsar.io.canal.CanalSource --tenant public --namespace default --name canal2 --destination-topic-name my-topic --source-config-file /data/pulsar/canal-mysql-source-config.yaml --parallelism 1\r\n```\r\n\r\n#### Actual behavior\r\n\r\nIt fails with following error:\r\n\r\n```\r\njava.lang.RuntimeException: User class must be in class path\r\n       at org.apache.pulsar.functions.utils.Reflections.createInstance(Reflections.java:108) ~[java-instance.jar:2.3.0-SNAPSHOT]\r\n       at org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupInput(JavaInstanceRunnable.java:584) ~[java-instance.jar:2.3.0-SNAPSHOT]\r\n       at org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupJavaInstance(JavaInstanceRunnable.java:180) ~[java-instance.jar:2.3.0-SNAPSHOT]\r\n       at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:206) [java-instance.jar:2.3.0-SNAPSHOT]\r\n       at java.lang.Thread.run(Thread.java:748) [?:1.8.0_191]\r\nCaused by: java.lang.ClassNotFoundException: org.apache.pulsar.io.canal.CanalSource\r\n       at java.net.URLClassLoader.findClass(URLClassLoader.java:382) ~[?:1.8.0_191]\r\n       at java.lang.ClassLoader.loadClass(ClassLoader.java:424) ~[?:1.8.0_191]\r\n       at java.lang.ClassLoader.loadClass(ClassLoader.java:357) ~[?:1.8.0_191]\r\n       at java.lang.Class.forName0(Native Method) ~[?:1.8.0_191]\r\n       at java.lang.Class.forName(Class.java:348) ~[?:1.8.0_191]\r\n       at org.apache.pulsar.functions.utils.Reflections.createInstance(Reflections.java:106) ~[java-instance.jar:2.3.0-SNAPSHOT]\r\n       ... 4 more\r\n```\r\n\r\n#### Get-around Fixes\r\n\r\nremove `file://` from `--archive` argument and remove `--classname`.\r\n\r\nso there seems to be a problem when these two parameters are used together.\r\n", "url": "https://github.com/apache/pulsar/issues/2996", "user": "sijie", "labels": ["component/io", "type/bug"], "created": "2018-11-16 09:57:16", "closed": "2019-04-22 04:23:28", "commits": {}, "ttf": 156.00027777777777, "commitsDetails": []}, {"title": "Intermittent test failure in TestS3Offload", "body": "```\r\nError Message\r\narrays differ firstly at element [15]; expected value is <48> but was <49>. \r\nStacktrace\r\njava.lang.AssertionError: arrays differ firstly at element [15]; expected value is <48> but was <49>. \r\n\tat org.testng.Assert.fail(Assert.java:96)\r\n\tat org.testng.Assert.assertEquals(Assert.java:195)\r\n\tat org.testng.Assert.assertEquals(Assert.java:179)\r\n\tat org.apache.pulsar.tests.integration.offload.TestS3Offload.testPublishOffloadAndConsumeViaThreshold(TestS3Offload.java:212)\r\n```\r\n\r\nFull error logs at https://gist.github.com/merlimat/cf7823d2a5fafae7661772f91e1710a7", "url": "https://github.com/apache/pulsar/issues/2942", "user": "merlimat", "labels": ["component/test", "type/bug"], "created": "2018-11-06 07:28:59", "closed": "2018-12-12 21:57:32", "commits": {}, "ttf": 36.000277777777775, "commitsDetails": []}, {"title": "NullPointerException On Send Message", "body": "Instance already run more than 1 month, but today we got some error log:\r\n```java\r\norg.apache.pulsar.client.api.PulsarClientException: java.lang.NullPointerException\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.sendAsync(ProducerImpl.java:388)\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.internalSendAsync(ProducerImpl.java:210)\r\n\tat org.apache.pulsar.client.impl.PartitionedProducerImpl.internalSendAsync(PartitionedProducerImpl.java:167)\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:78)\r\n\tat org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:54)\r\n\tat org.apache.pulsar.client.impl.ProducerBase.send(ProducerBase.java:50)\r\n\tat com.zhaopin.event.impl.EventImpl.pub(EventImpl.java:83)\r\n\tat sun.reflect.GeneratedMethodAccessor70.invoke(Unknown Source)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat com.zhaopin.thrift.rpc.executor.DefaultThriftExecutor.doExecute(DefaultThriftExecutor.java:133)\r\n\tat com.zhaopin.thrift.rpc.executor.DefaultThriftExecutor$1.run(DefaultThriftExecutor.java:68)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\nCaused by: java.lang.NullPointerException\r\n```\r\nWhen restart the instance, no error log print anymore.\r\nClient Version: 2.1.0-incubating\r\n", "url": "https://github.com/apache/pulsar/issues/2929", "user": "codelipenghui", "labels": ["type/bug"], "created": "2018-11-05 07:10:33", "closed": "2019-01-28 21:23:46", "commits": {}, "ttf": 84.00027777777778, "commitsDetails": []}, {"title": "NoClassDefFoundError error happens when running custom source connector on cluster", "body": "Run a custom source connector with dependency to eclipse paho is successful on localrun mode, but got java.lang.NoClassDefFoundError on cluster mode.\r\n\r\n#### Expected behavior\r\nRun the custom source connector successfully on cluster mode.\r\n\r\n#### Actual behavior\r\nGet below error in the function's log\r\n```\r\n03:02:49,717 INFO [public/default/emxq_source_rule1] [instance-0] JavaInstanceRunnable - Starting Java Instance emxq_source_rule1\r\n03:02:49,726 INFO [public/default/emxq_source_rule1] [instance-0] JavaInstanceRunnable - Loading JAR files for function InstanceConfig(instanceId=0, functionId=d6925a98-b890-44ed-90df-29f9e0f7ea4c, functionVersion=0d3e23d5-5172-4003-a068-30d4eca6a72d, functionDetails=tenant: \"public\"\r\nnamespace: \"default\"\r\nname: \"emxq_source_rule1\"\r\nclassName: \"org.apache.pulsar.functions.api.utils.IdentityFunction\"\r\nautoAck: true\r\nsource {\r\n  className: \"com.emqx.pulsar.io.EMQXSource\"\r\n  configs: \"{\\\"inputTopics\\\":\\\"sample/abc\\\"}\"\r\n  typeClassName: \"[B\"\r\n}\r\nsink {\r\n  topic: \"rule_topic_rule1\"\r\n  typeClassName: \"[B\"\r\n}\r\n, maxBufferedTuples=1024, port=7394) from archive /tmp/pulsar_functions/public/default/emxq_source_rule1/0/utils.jar\r\n03:02:49,742 INFO [public/default/emxq_source_rule1] [instance-0] JavaInstanceRunnable - Initialize function class loader for function emxq_source_rule1 at function cache manager\r\n03:02:50,202 INFO [public/default/emxq_source_rule1] [instance-0] JavaInstanceRunnable - Starting state table for function emxq_source_rule1\r\n03:02:50,783 ERROR [public/default/emxq_source_rule1] [instance-0] JavaInstanceRunnable - [public-emxq_source_rule1] Uncaught exception in Java Instance\r\njava.lang.NoClassDefFoundError: org/eclipse/paho/client/mqttv3/MqttCallback\r\n\tat java.lang.ClassLoader.defineClass1(Native Method) ~[?:1.8.0_181]\r\n\tat java.lang.ClassLoader.defineClass(ClassLoader.java:763) ~[?:1.8.0_181]\r\n\tat java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142) ~[?:1.8.0_181]\r\n\tat java.net.URLClassLoader.defineClass(URLClassLoader.java:467) ~[?:1.8.0_181]\r\n\tat java.net.URLClassLoader.access$100(URLClassLoader.java:73) ~[?:1.8.0_181]\r\n\tat java.net.URLClassLoader$1.run(URLClassLoader.java:368) ~[?:1.8.0_181]\r\n\tat java.net.URLClassLoader$1.run(URLClassLoader.java:362) ~[?:1.8.0_181]\r\n\tat java.security.AccessController.doPrivileged(Native Method) ~[?:1.8.0_181]\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:361) ~[?:1.8.0_181]\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424) ~[?:1.8.0_181]\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357) ~[?:1.8.0_181]\r\n\tat java.lang.Class.forName0(Native Method) ~[?:1.8.0_181]\r\n\tat java.lang.Class.forName(Class.java:348) ~[?:1.8.0_181]\r\n\tat org.apache.pulsar.functions.utils.Reflections.createInstance(Reflections.java:108) ~[java-instance.jar:2.1.1-incubating]\r\n\tat org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupInput(JavaInstanceRunnable.java:534) ~[java-instance.jar:2.1.1-incubating]\r\n\tat org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupJavaInstance(JavaInstanceRunnable.java:161) ~[java-instance.jar:2.1.1-incubating]\r\n\tat org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:188) [java-instance.jar:2.1.1-incubating]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\nCaused by: java.lang.ClassNotFoundException: org.eclipse.paho.client.mqttv3.MqttCallback\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:381) ~[?:1.8.0_181]\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424) ~[?:1.8.0_181]\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357) ~[?:1.8.0_181]\r\n\t... 18 more\r\n03:02:50,788 INFO [public/default/emxq_source_rule1] [instance-0] JavaInstanceRunnable - Closing instance\r\n```\r\n#### Steps to reproduce\r\n[emqx-source-0.0.2-SNAPSHOT.nar.zip](https://github.com/apache/pulsar/files/2537123/emqx-source-0.0.2-SNAPSHOT.nar.zip)\r\n1. Start pulsar standalone\r\n2. Unzip the attached source connector. Submit it via Admin CLI, e.g.:\r\nsudo ./pulsar-admin source create --className com.emqx.pulsar.io.EMQXSource --archive /pathToNar/emqx-source-0.0.2-SNAPSHOT.jar --tenant public --namespace default --name mqtt_source --destinationTopicName mqtt_message --sourceConfig '{\"inputTopics\":\"sample/abc\"}\r\nConsole shows \"Created successfully\"\r\n3. Open the log for public/default/mqtt_source, NoClassDefFoundError can be found.\r\n\r\nNotice that, the source connector can run in localrun mode successfully.\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.1.1-incubating\r\n", "url": "https://github.com/apache/pulsar/issues/2900", "user": "ngjaying", "labels": ["component/io", "type/bug"], "created": "2018-11-01 03:44:05", "closed": "2018-11-26 07:30:35", "commits": {}, "ttf": 25.00027777777778, "commitsDetails": []}, {"title": "pulsar-perf parameter lack description", "body": "i am using pulsar-perf to do the performance testing. when i use pulsar-perf produce/consume, it doesn't tell me which parameter is required. And i searched the [document](http://pulsar.apache.org/docs/en/reference-cli-tools.html#pulsar-perf) , it doesn't give me much information. Suggest add \"required\" flag. \r\n\r\nAnd also  pulsar-perf produce/consume have the same description in the  [document](http://pulsar.apache.org/docs/en/reference-cli-tools.html#pulsar-perf). Is it a mistake?", "url": "https://github.com/apache/pulsar/issues/2895", "user": "dreamcatchernick", "labels": ["component/documentation", "component/website", "help wanted", "type/bug"], "created": "2018-10-31 10:26:03", "closed": "2019-04-09 15:48:46", "commits": {"39e0f32b19f2882ea97fc5982252605de6772d1d": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 160.00027777777777, "commitsDetails": [{"commitHash": "39e0f32b19f2882ea97fc5982252605de6772d1d", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["32e7f337a6c0a889ace58890996d53179123d813"], "nameRev": "39e0f32b19f2882ea97fc5982252605de6772d1d tags/v2.3.0-candidate-1~110", "commitMessage": "Update command usage for pulsar-perf cli command (#2895) (#3452)\n\n", "commitDateTime": "2019-01-27 18:38:13", "authoredDateTime": "2019-01-27 18:38:13", "commitGitStats": [{"filePath": "site/_data/cli/pulsar-perf.yaml", "insertions": 12, "deletions": 0, "lines": 12}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Unauthorised when deleting namespace with superuser role", "body": "#### Expected behavior\r\n\r\nAll the following admin is done using a superuser role towards a pulsar broker over the REST API.\r\n\r\n* create tenant - OK\r\n* create namespace - OK\r\n* Set permission with role testrole on a topic in that namespace - OK\r\n* produce messages on that topic using testrole - OK\r\n* delete topic using force - OK\r\n* delete namespace - should be OK\r\n\r\n#### Actual behavior\r\n\r\nThe step delete namespace return unauthorised, note that I'm using the same superuser role that worked for the other operations. \r\n\r\n#### Steps to reproduce\r\n\r\nDo as above\r\n\r\n#### System configuration\r\npulsar-2.2.0 (same error in 2.1.0-incubating). Broker run in standalone with authorization and authentication on. Using client certificates for authentication.\r\n\r\n#### Log\r\n\r\n    10:27:01.014 [pulsar-web-53-10] WARN  org.apache.pulsar.broker.admin.impl.TenantsBase - [superUser] Failed to create already existing tenant tt5\r\n    10:27:01.018 [pulsar-web-53-10] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"PUT https://localhost:8081/admin/v2/tenants/tt5 HTTP/1.1\" 409 34 \"-\" \"Python/3.7 aiohttp/3.4.2\" 11\r\n    10:27:01.031 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741747 xid:547 sent:765 recv:908 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5\r\n    10:27:01.036 [pulsar-web-53-1] INFO  org.apache.pulsar.broker.admin.impl.TenantsBase - [superUser] updated tenant tt5\r\n    10:27:01.041 [pulsar-web-53-1] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"POST https://localhost:8081/admin/v2/tenants/tt5 HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 18\r\n    10:27:01.111 [pulsar-web-53-19] INFO  org.apache.pulsar.broker.web.PulsarWebResource - Successfully validated clusters on tenant [tt5]\r\n    10:27:01.122 [ProcessThread(sid:0 cport:2181):] INFO  org.apache.zookeeper.server.PrepRequestProcessor - Got user-level KeeperException when processing sessionid:0x1001f01ffe0000a type:create cxid:0x225 zxid:0xb5174 txntype:-1 reqpath:n/a Error Path:/admin/policies/tt5/testns1 Error:KeeperErrorCode = NodeExists for /admin/policies/tt5/testns1\r\n    10:27:01.125 [pulsar-web-53-19] WARN  org.apache.pulsar.broker.admin.impl.NamespacesBase - [superUser] Failed to create namespace tt5/testns1 - already exists\r\n    10:27:01.138 [pulsar-web-53-19] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"PUT https://localhost:8081/admin/v2/namespaces/tt5/testns1 HTTP/1.1\" 409 37 \"-\" \"Python/3.7 aiohttp/3.4.2\" 53\r\n    10:27:01.153 [pulsar-web-53-30] INFO  org.apache.pulsar.broker.web.PulsarWebResource - Successfully validated clusters on tenant [tt5]\r\n    10:27:01.165 [pulsar-web-53-30] INFO  org.apache.pulsar.broker.admin.impl.NamespacesBase - [superUser] Successfully updated the replication clusters on namespace tt5/testns1\r\n    10:27:01.165 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741749 xid:552 sent:770 recv:914 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5/testns1\r\n    10:27:01.167 [pulsar-web-53-30] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"POST https://localhost:8081/admin/v2/namespaces/tt5/testns1/replication HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 18\r\n    10:27:01.177 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.broker.service.BrokerService - /admin/policies/tt5/testns1 updating with Policies{auth_policies=org.apache.pulsar.common.policies.data.AuthPolicies@43769a87, replication_clusters=[standalone], bundles=BundlesData{numBundles=4, boundaries=[0x00000000, 0x40000000, 0x80000000, 0xc0000000, 0xffffffff]}, backlog_quota_map={}, persistence=null, deduplicationEnabled=null, clusterDispatchRate={}, latency_stats_sample_rate={}, antiAffinityGroup=null, message_ttl_in_seconds=600, retention_policies=RetentionPolicies{retentionTimeInMinutes=10, retentionSizeInMB=0}, deleted=true, encryption_required=false, subscription_auth_mode=None, max_producers_per_topic=0, max_consumers_per_topic=0, max_consumers_per_subscription=0, compaction_threshold=0, offload_threshold=-1, offload_deletion_lag_ms=null}\r\n    10:27:01.181 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741750 xid:555 sent:773 recv:918 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5/testns1\r\n    10:27:01.181 [pulsar-web-53-23] INFO  org.apache.pulsar.broker.authorization.PulsarAuthorizationProvider - [vworker] Successfully granted access for role vworker: [produce, consume] - namespace tt5/testns1\r\n    10:27:01.184 [pulsar-web-53-23] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"POST https://localhost:8081/admin/v2/namespaces/tt5/testns1/permissions/vworker HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 13\r\n    10:27:01.191 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.broker.service.BrokerService - /admin/policies/tt5/testns1 updating with Policies{auth_policies=org.apache.pulsar.common.policies.data.AuthPolicies@64800b7, replication_clusters=[standalone], bundles=BundlesData{numBundles=4, boundaries=[0x00000000, 0x40000000, 0x80000000, 0xc0000000, 0xffffffff]}, backlog_quota_map={}, persistence=null, deduplicationEnabled=null, clusterDispatchRate={}, latency_stats_sample_rate={}, antiAffinityGroup=null, message_ttl_in_seconds=600, retention_policies=RetentionPolicies{retentionTimeInMinutes=10, retentionSizeInMB=0}, deleted=true, encryption_required=false, subscription_auth_mode=None, max_producers_per_topic=0, max_consumers_per_topic=0, max_consumers_per_subscription=0, compaction_threshold=0, offload_threshold=-1, offload_deletion_lag_ms=null}\r\n    10:27:01.245 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741751 xid:558 sent:776 recv:922 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5/testns1\r\n    10:27:01.252 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.broker.service.BrokerService - /admin/policies/tt5/testns1 updating with Policies{auth_policies=org.apache.pulsar.common.policies.data.AuthPolicies@1f388fa7, replication_clusters=[standalone], bundles=BundlesData{numBundles=4, boundaries=[0x00000000, 0x40000000, 0x80000000, 0xc0000000, 0xffffffff]}, backlog_quota_map={}, persistence=null, deduplicationEnabled=null, clusterDispatchRate={}, latency_stats_sample_rate={}, antiAffinityGroup=null, message_ttl_in_seconds=600, retention_policies=RetentionPolicies{retentionTimeInMinutes=10, retentionSizeInMB=0}, deleted=true, encryption_required=false, subscription_auth_mode=None, max_producers_per_topic=0, max_consumers_per_topic=0, max_consumers_per_subscription=0, compaction_threshold=0, offload_threshold=-1, offload_deletion_lag_ms=null}\r\n    10:27:01.254 [pulsar-web-53-13] INFO  org.apache.pulsar.broker.admin.impl.PersistentTopicsBase - [superUser] Successfully granted access for role testrole: [produce, consume] - topic persistent://tt5/testns1/t1\\data\r\n    10:27:01.258 [pulsar-web-53-13] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"POST https://localhost:8081/admin/v2/persistent/tt5/testns1/t1%5Cdata/permissions/testrole HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 20\r\n    10:27:01.273 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741752 xid:561 sent:779 recv:926 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5/testns1\r\n    10:27:01.275 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.broker.service.BrokerService - /admin/policies/tt5/testns1 updating with Policies{auth_policies=org.apache.pulsar.common.policies.data.AuthPolicies@75e3dffb, replication_clusters=[standalone], bundles=BundlesData{numBundles=4, boundaries=[0x00000000, 0x40000000, 0x80000000, 0xc0000000, 0xffffffff]}, backlog_quota_map={}, persistence=null, deduplicationEnabled=null, clusterDispatchRate={}, latency_stats_sample_rate={}, antiAffinityGroup=null, message_ttl_in_seconds=600, retention_policies=RetentionPolicies{retentionTimeInMinutes=10, retentionSizeInMB=0}, deleted=true, encryption_required=false, subscription_auth_mode=None, max_producers_per_topic=0, max_consumers_per_topic=0, max_consumers_per_subscription=0, compaction_threshold=0, offload_threshold=-1, offload_deletion_lag_ms=null}\r\n    10:27:01.276 [pulsar-web-53-13] INFO  org.apache.pulsar.broker.admin.impl.PersistentTopicsBase - [superUser] Successfully granted access for role testrole: [produce, consume] - topic persistent://tt5/testns1/t1\\meta\r\n    10:27:01.278 [pulsar-web-53-13] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"POST https://localhost:8081/admin/v2/persistent/tt5/testns1/t1%5Cmeta/permissions/testrole HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 16\r\n    10:27:01.373 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741753 xid:564 sent:782 recv:930 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5/testns1\r\n    10:27:01.379 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.broker.service.BrokerService - /admin/policies/tt5/testns1 updating with Policies{auth_policies=org.apache.pulsar.common.policies.data.AuthPolicies@236c162, replication_clusters=[standalone], bundles=BundlesData{numBundles=4, boundaries=[0x00000000, 0x40000000, 0x80000000, 0xc0000000, 0xffffffff]}, backlog_quota_map={}, persistence=null, deduplicationEnabled=null, clusterDispatchRate={}, latency_stats_sample_rate={}, antiAffinityGroup=null, message_ttl_in_seconds=600, retention_policies=RetentionPolicies{retentionTimeInMinutes=10, retentionSizeInMB=0}, deleted=true, encryption_required=false, subscription_auth_mode=None, max_producers_per_topic=0, max_consumers_per_topic=0, max_consumers_per_subscription=0, compaction_threshold=0, offload_threshold=-1, offload_deletion_lag_ms=null}\r\n    10:27:01.383 [pulsar-web-53-3] INFO  org.apache.pulsar.broker.admin.impl.PersistentTopicsBase - [superUser] Successfully granted access for role testrole: [produce, consume] - topic persistent://tt5/testns1/t1\\data\r\n    10:27:01.389 [pulsar-web-53-3] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"POST https://localhost:8081/admin/v2/persistent/tt5/testns1/t1%5Cdata/permissions/testrole HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 28\r\n    10:27:01.408 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741754 xid:567 sent:785 recv:934 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5/testns1\r\n    10:27:01.414 [pulsar-web-53-3] INFO  org.apache.pulsar.broker.admin.impl.PersistentTopicsBase - [superUser] Successfully granted access for role testrole: [produce, consume] - topic persistent://tt5/testns1/t1\\meta\r\n    10:27:01.419 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.broker.service.BrokerService - /admin/policies/tt5/testns1 updating with Policies{auth_policies=org.apache.pulsar.common.policies.data.AuthPolicies@443d242b, replication_clusters=[standalone], bundles=BundlesData{numBundles=4, boundaries=[0x00000000, 0x40000000, 0x80000000, 0xc0000000, 0xffffffff]}, backlog_quota_map={}, persistence=null, deduplicationEnabled=null, clusterDispatchRate={}, latency_stats_sample_rate={}, antiAffinityGroup=null, message_ttl_in_seconds=600, retention_policies=RetentionPolicies{retentionTimeInMinutes=10, retentionSizeInMB=0}, deleted=true, encryption_required=false, subscription_auth_mode=None, max_producers_per_topic=0, max_consumers_per_topic=0, max_consumers_per_subscription=0, compaction_threshold=0, offload_threshold=-1, offload_deletion_lag_ms=null}\r\n    10:27:01.423 [pulsar-web-53-3] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"POST https://localhost:8081/admin/v2/persistent/tt5/testns1/t1%5Cmeta/permissions/testrole HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 28\r\n    10:27:01.510 [ProcessThread(sid:0 cport:2181):] INFO  org.apache.zookeeper.server.PrepRequestProcessor - Got user-level KeeperException when processing sessionid:0x1001f01ffe0000a type:create cxid:0x238 zxid:0xb517b txntype:-1 reqpath:n/a Error Path:/admin/policies/tt5 Error:KeeperErrorCode = NodeExists for /admin/policies/tt5\r\n    10:27:01.513 [pulsar-web-53-11] WARN  org.apache.pulsar.broker.admin.impl.TenantsBase - [superUser] Failed to create already existing tenant tt5\r\n    10:27:01.520 [pulsar-web-53-11] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"PUT https://localhost:8081/admin/v2/tenants/tt5 HTTP/1.1\" 409 34 \"-\" \"Python/3.7 aiohttp/3.4.2\" 16\r\n    10:27:01.533 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741756 xid:571 sent:789 recv:939 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5\r\n    10:27:01.535 [pulsar-web-53-11] INFO  org.apache.pulsar.broker.admin.impl.TenantsBase - [superUser] updated tenant tt5\r\n    10:27:01.538 [pulsar-web-53-11] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"POST https://localhost:8081/admin/v2/tenants/tt5 HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 14\r\n    10:27:01.586 [pulsar-web-53-10] INFO  org.apache.pulsar.broker.web.PulsarWebResource - Successfully validated clusters on tenant [tt5]\r\n    10:27:01.589 [ProcessThread(sid:0 cport:2181):] INFO  org.apache.zookeeper.server.PrepRequestProcessor - Got user-level KeeperException when processing sessionid:0x1001f01ffe0000a type:create cxid:0x23d zxid:0xb517d txntype:-1 reqpath:n/a Error Path:/admin/policies/tt5/testns1 Error:KeeperErrorCode = NodeExists for /admin/policies/tt5/testns1\r\n    10:27:01.591 [pulsar-web-53-10] WARN  org.apache.pulsar.broker.admin.impl.NamespacesBase - [superUser] Failed to create namespace tt5/testns1 - already exists\r\n    10:27:01.593 [pulsar-web-53-10] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"PUT https://localhost:8081/admin/v2/namespaces/tt5/testns1 HTTP/1.1\" 409 37 \"-\" \"Python/3.7 aiohttp/3.4.2\" 14\r\n    10:27:01.607 [pulsar-web-53-22] INFO  org.apache.pulsar.broker.web.PulsarWebResource - Successfully validated clusters on tenant [tt5]\r\n    10:27:01.611 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741757 xid:576 sent:794 recv:945 queuedpkts:0 pendingresp:1 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5/testns1\r\n    10:27:01.613 [pulsar-web-53-22] INFO  org.apache.pulsar.broker.admin.impl.NamespacesBase - [superUser] Successfully updated the replication clusters on namespace tt5/testns1\r\n    10:27:01.614 [pulsar-web-53-22] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"POST https://localhost:8081/admin/v2/namespaces/tt5/testns1/replication HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 18\r\n    10:27:01.615 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.broker.service.BrokerService - /admin/policies/tt5/testns1 updating with Policies{auth_policies=org.apache.pulsar.common.policies.data.AuthPolicies@1f23cebc, replication_clusters=[standalone], bundles=BundlesData{numBundles=4, boundaries=[0x00000000, 0x40000000, 0x80000000, 0xc0000000, 0xffffffff]}, backlog_quota_map={}, persistence=null, deduplicationEnabled=null, clusterDispatchRate={}, latency_stats_sample_rate={}, antiAffinityGroup=null, message_ttl_in_seconds=600, retention_policies=RetentionPolicies{retentionTimeInMinutes=10, retentionSizeInMB=0}, deleted=true, encryption_required=false, subscription_auth_mode=None, max_producers_per_topic=0, max_consumers_per_topic=0, max_consumers_per_subscription=0, compaction_threshold=0, offload_threshold=-1, offload_deletion_lag_ms=null}\r\n    10:27:01.624 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741758 xid:579 sent:797 recv:949 queuedpkts:0 pendingresp:1 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5/testns1\r\n    10:27:01.627 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.broker.service.BrokerService - /admin/policies/tt5/testns1 updating with Policies{auth_policies=org.apache.pulsar.common.policies.data.AuthPolicies@74d4c6a4, replication_clusters=[standalone], bundles=BundlesData{numBundles=4, boundaries=[0x00000000, 0x40000000, 0x80000000, 0xc0000000, 0xffffffff]}, backlog_quota_map={}, persistence=null, deduplicationEnabled=null, clusterDispatchRate={}, latency_stats_sample_rate={}, antiAffinityGroup=null, message_ttl_in_seconds=600, retention_policies=RetentionPolicies{retentionTimeInMinutes=10, retentionSizeInMB=0}, deleted=true, encryption_required=false, subscription_auth_mode=None, max_producers_per_topic=0, max_consumers_per_topic=0, max_consumers_per_subscription=0, compaction_threshold=0, offload_threshold=-1, offload_deletion_lag_ms=null}\r\n    10:27:01.627 [pulsar-web-53-1] INFO  org.apache.pulsar.broker.authorization.PulsarAuthorizationProvider - [vworker] Successfully granted access for role vworker: [produce, consume] - namespace tt5/testns1\r\n    10:27:01.631 [pulsar-web-53-1] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"POST https://localhost:8081/admin/v2/namespaces/tt5/testns1/permissions/vworker HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 14\r\n    10:27:01.675 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741760 xid:582 sent:800 recv:953 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5/testns1\r\n    10:27:01.680 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.broker.service.BrokerService - /admin/policies/tt5/testns1 updating with Policies{auth_policies=org.apache.pulsar.common.policies.data.AuthPolicies@40dd248d, replication_clusters=[standalone], bundles=BundlesData{numBundles=4, boundaries=[0x00000000, 0x40000000, 0x80000000, 0xc0000000, 0xffffffff]}, backlog_quota_map={}, persistence=null, deduplicationEnabled=null, clusterDispatchRate={}, latency_stats_sample_rate={}, antiAffinityGroup=null, message_ttl_in_seconds=600, retention_policies=RetentionPolicies{retentionTimeInMinutes=10, retentionSizeInMB=0}, deleted=true, encryption_required=false, subscription_auth_mode=None, max_producers_per_topic=0, max_consumers_per_topic=0, max_consumers_per_subscription=0, compaction_threshold=0, offload_threshold=-1, offload_deletion_lag_ms=null}\r\n    10:27:01.683 [pulsar-web-53-31] INFO  org.apache.pulsar.broker.admin.impl.NamespacesBase - [superUser] Successfully updated retention configuration: namespace=tt5/testns1, map={\"retentionTimeInMinutes\":10,\"retentionSizeInMB\":0}\r\n    10:27:01.686 [pulsar-web-53-31] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"POST https://localhost:8081/admin/v2/namespaces/tt5/testns1/retention HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 18\r\n    10:27:01.729 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741761 xid:585 sent:803 recv:957 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5/testns1\r\n    10:27:01.737 [pulsar-web-53-25] INFO  org.apache.pulsar.broker.admin.impl.NamespacesBase - [superUser] Successfully updated the message TTL on namespace tt5/testns1\r\n    10:27:01.737 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.broker.service.BrokerService - /admin/policies/tt5/testns1 updating with Policies{auth_policies=org.apache.pulsar.common.policies.data.AuthPolicies@6dec4cc1, replication_clusters=[standalone], bundles=BundlesData{numBundles=4, boundaries=[0x00000000, 0x40000000, 0x80000000, 0xc0000000, 0xffffffff]}, backlog_quota_map={}, persistence=null, deduplicationEnabled=null, clusterDispatchRate={}, latency_stats_sample_rate={}, antiAffinityGroup=null, message_ttl_in_seconds=600, retention_policies=RetentionPolicies{retentionTimeInMinutes=10, retentionSizeInMB=0}, deleted=true, encryption_required=false, subscription_auth_mode=None, max_producers_per_topic=0, max_consumers_per_topic=0, max_consumers_per_subscription=0, compaction_threshold=0, offload_threshold=-1, offload_deletion_lag_ms=null}\r\n    10:27:01.759 [pulsar-web-53-25] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:01 +0000] \"POST https://localhost:8081/admin/v2/namespaces/tt5/testns1/messageTTL HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 29\r\n    10:27:01.769 [pulsar-io-46-4] INFO  org.apache.pulsar.broker.service.ServerCnx - New connection from /172.17.0.1:39786\r\n    10:27:01.792 [pulsar-io-46-4] INFO  org.apache.pulsar.broker.service.ServerCnx - [/172.17.0.1:39786] Client successfully authenticated with tls role superUser and originalPrincipal null\r\n    10:27:01.843 [pulsar-io-46-1] INFO  org.apache.pulsar.broker.service.ServerCnx - New connection from /172.17.0.1:39788\r\n    10:27:01.865 [pulsar-io-46-1] INFO  org.apache.pulsar.broker.service.ServerCnx - [/172.17.0.1:39788] Client successfully authenticated with tls role superUser and originalPrincipal null\r\n    10:27:01.873 [pulsar-io-46-1] INFO  org.apache.pulsar.broker.service.ServerCnx - [/172.17.0.1:39788][persistent://tt5/testns1/t1\\data] Creating producer. producerId=0\r\n    10:27:01.875 [pulsar-ordered-OrderedExecutor-7-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - Opening managed ledger tt5/testns1/persistent/t1%5Cdata\r\n    10:27:01.877 [bookkeeper-ml-workers-OrderedExecutor-1-0] INFO  org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper - Creating '/managed-ledgers/tt5/testns1/persistent/t1%5Cdata'\r\n    10:27:01.879 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperChildrenCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe00009 local:/127.0.0.1:42438 remoteserver:localhost/127.0.0.1:2181 lastZxid:741762 xid:1381 sent:1381 recv:1400 queuedpkts:0 pendingresp:0 queuedevents:1] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/managed-ledgers/tt5/testns1/persistent\r\n    10:27:01.885 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.zookeeper.ZooKeeperChildrenCache - reloadCache called in zookeeperChildrenCache for path /managed-ledgers/tt5/testns1/persistent\r\n    10:27:01.888 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.bookkeeper.client.LedgerCreateOp - Ensemble: [127.0.0.1:3181] for ledger: 65\r\n    10:27:01.890 [bookkeeper-ml-workers-OrderedExecutor-1-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [tt5/testns1/persistent/t1%5Cdata] Created ledger 65\r\n    10:27:01.893 [bookkeeper-ml-workers-OrderedExecutor-1-0] INFO  org.apache.pulsar.broker.service.persistent.DispatchRateLimiter - [persistent://tt5/testns1/t1\\data] [null] setting message-dispatch-rate DispatchRate{dispatchThrottlingRateInMsg=0, dispatchThrottlingRateInByte=0, ratePeriodInSecond=1}\r\n    10:27:01.894 [bookkeeper-ml-workers-OrderedExecutor-1-0] INFO  org.apache.pulsar.broker.service.persistent.DispatchRateLimiter - [persistent://tt5/testns1/t1\\data] [null] configured message-dispatch rate at broker DispatchRate{dispatchThrottlingRateInMsg=0, dispatchThrottlingRateInByte=0, ratePeriodInSecond=1}\r\n    10:27:01.896 [bookkeeper-ml-workers-OrderedExecutor-1-0] INFO  org.apache.pulsar.broker.service.BrokerService - Created topic persistent://tt5/testns1/t1\\data - dedup is disabled\r\n    10:27:01.919 [Thread-23] INFO  org.apache.pulsar.broker.service.ServerCnx - [/172.17.0.1:39788] Created new producer: Producer{topic=PersistentTopic{topic=persistent://tt5/testns1/t1\\data}, client=/172.17.0.1:39788, producerName=standalone-0-17, producerId=0}\r\n    10:27:01.970 [pulsar-io-46-1] INFO  org.apache.pulsar.broker.service.ServerCnx - [PersistentTopic{topic=persistent://tt5/testns1/t1\\data}][standalone-0-17] Closing producer on cnx /172.17.0.1:39788\r\n    10:27:01.973 [pulsar-io-46-1] INFO  org.apache.pulsar.broker.service.ServerCnx - [PersistentTopic{topic=persistent://tt5/testns1/t1\\data}][standalone-0-17] Closed producer on cnx /172.17.0.1:39788\r\n    10:27:02.034 [pulsar-web-53-17] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:02 +0000] \"GET https://localhost:8081/admin/v2/persistent/tt5/testns1 HTTP/1.1\" 200 37 \"-\" \"Python/3.7 aiohttp/3.4.2\" 4\r\n    10:27:02.066 [ProcessThread(sid:0 cport:2181):] INFO  org.apache.zookeeper.server.PrepRequestProcessor - Got user-level KeeperException when processing sessionid:0x1001f01ffe00009 type:delete cxid:0x56d zxid:0xb5188 txntype:-1 reqpath:n/a Error Path:/ledgers/00/0000 Error:KeeperErrorCode = Directory not empty for /ledgers/00/0000\r\n    10:27:02.068 [BookKeeperClientWorker-OrderedExecutor-1-0] INFO  org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper - [tt5/testns1/persistent/t1%5Cdata] Remove ManagedLedger\r\n    10:27:02.070 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperChildrenCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe00009 local:/127.0.0.1:42438 remoteserver:localhost/127.0.0.1:2181 lastZxid:741768 xid:1391 sent:1391 recv:1410 queuedpkts:0 pendingresp:1 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/managed-ledgers/tt5/testns1/persistent\r\n    10:27:02.072 [bookkeeper-ml-workers-OrderedExecutor-1-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [tt5/testns1/persistent/t1%5Cdata] Successfully deleted managed ledger\r\n    10:27:02.073 [bookkeeper-ml-workers-OrderedExecutor-1-0] INFO  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://tt5/testns1/t1\\data] Topic deleted\r\n    10:27:02.076 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.zookeeper.ZooKeeperChildrenCache - reloadCache called in zookeeperChildrenCache for path /managed-ledgers/tt5/testns1/persistent\r\n    10:27:02.078 [pulsar-web-53-11] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:02 +0000] \"DELETE https://localhost:8081/admin/v2/persistent/tt5/testns1/t1%5Cdata?force=true HTTP/1.1\" 204 0 \"-\" \"Python/3.7 aiohttp/3.4.2\" 16\r\n    10:27:02.111 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741770 xid:588 sent:806 recv:961 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5/testns1\r\n    10:27:02.115 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.broker.service.BrokerService - /admin/policies/tt5/testns1 updating with Policies{auth_policies=org.apache.pulsar.common.policies.data.AuthPolicies@6c3b39ee, replication_clusters=[standalone], bundles=BundlesData{numBundles=4, boundaries=[0x00000000, 0x40000000, 0x80000000, 0xc0000000, 0xffffffff]}, backlog_quota_map={}, persistence=null, deduplicationEnabled=null, clusterDispatchRate={}, latency_stats_sample_rate={}, antiAffinityGroup=null, message_ttl_in_seconds=600, retention_policies=RetentionPolicies{retentionTimeInMinutes=10, retentionSizeInMB=0}, deleted=true, encryption_required=false, subscription_auth_mode=None, max_producers_per_topic=0, max_consumers_per_topic=0, max_consumers_per_subscription=0, compaction_threshold=0, offload_threshold=-1, offload_deletion_lag_ms=null}\r\n    10:27:02.121 [pulsar-web-53-18] WARN  org.apache.pulsar.broker.web.AuthenticationFilter - [127.0.0.1] Failed to authenticate HTTP request: Authentication required\r\n    10:27:02.121 [pulsar-web-53-18] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [29/Oct/2018:10:27:02 +0000] \"DELETE //127.0.0.1:8080/admin/v2/namespaces/tt5/testns1/0x80000000_0xc0000000 HTTP/1.1\" 401 382 \"-\" \"Jersey/2.25 (HttpUrlConnection 1.8.0_171)\" 1\r\n    10:27:02.126 [pulsar-web-53-15] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:02 +0000] \"DELETE https://localhost:8081/admin/v2/namespaces/tt5/testns1 HTTP/1.1\" 401 45 \"-\" \"Python/3.7 aiohttp/3.4.2\" 18\r\n    10:27:02.163 [pulsar-web-53-24] WARN  org.apache.pulsar.broker.admin.impl.TenantsBase - [superUser] Failed to delete tenant tt5: not empty\r\n    10:27:02.167 [pulsar-web-53-24] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:02 +0000] \"DELETE https://localhost:8081/admin/v2/tenants/tt5 HTTP/1.1\" 409 51 \"-\" \"Python/3.7 aiohttp/3.4.2\" 9\r\n    10:27:02.173 [pulsar-web-53-14] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:02 +0000] \"GET https://localhost:8081/admin/v2/persistent/tt5/testns1 HTTP/1.1\" 200 2 \"-\" \"Python/3.7 aiohttp/3.4.2\" 15\r\n    10:27:02.211 [pulsar-ordered-OrderedExecutor-6-0-EventThread] INFO  org.apache.pulsar.zookeeper.ZooKeeperDataCache - [State:CONNECTED Timeout:30000 sessionid:0x1001f01ffe0000a local:/127.0.0.1:42440 remoteserver:localhost/127.0.0.1:2181 lastZxid:741771 xid:593 sent:811 recv:967 queuedpkts:0 pendingresp:0 queuedevents:0] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/policies/tt5/testns1\r\n    10:27:02.215 [pulsar-ordered-OrderedExecutor-0-0] INFO  org.apache.pulsar.broker.service.BrokerService - /admin/policies/tt5/testns1 updating with Policies{auth_policies=org.apache.pulsar.common.policies.data.AuthPolicies@3e08232b, replication_clusters=[standalone], bundles=BundlesData{numBundles=4, boundaries=[0x00000000, 0x40000000, 0x80000000, 0xc0000000, 0xffffffff]}, backlog_quota_map={}, persistence=null, deduplicationEnabled=null, clusterDispatchRate={}, latency_stats_sample_rate={}, antiAffinityGroup=null, message_ttl_in_seconds=600, retention_policies=RetentionPolicies{retentionTimeInMinutes=10, retentionSizeInMB=0}, deleted=true, encryption_required=false, subscription_auth_mode=None, max_producers_per_topic=0, max_consumers_per_topic=0, max_consumers_per_subscription=0, compaction_threshold=0, offload_threshold=-1, offload_deletion_lag_ms=null}\r\n    10:27:02.235 [pulsar-web-53-1] WARN  org.apache.pulsar.broker.web.AuthenticationFilter - [127.0.0.1] Failed to authenticate HTTP request: Authentication required\r\n    10:27:02.236 [pulsar-web-53-1] INFO  org.eclipse.jetty.server.RequestLog - 127.0.0.1 - - [29/Oct/2018:10:27:02 +0000] \"DELETE //127.0.0.1:8080/admin/v2/namespaces/tt5/testns1/0x80000000_0xc0000000 HTTP/1.1\" 401 382 \"-\" \"Jersey/2.25 (HttpUrlConnection 1.8.0_171)\" 1\r\n    10:27:02.245 [pulsar-web-53-28] INFO  org.eclipse.jetty.server.RequestLog - 172.17.0.1 - - [29/Oct/2018:10:27:02 +0000] \"DELETE https://localhost:8081/admin/v2/namespaces/tt5/testns1 HTTP/1.1\" 401 45 \"-\" \"Python/3.7 aiohttp/3.4.2\" 41\r\n", "url": "https://github.com/apache/pulsar/issues/2880", "user": "HaraldGustafsson", "labels": ["component/broker", "type/bug"], "created": "2018-10-29 10:33:37", "closed": "2019-01-09 10:51:40", "commits": {"4f9771a89bd991b2f0a20fcb85ed6196f9b17673": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 72.00027777777778, "commitsDetails": [{"commitHash": "4f9771a89bd991b2f0a20fcb85ed6196f9b17673", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["918dc6842d09bc07478adb5fb099aa43f1d40f1b"], "nameRev": "4f9771a89bd991b2f0a20fcb85ed6196f9b17673 tags/v2.3.0-candidate-1~171", "commitMessage": "Test for namespace delete with TLS authorization (#3340)\n\nAdd a test for deleting namespaces when TLS authorization is\r\nenabled. This is effectly testing brokerClient* configuration also.\r\n\r\nIssue: #2880", "commitDateTime": "2019-01-09 07:34:57", "authoredDateTime": "2019-01-09 16:34:57", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTlsAuthTest.java", "insertions": 49, "deletions": 0, "lines": 49}, {"filePath": "pulsar-broker/src/test/resources/authentication/tls-http/user1.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "pulsar-broker/src/test/resources/authentication/tls-http/user1.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminApiTlsAuthTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTlsAuthTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTlsAuthTest.buildClient(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTlsAuthTest.testDeleteNamespace()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTlsAuthTest.setup()", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "The link issue in http://pulsar.apache.org/en/contact/", "body": "In [contact](http://pulsar.apache.org/en/contact) page, the links has some issue: \r\n```\r\n    const mailingLists = [\r\n      {\r\n        email: 'users@pulsar.apache.org',\r\n        desc: 'User-related discussions',\r\n        subscribe: 'mailto:users@pulsar.apache.org',     < === users-subscribe@..\r\n        unsubscribe: 'mailto:users-unsubscribe@pulsar.apache.org',\r\n        archives: 'http://mail-archives.apache.org/mod_mbox/pulsar-users/'\r\n      },\r\n      {\r\n        email: 'dev@pulsar.apache.org',\r\n        desc: 'Development-related discussions',\r\n        subscribe: 'mailto:dev@pulsar.apache.org',    < ===  users-subscribe@..\r\n        unsubscribe: 'mailto:dev-unsubscribe@pulsar.apache.org',\r\n        archives: 'http://mail-archives.apache.org/mod_mbox/pulsar-dev/'\r\n      },\r\n      {\r\n        email: 'dev@pulsar.apache.org',  < === commits@..\r\n        desc: 'All commits to the Pulsar repository',\r\n        subscribe: 'mailto:commits-subscribe@pulsar.apache.org',\r\n        unsubscribe: 'mailto:commits-unsubscribe@pulsar.apache.org',\r\n        archives: 'http://mail-archives.apache.org/mod_mbox/pulsar-commits/'\r\n      }\r\n    ]\r\n```\r\nThanks for the guy that report this, \r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/2860", "user": "jiazhai", "labels": ["component/documentation", "help wanted", "type/bug"], "created": "2018-10-27 07:50:46", "closed": "2018-10-27 22:38:30", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "SQL docs source missing", "body": "http://pulsar.apache.org/docs/en/next/sql-overview/\r\n\r\nDoes not exist in \r\n\r\nhttps://github.com/apache/pulsar/tree/master/site2/docs\r\n\r\nSo I can't correct a typo.", "url": "https://github.com/apache/pulsar/issues/2834", "user": "ivankelly", "labels": ["component/documentation", "type/bug"], "created": "2018-10-24 11:32:43", "closed": "2018-10-31 21:45:49", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "Inter Broker communication TLS not working for Pulsar Admin Client ", "body": "#### Expected behavior\r\n\r\nPulsar Admin Client in Broker should use TLS and connect to webServicePortTls.\r\n\r\n#### Actual behavior\r\n\r\nPulsar Admin Client uses only the webServicePort \r\n\r\n#### Steps to reproduce\r\n\r\nA. Create a cluster with TLS enabled in brokers\r\nB. Use AuthenticationTLS as brokerClientAuthPlugin\r\nC. run `pulsar-client-admin persistent list ...` \r\nD. You will see a 500 response and \"Authentication required\" Error on the broker.\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.2.1\r\n", "url": "https://github.com/apache/pulsar/issues/2830", "user": "jai1", "labels": ["type/bug"], "created": "2018-10-24 06:35:00", "closed": "2018-10-25 01:27:42", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Documentation error in TLS ", "body": "#### Expected behavior\r\n\r\nFollowing the steps described in the documentation should produce a certificate and a private key.\r\n\r\n#### Actual behavior\r\n\r\nWhen executing the steps in order, you will get the following error when executing the \r\n\r\n\"openssl req -config openssl.cnf -key private/ca.key.pem \\\r\n      -new -x509 -days 7300 -sha256 -extensions v3_ca \\\r\n      -out certs/ca.cert.pem\"\r\ncommand:\r\n\r\nerror on line 30 of openssl.cnf\r\n140735608460232:error:0E065068:configuration file routines:STR_COPY:variable has no value:/BuildRoot/Library/Caches/com.apple.xbs/Sources/libressl/libressl-22.50.2/libressl/crypto/conf/conf_def.c:573:line 30\r\n#### Steps to reproduce\r\n\r\nHow can we reproduce the issue\r\n\r\nExecute the following commands in sequence:\r\n\r\n$ mkdir my-ca\r\n$ cd my-ca\r\n$ wget https://github.com/apache/incubator-pulsar/tree/master/site2/website/static/examples/openssl.cnf\r\n$ export CA_HOME=$(pwd)\r\n$ mkdir certs crl newcerts private\r\n$ chmod 700 private/\r\n$ touch index.txt\r\n$ echo 1000 > serial\r\n$ openssl genrsa -aes256 -out private/ca.key.pem 4096\r\n$ chmod 400 private/ca.key.pem\r\n$ openssl req -config openssl.cnf -key private/ca.key.pem \\\r\n      -new -x509 -days 7300 -sha256 -extensions v3_ca \\\r\n      -out certs/ca.cert.pem\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.1.1\r\n", "url": "https://github.com/apache/pulsar/issues/2797", "user": "david-streamlio", "labels": ["component/documentation", "type/bug"], "created": "2018-10-16 19:16:08", "closed": "2018-12-27 10:33:46", "commits": {}, "ttf": 71.00027777777778, "commitsDetails": []}, {"title": "namespace grant-permission Returns 500 in 2.1.1-incubating", "body": "#### Expected behavior\r\n\r\nThe below command should return successfully: \r\n\r\n`pulsar-admin namespaces grant-permission public/pulsar-gke/default --actions produce,consume --role oisaac`\r\n\r\n#### Actual behavior\r\n\r\nThe broker server returns a 500 server error.\r\n\r\n#### Steps to reproduce\r\n\r\nI deployed a fresh cluster using the GKE deployment method. When enabling authentication and authorization I am unable to grant permissions to roles. Other admin actions work.\r\n\r\nI was able to get this working in 2.1.0-incubating.\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.1.1-incubating\r\nClient: google container engine running kubernetes.\r\n\r\n\r\n#### Error Log:\r\n\r\n```\r\n15:32:11.815 [pulsar-web-28-7] INFO  org.eclipse.jetty.server.RequestLog - 10.202.240.8 - - [12/Oct/2018:15:32:11 +0000] \"POST https://10.202.240.14:8443/admin/namespaces/translators/pulsar-gke/default/permissions/oisaac HTTP/1.1\" 500 389 \"-\" \"curl/7.54.0\" 128\r\njavax.servlet.ServletException: javax.servlet.ServletException: java.lang.NullPointerException\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:139) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:524) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:319) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:253) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273) [org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95) [org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:202) [org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273) [org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95) [org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93) [org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303) [org.eclipse.jetty-jetty-util-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148) [org.eclipse.jetty-jetty-util-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136) [org.eclipse.jetty-jetty-util-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_181]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_181]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]Caused by: javax.servlet.ServletException: java.lang.NullPointerException\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:489) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:427) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:388) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:341) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:228) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:845) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1689) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53) ~[org.apache.pulsar-pulsar-broker-2.1.1-incubating.jar:2.1.1-incubating]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.apache.pulsar.broker.web.AuthenticationFilter.doFilter(AuthenticationFilter.java:74) ~[org.apache.pulsar-pulsar-broker-common-2.1.1-incubating.jar:2.1.1-incubating]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\t... 17 moreCaused by: java.lang.NullPointerException\r\n\tat org.apache.pulsar.broker.admin.impl.NamespacesBase.internalGrantPermissionOnNamespace(NamespacesBase.java:301) ~[org.apache.pulsar-pulsar-broker-2.1.1-incubating.jar:2.1.1-incubating]\r\n\tat org.apache.pulsar.broker.admin.v1.Namespaces.grantPermissionOnNamespace(Namespaces.java:231) ~[org.apache.pulsar-pulsar-broker-2.1.1-incubating.jar:2.1.1-incubating]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_181]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_181]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_181]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_181]\r\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:143) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:271) ~[org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:267) ~[org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:315) ~[org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:297) ~[org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:267) ~[org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317) ~[org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:427) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:388) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:341) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:228) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:845) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1689) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53) ~[org.apache.pulsar-pulsar-broker-2.1.1-incubating.jar:2.1.1-incubating]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.apache.pulsar.broker.web.AuthenticationFilter.doFilter(AuthenticationFilter.java:74) ~[org.apache.pulsar-pulsar-broker-common-2.1.1-incubating.jar:2.1.1-incubating]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119) ~[org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\t... 17 more\r\n15:32:11.810 [pulsar-web-28-7] WARN  org.eclipse.jetty.server.HttpChannel - https://10.202.240.14:8443/admin/namespaces/translators/pulsar-gke/default/permissions/oisaac\r\njavax.servlet.ServletException: java.lang.NullPointerException\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:489) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:427) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:388) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:341) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:228) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:845) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1689) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:53) ~[org.apache.pulsar-pulsar-broker-2.1.1-incubating.jar:2.1.1-incubating]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.apache.pulsar.broker.web.AuthenticationFilter.doFilter(AuthenticationFilter.java:74) ~[org.apache.pulsar-pulsar-broker-common-2.1.1-incubating.jar:2.1.1-incubating]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1676) ~[org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581) [org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511) [org.eclipse.jetty-jetty-servlet-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:524) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:319) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:253) [org.eclipse.jetty-jetty-server-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273) [org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95) [org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:202) [org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273) [org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95) [org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93) [org.eclipse.jetty-jetty-io-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303) [org.eclipse.jetty-jetty-util-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148) [org.eclipse.jetty-jetty-util-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136) [org.eclipse.jetty-jetty-util-9.3.11.v20160721.jar:9.3.11.v20160721]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_181]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_181]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]Caused by: java.lang.NullPointerException\r\n\tat org.apache.pulsar.broker.admin.impl.NamespacesBase.internalGrantPermissionOnNamespace(NamespacesBase.java:301) ~[org.apache.pulsar-pulsar-broker-2.1.1-incubating.jar:2.1.1-incubating]\r\n\tat org.apache.pulsar.broker.admin.v1.Namespaces.grantPermissionOnNamespace(Namespaces.java:231) ~[org.apache.pulsar-pulsar-broker-2.1.1-incubating.jar:2.1.1-incubating]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_181]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_181]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_181]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_181]\r\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:143) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:271) ~[org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:267) ~[org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:315) ~[org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:297) ~[org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:267) ~[org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317) ~[org.glassfish.jersey.core-jersey-common-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154) ~[org.glassfish.jersey.core-jersey-server-2.25.jar:?]\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.25.jar:?]\r\n\t... 36 more\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/2795", "user": "oliverisaac", "labels": ["component/broker", "type/bug"], "created": "2018-10-16 16:04:58", "closed": "2018-11-02 16:39:41", "commits": {}, "ttf": 17.00027777777778, "commitsDetails": []}, {"title": "TLS Hostname verification undefined for C++/python client", "body": "I've not tested with code, but it looks like TLS hostname verification is a mess for the C++ client (and python by extension).\r\n\r\nFor binary connections, no hostname verification takes place as far as I can see. For http connections (for lookups) it takes place every time.\r\n\r\nI suspect this made it through testing since the tls certs used to test C++ use localhost as the common name. We should expose the ability to add the host verification in the configuration.\r\n", "url": "https://github.com/apache/pulsar/issues/2793", "user": "ivankelly", "labels": ["component/c++", "component/documentation", "triage/week-3", "type/bug"], "created": "2018-10-15 12:18:15", "closed": "2020-06-08 08:41:27", "commits": {"5db4d5f2242ed4718afb0b8e6705e890454e467e": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 601.0002777777778, "commitsDetails": [{"commitHash": "5db4d5f2242ed4718afb0b8e6705e890454e467e", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["3771c3f9e0900cfec6315f323fc5c8658c68a2a7"], "nameRev": "5db4d5f2242ed4718afb0b8e6705e890454e467e tags/v2.6.0-candidate-1~17", "commitMessage": "[Issue 2793][Doc]--Update TLS hostname verification for CPP and Python clients (#7182)\n\nFixes #2793 \r\n\r\n\r\n\r\n### Motivation\r\nBased on description in issue #2793, code example of host verification for C++ and Python clients are not correct. Therefore, update the security-tls-transport.md doc.\r\n\r\nDoc for master has been updated and merged. This PR is for updating docs for previous releases.\r\n\r\n\r\n\r\n### Modifications\r\n\r\n1: update the TLS hostname verification code example for C++ and Python clients.\r\n2: fix link errors.\r\n3: re-arrange doc heading levels.\r\n4: update the docs for the following releases: 2.5.2---2.2.0\r\n", "commitDateTime": "2020-06-08 01:41:26", "authoredDateTime": "2020-06-08 16:41:26", "commitGitStats": [{"filePath": "site2/website/versioned_docs/version-2.2.0/security-tls-transport.md", "insertions": 12, "deletions": 11, "lines": 23}, {"filePath": "site2/website/versioned_docs/version-2.2.1/security-tls-transport.md", "insertions": 12, "deletions": 11, "lines": 23}, {"filePath": "site2/website/versioned_docs/version-2.3.0/security-tls-transport.md", "insertions": 229, "deletions": 0, "lines": 229}, {"filePath": "site2/website/versioned_docs/version-2.3.1/security-tls-transport.md", "insertions": 229, "deletions": 0, "lines": 229}, {"filePath": "site2/website/versioned_docs/version-2.3.2/security-tls-transport.md", "insertions": 229, "deletions": 0, "lines": 229}, {"filePath": "site2/website/versioned_docs/version-2.4.0/security-tls-transport.md", "insertions": 229, "deletions": 0, "lines": 229}, {"filePath": "site2/website/versioned_docs/version-2.4.1/security-tls-transport.md", "insertions": 12, "deletions": 11, "lines": 23}, {"filePath": "site2/website/versioned_docs/version-2.4.2/security-tls-transport.md", "insertions": 12, "deletions": 11, "lines": 23}, {"filePath": "site2/website/versioned_docs/version-2.5.0/security-tls-transport.md", "insertions": 13, "deletions": 12, "lines": 25}, {"filePath": "site2/website/versioned_docs/version-2.5.1/security-tls-transport.md", "insertions": 13, "deletions": 12, "lines": 25}, {"filePath": "site2/website/versioned_docs/version-2.5.2/security-tls-transport.md", "insertions": 13, "deletions": 12, "lines": 25}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Problems introducing incompatible changes to persistent topic schema", "body": "#### Expected behavior\r\n\r\nWhen introducing incompatible changes to the schema for a persistent topic, deleting the schema/topic should allow the new schema to be used.\r\n\r\n#### Actual behavior\r\n\r\nAfter deleting the schema using pulsar-admin, the Java client gets an NPE when trying to create the producer. The same NPE happens if you delete schema, topic, namespace and tenant, then recreate tenant and namespace.\r\n\r\n#### Steps to reproduce\r\nI guess steps 2 and 3 aren't actually necessary to reproduce this, but I've included everything I did just in case:\r\n1. Run a producer using a JSON schema - we're using Kotlin, but I'm pretty confident the same would apply in Java. These are the relevant snippets:\r\n```kotlin\r\ndata class Test(var fieldOne: String = UNKNOWN,\r\n                var fieldTwo: String = UNKNOWN) : Serializable\r\n\r\nval producer = client.newProducer(JSONSchema.of(Test::class.java))\r\n          .topic(\"persistent://hicksst_hicksco_qa/default/TestTopic\")\r\n          .createAsync()\r\n          .get(30L, TimeUnit.SECONDS)\r\n```\r\n2. Make an incompatible change to the schema:\r\n```kotlin\r\ndata class Test(var fieldOne: String = UNKNOWN,\r\n                var fieldTwo: Int = 0) : Serializable\r\n```\r\n3. Running the producer and consumer now both throw an \"incompatible schema\" exception as expected.\r\n\r\n4. Delete the schema using pulsar-admin:\r\n\r\n```\r\npulsar-admin schemas delete persistent://hicksst_hicksco_qa/default/TestTopic\r\n```\r\n5. Running the producer now throws the following on the call to CompletableFuture.get:\r\n```\r\nCaused by: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException: java.lang.NullPointerException\r\n\tat java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1915)\r\n\tat percentile.streams.trade.simulator.pulsar.PulsarProducer.initialise(PulsarProducer.kt:34)\r\n\t... 5 more\r\nCaused by: org.apache.pulsar.client.api.PulsarClientException: java.lang.NullPointerException\r\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:761)\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:498)\r\n\tat org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:154)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310)\r\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:284)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1414)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:945)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:146)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:580)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:497)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\nThere are no exceptions shown in the Pulsar server logs. \r\nRunning the consumer does not throw an exception.\r\n\r\n6. Deleting and recreating the tenant, then running the producer throws the same NPE.\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.1.0\r\n**Java client library version**: 2.1.1-incubating\r\n", "url": "https://github.com/apache/pulsar/issues/2786", "user": "sjchicks", "labels": ["component/schemaregistry", "type/bug"], "created": "2018-10-12 11:20:02", "closed": "2019-03-19 15:19:06", "commits": {"8997375ef6a0b6c6286478b495c0ca785ae41710": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "47f85a1ddf27ca2b952ac8820537e9e0abd667b7": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 158.00027777777777, "commitsDetails": [{"commitHash": "8997375ef6a0b6c6286478b495c0ca785ae41710", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["05dc8c88aba193d64002ff8cc229c01790fcef72"], "nameRev": "8997375ef6a0b6c6286478b495c0ca785ae41710 tags/v2.4.0-candidate-1~461", "commitMessage": "Issue #3211: Fix NPE when creating schema after deleting a schema (#3836)\n\nFixes #3211\r\nFixes #2786 \r\n\r\n*Motivation*\r\n\r\nWhen a schema is deleted, the schema is not removed directly.\r\nYou can still fetch the latest schema but its state is marked as `deleted`.\r\n\r\nSo when we apply schema compatibility check, we should ignore deleted schema.\r\n\r\n*Modifications*\r\n\r\nIgnore deleted schema when doing schema compatibility check\r\n\r\n", "commitDateTime": "2019-03-19 23:19:05", "authoredDateTime": "2019-03-19 23:19:05", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java", "insertions": 11, "deletions": 4, "lines": 15}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/SchemaTest.java", "insertions": 110, "deletions": 0, "lines": 110}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/Schemas.java", "insertions": 79, "deletions": 0, "lines": 79}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SchemaRegistryServiceImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.checkCompatibilityWithLatest(java.lang.String,org.apache.pulsar.common.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.putSchemaIfAbsent(java.lang.String,org.apache.pulsar.common.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "SchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.schema.SchemaTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Schemas.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.schema.Schemas", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "47f85a1ddf27ca2b952ac8820537e9e0abd667b7", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["1c6563eb81fdff69b8f6507881497a95659165d7"], "nameRev": "47f85a1ddf27ca2b952ac8820537e9e0abd667b7 tags/v2.3.1-candidate-1~11", "commitMessage": "Issue #3211: Fix NPE when creating schema after deleting a schema (#3836)\n\nFixes #3211\r\nFixes #2786 \r\n\r\n*Motivation*\r\n\r\nWhen a schema is deleted, the schema is not removed directly.\r\nYou can still fetch the latest schema but its state is marked as `deleted`.\r\n\r\nSo when we apply schema compatibility check, we should ignore deleted schema.\r\n\r\n*Modifications*\r\n\r\nIgnore deleted schema when doing schema compatibility check\r\n\r\n", "commitDateTime": "2019-04-01 10:53:51", "authoredDateTime": "2019-03-19 23:19:05", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java", "insertions": 11, "deletions": 4, "lines": 15}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/SchemaTest.java", "insertions": 110, "deletions": 0, "lines": 110}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/schema/Schemas.java", "insertions": 79, "deletions": 0, "lines": 79}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SchemaRegistryServiceImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.checkCompatibilityWithLatest(java.lang.String,org.apache.pulsar.common.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.schema.SchemaRegistryServiceImpl.putSchemaIfAbsent(java.lang.String,org.apache.pulsar.common.schema.SchemaData,org.apache.pulsar.broker.service.schema.SchemaCompatibilityStrategy)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "SchemaTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.schema.SchemaTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Schemas.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.schema.Schemas", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Problem in Netty shading in Pulsar client lib", "body": "The current master have a problem with the shading of Netty. \r\n\r\nThe result is that user with other Netty dependencies will get failures like : \r\n\r\n```\r\n[172.17.5.172/172.17.5.172:6650] Got exception IncompatibleClassChangeError : Class org.apache.pulsar.shade.io.netty.buffer.PooledSlicedByteBuf does not implement the requested interface org.apache.pulsar.shade.io.netty.util.ReferenceCounted\r\njava.lang.IncompatibleClassChangeError: Class org.apache.pulsar.shade.io.netty.buffer.PooledSlicedByteBuf does not implement the requested interface org.apache.pulsar.shade.io.netty.util.ReferenceCounted\r\n    at org.apache.pulsar.shade.io.netty.buffer.AbstractPooledDerivedByteBuf$PooledNonRetainedSlicedByteBuf.retain0(AbstractPooledDerivedByteBuf.java:244) ~[pulsar-client-2.2.0-SNAPSHOT.jar:2.2.0-SNAPSHOT]\r\n```\r\n\r\nor \r\n\r\n```\r\nClass org.apache.pulsar.shade.io.netty.buffer.PooledSlicedByteBuf does not implement the requested interface org.apache.pulsar.shade.io.netty.util.ReferenceCounted\r\n```", "url": "https://github.com/apache/pulsar/issues/2778", "user": "merlimat", "labels": ["type/bug"], "created": "2018-10-11 22:50:04", "closed": "2018-10-12 05:23:08", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "ClassCastException when using custom JSON schema", "body": "#### Expected behavior\r\n\r\nIt should be possible to create a custom JSON `Schema` that's not an implementation of `JSONSchema`, so I can use schemas from libraries like https://github.com/sksamuel/pulsar4s.\r\n\r\n#### Actual behavior\r\n\r\nI used the `pulsar4s` library, which creates custom schema implementations. I wrote some very simple code like this:\r\n\r\n```scala\r\nimport com.sksamuel.pulsar4s._\r\nimport com.sksamuel.pulsar4s.circe._\r\nimport io.circe.generic.auto._\r\n\r\ncase class Foo(bar: String, baz: String)\r\n\r\nval client = PulsarClient(\"pulsar://localhost:6650\")\r\nval topic = Topic(\"persistent://sample/standalone/ns1/b\")\r\nval producer = client.producer[Foo](ProducerConfig(topic))\r\n```\r\n\r\nBecause pulsar4s creates schema instances that aren't `JSONSchema`, I get a `ClassCastException`:\r\n\r\n```\r\njava.util.concurrent.CompletionException: java.lang.ClassCastException: com.sksamuel.pulsar4s.circe.package$$anon$1 cannot be cast to org.apache.pulsar.client.impl.schema.JSONSchema\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:273)\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:280)\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:659)\r\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:632)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1962)\r\n\tat org.apache.pulsar.client.impl.ConnectionPool.lambda$null$4(ConnectionPool.java:196)\r\n\tat java.util.concurrent.CompletableFuture.uniRun(CompletableFuture.java:705)\r\n\tat java.util.concurrent.CompletableFuture$UniRun.tryFire(CompletableFuture.java:687)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1962)\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleConnected(ClientCnx.java:235)\r\n\tat org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:148)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310)\r\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:284)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1414)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:945)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:146)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:645)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:580)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:497)\r\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:459)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886)\r\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.lang.ClassCastException: com.sksamuel.pulsar4s.circe.package$$anon$1 cannot be cast to org.apache.pulsar.client.impl.schema.JSONSchema\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.connectionOpened(ProducerImpl.java:874)\r\n\tat org.apache.pulsar.client.impl.ConnectionHandler.lambda$grabCnx$0(ConnectionHandler.java:65)\r\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:656)\r\n\t... 30 more\r\n```\r\n\r\nThis is due to an unsafe cast at https://github.com/apache/pulsar/blob/v2.1.1-incubating/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java#L874\r\n\r\nThis was also reported at https://github.com/sksamuel/pulsar4s/issues/6\r\n\r\n#### System configuration\r\n\r\n**Pulsar version**: 2.1.1\r\n", "url": "https://github.com/apache/pulsar/issues/2767", "user": "gmethvin", "labels": ["component/schemaregistry", "type/bug"], "created": "2018-10-11 05:22:52", "closed": "2018-10-17 21:58:03", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "null payload or property values generated NullPointerException in server", "body": "#### Expected behavior\r\n\r\nI expected the server to accept null valued properties and payloads\r\n\r\n#### Actual behavior\r\n\r\nNullPointerException in base64 processing in the case of payload\r\nNullPointerException in the case of property values being null\r\n\r\njava.lang.NullPointerException: null\r\n        at org.apache.pulsar.common.api.proto.PulsarApi$KeyValue$Builder.setValue(PulsarApi.java:1923) ~[org.apache.pulsar-pulsar-common-2.1.1-incubating.jar:2.1.1-incubating]\r\n\r\n#### Steps to reproduce\r\n\r\nI used the Websocket API to send in a message with either a null payload or property values set to null.\r\n\r\n#### System configuration\r\n2.1.1", "url": "https://github.com/apache/pulsar/issues/2751", "user": "sfescape", "labels": ["component/websocket", "type/bug"], "created": "2018-10-09 20:18:57", "closed": "2018-11-28 22:32:55", "commits": {"c94247971765febc594cd60aa762f248624c2bc8": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}, "d546a12a582e72bdfc1df667edccefb9ce1a49bd": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 50.000277777777775, "commitsDetails": [{"commitHash": "c94247971765febc594cd60aa762f248624c2bc8", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["b4168a7016e4150680398f5d4a85ae664e470fc9"], "nameRev": "c94247971765febc594cd60aa762f248624c2bc8 tags/v2.3.0-candidate-1~363", "commitMessage": "Issue #2751: Add check to fix NPE (#3034)\n\nMotivation\r\nWe may meet NPE like this:\r\n```\r\njava.lang.NullPointerException: null\r\nat org.apache.pulsar.common.api.proto.PulsarApi$KeyValue$Builder.setValue(PulsarApi.java:1923) ~[org.apache.pulsar-pulsar-common-2.1.1-incubating.jar:2.1.1-incubating]\r\n```\r\nThis is related to protobuf, it does not support null-able field directly.\r\nprotocolbuffers/protobuf#1606\r\n\r\nIn this fix we try to avoid this by add checking before this method is called.", "commitDateTime": "2018-11-25 13:23:31", "authoredDateTime": "2018-11-25 13:23:31", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TypedMessageBuilderImpl.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/ProducerHandler.java", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "TypedMessageBuilderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TypedMessageBuilderImpl.value(java.lang.Object)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.TypedMessageBuilderImpl.property(java.lang.String,java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.TypedMessageBuilderImpl.properties(java.util.Map)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProducerHandler.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.websocket.ProducerHandler.onWebSocketText(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "d546a12a582e72bdfc1df667edccefb9ce1a49bd", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["7c9c7d888b3342c76ce152df2511204d7f80c895"], "nameRev": "d546a12a582e72bdfc1df667edccefb9ce1a49bd tags/v2.2.1-candidate-1~10", "commitMessage": "Issue #2751: Add check to fix NPE (#3034)\n\nMotivation\r\nWe may meet NPE like this:\r\n```\r\njava.lang.NullPointerException: null\r\nat org.apache.pulsar.common.api.proto.PulsarApi$KeyValue$Builder.setValue(PulsarApi.java:1923) ~[org.apache.pulsar-pulsar-common-2.1.1-incubating.jar:2.1.1-incubating]\r\n```\r\nThis is related to protobuf, it does not support null-able field directly.\r\nprotocolbuffers/protobuf#1606\r\n\r\nIn this fix we try to avoid this by add checking before this method is called.", "commitDateTime": "2018-12-13 10:35:13", "authoredDateTime": "2018-11-25 13:23:31", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TypedMessageBuilderImpl.java", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/ProducerHandler.java", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "TypedMessageBuilderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TypedMessageBuilderImpl.value(java.lang.Object)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.TypedMessageBuilderImpl.property(java.lang.String,java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.TypedMessageBuilderImpl.properties(java.util.Map)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProducerHandler.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.websocket.ProducerHandler.onWebSocketText(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Admin API via PulsarProxy with authentication fails", "body": "I tried Admin API via PulsarProxy with Athenz authentication, and found a few unexpected behaviors. Please correct me if my expectation/understanding is wrong.\r\n\r\n#### 1. proxyRoles\r\n\r\n##### Expected\r\n[`proxyRoles`](https://github.com/apache/pulsar/blob/90aa408b9ddc53629bdc5c0e540cf5335c34399b/conf/broker.conf#L206-L208) in broker.conf can be set to empty. \r\n(In this case Proxy will be treated as a \"normal\" client)\r\n\r\n##### Actual\r\n`proxyRoles` in broker.conf can NOT be set to empty.\r\n\r\nBecause:\r\n[`validateOriginalPrincipal`](https://github.com/apache/pulsar/blob/90aa408b9ddc53629bdc5c0e540cf5335c34399b/pulsar-broker/src/main/java/org/apache/pulsar/broker/web/PulsarWebResource.java#L158-L162) will return false when\r\n* request has `originalPrincipal`\r\n* `proxyRoles` is empty\r\n\r\n##### Proposal\r\nSkip `validateOriginalPrincipal` if `proxyRoles` is empty.\r\n\r\n#### 2. Super user proxy\r\n\r\n##### Expected\r\nA role can be both `proxyRoles` and [`superUserRoles`](https://github.com/apache/pulsar/blob/90aa408b9ddc53629bdc5c0e540cf5335c34399b/conf/broker.conf#L260-L262).\r\n\r\n##### Actual\r\nA role can be both `proxyRoles` and `superUserRoles`.\r\nHowever, when we use this role as a \"normal\" client, its super user access to Admin API will fail.\r\n\r\nBecause:\r\nAlthough the role behaves as a normal client, the process will enter [this if statement](https://github.com/apache/pulsar/blob/69071355ca03fac9e38f7501b37ca93ac19fef7b/pulsar-broker/src/main/java/org/apache/pulsar/broker/web/PulsarWebResource.java#L182) (since the role is also in `proxyRoles`) and finally [throw an exception](https://github.com/apache/pulsar/blob/69071355ca03fac9e38f7501b37ca93ac19fef7b/pulsar-broker/src/main/java/org/apache/pulsar/broker/web/PulsarWebResource.java#L187-L191) since [`originalPrincipalAuthorized`](https://github.com/apache/pulsar/blob/69071355ca03fac9e38f7501b37ca93ac19fef7b/pulsar-broker/src/main/java/org/apache/pulsar/broker/web/PulsarWebResource.java#L185) is false. (here `originalPrincipal` is null)\r\n\r\n##### Proposal\r\nIf `originalPrincipal` is null, treat a role as a \"normal\" client even when it is in `proxyRoles`.\r\n\r\n#### 3. Header for authentication\r\n\r\n##### Expected\r\nHTTP header includes authentication data of proxy.\r\n\r\n##### Actual\r\nHTTP header includes authentication data of original client.\r\n\r\nExample of HTTP header from proxy to broker:\r\n```\r\nUser-Agent: Jersey/2.23.2 (HttpUrlConnection 1.8.0_144)\r\nHost: <broker>:<broker-port>\r\nAccept: application/json\r\nAthenz-Role-Auth: <token of original client> # This should be token of proxy.\r\nVia: http/1.1 <proxy>\r\nX-Forwarded-For: <client-ip>\r\nX-Forwarded-Proto: http\r\nX-Forwarded-Host: <proxy>\r\nX-Forwarded-Server: <proxy-ip>\r\nX-Original-Principal: <role of original client>\r\n```\r\n\r\n##### Proposal\r\nMove original client's authentication data to another new header (e.g. X-Original-Authentication), and overwrite the authentication header with  proxy's authentication data.\r\n\r\n#### System configuration\r\n* Pulsar version: 2.1.1\r\n* broker.conf: `authenticateOriginalAuthData=false`\r\n* proxy.conf: `forwardAuthorizationCredentials=false`", "url": "https://github.com/apache/pulsar/issues/2749", "user": "nkurihar", "labels": ["component/proxy", "type/bug"], "created": "2018-10-09 12:35:42", "closed": "2018-11-21 22:39:36", "commits": {}, "ttf": 43.000277777777775, "commitsDetails": []}, {"title": "Ws client can't receive any more messages when number of timed-out messages reaches receiverQueueSize", "body": "Ws proxy controls message-delivery to ws client by using `pendingMessages`.\r\n`pendingMessages` increases when ws proxy sends a message to ws client and It decreases when ws client acks to ws proxy.\r\nIf `pendingMessages` reaches `receiverQueueSize`, ws proxy stops to send a message until ws client acks.\r\nEven if a message times out(cause by ws client unack), `pendingMessages` doesn't decrease and ws proxy keeps waiting for ack.\r\n\r\n#### Expected behavior\r\n\r\nWhen  a message times out, `pendingMessages` decreases.\r\n\r\n#### Actual behavior\r\n\r\n`pendingMessages` doesn't decrease.\r\nSo ws client can't receive any more messages when timed-out messages reaches `receiverQueueSize`.\r\n\r\n#### Steps to reproduce\r\n\r\n1. ws client connects to ws proxy url(`ws:<hostname>/ws/consumer/persistent/...?ackTimeoutMillis=1000&receiverQueueSize=2&subscriptionType=Shared`)\r\n2. producer sends 2 messages.\r\n3. ws client recieves 2 messages and not ack them.\r\n4. ws client doesn't receive any more messages until ws client reconnects even if `ackTimeoutMillis`(1000ms) passes.\r\n\r\n#### System configuration\r\n**Pulsar version**: 1.22.1 and 2.2.1\r\n\r\n<br>\r\n<br>\r\n\r\n`pendingMessages`\r\nhttps://github.com/apache/pulsar/blob/branch-2.2/pulsar-websocket/src/main/java/org/apache/pulsar/websocket/ConsumerHandler.java#L75\r\n", "url": "https://github.com/apache/pulsar/issues/2731", "user": "hrsakai", "labels": ["component/websocket", "type/bug"], "created": "2018-10-05 04:02:15", "closed": "2019-03-27 06:51:40", "commits": {}, "ttf": 173.00027777777777, "commitsDetails": []}, {"title": "Fix various bugs in the Go client doc examples", "body": "Various parts of the Go client doc examples do not work with the existing API.\r\n\r\nFor example, https://pulsar.apache.org/docs/en/client-libraries-go/#producers is missing a Context\r\nhttps://pulsar.apache.org/docs/en/client-libraries-go/#producer-operations more involved example refers to a message ID but the producer does not have that available.\r\n\r\nDoes anyone know a system that allows typechecking these docs?\r\n\r\nI asked around and Rust puts markdown docs in code comments, with embedded code blocks in the markdown.  These get extracted and put into tests.  You can use # to hide boilerplate.\r\n\r\nJavascript seems to have https://github.com/eslint/eslint-plugin-markdown", "url": "https://github.com/apache/pulsar/issues/2719", "user": "grantwwu", "labels": ["component/documentation", "triage/week-43", "type/bug"], "created": "2018-10-04 19:45:33", "closed": "2019-11-11 05:42:37", "commits": {"006f291b69ad49dbe0f682f6fe0d6a865f4c06fe": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "d946a8fa09c9d7206950621e2ce7e30642995680": {"commitGHEventType": "referenced", "commitUser": "wolfstudy"}}, "ttf": 402.0002777777778, "commitsDetails": [{"commitHash": "006f291b69ad49dbe0f682f6fe0d6a865f4c06fe", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["983d7907cd18bad4f3a63d89ff94d64420137b2b"], "nameRev": "006f291b69ad49dbe0f682f6fe0d6a865f4c06fe tags/v2.5.0-candidate-1~102", "commitMessage": "[Docs] Fix the go client docs missing in website (#5595)\n\nSigned-off-by: xiaolong.ran <ranxiaolong716@gmail.com>\r\n\r\nFixes: #2719 \r\n\r\n### Motivation\r\n\r\nIn website, the go client docs missing.\r\n\r\n### Modifications\r\n\r\nAdd missing docs for go client.", "commitDateTime": "2019-11-11 13:42:36", "authoredDateTime": "2019-11-11 13:42:36", "commitGitStats": [{"filePath": "site2/docs/client-libraries-go.md", "insertions": 24, "deletions": 4, "lines": 28}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "d946a8fa09c9d7206950621e2ce7e30642995680", "commitGHEventType": "referenced", "commitUser": "wolfstudy", "commitParents": ["e935a4b27bad0836616cc8df15836ac5674366c9"], "nameRev": "d946a8fa09c9d7206950621e2ce7e30642995680 tags/v2.4.2-candidate-1~5", "commitMessage": "[Docs] Fix the go client docs missing in website (#5595)\n\nSigned-off-by: xiaolong.ran <ranxiaolong716@gmail.com>\r\n\r\nFixes: #2719 \r\n\r\n### Motivation\r\n\r\nIn website, the go client docs missing.\r\n\r\n### Modifications\r\n\r\nAdd missing docs for go client.\n\n(cherry picked from commit 006f291b69ad49dbe0f682f6fe0d6a865f4c06fe)\n", "commitDateTime": "2019-11-19 21:14:03", "authoredDateTime": "2019-11-11 13:42:36", "commitGitStats": [{"filePath": "site2/docs/client-libraries-go.md", "insertions": 24, "deletions": 4, "lines": 28}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Python messageId serialize is broken", "body": "#### Expected behavior\r\nMessageId object serialize method is broken at least in python 3.7 \r\n\r\n    pulsar.MessageId.latest.serialize()\r\n\r\nShould return a string\r\n\r\n#### Actual behavior\r\n\r\n    >>> pulsar.MessageId.earliest.serialize()\r\n    Traceback (most recent call last):\r\n      File \"<stdin>\", line 1, in <module>\r\n    UnicodeDecodeError: 'utf-8' codec can't decode byte 0xff in position 1: invalid start byte\r\n\r\n#### Steps to reproduce\r\n\r\nAs above\r\n\r\n#### System configuration\r\npulsar-client 2.1.0 and Python 3.7\r\n", "url": "https://github.com/apache/pulsar/issues/2708", "user": "HaraldGustafsson", "labels": ["component/python", "type/bug"], "created": "2018-10-03 08:21:10", "closed": "2018-10-10 00:55:53", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "Improve Go/macOS C++ client installation documentation", "body": "The Go client installation documentation instructs you to install the C++ client as well.  However, it does not note that you need the version to match exactly.\r\n\r\nAdditionally, the macOS C++ client installation instructions do not provide a way to choose what version you install: https://pulsar.apache.org/docs/en/client-libraries-cpp/#macos", "url": "https://github.com/apache/pulsar/issues/2703", "user": "grantwwu", "labels": ["component/client", "component/documentation", "component/go", "type/bug"], "created": "2018-10-03 02:02:07", "closed": "2018-10-03 22:27:38", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Offloading fails", "body": "The following happens when I try to offload manually using: `pulsar-admin topics offload --size-threshold 0 public/default/my-topic && pulsar-admin topics offload-status -w public/default/my-topic`\r\n\r\n> Offload triggered for persistent://public/default/my-topic for messages before 6:0:-1\r\n> Error in offload\r\n> null\r\n> \r\n> Reason: Error offloading: org.apache.bookkeeper.mledger.ManagedLedgerException: java.util.concurrent.CompletionException: java.lang.UnsupportedOperationException\r\n> command terminated with exit code 1\r\n\r\nThe last broker log regarding offloading:\r\n\r\n> INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [public/default/persistent/my-topic] Metadata prepared for offload of ledger 4 with uuid da861b42-3d30-4158-babd-f8a73e5850b7\r\n\r\nEverything else about the cluster seems to be running fine by the looks of logs and grafana.\r\n\r\n#### Steps to reproduce\r\n\r\nSpin up a new kubernetes cluster on gcp and try offloading to tiered storage following the [cookbook](https://pulsar.apache.org/docs/en/cookbooks-tiered-storage/)\r\n\r\nI have tried both the helm deployment and the gcp specific one and I have also tried both gcp and aws-s3 storage.\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.1.1\r\n", "url": "https://github.com/apache/pulsar/issues/2697", "user": "macthestack", "labels": ["component/tieredstorage", "type/bug", "type/question"], "created": "2018-10-02 09:56:03", "closed": "2018-10-05 14:05:02", "commits": {"4358a98cd8790c549e415dbafc8cc943661b5713": {"commitGHEventType": "referenced", "commitUser": "ivankelly"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "4358a98cd8790c549e415dbafc8cc943661b5713", "commitGHEventType": "referenced", "commitUser": "ivankelly", "commitParents": ["65592ad2ae9b3f460ef7af95c78f02dbd0f1c5e1"], "nameRev": "4358a98cd8790c549e415dbafc8cc943661b5713 tags/v2.3.0-candidate-1~342", "commitMessage": "Extra logging for offloaders (#2733)\n\nSome extra logging for offloader loading and initialization which\r\nwould have been useful when debugging #2697.\r\n", "commitDateTime": "2018-11-28 17:05:04", "authoredDateTime": "2018-11-28 17:05:04", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/offload/OffloaderUtils.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ManagedLedgerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.offloadLoop(java.util.concurrent.CompletableFuture,java.util.Queue,org.apache.bookkeeper.mledger.impl.PositionImpl,java.util.Optional)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "OffloaderUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.offload.OffloaderUtils.searchForOffloaders(java.lang.String)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.PulsarService.createManagedLedgerOffloader(org.apache.pulsar.broker.ServiceConfiguration)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "description mistake in doc", "body": "#### Expected behavior\r\n\r\nIn the [Messaging] --> [Subscription modes] --> [Failover] part, the third paragraph\r\nConsumer-C-1 is the master consumer while Consumer-C-2 would be the next in line to receive messages if Consumer-C-1 disconnected.\r\nBut the doc says\r\nConsumer-C-1 is the master consumer while Consumer-C-2 would be the next in line to receive messages if Consumer-C-2 disconnected.\r\n\r\n\r\n#### Actual behavior\r\n\r\nIt will confuse the readers.\r\n\r\n#### Steps to reproduce\r\n\r\nJust modify the doc.\r\n\r\n#### System configuration\r\nI don't know what the version is. It's just the doc mistake.\r\n", "url": "https://github.com/apache/pulsar/issues/2672", "user": "fenghuasky1991", "labels": ["component/website", "type/bug"], "created": "2018-09-28 07:35:10", "closed": "2018-09-30 07:47:44", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Can not get topic stats from the admin API", "body": "#### Expected behavior\r\n\r\nWhen fetching persistent topic stats with pulsar-admin cli tool I get the stats for that topic.\r\n\r\n#### Actual behavior\r\n\r\nThe correct stats are returned every third time, and two times out of three the request times out.\r\n\r\n#### Steps to reproduce\r\n\r\n1. Have Pulsar cluster with three broker nodes and a Pulsar proxy in front of them.\r\n\r\n2. Get stats for a single persistent topic, either with curl or pulsar-admin tool. Run this command multiple times.\r\n\r\nThe response is correct every third time, which implies that the proxy forwards the request to the broker that actually serves the requested topic every third time. Broker logs show a response status code of 200 for the correct broker, and 307 for the other two brokers. It seems that the redirect between the broker and proxy is not functioning correctly. \r\n\r\n#### System configuration\r\n**Pulsar version**: 2.1.0-incubating\r\n", "url": "https://github.com/apache/pulsar/issues/2660", "user": "laaksma", "labels": ["type/bug"], "created": "2018-09-26 13:58:03", "closed": "2018-09-28 03:14:26", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Bug of ConsumerInterceptor on method onAcknowledge()", "body": "#### Expected behavior\r\n\r\nConsumer acknowledge the batch message must call onAcknowledge()  for every messages in batch message.\r\n\r\n#### Actual behavior\r\n\r\nConsumer just call onAcknowledge() for the last message in batch message.\r\n", "url": "https://github.com/apache/pulsar/issues/2655", "user": "codelipenghui", "labels": ["component/client", "type/bug"], "created": "2018-09-26 03:39:53", "closed": "2018-09-26 21:36:17", "commits": {"e809faa9f47f6a39a9d7d611daa320b7edb43b3b": {"commitGHEventType": "referenced", "commitUser": "jiazhai"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "e809faa9f47f6a39a9d7d611daa320b7edb43b3b", "commitGHEventType": "referenced", "commitUser": "jiazhai", "commitParents": ["3da0c9844dc5b8bf59df42e3a95bc618a1c7cf32"], "nameRev": "e809faa9f47f6a39a9d7d611daa320b7edb43b3b tags/v2.2.0-candidate-1~67", "commitMessage": "Fix Bug of ConsumerInterceptor on method onAcknowledge() (#2656)\n\nMotivation\r\nTo fix bug for #2655\r\n\r\nModifications\r\nAdd call interceptor logic in markAckForBatchMessage method.\r\n\r\nResult\r\nConsumer acknowledge the batch message will call onAcknowledge() for every messages in batch message.\r\n\r\n", "commitDateTime": "2018-09-26 22:18:26", "authoredDateTime": "2018-09-26 22:18:26", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 2, "deletions": 0, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.markAckForBatchMessage(org.apache.pulsar.client.impl.BatchMessageIdImpl,org.apache.pulsar.common.api.proto.PulsarApi.CommandAck.AckType,java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "NullPointerException at closing consumer", "body": "*Problem*\r\n\r\n```\r\nStacktrace\r\njava.lang.NullPointerException\r\n\tat org.apache.pulsar.client.impl.ConsumerImpl.closeAsync(ConsumerImpl.java:696)\r\n\tat org.apache.pulsar.client.impl.ConsumerBase.close(ConsumerBase.java:284)\r\n\tat org.apache.pulsar.client.api.ServiceUrlProviderTest.testCreateClientWithAutoChangedServiceUrlProvider(ServiceUrlProviderTest.java:115)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124)\r\n\tat org.testng.internal.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:54)\r\n\tat org.testng.internal.InvokeMethodRunnable.run(InvokeMethodRunnable.java:44)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```", "url": "https://github.com/apache/pulsar/issues/2639", "user": "sijie", "labels": ["component/client", "type/bug"], "created": "2018-09-22 18:49:40", "closed": "2018-09-26 21:47:10", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "com.fasterxml.jackson.databind.JsonMappingException: Infinite recursion", "body": "*Problem*\r\n\r\nFollowing stack trace was seen in CI\r\n\r\n```\r\n22:58:30.363 [pulsar-client-io-58-1:org.apache.pulsar.client.impl.ProducerStatsRecorderImpl@104] ERROR org.apache.pulsar.client.impl.ProducerStatsRecorderImpl - Failed to dump config info: {}\r\ncom.fasterxml.jackson.databind.JsonMappingException: Infinite recursion (StackOverflowError) (through reference chain: org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]-\r\n```", "url": "https://github.com/apache/pulsar/issues/2638", "user": "sijie", "labels": ["component/client", "component/stats", "type/bug"], "created": "2018-09-22 18:49:04", "closed": "2018-09-24 23:31:58", "commits": {"1905133edeea0c45b9812e28022c3820a45d4627": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "1905133edeea0c45b9812e28022c3820a45d4627", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["a911890a6ffea72eb7bae81ae97d57c3f1ff3fcb"], "nameRev": "1905133edeea0c45b9812e28022c3820a45d4627 tags/v2.2.0-candidate-1~83", "commitMessage": "Issue #2638: com.fasterxml.jackson.databind.JsonMappingException: Infinite recursion (#2644)\n\n*Motivation*\r\n\r\nFixes #2638.\r\n\r\n```\r\n22:58:30.363 [pulsar-client-io-58-1:org.apache.pulsar.client.impl.ProducerStatsRecorderImpl@104] ERROR org.apache.pulsar.client.impl.ProducerStatsRecorderImpl - Failed to dump config info: {}\r\ncom.fasterxml.jackson.databind.JsonMappingException: Infinite recursion (StackOverflowError) (through reference chain: org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]->org.apache.pulsar.client.impl.conf.ClientConfigurationData[\"serviceUrlProvider\"]->org.apache.pulsar.client.api.ServiceUrlProviderTest$AutoChangedServiceUrlProvider[\"pulsarClient\"]->org.apache.pulsar.client.impl.PulsarClientImpl[\"conf\"]-\r\n```\r\n\r\nThe problem is in the TestServiceUrlProvider it includes PulsarClient again, which will cause recursive reference.\r\n\r\n*Changes*\r\n\r\nAdd `@JsonIgnore` to ignore serviceUrlProvider", "commitDateTime": "2018-09-24 16:31:57", "authoredDateTime": "2018-09-24 16:31:57", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/conf/ClientConfigurationData.java", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ClientConfigurationData.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.conf.ClientConfigurationData", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Fail to deploy on Kubernetes cluster", "body": "#### Expected behavior\r\n$ alias pulsar-admin='kubectl exec pulsar-admin -it -- bin/pulsar-admin'\r\n$ pulsar-admin properties create prop \\\r\n  --admin-roles admin \\\r\n  --allowed-clusters us-central\r\n\r\nTell us what should happen\r\nThis command will create a property called prop\r\n\r\n#### Actual behavior\r\n\r\nTell us what happens instead\r\n\r\nGot:\r\n\r\n```\r\nError: Could not find or load main class \"\r\ncommand terminated with exit code 1\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\nHow can we reproduce the issue\r\nJust follow the doc: \r\nhttps://pulsar.incubator.apache.org/docs/v2.0.1-incubating/deployment/Kubernetes/#Localcluster-1w5r1b\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.0.1\r\n", "url": "https://github.com/apache/pulsar/issues/2589", "user": "wanlwanl", "labels": ["component/cli", "component/deploy", "type/bug", "type/question"], "created": "2018-09-15 10:46:27", "closed": "2018-09-26 07:51:56", "commits": {}, "ttf": 10.000277777777777, "commitsDetails": []}, {"title": "unacked message is not redelivered in setting ackTimeout", "body": "#### Expected behavior\r\n\r\nunacked message is not redelivered in setting ackTimeout\r\n\r\n#### Actual behavior\r\nunacked message is not redelivered in setting ackTimeout\r\n\r\n#### Steps to reproduce\r\n- create topic, producer and consumer, set consumer acktimeout\r\n- call consumer.receive(), and not ack the received message.\r\n- expected the message be redelivered after acktimeout; but actually not. \r\nit is actually redelivered after 2*acktimeout\r\n\r\n#### System configuration\r\n2.1", "url": "https://github.com/apache/pulsar/issues/2584", "user": "jiazhai", "labels": ["component/client", "type/bug"], "created": "2018-09-14 14:57:55", "closed": "2018-09-20 07:44:24", "commits": {"0ab2325fa33231f1c69782e081483012467dfcab": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "0ab2325fa33231f1c69782e081483012467dfcab", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["40ed8e45256518e7b751cc3206624a1ab131f8f6"], "nameRev": "0ab2325fa33231f1c69782e081483012467dfcab tags/v2.2.0-candidate-1~97", "commitMessage": "Issue #2584: unacked message is not redelivered on time (#2590)\n\n### Motivation\r\n\r\nunacked message is not redelivered after setting ackTimeout, but it is actually redelivered after 2*acktimeout.\r\n\r\nThe main reason is in UnAckedMessageTracker.\r\n```\r\n    public void start(PulsarClientImpl client, ConsumerBase<?> consumerBase, long ackTimeoutMillis) {\r\n        this.stop();\r\n        timeout = client.timer().newTimeout(new TimerTask() {\r\n            @Override\r\n            public void run(Timeout t) throws Exception {\r\n                if (isAckTimeout()) {   < === first timeout, it is false, because oldOpenSet is empty.\r\n                    log.warn(\"[{}] {} messages have timed-out\", consumerBase, oldOpenSet.size());\r\n                    Set<MessageId> messageIds = new HashSet<>();\r\n                    oldOpenSet.forEach(messageIds::add);\r\n                    oldOpenSet.clear();\r\n                    consumerBase.redeliverUnacknowledgedMessages(messageIds);\r\n                }\r\n                toggle();    < === toggle after timeout\r\n                timeout = client.timer().newTimeout(this, ackTimeoutMillis, TimeUnit.MILLISECONDS);\r\n            }\r\n        }, ackTimeoutMillis, TimeUnit.MILLISECONDS);\r\n    }\r\n```\r\nbefore first timeout, all messageId was added in CurrentSet, not in OldOpenSet, so isAckTimeout() is false, and `redeliverUnacknowledgedMessages` was not called at first timeout.\r\n\r\nRelated issue: #2584 \r\n\r\n### Modifications\r\n\r\n- move `toggle()` from behind if clause to before if clause.\r\n- add ut\r\n\r\n### Result\r\n\r\nut passed\r\n", "commitDateTime": "2018-09-20 00:44:04", "authoredDateTime": "2018-09-20 15:44:04", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerStatTest.java", "insertions": 0, "deletions": 1, "lines": 1}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java", "insertions": 47, "deletions": 0, "lines": 47}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/UnAcknowledgedMessagesTimeoutTest.java", "insertions": 17, "deletions": 41, "lines": 58}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/UnAckedMessageTracker.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SimpleProducerConsumerStatTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerStatTest.testAsyncProducerAndReceiveAsyncAndAsyncAck(int,int)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "SimpleProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testAckTimeoutRedeliver()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "UnAcknowledgedMessagesTimeoutTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.UnAcknowledgedMessagesTimeoutTest.receiveAllMessage(org.apache.pulsar.client.api.Consumer,boolean)", "TOT": 7, "UPD": 3, "INS": 2, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.UnAcknowledgedMessagesTimeoutTest.testFailoverSingleAckedPartitionedTopic()", "TOT": 41, "UPD": 7, "INS": 6, "MOV": 15, "DEL": 13}]}, {"spoonFilePath": "UnAckedMessageTracker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.UnAckedMessageTracker.start(org.apache.pulsar.client.impl.PulsarClientImpl,org.apache.pulsar.client.impl.ConsumerBase,long).1.run(io.netty.util.Timeout)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Schema javadoc missing from client api docs", "body": "http://pulsar.apache.org/api/client/ mentions passing a schema on constructor creating, but there's no linkage to JSONSchema or AVROSchema and the javadoc for these classes doesn't exist.", "url": "https://github.com/apache/pulsar/issues/2582", "user": "ivankelly", "labels": ["component/documentation", "type/bug"], "created": "2018-09-14 10:15:55", "closed": "2018-11-28 22:51:29", "commits": {"5858df0d22fcbcf6c52110d05d8c2875bd9ae80c": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 75.00027777777778, "commitsDetails": [{"commitHash": "5858df0d22fcbcf6c52110d05d8c2875bd9ae80c", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["aaf199663ab7debf674d8de71c76bc126b627e88"], "nameRev": "5858df0d22fcbcf6c52110d05d8c2875bd9ae80c tags/v2.3.0-candidate-1~337", "commitMessage": "Issue #2582: Schema javadoc missing from client api docs (#3086)\n\n*Motivation*\r\n\r\nFixes #2582\r\n\r\nSchema javadoc is missing from client api docs", "commitDateTime": "2018-11-28 14:51:28", "authoredDateTime": "2018-11-28 14:51:28", "commitGitStats": [{"filePath": "site/Makefile", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site/scripts/javadoc-gen.sh", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Timeout message not get redeliver in TopicsConsumer when use message listener", "body": "#### Expected behavior\r\n\r\nTimeout message get redeliver in TopicsConsumer when use message listener\r\n\r\n#### Actual behavior\r\n\r\nTimeout message not get redeliver in TopicsConsumer when use message listener\r\n\r\n#### Steps to reproduce\r\nHere is an simple UT\r\n```\r\n   @Test(timeOut = 30000)\r\n    public void testMultiTopicsMessageListener() throws Exception {\r\n        String key = \"MultiTopicsMessageListenerTest\";\r\n        final String subscriptionName = \"my-ex-subscription-\" + key;\r\n        final String messagePredicate = \"my-message-\" + key + \"-\";\r\n        final int totalMessages = 6;\r\n\r\n        // set latch larger than totalMessages, so timeout message get resend\r\n        CountDownLatch latch = new CountDownLatch(totalMessages * 3);\r\n\r\n        final String topicName1 = \"persistent://prop/use/ns-abc/topic-1-\" + key;\r\n        List<String> topicNames = Lists.newArrayList(topicName1);\r\n\r\n        admin.tenants().createTenant(\"prop\", new TenantInfo());\r\n        admin.topics().createPartitionedTopic(topicName1, 2);\r\n\r\n        // 1. producer connect\r\n        Producer<byte[]> producer1 = pulsarClient.newProducer().topic(topicName1)\r\n            .enableBatching(false)\r\n            .messageRoutingMode(MessageRoutingMode.SinglePartition)\r\n            .create();\r\n\r\n        // 2. Create consumer, set not ack in message listener, so time-out message will resend\r\n        Consumer<byte[]> consumer = pulsarClient.newConsumer()\r\n            .topics(topicNames)\r\n            .subscriptionName(subscriptionName)\r\n            .subscriptionType(SubscriptionType.Shared)\r\n            .ackTimeout(1000, TimeUnit.MILLISECONDS)\r\n            .receiverQueueSize(4)\r\n            .messageListener((c1, msg) -> {\r\n                Assert.assertNotNull(msg, \"Message cannot be null\");\r\n                String receivedMessage = new String(msg.getData());\r\n                latch.countDown();\r\n\r\n                log.info(\"Received message [{}] in the listener, latch: {}\",\r\n                    receivedMessage, latch.getCount());\r\n                // since not acked, it should retry another time\r\n                //c1.acknowledgeAsync(msg);\r\n            })\r\n            .subscribe();\r\n        assertTrue(consumer instanceof MultiTopicsConsumerImpl);\r\n\r\n        MultiTopicsConsumerImpl topicsConsumer = (MultiTopicsConsumerImpl) consumer;\r\n\r\n        // 3. producer publish messages\r\n        for (int i = 0; i < totalMessages; i++) {\r\n            producer1.send((messagePredicate + \"producer1-\" + i).getBytes());\r\n        }\r\n\r\n        // verify should not time out.\r\n        latch.await();\r\n\r\n        consumer.close();\r\n    }\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/2574", "user": "jiazhai", "labels": ["component/client", "type/bug"], "created": "2018-09-13 15:13:25", "closed": "2018-09-19 21:43:19", "commits": {"ec7435565520ee6ac3ed2ce4a0cd13e8de7dbca3": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "ec7435565520ee6ac3ed2ce4a0cd13e8de7dbca3", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["07d42261eb2d685de6f9a5ab214f4d08944ffb6e"], "nameRev": "ec7435565520ee6ac3ed2ce4a0cd13e8de7dbca3 tags/v2.2.0-candidate-1~124", "commitMessage": "Issue #2574: Timeout message not get redeliver in TopicsConsumer when use message listener\n\n### Motivation\r\n\r\nfix issue #2574 .\r\nTimeout message not get redeliver in TopicsConsumer when use message listener.\r\nThis is caused by message listener wrongly set in individual sub-ConsumerImpl.\r\n\r\n### Modifications\r\n\r\nset message listener to null for individual sub-ConsumerImpl.\r\nAdd a UT\r\n\r\n### Result\r\n\r\nUT passed.\r\n", "commitDateTime": "2018-09-14 09:15:13", "authoredDateTime": "2018-09-15 00:15:13", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/TopicsConsumerImplTest.java", "insertions": 58, "deletions": 0, "lines": 58}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "TopicsConsumerImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TopicsConsumerImplTest.testMultiTopicsMessageListener()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.getInternalConsumerConfig()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["ec7435565520ee6ac3ed2ce4a0cd13e8de7dbca3"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 1, "deletions": 0, "lines": 1, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["pulsar-client/src/main/java/org/apache/pulsar/client/impl"], "changesInPackagesSPOON": ["org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.getInternalConsumerConfig()"]}, {"title": "Wrong zookeeper server names are used in zookeeper helm charts.", "body": "#### Expected behavior\r\n\r\nBy using kubernetes/helm deployment, expect zookeeper to start successfully and the other services can connect to zookeeper correctly.\r\n\r\n#### Actual behavior\r\n\r\nzookeeper did not config and start successfully:\r\n```\r\n\"04:11:45.058 [main] INFO  org.apache.pulsar.zookeeper.ZooKeeperStarter - Starting ZK stats HTTP server at port 8000\"\r\n\"04:11:45.080 [main] INFO  org.eclipse.jetty.util.log - Logging initialized @1887ms\"\r\n\"04:11:45.158 [main] INFO  org.eclipse.jetty.server.Server - jetty-9.3.11.v20160721\"\r\n\"04:11:45.201 [main] INFO  org.eclipse.jetty.server.handler.ContextHandler - Started o.e.j.s.ServletContextHandler@7ac2e39b{/,null,AVAILABLE}\"\r\n\"04:11:45.222 [main] INFO  org.eclipse.jetty.server.AbstractConnector - Started ServerConnector@1a45193b{HTTP/1.1,[http/1.1]}{0.0.0.0:8000}\"\r\n\"04:11:45.223 [main] INFO  org.eclipse.jetty.server.Server - Started @2031ms\"\r\n\"04:11:45.228 [main] INFO  org.apache.zookeeper.server.quorum.QuorumPeerConfig - Reading configuration from: /pulsar/conf/zookeeper.conf\"\r\n\"04:11:45.230 [main] WARN  org.apache.zookeeper.server.quorum.QuorumPeerConfig - data/zookeeper is relative. Prepend ./ to indicate that you're sure!\"\r\n\"04:11:45.230 [main] INFO  org.apache.zookeeper.server.quorum.QuorumPeerConfig - clientPortAddress is 0.0.0.0/0.0.0.0:2181\"\r\n\"04:11:45.230 [main] INFO  org.apache.zookeeper.server.quorum.QuorumPeerConfig - secureClientPort is not set\"\r\n\"04:11:45.262 [main] ERROR org.apache.zookeeper.server.quorum.QuorumPeerMain - Invalid config, exiting abnormally\"\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\n```\r\ncd deployment/kubernetes/helm\r\nhelm package pulsar\r\n<upload chart>\r\nhelm install --name pulsar\r\n```\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.1 and latest on master\r\n", "url": "https://github.com/apache/pulsar/issues/2522", "user": "vli02", "labels": ["component/deploy", "type/bug"], "created": "2018-09-05 18:38:30", "closed": "2019-07-21 07:39:05", "commits": {}, "ttf": 318.0002777777778, "commitsDetails": []}, {"title": "Go client reader hang when processing backlog of ~6M messages", "body": "#### Expected behavior\r\n\r\nThe reader should read all topic messages and then continue to follow the topic\r\n\r\n#### Actual behavior\r\n\r\nThe reader reads approximately 230K messages and then the following call to Next blocks forever.\r\n\r\n#### Steps to reproduce\r\n\r\nI have a topic configured with infinite retention which I've loaded approx 6M ~60 byte messages into. This topic is fed with a new test message every second by a producer.\r\n\r\nI've use the following python code which gives me the result I would expect.\r\n```python\r\nimport pulsar, time\r\n\r\nclient = pulsar.Client('pulsar://localhost:6650')\r\nreader = client.create_reader('positions', pulsar.MessageId.earliest)\r\n\r\ni = 0\r\n\r\nwhile True:\r\n    reader.read_next()\r\n    i+=1\r\n    print(f\"{time.time()}: {i}\")\r\n```\r\nWhich outputs this  - all the backlog is read and then new messages as they come in:\r\n```\r\n<snip>\r\n1536138110.039305: 6332371\r\n1536138110.0393229: 6332372\r\n1536138110.0393403: 6332373\r\n1536138110.0393577: 6332374\r\n1536138110.039375: 6332375\r\n1536138110.0393927: 6332376\r\n1536138110.114043: 6332377\r\n1536138111.1111479: 6332378\r\n1536138112.1161785: 6332379\r\n1536138113.1167316: 6332380\r\n1536138114.1186855: 6332381\r\n1536138115.1202247: 6332382\r\n```\r\n\r\nThe problematic Go code is:\r\n```golang\r\npackage main\r\n\r\nimport (\r\n\t\"log\"\r\n\r\n\t\"github.com/apache/incubator-pulsar/pulsar-client-go/pulsar\"\r\n)\r\n\r\nfunc main() {\r\n\tlog.SetFlags(log.LstdFlags | log.Lmicroseconds)\r\n\tclient, err := pulsar.NewClient(pulsar.ClientOptions{\r\n\t\tURL: \"pulsar://localhost:6650\",\r\n\t\tOperationTimeoutSeconds: 120,\r\n\t})\r\n\r\n\tif err != nil {\r\n\t\tlog.Fatalf(\"Could not instantiate Pulsar client: %v\", err)\r\n\t}\r\n\r\n\tmsgChannel := make(chan pulsar.ReaderMessage)\r\n\r\n\treader, err := client.CreateReader(pulsar.ReaderOptions{\r\n\t\tTopic:          \"positions\",\r\n\t\tStartMessageID: pulsar.EarliestMessage,\r\n\t\tName:           \"go_reader\",\r\n\t\tMessageChannel: msgChannel,\r\n\t})\r\n\r\n\tif err != nil {\r\n\t\tlog.Fatalf(\"Could not instantiate Pulsar client: %v\", err)\r\n\t}\r\n\r\n\tdefer reader.Close()\r\n\r\n\ti := 0\r\n\tfor cm := range msgChannel {\r\n\t\ti++\r\n\t\t_ = cm.Message\r\n\r\n\t\tlog.Printf(\"%d\\n\", i)\r\n\t}\r\n}\r\n```\r\n\r\nAnd outputs the following: note that most of the messages are not received and the process hangs.\r\n```\r\n<snip>\r\n2018/09/05 10:08:04.674907 153036\r\n2018/09/05 10:08:04.674931 153037\r\n2018/09/05 10:08:04.674936 153038\r\n2018/09/05 10:08:04.675011 153039\r\n2018/09/05 10:08:04.675016 153040\r\n2018/09/05 10:08:04.675044 153041\r\n2018/09/05 10:08:04.675048 153042\r\n2018/09/05 10:08:04.675070 153043\r\n2018/09/05 10:08:04.675079 153044\r\n2018/09/05 10:08:04.675102 153045\r\n2018/09/05 10:08:04.675110 153046\r\n2018/09/05 10:08:04.675137 153047\r\n2018/09/05 10:08:04.675141 153048\r\n<hangs here>\r\n```\r\nThe number of messages received before hanging seems to depend on wall time - if I remove the log calls I get about 250K.\r\n\r\nWhen running the Go code I eventually get the following in my pulsar log:\r\n```\r\n10:09:01.340 [pulsar-io-48-11] WARN  org.apache.pulsar.common.api.PulsarHandler - [[id: 0xcb26b3aa, L:/127.0.0.1:6650 - R:/127.0.0.1:35682]] Forcing connection to close after keep-alive timeout\r\n10:09:01.341 [pulsar-io-48-11] INFO  org.apache.pulsar.broker.service.ServerCnx - Closed connection from /127.0.0.1:35682\r\n10:09:01.342 [pulsar-io-48-12] WARN  org.apache.pulsar.common.api.PulsarHandler - [[id: 0x894e4202, L:/127.0.0.1:6650 - R:/127.0.0.1:35684]] Forcing connection to close after keep-alive timeout\r\n10:09:01.343 [pulsar-io-48-12] INFO  org.apache.pulsar.broker.service.ServerCnx - Closed connection from /127.0.0.1:35684\r\n10:09:01.343 [pulsar-io-48-12] INFO  org.apache.pulsar.broker.service.AbstractDispatcherSingleActiveConsumer - Removing consumer Consumer{subscription=PersistentSubscription{topic=persistent://public/default/positions, name=reader-4a7656}, consumerId=0, consumerName=go_reader, address=/127.0.0.1:35684}\r\n```\r\n\r\nHope all this is helpful, I'll keep looking into it on my end but I'm unfamiliar with Go wrapping cpp so will be slow.\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.1.0-incubating w/ standard standalone config and operating mode\r\n**OS**: Ubuntu 18.04 w/ Oracle Java 8\r\n", "url": "https://github.com/apache/pulsar/issues/2521", "user": "blutack", "labels": ["component/go", "type/bug"], "created": "2018-09-05 09:28:10", "closed": "2018-09-06 14:40:24", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Trigger function not update function metrics correctly", "body": "When running a pulsar function and triggering it via command line the metrics of the function are not updated correctly.\r\n\r\n```\r\n  \"functionStatusList\": [\r\n    {\r\n      \"running\": true,\r\n      \"instanceId\": \"0\",\r\n      \"metrics\": {\r\n        \"metrics\": {\r\n          \"__total_system_exceptions__\": {},\r\n          \"__avg_latency_ms__\": {},\r\n          \"__total_serialization_exceptions__\": {},\r\n          \"__total_processed__\": {},\r\n          \"__total_successfully_processed__\": {},\r\n          \"__total_user_exceptions__\": {}\r\n        }\r\n      },\r\n      \"workerId\": \"pulsar-functions-worker-1\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nThe expected behaviors is to have a \r\nnumProcessed and numSuccessfullyProcessed json entry with the correct value\r\n", "url": "https://github.com/apache/pulsar/issues/2495", "user": "aahmed-se", "labels": ["component/functions", "type/bug"], "created": "2018-08-30 22:18:52", "closed": "2018-09-10 18:07:57", "commits": {}, "ttf": 10.000277777777777, "commitsDetails": []}, {"title": "`./bin/pulsar-admin clusters list` failed with `Error: Could not find or load main class \"`", "body": "#### Expected behavior\r\n\r\nExpect to list the clusters I have created.\r\n\r\n#### Actual behavior\r\n\r\nIt failed with Error: Could not find or load main class \"\r\n\r\n#### Steps to reproduce\r\n\r\n* Deploy pulsar in a k8s cluster by using helm charts.\r\n* kubectl exec -ti -n ... pulsar-broker-... bash\r\n* ./bin/pulsar-admin clusters list\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.1.0-incubating\r\n\r\nWe find the problem is the conf/pulsar_tool_env.sh, the `PULSAR_MEM=${PULSAR_MEM:-\"-Xmx256m -XX:MaxDirectMemorySize=256m\"}`\r\nIt should not take the PULSAR_MEM from env, it caused the actual command to exec to be:\r\n\r\n```exec /docker-java-home/bin/java -cp '/pulsar/conf:::/pulsar/lib/*:' -Dlog4j.configurationFile=log4j2.yaml -Djava.net.preferIPv4Stack=true '\"' -Xms1g -Xmx1g '-XX:MaxDirectMemorySize=1g\"' -client -Dio.netty.leakDetectionLevel=disabled -Dpulsar.log.appender=RoutingAppender -Dpulsar.log.dir=/pulsar/logs -Dpulsar.log.level=info -Dpulsar.routing.appender.default=Console -Dpulsar.functions.java.instance.jar=/pulsar/instances/java-instance.jar -Dpulsar.functions.python.instance.file=/pulsar/instances/python-instance/python_instance_main.py org.apache.pulsar.admin.cli.PulsarAdminTool /pulsar/conf/client.conf clusters list```\r\n\r\nThe problem is fixed with the following fix:\r\n```diff conf/pulsar_tools_env.sh.orig conf/pulsar_tools_env.sh\r\n45c45\r\n< PULSAR_MEM=${PULSAR_MEM:-\"-Xmx256m -XX:MaxDirectMemorySize=256m\"}\r\n---\r\n> PULSAR_MEM=\"-Xmx256m -XX:MaxDirectMemorySize=256m\"\r\n```", "url": "https://github.com/apache/pulsar/issues/2481", "user": "vli02", "labels": ["type/bug", "type/enhancement"], "created": "2018-08-30 00:48:36", "closed": "2018-09-01 07:09:31", "commits": {"cfdcdb5c096918187ab52725ba091c401f28b62c": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "588f6f2c5d32288e7404bbbbeb5049ac03dc0697": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "cfdcdb5c096918187ab52725ba091c401f28b62c", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["42b598a17b64d76428d48438cfb169cf3a1fcd5d"], "nameRev": "cfdcdb5c096918187ab52725ba091c401f28b62c tags/v2.2.0-candidate-1~183", "commitMessage": "Fixed the issue 2481 by not to take PULSAR_MEM from env. (#2484)\n\n### Motivation\r\n\r\nCommand `./bin/pulsar-admin clusters list` failed with `Error: Could not find or load main class \"` in my k8s deployment by using helm charts.\r\n\r\n### Modifications\r\n\r\nWith helm deployment the env var PULSAR_MEM is quoted with `\"`, taking it for `pulsar-admin` will make the exec command to be:\r\n\r\n```exec /docker-java-home/bin/java -cp '/pulsar/conf:::/pulsar/lib/*:' -Dlog4j.configurationFile=log4j2.yaml -Djava.net.preferIPv4Stack=true '\"' -Xms1g -Xmx1g '-XX:MaxDirectMemorySize=1g\"' -client -Dio.netty.leakDetectionLevel=disabled ... org.apache.pulsar.admin.cli.PulsarAdminTool /pulsar/conf/client.conf clusters list```\r\n\r\nThe fix is to take out the use of env var PULSAR_MEM in `conf/pulsar_tools_env.sh`.\r\n\r\n### Result\r\n\r\n`pulsar-admin` works as expected.\r\n\r\nFixes #2481", "commitDateTime": "2018-09-01 00:09:30", "authoredDateTime": "2018-09-01 00:09:30", "commitGitStats": [{"filePath": "conf/pulsar_tools_env.sh", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "588f6f2c5d32288e7404bbbbeb5049ac03dc0697", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["5d7760a663a101396c25f105a4ae7a01bd77d533"], "nameRev": "588f6f2c5d32288e7404bbbbeb5049ac03dc0697 tags/v2.1.1-incubating-candidate-1~14", "commitMessage": "Fixed the issue 2481 by not to take PULSAR_MEM from env. (#2484)\n\n ### Motivation\n\nCommand `./bin/pulsar-admin clusters list` failed with `Error: Could not find or load main class \"` in my k8s deployment by using helm charts.\n\n ### Modifications\n\nWith helm deployment the env var PULSAR_MEM is quoted with `\"`, taking it for `pulsar-admin` will make the exec command to be:\n\n```exec /docker-java-home/bin/java -cp '/pulsar/conf:::/pulsar/lib/*:' -Dlog4j.configurationFile=log4j2.yaml -Djava.net.preferIPv4Stack=true '\"' -Xms1g -Xmx1g '-XX:MaxDirectMemorySize=1g\"' -client -Dio.netty.leakDetectionLevel=disabled ... org.apache.pulsar.admin.cli.PulsarAdminTool /pulsar/conf/client.conf clusters list```\n\nThe fix is to take out the use of env var PULSAR_MEM in `conf/pulsar_tools_env.sh`.\n\n ### Result\n\n`pulsar-admin` works as expected.\n\nFixes #2481\n", "commitDateTime": "2018-09-01 00:11:14", "authoredDateTime": "2018-09-01 00:09:30", "commitGitStats": [{"filePath": "conf/pulsar_tools_env.sh", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Unable to consume messages, need to re-subscribe client", "body": "This is similar to issue [2013](https://github.com/apache/incubator-pulsar/issues/2013). We have several shared subscriptions of partitioned topics and we found some cases where a subscription's client is not receiving messages, but it's not related to a specific topic partition. \r\nIn this case, if we re-subscribe the client (`PulsarClient.subscribeAsync`), messages start to be delivered as expected.\r\n\r\nClient logs this warn:\r\n```\r\n[log_time:16:17:42.377] [thread:pulsar-timer-6-1] [level:WARN ] [logger:UnAckedMessageTracker] - [ConsumerBase{subscription='picking-consumer-prod.fbm-wms-picking', consumerName='i-08e97d991d75e9d07-10.73.125.156', topic='persistent://fury/global/wms-wave-feed-prod.fbm-wms-picking/wms-wave-feed-prod.fbm-wms-picking'}] 1 messages have timed-out\r\n```\r\n\r\nAnd we don't see any error from brokers.\r\n\r\nAny idea? Any log or metric that may be useful to debug this problem?\r\n\r\n#### System configuration\r\n**Pulsar version (brokers)**: 1.20.0\r\n**Pulsar clients version**: 1.22.0\r\n**Bookkeeper version**: 4.7.1", "url": "https://github.com/apache/pulsar/issues/2431", "user": "bardock", "labels": ["triage/week-24", "type/bug"], "created": "2018-08-23 17:13:07", "closed": "2020-07-02 07:47:51", "commits": {}, "ttf": 678.0002777777778, "commitsDetails": []}, {"title": "Namespaces admin commands should be able to distinguish v1 and v2 namespace format", "body": "#### Expected behavior\r\n\r\n- setup a 2.0.0 cluster\r\n- enable backlog : set-backlog-quotas test-tenant/test-cluster/ns1 --limit 500G --policy producer_exception\r\n- run perf: pulsar-perf produce persistent://test-tenant/test-cluster/ns1/test-topic\r\n- pulsar perf should be able to produce 500G data\r\n\r\n#### Actual behavior\r\n\r\n- pulsar perf encounters backlog exception when producing around ~10GB data\r\n\r\n#### Steps to reproduce\r\n\r\nas described in \"expected behavior\"\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.0.0\r\n", "url": "https://github.com/apache/pulsar/issues/2430", "user": "sijie", "labels": ["type/bug"], "created": "2018-08-23 09:29:18", "closed": "2018-11-07 17:28:19", "commits": {}, "ttf": 76.00027777777778, "commitsDetails": []}, {"title": "Make sure pulsar configuration files in-sync with the configuration definitions", "body": "### Problem\r\n\r\nIt seems that following settings are missing at `proxy.conf`.\r\n\r\n```\r\nbrokerServiceURL=pulsar://broker:6650\r\nbrokerServiceURLTLS=pulsar+ssl://broker:6651\r\nwebServiceURL=http://broker:9101\r\nwebServiceURLTLS=https://broker:8443\r\n```\r\n\r\nWe need to make sure pulsar configuration files are in-sync with the configuration definitions in the code.", "url": "https://github.com/apache/pulsar/issues/2407", "user": "sijie", "labels": ["component/config", "type/bug"], "created": "2018-08-20 17:57:08", "closed": "2019-01-23 15:35:22", "commits": {}, "ttf": 155.00027777777777, "commitsDetails": []}, {"title": "Document configuring the proxy without service discovery", "body": "Feature was added in #1002 \r\n\r\nConfiguring without service discovery is basically configuring with a broker URL rather than zookeeper. Should mention VIPs and why you would want to do this.\r\n\r\nVerify that it works (binary and http protocol, TLS and non-TLS) and add documentation on how to enable in \r\nhttp://pulsar.apache.org/docs/en/administration-proxy/", "url": "https://github.com/apache/pulsar/issues/2405", "user": "ivankelly", "labels": ["component/documentation", "type/bug"], "created": "2018-08-20 12:43:27", "closed": "2019-05-19 13:39:00", "commits": {"aa3fd10c87f6b2cc0a3d57dd67b4e205bb49a0d0": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 272.0002777777778, "commitsDetails": [{"commitHash": "aa3fd10c87f6b2cc0a3d57dd67b4e205bb49a0d0", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["ef94cb70df08d7e9f16c6415116e729bb6d756ab"], "nameRev": "aa3fd10c87f6b2cc0a3d57dd67b4e205bb49a0d0 tags/v2.3.0-candidate-1~161", "commitMessage": "Integration test and documentation for Proxy w/o ZK (#3352)\n\nAdds an integration test which creates a proxy which connects to the\r\nbrokers using broker URLs rather than service discovery.\r\n\r\nAdds documentation for configuring the proxy in this way.\r\n\r\nIssue: #2405", "commitDateTime": "2019-01-11 10:27:54", "authoredDateTime": "2019-01-11 19:27:54", "commitGitStats": [{"filePath": "site2/docs/administration-proxy.md", "insertions": 43, "deletions": 6, "lines": 49}, {"filePath": "site2/docs/security-authorization.md", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/proxy/TestProxy.java", "insertions": 35, "deletions": 7, "lines": 42}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/topologies/PulsarClusterSpec.java", "insertions": 2, "deletions": 0, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "TestProxy.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.proxy.TestProxy.testProxy()", "TOT": 6, "UPD": 2, "INS": 0, "MOV": 3, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.tests.integration.proxy.TestProxy", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.proxy.TestProxy.beforeSetupCluster(java.lang.String,org.apache.pulsar.tests.integration.topologies.PulsarClusterSpec$PulsarClusterSpecBuilder)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.proxy.TestProxy.testProxyWithServiceDiscovery()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.proxy.TestProxy.testProxyWithNoServiceDiscoveryProxyConnectsViaURL()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.proxy.TestProxy.testProxy(java.lang.String,java.lang.String)", "TOT": 5, "UPD": 0, "INS": 5, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarClusterSpec.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.topologies.PulsarClusterSpec", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Document proxy auth data forwarding", "body": "Added in #1169\r\n\r\nWhich auth providers does it work for? How does it interact with proxy roles?\r\n\r\nEnsure that it is supported in both the binary and http protocols.\r\n\r\nWould probably be best if this was picked up by someone who with with Athenz.", "url": "https://github.com/apache/pulsar/issues/2404", "user": "ivankelly", "labels": ["component/documentation", "component/proxy", "triage/week-45", "type/bug"], "created": "2018-08-20 12:31:01", "closed": "2020-06-22 03:58:14", "commits": {}, "ttf": 671.0002777777778, "commitsDetails": []}, {"title": "Document hostname verification in TLS transport docs", "body": "#1208 Added the feature.\r\n\r\nVerify that it works, and add documentation to http://pulsar.apache.org/docs/en/security-tls-transport/\r\n\r\nIt is already mentioned in passing, but we should be more explicit.", "url": "https://github.com/apache/pulsar/issues/2403", "user": "ivankelly", "labels": ["component/documentation", "type/bug"], "created": "2018-08-20 12:26:25", "closed": "2018-10-17 15:02:39", "commits": {"c8488605d45606ecc8e2e6f50318fee9c3dbfb9a": {"commitGHEventType": "closed", "commitUser": "sijie"}}, "ttf": 58.000277777777775, "commitsDetails": [{"commitHash": "c8488605d45606ecc8e2e6f50318fee9c3dbfb9a", "commitGHEventType": "closed", "commitUser": "sijie", "commitParents": ["15fbfee9a0dbc266083b1f96b99f882c7f992ce4"], "nameRev": "c8488605d45606ecc8e2e6f50318fee9c3dbfb9a tags/v2.3.0-candidate-1~534", "commitMessage": "Document TLS hostname verification option (#2403) (#2794)\n\nInform the user why it is disabled by default and in which scenarios\r\nthey should enable it.\r\n\r\nMaster issue: #2403\r\n\r\nFixes #2403", "commitDateTime": "2018-10-17 23:02:32", "authoredDateTime": "2018-10-17 17:02:32", "commitGitStats": [{"filePath": "site2/docs/security-tls-transport.md", "insertions": 17, "deletions": 3, "lines": 20}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Document TLS version and ciphersuite configuration for server and proxy", "body": "#1225 added support for specifying the TLS version and ciphersuite to use when configuring the proxy and broker. However, this is not documented in the respective configuration files, nor in the user documents. We should add such docs (and verify that they take effect).", "url": "https://github.com/apache/pulsar/issues/2402", "user": "ivankelly", "labels": ["component/documentation", "type/bug"], "created": "2018-08-20 12:17:32", "closed": "2018-11-28 21:50:19", "commits": {"ff76bd7ee65dc78aab3745977070a88fd82a51ca": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 100.00027777777778, "commitsDetails": [{"commitHash": "ff76bd7ee65dc78aab3745977070a88fd82a51ca", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["0b57b3c864c55f72c5bd8c197dbb594f3e79e92a"], "nameRev": "ff76bd7ee65dc78aab3745977070a88fd82a51ca tags/v2.3.0-candidate-1~352", "commitMessage": "Documentation for TLS protocol version and ciphers (#3057)\n\nPR #1225 added the ability to configure the TLS protocol version and\r\ncipher on the server side, but this was never added to the\r\ndocumentation. This patch fixes that omission.\r\n\r\nIssue: #2402", "commitDateTime": "2018-11-26 10:06:07", "authoredDateTime": "2018-11-26 19:06:07", "commitGitStats": [{"filePath": "site2/docs/reference-configuration.md", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "site2/docs/security-tls-transport.md", "insertions": 17, "deletions": 0, "lines": 17}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Consumer often discards received messages", "body": "When TLS is enabled, consumer often discards received messages. The following is the consumer log when a message is discarded.\r\n\r\n```\r\n17:53:52.113 [pulsar-client-io-1-1] ERROR o.a.pulsar.client.impl.ConsumerImpl - [persistent://xxx/xxx/xxx/xxx][xxx] Discarding corrupted message at 242595:3896\r\n```\r\n\r\nAt this time, an IndexOutOfBoundsException has been thrown at [this line](https://github.com/apache/incubator-pulsar/blob/v2.1.0-incubating/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java#L713).\r\n\r\n```\r\njava.lang.IndexOutOfBoundsException: writerIndex: 1680879946 (expected: readerIndex(23) <= writerIndex <= capacity(870))\r\n        at io.netty.buffer.AbstractByteBuf.writerIndex(AbstractByteBuf.java:118) ~[netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at org.apache.pulsar.common.api.Commands.parseMessageMetadata(Commands.java:271) ~[pulsar-common-2.1.0-incubating.jar:2.1.0-incubating]\r\n        at org.apache.pulsar.client.impl.ConsumerImpl.messageReceived(ConsumerImpl.java:713) ~[pulsar-client-original-2.1.0-incubating.jar:2.1.0-incubating]\r\n        at org.apache.pulsar.client.impl.ClientCnx.handleMessage(ClientCnx.java:275) [pulsar-client-original-2.1.0-incubating.jar:2.1.0-incubating]\r\n        at org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:166) [pulsar-common-2.1.0-incubating.jar:2.1.0-incubating]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:297) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:413) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1389) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.handler.ssl.SslHandler.decodeNonJdkCompatible(SslHandler.java:1171) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1205) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:489) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:428) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:265) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1414) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:945) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:806) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:404) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:304) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [na:1.8.0_171]\r\n```\r\n\r\nIf receiving the discarded messages again by resetting the cursor, this error may not occur.\r\nWhen TLS is disabled, this phenomenon does not seem to occur.\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.1.0-incubating\r\n", "url": "https://github.com/apache/pulsar/issues/2401", "user": "massakam", "labels": ["help wanted", "type/bug"], "created": "2018-08-20 09:23:06", "closed": "2018-08-31 22:39:32", "commits": {"92b809784f631bc6b72cc1116761e8fac02ef41c": {"commitGHEventType": "referenced", "commitUser": "ivankelly"}, "34e9fd6a441ccb5a895562c6872a7ce992cb39b9": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "e0097dfc651dbf20eb067889113711c908692b5f": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 11.000277777777777, "commitsDetails": [{"commitHash": "92b809784f631bc6b72cc1116761e8fac02ef41c", "commitGHEventType": "referenced", "commitUser": "ivankelly", "commitParents": ["c9a369936af3b3ecc663b86ae959a3fbfa627aca"], "nameRev": "92b809784f631bc6b72cc1116761e8fac02ef41c remotes/origin/branch-1.22", "commitMessage": "Copy ByteBufPair buffers when using with SSL (#2401)\n\nThe netty SSL handler uses a coalescing buffer queue, which modifies\nthe buffers used to queue the writes so that SSL_write can be given\nlarger chunks, thereby increasing the 'goodput'.\n\nIf we pass in a retained duplicate as we have been doing until now,\nthen later clients will be passed junk, as SSL will have modified cached\nentry buffers.\n\nThis patch introduces a copying ByteBufPair encoder, which is only\nused with SSL connections.\n", "commitDateTime": "2018-08-28 12:21:53", "authoredDateTime": "2018-08-28 12:21:53", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/PulsarChannelInitializer.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConnectionPool.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/ByteBufPair.java", "insertions": 24, "deletions": 1, "lines": 25}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarChannelInitializer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PulsarChannelInitializer.initChannel(io.netty.channel.socket.SocketChannel)", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ConnectionPool.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConnectionPool.1.initChannel(io.netty.channel.socket.SocketChannel)", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ByteBufPair.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.ByteBufPair", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.ByteBufPair.CopyingEncoder", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "34e9fd6a441ccb5a895562c6872a7ce992cb39b9", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["79b88cf66eb2a4d337e21ade7f699c7d641b5c9a"], "nameRev": "34e9fd6a441ccb5a895562c6872a7ce992cb39b9 tags/v2.2.0-candidate-1~186", "commitMessage": "Copy ByteBufPair buffers when using with SSL (#2401) (#2464)\n\nThe netty SSL handler uses a coalescing buffer queue, which modifies\r\nthe buffers used to queue the writes so that SSL_write can be given\r\nlarger chunks, thereby increasing the 'goodput'.\r\n\r\nIf we pass in a retained duplicate as we have been doing until now,\r\nthen later clients will be passed junk, as SSL will have modified cached\r\nentry buffers.\r\n\r\nThis patch introduces a copying ByteBufPair encoder, which is only\r\nused with SSL connections.", "commitDateTime": "2018-08-31 15:39:31", "authoredDateTime": "2018-09-01 00:39:31", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/PulsarChannelInitializer.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConnectionPool.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/ByteBufPair.java", "insertions": 24, "deletions": 1, "lines": 25}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarChannelInitializer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PulsarChannelInitializer.initChannel(io.netty.channel.socket.SocketChannel)", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ConnectionPool.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConnectionPool.1.initChannel(io.netty.channel.socket.SocketChannel)", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ByteBufPair.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.ByteBufPair", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.ByteBufPair.CopyingEncoder", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "e0097dfc651dbf20eb067889113711c908692b5f", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["bf4a50b45dcaec7bd48b38a739bc4e7d43d36af1"], "nameRev": "e0097dfc651dbf20eb067889113711c908692b5f tags/v2.1.1-incubating-candidate-1~7", "commitMessage": "Copy ByteBufPair buffers when using with SSL (#2401) (#2464)\n\nThe netty SSL handler uses a coalescing buffer queue, which modifies\r\nthe buffers used to queue the writes so that SSL_write can be given\r\nlarger chunks, thereby increasing the 'goodput'.\r\n\r\nIf we pass in a retained duplicate as we have been doing until now,\r\nthen later clients will be passed junk, as SSL will have modified cached\r\nentry buffers.\r\n\r\nThis patch introduces a copying ByteBufPair encoder, which is only\r\nused with SSL connections.", "commitDateTime": "2018-09-05 14:59:01", "authoredDateTime": "2018-09-01 00:39:31", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/PulsarChannelInitializer.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConnectionPool.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/ByteBufPair.java", "insertions": 24, "deletions": 1, "lines": 25}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarChannelInitializer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PulsarChannelInitializer.initChannel(io.netty.channel.socket.SocketChannel)", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ConnectionPool.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConnectionPool.1.initChannel(io.netty.channel.socket.SocketChannel)", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "ByteBufPair.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.ByteBufPair", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.ByteBufPair.CopyingEncoder", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["92b809784f631bc6b72cc1116761e8fac02ef41c"], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 30, "deletions": 4, "lines": 34, "gitFilesChange": 3}, "spoonStatsSummary": {"TOT": 8, "UPD": 0, "INS": 6, "MOV": 2, "DEL": 0, "spoonFilesChanged": 3, "spoonMethodsChanged": 4}, "statsSkippedReason": "", "changesInPackagesGIT": ["pulsar-common/src/main/java/org/apache/pulsar/common/api", "pulsar-client/src/main/java/org/apache/pulsar/client/impl", "pulsar-broker/src/main/java/org/apache/pulsar/broker/service"], "changesInPackagesSPOON": ["org.apache.pulsar.client.impl.ConnectionPool.1.initChannel(io.netty.channel.socket.SocketChannel)", "org.apache.pulsar.broker.service.PulsarChannelInitializer.initChannel(io.netty.channel.socket.SocketChannel)", "org.apache.pulsar.common.api.ByteBufPair.CopyingEncoder", "org.apache.pulsar.common.api.ByteBufPair"]}, {"title": "NonPersistentTopicTest#testMsgDropStat", "body": "*Problem*\r\n\r\n```\r\n-------------------------------------------------------------------------------\r\nTest set: org.apache.pulsar.client.api.NonPersistentTopicTest\r\n-------------------------------------------------------------------------------\r\nTests run: 19, Failures: 1, Errors: 0, Skipped: 1, Time elapsed: 91.727 s <<< FAILURE! - in org.apache.pulsar.client.api.NonPersistentTopicTest\r\ntestMsgDropStat(org.apache.pulsar.client.api.NonPersistentTopicTest)  Time elapsed: 0.918 s  <<< FAILURE!\r\njava.lang.AssertionError: expected [2018-08-16T19:29:27.772Z] but found [2018-08-16T19:29:27.625Z]\r\n\tat org.testng.Assert.fail(Assert.java:96)\r\n\tat org.testng.Assert.failNotEquals(Assert.java:776)\r\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:137)\r\n\tat org.testng.Assert.assertEquals(Assert.java:118)\r\n\tat org.testng.Assert.assertEquals(Assert.java:453)\r\n\tat org.testng.Assert.assertEquals(Assert.java:463)\r\n\tat org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat(NonPersistentTopicTest.java:818)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124)\r\n\tat org.testng.internal.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:54)\r\n\tat org.testng.internal.InvokeMethodRunnable.run(InvokeMethodRunnable.java:44)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nThe problem seems to related to #2351 (as commented https://github.com/apache/incubator-pulsar/pull/2390#issuecomment-413685952)\r\n\r\n#2390 removed the assertion to make master stable first.\r\n\r\nThis issue for tracking the real fix for the problem.", "url": "https://github.com/apache/pulsar/issues/2394", "user": "sijie", "labels": ["component/stats", "component/test", "type/bug"], "created": "2018-08-17 02:14:00", "closed": "2018-11-28 22:42:19", "commits": {"1f67d9fcbabbf6bf213173202df52df17b630a10": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 103.00027777777778, "commitsDetails": [{"commitHash": "1f67d9fcbabbf6bf213173202df52df17b630a10", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f6cf48df77a967f9af4075dcf7f17abb7646cdba"], "nameRev": "1f67d9fcbabbf6bf213173202df52df17b630a10 tags/v2.2.0-candidate-1~256", "commitMessage": "Remove connection state assertion in NonPersistentTopicTest#testMsgDropStat(#2390)\n\n\r\n\r\n ### Motivation\r\n\r\n(This is a worker around to fix master build. The real fix will be done in #2394)\r\n\r\nNonPersistentTopicTest keeps failing with following errors: (https://builds.apache.org/job/pulsar_precommit_java8/ws/pulsar-broker/target/surefire-reports/org.apache.pulsar.client.api.NonPersistentTopicTest.txt/*view*/)\r\n```\r\n-------------------------------------------------------------------------------\r\nTest set: org.apache.pulsar.client.api.NonPersistentTopicTest\r\n-------------------------------------------------------------------------------\r\nTests run: 19, Failures: 1, Errors: 0, Skipped: 1, Time elapsed: 91.727 s <<< FAILURE! - in org.apache.pulsar.client.api.NonPersistentTopicTest\r\ntestMsgDropStat(org.apache.pulsar.client.api.NonPersistentTopicTest)  Time elapsed: 0.918 s  <<< FAILURE!\r\njava.lang.AssertionError: expected [2018-08-16T19:29:27.772Z] but found [2018-08-16T19:29:27.625Z]\r\n\tat org.testng.Assert.fail(Assert.java:96)\r\n\tat org.testng.Assert.failNotEquals(Assert.java:776)\r\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:137)\r\n\tat org.testng.Assert.assertEquals(Assert.java:118)\r\n\tat org.testng.Assert.assertEquals(Assert.java:453)\r\n\tat org.testng.Assert.assertEquals(Assert.java:463)\r\n\tat org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat(NonPersistentTopicTest.java:818)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:124)\r\n\tat org.testng.internal.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:54)\r\n\tat org.testng.internal.InvokeMethodRunnable.run(InvokeMethodRunnable.java:44)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n\r\n```\r\n\r\nThe problem came from producer reconnects on CI environment:\r\n\r\nhttps://builds.apache.org/job/pulsar_precommit_java8/ws/pulsar-broker/target/surefire-reports/org.apache.pulsar.client.api.NonPersistentTopicTest-output.txt/*view*/\r\n```\r\n19:29:25.980 [pulsar-client-io-198-1:org.apache.pulsar.client.impl.ClientCnx@177] INFO  org.apache.pulsar.client.impl.ClientCnx - [id: 0x0e9cb22c, L:/127.0.0.1:54187 ! R:localhost/127.0.0.1:28701] Disconnected\r\n19:29:25.981 [pulsar-client-io-198-1:org.apache.pulsar.client.impl.ConnectionHandler@110] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [non-persistent://my-property/my-ns/stats-topic] [test-1-0] Closed connection [id: 0x0e9cb22c, L:/127.0.0.1:54187 ! R:localhost/127.0.0.1:28701] -- Will try again in 0.1 s\r\n19:29:25.982 [pulsar-client-io-198-1:org.apache.pulsar.client.impl.ConnectionHandler@110] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [non-persistent://my-property/my-ns/stats-topic] [subscriber-1] Closed connection [id: 0x0e9cb22c, L:/127.0.0.1:54187 ! R:localhost/127.0.0.1:28701] -- Will try again in 0.1 s\r\n19:29:25.982 [pulsar-client-io-198-1:org.apache.pulsar.client.impl.ConnectionHandler@110] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [non-persistent://my-property/my-ns/stats-topic] [subscriber-2] Closed connection [id: 0x0e9cb22c, L:/127.0.0.1:54187 ! R:localhost/127.0.0.1:28701] -- Will try again in 0.1 s\r\n19:29:26.083 [pulsar-timer-201-1:org.apache.pulsar.client.impl.ConnectionHandler@113] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [non-persistent://my-property/my-ns/stats-topic] [test-1-0] Reconnecting after timeout\r\n19:29:26.083 [pulsar-timer-201-1:org.apache.pulsar.client.impl.ConnectionHandler@113] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [non-persistent://my-property/my-ns/stats-topic] [subscriber-1] Reconnecting after timeout\r\n19:29:26.086 [pulsar-timer-201-1:org.apache.pulsar.client.impl.ConnectionHandler@113] INFO  org.apache.pulsar.client.impl.ConnectionHandler - [non-persistent://my-property/my-ns/stats-topic] [subscriber-2] Reconnecting after timeout\r\n19:29:26.097 [pulsar-client-io-198-1:org.apache.pulsar.client.impl.ConnectionPool@161] INFO  org.apache.pulsar.client.impl.ConnectionPool - [[id: 0x63f7f193, L:/127.0.0.1:54190 - R:localhost/127.0.0.1:28701]] Connected to server\r\n```\r\n\r\nThe assertion is *non-deterministic* and doesn't seem to be really needed. so this change is to remove that assertion.\r\n", "commitDateTime": "2018-08-16 19:17:19", "authoredDateTime": "2018-08-16 19:17:19", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/NonPersistentTopicTest.java", "insertions": 0, "deletions": 2, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NonPersistentTopicTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[documentation]: release notes link of old versions broken", "body": "http://pulsar.incubator.apache.org/en/versions/\r\nrelease notes link of old versions broken\r\n\r\n![image](https://user-images.githubusercontent.com/6348208/44216699-1a24d800-a1a8-11e8-9acb-3a1329ea1a31.png)\r\n\r\nseems file https://github.com/apache/incubator-pulsar/blob/master/site2/website/pages/en/versions.js not translated well.", "url": "https://github.com/apache/pulsar/issues/2386", "user": "jiazhai", "labels": ["component/website", "type/bug"], "created": "2018-08-16 15:00:26", "closed": "2018-08-17 15:45:32", "commits": {"4f43a3f5fe6046cbc034b65c1f625348d310cd11": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "4f43a3f5fe6046cbc034b65c1f625348d310cd11", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["a79fc748bd5323b213e2a29600e6df40965b5402"], "nameRev": "4f43a3f5fe6046cbc034b65c1f625348d310cd11 tags/v2.2.0-candidate-1~252", "commitMessage": "[documentation] Issue 2386: release notes link of old versions broken (#2388)\n\n### Motivation\r\n\r\nFixes #2386.\r\n\r\nRelease notes links of old versions are broken due to an additional \"/\".\r\n\r\n ### Changes\r\n\r\nRemove the extra \"/\"", "commitDateTime": "2018-08-17 08:45:31", "authoredDateTime": "2018-08-17 08:45:31", "commitGitStats": [{"filePath": "site2/website/pages/en/versions.js", "insertions": 3, "deletions": 3, "lines": 6}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "[java-client] ConnectionHandler: Log stack trace instead of printing", "body": "https://github.com/apache/incubator-pulsar/blob/2bc48129bfb4433182f1b05a9008faef76e387ac/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConnectionHandler.java#L74\r\n\r\nThe pulsar java client is currently very noisy in case of connection loss and it cannot be muted, as the stack trace is printed with `.printStackTrace()`. Moving this to the logging system will allow developers to configure this behavior.", "url": "https://github.com/apache/pulsar/issues/2384", "user": "trathschlag", "labels": ["component/client", "type/bug"], "created": "2018-08-16 12:24:51", "closed": "2018-09-18 10:05:41", "commits": {"c86627948d4abf4b50517338c739f0dea8029849": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 32.000277777777775, "commitsDetails": [{"commitHash": "c86627948d4abf4b50517338c739f0dea8029849", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["6c07c81bf85eaa6d2a23c026049c57305284876e"], "nameRev": "c86627948d4abf4b50517338c739f0dea8029849 tags/v2.2.0-candidate-1~115", "commitMessage": "[java-client] Issue #2384: ConnectionHandler: Log stack trace instead of printing (#2599)\n\n*Motivation*\r\n\r\nFixes #2384.\r\n\r\nThe pulsar java client is currently very noisy in case of connection loss and it cannot be muted, as the stack trace is printed with .printStackTrace(). Moving this to the logging system will allow developers to configure this behavior.\r\n\r\n*Changes*\r\n\r\nRemove `printStackTrace`.", "commitDateTime": "2018-09-18 03:05:40", "authoredDateTime": "2018-09-18 03:05:40", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConnectionHandler.java", "insertions": 0, "deletions": 1, "lines": 1}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConnectionHandler.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConnectionHandler.handleConnectionError(java.lang.Throwable)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Initializing cluster metadata should handle /managed-ledger path better", "body": "`/managed-ledger` can be created automatically by brokers without initializing metadata. so in helm deployment, all pods are usually started at the same time. hence the race condition can happen between broker starts and initializing cluster metadata.\r\n\r\n- broker starts triggering creating `/managed-ledger`\r\n- cluster-metadata-initializer attempts to initialize cluster metadata and fail since `/managed-ledger` is already there.\r\n\r\nit can be handled by adding more checks in `initContainer` before starting brokers. However I think we also need to improve the logic on initializing cluster metadata to better handle such corner cases.", "url": "https://github.com/apache/pulsar/issues/2379", "user": "sijie", "labels": ["component/cli", "type/bug"], "created": "2018-08-15 17:38:26", "closed": "2018-09-12 08:19:35", "commits": {"8763c746b5b38901d7fbb77e5766f55c563ba25e": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "8a4f5ccad08522a5774dbc0500b3f48ea73a6fb6": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "889b1bfe8c28075d64ee02bd63510de0d01772b9": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "bf4a50b45dcaec7bd48b38a739bc4e7d43d36af1": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 27.00027777777778, "commitsDetails": [{"commitHash": "8763c746b5b38901d7fbb77e5766f55c563ba25e", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["03d1302c91506df1dace73a60689e78ea589505f"], "nameRev": "8763c746b5b38901d7fbb77e5766f55c563ba25e tags/v2.2.0-candidate-1~174", "commitMessage": "Don't initialize /managed-ledgers on client creation (#2379) (#2509)\n\nNormally the /managed-ledgers znode is created by the\r\ninitialize-cluster-metadata command when a cluster is being turned\r\nup.\r\n\r\nHowever, the ManagedLedger client also creates it on boot. This has\r\ncaused issues in the past, where if a broker is started before\r\ninitialize-cluster-metadata is run, then initialize-cluster-metadata\r\nfails because it sees the /managed-ledger znode.\r\n\r\nThis patch removes the automatic creation of this znode from the\r\nclient boot process.", "commitDateTime": "2018-09-04 13:18:46", "authoredDateTime": "2018-09-04 22:18:46", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/MetaStoreImplZookeeper.java", "insertions": 57, "deletions": 7, "lines": 64}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/MetaStoreImplZookeeperTest.java", "insertions": 52, "deletions": 0, "lines": 52}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/test/BookKeeperClusterTestCase.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/test/MockedBookKeeperTestCase.java", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "MetaStoreImplZookeeper.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper", "TOT": 13, "UPD": 2, "INS": 1, "MOV": 9, "DEL": 1}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper.getManagedLedgerInfo(java.lang.String,boolean,org.apache.bookkeeper.mledger.impl.MetaStoreCallback)", "TOT": 5, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper.asyncCreateFullPathOptimistic(org.apache.zookeeper.ZooKeeper,java.lang.String,java.lang.String,byte[],java.util.List,org.apache.zookeeper.CreateMode,org.apache.zookeeper.AsyncCallback.StringCallback)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MetaStoreImplZookeeperTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeperTest.createOptimisticBaseNotExist()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeperTest.createOptimisticBaseExists()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BookKeeperClusterTestCase.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.setUp()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MockedBookKeeperTestCase.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.test.MockedBookKeeperTestCase.setUp(java.lang.reflect.Method)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "8a4f5ccad08522a5774dbc0500b3f48ea73a6fb6", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["113418d3e7b4d02597bed7a939a46e5f66829621"], "nameRev": "8a4f5ccad08522a5774dbc0500b3f48ea73a6fb6 tags/v2.1.1-incubating-candidate-1~9", "commitMessage": "Don't initialize /managed-ledgers on client creation (#2379) (#2509)\n\nNormally the /managed-ledgers znode is created by the\r\ninitialize-cluster-metadata command when a cluster is being turned\r\nup.\r\n\r\nHowever, the ManagedLedger client also creates it on boot. This has\r\ncaused issues in the past, where if a broker is started before\r\ninitialize-cluster-metadata is run, then initialize-cluster-metadata\r\nfails because it sees the /managed-ledger znode.\r\n\r\nThis patch removes the automatic creation of this znode from the\r\nclient boot process.", "commitDateTime": "2018-09-04 13:19:02", "authoredDateTime": "2018-09-04 22:18:46", "commitGitStats": [{"filePath": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/MetaStoreImplZookeeper.java", "insertions": 57, "deletions": 7, "lines": 64}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/MetaStoreImplZookeeperTest.java", "insertions": 52, "deletions": 0, "lines": 52}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/test/BookKeeperClusterTestCase.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "managed-ledger/src/test/java/org/apache/bookkeeper/test/MockedBookKeeperTestCase.java", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "MetaStoreImplZookeeper.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper", "TOT": 13, "UPD": 2, "INS": 1, "MOV": 9, "DEL": 1}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper.getManagedLedgerInfo(java.lang.String,boolean,org.apache.bookkeeper.mledger.impl.MetaStoreCallback)", "TOT": 5, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper.asyncCreateFullPathOptimistic(org.apache.zookeeper.ZooKeeper,java.lang.String,java.lang.String,byte[],java.util.List,org.apache.zookeeper.CreateMode,org.apache.zookeeper.AsyncCallback.StringCallback)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MetaStoreImplZookeeperTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeperTest.createOptimisticBaseNotExist()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeperTest.createOptimisticBaseExists()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BookKeeperClusterTestCase.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.test.BookKeeperClusterTestCase.setUp()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MockedBookKeeperTestCase.java", "spoonMethods": [{"spoonMethodName": "org.apache.bookkeeper.test.MockedBookKeeperTestCase.setUp(java.lang.reflect.Method)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "889b1bfe8c28075d64ee02bd63510de0d01772b9", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["79ac46a6ae50e48bed4ccb680d1f7945611f0565"], "nameRev": "889b1bfe8c28075d64ee02bd63510de0d01772b9 tags/v2.2.0-candidate-1~172", "commitMessage": "Handle /managed-ledgers znode existance on cluster init (#2379) (#2510)\n\nManagedLedger clients may create the /managed-ledger znode on boot, so\r\nif a broker starts before the metadata is initialized, it could\r\npotentially block initialization.\r\n\r\nThis patch changes this by making the existance of /managed-ledger a\r\nnon-error condition.", "commitDateTime": "2018-09-04 14:41:47", "authoredDateTime": "2018-09-04 23:41:47", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/PulsarClusterMetadataSetup.java", "insertions": 6, "deletions": 1, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarClusterMetadataSetup.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.PulsarClusterMetadataSetup.main(java.lang.String[])", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "bf4a50b45dcaec7bd48b38a739bc4e7d43d36af1", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["8a4f5ccad08522a5774dbc0500b3f48ea73a6fb6"], "nameRev": "bf4a50b45dcaec7bd48b38a739bc4e7d43d36af1 tags/v2.1.1-incubating-candidate-1~8", "commitMessage": "Handle /managed-ledgers znode existance on cluster init (#2379) (#2510)\n\nManagedLedger clients may create the /managed-ledger znode on boot, so\r\nif a broker starts before the metadata is initialized, it could\r\npotentially block initialization.\r\n\r\nThis patch changes this by making the existance of /managed-ledger a\r\nnon-error condition.", "commitDateTime": "2018-09-04 14:55:59", "authoredDateTime": "2018-09-04 23:41:47", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/PulsarClusterMetadataSetup.java", "insertions": 6, "deletions": 1, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarClusterMetadataSetup.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.PulsarClusterMetadataSetup.main(java.lang.String[])", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 2, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Cherry-pick GCS offloader documentation to new website", "body": "Cherry-pick documentation changes at #2152 ", "url": "https://github.com/apache/pulsar/issues/2340", "user": "sijie", "labels": ["component/documentation", "component/tieredstorage", "type/bug"], "created": "2018-08-08 08:34:54", "closed": "2018-09-04 21:22:34", "commits": {}, "ttf": 27.00027777777778, "commitsDetails": []}, {"title": "Function localrun quits when using partitioned topic.", "body": "First i write a demo package by gradle\r\n\r\n```groovy\r\nplugins {\r\n    id 'java'\r\n    id \"com.github.johnrengelman.shadow\" version \"2.0.4\"\r\n}\r\n```\r\n\r\n```java\r\npackage com.codelipenghui.pulsar.function;\r\n\r\nimport org.apache.pulsar.functions.api.Context;\r\nimport org.apache.pulsar.functions.api.Function;\r\n\r\npublic class WordCountFunction implements Function<String, Void> {\r\n\r\n    @Override\r\n    public Void process(String input, Context context) throws Exception {\r\n        context.incrCounter(\"test-case-total\", 1);\r\n        return null;\r\n    }\r\n}\r\n```\r\n\r\nI got info :\r\n\r\n```lua\r\n[root@qa-5-171 apache-pulsar-2.2.0-incubating-SNAPSHOT]# bin/pulsar-admin functions localrun --jar target/pulsar-functions-0.1.0-SNAPSHOT-jar-with-dependencies.jar --className pulsarfunctions.starter.sdk.WordCountFunction --tenant public --namespace default --name word-count-test --inputs persistent://public/default/plat.correctness.verification --output persistent://public/default/word-count-test-output\r\n19:58:34.946 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntimeFactory - Java instance jar location is not defined, using the location defined in system environment : /opt/apache-pulsar-2.2.0-incubating-SNAPSHOT/instances/java-instance.jar\r\n19:58:34.954 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntimeFactory - Python instance file location is not defined using the location defined in system environment : /opt/apache-pulsar-2.2.0-incubating-SNAPSHOT/instances/python-instance/python_instance_main.py\r\n19:58:34.974 [main] INFO  org.apache.pulsar.functions.runtime.RuntimeSpawner - RuntimeSpawner starting function word-count-test - 0\r\n19:58:34.987 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - ProcessBuilder starting the process with args java -cp /opt/apache-pulsar-2.2.0-incubating-SNAPSHOT/instances/java-instance.jar -Dpulsar.functions.java.instance.jar=/opt/apache-pulsar-2.2.0-incubating-SNAPSHOT/instances/java-instance.jar -Dlog4j.configurationFile=java_instance_log4j2.yml -Dpulsar.log.dir=/opt/apache-pulsar-2.2.0-incubating-SNAPSHOT/logs/functions -Dpulsar.log.file=word-count-test org.apache.pulsar.functions.runtime.JavaInstanceMain --jar target/pulsar-functions-0.1.0-SNAPSHOT-jar-with-dependencies.jar --instance_id 0 --function_id ac8f5862-34cd-4f0e-869e-39f5717a99a2 --function_version 1498f7f5-5483-42c2-b2ac-c07c5c1626ce --tenant public --namespace default --name word-count-test --function_classname pulsarfunctions.starter.sdk.WordCountFunction --auto_ack true --processing_guarantees ATLEAST_ONCE --pulsar_serviceurl http://localhost:8080/ --use_tls false --tls_allow_insecure false --hostname_verification_enabled false --max_buffered_tuples 1024 --port 16821 --source_type_classname \"java.lang.String\" --source_subscription_type SHARED --source_topics_serde_classname {\"persistent://public/default/plat.correctness.verification\":\"\"} --sink_type_classname \"java.lang.Void\" --sink_topic persistent://public/default/word-count-test-output\r\n19:58:34.995 [main] INFO  org.apache.pulsar.functions.runtime.ProcessRuntime - Started process successfully\r\n19:58:41.297 [main] INFO  org.apache.pulsar.admin.cli.CmdFunctions - RuntimeSpawner quit because of\r\n19:58:41.299 [Thread-3] INFO  org.apache.pulsar.admin.cli.CmdFunctions - Shutting down the localrun runtimeSpawner ...\r\n```\r\n\r\nAnd then i use https://github.com/streamlio/pulsar-functions-java-starter.git\r\n\r\nI got the same.", "url": "https://github.com/apache/pulsar/issues/2330", "user": "codelipenghui", "labels": ["component/functions", "type/bug"], "created": "2018-08-07 12:04:22", "closed": "2018-09-12 08:22:23", "commits": {"8688b6733177ee4a48d805df18a1d82865cf7320": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "259594165f5ee3c69a29629534af81011cab4ef1": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 35.000277777777775, "commitsDetails": [{"commitHash": "8688b6733177ee4a48d805df18a1d82865cf7320", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["9a9378944c8a6c3cd9124c888ad58f67e127ceb0"], "nameRev": "8688b6733177ee4a48d805df18a1d82865cf7320 tags/v2.2.0-candidate-1~216", "commitMessage": "Issue #2330: change getTopicName in MultiTopicsConsumer (#2346)\n\n* change getTopicName in MultiTopicsConsumer\r\n\r\n* change following sijie's comments\r\n\r\n* keep both topicName and topicPartitonName in consumer to avoid new string\r\n", "commitDateTime": "2018-08-27 11:38:41", "authoredDateTime": "2018-08-28 02:38:41", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 8, "deletions": 0, "lines": 8}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 5, "deletions": 4, "lines": 9}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TopicMessageIdImpl.java", "insertions": 23, "deletions": 4, "lines": 27}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TopicMessageImpl.java", "insertions": 16, "deletions": 4, "lines": 20}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/UnAckedTopicMessageTracker.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/MessageIdCompareToTest.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/semantics/SemanticsTest.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.getTopicNameWithoutPartition()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.doAcknowledge(org.apache.pulsar.client.api.MessageId,org.apache.pulsar.common.api.proto.PulsarApi.CommandAck.AckType,java.util.Map)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.messageReceived(org.apache.pulsar.client.impl.ConsumerImpl,org.apache.pulsar.client.api.Message)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicMessageIdImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TopicMessageIdImpl.equals(java.lang.Object)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicMessageIdImpl.getTopicName()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicMessageIdImpl", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicMessageIdImpl.getTopicPartitionName()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicMessageImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TopicMessageImpl", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicMessageImpl.getTopicPartitionName()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "UnAckedTopicMessageTracker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.UnAckedTopicMessageTracker.removeTopicMessages(java.lang.String)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MessageIdCompareToTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessageIdCompareToTest.testMessageIdImplCompareToTopicMessageId()", "TOT": 3, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageIdCompareToTest.testBatchMessageIdImplCompareToTopicMessageId()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SemanticsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.semantics.SemanticsTest.testSubscriptionInitialPosition(int)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "259594165f5ee3c69a29629534af81011cab4ef1", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["96bf00fa12bf74db57d36f40989e233752288351"], "nameRev": "259594165f5ee3c69a29629534af81011cab4ef1 tags/v2.1.1-incubating-candidate-1~20", "commitMessage": "Issue #2330: change getTopicName in MultiTopicsConsumer (#2346)\n\n* change getTopicName in MultiTopicsConsumer\r\n\r\n* change following sijie's comments\r\n\r\n* keep both topicName and topicPartitonName in consumer to avoid new string\r\n", "commitDateTime": "2018-08-27 11:39:10", "authoredDateTime": "2018-08-28 02:38:41", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 8, "deletions": 0, "lines": 8}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 5, "deletions": 4, "lines": 9}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TopicMessageIdImpl.java", "insertions": 23, "deletions": 4, "lines": 27}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TopicMessageImpl.java", "insertions": 16, "deletions": 4, "lines": 20}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/UnAckedTopicMessageTracker.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/MessageIdCompareToTest.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "tests/integration/semantics/src/test/java/org/apache/pulsar/tests/integration/semantics/SemanticsTest.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.getTopicNameWithoutPartition()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.doAcknowledge(org.apache.pulsar.client.api.MessageId,org.apache.pulsar.common.api.proto.PulsarApi.CommandAck.AckType,java.util.Map)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.messageReceived(org.apache.pulsar.client.impl.ConsumerImpl,org.apache.pulsar.client.api.Message)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicMessageIdImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TopicMessageIdImpl.equals(java.lang.Object)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicMessageIdImpl.getTopicName()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicMessageIdImpl", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicMessageIdImpl.getTopicPartitionName()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicMessageImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.TopicMessageImpl", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.TopicMessageImpl.getTopicPartitionName()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "UnAckedTopicMessageTracker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.UnAckedTopicMessageTracker.removeTopicMessages(java.lang.String)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MessageIdCompareToTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MessageIdCompareToTest.testMessageIdImplCompareToTopicMessageId()", "TOT": 3, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.MessageIdCompareToTest.testBatchMessageIdImplCompareToTopicMessageId()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SemanticsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.semantics.SemanticsTest.testSubscriptionInitialPosition(int)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Need docs to config a function worker correctly", "body": "", "url": "https://github.com/apache/pulsar/issues/2329", "user": "codelipenghui", "labels": ["component/documentation", "component/website", "type/bug"], "created": "2018-08-07 11:47:54", "closed": "2018-08-11 02:40:23", "commits": {"8655d53b62c6e8f25cc629f7922f52e23b07c768": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "20caf5f5de9a22aeb4b3c5a9eb4cac5bf4e2030e": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "8655d53b62c6e8f25cc629f7922f52e23b07c768", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["27964313bd26b71e8014dc0e168d4ffbde15a12f"], "nameRev": "8655d53b62c6e8f25cc629f7922f52e23b07c768 tags/v2.2.0-candidate-1~283", "commitMessage": "[documentation] Improve documentation on bare mental deployment (#2335)\n\n### Motiviation\r\n\r\nFixes #2329\r\n\r\n ### Changes\r\n\r\n- How to enable state storage for stateful functions\r\n- How to enable function worker\r\n- How to install builtin connectors\r\n- Instructions to test functions", "commitDateTime": "2018-08-10 19:40:23", "authoredDateTime": "2018-08-10 19:40:23", "commitGitStats": [{"filePath": "deployment/terraform-ansible/aws/setup-disk.yaml", "insertions": 36, "deletions": 0, "lines": 36}, {"filePath": "deployment/terraform-ansible/deploy-pulsar.yaml", "insertions": 1, "deletions": 19, "lines": 20}, {"filePath": "deployment/terraform-ansible/templates/bookkeeper.conf", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site2/docs/deploy-aws.md", "insertions": 37, "deletions": 1, "lines": 38}, {"filePath": "site2/docs/deploy-bare-metal.md", "insertions": 124, "deletions": 3, "lines": 127}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "20caf5f5de9a22aeb4b3c5a9eb4cac5bf4e2030e", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["c65b701b16bab4ba03f39b5a57bd378a6c4532ac"], "nameRev": "20caf5f5de9a22aeb4b3c5a9eb4cac5bf4e2030e tags/v2.2.0-candidate-1~279", "commitMessage": "[deploy][documentation] Fix terraform-ansible script and update documentation (#2357)\n\n* [documentation] Improve documentation on bare mental deployment\r\n\r\n ### Motiviation\r\n\r\nFixes #2329\r\n\r\n ### Changes\r\n\r\n- How to enable state storage for stateful functions\r\n- How to enable function worker\r\n- How to install builtin connectors\r\n- Instructions to test functions\r\n\r\n* Improve ansible script\r\n\r\n* Fix the documentation\r\n\r\n* update 2.1.0 documentation\r\n", "commitDateTime": "2018-08-11 22:06:30", "authoredDateTime": "2018-08-11 22:06:30", "commitGitStats": [{"filePath": "deployment/terraform-ansible/aws/instances.tf", "insertions": 29, "deletions": 5, "lines": 34}, {"filePath": "deployment/terraform-ansible/aws/network.tf", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "deployment/terraform-ansible/aws/output.tf", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "deployment/terraform-ansible/aws/setup-disk.yaml", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "deployment/terraform-ansible/aws/terraform.tfvars", "insertions": 7, "deletions": 3, "lines": 10}, {"filePath": "deployment/terraform-ansible/aws/variables.tf", "insertions": 10, "deletions": 2, "lines": 12}, {"filePath": "deployment/terraform-ansible/deploy-pulsar.yaml", "insertions": 52, "deletions": 28, "lines": 80}, {"filePath": "deployment/terraform-ansible/templates/bookkeeper.service", "insertions": 33, "deletions": 0, "lines": 33}, {"filePath": "deployment/terraform-ansible/templates/broker.conf", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "deployment/terraform-ansible/templates/functions_worker.yml", "insertions": 46, "deletions": 0, "lines": 46}, {"filePath": "deployment/terraform-ansible/templates/proxy.conf", "insertions": 123, "deletions": 0, "lines": 123}, {"filePath": "deployment/terraform-ansible/templates/{pulsar.service => pulsar.broker.service}", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "deployment/terraform-ansible/templates/pulsar.proxy.service", "insertions": 32, "deletions": 0, "lines": 32}, {"filePath": "site2/docs/deploy-aws.md", "insertions": 9, "deletions": 4, "lines": 13}, {"filePath": "site2/website/versioned_docs/version-2.1.0-incubating/deploy-aws.md", "insertions": 45, "deletions": 4, "lines": 49}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 2, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Flaky python unit test test_publish_compact_and_consume", "body": "#### Expected behavior\r\n\r\nSeen failure at : https://builds.apache.org/job/pulsar_precommit_cpp/2951/console\r\n\r\n```\r\n======================================================================\r\nFAIL: test_publish_compact_and_consume (__main__.PulsarTest)\r\n----------------------------------------------------------------------\r\nTraceback (most recent call last):\r\n  File \"pulsar_test.py\", line 557, in test_publish_compact_and_consume\r\n    self.assertEqual(msg0.data(), b'hello-1')\r\nAssertionError: 'hello-0' != 'hello-1'\r\n\r\n----------------------------------------------------------------------\r\n```\r\n\r\n\r\n```\r\n2018-08-06 22:34:41.901 INFO  HandlerBase:53 | [persistent://sample/standalone/ns1/my-python-test_publish_compact_and_consume, my-producer-name] Getting connection from pool\r\n2018-08-06 22:34:42.058 INFO  ProducerImpl:154 | [persistent://sample/standalone/ns1/my-python-test_publish_compact_and_consume, my-producer-name] Created producer on broker [127.0.0.1:55834 -> 127.0.0.1:8885] \r\n2018-08-06 22:34:42.060 INFO  HandlerBase:53 | [persistent://sample/standalone/ns1/my-python-test_publish_compact_and_consume, my-sub1, 0] Getting connection from pool\r\n2018-08-06 22:34:42.133 INFO  ConsumerImpl:168 | [persistent://sample/standalone/ns1/my-python-test_publish_compact_and_consume, my-sub1, 0] Created consumer on broker [127.0.0.1:55834 -> 127.0.0.1:8885] \r\n2018-08-06 22:34:42.134 INFO  ConsumerImpl:761 | [persistent://sample/standalone/ns1/my-python-test_publish_compact_and_consume, my-sub1, 0] Closed consumer 0\r\n2018-08-06 22:34:42.135 INFO  HandlerBase:53 | [persistent://sample/standalone/ns1/my-python-test_publish_compact_and_consume, my-sub2, 1] Getting connection from pool\r\n2018-08-06 22:34:42.207 INFO  ConsumerImpl:168 | [persistent://sample/standalone/ns1/my-python-test_publish_compact_and_consume, my-sub2, 1] Created consumer on broker [127.0.0.1:55834 -> 127.0.0.1:8885] \r\n2018-08-06 22:34:42.265 INFO  ProducerImpl:466 | [persistent://sample/standalone/ns1/my-python-test_publish_compact_and_consume, my-producer-name] Closed producer\r\nCompact still running\r\n{\"status\":\"RUNNING\",\"lastError\":\"\"}\r\nCompact still running\r\n{\"status\":\"RUNNING\",\"lastError\":\"\"}\r\nCompact Complete now\r\n{\"status\":\"SUCCESS\",\"lastError\":\"\"}\r\n2018-08-06 22:34:42.817 INFO  HandlerBase:53 | [persistent://sample/standalone/ns1/my-python-test_publish_compact_and_consume, my-sub1, 2] Getting connection from pool\r\n2018-08-06 22:34:42.818 INFO  ConsumerImpl:168 | [persistent://sample/standalone/ns1/my-python-test_publish_compact_and_consume, my-sub1, 2] Created consumer on broker [127.0.0.1:55834 -> 127.0.0.1:8885] \r\n```", "url": "https://github.com/apache/pulsar/issues/2321", "user": "merlimat", "labels": ["component/python", "component/test", "help wanted", "type/bug"], "created": "2018-08-06 22:58:21", "closed": "2019-10-23 16:36:30", "commits": {"5d1529a745b295283fd84d5930fac0c3092ef036": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 442.0002777777778, "commitsDetails": [{"commitHash": "5d1529a745b295283fd84d5930fac0c3092ef036", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["8b7245c9c13ad9b64760930ec2139c461ca1cb3b"], "nameRev": "5d1529a745b295283fd84d5930fac0c3092ef036 tags/v2.5.0-candidate-1~205", "commitMessage": "Give compacted ledger some time to update in python test(#2321) (#5448)\n\nAfter compaction completes the compacted ledger is recorded as a\r\nproperty of a cursor. As persisting the cursor is async and we don't\r\nwait for the acknowledgement of the acknowledgement, there may be a\r\nrace if we try to read the compacted ledger immediately.\r\n\r\nTo avoid this race, I've added a 1 second sleep to allow the compacted\r\nledger to be updated on the broker.", "commitDateTime": "2019-10-23 09:36:30", "authoredDateTime": "2019-10-23 18:36:30", "commitGitStats": [{"filePath": "pulsar-client-cpp/python/pulsar_test.py", "insertions": 11, "deletions": 2, "lines": 13}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "TLS auth not supported for https lookup in C++ client", "body": "Try the following test:\r\n```\r\nTEST(AuthPluginTest, testTlsDetectHttps) {\r\n    ClientConfiguration config = ClientConfiguration();\r\n    config.setUseTls(true); // shouldn't be needed soon\r\n    config.setTlsTrustCertsFilePath(\"../../pulsar-broker/src/test/resources/authentication/tls/cacert.pem\");\r\n    config.setTlsAllowInsecureConnection(false);\r\n    AuthenticationPtr auth =\r\n        pulsar::AuthTls::create(\"../../pulsar-broker/src/test/resources/authentication/tls/client-cert.pem\",\r\n                                \"../../pulsar-broker/src/test/resources/authentication/tls/client-key.pem\");\r\n    config.setAuth(auth);\r\n\r\n    Client client(\"https://localhost:9766\", config);\r\n\r\n    std::string topicName = \"persistent://property/cluster/namespace/test-tls-detect-https\";\r\n\r\n    Producer producer;\r\n    Promise<Result, Producer> producerPromise;\r\n    client.createProducerAsync(topicName, WaitForCallbackValue<Producer>(producerPromise));\r\n    Future<Result, Producer> producerFuture = producerPromise.getFuture();\r\n    Result result = producerFuture.get(producer);\r\n    ASSERT_EQ(ResultOk, result);\r\n}\r\n```\r\n\r\nShould work. Does not. Code isn't there to support it.", "url": "https://github.com/apache/pulsar/issues/2314", "user": "ivankelly", "labels": ["component/c++", "component/client", "type/bug"], "created": "2018-08-06 11:44:23", "closed": "2018-11-07 21:49:16", "commits": {"b6feac8180c978e3c59dfbcd4ef44494dd73b385": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 93.00027777777778, "commitsDetails": [{"commitHash": "b6feac8180c978e3c59dfbcd4ef44494dd73b385", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["10c351134a36457d3734a356b798b9f18b8d8593"], "nameRev": "b6feac8180c978e3c59dfbcd4ef44494dd73b385 tags/v2.2.0-candidate-1~286", "commitMessage": "C++ HTTP lookup works with TLS (#2314) (#2350)\n\n* C++ HTTP lookup works with TLS (#2314)\r\n\r\nPreviously it did not take TLS into account at all. Now, if useTls is\r\nconfigured, or the client it configured with a https:// url, the http\r\nlookup will be configured to use TLS.\r\n\r\nThis patch also makes some changes to make sure the URL the broker\r\nadvertises for TLS starts with pulsar+ssl://.\r\n\r\n* format\r\n", "commitDateTime": "2018-08-10 11:10:49", "authoredDateTime": "2018-08-10 20:10:49", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-cpp/lib/ClientConnection.cc", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client-cpp/lib/ClientImpl.cc", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "pulsar-client-cpp/lib/HTTPLookupService.cc", "insertions": 38, "deletions": 5, "lines": 43}, {"filePath": "pulsar-client-cpp/lib/HTTPLookupService.h", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-client-cpp/lib/LookupDataResult.h", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-client-cpp/tests/AuthPluginTest.cc", "insertions": 22, "deletions": 0, "lines": 22}, {"filePath": "pulsar-discovery-service/src/main/java/org/apache/pulsar/discovery/service/DiscoveryService.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.PulsarService.brokerUrlTls(org.apache.pulsar.broker.ServiceConfiguration)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "DiscoveryService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.discovery.service.DiscoveryService.serviceUrlTls()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "URL Encoding problem on Pulsar Admin CLI", "body": "*Problem*\r\n\r\n```\r\nare roles not allowed to have forward slashes?\r\nin their name\r\n```root@pulsar-admin:/pulsar# pulsar-admin namespaces grant-permission --actions produce,consume --role 'spiffe://developer/passport' core-platform/testing\r\nHTTP 404 Not Found\r\n\r\nReason: HTTP 404 Not Found\r\n\r\nroot@pulsar-admin:/pulsar# pulsar-admin namespaces grant-permission --actions produce,consume --role 'spiffe:\\/\\/developer\\/passport' core-platform/testing\r\nHTTP 404 Not Found\r\n\r\nReason: HTTP 404 Not Found\r\n\r\nroot@pulsar-admin:/pulsar# pulsar-admin namespaces grant-permission --actions produce,consume --role 'foo' core-platform/testing\r\n\r\nroot@pulsar-admin:/pulsar# pulsar-admin namespaces permissions core-platform/testing\r\n{\r\n  \"foo\" : [ \"produce\", \"consume\" ]\r\n}```\r\n\r\nJosh West [11:26 AM]\r\n@sijieg this looks like a `pulsar-admin` issue as well with URL encoding\r\n\r\nJosh West [11:26 AM]\r\nif i write out the role using %2F instead of / then the command succeeds\r\n```root@pulsar-admin:/pulsar# pulsar-admin namespaces grant-permission --actions produce,consume --role 'spiffe:%2F%2Fdeveloper%2Fpassport' core-platform/testing\r\nroot@pulsar-admin:/pulsar# curl -k --cert /tls/client.pem --key /tls/client-key.pem https://pulsar-broker:8443/admin/v2/namespaces/core-platform/testing/permissions | jq .\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100    81  100    81    0     0   1819      0 --:--:-- --:--:-- --:--:--  1840\r\n{\r\n  \"foo\": [\r\n    \"consume\",\r\n    \"produce\"\r\n  ],\r\n  \"spiffe://developer/passport\": [\r\n    \"consume\",\r\n    \"produce\"\r\n  ]\r\n}```\r\n```", "url": "https://github.com/apache/pulsar/issues/2304", "user": "sijie", "labels": ["component/cli", "type/bug"], "created": "2018-08-03 18:39:07", "closed": "2018-08-12 20:36:42", "commits": {"c0a5072b80d8b63e447cee8a029d23e4e075d2d6": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "1ef9d0daa1492d948ba31625a09c0f1792709121": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 9.000277777777777, "commitsDetails": [{"commitHash": "c0a5072b80d8b63e447cee8a029d23e4e075d2d6", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["20caf5f5de9a22aeb4b3c5a9eb4cac5bf4e2030e"], "nameRev": "c0a5072b80d8b63e447cee8a029d23e4e075d2d6 tags/v2.2.0-candidate-1~278", "commitMessage": "add encoding for WebTargets parts (#2359)\n\n### Motivation\r\n\r\nFixes #2304 \r\n\r\nIssue #2304 reported that Pulsar admin commands will fail with some url style parts,\r\n```\r\nroot@pulsar-admin:/pulsar# pulsar-admin namespaces grant-permission --actions produce,consume --role 'spiffe://developer/passport' core-platform/testing\r\nHTTP 404 Not Found\r\nReason: HTTP 404 Not Found\r\n```\r\nThis PR try to fix it.\r\n\r\n### Modifications\r\n\r\n- use URLEncoder to encode webTarget parts.\r\n- add tests to verify\r\n\r\n### Result\r\n\r\nall UT passed", "commitDateTime": "2018-08-12 13:36:41", "authoredDateTime": "2018-08-13 04:36:41", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/WebTargets.java", "insertions": 13, "deletions": 1, "lines": 14}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.namespaces()", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "WebTargets.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.internal.WebTargets.addParts(javax.ws.rs.client.WebTarget,java.lang.String[])", "TOT": 3, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.WebTargets", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "1ef9d0daa1492d948ba31625a09c0f1792709121", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["05488a0be6e27292344a093f694d2a5f48886601"], "nameRev": "1ef9d0daa1492d948ba31625a09c0f1792709121 tags/v2.1.1-incubating-candidate-1~33", "commitMessage": "add encoding for WebTargets parts (#2359)\n\n### Motivation\r\n\r\nFixes #2304 \r\n\r\nIssue #2304 reported that Pulsar admin commands will fail with some url style parts,\r\n```\r\nroot@pulsar-admin:/pulsar# pulsar-admin namespaces grant-permission --actions produce,consume --role 'spiffe://developer/passport' core-platform/testing\r\nHTTP 404 Not Found\r\nReason: HTTP 404 Not Found\r\n```\r\nThis PR try to fix it.\r\n\r\n### Modifications\r\n\r\n- use URLEncoder to encode webTarget parts.\r\n- add tests to verify\r\n\r\n### Result\r\n\r\nall UT passed", "commitDateTime": "2018-08-27 02:24:11", "authoredDateTime": "2018-08-13 04:36:41", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/WebTargets.java", "insertions": 13, "deletions": 1, "lines": 14}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.namespaces()", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "WebTargets.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.internal.WebTargets.addParts(javax.ws.rs.client.WebTarget,java.lang.String[])", "TOT": 3, "UPD": 1, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.internal.WebTargets", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Improve error message if authorization is not enabled", "body": "*Problem*\r\n\r\nIf `authorizationEnabled` is not enabled, authorization service is not set. All the accesses to this authorization service will throw NPE and clients will receive `Internal Server Error`. The message is meaningless. It is better to return a more meaningful message.", "url": "https://github.com/apache/pulsar/issues/2283", "user": "sijie", "labels": ["component/documentation", "component/website", "type/bug"], "created": "2018-08-01 17:37:10", "closed": "2018-08-17 15:48:54", "commits": {"2d197b0e7e40106535d91ed6de82dd30241ff256": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 15.000277777777777, "commitsDetails": [{"commitHash": "2d197b0e7e40106535d91ed6de82dd30241ff256", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["086cbbba0e8854ecbafc55bff9e93cb9a84ce797"], "nameRev": "2d197b0e7e40106535d91ed6de82dd30241ff256 tags/v2.2.0-candidate-1~249", "commitMessage": "Issue 2283: Improve error message if authorization is not enabled (#2382)\n\n### Motivation\r\n\r\n Fixes #2283.\r\n\r\n If authorizationEnabled is not enabled, authorization service is not set. All the accesses to this authorization service will throw NPE and clients will receive Internal Server Error. The message is meaningless. It is better to return a more meaningful message.\r\n\r\n ### Changes\r\n\r\n Return `Not implemented` if authorization is not enabled.", "commitDateTime": "2018-08-17 08:48:53", "authoredDateTime": "2018-08-17 08:48:53", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java", "insertions": 7, "deletions": 2, "lines": 9}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/Namespaces.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Namespaces.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/PulsarAdminException.java", "insertions": 14, "deletions": 4, "lines": 18}, {"filePath": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/BaseResource.java", "insertions": 2, "deletions": 3, "lines": 5}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/cli/CLITest.java", "insertions": 24, "deletions": 0, "lines": 24}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NamespacesBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.NamespacesBase.internalGrantPermissionOnNamespace(java.lang.String,java.util.Set)", "TOT": 6, "UPD": 0, "INS": 3, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "Namespaces.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.Namespaces.grantPermissionOnNamespace(java.lang.String,java.lang.String,java.lang.String,java.util.Set)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarAdminException.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.PulsarAdminException", "TOT": 5, "UPD": 4, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.admin.PulsarAdminException.ServerSideErrorException", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BaseResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.admin.internal.BaseResource.getApiException(java.lang.Throwable)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CLITest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.cli.CLITest.testGrantPermissionsAuthorizationDisabled()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Document the settings to enable authorization", "body": "https://pulsar.incubator.apache.org/docs/latest/security/authorization/ is lacking instructions on how to enable authorization. for example `authorizationEnabled` is not documented.", "url": "https://github.com/apache/pulsar/issues/2282", "user": "sijie", "labels": ["component/documentation", "component/website", "type/bug"], "created": "2018-08-01 17:33:35", "closed": "2018-08-21 19:26:17", "commits": {}, "ttf": 20.00027777777778, "commitsDetails": []}, {"title": "Fix git-commit-id-plugin ", "body": "*Problem*\r\n\r\nWe are using git-commit-id plugin for generating a properties file containing all the build information. However you have to skip git-commit-id-plugin when the source code is not in a git repo.\r\n\r\nSo we need:\r\n\r\n- update README to document the right build command\r\n- find a better solution for git-commit-id plugin", "url": "https://github.com/apache/pulsar/issues/2272", "user": "sijie", "labels": ["component/build", "type/bug"], "created": "2018-07-31 17:23:48", "closed": "2018-08-07 15:06:06", "commits": {"6f6c5c8e7fbfed0be5e00104038636250a504d9c": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "046e5007fec67ab89f2093d2ee85db0b09391d58": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "6f6c5c8e7fbfed0be5e00104038636250a504d9c", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["14765b2c4b452dcc3a0d1a4fd488142fd5111a93"], "nameRev": "6f6c5c8e7fbfed0be5e00104038636250a504d9c tags/v2.2.0-candidate-1~308", "commitMessage": "Issue 2272: Fix git-commit-id-plugin (#2327)\n\n### Motivation\r\n\r\nFixes #2272.\r\n\r\nWe are using git-commit-id plugin for generating a properties file containing all the build information.\r\nHowever you have to skip git-commit-id-plugin when the source code is not in a git repo.\r\n\r\n ### Changes\r\n\r\nadd `<failOnNoGitDirectory>false</failOnNoGitDirectory>` to git-commit-plugin", "commitDateTime": "2018-08-07 08:06:05", "authoredDateTime": "2018-08-07 08:06:05", "commitGitStats": [{"filePath": "pom.xml", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "046e5007fec67ab89f2093d2ee85db0b09391d58", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["0cc5e81fcc5ac3859ee463556e6c1ed7e05d29a3"], "nameRev": "046e5007fec67ab89f2093d2ee85db0b09391d58 tags/v2.1.1-incubating-candidate-1~39", "commitMessage": "Issue 2272: Fix git-commit-id-plugin (#2327)\n\n### Motivation\r\n\r\nFixes #2272.\r\n\r\nWe are using git-commit-id plugin for generating a properties file containing all the build information.\r\nHowever you have to skip git-commit-id-plugin when the source code is not in a git repo.\r\n\r\n ### Changes\r\n\r\nadd `<failOnNoGitDirectory>false</failOnNoGitDirectory>` to git-commit-plugin", "commitDateTime": "2018-08-27 02:15:09", "authoredDateTime": "2018-08-07 08:06:05", "commitGitStats": [{"filePath": "pom.xml", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "PIP8 hyper-link address is wrong in wiki", "body": "#### Expected behavior\r\n\r\nWhen a reader clicks the hyperlink with the name `PIP 8 Pulsar beyond 1M topics` in [pulsar wiki homepage](https://github.com/apache/incubator-pulsar/wiki) section **Accepted** the reader will go to an address which doesn't exist so the reader will be redirected to [pulsar wiki homepage](https://github.com/apache/incubator-pulsar/wiki) \r\n\r\n#### Actual behavior\r\n\r\nChange the hyperlink address of `PIP 8 Pulsar beyond 1M topics` mentioned before to https://github.com/apache/incubator-pulsar/wiki/PIP-8:-Pulsar-beyond-1M-topics to make the navigating address is correct\r\n\r\n#### Steps to reproduce\r\n\r\n1.  go to  [pulsar wiki homepage](https://github.com/apache/incubator-pulsar/wiki)\r\n2. go to section **Accepted**\r\n3. click `PIP 8 Pulsar beyond 1M topics`\r\n\r\n#### System configuration\r\n**Pulsar version**:  none\r\n", "url": "https://github.com/apache/pulsar/issues/2262", "user": "xiaozongyang", "labels": ["component/documentation", "type/bug"], "created": "2018-07-28 14:32:20", "closed": "2018-08-01 21:40:57", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "documentation: incorrect flags for bin/pulsar", "body": "#### Expected behavior\r\n\r\nThe documentation lists `-c` and `--conf` as possible arguments of the `bin/pulsar` command. \r\n\r\nhttps://pulsar.incubator.apache.org/docs/v2.0.1-incubating/reference/CliTools/#zookeeper-90gyx\r\n\r\n#### Actual behavior\r\n\r\nIn practice, the `-c` and `--conf` args to `bin/pulsar` are not respected. It seems that the proper way to specify an alternative config file is via env variables, eg the [`PULSAR_ZK_CONF`](https://github.com/apache/incubator-pulsar/blob/fd47532380d770e4fd78cabe71dea293fc2f0e06/bin/pulsar#L264) env variable.\r\n\r\n```shell\r\n$ ./bin/pulsar zookeeper -c conf/zookeeper.conf\r\n[AppClassLoader@4dd8dc3] info AspectJ Weaver Version 1.8.9 built on Monday Mar 14, 2016 at 21:18:16 GMT\r\n[AppClassLoader@4dd8dc3] info register classloader sun.misc.Launcher$AppClassLoader@4dd8dc3\r\n[AppClassLoader@4dd8dc3] info using configuration file:/src/github.com/apache/incubator-pulsar-v2/pulsar-broker/target/pulsar-broker.jar!/META-INF/aop.xml\r\n[AppClassLoader@4dd8dc3] info using configuration file:/src/github.com/apache/incubator-pulsar-v2/pulsar-zookeeper/target/pulsar-zookeeper.jar!/META-INF/aop.xml\r\n[AppClassLoader@4dd8dc3] info register aspect org.apache.pulsar.broker.zookeeper.aspectj.ClientCnxnAspect\r\n[AppClassLoader@4dd8dc3] info register aspect org.apache.pulsar.zookeeper.FinalRequestProcessorAspect\r\n[AppClassLoader@4dd8dc3] info register aspect org.apache.pulsar.zookeeper.ZooKeeperServerAspect\r\n10:49:25.346 [main] INFO  org.apache.pulsar.zookeeper.ZooKeeperStarter - Starting ZK stats HTTP server at port 8000\r\n10:49:25.367 [main] INFO  org.eclipse.jetty.util.log - Logging initialized @2001ms\r\n10:49:25.425 [main] INFO  org.eclipse.jetty.server.Server - jetty-9.3.11.v20160721\r\n10:49:25.459 [main] INFO  org.eclipse.jetty.server.handler.ContextHandler - Started o.e.j.s.ServletContextHandler@fcb4004{/,null,AVAILABLE}\r\n10:49:25.486 [main] INFO  org.eclipse.jetty.server.AbstractConnector - Started ServerConnector@3cc41abc{HTTP/1.1,[http/1.1]}{0.0.0.0:8000}\r\n10:49:25.486 [main] INFO  org.eclipse.jetty.server.Server - Started @2122ms\r\n10:49:25.492 [main] INFO  org.apache.zookeeper.server.DatadirCleanupManager - autopurge.snapRetainCount set to 3\r\n10:49:25.492 [main] INFO  org.apache.zookeeper.server.DatadirCleanupManager - autopurge.purgeInterval set to 0\r\n10:49:25.493 [main] INFO  org.apache.zookeeper.server.DatadirCleanupManager - Purge task is not scheduled.\r\n10:49:25.493 [main] WARN  org.apache.zookeeper.server.quorum.QuorumPeerMain - Either no config or no quorum defined in config, running  in standalone mode\r\n10:49:25.535 [main] ERROR org.apache.zookeeper.server.ZooKeeperServerMain - Invalid arguments, exiting abnormally\r\njava.lang.NumberFormatException: For input string: \"/src/github.com/apache/incubator-pulsar-v2/conf/zookeeper.conf\"\r\n\tat java.lang.NumberFormatException.forInputString(NumberFormatException.java:65) ~[?:1.8.0_161]\r\n\tat java.lang.Integer.parseInt(Integer.java:569) ~[?:1.8.0_161]\r\n\tat java.lang.Integer.parseInt(Integer.java:615) ~[?:1.8.0_161]\r\n\tat org.apache.zookeeper.server.ServerConfig.parse(ServerConfig.java:59) ~[pulsar-broker.jar:2.0.1-incubating]\r\n\tat org.apache.zookeeper.server.ZooKeeperServerMain.initializeAndRun(ZooKeeperServerMain.java:84) ~[pulsar-broker.jar:2.0.1-incubating]\r\n\tat org.apache.zookeeper.server.ZooKeeperServerMain.main(ZooKeeperServerMain.java:53) [pulsar-broker.jar:2.0.1-incubating]\r\n\tat org.apache.zookeeper.server.quorum.QuorumPeerMain.initializeAndRun(QuorumPeerMain.java:116) [pulsar-broker.jar:2.0.1-incubating]\r\n\tat org.apache.zookeeper.server.quorum.QuorumPeerMain.main(QuorumPeerMain.java:78) [pulsar-broker.jar:2.0.1-incubating]\r\n\tat org.apache.pulsar.zookeeper.ZooKeeperStarter.start(ZooKeeperStarter.java:68) [pulsar-zookeeper.jar:2.0.1-incubating]\r\n\tat org.apache.pulsar.zookeeper.ZooKeeperStarter.main(ZooKeeperStarter.java:38) [pulsar-zookeeper.jar:2.0.1-incubating]\r\n10:49:25.540 [main] INFO  org.apache.zookeeper.server.ZooKeeperServerMain - Usage: ZooKeeperServerMain configfile | port datadir [ticktime] [maxcnxns]\r\nUsage: ZooKeeperServerMain configfile | port datadir [ticktime] [maxcnxns]\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\nSee above \"Actual behavior\"\r\n\r\n#### System configuration\r\n\r\n`v2.0.1-incubating`\r\n", "url": "https://github.com/apache/pulsar/issues/2252", "user": "awilliams", "labels": ["component/documentation", "type/bug"], "created": "2018-07-27 16:54:29", "closed": "2018-08-08 18:06:30", "commits": {"0260df0fa8b3fc2a28ac32413be648b535a5c6ba": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 12.000277777777777, "commitsDetails": [{"commitHash": "0260df0fa8b3fc2a28ac32413be648b535a5c6ba", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["5e1ee372775668c3ff5f59d9beb58f600bb6bb1b"], "nameRev": "0260df0fa8b3fc2a28ac32413be648b535a5c6ba tags/v2.2.0-candidate-1~294", "commitMessage": "[documentation] Issue 2252: incorrect flags for bin/pulsar (#2341)\n\n### Motivation\r\n\r\nFixes #2252\r\n\r\nThe documentation lists -c and --conf as possible arguments of the bin/pulsar command.\r\nhttps://pulsar.incubator.apache.org/docs/v2.0.1-incubating/reference/CliTools/#zookeeper-90gyx\r\n\r\nHowever, the -c and --conf args to bin/pulsar are not respected.\r\nIt seems that the proper way to specify an alternative config file is via env variables,\r\neg the PULSAR_ZK_CONF env variable.\r\n\r\n ### Changes\r\n\r\nFix the documentation. Since `bin/pulsar` has specified configuration for all the components,\r\nwe have to use environment variables for overriding the configuration files.", "commitDateTime": "2018-08-08 11:06:29", "authoredDateTime": "2018-08-08 11:06:29", "commitGitStats": [{"filePath": "site2/docs/reference-cli-tools.md", "insertions": 26, "deletions": 35, "lines": 61}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Getting UnAckedMessageTracker messages have timed-out without a reason", "body": "#### Expected behavior\r\n\r\nNo warning at all\r\n\r\nTell us what should happen\r\n\r\nNo warning at all. consumer should have gotten the ack from the broker with warning ack timeout\r\n\r\n\r\nTell us what happens instead\r\n\r\nWe produce message to pulsar. the consumer recieve the message and ack it. for some reason we get this error:\r\n\r\n`WARN  o.a.p.c.i.UnAckedMessageTracker:91 - [ConsumerBase{subscription=\u2018subscr-wallet\u2019, consumerName=\u20189e188\u2019, topic=\u2018WithdrawEventQueue\u2019}] 1 messages have timed-out\r\n`\r\n\r\n\r\nno re-delivers occurs from the broker  but still we see this error on the consumer side claiming an ack was timed out. \r\n\r\nHow can we reproduce the issue\r\n\r\ncreate consumer this way:\r\n```\r\n ExecutorService executor = Executors.newFixedThreadPool(numOfConsumerThreads);\r\n        for (int i = 0; i < numOfConsumerThreads; i++) {\r\n            executor.submit(() ->\r\n            {\r\n                try {\r\n                   while (!Thread.currentThread().isInterrupted() && !isShutdown) {\r\n                    try {\r\n                        Message<String> msg = consumer.receive();\r\n\t\t\t\t\t\t//processing msg..\r\n\t\t\t\t\t}\r\n\t       ...\r\n}\r\n```\r\n\r\nand ack message this way:\r\n\r\n```\r\npublic void messageAckAsync(String topic, MessageId messageId, String\r\n            eventId, java.util.function.Consumer<MessageId> successHandler,\r\n                                java.util.function.Consumer<Exception> failHandler) {\r\n        try {\r\n            log.trace(\"acking msg. topic {} messageId {} eventId {}\", topic, messageId, eventId);\r\n            Consumer consumer = consumerMap.get(topic).getPulsarConsumer();\r\n            consumer.acknowledgeAsync(messageId)\r\n                    .handle((result, ex) -> {\r\n                        if (ex == null) {\r\n                            log.info(\"Message acked: {} topic {} envetId {}\", messageId, topic, eventId);\r\n                            successHandler.accept(messageId);\r\n                        } else {\r\n                            log.error(\"Error acking message to pulsar broker. errorMsg {} topic {} eventId {}\", ex, topic, eventId);\r\n                            failHandler.accept((Exception) ex);\r\n                        }\r\n                        return null;\r\n                    });\r\n        } catch (Exception e) {\r\n            throw new RuntimeException(\"Ack failed. topic= \" + topic + \", messageId= \" + messageId + \", eventId= \" + eventId);\r\n        }\r\n    }\r\n\r\n```\r\n#### System configuration\r\norg.apache.pulsar:pulsar-client:2.0.0-rc1-incubating", "url": "https://github.com/apache/pulsar/issues/2221", "user": "IdanFridman", "labels": ["type/bug"], "created": "2018-07-24 19:34:49", "closed": "2018-07-25 09:00:17", "commits": {"3c2e3e2e3fc3d2cce75dd3e42a77c2d7b3bc0499": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "638eb55970f2d30eb09282731f0402903b5ee469": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "3c2e3e2e3fc3d2cce75dd3e42a77c2d7b3bc0499", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["2ad89f475a0feced7242ce9de2ec2234dc24d1c7"], "nameRev": "3c2e3e2e3fc3d2cce75dd3e42a77c2d7b3bc0499 tags/v2.2.0-candidate-1~389", "commitMessage": "Fixed ack message tracker cleanup for single message batches (#2224)\n\n### Motivation\r\n\r\nFixes #2221\r\n\r\nThe issue is that we were removing a batch message id impl from the tracking set which contains the batch-wide ids.\r\n", "commitDateTime": "2018-07-25 02:00:16", "authoredDateTime": "2018-07-25 02:00:16", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/UnAcknowledgedMessagesTimeoutTest.java", "insertions": 32, "deletions": 0, "lines": 32}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 14, "deletions": 14, "lines": 28}], "commitSpoonAstDiffStats": [{"spoonFilePath": "UnAcknowledgedMessagesTimeoutTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.UnAcknowledgedMessagesTimeoutTest.testSingleMessageBatch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.markAckForBatchMessage(org.apache.pulsar.client.impl.BatchMessageIdImpl,org.apache.pulsar.common.api.proto.PulsarApi.CommandAck.AckType,java.util.Map)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.sendAcknowledge(org.apache.pulsar.client.api.MessageId,org.apache.pulsar.common.api.proto.PulsarApi.CommandAck.AckType,java.util.Map)", "TOT": 8, "UPD": 0, "INS": 4, "MOV": 3, "DEL": 1}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "638eb55970f2d30eb09282731f0402903b5ee469", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["227e1dfd9dc3b62cdb13780064ff1751f9c34542"], "nameRev": "638eb55970f2d30eb09282731f0402903b5ee469 tags/v2.1.1-incubating-candidate-1~51", "commitMessage": "Fixed ack message tracker cleanup for single message batches (#2224)\n\n### Motivation\r\n\r\nFixes #2221\r\n\r\nThe issue is that we were removing a batch message id impl from the tracking set which contains the batch-wide ids.\r\n", "commitDateTime": "2018-08-27 01:57:45", "authoredDateTime": "2018-07-25 02:00:16", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/UnAcknowledgedMessagesTimeoutTest.java", "insertions": 32, "deletions": 0, "lines": 32}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 14, "deletions": 14, "lines": 28}], "commitSpoonAstDiffStats": [{"spoonFilePath": "UnAcknowledgedMessagesTimeoutTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.UnAcknowledgedMessagesTimeoutTest.testSingleMessageBatch()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.markAckForBatchMessage(org.apache.pulsar.client.impl.BatchMessageIdImpl,org.apache.pulsar.common.api.proto.PulsarApi.CommandAck.AckType,java.util.Map)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl.sendAcknowledge(org.apache.pulsar.client.api.MessageId,org.apache.pulsar.common.api.proto.PulsarApi.CommandAck.AckType,java.util.Map)", "TOT": 8, "UPD": 0, "INS": 4, "MOV": 3, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Add example yaml files for pulsar connectors", "body": "*Problem*\r\n\r\nWe don't have any example yaml files for pulsar connectors. We need those examples to simplify users on configuring connnectors", "url": "https://github.com/apache/pulsar/issues/2207", "user": "sijie", "labels": ["component/documentation", "type/bug"], "created": "2018-07-19 22:44:27", "closed": "2018-10-17 22:08:04", "commits": {}, "ttf": 89.00027777777778, "commitsDetails": []}, {"title": "in cpp client, NamespaceName not support V2 type", "body": "In pulsar-client-cpp,  [TopicName](\r\nhttps://github.com/apache/incubator-pulsar/blob/master/pulsar-client-cpp/lib/TopicName.h) support V2 type, and contains method `isV2Topic()`, but NamespaceName not support it. \r\n\r\nWe need to add support for NamespaceName.", "url": "https://github.com/apache/pulsar/issues/2204", "user": "zhaijack", "labels": ["component/c++", "component/client", "type/bug"], "created": "2018-07-19 13:30:59", "closed": "2018-07-20 13:12:33", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "REST Api returns \"405 Method not allowed\"", "body": "#### Expected behavior\r\nRunning apachepulsar/pulsar:2.0.1-incubating standalone docker image.\r\n\r\nGET http://127.0.0.1:8080/admin/persistent/default/public/test-topic1/stats\r\nHTTP 200\r\n\r\n#### Actual behavior\r\n\r\nGET http://127.0.0.1:8080/admin/persistent/default/public/test-topic1/stats\r\nHTTP 405 METHOD NOT ALLOWED\r\n\r\n#### Steps to reproduce\r\n\r\n```\r\ndocker run -it \\\r\n  -p 6650:6650 \\\r\n  -p 8080:8080 \\\r\n  -v $PWD/data:/pulsar/data \\\r\n  apachepulsar/pulsar:2.0.1-incubating \\\r\n  bin/pulsar standalone\r\n```\r\n, afterwards in a browser window enter \r\n`http://127.0.0.1:8080/admin/persistent/default/public/test-topic1/stats`\r\n\r\n\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.0.1-incubating running in docker on a windows host\r\n", "url": "https://github.com/apache/pulsar/issues/2193", "user": "ratcashdev", "labels": ["component/documentation", "type/bug"], "created": "2018-07-18 11:11:23", "closed": "2018-10-10 21:46:02", "commits": {}, "ttf": 84.00027777777778, "commitsDetails": []}, {"title": "Offload: BlobStoreTestBase should support to use real AWS if a system property was set", "body": "In review of #2065 , Ivan commented that BlobStoreTestBase should support to use real AWS if a system property was set.\r\n\r\nSince the test changed a little, may need config for both aws and jcs, would like to do it in separate  issue.", "url": "https://github.com/apache/pulsar/issues/2165", "user": "zhaijack", "labels": ["component/test", "component/tieredstorage", "type/bug"], "created": "2018-07-14 07:23:42", "closed": "2018-10-10 21:51:13", "commits": {}, "ttf": 88.00027777777778, "commitsDetails": []}, {"title": "Race condition in reconnection after managed ledger is fenced", "body": "While checking the intermittent failures for `SequenceIdWithErrorTest`, I've seen that the test is \r\nfailing due to a race condition involving both producer and consumer reconnecting to the broker after the topic was fenced (in the case of the test, the fencing error is purposely inject).", "url": "https://github.com/apache/pulsar/issues/2141", "user": "merlimat", "labels": ["type/bug"], "created": "2018-07-12 05:02:34", "closed": "2018-07-17 17:44:53", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "Improve logging around \"Namespace not served by this instance\"", "body": "*Namespace not served by this instance* is a bit confusing. it should be something like \"namespace bundles not served by this instance\"?", "url": "https://github.com/apache/pulsar/issues/2121", "user": "sijie", "labels": ["component/documentation", "component/website", "type/bug"], "created": "2018-07-09 22:21:08", "closed": "2018-07-18 01:02:29", "commits": {"f0024d2d95b947f1e2ac09165133ed1fde146cb9": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 8.000277777777777, "commitsDetails": [{"commitHash": "f0024d2d95b947f1e2ac09165133ed1fde146cb9", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["3dfc217e9c2855ab4b42c81d453a3023c5dade32"], "nameRev": "f0024d2d95b947f1e2ac09165133ed1fde146cb9 tags/v2.1.0-incubating-candidate-5~13", "commitMessage": "Issue 2121: Improve logging around \"Namespace not served by this instance\" (#2183)\n\n### Motivation\r\n\r\nFixes #2121. Improve the logging around \"namespace not served by this instance\" to make things clearer.\r\n\r\n ### Changes\r\n\r\nImprove the logging to say \"namespace bundle for topic not served by\", rahter than \"namespace not served by\"", "commitDateTime": "2018-07-17 18:02:28", "authoredDateTime": "2018-07-17 18:02:28", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.checkTopicNsOwnership(java.lang.String)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "TopicPatternSubscription doesn't work through proxy", "body": "#### Expected behavior\r\n\r\npattern subscription should work with proxy\r\n\r\n#### Actual behavior\r\n\r\npattern subscription doesn't work with proxy\r\n\r\n```\r\n10:43:12.948 [pulsar-discovery-io-2-1] INFO  org.apache.pulsar.proxy.server.ProxyConnection - [/172.19.0.1:55484] Connection closed\r\n10:43:13.961 [pulsar-discovery-io-2-3] INFO  org.apache.pulsar.proxy.server.ProxyConnection - [/172.19.0.1:55486] New connection opened\r\n10:43:13.964 [pulsar-discovery-io-2-3] WARN  io.netty.channel.DefaultChannelPipeline - An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception.\r\njava.lang.UnsupportedOperationException: null\r\n\tat org.apache.pulsar.common.api.PulsarDecoder.handleGetTopicsOfNamespace(PulsarDecoder.java:427) ~[org.apache.pulsar-pulsar-common-2.2.0-incubating-SNAPSHOT.jar:2.2.0-incubating-SNAPSHOT]\r\n\tat org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:282) ~[org.apache.pulsar-pulsar-common-2.2.0-incubating-SNAPSHOT.jar:2.2.0-incubating-SNAPSHOT]\r\n\tat org.apache.pulsar.proxy.server.ProxyConnection.channelRead(ProxyConnection.java:164) ~[org.apache.pulsar-pulsar-proxy-2.2.0-incubating-SNAPSHOT.jar:2.2.0-incubating-SNAPSHOT]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:284) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1414) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:945) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:806) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:404) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:304) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_151]\r\n10:43:13.964 [pulsar-discovery-io-2-3] WARN  org.apache.pulsar.proxy.server.ProxyConnection - [/172.19.0.1:55486] Got exception UnsupportedOperationException : null\r\njava.lang.UnsupportedOperationException: null\r\n\tat org.apache.pulsar.common.api.PulsarDecoder.handleGetTopicsOfNamespace(PulsarDecoder.java:427) ~[org.apache.pulsar-pulsar-common-2.2.0-incubating-SNAPSHOT.jar:2.2.0-incubating-SNAPSHOT]\r\n\tat org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:282) ~[org.apache.pulsar-pulsar-common-2.2.0-incubating-SNAPSHOT.jar:2.2.0-incubating-SNAPSHOT]\r\n\tat org.apache.pulsar.proxy.server.ProxyConnection.channelRead(ProxyConnection.java:164) ~[org.apache.pulsar-pulsar-proxy-2.2.0-incubating-SNAPSHOT.jar:2.2.0-incubating-SNAPSHOT]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:284) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1414) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:945) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:806) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:404) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:304) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_151]\r\n10:43:13.964 [pulsar-discovery-io-2-3] INFO  org.apache.pulsar.client.impl.PulsarClientImpl - Client closing. URL: pulsar-proxy:6650\r\n10:43:13.965 [pulsar-discovery-io-2-3] INFO  org.apache.pulsar.proxy.server.ProxyConnectionPool - Closing ProxyConnectionPool.\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\nSetup a pulsar cluster with proxy, subscribe to topics using a regex pattern.\r\n\r\n#### System configuration\r\n**Pulsar version**: master\r\n", "url": "https://github.com/apache/pulsar/issues/2119", "user": "sijie", "labels": ["component/proxy", "type/bug"], "created": "2018-07-09 10:47:27", "closed": "2018-07-17 04:52:00", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "get-retention returns retentionSizeInMB as 0 when set to -1", "body": "#### Expected behavior\r\n\r\n`retentionSizeInMB` should have a value of -1.\r\n\r\n#### Actual behavior\r\n\r\n`retentionSizeInMB` is still 0.\r\n\r\n#### Steps to reproduce\r\n\r\n```bash\r\n# Default is 0 and 0 for size and time.\r\npulsar-admin namespaces get-retention public/default\r\n# Set to -1 for infinite size and time retention.\r\npulsar-admin namespaces set-retention public/default --size -1 --time -1\r\n# Get retention again, but size still says 0.\r\npulsar-admin namespaces get-retention public/default\r\n```\r\n\r\nIs this simply a bug in the admin API for reporting the wrong value or is the size retention not being set properly?\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.0.1-incubating\r\n", "url": "https://github.com/apache/pulsar/issues/2110", "user": "bruth", "labels": ["component/cli", "type/bug"], "created": "2018-07-08 10:25:51", "closed": "2018-07-26 06:02:26", "commits": {"2415d1310576d59143c842f9606c7ccd4574adab": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "406f8fa4de6d02839add4b50d31ef4d630b4c857": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 17.00027777777778, "commitsDetails": [{"commitHash": "2415d1310576d59143c842f9606c7ccd4574adab", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["355199eae59e885aa6a05a46479e3d6618e008cf"], "nameRev": "2415d1310576d59143c842f9606c7ccd4574adab tags/v2.2.0-candidate-1~372", "commitMessage": "Issue 2110: get-retention returns retentionSizeInMB as 0 when set to -1 (#2182)\n\n* Issue 2110: get-retention returns retentionSizeInMB as 0 when set to -1\r\n\r\n ### Motivation\r\n\r\nFixes #2110. infinite retention is not correctly propagated.\r\n\r\n ### Changes\r\n\r\nFix the command tool to set infinite retention correctly. Update command line description and website to reflect the fact retention size less than 1MB is treated as no retention.\r\n\r\n", "commitDateTime": "2018-07-25 23:02:25", "authoredDateTime": "2018-07-25 23:02:25", "commitGitStats": [{"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdNamespaces.java", "insertions": 7, "deletions": 3, "lines": 10}, {"filePath": "site/_data/cli/pulsar-admin.yaml", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/cli/CLITest.java", "insertions": 38, "deletions": 0, "lines": 38}], "commitSpoonAstDiffStats": [{"spoonFilePath": "CmdNamespaces.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdNamespaces.SetRetention", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.admin.cli.CmdNamespaces.SetRetention.run()", "TOT": 6, "UPD": 1, "INS": 2, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "CLITest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.cli.CLITest.testSetInfiniteRetention()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "406f8fa4de6d02839add4b50d31ef4d630b4c857", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["cab977e785d9db6e8a96f304585b8858f70c97b0"], "nameRev": "406f8fa4de6d02839add4b50d31ef4d630b4c857 tags/v2.1.1-incubating-candidate-1~47", "commitMessage": "Issue 2110: get-retention returns retentionSizeInMB as 0 when set to -1 (#2182)\n\n* Issue 2110: get-retention returns retentionSizeInMB as 0 when set to -1\r\n\r\n ### Motivation\r\n\r\nFixes #2110. infinite retention is not correctly propagated.\r\n\r\n ### Changes\r\n\r\nFix the command tool to set infinite retention correctly. Update command line description and website to reflect the fact retention size less than 1MB is treated as no retention.\r\n\r\n", "commitDateTime": "2018-08-27 02:01:49", "authoredDateTime": "2018-07-25 23:02:25", "commitGitStats": [{"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdNamespaces.java", "insertions": 7, "deletions": 3, "lines": 10}, {"filePath": "site/_data/cli/pulsar-admin.yaml", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "tests/integration/semantics/src/test/java/org/apache/pulsar/tests/integration/cli/CLITest.java", "insertions": 38, "deletions": 0, "lines": 38}], "commitSpoonAstDiffStats": [{"spoonFilePath": "CmdNamespaces.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.admin.cli.CmdNamespaces.SetRetention", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.admin.cli.CmdNamespaces.SetRetention.run()", "TOT": 6, "UPD": 1, "INS": 2, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "CLITest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.cli.CLITest.testSetInfiniteRetention()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Links to connector source code are broken", "body": "*Problem*\r\n\r\nThe links to connector source code are broken.\r\n\r\nThis problem comes from we renaming connector from `connect` to `io`.", "url": "https://github.com/apache/pulsar/issues/2090", "user": "sijie", "labels": ["component/documentation", "component/website", "type/bug"], "created": "2018-07-05 19:52:48", "closed": "2018-07-07 21:00:16", "commits": {"027f53568b7955f487ecea08fa6d612a7a6d734b": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "027f53568b7955f487ecea08fa6d612a7a6d734b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["ffe7b62fc26cb3d577717439b9cdd4048a36dcf1"], "nameRev": "027f53568b7955f487ecea08fa6d612a7a6d734b tags/v2.1.0-incubating-candidate-5~76", "commitMessage": "Issue 2090: (#2092)\n\n*Motivation*\r\n\r\nFixes #2090.\r\n\r\nLinks to connector source code are broken\r\n\r\n*Changes*\r\n\r\n- Change package name from `connect` to `io`\r\n- Fix the connector class name", "commitDateTime": "2018-07-07 14:00:15", "authoredDateTime": "2018-07-07 14:00:15", "commitGitStats": [{"filePath": "site/_data/connectors.yaml", "insertions": 5, "deletions": 5, "lines": 10}, {"filePath": "site/_includes/connectors.html", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "RackAwareTest is flaky.", "body": "*Flaky Test*\r\n```\r\n[ERROR] org.apache.pulsar.broker.service.RackAwareTest.testPlacement(org.apache.pulsar.broker.service.RackAwareTest)\r\n[INFO]   Run 1: PASS\r\n[ERROR]   Run 2: RackAwareTest.testPlacement:118 first bookie in rack 0 not included in ensemble expected [true] but found [false]\r\n```", "url": "https://github.com/apache/pulsar/issues/2089", "user": "sijie", "labels": ["component/test", "type/bug"], "created": "2018-07-05 18:44:48", "closed": "2019-02-14 09:29:52", "commits": {}, "ttf": 223.00027777777777, "commitsDetails": []}, {"title": "Improve documentation about `--inputs` and `--customSerdeInputs` for pulsar functions", "body": "*Problem*\r\n\r\nThese two flags are sometimes confused. We need improve the documentation to explain them clearly.", "url": "https://github.com/apache/pulsar/issues/2081", "user": "sijie", "labels": ["component/documentation", "component/functions", "type/bug", "type/enhancement"], "created": "2018-07-03 20:35:04", "closed": "2018-11-28 20:34:59", "commits": {}, "ttf": 147.00027777777777, "commitsDetails": []}, {"title": "SubscriptionInitialPosition doesn't work with multiple-topic type subscription", "body": "#### Expected behavior\r\n\r\n`SubscriptionInitialPosition` should work for all the types of subscriptions. \r\n\r\n#### Actual behavior\r\n\r\nHowever it only works for one-topic subscription, it doesn't work for partitioned topic subscription, multi-topics subscription and regex subscription.\r\n\r\n#### Cause\r\n\r\nThe problem is the consumer configuration is copied to an internal consumer configuration for multi-topic style subscription. but we missed copying `SubscriptionInitialPosition`. \r\n", "url": "https://github.com/apache/pulsar/issues/2077", "user": "sijie", "labels": ["component/client", "type/bug"], "created": "2018-07-03 18:09:34", "closed": "2018-07-07 20:59:04", "commits": {"ffe7b62fc26cb3d577717439b9cdd4048a36dcf1": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "ffe7b62fc26cb3d577717439b9cdd4048a36dcf1", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["423a9af9973c3df6275f2abd97957bd772e3da43"], "nameRev": "ffe7b62fc26cb3d577717439b9cdd4048a36dcf1 tags/v2.1.0-incubating-candidate-5~77", "commitMessage": "Issue 2077: SubscriptionInitialPosition doesn't work with multiple-topic type subscription (#2100)\n\n*Motivation*\r\n\r\nFixes #2077.\r\n\r\nThe problem is the consumer configuration is copied to an internal consumer configuration for multi-topic style subscription. but we missed copying SubscriptionInitialPosition.\r\n\r\n*Solution*\r\n\r\nUse `clone` for popagating configuration to internal configuration.\r\n\r\nAdded a test case to cover it.\r\n\r\n", "commitDateTime": "2018-07-07 13:59:03", "authoredDateTime": "2018-07-07 13:59:03", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java", "insertions": 1, "deletions": 20, "lines": 21}, {"filePath": "tests/integration/semantics/src/test/java/org/apache/pulsar/tests/integration/semantics/SemanticsTest.java", "insertions": 68, "deletions": 0, "lines": 68}], "commitSpoonAstDiffStats": [{"spoonFilePath": "MultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.getInternalConsumerConfig()", "TOT": 14, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 11}]}, {"spoonFilePath": "SemanticsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.semantics.SemanticsTest.testSubscriptionInitialPositionOneTopic()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.semantics.SemanticsTest.testSubscriptionInitialPositionTwoTopics()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.tests.integration.semantics.SemanticsTest.testSubscriptionInitialPosition(int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Unable to get messages from non-persistent topics", "body": "### Issue\r\nI am unable to get messages from non-persistent topics while using wildcard subscription.\r\n\r\nPublisher:\r\n```\r\nPulsarClient client = PulsarClient.builder()\r\n        .serviceUrl(\"pulsar://localhost:6650\")\r\n        .build();\r\nProducer<String> stringProducer = client.newProducer(Schema.STRING)\r\n        .topic(\"non-persistent://public/default/test1\")\r\n        .create();\r\nstringProducer.send(line);\r\n```\r\nSubscriber:\r\n```\r\n client = PulsarClient.builder()\r\n        .serviceUrl(\"pulsar://localhost:6650\")\r\n        .build();\r\nconsumer = client.newConsumer()\r\n        .topicsPattern(Pattern.compile(\"non-persistent://public/default/test[12]\"))\r\n        .subscriptionName(new Date().toString())\r\n        .subscribe();\r\nMessage msg = consumer.receive();\r\n```\r\n\r\n#### Expected behavior\r\n\r\nI receive the message.\r\n\r\n#### Actual behavior\r\n\r\nNo messages can be received. While debugging, we noticed that the topic list that client gets from the server by specified regexp is empty.\r\n\r\nServer says that the message is actually sent.\r\n\r\nAfter changing ```non-persistent``` to ```persistent```, everything works just fine.\r\n\r\nWhile trying to investigate this, we have changed the ```pulsar://``` prefix to ```http://``` and inspected http requests. Client tried to perform request ```GET /admin/v2/namespaces/public/default/destinations```, but failed, and in the server logs there was a ```TooLongFrameException : Adjusted frame length exceeds 5242880: 1195725860 - discarded```. From the Wireshark dump, the request's frame length is totally fine.\r\n\r\n#### Steps to reproduce\r\n\r\n1. Run Pulsar server\r\n2. Run consumer\r\n3. Run producer\r\n4. Try to send the message from producer\r\n5. See that the message is not received\r\n\r\n#### System configuration\r\n**Pulsar version**: ```2.0.1-incubating```\r\n", "url": "https://github.com/apache/pulsar/issues/2009", "user": "nikita-tomilov", "labels": ["component/client", "type/bug"], "created": "2018-06-21 11:59:49", "closed": "2019-01-25 06:58:55", "commits": {"69071355ca03fac9e38f7501b37ca93ac19fef7b": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 217.00027777777777, "commitsDetails": [{"commitHash": "69071355ca03fac9e38f7501b37ca93ac19fef7b", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["1eb0e670399f9171572dfbeb2c24b87183050bf2"], "nameRev": "69071355ca03fac9e38f7501b37ca93ac19fef7b tags/v2.2.0-candidate-1~78", "commitMessage": "Allow non-pesistent topics to be retrieved along with persistent ones from the \"GetTopicsOfNamespace\" method (#2025)\n\n### Motivation\r\n\r\nPlease see issue #2009 for a detailed bug report.\r\n\r\nIn our use case we require using java client with pattern subscription to read from a set of non-persistent topics. Unfortunately, right now this feature doesn't work. After researching the cause for this I have found out that under the hood the client is requesting a list of topics by namespace from the server and then filters them out by pattern and subscribes to them. The method in Pulsar broker NamespaceService class that is responsible for searching for required topics only uses ledgers, thus returning only persistent topics to the client. The goal of this pull request is to provide a solution for that problem.\r\n\r\n### Modifications\r\n\r\nThis pull request updates `getListOfTopics` method of NamespaceService class to also include active non-pesistent topics from local broker cache inside the `multiLayerTopicsMap` collection of BrokerService in the result.\r\n\r\n### Result\r\n\r\nAs a result, requesting a list of topics by namespace using the HTTP API or binary API (and thus via the clients) will add non-persistent topics to search result, allowing pattern subscription to be used with non-persistent topics.\r\n\r\n### Considerations\r\n\r\n1. Since this method pulls non-persistent topics from local broker cache, this probably means that this solution will only work for Pulsar installations with a single broker. And if there are multiple brokers, results might be inconsistent. Unfortunately I don't really know if non-persistent themselves work in multi-broker setups. I have recently asked on Slack if non-persistent topics are being replicated in any way and @merlimat's response was that they don't. Also it seems to be that some other methods that are working with non-persistent topics are using this very same collection.\r\n\r\n2. It seems to me that unit tests have made sure that Java client can work with this setup, but this might still be a breaking change for other clients or if applications working with this API are not expecting non-persistent topics in result.\r\n\r\n3. I have made sure that old unit tests inside the `pulsar-broker` subproject are still working and updated some old tests for this particular use case. Are there any more tests that I can add.\r\n\r\nOverall, we really need this and I would appreciate if maintainers could share their opinion. Thanks in advance.", "commitDateTime": "2018-09-24 23:04:01", "authoredDateTime": "2018-09-25 09:04:01", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/Namespaces.java", "insertions": 25, "deletions": 26, "lines": 51}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Namespaces.java", "insertions": 4, "deletions": 2, "lines": 6}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/namespace/NamespaceService.java", "insertions": 142, "deletions": 28, "lines": 170}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 6, "deletions": 3, "lines": 9}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/web/PulsarWebResource.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/PatternTopicsConsumerImplTest.java", "insertions": 197, "deletions": 9, "lines": 206}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/api/ConsumerBuilder.java", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BinaryProtoLookupService.java", "insertions": 8, "deletions": 5, "lines": 13}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBuilderImpl.java", "insertions": 10, "deletions": 3, "lines": 13}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/HttpLookupService.java", "insertions": 5, "deletions": 3, "lines": 8}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/LookupService.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PatternMultiTopicsConsumerImpl.java", "insertions": 5, "deletions": 2, "lines": 7}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "insertions": 10, "deletions": 6, "lines": 16}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/conf/ConsumerConfigurationData.java", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/Commands.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/api/proto/PulsarApi.java", "insertions": 108, "deletions": 0, "lines": 108}, {"filePath": "pulsar-common/src/main/proto/PulsarApi.proto", "insertions": 6, "deletions": 0, "lines": 6}, {"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/LookupProxyHandler.java", "insertions": 5, "deletions": 3, "lines": 8}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PulsarService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.PulsarService.loadNamespaceTopics(org.apache.pulsar.common.naming.NamespaceBundle)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NamespacesBase.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.impl.NamespacesBase.internalDeleteNamespaceBundle(java.lang.String,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.impl.NamespacesBase.internalDeleteNamespace(boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Namespaces.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.Namespaces.getTopics(java.lang.String,java.lang.String,org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Mode)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NamespaceService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService.getListOfTopics(org.apache.pulsar.common.naming.NamespaceName)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService.getFullListOfTopics(org.apache.pulsar.common.naming.NamespaceName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService.getListOfTopics(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Mode)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService.getListOfNonPersistentTopics(org.apache.pulsar.common.naming.NamespaceName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService.getNonPersistentTopicsFromPeerCluster(org.apache.pulsar.common.policies.data.ClusterData,org.apache.pulsar.common.naming.NamespaceName)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService.getNamespaceClient(org.apache.pulsar.common.policies.data.ClusterData)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ServerCnx.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.ServerCnx.handleGetTopicsOfNamespace(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace)", "TOT": 6, "UPD": 0, "INS": 5, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PulsarWebResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.web.PulsarWebResource.checkLocalOrGetPeerReplicationCluster(org.apache.pulsar.broker.PulsarService,org.apache.pulsar.broker.web.NamespaceName)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PatternTopicsConsumerImplTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testBinaryProtoToGetTopicsOfNamespace()", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testAutoUnbubscribePatternConsumer()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testTopicsListMinus()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testTopicsPatternFilter()", "TOT": 15, "UPD": 5, "INS": 3, "MOV": 5, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testBinaryProtoToGetTopicsOfNamespaceNonPersistent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testBinaryProtoToGetTopicsOfNamespaceAll()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testPatternTopicsSubscribeWithBuilderFail()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternTopicsConsumerImplTest.testBinaryProtoToGetTopicsOfNamespacePersistent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerBuilder.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.subscriptionTopicsMode(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Mode)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BinaryProtoLookupService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BinaryProtoLookupService.getTopicsUnderNamespace(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Mode)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.BinaryProtoLookupService.getTopicsUnderNamespace(java.net.InetSocketAddress,org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.client.impl.Backoff,java.util.concurrent.atomic.AtomicLong,java.util.concurrent.CompletableFuture,org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Mode)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerBuilderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBuilderImpl.subscriptionTopicsMode(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Mode)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "HttpLookupService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.HttpLookupService.getTopicsUnderNamespace(org.apache.pulsar.common.naming.NamespaceName)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.HttpLookupService.getTopicsUnderNamespace(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Mode)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "LookupService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.getTopicsUnderNamespace(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Mode)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PatternMultiTopicsConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PatternMultiTopicsConsumerImpl", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.PatternMultiTopicsConsumerImpl.run(io.netty.util.Timeout)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarClientImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.topicsPatternFilter(java.util.List,java.util.regex.Pattern)", "TOT": 11, "UPD": 3, "INS": 3, "MOV": 3, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.PulsarClientImpl.patternTopicSubscribeAsync(org.apache.pulsar.client.impl.conf.ConsumerConfigurationData,org.apache.pulsar.client.api.Schema,org.apache.pulsar.client.impl.ConsumerInterceptors)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerConfigurationData.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.conf.ConsumerConfigurationData", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Commands.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.Commands.newGetTopicsOfNamespaceRequest(java.lang.String,long,org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Mode)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.Commands.newGetTopicsOfNamespaceRequest(java.lang.String,long)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PulsarApi.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.hasMode()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.getMode()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Mode", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.hasMode()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.getMode()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.initFields()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.writeTo(org.apache.pulsar.common.util.protobuf.ByteBufCodedOutputStream)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.getSerializedSize()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Builder", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Builder.hasMode()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Builder.getMode()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Builder.setMode(org.apache.pulsar.common.api.proto.PulsarApi$CommandGetTopicsOfNamespace$Mode)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Builder.clearMode()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Builder.clear()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Builder.buildPartial()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Builder.mergeFrom(org.apache.pulsar.common.api.proto.PulsarApi$CommandGetTopicsOfNamespace)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace.Builder.mergeFrom(org.apache.pulsar.common.util.protobuf.ByteBufCodedInputStream,org.apache.pulsar.shaded.com.google.protobuf.v241.ExtensionRegistryLite)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "LookupProxyHandler.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.LookupProxyHandler.performGetTopicsOfNamespace(long,java.lang.String,java.lang.String,int,org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace$Mode)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.LookupProxyHandler.handleGetTopicsOfNamespace(org.apache.pulsar.common.api.proto.PulsarApi.CommandGetTopicsOfNamespace,long)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "website generating strange anchor tags", "body": "https://pulsar.incubator.apache.org/docs/latest/getting-started/ConceptsAndArchitecture/#Topics-kxiw2\r\n\r\nThe website documentation is adding a random sequence to the end of the anchor tag which makes it difficult and fragile to link to this documentation from external sources.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/2000", "user": "cckellogg", "labels": ["component/website", "type/bug"], "created": "2018-06-20 20:26:56", "closed": "2018-09-12 21:48:07", "commits": {}, "ttf": 84.00027777777778, "commitsDetails": []}, {"title": "TLS auth cannot be used between proxy and brokers", "body": "Brokers are configured to use TLS authentication\r\n\r\nProxies cannot connect to the TLS authentication required brokers, because the brokers are advertising their address as :8080, not :8443\r\n", "url": "https://github.com/apache/pulsar/issues/1991", "user": "ivankelly", "labels": ["component/broker", "component/proxy", "type/bug"], "created": "2018-06-19 12:09:52", "closed": "2018-09-12 21:48:43", "commits": {"a43a6822c81333f8369a15d9ac142fcd2bd2a951": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "c80dfb6abe6acfc4a95f73b55e43a4702762e12f": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "ae596ed7f546dd6db7e9c5c5623d34c2a1a0bda0": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "c16dfbe178f31b5b9caa72c1084ff4d0ab275723": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "de7332bfb98280cadba152db3cf648ac5530905d": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "873658239329e0202eb97e871ab624b0ca2841af": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 85.00027777777778, "commitsDetails": [{"commitHash": "a43a6822c81333f8369a15d9ac142fcd2bd2a951", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["2028aa2b476fc3922b1ab29b1ebc8456ab0f5bb1"], "nameRev": "a43a6822c81333f8369a15d9ac142fcd2bd2a951 tags/v2.1.0-incubating-candidate-1~5", "commitMessage": "Add TLS certs to testing docker image (#2021)\n\nSo that they can be configured to run with TLS.\r\n\r\nThe certificate authority used to generate the certs is also included\r\nin tests/ with instructions on how to generate new user and server\r\ncerts.\r\n\r\nThese certs will be used for an integration test once #1991 is solved.", "commitDateTime": "2018-06-22 09:23:29", "authoredDateTime": "2018-06-22 18:23:29", "commitGitStats": [{"filePath": "tests/certificate-authority/README.md", "insertions": 42, "deletions": 0, "lines": 42}, {"filePath": "tests/certificate-authority/certs/ca.cert.pem", "insertions": 29, "deletions": 0, "lines": 29}, {"filePath": "tests/certificate-authority/client-keys/admin.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "tests/certificate-authority/client-keys/admin.csr.pem", "insertions": 15, "deletions": 0, "lines": 15}, {"filePath": "tests/certificate-authority/client-keys/admin.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "tests/certificate-authority/client-keys/admin.key.pem", "insertions": 27, "deletions": 0, "lines": 27}, {"filePath": "tests/certificate-authority/index.txt", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "tests/certificate-authority/index.txt.attr", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "tests/certificate-authority/index.txt.attr.old", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "tests/certificate-authority/index.txt.old", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "tests/certificate-authority/newcerts/1000.pem", "insertions": 27, "deletions": 0, "lines": 27}, {"filePath": "tests/certificate-authority/newcerts/1001.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "tests/certificate-authority/openssl.cnf", "insertions": 115, "deletions": 0, "lines": 115}, {"filePath": "tests/certificate-authority/private/ca.key.pem", "insertions": 54, "deletions": 0, "lines": 54}, {"filePath": "tests/certificate-authority/serial", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "tests/certificate-authority/serial.old", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "tests/certificate-authority/server-keys/broker.cert.pem", "insertions": 27, "deletions": 0, "lines": 27}, {"filePath": "tests/certificate-authority/server-keys/broker.csr.pem", "insertions": 15, "deletions": 0, "lines": 15}, {"filePath": "tests/certificate-authority/server-keys/broker.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "tests/certificate-authority/server-keys/broker.key.pem", "insertions": 27, "deletions": 0, "lines": 27}, {"filePath": "tests/docker-images/latest-version-image/Dockerfile", "insertions": 8, "deletions": 12, "lines": 20}, {"filePath": "tests/docker-images/latest-version-image/ssl/admin.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "tests/docker-images/latest-version-image/ssl/admin.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "tests/docker-images/latest-version-image/ssl/broker.cert.pem", "insertions": 27, "deletions": 0, "lines": 27}, {"filePath": "tests/docker-images/latest-version-image/ssl/broker.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "tests/docker-images/latest-version-image/ssl/ca.cert.pem", "insertions": 29, "deletions": 0, "lines": 29}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "c80dfb6abe6acfc4a95f73b55e43a4702762e12f", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["174fd02f972e2db19e67874781a503cb264b0099"], "nameRev": "c80dfb6abe6acfc4a95f73b55e43a4702762e12f tags/v2.1.0-incubating-candidate-5~126", "commitMessage": "Move AuthenticationFilter to pulsar-broker-common (#2039)\n\nSo that it can be used by the proxy also.\r\n\r\nMaster issue: #1991", "commitDateTime": "2018-06-27 10:16:14", "authoredDateTime": "2018-06-27 19:16:14", "commitGitStats": [{"filePath": "{pulsar-broker => pulsar-broker-common}/src/main/java/org/apache/pulsar/broker/web/AuthenticationFilter.java", "insertions": 2, "deletions": 3, "lines": 5}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/web/WebService.java", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AuthenticationFilter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.web.AuthenticationFilter", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "WebService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.web.WebService.addServlet(java.lang.String,org.eclipse.jetty.servlet.ServletHolder,boolean,java.util.Map)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "ae596ed7f546dd6db7e9c5c5623d34c2a1a0bda0", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["4487d04dbd9ecb2a73e84ac202d1aa36a4aab788"], "nameRev": "ae596ed7f546dd6db7e9c5c5623d34c2a1a0bda0 tags/v2.1.0-incubating-candidate-5~123", "commitMessage": "Inject AuthenticationService into ProxyService (#2038)\n\nSo that the same authentication service can be used for the webserver also.\r\n\r\nMaster issue: #1991", "commitDateTime": "2018-06-28 09:02:47", "authoredDateTime": "2018-06-28 18:02:47", "commitGitStats": [{"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyService.java", "insertions": 6, "deletions": 6, "lines": 12}, {"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyServiceStarter.java", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyAuthenticatedProducerConsumerTest.java", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyAuthenticationTest.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyConnectionThrottlingTest.java", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyForwardAuthDataTest.java", "insertions": 8, "deletions": 2, "lines": 10}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyLookupThrottlingTest.java", "insertions": 6, "deletions": 1, "lines": 7}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyRolesEnforcementTest.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyTest.java", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyTlsTest.java", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyWithAuthorizationNegTest.java", "insertions": 5, "deletions": 1, "lines": 6}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyWithAuthorizationTest.java", "insertions": 9, "deletions": 3, "lines": 12}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyWithoutServiceDiscoveryTest.java", "insertions": 5, "deletions": 1, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ProxyService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyService.start()", "TOT": 4, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyService", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProxyServiceStarter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyServiceStarter", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProxyAuthenticatedProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyAuthenticatedProducerConsumerTest.setup()", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "ProxyAuthenticationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyAuthenticationTest.testAuthentication()", "TOT": 5, "UPD": 0, "INS": 2, "MOV": 3, "DEL": 0}]}, {"spoonFilePath": "ProxyConnectionThrottlingTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyConnectionThrottlingTest.setup()", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "ProxyForwardAuthDataTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyForwardAuthDataTest.testForwardAuthData()", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProxyLookupThrottlingTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyLookupThrottlingTest.setup()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProxyRolesEnforcementTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyRolesEnforcementTest.testIncorrectRoles()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ProxyTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyTest.setup()", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "ProxyTlsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyTlsTest.setup()", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "ProxyWithAuthorizationNegTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyWithAuthorizationNegTest.setup()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProxyWithAuthorizationTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyWithAuthorizationTest.setup()", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyWithAuthorizationTest.tlsCiphersAndProtocols(java.util.Set,java.util.Set,boolean)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ProxyWithoutServiceDiscoveryTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyWithoutServiceDiscoveryTest.setup()", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "c16dfbe178f31b5b9caa72c1084ff4d0ab275723", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["ae596ed7f546dd6db7e9c5c5623d34c2a1a0bda0"], "nameRev": "c16dfbe178f31b5b9caa72c1084ff4d0ab275723 tags/v2.1.0-incubating-candidate-5~122", "commitMessage": "Original principal authorization for admin API (#2028)\n\n* Original principal authorization for admin API\r\n\r\nThe broker admin checks if the authenticated user is listed as a proxy\r\nuser. If so, it checks looks for the header X-Original-Principal, and\r\nvalidates that the role is authorized to access the resource in\r\nquestion.\r\n\r\nThere are two use cases:\r\n\r\n1. The proxy role is a normal role. In this case, if a resource is to\r\nbe used via the proxy, the proxy user must be explicitly granted\r\npermission on the resource. So, to use the admin api for a tenant, the\r\nproxy role must be listed as a tenant admin.\r\n2. The proxy role is a superuser role. In this case, any resource can\r\nbe used via the proxy as long as the user authorized with the proxy is\r\nauthorized to use the resource. However, if the proxy is compromised,\r\na bad actor has full access to the cluster.\r\n\r\nThis patch is the first part of a fix for #1991.\r\n\r\n* Factor out some validation for original principal\r\n\r\nAlso added a check that if original principal is set, it must have\r\ncome from a role contained in proxyRoles.\r\n", "commitDateTime": "2018-06-28 09:04:06", "authoredDateTime": "2018-06-28 18:04:06", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/web/PulsarWebResource.java", "insertions": 61, "deletions": 4, "lines": 65}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTlsAuthTest.java", "insertions": 322, "deletions": 0, "lines": 322}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/NamespacesTest.java", "insertions": 23, "deletions": 32, "lines": 55}, {"filePath": "pulsar-broker/src/test/resources/authentication/tls-http/admin.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "pulsar-broker/src/test/resources/authentication/tls-http/admin.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "pulsar-broker/src/test/resources/authentication/tls-http/broker.cert.pem", "insertions": 27, "deletions": 0, "lines": 27}, {"filePath": "pulsar-broker/src/test/resources/authentication/tls-http/broker.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "pulsar-broker/src/test/resources/authentication/tls-http/ca.cert.pem", "insertions": 29, "deletions": 0, "lines": 29}, {"filePath": "pulsar-broker/src/test/resources/authentication/tls-http/proxy.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "pulsar-broker/src/test/resources/authentication/tls-http/proxy.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "pulsar-broker/src/test/resources/authentication/tls-http/superproxy.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "pulsar-broker/src/test/resources/authentication/tls-http/superproxy.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "tests/certificate-authority/client-keys/proxy.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "tests/certificate-authority/client-keys/proxy.csr.pem", "insertions": 15, "deletions": 0, "lines": 15}, {"filePath": "tests/certificate-authority/client-keys/proxy.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "tests/certificate-authority/client-keys/proxy.key.pem", "insertions": 27, "deletions": 0, "lines": 27}, {"filePath": "tests/certificate-authority/client-keys/superproxy.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "tests/certificate-authority/client-keys/superproxy.csr.pem", "insertions": 15, "deletions": 0, "lines": 15}, {"filePath": "tests/certificate-authority/client-keys/superproxy.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "tests/certificate-authority/client-keys/superproxy.key.pem", "insertions": 27, "deletions": 0, "lines": 27}, {"filePath": "tests/certificate-authority/index.txt", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "tests/certificate-authority/index.txt.old", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "tests/certificate-authority/newcerts/1002.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "tests/certificate-authority/newcerts/1003.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "tests/certificate-authority/newcerts/1004.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "tests/certificate-authority/serial", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "tests/certificate-authority/serial.old", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyChanges"}, {"commitHash": "de7332bfb98280cadba152db3cf648ac5530905d", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["30f61280677887ccbbf6f406c4ba12967caa3fa0"], "nameRev": "de7332bfb98280cadba152db3cf648ac5530905d tags/v2.1.0-incubating-candidate-3~4", "commitMessage": "Move AuthenticationFilter to pulsar-broker-common (#2039)\n\nSo that it can be used by the proxy also.\r\n\r\nMaster issue: #1991", "commitDateTime": "2018-06-28 09:23:17", "authoredDateTime": "2018-06-27 19:16:14", "commitGitStats": [{"filePath": "{pulsar-broker => pulsar-broker-common}/src/main/java/org/apache/pulsar/broker/web/AuthenticationFilter.java", "insertions": 2, "deletions": 3, "lines": 5}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/web/WebService.java", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AuthenticationFilter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.web.AuthenticationFilter", "TOT": 4, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "WebService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.web.WebService.addServlet(java.lang.String,org.eclipse.jetty.servlet.ServletHolder,boolean,java.util.Map)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "873658239329e0202eb97e871ab624b0ca2841af", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["2f47a104829a86e0bd6e36cefc9c2cc61625dae3"], "nameRev": "873658239329e0202eb97e871ab624b0ca2841af tags/v2.1.0-incubating-candidate-5~43", "commitMessage": "Add authentication to admin proxy (#2056)\n\nIt turns out that the admin rest api proxy wasn't doing authentication\r\nat all, so if you can connect, you have access to the api at the same\r\nlevel as the configured user of the proxy, which could well be\r\nsuperuser access.\r\n\r\nMaster Issue: #1991", "commitDateTime": "2018-07-12 16:28:22", "authoredDateTime": "2018-07-13 00:28:22", "commitGitStats": [{"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/AdminProxyHandler.java", "insertions": 10, "deletions": 0, "lines": 10}, {"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyServiceStarter.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/WebServer.java", "insertions": 18, "deletions": 1, "lines": 19}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/AuthedAdminProxyHandlerTest.java", "insertions": 89, "deletions": 82, "lines": 171}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/SuperUserAuthedAdminProxyHandlerTest.java", "insertions": 183, "deletions": 0, "lines": 183}, {"filePath": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/UnauthedAdminProxyHandlerTest.java", "insertions": 4, "deletions": 1, "lines": 5}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/admin.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/admin.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/broker.cert.pem", "insertions": 27, "deletions": 0, "lines": 27}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/broker.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/ca.cert.pem", "insertions": 29, "deletions": 0, "lines": 29}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/proxy.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/proxy.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/randouser.cert.pem", "insertions": 19, "deletions": 0, "lines": 19}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/randouser.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/superproxy.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/superproxy.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/user1.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "pulsar-proxy/src/test/resources/authentication/tls-admin-proxy/user1.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "tests/certificate-authority/client-keys/randouser.cert.pem", "insertions": 19, "deletions": 0, "lines": 19}, {"filePath": "tests/certificate-authority/client-keys/randouser.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "tests/certificate-authority/client-keys/randouser.key.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "tests/certificate-authority/client-keys/user1.cert.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "tests/certificate-authority/client-keys/user1.csr.pem", "insertions": 15, "deletions": 0, "lines": 15}, {"filePath": "tests/certificate-authority/client-keys/user1.key-pk8.pem", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "tests/certificate-authority/client-keys/user1.key.pem", "insertions": 27, "deletions": 0, "lines": 27}, {"filePath": "tests/certificate-authority/index.txt", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "tests/certificate-authority/index.txt.old", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "tests/certificate-authority/newcerts/1005.pem", "insertions": 26, "deletions": 0, "lines": 26}, {"filePath": "tests/certificate-authority/serial", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "tests/certificate-authority/serial.old", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminProxyHandler.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.AdminProxyHandler.addProxyHeaders(javax.servlet.http.HttpServletRequest,org.eclipse.jetty.client.api.Request)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProxyServiceStarter.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.ProxyServiceStarter", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "WebServer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.WebServer", "TOT": 6, "UPD": 0, "INS": 6, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.WebServer.addServlet(java.lang.String,org.eclipse.jetty.servlet.ServletHolder,java.util.List)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AuthedAdminProxyHandlerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.AuthedAdminProxyHandlerTest", "TOT": 10, "UPD": 2, "INS": 1, "MOV": 0, "DEL": 7}, {"spoonMethodName": "org.apache.pulsar.proxy.server.AuthedAdminProxyHandlerTest.setup()", "TOT": 55, "UPD": 9, "INS": 11, "MOV": 13, "DEL": 22}, {"spoonMethodName": "org.apache.pulsar.proxy.server.AuthedAdminProxyHandlerTest.testAuthenticatedProxy()", "TOT": 36, "UPD": 12, "INS": 0, "MOV": 20, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.proxy.server.AuthedAdminProxyHandlerTest.AdminProxyWrapper", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.proxy.server.AuthedAdminProxyHandlerTest.AdminProxyWrapper.rewriteTarget(javax.servlet.http.HttpServletRequest)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.AuthedAdminProxyHandlerTest.getTlsFile(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.AuthedAdminProxyHandlerTest.getDirectToBrokerAdminClient(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.AuthedAdminProxyHandlerTest.getAdminClient(java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.proxy.server.AuthedAdminProxyHandlerTest.testAuthenticatedProxyAsNonAdmin()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SuperUserAuthedAdminProxyHandlerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.SuperUserAuthedAdminProxyHandlerTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "UnauthedAdminProxyHandlerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.proxy.server.UnauthedAdminProxyHandlerTest.setup()", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 5, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0.0, "UPD": 0.0, "INS": 0.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Non-persistent topic drop too many messages", "body": "#### Expected behavior\r\n\r\nMessages sent to a non-persistent topic and acknowledge must be delivered, at least if the consumer is sufficient to prevent the broker from dropping.\r\n\r\n#### Actual behavior\r\n\r\nOnly few messages are delivered to the consumer. With a persistent topic, all messages are delivered. With a non-persistent topic and pulsar 1.22, all messages are delivered. With pulsar 2.0 and a non-persistent topic, only a few messages are delivered (9/3000 in my simple experiment).\r\n\r\nThe script is attach to this ticket. It doesn't need an installation of pulsar, a new archive is download and a standalone server is started.\r\n\r\n% PULSAR_VERSION=1.22.0-incubating PERS=non-persistent ./go.sh\r\nPulsar version: 1.22.0-incubating\r\nStarting standalone pulsar with pid 15900\r\nStarting pulsar consumer (pid 16309) on non-persistent://tenant/standalone/ns/topic\r\nStarting pulsar producer on non-persistent://tenant/standalone/ns/topic to send 1000 (foo bar baz)\r\nNB messages in consumer log: 1000 should be: 1000\r\nStarting pulsar producer on non-persistent://tenant/standalone/ns/topic to send 1000 (foo bar baz)\r\nNB messages in consumer log: 2000 should be: 2000\r\nStarting pulsar producer on non-persistent://tenant/standalone/ns/topic to send 1000 (foo bar baz)\r\nNB messages in consumer log: 3000 should be: 3000\r\n\r\n% PULSAR_VERSION=2.0.0-rc1-incubating PERS=non-persistent ./go.sh\r\nPulsar version: 2.0.0-rc1-incubating\r\nStarting standalone pulsar with pid 17091\r\nStarting pulsar consumer (pid 17772) on non-persistent://tenant/ns/topic\r\nStarting pulsar producer on non-persistent://tenant/ns/topic to send 1000 (foo bar baz)\r\nNB messages in consumer log: 9 should be: 1000\r\nStarting pulsar producer on non-persistent://tenant/ns/topic to send 1000 (foo bar baz)\r\nNB messages in consumer log: 9 should be: 2000\r\nStarting pulsar producer on non-persistent://tenant/ns/topic to send 1000 (foo bar baz)\r\nNB messages in consumer log: 9 should be: 3000\r\n\r\n% PULSAR_VERSION=2.0.0-rc1-incubating PERS=persistent ./test-pulsar.sh\r\nPulsar version: 2.0.0-rc1-incubating\r\nStarting standalone pulsar with pid 22509\r\nStarting pulsar consumer (pid 23199) on persistent://tenant/ns/topic\r\nStarting pulsar producer on persistent://tenant/ns/topic to send 1000 (foo bar baz)\r\nNB messages in consumer log: 1000 should be: 1000\r\nStarting pulsar producer on persistent://tenant/ns/topic to send 1000 (foo bar baz)\r\nNB messages in consumer log: 2000 should be: 2000\r\nStarting pulsar producer on persistent://tenant/ns/topic to send 1000 (foo bar baz)\r\nNB messages in consumer log: 3000 should be: 3000\r\n\r\n#### Steps to reproduce\r\n\r\n1. Using pulsar-client, launch a consumer on a non-persistent topic\r\n2. Using pulsar-client, launch a producer on the same topic\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.0.0-rc1-incubating\r\n\r\n[test-pulsar.sh.gz](https://github.com/apache/incubator-pulsar/files/2102633/test-pulsar.sh.gz)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/1967", "user": "gfouquier", "labels": ["component/client", "type/bug"], "created": "2018-06-14 14:05:06", "closed": "2018-06-20 23:36:51", "commits": {"233c77fca1ac1bfbc439c2246a45673ff366bfc3": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "233c77fca1ac1bfbc439c2246a45673ff366bfc3", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["e7cc3544c2ea94dda29120e83a86ed650ce20e2f"], "nameRev": "233c77fca1ac1bfbc439c2246a45673ff366bfc3 tags/v2.1.0-incubating-candidate-1~25", "commitMessage": "Issue 1967: Non-persistent topic drop too many messages (#1994)\n\n*Motivation*\r\n\r\nFixes #1967.\r\n\r\nin 2.0 there is an optimization change on grouping acknowledgements.\r\nThe [optimization change](https://github.com/apache/incubator-pulsar/commit/19dd2c502725e3b45e56541576508626c4213091#diff-debb36270f152d2533b03902f214fa9aR674)\r\navoided delivering messages that are already \"delivered\". However in non-persistent topic, pulsar doesn't store entries to bookkeeper, so no ledger id and entry id\r\nare assigned for those messages. Pulsar uses 0 for both ledger id and entry. So the optimization change treats messages as already \"delivered\". so pulsar client\r\ndoesn't dispatch those messages even it already received them from broker.\r\n\r\n*Changes*\r\n\r\n- Make AcknowledgementsGroupingTracker an interface\r\n- Introduce a no-op implementation for non-persistent topics\r\n\r\nSigned-off-by: Sijie Guo <sijie@apache.org>", "commitDateTime": "2018-06-20 16:36:50", "authoredDateTime": "2018-06-20 16:36:50", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/AcknowledgmentsGroupingTracker.java", "insertions": 7, "deletions": 178, "lines": 185}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "insertions": 10, "deletions": 1, "lines": 11}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/NonPersistentAcknowledgmentGroupingTracker.java", "insertions": 57, "deletions": 0, "lines": 57}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PersistentAcknowledgmentsGroupingTracker.java", "insertions": 209, "deletions": 0, "lines": 209}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/AcknowledgementsGroupingTrackerTest.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/naming/TopicName.java", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AcknowledgmentsGroupingTracker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.AcknowledgmentsGroupingTracker", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.client.impl", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.isDuplicate(org.apache.pulsar.client.api.MessageId)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.addAcknowledgment(org.apache.pulsar.client.impl.MessageIdImpl,org.apache.pulsar.common.api.proto.PulsarApi.CommandAck.AckType,java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.flush()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.close()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.AcknowledgmentsGroupingTracker.isDuplicate(org.apache.pulsar.client.api.MessageId)", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.AcknowledgmentsGroupingTracker.addAcknowledgment(org.apache.pulsar.client.impl.MessageIdImpl,org.apache.pulsar.common.api.proto.PulsarApi.CommandAck.AckType,java.util.Map)", "TOT": 5, "UPD": 0, "INS": 0, "MOV": 5, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.AcknowledgmentsGroupingTracker.flush()", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.AcknowledgmentsGroupingTracker.close()", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 3, "DEL": 0}]}, {"spoonFilePath": "ConsumerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerImpl", "TOT": 3, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "NonPersistentAcknowledgmentGroupingTracker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.NonPersistentAcknowledgmentGroupingTracker", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentAcknowledgmentsGroupingTracker.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.PersistentAcknowledgmentsGroupingTracker", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AcknowledgementsGroupingTrackerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.AcknowledgementsGroupingTrackerTest.testAckTracker()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.AcknowledgementsGroupingTrackerTest.testImmediateAckingTracker()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.AcknowledgementsGroupingTrackerTest.testAckTrackerMultiAck()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicName.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.naming.TopicName.isPersistent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "pulsar-client-cpp not able to build with static link", "body": "#### Expected behavior\r\nBuild pulsar-client-cpp lib with static linking all libs.\r\n\r\nSet LINK_STATIC to ON in CMakeList.txt and run ./docker-build.sh, expect to build the cpp client lib with static linking.\r\n\r\n#### Actual behavior\r\n\r\nBuild failed.\r\n\r\n#### Steps to reproduce\r\n\r\nIn pulsar/pulsar-client-cpp/\r\n\r\n$ git diff CMakeLists.txt\r\ndiff --git a/pulsar-client-cpp/CMakeLists.txt b/pulsar-client-cpp/CMakeLists.txt\r\nindex 38a47742..7fb08401 100644\r\n--- a/pulsar-client-cpp/CMakeLists.txt\r\n+++ b/pulsar-client-cpp/CMakeLists.txt\r\n@@ -24,7 +24,7 @@ set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} \"${CMAKE_SOURCE_DIR}/cmake_modules\")\r\n option(BUILD_TESTS \"Build tests\" ON)\r\n MESSAGE(STATUS \"BUILD_TESTS:  \" ${BUILD_TESTS})\r\n \r\n-option(LINK_STATIC \"Link against static libraries\" OFF)\r\n+option(LINK_STATIC \"Link against static libraries\" ON)\r\n MESSAGE(STATUS \"LINK_STATIC:  \" ${LINK_STATIC})\r\n \r\n option(USE_LOG4CXX \"Build with Log4cxx support\" OFF)\r\n$ ./docker-build.sh \r\n...\r\n[ 38%] Linking CXX shared library libpulsar.so\r\n...\r\n/usr/bin/ld: /usr/lib/gcc/x86_64-linux-gnu/5/../../../x86_64-linux-gnu/libboost_filesystem.a(operations.o): relocation R_X86_64_32 against `.rodata.str1.1' can not be used when making a shared object; recompile with -fPIC\r\n/usr/lib/gcc/x86_64-linux-gnu/5/../../../x86_64-linux-gnu/libboost_filesystem.a: error adding symbols: Bad value\r\ncollect2: error: ld returned 1 exit status\r\nlib/CMakeFiles/pulsarShared.dir/build.make:2097: recipe for target 'lib/libpulsar.so.2.1.0-incubating-SNAPSHOT' failed\r\nmake[2]: *** [lib/libpulsar.so.2.1.0-incubating-SNAPSHOT] Error 1\r\nmake[2]: Leaving directory '/pulsar/pulsar-client-cpp'\r\nCMakeFiles/Makefile2:158: recipe for target 'lib/CMakeFiles/pulsarShared.dir/all' failed\r\nmake[1]: *** [lib/CMakeFiles/pulsarShared.dir/all] Error 2\r\nmake[1]: Leaving directory '/pulsar/pulsar-client-cpp'\r\nMakefile:86: recipe for target 'all' failed\r\nmake: *** [all] Error 2\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.0\r\n", "url": "https://github.com/apache/pulsar/issues/1964", "user": "vli02", "labels": ["component/build", "component/c++", "type/bug"], "created": "2018-06-14 06:56:35", "closed": "2019-06-13 08:04:41", "commits": {}, "ttf": 364.0002777777778, "commitsDetails": []}, {"title": "Zookeeper won't start on IPV6  machines - UnknownHostException", "body": "#### Expected behavior\r\nSuccessfully start zookeeprs on a IPV6 configured machine \r\n\r\n#### Actual behavior\r\n\r\nFails to resolve hostname /ip address when starting zookeeper even though nslookup works .\r\n\r\n12:50:28.476 [QuorumPeer[myid=3]/0.0.0.0:2181] WARN  org.apache.zookeeper.server.quorum.QuorumCnxManager - Cannot open channel to 2 at election address carocnxoappa9v.nss.vzwnet.com:3888\r\njava.net.UnknownHostException: carocnxoappa9v.com\r\n        at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:214) ~[?:1.8.0]\r\n        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:403) ~[?:1.8.0]\r\n        at java.net.Socket.connect(Socket.java:666) ~[?:1.8.0]\r\n        at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:562) [org.apache.pulsar-pulsar-zookeeper-2.0.0-rc1-incubating.jar:2.0.0-rc1-incubating]\r\n        at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectAll(QuorumCnxManager.java:614) [org.apache.pulsar-pulsar-zookeeper-2.0.0-rc1-incubating.jar:2.0.0-rc1-incubating]\r\n        at org.apache.zookeeper.server.quorum.FastLeaderElection.lookForLeader(FastLeaderElection.java:843) [org.apache.pulsar-pulsar-zookeeper-2.0.0-rc1-incubating.jar:2.0.0-rc1-incubating]\r\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:913) [org.apache.pulsar-pulsar-zookeeper-2.0.0-rc1-incubating.jar:2.0.0-rc1-incubating]\r\n12:50:28.477 [QuorumPeer[myid=3]/0.0.0.0:2181] WARN  org.apache.zookeeper.server.quorum.QuorumPeer - Failed to resolve address: carocnxoappa9v.nss.vzwnet.com\r\n****java.net.UnknownHostException: carocnxoappa9v.nss.vzwnet.com\r\n        at java.net.InetAddress.getAllByName0(InetAddress.java:1418) ~[?:1.8.0]\r\n        at java.net.InetAddress.getAllByName(InetAddress.java:1322) ~[?:1.8.0]\r\n        at java.net.InetAddress.getAllByName(InetAddress.java:1245) ~[?:1.8.0]\r\n        at java.net.InetAddress.getByName(InetAddress.java:1195) ~[?:1.8.0]\r\n        at**** org.apache.zookeeper.server.quorum.QuorumPeer$QuorumServer.recreateSocketAddresses(QuorumPeer.java:166) [org.apache.pulsar-pulsar-zookeeper-2.0.0-rc1-incubating.jar:2.0.0-rc1-incubating]\r\n        at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:595) [org.apache.pulsar-pulsar-zookeeper-2.0.0-rc1-incubating.jar:2.0.0-rc1-incubating]\r\n        at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectAll(QuorumCnxManager.java:614) [org.apache.pulsar-pulsar-zookeeper-2.0.0-rc1-incubating.jar:2.0.0-rc1-incubating]\r\n        at org.apache.zookeeper.server.quorum.FastLeaderElection.lookForLeader(FastLeaderElection.java:843) [org.apache.pulsar-pulsar-zookeeper-2.0.0-rc1-incubating.jar:2.0.0-rc1-incubating]\r\n        at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:913) [org.apache.pulsar-pulsar-zookeeper-2.0.0-rc1-incubating.jar:2.0.0-rc1-incubating]\r\n\r\n\r\nnslookup carocnxoappa9v.com\r\nServer:         2001:xxxx:a06:xxxx:f0:fef:0:yyy\r\nAddress:        2001:xxxx:a06:xxxx:f0:fef:0:yyy#53\r\n\r\n\r\n\r\n\r\n#### Steps to reproduce\r\n\r\n1. Follow the below link for Deploying a ZooKeeper cluster :https://pulsar.incubator.apache.org/docs/latest/deployment/cluster/\r\n2. Start the Zookeeper \r\n3. Issue : Problem is seen in the logs \r\ncat /VMB/vmb_install/apache-pulsar-2.0.0-rc1-incubating/logs/pulsar-zookeeper-server.log\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.0 \r\nPulsar 2.0.0-rc1-incubating binary release", "url": "https://github.com/apache/pulsar/issues/1949", "user": "dsambandam", "labels": ["type/bug"], "created": "2018-06-11 20:28:42", "closed": "2018-09-05 21:43:27", "commits": {}, "ttf": 86.00027777777778, "commitsDetails": []}, {"title": "Non serializable client builder", "body": "```\r\nOne of the main change concerns the \r\nconfiguration classes, replace by builders. Although ProducerBuilder and \r\nConsumerBuilder interfaces implement Serializable, corresponding \r\nimplementations aren't, because a pulsar client object is embedded. The \r\nschema object is also a problem for serialization.\r\n```", "url": "https://github.com/apache/pulsar/issues/1943", "user": "sijie", "labels": ["component/client", "type/bug"], "created": "2018-06-08 15:29:24", "closed": "2018-06-21 19:23:42", "commits": {"8599151eeed3bcec78964f40b21793220e0b27ea": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 13.000277777777777, "commitsDetails": [{"commitHash": "8599151eeed3bcec78964f40b21793220e0b27ea", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["0c1cc5452197512d42ea45a24a20981e183301a8"], "nameRev": "8599151eeed3bcec78964f40b21793220e0b27ea tags/v2.1.0-incubating-candidate-1~15", "commitMessage": "Issue 1943: remove serializable from builders and add loadData to load configuration from a config map (#2004)\n\n* Issue 1943: remove serializable from builders and add loadData to load configuration from a config map\r\n\r\n*Motivation*\r\n\r\nMake pulsar users be able to use java Serialization framework for distributing client settings. This is required for using pulsar in frameworks like Spark.\r\n\r\n*Changes*\r\n\r\n- Remove serializable from builders\r\n- Add a tool to load client/producer/consumer/reader configuration data from a Map config (which is serializable)\r\n\r\nFixes #1943\r\n\r\n* Address review comments:\r\n\r\n- add example in javadoc\r\n- change client builder to `loadConf` as well\r\n- change ConfigurationDataUtil to merge config to existing settings\r\n\r\nSigned-off-by: Sijie Guo <sijie@apache.org>\r\n\r\n* set FAIL_ON_UNKNOWN_PROPERTIES to true\r\nadd a test case to make sure exceptions thrown when loading config with unknown properties\r\n", "commitDateTime": "2018-06-21 12:23:41", "authoredDateTime": "2018-06-21 12:23:41", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/api/ClientBuilder.java", "insertions": 21, "deletions": 2, "lines": 23}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/api/ConsumerBuilder.java", "insertions": 21, "deletions": 2, "lines": 23}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/api/ConsumerEventListener.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/api/CryptoKeyReader.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/api/MessageId.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/api/ProducerBuilder.java", "insertions": 21, "deletions": 2, "lines": 23}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/api/PulsarClient.java", "insertions": 3, "deletions": 0, "lines": 3}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/api/ReaderBuilder.java", "insertions": 22, "deletions": 2, "lines": 24}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ClientBuilderImpl.java", "insertions": 10, "deletions": 4, "lines": 14}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBuilderImpl.java", "insertions": 9, "deletions": 4, "lines": 13}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerBuilderImpl.java", "insertions": 9, "deletions": 3, "lines": 12}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ReaderBuilderImpl.java", "insertions": 9, "deletions": 3, "lines": 12}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/conf/ClientConfigurationData.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/conf/ConfigurationDataUtils.java", "insertions": 75, "deletions": 0, "lines": 75}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/conf/ProducerConfigurationData.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/conf/ConfigurationDataUtilsTest.java", "insertions": 111, "deletions": 0, "lines": 111}, {"filePath": "pulsar-functions/instance/src/test/java/org/apache/pulsar/functions/instance/producers/MultiConsumersOneOutputTopicProducersTest.java", "insertions": 5, "deletions": 0, "lines": 5}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ClientBuilder.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.loadConf(java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerBuilder.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.loadConf(java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerEventListener.java", "spoonMethods": []}, {"spoonFilePath": "CryptoKeyReader.java", "spoonMethods": []}, {"spoonFilePath": "MessageId.java", "spoonMethods": []}, {"spoonFilePath": "ProducerBuilder.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.loadConf(java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PulsarClient.java", "spoonMethods": []}, {"spoonFilePath": "ReaderBuilder.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.loadConf(java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ClientBuilderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ClientBuilderImpl", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.ClientBuilderImpl.loadConf(java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerBuilderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBuilderImpl", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.client.impl.ConsumerBuilderImpl.loadConf(java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProducerBuilderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerBuilderImpl", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerBuilderImpl.loadConf(java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ReaderBuilderImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ReaderBuilderImpl", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.ReaderBuilderImpl.loadConf(java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ClientConfigurationData.java", "spoonMethods": []}, {"spoonFilePath": "ConfigurationDataUtils.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.conf.ConfigurationDataUtils", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProducerConfigurationData.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.conf.ProducerConfigurationData.isEncryptionEnabled()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConfigurationDataUtilsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.conf.ConfigurationDataUtilsTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "MultiConsumersOneOutputTopicProducersTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.functions.instance.producers.MultiConsumersOneOutputTopicProducersTest.MockProducerBuilder.loadConf(java.util.Map)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Proxy doesn't strip the request URL for admin requests correctly", "body": "#### Expected behavior\r\n\r\nUsing proxy to do admin tasks should work.\r\n\r\n#### Actual behavior\r\n\r\nOn client\r\n```\r\norg.apache.pulsar.client.admin.PulsarAdminException$NotAllowedException: HTTP 405 HTTP method PUT is not supported by this URL\r\n```\r\n\r\nFrom proxy log.\r\n```\r\n09:33:50.627 [pulsar-external-web-4-8] INFO  org.eclipse.jetty.server.RequestLog - 172.29.0.1 - - [17/May/2018:09:33:50 +0000] \"PUT //172.29.0.4:8080/admin/v2/persistent/s3-offload-test/ns1/topic1/offload HTTP/1.1\" 405 406 \"-\" \"Jersey/2.25 (HttpUrlConnection 1.8.0_151)\" 10\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\nSet up a broker with mostly default config (just set up zk stuff)\r\nSet up a proxy with mostly default config (just set zk and brokerServiceURL)\r\n\r\nI had \r\n```\r\nbrokerServiceURL=http://pulsar-broker1:8080\r\n```\r\nwhere pulsar-broker1 resolves to 172.29.0.5\r\n172.29.0.4 is the ip of the proxy itself.\r\n\r\nAdmin client is created with:\r\n```\r\nPulsarAdmin admin = new PulsarAdmin(new URL(\"http://172.29.0.4:8080\"), \"\", \"\")\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/1797", "user": "ivankelly", "labels": ["type/bug"], "created": "2018-05-17 10:02:24", "closed": "2018-06-07 03:57:19", "commits": {}, "ttf": 20.00027777777778, "commitsDetails": []}, {"title": "Proxy cannot be configured to work as proxy for both admin and client requests", "body": "#### Expected behavior\r\n\r\nWhen I start a proxy, I should be able to point both a client and an admin client at it, and expect it to work.\r\n\r\n#### Actual behavior\r\n\r\nBy default, admin client will not work, as brokerServiceURL isn't configured (this should come from zookeeper, the key isn't even in the default config file). \r\n\r\nIf I configure brokerServiceURL, then admin client works, but the client itself doesn't work, as it's trying to send binary protocol requests to a http endpoint.\r\n", "url": "https://github.com/apache/pulsar/issues/1796", "user": "ivankelly", "labels": ["type/bug"], "created": "2018-05-17 09:05:01", "closed": "2018-06-07 03:30:22", "commits": {}, "ttf": 20.00027777777778, "commitsDetails": []}, {"title": "Improve the k8s deployment documentation", "body": "Context:\r\n\r\n```\r\nByron [5:31 AM]\r\n\r\nso it turns out that when using `hostPath` for a volume.. it will retain the data on the host even after the pod is deleted. it _makes sense_ in how this feature is described, but i hadn\u2019t used this before. from the docs.\r\n\r\n> A hostPath volume mounts a file or directory from the host node\u2019s filesystem into your pod. This is not something that most Pods will need, but it offers a powerful escape hatch for some applications.\r\n\r\nFor the provided k8s configs in the repo, it may be better to not include volumes by default to prevent this from happening to newcomers. In the docs, there would be a warning stating that the configs do not provide cross restart persistent and that needs to be added.\r\n```", "url": "https://github.com/apache/pulsar/issues/1638", "user": "sijie", "labels": ["component/deploy", "component/documentation", "triage/week-29", "type/bug"], "created": "2018-04-24 17:40:27", "closed": "2020-04-14 09:24:20", "commits": {}, "ttf": 720.0002777777778, "commitsDetails": []}, {"title": "Fixes for patch release 1.22.1", "body": "I have created this issue just to track the commits to be backported to 1.22\r\n\r\n| Commit SHA-SUM        | Backported? (Y/N) | \r\n| ------------- |:-------------:| \r\n| TBD| No|", "url": "https://github.com/apache/pulsar/issues/1631", "user": "jai1", "labels": ["type/bug"], "created": "2018-04-22 07:35:17", "closed": "2018-04-23 18:00:12", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "NPE at topic termination when there is no consumers connected", "body": "#### Expected behavior\r\n\r\ntopic termination should work no matter if there are consumers connected or not.\r\n\r\n#### Actual behavior\r\n\r\ntopic termination would fail if there are not consumers connected.\r\n\r\n```\r\nApr 19 17:30:15 localhost broker[14076]: 2018-04-19 17:30:15,814 - ERROR - [pulsar-web-61-30:PersistentTopics@1311] - [null] Failed to terminated topic persistent://x/y/z\r\nApr 19 17:30:15 localhost broker[14076]: java.lang.NullPointerException\r\nApr 19 17:30:15 localhost broker[14076]: #011at org.apache.pulsar.broker.service.persistent.PersistentSubscription.topicTerminated(PersistentSubscription.java:672)\r\nApr 19 17:30:15 localhost broker[14076]: #011at org.apache.pulsar.broker.service.persistent.PersistentTopic$8.lambda$0(PersistentTopic.java:1444)\r\nApr 19 17:30:15 localhost broker[14076]: #011at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.forEach(ConcurrentOpenHashMap.java:386)\r\nApr 19 17:30:15 localhost broker[14076]: #011at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.forEach(ConcurrentOpenHashMap.java:160)\r\nApr 19 17:30:15 localhost broker[14076]: #011at org.apache.pulsar.broker.service.persistent.PersistentTopic$8.terminateComplete(PersistentTopic.java:1444)\r\nApr 19 17:30:15 localhost broker[14076]: #011at org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.asyncTerminate(ManagedLedgerImpl.java:895)\r\nApr 19 17:30:15 localhost broker[14076]: #011at org.apache.pulsar.broker.service.persistent.PersistentTopic.terminate(PersistentTopic.java:1440)\r\nApr 19 17:30:15 localhost broker[14076]: #011at org.apache.pulsar.broker.admin.PersistentTopics.terminate(PersistentTopics.java:1309)\r\nApr 19 17:30:15 localhost broker[14076]: #011at sun.reflect.GeneratedMethodAccessor57.invoke(Unknown Source)\r\nApr 19 17:30:15 localhost broker[14076]: #011at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\n- create a topic\r\n- produce messages\r\n- terminate the topic\r\n\r\n#### System configuration\r\n**Pulsar version**: 1.22.0\r\n", "url": "https://github.com/apache/pulsar/issues/1618", "user": "sijie", "labels": ["type/bug"], "created": "2018-04-19 18:43:36", "closed": "2018-04-20 18:16:33", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Underscore `_` should be allowed as property name", "body": "Validation of topic name is failed in `NamedEntity.checkURI` method when you create a subscription, cause it uses java URI class for validation and property stands for hostname which cannot contain underscore char `_`.\r\n\r\nAnother way of validation should be used for there.", "url": "https://github.com/apache/pulsar/issues/1506", "user": "zubchenok", "labels": ["type/bug"], "created": "2018-04-05 21:15:34", "closed": "2018-04-06 23:33:30", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Too frequent WARN or wrong number of seconds ", "body": "#### Expected behavior\r\n\r\ntime waited should correspond to frequency of output of WARN messages\r\n```\r\n10:16:25.438 [main] WARN  org.apache.pulsar.client.cli.PulsarClientTool - No message to consume after waiting for 5 seconds.\r\n10:16:30.439 [main] WARN  org.apache.pulsar.client.cli.PulsarClientTool - No message to consume after waiting for 5 seconds.\r\n10:16:35.440 [main] WARN  org.apache.pulsar.client.cli.PulsarClientTool - No message to consume after waiting for 5 seconds.\r\n10:16:40.441 [main] WARN  org.apache.pulsar.client.cli.PulsarClientTool - No message to consume after waiting for 5 seconds.\r\n10:16:45.446 [main] WARN  org.apache.pulsar.client.cli.PulsarClientTool - No message to consume after waiting for 5 seconds.\r\n```\r\n#### Actual behavior\r\n\r\noutputs WARN with wrong number of seconds\r\n(it says it waited 20 seconds but the output is every 5 seconds)\r\n\r\n```\r\n10:16:25.438 [main] WARN  org.apache.pulsar.client.cli.PulsarClientTool - No message to consume after waiting for 20 seconds.\r\n10:16:30.439 [main] WARN  org.apache.pulsar.client.cli.PulsarClientTool - No message to consume after waiting for 20 seconds.\r\n10:16:35.440 [main] WARN  org.apache.pulsar.client.cli.PulsarClientTool - No message to consume after waiting for 20 seconds.\r\n10:16:40.441 [main] WARN  org.apache.pulsar.client.cli.PulsarClientTool - No message to consume after waiting for 20 seconds.\r\n10:16:45.446 [main] WARN  org.apache.pulsar.client.cli.PulsarClientTool - No message to consume after waiting for 20 seconds.\r\n```\r\n#### Steps to reproduce\r\n\r\n```\r\npulsar-client consume persistent://sample/standalone/ns1/backwards \\\r\n  --subscription-name my-subscription \\\r\n  --num-messages 0\r\n```\r\n\r\n#### System configuration\r\n**Pulsar version**: 2.0.0\r\nmac \r\n", "url": "https://github.com/apache/pulsar/issues/1485", "user": "pouledodue", "labels": ["component/client", "type/bug"], "created": "2018-04-02 14:22:39", "closed": "2018-09-12 08:04:08", "commits": {"b7e3fdd0976b4703cc858ddebf7e9db17d9a9fd8": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 162.00027777777777, "commitsDetails": [{"commitHash": "b7e3fdd0976b4703cc858ddebf7e9db17d9a9fd8", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["edaaafc50391f44d79ae16b6f35e664ced7f5dc5"], "nameRev": "b7e3fdd0976b4703cc858ddebf7e9db17d9a9fd8 tags/v2.1.0-incubating-candidate-1~20", "commitMessage": "Downgrade pulsar-client CLI consume warning message (#1485) (#2012)\n\nPreviously this log would spam the stdout if there were no messages\r\ncoming in. The message wasn't even factually correct, as the timeout\r\nhad changed.\r\n\r\nI've downgraded the log warn to debug can corrected the factual error.", "commitDateTime": "2018-06-21 09:26:53", "authoredDateTime": "2018-06-21 18:26:53", "commitGitStats": [{"filePath": "pulsar-client-tools/src/main/java/org/apache/pulsar/client/cli/CmdConsume.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "CmdConsume.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.cli.CmdConsume.run()", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "MessageID has always batch index 0 when sending messages in a batch", "body": "When I send messages I always get 0 in batchIndex component of MessageID in the result of sendAsync method. Here is a unit test that reproduce the issue:\r\n```\r\n    @Test\r\n    public void testSameBatchIndex() throws Exception\r\n    {\r\n        String topicName = \"persistent://test-prop/vv/ns1/test-\" + UUID.randomUUID();\r\n        PulsarClient pulsarClient = PulsarClient.create(\"pulsar://vv:6650\");\r\n\r\n        Producer producer = pulsarClient.createProducer(topicName, new ProducerConfiguration()\r\n                .setBatchingEnabled(true)\r\n                .setBatchingMaxMessages(1000)\r\n                .setBatchingMaxPublishDelay(1, TimeUnit.SECONDS)\r\n        );\r\n\r\n        Consumer consumer = pulsarClient.subscribe(topicName, \"subscription\", new ConsumerConfiguration()\r\n                .setMessageListener((consumer1, message) -> System.out.println(\"Read: \" + message.getMessageId()))\r\n        );\r\n\r\n        producer.sendAsync(\"A\".getBytes()).whenCompleteAsync((messageId, throwable) -> {\r\n            System.out.println(\"A: \" + messageId);\r\n        });\r\n        producer.sendAsync(\"B\".getBytes()).whenCompleteAsync((messageId, throwable) -> {\r\n            System.out.println(\"B: \" + messageId);\r\n        });\r\n        producer.sendAsync(\"C\".getBytes()).whenCompleteAsync((messageId, throwable) -> {\r\n            System.out.println(\"C: \" + messageId);\r\n        });\r\n\r\n        Thread.sleep(3333);\r\n\r\n        consumer.close();\r\n        producer.close();\r\n        pulsarClient.close();\r\n    }\r\n\r\n```\r\nActual output is \r\n```\r\nA: 1286:0:-1:0\r\nB: 1286:0:-1:0\r\nC: 1286:0:-1:0\r\nRead: 1286:0:-1:0\r\nRead: 1286:0:-1:1\r\nRead: 1286:0:-1:2\r\n```\r\n\r\nExpected output is\r\n```\r\nA: 1286:0:-1:0\r\nB: 1286:0:-1:1\r\nC: 1286:0:-1:2\r\nRead: 1286:0:-1:0\r\nRead: 1286:0:-1:1\r\nRead: 1286:0:-1:2\r\n```\r\n\r\nversion: 1.22.0-incubating", "url": "https://github.com/apache/pulsar/issues/1455", "user": "zubchenok", "labels": ["component/client", "type/bug"], "created": "2018-03-27 14:45:05", "closed": "2018-07-06 15:37:08", "commits": {"83e31579f5df941ad49fb54ec269c1d917821504": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 101.00027777777778, "commitsDetails": [{"commitHash": "83e31579f5df941ad49fb54ec269c1d917821504", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["0420e594eeaf7268886f5dc307488151c9bfc27e"], "nameRev": "83e31579f5df941ad49fb54ec269c1d917821504 tags/v2.1.0-incubating-candidate-5~84", "commitMessage": "Issue 1455: MessageID has always batch index 0 when sending messages in a batch (#2099)\n\n*Motivation*\r\n\r\nFixes #1455.\r\n\r\nPulsar uses a callback chain for completing the list of callbacks for a batch. However the callback chain doesn't reference the message instance for completing the callback.\r\nso when callback chain is triggered, it always uses the first message id to complete the chain of callbacks.\r\n\r\n*Changes*\r\n\r\nIntroduce a field to keep message instance in the callback chain. So when the chain is invoked, each callback can use the right message instance to complete the callback.\r\n\r\nAdded an integration test to ensure it works correctly.", "commitDateTime": "2018-07-06 08:37:07", "authoredDateTime": "2018-07-06 08:37:07", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentReplicator.java", "insertions": 6, "deletions": 1, "lines": 7}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentReplicator.java", "insertions": 6, "deletions": 1, "lines": 7}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageContainer.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "insertions": 11, "deletions": 3, "lines": 14}, {"filePath": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/SendCallback.java", "insertions": 11, "deletions": 3, "lines": 14}, {"filePath": "tests/integration/semantics/src/test/java/org/apache/pulsar/tests/integration/semantics/SemanticsTest.java", "insertions": 64, "deletions": 0, "lines": 64}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NonPersistentReplicator.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentReplicator.ProducerSendCallback.getNextMessage()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.nonpersistent.NonPersistentReplicator.ProducerSendCallback.addCallback(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentReplicator.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentReplicator.ProducerSendCallback.getNextMessage()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentReplicator.ProducerSendCallback.addCallback(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BatchMessageContainer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.BatchMessageContainer.add(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.internalSendAsync(org.apache.pulsar.client.api.Message).2.sendComplete(java.lang.Exception)", "TOT": 7, "UPD": 1, "INS": 3, "MOV": 1, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.internalSendAsync(org.apache.pulsar.client.api.Message).2", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.internalSendAsync(org.apache.pulsar.client.api.Message).2.getNextMessage()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.ProducerImpl.internalSendAsync(org.apache.pulsar.client.api.Message).2.addCallback(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.client.impl.SendCallback)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SendCallback.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.impl.getNextMessage()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.client.impl.addCallback(org.apache.pulsar.client.impl.MessageImpl,org.apache.pulsar.client.impl.SendCallback)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SemanticsTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.tests.integration.semantics.SemanticsTest.testBatchProducing(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "reachedEndOfTopic is called twice if a topic has been terminated before subscription", "body": "When you terminate a topic and then subscribe, MessageListener.reachedEndOfTopic is called two times.\r\n\r\nThere is a unit test that reproduces the issue:\r\n\r\n```\r\n    @Test\r\n    public void testDoubledReachedEndOfTopic() throws Exception\r\n    {\r\n        String topicName = \"persistent://test-prop/vv/ns1/test-\" + UUID.randomUUID();\r\n        PulsarClient pulsarClient = PulsarClient.create(\"pulsar://vv:6650\");\r\n\r\n        Producer producer = pulsarClient.createProducer(topicName);\r\n        producer.close();\r\n\r\n        PulsarAdmin admin = new PulsarAdmin(new URL(\"http://vv:8080\"), new ClientConfiguration());\r\n        admin.persistentTopics().terminateTopicAsync(topicName).get();\r\n        admin.close();\r\n\r\n        CountDownLatch latch = new CountDownLatch(2);\r\n        Consumer consumer = pulsarClient.subscribe(topicName, \"subscription\", new ConsumerConfiguration()\r\n                .setMessageListener(new MessageListener()\r\n                {\r\n                    @Override\r\n                    public void reachedEndOfTopic(Consumer consumer)\r\n                    {\r\n                        System.out.println(\"reachedEndOfTopic\");\r\n                        latch.countDown();\r\n                    }\r\n\r\n                    @Override\r\n                    public void received(Consumer consumer, Message message)\r\n                    {\r\n                        // do nothing\r\n                    }\r\n                })\r\n        );\r\n\r\n        assertFalse(latch.await(3, TimeUnit.SECONDS));\r\n        assertTrue(latch.getCount() == 1);\r\n\r\n        consumer.close();\r\n        pulsarClient.close();\r\n    }\r\n```", "url": "https://github.com/apache/pulsar/issues/1452", "user": "zubchenok", "labels": ["component/client", "type/bug"], "created": "2018-03-27 02:15:04", "closed": "2018-08-05 23:49:43", "commits": {"3f8944f28ef2188d4bdab8f9394650fd799bc786": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "0cc5e81fcc5ac3859ee463556e6c1ed7e05d29a3": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 131.00027777777777, "commitsDetails": [{"commitHash": "3f8944f28ef2188d4bdab8f9394650fd799bc786", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["df02c7bfd12c0a62e25bd28b6ec0d35a7eaf7e9a"], "nameRev": "3f8944f28ef2188d4bdab8f9394650fd799bc786 tags/v2.2.0-candidate-1~315", "commitMessage": "Issue #1452: remove reachedEndOfTopic in addConsumer (#2301)\n\n### Motivation\r\n\r\nFixes #1452 \r\n\r\nIn issue #1452 , reachedEndOfTopic was called twice if a topic has been terminated before subscription.\r\nIt may be better to call `reachedEndOfTopic`, when real read/ack happened to the subscription, so delete the calling in `addConsumer` to avoid dup calling.\r\n\r\n### Modifications\r\n\r\nremove dup calling in `addConsumer` .\r\nadd related ut.\r\n\r\n### Result\r\n\r\nExpected all ut passed.", "commitDateTime": "2018-08-05 16:49:42", "authoredDateTime": "2018-08-06 07:49:42", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentSubscription.java", "insertions": 0, "deletions": 5, "lines": 5}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java", "insertions": 40, "deletions": 2, "lines": 42}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentSubscription.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentSubscription.addConsumer(org.apache.pulsar.broker.service.Consumer)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "SimpleProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testReachedEndOfTopic()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "0cc5e81fcc5ac3859ee463556e6c1ed7e05d29a3", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["5ac1322a7e919217b3979ff1a13c9a7e6ea34541"], "nameRev": "0cc5e81fcc5ac3859ee463556e6c1ed7e05d29a3 tags/v2.1.1-incubating-candidate-1~40", "commitMessage": "Issue #1452: remove reachedEndOfTopic in addConsumer (#2301)\n\n### Motivation\r\n\r\nFixes #1452 \r\n\r\nIn issue #1452 , reachedEndOfTopic was called twice if a topic has been terminated before subscription.\r\nIt may be better to call `reachedEndOfTopic`, when real read/ack happened to the subscription, so delete the calling in `addConsumer` to avoid dup calling.\r\n\r\n### Modifications\r\n\r\nremove dup calling in `addConsumer` .\r\nadd related ut.\r\n\r\n### Result\r\n\r\nExpected all ut passed.", "commitDateTime": "2018-08-27 02:13:52", "authoredDateTime": "2018-08-06 07:49:42", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentSubscription.java", "insertions": 0, "deletions": 5, "lines": 5}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java", "insertions": 40, "deletions": 2, "lines": 42}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentSubscription.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentSubscription.addConsumer(org.apache.pulsar.broker.service.Consumer)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "SimpleProducerConsumerTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.client.api.SimpleProducerConsumerTest.testReachedEndOfTopic()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Pulsar standalone fails to start with java 9", "body": "#### Expected behavior\r\n\r\n`./bin/pulsar standalone` should be able to run with java 9\r\n\r\n#### Actual behavior\r\n\r\nstandalone fails to start with following errors.\r\n\r\n```\r\nException in thread \"main\" java.lang.RuntimeException: java.lang.reflect.InvocationTargetException\r\n\tat com.ea.agentloader.AgentLoader$1.loadAgent(AgentLoader.java:244)\r\n\tat com.ea.agentloader.AgentLoader.loadAgent(AgentLoader.java:77)\r\n\tat com.ea.agentloader.AgentLoader.loadAgentClass(AgentLoader.java:148)\r\n\tat com.ea.agentloader.AgentLoader.loadAgentClass(AgentLoader.java:102)\r\n\tat org.apache.pulsar.PulsarStandaloneStarter.start(PulsarStandaloneStarter.java:178)\r\n\tat org.apache.pulsar.PulsarStandaloneStarter.main(PulsarStandaloneStarter.java:252)\r\nCaused by: java.lang.reflect.InvocationTargetException\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:564)\r\n\tat com.ea.agentloader.AgentLoader$1.loadAgent(AgentLoader.java:240)\r\n\t... 5 more\r\nCaused by: java.lang.RuntimeException: java.io.IOException: Can not attach to current VM\r\n\tat com.ea.agentloader.AgentLoaderHotSpot.getVirtualMachine(AgentLoaderHotSpot.java:90)\r\n\tat com.ea.agentloader.AgentLoaderHotSpot.loadAgent(AgentLoaderHotSpot.java:56)\r\n\t... 10 more\r\nCaused by: java.io.IOException: Can not attach to current VM\r\n\tat jdk.attach/sun.tools.attach.HotSpotVirtualMachine.<init>(HotSpotVirtualMachine.java:75)\r\n\tat jdk.attach/sun.tools.attach.VirtualMachineImpl.<init>(VirtualMachineImpl.java:58)\r\n\tat jdk.attach/sun.tools.attach.AttachProviderImpl.attachVirtualMachine(AttachProviderImpl.java:58)\r\n\tat jdk.attach/com.sun.tools.attach.VirtualMachine.attach(VirtualMachine.java:207)\r\n\tat com.ea.agentloader.AgentLoaderHotSpot.getVirtualMachine(AgentLoaderHotSpot.java:86)\r\n\t... 11 more\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\nuse java 9\r\n\r\n```\r\n$ java --version\r\njava 9.0.1\r\nJava(TM) SE Runtime Environment (build 9.0.1+11)\r\nJava HotSpot(TM) 64-Bit Server VM (build 9.0.1+11, mixed mode)\r\n```\r\n\r\nrun `bin/pulsar standalone`\r\n\r\n#### System configuration\r\n**Pulsar version**: master\r\n**Java**: java 9\r\n**OS**: mac\r\n", "url": "https://github.com/apache/pulsar/issues/1419", "user": "sijie", "labels": ["type/bug", "type/enhancement"], "created": "2018-03-22 07:29:37", "closed": "2019-02-11 17:07:28", "commits": {}, "ttf": 326.0002777777778, "commitsDetails": []}, {"title": "Docs about garbage collection are inaccurate/lacking", "body": "In the docs (http://pulsar.apache.org/docs/latest/admin/GeoReplication/#creating-global-namespaces) the section \"Delete a global topic\" says:\r\n\r\n> In Pulsar, a topic is automatically deleted when it\u2019s no longer used, that is to say, when no producers or consumers are connected and there are no subscriptions\r\n\r\nI believe it should say that it will also not be garbage collected if there are messages with retention > 0. And could be worth mentioning that you can turn this off with brokerDeleteInactiveTopicsEnabled=false.", "url": "https://github.com/apache/pulsar/issues/1416", "user": "piotrblasiak", "labels": ["component/documentation", "type/bug"], "created": "2018-03-21 19:10:34", "closed": "2018-06-29 22:30:37", "commits": {"99c0ed2d9309ae272a049852889827d227a87882": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 100.00027777777778, "commitsDetails": [{"commitHash": "99c0ed2d9309ae272a049852889827d227a87882", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["f1df0484d1f094d9bd48db18d28e1a1ef233f6db"], "nameRev": "99c0ed2d9309ae272a049852889827d227a87882 tags/v2.1.0-incubating-candidate-5~118", "commitMessage": "Issue 1416: Docs about garbage collection are inaccurate/lacking (#2049)\n\n*Motivation*\r\n\r\nFixes #1416. Improve documentation around garbage collecting topic in [GeoReplication](http://pulsar.apache.org/docs/latest/admin/GeoReplication/#creating-global-namespaces) documentation page.\r\n\r\n*Solution*\r\n\r\n- explicitly callout topics only being deleted when no messages are kept for retention.\r\n- callout the flag to disable garabge collecting inactive topics.", "commitDateTime": "2018-06-29 15:30:36", "authoredDateTime": "2018-06-29 15:30:36", "commitGitStats": [{"filePath": "site/docs/latest/admin/GeoReplication.md", "insertions": 3, "deletions": 1, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "pulsar-client-admin is missing deps in maven", "body": "#### Expected behavior\r\n\r\nInclude the pulsar-client-admin artifact and be able to instantiate and use PulsarAdmin.\r\n\r\n#### Actual behavior\r\n\r\nThere seems to be missing dependencies according to the exception:\r\n\r\n```\r\njava.lang.RuntimeException: java.lang.ClassNotFoundException: Provider org.apache.pulsar.admin.shade.org.glassfish.jersey.internal.RuntimeDelegateImpl could not be instantiated: java.lang.IllegalStateException: No generator was provided and there is no default generator registered\r\n\tat org.apache.pulsar.admin.shade.javax.ws.rs.ext.RuntimeDelegate.findDelegate(RuntimeDelegate.java:152)\r\n\tat org.apache.pulsar.admin.shade.javax.ws.rs.ext.RuntimeDelegate.getInstance(RuntimeDelegate.java:120)\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\n```\r\n<dependency>\r\n\t\t\t<groupId>org.apache.pulsar</groupId>\r\n\t\t\t<artifactId>pulsar-client-admin</artifactId>\r\n\t\t\t<version>${pulsar.version}</version>\r\n\t\t</dependency>\r\n```\r\n\r\n#### System configuration\r\n**Pulsar version**: 1.22.0-incubating\r\n", "url": "https://github.com/apache/pulsar/issues/1409", "user": "piotrblasiak", "labels": ["type/bug"], "created": "2018-03-21 10:34:29", "closed": "2018-04-27 01:50:39", "commits": {}, "ttf": 36.000277777777775, "commitsDetails": []}, {"title": "Intermittent test failures in BrokerBkEnsemblesTests.testSkipCorruptDataLedger()", "body": "https://builds.apache.org/job/pulsar-pull-request/org.apache.pulsar$pulsar-broker/2119/testReport/junit/org.apache.pulsar.broker.service/BrokerBkEnsemblesTests/testSkipCorruptDataLedger/\r\n\r\n```\r\nError Message\r\n\r\nMethod org.apache.pulsar.broker.service.BrokerBkEnsemblesTests.testSkipCorruptDataLedger() didn't finish within the time-out 6000\r\n\r\nStacktrace\r\n\r\norg.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.broker.service.BrokerBkEnsemblesTests.testSkipCorruptDataLedger() didn't finish within the time-out 6000\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:271)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```", "url": "https://github.com/apache/pulsar/issues/1388", "user": "merlimat", "labels": ["component/test", "type/bug"], "created": "2018-03-15 03:31:56", "closed": "2018-11-21 21:52:28", "commits": {}, "ttf": 251.00027777777777, "commitsDetails": []}, {"title": "Unable to delete partitioned metadata for a partitioned topic", "body": "Unable to delete the metadata for a partitioned topic if no messages are produced on that topic.\r\n\r\nRepo steps:\r\n\r\n1 - create a partitioned topic\r\n2 - delete the partitioned topic before producing messages to it\r\n", "url": "https://github.com/apache/pulsar/issues/1383", "user": "cckellogg", "labels": ["component/cli", "type/bug"], "created": "2018-03-14 18:57:36", "closed": "2018-07-18 12:49:38", "commits": {}, "ttf": 125.00027777777778, "commitsDetails": []}, {"title": "Ensure that api package doesn't expose impl classes", "body": "#### Expected behavior\r\n\r\nAPIs shouldn't expose impl classes.\r\n\r\n#### Actual behavior\r\n\r\n```\r\n$ git grep import | grep api/ | grep -v test/ | grep impl\r\npulsar-broker/src/main/java/org/apache/pulsar/client/api/RawReader.java:import org.apache.pulsar.client.impl.PulsarClientImpl;\r\npulsar-broker/src/main/java/org/apache/pulsar/client/api/RawReader.java:import org.apache.pulsar.client.impl.RawReaderImpl;\r\npulsar-client/src/main/java/org/apache/pulsar/client/api/AuthenticationFactory.java:import org.apache.pulsar.client.impl.auth.AuthenticationDisabled;\r\npulsar-client/src/main/java/org/apache/pulsar/client/api/ClientConfiguration.java:import org.apache.pulsar.client.impl.conf.ClientConfigurationData;\r\npulsar-client/src/main/java/org/apache/pulsar/client/api/Consumer.java:import org.apache.pulsar.client.impl.ConsumerStats;\r\npulsar-client/src/main/java/org/apache/pulsar/client/api/ConsumerConfiguration.java:import org.apache.pulsar.client.impl.conf.ConsumerConfigurationData;\r\npulsar-client/src/main/java/org/apache/pulsar/client/api/MessageBuilder.java:import org.apache.pulsar.client.impl.MessageBuilderImpl;\r\npulsar-client/src/main/java/org/apache/pulsar/client/api/MessageId.java:import org.apache.pulsar.client.impl.MessageIdImpl;\r\npulsar-client/src/main/java/org/apache/pulsar/client/api/Producer.java:import org.apache.pulsar.client.impl.ProducerStats;\r\npulsar-client/src/main/java/org/apache/pulsar/client/api/ProducerConfiguration.java:import org.apache.pulsar.client.impl.conf.ProducerConfigurationData;\r\npulsar-client/src/main/java/org/apache/pulsar/client/api/PulsarClient.java:import org.apache.pulsar.client.impl.ClientBuilderImpl;\r\npulsar-client/src/main/java/org/apache/pulsar/client/api/PulsarClient.java:import org.apache.pulsar.client.impl.PulsarClientImpl;\r\npulsar-client/src/main/java/org/apache/pulsar/client/api/ReaderConfiguration.java:import org.apache.pulsar.client.impl.conf.ReaderConfigurationData;\r\n```\r\n\r\n### Note\r\n\r\n- Some will be fixed with #1321\r\n- Some might be false alert since I just did grep `import` line\r\n- Ideally api package shouldn't depend on any impl classes, but there might be acceptable cases\r\n", "url": "https://github.com/apache/pulsar/issues/1326", "user": "maskit", "labels": ["component/client", "type/bug", "type/enhancement"], "created": "2018-03-04 13:22:01", "closed": "2019-02-14 14:55:33", "commits": {}, "ttf": 347.0002777777778, "commitsDetails": []}, {"title": "Provide documentation for running BookKeeper auto-recovery", "body": "While BookKeeper auto-recovery has already been incorporated into the Pulsar setup for DC/OS and Kubernetes. We need to provide instructions for bare metal deployments as well.", "url": "https://github.com/apache/pulsar/issues/1288", "user": "lucperkins", "labels": ["component/documentation", "type/bug"], "created": "2018-02-26 19:51:45", "closed": "2018-07-18 03:47:28", "commits": {"fd7b32c6ed4d8fd814c90718c143fcb7818c11e8": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 141.00027777777777, "commitsDetails": [{"commitHash": "fd7b32c6ed4d8fd814c90718c143fcb7818c11e8", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["f0024d2d95b947f1e2ac09165133ed1fde146cb9"], "nameRev": "fd7b32c6ed4d8fd814c90718c143fcb7818c11e8 tags/v2.1.0-incubating-candidate-5~12", "commitMessage": "Issue 1288: Provide documentation for running BookKeeper auto-recovery (#2186)\n\n* Issue 1288: Provide documentation for running BookKeeper auto-recovery\r\n\r\n ### Motivation\r\n\r\nFixes #1288. We mentioned auto-recovery in DCOS deployment. but we don't have any instructions to run auto-recovery in bare-mental deployment.\r\n\r\n ### Changes\r\n\r\nUpdate the documentation in bare-mental deployment.\r\n\r\n* Enable autorecovery for ansible\r\n", "commitDateTime": "2018-07-17 20:47:27", "authoredDateTime": "2018-07-17 20:47:27", "commitGitStats": [{"filePath": "deployment/terraform-ansible/templates/bookkeeper.conf", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "site/docs/latest/deployment/cluster.md", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Metadata lookup for a non-persistent partitioned topic returns there are no partitions", "body": "When using a non-persistent topic with partitions, the metadata can be set correctly through the `pulsar-admin` tool. \r\nHowever, when a producer tries to use this topic, it will not discover that this is partitioned and will use it as a single topic.", "url": "https://github.com/apache/pulsar/issues/1250", "user": "merlimat", "labels": ["type/bug"], "created": "2018-02-19 16:03:15", "closed": "2018-02-19 18:43:46", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Buffer truncated in producer when sending ", "body": "#### Actual behavior\r\n\r\nThere is a condition in which the Java producer gets stuck sending truncated buffers. This can be seen happening in very precise conditions: \r\n\r\n * Batching enabled (doesn't reproduce without batching at all)\r\n * Network used ~100%  in brokers/clients\r\n * A decent number of partitions (eg: 300)\r\n * Producer reconnecting (not necessarily creating TCP connection, but re-establishing the producer after a bundle unload).\r\n\r\n#### Examples of exceptions : \r\n\r\nIn consumer logs:\r\n\r\n```\r\n2018-02-07 02:15:48,377 WARN  org.apache.pulsar.client.impl.ClientCnx:159 [pulsar-client-io-1-1] [exceptionCaught] [/100.85.173.79:6650] Got exception IndexOutOfBoundsException : writerIndex: 1751739039 (expected: readerIndex(52) <= writerIndex <= capacity(20896))\r\njava.lang.IndexOutOfBoundsException: writerIndex: 1751739039 (expected: readerIndex(52) <= writerIndex <= capacity(20896))\r\n    at org.apache.pulsar.shade.io.netty.buffer.AbstractByteBuf.writerIndex(AbstractByteBuf.java:118)\r\n    at org.apache.pulsar.shade.org.apache.pulsar.common.api.Commands.deSerializeSingleMessageInBatch(Commands.java:819)\r\n    at org.apache.pulsar.client.impl.ConsumerImpl.receiveIndividualMessagesFromBatch(ConsumerImpl.java:904)\r\n    at org.apache.pulsar.client.impl.ConsumerImpl.messageReceived(ConsumerImpl.java:812)\r\n    at org.apache.pulsar.client.impl.ClientCnx.handleMessage(ClientCnx.java:224)\r\n    at org.apache.pulsar.shade.org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:160)\r\n```\r\nIn this case the consumer received a batch where the count of messages was 3, but there were actually only 2 messages in the frame. \r\n\r\nIn broker logs: \r\n\r\n```\r\n2018-02-08 04:53:44,176 - ERROR [pulsar-io-55-5:Producer@180] - [PersistentTopic{topic=persistent://matteo/local/ns2/t300-partition-270}] [local-1-5055] Failed to verify checksum\r\n2018-02-08 04:53:44,176 - WARN  [pulsar-io-55-5:ServerCnx@177] - [/10.0.0.218:35556] Got exception IndexOutOfBoundsException : readerIndex(0) + length(4) exceeds writerIndex(0): PooledSlicedByteBuf(\r\nridx: 0, widx: 0, cap: 0/0, unwrapped: PooledUnsafeDirectByteBuf(ridx: 128064, widx: 208394, cap: 262144))\r\njava.lang.IndexOutOfBoundsException: readerIndex(0) + length(4) exceeds writerIndex(0): PooledSlicedByteBuf(ridx: 0, widx: 0, cap: 0/0, unwrapped: PooledUnsafeDirectByteBuf(ridx: 128064, widx: 20839\r\n4, cap: 262144))\r\n        at io.netty.buffer.AbstractByteBuf.checkReadableBytes0(AbstractByteBuf.java:1403)\r\n        at io.netty.buffer.AbstractByteBuf.readInt(AbstractByteBuf.java:786)\r\n        at io.netty.buffer.AbstractByteBuf.readUnsignedInt(AbstractByteBuf.java:802)\r\n        at org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:75)\r\n```\r\n\r\n#### Possible causes\r\n\r\nThe tcpdump captures show that the \"send\" request from producer are truncated", "url": "https://github.com/apache/pulsar/issues/1201", "user": "merlimat", "labels": ["type/bug"], "created": "2018-02-08 06:16:36", "closed": "2018-02-09 06:19:34", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Errors in increasing number of partitions for a partitioned topic", "body": "There are few errors that are happening under certain conditions when increasing the number of partitions for a topic.\r\n\r\n1. Increasing the partitions for a topic that was not used results in a 500 error with exception in the broker logs: \r\n\r\n```bash\r\nbin/pulsar-admin persistent create-partitioned-topic $TOPIC -p 10\r\n# and immediately after :\r\nbin/pulsar-admin persistent update-partitioned-topic $TOPIC -p 20\r\n```\r\n\r\n```\r\n2018-01-30 00:53:39,353 - WARN  - [bookkeeper-ml-workers-51-1:PersistentTopics$3@1506] - [null] Failed to get list of cursors of test/local/ns/persistent/my-topic-partition-1\r\n2018-01-30 00:53:39,353 - ERROR - [pulsar-web-69-23:PersistentTopics@463] - [null] Failed to update partitioned topic persistent://test/local/ns/my-topic\r\n org.apache.bookkeeper.mledger.ManagedLedgerException$MetaStoreException: org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode\r\n Caused by: org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode\r\n at org.apache.zookeeper.KeeperException.create(KeeperException.java:111)\r\n at org.apache.bookkeeper.mledger.impl.MetaStoreImplZookeeper.lambda$null$5(MetaStoreImplZookeeper.java:202)\r\nJan 30 00:53:39 ip-10-0-0-96.us-west-2.compute.internal pulsar[12513]: at org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:30)\r\nJan 30 00:53:39 ip-10-0-0-96.us-west-2.compute.internal pulsar[12513]: at org.apache.bookkeeper.util.SafeRunnable.run(SafeRunnable.java:31)\r\nJan 30 00:53:39 ip-10-0-0-96.us-west-2.compute.internal pulsar[12513]: at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\nJan 30 00:53:39 ip-10-0-0-96.us-west-2.compute.internal pulsar[12513]: at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\nJan 30 00:53:39 ip-10-0-0-96.us-west-2.compute.internal pulsar[12513]: at io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.java:138)\r\nJan 30 00:53:39 ip-10-0-0-96.us-west-2.compute.internal pulsar[12513]: at java.lang.Thread.run(Thread.java:748)\r\nJan 30 00:53:39 ip-10-0-0-96.us-west-2.compute.internal pulsar[12513]: 2018-01-30 00:53:39,358 - INFO  - [pulsar-web-69-23:Slf4jRequestLog@60] - 10.0.0.100 - - [30/Jan/2018:00:53:39 +0000] \"POST //10.0.0.96:8080/admin/persistent/test/local/ns/my-topic/partitions HTTP/1.1\" 500 1045 \"-\" \"Jersey/2.23.2 (HttpU\r\n```\r\n\r\nThis is due to the broker trying to get the list of existing subscriptions for the topic (with the purpose of pre-creating the subscriptions on the new partitions) and failing at it.\r\n\r\n 2. In some condition the update also fails when the partitioned topic is fully created, because the HTTP request is not routed to the broker owning the particular partition (again when trying to pre-create the subscription).\r\n\r\n```\r\n2018-01-30 00:58:48,482 - WARN  - [bookkeeper-ml-workers-44-1:BrokerService@867] - Namespace not served by this instance. Please redo the lookup. Request is denied: namespace=test/local/ns\r\n2018-01-30 00:58:48,482 - WARN  - [bookkeeper-ml-workers-44-1:BrokerService@439] - [persistent://test/local/ns/my-topic-partition-10] Service unit is not ready when loading the topic\r\n``` \r\n\r\nIn this case the broker fails to validate the ownership and the REST request stays stuck with no response sent back to caller.\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/1143", "user": "merlimat", "labels": ["type/bug"], "created": "2018-01-30 02:11:45", "closed": "2018-02-03 16:29:34", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "Intermittent test failure in testSkipCorruptDataLedger", "body": "\r\nhttps://builds.apache.org/job/pulsar-pull-request/org.apache.pulsar$pulsar-broker/1274/testReport/junit/org.apache.pulsar.broker.service/BrokerBkEnsemblesTests/testSkipCorruptDataLedger/\r\n\r\n```\r\nMethod org.apache.pulsar.broker.service.BrokerBkEnsemblesTests.testSkipCorruptDataLedger() didn't finish within the time-out 6000\r\n```", "url": "https://github.com/apache/pulsar/issues/1126", "user": "merlimat", "labels": ["component/test", "type/bug"], "created": "2018-01-28 00:05:39", "closed": "2019-02-21 09:30:24", "commits": {}, "ttf": 389.0002777777778, "commitsDetails": []}, {"title": "Exception during namespace bundle split", "body": "This particular exception was reported. It was during an automatically initiated bundle split. \r\n\r\n```\r\n2018-01-26 00:38:08,489 - ERROR - [pulsar-web-61-28:PulsarWebResource@381] - [null] Failed to validate namespace bundle netflix/prod/ns1/0x84000000_0x86000000\r\njava.lang.IllegalArgumentException: Invalid upper boundary for bundle\r\n    at com.google.common.base.Preconditions.checkArgument(Preconditions.java:122)\r\n    at org.apache.pulsar.common.naming.NamespaceBundles.validateBundle(NamespaceBundles.java:110)\r\n    at org.apache.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleRange(PulsarWebResource.java:378)\r\n    at org.apache.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleOwnership(PulsarWebResource.java:404)\r\n    at org.apache.pulsar.broker.admin.Namespaces.splitNamespaceBundle(Namespaces.java:876)\r\n    at sun.reflect.GeneratedMethodAccessor127.invoke(Unknown Source)\r\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n    at java.lang.reflect.Method.invoke(Method.java:498)\r\n    at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81)\r\n    at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144)\r\n    at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161)\r\n    at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:143)\r\n    at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99)\r\n    at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389)\r\n    at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347)\r\n    at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102)\r\n    at org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326)\r\n```\r\n\r\nI think that the race condition is happening since all 4 initial bundles are getting split around the same time and the bundle cache gets updated while the new bundle split is being processed. \r\n\r\nThe result doesn't cause any particular issue, just that the bundle split fails with invalid bundle range, but the current bundle will continue to run unaffacted until the next split will take place.", "url": "https://github.com/apache/pulsar/issues/1117", "user": "merlimat", "labels": ["type/bug"], "created": "2018-01-26 01:36:41", "closed": "2018-03-27 21:25:10", "commits": {"ea391488145d7e59309ee1c243bd38b9f9768773": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "dd5c425f9b9df0de4852a49a9d8f731020271320": {"commitGHEventType": "referenced", "commitUser": "jai1"}}, "ttf": 60.000277777777775, "commitsDetails": [{"commitHash": "ea391488145d7e59309ee1c243bd38b9f9768773", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["527731cff64be2d8ebcc09921aaec843ff9ca7d4"], "nameRev": "ea391488145d7e59309ee1c243bd38b9f9768773 tags/v2.0.0-rc1-incubating-candidate-1~221", "commitMessage": "Issue #1117: handle race in concurrent bundle split (#1428)\n\n*  handle race in bundle split\r\n\r\n* change following comments\r\n\r\n* rebase master, fix test error\r\n", "commitDateTime": "2018-03-27 14:25:09", "authoredDateTime": "2018-03-27 14:25:10", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/cache/LocalZooKeeperCacheService.java", "insertions": 16, "deletions": 5, "lines": 21}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/namespace/NamespaceService.java", "insertions": 116, "deletions": 55, "lines": 171}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 12, "deletions": 1, "lines": 13}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/common/naming/NamespaceBundleFactory.java", "insertions": 23, "deletions": 9, "lines": 32}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/common/naming/NamespaceBundles.java", "insertions": 13, "deletions": 5, "lines": 18}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java", "insertions": 115, "deletions": 0, "lines": 115}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/namespace/NamespaceServiceTest.java", "insertions": 3, "deletions": 7, "lines": 10}, {"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZooKeeperDataCache.java", "insertions": 8, "deletions": 0, "lines": 8}], "commitSpoonAstDiffStats": [{"spoonFilePath": "LocalZooKeeperCacheService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.cache.LocalZooKeeperCacheService.2.getAsync(java.lang.String)", "TOT": 7, "UPD": 5, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.cache.LocalZooKeeperCacheService.2.getWithStatAsync(java.lang.String)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NamespaceService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService.splitAndOwnBundle(org.apache.pulsar.common.naming.NamespaceBundle,boolean)", "TOT": 50, "UPD": 10, "INS": 1, "MOV": 32, "DEL": 7}, {"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService.updateNamespaceBundles(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.naming.NamespaceBundles,org.apache.zookeeper.AsyncCallback.StatCallback)", "TOT": 13, "UPD": 2, "INS": 5, "MOV": 2, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService.splitAndOwnBundleOnceAndRetry(org.apache.pulsar.common.naming.NamespaceBundle,boolean,java.util.concurrent.atomic.AtomicInteger,java.util.concurrent.CompletableFuture)", "TOT": 16, "UPD": 0, "INS": 16, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getAllTopicsFromNamespaceBundle(java.lang.String,java.lang.String)", "TOT": 8, "UPD": 1, "INS": 4, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "NamespaceBundleFactory.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceBundleFactory", "TOT": 9, "UPD": 3, "INS": 4, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceBundleFactory.splitBundles(org.apache.pulsar.common.naming.NamespaceBundle,int)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceBundleFactory.getBundles(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.policies.data.BundlesData)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceBundleFactory.getBundles(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.policies.data.BundlesData,long)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NamespaceBundles.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceBundles", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceBundles.getVersion()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.testNamespaceSplitBundleConcurrent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NamespaceServiceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceServiceTest.testSplitMapWithRefreshedStatMap()", "TOT": 4, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "ZooKeeperDataCache.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.ZooKeeperDataCache.getWithStatAsync(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "dd5c425f9b9df0de4852a49a9d8f731020271320", "commitGHEventType": "referenced", "commitUser": "jai1", "commitParents": ["5d14788e510faec23fd8ed189ed343e93b489dda"], "nameRev": "dd5c425f9b9df0de4852a49a9d8f731020271320 tags/v1.22.1-incubating-candidate-1~9", "commitMessage": "Issue #1117: handle race in concurrent bundle split \n\n", "commitDateTime": "2018-05-02 01:27:05", "authoredDateTime": "2018-05-02 01:27:05", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/cache/LocalZooKeeperCacheService.java", "insertions": 16, "deletions": 5, "lines": 21}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/namespace/NamespaceService.java", "insertions": 116, "deletions": 55, "lines": 171}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "insertions": 12, "deletions": 1, "lines": 13}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/common/naming/NamespaceBundleFactory.java", "insertions": 23, "deletions": 9, "lines": 32}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/common/naming/NamespaceBundles.java", "insertions": 13, "deletions": 5, "lines": 18}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java", "insertions": 115, "deletions": 0, "lines": 115}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/namespace/NamespaceServiceTest.java", "insertions": 3, "deletions": 7, "lines": 10}, {"filePath": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZooKeeperDataCache.java", "insertions": 8, "deletions": 0, "lines": 8}], "commitSpoonAstDiffStats": [{"spoonFilePath": "LocalZooKeeperCacheService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.cache.LocalZooKeeperCacheService.2.getAsync(java.lang.String)", "TOT": 7, "UPD": 5, "INS": 1, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.cache.LocalZooKeeperCacheService.2.getWithStatAsync(java.lang.String)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NamespaceService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService.splitAndOwnBundle(org.apache.pulsar.common.naming.NamespaceBundle,boolean)", "TOT": 50, "UPD": 10, "INS": 1, "MOV": 32, "DEL": 7}, {"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService.updateNamespaceBundles(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.naming.NamespaceBundles,org.apache.zookeeper.AsyncCallback.StatCallback)", "TOT": 13, "UPD": 2, "INS": 5, "MOV": 2, "DEL": 4}, {"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceService.splitAndOwnBundleOnceAndRetry(org.apache.pulsar.common.naming.NamespaceBundle,boolean,java.util.concurrent.atomic.AtomicInteger,java.util.concurrent.CompletableFuture)", "TOT": 16, "UPD": 0, "INS": 16, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "BrokerService.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.BrokerService.getAllTopicsFromNamespaceBundle(java.lang.String,java.lang.String)", "TOT": 8, "UPD": 1, "INS": 4, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "NamespaceBundleFactory.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceBundleFactory", "TOT": 9, "UPD": 3, "INS": 4, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceBundleFactory.splitBundles(org.apache.pulsar.common.naming.NamespaceBundle,int)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceBundleFactory.getBundles(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.policies.data.BundlesData)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceBundleFactory.getBundles(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.policies.data.BundlesData,long)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NamespaceBundles.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceBundles", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.common.naming.NamespaceBundles.getVersion()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminApiTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.AdminApiTest.testNamespaceSplitBundleConcurrent()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "NamespaceServiceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.namespace.NamespaceServiceTest.testSplitMapWithRefreshedStatMap()", "TOT": 4, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "ZooKeeperDataCache.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.zookeeper.ZooKeeperDataCache.getWithStatAsync(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["dd5c425f9b9df0de4852a49a9d8f731020271320"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 188, "deletions": 75, "lines": 263, "gitFilesChange": 6}, "spoonStatsSummary": {"TOT": 119, "UPD": 21, "INS": 46, "MOV": 39, "DEL": 13, "spoonFilesChanged": 6, "spoonMethodsChanged": 14}, "statsSkippedReason": "", "changesInPackagesGIT": ["pulsar-broker/src/main/java/org/apache/pulsar/broker/service", "pulsar-broker/src/main/java/org/apache/pulsar/common/naming", "pulsar-broker/src/main/java/org/apache/pulsar/broker/namespace", "pulsar-broker/src/main/java/org/apache/pulsar/broker/cache", "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper"], "changesInPackagesSPOON": ["org.apache.pulsar.common.naming.NamespaceBundleFactory.getBundles(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.policies.data.BundlesData)", "org.apache.pulsar.broker.namespace.NamespaceService.splitAndOwnBundleOnceAndRetry(org.apache.pulsar.common.naming.NamespaceBundle,boolean,java.util.concurrent.atomic.AtomicInteger,java.util.concurrent.CompletableFuture)", "org.apache.pulsar.common.naming.NamespaceBundleFactory", "org.apache.pulsar.zookeeper.ZooKeeperDataCache.getWithStatAsync(java.lang.String)", "org.apache.pulsar.common.naming.NamespaceBundles.getVersion()", "org.apache.pulsar.broker.cache.LocalZooKeeperCacheService.2.getWithStatAsync(java.lang.String)", "org.apache.pulsar.broker.cache.LocalZooKeeperCacheService.2.getAsync(java.lang.String)", "org.apache.pulsar.common.naming.NamespaceBundleFactory.getBundles(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.policies.data.BundlesData,long)", "org.apache.pulsar.common.naming.NamespaceBundles", "org.apache.pulsar.broker.namespace.NamespaceService.splitAndOwnBundle(org.apache.pulsar.common.naming.NamespaceBundle,boolean)", "org.apache.pulsar.broker.namespace.NamespaceService", "org.apache.pulsar.common.naming.NamespaceBundleFactory.splitBundles(org.apache.pulsar.common.naming.NamespaceBundle,int)", "org.apache.pulsar.broker.service.BrokerService.getAllTopicsFromNamespaceBundle(java.lang.String,java.lang.String)", "org.apache.pulsar.broker.namespace.NamespaceService.updateNamespaceBundles(org.apache.pulsar.common.naming.NamespaceName,org.apache.pulsar.common.naming.NamespaceBundles,org.apache.zookeeper.AsyncCallback.StatCallback)"]}, {"title": "Intermittent test failures in DiscoveryServiceTest.testClientServerConnectionTls", "body": "https://builds.apache.org/job/pulsar-master/org.apache.pulsar$pulsar-discovery-service/219/testReport/junit/org.apache.pulsar.discovery.service/DiscoveryServiceTest/testClientServerConnectionTls/\r\n\r\n```\r\njava.lang.AssertionError: expected [true] but found [false]\r\n\tat org.testng.Assert.fail(Assert.java:96)\r\n\tat org.testng.Assert.failNotEquals(Assert.java:776)\r\n\tat org.testng.Assert.assertTrue(Assert.java:44)\r\n\tat org.testng.Assert.assertTrue(Assert.java:54)\r\n\tat org.apache.pulsar.discovery.service.DiscoveryServiceTest.testClientServerConnectionTls(DiscoveryServiceTest.java:149)\r\n```", "url": "https://github.com/apache/pulsar/issues/1081", "user": "merlimat", "labels": ["component/test", "type/bug"], "created": "2018-01-18 17:55:25", "closed": "2018-09-12 08:08:21", "commits": {"774cafa25d6340c778c5c281045446086aff96a0": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 236.00027777777777, "commitsDetails": [{"commitHash": "774cafa25d6340c778c5c281045446086aff96a0", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["8da066947b339d1f71025f8d3857bb7e5b9e70a2"], "nameRev": "774cafa25d6340c778c5c281045446086aff96a0 tags/v2.2.0-candidate-1~210", "commitMessage": "Fix flake in DiscoveryServiceTest (#1081) (#2406)\n\nThis test was flaking because it was only waiting for 1 second for\r\nconnection and message exchange to complete, which is not enough time\r\nwhen there's heavy load on the machine (simulated with stress-ng).\r\n\r\nThe fix is to increase the timeout to 10 seconds. I've also cleaned up\r\nthe test to use a CompletableFuture rather than a CountDownLatch so\r\ntha the test thread can be notified of failures in the handlers.", "commitDateTime": "2018-08-27 22:30:42", "authoredDateTime": "2018-08-28 07:30:42", "commitGitStats": [{"filePath": "pulsar-discovery-service/src/test/java/org/apache/pulsar/discovery/service/DiscoveryServiceTest.java", "insertions": 43, "deletions": 34, "lines": 77}], "commitSpoonAstDiffStats": [{"spoonFilePath": "DiscoveryServiceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.discovery.service.DiscoveryServiceTest.testClientServerConnection()", "TOT": 12, "UPD": 7, "INS": 1, "MOV": 2, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.discovery.service.DiscoveryServiceTest.testClientServerConnectionTls()", "TOT": 13, "UPD": 7, "INS": 1, "MOV": 3, "DEL": 2}, {"spoonMethodName": "org.apache.pulsar.discovery.service.DiscoveryServiceTest.connectToService(java.lang.String,java.util.concurrent.CountDownLatch,boolean)", "TOT": 4, "UPD": 2, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.discovery.service.DiscoveryServiceTest.ClientHandler", "TOT": 6, "UPD": 6, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.discovery.service.DiscoveryServiceTest.ClientHandler.exceptionCaught(io.netty.channel.ChannelHandlerContext,java.lang.Throwable)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.discovery.service.DiscoveryServiceTest.ClientHandler.channelRead(io.netty.channel.ChannelHandlerContext,java.lang.Object)", "TOT": 6, "UPD": 1, "INS": 1, "MOV": 3, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.discovery.service.DiscoveryServiceTest.connectToService(java.lang.String,java.util.concurrent.CountDownLatch,boolean).1.initChannel(io.netty.channel.socket.SocketChannel)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.discovery.service.DiscoveryServiceTest.ClientHandler.channelActive(io.netty.channel.ChannelHandlerContext)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.discovery.service.DiscoveryServiceTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.discovery.service.DiscoveryServiceTest.connectToService(java.lang.String,java.util.concurrent.CompletableFuture,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Problems with Partitioned Topics which name contains -partition-N", "body": "Someone accidentally created a partitioned topic in one of our cluster with a name which contains `-partition-2`.\r\nThis raised all sorts of issues, it would seem that only one partition was created for this topic, but metadata exists saying that it has 10 partitions.\r\nWhen trying to get the subscriptions on the topic via HTTP the requests hang forever because we never merged https://github.com/apache/incubator-pulsar/pull/564\r\nWhen trying to get partitioned-stats for the topic a warning is logged saying that no partition metadata was found.\r\n\r\nWe should probably:\r\n1 - Don't allow partitioned topics which contain `-partition-` on its name\r\n2 - Fix logic to allow those topics", "url": "https://github.com/apache/pulsar/issues/1067", "user": "sschepens", "labels": ["component/client", "type/bug"], "created": "2018-01-16 16:24:37", "closed": "2018-08-11 02:40:44", "commits": {"cb16f5584d316de275aa60f69a6391f449a3e3d1": {"commitGHEventType": "referenced", "commitUser": "sijie"}, "05488a0be6e27292344a093f694d2a5f48886601": {"commitGHEventType": "referenced", "commitUser": "sijie"}}, "ttf": 206.00027777777777, "commitsDetails": [{"commitHash": "cb16f5584d316de275aa60f69a6391f449a3e3d1", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["8655d53b62c6e8f25cc629f7922f52e23b07c768"], "nameRev": "cb16f5584d316de275aa60f69a6391f449a3e3d1 tags/v2.2.0-candidate-1~282", "commitMessage": "Issue 1067: Problems with Partitioned Topics which name contains -partition-N (#2342)\n\n* Issue 1067: Problems with Partitioned Topics which name contains -partition-N\r\n\r\n ### Motivation\r\n\r\nFixes #1067.\r\n\r\nSomeone accidentally created a partitioned topic in one of our cluster with a name which contains -partition-2.\r\nThis raised all sorts of issues, it would seem that only one partition was created for this topic, but metadata exists saying that it has 10 partitions.\r\n\r\n ### Changes\r\n\r\nDisallow creating a partitioned topic contains '-partition-' in the name.\r\n\r\n* only validate partitioned topic name when create/delete/update partitioned topics\r\n\r\n* Changed to use a CONSTANT\r\n", "commitDateTime": "2018-08-10 19:40:44", "authoredDateTime": "2018-08-10 19:40:44", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 9, "deletions": 0, "lines": 9}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 29, "deletions": 13, "lines": 42}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminResourceTest.java", "insertions": 69, "deletions": 0, "lines": 69}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/naming/TopicName.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.validatePartitionedTopicName(java.lang.String,java.lang.String,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createPartitionedTopic(java.lang.String,java.lang.String,java.lang.String,int,boolean)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.updatePartitionedTopic(java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.deletePartitionedTopic(java.lang.String,java.lang.String,java.lang.String,boolean,boolean)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.getPartitionedStats(java.lang.String,java.lang.String,java.lang.String,boolean)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.getPartitionedMetadata(java.lang.String,java.lang.String,java.lang.String,boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminResourceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResourceTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicName.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.naming.TopicName", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "05488a0be6e27292344a093f694d2a5f48886601", "commitGHEventType": "referenced", "commitUser": "sijie", "commitParents": ["f2e6ea73aab47a5c977d44c9deb3f99a07e53a94"], "nameRev": "05488a0be6e27292344a093f694d2a5f48886601 tags/v2.1.1-incubating-candidate-1~34", "commitMessage": "Issue 1067: Problems with Partitioned Topics which name contains -partition-N (#2342)\n\n* Issue 1067: Problems with Partitioned Topics which name contains -partition-N\r\n\r\n ### Motivation\r\n\r\nFixes #1067.\r\n\r\nSomeone accidentally created a partitioned topic in one of our cluster with a name which contains -partition-2.\r\nThis raised all sorts of issues, it would seem that only one partition was created for this topic, but metadata exists saying that it has 10 partitions.\r\n\r\n ### Changes\r\n\r\nDisallow creating a partitioned topic contains '-partition-' in the name.\r\n\r\n* only validate partitioned topic name when create/delete/update partitioned topics\r\n\r\n* Changed to use a CONSTANT\r\n", "commitDateTime": "2018-08-27 02:23:01", "authoredDateTime": "2018-08-10 19:40:44", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/AdminResource.java", "insertions": 9, "deletions": 0, "lines": 9}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java", "insertions": 29, "deletions": 13, "lines": 42}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminResourceTest.java", "insertions": 69, "deletions": 0, "lines": 69}, {"filePath": "pulsar-common/src/main/java/org/apache/pulsar/common/naming/TopicName.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "AdminResource.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResource.validatePartitionedTopicName(java.lang.String,java.lang.String,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "PersistentTopics.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.createPartitionedTopic(java.lang.String,java.lang.String,java.lang.String,int,boolean)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.updatePartitionedTopic(java.lang.String,java.lang.String,java.lang.String,int)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.deletePartitionedTopic(java.lang.String,java.lang.String,java.lang.String,boolean,boolean)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.getPartitionedStats(java.lang.String,java.lang.String,java.lang.String,boolean)", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.apache.pulsar.broker.admin.v2.PersistentTopics.getPartitionedMetadata(java.lang.String,java.lang.String,java.lang.String,boolean)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AdminResourceTest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.admin.AdminResourceTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TopicName.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.common.naming.TopicName", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Create ledger stuck due to zk-connection loss", "body": "#### Actual behavior\r\n\r\nBroker creates a new ml-ledger when current ledger gets full and it doesn't publish any new messages until new ledger creation completes. However, [For some reason]( https://issues.apache.org/jira/browse/ZOOKEEPER-1277) if zookeeper quorum restarts and zk-connection is lost at broker then bk-client fails to create new ledger and it should fail broker's create-ledger callback to notify broker. But Bk-client doesn't complete the broker's callback so, related topic gets stuck and producer is not be able to produce any new messages until we unload the topic.\r\nWe saw following exception when broker lost the zk-connection\r\n```\r\n05:43:35.364 [main-EventThread] ERROR o.a.b.meta.ZkLedgerIdGenerator       - Could not generate new ledger id\r\norg.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss for /ledgers/idgen-long/HOB-0000000001/ID-\r\n        at org.apache.zookeeper.KeeperException.create(KeeperException.java:99) ~[zookeeper-3.4.6.jar:3.4.6-1569965]\r\n        at org.apache.zookeeper.KeeperException.create(KeeperException.java:51) ~[zookeeper-3.4.6.jar:3.4.6-1569965]\r\n        at org.apache.bookkeeper.meta.ZkLedgerIdGenerator$1.processResult(ZkLedgerIdGenerator.java:78) ~[bookkeeper-server-4.3.1.56-yahoo.jar:4.3.1.56-yahoo]\r\n        at org.apache.bookkeeper.util.ZkUtils$1.processResult(ZkUtils.java:79) [bookkeeper-server-4.3.1.56-yahoo.jar:4.3.1.56-yahoo]\r\n        at org.apache.bookkeeper.zookeeper.ZooKeeperClient$9$1.processResult(ZooKeeperClient.java:527) [bookkeeper-server-4.3.1.56-yahoo.jar:4.3.1.56-yahoo]\r\n        at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:605) [zookeeper-3.4.6.jar:3.4.6-1569965]\r\n        at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:498) [zookeeper-3.4.6.jar:3.4.6-1569965]\r\n\r\n```\r\n\r\nTherefore, we can fix bk-client issue and upgrade the bk-version at broker.\r\n\r\nBk-client PR: https://github.com/yahoo/bookkeeper/pull/14", "url": "https://github.com/apache/pulsar/issues/989", "user": "rdhabalia", "labels": ["type/bug"], "created": "2017-12-19 21:53:02", "closed": "2018-01-18 15:13:43", "commits": {}, "ttf": 29.00027777777778, "commitsDetails": []}, {"title": "Message duplication on PartitionedConsumer redelivery", "body": "When redelivery is activated, `ConsumerImpl` removes messages from its queue if they are present, but when using `PartitionedConsumerImpl` messages should not be in the internal `ConsumerImpl` queue but instead in the `PartitionedConsumerImpl` queue. These messages get redelivered but are never removed from the `PartitionedConsumerImpl` queue, this generates a lot of duplicate messages.\r\n\r\nI remember that `PartitionedConsumerImpl` used to have an `UnAckedMessageTracker` why was this removed?\r\nWe need to fix the communication between `PartitionedConsumerImpl`  and `ConsumerImpl` on redelivery, simply adding an `UnAckedMessageTracker` on `PartitionedConsumerImpl` is not gonna cut it, when a message is received by `PartitionedConsumerImpl` it should stop being tracked by `ConsumerImpl` and instead be tracked by `PartitionedConsumerImpl`", "url": "https://github.com/apache/pulsar/issues/946", "user": "sschepens", "labels": ["type/bug"], "created": "2017-12-06 20:11:15", "closed": "2017-12-21 23:00:05", "commits": {}, "ttf": 15.000277777777777, "commitsDetails": []}, {"title": "Intermittent test failure : org.apache.pulsar.broker.service.ReplicatorTest.testCloseReplicatorStartProducer", "body": "[build](https://builds.apache.org/job/pulsar-pull-request/org.apache.pulsar$pulsar-broker/695/testReport/junit/org.apache.pulsar.broker.service/ReplicatorTest/testCloseReplicatorStartProducer/)\r\n\r\n```\r\nError Message\r\n\r\nProducer was not registered on the connection\r\nStacktrace\r\n\r\norg.apache.pulsar.client.api.PulsarClientException: Producer was not registered on the connection\r\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:531)\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:367)\r\n\tat org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:148)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:356)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:342)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:335)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:295)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:269)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:356)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:342)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:335)\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1294)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:356)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:342)\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:911)\r\n\tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:934)\r\n\tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:397)\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:302)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:131)\r\n\tat io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.java:144)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n\r\n```", "url": "https://github.com/apache/pulsar/issues/890", "user": "rdhabalia", "labels": ["component/test", "type/bug"], "created": "2017-11-07 18:25:33", "closed": "2019-03-29 23:56:39", "commits": {}, "ttf": 507.0002777777778, "commitsDetails": []}, {"title": "Intermittent test failure in NamespaceServiceTest.testSplitMapWithRefreshedStatMap", "body": "https://builds.apache.org/job/pulsar-pull-request/org.apache.pulsar$pulsar-broker/618/testReport/junit/org.apache.pulsar.broker.namespace/NamespaceServiceTest/testSplitMapWithRefreshedStatMap/\r\n\r\n```\r\n14846 [main] WARN org.apache.pulsar.broker.namespace.NamespaceService - failed to aquire ownership of split bundle for namespace [pulsar/global/ns1], No value present\r\njava.util.NoSuchElementException: No value present\r\n\tat java.util.Optional.get(Optional.java:135)\r\n\tat org.apache.pulsar.broker.namespace.NamespaceService.updateNamespaceBundles(NamespaceService.java:634)\r\n\tat org.apache.pulsar.broker.namespace.NamespaceService.splitAndOwnBundle(NamespaceService.java:571)\r\n\tat org.apache.pulsar.broker.namespace.NamespaceService$$EnhancerByMockitoWithCGLIB$$4a9a83c4.CGLIB$splitAndOwnBundle$3(<generated>)\r\n\tat org.apache.pulsar.broker.namespace.NamespaceService$$EnhancerByMockitoWithCGLIB$$4a9a83c4$$FastClassByMockitoWithCGLIB$$ba017724.invoke(<generated>)\r\n```", "url": "https://github.com/apache/pulsar/issues/853", "user": "merlimat", "labels": ["component/test", "type/bug"], "created": "2017-10-24 22:05:47", "closed": "2019-01-08 14:27:58", "commits": {}, "ttf": 440.0002777777778, "commitsDetails": []}, {"title": "Intermittent test failure UnAcknowledgedMessagesTimeoutTest.testFailoverSingleAckedPartitionedTopic", "body": "[jenkins](https://builds.apache.org/job/pulsar-pull-request/org.apache.pulsar$pulsar-broker/599/testReport/junit/org.apache.pulsar.client.impl/UnAcknowledgedMessagesTimeoutTest/testFailoverSingleAckedPartitionedTopic/)/[log](https://gist.github.com/hrsakai/e60967259a2d255cbbf97456d1ce372b)\r\n\r\n```\r\nError Message\r\n\r\nexpected [10] but found [12]\r\nStacktrace\r\n\r\njava.lang.AssertionError: expected [10] but found [12]\r\n\tat org.apache.pulsar.client.impl.UnAcknowledgedMessagesTimeoutTest.testFailoverSingleAckedPartitionedTopic(UnAcknowledgedMessagesTimeoutTest.java:336)\r\n```", "url": "https://github.com/apache/pulsar/issues/844", "user": "hrsakai", "labels": ["component/test", "type/bug"], "created": "2017-10-20 07:00:16", "closed": "2018-11-22 03:47:00", "commits": {}, "ttf": 397.0002777777778, "commitsDetails": []}, {"title": "Encryption fixes to address compatibility across crypto libraries", "body": "Addressing few issues which is require in order for other libraries like openssl(c++ client) to be able to process and decrypt messages published by bouncy castle(Java client).\r\n1. Specify the transformation used by RSA encryption\r\n2. The original intention is to use 256 bit key length for AES. The code is using 128 now.\r\n3. Use 16 bytes for AES tag length\r\n", "url": "https://github.com/apache/pulsar/issues/838", "user": "saandrews", "labels": ["component/client", "type/bug"], "created": "2017-10-18 17:05:27", "closed": "2017-10-20 16:48:58", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Intermittent exception during SimpleProducerConsumerTest.testEncryptionFailure", "body": "There is an intermittent test failure in`SimpleProducerConsumerTest.testEncryptionFailure`\r\nhttps://builds.apache.org/job/pulsar-pull-request/org.apache.pulsar$pulsar-broker/575/testReport/junit/org.apache.pulsar.client.api/SimpleProducerConsumerTest/testEncryptionFailure/\r\n\r\nThe exception though it's a NPE in the actual code and not just in the test code.\r\n\r\n```\r\njava.lang.NullPointerException\r\n\tat org.apache.pulsar.client.api.SimpleProducerConsumerTest.testEncryptionFailure(\r\n               SimpleProducerConsumerTest.java:2435)\r\n```\r\n\r\nInternal exception:\r\n\r\n```\r\n178836 [pulsar-client-io-1679-1] WARN org.apache.pulsar.client.impl.ClientCnx - [id: 0x3ce1b0d9, L:/127.0.0.1:43538 - R:localhost/127.0.0.1:15002] Exception caught: null\r\njava.lang.NullPointerException\r\n\tat org.apache.pulsar.client.impl.MessageCrypto.decryptData(MessageCrypto.java:515)\r\n\tat org.apache.pulsar.client.impl.MessageCrypto.getKeyAndDecryptData(MessageCrypto.java:540)\r\n\tat org.apache.pulsar.client.impl.MessageCrypto.decrypt(MessageCrypto.java:570)\r\n\tat org.apache.pulsar.client.impl.ConsumerImpl.decryptPayloadIfNeeded(ConsumerImpl.java:1008)\r\n\tat org.apache.pulsar.client.impl.ConsumerImpl.messageReceived(ConsumerImpl.java:744)\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleMessage(ClientCnx.java:203)\r\n\tat org.apache.pulsar.common.api.PulsarDecoder.channelRead(PulsarDecoder.java:159)\r\n...\r\n```", "url": "https://github.com/apache/pulsar/issues/834", "user": "merlimat", "labels": ["type/bug"], "created": "2017-10-17 18:33:47", "closed": "2017-10-18 06:02:46", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "C++ client is appending partition id to subscription name", "body": "#### Expected behavior\r\n\r\nWhen subscribing to a partitioned topic, a consumer should use the same subscription name on all the partitions. \r\n\r\nThis is important because many tools that operate at the partitioned topic level are assuming it. Eg: clear backlog, get partitioned-stats, etc..\r\n\r\n#### Actual behavior\r\n\r\nJava client is using the correct name, while C++ client (and Python which is built on it as well) is appending the partition id to the subscription name. Eg: `sub0` instead of the user-specified `sub`. \r\n\r\nhttps://github.com/apache/incubator-pulsar/blob/master/pulsar-client-cpp/lib/PartitionedConsumerImpl.cc#L182\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/827", "user": "merlimat", "labels": ["component/c++", "component/client", "type/bug"], "created": "2017-10-13 23:24:42", "closed": "2018-01-04 10:07:09", "commits": {}, "ttf": 82.00027777777778, "commitsDetails": []}, {"title": "split-bundle: lookup failure + error logs of split-bundle", "body": "#### Expected behavior\r\n\r\nWhen broker splits bundle then other broker which receives lookup-request for a topic which falls under that bundle should be redirected properly.\r\n\r\n#### Actual behavior\r\n\r\nRight now, as described at [in the mail](https://lists.apache.org/thread.html/c82e5f7d239468a3f1b02d61e15632abf63f47867b8e1b9611628d0c@%3Cusers.pulsar.apache.org%3E), there are two issues:\r\n\r\n**1. Lookup fails after bundle-split**\r\n```\r\nCaused by: java.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$LookupException: java.lang.IllegalStateException: Namespace bundle test/us-west/ns-bundle/0x50000000_0x60000000 is being unloaded\r\n```\r\nIt happens in following scenario: \r\n1. Broker-2 receives a lookup request for a brand-new namespace (which doesn't have local-policies), so, broker-2 creates local-policies, puts bundle data into `bundlesCache`, and assigns bundle to Broker-1.\r\n2. Now,  Broker-1 splits bundle, disable original bundle and updates local-policies.\r\n3. Broker-2 doesn't know about newly split bundle and original bundle is disable. So, any lookup request for this bundle on broker-2 will receive above error.\r\n\r\n**2. Split-bundle fails**\r\n\r\n```\r\n2017-10-11 18:19:07,975 - INFO  [pulsar-web-56-3:Namespaces@789] - [null] Split namespace bundle test/us-west/ns-bundle/0x50000000_0x58000000\r\n2017-10-11 18:19:07,976 - INFO  [pulsar-web-56-3:PulsarWebResource@222] - Successfully validated clusters on property [test]\r\n2017-10-11 18:19:07,976 - ERROR [pulsar-web-56-3:PulsarWebResource@373] - [null] Failed to validate namespace bundle test/us-west/ns-bundle/0x50000000_0x58000000\r\njava.lang.IllegalArgumentException: Invalid upper boundary for bundle\r\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:93)\r\n\tat org.apache.pulsar.common.naming.NamespaceBundles.validateBundle(NamespaceBundles.java:110)\r\n\tat org.apache.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleRange(PulsarWebResource.java:370)\r\n\tat org.apache.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleOwnership(PulsarWebResource.java:381)\r\n\tat org.apache.pulsar.broker.admin.Namespaces.splitNamespaceBundle(Namespaces.java:801)\r\n```\r\n\r\nThis issue happens due to stale data into LoadBalancer and it tries to split already split bundle. So, it  doesn't have any functional issue and it would be resolved after a minute as soon as load-manager will get latest data. So, to fix it: load-balancer should get latest data after bundle-split. After reproducing, I am seeing below logs\r\n```\r\n// (1) Load-balancer selected bundle to split\r\n20:26:57.438 [pulsar-load-manager-11-1] INFO  o.a.p.b.l.impl.SimpleLoadManagerImpl - Will split hot namespace bundle cms-java-systest/perf/part-bundle2/0x78000000_0x80000000, topics 2, producers+consumers 2, msgRate in+out 3753.588550254447, bandwidth in+out 3967543.0976189505\r\n// (2) Split is successful\r\n20:26:57.525 [pulsar-web-72-11] INFO  o.a.pulsar.broker.admin.Namespaces   -  Split namespace bundle cms-java-systest/perf/part-bundle2/0x78000000_0x80000000\r\n20:26:57.545 [pulsar-load-manager-11-1] INFO  o.a.p.b.l.impl.SimpleLoadManagerImpl - Successfully split namespace bundle cms-java-systest/perf/part-bundle2/0x78000000_0x80000000\r\n\r\n// (3) Again Load-balancer selected same bundle to split with same old data. and it fails while splitiing \r\n20:27:02.396 [pulsar-load-manager-11-1] INFO  o.a.p.b.l.impl.SimpleLoadManagerImpl - Will split hot namespace bundle cms-java-systest/perf/part-bundle2/0x78000000_0x80000000, topics 2, producers+consumers 2, msgRate in+out 3753.588550254447, bandwidth in+out 3967543.0976189505\r\n20:27:02.396 [pulsar-simple-load-manager-70-1] INFO  o.a.p.b.l.impl.SimpleLoadManagerImpl - doLoadRanking - load balancing strategy: weightedRandomSelection\r\n20:27:02.468 [pulsar-web-72-15] INFO  o.a.pulsar.broker.admin.Namespaces   - Split namespace bundle cms-java-systest/perf/part-bundle2/0x78000000_0x80000000\r\n20:27:02.469 [pulsar-web-72-15] INFO  o.a.p.broker.web.PulsarWebResource   - Successfully validated clusters on property [cms-java-systest]\r\n20:27:02.470 [pulsar-web-72-15] ERROR o.a.p.broker.web.PulsarWebResource   - Failed to validate namespace bundle cms-java-systest/perf-gq1/part-bundle2/0x78000000_0x80000000\r\njava.lang.IllegalArgumentException: Invalid upper boundary for bundle\r\n        at com.google.common.base.Preconditions.checkArgument(Preconditions.java:93) ~[guava-15.0.jar:na]\r\n        at org.apache.pulsar.common.naming.NamespaceBundles.validateBundle(NamespaceBundles.java:110) ~[pulsar-broker-1.20.0-incubating-yahoo.jar:1.20.0-incubating-yahoo]\r\n        at org.apache.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleRange(PulsarWebResource.java:369) [pulsar-broker-1.20.0-incubating-yahoo.jar:1.20.0-incubating-yahoo]\r\n        at org.apache.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleOwnership(PulsarWebResource.java:395) [pulsar-broker-1.20.0-incubating-yahoo.jar:1.20.0-incubating-yahoo]\r\n        at org.apache.pulsar.broker.admin.Namespaces.splitNamespaceBundle(Namespaces.java:854) [pulsar-broker-1.20.0-incubating-yahoo.jar:1.20.0-incubating-yahoo]\r\n        at sun.reflect.GeneratedMethodAccessor115.invoke(Unknown Source) ~[na:na]\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:1.8.0_131]\r\n        at java.lang.reflect.Method.invoke(Method.java:498) ~[na:1.8.0_131]\r\n\r\n\r\n```\r\n\r\nI will create 2 PR with the fix.", "url": "https://github.com/apache/pulsar/issues/821", "user": "rdhabalia", "labels": ["type/bug"], "created": "2017-10-13 00:12:11", "closed": "2017-10-18 00:34:52", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "Intermittent test failure ReplicatorTest.testResumptionAfterBacklogRelaxed", "body": "[Jenkins job](https://builds.apache.org/job/pulsar-pull-request/org.apache.pulsar$pulsar-broker/450/testReport/junit/org.apache.pulsar.broker.service/ReplicatorTest/testResumptionAfterBacklogRelaxed/)\r\n\r\n**Output:**\r\n\r\n```\r\nError Message\r\n\r\nexpected [0] but found [1]\r\nStacktrace\r\n\r\njava.lang.AssertionError: expected [0] but found [1]\r\n\tat org.apache.pulsar.broker.service.ReplicatorTest.testResumptionAfterBacklogRelaxed(ReplicatorTest.java:742)\r\n\r\n```", "url": "https://github.com/apache/pulsar/issues/788", "user": "rdhabalia", "labels": ["component/test", "type/bug"], "created": "2017-09-25 01:17:41", "closed": "2019-03-29 23:56:49", "commits": {}, "ttf": 550.0002777777778, "commitsDetails": []}, {"title": "Negative unacked messages", "body": "We're experiencing a behavior were consumers have negative unackedMesasges count, huge backlogs, have availablePermits, are not blocked and yet are not receiving messages.\r\nConsumer machines report that the have almost no messages in queue.\r\nWe're running 1.19-incubating.\r\n\r\nThis example is of topic `persistent://fury/global/948c07dd9c6a4c5faa106651d0d2cafd-account-movements/948c07dd9c6a4c5faa106651d0d2cafd-account-movements-partition-0`\r\n```json\r\n    \"925c59c3045f4a39af9b34472623f73c-melipayments-receipts-movements\" : {\r\n      \"msgRateOut\" : 0.0,\r\n      \"msgThroughputOut\" : 0.0,\r\n      \"msgRateRedeliver\" : 0.0,\r\n      \"msgBacklog\" : 1219175,\r\n      \"blockedSubscriptionOnUnackedMsgs\" : true,\r\n      \"unackedMessages\" : 152277,\r\n      \"type\" : \"Shared\",\r\n      \"msgRateExpired\" : 0.0,\r\n      \"consumers\" : [ {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"i-09c2ad7fd2a49d057-10.73.103.15\",\r\n        \"availablePermits\" : 91,\r\n        \"unackedMessages\" : -49860,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"address\" : \"/10.73.103.15:47300\",\r\n        \"connectedSince\" : \"2017-08-30 20:44:19.126+0000\",\r\n        \"clientVersion\" : \"1.19.0-incubating\"\r\n      }, {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"i-0694bdfc5817f7af3-10.73.105.189\",\r\n        \"availablePermits\" : 87,\r\n        \"unackedMessages\" : 118754,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"address\" : \"/10.73.105.189:58453\",\r\n        \"connectedSince\" : \"2017-08-30 20:44:20.118+0000\",\r\n        \"clientVersion\" : \"1.19.0-incubating\"\r\n      }, {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"i-04ea2b6ee82a2ade9-10.73.104.203\",\r\n        \"availablePermits\" : 98,\r\n        \"unackedMessages\" : 58328,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"address\" : \"/10.73.104.203:53460\",\r\n        \"connectedSince\" : \"2017-08-30 20:44:28.898+0000\",\r\n        \"clientVersion\" : \"1.19.0-incubating\"\r\n      }, {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"i-09262b38b611871c9-10.73.103.239\",\r\n        \"availablePermits\" : 75,\r\n        \"unackedMessages\" : -44463,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"address\" : \"/10.73.103.239:45222\",\r\n        \"connectedSince\" : \"2017-08-30 20:44:50.145+0000\",\r\n        \"clientVersion\" : \"1.19.0-incubating\"\r\n      }, {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"i-02cffb4d69393aa51-10.73.104.10\",\r\n        \"availablePermits\" : 85,\r\n        \"unackedMessages\" : 73966,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"address\" : \"/10.73.104.10:58965\",\r\n        \"connectedSince\" : \"2017-08-30 20:44:54.732+0000\",\r\n        \"clientVersion\" : \"1.19.0-incubating\"\r\n      }, {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"i-0f4e04a029a239613-10.73.105.79\",\r\n        \"availablePermits\" : 65,\r\n        \"unackedMessages\" : 2183,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"address\" : \"/10.73.105.79:33272\",\r\n        \"connectedSince\" : \"2017-09-12 17:26:25.868+0000\",\r\n        \"clientVersion\" : \"1.19.0-incubating\"\r\n      }, {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"i-046c50f69cb36846d-10.73.103.139\",\r\n        \"availablePermits\" : 56,\r\n        \"unackedMessages\" : -443,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"address\" : \"/10.73.103.139:43031\",\r\n        \"connectedSince\" : \"2017-09-12 17:26:29.296+0000\",\r\n        \"clientVersion\" : \"1.19.0-incubating\"\r\n      }, {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"i-091165aafb986c96c-10.73.106.158\",\r\n        \"availablePermits\" : 90,\r\n        \"unackedMessages\" : -3035,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"address\" : \"/10.73.106.158:37738\",\r\n        \"connectedSince\" : \"2017-09-12 17:26:39.390+0000\",\r\n        \"clientVersion\" : \"1.19.0-incubating\"\r\n      }, {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"i-074e75743c602e69f-10.73.104.223\",\r\n        \"availablePermits\" : 75,\r\n        \"unackedMessages\" : 1837,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"address\" : \"/10.73.104.223:60664\",\r\n        \"connectedSince\" : \"2017-09-12 17:26:39.435+0000\",\r\n        \"clientVersion\" : \"1.19.0-incubating\"\r\n      }, {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"i-01137dae0559e78e8-10.73.106.241\",\r\n        \"availablePermits\" : 77,\r\n        \"unackedMessages\" : -2551,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"address\" : \"/10.73.106.241:40963\",\r\n        \"connectedSince\" : \"2017-09-12 17:27:02.569+0000\",\r\n        \"clientVersion\" : \"1.19.0-incubating\"\r\n      }, {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"i-07f6a2096808b30c3-10.73.106.41\",\r\n        \"availablePermits\" : 99,\r\n        \"unackedMessages\" : -2439,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"address\" : \"/10.73.106.41:48132\",\r\n        \"connectedSince\" : \"2017-09-12 17:27:16.081+0000\",\r\n        \"clientVersion\" : \"1.19.0-incubating\"\r\n      }, {\r\n        \"msgRateOut\" : 0.0,\r\n        \"msgThroughputOut\" : 0.0,\r\n        \"msgRateRedeliver\" : 0.0,\r\n        \"consumerName\" : \"i-0cc9c33a29333699e-10.73.106.181\",\r\n        \"availablePermits\" : 100,\r\n        \"unackedMessages\" : 0,\r\n        \"blockedConsumerOnUnackedMsgs\" : false,\r\n        \"address\" : \"/10.73.106.181:60881\",\r\n        \"connectedSince\" : \"2017-09-13 20:10:37.227+0000\",\r\n        \"clientVersion\" : \"1.19.0-incubating\"\r\n      } ]\r\n    }\r\n```\r\n\r\nInternal Stats for the partition shows:\r\n```json\r\n    \"925c59c3045f4a39af9b34472623f73c-melipayments-receipts-movements\" : {\r\n      \"markDeletePosition\" : \"7774731:289032\",\r\n      \"readPosition\" : \"7774731:289033\",\r\n      \"waitingReadOp\" : false,\r\n      \"pendingReadOps\" : 0,\r\n      \"messagesConsumedCounter\" : 26329750,\r\n      \"cursorLedger\" : 7773772,\r\n      \"cursorLedgerLastEntry\" : 14392,\r\n      \"individuallyDeletedMessages\" : \"[]\",\r\n      \"lastLedgerSwitchTimestamp\" : \"2017-09-12 15:55:13.214+0000\",\r\n      \"state\" : \"Open\"\r\n    }\r\n```\r\n\r\nInfo Internal for the subscription shows:\r\n```json\r\n{\r\n  \"markDelete\": {\r\n    \"entryId\": 352016,\r\n    \"ledgerId\": 7765017\r\n  },\r\n  \"individualDeletedMessages\": [\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352027,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352017,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352038,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352028,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352049,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352039,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352060,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352050,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352068,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352061,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352071,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352069,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352079,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352072,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352082,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352080,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352090,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352083,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352093,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352091,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352101,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352094,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352104,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352102,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352112,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352105,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352115,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352113,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352123,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352116,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352126,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352124,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352134,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352127,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352138,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352135,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352146,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352139,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352149,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352147,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352157,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352150,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352160,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352158,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352168,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352161,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352171,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352169,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352175,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352172,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352179,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352176,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352182,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352180,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352186,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352183,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352190,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352187,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352193,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352191,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352197,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352194,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352202,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352198,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352205,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352203,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352209,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352206,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352213,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352210,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352216,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352214,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352220,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352217,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352224,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352221,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352227,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352225,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352231,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352228,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352235,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352232,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352238,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352236,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352242,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352239,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352246,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352243,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352249,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352247,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352253,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352250,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352257,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352254,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352260,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352258,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352264,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352261,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352268,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352265,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352272,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352269,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352276,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352273,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352280,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352277,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352283,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352281,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352288,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352284,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352292,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352289,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352295,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352293,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352299,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352296,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352303,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352300,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352306,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352304,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352311,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352307,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352315,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352312,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352319,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352316,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352323,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352320,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352327,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352324,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352330,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352328,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352334,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352331,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352338,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352335,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352341,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352339,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352345,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352342,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352349,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352346,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352355,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352350,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352359,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352356,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352365,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352360,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352369,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352366,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352372,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352370,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352376,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352373,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352380,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352377,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352383,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352381,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352387,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352384,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352391,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352388,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352394,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352392,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352398,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352395,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352402,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352399,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352405,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352403,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352409,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352406,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352413,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352410,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352416,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352414,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352420,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352417,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352424,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352421,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352427,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352425,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352431,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352428,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352435,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352432,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352438,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352436,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352442,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352439,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352446,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352443,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352449,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352447,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352453,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352450,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352457,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352454,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352460,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352458,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352464,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352461,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352468,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352465,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352471,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352469,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352475,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352472,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352479,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352476,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352482,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352480,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352486,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352483,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352490,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352487,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352494,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352492,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352498,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352495,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352502,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352499,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352505,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352503,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352509,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352506,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352513,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352510,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352516,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352514,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352520,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352517,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352524,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352521,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352528,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352525,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352532,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352529,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352536,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352533,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352539,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352537,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352543,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352540,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352547,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352544,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352550,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352548,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352554,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352551,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352558,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352555,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352561,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352559,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352566,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352563,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352570,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352567,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352573,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352571,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352577,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352574,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352581,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352578,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352584,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352582,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    },\r\n    {\r\n      \"to\": {\r\n        \"entryId\": 352592,\r\n        \"ledgerId\": 7765017\r\n      },\r\n      \"from\": {\r\n        \"entryId\": 352590,\r\n        \"ledgerId\": 7765017\r\n      }\r\n    }\r\n  ],\r\n  \"cursorsLedgerId\": 7773772,\r\n  \"version\": 809,\r\n  \"modificationDate\": \"2017-09-12 15:55:13.224+0000\",\r\n  \"creationDate\": \"2017-03-20 20:12:03.197+0000\"\r\n}\r\n``` \r\n\r\nOther subscriptions on the same topic seems OK.\r\nI'm uploading a heap dump of the broker holding the topic atm.", "url": "https://github.com/apache/pulsar/issues/759", "user": "sschepens", "labels": ["type/bug"], "created": "2017-09-13 20:56:47", "closed": "2017-10-02 21:07:20", "commits": {"fea1b3357df19e6f396bf865f6f9befe7d559f4e": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 19.00027777777778, "commitsDetails": [{"commitHash": "fea1b3357df19e6f396bf865f6f9befe7d559f4e", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["bace0b47ada0d107f33d26ac282e1d6fb0a43156"], "nameRev": "fea1b3357df19e6f396bf865f6f9befe7d559f4e tags/v1.20.0-incubating-candidate-0~10", "commitMessage": "Correctly process the ack for a message that was outstanding on a different consumer (#791)\n\nFixes #759", "commitDateTime": "2017-09-26 01:14:01", "authoredDateTime": "2017-09-26 01:14:01", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java", "insertions": 12, "deletions": 9, "lines": 21}, {"filePath": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherMultipleConsumers.java", "insertions": 13, "deletions": 14, "lines": 27}, {"filePath": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentQueueE2ETest.java", "insertions": 61, "deletions": 0, "lines": 61}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Consumer.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.Consumer.flowPermits(int)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.Consumer.getStats()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.Consumer.getUnackedMessages()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.Consumer.addAndGetUnAckedMsgs(org.apache.pulsar.broker.service.Consumer,int)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.Consumer.removePendingAcks(org.apache.bookkeeper.mledger.impl.PositionImpl)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "PersistentDispatcherMultipleConsumers.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers.readMoreEntries()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers.addUnAckedMessages(int)", "TOT": 6, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 3}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers.isBlockedDispatcherOnUnackedMsgs()", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers.blockDispatcherOnUnackedMsgs()", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers.unBlockDispatcherOnUnackedMsgs()", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers.getTotalUnackedMessages()", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "PersistentQueueE2ETest.java", "spoonMethods": [{"spoonMethodName": "org.apache.pulsar.broker.service.PersistentQueueE2ETest.testUnackedCountWithRedeliveries()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Server error when unloading namespace", "body": "#### Expected behavior\r\n\r\nUnloading a non-loaded namespace or a namespaces that have some non-loaded bundles should not fail.\r\n\r\n#### Actual behavior\r\n\r\nClient is getting 500 errors when unloading a namespace that contain non loaded bundles.\r\n\r\n```\r\njava.util.concurrent.ExecutionException: java.lang.IllegalStateException: Can't find owner of ServiceUnit: sample/standalone/my-ns/0x00000000_0x10000000\r\n\tat java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)\r\n\tat org.apache.pulsar.broker.namespace.NamespaceService.getWebServiceUrl(NamespaceService.java:170)\r\n\tat org.apache.pulsar.broker.web.PulsarWebResource.validateBundleOwnership(PulsarWebResource.java:407)\r\n\tat org.apache.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleOwnership(PulsarWebResource.java:382)\r\n\tat org.apache.pulsar.broker.admin.Namespaces.unloadNamespaceBundle(Namespaces.java:770)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n```\r\n\r\n#### Steps to reproduce\r\n\r\nCreate a namespace with multiple bundles. Trigger unloading of that namespace. \r\n\r\n", "url": "https://github.com/apache/pulsar/issues/707", "user": "merlimat", "labels": ["type/bug"], "created": "2017-08-21 19:01:17", "closed": "2017-08-22 19:18:45", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Assertion failure in RocksDB when opening the index db", "body": "In some cases, the bookie from the standalone pulsar service is crashing on startup. \r\n\r\n```\r\n2017-08-10 13:03:51,646 - INFO  - [main:Bookie@506] - using ledger storage: org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage\r\n2017-08-10 13:03:51,711 - INFO  - [main:DbLedgerStorage@132] - Started Db Ledger Storage\r\n2017-08-10 13:03:51,711 - INFO  - [main:DbLedgerStorage@133] -  - Write cache size: 256 MB\r\n2017-08-10 13:03:51,712 - INFO  - [main:DbLedgerStorage@134] -  - Read Cache: 64 MB\r\n2017-08-10 13:03:51,712 - INFO  - [main:DbLedgerStorage@135] -  - Read Ahead Batch size: : 100\r\nAssertion failed: (filter->size() > 0), function GetFilter, file table/block_based_table_reader.cc, line 1133.\r\nAbort trap: 6\r\n```\r\n\r\nOnce it gets into that state is not recovering.\r\n\r\n\r\nStack traces:\r\n\r\n```\r\n thread #6, stop reason = signal SIGSTOP\r\n    frame #0: 0x00007fffd445cd42 libsystem_kernel.dylib`__pthread_kill + 10\r\n    frame #1: 0x00007fffd454a457 libsystem_pthread.dylib`pthread_kill + 90\r\n    frame #2: 0x00007fffd43c2420 libsystem_c.dylib`abort + 129\r\n    frame #3: 0x00007fffd4389893 libsystem_c.dylib`__assert_rtn + 320\r\n    frame #4: 0x000000013da81279 librocksdbjni1259198247081385980.jnilib`rocksdb::BlockBasedTable::GetFilter(rocksdb::BlockHandle const&, bool, bool) const + 1017\r\n    frame #5: 0x000000013da7e202 librocksdbjni1259198247081385980.jnilib`rocksdb::BlockBasedTable::Open(rocksdb::ImmutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::BlockBasedTableOptions const&, rocksdb::InternalKeyComparator const&, std::__1::unique_ptr<rocksdb::RandomAccessFileReader, std::__1::default_delete<rocksdb::RandomAccessFileReader> >&&, unsigned long long, std::__1::unique_ptr<rocksdb::TableReader, std::__1::default_delete<rocksdb::TableReader> >*, bool, bool, int) + 4338\r\n    frame #6: 0x000000013da7958a librocksdbjni1259198247081385980.jnilib`rocksdb::BlockBasedTableFactory::NewTableReader(rocksdb::TableReaderOptions const&, std::__1::unique_ptr<rocksdb::RandomAccessFileReader, std::__1::default_delete<rocksdb::RandomAccessFileReader> >&&, unsigned long long, std::__1::unique_ptr<rocksdb::TableReader, std::__1::default_delete<rocksdb::TableReader> >*, bool) const + 90\r\n    frame #7: 0x000000013d996912 librocksdbjni1259198247081385980.jnilib`rocksdb::TableCache::GetTableReader(rocksdb::EnvOptions const&, rocksdb::InternalKeyComparator const&, rocksdb::FileDescriptor const&, bool, unsigned long, bool, rocksdb::HistogramImpl*, std::__1::unique_ptr<rocksdb::TableReader, std::__1::default_delete<rocksdb::TableReader> >*, bool, int, bool) + 546\r\n    frame #8: 0x000000013d996dfa librocksdbjni1259198247081385980.jnilib`rocksdb::TableCache::FindTable(rocksdb::EnvOptions const&, rocksdb::InternalKeyComparator const&, rocksdb::FileDescriptor const&, rocksdb::Cache::Handle**, bool, bool, rocksdb::HistogramImpl*, bool, int, bool) + 602\r\n    frame #9: 0x000000013d99716a librocksdbjni1259198247081385980.jnilib`rocksdb::TableCache::NewIterator(rocksdb::ReadOptions const&, rocksdb::EnvOptions const&, rocksdb::InternalKeyComparator const&, rocksdb::FileDescriptor const&, rocksdb::RangeDelAggregator*, rocksdb::TableReader**, rocksdb::HistogramImpl*, bool, rocksdb::Arena*, bool, int) + 394\r\n    frame #10: 0x000000013d85b35d librocksdbjni1259198247081385980.jnilib`rocksdb::BuildTable(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, rocksdb::Env*, rocksdb::ImmutableCFOptions const&, rocksdb::MutableCFOptions const&, rocksdb::EnvOptions const&, rocksdb::TableCache*, rocksdb::InternalIterator*, std::__1::unique_ptr<rocksdb::InternalIterator, std::__1::default_delete<rocksdb::InternalIterator> >, rocksdb::FileMetaData*, rocksdb::InternalKeyComparator const&, std::__1::vector<std::__1::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::__1::default_delete<rocksdb::IntTblPropCollectorFactory> >, std::__1::allocator<std::__1::unique_ptr<rocksdb::IntTblPropCollectorFactory, std::__1::default_delete<rocksdb::IntTblPropCollectorFactory> > > > const*, unsigned int, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<unsigned long long, std::__1::allocator<unsigned long long> >, unsigned long long, rocksdb::CompressionType, rocksdb::CompressionOptions const&, bool, rocksdb::InternalStats*, rocksdb::TableFileCreationReason, rocksdb::EventLogger*, int, rocksdb::Env::IOPriority, rocksdb::TableProperties*, int) + 3981\r\n    frame #11: 0x000000013d912099 librocksdbjni1259198247081385980.jnilib`rocksdb::DBImpl::WriteLevel0TableForRecovery(int, rocksdb::ColumnFamilyData*, rocksdb::MemTable*, rocksdb::VersionEdit*) + 1337\r\n    frame #12: 0x000000013d910563 librocksdbjni1259198247081385980.jnilib`rocksdb::DBImpl::RecoverLogFiles(std::__1::vector<unsigned long long, std::__1::allocator<unsigned long long> > const&, unsigned long long*, bool) + 2355\r\n    frame #13: 0x000000013d90f3ca librocksdbjni1259198247081385980.jnilib`rocksdb::DBImpl::Recover(std::__1::vector<rocksdb::ColumnFamilyDescriptor, std::__1::allocator<rocksdb::ColumnFamilyDescriptor> > const&, bool, bool, bool) + 1370\r\n    frame #14: 0x000000013d91371e librocksdbjni1259198247081385980.jnilib`rocksdb::DB::Open(rocksdb::DBOptions const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<rocksdb::ColumnFamilyDescriptor, std::__1::allocator<rocksdb::ColumnFamilyDescriptor> > const&, std::__1::vector<rocksdb::ColumnFamilyHandle*, std::__1::allocator<rocksdb::ColumnFamilyHandle*> >*, rocksdb::DB**) + 2238\r\n    frame #15: 0x000000013d912c27 librocksdbjni1259198247081385980.jnilib`rocksdb::DB::Open(rocksdb::Options const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, rocksdb::DB**) + 1351\r\n    frame #16: 0x000000013d83610c librocksdbjni1259198247081385980.jnilib`___lldb_unnamed_symbol106$$librocksdbjni1259198247081385980.jnilib + 28\r\n    frame #17: 0x000000013d8302a3 librocksdbjni1259198247081385980.jnilib`rocksdb_open_helper(JNIEnv_*, long, _jstring*, std::__1::function<rocksdb::Status (rocksdb::Options const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, rocksdb::DB**)>) + 147\r\n    frame #18: 0x000000013d8303a9 librocksdbjni1259198247081385980.jnilib`Java_org_rocksdb_RocksDB_open__JLjava_lang_String_2 + 73\r\n```", "url": "https://github.com/apache/pulsar/issues/674", "user": "merlimat", "labels": ["type/bug"], "created": "2017-08-10 20:05:26", "closed": "2018-06-01 14:54:53", "commits": {}, "ttf": 294.0002777777778, "commitsDetails": []}, {"title": "Intermittent C++ test failure in LatchTest.testTimedWait", "body": "As seen on https://builds.apache.org/job/pulsar-pull-request/45/console \r\n```\r\n[35/75] LatchTest.testTimedWait (108 ms)\r\nlog4cxx: Could not read configuration file [log4cxx.conf].\r\n\u001b[0;33mNote: Google Test filter = LatchTest.testTimedWait\r\n\u001b[m\u001b[0;32m[==========] \u001b[mRunning 1 test from 1 test case.\r\n\u001b[0;32m[----------] \u001b[mGlobal test environment set-up.\r\n\u001b[0;32m[----------] \u001b[m1 test from LatchTest\r\n\u001b[0;32m[ RUN      ] \u001b[mLatchTest.testTimedWait\r\nlog4cxx: No appender could be found for logger (pulsar./pulsar/pulsar-client-cpp/tests/LatchTest.cc).\r\nlog4cxx: Please initialize the log4cxx system properly.\r\n/pulsar/pulsar-client-cpp/tests/LatchTest.cc:80: Failure\r\nValue of: latch1.wait(millisec(70))\r\n  Actual: false\r\nExpected: true\r\n\u001b[0;31m[  FAILED  ] \u001b[mLatchTest.testTimedWait (74 ms)\r\n\u001b[0;32m[----------] \u001b[m1 test from LatchTest (74 ms total)\r\n\r\n\u001b[0;32m[----------] \u001b[mGlobal test environment tear-down\r\n\u001b[0;32m[==========] \u001b[m1 test from 1 test case ran. (74 ms total)\r\n\u001b[0;32m[  PASSED  ] \u001b[m0 tests.\r\n\u001b[0;31m[  FAILED  ] \u001b[m1 test, listed below:\r\n\u001b[0;31m[  FAILED  ] \u001b[mLatchTest.testTimedWait\r\n```\r\n\r\ncc @jai1 ", "url": "https://github.com/apache/pulsar/issues/630", "user": "merlimat", "labels": ["component/c++", "component/test", "flaky-tests", "triage/week-3", "type/bug"], "created": "2017-08-02 23:43:05", "closed": "2020-02-12 16:59:44", "commits": {}, "ttf": 923.0002777777778, "commitsDetails": []}, {"title": "Intermittent test failure in SimpleProducerConsumerTest.testBlockUnackConsumerAckByDifferentConsumer", "body": "As seen in https://builds.apache.org/job/pulsar-pull-request/org.apache.pulsar$pulsar-broker/21/testReport/junit/org.apache.pulsar.client.api/SimpleProducerConsumerTest/testBlockUnackConsumerAckByDifferentConsumer/\r\n\r\n```\r\njava.lang.AssertionError: expected [110] but found [100]\r\n\tat org.apache.pulsar.client.api.SimpleProducerConsumerTest.testBlockUnackConsumerAckByDifferentConsumer(SimpleProducerConsumerTest.java:1643)\r\n```", "url": "https://github.com/apache/pulsar/issues/624", "user": "merlimat", "labels": ["component/test", "help wanted", "triage/week-1", "type/bug"], "created": "2017-08-02 17:22:24", "closed": "2020-01-03 05:21:56", "commits": {}, "ttf": 883.0002777777778, "commitsDetails": []}, {"title": "Intermittent test failure in SLAMonitoringTest.testUnloadIfBrokerCrashes", "body": "As seen in https://builds.apache.org/job/pulsar-pull-request/org.apache.pulsar$pulsar-broker/24/testReport/junit/org.apache.pulsar.broker/SLAMonitoringTest/testUnloadIfBrokerCrashes/\r\n\r\n```\r\njava.lang.AssertionError: The SLA Monitor namespace should be owned by some other broker\r\n\tat org.apache.pulsar.broker.SLAMonitoringTest.testUnloadIfBrokerCrashes(SLAMonitoringTest.java:215)\r\n```", "url": "https://github.com/apache/pulsar/issues/623", "user": "merlimat", "labels": ["component/test", "help wanted", "triage/week-1", "type/bug"], "created": "2017-08-02 17:21:15", "closed": "2020-01-03 05:20:40", "commits": {}, "ttf": 883.0002777777778, "commitsDetails": []}, {"title": "Intermittent test failures in SimpleProducerConsumerTest.testSendCallBack", "body": "As seen in https://builds.apache.org/job/pulsar-pull-request/org.apache.pulsar$pulsar-broker/30/testReport/junit/org.apache.pulsar.client.api/SimpleProducerConsumerTest/testSendCallBack/\r\n\r\n```\r\njava.util.concurrent.ExecutionException: io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n\tat org.apache.pulsar.client.api.SimpleProducerConsumerTest.testSendCallBack(SimpleProducerConsumerTest.java:958)\r\nCaused by: io.netty.util.IllegalReferenceCountException: refCnt: 0\r\n\tat org.apache.pulsar.client.api.SimpleProducerConsumerTest.lambda$testSendCallBack$2(SimpleProducerConsumerTest.java:954)\r\n\tat org.apache.pulsar.client.api.SimpleProducerConsumerTest.testSendCallBack(SimpleProducerConsumerTest.java:950)\r\n```", "url": "https://github.com/apache/pulsar/issues/622", "user": "merlimat", "labels": ["component/test", "help wanted", "type/bug"], "created": "2017-08-02 17:18:55", "closed": "2020-01-03 05:08:20", "commits": {}, "ttf": 883.0002777777778, "commitsDetails": []}, {"title": "Itermittent test failure in ReplicatorTest.testResumptionAfterBacklogRelaxed", "body": "Test logs at:\r\nhttps://builds.apache.org/job/pulsar-pull-request/org.apache.pulsar$pulsar-broker/15/testReport/junit/org.apache.pulsar.broker.service/ReplicatorTest/testResumptionAfterBacklogRelaxed/\r\n\r\n```\r\n868617 [pulsar-io-23669-14] ERROR org.apache.pulsar.broker.service.persistent.PersistentReplicator - [persistent://pulsar/global/ns1/producer_exception][r1 -> r2] Error producing on remote broker\r\norg.apache.pulsar.client.api.PulsarClientException$ProducerBlockedQuotaExceededException: Could not send pending messages as backlog exceeded\r\n\tat org.apache.pulsar.client.impl.ProducerImpl.lambda$connectionOpened$6(ProducerImpl.java:781)\r\n\tat java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:870)\r\n\tat java.util.concurrent.CompletableFuture$UniExceptionally.tryFire(CompletableFuture.java:852)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474)\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977)\r\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:356)\r\n```", "url": "https://github.com/apache/pulsar/issues/614", "user": "merlimat", "labels": ["component/test", "help wanted", "type/bug"], "created": "2017-08-01 19:36:37", "closed": "2018-11-21 21:49:41", "commits": {}, "ttf": 477.0002777777778, "commitsDetails": []}, {"title": "Stack overflow during C++ tests", "body": "Reproduced locally when compiling on Ubuntu 16.04.\r\n\r\nOne test is constantly failing and valgrind catches the problem as well: \r\n\r\n```\r\n==670== Memcheck, a memory error detector\r\n==670== Copyright (C) 2002-2015, and GNU GPL'd, by Julian Seward et al.\r\n==670== Using Valgrind-3.11.0 and LibVEX; rerun with -h for copyright info\r\n==670== Command: ./main --gtest_filter=BasicEndToEndTest.testPartitionedProducerConsumer\r\n==670==\r\nlog4cxx: Could not read configuration file [log4cxx.conf].\r\nNote: Google Test filter = BasicEndToEndTest.testPartitionedProducerConsumer\r\n[==========] Running 1 test from 1 test case.\r\n[----------] Global test environment set-up.\r\n[----------] 1 test from BasicEndToEndTest\r\n[ RUN      ] BasicEndToEndTest.testPartitionedProducerConsumer\r\nlog4cxx: No appender could be found for logger (pulsar./pulsar/pulsar-client-cpp/lib/ClientImpl.cc).\r\nlog4cxx: Please initialize the log4cxx system properly.\r\n*   Trying 127.0.0.1...\r\n* Connected to localhost (127.0.0.1) port 8765 (#0)\r\n> PUT /admin/persistent/prop/unit/ns/partition-test/partitions HTTP/1.1\r\nHost: localhost:8765\r\nAccept: */*\r\nContent-Type: application/json\r\nContent-Length: 1\r\n\r\n* upload completely sent off: 1 out of 1 bytes\r\n< HTTP/1.1 204 No Content\r\n< Date: Wed, 26 Jul 2017 21:23:46 GMT\r\n< broker-address: localhost\r\n< Server: Jetty(9.3.11.v20160721)\r\n<\r\n* Connection #0 to host localhost left intact\r\n*** stack smashing detected ***: ./main terminated\r\n==670==\r\n==670== Process terminating with default action of signal 6 (SIGABRT)\r\n==670==    at 0x6BA0428: raise (raise.c:54)\r\n==670==    by 0x6BA2029: abort (abort.c:89)\r\n==670==    by 0x6BE27E9: __libc_message (libc_fatal.c:175)\r\n==670==    by 0x6C8411B: __fortify_fail (fortify_fail.c:37)\r\n==670==    by 0x6C840BF: __stack_chk_fail (stack_chk_fail.c:28)\r\n==670==    by 0x4E8E7B: makePutRequest(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) (HttpHelper.cc:47)\r\n==670==    by 0x49F3EF: BasicEndToEndTest_testPartitionedProducerConsumer_Test::TestBody() (BasicEndToEndTest.cc:399)\r\n==670==    by 0x52158B: void testing::internal::HandleSehExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) (in /pulsar/pulsar-client-cpp/tests/main)\r\n==670==    by 0x51C1BC: void testing::internal::HandleExceptionsInMethodIfSupported<testing::Test, void>(testing::Test*, void (testing::Test::*)(), char const*) (in /pulsar/pulsar-client-cpp/tests/main)\r\n==670==    by 0x50148B: testing::Test::Run() (in /pulsar/pulsar-client-cpp/tests/main)\r\n==670==    by 0x501D33: testing::TestInfo::Run() (in /pulsar/pulsar-client-cpp/tests/main)\r\n==670==    by 0x502422: testing::TestCase::Run() (in /pulsar/pulsar-client-cpp/tests/main)\r\n==670==\r\n==670== HEAP SUMMARY:\r\n==670==     in use at exit: 332,376 bytes in 4,737 blocks\r\n==670==   total heap usage: 8,361 allocs, 3,624 frees, 600,439 bytes allocated\r\n==670==\r\n==670== LEAK SUMMARY:\r\n==670==    definitely lost: 0 bytes in 0 blocks\r\n==670==    indirectly lost: 0 bytes in 0 blocks\r\n==670==      possibly lost: 0 bytes in 0 blocks\r\n==670==    still reachable: 332,376 bytes in 4,737 blocks\r\n==670==         suppressed: 0 bytes in 0 blocks\r\n==670== Rerun with --leak-check=full to see details of leaked memory\r\n==670==\r\n==670== For counts of detected and suppressed errors, rerun with: -v\r\n==670== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)\r\n./run-unit-tests.sh: line 51:   670 Aborted                 valgrind ./main --gtest_filter=BasicEndToEndTest.testPartitionedProducerConsumer\r\n```", "url": "https://github.com/apache/pulsar/issues/601", "user": "merlimat", "labels": ["component/c++", "component/test", "type/bug"], "created": "2017-07-26 21:30:09", "closed": "2017-07-27 03:18:46", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Problems in lookup flow in C++ Client", "body": "# Issues:-\r\n\r\n1. **Client Stops Doing Lookups**\r\nIn case of non graceful shutdown, if the ClientConnection object is not destroyed within first backoff time (0.1 seconds) then the consumer/producer will no longer attempt to reconnect to the broker - which may lead to Timeouts and queue full in case of producer and backlog in case of consumer.\r\n\r\n2. **Locking inconsistencies in Lookup Logic**\r\nIn the following methods, we check/change the clientConnection_ weakPtr outside a lock\r\n- ProducerImpl.disconnectProducer()\r\n- ConsumerImpl.disconnectConsumer()\r\n- HandlerBase.grabCnx()\r\n- ConsumerImpl.handleCreateConsumer() \r\n\r\n3. **Duplicate lookups happen on the client side**\r\n(A) During a graceful shutdown, the broker sends CLOSE_PRODUCER / CLOSE_CONSUMER command to the client, which triggers the reconnection logic. \r\n(B) After the connection is closed the ClientConnection.close() also triggers the reconnection logic for all registered consumers/producers. \r\n\r\nIf (A) doesn't complete before (B) then lookups and CREATE_PRODUCER / CREATE_CONSUMER commands are sent twice - this is not a functional issue because the broker returns success for the duplicate command but this leads a twice the required number of lookups.\r\n\r\n4. **Duplicate CLOSE_PRODUCER and CLOSE_CONSUMER triggered by the broker**\r\nNot sure why this is happening or it's side effects.\r\n\r\n**Note:** Will attach the relevant log files with the Pull Request for the fixes.\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/551", "user": "jai1", "labels": ["component/c++", "type/bug"], "created": "2017-07-07 00:44:33", "closed": "2017-12-22 00:19:49", "commits": {"f5768b057aab33f58988753d3eb643d86437db85": {"commitGHEventType": "referenced", "commitUser": "saandrews"}, "87b8944fa16ec6a898d26cb3e9bd32fee82086e8": {"commitGHEventType": "referenced", "commitUser": "jai1"}}, "ttf": 167.00027777777777, "commitsDetails": [{"commitHash": "f5768b057aab33f58988753d3eb643d86437db85", "commitGHEventType": "referenced", "commitUser": "saandrews", "commitParents": ["dcd9b137470abef0766aac2bfaab0b210a26c709"], "nameRev": "f5768b057aab33f58988753d3eb643d86437db85 tags/v1.19.0-incubating~51", "commitMessage": "Fix for Problems in lookup flow in C++ Client (#551) - Issue 1 (#553)\n\n", "commitDateTime": "2017-07-07 15:43:16", "authoredDateTime": "2017-07-07 15:43:16", "commitGitStats": [{"filePath": "pulsar-client-cpp/lib/HandlerBase.cc", "insertions": 1, "deletions": 3, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "87b8944fa16ec6a898d26cb3e9bd32fee82086e8", "commitGHEventType": "referenced", "commitUser": "jai1", "commitParents": ["aaae2214e6377cccba6c9d42c617b68560b77d06"], "nameRev": "87b8944fa16ec6a898d26cb3e9bd32fee82086e8 tags/v1.19.0-incubating~20", "commitMessage": "CPP Client Test for Lookup Issue (#551) (#595)\n\n* CPP Client Test for Lookup Issue (#551)\r\n\r\n* Fixed a typo\r\n", "commitDateTime": "2017-07-24 18:13:27", "authoredDateTime": "2017-07-24 18:13:27", "commitGitStats": [{"filePath": "pulsar-client-cpp/lib/HandlerBase.h", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "pulsar-client-cpp/tests/BasicEndToEndTest.cc", "insertions": 92, "deletions": 23, "lines": 115}, {"filePath": "pulsar-client-cpp/tests/PulsarFriend.h", "insertions": 14, "deletions": 0, "lines": 14}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 2, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "ModularLoadManagerImpl does not clear preallocated bundles from its ephemeral map", "body": "There is a major issue with the ModularLoadManagerImpl which has been fixed and is being tested. We should not release 1.17.6 or 1.18 until this fix is merged. Otherwise, the old load manager should be used. PR is coming in the next few hours.\r\n\r\n#### Expected behavior\r\n\r\nLoad balancer should not assign bundles to a broker which is down.\r\n\r\n#### Actual behavior\r\n\r\n1. The load manager has incomplete information regarding bundle activity on the brokers, potentially leading to hot brokers, and\r\n2. Once a bundle is assigned to a broker, if that broker permanently dies (or is shut down), the load manager keeps assigning the bundle to a broker which is not up\r\n\r\n#### Steps to reproduce\r\n\r\n1. Load a bundle and wait until you see it is loaded in the broker's load report\r\n2. Stop the broker it is assigned to\r\n3. Lookups will keep returning the old broker even though it is no longer up\r\n\r\n#### System configuration\r\n**Pulsar version**: 1.17.x\r\n", "url": "https://github.com/apache/pulsar/issues/478", "user": "bradtm", "labels": ["type/bug"], "created": "2017-06-15 00:31:43", "closed": "2017-06-16 19:28:19", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Message rate out with batches is counting batches/s", "body": "#### Expected behavior\r\n\r\nWhen publishing with transparent batching the message rate in is correctly \r\ndisplayed as msg/s, but the rate out is just counting the batches. \r\n\r\nSame thing happens with the backlog count. I think we should have been \r\ndisplaying an estimated of the *messages* in the backlog.\r\n", "url": "https://github.com/apache/pulsar/issues/466", "user": "merlimat", "labels": ["type/bug"], "created": "2017-06-09 22:07:38", "closed": "2017-06-15 18:03:40", "commits": {"042521a7d6e7b2c6b1b3b00bbc52a8bc74dc7f66": {"commitGHEventType": "referenced", "commitUser": "jai1"}}, "ttf": 5.000277777777778, "commitsDetails": [{"commitHash": "042521a7d6e7b2c6b1b3b00bbc52a8bc74dc7f66", "commitGHEventType": "referenced", "commitUser": "jai1", "commitParents": ["8abafee5bc229d7e447aae3187885ab906c8290b"], "nameRev": "042521a7d6e7b2c6b1b3b00bbc52a8bc74dc7f66 tags/v1.18~6", "commitMessage": "Fixed message rate out with batches to count messages/s (#466) (#474)\n\n", "commitDateTime": "2017-06-15 00:09:49", "authoredDateTime": "2017-06-15 00:09:49", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/com/yahoo/pulsar/broker/service/Consumer.java", "insertions": 5, "deletions": 3, "lines": 8}, {"filePath": "pulsar-broker/src/test/java/com/yahoo/pulsar/client/api/SimpleProducerConsumerStatTest.java", "insertions": 37, "deletions": 0, "lines": 37}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Consumer.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.broker.service.Consumer.sendMessages(java.util.List)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 1}, {"spoonMethodName": "com.yahoo.pulsar.broker.service.Consumer.updatePermitsAndPendingAcks(java.util.List)", "TOT": 3, "UPD": 0, "INS": 3, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SimpleProducerConsumerStatTest.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.client.api.SimpleProducerConsumerStatTest.testBatchMessagesRateOut()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "no reply from websocket proxy", "body": "#### Expected behavior\r\nwebsocket proxy returns correct response.\r\n\r\n#### Actual behavior\r\n\r\nwe execute the following script about 2 to 100 times, websocket proxy often has come to return no more response.\r\n\r\n#### Steps to reproduce\r\n```\r\n# execute python script\r\n$for i in `seq 1 1000`;do python3.5 ./websocket_produce.py;done;\r\ncreate 0\r\ncreate 1\r\ncreate 2\r\ncreate 3\r\ncreate 4\r\ncreate 5\r\ncreate 6\r\ncreate 7\r\ncreate 8\r\ncreate 9\r\n=======================================================\r\ncreate 0\r\ncreate 2\r\ncreate 3\r\ncreate 4\r\ncreate 5\r\ncreate 6\r\ncreate 7\r\ncreate 9\r\ncreate 8\r\ncreate 1\r\n=======================================================\r\n\u30fb\r\n\u30fb\r\n#no reply\r\n```\r\n\r\nwebsocket_produce.py\r\n```\r\n# -*- coding:utf-8 -*-\r\nimport websocket, base64, json, sys\r\nfrom multiprocessing import Pool\r\nfrom multiprocessing import Process\r\n\r\ncert = '<value>'\r\ndef create_producer(i):\r\n    print('create '+str(i))\r\n    return websocket.create_connection(\r\n       'ws://<hostname>:<port>/ws/producer/persistent/prop/global/n1/topic2',  header=['cert-header-name: ' + cert])\r\n\r\ndef send_message(producer):\r\n    s=base64.b64encode(b'abcdefg').decode('utf-8')\r\n    message = \"{\\\"payload\\\":\\\"\" + s + \"\\\"}\"\r\n    producer.send(message)\r\n#    print(json.loads(producer.recv()))\r\n\r\np = Pool(10)\r\n# 1. create 10 producers\r\nproducers = p.map(create_producer, range(10))\r\n# 2. send 10messages per producer \r\nfor i in range(10):\r\n    p.map(send_message, producers)\r\n\r\nprint(\"=======================================================\")\r\n```  \r\n    \r\n   \r\n   \r\nwe confirmed following when this problem occurred.\r\n1 .  when executing ``getSession().getRemote().sendString(msg)``, suddenly ``onWebSocketError()`` is called. \r\n[ProducerHandler.java#L130](https://github.com/yahoo/pulsar/blob/afaa63fdaa53bc04554329b43ddbf95c5b158ae8/pulsar-websocket/src/main/java/com/yahoo/pulsar/websocket/ProducerHandler.java#L130)\r\n[ProducerHandler.java#L114](https://github.com/yahoo/pulsar/blob/afaa63fdaa53bc04554329b43ddbf95c5b158ae8/pulsar-websocket/src/main/java/com/yahoo/pulsar/websocket/ProducerHandler.java#L114)\r\n```\r\n14:21:16.868 [pulsar-client-io-56-1] INFO  c.y.p.w.AbstractWebSocketHandler     - [/172.21.219.252:54150] WebSocket error on topic persistent://prop/global/n1/topic2 : null\r\n```\r\n2 .  and another thread calls ``onWebSocketClose()``.\r\n```\r\n14:21:16.876 [pulsar-web-46-15] INFO  c.y.p.w.AbstractWebSocketHandler     - [/172.21.219.252:54150] Closed WebSocket session on topic persistent://prop/global/n1/topic2. status: 1006 - reason: WebSocket Read EOF\r\n```\r\n\r\n3 .  after next time, request is stoped in ``ctx.writeAndFlush(request)`` and no reply from websocket proxy\r\n[ClientCnx.java#L349](https://github.com/yahoo/pulsar/blob/029b8b09ffccad8d6021958a258d58c3ab649378/pulsar-client/src/main/java/com/yahoo/pulsar/client/impl/ClientCnx.java#L349)\r\n  \r\n4 .  no reply from admin API, too.\r\n  \r\n\r\n#### System configuration\r\n**Pulsar version**: 1.17.2  and updated the latest version(current master) but This problem still occurred.\r\nwebsocket proxy and broker run in same server.\r\n   \r\n\r\nDo you know what could be happening?", "url": "https://github.com/apache/pulsar/issues/458", "user": "hrsakai", "labels": ["type/bug"], "created": "2017-06-08 02:02:19", "closed": "2017-06-14 19:45:26", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "C++ default batch group commit time is too high", "body": "#### Expected behavior\r\n\r\nIn Java producer we are using 10ms as default group commit time for automatic batching. In C++ that is currently set to 3 seconds. \r\nWe should use the same value as in Java.", "url": "https://github.com/apache/pulsar/issues/457", "user": "merlimat", "labels": ["type/bug"], "created": "2017-06-08 00:36:19", "closed": "2017-06-10 06:01:21", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "C++ producer with batching enabled is not setting the message count", "body": "#### Expected behavior\r\n\r\nWhen publishing with batching enabled on the C++ producer, the message are\r\neffectively batched, but the stats are reporting the \"rate\" of batches/s\r\ninstead of the expected msg/s\r\n", "url": "https://github.com/apache/pulsar/issues/456", "user": "merlimat", "labels": ["type/bug"], "created": "2017-06-08 00:34:52", "closed": "2017-06-09 21:19:30", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "StackOverflow on asyncReplayEntries", "body": "I found the following 7 StackOverflows on brokers in the past 24hs on multiple brokers, I'm attaching the traces here, they all seem to come from `asyncReplayEntries`.\r\n\r\n[overflow1.txt](https://github.com/yahoo/pulsar/files/956209/overflow1.txt)\r\n[overflow2.txt](https://github.com/yahoo/pulsar/files/956210/overflow2.txt)\r\n[overflow3.txt](https://github.com/yahoo/pulsar/files/956215/overflow3.txt)\r\n[overflow4.txt](https://github.com/yahoo/pulsar/files/956213/overflow4.txt)\r\n[overflow5.txt](https://github.com/yahoo/pulsar/files/956212/overflow5.txt)\r\n[overflow6.txt](https://github.com/yahoo/pulsar/files/956211/overflow6.txt)\r\n[overflow7.txt](https://github.com/yahoo/pulsar/files/956214/overflow7.txt)\r\n\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/383", "user": "sschepens", "labels": ["type/bug"], "created": "2017-04-25 18:57:32", "closed": "2017-06-14 23:50:49", "commits": {}, "ttf": 50.000277777777775, "commitsDetails": []}, {"title": "Broker LoadFactor CPU NaN", "body": "We've found that brokers are saving loadFactorCPU as `NaN` in zookeeper path `/loadbalance/settings/load_factor_cpu`, and think this is probably messing load balancing.\r\n`{\"loadFactorCPU\":\"NaN\"}`\r\nHow can this end up being `NaN`? What consecuences can this bring?\r\n\r\nPS: I've also seen some other fields in `/loadbalance/brokers/*` with NaN, such as `allocatedCPU` and `preAllocatedCPU`", "url": "https://github.com/apache/pulsar/issues/382", "user": "sschepens", "labels": ["component/broker", "type/bug"], "created": "2017-04-25 18:26:16", "closed": "2018-11-28 21:55:08", "commits": {}, "ttf": 582.0002777777778, "commitsDetails": []}, {"title": "\"unackedMessages\" stats values keeps increasing", "body": "#### Expected behavior\r\n\r\nIn the consumers stats reported for any topic, `unackedMessages` should tell the number of messages pushed to a particular consumer that weren't acked yet.\r\n\r\n#### Actual behavior\r\n\r\nIn exclusive/failover subscription type, the number is not decreased when acks are received (either individual or cumulative) and it's constantly increasing. There is no user-facing problem (delivery is not blocked), but it doesn't make sense to report that number.\r\n\r\n#### System configuration\r\nSeems to affect current master and even back to 1.17.2 and 1.16.5 releases. 1.15.7 looks good.\r\n", "url": "https://github.com/apache/pulsar/issues/369", "user": "merlimat", "labels": ["type/bug"], "created": "2017-04-20 22:34:02", "closed": "2017-04-24 17:37:57", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "Broker stop produces a consumer reset", "body": "I've been stopping some brokers and found that probably all consumers handled by that broker were reset to a previous position.\r\nThis should not be happening as we're mark-deleting 10 times per second.\r\nI've been checking logs but found nothing useful, it would seem that the metadata stored in zookeeper is just old.\r\nDo you know what could be happening @merlimat @rdhabalia ?\r\n\r\nHere are the logs for all brokers when the stopped:\r\n[broker-logs.txt](https://github.com/yahoo/pulsar/files/914757/broker-logs.txt)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/346", "user": "sschepens", "labels": ["type/bug"], "created": "2017-04-11 21:47:42", "closed": "2018-11-28 21:56:11", "commits": {}, "ttf": 596.0002777777778, "commitsDetails": []}, {"title": "Pulsar binary releases are not getting uploaded to GitHub as expected", "body": "#### Expected behavior\r\n\r\n[GettingStarted](https://github.com/yahoo/pulsar/blob/a86b6df3c54da8f78bd986f2541cd106f031421e/docs/GettingStarted.md#getting-the-software) is no longer accurate.\r\n\r\n#### Actual behavior\r\n\r\n[Releases](https://github.com/yahoo/pulsar/releases/latest) no longer hosting pulsar-X.Y-bin.tar.gz artifacts.\r\n\r\n#### System configuration\r\n\r\nLast version with a binary release was 1.16.5.\r\n", "url": "https://github.com/apache/pulsar/issues/340", "user": "agarman", "labels": ["component/build", "type/bug"], "created": "2017-04-07 19:30:36", "closed": "2017-05-05 22:21:53", "commits": {"136fb7b1746f480be9ec841376838ecf66355af6": {"commitGHEventType": "referenced", "commitUser": "rdhabalia"}, "4193ac019b9e2d9229445ddf55344bf19f7cdcb2": {"commitGHEventType": "referenced", "commitUser": "rdhabalia"}, "e77fa5b1182a065faedd45677bfe63ef8b5e2a0c": {"commitGHEventType": "referenced", "commitUser": "rdhabalia"}, "cdfc0c73dace172e736402218345a57a3c740e9f": {"commitGHEventType": "referenced", "commitUser": "rdhabalia"}}, "ttf": 28.00027777777778, "commitsDetails": [{"commitHash": "136fb7b1746f480be9ec841376838ecf66355af6", "commitGHEventType": "referenced", "commitUser": "rdhabalia", "commitParents": ["9961d2c305bf86aa765b000fc50bd91d2294ae25"], "nameRev": "136fb7b1746f480be9ec841376838ecf66355af6 tags/v1.18~84", "commitMessage": "Fixed travis release yaml configuration. Fix for #340 (#373)\n\n", "commitDateTime": "2017-04-20 17:25:50", "authoredDateTime": "2017-04-20 17:25:50", "commitGitStats": [{"filePath": ".travis.yml", "insertions": 0, "deletions": 1, "lines": 1}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "4193ac019b9e2d9229445ddf55344bf19f7cdcb2", "commitGHEventType": "referenced", "commitUser": "rdhabalia", "commitParents": ["d08b3ed0c2a9a70401e895f114724e2e86d5627a"], "nameRev": "4193ac019b9e2d9229445ddf55344bf19f7cdcb2 tags/v1.17.4~5", "commitMessage": "Fixed travis release yaml configuration. Fix for #340 (#373)\n\n", "commitDateTime": "2017-04-24 15:20:59", "authoredDateTime": "2017-04-20 17:25:50", "commitGitStats": [{"filePath": ".travis.yml", "insertions": 0, "deletions": 1, "lines": 1}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "e77fa5b1182a065faedd45677bfe63ef8b5e2a0c", "commitGHEventType": "referenced", "commitUser": "rdhabalia", "commitParents": ["09b6bb0c2e39e1418b4422c138bd0865cf8950bc"], "nameRev": "e77fa5b1182a065faedd45677bfe63ef8b5e2a0c tags/v1.18~75", "commitMessage": "Skip travis local cleanup before uploading releases to github. Fix for #340 (#381)\n\n", "commitDateTime": "2017-04-25 10:50:14", "authoredDateTime": "2017-04-25 10:50:14", "commitGitStats": [{"filePath": ".travis.yml", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "cdfc0c73dace172e736402218345a57a3c740e9f", "commitGHEventType": "referenced", "commitUser": "rdhabalia", "commitParents": ["763836a71d42a175ce8966b168d625e4a3e864f2"], "nameRev": "cdfc0c73dace172e736402218345a57a3c740e9f tags/v1.17.5~11", "commitMessage": "Skip travis local cleanup before uploading releases to github. Fix for #340 (#381)\n\n", "commitDateTime": "2017-05-02 11:20:00", "authoredDateTime": "2017-04-25 10:50:14", "commitGitStats": [{"filePath": ".travis.yml", "insertions": 1, "deletions": 0, "lines": 1}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 2, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Java Client doesn't close the connection if the subscribe fails", "body": "#### Problem\r\nWhen the Java client with connection pool off, receives a subscribe failed error from broker the client tries to reconnect after a backoff, but doesn't close the old connection. This leads to thousands of connections created on the broker which results in broker running out of file descriptors.\r\n\r\n#### Steps to reproduce\r\na. Start the broker, bookie and zookie\r\nb. Start consumer and producer - keep them running henceforth\r\nc. Wait for a min and shut down the bookies\r\nd. Restart the broker\r\ne. Wait for a few minutes\r\nf. do lsof on the broker to see thousands of connections.\r\n\r\n### Proposed solution\r\nJava client can close the old connection before getting a new connection - since the connection pool is off we can safely close the old connection without affecting other producers or consumers.", "url": "https://github.com/apache/pulsar/issues/331", "user": "jai1", "labels": ["type/bug"], "created": "2017-04-04 20:36:42", "closed": "2017-04-19 02:36:31", "commits": {}, "ttf": 14.000277777777777, "commitsDetails": []}, {"title": "Fail to reset-cursor on partitioned topic", "body": "After issues with ZK #308 we are attempting to reset some consumers and we're getting the following exceptions.\r\nHow and why can a `ManagedCursorImpl` have a `ReadOnlyLedgerHandle`?\r\n\r\n```\r\nCaused by: com.yahoo.pulsar.broker.service.BrokerServiceException$SubscriptionInvalidCursorPosition: unable to persist position for cursor reset 730778:44020\r\n\tat com.yahoo.pulsar.broker.service.persistent.PersistentSubscription$5$1.resetFailed(PersistentSubscription.java:371)\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$7.operationFailed(ManagedCursorImpl.java:746)\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.lambda$persistPosition$12(ManagedCursorImpl.java:1911)\r\n\tat org.apache.bookkeeper.client.ReadOnlyLedgerHandle.asyncAddEntry(ReadOnlyLedgerHandle.java:105)\r\n\tat org.apache.bookkeeper.client.ReadOnlyLedgerHandle.asyncAddEntry(ReadOnlyLedgerHandle.java:98)\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.persistPosition(ManagedCursorImpl.java:1889)\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalResetCursor(ManagedCursorImpl.java:768)\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.lambda$asyncResetCursor$4(ManagedCursorImpl.java:780)\r\n\tat org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:27)\r\n\tat org.apache.bookkeeper.util.SafeRunnable.run(SafeRunnable.java:31)\r\n```", "url": "https://github.com/apache/pulsar/issues/309", "user": "sschepens", "labels": ["type/bug"], "created": "2017-03-22 20:01:44", "closed": "2017-03-24 22:14:43", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "BookKeeper Crashes unexpectedly", "body": "Hi. We had a couple of bookkeepers that crashed unexpectedly at different moments. We gathered the logs before the crash, I'm attaching them. Any help will be much appreciated.\r\n\r\nThanks\r\n[bklogs.txt](https://github.com/yahoo/pulsar/files/810917/bklogs.txt)\r\n\r\n", "url": "https://github.com/apache/pulsar/issues/258", "user": "estebangarcia", "labels": ["type/bug"], "created": "2017-03-01 13:59:32", "closed": "2017-03-23 16:36:25", "commits": {}, "ttf": 22.00027777777778, "commitsDetails": []}, {"title": "Incorrect error handling in ConsumerBase.receiveAsync ", "body": "#### Expected behavior\r\n\r\nIf the listener is unavailable or state is not ready the function should return exception.\r\n\r\n#### Actual behavior\r\n\r\nIt doesn't, as seen below the return statement is missing before `FutureUtil`\r\n\r\n```\r\n\r\n    @Override\r\n    public CompletableFuture<Message> receiveAsync() {\r\n\r\n        if (listener != null) {\r\n            FutureUtil.failedFuture(new PulsarClientException.InvalidConfigurationException(\r\n                    \"Cannot use receive() when a listener has been set\"));\r\n        }\r\n\r\n        switch (getState()) {\r\n        case Ready:\r\n        case Connecting:\r\n            break; // Ok\r\n        case Closing:\r\n        case Closed:\r\n            FutureUtil.failedFuture(new PulsarClientException.AlreadyClosedException(\"Consumer already closed\"));\r\n        case Failed:\r\n        case Uninitialized:\r\n            FutureUtil.failedFuture(new PulsarClientException.NotConnectedException());\r\n        }\r\n\r\n        return internalReceiveAsync();\r\n    }\r\n\r\n```\r\n#### Steps to reproduce\r\n\r\nCode Inspection\r\n\r\n#### System configuration\r\n**Pulsar version**: x.y\r\n", "url": "https://github.com/apache/pulsar/issues/249", "user": "jai1", "labels": ["type/bug"], "created": "2017-02-27 20:15:21", "closed": "2017-03-02 03:26:50", "commits": {"24c7724c190a0dc3c6a24c6670c1575f85d62757": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 2.000277777777778, "commitsDetails": [{"commitHash": "24c7724c190a0dc3c6a24c6670c1575f85d62757", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["a715c93411b2aa2abdc83672cd2554c21f11e7ec"], "nameRev": "24c7724c190a0dc3c6a24c6670c1575f85d62757 tags/v1.17~41", "commitMessage": "Fix in ConsumerBase.java to return failed future - #249 (#257)\n\n", "commitDateTime": "2017-03-01 14:08:45", "authoredDateTime": "2017-03-01 14:08:45", "commitGitStats": [{"filePath": "pulsar-broker/src/test/java/com/yahoo/pulsar/client/impl/ConsumeBaseExceptionTest.java", "insertions": 80, "deletions": 0, "lines": 80}, {"filePath": "pulsar-client/src/main/java/com/yahoo/pulsar/client/impl/ConsumerBase.java", "insertions": 3, "deletions": 3, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConsumeBaseExceptionTest.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.client.impl.ConsumeBaseExceptionTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConsumerBase.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.client.impl.ConsumerBase.receiveAsync()", "TOT": 6, "UPD": 0, "INS": 3, "MOV": 3, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Intermittent test failures on AdminApiTest.partitionedTopics", "body": "```\r\nFailed tests: \r\ncom.yahoo.pulsar.broker.admin.AdminApiTest.partitionedTopics(com.yahoo.pulsar.broker.admin.AdminApiTest)\r\n  Run 1: AdminApiTest.partitionedTopics \u00bb ServerSideError Some error occourred on the s...\r\n  Run 2: PASS\r\n```", "url": "https://github.com/apache/pulsar/issues/236", "user": "merlimat", "labels": ["component/test", "type/bug"], "created": "2017-02-23 16:45:40", "closed": "2020-06-09 01:39:12", "commits": {}, "ttf": 1201.0002777777777, "commitsDetails": []}, {"title": "NPE on resetCursor", "body": "@merlimat @rdhabalia \r\nI just got a coulpe of NPE's when calling resetCursor on a subscription with active consumers.\r\nThe stack is:\r\n```\r\njava.lang.NullPointerException\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.persistPosition(ManagedCursorImpl.java:1858)\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalResetCursor(ManagedCursorImpl.java:700)\r\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.lambda$asyncResetCursor$4(ManagedCursorImpl.java:765)\r\n\tat org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:27)\r\n\tat org.apache.bookkeeper.util.SafeRunnable.run(SafeRunnable.java:31)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.java:144)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\n```\r\n\r\nApparently, the `ManagedCursorImpl` has a null `cursorLedger` so the ends up [passing](https://github.com/yahoo/pulsar/blob/master/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java#L676) `null` as LedgerHandle to `persistPosition` which fails when calling `lh.asyncAddEntry` [here](https://github.com/yahoo/pulsar/blob/master/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java#L1801).\r\n\r\nThis leaves the subscription in a inconsistent state because the callback is never called and the subrscription is never unfenced.\r\n\r\nIs it OK for a `ManagedCursorImpl` to have no cursor ledger? is it because data is stored in ZK? what should we do in this case? ", "url": "https://github.com/apache/pulsar/issues/230", "user": "sschepens", "labels": ["type/bug"], "created": "2017-02-21 18:43:40", "closed": "2017-03-02 03:01:02", "commits": {}, "ttf": 8.000277777777777, "commitsDetails": []}, {"title": "JvmMetrics doesn't return correct jvm_direct_memory_used.", "body": "#### Expected behavior\r\n\r\n[JvmMetrics](https://github.com/yahoo/pulsar/blob/master/pulsar-broker/src/main/java/com/yahoo/pulsar/broker/stats/metrics/JvmMetrics.java#L67) doesn't return correct `jvm_direct_memory_used`.\r\n\r\n#### Actual behavior and Steps to reproduce\r\n\r\n```\r\n @Test\r\n    public void testDirectMemory() throws Exception {\r\n\r\n        int pendingMsg = 10_000000;\r\n\r\n        PooledByteBufAllocator allocator = new PooledByteBufAllocator( //\r\n                true, // preferDirect\r\n                0, // nHeapArenas,\r\n                1, // nDirectArena\r\n                8192, // pageSize\r\n                11, // maxOrder\r\n                64, // tinyCacheSize\r\n                32, // smallCacheSize\r\n                8 // normalCacheSize\r\n        );\r\n        JvmMetrics jvm = new JvmMetrics(pulsar);\r\n        Field directMemoryUsage = PlatformDependent.class.getDeclaredField(\"DIRECT_MEMORY_COUNTER\");\r\n        directMemoryUsage.setAccessible(true);\r\n        try {\r\n            for (int i = 0; i < pendingMsg * pendingMsg; i++) {\r\n                allocator.directBuffer(10000, 10000);\r\n                if (i % 30000 == 0) {\r\n                    Thread.sleep(1000);\r\n                    System.out.println(i + \" used_jdk,used_netty,max :\"\r\n                            + jvm.generate().get(0).getMetrics().get(\"jvm_direct_memory_used\") + \",  \"\r\n                            + jvm.generate().get(0).getMetrics().get(\"jvm_max_direct_memory\") + \", \"\r\n                            + ((AtomicLong) directMemoryUsage.get(null)).get());\r\n                }\r\n            }\r\n        } catch (Throwable th) {\r\n            th.printStackTrace();\r\n        }\r\n    }\r\n```\r\n**output**\r\n```\r\n0 used_jdk,used_netty,max :24577,  8589934592, 16777216\r\n30000 used_jdk,used_netty,max :24577,  8589934592, 503316480\r\n60000 used_jdk,used_netty,max :24577,  8589934592, 989855744\r\n90000 used_jdk,used_netty,max :24577,  8589934592, 1476395008\r\n120000 used_jdk,used_netty,max :24577,  8589934592, 1979711488\r\n150000 used_jdk,used_netty,max :24577,  8589934592, 2466250752\r\n180000 used_jdk,used_netty,max :24577,  8589934592, 2952790016\r\n210000 used_jdk,used_netty,max :24577,  8589934592, 3456106496\r\n240000 used_jdk,used_netty,max :24577,  8589934592, 3942645760\r\n270000 used_jdk,used_netty,max :32769,  8589934592, 4429185024\r\n300000 used_jdk,used_netty,max :32769,  8589934592, 4915724288\r\n330000 used_jdk,used_netty,max :32769,  8589934592, 5419040768\r\n360000 used_jdk,used_netty,max :32769,  8589934592, 5905580032\r\n390000 used_jdk,used_netty,max :32769,  8589934592, 6392119296\r\n420000 used_jdk,used_netty,max :32769,  8589934592, 6895435776\r\n450000 used_jdk,used_netty,max :32769,  8589934592, 7381975040\r\n480000 used_jdk,used_netty,max :32769,  8589934592, 7868514304\r\n510000 used_jdk,used_netty,max :32769,  8589934592, 8371830784\r\nio.netty.util.internal.OutOfDirectMemoryError: failed to allocate 16777216 byte(s) of direct memory (used: 8589934592, max: 8589934592)\r\n\tat io.netty.util.internal.PlatformDependent.incrementMemoryCounter(PlatformDependent.java:518)\r\n\tat io.netty.util.internal.PlatformDependent.allocateDirectNoCleaner(PlatformDependent.java:472)\r\n\tat io.netty.buffer.PoolArena$DirectArena.allocateDirect(PoolArena.java:688)\r\n\tat io.netty.buffer.PoolArena$DirectArena.newChunk(PoolArena.java:677)\r\n\tat io.netty.buffer.PoolArena.allocateNormal(PoolArena.java:237)\r\n\tat io.netty.buffer.PoolArena.allocate(PoolArena.java:221)\r\n\tat io.netty.buffer.PoolArena.allocate(PoolArena.java:141)\r\n```\r\n", "url": "https://github.com/apache/pulsar/issues/222", "user": "rdhabalia", "labels": ["type/bug"], "created": "2017-02-18 00:00:22", "closed": "2017-02-18 15:32:19", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Replicator does not resume once paused, due to backlog quota", "body": "#### Expected behavior\r\n\r\nReplicator stops replication when the remote side reaches it's configured backlog quota and resumes once backlog goes below it's quota.\r\n\r\n#### Actual behavior\r\n\r\nOnce the backlog drains, it should resume replication. Instead it stays in the paused mode. \r\n\r\n#### Steps to reproduce\r\n\r\nOn a global topic, allow the local backlog to grow beyond configured quota. Continue to publish messages from a remote cluster on the same topic.\r\n\r\n#### System configuration\r\n**Pulsar version**: 1.16\r\n", "url": "https://github.com/apache/pulsar/issues/199", "user": "saandrews", "labels": ["type/bug"], "created": "2017-02-09 21:28:51", "closed": "2017-02-17 23:55:29", "commits": {"6fd212affde8a4621ecda82889ace96060187493": {"commitGHEventType": "referenced", "commitUser": "merlimat"}, "c266e401a20dc70288e608784de194b88ff10a39": {"commitGHEventType": "referenced", "commitUser": "rdhabalia"}}, "ttf": 8.000277777777777, "commitsDetails": [{"commitHash": "6fd212affde8a4621ecda82889ace96060187493", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["7284ae8166c2b694678900bef6de062b328fd26f"], "nameRev": "6fd212affde8a4621ecda82889ace96060187493 tags/v1.17~66", "commitMessage": "Fix #199: Do not stop to replicate when producer throws exception (#220)\n\n* Fix #199: Do not stop to replicate when producer throws exception\r\n\r\n* Fix log messages\r\n\r\n* testReplicatorProducerClosing shoud be executed at last since it closes pulsar2/pulsar3\r\n\r\n* Add unit test for replication resumption on backlog exceeded\r\n", "commitDateTime": "2017-02-17 15:55:28", "authoredDateTime": "2017-02-17 15:55:28", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/com/yahoo/pulsar/broker/service/persistent/PersistentReplicator.java", "insertions": 8, "deletions": 8, "lines": 16}, {"filePath": "pulsar-broker/src/test/java/com/yahoo/pulsar/broker/service/ReplicatorTest.java", "insertions": 76, "deletions": 6, "lines": 82}, {"filePath": "pulsar-broker/src/test/java/com/yahoo/pulsar/broker/service/ReplicatorTestBase.java", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentReplicator.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.broker.service.persistent.PersistentReplicator.ProducerSendCallback.sendComplete(java.lang.Exception)", "TOT": 5, "UPD": 0, "INS": 2, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "ReplicatorTest.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.broker.service.ReplicatorTest.testConcurrentReplicator()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "com.yahoo.pulsar.broker.service.ReplicatorTest.testReplicationOverrides()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "com.yahoo.pulsar.broker.service.ReplicatorTest.testResumptionAfterBacklogRelaxed()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "com.yahoo.pulsar.broker.service.ReplicatorTest.testReplicatorProducerClosing()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ReplicatorTestBase.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.broker.service.ReplicatorTestBase", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "com.yahoo.pulsar.broker.service.ReplicatorTestBase.setup()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "c266e401a20dc70288e608784de194b88ff10a39", "commitGHEventType": "referenced", "commitUser": "rdhabalia", "commitParents": ["be4f4eacfeb26e12327c4be98cbfdbbf9a2b71a1"], "nameRev": "c266e401a20dc70288e608784de194b88ff10a39 tags/v1.16.1~4", "commitMessage": "Fix #199: Do not stop to replicate when producer throws exception (#220)\n\n* Fix #199: Do not stop to replicate when producer throws exception\r\n\r\n* Fix log messages\r\n\r\n* testReplicatorProducerClosing shoud be executed at last since it closes pulsar2/pulsar3\r\n\r\n* Add unit test for replication resumption on backlog exceeded\r\n", "commitDateTime": "2017-02-24 15:46:19", "authoredDateTime": "2017-02-17 15:55:28", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/com/yahoo/pulsar/broker/service/persistent/PersistentReplicator.java", "insertions": 8, "deletions": 8, "lines": 16}, {"filePath": "pulsar-broker/src/test/java/com/yahoo/pulsar/broker/service/ReplicatorTest.java", "insertions": 76, "deletions": 6, "lines": 82}, {"filePath": "pulsar-broker/src/test/java/com/yahoo/pulsar/broker/service/ReplicatorTestBase.java", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentReplicator.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.broker.service.persistent.PersistentReplicator.ProducerSendCallback.sendComplete(java.lang.Exception)", "TOT": 5, "UPD": 0, "INS": 2, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "ReplicatorTest.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.broker.service.ReplicatorTest.testConcurrentReplicator()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "com.yahoo.pulsar.broker.service.ReplicatorTest.testReplicationOverrides()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "com.yahoo.pulsar.broker.service.ReplicatorTest.testResumptionAfterBacklogRelaxed()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "com.yahoo.pulsar.broker.service.ReplicatorTest.testReplicatorProducerClosing()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ReplicatorTestBase.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.broker.service.ReplicatorTestBase", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "com.yahoo.pulsar.broker.service.ReplicatorTestBase.setup()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Brokers connecting to replaced Bookies", "body": "We're finding brokers attempting to connect to Bookies that have been replaced and are nowhere to be found on Zookeeper.", "url": "https://github.com/apache/pulsar/issues/190", "user": "sschepens", "labels": ["type/bug"], "created": "2017-02-03 21:07:58", "closed": "2018-12-05 22:15:14", "commits": {}, "ttf": 670.0002777777778, "commitsDetails": []}, {"title": "Failed to split namespace bundle", "body": "We had a couple of this errors last night, here are the logs from broker.\r\n\r\n```\r\n2017-01-25 08:53:54,522 - INFO  - [pool-1-thread-1:SimpleLoadManagerImpl@1381] - Will split hot namespace bundle fury/global/cbead41f2a5849b5a5be64df0f3521d2-orders-orders/0xb333332f_0xbffffffb, topics 2, producers+consumers 610, msgRate in+out 1000.1632182840386, bandwidth in+out 126300.59782161229\r\n\r\n2017-01-25 08:53:54,523 - INFO  - [pulsar-web-44-25:Namespaces@781] - [null] Split namespace bundle fury/global/cbead41f2a5849b5a5be64df0f3521d2-orders-orders/0xbffffffb_0xccccccc8\r\n\r\n2017-01-25 08:53:54,523 - ERROR - [pulsar-web-44-25:PulsarWebResource@364] - [null] Failed to validate namespace bundle fury/global/cbead41f2a5849b5a5be64df0f3521d2-orders-orders/0xbffffffb_0xccccccc\r\n\r\njava.lang.IllegalArgumentException: Cannot find bundle in the bundles list\r\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:93)\r\n\tat com.yahoo.pulsar.common.naming.NamespaceBundles.validateBundle(NamespaceBundles.java:101)\r\n\tat com.yahoo.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleRange(PulsarWebResource.java:361)\r\n\tat com.yahoo.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleOwnership(PulsarWebResource.java:372)\r\n\tat com.yahoo.pulsar.broker.admin.Namespaces.splitNamespaceBundle(Namespaces.java:793)\r\n\tat sun.reflect.GeneratedMethodAccessor118.invoke(Unknown Source)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81)\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144)\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161)\r\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:143)\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99)\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389)\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347)\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102)\r\n\tat org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326)\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:271)\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:267)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:315)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:297)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:267)\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317)\r\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305)\r\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154)\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473)\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:427)\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:388)\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:341)\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:228)\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:845)\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:583)\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:524)\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:319)\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:253)\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\r\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.java:144)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\n\r\ncom.yahoo.pulsar.client.admin.PulsarAdminException$ServerSideErrorException: Some error occourred on the server\r\n\tat com.yahoo.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:160)\r\n\tat com.yahoo.pulsar.client.admin.internal.NamespacesImpl.splitNamespaceBundle(NamespacesImpl.java:349)\r\n\tat com.yahoo.pulsar.broker.loadbalance.impl.SimpleLoadManagerImpl.doNamespaceBundleSplit(SimpleLoadManagerImpl.java:1396)\r\n\tat com.yahoo.pulsar.broker.loadbalance.NamespaceBundleSplitTask.run(NamespaceBundleSplitTask.java:37)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\nCaused by: javax.ws.rs.InternalServerErrorException: HTTP 500 Internal Server Error\r\n\tat org.glassfish.jersey.client.JerseyInvocation.convertToException(JerseyInvocation.java:1032)\r\n\tat org.glassfish.jersey.client.JerseyInvocation.translate(JerseyInvocation.java:819)\r\n\tat org.glassfish.jersey.client.JerseyInvocation.access$700(JerseyInvocation.java:92)\r\n\tat org.glassfish.jersey.client.JerseyInvocation$2.call(JerseyInvocation.java:701)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:315)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:297)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:228)\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:444)\r\n\tat org.glassfish.jersey.client.JerseyInvocation.invoke(JerseyInvocation.java:697)\r\n\tat org.glassfish.jersey.client.JerseyInvocation$Builder.method(JerseyInvocation.java:448)\r\n\tat org.glassfish.jersey.client.JerseyInvocation$Builder.put(JerseyInvocation.java:332)\r\n\tat com.yahoo.pulsar.client.admin.internal.NamespacesImpl.splitNamespaceBundle(NamespacesImpl.java:347)\r\n\t... 9 more\r\n\r\n\r\n2017-01-25 08:53:54,527 - ERROR - [pool-1-thread-1:SimpleLoadManagerImpl@1400] - Failed to split namespace bundle fury/global/cbead41f2a5849b5a5be64df0f3521d2-orders-orders/0xbffffffb_0xccccccc8\r\n\r\n\r\n2017-01-25 08:53:54,527 - ERROR - [pulsar-web-44-10:PulsarWebResource@364] - [null] Failed to validate namespace bundle fury/global/cbead41f2a5849b5a5be64df0f3521d2-orders-orders/0xb333332f_0xbffffffb\r\n\r\n\r\n2017-01-25 08:53:54,527 - INFO  - [pulsar-web-44-10:Namespaces@781] - [null] Split namespace bundle fury/global/cbead41f2a5849b5a5be64df0f3521d2-orders-orders/0xb333332f_0xbffffffb\r\n\r\n\r\njava.lang.IllegalArgumentException: Invalid upper boundary for bundle\r\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:93)\r\n\tat com.yahoo.pulsar.common.naming.NamespaceBundles.validateBundle(NamespaceBundles.java:102)\r\n\tat com.yahoo.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleRange(PulsarWebResource.java:361)\r\n\tat com.yahoo.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleOwnership(PulsarWebResource.java:372)\r\n\tat com.yahoo.pulsar.broker.admin.Namespaces.splitNamespaceBundle(Namespaces.java:793)\r\n\tat sun.reflect.GeneratedMethodAccessor118.invoke(Unknown Source)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81)\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144)\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161)\r\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:143)\r\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99)\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389)\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347)\r\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102)\r\n\tat org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326)\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:271)\r\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:267)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:315)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:297)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:267)\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317)\r\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305)\r\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154)\r\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473)\r\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:427)\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:388)\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:341)\r\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:228)\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:845)\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:583)\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:524)\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:319)\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:253)\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\r\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.java:144)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\n\r\n\r\n2017-01-25 08:53:54,528 - ERROR - [pool-1-thread-1:SimpleLoadManagerImpl@1400] - Failed to split namespace bundle fury/global/cbead41f2a5849b5a5be64df0f3521d2-orders-orders/0xb333332f_0xbffffffb\r\n\r\n\r\ncom.yahoo.pulsar.client.admin.PulsarAdminException$ServerSideErrorException: Some error occourred on the server\r\n\tat com.yahoo.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:160)\r\n\tat com.yahoo.pulsar.client.admin.internal.NamespacesImpl.splitNamespaceBundle(NamespacesImpl.java:349)\r\n\tat com.yahoo.pulsar.broker.loadbalance.impl.SimpleLoadManagerImpl.doNamespaceBundleSplit(SimpleLoadManagerImpl.java:1396)\r\n\tat com.yahoo.pulsar.broker.loadbalance.NamespaceBundleSplitTask.run(NamespaceBundleSplitTask.java:37)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\nCaused by: javax.ws.rs.InternalServerErrorException: HTTP 500 Internal Server Error\r\n\tat org.glassfish.jersey.client.JerseyInvocation.convertToException(JerseyInvocation.java:1032)\r\n\tat org.glassfish.jersey.client.JerseyInvocation.translate(JerseyInvocation.java:819)\r\n\tat org.glassfish.jersey.client.JerseyInvocation.access$700(JerseyInvocation.java:92)\r\n\tat org.glassfish.jersey.client.JerseyInvocation$2.call(JerseyInvocation.java:701)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:315)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:297)\r\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:228)\r\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:444)\r\n\tat org.glassfish.jersey.client.JerseyInvocation.invoke(JerseyInvocation.java:697)\r\n\tat org.glassfish.jersey.client.JerseyInvocation$Builder.method(JerseyInvocation.java:448)\r\n\tat org.glassfish.jersey.client.JerseyInvocation$Builder.put(JerseyInvocation.java:332)\r\n\tat com.yahoo.pulsar.client.admin.internal.NamespacesImpl.splitNamespaceBundle(NamespacesImpl.java:347)\r\n\t... 9 more\r\n```", "url": "https://github.com/apache/pulsar/issues/172", "user": "sschepens", "labels": ["type/bug"], "created": "2017-01-25 14:07:24", "closed": "2017-01-31 23:16:51", "commits": {"fba72bd0cae067ea6cd6f39e7f39fa29f26c0085": {"commitGHEventType": "referenced", "commitUser": "yush1ga"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "fba72bd0cae067ea6cd6f39e7f39fa29f26c0085", "commitGHEventType": "referenced", "commitUser": "yush1ga", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "spoonStatsSummary": {}, "statsSkippedReason": ""}, {"title": "Broker Shutdown while unloading bundles", "body": "Using the functionallity in #88 we enabled Broker loadbalancing and testing it.\r\nWe're seeing that almost everytime a Broker unloads a topic it prints a bunch of stacks like the following that do not seem too harmful.\r\n```\r\n2016-11-16 17:34:41,750 - INFO  - [pulsar-web-44-1:Consumer@257] - Disconnecting consumer: Consumer{subscription=PersistentSubscription{topic=persistent://items/global/items/items-partition-7, name=items-104}, consumerId=1057, consumerName=ip-10-3-3-105, address=/10.3.3.105:44574}\r\n2016-11-16 17:34:41,750 - WARN  - [pulsar-web-44-19:DestinationLookup@114] - Failed to lookup broker for topic persistent://items/global/items/items-partition-7: java.lang.IllegalStateException: Namespace bundle items/global/items/0x33333332_0x4ccccccb is being unloaded\r\njava.util.concurrent.CompletionException: java.lang.IllegalStateException: Namespace bundle items/global/items/0x33333332_0x4ccccccb is being unloaded\r\n        at java.util.concurrent.CompletableFuture.encodeRelay(CompletableFuture.java:326)\r\n        at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:984)\r\n        at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2124)\r\n        at com.yahoo.pulsar.broker.namespace.NamespaceService.getBrokerServiceUrlAsync(NamespaceService.java:131)\r\n        at com.yahoo.pulsar.broker.lookup.DestinationLookup.lookupDestinationAsync(DestinationLookup.java:77)\r\n        at sun.reflect.GeneratedMethodAccessor13.invoke(Unknown Source)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.lang.reflect.Method.invoke(Method.java:498)\r\n        at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$1.invoke(ResourceMethodInvocationHandlerFactory.java:81)\r\n        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:144)\r\n        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:161)\r\n        at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:143)\r\n        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:99)\r\n        at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:389)\r\n        at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:347)\r\n        at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:102)\r\n        at org.glassfish.jersey.server.ServerRuntime$2.run(ServerRuntime.java:326)\r\n        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:271)\r\n        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:267)\r\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:315)\r\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:297)\r\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:267)\r\n        at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:317)\r\n        at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:305)\r\n        at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:1154)\r\n        at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:473)\r\n        at org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:427)\r\n        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:388)\r\n        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:341)\r\n        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:228)\r\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:845)\r\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:583)\r\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:224)\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1180)\r\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511)\r\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185)\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1112)\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\r\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213)\r\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119)\r\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134)\r\n        at org.eclipse.jetty.server.Server.handle(Server.java:524)\r\n        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:319)\r\n        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:253)\r\n        at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273)\r\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95)\r\n        at org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93)\r\n        at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303)\r\n        at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148)\r\n        at org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n        at io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.java:144)\r\n        at java.lang.Thread.run(Thread.java:745)\r\nCaused by: java.lang.IllegalStateException: Namespace bundle items/global/items/0x33333332_0x4ccccccb is being unloaded\r\n        at com.yahoo.pulsar.broker.namespace.NamespaceService.lambda$findBrokerServiceUrl$4(NamespaceService.java:305)\r\n        at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:656)\r\n        at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:669)\r\n        at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:1997)\r\n        at com.yahoo.pulsar.broker.namespace.NamespaceService.findBrokerServiceUrl(NamespaceService.java:289)\r\n        at com.yahoo.pulsar.broker.namespace.NamespaceService.lambda$getBrokerServiceUrlAsync$0(NamespaceService.java:131)\r\n        at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:981)\r\n        ... 52 more\r\n2016-11-16 17:34:41,752 - INFO  - [pulsar-web-44-19:Slf4jRequestLog@60] - 10.3.3.231 - - [16/Nov/2016:17:34:41 +0000] \"GET //pulsar-discovery.furycloud.io/lookup/v2/destination/persistent/items/global/items/items-partition-7 HTTP/1.1\" 500 392 \"-\" \"Pulsar-Java-v1.15.2\" 2\r\n2016-11-16 17:34:41,752 - INFO  - [pulsar-web-44-1:PersistentDispatcherMultipleConsumers@108] - Removed consumer Consumer{subscription=PersistentSubscription{topic=persistent://items/global/items/items-partition-7, name=items-104}, consumerId=1057, consumerName=ip-10-3-3-105, address=/10.3.3.105:44574} with pending 1000 acks\r\n```\r\n\r\nThe problem is that after a few seconds the broker always looses it's connection to Zookeeper and then crashes.\r\n\r\n```\r\n2016-11-16 17:34:09,533 - INFO  - [pool-1-thread-1:SimpleLoadManagerImpl@1345] - Running namespace bundle split with thresholds: topics 1000, sessions 1000, msgRate 1000, bandwidth 104857600, maxBundles 128\r\n2016-11-16 17:34:09,534 - INFO  - [pool-1-thread-1:SimpleLoadManagerImpl@1381] - Will split hot namespace bundle items/global/items/0x33333332_0x4ccccccb, topics 4, producers+consumers 4, msgRate in+out 5103.013012492122, bandwidth in+out 2094753.0844518002\r\n2016-11-16 17:34:09,535 - INFO  - [pool-1-thread-1:SimpleLoadManagerImpl@1381] - Will split hot namespace bundle items/global/items/0xccccccc8_0xe6666661, topics 3, producers+consumers 3, msgRate in+out 3823.7859370443607, bandwidth in+out 1568994.7075086082\r\n2016-11-16 17:34:09,575 - INFO  - [pool-1-thread-1:PulsarService@563] - Admin api url: http://ip-10-3-3-225:8080\r\n2016-11-16 17:34:09,681 - INFO  - [pulsar-web-44-8:Namespaces@781] - [null] Split namespace bundle items/global/items/0x33333332_0x4ccccccb\r\n2016-11-16 17:34:09,702 - INFO  - [pulsar-web-44-8:OwnershipCache@224] - Trying to acquire ownership of items/global/items/0x33333332_0x3ffffffe\r\n2016-11-16 17:34:09,702 - INFO  - [pulsar-web-44-8:OwnershipCache@224] - Trying to acquire ownership of items/global/items/0x3ffffffe_0x4ccccccb\r\n2016-11-16 17:34:09,706 - INFO  - [main-EventThread:OwnershipCache@229] - Successfully acquired ownership of /namespace/items/global/items/0x33333332_0x3ffffffe\r\n2016-11-16 17:34:09,706 - INFO  - [main-EventThread:OwnershipCache@229] - Successfully acquired ownership of /namespace/items/global/items/0x3ffffffe_0x4ccccccb\r\n2016-11-16 17:34:09,709 - INFO  - [main-EventThread:ZooKeeperDataCache@131] - [State:CONNECTED Timeout:30000 sessionid:0x2586d8253880021 local:/10.3.3.225:41540 remoteserver:ip-10-3-3-143.ec2.internal/10.3.3.143:2181 lastZxid:4294989977 xid:4113 sent:4113 recv:4173 queuedpkts:0 pendingresp:0 queuedevents:1] Received ZooKeeper watch event: WatchedEvent state:SyncConnected type:NodeDataChanged path:/admin/local-policies/items/global/items\r\n2016-11-16 17:34:12,805 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 25 seconds\r\n2016-11-16 17:34:14,805 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 23 seconds\r\n2016-11-16 17:34:16,806 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 21 seconds\r\n2016-11-16 17:34:19,073 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 18 seconds\r\n2016-11-16 17:34:21,106 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 16 seconds\r\n2016-11-16 17:34:23,106 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 14 seconds\r\n2016-11-16 17:34:25,106 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 12 seconds\r\n2016-11-16 17:34:27,107 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 10 seconds\r\n2016-11-16 17:34:29,107 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 8 seconds\r\n2016-11-16 17:34:31,107 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 6 seconds\r\n2016-11-16 17:34:33,108 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 4 seconds\r\n2016-11-16 17:34:35,108 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 2 seconds\r\n2016-11-16 17:34:37,108 - WARN  - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@160] - zoo keeper disconnected, waiting to reconnect, time remaining = 0 seconds\r\n2016-11-16 17:34:38,101 - INFO  - [pulsar-io-39-2:ServerCnx@577] - [PersistentTopic{topic=persistent://items/global/items/items-partition-7}][pulsar.repl.us-east] Closing producer on cnx /10.3.3.140:57424\r\n2016-11-16 17:34:38,106 - INFO  - [pulsar-io-39-2:ServerCnx@580] - [PersistentTopic{topic=persistent://items/global/items/items-partition-7}][pulsar.repl.us-east] Closed producer on cnx /10.3.3.140:57424\r\n2016-11-16 17:34:38,225 - INFO  - [pulsar-io-39-6:ClientCnx@288] - [ip-10-3-3-140/10.3.3.140:6650] Broker notification of Closed producer: 58\r\n2016-11-16 17:34:38,226 - INFO  - [pulsar-io-39-6:HandlerBase@109] - [persistent://items/global/items/items-partition-7] [pulsar.repl.us-west] Closed connection [id: 0x21af9022, L:/10.3.3.225:55580 - R:ip-10-3-3-140/10.3.3.140:6650] -- Will try again in 0.12 s\r\n2016-11-16 17:34:38,347 - WARN  - [pulsar-timer-46-1:HandlerBase@112] - [persistent://items/global/items/items-partition-7] [pulsar.repl.us-west] Reconnecting after timeout\r\n2016-11-16 17:34:38,359 - WARN  - [pulsar-io-39-3:HttpClient@140] - [http://internal-pulsar-brokers-1007547935.us-east-1.elb.amazonaws.com/lookup/v2/destination/persistent/items/global/items/items-partition-7] HTTP get request failed: Request failed.\r\n2016-11-16 17:34:38,359 - WARN  - [pulsar-io-39-3:HandlerBase@74] - [persistent://items/global/items/items-partition-7] [pulsar.repl.us-west] Error connecting to broker: com.yahoo.pulsar.client.api.PulsarClientException: HTTP get request failed: Request failed.\r\n2016-11-16 17:34:38,359 - WARN  - [pulsar-io-39-3:HandlerBase@92] - [persistent://items/global/items/items-partition-7] [pulsar.repl.us-west] Could not get connection to broker: com.yahoo.pulsar.client.api.PulsarClientException: HTTP get request failed: Request failed. -- Will try again in 0.235 s\r\n2016-11-16 17:34:38,595 - INFO  - [pulsar-timer-46-1:HandlerBase@96] - [persistent://items/global/items/items-partition-7] [pulsar.repl.us-west] Reconnecting after connection was closed\r\n2016-11-16 17:34:38,597 - WARN  - [pulsar-io-39-3:HttpClient@140] - [http://internal-pulsar-brokers-1007547935.us-east-1.elb.amazonaws.com/lookup/v2/destination/persistent/items/global/items/items-partition-7] HTTP get request failed: Request failed.\r\n2016-11-16 17:34:38,598 - WARN  - [pulsar-io-39-3:HandlerBase@74] - [persistent://items/global/items/items-partition-7] [pulsar.repl.us-west] Error connecting to broker: com.yahoo.pulsar.client.api.PulsarClientException: HTTP get request failed: Request failed.\r\n2016-11-16 17:34:38,598 - WARN  - [pulsar-io-39-3:HandlerBase@92] - [persistent://items/global/items/items-partition-7] [pulsar.repl.us-west] Could not get connection to broker: com.yahoo.pulsar.client.api.PulsarClientException: HTTP get request failed: Request failed. -- Will try again in 0.431 s\r\n2016-11-16 17:34:39,030 - INFO  - [pulsar-timer-46-1:HandlerBase@96] - [persistent://items/global/items/items-partition-7] [pulsar.repl.us-west] Reconnecting after connection was closed\r\n2016-11-16 17:34:39,032 - WARN  - [pulsar-io-39-3:HttpClient@140] - [http://internal-pulsar-brokers-1007547935.us-east-1.elb.amazonaws.com/lookup/v2/destination/persistent/items/global/items/items-partition-7] HTTP get request failed: Request failed.\r\n2016-11-16 17:34:39,032 - WARN  - [pulsar-io-39-3:HandlerBase@74] - [persistent://items/global/items/items-partition-7] [pulsar.repl.us-west] Error connecting to broker: com.yahoo.pulsar.client.api.PulsarClientException: HTTP get request failed: Request failed.\r\n2016-11-16 17:34:39,032 - WARN  - [pulsar-io-39-3:HandlerBase@92] - [persistent://items/global/items/items-partition-7] [pulsar.repl.us-west] Could not get connection to broker: com.yahoo.pulsar.client.api.PulsarClientException: HTTP get request failed: Request failed. -- Will try again in 0.904 s\r\n2016-11-16 17:34:39,109 - ERROR - [pulsar-zk-session-watcher-10-1:ZooKeeperSessionWatcher@155] - timeout expired for reconnecting, invoking shutdown service\r\n2016-11-16 17:34:39,109 - INFO  - [pulsar-zk-session-watcher-10-1:ZooKeeper@684] - Session: 0x2586d8253880021 closed\r\n2016-11-16 17:34:39,109 - INFO  - [pulsar-zk-session-watcher-10-1:MessagingServiceShutdownHook@94] - Invoking Runtime.halt(-1)\r\n```\r\n\r\nDo you know what could be happening? We don't see any issue with Zookeepers and the other brokers continue working properly.\r\n\r\nEDIT: Broker load doesn't seem to affect this, a broker with 7% CPU usage just crashed with the same exceptions.", "url": "https://github.com/apache/pulsar/issues/114", "user": "sschepens", "labels": ["type/bug"], "created": "2016-11-16 19:57:46", "closed": "2016-11-16 23:21:45", "commits": {"4563540cf3d3481e3092c1099edd2b578ad87dc4": {"commitGHEventType": "referenced", "commitUser": "merlimat"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "4563540cf3d3481e3092c1099edd2b578ad87dc4", "commitGHEventType": "referenced", "commitUser": "merlimat", "commitParents": ["3c596d49ac48468de587fd6870d81987c52a6d0f"], "nameRev": "4563540cf3d3481e3092c1099edd2b578ad87dc4 tags/v1.16~39", "commitMessage": "[#114] Process ZK event from background thread to avoid deadlock on ZK sync operations (#115)\n\n", "commitDateTime": "2016-11-16 15:21:18", "authoredDateTime": "2016-11-16 15:21:18", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/com/yahoo/pulsar/broker/namespace/NamespaceService.java", "insertions": 30, "deletions": 29, "lines": 59}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NamespaceService.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.broker.namespace.NamespaceService.splitAndOwnBundle(com.yahoo.pulsar.common.naming.NamespaceBundle).2.processResult(int,java.lang.String,java.lang.Object,org.apache.zookeeper.data.Stat)", "TOT": 20, "UPD": 8, "INS": 0, "MOV": 3, "DEL": 9}, {"spoonMethodName": "com.yahoo.pulsar.broker.namespace.NamespaceService.splitAndOwnBundle(com.yahoo.pulsar.common.naming.NamespaceBundle)", "TOT": 8, "UPD": 0, "INS": 7, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Consumers blocked with 0 availablePermits", "body": "When a consumer with `ackTimeout` connects, it negotiates a given amount of permits with broker (say 1000), it then receives 1000 messages. At this point the consumer has 0 `availablePermits` and 1000 `unackedMessages`, If no one pulls these messages from this consumer, they are eventually redelivered to the broker, now the broker schedules redelivery of those messages, but never increments `availablePermits` for the consumer, leaving the consumer stuck with 0 `availablePermits`.\r\n\r\nThis happens at least with perMessageRedelivery, as a redelivery does not necessarily imply that permits have to be granted to the consumer. Unfortunately, I don't know if the Broker can really do something here. \r\n\r\nI believe this issue is a consequence of a consumer asking for redelivery of messages that have never been pulled from the queue.\r\n\r\nThe best approach seems to be for the consumer to ask for more permits when this is the case.\r\nWhat do you think?\r\n", "url": "https://github.com/apache/pulsar/issues/100", "user": "sschepens", "labels": ["type/bug"], "created": "2016-11-01 18:43:24", "closed": "2016-11-16 17:58:16", "commits": {}, "ttf": 14.000277777777777, "commitsDetails": []}, {"title": "SimpleDateFormat is not thread safe", "body": "- https://github.com/yahoo/pulsar/blob/1304d4b44d/pulsar-broker/src/main/java/com/yahoo/pulsar/broker/admin/PersistentTopics.java#L105\n- https://github.com/yahoo/pulsar/blob/1304d4b44d/pulsar-broker/src/main/java/com/yahoo/pulsar/broker/service/persistent/PersistentTopic.java#L121\n- https://github.com/yahoo/pulsar/blob/1304d4b44d/pulsar-client/src/main/java/com/yahoo/pulsar/client/impl/ProducerImpl.java#L1094\n- https://github.com/yahoo/pulsar/blob/1304d4b44d/pulsar-websocket/src/main/java/com/yahoo/pulsar/websocket/ConsumerHandler.java#L195\n", "url": "https://github.com/apache/pulsar/issues/62", "user": "xuwei-k", "labels": ["type/bug"], "created": "2016-10-14 01:00:17", "closed": "2016-10-14 17:15:48", "commits": {"050ecd11c48a15598f78f209d25f7ab31a8b4a4d": {"commitGHEventType": "referenced", "commitUser": "sboobna"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "050ecd11c48a15598f78f209d25f7ab31a8b4a4d", "commitGHEventType": "referenced", "commitUser": "sboobna", "commitParents": ["1304d4b44d74f62a76eab35f0a11060a87303448"], "nameRev": "050ecd11c48a15598f78f209d25f7ab31a8b4a4d tags/v1.15~11", "commitMessage": "Use threadsafe formatter (#64)\n\n* Use thread safe datetime formatter\r\n\r\nThis closes #62\r\n\r\n* Organize import lines\r\n", "commitDateTime": "2016-10-14 10:15:48", "authoredDateTime": "2016-10-15 02:15:48", "commitGitStats": [{"filePath": "pulsar-broker/src/main/java/com/yahoo/pulsar/broker/admin/PersistentTopics.java", "insertions": 19, "deletions": 19, "lines": 38}, {"filePath": "pulsar-broker/src/main/java/com/yahoo/pulsar/broker/service/Consumer.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "pulsar-broker/src/main/java/com/yahoo/pulsar/broker/service/Producer.java", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "pulsar-broker/src/main/java/com/yahoo/pulsar/broker/service/persistent/PersistentTopic.java", "insertions": 27, "deletions": 26, "lines": 53}, {"filePath": "pulsar-client/src/main/java/com/yahoo/pulsar/client/impl/ProducerImpl.java", "insertions": 7, "deletions": 6, "lines": 13}, {"filePath": "pulsar-websocket/src/main/java/com/yahoo/pulsar/websocket/ConsumerHandler.java", "insertions": 5, "deletions": 3, "lines": 8}], "commitSpoonAstDiffStats": [{"spoonFilePath": "PersistentTopics.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.broker.admin.PersistentTopics", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "com.yahoo.pulsar.broker.admin.PersistentTopics.peekNthMessage(java.lang.String,java.lang.String,java.lang.String,java.lang.String,java.lang.String,int,boolean)", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "Consumer.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.broker.service.Consumer", "TOT": 4, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "Producer.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.broker.service.Producer", "TOT": 4, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "PersistentTopic.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.broker.service.persistent.PersistentTopic", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "com.yahoo.pulsar.broker.service.persistent.PersistentTopic.getInternalStats()", "TOT": 9, "UPD": 0, "INS": 3, "MOV": 3, "DEL": 3}]}, {"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.client.impl.ProducerImpl", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "com.yahoo.pulsar.client.impl.ProducerImpl.connectionOpened(com.yahoo.pulsar.client.impl.ClientCnx)", "TOT": 4, "UPD": 1, "INS": 1, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "ConsumerHandler.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.websocket.ConsumerHandler", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "com.yahoo.pulsar.websocket.ConsumerHandler.receiveMessage()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Intermittent test failure on BacklogQuotaManagerTest.testAheadProducerOnHoldTimeout", "body": "Seen intermittently in travis builds. Unfortunately the exception stack trace is not being printed fully.\n\n```\ncom.yahoo.pulsar.client.admin.internal.BrokerStatsImpl$$EnhancerByMockitoWithCGLIB$$7141231b@443bf7aa\nTests run: 361, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 825.674 sec <<< FAILURE! - in TestSuite\ntestAheadProducerOnHoldTimeout(com.yahoo.pulsar.broker.service.BacklogQuotaManagerTest)  Time elapsed: 8.691 sec  <<< FAILURE!\nio.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1\n    at com.yahoo.pulsar.broker.service.BacklogQuotaManagerTest.testAheadProducerOnHoldTimeout(BacklogQuotaManagerTest.java:504)\n```\n", "url": "https://github.com/apache/pulsar/issues/33", "user": "merlimat", "labels": ["component/test", "type/bug"], "created": "2016-09-22 16:52:18", "closed": "2016-09-22 18:44:59", "commits": {"997d8f621d6e500939e8fa0f748210e9b05be364": {"commitGHEventType": "closed", "commitUser": "merlimat"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "997d8f621d6e500939e8fa0f748210e9b05be364", "commitGHEventType": "closed", "commitUser": "merlimat", "commitParents": ["7d317bd3c325ffcfea17fd92c88cfe9a5b52ece1"], "nameRev": "997d8f621d6e500939e8fa0f748210e9b05be364 tags/v1.15~34", "commitMessage": "Synchronized producer cleanup during close operation (#34)\n\nFixes #33: Intermittent test failure on BacklogQuotaManagerTest.testAheadProducerOnHoldTimeout", "commitDateTime": "2016-09-22 11:44:58", "authoredDateTime": "2016-09-22 11:44:58", "commitGitStats": [{"filePath": "pulsar-client/src/main/java/com/yahoo/pulsar/client/impl/ProducerImpl.java", "insertions": 14, "deletions": 6, "lines": 20}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ProducerImpl.java", "spoonMethods": [{"spoonMethodName": "com.yahoo.pulsar.client.impl.ProducerImpl.closeAsync()", "TOT": 8, "UPD": 0, "INS": 2, "MOV": 6, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "\u4e0b\u8f7d1.14-release\u7248\u672c\u542f\u52a8\u62a5\u9519", "body": "Exception in thread \"main\" java.lang.NoClassDefFoundError: Could not initialize class io.netty.channel.epoll.IovArray\n    at io.netty.channel.epoll.EpollEventLoop.<init>(EpollEventLoop.java:62)\n    at io.netty.channel.epoll.EpollEventLoopGroup.newChild(EpollEventLoopGroup.java:114)\n    at io.netty.util.concurrent.MultithreadEventExecutorGroup.<init>(MultithreadEventExecutorGroup.java:64)\n    at io.netty.channel.MultithreadEventLoopGroup.<init>(MultithreadEventLoopGroup.java:49)\n    at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:93)\n    at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:80)\n    at io.netty.channel.epoll.EpollEventLoopGroup.<init>(EpollEventLoopGroup.java:61)\n    at org.apache.bookkeeper.client.BookKeeper.getDefaultEventLoopGroup(BookKeeper.java:936)\n    at org.apache.bookkeeper.client.BookKeeper.<init>(BookKeeper.java:243)\n    at com.yahoo.pulsar.broker.BookKeeperClientFactoryImpl.create(BookKeeperClientFactoryImpl.java:79)\n    at com.yahoo.pulsar.broker.ManagedLedgerClientFactory.<init>(ManagedLedgerClientFactory.java:38)\n    at com.yahoo.pulsar.broker.PulsarService.start(PulsarService.java:231)\n    at com.yahoo.pulsar.PulsarStandaloneStarter.start(PulsarStandaloneStarter.java:143)\n    at com.yahoo.pulsar.PulsarStandaloneStarter.main(PulsarStandaloneStarter.java:175)\n", "url": "https://github.com/apache/pulsar/issues/29", "user": "weishengshui", "labels": ["type/bug"], "created": "2016-09-21 10:07:28", "closed": "2016-09-27 20:02:36", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}]}