{"projectName": "eXist-db/exist", "bugLabels": ["bug", "regression"], "captureTime": "Sun Jul  5 13:13:38 2020", "issues": [{"title": "[BUG] missing location from error messages", "body": "**Describe the bug**\r\n\r\nI have discovered two more cases in which eXist fails to include the location of errors in queries.\r\n\r\n**Expected behavior**\r\n\r\nWhen reporting errors, eXist should always report the line number and position (or column and row) of errors.\r\n\r\nSee also https://github.com/eXist-db/exist/issues/3450.\r\n\r\n**To Reproduce**\r\n\r\nThe error messages raised by the conditions in the conditional expressions below fail to include the location of the error.\r\n\r\n```xquery\r\nmap {\r\n    \"foo\": [\"bar\", \"baz\"]\r\n}[?foo eq \"bar\"]\r\n```\r\n\r\neXist's error lacks location info:\r\n\r\n> err:XPTY0004 Expected single atomic value but found array with length 2\r\n\r\nBaseX returns the location:\r\n\r\n> Stopped at /Users/joe/workspace/XQuery-for-Humanists/Test/file, 3/16:\r\n> [XPTY0004] Item expected, sequence found: (\"bar\", \"baz\").\r\n\r\nSaxon returns the location at line 3 column 4:\r\n\r\n> A sequence of more than one item is not allowed as the first operand of 'eq' ([\"bar\", \"baz\", ])\r\n\r\nSimilarly:\r\n\r\n```xquery\r\nmap {\r\n    \"foo\": \r\n        map { \r\n            \"bar\": \"baz\"\r\n        }\r\n}[?foo eq \"bar\"]\r\n```\r\n\r\neXist's error lacks location info:\r\n\r\n> err:FOTY0013 A function item other than an array cannot be atomized\r\n\r\nBaseX returns:\r\n\r\n> Stopped at /Users/joe/workspace/XQuery-for-Humanists/Test/file, 6/16:\r\n> [FOTY0013] Items of type map(xs:string, xs:string?) cannot be atomized.\r\n\r\nSaxon returns an error at line 6 column 4:\r\n\r\n> An atomic value is required for the first operand of 'eq', but the supplied type is a map type, which cannot be atomized\r\n\r\neXist should be able to report column and line numbers of errors.\r\n\r\n**Context (please always complete the following information):**\r\n - OS: macOS 10.13.6\r\n - eXist-db version: 5.3.0-SNAPSHOT\r\n - Java Version: JDK 11.0.7+10 (Liberica 2020-04-14 LTS)\r\n\r\n**Additional context**\r\n- How is eXist-db installed? 5.3.0-SNAPSHOT built from source \r\n- Any custom changes in e.g. `conf.xml`? None.\r\n", "url": "https://github.com/eXist-db/exist/issues/3462", "user": "joewiz", "labels": ["bug"], "created": "2020-06-24 03:08:09", "closed": "2020-06-29 14:00:37", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "[BUG] missing location from error messages", "body": "**Describe the bug**\r\n\r\nI have discovered several cases in which eXist fails to include the location of errors in queries.\r\n\r\n**Expected behavior**\r\n\r\nWhen reporting errors, eXist should always report the line number and position (or column and row) of errors.\r\n\r\nFor a clue about what might be needed to fix this, see several similar fixes: https://github.com/eXist-db/exist/search?q=error+location&unscoped_q=error+location&type=Commits.\r\n\r\n**To Reproduce**\r\n\r\nThe error messages raised by the conditions in the conditional expressions below fail to include the location of the error.\r\n\r\n```xquery\r\nif (map { \"foo\": \"bar\" } eq 1) then \"yay\" else \"boo\"\r\n```\r\n\r\nThe error raised:\r\n\r\n> err:FOTY0013 A function item other than an array cannot be atomized\r\n\r\nSimilarly:\r\n\r\n```xquery\r\nif (\"a\" eq 1) then \"yay\" else \"boo\"\r\n```\r\n\r\nThe error raised: \r\n\r\n> err:XPTY0004 can not compare xs:string('a') with xs:integer('1')\r\n\r\nI would expect the error message to include the location of the error\u2014the condition.\r\n\r\nSaxon reports the error at line 3 column 6 (one character to the right of the open parens of the condition). BaseX reports the error at line 3 column 30 (or 13 in the 2nd query)\u2014(the close parens of the condition). eXist should be able to report column and line numbers of errors like this and others that it raises.\r\n\r\n**Context (please always complete the following information):**\r\n - OS: macOS 10.15.5\r\n - eXist-db version: 5.2.0, 5.3.0-SNAPSHOT\r\n - Java Version: JDK 1.8.0_252 (Zulu 8.46.0.19-CA-macosx) (build 1.8.0_252-b14)\r\n\r\n**Additional context**\r\n- How is eXist-db installed? 5.2.0 via DMG installer, 5.3.0-SNAPSHOT built from source \r\n- Any custom changes in e.g. `conf.xml`? None.\r\n", "url": "https://github.com/eXist-db/exist/issues/3450", "user": "joewiz", "labels": ["bug"], "created": "2020-06-16 23:27:55", "closed": "2020-06-18 13:20:40", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "[BUG] util:registered-functions throws XPathException with certain modules", "body": "**Describe the bug**\r\n\r\nFor 3 eXist extension modules, `util:registered-functions` throws an XPathException error.\r\n\r\nExample error:\r\n\r\n> No module found matching namespace URI: `http://exist-db.org/xquery/memsort`\r\n\r\nAffected modules:\r\n\r\n- `http://exist-db.org/xquery/console `\r\n- `http://exist-db.org/xquery/memsort `\r\n- `http://expath.org/ns/crypto `\r\n\r\n**Expected behavior**\r\n\r\nThis function should not raise an error when provided with a valid extension module namespace URI.\r\n\r\n**To Reproduce**\r\n\r\nThe following query shows which modules produce the error.\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nfor $namespace-uri in util:registered-modules()\r\nreturn\r\n    try { \r\n        let $functions := util:registered-functions($namespace-uri) \r\n        return\r\n            ()\r\n    } catch * { \r\n        <error>{$err:code} raised when getting registered functions for module {$namespace-uri}</error>\r\n    }\r\n```\r\n\r\n**Context (please always complete the following information):**\r\n - OS: macOS 10.13.6\r\n - eXist-db version: 5.2.0, 5.3.0-SNAPSHOT\r\n - Java Version: 1.8.0_242 (Zulu 8.44.0.11-CA-macosx) (build 1.8.0_242-b20)\r\n\r\n**Additional context**\r\n- How is eXist-db installed? DMG, source\r\n- Any custom changes in e.g. `conf.xml`? no\r\n", "url": "https://github.com/eXist-db/exist/issues/3425", "user": "joewiz", "labels": ["bug"], "created": "2020-05-21 21:22:51", "closed": "2020-05-23 14:39:18", "commits": {"0b42bb40e9a16a4d4fc72b302d8bcae1bff4e6d6": {"commitGHEventType": "referenced", "commitUser": "dizzzz"}, "571abeec507042e430887c142ab30cb32d34606c": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "0b42bb40e9a16a4d4fc72b302d8bcae1bff4e6d6", "commitGHEventType": "referenced", "commitUser": "dizzzz", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "571abeec507042e430887c142ab30cb32d34606c", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["b2ded0385afd8428a669a8d4e6f1d82456946d34", "d3544e40a459f229c92e21dafd024a8551d4e83a"], "nameRev": "571abeec507042e430887c142ab30cb32d34606c remotes/origin/adamretter-patch-3~11", "commitMessage": "Merge pull request #3430 from dizzzz/hotfix/add_missing_functions\n\nAdd java modules to list functions. Fixes #3425", "commitDateTime": "2020-05-23 16:39:17", "authoredDateTime": "2020-05-23 16:39:17", "commitGitStats": [{"filePath": "exist-core/src/main/java/org/exist/xquery/functions/util/BuiltinFunctions.java", "insertions": 108, "deletions": 93, "lines": 201}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BuiltinFunctions.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.functions.util.BuiltinFunctions", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.util.BuiltinFunctions.eval(org.exist.xquery.functions.util.Sequence[],org.exist.xquery.functions.util.Sequence)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.util.BuiltinFunctions.addFunctionsFromModule(org.exist.xquery.functions.util.ValueSequence,org.exist.xquery.Module)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.util.BuiltinFunctions.addFunctionRefsFromModule(org.exist.xquery.functions.util.ValueSequence,org.exist.xquery.Module)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.util.BuiltinFunctions.addFunctionRefsFromContext(org.exist.xquery.functions.util.ValueSequence)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.util.BuiltinFunctions.addVariablesFromModule(org.exist.xquery.functions.util.ValueSequence,org.exist.xquery.Module)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0.0, "deletions": 0.0, "lines": 0.0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0.0, "UPD": 0.0, "INS": 0.0, "MOV": 0.0, "DEL": 0.0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[BUG] util:registered-functions returns QNames with null namespace prefixes", "body": "**Describe the bug**\r\n\r\nFor a small number of eXist extension functions, `util:registered-functions` returns results with a null namespace prefix. \r\n\r\nThis causes incorrect the namespace prefix for affected functions to be omitted in eXist's function documentation, and prevents IDEs such as oXygen from accessing the affected functions when users request function autocompletion/documentation based on a function's prefix. (See screenshots below.)\r\n\r\nAffected functions:\r\n\r\n- `http://exist-db.org/xquery/xmldb`\r\n  - copy-collection\r\n  - copy-resource\r\n- `http://exist-db.org/xquery/inspection`\r\n  - inspect-function\r\n  - inspect-module\r\n  - inspect-module-uri\r\n- `http://exist-db.org/xquery/system`\r\n  - restore\r\n- `http://exist-db.org/xquery/sql`\r\n  - execute\r\n- `http://exist-db.org/xquery/util`\r\n  - absolute-resource-id\r\n  - binary-doc\r\n  - binary-doc-available\r\n  - binary-doc-content-digest\r\n  - document-id\r\n  - document-name\r\n  - eval\r\n  - eval-and-serialize\r\n  - eval-inline\r\n  - eval-with-context\r\n  - get-resource-by-absolute-id\r\n  - is-binary-doc\r\n  - qname-index-lookup\r\n- `http://exist-db.org/xquery/compression`\r\n  - deflate\r\n  - gzip\r\n  - inflate\r\n  - tar\r\n  - ungzip\r\n  - zip\r\n\r\n**Expected behavior**\r\n\r\nEvery function returned by `util:registered-functions` should have the namespace prefix of its parent module\u2014and should never return a null namespace prefix.\r\n\r\n**To Reproduce**\r\n\r\nThe query below lists which functions are affected.\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nfor $namespace-uri in util:registered-modules()\r\nlet $functions := try { util:registered-functions($namespace-uri) } catch * { <error>{$err:code} raised when getting registered functions for module {$namespace-uri}</error> }\r\nreturn\r\n    if ($functions instance of element(error)) then\r\n        ()\r\n    else\r\n        let $prefix-analysis := \r\n            for $function in $functions\r\n            group by $prefix := fn:prefix-from-QName($function)\r\n            return\r\n                map { \r\n                    \"prefix\": $prefix,\r\n                    \"functions\": \r\n                        array { $function ! fn:local-name-from-QName(.) }\r\n                }\r\n        where count($prefix-analysis) gt 1\r\n        order by $namespace-uri\r\n        return\r\n            map { \r\n                \"module\": $namespace-uri,\r\n                \"prefix-analysis\": array { $prefix-analysis }\r\n            }\r\n```\r\n\r\nNote, too, that running `inspect:inspect-functions` on the same modules returns results with a similar discrepancy - `base64-encode` has a prefix, whereas `binary-doc` lacks one:\r\n\r\n```xml\r\n<function name=\"util:base64-encode\" module=\"http://exist-db.org/xquery/util\"/>\r\n<function name=\"binary-doc\" module=\"http://exist-db.org/xquery/util\"/>\r\n```\r\n\r\n**Screenshots**\r\n\r\noXygen's function documentation omits util:binary-doc:\r\n\r\n> ![Screenshot 2020-05-14 at 08 57 22](https://user-images.githubusercontent.com/59118/82607390-aedf1580-9b86-11ea-8f1e-9c3ecbbfbaf0.png)\r\n\r\neXist's function documentation omits the prefix for util:binary-doc:\r\n\r\n> ![Screen Shot 2020-05-14 at 11 30 30 AM](https://user-images.githubusercontent.com/59118/82607430-c1f1e580-9b86-11ea-9127-615d46a7e684.png)\r\n\r\n**Context (please always complete the following information):**\r\n - OS: macOS 10.13.6\r\n - eXist-db version: 5.2.0, 5.3.0-SNAPSHOT\r\n - Java Version: 1.8.0_242 (Zulu 8.44.0.11-CA-macosx) (build 1.8.0_242-b20)\r\n\r\n**Additional context**\r\n- How is eXist-db installed? DMG, source\r\n- Any custom changes in e.g. `conf.xml`? no\r\n", "url": "https://github.com/eXist-db/exist/issues/3424", "user": "joewiz", "labels": ["bug"], "created": "2020-05-21 21:22:00", "closed": "2020-05-22 21:04:59", "commits": {"b2ded0385afd8428a669a8d4e6f1d82456946d34": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "b2ded0385afd8428a669a8d4e6f1d82456946d34", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["09c8df4834bef44f1ac0cd3b00cac9ae8a6e389c", "63b730b5288776240e5b982b542af73251392c77"], "nameRev": "b2ded0385afd8428a669a8d4e6f1d82456946d34 remotes/origin/adamretter-patch-3~12", "commitMessage": "Merge pull request #3428 from dizzzz/hotfix/fix_missing_module_prefix\n\nRepair module prefixes. Fixes #3424", "commitDateTime": "2020-05-22 23:04:58", "authoredDateTime": "2020-05-22 23:04:58", "commitGitStats": [{"filePath": "exist-core/src/main/java/org/exist/xquery/functions/inspect/InspectionModule.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "exist-core/src/main/java/org/exist/xquery/functions/system/SystemModule.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "exist-core/src/main/java/org/exist/xquery/functions/util/UtilModule.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "exist-core/src/main/java/org/exist/xquery/functions/xmldb/XMLDBModule.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "exist-core/src/test/xquery/inspect/inspect.xql", "insertions": 15, "deletions": 0, "lines": 15}, {"filePath": "extensions/modules/cache/src/main/java/org/exist/xquery/modules/cache/CacheModule.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "extensions/modules/compression/src/main/java/org/exist/xquery/modules/compression/CompressionModule.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "extensions/modules/sql/src/main/java/org/exist/xquery/modules/sql/SQLUtils.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "InspectionModule.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.functions.inspect.InspectionModule.functionSignature(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.inspect.InspectionModule.functionSignatures(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[][])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SystemModule.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.functions.system.SystemModule.functionSignature(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.system.SystemModule.functionSignatures(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[][])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "UtilModule.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.functions.util.UtilModule.functionSignature(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.util.UtilModule.functionSignatures(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[][])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "XMLDBModule.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.functions.xmldb.XMLDBModule.functionSignature(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.xmldb.XMLDBModule.functionSignatures(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[][])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CacheModule.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.modules.cache.CacheModule.functionSignature(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.modules.cache.CacheModule.functionSignatures(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[][])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "CompressionModule.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.modules.compression.CompressionModule.functionSignature(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.modules.compression.CompressionModule.functionSignatures(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[][])", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "SQLUtils.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.modules.sql.SQLUtils.functionSignatures(java.lang.String,java.lang.String,org.exist.xquery.value.FunctionReturnSequenceType,org.exist.xquery.value.FunctionParameterSequenceType[][])", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "[BUG] Java exception when passing a function with wrong arity to higher-order functions", "body": "**Describe the bug**\r\n\r\nPassing a function with a wrong arity (not one) as the second parameter to a higher order function such as `fn:for-each` or `fn:filter` will throw a java exception.\r\n\r\n```\r\nERROR (XQueryServlet.java [process]:559) - null\r\njava.lang.ArrayIndexOutOfBoundsException: null\r\n```\r\n\r\n`fold-left` and `fold-right` not tested yet but are likely also affected, judging from the implementation.\r\n\r\n\r\n**Expected behavior**\r\n\r\nXQuery exception XPTY0004 - (argument) type mismatch\r\n\r\nSaxon 10 HE returns `XPTY0004  The supplied function (function($m, $n){ $m }) has 2 arguments - expected 1`\r\n\r\n**To Reproduce**\r\n\r\n```Xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace t=\"http://exist-db.org/xquery/test\";\r\n\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare\r\n    %test:assertError(\"XPTY0004\")\r\nfunction t:for-each-arity-0() {\r\n    for-each(1, function () { 1 })\r\n};\r\n\r\ndeclare\r\n    %test:assertError(\"XPTY0004\")\r\nfunction t:for-each-arity-2() {\r\n    for-each(1, function ($a, $b) { 1 })\r\n};\r\n\r\ndeclare\r\n    %test:assertError(\"XPTY0004\")\r\nfunction t:filter-arity-0() {\r\n    filter(1, function () { 1 })\r\n};\r\n\r\ndeclare\r\n    %test:assertError(\"XPTY0004\")\r\nfunction t:filter-arity-2() {\r\n    filter(1, function ($a, $b) { 1 })\r\n};\r\n\r\n```\r\n\r\n**Context (please always complete the following information):**\r\n - OS: 10.15.4\r\n - eXist-db version: 5.3.0-SNAPSHOT 22b3c2776b8ef30b55a192b7e33448a05565d4cf\r\n - Java Version 1.8.0_152 64-Bit\r\n\r\n**Additional context**\r\n- How is eXist-db installed? built from source\r\n- Any custom changes in e.g. `conf.xml`? none\r\n", "url": "https://github.com/eXist-db/exist/issues/3358", "user": "line-o", "labels": ["bug", "xquery"], "created": "2020-04-10 21:48:43", "closed": "2020-05-10 08:02:31", "commits": {}, "ttf": 29.00027777777778, "commitsDetails": []}, {"title": "[BUG] format-number throws IndexOutofBoundsException", "body": "**Describe the bug**\r\n\r\nCalling format-number with a certain picture string throws an java.lang.IndexOutOfBoundsException\r\n\r\n`format-number($i, \"#.###,##\")`\r\n\r\n**Expected behavior**\r\n\r\nEither the appropriate XQuery-error is thrown or the number to be formatted according to the picture string.\r\n\r\n**To Reproduce**\r\n\r\n```Xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace fd=\"http://exist-db.org/xquery/test/format-numbers\";\r\n\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare\r\n    %test:args(\"12345.6\")\r\n    %test:args(\"#.###,##\")\r\n    %test:assertEquals(\"12.345,6\")\r\nfunction fd:simple-number-1($number as numeric, $picture) {\r\n    format-number($number, $picture)\r\n};\r\n```\r\n\r\n**Context (please always complete the following information):**\r\n - OS: macOS 10.15.4\r\n - eXist-db version: 5.3.0-SNAPSHOT\r\n - Java Version Java 1.8.0_152\r\n\r\n**Additional context**\r\n- How is eXist-db installed? built from commit: 093c4c0726e02868acadbce9583ec5809f462b33\r\n- Any custom changes in e.g. `conf.xml`? no\r\n\r\n**Stack Trace**\r\n\r\n```\r\n2020-04-08 14:54:48,995 [qtp1126112943-134] ERROR (XQueryServlet.java [process]:559) - null\r\njava.lang.IndexOutOfBoundsException: null\r\n\tat org.exist.util.CodePointString.insert(CodePointString.java:293) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.functions.fn.FnFormatNumbers.format(FnFormatNumbers.java:633) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.functions.fn.FnFormatNumbers.eval(FnFormatNumbers.java:109) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.BasicFunction.eval(BasicFunction.java:74) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:41) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.ForExpr.processItem(ForExpr.java:251) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.ForExpr.eval(ForExpr.java:189) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:280) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:261) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:185) ~[exist-core-5.3.0-SNAPSHOT.jar:5.3.0-SNAPSHOT]\r\n...\r\n```", "url": "https://github.com/eXist-db/exist/issues/3346", "user": "line-o", "labels": ["bug", "xquery"], "created": "2020-04-08 13:09:34", "closed": "2020-04-10 19:52:12", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "[BUG] util:get-resource-by-absolute-id does not work", "body": "**Describe the bug**\r\n\r\n`util:get-resource-by-absolute-id` does return an empty sequence when given a valid absolute resource id.\r\n\r\n**Expected behavior**\r\n\r\n```xquery\r\nutil:get-resource-by-absolute-id(\r\n    util:absolute-resource-id('/db/some/file'))\r\n```\r\n\r\nto return '/db/some/file' when this file exists in the database.\r\n\r\n**To Reproduce**\r\n\r\n```Xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace abs=\"http://exist-db.org/xquery/absolute-resource-id\";\r\n\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare variable $abs:XML := document { <root/> };\r\n\r\ndeclare\r\n    %test:setUp\r\nfunction abs:setup() {\r\n    let $testCol := xmldb:create-collection(\"/db\", \"test\")\r\n    return xmldb:store(\"/db/test\", \"test.xml\", $abs:XML)\r\n};\r\n\r\ndeclare\r\n    %test:tearDown\r\nfunction abs:tearDown() {\r\n    xmldb:remove(\"/db/test\")\r\n};\r\n\r\ndeclare\r\n    %test:assertEquals('/db/test/test.xml')\r\nfunction abs:test() {\r\n    util:get-resource-by-absolute-id(\r\n        util:absolute-resource-id('/db/test/test.xml'))\r\n};\r\n```\r\n\r\n**Context (please always complete the following information):**\r\n - OS: OSX 10.15.4\r\n - eXist-db version: 5.3.0-SNAPSHOT 093c4c0726e02868acadbce9583ec5809f462b33\r\n - Java Version 1.8.0_152-b16\r\n\r\n**Additional context**\r\n- How is eXist-db installed? built from source \r\n- Any custom changes in e.g. `conf.xml`? none\r\n", "url": "https://github.com/eXist-db/exist/issues/3337", "user": "line-o", "labels": ["bug", "xquery"], "created": "2020-03-30 20:34:59", "closed": "2020-04-10 19:40:09", "commits": {}, "ttf": 10.000277777777777, "commitsDetails": []}, {"title": "[BUG] \"Unknown type: xs:numeric\" error", "body": "**Describe the bug**\r\n\r\nIn eXist 5.3.0-SNAPSHOT (develop HEAD), certain expressions related to the `xs:numeric` type produce the error:\r\n\r\n> exerr:ERROR Unknown type: xs:numeric\r\n\r\n**Expected behavior**\r\n\r\nThis type should be known to eXist.\r\n\r\n**To Reproduce**\r\n\r\nThe following code produces the error:\r\n\r\n```xquery\r\n1 cast as xs:numeric\r\n```\r\n\r\nHere is a corresponding XQSuite test:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace it = \"http://exist-db.org/xquery/test/integer-tests\";\r\n\r\ndeclare namespace test = \"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare\r\n    %test:args(\"1\")\r\n    %test:assertEquals(1)\r\nfunction it:string-cast-as-numeric($string as xs:integer) as xs:numeric {\r\n    $string cast as xs:numeric\r\n};\r\n```\r\n\r\nRunning this test in eXist 5.2.0 succeeds; the expression `1 cast as xs:numeric` also returns the expected `xs:numeric(1)` in BaseX and Saxon. But in eXist 5.3.0-SNAPSHOT, this test returns:\r\n\r\n```xml\r\n<testsuites>\r\n    <testsuite package=\"http://exist-db.org/xquery/test/integer-tests\"\r\n        timestamp=\"2020-03-25T23:42:28.916-04:00\" tests=\"1\" failures=\"0\"\r\n        errors=\"1\" pending=\"0\" time=\"PT0.229S\">\r\n        <testcase name=\"string-cast-as-numeric\"\r\n            class=\"it:string-cast-as-numeric\">\r\n            <error type=\"java:org.exist.xquery.XPathException\"\r\n                message=\"exerr:ERROR Unknown type: xs:numeric [at line 10, column 35]...\"/>\r\n        </testcase>\r\n    </testsuite>\r\n</testsuites>\r\n```\r\n\r\nAs discussed with @adamretter in Slack, there may be some relation between this issue and https://github.com/eXist-db/exist/pull/3266.\r\n\r\nThe problem was first observed when running the tests included as part of the documentation app's build script, tests which effectively weren't running between Feb 4 and Mar 23. To reproduce the error, clone and build the documentation app using these steps:\r\n\r\n```bash\r\ngit clone https://github.com/eXist-db/documentation.git\r\ncd documentation\r\nmvn clean package\r\n```\r\n\r\nDuring the maven operation, the error is raised. Here's the portion of the console output from that build process where the error appears:\r\n\r\n```text\r\n[INFO]   running XQsuite test \u2026\r\n[INFO]         3 xqsuite tests:\r\n[INFO]           [ 'section-headings',\r\n[INFO]             'exerr:ERROR Unknown type: xs:numeric [at line 53, column 27, source: /db/apps/doc/modules/config.xqm]\\nIn function:\\n\\ttests:missing-id() [18:1:/db/apps/doc/modules/test-suite.xql]\\n\\ttest:apply(function(*), item()*) [560:9:jar:file:/exist/lib/exist.uber.jar!/org/exist/xquery/lib/xqsuite/xqsuite.xql]\\n\\ttest:apply(function(*), element(), item()*) [467:9:jar:file:/exist/lib/exist.uber.jar!/org/exist/xquery/lib/xqsuite/xqsuite.xql]\\n\\ttest:call-test(function(*), element(), element()*) [279:32:jar:file:/exist/lib/exist.uber.jar!/org/exist/xquery/lib/xqsuite/xqsuite.xql]. Unknown type: xs:numeric' ]\r\n[INFO] npm ERR! Test failed.  See above for more details.\r\n```\r\n\r\nStrangely, in the relevant code\u2014`doc/modules/config.xqm`, `doc/modules/test-suite.xql`, and eXist's `xqsuite.xql` module\u2014there is no direct invocation of the `xs:numeric` type.\r\n\r\n\r\n**Context (please always complete the following information):**\r\n - OS: macOS 10.13.6\r\n - eXist-db version: 5.3.0-SNAPSHOT (develop 5d59f738b1e180c035a5605c02e2bdcb1cf6dfe5)\r\n - Java Version: OpenJDK Runtime Environment (Zulu 8.44.0.11-CA-macosx) (build 1.8.0_242-b20)\r\n\r\n**Additional context**\r\n- How is eXist-db installed?\r\n    ```bash\r\n    docker pull existdb/existdb:latest\r\n    docker run -dit -p 8080:8080 --name docs --rm existdb/existdb:latest\r\n    ```\r\n- Any custom changes in e.g. `conf.xml`? No\r\n", "url": "https://github.com/eXist-db/exist/issues/3323", "user": "joewiz", "labels": ["bug", "regression"], "created": "2020-03-26 03:54:47", "closed": "2020-03-27 07:24:57", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "[BUG] rename and  move collection error", "body": "> new collection  then  delete  ,as shown below. \r\n,user  admin  \uff0ci uninstall old version existdb\uff0cinstall 5.2.0\r\n\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n![image](https://user-images.githubusercontent.com/28621460/76921892-1324f500-690a-11ea-8a39-0860aa9a304f.png)\r\n\r\n\r\n**Context (please always complete the following information):**\r\n - OS: [e.g. windows10]\r\n - eXist-db version: [e.g. 5.2.0]\r\n - Java Version \"1.8.0_171\"\r\n\r\n**Additional context**\r\n- How is eXist-db installed? [e.g. JAR installer ]\r\n- Any custom changes in e.g. `conf.xml`?\r\n No  \r\n", "url": "https://github.com/eXist-db/exist/issues/3310", "user": "SnowMakerDemo", "labels": ["bug"], "created": "2020-03-18 03:20:35", "closed": "2020-03-23 12:58:54", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "[BUG] Java memory settings for Windows service with eXist 5.x", "body": "I have eXist 5.2.0 running as a service on Windows 2012 R2. Since upgrading to eXist 5.x I have observed that eXist would not use more than about 4 Gb of RAM regardless of the setting in the Launcher System Configuration panel for Max Memory or settings in /etc/launcher.properties. This might be a bug or at least an update that needs to be made in the System Configuration form. \r\n\r\nThe expected behavior is that the Java Memory Min and Max limits that are configured in the Launcher System Configuration panel would be used for running eXist-db as a Windows service. Memory usage observed in Monex should reflect the configuration.\r\n\r\nAfter reading through [Procrun documentation ](https://commons.apache.org/proper/commons-daemon/procrun.html) I finally found a solution/workaround:\r\n\r\n1. Stop the eXist-db service\r\n2. Run `regedit.exe`\r\n3. Navigate to `HKEY_LOCAL_MACHINE\\SOFTWARE\\Wow6432Node\\Apache Software Foundation\\Procrun 2.0\\eXist-db\\Parameters\\Java`\r\n4. Next to the key JvmMs, right click and add a new DWORD key.\r\n5. Give the new key a name `JvmMx`\r\n6. Give the new key a decimal value that is a number of megabytes of memory to allow Java to utilize. For example, to set the memory limit to 12 Gb on a machine with 16 Gb total memory enter the value in Mb as 12288.\r\n7. Start the eXist-db service\r\n\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/3253", "user": "vincentml", "labels": ["bug"], "created": "2020-02-28 23:27:00", "closed": "2020-03-10 13:07:34", "commits": {}, "ttf": 10.000277777777777, "commitsDetails": []}, {"title": "Hangup in getting permissions in an AVT?", "body": "I run the following XQuery script (I minimized it as much as possible). eXist eats my CPU up to 100%. I have to force shutdown the database.\r\n\r\n```xquery\r\nxquery version \"3.1\" encoding \"UTF-8\";\r\n\r\ndeclare option exist:serialize \"method=xml media-type=text/xml indent=yes\";\r\n\r\n<TEST>\r\n{\r\n  let $path as xs:string :='/db/TEST' \r\n  return\r\n    <result>\r\n      <collection name=\"{$path}\" created=\"{xmldb:created($path)}\" \r\n        owner-name=\"{sm:get-permissions(xs:anyURI($path))/sm:permission/@owner}\"/>\r\n    </result>       \r\n}    \r\n</TEST>\r\n```\r\n\r\nThe cause is in the AVT for the `owner-name` attribute. But when I put that expression outside an AVT it simply works.\r\n\r\n**Expected behavior**\r\nThe requested owner name in the attribute. Or: some error message about what I did wrong. But not a hangup\r\n\r\n**To Reproduce**\r\nCreate a `/db/TEST` collection. Run the script above as admin.\r\n\r\n**Context (please always complete the following information):**\r\n - OS: Windows 10\r\n - eXist-db version: 5.2.0\r\n - Java Version 1.8.0_202-b08\r\n\r\n**Additional context**\r\n- How is eXist-db installed? jar\r\n- Any custom changes in e.g. `conf.xml`? no\r\n", "url": "https://github.com/eXist-db/exist/issues/3231", "user": "xatapult", "labels": ["bug"], "created": "2020-01-28 09:35:30", "closed": "2020-03-03 11:26:33", "commits": {}, "ttf": 35.000277777777775, "commitsDetails": []}, {"title": "[BUG] CI skips deploy step on tag builds", "body": "**Describe the bug**\r\nthe deploy step for the docker images is not doing its job on travis: If should have fired here [CI-log](https://travis-ci.com/eXist-db/exist/jobs/279263275#L3400) but it didn't. \r\n\r\n**Expected behavior**\r\nA tagged `:release` should have been pushed from travis the `:5.2.0` came from `adam's local build. This is a regression, we need to adjust the travis config / settings\r\n\r\n**Screenshots**\r\n![Screenshot 2020-01-23 at 16 33 31](https://user-images.githubusercontent.com/6205362/73003203-84ae5e80-3e05-11ea-905d-bb4d968655c8.png)\r\n\r\n**Context:**\r\n - GitHub\r\n\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/3224", "user": "duncdrum", "labels": ["bug", "docker"], "created": "2020-01-23 16:29:21", "closed": "2020-01-24 17:20:12", "commits": {"8be0cc5869a74a483f35cc232b34374beff7ac66": {"commitGHEventType": "referenced", "commitUser": "duncdrum"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "8be0cc5869a74a483f35cc232b34374beff7ac66", "commitGHEventType": "referenced", "commitUser": "duncdrum", "commitParents": ["9e0b938bce6c46bf90b580dabd132faecdea85de"], "nameRev": "8be0cc5869a74a483f35cc232b34374beff7ac66 remotes/origin/dependabot/maven/net.sf.saxon-Saxon-HE-10.1~119^2", "commitMessage": "fix(travis): deploy on tagged builds\n\nclose #3224", "commitDateTime": "2020-01-24 11:46:30", "authoredDateTime": "2020-01-24 11:46:30", "commitGitStats": [{"filePath": ".travis.yml", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["8be0cc5869a74a483f35cc232b34374beff7ac66"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 1, "deletions": 1, "lines": 2, "gitFilesChange": 1}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": [".travis.yml"]}, {"title": "unparsed-text() for user guest seems to think it must read from the file system", "body": "My XQuery script performs a call to `unparsed-text()` and asks for a file *in* the database that has world read permissions. E.g. \r\n\r\n```\r\nunparsed-text('/db/apps/eXide/build.js')\r\n```\r\n\r\nWhat I get is: `err:FOUT1170 non-dba user not allowed to read from file system`\r\n\r\n(Anyway, why is the error code something with FOUT, the Dutch word for error...)\r\n\r\n**Expected behavior**\r\nThe unparsed text of the requested file \r\n\r\n**To Reproduce**\r\n* run eXide as guest user. \r\n* Enter ` unparsed-text('/db/apps/eXide/build.js')`  as XQuery script\r\n* Run it: error\r\n* Login as amin\r\n* Run it again: Ok\r\n\r\n\r\n**Context (please always complete the following information):**\r\n - OS: WIndows 10\r\n - eXist-db version: 5.1.1 (latest version)\r\n - Java Version \"1.8.0_241\"\r\n\r\n**Additional context**\r\n- How is eXist-db installed? JAR installed\r\n- Any custom changes in e.g. `conf.xml`? No\r\n", "url": "https://github.com/eXist-db/exist/issues/3220", "user": "xatapult", "labels": ["bug"], "created": "2020-01-22 14:09:11", "closed": "2020-03-10 11:30:03", "commits": {}, "ttf": 47.000277777777775, "commitsDetails": []}, {"title": "[feature] add match highlighting to ft:field hits", "body": "**Is your feature request related to a problem? Please describe.**\r\n\r\nThe field feature in eXist 5 allows full text search within the field, and when hits are found, the field can be returned. Yet there is no facility for the highlighting of matches in fields. \r\n\r\nThis feature request flows from the motivation for the index defined in https://github.com/eXist-db/exist/blob/develop/extensions/indexes/lucene/src/test/xquery/lucene/facets.xql#L187-L192: some divs are English, some are German, and we can use fields to perform language-specific and language-sensitive searches. Naturally, a search interface would display a KWIC summary of the hits. However, we do not have any facility for applying match highlighting to the results of field searches.\r\n\r\n**Describe the solution you'd like**\r\n\r\nI would expect a function like `util:expand` to highlight matches in full text hits in a field. However, `ft:field` returns a string, and `util:expand` operates on XML nodes stored in the database. Thus, `util:expand` may not be suitable. Instead, perhaps it'll be necessary to create a new `ft:highlight-field-matches` function? Since it operates on strings, perhaps it could return results in an `<exist:field>` element, with matches wrapped in an `<exist:match>` element, like:\r\n\r\n```xquery\r\ndeclare\r\n    %test:args(\"english:bir*\")\r\n    %test:assertEquals(\"<exist:field>And the <exist:match>birds</exist:match> are singing</exist:field>\")\r\nfunction facet:highlight-field-matches($query as xs:string) {\r\n    doc(\"/db/lucenetest/multi-lang.xml\")//div[ft:query(., $query, map {\"fields\": \"english\"})]\r\n    => ft:highlight-field-matches(\"english\")\r\n};\r\n```\r\n\r\n**Describe alternatives you've considered**\r\n\r\nI tried `util:expand`, but since it takes a node and `ft:field` returns a string, it throws an error.\r\n\r\nAs for the results of the proposed function, I also considered proposing the format returned by `fn:analyze-string`: \r\n\r\n```xml\r\n<fn:analyze-string-result xmlns:fn=\"http://www.w3.org/2005/xpath-functions\">\r\n    <fn:non-match>And the </fn:non-match>\r\n    <fn:match>birds</fn:match>\r\n    <fn:non-match> are singing</fn:non-match>\r\n</fn:analyze-string-result>\r\n```\r\n\r\n... since this format would be compatible with any code for working with the results of this function. On the other hand, it's more likely that eXist developers would have code for highlighting nodes containing `<exist:match>` elements.\r\n\r\n**Additional context**\r\n\r\nI imagine that search applications with diverse data (i.e., different XML vocabularies or different structures) may make growing use of `ft:field` to allow corpus-wide searches across collections. For example, a corpus may contain both TEI and DocBook collections, each of which would require distinct indexes (one for `tei:TEI` and one for `dbk:article`), but which could feed into a common field containing the contents to be made full text searchable. This is already possible, but when displaying search results, it is common to display KWIC summaries. ", "url": "https://github.com/eXist-db/exist/issues/3210", "user": "joewiz", "labels": ["Lucene", "bug", "enhancement"], "created": "2020-01-19 02:00:39", "closed": "2020-06-10 16:44:04", "commits": {"cfb199983c923871fe287dc75218bc9eb08d3cc3": {"commitGHEventType": "closed", "commitUser": "joewiz"}, "dd71ec6d727c6963fb23f67bfd55ae371afcde7a": {"commitGHEventType": "referenced", "commitUser": "joewiz"}}, "ttf": 143.00027777777777, "commitsDetails": [{"commitHash": "cfb199983c923871fe287dc75218bc9eb08d3cc3", "commitGHEventType": "closed", "commitUser": "joewiz", "commitParents": ["328ddbb48cadceab7e9bf713935f9daf194cb027"], "nameRev": "cfb199983c923871fe287dc75218bc9eb08d3cc3 remotes/origin/adamretter-patch-3~2^2~1", "commitMessage": "[feature] add match highlighting to ft:field hits. Closes #3210\n", "commitDateTime": "2020-05-21 11:23:09", "authoredDateTime": "2020-05-21 11:23:09", "commitGitStats": [{"filePath": "extensions/indexes/lucene/src/main/java/org/exist/indexing/lucene/LuceneIndexWorker.java", "insertions": 18, "deletions": 1, "lines": 19}, {"filePath": "extensions/indexes/lucene/src/main/java/org/exist/indexing/lucene/LuceneMatchListener.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "extensions/indexes/lucene/src/main/java/org/exist/xquery/modules/lucene/Field.java", "insertions": 156, "deletions": 4, "lines": 160}, {"filePath": "extensions/indexes/lucene/src/main/java/org/exist/xquery/modules/lucene/LuceneModule.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "extensions/indexes/lucene/src/test/xquery/lucene/facets.xql", "insertions": 19, "deletions": 0, "lines": 19}], "commitSpoonAstDiffStats": [{"spoonFilePath": "LuceneIndexWorker.java", "spoonMethods": [{"spoonMethodName": "org.exist.indexing.lucene.LuceneIndexWorker.getLuceneConfig(org.exist.indexing.lucene.DBBroker,org.exist.indexing.lucene.DocumentSet)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.indexing.lucene.LuceneIndexWorker.getTerms(org.exist.indexing.lucene.Query)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "LuceneMatchListener.java", "spoonMethods": [{"spoonMethodName": "org.exist.indexing.lucene.LuceneMatchListener.getPath(org.exist.dom.persistent.NodeProxy)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.indexing.lucene.LuceneMatchListener.scanMatches(org.exist.dom.persistent.NodeProxy)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.indexing.lucene.LuceneMatchListener.walkAncestor(org.exist.dom.persistent.IStoredNode,org.exist.storage.NodePath2)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "Field.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.modules.lucene.Field.eval(org.exist.xquery.modules.lucene.Sequence[],org.exist.xquery.modules.lucene.Sequence)", "TOT": 18, "UPD": 0, "INS": 1, "MOV": 16, "DEL": 1}, {"spoonMethodName": "org.exist.xquery.modules.lucene.Field.highlightMatches(java.lang.String,org.exist.dom.persistent.NodeProxy,org.exist.xquery.modules.lucene.LuceneMatch,org.exist.xquery.modules.lucene.Sequence)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.modules.lucene.Field.getMatch(org.exist.dom.persistent.NodeProxy)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.modules.lucene.Field", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "LuceneModule.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.modules.lucene.LuceneModule", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "dd71ec6d727c6963fb23f67bfd55ae371afcde7a", "commitGHEventType": "referenced", "commitUser": "joewiz", "commitParents": ["3e482e85d5b7c294d298a4e22daaf3bd11df313c", "9c2ff4b58513530ec87b270726196025cfc5e5fa"], "nameRev": "dd71ec6d727c6963fb23f67bfd55ae371afcde7a remotes/origin/adamretter-patch-3~2", "commitMessage": "Merge pull request #3423 from wolfgangmm/feature/field-match-highlight\n\n[feature] support match highlighting on ft:field hits. Closes #3210", "commitDateTime": "2020-06-10 12:44:01", "authoredDateTime": "2020-06-10 12:44:01", "commitGitStats": [{"filePath": "extensions/indexes/lucene/src/main/java/org/exist/indexing/lucene/LuceneIndexWorker.java", "insertions": 17, "deletions": 1, "lines": 18}, {"filePath": "extensions/indexes/lucene/src/main/java/org/exist/indexing/lucene/LuceneMatchListener.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "extensions/indexes/lucene/src/main/java/org/exist/xquery/modules/lucene/Field.java", "insertions": 157, "deletions": 4, "lines": 161}, {"filePath": "extensions/indexes/lucene/src/main/java/org/exist/xquery/modules/lucene/LuceneModule.java", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "extensions/indexes/lucene/src/test/xquery/lucene/facets.xql", "insertions": 19, "deletions": 0, "lines": 19}], "commitSpoonAstDiffStats": [{"spoonFilePath": "LuceneIndexWorker.java", "spoonMethods": [{"spoonMethodName": "org.exist.indexing.lucene.LuceneIndexWorker.getLuceneConfig(org.exist.indexing.lucene.DBBroker,org.exist.indexing.lucene.DocumentSet)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.indexing.lucene.LuceneIndexWorker.getTerms(org.exist.indexing.lucene.Query)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "LuceneMatchListener.java", "spoonMethods": [{"spoonMethodName": "org.exist.indexing.lucene.LuceneMatchListener.getPath(org.exist.dom.persistent.NodeProxy)", "TOT": 3, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.indexing.lucene.LuceneMatchListener.scanMatches(org.exist.dom.persistent.NodeProxy)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.indexing.lucene.LuceneMatchListener.walkAncestor(org.exist.dom.persistent.IStoredNode,org.exist.storage.NodePath2)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "Field.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.modules.lucene.Field.eval(org.exist.xquery.modules.lucene.Sequence[],org.exist.xquery.modules.lucene.Sequence)", "TOT": 18, "UPD": 0, "INS": 1, "MOV": 16, "DEL": 1}, {"spoonMethodName": "org.exist.xquery.modules.lucene.Field.highlightMatches(java.lang.String,org.exist.dom.persistent.NodeProxy,org.exist.xquery.modules.lucene.LuceneMatch,org.exist.xquery.modules.lucene.Sequence)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.modules.lucene.Field.getMatch(org.exist.dom.persistent.NodeProxy)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.modules.lucene.Field", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "LuceneModule.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.modules.lucene.LuceneModule", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["cfb199983c923871fe287dc75218bc9eb08d3cc3"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 177, "deletions": 7, "lines": 184, "gitFilesChange": 4}, "spoonStatsSummary": {"TOT": 32, "UPD": 2, "INS": 9, "MOV": 16, "DEL": 5, "spoonFilesChanged": 4, "spoonMethodsChanged": 10}, "statsSkippedReason": "", "changesInPackagesGIT": ["extensions/indexes/lucene/src/main/java/org/exist/indexing/lucene", "extensions/indexes/lucene/src/main/java/org/exist/xquery/modules"], "changesInPackagesSPOON": ["org.exist.indexing.lucene.LuceneMatchListener.scanMatches(org.exist.dom.persistent.NodeProxy)", "org.exist.xquery.modules.lucene.Field", "org.exist.indexing.lucene.LuceneMatchListener.getPath(org.exist.dom.persistent.NodeProxy)", "org.exist.indexing.lucene.LuceneMatchListener.walkAncestor(org.exist.dom.persistent.IStoredNode,org.exist.storage.NodePath2)", "org.exist.xquery.modules.lucene.Field.eval(org.exist.xquery.modules.lucene.Sequence[],org.exist.xquery.modules.lucene.Sequence)", "org.exist.xquery.modules.lucene.Field.getMatch(org.exist.dom.persistent.NodeProxy)", "org.exist.xquery.modules.lucene.Field.highlightMatches(java.lang.String,org.exist.dom.persistent.NodeProxy,org.exist.xquery.modules.lucene.LuceneMatch,org.exist.xquery.modules.lucene.Sequence)", "org.exist.indexing.lucene.LuceneIndexWorker.getTerms(org.exist.indexing.lucene.Query)", "org.exist.xquery.modules.lucene.LuceneModule", "org.exist.indexing.lucene.LuceneIndexWorker.getLuceneConfig(org.exist.indexing.lucene.DBBroker,org.exist.indexing.lucene.DocumentSet)"]}, {"title": "HTTP 500 by Accept header from Chrome 79", "body": "As reported in #2679 the current Accept header sent by Google Chrome forces a HTTP 500, again.\r\n> eXist 5.1.0-SNAPSHOT \r\n\r\n### Reproduce\r\n```bash\r\ndocker run -p 8099:8080 existdb/existdb:latest & sleep 30;\r\nwhile [ $(curl --head --silent http://localhost:8099/ --connect-timeout 5 | grep -c \"200 OK\") = 0 ]; do sleep 2s; done;\r\necho 'xquery version \"3.1\";\r\nmodule namespace api = \"http://test.org/ns/exist/api\";\r\ndeclare namespace output = \"http://www.w3.org/2010/xslt-xquery-serialization\";\r\ndeclare namespace rest = \"http://exquery.org/ns/restxq\";\r\n\r\n(:~\r\n : Test\r\n :)\r\ndeclare\r\n  %rest:GET\r\n  %rest:path(\"/info\")\r\n  %rest:produces(\"application/json\")\r\n  %output:media-type(\"application/json\")\r\n  %output:method(\"json\")\r\nfunction api:info()\r\nas map(*) {\r\n  map {\r\n    \"name\": \"test\"\r\n  }\r\n};' > /tmp/test.xqm\r\ncurl -X PUT -H 'Content-Type: application/xquery' --data-binary @/tmp/test.xqm http://admin:@localhost:8099/exist/rest/db/test.xqm\r\n# google-chrome http://localhost:8099/exist/restxq/info\r\n# or in the terminal:\r\ncurl -H \"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\" http://localhost:8099/exist/restxq/info\r\n```\r\n### Error Message\r\n```\r\nHTTP ERROR 500 javax.servlet.ServletException: javax.servlet.ServletException:\r\nAn error occurred while processing request to /exist/restxq/info: Invalid Accept Header Value: &apos;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&apos; in respect to pattern: &apos;((?:(?:\\*\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}))(?:;\\s?q=(?:0(?:\\.[0-9]{1,3})?)|(?:1(?:\\.[0]{1,3})?))?\\s?(?:;\\s?[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+=[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+|(?:&quot;[a-z0-9]+&quot;))?)(,\\s?(?:(?:\\*\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}))(?:;\\s?q=(?:0(?:\\.[0-9]{1,3})?)|(?:1(?:\\.[0]{1,3})?))?\\s?(?:;\\s?[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+=[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+|(?:&quot;[a-z0-9]+&quot;))?)*&apos;</h2>\r\n<table>\r\n<tr><th>URI:</th><td>/exist/restxq/info</td></tr>\r\n<tr><th>STATUS:</th><td>500</td></tr>\r\n<tr><th>MESSAGE:</th><td>javax.servlet.ServletException: javax.servlet.ServletException: An error occurred while processing request to /exist/restxq/info: Invalid Accept Header Value: &apos;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&apos; in respect to pattern: &apos;((?:(?:\\*\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}))(?:;\\s?q=(?:0(?:\\.[0-9]{1,3})?)|(?:1(?:\\.[0]{1,3})?))?\\s?(?:;\\s?[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+=[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+|(?:&quot;[a-z0-9]+&quot;))?)(,\\s?(?:(?:\\*\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}))(?:;\\s?q=(?:0(?:\\.[0-9]{1,3})?)|(?:1(?:\\.[0]{1,3})?))?\\s?(?:;\\s?[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+=[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+|(?:&quot;[a-z0-9]+&quot;))?)*&apos;</td></tr>\r\n<tr><th>SERVLET:</th><td>XQueryURLRewrite</td></tr>\r\n<tr><th>CAUSED BY:</th><td>javax.servlet.ServletException: javax.servlet.ServletException: An error occurred while processing request to /exist/restxq/info: Invalid Accept Header Value: &apos;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&apos; in respect to pattern: &apos;((?:(?:\\*\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}))(?:;\\s?q=(?:0(?:\\.[0-9]{1,3})?)|(?:1(?:\\.[0]{1,3})?))?\\s?(?:;\\s?[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+=[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+|(?:&quot;[a-z0-9]+&quot;))?)(,\\s?(?:(?:\\*\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}))(?:;\\s?q=(?:0(?:\\.[0-9]{1,3})?)|(?:1(?:\\.[0]{1,3})?))?\\s?(?:;\\s?[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+=[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+|(?:&quot;[a-z0-9]+&quot;))?)*&apos;</td></tr>\r\n<tr><th>CAUSED BY:</th><td>javax.servlet.ServletException: An error occurred while processing request to /exist/restxq/info: Invalid Accept Header Value: &apos;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&apos; in respect to pattern: &apos;((?:(?:\\*\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}))(?:;\\s?q=(?:0(?:\\.[0-9]{1,3})?)|(?:1(?:\\.[0]{1,3})?))?\\s?(?:;\\s?[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+=[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+|(?:&quot;[a-z0-9]+&quot;))?)(,\\s?(?:(?:\\*\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}))(?:;\\s?q=(?:0(?:\\.[0-9]{1,3})?)|(?:1(?:\\.[0]{1,3})?))?\\s?(?:;\\s?[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+=[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+|(?:&quot;[a-z0-9]+&quot;))?)*&apos;</td></tr>\r\n<tr><th>CAUSED BY:</th><td>java.lang.IllegalArgumentException: Invalid Accept Header Value: &apos;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&apos; in respect to pattern: &apos;((?:(?:\\*\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}))(?:;\\s?q=(?:0(?:\\.[0-9]{1,3})?)|(?:1(?:\\.[0]{1,3})?))?\\s?(?:;\\s?[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+=[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+|(?:&quot;[a-z0-9]+&quot;))?)(,\\s?(?:(?:\\*\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/\\*)|(?:[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}\\/[a-z0-9!#\\$&amp;\\.\\+\\-\\^_]{1,127}))(?:;\\s?q=(?:0(?:\\.[0-9]{1,3})?)|(?:1(?:\\.[0]{1,3})?))?\\s?(?:;\\s?[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+=[!#$%&amp;&apos;*+\\-.^_`|~0-9a-zA-z]+|(?:&quot;[a-z0-9]+&quot;))?)*&apos;</td></tr>\r\n</table>\r\n\t[\u2026]\r\n```", "url": "https://github.com/eXist-db/exist/issues/3173", "user": "mathias-goebel", "labels": ["bug"], "created": "2019-12-20 14:48:56", "closed": "2020-01-15 09:34:25", "commits": {}, "ttf": 25.00027777777778, "commitsDetails": []}, {"title": "[BUG] contentextraction library broken in 5.x", "body": "**Describe the bug**\r\n\r\nThe contentextraction libraries, which were working in eXist 4.7.1, are not working in eXist 5.0.0-5.1.1. Calling `contentextraction:get-metadata()` produces an error:\r\n\r\n```\r\n2019-12-17 10:53:27,043 [qtp1158869572-876] ERROR (ContentFunctions.java [eval]:168) - Problem with content extraction library: Unexpected RuntimeException from org.apache.tika.parser.EmptyParser@4fc9f8fd \r\norg.exist.contentextraction.ContentExtractionException: Problem with content extraction library: Unexpected RuntimeException from org.apache.tika.parser.EmptyParser@4fc9f8fd\r\n\tat org.exist.contentextraction.ContentExtraction.extractMetadata(ContentExtraction.java:74) ~[exist-contentextraction-5.1.1.jar:5.1.1]\r\n\tat org.exist.contentextraction.xquery.ContentFunctions.eval(ContentFunctions.java:146) ~[exist-contentextraction-5.1.1.jar:5.1.1]\r\n\tat org.exist.xquery.BasicFunction.eval(BasicFunction.java:74) ~[exist-core-5.1.1.jar:5.1.1]\r\n\t...\r\nCaused by: java.lang.NullPointerException\r\n\tat org.apache.tika.sax.ContentHandlerDecorator.startDocument(ContentHandlerDecorator.java:106) ~[tika-core-1.22.jar:1.22]\r\n\tat org.apache.tika.sax.XHTMLContentHandler.startDocument(XHTMLContentHandler.java:120) ~[tika-core-1.22.jar:1.22]\r\n\tat org.apache.tika.parser.EmptyParser.parse(EmptyParser.java:54) ~[tika-core-1.22.jar:1.22]\r\n\tat org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:280) ~[tika-core-1.22.jar:1.22]\r\n\tat org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:143) ~[tika-core-1.22.jar:1.22]\r\n\tat org.exist.contentextraction.ContentExtraction.extractMetadata(ContentExtraction.java:71) ~[exist-contentextraction-5.1.1.jar:5.1.1]\r\n```\r\n\r\nCalling `contentextraction:get-metadata-and-content()` produces no error, but the result is clearly broken. Here's the result when applied to a PDF, whether in the db or on disk:\r\n\r\n```xml\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n    <head>\r\n        <meta name=\"X-Parsed-By\" content=\"org.apache.tika.parser.EmptyParser\"/>\r\n        <meta name=\"Content-Type\" content=\"application/pdf\"/>\r\n        <title/>\r\n    </head>\r\n    <body/>\r\n</html>\r\n```\r\n\r\n**Expected behavior**\r\n\r\nI expect no error to be thrown, and instead for `contentextraction:get-metadata()` to be able to receive the `xs:base64Binary` data and extract the metadata, and for `contentextraction:get-metadata-and-content()` to extract both the metadata and content.\r\n\r\n**To Reproduce**\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace t=\"http://exist-db.org/xquery/test\";\r\n\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\ndeclare namespace html=\"http://www.w3.org/1999/xhtml\";\r\n\r\n(: minimal PDF taken from https://brendanzagaeski.appspot.com/0004.html :)\r\ndeclare variable $t:PDF := \"%PDF-1.1\r\n%\u00a5\u00b1\u00eb\r\n\r\n1 0 obj\r\n  << /Type /Catalog\r\n     /Pages 2 0 R\r\n  >>\r\nendobj\r\n\r\n2 0 obj\r\n  << /Type /Pages\r\n     /Kids [3 0 R]\r\n     /Count 1\r\n     /MediaBox [0 0 300 144]\r\n  >>\r\nendobj\r\n\r\n3 0 obj\r\n  <<  /Type /Page\r\n      /Parent 2 0 R\r\n      /Resources\r\n       << /Font\r\n           << /F1\r\n               << /Type /Font\r\n                  /Subtype /Type1\r\n                  /BaseFont /Times-Roman\r\n               >>\r\n           >>\r\n       >>\r\n      /Contents 4 0 R\r\n  >>\r\nendobj\r\n\r\n4 0 obj\r\n  << /Length 55 >>\r\nstream\r\n  BT\r\n    /F1 18 Tf\r\n    0 0 Td\r\n    (Hello World) Tj\r\n  ET\r\nendstream\r\nendobj\r\n\r\nxref\r\n0 5\r\n0000000000 65535 f \r\n0000000018 00000 n \r\n0000000077 00000 n \r\n0000000178 00000 n \r\n0000000457 00000 n \r\ntrailer\r\n  <<  /Root 1 0 R\r\n      /Size 5\r\n  >>\r\nstartxref\r\n565\r\n%%EOF\" => util:string-to-binary();\r\n\r\ndeclare variable $t:temp-dir := util:system-property(\"java.io.tmpdir\");\r\n\r\ndeclare\r\n    %test:setUp\r\nfunction t:setup() {\r\n    let $testCol := xmldb:create-collection(\"/db\", \"test\")\r\n    return\r\n        (\r\n            xmldb:store(\"/db/test\", \"test.pdf\", $t:PDF),\r\n            file:serialize-binary($t:PDF, $t:temp-dir || \"/test.pdf\", false())\r\n        )\r\n};\r\n\r\ndeclare\r\n    %test:tearDown\r\nfunction t:tearDown() {\r\n    xmldb:remove(\"/db/test\"),\r\n    file:delete($t:temp-dir || \"/test.pdf\")\r\n};\r\n\r\ndeclare\r\n    %test:assertTrue\r\nfunction t:exists-on-disk() {\r\n    let $pdf-path := $t:temp-dir || \"/test.pdf\"\r\n    return\r\n        if (file:exists($pdf-path)) then\r\n            let $pdf := file:read-binary($pdf-path)\r\n            return\r\n                $pdf instance of xs:base64Binary\r\n        else\r\n            false()\r\n};\r\n\r\ndeclare\r\n    %test:assertTrue\r\nfunction t:exists-in-db() {\r\n    let $pdf-path := \"/db/test/test.pdf\"\r\n    return\r\n        if (util:binary-doc-available($pdf-path)) then\r\n            let $pdf := util:binary-doc($pdf-path)\r\n            return\r\n                $pdf instance of xs:base64Binary\r\n        else\r\n            false()\r\n};\r\n\r\ndeclare\r\n    %test:assertEquals(\"1\")\r\nfunction t:read-metadata-from-disk() {\r\n    (\r\n        file:read-binary($t:temp-dir || \"/test.pdf\")\r\n        => contentextraction:get-metadata()\r\n    )//html:meta[@name eq \"xmpTPg:NPages\"]/@content/string()\r\n};\r\n\r\ndeclare\r\n    %test:assertEquals(\"1\")\r\nfunction t:read-metadata-from-db() {\r\n    (\r\n        util:binary-doc(\"/db/test/test.pdf\")\r\n        => contentextraction:get-metadata()\r\n    )//html:meta[@name eq \"xmpTPg:NPages\"]/@content/string()\r\n};\r\n\r\ndeclare\r\n    %test:assertEquals(\"Hello World\")\r\nfunction t:read-content-and-metadata-from-disk() {\r\n    (\r\n        file:read-binary($t:temp-dir || \"/test.pdf\")\r\n        => contentextraction:get-metadata-and-content()\r\n    )//html:p[2]/string()\r\n};\r\n\r\ndeclare\r\n    %test:assertEquals(\"Hello World\")\r\nfunction t:read-content-and-metadata-from-db() {\r\n    (\r\n        util:binary-doc(\"/db/test/test.pdf\")\r\n        => contentextraction:get-metadata-and-content()\r\n    )//html:p[2]/string()\r\n};\r\n```\r\n\r\nIn eXist 4.7.1, all tests pass. In eXist 5.0.0 and higher (including 5.1.1), the testsuite fails, as follows:\r\n\r\n```xml\r\n<testsuites>\r\n    <testsuite package=\"http://exist-db.org/xquery/test\" timestamp=\"2019-12-17T12:09:22.634-05:00\"\r\n        tests=\"6\" failures=\"2\" errors=\"2\" pending=\"0\" time=\"PT0.132S\">\r\n        <testcase name=\"exists-in-db\" class=\"t:exists-in-db\"/>\r\n        <testcase name=\"exists-on-disk\" class=\"t:exists-on-disk\"/>\r\n        <testcase name=\"read-content-and-metadata-from-db\"\r\n            class=\"t:read-content-and-metadata-from-db\">\r\n            <failure\r\n                message=\"assertEquals failed: wrong number of items returned by function. Expected: 1. Got: 0\"\r\n                type=\"failure-error-code-1\">Hello World</failure>\r\n            <output/>\r\n        </testcase>\r\n        <testcase name=\"read-content-and-metadata-from-disk\"\r\n            class=\"t:read-content-and-metadata-from-disk\">\r\n            <failure\r\n                message=\"assertEquals failed: wrong number of items returned by function. Expected: 1. Got: 0\"\r\n                type=\"failure-error-code-1\">Hello World</failure>\r\n            <output/>\r\n        </testcase>\r\n        <testcase name=\"read-metadata-from-db\" class=\"t:read-metadata-from-db\">\r\n            <error type=\"java:org.exist.contentextraction.ContentExtractionException\"\r\n                message=\"Problem with content extraction library: Unexpected RuntimeException from org.apache.tika.parser.EmptyParser@7fb817d6\"\r\n            />\r\n        </testcase>\r\n        <testcase name=\"read-metadata-from-disk\" class=\"t:read-metadata-from-disk\">\r\n            <error type=\"java:org.exist.contentextraction.ContentExtractionException\"\r\n                message=\"Problem with content extraction library: Unexpected RuntimeException from org.apache.tika.parser.EmptyParser@7b849b06\"\r\n            />\r\n        </testcase>\r\n    </testsuite>\r\n</testsuites>\r\n```\r\n\r\nFor comparison, run `tika -x test.pdf` on [test.pdf](https://github.com/eXist-db/exist/files/3974285/test.pdf). The result:\r\n\r\n```xml\r\n<html xmlns=\"http://www.w3.org/1999/xhtml\">\r\n    <head>\r\n        <meta name=\"pdf:PDFVersion\" content=\"1.1\" />\r\n        <meta name=\"X-Parsed-By\" content=\"org.apache.tika.parser.DefaultParser\" />\r\n        <meta name=\"X-Parsed-By\" content=\"org.apache.tika.parser.pdf.PDFParser\" />\r\n        <meta name=\"access_permission:modify_annotations\" content=\"true\" />\r\n        <meta name=\"access_permission:can_print_degraded\" content=\"true\" />\r\n        <meta name=\"access_permission:extract_for_accessibility\" content=\"true\" />\r\n        <meta name=\"access_permission:assemble_document\" content=\"true\" />\r\n        <meta name=\"xmpTPg:NPages\" content=\"1\" />\r\n        <meta name=\"resourceName\" content=\"test.pdf\" />\r\n        <meta name=\"dc:format\" content=\"application/pdf; version=1.1\" />\r\n        <meta name=\"access_permission:extract_content\" content=\"true\" />\r\n        <meta name=\"access_permission:can_print\" content=\"true\" />\r\n        <meta name=\"access_permission:fill_in_form\" content=\"true\" />\r\n        <meta name=\"pdf:encrypted\" content=\"false\" />\r\n        <meta name=\"Content-Length\" content=\"738\" />\r\n        <meta name=\"access_permission:can_modify\" content=\"true\" />\r\n        <meta name=\"Content-Type\" content=\"application/pdf\" />\r\n        <title></title>\r\n    </head>\r\n    <body>\r\n        <div class=\"page\">\r\n            <p></p>\r\n            <p>Hello World</p>\r\n            <p></p>\r\n        </div>\r\n    </body>\r\n</html>\r\n```\r\n\r\n**Context (please always complete the following information):**\r\n - OS: macOS 10.15.2\r\n - eXist-db version: 5.0.0-5.1.1 (release) (problem not evident in 4.7.1)\r\n - Java Version: OpenJDK 1.8.0_232 (Zulu 8.42.0.23-CA-macosx)\r\n\r\n**Additional context**\r\n- How is eXist-db installed? DMG via homebrew\r\n- Any custom changes in e.g. `conf.xml`? none\r\n", "url": "https://github.com/eXist-db/exist/issues/3166", "user": "joewiz", "labels": ["bug"], "created": "2019-12-17 16:22:15", "closed": "2020-01-21 14:48:48", "commits": {}, "ttf": 34.000277777777775, "commitsDetails": []}, {"title": "java.lang.ClassCastException with fn:subsequence", "body": "### What is the problem\r\n\r\nThe following query raises an error:\r\n\r\n```xquery\r\n(\"x\", \"y\") => subsequence(1, 1) => matches(\"x\")\r\n```\r\n\r\nThe error:\r\n\r\n```text\r\n2019-12-06 14:08:51,839 [qtp1729081400-44] ERROR (XQueryServlet.java [process]:559) - org.exist.xquery.value.StringValue cannot be cast to org.exist.xquery.value.NodeValue \r\njava.lang.ClassCastException: org.exist.xquery.value.StringValue cannot be cast to org.exist.xquery.value.NodeValue\r\n\tat org.exist.xquery.value.SubSequence.isPersistentSet(SubSequence.java:377) ~[exist-core-5.1.0.jar:5.1.0]\r\n\tat org.exist.xquery.functions.fn.FunMatches.eval(FunMatches.java:322) ~[exist-core-5.1.0.jar:5.1.0]\r\n...\r\n```\r\n\r\n### What did you expect\r\n\r\nI expected the query to return `true()` instead of an error.  \r\n\r\nThe following slight variants of the query do return the expected result:\r\n\r\n```xquery\r\n(\"x\", \"y\") => subsequence(1, 1) => string() => matches(\"x\")\r\n```\r\n\r\n```xquery\r\n(\"x\", \"y\") => head() => matches(\"x\")\r\n```\r\n\r\nThe problem seems specific to `fn:subsequence()` and its handling of data types.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace t=\"http://exist-db.org/xquery/test\";\r\n\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare\r\n    %test:assertTrue\r\nfunction t:test() {\r\n    (\"x\", \"y\") => subsequence(1, 1) => matches(\"x\")\r\n};\r\n```\r\n\r\nThis test returns:\r\n\r\n```xml\r\n<testcase name=\"test\" class=\"t:test\">\r\n    <error type=\"java:java.lang.ClassCastException\"\r\n        message=\"org.exist.xquery.value.StringValue cannot be cast to org.exist.xquery.value.NodeValue\"\r\n    />\r\n</testcase>\r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: every release of eXist since 4.5.0  \r\n- Java version: 1.8.0_232\r\n- Operating system: macOS 10.15.1\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed? built develop from source, tested previous releases with DMG download\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/3148", "user": "joewiz", "labels": ["bug"], "created": "2019-12-06 21:12:15", "closed": "2020-01-17 10:43:10", "commits": {}, "ttf": 41.000277777777775, "commitsDetails": []}, {"title": "xslfo broken in 5.1.0", "body": "The attached 47-line query successfully produces PDF output in 5.0.0 but throws an NPE in 5.1.0.  The error is just this:\r\n\r\nOracle JDK 8:\r\n\r\n`An exception occurred during query execution: exerr:ERROR exerr:ERROR Error. [at line 46, column 13] [at line 46, column 13]`\r\n\r\nOpenJDK 11:\r\n\r\n`An exception occurred during query execution: exerr:ERROR exerr:ERROR java.lang.NullPointerException [at line 46, column 13] [at line 46, column 13]\r\n`\r\n\r\nand the stack trace from OpenJDK 11 is the following:\r\n\r\n```\r\norg.xmldb.api.base.XMLDBException: exerr:ERROR java.lang.NullPointerException [at line 46, column 13]\r\n\tat org.exist.xmldb.RemoteXPathQueryService.throwException(RemoteXPathQueryService.java:175)\r\n\tat org.exist.xmldb.RemoteXPathQueryService.query(RemoteXPathQueryService.java:112)\r\n\tat org.exist.xmldb.RemoteXPathQueryService.query(RemoteXPathQueryService.java:81)\r\n\tat org.exist.xmldb.RemoteXPathQueryService.execute(RemoteXPathQueryService.java:349)\r\n\tat org.exist.client.QueryDialog$QueryRunnable.run(QueryDialog.java:577)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: org.exist.xquery.XPathException: exerr:ERROR exerr:ERROR java.lang.NullPointerException [at line 46, column 13] [at line 46, column 13]\r\n\tat org.exist.xmldb.RemoteXPathQueryService.throwException(RemoteXPathQueryService.java:174)\r\n\t... 5 more\r\n```\r\n\r\nThere is nothing in exist.log.\r\n\r\n### Context information\r\n\r\n[eXist Version : 5.1.0] \r\n[eXist Build : 20191117145049] \r\n[Git commit : 1533551563661d2c2061d3ed1304cb257f216327] \r\n[Operating System : Mac OS X 10.14.6 x86_64] \r\n\r\nThe problem happens with both Oracle JRE 1.8.0_231 and OpenJDK 11.0.4+11, though only the latter indicates the problem is an NPE.\r\n\r\n- Any custom changes: no\r\n\r\n[broken_xslfo.xql.zip](https://github.com/eXist-db/exist/files/3881625/broken_xslfo.xql.zip)\r\n", "url": "https://github.com/eXist-db/exist/issues/3125", "user": "craigberry", "labels": ["bug"], "created": "2019-11-22 22:28:08", "closed": "2019-11-23 13:07:40", "commits": {"45094d08bc18d415c1f8f8a18aa115f20da1d712": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "45094d08bc18d415c1f8f8a18aa115f20da1d712", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["52179905dfac322be9b99de97d1aaebe4b605a0e"], "nameRev": "45094d08bc18d415c1f8f8a18aa115f20da1d712 tags/eXist-5.1.1~10", "commitMessage": "[bugfix] Fix an NPE with Apache FOP XSL:FO render in eXist-db 5.1.0\nCloses https://github.com/eXist-db/exist/issues/3125\n", "commitDateTime": "2019-12-06 18:43:14", "authoredDateTime": "2019-11-23 13:43:58", "commitGitStats": [{"filePath": "extensions/modules/xslfo/pom.xml", "insertions": 5, "deletions": 0, "lines": 5}, {"filePath": "extensions/modules/xslfo/src/main/java/org/exist/xquery/modules/xslfo/ApacheFopProcessorAdapter.java", "insertions": 10, "deletions": 4, "lines": 14}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ApacheFopProcessorAdapter.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.modules.xslfo.ApacheFopProcessorAdapter.FopAvalonConfigurationAdapter", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.xquery.modules.xslfo.ApacheFopProcessorAdapter.FopAvalonConfigurationAdapter.getChild(java.lang.String,boolean)", "TOT": 5, "UPD": 0, "INS": 4, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.modules.xslfo.ApacheFopProcessorAdapter.FopAvalonConfigurationAdapter.getChildren(java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["45094d08bc18d415c1f8f8a18aa115f20da1d712"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 10, "deletions": 4, "lines": 14, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 8, "UPD": 0, "INS": 6, "MOV": 1, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 3}, "statsSkippedReason": "", "changesInPackagesGIT": ["extensions/modules/xslfo/src/main/java/org/exist/xquery/modules"], "changesInPackagesSPOON": ["org.exist.xquery.modules.xslfo.ApacheFopProcessorAdapter.FopAvalonConfigurationAdapter.getChildren(java.lang.String)", "org.exist.xquery.modules.xslfo.ApacheFopProcessorAdapter.FopAvalonConfigurationAdapter.getChild(java.lang.String,boolean)", "org.exist.xquery.modules.xslfo.ApacheFopProcessorAdapter.FopAvalonConfigurationAdapter"]}, {"title": "NPE during restore", "body": "### What is the problem\r\nA NPE occurs while restoring from a ZIP file.\r\n\r\n### What did you expect\r\nA restore without issues\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n```\r\n./bin/backup.sh -r ~/Downloads/full20190710-0300.zip -P MyPassword -R -ouri=xmldb:exist:///\r\njava.lang.NullPointerException\r\n\tat org.expath.pkg.repo.deps.Semver.compareTo(Semver.java:185)\r\n\tat org.exist.backup.restore.AppRestoreUtils.checkApps(AppRestoreUtils.java:62)\r\n\tat org.exist.backup.Restore.restore(Restore.java:70)\r\n\tat org.exist.xmldb.LocalRestoreService.lambda$0(LocalRestoreService.java:56)\r\n\tat org.exist.xmldb.function.LocalXmldbFunction.apply(LocalXmldbFunction.java:46)\r\n\tat org.exist.xmldb.AbstractLocal.withDb(AbstractLocal.java:263)\r\n\tat org.exist.xmldb.LocalRestoreService.restore(LocalRestoreService.java:54)\r\n\tat org.exist.backup.Main.restoreWithoutGui(Main.java:278)\r\n\tat org.exist.backup.Main.process(Main.java:248)\r\n\tat org.exist.backup.Main.main(Main.java:448)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.exist.start.Main.invokeMain(Main.java:118)\r\n\tat org.exist.start.Main.runEx(Main.java:248)\r\n\tat org.exist.start.Main.run(Main.java:123)\r\n\tat org.exist.start.Main.main(Main.java:60)\r\n```\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version : 5.2.0-SNAPSHOT (aka 5.1.0) \r\n- Java version : OpenJDK Runtime Environment (Zulu 8.42.0.23-CA-macosx) (build 1.8.0_232-b18) \r\n- Operating system (Windows 7, Linux, MacOs): MacOS\r\n- 32 or 64 bit : 64bit\r\n- How is eXist-db installed? (JAR installer, DMG, WAR file, clone from GitHub):  local build\r\n- Any custom changes in e.g. conf.xml - none \r\n", "url": "https://github.com/eXist-db/exist/issues/3118", "user": "dizzzz", "labels": ["bug"], "created": "2019-11-18 21:14:02", "closed": "2019-11-28 12:39:40", "commits": {"78e894ba338f02044e6b9836a90c24a615bdf0a5": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 9.000277777777777, "commitsDetails": [{"commitHash": "78e894ba338f02044e6b9836a90c24a615bdf0a5", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["45094d08bc18d415c1f8f8a18aa115f20da1d712"], "nameRev": "78e894ba338f02044e6b9836a90c24a615bdf0a5 tags/eXist-5.1.1~9", "commitMessage": "[bugfix] Fix an issue with SemVer comparison of package versions when restoring a backup\nCloses https://github.com/eXist-db/exist/issues/3118\n", "commitDateTime": "2019-12-06 18:43:14", "authoredDateTime": "2019-11-27 12:42:26", "commitGitStats": [{"filePath": "exist-parent/pom.xml", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["78e894ba338f02044e6b9836a90c24a615bdf0a5"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "K2-SeqExprTreat-2 causes StackOverflowError in IntegerValue.plus", "body": "This simple XQuery will lead to a StackOverflowError:\r\n\r\n```xquery\r\n3 treat as item()+ + +1\r\n```\r\n\r\nThe result should instead be `4`.\r\n\r\nThis is taken from the XQTS 3.1.0:\r\n\r\n```xml\r\n  <test-case name=\"K2-SeqExprTreat-2\">\r\n      <description> Use three pluses on a row, combined with 'treat as'. </description>\r\n      <created by=\"Frans Englich\" on=\"2007-11-26\"/>\r\n      <test>3 treat as item()+ + +1</test>\r\n      <result>\r\n         <assert-eq>4</assert-eq>\r\n      </result>\r\n   </test-case>\r\n```", "url": "https://github.com/eXist-db/exist/issues/3111", "user": "adamretter", "labels": ["bug"], "created": "2019-11-15 14:45:30", "closed": "2019-11-16 12:08:02", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Parallel tests need separate log files.", "body": "When we run tests in parallel each test has a separate data folder, this is usually enforced by the use of the `useTemporaryStorage` parameter to `ExistEmbeddedServer`.\r\n\r\nAt the moment the tests do not use separate Log4j log files. Ideally these need to be separated to also use temporary storage, otherwise two tests running in parallel can have file locking issues on the same log file on Windows.", "url": "https://github.com/eXist-db/exist/issues/3094", "user": "adamretter", "labels": ["bug", "windows"], "created": "2019-11-04 17:53:39", "closed": "2019-11-11 20:04:28", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "fn:random-number-generator not spec compliant", "body": "### What is the problem\r\n\r\nThe function `fn:random-number-generator` is not compliant to the xquery 3.1 specification.\r\n\r\nSpecifically:\r\n1. The seed can be of type `xs:anyAtomic` but only `xs:number` is supported because it is internally cast to `java.long` https://github.com/eXist-db/exist/blob/cdefdee3263b3e68e37abc3ad6893b30fc7682c6/exist-core/src/main/java/org/exist/xquery/functions/fn/FnRandomNumberGenerator.java#L43\r\n2. There is a side-effect with the function returned in the `next` key.\r\nhttps://github.com/eXist-db/exist/blob/cdefdee3263b3e68e37abc3ad6893b30fc7682c6/exist-core/src/main/java/org/exist/xquery/functions/fn/FnRandomNumberGenerator.java#L84\r\n\r\n### What did you expect\r\n\r\nThe implementation to be spec compliant.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nYou can find the tests in #3072 \r\n\r\n### Context information\r\n\r\n- eXist-db 5.0.x /   \r\n- Java\r\n- MacOs 10.14.x (64 bit)\r\n- clone from latest develop\r\n- no custom changes", "url": "https://github.com/eXist-db/exist/issues/3071", "user": "line-o", "labels": ["bug"], "created": "2019-10-27 16:00:39", "closed": "2020-02-20 07:09:45", "commits": {}, "ttf": 115.00027777777778, "commitsDetails": []}, {"title": "No returned compiled query into Pool ", "body": "Thank you for reporting your issue!\r\n\r\nTo be able to better understand you problem or suggestion, please add as much information as possible to this ticket. When there is no or just little information, it will be too difficult to work on it (and hence we will not be able to solve it)\r\n\r\nPlease fill in the following sections:\r\n\r\n### What is the problem\r\n> exist/exist-core/src/main/java/org/exist/storage/serializers/XIncludeFilter.java has borrowed from pool, but has no any return borrowed query back to it, although other classes do that\r\n```\r\nCompiledXQuery compiled = pool.borrowCompiledXQuery(serializer.broker, source);\r\n```\r\n(!) There is no finalize code\r\n```\r\ncontext.runCleanupTasks();\r\npool.returnCompiledXQuery(source, compiled);\r\n```\r\n\r\n### What did you expect\r\n> that pool will be left unchanged after calling execute method\r\n\r\n### Describe how to reproduce or add a test\r\n> Just seen by eyes.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version  (any+current)\r\n- Java version N/A\r\n- Operating system N/A\r\n- 32 or 64 bit N/A\r\n", "url": "https://github.com/eXist-db/exist/issues/3058", "user": "alebastrov", "labels": ["bug"], "created": "2019-10-17 12:35:30", "closed": "2019-10-23 13:11:32", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "5.0 indexes not recomputed after move($source, $target) operation", "body": "### What is the problem\r\nbase-uri($node) shows the URI where the resource containing $node was stored, rather than the location it has been moved to. \r\n\r\n### What did you expect\r\nbase-uri($node) shows the URI for the node's new location\r\n\r\n\r\n### Describe how to reproduce or add a test\r\nWithin a collection `_shared-prefix_`, create a collection `staging` containing a collection `data` and within the latter a resource such as \r\n\r\n```\r\n<index xmlns=\"http://example.org/namespace\">\r\n    <item>A</item>\r\n</index>\r\n```\r\n\r\nCreate a collection, sister to `staging` called `prod`.\r\n\r\nCreate an index scoping over both source and target, such as\r\n```\r\n<collection xmlns=\"http://exist-db.org/collection-config/1.0\">\r\n    <index xmlns:mynamespace=\"http://example.org/namespace\">\r\n        <range>\r\n            <create qname=\"mynamespace:item\" type=\"xs:string\"/>\r\n        </range>\r\n    </index> \r\n</collection>\r\n```\r\n\r\nCheck that the following returns a uri containing `staging`: \r\n\r\n```\r\nxquery version \"3.1\";\r\ndeclare namespace ns =\"http://example.org/namespace\";\r\nbase-uri(collection(\"_shared-prefix_\")//ns:item)\r\n```\r\n\r\nExecute\r\n\r\n`xmldb:move(\"_shared-prefix_/staging/data\", \"_shared-prefix_/prod\")`\r\n\r\nThe XQuery above (with version spec) should not return a URI containing `_shared-prefix_/staging`.\r\n\r\n### Context information\r\n\r\n- eXist\u00a0Version: 5.0.0\r\n- eXist\u00a0Build: 20190902160649\r\n- Operating System: Linux 4.18.0-80.el8.x86_64 amd64 (RHEL 8)\r\n- Java Version: 1.8.0_222\r\n- How is eXist-db installed? (JAR installer, DMG, WAR file, clone from GitHub): JAR\r\n- Any custom changes in e.g. conf.xml: (none)\r\n", "url": "https://github.com/eXist-db/exist/issues/3040", "user": "Jo-Calder", "labels": ["bug", "high prio"], "created": "2019-10-07 11:07:20", "closed": "2020-03-04 17:51:50", "commits": {}, "ttf": 149.00027777777777, "commitsDetails": []}, {"title": "util:get-resource-by-absolute-id() is broken in 5.0.0", "body": "Hi there. I noticed that the `util:get-resource-by-absolute-id()` doesn't return anything when provided with a valid id parameter in eXist 5.0.0. I compared the behavior of the function in 4.7.1 and 5.0.0 by using the two corresponding Docker images from Docker Hub and a short XQuery snippet:\r\n```\r\nlet $doc := doc(\"/db/apps/eXide/build.xml\")\r\n(: $doc can also be any other document of course :)\r\nlet $abs-id := util:absolute-resource-id($doc)\r\nreturn $doc = util:get-resource-by-absolute-id($abs-id)\r\n```\r\nThis snippet:\r\n* returns `true()` on eXist 4.7.1 from Docker Hub `existdb/existdb:4.7.1` (image id `1937aedf933b`)\r\n* returns `false()` on eXist 5.0.0 from Docker Hub `existdb/existdb:5.0.0` (image id `72d679c573f1`)\r\n\r\nMy OS is Debian 9. Please let me know if there's other info you need.", "url": "https://github.com/eXist-db/exist/issues/3031", "user": "03b8", "labels": ["bug", "investigate", "xquery"], "created": "2019-09-28 10:26:30", "closed": "2020-04-10 19:40:09", "commits": {}, "ttf": 195.00027777777777, "commitsDetails": []}, {"title": "Restoring a large backup can report no progress for some time.", "body": "As reported to me by Vincent Lizzi... When restoring a very large backup using XML-RPC remote API, there can be a very long pause before any progress at all is reported. It appears to the user that either nothing is happening or the system has crashed.\r\n\r\n* When restoring a backup, we first create a Zip which we then copy up to the server before initiating the restore process. The creation of this zip and copying it to the server needs to be included in the restore progress feedback.", "url": "https://github.com/eXist-db/exist/issues/3024", "user": "adamretter", "labels": ["bug"], "created": "2019-09-23 19:08:07", "closed": "2020-03-06 19:03:57", "commits": {}, "ttf": 164.00027777777777, "commitsDetails": []}, {"title": "XSLT transformations on Jetty config are not idempotent", "body": "When doing a distribution build, XSLT is used to create the correct Jetty config.\r\n\r\nIf two Maven targets are invoked which call the XSLT (without `clean` between them), then the XSLT corrupts the Jetty config. This leads to Jetty trying to serve the `/etc` directory.\r\n\r\n* This will cause a problem: `cd exist-distribution && mvn clean install package`\r\n* This will NOT cause a problem: `cd exist-distribution && mvn clean install && mvn clean package`\r\n\r\nEach of the `install` and `package` targets will call the XSLT transformation once each on `exist-distribution/target/exist-distribution-5.1.0-SNAPSHOT-dir/etc/jetty/webapps/exist-webapp-context.xml`.\r\n\r\nThe correctly transformed `exist-webapp-context.xml` should look like:\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!DOCTYPE Configure\r\n  PUBLIC \"-//Jetty//Configure//EN\" \"http://www.eclipse.org/jetty/configure_9_3.dtd\">\r\n<Configure id=\"exist-webapp-context\" class=\"org.exist.jetty.WebAppContext\">\r\n    <!-- contextPath can be set to either '/exist' or '/' -->\r\n    <Set name=\"contextPath\">/exist</Set>\r\n    <Set name=\"war\"><Property name=\"jetty.home\" default=\".\"/>/etc/webapp</Set>\r\n    <Set name=\"defaultsDescriptor\"><Property name=\"jetty.home\" default=\".\"/>/etc/jetty/webdefault.xml</Set>\r\n    <Set name=\"securityHandler\">\r\n        <New class=\"org.eclipse.jetty.security.ConstraintSecurityHandler\">\r\n            <Set name=\"loginService\">\r\n                <New class=\"org.eclipse.jetty.jaas.JAASLoginService\">\r\n                    <Set name=\"name\">Test JAAS Realm</Set>\r\n                    <Set name=\"loginModuleName\">JAASLoginService</Set>\r\n                </New>\r\n            </Set>\r\n        </New>\r\n    </Set>\r\n    <Call name=\"setAttribute\">\r\n        <Arg>org.eclipse.jetty.server.webapp.ContainerIncludeJarPattern</Arg>\r\n        <Arg>.*/[^/]*servlet-api-[^/]*\\.jar$|.*/javax.servlet.jsp.jstl-.*\\.jar$|.*/org.apache.taglibs.taglibs-standard-impl-.*\\.jar$|.*/content/.*\\.jar$</Arg>\r\n    </Call>\r\n</Configure>\r\n```\r\n\r\nThe corrupted `exist-webapp-context.xml` (after two transformations) looks like:\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<!DOCTYPE Configure\r\n  PUBLIC \"-//Jetty//Configure//EN\" \"http://www.eclipse.org/jetty/configure_9_3.dtd\">\r\n<Configure id=\"exist-webapp-context\" class=\"org.exist.jetty.WebAppContext\">\r\n    <!-- contextPath can be set to either '/exist' or '/' -->\r\n    <Set name=\"contextPath\">/exist</Set>\r\n    <Set name=\"war\">/etc/</Set>\r\n    <Set name=\"defaultsDescriptor\"><Property name=\"jetty.home\" default=\".\"/>/etc/jetty/webdefault.xml</Set>\r\n    <Set name=\"securityHandler\">\r\n        <New class=\"org.eclipse.jetty.security.ConstraintSecurityHandler\">\r\n            <Set name=\"loginService\">\r\n                <New class=\"org.eclipse.jetty.jaas.JAASLoginService\">\r\n                    <Set name=\"name\">Test JAAS Realm</Set>\r\n                    <Set name=\"loginModuleName\">JAASLoginService</Set>\r\n                </New>\r\n            </Set>\r\n        </New>\r\n    </Set>\r\n    <Call name=\"setAttribute\">\r\n        <Arg>org.eclipse.jetty.server.webapp.ContainerIncludeJarPattern</Arg>\r\n        <Arg>.*/[^/]*servlet-api-[^/]*\\.jar$|.*/javax.servlet.jsp.jstl-.*\\.jar$|.*/org.apache.taglibs.taglibs-standard-impl-.*\\.jar$|.*/content/.*\\.jar$</Arg>\r\n    </Call>\r\n</Configure>\r\n```\r\n\r\nNote the incorrect `<Set name=\"war\">/etc/</Set>` vs the correct `<Set name=\"war\"><Property name=\"jetty.home\" default=\".\"/>/etc/webapp</Set>`.\r\n\r\nTo fix it we likely need to add some further conditions to the templates in `jetty-deploy.xslt`", "url": "https://github.com/eXist-db/exist/issues/3017", "user": "adamretter", "labels": ["bug"], "created": "2019-09-13 11:58:06", "closed": "2020-03-03 17:13:08", "commits": {"f03ec41a3d78308ff263cd93c424a259c0731994": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 172.00027777777777, "commitsDetails": [{"commitHash": "f03ec41a3d78308ff263cd93c424a259c0731994", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["bc9b10d1abc61b86ea034b56de1fc85628d0f299", "23a0002ff5c616e9f2e4be002f2b1aa50133dcd4"], "nameRev": "f03ec41a3d78308ff263cd93c424a259c0731994 tags/eXist-5.1.0~10", "commitMessage": "Merge pull request #3097 from markhall82/feature/jetty-deploy-xslt\n\nFix for issue #3017, add extra condition to xslt so that it does not \u2026", "commitDateTime": "2019-11-15 11:20:18", "authoredDateTime": "2019-11-15 11:20:18", "commitGitStats": [{"filePath": "exist-distribution/src/main/xslt/jetty-deploy.xslt", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Wrong location webdav.properties", "body": "original report by @joewiz \r\n\r\n### What is the problem\r\nThe optional 'webdav.properties' should be in `EXIST_HOME/etc` and not in `EXIST_HOME` \r\n\r\n### What did you expect\r\nSee description\r\n\r\n### Describe how to reproduce or add a test\r\nStore the file in the right location for specific serialisation settings.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version +: v5.0\r\n- Java version (e.g. Java8u121) - Java8u20x\r\n- Operating system (Windows 7, Linux, MacOs) - macOS\r\n- 32 or 64 bit - 64bit\r\n- How is eXist-db installed? (JAR installer, DMG, WAR file, clone from GitHub) - any\r\n- Any custom changes in e.g. conf.xml - none\r\n\r\n\r\n### see\r\nhttps://github.com/eXist-db/exist/blob/develop/extensions/webdav/src/main/java/org/exist/webdav/ExistResourceFactory.java#L73-L88\r\nhttps://github.com/eXist-db/exist/blob/develop/exist-core/src/main/java/org/exist/jetty/JettyStart.java#L119-L124\r\nand best\r\nhttps://github.com/eXist-db/exist/blob/develop/exist-core/src/main/java/org/exist/launcher/WindowsServiceManager.java#L81-L82", "url": "https://github.com/eXist-db/exist/issues/3008", "user": "dizzzz", "labels": ["bug"], "created": "2019-09-08 18:08:34", "closed": "2019-09-10 10:49:54", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Loading via no-gui client complains about missing collection", "body": "Trying to load a bunch of files from an `output` directory via the no-gui JAC doesn't work. The following command:\r\n\r\n```\r\nclient.bat --collection /db/xmark --parse output/ --no-gui --user admin\r\n```\r\n\r\nGives the error:\r\n```\r\nPlease specify target collection with --collection\r\n```", "url": "https://github.com/eXist-db/exist/issues/3007", "user": "adamretter", "labels": ["bug"], "created": "2019-09-07 13:01:26", "closed": "2019-09-17 07:46:32", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "collection.xconf.init is not deployed at first startup in 5.x.x.", "body": "The `collection.xconf.init` is not being deployed the first time a new database is created in 5.x.x as it has now moved into the `etc/` subfolder.\r\n\r\nSee also - https://github.com/eXist-db/docker-existdb/issues/66", "url": "https://github.com/eXist-db/exist/issues/2976", "user": "adamretter", "labels": ["bug"], "created": "2019-08-25 13:09:40", "closed": "2019-08-28 14:07:11", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "semver missing in current development branch", "body": "### What is the problem\r\n\r\nBuilding the current development branch and then logging in to the dashboard throws an exception because it cannot find semver.  The Launcher displays no apps and the package manager cannot create a list of packages.  The Javascript console shows 500 errors and exist.log shows \"`Error while loading module modules/packages.xqm: error found while loading module semver: failed to load module: 'http://exist-db.org/xquery/semver' from: 'http://exist-db.org/xquery/semver', location: 'http://exist-db.org/xquery/semver'. Source not found`.\"\r\n\r\n### What did you expect\r\n\r\nNormal dashboard behavior.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n```\r\ngit checkout develop\r\ngit pull\r\ngit clean -xdf\r\nmvn -q clean package -DskipTests\r\nexist-distribution/target/exist-distribution-5.1.0-SNAPSHOT-dir/bin/startup.sh\r\n```\r\n\r\neXist start-up looks fine, but:\r\n\r\nNavigate to localhost:8080 in a browser and log in as admin.  The login appears to succeed but any attempt to access packages fails.  Here's the full stack dump from exist.log:\r\n\r\n```\r\n2019-08-23 17:43:30,682 [qtp1105958076-47] WARN  (TransactionManager.java [close]:400) - Transaction was not committed or aborted, auto aborting!\r\n2019-08-23 17:43:31,212 [qtp1105958076-46] WARN  (HttpChannel.java [handleException]:600) - /exist/apps/packageservice/packages/apps\r\njavax.servlet.ServletException: javax.servlet.ServletException: An error occurred while processing request to /exist/apps/packageservice/packages/apps: err:XQST0059 error found while loading module packages: Error while loading module modules/packages.xqm: error found while loading module semver: failed to load module: 'http://exist-db.org/xquery/semver' from: 'http://exist-db.org/xquery/semver', location: 'http://exist-db.org/xquery/semver'. Source not found.\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:162) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:772) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:494) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:374) [jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:268) [jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311) [jetty-io-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) [jetty-io-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:117) [jetty-io-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:336) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:313) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:171) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:129) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:367) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:782) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:918) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_201]\r\nCaused by: javax.servlet.ServletException: An error occurred while processing request to /exist/apps/packageservice/packages/apps: err:XQST0059 error found while loading module packages: Error while loading module modules/packages.xqm: error found while loading module semver: failed to load module: 'http://exist-db.org/xquery/semver' from: 'http://exist-db.org/xquery/semver', location: 'http://exist-db.org/xquery/semver'. Source not found.\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:370) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790) ~[javax.servlet-api-3.1.0.jar:3.1.0]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:844) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1604) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:226) ~[websocket-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1591) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:542) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:512) ~[jetty-security-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:512) ~[jetty-security-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:235) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1581) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1307) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:482) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1549) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1204) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:221) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\t... 16 more\r\nCaused by: org.exist.xquery.XPathException: err:XQST0059 error found while loading module packages: Error while loading module modules/packages.xqm: error found while loading module semver: failed to load module: 'http://exist-db.org/xquery/semver' from: 'http://exist-db.org/xquery/semver', location: 'http://exist-db.org/xquery/semver'. Source not found.\r\n\tat org.exist.xquery.ModuleContext.moduleLoadException(ModuleContext.java:254) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.ModuleContext.moduleLoadException(ModuleContext.java:237) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.compileModule(XQueryContext.java:2466) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.compileOrBorrowModule(XQueryContext.java:2439) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.importModule(XQueryContext.java:2392) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.importDecl(XQueryTreeParser.java:6321) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:5340) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.libraryModule(XQueryTreeParser.java:4030) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:3861) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3642) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.compileModule(XQueryContext.java:2498) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.compileOrBorrowModule(XQueryContext.java:2439) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.importModule(XQueryContext.java:2364) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.importDecl(XQueryTreeParser.java:6312) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:5340) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.mainModule(XQueryTreeParser.java:4042) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:3987) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3642) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.compile(XQuery.java:128) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.compile(XQuery.java:79) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.compile(XQuery.java:71) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.runQuery(XQueryURLRewrite.java:669) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:243) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790) ~[javax.servlet-api-3.1.0.jar:3.1.0]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:844) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1604) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:226) ~[websocket-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1591) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:542) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:512) ~[jetty-security-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:512) ~[jetty-security-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:235) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1581) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1307) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:482) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1549) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1204) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:221) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\t... 16 more\r\n2019-08-23 17:43:34,724 [qtp1105958076-42] INFO  (LogFunction.java [writeLog]:214) - (Line: 55 /db/apps/dashboard/controller.xql) path /admin\r\n2019-08-23 17:43:34,725 [qtp1105958076-42] INFO  (LogFunction.java [writeLog]:214) - (Line: 56 /db/apps/dashboard/controller.xql) route\r\n2019-08-23 17:43:39,542 [qtp1105958076-46] INFO  (LogFunction.java [writeLog]:214) - (Line: 55 /db/apps/dashboard/controller.xql) path /admin\r\n2019-08-23 17:43:39,542 [qtp1105958076-46] INFO  (LogFunction.java [writeLog]:214) - (Line: 56 /db/apps/dashboard/controller.xql) route\r\n2019-08-23 17:43:39,785 [qtp1105958076-33] WARN  (HttpChannel.java [handleException]:600) - /exist/apps/dashboard/resources/images/existdb-web.svg\r\njavax.servlet.ServletException: javax.servlet.ServletException: An error occurred while processing request to /exist/apps/dashboard/resources/images/existdb-web.svg: null\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:162) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:772) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:494) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:374) [jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:268) [jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311) [jetty-io-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) [jetty-io-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:117) [jetty-io-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:336) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:313) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:171) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:129) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:367) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:782) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:918) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_201]\r\nCaused by: javax.servlet.ServletException: An error occurred while processing request to /exist/apps/dashboard/resources/images/existdb-web.svg: null\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:370) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790) ~[javax.servlet-api-3.1.0.jar:3.1.0]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:844) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1604) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:226) ~[websocket-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1591) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:542) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:512) ~[jetty-security-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:512) ~[jetty-security-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:235) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1581) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1307) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:482) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1549) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1204) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:221) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\t... 16 more\r\nCaused by: java.lang.NullPointerException\r\n\tat org.exist.util.WeakLazyStripes.get(WeakLazyStripes.java:202) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.storage.lock.LockManager.getCollectionLock(LockManager.java:204) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.storage.lock.LockManager.acquireCollectionReadLock(LockManager.java:231) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.storage.NativeBroker.readLockCollection(NativeBroker.java:1741) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.storage.NativeBroker.openCollection(NativeBroker.java:835) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.findDbControllerXql(XQueryURLRewrite.java:795) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.findSourceFromDb(XQueryURLRewrite.java:739) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.findSource(XQueryURLRewrite.java:720) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.getSourceInfo(XQueryURLRewrite.java:636) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.runQuery(XQueryURLRewrite.java:642) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:243) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790) ~[javax.servlet-api-3.1.0.jar:3.1.0]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:844) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1604) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:226) ~[websocket-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1591) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:542) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:512) ~[jetty-security-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:512) ~[jetty-security-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:235) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1581) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1307) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:482) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1549) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1204) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:221) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\t... 16 more\r\n2019-08-23 17:43:39,872 [qtp1105958076-40] WARN  (TransactionManager.java [close]:400) - Transaction was not committed or aborted, auto aborting!\r\n2019-08-23 17:43:40,327 [qtp1105958076-46] WARN  (HttpChannel.java [handleException]:600) - /exist/apps/packageservice/packages/apps\r\njavax.servlet.ServletException: javax.servlet.ServletException: An error occurred while processing request to /exist/apps/packageservice/packages/apps: err:XQST0059 error found while loading module packages: Error while loading module modules/packages.xqm: error found while loading module semver: failed to load module: 'http://exist-db.org/xquery/semver' from: 'http://exist-db.org/xquery/semver', location: 'http://exist-db.org/xquery/semver'. Source not found.\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:162) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:772) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:494) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:374) [jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:268) [jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311) [jetty-io-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:103) [jetty-io-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:117) [jetty-io-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:336) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:313) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:171) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:129) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:367) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:782) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:918) [jetty-util-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_201]\r\nCaused by: javax.servlet.ServletException: An error occurred while processing request to /exist/apps/packageservice/packages/apps: err:XQST0059 error found while loading module packages: Error while loading module modules/packages.xqm: error found while loading module semver: failed to load module: 'http://exist-db.org/xquery/semver' from: 'http://exist-db.org/xquery/semver', location: 'http://exist-db.org/xquery/semver'. Source not found.\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:370) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790) ~[javax.servlet-api-3.1.0.jar:3.1.0]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:844) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1604) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:226) ~[websocket-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1591) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:542) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:512) ~[jetty-security-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:512) ~[jetty-security-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:235) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1581) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1307) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:482) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1549) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1204) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:221) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\t... 16 more\r\nCaused by: org.exist.xquery.XPathException: err:XQST0059 error found while loading module packages: Error while loading module modules/packages.xqm: error found while loading module semver: failed to load module: 'http://exist-db.org/xquery/semver' from: 'http://exist-db.org/xquery/semver', location: 'http://exist-db.org/xquery/semver'. Source not found.\r\n\tat org.exist.xquery.ModuleContext.moduleLoadException(ModuleContext.java:254) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.ModuleContext.moduleLoadException(ModuleContext.java:237) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.compileModule(XQueryContext.java:2466) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.compileOrBorrowModule(XQueryContext.java:2439) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.importModule(XQueryContext.java:2392) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.importDecl(XQueryTreeParser.java:6321) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:5340) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.libraryModule(XQueryTreeParser.java:4030) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:3861) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3642) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.compileModule(XQueryContext.java:2498) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.compileOrBorrowModule(XQueryContext.java:2439) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.importModule(XQueryContext.java:2364) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.importDecl(XQueryTreeParser.java:6312) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:5340) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.mainModule(XQueryTreeParser.java:4042) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:3987) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3642) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.compile(XQuery.java:128) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.compile(XQuery.java:79) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.compile(XQuery.java:71) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.runQuery(XQueryURLRewrite.java:669) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:243) ~[exist-core-5.1.0-SNAPSHOT.jar:5.1.0-SNAPSHOT]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790) ~[javax.servlet-api-3.1.0.jar:3.1.0]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:844) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1604) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:226) ~[websocket-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1591) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:542) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:512) ~[jetty-security-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:512) ~[jetty-security-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:235) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1581) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1307) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:482) ~[jetty-servlet-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1549) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1204) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:221) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146) ~[jetty-server-9.4.20.v20190813.jar:9.4.20.v20190813]\r\n\t... 16 more\r\n```\r\n\r\n\r\nexpath-repo.log also has this:\r\n\r\n`2019-08-23 17:43:40,053 [qtp1105958076-46] DEBUG (Package.java [resolveInThisPackage]:101) - Package 'http://exist-db.org/apps/shared', not in XQUERY: 'http://exist-db.org/xquery/semver'`\r\n\r\n### Context information\r\n\r\n```\r\n$ git describe\r\neXist-5.0.0-RC1-1237-gf982fa6e9\r\n$ java -version\r\njava version \"1.8.0_201\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_201-b09)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.201-b09, mixed mode)\r\n$ uname -av\r\nDarwin triamond.local 18.7.0 Darwin Kernel Version 18.7.0: Thu Jun 20 18:42:21 PDT 2019; root:xnu-4903.270.47~4/RELEASE_X86_64 x86_64\r\n$ mvn -v\r\nApache Maven 3.6.1 (d66c9c0b3152b2e69ee9bac180bb8fcc8e6af555; 2019-04-04T14:00:29-05:00)\r\nMaven home: /usr/local/Cellar/maven/3.6.1/libexec\r\nJava version: 1.8.0_201, vendor: Oracle Corporation, runtime: /Library/Java/JavaVirtualMachines/jdk1.8.0_201.jdk/Contents/Home/jre\r\nDefault locale: en_US, platform encoding: UTF-8\r\nOS name: \"mac os x\", version: \"10.14.6\", arch: \"x86_64\", family: \"mac\"\r\n```\r\n", "url": "https://github.com/eXist-db/exist/issues/2973", "user": "craigberry", "labels": ["bug"], "created": "2019-08-23 23:24:16", "closed": "2019-08-25 14:24:20", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "SwitchUserFunction can cause security leak", "body": "As described here - https://github.com/eXist-db/dashboard/issues/92\r\nAfter logging into the Dashboard on eXist-db 5.0.0-RC8 and clicking User Manager, then you will see the following in the logs:\r\n\r\n```\r\n2019-06-28 15:53:38,136 [qtp732118572-52] WARN  (BrokerPool.java [release]:1327) - Broker org.exist.storage.NativeBroker_exist_5 was returned with extraneous Subjects, cleaning... \r\njava.lang.IllegalStateException: DBBroker pushSubject/popSubject mismatch\r\n\tat org.exist.storage.BrokerPool.release(BrokerPool.java:1327) [exist-core-5.0.0-RC8-SNAPSHOT.jar:5.0.0-RC8-SNAPSHOT]\r\n\tat org.exist.storage.DBBroker.close(DBBroker.java:1039) [exist-core-5.0.0-RC8-SNAPSHOT.jar:5.0.0-RC8-SNAPSHOT]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:320) [exist-core-5.0.0-RC8-SNAPSHOT.jar:5.0.0-RC8-SNAPSHOT]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790) [javax.servlet-api-3.1.0.jar:3.1.0]\r\n```\r\n\r\n---\r\n\r\nIf you trace the `pushSubject/popSubject` calls you will find the issue is via `org.exist.xquery.UserSwitchingBasicFunction` being used by the Persistent Login module's `org.exist.xquery.modules.persistentlogin.PersistentLoginFunctions`.\r\n\r\nYou will see the following calls in `UserSwitchingBasicFunction`:\r\n1. `UserSwitchingBasicFunction@8067#switchUser(admin)` [`pushedSubject`==`false`] -> `DBBroker#pushSubject`    (line 96/col 5 - persistentlogin/login.xql)\r\n2. `UserSwitchingBasicFunction@8450#switchUser(admin)` [`pushedSubject`==`false`] -> `DBBroker#pushSubject`\t(line 96/col 5 - persistentlogin/login.xql)\r\n3. `UserSwitchingBasicFunction@8450#switchUser(admin)` [`pushedSubject`==`true`] -> `DBBroker#pushSubject`\t\t(line 96/col 5 - persistentlogin/login.xql)\r\n4. `UserSwitchingBasicFunction@8067#resetState()` [`pushedSubject`==`true`] -> `DBBroker#popSubject`\r\n5. `UserSwitchingBasicFunction@8450#resetState()` [`pushedSubject`==`true`] -> `DBBroker#popSubject`\r\n\r\nThe issue appears to be call (3). It is not clear to me why eXist-db is calling `switchUser` twice on the same (@8450) `UserSwitchingBasicFunction` object.\r\n\r\nI expected that each `switchUser` XQuery call would get a new instance of `UserSwitchingBasicFunction`", "url": "https://github.com/eXist-db/exist/issues/2922", "user": "adamretter", "labels": ["bug", "high prio", "security"], "created": "2019-08-05 13:33:17", "closed": "2019-08-06 08:27:07", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "changing admin password in Java client throws unauthorized exception", "body": "With a fresh install of 5.0-RC8 on macOS Mojave using the DMG installer, I used the Java Admin client to change the admin password from its default (blank) value to a new non-blank value (after first logging in with the blank value).  As soon as I clicked Save, it threw the exception below and was unable to perform any other operations.  \r\n\r\nThe password change had apparently succeeded since after quitting the client and restarting I could log in with the password I had entered.  I guess what I'm asking is would it be possible to have the client re-authenticate you after it's successfully updated the password for the account under which you are logged in.\r\n\r\n```\r\norg.xmldb.api.base.XMLDBException: HTTP server returned unexpected status: Unauthorized\r\n\tat org.exist.xmldb.RemoteCollection.instance(RemoteCollection.java:109)\r\n\tat org.exist.xmldb.RemoteCollection.instance(RemoteCollection.java:85)\r\n\tat org.exist.xmldb.DatabaseImpl.readCollection(DatabaseImpl.java:278)\r\n\tat org.exist.xmldb.DatabaseImpl.getRemoteCollection(DatabaseImpl.java:240)\r\n\tat org.exist.xmldb.DatabaseImpl.getCollection(DatabaseImpl.java:180)\r\n\tat org.exist.xmldb.DatabaseImpl.getCollection(DatabaseImpl.java:169)\r\n\tat org.xmldb.api.DatabaseManager.getCollection(DatabaseManager.java:235)\r\n\tat org.exist.client.InteractiveClient.connect(InteractiveClient.java:300)\r\n\tat org.exist.client.ClientFrame.reconnectClient(ClientFrame.java:514)\r\n\tat org.exist.client.security.UserManagerDialog.reconnectClientAndUserManager(UserManagerDialog.java:370)\r\n\tat org.exist.client.security.UserManagerDialog.lambda$8(UserManagerDialog.java:384)\r\n\tat org.exist.client.security.EditUserDialog.createUser(EditUserDialog.java:104)\r\n\tat org.exist.client.security.UserDialog.btnCreateActionPerformed(UserDialog.java:329)\r\n\tat javax.swing.AbstractButton.fireActionPerformed(AbstractButton.java:2022)\r\n\tat javax.swing.AbstractButton$Handler.actionPerformed(AbstractButton.java:2348)\r\n\tat javax.swing.DefaultButtonModel.fireActionPerformed(DefaultButtonModel.java:402)\r\n\tat javax.swing.DefaultButtonModel.setPressed(DefaultButtonModel.java:259)\r\n\tat javax.swing.plaf.basic.BasicButtonListener.mouseReleased(BasicButtonListener.java:252)\r\n\tat java.awt.Component.processMouseEvent(Component.java:6539)\r\n\tat javax.swing.JComponent.processMouseEvent(JComponent.java:3324)\r\n\tat java.awt.Component.processEvent(Component.java:6304)\r\n\tat java.awt.Container.processEvent(Container.java:2239)\r\n\tat java.awt.Component.dispatchEventImpl(Component.java:4889)\r\n\tat java.awt.Container.dispatchEventImpl(Container.java:2297)\r\n\tat java.awt.Component.dispatchEvent(Component.java:4711)\r\n\tat java.awt.LightweightDispatcher.retargetMouseEvent(Container.java:4904)\r\n\tat java.awt.LightweightDispatcher.processMouseEvent(Container.java:4535)\r\n\tat java.awt.LightweightDispatcher.dispatchEvent(Container.java:4476)\r\n\tat java.awt.Container.dispatchEventImpl(Container.java:2283)\r\n\tat java.awt.Window.dispatchEventImpl(Window.java:2746)\r\n\tat java.awt.Component.dispatchEvent(Component.java:4711)\r\n\tat java.awt.EventQueue.dispatchEventImpl(EventQueue.java:760)\r\n\tat java.awt.EventQueue.access$500(EventQueue.java:97)\r\n\tat java.awt.EventQueue$3.run(EventQueue.java:709)\r\n\tat java.awt.EventQueue$3.run(EventQueue.java:703)\r\n\tat java.security.AccessController.doPrivileged(Native Method)\r\n\tat java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:74)\r\n\tat java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:84)\r\n\tat java.awt.EventQueue$4.run(EventQueue.java:733)\r\n\tat java.awt.EventQueue$4.run(EventQueue.java:731)\r\n\tat java.security.AccessController.doPrivileged(Native Method)\r\n\tat java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:74)\r\n\tat java.awt.EventQueue.dispatchEvent(EventQueue.java:730)\r\n\tat java.awt.EventDispatchThread.pumpOneEventForFilters(EventDispatchThread.java:205)\r\n\tat java.awt.EventDispatchThread.pumpEventsForFilter(EventDispatchThread.java:116)\r\n\tat java.awt.EventDispatchThread.pumpEventsForHierarchy(EventDispatchThread.java:105)\r\n\tat java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:101)\r\n\tat java.awt.EventDispatchThread.pumpEvents(EventDispatchThread.java:93)\r\n\tat java.awt.EventDispatchThread.run(EventDispatchThread.java:82)\r\nCaused by: org.apache.xmlrpc.client.XmlRpcHttpTransportException: HTTP server returned unexpected status: Unauthorized\r\n\tat org.apache.xmlrpc.client.XmlRpcSunHttpTransport.getInputStream(XmlRpcSunHttpTransport.java:94)\r\n\tat org.apache.xmlrpc.client.XmlRpcStreamTransport.sendRequest(XmlRpcStreamTransport.java:152)\r\n\tat org.apache.xmlrpc.client.XmlRpcHttpTransport.sendRequest(XmlRpcHttpTransport.java:143)\r\n\tat org.apache.xmlrpc.client.XmlRpcSunHttpTransport.sendRequest(XmlRpcSunHttpTransport.java:69)\r\n\tat org.apache.xmlrpc.client.XmlRpcClientWorker.execute(XmlRpcClientWorker.java:56)\r\n\tat org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:167)\r\n\tat org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:158)\r\n\tat org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:147)\r\n\tat org.exist.xmldb.RemoteCollection.instance(RemoteCollection.java:97)\r\n\t... 48 more\r\n```", "url": "https://github.com/eXist-db/exist/issues/2918", "user": "craigberry", "labels": ["bug"], "created": "2019-08-03 21:27:06", "closed": "2019-08-06 08:41:05", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Restoring a backup overwrites newer apps", "body": "When restoring a backup, if the backup contains older apps, then can easily overwrite the newer apps, or worse you end up with a mess of old apps with some orphaned newer files.\r\n\r\nRestore should detect app versions and offer the user a choice about whether to replace the newer version with the older version, or ignore the older version.\r\n\r\nExample:\r\n---\r\n**NOTE**: EXPath Apps shipped with previous version of eXist-db, are not guaranteed to be forwards compatible with RC8. As such when restoring a backup to RC8 you should at least exclude the following from your `/db/apps` folder:\r\n1. `/db/apps/dashboard`\r\n2. `/db/apps/doc`\r\n3. `/db/apps/eXide`\r\n4. `/db/apps/fundocs`\r\n5. `/db/apps/markdown`\r\n6. `/db/apps/monex`\r\n7. `/db/apps/packageservice`\r\n8. `/db/apps/shared-resources`\r\n\r\nIf in doubt, you should consider excluding `/db/apps` entrirely from your backup archive during the restore, and then subsequently installing the latest versions of the Apps you need via the Dashboard's Package Manager.", "url": "https://github.com/eXist-db/exist/issues/2914", "user": "adamretter", "labels": ["bug"], "created": "2019-08-03 09:58:16", "closed": "2019-08-30 10:07:32", "commits": {}, "ttf": 27.00027777777778, "commitsDetails": []}, {"title": "Race condition when invoking org.exist.backup.ExportMain", "body": "### What is the problem\r\nWhen invoking `org.exist.backup.ExportMain` for a data export. In some cases the export process locks itself and can only be hard terminated.\r\n\r\n### Describe how to reproduce or add a test\r\nIn order to reproduce the issue reliably apply the following patch to `develop`\r\n```diff\r\ndiff --git a/exist-core/src/main/java/org/exist/storage/BrokerPool.java b/exist-core/src/main/java/org/exist/storage/BrokerPool.java\r\nindex da668df843..ceab3fcc56 100644\r\n--- a/exist-core/src/main/java/org/exist/storage/BrokerPool.java\r\n+++ b/exist-core/src/main/java/org/exist/storage/BrokerPool.java\r\n@@ -406,7 +406,7 @@ public class BrokerPool extends BrokerPools implements BrokerPoolConstants, Data\r\n         this.maxBrokers = conf.getProperty(PROPERTY_MAX_CONNECTIONS, maxBrokers);\r\n         LOG.info(\"database instance '\" + instanceName + \"' will have between \" + nf.format(this.minBrokers) + \" and \" + nf.format(this.maxBrokers) + \" brokers\");\r\n \r\n-        this.majorSyncPeriod = conf.getProperty(PROPERTY_SYNC_PERIOD, DEFAULT_SYNCH_PERIOD);\r\n+        this.majorSyncPeriod = 200; //conf.getProperty(PROPERTY_SYNC_PERIOD, DEFAULT_SYNCH_PERIOD);\r\n         LOG.info(\"database instance '\" + instanceName + \"' will be synchronized every \" + nf.format(/*this.*/majorSyncPeriod) + \" ms\");\r\n \r\n         // convert from bytes to megabytes: 1024 * 1024\r\n@@ -536,7 +536,7 @@ public class BrokerPool extends BrokerPools implements BrokerPoolConstants, Data\r\n         if(majorSyncPeriod > 0) {\r\n             final SyncTask syncTask = new SyncTask();\r\n             syncTask.configure(conf, null);\r\n-            scheduler.createPeriodicJob(2500, new SystemTaskJobImpl(SyncTask.getJobName(), syncTask), 2500);\r\n+            scheduler.createPeriodicJob(200, new SystemTaskJobImpl(SyncTask.getJobName(), syncTask), 200);\r\n         }\r\n \r\n         try {\r\n```\r\nAfter building a distribution and installing it perform the following command in the `lib` folder of the root installation directory:\r\n\r\n```bash\r\njava -cp $(find . -name '*.jar' -printf '%p:' | sed 's/:$//') -Xmx2g -Dexist.home=/<exist_root_instal_directory>/etc  org.exist.backup.ExportMain -x -z -d /tmp/exist_backup_test -v\r\n```\r\n", "url": "https://github.com/eXist-db/exist/issues/2893", "user": "reinhapa", "labels": ["bug", "high prio"], "created": "2019-07-23 17:32:23", "closed": "2019-08-29 15:12:37", "commits": {}, "ttf": 36.000277777777775, "commitsDetails": []}, {"title": "Restore: wrong location data directory", "body": "### What is the problem\r\nWhen running restore of a backup file, in localmode, an \"unexpected\" location is used for the data directory.\r\n\r\n### What did you expect\r\nUse the data directory `EXIST_HOME/data` in stead of `EXIST_HOME/../data`\r\n\r\n### Describe how to reproduce or add a test\r\nRun\r\n\r\n```\r\nbin\\backup.bat -r full20190409-0300.zip -ouri=xmldb:exist:/// -R -q -P \"password\"\r\n```\r\n\r\nthe data directory is actually written in the directory `exist-distribution\\target\\data` in stead of `exist-distribution\\target\\exist-distribution-5.0.0-RC8-SNAPSHOT-dir`\r\n\r\nthe current directory is `exist-distribution\\target\\exist-distribution-5.0.0-RC8-SNAPSHOT-dir`\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version : v5 RCx\r\n- Java version (e.g. Java8u201)\r\n- Operating system (Windows 10)\r\n- 64 bit\r\n- How is eXist-db installed? (clone from GitHub, exist-distribution-5.0.0-RC8-SNAPSHOT-dir)\r\n- Any custom changes in e.g. conf.xml - none\r\n", "url": "https://github.com/eXist-db/exist/issues/2874", "user": "dizzzz", "labels": ["bug", "high prio", "needs develop port", "needs resolution", "regression"], "created": "2019-07-12 14:50:39", "closed": "2019-08-06 08:30:26", "commits": {}, "ttf": 24.00027777777778, "commitsDetails": []}, {"title": "NPE with MimeTable when running xq suite tests", "body": "### What is the problem\r\nWhen running the Mongrel XAR test suite, There is a NPE stack trace, shown below\r\n\r\n### What did you expect\r\nClean build\r\n\r\n### Describe how to reproduce or add a test\r\nCheckout mongrel, change exist-db to version 4.6.0 or 5.0.0-RC6 and run `mvn clean install`\r\n\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version: 4.6.0 or 5.0.0-RC6 // mongrel from git@github.com:weXsol/Mongrel.git \r\n- Java version (e.g. Java8u201)\r\n- Operating system ( MacOs)\r\n- 64 bit\r\n- How is eXist-db installed? n/a - man dependency\r\n- Any custom changes in e.g. conf.xml -  none\r\n\r\n\r\n```\r\nERROR StatusLogger No Log4j 2 configuration file found. Using default configuration (logging only errors to the console), or user programmatically provided configurations. Set system property 'log4j2.debug' to show Log4j 2 internal initialization logging. See https://logging.apache.org/log4j/2.x/manual/configuration.html for instructions on how to configure Log4j 2\r\n21:29:02.442 [main] ERROR org.exist.util.MimeTable - Failed to load mime-type table from class loader\r\n21:29:02.506 [main] ERROR org.exist.util.MimeTable - Failed to load mime-type table from class loader\r\njava.net.MalformedURLException: null\r\n\tat java.net.URL.<init>(URL.java:627) ~[?:1.8.0_212]\r\n\tat java.net.URL.<init>(URL.java:490) ~[?:1.8.0_212]\r\n\tat java.net.URL.<init>(URL.java:439) ~[?:1.8.0_212]\r\n\tat org.apache.xerces.impl.XMLEntityManager.setupCurrentEntity(Unknown Source) ~[xercesImpl-2.12.0.jar:2.12.0]\r\n\tat org.apache.xerces.impl.XMLVersionDetector.determineDocVersion(Unknown Source) ~[xercesImpl-2.12.0.jar:2.12.0]\r\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source) ~[xercesImpl-2.12.0.jar:?]\r\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source) ~[xercesImpl-2.12.0.jar:?]\r\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source) ~[xercesImpl-2.12.0.jar:?]\r\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source) ~[xercesImpl-2.12.0.jar:?]\r\n\tat org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source) ~[xercesImpl-2.12.0.jar:?]\r\n\tat org.exist.util.MimeTable.loadMimeTypes(MimeTable.java:290) ~[exist-core-5.0.0-RC6.jar:5.0.0-RC6]\r\n\tat org.exist.util.MimeTable.load(MimeTable.java:263) [exist-core-5.0.0-RC6.jar:5.0.0-RC6]\r\n\tat org.exist.util.MimeTable.load(MimeTable.java:214) [exist-core-5.0.0-RC6.jar:5.0.0-RC6]\r\n\tat org.exist.util.MimeTable.<init>(MimeTable.java:115) [exist-core-5.0.0-RC6.jar:5.0.0-RC6]\r\n\tat org.exist.util.MimeTable.getInstance(MimeTable.java:83) [exist-core-5.0.0-RC6.jar:5.0.0-RC6]\r\n\tat org.exist.util.XMLFilenameFilter.asPredicate(XMLFilenameFilter.java:20) [exist-core-5.0.0-RC6.jar:5.0.0-RC6]\r\n\tat org.exist.test.runner.XSuite.getRunner(XSuite.java:196) [exist-testkit-5.0.0-RC6.jar:5.0.0-RC6]\r\n\tat org.exist.test.runner.XSuite.getRunners(XSuite.java:176) [exist-testkit-5.0.0-RC6.jar:5.0.0-RC6]\r\n\tat org.exist.test.runner.XSuite.<init>(XSuite.java:135) [exist-testkit-5.0.0-RC6.jar:5.0.0-RC6]\r\n\tat org.exist.test.runner.XSuite.<init>(XSuite.java:103) [exist-testkit-5.0.0-RC6.jar:5.0.0-RC6]\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) [?:1.8.0_212]\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62) [?:1.8.0_212]\r\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) [?:1.8.0_212]\r\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:423) [?:1.8.0_212]\r\n\tat org.junit.internal.builders.AnnotatedBuilder.buildRunner(AnnotatedBuilder.java:107) [junit-4.12.jar:4.12]\r\n\tat org.junit.internal.builders.AnnotatedBuilder.runnerForClass(AnnotatedBuilder.java:86) [junit-4.12.jar:4.12]\r\n\tat org.junit.runners.model.RunnerBuilder.safeRunnerForClass(RunnerBuilder.java:59) [junit-4.12.jar:4.12]\r\n\tat org.junit.internal.builders.AllDefaultPossibilitiesBuilder.runnerForClass(AllDefaultPossibilitiesBuilder.java:26) [junit-4.12.jar:4.12]\r\n\tat org.junit.runners.model.RunnerBuilder.safeRunnerForClass(RunnerBuilder.java:59) [junit-4.12.jar:4.12]\r\n\tat org.junit.internal.requests.ClassRequest.getRunner(ClassRequest.java:33) [junit-4.12.jar:4.12]\r\n\tat org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:250) [surefire-junit4-2.12.4.jar:2.12.4]\r\n\tat org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:141) [surefire-junit4-2.12.4.jar:2.12.4]\r\n\tat org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:112) [surefire-junit4-2.12.4.jar:2.12.4]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_212]\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_212]\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_212]\r\n\tat java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_212]\r\n\tat org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:189) [surefire-api-2.12.4.jar:2.12.4]\r\n\tat org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:165) [surefire-booter-2.12.4.jar:2.12.4]\r\n\tat org.apache.maven.surefire.booter.ProviderFactory.invokeProvider(ProviderFactory.java:85) [surefire-booter-2.12.4.jar:2.12.4]\r\n\tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:115) [surefire-booter-2.12.4.jar:2.12.4]\r\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:75) [surefire-booter-2.12.4.jar:2.12.4]\r\nCaused by: java.lang.NullPointerException\r\n\tat java.net.URL.<init>(URL.java:532) ~[?:1.8.0_212]\r\n\t... 41 more\r\n```", "url": "https://github.com/eXist-db/exist/issues/2811", "user": "dizzzz", "labels": ["bug", "wontfix"], "created": "2019-06-13 19:34:00", "closed": "2019-06-13 21:57:38", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "descriptor.xml not properly registered", "body": "### What is the problem\r\nUpon start of exist we get the following warnings:\r\n```\r\n13 Jun 2019 10:39:51,084 [qtp606365803-40] WARN  (Descriptor.java [<init>]:100) - Giving up unable to read descriptor file from /exist/descriptor.xml \r\n13 Jun 2019 10:39:51,084 [qtp606365803-40] WARN  (Descriptor.java [<init>]:113) - Giving up unable to read descriptor.xml file from classloader in package org.exist.http, eXist-db Core, version 5.0 \r\n```\r\n\r\nYet the file `descriptor.xml` is present at `exist/etc`, so chances are exist is looking in the wrong location\r\n\r\n### What did you expect\r\nExist to know where to look for this file, and find it.              \r\n\r\n### Describe how to reproduce or add a test\r\nStart exist and check `exist.log`\r\n\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version 5.0.0-RC8-SNAPSHOT\r\n- Java version (8)\r\n- OS Docker\r\n- 64 bit", "url": "https://github.com/eXist-db/exist/issues/2808", "user": "duncdrum", "labels": ["bug", "regression"], "created": "2019-06-13 11:07:45", "closed": "2020-03-04 17:47:23", "commits": {}, "ttf": 265.0002777777778, "commitsDetails": []}, {"title": "[BUG] string-length() after simple map operator", "body": "Thank you for reporting your issue!\r\n\r\nTo be able to better understand you problem or suggestion, please add as much information as possible to this ticket. When there is no or just little information, it will be too difficult to work on it (and hence we will not be able to solve it)\r\n\r\nPlease fill in the following sections:\r\n\r\n### What is the problem\r\n> Describe exactly what you see (e.g. an output of an XQuery) \r\n\r\nIn eXide, `1 ! string-length(.)` incorrectly returns `1`. It should raise a type error. \r\n\r\n### What did you expect\r\n> Describe what you expected to happen. Add for example a reference to a [specification](https://www.w3.org/TR/xquery-3/).\r\n\r\n`1 ! string-length()` (no dot inside the parentheses) correctly returns `1`. The reason different behavior with and without the dot is expected is explained at <https://www.biglist.com/lists/lists.mulberrytech.com/xsl-list/archives/201906/msg00021.html>. Saxon correctly implements the different behavior. And eXist correctly raises a type error with `string-length(1)`.\r\n\r\n### Describe how to reproduce or add a test\r\n> Describe how we can can reproduce the problem.\r\n\r\nType `1 ! string-length(.)` into eXide and press the Eval button.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version + Git Revision hash e.g. eXist-db 3.0 /  acd0c14 : exist-db 4.4\r\n- Java version (e.g. Java8u121) : Java 8\r\n- Operating system (Windows 7, Linux, MacOs) : Centos 6\r\n- 32 or 64 bit : 64 bit\r\n- How is eXist-db installed? (JAR installer, DMG, WAR file, clone from GitHub) : jar\r\n- Any custom changes in e.g. conf.xml : no\r\n", "url": "https://github.com/eXist-db/exist/issues/2798", "user": "djbpitt", "labels": ["bug", "xquery"], "created": "2019-06-10 06:25:50", "closed": "2020-04-11 15:16:57", "commits": {}, "ttf": 306.0002777777778, "commitsDetails": []}, {"title": "Rebuilding eXist-db with 'mvn package' fails with an error ", "body": "### What is the problem\r\nCalling `mvn package -DskipTests` twice fails with an error. If `mvn clean package -DskipTests` and running eXist-db from $EXIST/exist-distribution/target/exist-distribution-5.0.0-RC8-SNAPSHOT-dir/ will delete the current database and install a new version into exist-distribution-5.0.0-RC8-SNAPSHOT-dir/\r\n\r\n\r\n### What did you expect\r\nTo be able to execute `mvn package -DskipTests` without any error and without loosing the existing database. \r\n \r\n### Describe how to reproduce or add a test\r\ncall `mvn package -DskipTests` twice. \r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db 5 develop branch\r\n- Java version: 1.8.0_201\r\n- Operating system MacOs (but will be a problem on all others too\r\n- 64 bit\r\n- installed from Github develop branch\r\n- no changes\r\n", "url": "https://github.com/eXist-db/exist/issues/2791", "user": "windauer", "labels": ["bug"], "created": "2019-06-07 12:54:45", "closed": "2019-06-19 08:01:47", "commits": {}, "ttf": 11.000277777777777, "commitsDetails": []}, {"title": "XPath general comparison optimisation bug", "body": "### What is the problem\r\nxpath bug.  Result sets are incorrect.\r\n\r\nfirst xpath is returning more than one item - (\"topicValue\",\"topicValue\")\r\nsecond xpath is not returning an empty set - (\"topicValue\")\r\n\r\n### What did you expect\r\nfirst xpath should have only returned 1 value - (\"topicValue\")\r\nsecond xpath should have returned an empty set - ()\r\n\r\n### Describe how to reproduce or add a test\r\n```\r\nlet $dita := \r\n    <dita>\r\n        <topic>\r\n            <prolog>\r\n                <metadata>\r\n                    <data name=\"topicType\" value=\"topicValue\"/>\r\n                </metadata>\r\n            </prolog>\r\n            <topic>\r\n                <prolog>\r\n                    <metadata>\r\n                        <data name=\"topicType\" value=\"topicValue\"/>\r\n                    </metadata>\r\n                </prolog>\r\n            </topic>\r\n        </topic>\r\n    </dita>\r\nlet $xpath1 := $dita/topic/prolog//data[@name eq 'topicType']/@value\r\nlet $xpath2 := $dita/topic/topic/topic/prolog//data[@name eq 'topicType']/@value\r\n```\r\n\r\n### Context information\r\n- eXist-db versions: 5.0.0-RC8-SNAPSHOT, 4.7.0, 4.6.1, 4.3.1, 3.4.1, 2.2\r\n- Java version: jdk 1.8.0_144\r\n- Operating system: Win 8.1, Win 10\r\n- 64 bit\r\n- install method: JAR installer\r\n- custom changes: none\r\n", "url": "https://github.com/eXist-db/exist/issues/2786", "user": "fjeneau9", "labels": ["bug"], "created": "2019-06-06 16:42:50", "closed": "2019-06-25 14:31:16", "commits": {}, "ttf": 18.00027777777778, "commitsDetails": []}, {"title": "hc:send-request on empty repsonse with status 404", "body": "### What is the problem\r\nThe httpclient (`hc:send-request`) throws err:ERROR on an empty resource. While other resources with status code 404 seems to be no problem.\r\n\r\n### What did you expect\r\nresponse header and no second item in the returning sequence\r\n\r\n### Describe how to reproduce or add a test\r\n```xq\r\nxquery version \"3.1\";\r\nhc:send-request(<hc:request href=\"https://d-nb.info/gnd/117444839/about/rdf\" method=\"get\"/>)\r\n```\r\neXist 3.5.0 returns an empty sequence, what is not what i expect as there is no information on the response headers, but at least there is no error.\r\neXist 5.0.0-RC8 throws `exerr:ERROR Header is not content type [at line 2, column 1]`\r\n\r\n### Context information\r\n- eXist-db 5.0.0-RC8 pulled from docker hub (tag latest)\r\n", "url": "https://github.com/eXist-db/exist/issues/2783", "user": "mathias-goebel", "labels": ["bug"], "created": "2019-06-04 13:10:15", "closed": "2019-06-14 11:04:28", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "Backups broken in develop", "body": "### What is the problem\r\nRestoring a backup created with current develop will result in all binary files missing. It doesn't matter if you restore into a remote or local instance. \r\n\r\nThe `__contents__.xml` descriptors inside the backup are missing entries for all binary files.\r\n\r\nBackup/restore was tested extensively not long ago, so this bug must have been introduced very recently.\r\n\r\n### Describe how to reproduce or add a test\r\nA backup is attached. On a fresh database, install a package which is not contained by default, e.g. the demo app. Create a backup via the dashboard and check the `__contents__.xml` files contained inside. They should be missing entries for all binary resources. Restoring the backup will thus miss all binary resources.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db 96993a5d3132f0469f13a46a5e6e0ccc99b837d4\r\n- Java version 1.8.0_181\r\n- Operating system (MacOs)\r\n\r\n[full20190530-1459.zip](https://github.com/eXist-db/exist/files/3237243/full20190530-1459.zip)\r\n", "url": "https://github.com/eXist-db/exist/issues/2767", "user": "wolfgangmm", "labels": ["bug", "high prio"], "created": "2019-05-30 13:09:10", "closed": "2019-06-02 08:05:28", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Memory assertion when doing backup with 4.7.0 ", "body": "Reading a XML document exceeding 16 MB in size via remote connection triggers the following error:\r\n```\r\njava.lang.AssertionError: memory values bigger than 16MB not supported\r\n\tat org.exist.util.io.MemoryContentsImpl.ensureCapacity(MemoryContentsImpl.java:114)\r\n\tat org.exist.util.io.MemoryContentsImpl.write(MemoryContentsImpl.java:194)\r\n\tat org.exist.util.io.MemoryContentsImpl.writeAtEnd(MemoryContentsImpl.java:216)\r\n\tat org.exist.util.io.OverflowToDiskStream.write(OverflowToDiskStream.java:106)\r\n```\r\nThe reason for the problem is a typo within the definition of the default in memory buffer of remote resources before buffering them to the local file system of the client. It declares a 64 MB buffer size instead of 4 MB\r\n\r\nMore details also available on the [Exist-open mailing list entry](https://github.com/eXist-db/exist/issues/2743)", "url": "https://github.com/eXist-db/exist/issues/2743", "user": "reinhapa", "labels": ["bug"], "created": "2019-05-25 08:24:23", "closed": "2019-05-26 09:15:02", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Installing service fails with OpenJDK", "body": "### What is the problem\r\nUsing windows 10, installing eXist as a service fails when using one of the OpenJDK-based Java distributions (tried Zulu and Amazon Corretto). According to procrun log, it fails to create Java and prints a \"file not found\".", "url": "https://github.com/eXist-db/exist/issues/2731", "user": "wolfgangmm", "labels": ["bug"], "created": "2019-05-23 18:12:21", "closed": "2019-05-27 11:45:33", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "comment nodes incorrectly unescaped?", "body": "\r\n### What is the problem\r\n\r\nCreate a document with the following contents:\r\n```\r\n<root>\r\n    <!-- text <a> &lt;b&gt;  -->\r\n</root>\r\n```\r\n\r\nSave it in exide or upload to db via webdav.\r\n\r\nReopen the document in exide or via webdav. The result will be:\r\n\r\n```\r\n<root>\r\n    <!-- text <a> <b>  -->\r\n</root>\r\n```\r\n\r\n### What did you expect\r\nAs far a I know, there is no need to escape anything inside XML comments, all characters are literal, the only restriction is the sequence '--' is not allowed. Therefore I expected the original contents of the document returned by existdb.\r\n\r\n\r\n### Context information\r\n- eXist-db version 4.4\r\n- Java version 1.8.0_161\r\n- Operating system Windows 10\r\n- 64 bit\r\n- How is eXist-db installed? JAR installer\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/2728", "user": "merenyics", "labels": ["bug"], "created": "2019-05-23 15:26:20", "closed": "2019-05-26 09:13:58", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "\"this IndexReader is closed\" error during reindex with facets", "body": "### What is the problem\r\n\r\nWhen using the facets feature in 5.0.0 (develop) with stock TEI Publisher (master), I am hitting a \u201cthis IndexReader is closed\u201d error when loading a page that queries facets during a reindex. For example, running `xmldb:reindex(\"/db/apps/tei-publisher\")` and then requesting http://localhost:8080/exist/apps/tei-publisher/modules/facets.xql?sort=title before the reindex is complete will yield a 500 error, culminating in:\r\n\r\n```\r\norg.apache.lucene.store.AlreadyClosedException: this IndexReader is closed\r\n    at org.apache.lucene.index.IndexReader.ensureOpen(IndexReader.java:276)\r\n    at org.apache.lucene.index.SegmentReader.getBinaryDocValues(SegmentReader.java:501)\r\n    at org.apache.lucene.facet.taxonomy.FastTaxonomyFacetCounts.count(FastTaxonomyFacetCounts.java:54)\r\n    at org.apache.lucene.facet.taxonomy.FastTaxonomyFacetCounts.<init>(FastTaxonomyFacetCounts.java:49)\r\n    at org.apache.lucene.facet.taxonomy.FastTaxonomyFacetCounts.<init>(FastTaxonomyFacetCounts.java:39)\r\n    at org.exist.indexing.lucene.LuceneIndexWorker.lambda$getFacets$3(LuceneIndexWorker.java:554)\r\n    at org.exist.indexing.lucene.LuceneIndex.withSearcher(LuceneIndex.java:259)\r\n    at org.exist.indexing.lucene.LuceneIndexWorker.getFacets(LuceneIndexWorker.java:554)\r\n    at org.exist.xquery.modules.lucene.Facets.addFacetsToMap(Facets.java:151)\r\n    at org.exist.xquery.modules.lucene.Facets.eval(Facets.java:141)\r\n```\r\n\r\nThis seems to describe the problem and a possible solution too:\r\n\r\nhttps://stackoverflow.com/questions/41437582/lucene-alreadyclosedexception-this-indexreader-is-closed\r\n\r\n### What did you expect\r\n\r\nI expected to be able to make requests to the application during reindexing without encountering a 500 error. I hope this is surmountable. Otherwise, production instances cannot perform reindexing or even perhaps loading large amounts of data.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nSee description above.\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: 5.0.0 (current develop)\r\n- Java version: OpenJDK 12.0.1+12\r\n- Operating system: macOS 10.14.5\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed? Built from source\r\n- Any custom changes in e.g. conf.xml: no\r\n", "url": "https://github.com/eXist-db/exist/issues/2700", "user": "joewiz", "labels": ["bug"], "created": "2019-05-21 17:29:19", "closed": "2019-05-22 18:24:33", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "fn:tokenize default case-insensitive", "body": "Hi, \r\n\r\nseems like fn.tokenize is  default case-insensitive for characters in the pattern and behaves as if the i-flag was specified.\r\n\r\ntry:\r\ntokenize('firstSecondThirdLast', '[A-Z]')\r\n\r\nShould split on the capital letters only, but splits on every character.\r\nThe error is found in the latest release, but also found in an earlier release I have tried.\r\n\r\nRegards,\r\nTrond ", "url": "https://github.com/eXist-db/exist/issues/2694", "user": "trondaal", "labels": ["bug"], "created": "2019-05-13 13:08:36", "closed": "2019-05-25 21:15:07", "commits": {}, "ttf": 12.000277777777777, "commitsDetails": []}, {"title": "Controller fails on first access to app", "body": "5.0/develop: the first time one tries to access the root page of any of the installed apps, only a collection is returned. The controller is not evaluated/fails due to the collection not being found.", "url": "https://github.com/eXist-db/exist/issues/2691", "user": "wolfgangmm", "labels": ["bug"], "created": "2019-05-13 10:56:14", "closed": "2019-05-14 19:02:21", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "IllegalMonitorState in LockTable", "body": "I encountered the following exception using current develop. Any idea what could cause it?\r\n\r\n```java\r\nCaused by: java.lang.IllegalMonitorStateException\r\n        at java.util.concurrent.locks.StampedLock.unlockRead(StampedLock.java:563) ~[?:1.8.0_181]\r\n        at org.exist.storage.lock.LockTable$Entries.unmerge(LockTable.java:385) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.storage.lock.LockTable.event(LockTable.java:230) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.storage.lock.LockTable.released(LockTable.java:126) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.storage.lock.LockManager.lambda$null$2(LockManager.java:201) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.storage.lock.LockManager.unlockAll(LockManager.java:249) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.storage.lock.LockManager.lambda$acquireCollectionReadLock$3(LockManager.java:201) ~[exist.jar:\r\n5.0.0-SNAPSHOT]\r\n        at org.exist.storage.lock.ManagedLock.close(ManagedLock.java:186) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.collections.LockedCollection.close(LockedCollection.java:90) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.storage.NativeBroker.getXMLResource(NativeBroker.java:2233) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.source.DBSource.isValid(DBSource.java:91) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.ExternalModuleImpl.moduleIsValid(ExternalModuleImpl.java:267) ~[exist.jar:5.0.0-SNAPSHO\r\nT]\r\n        at org.exist.xquery.XQueryContext.checkModulesValid(XQueryContext.java:1487) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.PathExpr.isValid(PathExpr.java:526) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.storage.XQueryPool.lambda$borrowCompiledXQuery$1(XQueryPool.java:183) ~[exist.jar:5.0.0-SNAPSH\r\nOT]\r\n        at com.github.benmanes.caffeine.cache.BoundedLocalCache.lambda$remap$16(BoundedLocalCache.java:2228) ~[caff\r\neine-2.6.2.jar:?]\r\n        at java.util.concurrent.ConcurrentHashMap.compute(ConcurrentHashMap.java:1877) ~[?:1.8.0_181]\r\n        at com.github.benmanes.caffeine.cache.BoundedLocalCache.remap(BoundedLocalCache.java:2194) ~[caffeine-2.6.2\r\n.jar:?]\r\n        at com.github.benmanes.caffeine.cache.BoundedLocalCache.computeIfPresent(BoundedLocalCache.java:2132) ~[caf\r\nfeine-2.6.2.jar:?]\r\n        at org.exist.storage.XQueryPool.borrowCompiledXQuery(XQueryPool.java:163) ~[exist.jar:5.0.0-SNAPSHOT]\r\n```", "url": "https://github.com/eXist-db/exist/issues/2685", "user": "wolfgangmm", "labels": ["bug"], "created": "2019-05-06 07:28:59", "closed": "2019-05-10 14:11:22", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "more string comparison bugs involving empty strings and collations", "body": "#1898 already fixed 'contains', but 'starts-with', 'ends-with' and indexOf may also cause exceptions when the string being compared is the empty string and a collation is in effect.\r\n\r\nThe following test cases should cover `starts-with` and `ends-with`, I'm not sure how to test for the `indexOf` bug:\r\n\r\n```xquery\r\ndeclare\r\n    %test:assertEquals(\"<a>xxx</a>\")\r\nfunction collations:non-empty-string-starts-with() {\r\n    doc(\"/db/collations-test/test.xml\")//a[starts-with(.,'x',\"?lang=en-US\")]\r\n};\r\n\r\n declare\r\n    %test:assertEmpty\r\nfunction collations:empty-string-starts-with() {\r\n    doc(\"/db/collations-test/test.xml\")//b[starts-with(.,'x',\"?lang=en-US\")]\r\n};\r\n\r\ndeclare\r\n    %test:assertEquals(\"<a>xxx</a>\")\r\nfunction collations:non-empty-string-ends-with() {\r\n    doc(\"/db/collations-test/test.xml\")//a[ends-with(.,'x',\"?lang=en-US\")]\r\n};\r\n\r\n declare\r\n    %test:assertEmpty\r\nfunction collations:empty-string-ends-with() {\r\n    doc(\"/db/collations-test/test.xml\")//b[ends-with(.,'x',\"?lang=en-US\")]\r\n};\r\n```\r\nThe fix should be very similar to how `contains` was handled.", "url": "https://github.com/eXist-db/exist/issues/2678", "user": "merenyics", "labels": ["bug"], "created": "2019-05-03 22:29:27", "closed": "2019-08-24 14:32:07", "commits": {}, "ttf": 112.00027777777778, "commitsDetails": []}, {"title": "Unable to start eXist-db.app", "body": "Related to #2171 and #1792\r\n\r\n### What is the problem\r\nStarting eXist-db.app with Java 12 on macOS (10.14.3) yields the following error:\r\n\r\n> This application requires that Java 8 or later be installed on your computer. Please download and install the latest version of Java from www.java.com and try again.\r\n\r\n### What did you expect\r\nI expected eXist-db.app to start with any version of Java 8 or higher.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n1. Install Java via `brew cask install java`. Opening a new Terminal window and running `java -version `should report Java 12.0.1.\r\n2. Install eXist-db via `brew cask install exist-db`.\r\n3. Start eXist-db.app via the GUI (clicking on exist-db icon in application folder) or use `$ /Applications/eXist-db.app/Contents/MacOS/eXist-JavaAppLauncher`, which produces the following output:\r\n\r\n`2019-04-27 10:53:29.516 eXist-JavaAppLauncher[671:12307] NSString *findJavaDylib(NSString *, _Bool, _Bool, _Bool, _Bool) Searching for a JRE.\r\n2019-04-27 10:53:29.517 eXist-JavaAppLauncher[671:12307] NSString *findJREDylib(int, _Bool, _Bool) JRE search exception: 'launch path not accessible'\r\n2019-04-27 10:53:29.587 eXist-JavaAppLauncher[671:12307] int launch(char *, int, char **) Launchpath: /Library/Java/JavaVirtualMachines/openjdk-12.0.1.jdk/Contents/Home/lib/jli/libjli.dylib\r\n2019-04-27 10:53:29.593 eXist-JavaAppLauncher[671:12307] int launch(char *, int, char **) Error launching JVM Runtime ((null)) Relative Path: '/Library/Java/JavaVirtualMachines/openjdk-12.0.1.jdk/Contents/Home' (dylib: /Library/Java/JavaVirtualMachines/openjdk-12.0.1.jdk/Contents/Home/lib/jli/libjli.dylib)\r\n  error: Diese Anwendung ben\u00f6tigt die Java 8 Laufzeitumgebung oder h\u00f6her auf Ihrem Computer installiert sein. Bitte installieren Sie die neueste Version von Java von www.java.com und erneut versuchen.`\r\n\r\n4. Checking `echo $JAVA_HOME` and `echo $EXIST_HOME` produces the following outputs:\r\n`/Library/Java/JavaVirtualMachines/openjdk-12.0.1.jdk/Contents/Home`\r\n\r\nand \r\n\r\n`/Applications/eXist-db.app/Contents/Resources/eXist-db`\r\n\r\n### Context information\r\n- eXist-db version 4.6.1\r\n- Java version 12.0.1\r\n- Operating system Mac OS 10.14.3\r\n- 64 bit\r\n- How is eXist-db installed? DMG", "url": "https://github.com/eXist-db/exist/issues/2658", "user": "Bpolitycki", "labels": ["Java12", "bug"], "created": "2019-04-27 09:00:21", "closed": "2019-04-29 04:22:44", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "ArrayIndexOutOfBoundsException in DocumentImpl.hasIdAttribute", "body": "### What is the problem\r\n> Describe exactly what you see (e.g. an output of an XQuery) \r\n\r\n8\r\n\r\nThat's right, the number 8 is returned by the XQuery file eightball.xql in the attachment.  My guess would be that's an 8-byte offset from a null pointer or element 8 of a 7-element sequence or something like that.  The exist log shows this:\r\n\r\n```\r\n2019-04-12 21:01:34,129 [qtp1390430007-859] ERROR (XQueryServlet.java [process]:552) - 8\r\njava.lang.ArrayIndexOutOfBoundsException: 8\r\n\tat org.exist.dom.memtree.DocumentImpl.hasIdAttribute(DocumentImpl.java:724) ~[exist.jar:4.7.0-SNAPSHOT]\r\n\tat org.exist.dom.memtree.DocumentImpl.selectById(DocumentImpl.java:691) ~[exist.jar:4.7.0-SNAPSHOT]\r\n...\r\n```\r\n\r\n### What did you expect\r\n\r\nThe attached reproducer works fine in eXist 4.3.1, but fails in the current develop and develop-4.x.x branches, e.g., \r\n\r\n```\r\n$ git describe\r\neXist-4.6.1-113-gb3b578bcf\r\n```\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nRestore the attached backup.  It contains one 7-line XML file (eightball.xml) and one 83-line XQuery script (eightball.xql).  Here's the details of what's in it:\r\n\r\n```\r\n$ unzip -l eightball-backup.zip\r\nArchive:  eightball-backup.zip\r\n  Length      Date    Time    Name\r\n---------  ---------- -----   ----\r\n      612  04-12-2019 21:24   db/apps/eightball/eightball.xml\r\n     2888  04-12-2019 21:24   db/apps/eightball/eightball.xql\r\n      869  04-12-2019 21:24   db/apps/eightball/__contents__.xml\r\n---------                     -------\r\n     4369                     3 files\r\n```\r\n\r\nRun eightball.xql in eXide (or whatever) and check your exist.log for the exception.  The reproducer is boiled down from thousands of lines of code, mostly from tei-simple.  The code won't make a great deal of sense as-is because of how much has been eliminated, but this is the smallest reproducer I could come up with, and obviously whatever is happening should not be exceeding an array bound.\r\n\r\n### Context information\r\n\r\nJava 1.8.0_201\r\n\r\n11 Apr 2019 12:13:19,007 [main] INFO  (JettyStart.java [run]:158) - [eXist Version : 4.7.0-SNAPSHOT]\r\n11 Apr 2019 12:13:19,008 [main] INFO  (JettyStart.java [run]:159) - [eXist Build : 201904111213]\r\n11 Apr 2019 12:13:19,008 [main] INFO  (JettyStart.java [run]:160) - [Git commit : b3b578bcf]\r\n11 Apr 2019 12:13:19,008 [main] INFO  (JettyStart.java [run]:162) - [Operating System : Mac OS X 10.14.4 x86_64]\r\n\r\n[eightball-backup.zip](https://github.com/eXist-db/exist/files/3075646/eightball-backup.zip)", "url": "https://github.com/eXist-db/exist/issues/2636", "user": "craigberry", "labels": ["bug"], "created": "2019-04-13 02:31:53", "closed": "2019-04-18 08:06:04", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "Incomprehensible warning messages in exist.log", "body": "### What is the problem\r\nNothing goes wrong but we get a lot of messages in the exist.log like these:\r\n\r\n```\r\n2019-04-02 15:34:42,729 [qtp1430358188-50914] WARN  (PathExpr.java [replace]:119) - Expression not found: $jblogin:key-db-username-column; in: false() \r\n2019-04-02 15:34:42,729 [qtp1430358188-50914] WARN  (PathExpr.java [replace]:119) - Expression not found: $jblogin:key-db-password-column; in: false() \r\n2019-04-02 15:34:42,729 [qtp1430358188-50914] WARN  (PathExpr.java [replace]:119) - Expression not found: $jblogin:key-db-exist-user; in: false() \r\n```\r\n\r\nThere are lots and lots of them. I tried to find out what they refer to but couldn't.\r\n\r\nSometimes it seems that eXist is warning me for a lookup in a map on a key that doesn't exist, but why should it? \r\n\r\n\r\n### What did you expect\r\nI see no reason why eXist would warn me. The code runs ok, no errors.\r\n\r\n### Describe how to reproduce or add a test\r\nThat's a problem, this is produced by a huge code base that isn't really portable. And I have no idea what exactly causes this. I'm sorry I cant be of more help here.\r\n\r\nI suppose (?) that it is possible to look in the code and find out at least where and why this message is produced?\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version + Git Revision: 4.4.0 (Build 201809300841) \r\n- Java version 1.8.0.191_b12\r\n- Operating system Windows server 2012\r\n-  64 bit\r\n- How is eXist-db installed? (JAR installer)\r\n- Any custom changes? only memory settings\r\n", "url": "https://github.com/eXist-db/exist/issues/2622", "user": "xatapult", "labels": ["bug"], "created": "2019-04-02 13:50:52", "closed": "2020-01-16 09:16:30", "commits": {}, "ttf": 288.0002777777778, "commitsDetails": []}, {"title": "Disable recovery is not possible", "body": "### What is the problem\r\nI am embedding eXist, and I am turning off recovery by setting `/exist/db-connection/recovery/@enabled` to `false` in `conf.xml`.\r\nThis leads to a `java.util.NoSuchElementException: No value present` in `BrokerPool`.\r\n\r\n### What did you expect\r\nI expected to be able to create a local connection.\r\n\r\n### Describe how to reproduce or add a test\r\nI will ad a pull request shortly, with a [BrokerPoolNoRecoveryTest](https://github.com/ohumbel/exist/blob/a0c74f30570b4668ec00fbbb7781adaaeddf07de/exist-core/src/test/java/org/exist/storage/BrokerPoolNoRecoveryTest.java) reproducing the problem.\r\n\r\n### Context information\r\nI tested it on branches `develop` and `develop-4.x.x`. The problem is present on both.\r\nMy Java version is `Java8u202`.\r\nIt is happening on Windows, Linux and Mac, 64 bit.\r\nI embedded `exist-core`, `exist-optional` and `exist-start` into my application.\r\nI set `/exist/db-connection/recovery/@enabled` to `false` in `conf.xml`.\r\n", "url": "https://github.com/eXist-db/exist/issues/2533", "user": "ohumbel", "labels": ["bug"], "created": "2019-03-08 05:38:24", "closed": "2019-03-09 04:17:50", "commits": {"9857585483b1d8d2f68c62b5a269584e40e63340": {"commitGHEventType": "referenced", "commitUser": "adamretter"}, "6eb3fbacd6396ac910269d29ee11db0b75612a2b": {"commitGHEventType": "referenced", "commitUser": "adamretter"}, "164b25e096377bc88f99c2613e16eca9673214db": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "9857585483b1d8d2f68c62b5a269584e40e63340", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["ab60f8ad7df64cc8de133509901e4fdc48217b49", "b3b2ee819fd8f7c2caac30aae2f144d7734f163e"], "nameRev": "9857585483b1d8d2f68c62b5a269584e40e63340 tags/eXist-5.1.0~237", "commitMessage": "Merge pull request #2538 from adamretter/pr-2534\n\nStart fine with recovery disabled (Fixes issue #2533)", "commitDateTime": "2019-03-09 11:17:49", "authoredDateTime": "2019-03-09 11:17:49", "commitGitStats": [{"filePath": "build/scripts/junit.xml", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "exist-core/src/main/java/org/exist/storage/BrokerPool.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "exist-core/src/test/java/org/exist/storage/BrokerPoolNoRecoveryTest.java", "insertions": 51, "deletions": 0, "lines": 51}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerPool.java", "spoonMethods": [{"spoonMethodName": "org.exist.storage.BrokerPool.sync(org.exist.storage.DBBroker,org.exist.storage.sync.Sync)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "BrokerPoolNoRecoveryTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.storage.BrokerPoolNoRecoveryTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "6eb3fbacd6396ac910269d29ee11db0b75612a2b", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["f1c3e4d5a9edde9f71631e374ebf4143fa726a2e", "6839ae12534f879903c5bade16bc4639c216205a"], "nameRev": "6eb3fbacd6396ac910269d29ee11db0b75612a2b tags/eXist-4.7.0~39", "commitMessage": "Merge pull request #2535 from ohumbel/bugfix/disabled_recovery_4.x.x\n\n(4.x.x) Start fine with recovery disabled (Fixes issue #2533 on develop-4.x.x)", "commitDateTime": "2019-03-09 11:20:31", "authoredDateTime": "2019-03-09 11:20:31", "commitGitStats": [{"filePath": "build/scripts/junit.xml", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "exist-core/src/main/java/org/exist/storage/BrokerPool.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "exist-core/src/test/java/org/exist/storage/BrokerPoolNoRecoveryTest.java", "insertions": 51, "deletions": 0, "lines": 51}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerPool.java", "spoonMethods": [{"spoonMethodName": "org.exist.storage.BrokerPool.sync(org.exist.storage.DBBroker,org.exist.storage.sync.Sync)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "BrokerPoolNoRecoveryTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.storage.BrokerPoolNoRecoveryTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "164b25e096377bc88f99c2613e16eca9673214db", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["4fbeb5c3e108a98f2a92c54c077dc45ba7f4fe5d", "97aa0170834dd265ea207b4ee5567c8b77db022f"], "nameRev": "164b25e096377bc88f99c2613e16eca9673214db tags/eXist-5.0.0-RC8~96", "commitMessage": "Merge pull request #2539 from adamretter/bugfix/disabled_recovery_5.0.0\n\n(5.0.0) Start fine with recovery disabled (Fixes issue #2533 on develop-5.0.0) ", "commitDateTime": "2019-03-09 11:21:30", "authoredDateTime": "2019-03-09 11:21:30", "commitGitStats": [{"filePath": "build/scripts/junit.xml", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "exist-core/src/main/java/org/exist/storage/BrokerPool.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "exist-core/src/test/java/org/exist/storage/BrokerPoolNoRecoveryTest.java", "insertions": 51, "deletions": 0, "lines": 51}], "commitSpoonAstDiffStats": [{"spoonFilePath": "BrokerPool.java", "spoonMethods": [{"spoonMethodName": "org.exist.storage.BrokerPool.sync(org.exist.storage.DBBroker,org.exist.storage.sync.Sync)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "BrokerPoolNoRecoveryTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.storage.BrokerPoolNoRecoveryTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 3, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Typo in an XQuery file for xqproc", "body": "### What is the problem\r\nin `exist/extensions/xprocxq/main/src/xquery/std.xqm` line 104 has `: =` instead of `:=`\r\n### What did you expect\r\nFix the typo\r\n\r\n### Describe how to reproduce or add a test\r\nN/A\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version + Git Revision hash e.g. eXist-db 5.0 / develop/1ae05530\r\n- Java version 1.8.0_192\r\n- Operating system MacOs\r\n- 64 bit\r\n- How is eXist-db installed? clone from GitHub\r\n- Any custom changes   N/A\r\n", "url": "https://github.com/eXist-db/exist/issues/2532", "user": "lcahlander", "labels": ["bug"], "created": "2019-03-07 21:38:07", "closed": "2019-03-25 07:26:51", "commits": {}, "ttf": 17.00027777777778, "commitsDetails": []}, {"title": "xpath issue", "body": "in exist 4.6 this xpath yields 4 results instead of 1:\r\n\r\n//tei:entry[position()=1]/tei:form/tei:gram[@type='pos']\r\n\r\non this xml: [huis.zip](https://github.com/eXist-db/exist/files/2915540/huis.zip)\r\n\r\nI can fix it using:\r\n\r\n//tei:entry[position()=1]/tei:form[@type='lemma']/tei:gram[@type='pos']\r\n", "url": "https://github.com/eXist-db/exist/issues/2527", "user": "eduarddrenth", "labels": ["bug", "xquery"], "created": "2019-02-28 15:04:59", "closed": "2020-04-08 15:44:18", "commits": {}, "ttf": 405.0002777777778, "commitsDetails": []}, {"title": "[4.6.0] Cannot navigate subfolders in Java Admin Console", "body": "### What is the problem\r\n> I get this error:\r\n```\r\njava.lang.BootstrapMethodError: java.lang.IllegalAccessError: no such constructor: org.exist.util.crypto.digest.MD2StreamableDigest.<init>()void/newInvokeSpecial\r\n\tat org.exist.util.crypto.digest.DigestType.<clinit>(DigestType.java:31)\r\n\tat org.exist.xmldb.RemoteCollection.getResource(RemoteCollection.java:432)\r\n\tat org.exist.client.InteractiveClient.getResources(InteractiveClient.java:409)\r\n\tat org.exist.client.InteractiveClient.process(InteractiveClient.java:575)\r\n\tat org.exist.client.ClientFrame$ProcessRunnable.run(ClientFrame.java:1443)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.lang.IllegalAccessError: no such constructor: org.exist.util.crypto.digest.MD2StreamableDigest.<init>()void/newInvokeSpecial\r\n\tat java.lang.invoke.MethodHandleNatives.linkMethodHandleConstant(MethodHandleNatives.java:483)\r\n\t... 6 more\r\nCaused by: java.lang.NoClassDefFoundError: org/bouncycastle/crypto/ExtendedDigest\r\n\tat java.lang.invoke.MethodHandleNatives.resolve(Native Method)\r\n\tat java.lang.invoke.MemberName$Factory.resolve(MemberName.java:975)\r\n\tat java.lang.invoke.MemberName$Factory.resolveOrFail(MemberName.java:1000)\r\n\tat java.lang.invoke.MethodHandles$Lookup.resolveOrFail(MethodHandles.java:1394)\r\n\tat java.lang.invoke.MethodHandles$Lookup.linkMethodHandleConstant(MethodHandles.java:1750)\r\n\tat java.lang.invoke.MethodHandleNatives.linkMethodHandleConstant(MethodHandleNatives.java:477)\r\n\t... 6 more\r\nCaused by: java.lang.ClassNotFoundException: org.bouncycastle.crypto.ExtendedDigest\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:382)\r\n\tat com.sun.jnlp.JNLPClassLoader.findClass(Unknown Source)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\n\tat com.sun.jnlp.JNLPClassLoader.loadClass(Unknown Source)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\n\t... 12 more\r\n\r\n```\r\n\r\n### What did you expect\r\n> I expect to see the content of the folder I'm double-clicking.\r\n\r\n### Describe how to reproduce or add a test\r\n> Open the Java Admin Console, double-click the 'apps' folder, then double-click one of your apps folders. `cd 'my-app'` results in the same error.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db: 4.6.0\r\n- Java version: JDK 11.0.2\r\n- Operating system: CentOs 7 (where eXist-db runs); OSX 13 (where Java Admin Console runs)\r\n- 64 bit\r\n- How is eXist-db installed? Clone from GitHub\r\n", "url": "https://github.com/eXist-db/exist/issues/2515", "user": "lguariento", "labels": ["bug", "triage"], "created": "2019-02-23 09:34:54", "closed": "2019-02-26 10:01:05", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "Some resources are not handled correctly in latest releases", "body": "Exist-db 4.6 and 5.0.0RC6\r\n\r\nthe following items need to be adressed:\r\n\r\n- mime-types.xml  is copied to `eXist-db\\src\\org\\exist\\util\\mime-types.xml` but should end in `eXist-db\\exist-core\\src\\main\\resources` (or we should git rid of the one in EXIST_HOME at all, of have it copied from the resources\r\n- `eXist-db\\exist-core\\src\\main\\resources\\org\\exist\\xquery\\parser` should only contain the .g files as the rest should be generated. \r\n\r\n![image](https://user-images.githubusercontent.com/1700062/53095469-3caff900-351d-11e9-8e40-5bdcef3ed05a.png)\r\n\r\nand\r\n\r\n![image](https://user-images.githubusercontent.com/1700062/53095489-489bbb00-351d-11e9-86b4-080ca116a68c.png)\r\n\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/2506", "user": "dizzzz", "labels": ["bug"], "created": "2019-02-20 13:39:39", "closed": "2019-03-09 15:20:20", "commits": {}, "ttf": 17.00027777777778, "commitsDetails": []}, {"title": "EXPath Packages fail to install due to improper checking of semver-* dependencies", "body": "### What is the problem\r\n\r\neXist is treating the `semver-max` dependency restriction in the EXPath Package descriptor as `<` (exclusive) instead of `<=` (inclusive). As a result, EXPath Packages with a dependency expressed via the `semver-max` restriction fail to install on systems that meet the stated dependency requirements.\r\n\r\nFor example, given a package with a dependency on eXist of `semver-max=\"4.5.0\"`:\r\n\r\n```xml\r\n<dependency processor=\"http://exist-db.org\" semver-min=\"4.1.0\" semver-max=\"4.5.0\"/>\r\n```\r\n\r\n... eXist 4.5.0 refuses to install the package, with the following error (see detailed exist.log output below):\r\n\r\n> Package requires eXist-db version > 4.1.0 < 4.5.0. Installed version is 4.5.0.\r\n\r\n### What did you expect\r\n\r\nThe `semver-max` dependency restriction is defined in the EXPath Package spec's section on versioning (http://expath.org/spec/pkg#versioning) as follows:\r\n\r\n> If semver-max is used, the secondary package version must be either compatible with that SemVer template, or lower than it.\r\n\r\nIn other words, semver-max is supposed to mean `<=` (inclusive), not `<` (exclusive), but eXist is treating semver-max as `<` (exclusive) instead of `<=` (inclusive).\r\n\r\nI suspect the issue is in our implementation the EXPath Package spec - specifically: https://github.com/eXist-db/expath-pkg-java/blob/master/pkg-java/src/org/expath/pkg/repo/deps/Semver.java.  \r\n\r\nIf we could confirm this, we could move this issue to that repo.  But for now, the stack trace appears to only reference classes in the eXist core.\r\n\r\nFrom exist.log:\r\n\r\n```text\r\n2019-01-31 08:11:12,854 [qtp1611266232-53] ERROR (Deploy.java [installAndDeployFromDb]:216) - Package requires eXist-db version > 4.1.0 < 4.5.0. Installed version is 4.5.0 \r\norg.expath.pkg.repo.PackageException: Package requires eXist-db version > 4.1.0 < 4.5.0. Installed version is 4.5.0\r\n\tat org.exist.repo.Deployment.checkProcessorVersion(Deployment.java:294) ~[exist.jar:4.5.0]\r\n\tat org.exist.repo.Deployment.installAndDeploy(Deployment.java:218) ~[exist.jar:4.5.0]\r\n\tat org.exist.repo.Deployment.installAndDeploy(Deployment.java:164) ~[exist.jar:4.5.0]\r\n\tat org.exist.xquery.modules.expathrepo.Deploy.installAndDeployFromDb(Deploy.java:214) [exist-modules.jar:4.5.0]\r\n\tat org.exist.xquery.modules.expathrepo.Deploy.eval(Deploy.java:170) [exist-modules.jar:4.5.0]\r\n\tat org.exist.xquery.BasicFunction.eval(BasicFunction.java:74) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:41) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:276) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:276) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) [exist.jar:4.5.0]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:261) [exist.jar:4.5.0]\r\n```\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nModify `expath-pkg.xml` in any package to have a dependency with `semver-max` on the version of eXist you are currently running, build the package, and try to deploy it to eXist.\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 4.5.0 release\r\n- Java version: OpenJDK 11.0.2+9\r\n- Operating system: macOS 10.13.6\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed? DMG installer\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/2449", "user": "joewiz", "labels": ["bug", "high prio", "needs Junit test"], "created": "2019-01-31 13:21:41", "closed": "2019-04-17 09:25:23", "commits": {}, "ttf": 75.00027777777778, "commitsDetails": []}, {"title": "dynamic declared variables in xquery module lead to NPE", "body": "### What is the problem\r\n\r\nIt is possible to declare variables, whose values will be (lazily?) evaluated at runtime.\r\nUsing a function or arrow expression leads to an NPE.\r\n\r\n### What did you expect\r\n\r\none of the three:\r\n\r\n1. the value to be evaluated correctly\r\n2. the xquery parser to raise an error\r\n3. the xquery runtime to raise an error\r\n\r\nThe xquery 3.1 spec states:\r\n\r\n> [Definition: If a variable declaration includes an expression (VarValue or VarDefaultValue), the expression is called an initializing expression. The static context for an initializing expression includes all functions, variables, and namespaces that are declared or imported anywhere in the Prolog, other than the variable being declared.]\r\n\r\nand includes following example\r\n\r\n```xquery\r\ndeclare variable $a := local:f(); \r\ndeclare variable $b := 1;\r\ndeclare function local:f() { $b }; \r\n```\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nRun the following test suite:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace devar=\"http://exist-db.org/xquery/test/declared-variables\";\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare variable $devar:static := 'I am static.';\r\ndeclare variable $devar:dynamic := replace($devar:static, 'static', 'dynamic');\r\ndeclare variable $devar:function := (function ($a) {\r\n    replace($a, 'static', 'the return of a function expression')\r\n})($devar:static);\r\n\r\ndeclare variable $devar:arrow := $devar:static \r\n    => replace('static', 'the return of an arrow expression')\r\n;\r\n\r\ndeclare\r\n    %test:assertEquals('I am static.')\r\nfunction devar:read-static () {\r\n    $devar:static\r\n};\r\n\r\ndeclare\r\n    %test:assertEquals('I am dynamic.')\r\nfunction devar:read-dynamic () {\r\n    $devar:dynamic\r\n};\r\n\r\ndeclare\r\n    %test:assertEquals('I am the return of a function expression.')\r\nfunction devar:read-function () {\r\n    $devar:function\r\n};\r\n\r\ndeclare\r\n    %test:assertEquals('I am the return of a arrow expression.')\r\nfunction devar:read-arrow () {\r\n    $devar:arrow\r\n};\r\n```\r\n\r\n### Context information\r\nPlease always add the following information\r\n\r\n- eXist-db version 5.0.0 / 3d8272ad5fb706cb6291cabf8d1e3cef31566453 \r\n- Java(TM) SE Runtime Environment (build 1.8.0_152-b16)\r\n- Operating system MacOs Mojave\r\n- How is eXist-db installed? GitHub\r\n- Any custom changes in e.g. conf.xml none\r\n", "url": "https://github.com/eXist-db/exist/issues/2437", "user": "line-o", "labels": ["bug", "xquery"], "created": "2019-01-25 18:48:25", "closed": "2020-04-09 08:18:13", "commits": {}, "ttf": 439.0002777777778, "commitsDetails": []}, {"title": "Missing JARs in JNLP/webstart", "body": "As reported by @raducoravu  in https://github.com/eXist-db/exist/issues/2311#issuecomment-455116030:\r\n\r\nThe JNLP file is pointing to non existing JAR files:\r\n\r\n```\r\nexist/webstart/pkg-java-fork.jar  --> missing version nr\r\nexist/webstart/j8fu-1.16.jar --> probably double digit is a problem\r\nexist/webstart/gnu-crypto-2.0.1.jar --> replaced\r\nexist/webstart/xmldb.jar -> renamed and has version nr\r\n```", "url": "https://github.com/eXist-db/exist/issues/2397", "user": "dizzzz", "labels": ["bug", "high prio", "regression"], "created": "2019-01-17 13:32:35", "closed": "2019-01-22 19:34:01", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "BackupSystemTask is not limiting the backups as folders", "body": "### What is the problem\r\nA backup job as below is not limiting the number of backups in case when suffix is not equal with \".zip\r\n```xml\r\n<job type=\"system\" class=\"org.exist.storage.BackupSystemTask\" cron-trigger=\"0 0 3 ? * * *\">\r\n        <parameter name=\"dir\" value=\"/home/claudius/exist-db/backup\" />\r\n        <parameter name=\"prefix\" value=\"full-backup-\" />\r\n        <parameter name=\"collection\" value=\"/db\" />\r\n        <parameter name=\"user\" value=\"admin\" />\r\n        <parameter name=\"password\" value=\"password\" />\r\n        <parameter name=\"zip-files-max\" value=\"2\" />\r\n</job>\r\n```\r\n### What did you expect\r\nI would expect only two backups to be maintained.\r\n\r\n### Describe how to reproduce or add a test\r\nAnyone can reproduce this issue, by using the above backup job in conf.xml.\r\n\r\n### Context information\r\n- eXist-db 4.4.0 / ab5716180\r\n- java version \"1.8.0_191\"\r\n- ubuntu 18\r\n- 64 bit\r\n- How is eXist-db installed? - JAR installer\r\n", "url": "https://github.com/eXist-db/exist/issues/2387", "user": "claudius108", "labels": ["bug"], "created": "2019-01-15 09:46:09", "closed": "2019-03-29 10:19:03", "commits": {}, "ttf": 73.00027777777778, "commitsDetails": []}, {"title": "eXist-db Systemd service with YAJSW fails on Java 11", "body": "If you install OpenJDK 11 on Ubuntu 18.04.1 LTS, then install eXist-db as a service to systemd using `tools/yajsw/bin/installDaemon.sh`. eXist-db will not start under systemd. You will see repeated messages about the pid file in the systemd output. Seems to be a problem with YAJSW.\r\n\r\nUsing OpenJDK 8 everything works fine.\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/2332", "user": "adamretter", "labels": ["YAJSW", "awaiting-response", "bug"], "created": "2018-12-06 08:05:37", "closed": "2019-10-28 22:40:31", "commits": {}, "ttf": 326.0002777777778, "commitsDetails": []}, {"title": "array:get IndexOutOfBoundsException", "body": "While accessing an out-of-bound index of array in XQuery using the parentheses notation correctly throws XQuery error, using array:get() function for the same purpose ends with an IndexOutOfBoundsException thrown within the servlet.\r\n\r\n**Steps to reproduce:**\r\n\r\n1.  Open new XQuery 3.1 window\r\n2. evaluate the following expression:\r\n```\r\n  let $a := [ 1, 2, 3 ]\r\n  return $a(10)\r\n```\r\nThis correctly ends with **err:FOAY0001 Position 10 does not exist in this array.**  being reported.\r\n3.   Change the second line of the expression to\r\n ` return array:get($a, 10)`\r\n4. Evaluate the expression again. This time a successful query returing 0 items is repoted, while the log of the database contains an exception dump with this cause:\r\n```\r\n2018-11-30 13:08:35,603 [qtp1502843539-99] ERROR (XQueryServlet.java [process]:552) - null \r\njava.lang.IndexOutOfBoundsException: null\r\n        at com.github.krukow.clj_lang.PersistentVector.arrayFor(PersistentVector.java:126) ~[clj-ds-0.0.4.jar:?]\r\n        at com.github.krukow.clj_lang.PersistentVector.nth(PersistentVector.java:130) ~[clj-ds-0.0.4.jar:?]\r\n        at org.exist.xquery.functions.array.ArrayType.get(ArrayType.java:67) ~[exist.jar:4.4.0]\r\n        at org.exist.xquery.functions.array.ArrayFunction.eval(ArrayFunction.java:252) ~[exist.jar:4.4.0]\r\n        at org.exist.xquery.BasicFunction.eval(BasicFunction.java:74) ~[exist.jar:4.4.0]\r\n        at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:41) ~[exist.jar:4.4.0]\r\n        at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58) ~[exist.jar:4.4.0]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:4.4.0]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:4.4.0]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:4.4.0]\r\n        at org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:4.4.0]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:4.4.0]\r\n        at org.exist.xquery.XQuery.execute(XQuery.java:261) ~[exist.jar:4.4.0]\r\n        at org.exist.xquery.XQuery.execute(XQuery.java:185) ~[exist.jar:4.4.0]\r\n        at org.exist.http.servlets.XQueryServlet.process(XQueryServlet.java:488) [exist-optional.jar:4.4.0]\r\n        at org.exist.http.servlets.XQueryServlet.doPost(XQueryServlet.java:192) [exist-optional.jar:4.4.0]\r\n```\r\n\r\nThe second query should behave the same way as the first one - reporting an XQuery error.\r\n\r\n### Context information\r\n- eXist-db version **exist-4.4.0 stable**\r\n- Java version **openjdk version \"1.8.0_131\"**\r\n- Operating system **Linux Centos 7**\r\n- **64 bit**\r\n- Standard installation by eXist-setup.jar\r\n- One custom module for Levenshtein function, two custom analyzers for Lucene\r\n", "url": "https://github.com/eXist-db/exist/issues/2317", "user": "median1st", "labels": ["bug"], "created": "2018-11-30 13:11:48", "closed": "2018-12-14 14:13:29", "commits": {}, "ttf": 14.000277777777777, "commitsDetails": []}, {"title": "util:get-fragment-between is not producing correct fragment(s)", "body": "### What is the problem\r\n\r\nThe fragmenting process used by `util:get-fragment-between` isn't stopping at second node. \r\n\r\nRunning `util:get-fragment-between` to get the fragment between the first and second `<pb>` in the full sample below returns:\r\n\r\n```xml\r\n            <pb facs=\"1.jpg\"></pb>     \r\n            <p>Aus dem Leben einer Kartoffel.</p>\r\n            <pb facs=\"2.jpg\"></pb>\r\n       </front>\r\n       <body>\r\n            <pb facs=\"3.jpg\"></pb>\r\n            <p>Hubertus Knoll spazierte \u00fcber das <pb facs=\"4.jpg\"></pb> Feld.</p>\r\n            <pb facs=\"5.jpg\"></pb>\r\n        </body>\r\n    </text>\r\n</TEI>\r\n```\r\n\r\nMaybe the problem was caused here?\r\nhttps://github.com/eXist-db/exist/blob/eXist-4.4.0/src/org/exist/xquery/functions/util/GetFragmentBetween.java#L182\r\n\r\n### What did you expect\r\n\r\nI expected output (like in version 4.3.1):\r\n\r\n```xml\r\n<pb facs=\"1.jpg\"></pb>\r\n<p>Aus dem Leben einer Kartoffel.</p>\r\n```\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nStore the following as `kartoffelmann.xml`:\r\n\r\n```xml\r\n<TEI xmlns=\"http://www.tei-c.org/ns/1.0\">\r\n    <text>\r\n        <front>\r\n            <pb facs=\"1.jpg\"/>\r\n            <p>Aus dem Leben einer Kartoffel.</p>\r\n            <pb facs=\"2.jpg\"/>\r\n        </front>\r\n        <body>\r\n            <pb facs=\"3.jpg\"/>\r\n            <p>Hubertus Knoll spazierte \u00fcber das <pb facs=\"4.jpg\"/> Feld.</p>\r\n            <pb facs=\"5.jpg\"/>\r\n        </body>\r\n    </text>\r\n</TEI>\r\n```\r\n\r\nRun the following query:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\ndeclare namespace tei = \"http://www.tei-c.org/ns/1.0\";\r\n\r\nlet $doc := doc(\"kartoffelmann.xml\")\r\nlet $pbs := $doc//tei:pb\r\nlet $pb1 := $pbs[1]\r\nlet $pb2 := $pbs[2]\r\nreturn\r\n    util:get-fragment-between($pb1, $pb2, false(), true())\r\n```\r\n\r\nResults are as above.\r\n\r\n### Context information\r\n\r\n- eXist-db version:  eXist-db >= 4.4.0\r\n- Java version:  jdk1.8.0_191\r\n- Operating system: Windows 10\r\n- 64 bit\r\n- How is eXist-db installed? JAR installer\r\n- Any custom changes in e.g. conf.xml: no\r\n", "url": "https://github.com/eXist-db/exist/issues/2316", "user": "babslgam", "labels": ["bug", "regression"], "created": "2018-11-29 14:27:00", "closed": "2020-03-27 19:59:10", "commits": {}, "ttf": 484.0002777777778, "commitsDetails": []}, {"title": "Cannot launch Java Admin Client (JNLP)", "body": "### What is the problem\r\n> I cannot launch the Java Admin Client. Upon launching exist.jnlp I get:\r\n\r\n```\r\njava.lang.NoClassDefFoundError: org/xmldb/api/base/XMLDBException\r\n\tat java.lang.Class.getDeclaredMethods0(Native Method)\r\n\tat java.lang.Class.privateGetDeclaredMethods(Class.java:2701)\r\n\tat java.lang.Class.privateGetMethodRecursive(Class.java:3048)\r\n\tat java.lang.Class.getMethod0(Class.java:3018)\r\n\tat java.lang.Class.getMethod(Class.java:1784)\r\n\tat com.sun.javaws.Launcher.doLaunchApp(Unknown Source)\r\n\tat com.sun.javaws.Launcher.run(Unknown Source)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\nCaused by: java.lang.ClassNotFoundException: org.xmldb.api.base.XMLDBException\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:382)\r\n\tat com.sun.jnlp.JNLPClassLoader.findClass(Unknown Source)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\n\tat com.sun.jnlp.JNLPClassLoader.loadClass(Unknown Source)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\n\t... 8 more\r\n```\r\n\r\nIf I do curl -v http://localhost:8080/xmlrpc I get:\r\n\r\n```\r\n* About to connect() to localhost port 8080 (#0)\r\n*   Trying ::1...\r\n* Connected to localhost (::1) port 8080 (#0)\r\n> GET /xmlrpc HTTP/1.1\r\n> User-Agent: curl/7.29.0\r\n> Host: localhost:8080\r\n> Accept: */*\r\n> \r\n< HTTP/1.1 405 HTTP method GET is not supported by this URL\r\n< Date: Mon, 26 Nov 2018 12:28:16 GMT\r\n< Cache-Control: must-revalidate,no-cache,no-store\r\n< Content-Type: text/html;charset=iso-8859-1\r\n< Content-Length: 393\r\n< Server: Jetty(9.4.10.v20180503)\r\n< \r\n<html>\r\n<head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\"/>\r\n<title>Error 405 HTTP method GET is not supported by this URL</title>\r\n</head>\r\n<body><h2>HTTP ERROR 405</h2>\r\n<p>Problem accessing /xmlrpc. Reason:\r\n<pre>    HTTP method GET is not supported by this URL</pre></p><hr><a href=\"http://eclipse.org/jetty\">Powered by Jetty:// 9.4.10.v20180503</a><hr/>\r\n\r\n</body>\r\n</html>\r\n```\r\n### Describe how to reproduce\r\n```\r\ngit clone git://github.com/eXist-db/exist.git\r\ncd exist\r\ngit checkout master\r\n./build.sh\r\n./build.sh -f build/scripts/jarsigner.xml\r\n\r\n<Set name=\"contextPath\">/</Set>\r\nin tools/jetty/webapps/exist-webapp-context.xml\r\n\r\ncd tools/yajsw/bin/\r\n./installDaemonNoPriv.sh\r\n./startDaemon.sh\r\n```\r\n\r\nconnect to the dashboard - click on 'Java Admin Client' - download the jnlp, and double click on it.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db 4.5.0  / e29b4099c71094e25fae7d627975bf8e6b78658e\r\n- build 1.8.0_152-b16\r\n- CentoS 7\r\n- 64 bit\r\n- Clone via GitHub\r\n", "url": "https://github.com/eXist-db/exist/issues/2311", "user": "lguariento", "labels": ["bug"], "created": "2018-11-26 12:29:26", "closed": "2018-12-03 16:35:49", "commits": {"8313edf404d5175b2a8b86c3a1e900fb0d483488": {"commitGHEventType": "referenced", "commitUser": "dizzzz"}}, "ttf": 7.000277777777778, "commitsDetails": [{"commitHash": "8313edf404d5175b2a8b86c3a1e900fb0d483488", "commitGHEventType": "referenced", "commitUser": "dizzzz", "commitParents": ["a6643d89ea80a615185dc063e447dc17564d11dd"], "nameRev": "8313edf404d5175b2a8b86c3a1e900fb0d483488 tags/eXist-5.1.0~285^2", "commitMessage": "Repair of missing webstart jar file. Fixes #2311\n", "commitDateTime": "2018-12-03 15:42:22", "authoredDateTime": "2018-12-03 15:34:21", "commitGitStats": [{"filePath": "src/org/exist/webstart/JnlpJarFiles.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "JnlpJarFiles.java", "spoonMethods": [{"spoonMethodName": "org.exist.webstart.JnlpJarFiles", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["8313edf404d5175b2a8b86c3a1e900fb0d483488"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 1, "deletions": 1, "lines": 2, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/webstart"], "changesInPackagesSPOON": ["org.exist.webstart.JnlpJarFiles"]}, {"title": "Insufficient synchronization in TransactionManager", "body": "The internal state of the transaction manager is read and modified by multiple threads, sometimes with a lock and sometimes without. This should be fixed so that it is consistent and correct memory affects are seen.\r\n\r\n1. `TransactionManager#transactions` is potentially accessed without sufficient synchronisation:\r\n    1. https://github.com/eXist-db/exist/blob/eXist-4.4.0/src/org/exist/storage/txn/TransactionManager.java#L200\r\n    2. https://github.com/eXist-db/exist/blob/eXist-4.4.0/src/org/exist/storage/txn/TransactionManager.java#L253\r\n    3. https://github.com/eXist-db/exist/blob/eXist-4.4.0/src/org/exist/storage/txn/TransactionManager.java#L264\r\n    4. https://github.com/eXist-db/exist/blob/eXist-4.4.0/src/org/exist/storage/txn/TransactionManager.java#L269\r\n    5. https://github.com/eXist-db/exist/blob/eXist-4.4.0/src/org/exist/storage/txn/TransactionManager.java#L272\r\n    6. https://github.com/eXist-db/exist/blob/eXist-4.4.0/src/org/exist/storage/txn/TransactionManager.java#L299\r\n\r\n2. `TransactionManager#nextTxnId` is potentially accessed without sufficient synchronisation:\r\n    1. https://github.com/eXist-db/exist/blob/eXist-4.4.0/src/org/exist/storage/txn/TransactionManager.java#L225\r\n    2. https://github.com/eXist-db/exist/blob/eXist-4.4.0/src/org/exist/storage/txn/TransactionManager.java#L260", "url": "https://github.com/eXist-db/exist/issues/2304", "user": "adamretter", "labels": ["bug", "high prio"], "created": "2018-11-20 03:04:01", "closed": "2019-01-08 08:35:19", "commits": {"4a7d40543581a257784d842dc51b5672cc0fe227": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 49.000277777777775, "commitsDetails": [{"commitHash": "4a7d40543581a257784d842dc51b5672cc0fe227", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["946e86eea72f1f5b5961d6db2270c219455280c8"], "nameRev": "4a7d40543581a257784d842dc51b5672cc0fe227 tags/eXist-5.1.0~273^2~2", "commitMessage": "[bugfix/feature] New non-blocking lock-free implementation of the Transaction Manager.\nCloses https://github.com/eXist-db/exist/issues/2304\n", "commitDateTime": "2018-12-14 11:41:21", "authoredDateTime": "2018-11-20 20:44:02", "commitGitStats": [{"filePath": "src/org/exist/storage/BrokerPool.java", "insertions": 0, "deletions": 9, "lines": 9}, {"filePath": "src/org/exist/storage/SystemTaskManager.java", "insertions": 1, "deletions": 2, "lines": 3}, {"filePath": "src/org/exist/storage/journal/Journal.java", "insertions": 6, "deletions": 1, "lines": 7}, {"filePath": "src/org/exist/storage/txn/TransactionManager.java", "insertions": 399, "deletions": 179, "lines": 578}, {"filePath": "src/org/exist/storage/txn/Txn.java", "insertions": 2, "deletions": 0, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyChanges"}], "filteredCommits": ["4a7d40543581a257784d842dc51b5672cc0fe227"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 408, "deletions": 191, "lines": 599, "gitFilesChange": 5}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/storage/txn", "src/org/exist/storage", "src/org/exist/storage/journal"]}, {"title": "LDAP: Different hasGroup() and findAllGroupNames() implementations lead to 500 in web user manager", "body": "### What is the problem\r\nLDAPRealm contains a findAllGroupNames() implementation that returns all groups in LDAP. This could be a very large number, only a view of them relevant to a particular exist instance. The caching mechanism now only saves groups to the local instance which are actually used by some LDAP user account exist read from LDAP. There are filter options for this and there are default groups in an LDAP/AD database that don't have any users assigned at all.\r\nYet there is the hasGroup() function that assumes that any group returned by findAllGroupNames() can be found when looking at the local cache.\r\nThis makes e. g. the logic in web UI user manager fail with error 500\r\n\r\n### What did you expect\r\nEither hasGroup() needs to check against the LDAP DB or the listing returned by findAllGroupNames() should only contain locally cached groups. The latter could be achieved by using the very simple findAllGroupNames() implementation found in other real implementations.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n1. Configure LDAP\r\n1. Let exist read the users from the DB\r\n1. Try to open the web user manager.\r\n1. It reports a 500 error from the server and the groups list is empty.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist 4.5.0-SNAPSHOT Git commit: f62496a5e Git branch: develop-4.x.x\r\n- jdk1.8.0_192\r\n- Windows 10\r\n- 64 bit\r\n- Compiled with IntelliJ IDEA from git source\r\n- Enabled LDAP and configured it to read from an UCS Core Edition Samba AD replacement", "url": "https://github.com/eXist-db/exist/issues/2281", "user": "simar0at", "labels": ["bug"], "created": "2018-11-08 14:56:31", "closed": "2019-08-07 17:33:57", "commits": {}, "ttf": 272.0002777777778, "commitsDetails": []}, {"title": "LDAP: NullPointerException in findAllGroupMembers", "body": "### What is the problem\r\nLDAPRealm findAllGroupMembers is also called with built-in groups as parameter. Searching these in LDAP [results in a null return](https://github.com/eXist-db/exist/blob/develop/extensions/security/ldap/src/org/exist/security/realm/ldap/LDAPRealm.java#L1240) which is not checked but [subseqently just used as an object](https://github.com/eXist-db/exist/blob/develop/extensions/security/ldap/src/org/exist/security/realm/ldap/LDAPRealm.java#L1242)\r\n\r\n### What did you expect\r\nEither that this function is only called on groups from the LDAP realm or that it handles null returns as not found gracefully.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n1. Configure LDAP\r\n1. Let exist read the users from the DB\r\n1. Try to change access rights using the GUI client\r\n1. Edit Properties Error: Could not get dba group members: Failed to invoke method getGroupMembers in class org.exist.xmlrpc.RpcConnection: null\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist 4.5.0-SNAPSHOT Git commit: f62496a5e Git branch: develop-4.x.x\r\n- jdk1.8.0_192\r\n- Windows 10\r\n- 64 bit\r\n- Compiled with IntelliJ IDEA from git source\r\n- Enabled LDAP and configured it to read from an UCS Core Edition Samba AD replacement\r\n", "url": "https://github.com/eXist-db/exist/issues/2280", "user": "simar0at", "labels": ["bug"], "created": "2018-11-08 14:42:34", "closed": "2019-03-29 19:36:39", "commits": {}, "ttf": 141.00027777777777, "commitsDetails": []}, {"title": "String index out of range when using UCA collation to sort >8,192 strings", "body": "### What is the problem\r\n\r\nWhen using the `numeric=yes` option with the UCA collation in an `order by` clause of a FLWOR expression, sorting more than >8,192 strings will raise an \"String index out of range\" error.\r\n\r\n### What did you expect\r\n\r\nI expected there to be no fixed limit to the number of strings that could be sorted.\r\n\r\nFor the documentation on the `numeric=yes` option, see https://www.w3.org/TR/xpath-functions-31/#uca-collations. Support for the UCA collation was added in https://github.com/eXist-db/exist/pull/1575.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nThe following query and the variant described below illustrate how to reproduce:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nlet $terms := (1 to 8193) ! (. cast as xs:string)\r\nfor $term in $terms\r\norder by $term collation \"http://www.w3.org/2013/collation/UCA?numeric=yes\"\r\nreturn \r\n    $term\r\n```\r\n\r\nThis raises no error and works correctly, returning the \"terms\" (strings) in *numeric* order (1, 2, 3) rather than in string order (1, 10, 100). **However,** if you change \"8192\" to \"8193\", you will trigger an \"String index out of range\" error [1]. \r\n\r\nSaxon 9.8.0.12 (run via oXygen 20.1) and BaseX 9.1 (with icu4j-63_1.jar added to the classpath as per http://docs.basex.org/wiki/XQuery_3.1#Collations) returns the expected results without error.\r\n\r\nMoreover, if you submit the query several times in succession, one of the queries will hang instead of returning an error quickly, and monex will perpetually report the stack is in a state of waiting. [2] However, memory and CPU usage is idle, and the query cannot be killed (e.g., via monex). The only way out is to force kill eXist.\r\n\r\n**[1] exist.log**\r\n\r\n```text\r\n2018-11-07 22:27:30,775 [qtp1159770377-88] ERROR (XQueryServlet.java [process]:552) - String index out of range: 2 \r\njava.lang.StringIndexOutOfBoundsException: String index out of range: 2\r\n\tat java.lang.StringLatin1.charAt(StringLatin1.java:47) ~[?:?]\r\n\tat java.lang.String.charAt(String.java:693) ~[?:?]\r\n\tat com.ibm.icu.impl.coll.UTF16CollationIterator.handleNextCE32(UTF16CollationIterator.java:107) ~[icu4j-59_1.jar:59.1]\r\n\tat com.ibm.icu.impl.coll.CollationIterator.nextCE(CollationIterator.java:247) ~[icu4j-59_1.jar:59.1]\r\n\tat com.ibm.icu.impl.coll.CollationCompare.compareUpToQuaternary(CollationCompare.java:60) ~[icu4j-59_1.jar:59.1]\r\n\tat com.ibm.icu.text.RuleBasedCollator.doCompare(RuleBasedCollator.java:1688) ~[icu4j-59_1.jar:59.1]\r\n\tat com.ibm.icu.text.RuleBasedCollator.compare(RuleBasedCollator.java:1483) ~[icu4j-59_1.jar:59.1]\r\n\tat org.exist.util.Collations.compare(Collations.java:269) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.value.StringValue.compareTo(StringValue.java:646) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.value.OrderedValueSequence$Entry.compareTo(OrderedValueSequence.java:368) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.value.OrderedValueSequence$Entry.compareTo(OrderedValueSequence.java:302) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat java.util.Comparators$NaturalOrderComparator.compare(Comparators.java:52) ~[?:?]\r\n\tat java.util.Comparators$NaturalOrderComparator.compare(Comparators.java:47) ~[?:?]\r\n\tat java.util.TimSort.countRunAndMakeAscending(TimSort.java:360) ~[?:?]\r\n\tat java.util.TimSort.sort(TimSort.java:234) ~[?:?]\r\n\tat java.util.ArraysParallelSortHelpers$FJObject$Sorter.compute(ArraysParallelSortHelpers.java:145) ~[?:?]\r\n\tat java.util.concurrent.CountedCompleter.exec(CountedCompleter.java:746) ~[?:?]\r\n\tat java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:290) ~[?:?]\r\n\tat java.util.concurrent.ForkJoinTask.doInvoke(ForkJoinTask.java:408) ~[?:?]\r\n\tat java.util.concurrent.ForkJoinTask.invoke(ForkJoinTask.java:736) ~[?:?]\r\n\tat java.util.Arrays.parallelSort(Arrays.java:1122) ~[?:?]\r\n\tat java.util.stream.SortedOps$OfRef.opEvaluateParallel(SortedOps.java:158) ~[?:?]\r\n\tat java.util.stream.AbstractPipeline.opEvaluateParallelLazy(AbstractPipeline.java:710) ~[?:?]\r\n\tat java.util.stream.AbstractPipeline.sourceSpliterator(AbstractPipeline.java:434) ~[?:?]\r\n\tat java.util.stream.AbstractPipeline.evaluateToArrayNode(AbstractPipeline.java:260) ~[?:?]\r\n\tat java.util.stream.ReferencePipeline.toArray(ReferencePipeline.java:517) ~[?:?]\r\n\tat org.exist.xquery.value.OrderedValueSequence.sort(OrderedValueSequence.java:135) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.OrderByClause.postEval(OrderByClause.java:74) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.BindingExpression.postEval(BindingExpression.java:91) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.BindingExpression.postEval(BindingExpression.java:91) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:157) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:261) ~[exist.jar:4.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:185) ~[exist.jar:4.5.0-SNAPSHOT]\r\n        ...\r\n```\r\n\r\n**[2] monex stack report**\r\n\r\n```text\r\njava.base@11.0.1/java.lang.Object.wait(Native Method)\r\njava.base@11.0.1/java.util.concurrent.ForkJoinTask.externalAwaitDone(ForkJoinTask.java:330)\r\njava.base@11.0.1/java.util.concurrent.ForkJoinTask.doInvoke(ForkJoinTask.java:412)\r\njava.base@11.0.1/java.util.concurrent.ForkJoinTask.invoke(ForkJoinTask.java:736)\r\njava.base@11.0.1/java.util.Arrays.parallelSort(Arrays.java:1122)\r\njava.base@11.0.1/java.util.stream.SortedOps$OfRef.opEvaluateParallel(SortedOps.java:158)\r\njava.base@11.0.1/java.util.stream.AbstractPipeline.opEvaluateParallelLazy(AbstractPipeline.java:710)\r\njava.base@11.0.1/java.util.stream.AbstractPipeline.sourceSpliterator(AbstractPipeline.java:434)\r\njava.base@11.0.1/java.util.stream.AbstractPipeline.evaluateToArrayNode(AbstractPipeline.java:260)\r\njava.base@11.0.1/java.util.stream.ReferencePipeline.toArray(ReferencePipeline.java:517)\r\norg.exist.xquery.value.OrderedValueSequence.sort(OrderedValueSequence.java:135)\r\norg.exist.xquery.OrderByClause.postEval(OrderByClause.java:74)\r\norg.exist.xquery.BindingExpression.postEval(BindingExpression.java:91)\r\norg.exist.xquery.BindingExpression.postEval(BindingExpression.java:91)\r\norg.exist.xquery.LetExpr.eval(LetExpr.java:157)\r\norg.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\norg.exist.xquery.PathExpr.eval(PathExpr.java:276)\r\norg.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\norg.exist.xquery.XQuery.execute(XQuery.java:261)\r\norg.exist.xquery.XQuery.execute(XQuery.java:185)\r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: develop-4.x.x 7ed8dd77f8ba53245c8039bc58e743e3c74cd960\r\n- Java version: OpenJDK 11.0.1+13\r\n- Operating system: macOS 10.13.6\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed? Cloned from GitHub\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/2278", "user": "joewiz", "labels": ["bug"], "created": "2018-11-08 04:03:01", "closed": "2019-05-03 20:23:10", "commits": {}, "ttf": 176.00027777777777, "commitsDetails": []}, {"title": "map with duplicate keys should throw an error", "body": "### What is the problem\r\n\r\nThe following code\r\n\r\n```xquery\r\nmap { 'a': 1, 'a': 2 }\r\n```\r\n\r\nevaluates to\r\n\r\n```xquery\r\nmap { 'a': 2 }\r\n```\r\n\r\n### What did you expect\r\n\r\nAn error should be raised, that key 'a' was entered twice.\r\nBaseX does exactly that:\r\n\r\n```\r\nXQUERY map {'a':1, 'a':2}\r\nStopped at ., 1/5:\r\n[XQDY0137] Key \"a\" already exists in map (values: 1 vs. 2).\r\n```\r\n\r\nThis should not affect `map:put` or `map:merge` where this actually overwrites the given key in the returned, new map.\r\n\r\n\r\n### Context information\r\n\r\n- eXist-db 5.0.0-RC3 /  bfdcc8406 \r\n- Java version: 1.8.0_152\r\n- Operating system: MacOS (Mojave)\r\n- build from source / clone from GitHub\r\n", "url": "https://github.com/eXist-db/exist/issues/2203", "user": "line-o", "labels": ["bug"], "created": "2018-10-08 20:26:36", "closed": "2018-10-14 13:37:31", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "Function documentation shows old information", "body": "### What is the problem\r\nIf you create an XQuery module yourself with XQdoc comments, in some cases you see old information which does not go away on a regenerate. \r\n\r\n### What did you expect\r\nConsistent information displayed by the fundocs app\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n- Add a module with XQdoc in it to the database (anywhere). Here is an example: [testmod.zip](https://github.com/eXist-db/exist/files/2456315/testmod.zip)\r\n- Go to fundocs (as admin) and regenerate. \r\n- Search for \"blah\". The new module and  function should show up.\r\n- Click on the namespace (http://www.xatapult.com/ns/testmod) in the grey-background header. You get the module's information.\r\n- Now change something in the XQdoc of the module and save\r\n- Regenerate the fundocs\r\n- Re-search on \"blah\". You should see the applied changes to the XQdoc\r\n- Click on the namespace again. The information there is old, it shows the previous XQdoc version.\r\n\r\n### Context information\r\n\r\n- eXist version: 4.4.0 (Build 201809211803)\r\n- Java version 1.8.0_181\r\n- Operating system W10 (source) and Unix (dest)\r\n- 64 bit\r\n- JAR installed\r\n- Any custom changes in e.g. conf.xml? \r\n  - Data and Journal directory moved to outside eXist installation directory\r\n  - Global cache module enables\r\n  - RestXQ and expath auto deploy trigger disabled\r\n", "url": "https://github.com/eXist-db/exist/issues/2199", "user": "xatapult", "labels": ["bug"], "created": "2018-10-08 14:28:09", "closed": "2018-10-08 14:30:48", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Error on taking a subsequence of stored nodes", "body": "Thank you for reporting your issue!\r\n\r\nTo be able to better understand you problem or suggestion, please add as much information as possible to this ticket. When there is no or just little information, it will be too difficult to work on it (and hence we will not be able to solve it)\r\n\r\nPlease fill in the following sections:\r\n\r\n### What is the problem\r\n> Describe exactly what you see (e.g. an output of an XQuery) \r\n\r\nSince #2138 I am experiencing problems with taking a subsequence of nodes from a resource (stored?).\r\n\r\n### What did you expect\r\n> Describe what you expected to happen. Add for example a reference to a [specification](https://www.w3.org/TR/xquery-3/).\r\n\r\nNo error, the text node of the second 'x' element with the code below.\r\n\r\n### Describe how to reproduce or add a test\r\n> Describe how we can can reproduce the problem.\r\n\r\n> The *best* way is to provide a 'self containing' test, a test that can be run without dependancies. The [XQSuite - Annotation-based Test Framework for XQuery](http://exist-db.org/exist/apps/doc/xqsuite.xml) makes it very easy for you to create tests. These tests can be executed from the [eXide editor](http://exist-db.org/exist/apps/eXide/index.html) (XQuery - Run as Test)\r\n\r\nRunning the following script:\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nlet $x := doc('/db/apps/test.xml')/test/x\r\nlet $xx := subsequence($x, 2, 1)\r\nreturn $xx/text()\r\n```\r\n\r\non the document (`/db/apps/text.xml`):\r\n```xml\r\n<test>\r\n    <x>1</x>\r\n    <x>2</x>\r\n    <x>3</x>\r\n</test>\r\n```\r\n\r\ncreates the error:\r\n```\r\nexerr:ERROR Type error: the sub-sequence cannot be converted into a MemoryNodeSet. It contains nodes from stored resources.\r\n```\r\n\r\nWith any build from source prior to ace6379f4d034fb1b5db61d1160f5a6c764d59af it returns:\r\n```\r\n2\r\n```\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version + Git Revision hash e.g. eXist-db 3.0 /  acd0c14 \r\n4.4.0 or develop-4.x.x (608991ac3e4ada8e887a516f58cac41af3ea4809)\r\n- Java version (e.g. Java8u121)\r\n1.8.0\r\n- Operating system (Windows 7, Linux, MacOs)\r\nLinux\r\n- 32 or 64 bit\r\n64 bits\r\n- How is eXist-db installed? (JAR installer, DMG, WAR file, clone from GitHub)\r\nclone from GitHub\r\n- Any custom changes in e.g. conf.xml\r\nnone", "url": "https://github.com/eXist-db/exist/issues/2195", "user": "ptrckb", "labels": ["bug"], "created": "2018-10-08 09:35:30", "closed": "2018-10-14 18:07:04", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "REST interface put method failing", "body": "### What is the problem\r\nWe have code that copies files from one server to the other using the standard REST interface functionality eXist provides. Here is a dressed down code example:\r\n\r\n```\r\nlet $full-path-source := '/db/TEST/somefile.xml'\r\nlet $full-path-dest := $full-path-source\r\n\r\nlet $server := 'server-name-or-ip' \r\n\r\nlet $request :=\r\n  <hc:request href=\"http://{$server}:8080/exist/rest{$full-path-dest}\" method=\"put\" auth-method=\"basic\" \r\n      username=\"admin\" password=\"adminpassword\" send-authorization=\"true\">\r\n    <hc:body media-type=\"{xmldb:get-mime-type(xs:anyURI($full-path-source))}\"/>\r\n  </hc:request>\r\n\r\nreturn\r\n  hc:send-request($request, (), doc($full-path-source))\r\n```\r\nThe environment is all ok as far as I can see. The source file exists, is well-formed, the destination collection exists and is writable.\r\n\r\nSince using 4.4.0 there are problems with this:\r\n\r\n- When the file to send is bigger than some threshold (an XML file of 84Kb fails, a very small one succeeds, usually...) an error pops up\r\n- The error is, rather puzzling: Error serializing the body content (on the hc:send-request()). \r\n- But there is nothing wrong with the file and why wouldn't it be able to serialize? It seems like a wrong message for some other problem occurring.\r\n- Very rarely the bug does not happen and the file transfers...\r\n- The source is a WIndows machine, the destination a Unix machine, all running 4.4.0\r\n- To make it even more strange: When I do the same with a Windows machine as destination, my whole source system hangs up\r\n- There is nothing in the exist.log about this\r\n- We run the script from within oXygen but also using a rest call to it\r\n- We had no problems with 4.3.1\r\n\r\n\r\n### What did you expect\r\nFile copied to remote system\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nHave two separate servers running eXist, preferably the source on Windows and the destination on Unix\r\nAdapt the script above with the right stuff (address, password, etc).\r\nTry it to run on the source machine\r\n\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist version: 4.4.0 (Build 201809211803)\r\n- Java version 1.8.0_181\r\n- Operating system W10 (source) and Unix (dest)\r\n- 64 bit\r\n- JAR installed\r\n- Any custom changes in e.g. conf.xml? \r\n  - Data and Journal directory moved to outside eXist installation directory\r\n  - Global cache module enables\r\n  - RestXQ and expath auto deploy trigger disabled\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/2186", "user": "xatapult", "labels": ["bug"], "created": "2018-10-03 09:29:40", "closed": "2018-10-15 13:06:41", "commits": {}, "ttf": 12.000277777777777, "commitsDetails": []}, {"title": "random java.util.ConcurrentModificationException in 4.4.0 during xupdate via REST call", "body": "### What is the problem\r\na java.util.ConcurrentModificationException exception is randomly raised while processing an xupdate statement submitted via REST POST, returns 5xx status code\r\n\r\nThis has happened 3 times in 3 weeks, perhaps 1 out of every 2000 xupdate calls.\r\n\r\n### What did you expect\r\nI expect the documents to be updated and get back a 200 response code\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nsend an HTTP POST to \r\n```\r\nhttp://host:port/exist/servlet/db/orgs/il/customs/pending_shipments/QIL1505643/shiprequest.xml\r\n```\r\nwith contents as shown (contents of Quote element have been redacted)\r\n\r\n```\r\n<?xml version=\"1.0\"?>\r\n<xupdate:modifications xmlns:xupdate=\"http://www.xmldb.org/xupdate\" version=\"1.0\">\r\n  <xupdate:remove select=\"/shiprequest[@key='QIL1505643']/@commit_batch\"/>\r\n  <xupdate:remove select=\"/shiprequest[@key='QIL1505643']/quotes\"/>\r\n  <xupdate:append select=\"/shiprequest[@key='QIL1505643']\">\r\n    <xupdate:element name=\"quotes\">\r\n      <xupdate:attribute name=\"python.type\">list</xupdate:attribute>\r\n      <Quote version=\"1\">\r\n        <valid_quote python.type=\"bool\">True</valid_quote>\r\n      </Quote>\r\n    </xupdate:element>\r\n  </xupdate:append>\r\n</xupdate:modifications>\r\n```\r\n\r\n\r\n### Context information\r\n\r\nrunning official docker image 4.4.0\r\n\r\n```\r\neXist Version: | 4.4.0\r\neXist Build: | 201809252010\r\nOperating System: | Linux 4.4.0-133-generic amd64\r\nJava Version: | 1.8.0_171\r\n```\r\n\r\n[exception.txt](https://github.com/eXist-db/exist/files/2439267/exception.txt)\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/2185", "user": "bkcsfi", "labels": ["bug"], "created": "2018-10-02 18:48:59", "closed": "2018-10-12 06:37:24", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "parse-xml-fragment is not returning document-node", "body": "### What is the problem\r\n\r\nThe `fn:parse-xml-fragment()` function (added by @claudius108 in https://github.com/eXist-db/exist/pull/158) is returning items of the wrong type and arity.\r\n\r\n### What did you expect\r\n\r\nAccording to https://www.w3.org/TR/xpath-functions-31/#func-parse-xml-fragment, the function's signature is:\r\n\r\n```xquery\r\nfn:parse-xml-fragment($arg as xs:string?) as document-node()?\r\n```\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nThe following query should return `true()` but returns `false()`\r\n\r\n```xquery\r\nparse-xml-fragment(\"He was <i>so</i> kind\") instance of document-node()\r\n```\r\n\r\nThe following query should return `1` but returns `3`\r\n\r\n```xquery\r\ncount(parse-xml-fragment(\"He was <i>so</i> kind\"))\r\n```\r\n\r\nSaxon and BaseX return the expected results. Only eXist returns the incorrect results.\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: 4.4.0 (release)\r\n- Java version: 11\r\n- Operating system (Windows 7, Linux, MacOs): macOS \r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed? DMG installer\r\n- Any custom changes in e.g. conf.xml\r\n", "url": "https://github.com/eXist-db/exist/issues/2181", "user": "joewiz", "labels": ["bug"], "created": "2018-10-01 17:31:00", "closed": "2020-03-10 11:20:11", "commits": {}, "ttf": 525.0002777777778, "commitsDetails": []}, {"title": "Unable to start eXist-db.app with Java 11", "body": "### What is the problem\r\n\r\nStarting eXist-db.app with Java 11 on macOS yields the following error:\r\n\r\n> This application requires that Java 8 or later be installed on your computer. Please download and install the latest version of Java from www.java.com and try again.\r\n\r\nThis problem is analogous to https://github.com/eXist-db/exist/issues/1792 and is caused by a version string parsing bug in the \"appbundler\" tool used to create eXist-db.app, https://bitbucket.org/infinitekind/appbundler. \r\n\r\nReferences:\r\n- Commit in default branch addressing version checking (2017-08-01) https://bitbucket.org/infinitekind/appbundler/commits/ce0600b603c11a1fe120b6de3aa9a3feb97971b8\r\n- @adamretter's self-built, self-patched appbundler jar (2018-01-14): https://github.com/eXist-db/exist/pull/1687\r\n- Unmerged PR addressing version checking (2018-01-30): https://bitbucket.org/infinitekind/appbundler/pull-requests/48/workaround-for-java-9/diff\r\n- A mavenized fork of appbundler on GitHub (last updated 2017-12-11): https://github.com/teras/appbundler. Contains a commit addressing version checking (2017-12-08): https://github.com/teras/appbundler/commit/873c9abbbabb5098b2e432de73f726e9e6242682.\r\n\r\n### What did you expect\r\n\r\nI expected eXist-db.app to start with any version of Java 8 or higher.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n1. Install Java 11. Uninstalling other versions of Java may be necessary to prevent earlier versions from being the system default. Opening a new Terminal window and running `java -version` should report Java 11.\r\n2. Download eXist-db-4.4.0 DMG installer, open the DMG, and drag eXist-db.app into the Applications folder. \r\n3. Start eXist-db.app\r\n\r\nAlternative route: `brew cask install java exist-db` and start /Applications/eXist-db.app.\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 4.4.0 release\r\n- Java version: Java 11\r\n- Operating system: macOS 10.13\r\n- 32 or 64 bit: 64 big\r\n- How is eXist-db installed? DMG\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/2171", "user": "joewiz", "labels": ["bug"], "created": "2018-09-27 16:28:39", "closed": "2018-11-23 21:21:37", "commits": {}, "ttf": 57.000277777777775, "commitsDetails": []}, {"title": "Module import via remote URL is broken", "body": "### What is the problem\r\n\r\neXist used to support loading modules over the web, but doing so with 4.3.1 raises an error:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nimport module namespace functx = \"http://www.functx.com\" \r\n    at \"http://www.xqueryfunctions.com/xq/functx-1.0-doc-2007-01.xq\";\r\n\r\n\"hello\"\r\n```\r\n\r\nThe error raised is:\r\n\r\n> Invalid URI: xmldb URI scheme does not start with xmldb:: http://www.xqueryfunctions.com/xq/functx-1.0-doc-2007-01.xq\r\n\r\nUnder 4.0.0 (release), this query does not raise an error, but instead returns the expected result, `\"hello\"`.\r\n\r\n### What did you expect\r\n\r\nLoading modules via URI is discussed at https://exist-db.org/exist/apps/doc/xquery#module-system.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nSee test query above. The stack trace is:\r\n\r\n```text\r\n2018-09-15 15:16:56,737 [qtp2000015086-35] ERROR (XQueryServlet.java [process]:552) - Invalid URI: xmldb URI scheme does not start with xmldb:: http://www.xqueryfunctions.com/xq/functx-1.0-doc-2007-01.xq \r\njava.lang.IllegalArgumentException: Invalid URI: xmldb URI scheme does not start with xmldb:: http://www.xqueryfunctions.com/xq/functx-1.0-doc-2007-01.xq\r\n\tat org.exist.xmldb.XmldbURI.create(XmldbURI.java:219) ~[exist.jar:4.3.1]\r\n\tat org.exist.xmldb.XmldbURI.append(XmldbURI.java:595) ~[exist.jar:4.3.1]\r\n\tat org.exist.source.SourceFactory.getSource(SourceFactory.java:98) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.XQueryContext.importModule(XQueryContext.java:2846) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.importDecl(XQueryTreeParser.java:6312) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:5340) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.mainModule(XQueryTreeParser.java:4042) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:3987) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3642) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.XQuery.compile(XQuery.java:128) ~[exist.jar:4.3.1]\r\n        ...\r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 4.3.1 release\r\n- Java version: 10.0.2+13\r\n- Operating system: macOS 10.13.6\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed? DMG installer\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/2157", "user": "joewiz", "labels": ["bug", "regression"], "created": "2018-09-15 19:19:23", "closed": "2018-09-21 05:29:28", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "Bug in eXist's handling of / when a context item has been declared", "body": "### What is the problem\r\n\r\nSupport for the [context item declaration](https://www.w3.org/TR/xquery-31/#id-context-item-declarations) was added in #1571. eXist's implementation correctly redefines the [context item expression](https://www.w3.org/TR/xpath-31/#id-context-item-expression) `.` to be the item from the declaration. \r\n\r\nHowever, eXist's implementation does not carry this through to redefine the node selected by `/` (which the XPath spec [defines](https://www.w3.org/TR/xpath-31/#id-path-expressions) as \"an abbreviation for the initial step (`fn:root(self::node())` treat as `document-node()`)\"). \r\n\r\nInstead, eXist treats `/` as `collection()`, even when a context item has been declared.\r\n\r\nThis was first reported by @martin-honnen in https://github.com/eXist-db/eXide/issues/204.\r\n\r\n### What did you expect\r\n\r\nI expected eXist to return the same result for `/` as its expanded form `fn:root(self::node())` when a context item has been declared.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\ndeclare context item := document {\r\n    <root>\r\n        <item>foo</item>\r\n        <item>bar</item>\r\n        <item>foo</item>\r\n    </root>\r\n};\r\n\r\n. instance of document-node(),\r\nself::node() instance of document-node(),\r\nroot(self::node()) instance of document-node(),\r\n(/) instance of document-node()\r\n```\r\n\r\nThis query returns `true(), true(), true(), false()`. The final result should also be `true()`.\r\n\r\n(Unfortunately, XQSuite doesn't respect a context item declaration ... so a proper test would probably need to be implemented in java alongside the other tests for this feature in https://github.com/eXist-db/exist/blob/develop/test/src/org/exist/xquery/XQueryDeclareContextItemTest.java.)\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 4.3.1 release\r\n- Java version: 10.0.2+13\r\n- Operating system: macOS 10.13.6\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed: DMG installer\r\n- Any custom changes in e.g. conf.xml: None\r\n", "url": "https://github.com/eXist-db/exist/issues/2156", "user": "joewiz", "labels": ["bug"], "created": "2018-09-13 13:53:18", "closed": "2018-09-29 01:05:48", "commits": {"174c394a30ac6a460bf5696b3257485d59a29a10": {"commitGHEventType": "referenced", "commitUser": "joewiz"}, "429e670a7ffd5e64fe5f9f897a79db5731d0d65f": {"commitGHEventType": "closed", "commitUser": "joewiz"}, "98eff52f7fd8dd5c8f3a070c5b0fe49d39b8a7f5": {"commitGHEventType": "referenced", "commitUser": "joewiz"}}, "ttf": 15.000277777777777, "commitsDetails": [{"commitHash": "174c394a30ac6a460bf5696b3257485d59a29a10", "commitGHEventType": "referenced", "commitUser": "joewiz", "commitParents": ["8471de4d899a08b9558fcd4f96f45e22a07c3bf5", "bc79e00578d1c2b45c18c3110f8965cebd0b58d1"], "nameRev": "174c394a30ac6a460bf5696b3257485d59a29a10 tags/eXist-5.0.0-RC5~30", "commitMessage": "Merge pull request #2175 from dizzzz/bugfix/5xx_fix_context_handling\n\n5xx: Fix handling of / when context item was declared, closes #2156", "commitDateTime": "2018-09-28 21:05:38", "authoredDateTime": "2018-09-28 21:05:38", "commitGitStats": [{"filePath": "src/org/exist/xquery/RootNode.java", "insertions": 26, "deletions": 4, "lines": 30}, {"filePath": "test/src/org/exist/xquery/XQueryDeclareContextItemTest.java", "insertions": 20, "deletions": 0, "lines": 20}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RootNode.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.RootNode.eval(org.exist.xquery.value.Sequence,org.exist.xquery.value.Item)", "TOT": 6, "UPD": 4, "INS": 0, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.RootNode.returnsType()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.RootNode.eval(org.exist.xquery.Sequence,org.exist.xquery.Item)", "TOT": 5, "UPD": 0, "INS": 5, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "XQueryDeclareContextItemTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.XQueryDeclareContextItemTest.declareContextItemIsDocument()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "429e670a7ffd5e64fe5f9f897a79db5731d0d65f", "commitGHEventType": "closed", "commitUser": "joewiz", "commitParents": ["ec5b16a66029d804eaafb7246b11360b0fcbfddb"], "nameRev": "429e670a7ffd5e64fe5f9f897a79db5731d0d65f tags/eXist-5.1.0~314^2", "commitMessage": "[bugfix] Fix handling of / when context item was declared, closes #2156\n", "commitDateTime": "2018-09-27 22:37:24", "authoredDateTime": "2018-09-23 18:59:47", "commitGitStats": [{"filePath": "src/org/exist/xquery/RootNode.java", "insertions": 26, "deletions": 4, "lines": 30}, {"filePath": "test/src/org/exist/xquery/XQueryDeclareContextItemTest.java", "insertions": 20, "deletions": 0, "lines": 20}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RootNode.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.RootNode.eval(org.exist.xquery.value.Sequence,org.exist.xquery.value.Item)", "TOT": 6, "UPD": 4, "INS": 0, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.RootNode.returnsType()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.RootNode.eval(org.exist.xquery.Sequence,org.exist.xquery.Item)", "TOT": 5, "UPD": 0, "INS": 5, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "XQueryDeclareContextItemTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.XQueryDeclareContextItemTest.declareContextItemIsDocument()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "98eff52f7fd8dd5c8f3a070c5b0fe49d39b8a7f5", "commitGHEventType": "referenced", "commitUser": "joewiz", "commitParents": ["8ef6f2bf0dd927f70df85463631134e503a1108d", "429e670a7ffd5e64fe5f9f897a79db5731d0d65f"], "nameRev": "98eff52f7fd8dd5c8f3a070c5b0fe49d39b8a7f5 tags/eXist-5.1.0~314", "commitMessage": "Merge pull request #2176 from dizzzz/bugfix/develop_fix_context_handling\n\ndevelop: Fix handling of / when context item was declared, closes #2156", "commitDateTime": "2018-09-28 21:05:42", "authoredDateTime": "2018-09-28 21:05:42", "commitGitStats": [{"filePath": "src/org/exist/xquery/RootNode.java", "insertions": 26, "deletions": 4, "lines": 30}, {"filePath": "test/src/org/exist/xquery/XQueryDeclareContextItemTest.java", "insertions": 20, "deletions": 0, "lines": 20}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RootNode.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.RootNode.eval(org.exist.xquery.value.Sequence,org.exist.xquery.value.Item)", "TOT": 6, "UPD": 4, "INS": 0, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.RootNode.returnsType()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.RootNode.eval(org.exist.xquery.Sequence,org.exist.xquery.Item)", "TOT": 5, "UPD": 0, "INS": 5, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "XQueryDeclareContextItemTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.XQueryDeclareContextItemTest.declareContextItemIsDocument()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["429e670a7ffd5e64fe5f9f897a79db5731d0d65f"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 2, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 26, "deletions": 4, "lines": 30, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 12, "UPD": 5, "INS": 5, "MOV": 2, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 3}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/xquery"], "changesInPackagesSPOON": ["org.exist.xquery.RootNode.returnsType()", "org.exist.xquery.RootNode.eval(org.exist.xquery.value.Sequence,org.exist.xquery.value.Item)", "org.exist.xquery.RootNode.eval(org.exist.xquery.Sequence,org.exist.xquery.Item)"]}, {"title": "Bug in eXist's handling of / when using context item declaration", "body": "*@martin-honnen commented on Sep 11, 2018, 9:11 PM UTC:*\n\nWhen I run the code\n\n```xq\nxquery version \"3.1\";\n\ndeclare context item := document {\n<Toptag>\n<text coordinates=\"\" country=\"\" date=\"yyyy-mm-dd\" lang=\"\" place=\"xyc\" time=\"\" id=\" 123\"  name=\"xyz\" >\n<div>\nThis is text\n</div>\n</text>\n<text coordinates=\"\" country=\"\" date=\"yyyy-mm-dd\" lang=\"\" place=\"xyc\" \ntime=\"\" id=\" 124\"  name=\"xyz\" >\n<div>\nThis is text\n</div>\n</text>\n<text coordinates=\"\" country=\"\" date=\"yyyy-mm-dd\" lang=\"\" place=\"xyc\"         time=\"\" id=\" 123\"  name=\"xyz\" >\n<div>\nThis is text\n</div>\n</text>\n</Toptag>\n};\n\n/*/element { node-name() }\n{\n  for $child in *\n  group by $xml := serialize($child)\n  return $child[1]\n}\n```\n\nat [http://demo.exist-db.org/exist/apps/eXide/index.html](http://demo.exist-db.org/exist/apps/eXide/index.html) with the \"Eval\" button I get a strange result, it returns lots of elements like\n\n```\n<collection xmlns=\"http://exist-db.org/collection-config/1.0\">\n    <triggers>\n        <trigger class=\"org.exist.extensions.exquery.restxq.impl.RestXqTrigger\"/>\n    </triggers>\n</collection>\n2\n<package xmlns=\"http://expath.org/ns/pkg\">\n    <xquery>\n        <namespace>http://exist-db.org/apps/site-utils</namespace>\n        <file>siteutils.xql</file>\n    </xquery>\n   ...\n\n```\n\nResult I want is\n\n```\n<Toptag>\n  <text coordinates=\"\" country=\"\" date=\"yyyy-mm-dd\" lang=\"\" place=\"xyc\" time=\"\" id=\" 123\" name=\"xyz\">\n    <div>\nThis is text\n</div>\n  </text>\n  <text coordinates=\"\" country=\"\" date=\"yyyy-mm-dd\" lang=\"\" place=\"xyc\" time=\"\" id=\" 124\" name=\"xyz\">\n    <div>\nThis is text\n</div>\n  </text>\n</Toptag>\n\n```\n\nI tried to reproduce the problem with simpler input\n\n```\nxquery version \"3.1\";\n\ndeclare context item := document {\n    <root>\n        <item>foo</item>\n        <item>bar</item>\n        <item>foo</item>\n    </root>\n};\n\n*/element { node-name() }\n{\n    for $child in *\n    group by $xml := serialize($child)\n    return $child[1]\n}\n\n```\n\nbut there I get the correct result.\n\nI am not sure what the problem is related to but I get it reproduced with repeated evals in different browsers so I guess I let you know.\n\n*This issue was moved by [joewiz](https://github.com/joewiz) from [eXist-db/eXide#204](https://github.com/eXist-db/eXide/issues/204).*", "url": "https://github.com/eXist-db/exist/issues/2155", "user": "move[bot]", "labels": ["bug"], "created": "2018-09-13 13:24:58", "closed": "2018-09-13 13:53:54", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Two JSR305 jars?", "body": "In our archive i see to JSR305 jar files:\r\n\r\n<img width=\"1019\" alt=\"image\" src=\"https://user-images.githubusercontent.com/1700062/44958072-16e55800-aedb-11e8-9a26-02e601ebba31.png\">\r\n\r\nBoth are added by @adamretter  .... is this done on purpose?\r\n\r\ncheers\r\n\r\nDannes\r\n", "url": "https://github.com/eXist-db/exist/issues/2136", "user": "dizzzz", "labels": ["bug"], "created": "2018-09-02 16:10:14", "closed": "2018-12-04 01:07:46", "commits": {}, "ttf": 92.00027777777778, "commitsDetails": []}, {"title": "JMX servlet does not contain eXist-db specific information", "body": "### What is the problem\r\nThe url http://localhost:8080/exist/status does not return all required information for the Monex app. As a result the Monex app does not work as expected.\r\n\r\nin logging:\r\n\r\n```\r\n2018-08-16 10:25:52,196 [main] WARN  (AgentFactory.java [getInstance]:46) - Failed to instantiate class for JMX agent: org.exist.management.impl.JMXAgent \r\n```\r\n\r\nwith debugger\r\n\r\n```\r\njava.lang.IllegalAccessException: Class org.exist.management.AgentFactory can not access a member of class org.exist.management.impl.JMXAgent with modifiers \"private\"\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/1700062/44214884-6e609580-a171-11e8-9b26-0614556c4fff.png)\r\n\r\n### What did you expect\r\nThe XML file should contain the sections as defined in `org/exist/management/impl/JMXAgent.java`\r\n\r\n### Describe how to reproduce or add a test\r\n- Start monex\r\n- retrieve XML via URL\r\n\r\n### Context information\r\n\r\n- eXist-db version : 4.x.x / 24ec68348bcd7854d65b75c396de3acdfbd2932a\r\n- Java version (e.g. Java8u121) // java8U172\r\n- Operating system (Windows 7, Linux, MacOs) / windows\r\n- 32 or 64 bit / 64\r\n- How is eXist-db installed? (JAR installer, DMG, WAR file, clone from GitHub) / clone\r\n- Any custom changes in e.g. conf.xml / nope\r\n", "url": "https://github.com/eXist-db/exist/issues/2118", "user": "dizzzz", "labels": ["bug", "needs 4.x.x backport", "needs 5.0.0 backport", "needs develop port", "regression"], "created": "2018-08-16 14:22:07", "closed": "2018-09-02 15:47:35", "commits": {}, "ttf": 17.00027777777778, "commitsDetails": []}, {"title": "NPE for nesting for with group and order", "body": "eXist-db 4.3.1 macOS Mojave.\r\n\r\nI'm trying to get to the core of the problem but so far I cannot get closer than this query fragment:\r\n\r\n```xquery\r\ndeclare variable $colDecorCache     := collection('/db/apps/decor/cache');\r\ndeclare variable $colDecorData      := collection('/db/apps/decor/data');\r\n\r\ndeclare function local:getTemplateById($id as xs:string, $flexibility as xs:string?, $prefix as xs:string, $version as xs:string?) {\r\n\r\nlet $internalrepositories       := $colDecorData/decor[project/@prefix = $prefix][1]\r\nlet $buildingBlockRepositories  := $internalrepositories/project/buildingBlockRepository\r\nlet $x                          := local:getTemplateById($prefix, $id, $prefix, $buildingBlockRepositories, ())\r\n\r\nreturn ()\r\n};\r\n\r\ndeclare %private function local:getTemplateById($basePrefix as xs:string, $id as xs:string, $prefix as xs:string, $externalrepositorylist as element()*, $bbrList as element()*) as element()* {\r\n    for $repository in $externalrepositorylist\r\n    let $repourl                := $repository/@url\r\n    let $repoident              := $repository/@ident\r\n    return\r\n        <repositoryTemplateList>\r\n        {\r\n                let $cachedProject  := $colDecorCache//cacheme[@bbrident = $repoident][@bbrurl = $repourl]/decor\r\n                return ()\r\n        }\r\n        </repositoryTemplateList>\r\n};\r\n\r\n<x>\r\n{\r\n    (: Don't show links for templates in versioned projects :)\r\n    for $projectTemplateSet in $colDecorData/decor[@repository = 'true']//template[@ref]\r\n    let $prefix                 := $projectTemplateSet/ancestor::decor/project/@prefix\r\n    let $tid                    := $projectTemplateSet/@id | $projectTemplateSet/@ref\r\n    group by $prefix, $tid\r\n    order by $prefix, $tid\r\n    return (\r\n        for $template in $projectTemplateSet\r\n        return (\r\n            if ($template[@ref]) then (\r\n                local:getTemplateById($template/@ref, 'dynamic', $prefix, ())//template[@id]\r\n            ) else ()\r\n        )\r\n    )\r\n}\r\n</x>\r\n```\r\n\r\nThis code yields a NullPointException from the exist.log no stack trace:\r\n\r\n```\r\n2018-08-03 17:30:41,336 [qtp1226557879-3531] INFO  (XQueryServlet.java [init]:158) - encoding = UTF-8 \r\n2018-08-03 17:30:41,371 [qtp1226557879-3531] ERROR (XQueryServlet.java [process]:552) - null \r\njava.lang.NullPointerException: null\r\n```\r\n\r\nWhen I remove the line \"order by $prefix, $tid\" the xquery finishes normally. When I remove the line \"let $cachedProject  := $colDecorCache//cacheme[@bbrident = $repoident][@bbrurl = $repourl]/decor\" the xquery finishes normally.\r\n\r\nThe collection that $colDecorCache operates on has combined range indexes configured.\r\n\r\nThis xquery fragment is hard to replay anywhere else because of data requirements. I still hope we can get to the bottom of it.\r\n", "url": "https://github.com/eXist-db/exist/issues/2099", "user": "ahenket", "labels": ["bug"], "created": "2018-08-03 15:33:53", "closed": "2018-10-22 20:02:05", "commits": {}, "ttf": 80.00027777777778, "commitsDetails": []}, {"title": "arrow operator in combination with range index", "body": "### What is the problem\r\n\r\nThe following expressions (which should be interpreted and evaluated identically as far as I know),\r\n\r\n```xquery\r\n$coll//a[contains(., 'str')] => count()\r\n```\r\nand\r\n```xquery\r\ncount( $coll//a[contains(., 'str')] )\r\n```\r\n... may, in fact, return different values.\r\n\r\nAfter some investigation I concluded that the difference is due to the fact that element 'a' has a case-insensitive range index defined on it, and the first expression containing the arrow operator fails to use the index, hence the different results.\r\n\r\nSimilar expressions with a `matches(., 'str')` filter clause always give identical values.\r\n\r\n### What did you expect\r\n\r\nI expected the two expressions to be evaluated in exactly the same way\r\n\r\n### Context information\r\n\r\n- eXist-db version: 4.3.1\r\n- Java version: Java8u161\r\n- Operating system: Win10\r\n- 64 bit\r\n- How is eXist-db installed? jar\r\n- no custom changes\r\n", "url": "https://github.com/eXist-db/exist/issues/2092", "user": "merenyics", "labels": ["bug", "xquery"], "created": "2018-08-01 12:07:23", "closed": "2020-04-09 08:52:23", "commits": {}, "ttf": 616.0002777777778, "commitsDetails": []}, {"title": "Packagemanager can't read repo", "body": "eXist-db 4.3.1 - Dashboard 1.1.0 - any platform\r\nrepo 0.6.0\r\n\r\nWhen I try to get to packages from our own repository (http://decor.nictiz.nl/apps/public-repo-dev) I get a 404 in the package manager. Looking a little deeper the problem is that when it tries to load the `apps.xml` list, it interprets that list to be `text/xml` instead of `application/xml`.\r\n\r\nThis happens in function packages:public-repo-contents in the line\r\n\r\n```xquery\r\nlet $data := http:send-request($request)\r\n```\r\n\r\nYou can replay that in Postman/curl and see what comes back (application/xml) using a simple http GET on:\r\n\r\n```\r\nhttp://decor.nictiz.nl/apps/public-repo-dev/public/apps.xml?version=4.3.1&amp;source=\r\n```\r\n\r\nBut you when http:send-request() executes, you'll get:\r\n\r\n```xml\r\n<hc:response xmlns:hc=\"http://expath.org/ns/http-client\" status=\"200\" message=\"OK\" spent-millis=\"136\">\r\n    <hc:header name=\"server\" value=\"nginx/1.10.2\"/>\r\n    <hc:header name=\"date\" value=\"Mon, 30 Jul 2018 01:55:16 GMT\"/>\r\n    <hc:header name=\"content-type\" value=\"text/plain; charset=utf-8\"/>\r\n    <hc:header name=\"transfer-encoding\" value=\"chunked\"/>\r\n    <hc:header name=\"connection\" value=\"keep-alive\"/>\r\n    <hc:header name=\"x-xquery-cached\" value=\"true\"/>\r\n    <hc:body media-type=\"text/plain\"/>\r\n</hc:response>&lt;apps version=\"4.3.1\"&gt; ... &lt;/apps&gt;\r\n```\r\n\r\nTo work around this problem I've replaced the call `http:send-request($request)` with `httpclient:get(xs:anyURI($url),false(), $request)` because the older HTTP client module will accept the body as XML.\r\n\r\nReproduction code:\r\n\r\n```xquery\r\nxquery version \"3.0\";\r\n\r\ndeclare namespace http = \"http://expath.org/ns/http-client\";\r\n\r\nlet $base   := 'http://decor.nictiz.nl/apps/public-repo-dev'\r\n\r\nlet $url    := $base || \"/public/apps.xml?version=4.3.1&amp;source=\" || util:system-property(\"product-source\")\r\n\r\nlet $request :=\r\n    <http:request method=\"get\" href=\"{$url}\" timeout=\"10\">\r\n        <http:header name=\"Cache-Control\" value=\"no-cache\"/>\r\n    </http:request>\r\n\r\nlet $expath-response    := httpclient:get(xs:anyURI($url),false(), $request)\r\nlet $exist-response     := http:send-request($request)\r\n\r\nreturn\r\n    <x url=\"{$url}\">\r\n        <!-- response by expath http client -->\r\n        {$expath-response}\r\n        <!-- response by exist-db http client -->\r\n        {$exist-response}\r\n    </x>\r\n```", "url": "https://github.com/eXist-db/exist/issues/2079", "user": "ahenket", "labels": ["bug"], "created": "2018-07-30 02:01:03", "closed": "2018-07-31 05:24:29", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Templating and transform:transform: empty output on error", "body": "## What is the problem\r\n- The templating system is used to provide the basic HTML for displaying the result of an XSL transformation:\r\n```html\r\n<html data-template=\"wdb:getEE\">\r\n    <head><title>test</title></head>\r\n    <body>\r\n        <div id=\"wdbContent\" data-template=\"wdb:getContent\" />\r\n    </body>\r\n</html>\r\n```\r\n- the function to apply the transformation is basically this:\r\n```xquery\r\ndeclare function wdb:getContent($node as node(), $model as map(*)) {\r\n  let $re :=\r\n    try { transform:transform(doc($file), doc($xslt), $params, $attr, \"expand-xincludes=no\") }\r\n    catch * { <h1>Error</h1> }\r\n\t\r\n  return \r\n    <div id=\"wdbContent\">\r\n        {$re}\r\n    </div>\r\n};\r\n```\r\n- this works fine if there are no errors in the XSLT. However, if there is an error, e.g. calling `doc()` on a file that does not exist, the output is an empty file:\r\n```html\r\n<!DOCTYPE html>\r\n<html></html>\r\n```\r\n## What did you expect\r\nThe output of the given HTML in case of an error.\r\n\r\n### additional observations:\r\n1. calling `wdb:getContent` with exactly the same parameters from eXide produces the expected output in case of an error\r\n1. everything else inside the `catch` is processed correctly \u2013 I tried to `console:log` before returning output, which worked, and forwarding handling to another function: there, too, `console:log` worked but no output was produced\r\n1. using `transform:stream-transform` returns the expected output in case of an error (but of course won't work correctly with the templating system)\r\n\r\n## Describe how to reproduce or add a test\r\nThe attached .zip contains an example. Store in `/db/apps` and call `$server/exist/apps/catch/view.html`.\r\nIf the line with `doc()` is commented out in the XSLT, you get \u201cTesting\u201d; if it is active, you get an empty response. If you use `stream-transform` instead of `transform` in app.xql, you get \u201cerror\u201c if the `doc()` line is active.\r\n[catch.zip](https://github.com/eXist-db/exist/files/2236586/catch.zip)\r\n\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db: 4.3.0\r\n- Java version: 1.8.0_171\r\n- Operating system: tested on Ubuntu 16.04 and Windows 10\r\n- 64 bit\r\n- How is eXist-db installed? JAR installer\r\n- Any custom changes in e.g. conf.xml: added an additional `root` to `controller-config.xml` on the Ubuntu machine; this is not present under Windows.\r\n", "url": "https://github.com/eXist-db/exist/issues/2074", "user": "dariok", "labels": ["bug"], "created": "2018-07-27 16:55:49", "closed": "2019-01-13 10:43:57", "commits": {}, "ttf": 169.00027777777777, "commitsDetails": []}, {"title": "Restoring from backup fails in 5.0.0", "body": "### What is the problem\r\nRestoring from backup fails in 5.0.0 with the message\r\n\r\n```\r\nStarting restore of backup...\r\nProcessing backup: /Users/ttasovac/Downloads/test.zip#db/test/__contents__.xml\r\nCreating collection /db/test\r\nAn unrecoverable error occurred while restoring\r\ncollection '/db/test': Database instance 'exist' is not available. Aborting restore!\r\nFinished restore of backup.\r\n```\r\n### Describe how to reproduce or add a test\r\n1.  Create a new collection (\"test\")\r\n2. Back up the collection \"test\" \r\n3. Restore from the previously made backup\r\n4. The restore will fail.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version: 5.0.0RC1 and 5.0.0RC2\r\n- Java version: 1.8.0_144-b01\r\n- Operating system: Mac OS\r\n- 64 bit\r\n- How is eXist-db installed? DMG", "url": "https://github.com/eXist-db/exist/issues/2064", "user": "ttasovac", "labels": ["bug"], "created": "2018-07-27 05:44:16", "closed": "2018-07-28 05:10:06", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "sibling axes used without element name very inefficient", "body": "### What is the problem\r\n> whereas an XPath expression like\r\n`preceding-sibling::a`\r\nworks as it should, more general expressions involving the sibling axes are _extremely_ inefficient.\r\n`preceding-sibling::*\r\npreceding-sibling::node()\r\npreceding-sibling::text()\r\n`\r\ndo seem to work, but take ages to evaluate both as steps in an XPath and as filter expressions. The same goes for following-sibling.\r\n\r\n### What did you expect\r\n> fast execution\r\n\r\n### Describe how to reproduce or add a test\r\n> On a collection containing just a few thousand elements `<a>`, run a query like\r\n`$coll//a[following-sibling::*]`\r\nsit back and relax (for 10-30 minutes!!!)\r\n\r\nI would also like to add that these queries cannot be killed, or more precisely, killing them takes just as long as running them.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version : all recent versions, I'm using 4.3 at the moment\r\n- Java version (Java8u161)\r\n- Operating system (Windows 10)\r\n- 64 bit\r\n- How is eXist-db installed? (JAR installer)\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/2051", "user": "merenyics", "labels": ["bug", "in progress", "investigate"], "created": "2018-07-20 16:09:46", "closed": "2019-10-31 10:03:09", "commits": {}, "ttf": 467.0002777777778, "commitsDetails": []}, {"title": "calling a non-existent templating function no longer(?) reports error", "body": "\r\n### What is the problem\r\n> If I remember correctly, prior to version 4.3 calling a templating function like this\r\n `<div class=\"some:function\"/>` \r\nresulted in an error being thrown immediately, indicating that the given function does not exist. Right now, using 4.3, the server does not respond within a reasonable amount of time, I can see in Monex that a query is running (view.xql) but it won't return, I need to kill it manually.\r\n\r\n### What did you expect\r\n> I expected to get the error message I used to get, instead of the query hanging\r\n\r\n### Describe how to reproduce or add a test\r\n> Just try calling a non-existent function using templating\r\n\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version 4.3\r\n- Java version Java8u161\r\n- Operating system Windows 10 \r\n- 64 bit\r\n- How is eXist-db installed? (JAR installer)\r\n- no custom changes\r\n", "url": "https://github.com/eXist-db/exist/issues/2050", "user": "merenyics", "labels": ["bug"], "created": "2018-07-20 15:56:18", "closed": "2018-08-08 19:16:14", "commits": {}, "ttf": 19.00027777777778, "commitsDetails": []}, {"title": "Changes to global variable reset in modules causes regressions", "body": "This commit: https://github.com/eXist-db/exist/commit/7e6b2691012cfccb76fd772c0aacfa5d55eaa505#diff-1a7f6e1a39c50b3b42adcf60d6dfc6bd \r\n\r\nchanged the behavior for how global variables are reset in eXist. The issue is that multiple instances of modules are instantiated as part of normal system operation. However some modules are still in use when others are reset, this causes the global variables to be nullified across all instances of the module prematurely causing queries that rely on these to fail.\r\n\r\nIt seems that in order to prevent this from happening globalVariables must either not be static or more logic must be implemented to ensure that reset is not called while modules are still referenced or in use.\r\n", "url": "https://github.com/eXist-db/exist/issues/2042", "user": "caseydawsonjordan", "labels": ["bug"], "created": "2018-07-16 15:41:23", "closed": "2018-07-24 08:53:56", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "Cannot import DTD to Exist server using \"RemoteCollection\" API (Exist 4.3.0)", "body": "Using Oxygen XML Editor with Exist 4.3.0 to import a local DTD to an Exist DB.\r\nCode looks like this:\r\n\r\n```java\r\n    /**\r\n     * Creates a eXist resource into the eXist collection.\r\n     * \r\n     * @see ro.sync.db.nxd.NXDContainer.ImportCollection#createResource(java.io.File)\r\n     */\r\n    @Override\r\n    public void createResource(File file) throws DBException {\r\n      \r\n      XmldbURI filenameUri;\r\n      try {\r\n          filenameUri = URIUtils.encodeXmldbUriFor(file.getName());\r\n      } catch (URISyntaxException e1) {\r\n          throw new DBException(file.getAbsolutePath()+ \" could not be encoded as a URI\");\r\n      }\r\n\r\n      // The unit is a file, add the file as a resource.\r\n      MimeType mimeType = ((ExistSession) getDBLink()).getContentType(file.getName());\r\n      if (mimeType == null || mimeType.getXMLDBType() == null) {\r\n        if (logger.isDebugEnabled()) {\r\n          logger.debug(\"\\nFile \" + file.getName()\r\n              + \" has an unknown suffix. Assuming binary type.\\n\");\r\n        }\r\n        mimeType = MimeType.BINARY_TYPE;\r\n      }\r\n      try {\r\n        Resource document = existCollection.createResource(filenameUri.toString(), mimeType.getXMLDBType());\r\n        ((EXistResource) document).setMimeType(mimeType.getName());\r\n        //EXM-39520 Try to close the input streams ourselves, as Exist does not do that...\r\n        InputSource is = new InputSource();\r\n        FileInputStream fis = null;\r\n        try{\r\n          fis = new FileInputStream(file);\r\n          is.setByteStream(fis);\r\n          try {\r\n            is.setSystemId(URLUtil.correct(file).toString());\r\n          } catch (MalformedURLException e) {\r\n            //Ignore\r\n          }\r\n          document.setContent(is);\r\n          existCollection.storeResource(document);\r\n        } finally {\r\n          if(fis != null){\r\n            try{\r\n              fis.close();\r\n            } catch(IOException ex){\r\n              //Ignore\r\n            }\r\n          }\r\n        }\r\n      } catch (XMLDBException e) {\r\n        throw new DBException(getCause(e), ExistContainer.this);\r\n      } catch (FileNotFoundException e) {\r\n        throw new DBException(e, ExistContainer.this);\r\n      }\r\n    }\r\n```\r\nand throws this error:\r\n\r\n        org.apache.xmlrpc.XmlRpcException: Failed to invoke method parseLocalExt in class org.exist.xmlrpc.RpcConnection: null\r\n        \tat ro.sync.db.nxd.exist.ExistContainer$ExistImportCollection.createResource(ExistContainer.java:674)\r\n        \tat ro.sync.db.nxd.NXDContainer.importUnit(NXDContainer.java:369)\r\n        \tat ro.sync.db.nxd.NXDContainer.importUnits(NXDContainer.java:465)\r\n        \tat ro.sync.db.nxd.NXDContainer.internalImport(NXDContainer.java:435)\r\n        \tat ro.sync.db.DBDnDTreeHandler$1.appRun(DBDnDTreeHandler.java:421)\r\n        \tat ro.sync.ui.application.ApplicationThread.run(ApplicationThread.java:135)\r\n        Caused by: org.apache.xmlrpc.XmlRpcException: Failed to invoke method parseLocalExt in class org.exist.xmlrpc.RpcConnection: null\r\n        \tat org.apache.xmlrpc.client.XmlRpcStreamTransport.readResponse(XmlRpcStreamTransport.java:197)\r\n        \tat org.apache.xmlrpc.client.XmlRpcStreamTransport.sendRequest(XmlRpcStreamTransport.java:156)\r\n        \tat org.apache.xmlrpc.client.XmlRpcHttpTransport.sendRequest(XmlRpcHttpTransport.java:143)\r\n        \tat org.apache.xmlrpc.client.XmlRpcSunHttpTransport.sendRequest(XmlRpcSunHttpTransport.java:69)\r\n        \tat org.apache.xmlrpc.client.XmlRpcClientWorker.execute(XmlRpcClientWorker.java:56)\r\n        \tat org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:167)\r\n        \tat org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:158)\r\n        \tat org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:147)\r\n        \tat org.exist.xmldb.RemoteCollection.uploadAndStore(RemoteCollection.java:686)\r\n        \tat org.exist.xmldb.RemoteCollection.storeResource(RemoteCollection.java:502)\r\n        \tat org.exist.xmldb.RemoteCollection.storeResource(RemoteCollection.java:471)\r\n        \tat ro.sync.db.nxd.exist.ExistContainer$ExistImportCollection.createResource(ExistContainer.java:663)\r\n        \t... 5 more", "url": "https://github.com/eXist-db/exist/issues/2036", "user": "raducoravu", "labels": ["bug"], "created": "2018-07-16 05:32:09", "closed": "2018-07-19 06:35:13", "commits": {"ba6309e922f2809e82dc1685080b7aa55b634720": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "ba6309e922f2809e82dc1685080b7aa55b634720", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["fc14020519af7d7ee3d17173f002823239b9b108"], "nameRev": "ba6309e922f2809e82dc1685080b7aa55b634720 tags/eXist-5.1.0~345^2", "commitMessage": "[bugfix] Fix another issue with uploading 0-byte binary files\nCloses https://github.com/eXist-db/exist/issues/2036\n", "commitDateTime": "2018-07-16 18:41:10", "authoredDateTime": "2018-07-16 18:35:22", "commitGitStats": [{"filePath": "src/org/exist/xmldb/RemoteCollection.java", "insertions": 4, "deletions": 2, "lines": 6}, {"filePath": "test/src/org/exist/xmldb/RemoteCollectionTest.java", "insertions": 29, "deletions": 0, "lines": 29}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RemoteCollection.java", "spoonMethods": [{"spoonMethodName": "org.exist.xmldb.RemoteCollection.uploadAndStore(org.exist.xmldb.Resource)", "TOT": 5, "UPD": 0, "INS": 1, "MOV": 3, "DEL": 1}]}, {"spoonFilePath": "RemoteCollectionTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.xmldb.RemoteCollectionTest.createEmptyBinaryResource()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["ba6309e922f2809e82dc1685080b7aa55b634720"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 4, "deletions": 2, "lines": 6, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 5, "UPD": 0, "INS": 1, "MOV": 3, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/xmldb"], "changesInPackagesSPOON": ["org.exist.xmldb.RemoteCollection.uploadAndStore(org.exist.xmldb.Resource)"]}, {"title": "GPL issue with Exificient", "body": "The version of Exificient (0.9.3) that we ship in `lib/user`, is licensed under GPL v2. See https://search.maven.org/remotecontent?filepath=com/siemens/ct/exi/exificient/0.9.3/exificient-0.9.3.pom for confirmation.\r\n\r\nNewer versions are licensed until MIT. We should either update, or remove the module from the main code base.\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/2015", "user": "adamretter", "labels": ["bug", "high prio", "needs resolution"], "created": "2018-07-10 19:12:42", "closed": "2019-12-02 18:58:01", "commits": {}, "ttf": 509.0002777777778, "commitsDetails": []}, {"title": "Xerces 2.12: problems with betterform <xf:bind/>", "body": "### What is the problem\r\n\r\nthe update to xerces 2.12 leads to NullPointerExecption if betterform is used.\r\nthe problem seems to be a call via <xf:bind id=\"\" ref=\"\" type=\"xs:int\"/>.\r\nActually only the datatype xs:string is ok (xf:integer, xf:boolean tested with error result).\r\n\r\n```\r\nCaused by: java.lang.NullPointerException\r\n946     at org.apache.xerces.impl.dv.xs.XSSimpleTypeDecl.getActualValue(Unknown Source) ~[xercesImpl-2.12.0.jar:?]\r\n947     at org.apache.xerces.impl.dv.xs.XSSimpleTypeDecl.validate(Unknown Source) ~[xercesImpl-2.12.0.jar:?]\r\n948     at de.betterform.xml.xforms.model.constraints.Validator.checkDatatype(Validator.java:303) ~[betterform-exist-5.1-SNAPSHOT-20160615.jar:?]\r\n949     at de.betterform.xml.xforms.model.constraints.Validator.validate(Validator.java:257) ~[betterform-exist-5.1-SNAPSHOT-20160615.jar:?]\r\n950     at de.betterform.xml.xforms.model.constraints.Validator.validate(Validator.java:213) ~[betterform-exist-5.1-SNAPSHOT-20160615.jar:?]\r\n951     at de.betterform.xml.xforms.model.constraints.Validator.validate(Validator.java:190) ~[betterform-exist-5.1-SNAPSHOT-20160615.jar:?]\r\n```\r\n\r\n### What did you expect\r\n\r\nI know it is a betterform problem not a eXist, but it is relevant for some eXist users.\r\nbetterform xf:bind should be usable with type validation\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nas far I could reduce it.\r\nsome test app for betterform is needed (a little bit complex but the gurus knows ;-)\r\nand the following example app function:\r\n\r\n--\r\n see next comment\r\n---\r\n\r\nreverting to xerces 2.11 resolves the problem\r\n\r\n### Context information\r\n8 Jul 2018 11:20:08,957 [main] INFO  (JettyStart.java [run]:146) - Running with Java 1.8.0_171 [Oracle Corporation (Java HotSpot(TM) 64-Bit Server VM) in /usr/lib/jvm/java-8-oracle/jre]\r\n08 Jul 2018 11:20:08,957 [main] INFO  (JettyStart.java [run]:153) - Running as user 'peter'\r\n08 Jul 2018 11:20:08,957 [main] INFO  (JettyStart.java [run]:154) - [eXist Home : /media/peter/TrekStor/existdb-4.0]\r\n08 Jul 2018 11:20:08,958 [main] INFO  (JettyStart.java [run]:155) - [eXist Version : 4.3.0]\r\n08 Jul 2018 11:20:08,959 [main] INFO  (JettyStart.java [run]:156) - [eXist Build : 201807081118]\r\n08 Jul 2018 11:20:08,959 [main] INFO  (JettyStart.java [run]:157) - [Git commit : dd335e5]\r\n08 Jul 2018 11:20:08,959 [main] INFO  (JettyStart.java [run]:159) - [Operating System : Linux 4.4.0-130-generic amd64]\r\nno relevant changes to conf.xml\r\n", "url": "https://github.com/eXist-db/exist/issues/2007", "user": "pherk", "labels": ["bug", "regression", "security"], "created": "2018-07-08 17:14:24", "closed": "2018-08-02 12:59:55", "commits": {}, "ttf": 24.00027777777778, "commitsDetails": []}, {"title": "Fetching LDAP groups does not work correctly because some escaping is missing", "body": "### What is the problem\r\n- If you have a user name containing ```\\``` and ```()``` like ```Omar\\, Siam``` in an organisational unit like ```Austrian Center for digital humanities (ACDH)``` the LDAP code is unable to search for the corresponding groups because  for the search the DN is taken as is.\r\n\r\n### What did you expect\r\n* The ```\\``` and ```()``` need to be escaped. ```\\5c, \\28, \\29```.\r\n\r\n### Describe how to reproduce or add a test\r\n* Try the literal representation in Apache Directory Studio. Does not work.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist Version : 4.3.0 eXist Build : 201807061041 Git commit : 3d6c60327\r\n- jre1.8.0_172\r\n- Windows 10\r\n- 64 bit\r\n- JAR installer\r\n", "url": "https://github.com/eXist-db/exist/issues/2001", "user": "simar0at", "labels": ["bug"], "created": "2018-07-06 16:02:46", "closed": "2018-07-13 07:01:35", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "Fetching LDAP users from our server ends in an exception and additional groups a user might be in are never fetched.", "body": "### What is the problem\r\n* `LDAPRealm` contains code that `LdapUtils.closeContext(ctx)` even though `ctx` gets passed in as final and is not created within the method\r\n*  `createAccountInDatabase` at line 334 passes the `LdapContext` to `getGroup` (line 348) which closes it and then to `getGroupMembershipForLdapUser` (line 364) which tries to use it to get more group memberships for the user.\r\n* this is not fatal but JDK tries to recreate the context using properties normally not set when running exist-db instead of using the configutation at `/db/security/config.xml`\r\n* In the logs there is \r\n```\r\nERROR (LDAPRealm.java [findGroupnamesForUserDistinguishedName]:1049) - org.exist.security.AuthenticationException: Need to specify class name in environment or system property, or as an applet parameter, or in an application resource file:  java.naming.factory.initial\r\n```\r\n\r\n### What did you expect\r\n* LDAP user and all her groups are fetched\r\n\r\n### Describe how to reproduce or add a test\r\n* Configure your exist db to fetch users from an LDAP server (ours is an AD) I think it is not relevant that has additional groups in memberOf, the error will occur when trying to get this information.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist Version : 4.3.0 eXist Build : 201807061041 Git commit : 3d6c60327\r\n- jre1.8.0_172\r\n- Windows 10\r\n- 64 bit\r\n- JAR installer\r\n- /db/system/security/config.xml\r\n```xml\r\n<security-manager xmlns=\"http://exist-db.org/Configuration\" last-account-id=\"12\" last-group-id=\"12\" version=\"2.0\">\r\n    <authentication-entry-point>/authentication/login</authentication-entry-point>\r\n<!--<events></events>-->\r\n    <realm id=\"LDAP\" version=\"1.0\" principals-are-case-insensitive=\"true\">\r\n        <context>\r\n            <authentication>simple</authentication>\r\n            <use-ssl>true</use-ssl>\r\n<!--<principal-pattern></principal-pattern>-->\r\n            <url>ldaps://xxxxxxx.yyy.ads:636</url>\r\n            <domain>yyy.ads</domain>\r\n            <search>\r\n                <base>dc=yyy,dc=ads</base>\r\n                <default-username>xxxxxxx@yyy.ads</default-username>\r\n                <default-password>xxxxxxxxx</default-password>\r\n                <account>\r\n                    <search-filter-prefix>objectClass=user</search-filter-prefix>\r\n                    <search-attribute key=\"primaryGroupID\">primaryGroupID</search-attribute>\r\n                    <search-attribute key=\"name\">sAMAccountName</search-attribute>\r\n                    <search-attribute key=\"objectSid\">objectSid</search-attribute>\r\n                    <search-attribute key=\"dn\">distinguishedName</search-attribute>\r\n                    <search-attribute key=\"memberOf\">memberOf</search-attribute>\r\n                    <metadata-search-attribute key=\"http://axschema.org/namePerson/last\">sn</metadata-search-attribute>\r\n                    <metadata-search-attribute key=\"http://axschema.org/namePerson/first\">givenName</metadata-search-attribute>\r\n                    <metadata-search-attribute key=\"http://axschema.org/namePerson\">name</metadata-search-attribute>\r\n                    <metadata-search-attribute key=\"http://axschema.org/contact/email\">mail</metadata-search-attribute>\r\n<!--<whitelist></whitelist>-->\r\n<!--<blacklist></blacklist>-->\r\n                </account>\r\n                <group>\r\n                    <search-filter-prefix>objectClass=group</search-filter-prefix>\r\n                    <search-attribute key=\"member\">member</search-attribute>\r\n                    <search-attribute key=\"name\">sAMAccountName</search-attribute>\r\n                    <search-attribute key=\"objectSid\">objectSid</search-attribute>\r\n                    <search-attribute key=\"dn\">distinguishedName</search-attribute>\r\n                    <search-attribute key=\"primaryGroupToken\">primaryGroupToken</search-attribute>\r\n<!--<whitelist></whitelist>-->\r\n<!--<blacklist></blacklist>-->\r\n                </group>\r\n            </search>\r\n            <transformation>\r\n                <add-group>group.users</add-group>\r\n            </transformation>\r\n        </context>\r\n    </realm>\r\n</security-manager>\r\n```\r\n", "url": "https://github.com/eXist-db/exist/issues/2000", "user": "simar0at", "labels": ["bug"], "created": "2018-07-06 15:54:15", "closed": "2018-07-13 07:01:35", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "Nixos and non-standard paths", "body": "The installer cannot set rights through `chmod`\r\n\r\n```shell\r\n[ WARNING: Error executing\r\n/bin/chmod a+x /.../exist/start.jar ]\r\n[ ERROR: The installation was not completed ]\r\n[ Unpacking finished ]\r\n```\r\n\r\nbecause it is not found under `/bin`.\r\n\r\nWhen using `startup.sh` there is a similar problem\r\n\r\n```shell\r\n/.../exist/bin/functions.d/eXist-settings.sh: line 14: /usr/bin/dirname: No such file or directory\r\n/.../exist/bin/functions.d/eXist-settings.sh: line 14: /bin/pwd: No such file or directory\r\nUnable to find start.jar. Please set EXIST_HOME to point to your installation directory.\r\n```\r\n\r\nThese are the paths on Nixos\r\n\r\n```shell\r\n$ type chmod\r\nchmod is /run/current-system/sw/bin/chmod\r\n$ type dirname\r\ndirname is /run/current-system/sw/bin/dirname\r\n$ type pwd\r\npwd is a shell builtin\r\npwd is /run/current-system/sw/bin/pwd\r\n```\r\n\r\nThe solution for the `startup.sh` script is to change line 14 in `bin/functions.d/eXist-settings.sh` to\r\n\r\n```shell\r\n                (cd $(dirname \"$p\") ; pwd)\r\n```\r\n\r\nbash should know the path to the executables anyway.", "url": "https://github.com/eXist-db/exist/issues/1999", "user": "tasmo", "labels": ["bug"], "created": "2018-07-06 11:12:59", "closed": "2019-01-18 11:32:02", "commits": {}, "ttf": 196.00027777777777, "commitsDetails": []}, {"title": "Parsing error XPST0003 when constructing attribute values", "body": "### What is the problem\r\n\r\nThe following query raises an XPST0003 error in eXist, but does not in Saxon or BaseX:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\n<x y=\"{'z'}\"/>\r\n```\r\n\r\nThe error:\r\n\r\n> Cannot compile xquery: err:XPST0003 unexpected token: ' (while expecting closing tag for element constructor: x) [at line 3, column 8]\r\n\r\n### What did you expect\r\n\r\nI expected the query to return `<x y=\"z\"/>`\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nTo trigger the error, use a direct constructor to create an attribute value with an enclosed expression beginning with a literal string - no matter the variant of single or double quotes used for the literal string:\r\n\r\n```xquery\r\n<x y=\"{\"z\"}\"/>\r\n<x y=\"{'z'}\"/>\r\n<x y='{\"z\"}'/>\r\n<x y='{'z'}'/>\r\n```\r\n\r\nThe error can be avoided if any other kind of expression appears (first) in the enclosed expression:\r\n\r\n```xquery\r\n<x y='{string-join(('z'), '')}'/>\r\n<x y='{<z>z</z>}'/>\r\n<x y='{1 || 'z'}'/>\r\n<x>{ attribute y {'z'} }</x>\r\n```\r\n\r\nComments don't work though:\r\n\r\n```xquery\r\n<x y='{(: darn :) 'z'}'/>\r\n```\r\n\r\nAgain, Saxon and BaseX do not exhibit the error above.\r\n\r\n### Context information\r\n\r\n- eXist-db version: 5.0.0-RC1 develop ece9d6ded (also tested with 4.2.1)\r\n- Java version: 1.8.0_172\r\n- Operating system: macOS 10.13.5\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed? build from source\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/1988", "user": "joewiz", "labels": ["bug", "duplicate"], "created": "2018-07-01 21:53:07", "closed": "2019-01-12 13:01:27", "commits": {}, "ttf": 194.00027777777777, "commitsDetails": []}, {"title": "Namespaces mangled on using doc() with file:/ ", "body": "### What is the problem\r\nAfter reporting #1975 I tried to load the doc from the file system using `doc('file:/path/to/file.xml')` (as the `admin` user).\r\n\r\nBig surprise: it totally mangles the namespaces!\r\n\r\nWhat goes in as:\r\n```xml\r\n<book dtd-version=\"2.0xxxxx\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns:mml=\"http://www.w3.org/1998/Math/MathML\" xml:lang=\"en\">\r\n```\r\n\r\nComes out as:\r\n```xml\r\n<book xmlns=\"http://www.w3.org/1998/Math/MathML\" xmlns:mml=\"http://www.w3.org/1998/Math/MathML\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns=\"\" dtd-version=\"2.0xxxxx\" xml:lang=\"en\">\r\n```\r\n\r\nNote the double `xmlns=\"\"`, this makes the document not well-formed\r\n\r\n### What did you expect\r\nUsing `doc()` with a `file:/` URL should load the document from the file system as-is, not mangle it.\r\n\r\n### Describe how to reproduce or add a test\r\nTry to load the following XML (in the zip) file from the file system using `doc('file:/path/to/the/file.xml')` in an XQuery script as admin. \r\n[aic.15.2018-06-15-2.xml.zip](https://github.com/eXist-db/exist/files/2141334/aic.15.2018-06-15-2.xml.zip)\r\n\r\n### Context information\r\nSee #1975", "url": "https://github.com/eXist-db/exist/issues/1976", "user": "xatapult", "labels": ["bug"], "created": "2018-06-27 13:09:11", "closed": "2018-07-05 11:42:28", "commits": {"1a4da07cbba4ed8a84695a8f760a0721680cdf3e": {"commitGHEventType": "closed", "commitUser": "ljo"}}, "ttf": 7.000277777777778, "commitsDetails": [{"commitHash": "1a4da07cbba4ed8a84695a8f760a0721680cdf3e", "commitGHEventType": "closed", "commitUser": "ljo", "commitParents": ["b45381aedccdaae4e2968a45bc48a753f4bb9bf6"], "nameRev": "1a4da07cbba4ed8a84695a8f760a0721680cdf3e tags/eXist-5.1.0~362^2~2", "commitMessage": "[bugfix] Fix an issue with with namespaces when parsing external documents to memtree\nCloses https://github.com/eXist-db/exist/issues/1976\n", "commitDateTime": "2018-07-03 16:46:51", "authoredDateTime": "2018-07-03 15:52:23", "commitGitStats": [{"filePath": "src/org/exist/dom/memtree/SAXAdapter.java", "insertions": 8, "deletions": 6, "lines": 14}, {"filePath": "test/src/org/exist/xquery/functions/fn/ExtDocTest.java", "insertions": 122, "deletions": 0, "lines": 122}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SAXAdapter.java", "spoonMethods": [{"spoonMethodName": "org.exist.dom.memtree.SAXAdapter.startElement(java.lang.String,java.lang.String,java.lang.String,org.xml.sax.Attributes)", "TOT": 8, "UPD": 0, "INS": 5, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "ExtDocTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.functions.fn.ExtDocTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["1a4da07cbba4ed8a84695a8f760a0721680cdf3e"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 8, "deletions": 6, "lines": 14, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 8, "UPD": 0, "INS": 5, "MOV": 2, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/dom/memtree"], "changesInPackagesSPOON": ["org.exist.dom.memtree.SAXAdapter.startElement(java.lang.String,java.lang.String,java.lang.String,org.xml.sax.Attributes)"]}, {"title": "Large XQuery range can crash eXist-db", "body": "The following very simple query from the XQTS 3.1 will result in a `java.lang.OutOfMemoryError`.\r\n\r\n```xquery\r\ncount(subsequence(1 to 3000000000, -2147483649))\r\n```\r\n\r\nIt should also be considered as a security issue. This simple query could be sent to the REST end-point of any eXist-db server (which exposes the service), and it will cause the JVM to shutdown.\r\n\r\nThe XQTS states that we can either return the value `3000000000`, or any error code. So we can decide what we want to do here.\r\n", "url": "https://github.com/eXist-db/exist/issues/1971", "user": "adamretter", "labels": ["bug", "high prio", "security"], "created": "2018-06-25 17:42:57", "closed": "2018-09-03 18:19:18", "commits": {}, "ttf": 70.00027777777778, "commitsDetails": []}, {"title": "fn:collection returns binary resources as document-node", "body": "### What is the problem\r\n\r\nThe `fn:collection` function returns binary resources as `document-node`.\r\n\r\n### What did you expect\r\n\r\nI expected that `fn:collection` would either (1) exclude binary resources from its results (as the XQuery 1.0-3.0 specs suggest) or (2) return them with the correct datatype of `xs:base64Binary` (as the XQuery 3.1 spec suggests). \r\n\r\nFor context, see https://www.w3.org/TR/xpath-functions/#func-collection, which lists the following function signature for `fn:collection`:\r\n\r\n> `fn:collection($arg as xs:string?) as item()*`\r\n\r\nAlso, see this note:\r\n\r\n> In earlier releases, the primary use for the `fn:collection` function was to retrieve a collection of XML documents, perhaps held as lexical XML in operating system filestore, or perhaps held in an XML database. In this release the concept has been generalised to allow other resources to be retrieved: for example JSON documents might be returned as arrays or maps, non-XML text files might be returned as strings, and binary files might be returned as instances of `xs:base64Binary`...\r\n\r\nIn XQuery 3.0 and earlier, the return type for `fn:collection` was `node()*`.\r\n\r\nThus, if eXist conforms to XQuery 1.0-3.0, `fn:collection` **should not** include binary resources at all in the results. \r\n\r\nHowever, if eXist is following XQuery 3.1, `fn:collection` **could** return binary resources as `xs:base64Binary`. \r\n\r\nI think we should adopt the XQuery 3.1 behavior.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nA simple test:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\n(: pick a collection that contains only binary resources, like dashboard's module collection:)\r\nlet $collection-name := \"/db/apps/dashboard/modules\"\r\nlet $collection := collection($collection-name)\r\nlet $binary-docs := \r\n    for $resource-name in xmldb:get-child-resources($collection-name) \r\n    return\r\n        util:binary-doc($collection-name || \"/\" || $resource-name)\r\nreturn\r\n    (\r\n        every $bin in $collection satisfies $bin instance of xs:base64Binary,\r\n        every $bin in $collection satisfies $bin instance of document-node(),\r\n        every $bin in $binary-docs satisfies $bin instance of xs:base64Binary,\r\n        every $bin in $binary-docs satisfies $bin instance of document-node()\r\n    )\r\n```\r\n\r\nThe results, `false, true, true, false` shows that eXist's `fn:collection` function is returning binary resources as `document-node`, not as `xs:base64Binary`. On the other hand, using `util:binary-doc` to retrieve the same resources shows that `util:binary-doc` correctly returns these resources as `xs:base64Binary`, not as `document-node`.\r\n\r\nAn XQSuite demonstrating this:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace ct=\"http://exist-db.org/xquery/fn/collection/test\";\r\n\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare variable $ct:text := \"foo\";\r\ndeclare variable $ct:xml := <x>{$ct:text}</x>;\r\n\r\ndeclare\r\n    %test:setUp\r\nfunction ct:setup() {\r\n    let $testCol := xmldb:create-collection(\"/db\", \"test\")\r\n    return \r\n        (\r\n            xmldb:store($testCol, \"test.txt\", $ct:text),\r\n            xmldb:store($testCol, \"test.xml\", $ct:xml)\r\n        )\r\n};\r\n\r\n(: Both documents and binary resources should be returned by fn:collection :)\r\ndeclare\r\n    %test:assertEquals(2)\r\nfunction ct:count-collection-contents() {\r\n    count(collection(\"/db/test\"))\r\n};\r\n\r\n(: fn:collection should return the correct type of resources :)\r\ndeclare\r\n    %test:assertFalse\r\nfunction ct:binary-resources-are-not-document-nodes() {\r\n    every $x in collection(\"/db/test\") satisfies $x instance of document-node()\r\n};\r\n\r\n(: fn:collection should return the correct type of resources :)\r\ndeclare\r\n    %test:assertTrue\r\nfunction ct:binary-resources-are-binary() {\r\n    some $x in collection(\"/db/test\") satisfies $x instance of xs:base64Binary\r\n};\r\n\r\n(: fn:collection should return the correct type of resources :)\r\ndeclare\r\n    %test:assertTrue\r\nfunction ct:documents-are-document-nodes() {\r\n    some $x in collection(\"/db/test\") satisfies $x instance of document-node()\r\n};\r\n\r\ndeclare\r\n    %test:tearDown\r\nfunction ct:tearDown() {\r\n    xmldb:remove(\"/db/test\")\r\n};\r\n```\r\n\r\nThis test currently returns:\r\n\r\n```xml\r\n<testsuites>\r\n    <testsuite package=\"http://exist-db.org/xquery/fn/collection/test\"\r\n        timestamp=\"2018-06-23T20:49:27.073+02:00\" failures=\"2\" pending=\"0\" tests=\"4\" time=\"PT0.019S\">\r\n        <testcase name=\"binary-resources-are-binary\" class=\"ct:binary-resources-are-binary\">\r\n            <failure message=\"assertTrue failed.\" type=\"failure-error-code-1\"/>\r\n            <output>false</output>\r\n        </testcase>\r\n        <testcase name=\"binary-resources-are-not-document-nodes\"\r\n            class=\"ct:binary-resources-are-not-document-nodes\">\r\n            <failure message=\"assertFalse failed.\" type=\"failure-error-code-1\"/>\r\n            <output>true</output>\r\n        </testcase>\r\n        <testcase name=\"count-collection-contents\" class=\"ct:count-collection-contents\"/>\r\n        <testcase name=\"documents-are-document-nodes\" class=\"ct:documents-are-document-nodes\"/>\r\n    </testsuite>\r\n</testsuites>\r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 5.0.0-SNAPSHOT+201806200044 develop dc35967f5\r\n- Java version: 1.8.0_172\r\n- Operating system: macOS 10.13.5\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed: clone from GitHub\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/1964", "user": "joewiz", "labels": ["bug", "in progress", "xquery"], "created": "2018-06-23 18:53:49", "closed": "2020-04-10 19:53:24", "commits": {}, "ttf": 657.0002777777778, "commitsDetails": []}, {"title": "wrapping nodes using for-each after an arrow-operator", "body": "### What is the problem\r\n\r\nWrapping nodes in a function used in `fn:for-each` after an Arrow Operator incorrectly outputs one element per item in the source sequence.\r\n\r\n```xquery\r\nlet $xml := <root><i/><i/><i/></root>\r\nreturn\r\n    $xml/i => for-each(function ($i) { <wrap>{$i}</wrap> })\r\n```\r\n\r\nreturns\r\n\r\n```xml\r\n<wrap><i/><i/><i/></wrap>\r\n<wrap><i/><i/><i/></wrap>\r\n<wrap><i/><i/><i/></wrap>\r\n```\r\n\r\n### What did you expect\r\n\r\n```xml\r\n<wrap><i/></wrap>\r\n<wrap><i/></wrap>\r\n<wrap><i/></wrap>\r\n```\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n2 tests:\r\n- *`ao:wrap-atomic-sequence`* does work\r\n- *`ao:wrap-element-sequence`* outputs 9 instead of 3\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace ao=\"http://exist-db.org/xquery/test/arrowop\";\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare\r\n\t%private\r\nfunction ao:wrap ($item as item()) as item() { \r\n    <wrap>{$item}</wrap>\r\n};\r\n\r\ndeclare\r\n\t%private\r\nfunction ao:wrap-explicit-type-conversion ($item as item()) as item() { \r\n    <wrap>{xs:string($item)}</wrap>\r\n};\r\n\r\ndeclare\r\n\t%private \r\nfunction ao:first-element-text ($s as node()*) as text() {\r\n    $s[1]/text()\r\n};\r\n\r\ndeclare\r\n    %test:assertEquals(\"1\")\r\nfunction ao:wrap-atomic-sequence () {\r\n    (1, 2, 3) => for-each(ao:wrap#1) => ao:first-element-text()\r\n};\r\n\r\ndeclare\r\n    %test:assertEquals(\"1\")\r\nfunction ao:wrap-atomic-sequence-with-explicit-type-conversion () {\r\n    (1, 2, 3) => for-each(ao:wrap-with-explicit-type-conversion#1) => ao:first-element-text()\r\n};\r\n\r\ndeclare\r\n\t%private \r\nfunction ao:get-i-elements ($i as item()) { $i//i };\r\n\r\ndeclare\r\n    %test:assertEquals(3)\r\nfunction ao:wrap-element-sequence () {\r\n    let $xml := <root><i/><i/><i/></root>\r\n    return $xml/node()\r\n        => for-each(ao:wrap#1)\r\n        => for-each(ao:get-i-elements#1)\r\n        => count()\r\n};\r\n```\r\n\r\n### Context information\r\n\r\n- Tested on 4.1.0 and 5.0.0-RC1 (8339007319a720c97733c1c35b30d6e20ff41c9d) \r\n- java version \"1.8.0_152\"\r\n- Operating system: MacOs (64 bit)\r\n- both are clones from GitHub\r\n- the 4.1.0 is a customised version of existdb \r\n", "url": "https://github.com/eXist-db/exist/issues/1960", "user": "line-o", "labels": ["bug"], "created": "2018-06-19 10:03:59", "closed": "2019-04-03 21:02:39", "commits": {}, "ttf": 288.0002777777778, "commitsDetails": []}, {"title": "map:get for non-existent key returns null", "body": "The following query returns Java `null` which it should not. It should return an empty sequence!\r\n\r\n```xquery\r\nmap:get(map:entry(\"foo\", \"bar\"), \"baz\")\r\n```", "url": "https://github.com/eXist-db/exist/issues/1945", "user": "adamretter", "labels": ["bug"], "created": "2018-06-16 09:06:41", "closed": "2018-07-05 11:42:28", "commits": {"cf8892153ebbf9cc6a7a9d6a417bfd027728803e": {"commitGHEventType": "closed", "commitUser": "ljo"}}, "ttf": 19.00027777777778, "commitsDetails": [{"commitHash": "cf8892153ebbf9cc6a7a9d6a417bfd027728803e", "commitGHEventType": "closed", "commitUser": "ljo", "commitParents": ["9cd24d83e7148103ca28b07528a875150bd68348"], "nameRev": "cf8892153ebbf9cc6a7a9d6a417bfd027728803e tags/eXist-5.1.0~362^2~4", "commitMessage": "[bugfix] Avoid NPE when map:get returns value for non-existent key/value pair\nCloses https://github.com/eXist-db/exist/issues/1945\n", "commitDateTime": "2018-07-03 14:34:04", "authoredDateTime": "2018-07-03 14:34:04", "commitGitStats": [{"filePath": "src/org/exist/xquery/functions/map/MapFunction.java", "insertions": 6, "deletions": 1, "lines": 7}, {"filePath": "test/src/xquery/maps/maps.xql", "insertions": 7, "deletions": 1, "lines": 8}], "commitSpoonAstDiffStats": [{"spoonFilePath": "MapFunction.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.functions.map.MapFunction.get(org.exist.xquery.functions.map.Sequence[])", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["cf8892153ebbf9cc6a7a9d6a417bfd027728803e"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 13, "deletions": 2, "lines": 15, "gitFilesChange": 2}, "spoonStatsSummary": {"TOT": 4, "UPD": 0, "INS": 2, "MOV": 1, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["test/src/xquery/maps/maps.xql", "src/org/exist/xquery/functions/map"], "changesInPackagesSPOON": ["org.exist.xquery.functions.map.MapFunction.get(org.exist.xquery.functions.map.Sequence[])"]}, {"title": "bug in document-node(element(xxx)) ", "body": "# What is the problem\r\n\r\n## Describe exactly what you see (e.g. an output of an XQuery) \r\n\r\n```xquery\r\ndeclare namespace tei=\"http://www.tei-c.org/ns/1.0\";\r\ndeclare variable $play as document-node(element(tei:TEI)) := doc('/db/apps/shakespeare/data/ham.xml');\r\n$play\r\n```\r\n\r\nreturns zero results in eXist-db 4.0, although the play exists. It returns one result, as expected, in &lt;oXygen/&gt;.\r\n\r\n## What did you expect\r\n\r\nI expected it to return the play:\r\n\r\n> document-node( E ) matches any document node that contains exactly one element node, optionally accompanied by one or more comment and processing instruction nodes, if E is an ElementTest or SchemaElementTest that matches the element node (see 2.5.5.3 Element Test and 2.5.5.4 Schema Element Test).\r\n>\r\n>Example: document-node(element(book)) matches a document node containing exactly one element node that is matched by the ElementTest element(book).\r\n\r\n(<https://www.w3.org/TR/xpath-31/#id-matching-item>) \r\n\r\n## Describe how to reproduce or add a test\r\n\r\nRun the example above on an eXist-db installation with the Shakespeare app installed.\r\n\r\n## Context information\r\n- eXist-db version + Git Revision hash: eXist-db 4.0 / cc66ebc\r\n- Java version: java version \"1.8.0_45\", Java(TM) SE Runtime Environment (build 1.8.0_45-b14), Java HotSpot(TM) 64-Bit Server VM (build 25.45-b02, mixed mode)\r\n- Operating system: MacOs 10.11.6 (15G20015)\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed: JAR installer\r\n- Any custom changes: none\r\n", "url": "https://github.com/eXist-db/exist/issues/1932", "user": "djbpitt", "labels": ["bug"], "created": "2018-06-09 18:30:12", "closed": "2020-03-10 17:24:55", "commits": {}, "ttf": 639.0002777777778, "commitsDetails": []}, {"title": "NPE in org.exist.storage.CreateBinaryLoggable", "body": "### What is the problem\r\n\r\nInstalling a package via public repo fails in eXist 5.0.0-develop with an NPE in `org.exist.storage.CreateBinaryLoggable`. The problem is not evident in 4.x.\r\n\r\n### What did you expect\r\n\r\nI expected to be able to install packages from the public repo successfully and without triggering an NPE.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nThe following query triggers an NPE:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\nlet $pkgName := \"http://exist-db.org/apps/packagemanager\"\r\nlet $version := \"4.5.0\"\r\nlet $publicRepoURL := \"http://demo.exist-db.org/exist/apps/public-repo/modules/find.xql\"\r\nreturn\r\n    repo:install-and-deploy($pkgName, $version, $publicRepoURL)\r\n```\r\n\r\nThe error:\r\n\r\n```text\r\n2018-06-08 13:32:22,689 [qtp110634796-40] ERROR (XQueryServlet.java [process]:545) - null \r\njava.lang.NullPointerException: null\r\n        at org.exist.storage.CreateBinaryLoggable.<init>(CreateBinaryLoggable.java:43) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.storage.NativeBroker.lambda$storeBinaryResource$11(NativeBroker.java:2397) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.storage.NativeBroker.storeBinaryResource(NativeBroker.java:2407) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.storage.NativeBroker.storeBinaryResource(NativeBroker.java:2375) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.collections.MutableCollection.addBinaryResource(MutableCollection.java:1658) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.collections.MutableCollection.addBinaryResource(MutableCollection.java:1610) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.collections.MutableCollection.addBinaryResource(MutableCollection.java:1600) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.collections.MutableCollection.addBinaryResource(MutableCollection.java:1594) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.repo.Deployment.storeBinary(Deployment.java:825) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.repo.Deployment.storeFiles(Deployment.java:787) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.repo.Deployment.scanDirectory(Deployment.java:716) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.repo.Deployment.scanDirectory(Deployment.java:690) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.repo.Deployment.deploy(Deployment.java:440) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.repo.Deployment.installAndDeploy(Deployment.java:278) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.repo.Deployment.installAndDeploy(Deployment.java:158) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.modules.expathrepo.Deploy.installAndDeploy(Deploy.java:190) ~[exist-modules.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.modules.expathrepo.Deploy.eval(Deploy.java:165) ~[exist-modules.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.BasicFunction.eval(BasicFunction.java:74) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:41) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.XQuery.execute(XQuery.java:261) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.xquery.XQuery.execute(XQuery.java:185) ~[exist.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.http.servlets.XQueryServlet.process(XQueryServlet.java:481) [exist-optional.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.http.servlets.XQueryServlet.doPost(XQueryServlet.java:192) [exist-optional.jar:5.0.0-SNAPSHOT]\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:707) [servlet-api-3.1.jar:3.1.0]\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:790) [servlet-api-3.1.jar:3.1.0]\r\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:865) [jetty-servlet-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:535) [jetty-servlet-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:146) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:566) [jetty-security-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:257) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [jetty-servlet-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1155) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:163) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:73) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:51) [exist-optional.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:525) [exist-optional.jar:5.0.0-SNAPSHOT]\r\n        at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:344) [exist-optional.jar:5.0.0-SNAPSHOT]\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:790) [servlet-api-3.1.jar:3.1.0]\r\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:865) [jetty-servlet-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1655) [jetty-servlet-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at de.betterform.agent.web.filter.XFormsFilter.doFilter(XFormsFilter.java:171) [betterform-exist-5.1-SNAPSHOT-20160615.jar:?]\r\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1634) [jetty-servlet-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533) [jetty-servlet-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:146) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:524) [jetty-security-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:257) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [jetty-servlet-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1155) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:219) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:674) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.Server.handle(Server.java:531) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:352) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260) [jetty-server-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:281) [jetty-io-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:102) [jetty-io-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118) [jetty-io-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:333) [jetty-util-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:310) [jetty-util-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:168) [jetty-util-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:126) [jetty-util-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366) [jetty-util-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:760) [jetty-util-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:678) [jetty-util-9.4.10.v20180503.jar:9.4.10.v20180503]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_172]\r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 5.0.0+SNAPSHOT develop 5d0e120\r\n- Java version: 1.8.0_172-b11\r\n- Operating system: macOS 10.13.4\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed: cloned from GitHub\r\n- Any custom changes in e.g. conf.xml: no\r\n", "url": "https://github.com/eXist-db/exist/issues/1928", "user": "joewiz", "labels": ["bug"], "created": "2018-06-08 23:42:15", "closed": "2018-06-09 10:29:27", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "NPE on inspect:module-functions unless location is prepended with xmldb:exist://", "body": "### What is the problem\r\n\r\n`inspect:module-functions` does not work unless the location is prepended with `xmldb:exist://`.\r\n\r\n### What did you expect\r\n\r\nI expected the `inspect:module-functions` to work even if the location is not prepended with `xmldb:exist://`.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nThe following two expressions should return identical results:\r\n\r\n**Case 1**: *with* `xmldb:exist://` prefix\r\n\r\n```xquery\r\ninspect:module-functions(xs:anyURI(\"xmldb:exist:///db/apps/shared-resources/content/apputil.xql\"))\r\n```\r\n\r\n**Case 2**: *without* `xmldb:exist://`prefix\r\n\r\n```xquery\r\ninspect:module-functions(xs:anyURI(\"/db/apps/shared-resources/content/apputil.xql\"))\r\n```\r\n\r\nCase 1 returns the list of functions in the app-util module. Case 2 triggers an NPE:\r\n\r\n```text\r\n2018-06-08 16:57:54,365 [qtp1635955718-74] ERROR (XQueryServlet.java [process]:545) - null \r\njava.lang.NullPointerException: null\r\n```\r\n\r\nWork was recently done on this code to address https://github.com/eXist-db/exist/issues/1827 (closed by https://github.com/eXist-db/exist/pull/1833). \r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 4.2.0\r\n- Java version: 1.8.0_172-b11\r\n- Operating system: macOS 10.13.4\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed: cloned from GitHub\r\n- Any custom changes in e.g. conf.xml: no\r\n", "url": "https://github.com/eXist-db/exist/issues/1927", "user": "joewiz", "labels": ["bug", "regression"], "created": "2018-06-08 21:14:09", "closed": "2018-06-13 12:44:45", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "XQSuite outdated functions in code for suite.xql", "body": "*@MRodz commented on Jun 8, 2018, 6:38 AM UTC:*\r\n\r\nOn [http://exist-db.org/exist/apps/doc/xqsuite#D3.19](http://exist-db.org/exist/apps/doc/xqsuite#D3.19) the provided example seems to be outdated in the code for `suite.xql`.\r\n\r\nThe query:\r\n\r\n```xquery\r\nimport module namespace test=\"http://exist-db.org/xquery/xqsuite\" at \"resource:org/exist/xquery/lib/xqsuite/xqsuite.xql\";\r\n\r\ntest:suite( inspect:module-functions(xs:anyURI(\"math.xql\")) )\r\n````\r\n\r\nhas 0 results when tested in exist-db 4.2.0 and 4.1.0, while [Joe's approach](https://gist.github.com/joewiz/fa32be80749a69fcb8da) with `util:list-functions` instead of `inspect:module-functions` yields the expected testsuite outcome.\r\n\r\n*   exist-db version: `4.2.0`\r\n*   documentation version: current website\r\n\r\n*This issue was moved by [duncdrum](https://github.com/duncdrum) from eXist-db/documentation/issues/257.*", "url": "https://github.com/eXist-db/exist/issues/1925", "user": "move[bot]", "labels": ["bug", "regression"], "created": "2018-06-08 12:59:33", "closed": "2018-06-08 21:14:44", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Upgrade restxq with recent changes", "body": "I updated the restxq extension, with two fixes. I'd appreciate when it would be part of v4.2.1 \r\n\r\n- https://github.com/exquery/exquery/pull/35\r\n- https://github.com/exquery/exquery/pull/34 \r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1915", "user": "dizzzz", "labels": ["bug"], "created": "2018-06-07 17:13:24", "closed": "2019-01-12 14:51:12", "commits": {}, "ttf": 218.00027777777777, "commitsDetails": []}, {"title": "No charset in XMLRPC responses", "body": "I'm using Python's XMLRPC package to access eXist-db, which in turn uses the very wide-spread requests package for handling HTTP.\r\n\r\nI found out that even though I set UTF-8 as the default encoding, responses are not decoded by Python in UTF-8, but rather in the ISO-8859-1 character set. Further investigation shown that he content-type header returned from eXist is:\r\n\r\n`content-type: text/xml`\r\n\r\nThe Requests package is very strict about this. If no character set is specified, it does what the standard says, meaning it uses ISO-8859-1 .\r\n\r\nI can work around it and fix it on the client side, but still I think it would be better to change the content-type to `content-type: text/xml; charset=utf-8`\r\n\r\nThe REST API works well, returning a content type of `application/xml; charset=utf-8` .\r\n\r\nAll this is with eXist 4.10 on 64-bit Windows 10 with Java 8.", "url": "https://github.com/eXist-db/exist/issues/1899", "user": "zmbq", "labels": ["bug"], "created": "2018-06-02 21:33:50", "closed": "2018-06-03 15:50:23", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "string comparison  on non-indexed empty text node with collation specified results in exception", "body": "### What is the problem\r\n> Queries that include a filter clause involving string comparison on EMPTY text nodes which are not indexed fail with the following exception only when a collation is in effect either as a default collation, or explicitly passed to the string comparison function:\r\n\r\n```\r\njava.lang.IllegalArgumentException: Illegal argument target.  Argument can not be null or of length 0\r\n\tat com.ibm.icu.text.SearchIterator.<init>(SearchIterator.java:636)\r\n\tat com.ibm.icu.text.StringSearch.<init>(StringSearch.java:181)\r\n\tat com.ibm.icu.text.StringSearch.<init>(StringSearch.java:234)\r\n\tat org.exist.util.Collations.contains(Collations.java:338)\r\n\tat org.exist.xquery.value.StringValue.contains(StringValue.java:673)\r\n\tat org.exist.xquery.GeneralComparison.compareAtomic(GeneralComparison.java:1089)\r\n\tat org.exist.xquery.GeneralComparison.nodeSetCompare(GeneralComparison.java:648)\r\n\tat org.exist.xquery.GeneralComparison.quickNodeSetCompare(GeneralComparison.java:923)\r\n\tat org.exist.xquery.GeneralComparison.eval(GeneralComparison.java:469)\r\n\tat org.exist.xquery.modules.range.Lookup.eval(Lookup.java:317)\r\n\tat org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:41)\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:276)\r\n\tat org.exist.xquery.Predicate.selectByNodeSet(Predicate.java:450)\r\n\tat org.exist.xquery.Predicate.evalPredicate(Predicate.java:326)\r\n\tat org.exist.xquery.LocationStep.processPredicate(LocationStep.java:256)\r\n\tat org.exist.xquery.LocationStep.applyPredicate(LocationStep.java:243)\r\n\tat org.exist.xquery.LocationStep.eval(LocationStep.java:474)\r\n        ...\r\n```\r\n\r\n### What did you expect\r\n> I expected string comparison to work on unindexed empty text nodes with a collation specified\r\n\r\n### Describe how to reproduce or add a test\r\n> create a document with the following content, in a non-indexed collection\r\n`<entry>\r\n    <a>xxx</a>\r\n    <b></b>\r\n</entry>`\r\n\r\nrun these queries:\r\n\r\n```\r\ncollection(\"/db/data/testqueries\")//a[contains(.,'x',\"?lang=en-US\")]\r\ncollection(\"/db/data/testqueries\")//b[contains(.,'x',\"?lang=en-US\")]\r\n```\r\n\r\nThe second query will fail with the exception quoted above.\r\n\r\nHaving a range index defined on `<b>`, or omitting the collation argument results in no exception being thrown.\r\n\r\n### Context information\r\n- eXist-db version 4.1\r\n- Java version Java8u171\r\n- Operating system (Windows 10)\r\n- 64 bit\r\n- No custom changes\r\n", "url": "https://github.com/eXist-db/exist/issues/1898", "user": "merenyics", "labels": ["bug"], "created": "2018-06-01 16:47:20", "closed": "2019-05-03 20:35:07", "commits": {}, "ttf": 336.0002777777778, "commitsDetails": []}, {"title": "Bug in day of week with format-date functions ", "body": "### What is the problem\r\n\r\nIn the current release and the develop branch, eXist returns the wrong day of the week when using the `[F]` picture string to output the day of the week with `format-date()` or `format-dateTime()`. It consistently returns the day of the week *one day after* what it should be returning. So, instead of saying that today is Friday, it says Saturday.\r\n\r\n### What did you expect\r\n\r\nI expected eXist to return the correct day of the week.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nThe problem is evident in my tests with the eXist 4.1.0 release (919514c68) and later (including the current develop HEAD, f53dbceae), but not in the eXist 4.0.0 release (cc66ebc). When I copy https://github.com/eXist-db/exist/blob/develop/test/src/xquery/dates/format-dates.xql into my database, I get the failures shown below. A quick test anyone can run is this:\r\n\r\n```xquery\r\n\"Is today really \" || format-date(current-date(), \"[FNn]\") || \"?\"\r\n```\r\n\r\nResult of format-dates.xql on my machine (identical results with the 4.1.0 release and current develop):\r\n\r\n```xml\r\n<testsuites>\r\n    <testsuite package=\"http://exist-db.org/xquery/test/format-dates\" timestamp=\"2018-05-18T13:11:53.493-04:00\" failures=\"14\" pending=\"10\" tests=\"88\" time=\"PT0.268S\">\r\n        <testcase name=\"date-format-in-format-time\" class=\"fd:date-format-in-format-time\"/>\r\n        <testcase name=\"format-date-Z\" class=\"fd:format-date-Z\"/>\r\n        <testcase name=\"format-date-z\" class=\"fd:format-date-z\"/>\r\n        <testcase name=\"format-dateTime\" class=\"fd:format-dateTime\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">11:14 pm on Tuesday, June 26th, 2012</failure>\r\n            <output>11:14 pm on Wednesday, June 26th, 2012</output>\r\n        </testcase>\r\n        <testcase name=\"format-dateTime-Z\" class=\"fd:format-dateTime-Z\"/>\r\n        <testcase name=\"format-dateTime-Z-negative-double-digit\" class=\"fd:format-dateTime-Z-negative-double-digit\"/>\r\n        <testcase name=\"format-dateTime-Z-negative-single-digit\" class=\"fd:format-dateTime-Z-negative-single-digit\"/>\r\n        <testcase name=\"format-dateTime-Z-positive-double-digit\" class=\"fd:format-dateTime-Z-positive-double-digit\"/>\r\n        <testcase name=\"format-dateTime-Z-positive-single-digit\" class=\"fd:format-dateTime-Z-positive-single-digit\"/>\r\n        <testcase name=\"format-dateTime-Z-zero\" class=\"fd:format-dateTime-Z-zero\"/>\r\n        <testcase name=\"format-dateTime-Z0-00-negative-double-digit\" class=\"fd:format-dateTime-Z0-00-negative-double-digit\"/>\r\n        <testcase name=\"format-dateTime-Z0-00-negative-single-digit\" class=\"fd:format-dateTime-Z0-00-negative-single-digit\"/>\r\n        <testcase name=\"format-dateTime-Z0-00-positive-double-digit\" class=\"fd:format-dateTime-Z0-00-positive-double-digit\"/>\r\n        <testcase name=\"format-dateTime-Z0-00-positive-single-digit\" class=\"fd:format-dateTime-Z0-00-positive-single-digit\"/>\r\n        <testcase name=\"format-dateTime-Z0-00-zero\" class=\"fd:format-dateTime-Z0-00-zero\"/>\r\n        <testcase name=\"format-dateTime-Z0-negative-double-digit\" class=\"fd:format-dateTime-Z0-negative-double-digit\"/>\r\n        <testcase name=\"format-dateTime-Z0-negative-single-digit\" class=\"fd:format-dateTime-Z0-negative-single-digit\"/>\r\n        <testcase name=\"format-dateTime-Z0-positive-double-digit\" class=\"fd:format-dateTime-Z0-positive-double-digit\"/>\r\n        <testcase name=\"format-dateTime-Z0-positive-single-digit\" class=\"fd:format-dateTime-Z0-positive-single-digit\"/>\r\n        <testcase name=\"format-dateTime-Z0-zero\" class=\"fd:format-dateTime-Z0-zero\"/>\r\n        <testcase name=\"format-dateTime-Z00-00-negative-double-digit\" class=\"fd:format-dateTime-Z00-00-negative-double-digit\"/>\r\n        <testcase name=\"format-dateTime-Z00-00-negative-single-digit\" class=\"fd:format-dateTime-Z00-00-negative-single-digit\"/>\r\n        <testcase name=\"format-dateTime-Z00-00-positive-double-digit\" class=\"fd:format-dateTime-Z00-00-positive-double-digit\"/>\r\n        <testcase name=\"format-dateTime-Z00-00-positive-single-digit\" class=\"fd:format-dateTime-Z00-00-positive-single-digit\"/>\r\n        <testcase name=\"format-dateTime-Z00-00-zero\" class=\"fd:format-dateTime-Z00-00-zero\"/>\r\n        <testcase name=\"format-dateTime-Z00-00t-negative-double-digit\" class=\"fd:format-dateTime-Z00-00t-negative-double-digit\"/>\r\n        <testcase name=\"format-dateTime-Z00-00t-negative-single-digit\" class=\"fd:format-dateTime-Z00-00t-negative-single-digit\"/>\r\n        <testcase name=\"format-dateTime-Z00-00t-positive-double-digit\" class=\"fd:format-dateTime-Z00-00t-positive-double-digit\"/>\r\n        <testcase name=\"format-dateTime-Z00-00t-positive-single-digit\" class=\"fd:format-dateTime-Z00-00t-positive-single-digit\"/>\r\n        <testcase name=\"format-dateTime-Z00-00t-zero\" class=\"fd:format-dateTime-Z00-00t-zero\"/>\r\n        <testcase name=\"format-dateTime-Z0000-negative-double-digit\" class=\"fd:format-dateTime-Z0000-negative-double-digit\"/>\r\n        <testcase name=\"format-dateTime-Z0000-negative-single-digit\" class=\"fd:format-dateTime-Z0000-negative-single-digit\"/>\r\n        <testcase name=\"format-dateTime-Z0000-positive-double-digit\" class=\"fd:format-dateTime-Z0000-positive-double-digit\"/>\r\n        <testcase name=\"format-dateTime-Z0000-positive-single-digit\" class=\"fd:format-dateTime-Z0000-positive-single-digit\"/>\r\n        <testcase name=\"format-dateTime-Z0000-zero\" class=\"fd:format-dateTime-Z0000-zero\"/>\r\n        <testcase name=\"format-dateTime-ZN-NY-negative-double-digit\" class=\"fd:format-dateTime-ZN-NY-negative-double-digit\">\r\n            <pending>[ZN] is not yet supported</pending>\r\n        </testcase>\r\n        <testcase name=\"format-dateTime-ZN-NY-negative-single-digit\" class=\"fd:format-dateTime-ZN-NY-negative-single-digit\">\r\n            <pending>[ZN] is not yet supported</pending>\r\n        </testcase>\r\n        <testcase name=\"format-dateTime-ZN-NY-positive-double-digit\" class=\"fd:format-dateTime-ZN-NY-positive-double-digit\">\r\n            <pending>[ZN] is not yet supported</pending>\r\n        </testcase>\r\n        <testcase name=\"format-dateTime-ZN-NY-positive-single-digit\" class=\"fd:format-dateTime-ZN-NY-positive-single-digit\">\r\n            <pending>[ZN] is not yet supported</pending>\r\n        </testcase>\r\n        <testcase name=\"format-dateTime-ZN-NY-zero\" class=\"fd:format-dateTime-ZN-NY-zero\">\r\n            <pending>[ZN] is not yet supported</pending>\r\n        </testcase>\r\n        <testcase name=\"format-dateTime-ZN-negative-double-digit\" class=\"fd:format-dateTime-ZN-negative-double-digit\">\r\n            <pending>[ZN] is not yet supported</pending>\r\n        </testcase>\r\n        <testcase name=\"format-dateTime-ZN-negative-single-digit\" class=\"fd:format-dateTime-ZN-negative-single-digit\">\r\n            <pending>[ZN] is not yet supported</pending>\r\n        </testcase>\r\n        <testcase name=\"format-dateTime-ZN-positive-double-digit\" class=\"fd:format-dateTime-ZN-positive-double-digit\">\r\n            <pending>[ZN] is not yet supported</pending>\r\n        </testcase>\r\n        <testcase name=\"format-dateTime-ZN-positive-single-digit\" class=\"fd:format-dateTime-ZN-positive-single-digit\">\r\n            <pending>[ZN] is not yet supported</pending>\r\n        </testcase>\r\n        <testcase name=\"format-dateTime-ZN-zero\" class=\"fd:format-dateTime-ZN-zero\">\r\n            <pending>[ZN] is not yet supported</pending>\r\n        </testcase>\r\n        <testcase name=\"format-dateTime-ZZ-negative-double-digit\" class=\"fd:format-dateTime-ZZ-negative-double-digit\"/>\r\n        <testcase name=\"format-dateTime-ZZ-negative-single-digit\" class=\"fd:format-dateTime-ZZ-negative-single-digit\"/>\r\n        <testcase name=\"format-dateTime-ZZ-positive-double-digit\" class=\"fd:format-dateTime-ZZ-positive-double-digit\"/>\r\n        <testcase name=\"format-dateTime-ZZ-positive-single-digit\" class=\"fd:format-dateTime-ZZ-positive-single-digit\"/>\r\n        <testcase name=\"format-dateTime-ZZ-zero\" class=\"fd:format-dateTime-ZZ-zero\"/>\r\n        <testcase name=\"format-dateTime-no-tz-Z\" class=\"fd:format-dateTime-no-tz-Z\"/>\r\n        <testcase name=\"format-dateTime-no-tz-z\" class=\"fd:format-dateTime-no-tz-z\"/>\r\n        <testcase name=\"format-dateTime-z\" class=\"fd:format-dateTime-z\"/>\r\n        <testcase name=\"format-dateTime-z-negative-double-digit\" class=\"fd:format-dateTime-z-negative-double-digit\"/>\r\n        <testcase name=\"format-dateTime-z-negative-single-digit\" class=\"fd:format-dateTime-z-negative-single-digit\"/>\r\n        <testcase name=\"format-dateTime-z-positive-double-digit\" class=\"fd:format-dateTime-z-positive-double-digit\"/>\r\n        <testcase name=\"format-dateTime-z-positive-single-digit\" class=\"fd:format-dateTime-z-positive-single-digit\"/>\r\n        <testcase name=\"format-dateTime-z-zero\" class=\"fd:format-dateTime-z-zero\"/>\r\n        <testcase name=\"format-month-numeric-width\" class=\"fd:format-month-numeric-width\"/>\r\n        <testcase name=\"format-month-numeric-width\" class=\"fd:format-month-numeric-width\"/>\r\n        <testcase name=\"format-month-string-width-caps\" class=\"fd:format-month-string-width-caps\"/>\r\n        <testcase name=\"format-month-string-width-caps\" class=\"fd:format-month-string-width-caps\"/>\r\n        <testcase name=\"format-month-string-width-title\" class=\"fd:format-month-string-width-title\"/>\r\n        <testcase name=\"format-month-string-width-title\" class=\"fd:format-month-string-width-title\"/>\r\n        <testcase name=\"format-names\" class=\"fd:format-names\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">Tuesday, June 26, 2012</failure>\r\n            <output>Wednesday, June 26, 2012</output>\r\n        </testcase>\r\n        <testcase name=\"format-names\" class=\"fd:format-names\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">Wednesday, October 7, 1970</failure>\r\n            <output>Thursday, October 7, 1970</output>\r\n        </testcase>\r\n        <testcase name=\"format-names-width\" class=\"fd:format-names-width\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">Tue Jun 26 2012</failure>\r\n            <output>Wed Jun 26 2012</output>\r\n        </testcase>\r\n        <testcase name=\"format-names-width\" class=\"fd:format-names-width\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">Wed Oct 7 1970</failure>\r\n            <output>Thu Oct 7 1970</output>\r\n        </testcase>\r\n        <testcase name=\"format-ordinal\" class=\"fd:format-ordinal\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">Tuesday, June 26th, 2012</failure>\r\n            <output>Wednesday, June 26th, 2012</output>\r\n        </testcase>\r\n        <testcase name=\"format-ordinal\" class=\"fd:format-ordinal\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">Friday, June 1st, 2012</failure>\r\n            <output>Saturday, June 1st, 2012</output>\r\n        </testcase>\r\n        <testcase name=\"format-ordinal\" class=\"fd:format-ordinal\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">Saturday, June 2nd, 2012</failure>\r\n            <output>Sunday, June 2nd, 2012</output>\r\n        </testcase>\r\n        <testcase name=\"format-ordinal\" class=\"fd:format-ordinal\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">Sunday, June 3rd, 2012</failure>\r\n            <output>Monday, June 3rd, 2012</output>\r\n        </testcase>\r\n        <testcase name=\"format-square-brackets\" class=\"fd:format-square-brackets\"/>\r\n        <testcase name=\"language\" class=\"fd:language\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">Mittwoch, 27. Juni 2012</failure>\r\n            <output>Donnerstag, 27. Juni 2012</output>\r\n        </testcase>\r\n        <testcase name=\"language\" class=\"fd:language\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">Mittwoch, 7. Oktober 1970</failure>\r\n            <output>Donnerstag, 7. Oktober 1970</output>\r\n        </testcase>\r\n        <testcase name=\"language-fr\" class=\"fd:language-fr\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">jeudi, 1er juin 2012</failure>\r\n            <output>samedi, 1er juin 2012</output>\r\n        </testcase>\r\n        <testcase name=\"language-fr\" class=\"fd:language-fr\"/>\r\n        <testcase name=\"language-ru\" class=\"fd:language-ru\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">\u0421\u0440\u0435\u0434\u0430, 27 \u0418\u044e\u043d\u044f 2012</failure>\r\n            <output>\u0447\u0435\u0442\u0432\u0435\u0440\u0433, 27 \u0438\u044e\u043d\u044f 2012</output>\r\n        </testcase>\r\n        <testcase name=\"language-ru\" class=\"fd:language-ru\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">\u0421\u0440\u0435\u0434\u0430, 7 \u041e\u043a\u0442\u044f\u0431\u0440\u044f 1970</failure>\r\n            <output>\u0447\u0435\u0442\u0432\u0435\u0440\u0433, 7 \u043e\u043a\u0442\u044f\u0431\u0440\u044f 1970</output>\r\n        </testcase>\r\n        <testcase name=\"simple-date\" class=\"fd:simple-date\"/>\r\n        <testcase name=\"simple-date\" class=\"fd:simple-date\"/>\r\n        <testcase name=\"simple-format\" class=\"fd:simple-format\"/>\r\n        <testcase name=\"simple-format\" class=\"fd:simple-format\"/>\r\n        <testcase name=\"simple-time\" class=\"fd:simple-time\"/>\r\n        <testcase name=\"simple-time\" class=\"fd:simple-time\"/>\r\n        <testcase name=\"time-am-pm\" class=\"fd:time-am-pm\"/>\r\n        <testcase name=\"time-am-pm\" class=\"fd:time-am-pm\"/>\r\n        <testcase name=\"time-format-in-format-date\" class=\"fd:time-format-in-format-date\"/>\r\n    </testsuite>\r\n</testsuites>\r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 4.1.0 release (919514c68) and 4.2.0-SNAPSHOT develop (f53dbceae)\r\n- Java version: 1.8.0_172\r\n- Operating system: macOS 10.13.4\r\n- 32 or 64 bit: 64 bit\r\n- Any custom changes in e.g. conf.xml: n/a", "url": "https://github.com/eXist-db/exist/issues/1878", "user": "joewiz", "labels": ["bug"], "created": "2018-05-18 17:30:02", "closed": "2018-05-28 12:26:43", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "Client unable to upload large XML files (4.1.0)", "body": "When I try to upload a large XML file (>512k) using the client, I see the following error in the Java console:\r\n```\r\nException in thread \"Thread-23\" java.lang.NullPointerException\r\n\tat org.exist.xmldb.RemoteCollection.uploadAndStore(RemoteCollection.java:606)\r\n\tat org.exist.xmldb.RemoteCollection.storeResource(RemoteCollection.java:507)\r\n\tat org.exist.xmldb.RemoteCollection.storeResource(RemoteCollection.java:476)\r\n\tat org.exist.client.InteractiveClient.store(InteractiveClient.java:1763)\r\n\tat org.exist.client.InteractiveClient.parse(InteractiveClient.java:1673)\r\n\tat org.exist.client.ClientFrame$2.run(ClientFrame.java:980)\r\n```\r\nI tried to reconstruct the code to understand what the problem is.\r\n\r\nIt appears the res.getContent() returns a String (not a File or InputStream). Consequently the InputStream instance \"is\" is never instantiated and generates a null pointer exception.\r\n\r\nThis bug also causes restore to skip large files.\r\n", "url": "https://github.com/eXist-db/exist/issues/1874", "user": "thammr", "labels": ["bug", "regression"], "created": "2018-05-14 00:45:27", "closed": "2018-06-08 05:11:53", "commits": {}, "ttf": 25.00027777777778, "commitsDetails": []}, {"title": "repeated retrieval of binary files with http:send-request() fails with TemporaryFileManager error", "body": "### What is the problem\r\nIn eXist-4.1.0, repeated retrieval of binary files with the EXPath `http:send-request()` function fails with an error that seems to indicate a problem with management of temporary binary files on Windows:\r\n\r\n    An exception occurred during query execution: exerr:ERROR \r\n    exerr:ERROR Unable to add binary value to result: \r\n    C:\\Users\\me\\AppData\\Local\\Temp\\_mmtfm_f969fcfd-6ac0-4147-b0b8-a781296aad50938403981084997840\\mmtf_15259068048824434207436387375223.tmp: \r\n    The process cannot access the file because it is being used by another process.\r\n\r\nThis happens with all possible `<binary-manager>` settings in `conf.xml`, and seems to have been introduced since eXist-4.1.0; in eXist-4.0.0 (and tested down to eXist-3.6.0), this error does not occur.\r\n\r\n### What did you expect\r\nI would expect repeated retrieval of binary files with the exPath `http:send-request()` function to succeed without errors.\r\n\r\n### Describe how to reproduce or add a test\r\nOn a standard eXist-4.1.0 installation (with all standard packages installed), run following XQuery twice:\r\n\r\n```xquery\r\ndeclare namespace http=\"http://expath.org/ns/http-client\";\r\n\r\nhttp:send-request(<http:request href=\"http://localhost:8080/exist/apps/dashboard/resources/images/app.gif\" method=\"get\"/>)\r\n````\r\n\r\nWhile it succeeds the first time, subsequent calls throw the error mentioned above. The `exist.log` file contains this stacktrace:\r\n\r\n    2018-05-10 01:13:41,912 [qtp1812315561-40] INFO  (TemporaryFileManager.java [<init>]:82) - Temporary folder is: C:\\Users\\me\\AppData\\Local\\Temp\\_mmtfm_5c9489da-d9cc-4712-99dc-0b28359195963949822623512354281 \r\n    2018-05-10 01:13:41,955 [qtp1812315561-40] ERROR (TemporaryFileManager.java [returnTemporaryFile]:107) - Unable to delete temporary file: C:\\Users\\me\\AppData\\Local\\Temp\\_mmtfm_5c9489da-d9cc-4712-99dc-0b28359195963949822623512354281\\mmtf_15259076219136792099700690257005.tmp \r\n    java.nio.file.FileSystemException: C:\\Users\\me\\AppData\\Local\\Temp\\_mmtfm_5c9489da-d9cc-4712-99dc-0b28359195963949822623512354281\\mmtf_15259076219136792099700690257005.tmp: The process cannot access the file because it is being used by another process.\r\n\r\n      at sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:86) ~[?:1.8.0_172]\r\n      at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:97) ~[?:1.8.0_172]\r\n      at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:102) ~[?:1.8.0_172]\r\n      at sun.nio.fs.WindowsFileSystemProvider.implDelete(WindowsFileSystemProvider.java:269) ~[?:1.8.0_172]\r\n      at sun.nio.fs.AbstractFileSystemProvider.deleteIfExists(AbstractFileSystemProvider.java:108) ~[?:1.8.0_172]\r\n      at java.nio.file.Files.deleteIfExists(Files.java:1165) ~[?:1.8.0_172]\r\n      at org.exist.util.io.TemporaryFileManager.returnTemporaryFile(TemporaryFileManager.java:105) ~[exist.jar:4.1.0]\r\n      at org.expath.httpclient.model.exist.EXistResult.lambda$add$0(EXistResult.java:102) ~[exist-expath-20130805.jar:4.1.0]\r\n      at org.exist.xquery.value.BinaryValueFromFile.lambda$close$0(BinaryValueFromFile.java:100) ~[exist.jar:4.1.0]\r\n      at java.util.Optional.ifPresent(Optional.java:159) ~[?:1.8.0_172]\r\n      at org.exist.xquery.value.BinaryValueFromFile.close(BinaryValueFromFile.java:100) ~[exist.jar:4.1.0]\r\n      at org.exist.xquery.XQueryContext$BinaryValueCleanupTask.cleanup(XQueryContext.java:3606) ~[exist.jar:4.1.0]\r\n      at org.exist.xquery.XQueryContext.runCleanupTasks(XQueryContext.java:3729) ~[exist.jar:4.1.0]\r\n      at org.exist.xquery.value.BinaryValueManager.runCleanupTasks(BinaryValueManager.java:14) ~[exist.jar:4.1.0]\r\n      at org.exist.http.servlets.XQueryServlet.process(XQueryServlet.java:484) ~[exist-optional.jar:4.1.0]\r\n      at org.exist.http.servlets.XQueryServlet.doPost(XQueryServlet.java:192) ~[exist-optional.jar:4.1.0]\r\n      at javax.servlet.http.HttpServlet.service(HttpServlet.java:707) ~[servlet-api-3.1.jar:3.1.0]\r\n      at javax.servlet.http.HttpServlet.service(HttpServlet.java:790) ~[servlet-api-3.1.jar:3.1.0]\r\n      at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:864) ~[jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:535) ~[jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:146) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:566) ~[jetty-security-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:257) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) ~[jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1155) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:163) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:73) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:51) ~[exist-optional.jar:4.1.0]\r\n      at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:519) ~[exist-optional.jar:4.1.0]\r\n      at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:338) ~[exist-optional.jar:4.1.0]\r\n      at javax.servlet.http.HttpServlet.service(HttpServlet.java:790) ~[servlet-api-3.1.jar:3.1.0]\r\n      at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:864) ~[jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1655) ~[jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at de.betterform.agent.web.filter.XFormsFilter.doFilter(XFormsFilter.java:171) ~[betterform-exist-5.1-SNAPSHOT-20160615.jar:?]\r\n      at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1634) ~[jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533) ~[jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:146) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:524) ~[jetty-security-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:257) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) ~[jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1155) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:219) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:666) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.Server.handle(Server.java:531) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:352) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260) ~[jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:281) ~[jetty-io-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:102) ~[jetty-io-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118) ~[jetty-io-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:319) ~[jetty-util-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:175) ~[jetty-util-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.produce(EatWhatYouKill.java:139) ~[jetty-util-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:754) [jetty-util-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:672) [jetty-util-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n      at java.lang.Thread.run(Thread.java:748) [?:1.8.0_172]\r\n\r\nFurther observations:\r\n\r\n- As mentioned above, this happens with all possible InputStream Cache classes listed in `conf.xml`. \r\n- Subsequent retrieval of non-binary files works without problem.\r\n- It seems to be a Windows-only issue: on (Ubuntu) Linux, all works fine.\r\n- Introduced since eXist-4.1.0\r\n\r\n### Context information\r\n- eXist-db version + Git Revision hash: eXist-db 4.1.0 / 919514c\r\n- Java version: Oracle JDK 1.8.0_172-b11\r\n- Operating system: Windows 7\r\n- 32 or 64 bit: 64 bit\r\n- Any custom changes: none", "url": "https://github.com/eXist-db/exist/issues/1863", "user": "rvdb", "labels": ["bug", "windows"], "created": "2018-05-09 23:24:45", "closed": "2018-06-03 15:44:50", "commits": {"d86896020c49561036308a3bd01bbe6598ca95a2": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 24.00027777777778, "commitsDetails": [{"commitHash": "d86896020c49561036308a3bd01bbe6598ca95a2", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["44c95ce6f391ae3627f6232158c798309baee7c7"], "nameRev": "d86896020c49561036308a3bd01bbe6598ca95a2 tags/eXist-4.2.0~9^2~1", "commitMessage": "[bugfix] Do not recycle temporary files.\nCloses https://github.com/eXist-db/exist/issues/1863\n", "commitDateTime": "2018-06-03 09:04:44", "authoredDateTime": "2018-06-03 09:04:44", "commitGitStats": [{"filePath": "src/org/exist/util/io/TemporaryFileManager.java", "insertions": 50, "deletions": 55, "lines": 105}], "commitSpoonAstDiffStats": [{"spoonFilePath": "TemporaryFileManager.java", "spoonMethods": [{"spoonMethodName": "org.exist.util.io.TemporaryFileManager", "TOT": 6, "UPD": 3, "INS": 2, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.util.io.TemporaryFileManager.getTemporaryFile()", "TOT": 12, "UPD": 1, "INS": 2, "MOV": 6, "DEL": 3}, {"spoonMethodName": "org.exist.util.io.TemporaryFileManager.returnTemporaryFile(java.nio.file.Path)", "TOT": 5, "UPD": 0, "INS": 1, "MOV": 3, "DEL": 1}, {"spoonMethodName": "org.exist.util.io.TemporaryFileManager.finalize()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["d86896020c49561036308a3bd01bbe6598ca95a2"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 50, "deletions": 55, "lines": 105, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 24, "UPD": 4, "INS": 5, "MOV": 9, "DEL": 6, "spoonFilesChanged": 1, "spoonMethodsChanged": 4}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/util/io"], "changesInPackagesSPOON": ["org.exist.util.io.TemporaryFileManager.finalize()", "org.exist.util.io.TemporaryFileManager.getTemporaryFile()", "org.exist.util.io.TemporaryFileManager.returnTemporaryFile(java.nio.file.Path)", "org.exist.util.io.TemporaryFileManager"]}, {"title": "IndexManager has insufficient synchronization", "body": "Not all methods in IndexManager are correctly synchronized for updating/reading state.", "url": "https://github.com/eXist-db/exist/issues/1856", "user": "adamretter", "labels": ["bug"], "created": "2018-05-05 15:54:23", "closed": "2018-05-13 08:32:43", "commits": {"95083b69394652699c7ed73c86404853d7e11915": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 7.000277777777778, "commitsDetails": [{"commitHash": "95083b69394652699c7ed73c86404853d7e11915", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["9603c5c611095cb732f1cfe07f47294d42a12b72"], "nameRev": "95083b69394652699c7ed73c86404853d7e11915 tags/eXist-4.2.0~24^2", "commitMessage": "[bugfix] Make IndexManager thread safe\nCloses https://github.com/eXist-db/exist/issues/1856\n", "commitDateTime": "2018-05-06 00:53:56", "authoredDateTime": "2018-05-06 00:52:46", "commitGitStats": [{"filePath": "src/org/exist/indexing/IndexManager.java", "insertions": 15, "deletions": 4, "lines": 19}], "commitSpoonAstDiffStats": [{"spoonFilePath": "IndexManager.java", "spoonMethods": [{"spoonMethodName": "org.exist.indexing.IndexManager", "TOT": 6, "UPD": 2, "INS": 3, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.indexing.IndexManager.configurationChanged()", "TOT": 3, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.exist.indexing.IndexManager.getConfigurationTimestamp()", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["95083b69394652699c7ed73c86404853d7e11915"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 15, "deletions": 4, "lines": 19, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 11, "UPD": 2, "INS": 5, "MOV": 3, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 3}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/indexing"], "changesInPackagesSPOON": ["org.exist.indexing.IndexManager", "org.exist.indexing.IndexManager.configurationChanged()", "org.exist.indexing.IndexManager.getConfigurationTimestamp()"]}, {"title": "Bugs in integer subtype checks and casting", "body": "### What is the problem\r\n\r\nWhen performing xs:positiveInteger and xs:negativeInteger type checks on values, the checks miss errors. \r\n\r\n### What did you expect\r\n\r\nI expected type checks to be enforced.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n**Test 1**\r\n\r\nGiven following query:\r\n\r\n```xquery \r\n-1 cast as xs:positiveInteger\r\n```\r\n\r\n- eXist returns `-1`.\r\n- Saxon returns:\r\n    > Value -1 cannot be converted to integer subtype xs:positiveInteger\r\n- BaseX returns:\r\n    > [FORG0001] Cannot convert xs:integer to xs:positiveInteger: -1.\r\n\r\n**Test 2**\r\n\r\nGiven the following query:\r\n\r\n```xquery\r\n-1 instance of xs:positiveInteger\r\n```\r\n\r\neXist correctly returns `false()` (as do Saxon and BaseX).\r\n\r\n**Test 3**\r\n\r\nGiven the following query:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\ndeclare function local:test($input as xs:positiveInteger) {\r\n    $input\r\n};\r\n\r\nlocal:test(-1)\r\n```\r\n\r\n- eXist returns `-1`. \r\n- Saxon returns:\r\n    > Required item type of first argument of local:test() is xs:positiveInteger; supplied value (-1) has item type xs:integer\r\n- BaseX returns: \r\n    > [XPTY0004] Cannot convert xs:integer to xs:positiveInteger: $input := -1. \r\n\r\n**Test 4**\r\n\r\nThe opposite of test 1 is also wrong in eXist but correct in Saxon and BaseX.\r\n\r\n```xquery\r\n1 cast as xs:negativeInteger\r\n```\r\n\r\n- eXist returns `1`. \r\n\r\n**Test 5**\r\n\r\nThe opposite of test 2 is also correct in eXist, Saxon, and BaseX.\r\n\r\n```xquery\r\n1 instance of xs:negativeInteger\r\n```\r\n\r\n- All return `false()`.\r\n\r\n**Test 6**\r\n\r\nThe opposite of test 3 is also wrong in eXist but correct in Saxon and BaseX.\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\ndeclare function local:test($input as xs:negativeInteger) {\r\n    $input\r\n};\r\n\r\nlocal:test(1)\r\n```\r\n\r\n- eXist returns `1`.\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 4.2.0-SNAPSHOT+201804241640 develop 30c5c331d\r\n- Java version: 1.8.0_172-b11\r\n- Operating system: macOS 10.13.4\r\n- 32 or 64 bit: 64 bit\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/1849", "user": "joewiz", "labels": ["bug"], "created": "2018-05-01 21:47:32", "closed": "2020-03-04 17:50:09", "commits": {}, "ttf": 672.0002777777778, "commitsDetails": []}, {"title": "AppVeyor fails to build PRs", "body": "When building `HEAD` of the `develop` branch, AppVeyor does a git clone to `C:\\projects\\exist`.\r\n\r\nHowever, it seems something has changed at AppVeyor where PRs (and probably other branches) and cloned to `C:\\project\\exist-xxxxx` where `xxxxx` is some sort if unique identifier.\r\n\r\nUnfortunately for reasons unknown to me, eXist requires you to set an `EXIST_HOME` variable, for our AppVeyor build this is set to `C:\\projects\\exist` in our `appveyor.yml`. We have two options:\r\n\r\n1. Quick fix. Modify `appveyor.xml` to use some sort of build environment variable set by AppVeyor (if available) for EXIST_HOME.\r\n2. Remove our dependency on the environment variable `EXIST_HOME`. This should be possible as this requirement is pretty unique to eXist-db, there are many other projects, databases included, which don't need such a fixed path.", "url": "https://github.com/eXist-db/exist/issues/1834", "user": "adamretter", "labels": ["bug", "high prio"], "created": "2018-04-16 09:24:34", "closed": "2018-04-16 10:59:43", "commits": {"89c98e909222a3ffa250aaeb18de3ebcf1fa7064": {"commitGHEventType": "closed", "commitUser": "wolfgangmm"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "89c98e909222a3ffa250aaeb18de3ebcf1fa7064", "commitGHEventType": "closed", "commitUser": "wolfgangmm", "commitParents": ["b66fade3cb4598b0ee7f06d62c05fd2bb623e6d3"], "nameRev": "89c98e909222a3ffa250aaeb18de3ebcf1fa7064 tags/eXist-4.1.0~4^2~1", "commitMessage": "[bugfix] Fix AppVeyor builds on branches\nCloses https://github.com/eXist-db/exist/issues/1834\n", "commitDateTime": "2018-04-16 11:04:32", "authoredDateTime": "2018-04-16 10:52:26", "commitGitStats": [{"filePath": "appveyor.yml", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["89c98e909222a3ffa250aaeb18de3ebcf1fa7064"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2, "deletions": 2, "lines": 4, "gitFilesChange": 1}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["appveyor.yml"]}, {"title": "Cannot install apps as 'admin'", "body": "### What is the problem\r\nWhen attempting to install a XAR file via the package manager, the message \"Permission Denied. You must be member of the dba group\"\r\n\r\n<img width=\"503\" alt=\"dashboard\" src=\"https://user-images.githubusercontent.com/1700062/38780440-715373f8-40d6-11e8-95fa-a1eef979eaaa.png\">\r\n\r\n### What did you expect\r\nBeing admin, install should be no problem installing a XAR\r\n\r\n### Describe how to reproduce or add a test\r\n- clean clone, build, start db\r\n- open package manager, try to install e.g. the documentation app.\r\n\r\n### Context information\r\n\r\n- eXist-db version : 4.1-snapshot // b66fade3cb4598b0ee7f06d62c05fd2bb623e6d3 \r\n- Java version (e.g. Java8u121) : java8U161\r\n- Operating system (Windows 7, Linux, MacOs) : macOS\r\n- 32 or 64 bit : 64 bit\r\n- Any custom changes in e.g. conf.xml : none\r\n\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1832", "user": "dizzzz", "labels": ["bug", "high prio", "investigate"], "created": "2018-04-15 15:57:41", "closed": "2018-04-15 17:27:38", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Incorrect permission on parent collection when installing XAR", "body": "### What is the problem\r\nA XAR file can set default username/group name as owner of the collection that is created when the XAR is extracted and installed (e.g. /db/apps/foo). The problem is that the same ownership is applied to /db/apps\r\n\r\n### What did you expect\r\nOnly /db/apps/foo should get then new ownership\r\n\r\n### Describe how to reproduce or add a test\r\n- in eXide create XAR file that introduces new username/password (maybe the Monex app can be used)\r\n- install XAR via package manager\r\n- check /db/apps ownership\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version + Git Revision hash e.g. eXist-db 3.0 /  acd0c14 : 4.1-snaphot\r\n- Java version (e.g. Java8u121) - java8u161\r\n- Operating system (Windows 7, Linux, MacOs) - macOS\r\n- 32 or 64 bit - 64 bit\r\n- Any custom changes in e.g. conf.xml - none\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1820", "user": "dizzzz", "labels": ["bug", "high prio", "investigate", "needs resolution"], "created": "2018-04-13 19:02:01", "closed": "2018-04-14 10:27:01", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "New usermanager is not functioning in 'develop'", "body": "see https://github.com/eXist-db/usermanager/issues/16 \r\n\r\nthe functX XAR must be deployed always for the usermanager. current usermanager can't work right now UNLESS it is installed via the central repo.\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1813", "user": "dizzzz", "labels": ["bug", "high prio"], "created": "2018-04-12 18:17:11", "closed": "2018-04-13 10:58:21", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "registering restxq functions fails", "body": "### What is the problem\r\n\r\nregistering restxq functions fails (at least for me)  \r\nthe old registry persists\r\n\r\n### What did you expect\r\n\r\nshouldn't happen\r\n\r\n### Describe how to reproduce or add a test\r\n\r\ndon't know how, but\r\n- showed up after rebuilding with the latest merge (develop) from Apr 5 (Apr 3 was ok, AFAIR)\r\n- it happens after storing the restxq functions module from eXide and also with exrest:register-module()\r\n\r\nhere is restxq.log:\r\n```\r\n2018-04-07 10:10:56,250 [qtp1144499207-21] INFO  (RestXqServiceRegistryLogger.java [registered]:44) - Registered RESTXQ Resource Function: /db/apps/nabu/FHIR/EpisodeOfCare/episodeofcare-routes.xqm,{http://enahar.org/exist/restxq/nabu/eocs}putEpisodeOfCareXML#4\r\n2018-04-07 10:10:56,250 [qtp1144499207-21] INFO  (RestXqServiceRegistryPersistence.java [updateRegistryOnDisk]:149) - Preparing new RESTXQ registry on disk: /tmp/_mmtfm_2f19f08e-1ae9-42a4-aa5e-5a3a62eaddb62175345958671903924/mmtf_1523088656250481289648461230759.tmp\r\n2018-04-07 10:10:56,254 [qtp1144499207-21] ERROR (RestXqServiceRegistryPersistence.java [updateRegistryOnDisk]:191) - /tmp/_mmtfm_2f19f08e-1ae9-42a4-aa5e-5a3a62eaddb62175345958671903924/mmtf_1523088656250481289648461230759.tmp -> /media/peter/TrekStor/existdb-4.0/webapp/WEB-INF/data/restxq.registry: Invalid cross-device link\r\njava.nio.file.AtomicMoveNotSupportedException: /tmp/_mmtfm_2f19f08e-1ae9-42a4-aa5e-5a3a62eaddb62175345958671903924/mmtf_1523088656250481289648461230759.tmp -> /media/peter/TrekStor/existdb-4.0/webapp/WEB-INF/data/restxq.registry: Invalid cross-device link\r\n        at sun.nio.fs.UnixCopyFile.move(UnixCopyFile.java:394) ~[?:1.8.0_161]\r\n        at sun.nio.fs.UnixFileSystemProvider.move(UnixFileSystemProvider.java:262) ~[?:1.8.0_161]\r\n        at java.nio.file.Files.move(Files.java:1395) ~[?:1.8.0_161]\r\n        at org.exist.extensions.exquery.restxq.impl.RestXqServiceRegistryPersistence.updateRegistryOnDisk(RestXqServiceRegistryPersistence.java:184) ~[exist-restxq.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.extensions.exquery.restxq.impl.RestXqServiceRegistryPersistence.registered(RestXqServiceRegistryPersistence.java:129) ~[exist-restxq.jar:4.1.0-SNAPSHOT]\r\n        at org.exquery.restxq.impl.RestXqServiceRegistryImpl.register(RestXqServiceRegistryImpl.java:69) ~[exquery-restxq-1.0-SNAPSHOT.jar:0.1.32-SNAPSHOT]\r\n        at org.exquery.restxq.impl.RestXqServiceRegistryImpl.register(RestXqServiceRegistryImpl.java:78) ~[exquery-restxq-1.0-SNAPSHOT.jar:0.1.32-SNAPSHOT]\r\n        at org.exist.extensions.exquery.restxq.impl.ExistXqueryRegistry.registerServices(ExistXqueryRegistry.java:126) ~[exist-restxq.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.extensions.exquery.restxq.impl.RestXqTrigger.after(RestXqTrigger.java:114) ~[exist-restxq.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.extensions.exquery.restxq.impl.RestXqTrigger.afterUpdateDocument(RestXqTrigger.java:61) ~[exist-restxq.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.collections.triggers.DocumentTriggers.afterUpdateDocument(DocumentTriggers.java:254) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.collections.MutableCollection.addBinaryResource(MutableCollection.java:1715) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.collections.MutableCollection.addBinaryResource(MutableCollection.java:1647) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xmldb.LocalCollection.lambda$storeBinaryResource$12(LocalCollection.java:532) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xmldb.function.LocalXmldbCollectionFunction.apply(LocalXmldbCollectionFunction.java:48) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xmldb.LocalCollection.lambda$null$22(LocalCollection.java:729) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xmldb.function.LocalXmldbCollectionFunction.apply(LocalXmldbCollectionFunction.java:48) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xmldb.AbstractLocal.lambda$with$6(AbstractLocal.java:172) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xmldb.AbstractLocal.lambda$null$4(AbstractLocal.java:118) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xmldb.function.LocalXmldbFunction.apply(LocalXmldbFunction.java:46) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xmldb.AbstractLocal.withDb(AbstractLocal.java:196) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xmldb.AbstractLocal.lambda$modify$5(AbstractLocal.java:118) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xmldb.LocalCollection.lambda$modify$23(LocalCollection.java:727) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xmldb.LocalCollection.storeBinaryResource(LocalCollection.java:527) [exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xmldb.LocalCollection.storeResource(LocalCollection.java:510) [exist.jar:4.1.0-SNAPSHOT]\r\n```\r\n\r\nexist.log: no error:\r\n```\r\n2018-04-07 10:04:12,279 [qtp1144499207-24] INFO  (Descriptor.java [<init>]:99) - Reading Descriptor from file /media/peter/TrekStor/existdb-4.0/descriptor.xml\r\n2018-04-07 10:04:18,465 [qtp1144499207-24] INFO  (MimeTable.java [load]:244) - Loading mime table from file /media/peter/TrekStor/existdb-4.0/mime-types.xml\r\n2018-04-07 10:04:18,483 [qtp1144499207-24] INFO  (TemporaryFileManager.java [<init>]:82) - Temporary folder is: /tmp/_mmtfm_2f19f08e-1ae9-42a4-aa5e-5a3a62eaddb62175345958671903924\r\n```\r\n\r\n### Context information\r\n\r\n2018-04-06 10:38:05,245 [main] INFO  (JettyStart.java [run]:137) - Running with Java 1.8.0_161 [Oracle Corporation (Java HotSpot(TM) 64-Bit Server VM) in /usr/lib/jvm/java-8-oracle/jre]\r\n2018-04-06 10:38:05,245 [main] INFO  (JettyStart.java [run]:144) - Running as user 'peter'\r\n2018-04-06 10:38:05,246 [main] INFO  (JettyStart.java [run]:145) - [eXist Home : /media/peter/TrekStor/existdb-4.0]\r\n2018-04-06 10:38:05,248 [main] INFO  (JettyStart.java [run]:146) - [eXist Version : 4.1.0-SNAPSHOT]\r\n2018-04-06 10:38:05,248 [main] INFO  (JettyStart.java [run]:147) - [eXist Build : 201804051740]\r\n2018-04-06 10:38:05,248 [main] INFO  (JettyStart.java [run]:148) - [Git commit : ec3f8e5]\r\n2018-04-06 10:38:05,249 [main] INFO  (JettyStart.java [run]:150) - [Operating System : Linux 4.4.0-119-generic amd64]\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1803", "user": "pherk", "labels": ["bug"], "created": "2018-04-07 09:06:41", "closed": "2018-04-07 19:05:44", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "XML:DB RpcClient is never closed", "body": "In the XML:DB Remote API, the XmlRpcClient which is used is never closed, which means that the sockets can also dangle.\r\n\r\nFrom the exist-open mailing list:\r\n\r\n> Hi,\r\n>\r\n> We are using in our application (Oxygen XML Editor) API like this:\r\n> org.xmldb.api.DatabaseManager.getCollection(String, String, String)\r\n> to gain access to the base collection and iterate it:\r\n> Collection baseCollection = DatabaseManager.getCollection(uri + collection, user, password);\r\n>\r\n> We also have a \"Disconnect\" action which should close the TCP/IP connection between the client and the server.\r\n> I tried to use Collection.close() on the base collection but this does not close the TCP/IP connection to the Exist server.\r\n> What other API can I use in order to close a specific TCP/IP connection to the Exist server?\r\n>\r\n> Regards,\r\n> Radu", "url": "https://github.com/eXist-db/exist/issues/1785", "user": "adamretter", "labels": ["bug", "high prio"], "created": "2018-03-27 12:52:11", "closed": "2018-04-09 19:26:18", "commits": {}, "ttf": 13.000277777777777, "commitsDetails": []}, {"title": "UnsupportedOperationException on BinaryValueFromFile#incrementSharedReferences", "body": "Since b80b97abe8372a05a0e47ab1d37d579e9ea17843, `BinaryValue` has a method `incrementSharedReferences`. It is only implemented by `BinaryValueFromInputStream` while `BinaryValueFromFile` and `BinaryValueFromBinaryString` throw an UnsupportedOperationException. This happens eg. in the following test snippet:\r\n\r\n```xquery\r\nlet $binData := file:read-binary(\"/Users/wolfgang/Source/eXist/develop/VERSION.txt\")\r\nreturn\r\n    element { \"root\" } {\r\n        \"bla\"\r\n    }\r\n```\r\n\r\nBecause `incrementSharedReferences` can obviously be called on those classes, it should not just throw an exception but rather do nothing. Commenting out the `throw` fixes the issue.", "url": "https://github.com/eXist-db/exist/issues/1768", "user": "wolfgangmm", "labels": ["bug"], "created": "2018-03-13 19:06:36", "closed": "2018-04-07 16:24:29", "commits": {}, "ttf": 24.00027777777778, "commitsDetails": []}, {"title": "update insert preceding silently fails since v3.5.0", "body": "[update_insert_preceding_bug.zip](https://github.com/eXist-db/exist/files/1777843/update_insert_preceding_bug.zip)\r\n\r\n### What is the problem\r\n\r\nThe following statement works in eXist 3.4.1 (and prior) but fails in 3.5.0 through 4.0.0:\r\n\r\n```XQuery\r\nlet $setid := update insert attribute id {$id} preceding $doc//annotation-item[@temp-id=$temp]/@status\r\n```\r\n\r\nSee below for full context and reproducer.\r\n\r\n### What did you expect\r\n\r\nThe statement should be inserting an `id` attribute before an existing `temp-id` attribute, and it does this in 3.4 and before but fails to do so in 3.5.0 and later.  When it fails, it fails silently and does not return such that statements following the update insert statement are not reached.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nThe attached zip file has two files in it:\r\n\r\n```\r\n$ unzip -l update_insert_preceding_bug.zip\r\nArchive:  update_insert_preceding_bug.zip\r\n  Length      Date    Time    Name\r\n---------  ---------- -----   ----\r\n      639  03-03-2018 11:32   A00969_annotations.xml\r\n      548  03-03-2018 11:32   testupdate.xql\r\n---------                     -------\r\n     1187                     2 files\r\n```\r\n\r\nCreate a collection called `testupdate`, load those two files into it, start the remote console in Monex, and then run `testupdate.xql` from eXide.  In 3.4.1 and earlier, the `id` attribute will be successfully inserted and the \"after update\" message will be printed to the console.\r\n\r\nIn any failing version of eXist, the update fails silently.  The document it's trying to update is not changed, and the \"after update\" message never appears on the console.\r\n\r\n### Context information\r\n\r\n```\r\n$ git describe --long\r\neXist-4.0.0-0-gcc66ebc3c\r\n```\r\n\r\n```\r\n$ java -version\r\njava version \"1.8.0_121\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_121-b13)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)\r\n```\r\n\r\n```\r\n$ sw_vers\r\nProductName:\tMac OS X\r\nProductVersion:\t10.13.3\r\nBuildVersion:\t17D102\r\n```\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1761", "user": "craigberry", "labels": ["bug"], "created": "2018-03-03 20:46:25", "closed": "2018-06-17 19:53:50", "commits": {"c5bc2fc0979deb09e9a1e425ffc71ad7d011533a": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 105.00027777777778, "commitsDetails": [{"commitHash": "c5bc2fc0979deb09e9a1e425ffc71ad7d011533a", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["52638d798dc9fe7e49a9c3c2ab3c729d510667f7"], "nameRev": "c5bc2fc0979deb09e9a1e425ffc71ad7d011533a tags/eXist-5.1.0~374^2", "commitMessage": "[bugfix] Fix an NPE where an in-memory document was used with XQuery Update.\nCloses https://github.com/eXist-db/exist/issues/1761\n", "commitDateTime": "2018-06-17 17:12:23", "authoredDateTime": "2018-06-17 13:13:07", "commitGitStats": [{"filePath": "src/org/exist/xquery/update/Modification.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "test/src/org/exist/xquery/update/UpdateInsertTest.java", "insertions": 19, "deletions": 0, "lines": 19}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Modification.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.update.Modification.deepCopy(org.exist.xquery.value.Sequence)", "TOT": 2, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 1}]}, {"spoonFilePath": "UpdateInsertTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.update.UpdateInsertTest.insertInMemoryDocument()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["c5bc2fc0979deb09e9a1e425ffc71ad7d011533a"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2, "deletions": 1, "lines": 3, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 2, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/xquery/update"], "changesInPackagesSPOON": ["org.exist.xquery.update.Modification.deepCopy(org.exist.xquery.value.Sequence)"]}, {"title": "NoClassDefFoundError: Could not initialize class org.apache.lucene.analysis.icu.ICUFoldingFilter", "body": "### What is the problem\r\n\r\nIn eXist v3.6.1, saving a document to a collection with a full text index configured with `<lucene diacritics=\"no\">` works without error. In eXist v4.0.0 (and v4.1.0-SNAPSHOT) this action returns a sequence of errors, including `java.lang.ExceptionInInitializerError` and `java.lang.NoClassDefFoundError`. A test demonstrating this is below.\r\n\r\nThis issue was whittled down from the problem reported to me and @adamretter by @wsalesky, in which running [analyzers.xql](https://github.com/eXist-db/exist/blob/develop/extensions/indexes/lucene/test/src/xquery/lucene/analyzers.xql) in eXist v4.0.0 via eXide > Run as test results in a test failure. A test demonstrating this is below too.\r\n\r\n### What did you expect\r\n\r\nI expected to be able to configure diacritic-insensitive Lucene full text indexes in eXist v4.0.0.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nRun the following XQuery in eXide and monitor exist.log. (Consider first running without `diacritics=\"no\"`; the query runs without error. Then restore `diacritics=\"no\"` to observe the error.)\r\nThe query will produce a sequence of errors, including `java.lang.ExceptionInInitializerError` and `java.lang.NoClassDefFoundError`.\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nlet $xconf :=\r\n    <collection xmlns=\"http://exist-db.org/collection-config/1.0\">\r\n        <index>\r\n            <lucene diacritics=\"no\">\r\n            <!--  <lucene>  -->\r\n                <text qname=\"p\"/>\r\n            </lucene>\r\n        </index>\r\n    </collection>\r\nlet $test-col := xmldb:create-collection(\"/db\", \"test\")\r\nlet $conf-col := xmldb:create-collection(\"/db/system/config/db\", \"test\")\r\nreturn \r\n    (\r\n        xmldb:store($conf-col, \"collection.xconf\", $xconf),\r\n        xmldb:store($test-col, \"test.xml\",\r\n            <test>\r\n                <p>Hello</p>\r\n            </test>\r\n        ),\r\n        xmldb:remove($test-col),\r\n        xmldb:remove($conf-col)\r\n    )\r\n```\r\n\r\nWith `diacritics=\"no\"`, the query produces a sequence of errors in exist.log - see the full logs\r\n[here](https://github.com/eXist-db/exist/files/1742938/exist.log).\r\n\r\n**First run:**\r\n\r\n```text\r\n2018-02-21 00:29:30,620 [qtp1253271425-51] WARN  (TransactionManager.java [close]:186) - Transaction was not committed or aborted, auto aborting! \r\n2018-02-21 00:29:30,621 [qtp1253271425-51] ERROR (XQueryServlet.java [process]:534) - null \r\njava.lang.ExceptionInInitializerError: null\r\n\tat org.exist.indexing.lucene.analyzers.NoDiacriticsStandardAnalyzer.createComponents(NoDiacriticsStandardAnalyzer.java:133) ~[exist-index-lucene.jar:4.1.0-SNAPSHOT]\r\n...\r\nCaused by: com.ibm.icu.util.ICUUncheckedIOException: java.io.IOException: ICU data file error: Header authentication failed, please check if you have a valid ICU data file; data format 4e726d32, format version 2.0.0.0\r\n\tat com.ibm.icu.impl.Normalizer2Impl.load(Normalizer2Impl.java:483) ~[icu4j-60.2.jar:60.2]\r\n```\r\n\r\n**Second and subsequent runs:**\r\n\r\n```text\r\n2018-02-21 00:29:35,090 [qtp1253271425-54] ERROR (XQueryServlet.java [process]:534) - Could not initialize class org.apache.lucene.analysis.icu.ICUFoldingFilter \r\njava.lang.NoClassDefFoundError: Could not initialize class org.apache.lucene.analysis.icu.ICUFoldingFilter\r\n\tat org.exist.indexing.lucene.analyzers.NoDiacriticsStandardAnalyzer.createComponents(NoDiacriticsStandardAnalyzer.java:133) ~[exist-index-lucene.jar:4.1.0-SNAPSHOT]\r\n```\r\n\r\nTo reproduce @wsalesky's report with or without eXide, run the following query:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nimport module namespace test=\"http://exist-db.org/xquery/xqsuite\" at \r\n    \"resource:org/exist/xquery/lib/xqsuite/xqsuite.xql\";\r\n\r\ntest:suite(\r\n    inspect:module-functions(\r\n        xs:anyURI(\r\n            \"https://raw.githubusercontent.com/eXist-db/exist/develop/extensions/indexes/lucene/test/src/xquery/lucene/analyzers.xql\"\r\n        )\r\n    )\r\n)\r\n```\r\n\r\n**Result:**\r\n\r\n```xml\r\n<testsuites>\r\n    <testsuite package=\"http://exist-db.org/xquery/lucene/test/analyzers\"\r\n        timestamp=\"2018-02-21T00:35:32.712-05:00\" errors=\"5\">Could not initialize class\r\n        org.apache.lucene.analysis.icu.ICUFoldingFilter</testsuite>\r\n</testsuites>\r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: no problem evident in eXist-db v3.6.0 (3be6286); problem evident in v4.0.0 (cc66ebc) and v4.1.0 (23f577317)\r\n- Java version: 1.8.0_162\r\n- Operating system: macOS 10.13.3\r\n- 32 or 64 bit: 64 bit\r\n- Any custom changes in e.g. conf.xml: no\r\n", "url": "https://github.com/eXist-db/exist/issues/1744", "user": "joewiz", "labels": ["bug"], "created": "2018-02-21 05:40:47", "closed": "2018-02-28 14:28:15", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "Upload via collection browser fails with server error", "body": "I report here because it seems to me that it is an exist error and not a dashboard error\r\n\r\n### What is the problem\r\n> upload via collection browser fails with 'server error'\r\n\r\n### Describe how to reproduce or add a test\r\n> click on upload resources, try upload a xml or xqm file\r\n\r\n### Context information\r\n\r\n- eXist-db 4.1-snapshot , Dashboard 1.0.0, eXide 2.4.3\r\n- Java8\r\n- Ubuntu 16.04LTS\r\n- 64 bit\r\n- no custom changes\r\n\r\nexist.log:\r\n```\r\n2018-02-20 09:46:52,132 [qtp393549265-215] ERROR (EXistServlet.java [doPost]:477) - java.lang.UnsupportedOperationException\r\n2018-02-20 09:46:52,134 [qtp393549265-215] WARN  (HttpChannel.java [handleException]:568) - /exist/apps/dashboard/plugins/browsing/upload.xql\r\njavax.servlet.ServletException: javax.servlet.ServletException: An error occurred while processing request to /exist/apps/dashboard/plugins/browsing/upload.xql: An unknown error occurred: null\r\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146) ~[jetty-server-9.4.8.v20171121.jar:9.4.8.v20171121]\r\n\r\n... snip\r\n\r\nCaused by: java.lang.UnsupportedOperationException\r\n        at org.exist.xquery.value.BinaryValueFromFile.incrementSharedReferences(BinaryValueFromFile.java:123) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.XQueryContext.enterEnclosedExpr(XQueryContext.java:3546) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:80) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:329) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.XQuery.execute(XQuery.java:261) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.xquery.XQuery.execute(XQuery.java:185) ~[exist.jar:4.1.0-SNAPSHOT]\r\n        at org.exist.http.RESTServer.executeXQuery(RESTServer.java:1539) ~[exist-optional.jar:4.1.0-SNAPSHOT]\r\n... snip\r\n```", "url": "https://github.com/eXist-db/exist/issues/1740", "user": "pherk", "labels": ["bug"], "created": "2018-02-20 09:06:15", "closed": "2018-04-07 16:24:29", "commits": {}, "ttf": 46.000277777777775, "commitsDetails": []}, {"title": "Function call as map value (official syntax)", "body": "## What is the problem\r\nWhen trying to update some older code that uses maps, I found that exist struggles with the xpath3.1 map syntax `:` instead of `:=`. The sample query below returns the following error in exist.\r\n`xquery: err:XPST0081 No namespace defined for prefix pos:fn`\r\n\r\nThis looks like a lexer problem the old (`:=`) syntax returns the desired maps in exist. \r\n\r\n```\r\nmap {\r\n    1: 5\r\n}\r\n\r\nmap {\r\n    2: 3\r\n}\r\n```\r\n\r\n~~However, in the problematic case checking with Saxon`9.7.0.19`, I see: \r\n `Cannot add a map to an XML tree` \r\nwhich suggests I m trying to do something that I shouldn't that has nothing to do with namespaces.~~\r\n\r\n~~The old syntax won't run:\r\n`The ':=' notation is no longer accepted in map expressions: use ':' instead`~~\r\n\r\n~~So I am not sure what the correct response from eXist should be, ie if the query should return a result of if even the old syntax should be changed to raise an error.~~ \r\n\r\n### What did you expect\r\nReplacing `:=` with `:`according to [Xpath 3.1 specification](https://www.w3.org/TR/xpath-31/#id-maps-and-arrays) to not result in broken queries.\r\n\r\nthis might be of interest from the specs:\r\n>For instance, consider the expression map{a:b}. Although it matches the EBNF for MapConstructor (with a matching MapKeyExpr and b matching MapValueExpr), the \"longest possible match\" rule requires that a:b **be parsed as a QName, which results in a syntax error. Changing the expression to map{a :b} or map{a: b} will prevent this**, resulting in the intended parse.\r\n\r\n### Describe how to reproduce or add a test\r\n```xquery\r\nfor $n at $pos in (\"hello\", \"you\")\r\nreturn\r\n    map {  $pos: fn:string-length($n) }\r\n```\r\n\r\nsee #1510 \r\n\r\n### Context information\r\n- eXist-db `3.6.1`\r\n- Java version `1.8.0_162`\r\n- Operating system (MacOs)", "url": "https://github.com/eXist-db/exist/issues/1725", "user": "duncdrum", "labels": ["bug"], "created": "2018-02-10 13:20:56", "closed": "2018-03-02 08:08:24", "commits": {}, "ttf": 19.00027777777778, "commitsDetails": []}, {"title": "Namespace serialization bug over WebDAV or XML-RPC after XQuery Update", "body": "### What is the problem\r\n\r\nAfter using XQuery Update to insert an element (a) in the empty namespace and (b) with an `xml:id` attribute into a document with a non-empty namespace, the empty namespace of the inserted element is not shown when reading the resulting document over WebDAV or XML-RPC. However, when reading the document via the REST interface, the `doc()` function, or eXide (via its load.xql module), the inserted empty namespace is preserved. \r\n\r\nThis phenomenon is only evident when (a) and (b) are in place. In other words, the problem is not evident if you insert an element in a non-empty namespace, or if you insert an element without the `xml:id` attribute. Also, the phenomenon is not evident if you store a document with the same structure directly and without the use of XQuery update.\r\n\r\n### What did you expect\r\n\r\nI expected node\u00a0identity to be preserved regardless of the interface through which the node is serialized or method with which it was stored into the database.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nRun the following query in eXide or Java admin client:\r\n\r\n```xquery\r\n\r\nxquery version \"3.1\";\r\n\r\ndeclare namespace foo=\"foo\";\r\n\r\nlet $in-memory := \r\n    <root xmlns=\"foo\">\r\n        <x/>\r\n    </root> \r\nlet $store := xmldb:store(\"/db\", \"test.xml\", $in-memory)\r\nlet $on-disk := doc(\"/db/test.xml\")\r\nlet $new-node := <x xml:id=\"aargh\"/>\r\nlet $update := update insert $new-node into $on-disk/foo:root\r\nreturn\r\n    (\r\n        $in-memory,\r\n        $on-disk\r\n    )\r\n```\r\n\r\nThe 2nd item returned is as follows:\r\n\r\n```xml\r\n<root xmlns=\"foo\">\r\n    <x/>\r\n    <x xmlns=\"\" xml:id=\"aargh\"/>\r\n</root>\r\n```\r\n\r\nThen retrieve the file via REST interface, at <http://localhost:8080/exist/rest/db/test.xml>, and the result should be identical.\r\n\r\nThen retrieve the file via XML-RPC interface (e.g., Java admin client or oXygen data source explorer) or WebDAV (e.g., Transmit or oXygen WebDAV data source), and the inserted element has lost its empty namespace:\r\n\r\n```xml\r\n<root xmlns=\"foo\">\r\n    <x/>\r\n    <x xml:id=\"aargh\"/>\r\n</root>\r\n```\r\n\r\nThis phenomenon is not evident if the `@xml:id` attribute is removed from the inserted element, if the inserted element is in a non-empty namespace, or if the document is stored whole via the following query:\r\n\r\n```xquery\r\nlet $new-node := <x a=\"b\"/>\r\n```\r\n\r\n```xquery\r\nlet $new-node := <x xmlns=\"bar\"/>\r\n```\r\n\r\n```xquery\r\nxmldb:store(\r\n    '/db', \r\n    'test.xml', \r\n    <root xmlns=\"foo\">\r\n        <x/>\r\n        <x xmlns=\"\" xml:id=\"aargh\"/>\r\n    </root>\r\n)\r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 3.7.0-SNAPSHOT + 45c3aa506\r\n- Java version: 1.8.0_152\r\n- Operating system: macOS 10.13.3\r\n- 32 or 64 bit: 64 bit\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/1724", "user": "joewiz", "labels": ["bug"], "created": "2018-02-08 17:08:45", "closed": "2018-06-05 19:02:08", "commits": {}, "ttf": 117.00027777777778, "commitsDetails": []}, {"title": "Version mismatch jetty JARS monex vs v3.6.1 distribution", "body": "The version of a number of jetty JARs do not match ; I'd recommend:\r\n\r\n- to remove these JARS from the XAR into the default distribution \r\n\r\n![monex-0_9_11_xar](https://user-images.githubusercontent.com/1700062/35882331-181cecce-0b84-11e8-9566-3abdb85f33fc.jpg)\r\n\r\nvs\r\n\r\n```\r\nll tools/jetty/lib/ | grep jetty\r\n-rw-r--r--  1 wessels  staff   78584 Jan  7 13:16 jetty-annotations-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff   52049 Jan  7 13:16 jetty-deploy-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff  164892 Jan  7 13:16 jetty-http-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff  128560 Jan  7 13:16 jetty-io-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff   39901 Jan  7 13:16 jetty-jaas-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff   25557 Jan  7 13:16 jetty-jmx-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff   41333 Jan  7 13:16 jetty-jndi-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff   54676 Jan  7 13:16 jetty-plus-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff   93173 Jan  7 13:16 jetty-security-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff  585344 Jan  7 13:16 jetty-server-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff  110246 Jan  7 13:16 jetty-servlet-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff  481910 Jan  7 13:16 jetty-util-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff  128578 Jan  7 13:16 jetty-webapp-9.4.8.v20171121.jar\r\n-rw-r--r--  1 wessels  staff   52107 Jan  7 13:16 jetty-xml-9.4.8.v20171121.jar\r\n```", "url": "https://github.com/eXist-db/exist/issues/1721", "user": "dizzzz", "labels": ["bug", "high prio"], "created": "2018-02-06 20:24:57", "closed": "2018-02-14 13:55:49", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "\"Socket is closed\" error using httpclient", "body": "### What is the problem\r\n\r\nOn latest develop, when using httpclient to GET a resource which is returned as xs:base64Binary, a following util:binary-to-string will fail with a \"Socket is closed\" error.\r\n\r\n### What did you expect\r\nSample query below works fine in eXist 3.6.1 and returns a JSON string.\r\n\r\n### Describe how to reproduce or add a test\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nimport module namespace http=\"http://expath.org/ns/http-client\";\r\n\r\nlet $url := \"https://www.ssrq-sds-fds.ch/places-db-edit/views/loc-search.xq?query=sevelen\"\r\nlet $request :=\r\n    <http:request method=\"GET\" href=\"{$url}\"/>\r\nlet $response := http:send-request($request)\r\nlet $json := util:binary-to-string($response[2])\r\nreturn\r\n    $json\r\n```\r\n\r\n### Context information\r\n\r\n- 3.7.0-SNAPSHOT 8685d2d4e \r\n- java version \"1.8.0_162\"\r\n\r\nRelevant stacktrace:\r\n\r\n```\r\nCaused by: java.net.SocketException: Socket is closed\r\n        at sun.security.ssl.SSLSocketImpl.checkEOF(SSLSocketImpl.java:1542) ~[?:1.8.0_162]\r\n        at sun.security.ssl.AppInputStream.read(AppInputStream.java:95) ~[?:1.8.0_162]\r\n        at org.apache.http.impl.io.SessionInputBufferImpl.streamRead(SessionInputBufferImpl.java:137) ~[httpcore-4.4.9.jar:4.4.9]\r\n        at org.apache.http.impl.io.SessionInputBufferImpl.fillBuffer(SessionInputBufferImpl.java:153) ~[httpcore-4.4.9.jar:4.4.9]\r\n        at org.apache.http.impl.io.SessionInputBufferImpl.read(SessionInputBufferImpl.java:206) ~[httpcore-4.4.9.jar:4.4.9]\r\n        at org.apache.http.impl.io.ContentLengthInputStream.read(ContentLengthInputStream.java:176) ~[httpcore-4.4.9.jar:4.4.9]\r\n        at org.apache.http.conn.EofSensorInputStream.read(EofSensorInputStream.java:135) ~[httpclient-4.5.4.jar:4.5.4]\r\n        at org.exist.util.io.AbstractFilterInputStreamCache.read(AbstractFilterInputStreamCache.java:118) ~[exist.jar:3.7.0-SNAPSHOT]\r\n        at org.exist.util.io.CachingFilterInputStream.read(CachingFilterInputStream.java:176) ~[exist.jar:3.7.0-SNAPSHOT]\r\n        at org.exist.util.io.CachingFilterInputStream.read(CachingFilterInputStream.java:141) ~[exist.jar:3.7.0-SNAPSHOT]\r\n        at org.exist.xquery.value.BinaryValueFromInputStream.streamBinaryTo(BinaryValueFromInputStream.java:67) ~[exist.jar:3.7.0-SNAPSHOT]\r\n        at org.exist.xquery.functions.util.BinaryToString.binaryToString(BinaryToString.java:118) ~[exist.jar:3.7.0-SNAPSHOT]\r\n```", "url": "https://github.com/eXist-db/exist/issues/1709", "user": "wolfgangmm", "labels": ["bug"], "created": "2018-01-28 16:55:46", "closed": "2018-04-05 13:13:14", "commits": {}, "ttf": 66.00027777777778, "commitsDetails": []}, {"title": "Insufficient synchronisation in FileSyncThread", "body": "There seems to a technical synchronisation issue in `FileSyncThread`.\r\n\r\nI can see several ways to fix, but I am not sure what @wolfgangmm's intention was exactly with regards to how that class should be used.\r\n\r\nBasically [this call to `sync`](https://github.com/eXist-db/exist/blob/develop/src/org/exist/storage/journal/FileSyncThread.java#L12), enables a write to the `syncTriggered` variable without sufficient synchronisation.", "url": "https://github.com/eXist-db/exist/issues/1699", "user": "adamretter", "labels": ["bug", "high prio"], "created": "2018-01-22 18:21:12", "closed": "2018-10-14 15:58:18", "commits": {"6ae69e259fec4fe4b12e649cd65a175376dab2f2": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 264.0002777777778, "commitsDetails": [{"commitHash": "6ae69e259fec4fe4b12e649cd65a175376dab2f2", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["ae60ae527722bb75aa15c9804e1278cca8e58175"], "nameRev": "6ae69e259fec4fe4b12e649cd65a175376dab2f2 tags/eXist-5.1.0~308^2", "commitMessage": "[bugfix] Fixed thread naming and grouping per-database instance. Also likely fixed some subtle concurrency issues in the Admin Client and FileSyncThread\nCloses https://github.com/eXist-db/exist/issues/1699\n", "commitDateTime": "2018-10-14 13:53:21", "authoredDateTime": "2018-10-12 15:39:28", "commitGitStats": [{"filePath": "extensions/debuggee/src/org/exist/debuggee/ScriptRunner.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "extensions/debuggee/src/org/exist/debugger/DebuggerImpl.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "extensions/fluent/src/org/exist/fluent/Database.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "extensions/fluent/src/org/exist/fluent/WeakMultiValueHashMap.java", "insertions": 3, "deletions": 1, "lines": 4}, {"filePath": "extensions/modules/src/org/exist/xquery/modules/exi/EXIUtils.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "src/org/exist/Database.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "src/org/exist/backup/Backup.java", "insertions": 26, "deletions": 8, "lines": 34}, {"filePath": "src/org/exist/backup/ExportGUI.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "src/org/exist/backup/Main.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "src/org/exist/client/ClientFrame.java", "insertions": 45, "deletions": 91, "lines": 136}, {"filePath": "src/org/exist/client/DocumentView.java", "insertions": 46, "deletions": 48, "lines": 94}, {"filePath": "src/org/exist/client/InteractiveClient.java", "insertions": 15, "deletions": 0, "lines": 15}, {"filePath": "src/org/exist/client/QueryDialog.java", "insertions": 26, "deletions": 22, "lines": 48}, {"filePath": "src/org/exist/jetty/JettyStart.java", "insertions": 8, "deletions": 7, "lines": 15}, {"filePath": "src/org/exist/launcher/Launcher.java", "insertions": 5, "deletions": 2, "lines": 7}, {"filePath": "src/org/exist/management/client/JMXServlet.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "src/org/exist/management/client/JMXtoXML.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "src/org/exist/protocolhandler/protocols/xmldb/EmbeddedURLConnection.java", "insertions": 7, "deletions": 7, "lines": 14}, {"filePath": "src/org/exist/protocolhandler/protocols/xmldb/Handler.java", "insertions": 4, "deletions": 3, "lines": 7}, {"filePath": "src/org/exist/protocolhandler/protocols/xmldb/InMemoryURLConnection.java", "insertions": 6, "deletions": 5, "lines": 11}, {"filePath": "src/org/exist/protocolhandler/xmlrpc/{XmlrpcDownloadThread.java => XmlrpcDownloadRunnable.java}", "insertions": 18, "deletions": 24, "lines": 42}, {"filePath": "src/org/exist/protocolhandler/xmlrpc/XmlrpcInputStream.java", "insertions": 32, "deletions": 37, "lines": 69}, {"filePath": "src/org/exist/protocolhandler/xmlrpc/XmlrpcOutputStream.java", "insertions": 27, "deletions": 31, "lines": 58}, {"filePath": "src/org/exist/protocolhandler/xmlrpc/{XmlrpcUploadThread.java => XmlrpcUploadRunnable.java}", "insertions": 16, "deletions": 21, "lines": 37}, {"filePath": "src/org/exist/scheduler/impl/QuartzSchedulerImpl.java", "insertions": 59, "deletions": 15, "lines": 74}, {"filePath": "src/org/exist/scheduler/impl/ShutdownTask.java", "insertions": 1, "deletions": 7, "lines": 8}, {"filePath": "src/org/exist/scheduler/impl/quartz.properties", "insertions": 1, "deletions": 3, "lines": 4}, {"filePath": "src/org/exist/storage/BrokerPool.java", "insertions": 19, "deletions": 3, "lines": 22}, {"filePath": "src/org/exist/storage/BrokerPools.java", "insertions": 6, "deletions": 7, "lines": 13}, {"filePath": "src/org/exist/storage/journal/{FileSyncThread.java => FileSyncRunnable.java}", "insertions": 37, "deletions": 15, "lines": 52}, {"filePath": "src/org/exist/storage/journal/Journal.java", "insertions": 22, "deletions": 16, "lines": 38}, {"filePath": "src/org/exist/storage/lock/LockManager.java", "insertions": 2, "deletions": 3, "lines": 5}, {"filePath": "src/org/exist/storage/lock/LockTable.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "src/org/exist/util/NamedThreadFactory.java", "insertions": 47, "deletions": 11, "lines": 58}, {"filePath": "src/org/exist/util/NamedThreadGroupFactory.java", "insertions": 62, "deletions": 0, "lines": 62}, {"filePath": "src/org/exist/util/ThreadUtils.java", "insertions": 66, "deletions": 0, "lines": 66}, {"filePath": "src/org/exist/validation/internal/node/NodeInputStream.java", "insertions": 26, "deletions": 25, "lines": 51}, {"filePath": "src/org/exist/validation/internal/node/{NodeSerializerThread.java => NodeSerializerRunnable.java}", "insertions": 5, "deletions": 11, "lines": 16}, {"filePath": "src/org/exist/validation/resolver/AnyUriResolver.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "src/org/exist/validation/resolver/unstable/eXistLSResourceResolver.java", "insertions": 3, "deletions": 3, "lines": 6}, {"filePath": "src/org/exist/xquery/functions/validation/Shared.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "test/src/org/exist/deadlocks/GetReleaseBrokerDeadlocks.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "test/src/org/exist/storage/AllStorageTests.java", "insertions": 2, "deletions": 1, "lines": 3}, {"filePath": "test/src/org/exist/storage/ConcurrentBrokerPoolTest.conf.xml", "insertions": 79, "deletions": 0, "lines": 79}, {"filePath": "test/src/org/exist/storage/ConcurrentBrokerPoolTest.java", "insertions": 189, "deletions": 0, "lines": 189}, {"filePath": "test/src/org/exist/storage/lock/CollectionLocksTest.java", "insertions": 14, "deletions": 11, "lines": 25}, {"filePath": "test/src/org/exist/storage/lock/DocumentLocksTest.java", "insertions": 5, "deletions": 2, "lines": 7}, {"filePath": "test/src/org/exist/storage/lock/LockManagerTest.java", "insertions": 18, "deletions": 15, "lines": 33}, {"filePath": "test/src/org/exist/test/ExistEmbeddedServer.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "test/src/org/exist/test/TransactionTestDSL.java", "insertions": 5, "deletions": 3, "lines": 8}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyFiles"}], "filteredCommits": ["6ae69e259fec4fe4b12e649cd65a175376dab2f2"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 673, "deletions": 443, "lines": 1116, "gitFilesChange": 43}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/protocolhandler/protocols/xmldb", "src/org/exist/protocolhandler/xmlrpc", "src/org/exist/client", "src/org/exist/scheduler/impl", "src/org/exist/storage/lock", "src/org/exist/jetty", "src/org/exist/storage", "extensions/debuggee/src/org/exist/debuggee", "src/org/exist/validation/resolver/unstable", "src/org/exist/backup", "extensions/debuggee/src/org/exist/debugger", "extensions/modules/src/org/exist/xquery/modules/exi", "src/org/exist/launcher", "src/org/exist/validation/resolver", "test/src/org/exist/deadlocks", "src/org/exist/util", "src/org/exist/management/client", "src/org/exist/storage/journal", "src/org/exist/validation/internal/node", "src/org/exist/scheduler/impl/quartz.properties", "test/src/org/exist/test", "extensions/fluent/src/org/exist/fluent", "src/org/exist", "src/org/exist/xquery/functions/validation"]}, {"title": "Reindexing collection causes xpath in xsl transform to fail.", "body": "### What is the problem\r\nReindexing a collection causes XSL transformations run by the `transform:transform` function to fail.  XPath expressions and keys generated on a document included by the `xsl:doc` function behave strangely and generate different results after the reindex requested from the Java client.\r\n\r\n### What did you expect\r\nThe attached example which counts the nodes in a document illustrates the problem.  Prior to the reindex, the node count reported is `1`, after the reindex, the count is `0`.  Editing and saving the XML document restores the count to `1`.  Removing either or both of the two comments at the start of the XML document appears to eliminate the problem as well.\r\n\r\n### Describe how to reproduce or add a test\r\nUsing the Java client:\r\n1. Create a test collection, `/db/test`. \r\n2. Upload the `test.xql`, `xml.xml` and `xsl.xsl` documents attached to this collection using the Java client.  \r\n3. Open `test.xql` and choose submit.  The result should be `1`.  (`<param-count expr=\"count($xml//*)\">1</param-count>` specifically.)\r\n4. Choose the `/db/test` collection and reindex.\r\n5. Submit `test.xql` again.  The result is `0`.\r\n6. Open `xml.xml` and choose save.\r\n7. Submit `test.xql` again.  The result is `1`.  Repeating step 4 and 5 will cause the result to become `0` again.\r\n8. Remove either comment at the beginning of `xml.xml` and save the file.  \r\n9. Submit `test.xql`.  The result will be `1`.\r\n10. Reindex test again, and resubmit `test.xql`.  With the comment removed, the result will be `1` after the reindex.\r\n\r\nAlthough this test doesn't demonstrate it, I also found this behavior:  If the XML document consists of two nodes:  `<a><b/></a>`, then after reindexing, the expression `count(doc('xml.xml')//*)` returns `0` , but `count(doc('xml.xml')/a//*)` returns `1` if evaluated inside a transformation.  If these expressions are evaluated in the XQuery, they return the expected results before and after the reindex.  Only expression evaluation inside a transformation are affected.\r\n\r\n\r\n[test.zip](https://github.com/eXist-db/exist/files/1636765/test.zip)\r\n\r\n\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version: 3.6.1\r\n- Java version: Java(TM) SE Runtime Environment (build 1.8.0_151-b12)\r\n- Operating system: MacOS & Linux\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml: N/A (problem exists on customized and uncustomized instances)\r\n", "url": "https://github.com/eXist-db/exist/issues/1691", "user": "paulmer", "labels": ["bug", "investigate"], "created": "2018-01-16 20:56:18", "closed": "2018-08-16 19:28:00", "commits": {}, "ttf": 211.00027777777777, "commitsDetails": []}, {"title": "Strange behaviour with xmldb:*-functions", "body": "`xmldb:document()`, `xmldb:copy()` produce unexpected errors:\r\n\r\n1. unable to open an existing file\r\n2. not finding existing collections\r\n3. wrong user\r\n\r\nConsider the following example, run from eXide on eXist 3.6.0, the remote running eXist 3.4.1\r\n\r\n```xquery\r\n    xquery version \"3.1\";\r\n    \r\n    let $auth2 := xmldb:login('xmldb:exist:///db/apps', 'admin', '')\r\n    \r\n    let $coll := xmldb:get-child-collections('xmldb:exist://dev2.hab.de:80/xmlrpc/db/edoc/')\r\n    \r\n    let $date := xmldb:last-modified('xmldb:exist://dev2.hab.de:80/xmlrpc/db/edoc', 'test.xml')\r\n    let $size := xmldb:size('xmldb:exist://dev2.hab.de:80/xmlrpc/db/edoc/', 'test.xml')\r\n    let $doc := xmldb:document('xmldb:exist://dev2.hab.de:80/xmlrpc/db/edoc/test.xml')\r\n    let $doc2 := doc('http://dev2.hab.de/edoc/test.xml')\r\n    \r\n    let $coll2 := xmldb:get-child-collections('xmldb:exist:///db/apps/edoc')\r\n    let $copy := \r\n        try {\r\n            xmldb:copy('xmldb:exist://dev2.hab.de:80/xmlrpc/db/edoc', 'xmldb:exist:///db/apps/edoc', 'test.xml')\r\n        } catch * {\r\n            $err:code || ': ' || $err:description\r\n        }\r\n        \r\n    let $user := xmldb:get-current-user()\r\n    let $copy2 := \r\n        try {\r\n            xmldb:copy('xmldb:exist://dev2.hab.de:80/xmlrpc/db/edoc', 'xmldb:exist:///db/apps', 'test.xml')\r\n        } catch * {\r\n            $err:code || ': ' || $err:description\r\n        }\r\n    \r\n    return \r\n        <result>\r\n            <collectionCount>{count($coll)}</collectionCount>\r\n            <collection>{$coll}</collection>\r\n            <date>{$date}</date>\r\n            <size>{$size}</size>\r\n            <document>{$doc}</document>\r\n            <document2>{$doc2}</document2>\r\n            <coll2>{$coll2}</coll2>\r\n            <copy>{$copy}</copy>\r\n            <user>{$user}</user>\r\n            <copy2>{$copy2}</copy2>\r\n        </result>\r\n```\r\n\r\n### What is the problem\r\nThe result of this query:\r\n```xml\r\n    <result>\r\n        <collectionCount>16</collectionCount>\r\n        <collection>ed000086 ed000245 ed000244 ed000083 ed000082 ed000228 ed000216 ed000133 ed000084 templates modules wd resources ed000001 kf ed000240</collection>\r\n        <date>2018-01-05T09:55:58+01:00</date>\r\n        <size>4096</size>\r\n        <document/>\r\n        <document2>\r\n            <emptyTemplate/>\r\n        </document2>\r\n        <coll2>templates admin wd modules resources</coll2>\r\n        <copy>java:org.xmldb.api.base.XMLDBException: Failed to invoke method copyResource in class org.exist.xmlrpc.RpcConnection: collection /db/apps/edoc not found!. XMLDB exception caught: Failed to invoke method copyResource in class org.exist.xmlrpc.RpcConnection: collection /db/apps/edoc not found!</copy>\r\n        <user>admin</user>\r\n        <copy2>java:org.xmldb.api.base.XMLDBException: Failed to invoke method copyResource in class org.exist.xmlrpc.RpcConnection: Account 'guest' does not have write access on the destination collection '/db/apps'. XMLDB exception caught: Failed to invoke method copyResource in class org.exist.xmlrpc.RpcConnection: Account 'guest' does not have write access on the destination collection '/db/apps'.</copy2>\r\n    </result>\r\n```\r\n\r\nThe remote machine's log for the time the query was run has 2 warnings by the transaction manager that 2 transactions were auto aborted but no further errors.\r\n\r\n### What did you expect\r\n\r\n- `$doc` should contain the file as does `$doc2`\r\n- The first copy operation should be successful; as can be seen from `$coll2`, the collection exists and is accessible\r\n- The second copy operation should be successful; as can be seen from `$user`, the current user is 'admin'\r\n\r\n### Describe how to reproduce or add a test\r\nSee XQuery\r\n\r\n### Context information\r\nPlease always add the following information\r\n- *eXist:* local: eXist 3.6.0; remote: eXist 3.4.1\r\n- *Java version:* local: openjdk version \"1.8.0_151\"; remote: 1.8.0_92\r\n- *OS:* local: Ubuntu 16.04; remote: Win Server 2012 R2 6.3\r\n- both 64Bit\r\n- remote: Port 80; contextPath: '/'\r\n\r\n  ", "url": "https://github.com/eXist-db/exist/issues/1672", "user": "dariok", "labels": ["bug"], "created": "2018-01-05 10:21:29", "closed": "2018-02-14 13:58:00", "commits": {}, "ttf": 40.000277777777775, "commitsDetails": []}, {"title": "Installer & Java9 (endorsed)", "body": "The installer fails with the following when setting the admin password:\r\n\r\n```\r\nThe system cannot find the file C:\\Localdata\\Program.\r\n\"-Xms64m -Xmx768m -Djava.endorsed.dirs=\"C:\\Localdata\\eXist-db\"\\lib\\endorsed\"\r\nError: Could not create the Java Virtual Machine.\r\n-Djava.endorsed.dirs=C:\\Localdata\\eXist-db\\lib\\endorsed is not supported. Endorsed standards and standalone APIs\r\nin modular form will be supported via the concept of upgradeable modules.\r\nError: A fatal exception has occurred. Program will exit.\r\n```\r\n\r\nfurther investigation is needed; Java9 is installed \r\n\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version : 3.6.1 (jar installer)\r\n- Java version (e.g. Java8u151)\r\n- Operating system (Windows 7)\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml : none\r\n", "url": "https://github.com/eXist-db/exist/issues/1671", "user": "dizzzz", "labels": ["bug", "investigate"], "created": "2018-01-05 09:52:29", "closed": "2018-01-20 17:03:49", "commits": {"9e7c096ae34c8b87e20d2d4d55bc6f737ec4c620": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 15.000277777777777, "commitsDetails": [{"commitHash": "9e7c096ae34c8b87e20d2d4d55bc6f737ec4c620", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["4d05ea207ea6d421d8b119b040456ff43f2d3595"], "nameRev": "9e7c096ae34c8b87e20d2d4d55bc6f737ec4c620 tags/eXist-4.0.0~25^2", "commitMessage": "[bugfix] Remove further use of endorsed folder.\nCloses https://github.com/eXist-db/exist/issues/1671\n", "commitDateTime": "2018-01-19 17:22:49", "authoredDateTime": "2018-01-19 17:22:49", "commitGitStats": [{"filePath": "bin/run.sh", "insertions": 0, "deletions": 4, "lines": 4}, {"filePath": "build.bat", "insertions": 1, "deletions": 3, "lines": 4}, {"filePath": "build.sh", "insertions": 1, "deletions": 3, "lines": 4}, {"filePath": "installer/launch_client.bat", "insertions": 1, "deletions": 2, "lines": 3}, {"filePath": "installer/scripts/build.bat", "insertions": 1, "deletions": 3, "lines": 4}, {"filePath": "installer/scripts/build.sh", "insertions": 1, "deletions": 3, "lines": 4}, {"filePath": "installer/scripts/eXist-settings.sh", "insertions": 3, "deletions": 4, "lines": 7}, {"filePath": "installer/scripts/setup.bat", "insertions": 1, "deletions": 2, "lines": 3}, {"filePath": "installer/scripts/setup.sh", "insertions": 0, "deletions": 3, "lines": 3}, {"filePath": "tools/jsvc/exist-init.d.sh", "insertions": 0, "deletions": 3, "lines": 3}, {"filePath": "tools/jsvc/exist.sh", "insertions": 0, "deletions": 3, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["9e7c096ae34c8b87e20d2d4d55bc6f737ec4c620"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 9, "deletions": 33, "lines": 42, "gitFilesChange": 11}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["installer/scripts/build.sh", "installer/scripts/eXist-settings.sh", "bin/run.sh", "installer/scripts/setup.bat", "installer/scripts/build.bat", "installer/scripts/setup.sh", "tools/jsvc/exist-init.d.sh", "tools/jsvc/exist.sh", "installer/launch_client.bat", "build.sh", "build.bat"]}, {"title": "Missing XQST0034 check", "body": "```xquery\r\ndeclare function local:thing1() {\r\n    <a/>\r\n};\r\n\r\ndeclare function local:thing2() {\r\n    <thing2/>\r\n};\r\n\r\ndeclare function local:thing1() {\r\n    <b/>\r\n};\r\n\r\n\r\nlocal:thing1()\r\n```\r\n\r\nThis should result in `XQST0034`, however eXist compiles it just fine. It then **somehow** chooses which `thing1` to run :-(\r\n", "url": "https://github.com/eXist-db/exist/issues/1665", "user": "adamretter", "labels": ["bug", "xquery"], "created": "2017-12-27 17:36:54", "closed": "2020-04-11 17:55:04", "commits": {}, "ttf": 836.0002777777778, "commitsDetails": []}, {"title": "Update insert fails", "body": "### What is the problem\r\n\r\nOriginal report by Alexander Henket:\r\n\r\nI get a `NullPointerException` when I try to \u201cupdate insert\u201d the first node into an element that has attributes.\r\n\r\n```\r\norg.xmldb.api.base.XMLDBException\r\n\tat org.exist.xmldb.LocalXPathQueryService.execute(LocalXPathQueryService.java:195)\r\n\tat org.exist.xmldb.LocalXPathQueryService.lambda$execute$1(LocalXPathQueryService.java:159)\r\n\tat org.exist.xmldb.function.LocalXmldbFunction.apply(LocalXmldbFunction.java:46)\r\n\tat org.exist.xmldb.AbstractLocal.withDb(AbstractLocal.java:196)\r\n\tat org.exist.xmldb.LocalXPathQueryService.execute(LocalXPathQueryService.java:158)\r\n\tat org.exist.client.QueryDialog$QueryThread.run(QueryDialog.java:573)\r\nCaused by: java.lang.NullPointerException\r\n\tat org.exist.dom.persistent.ElementImpl.appendChildren(ElementImpl.java:587)\r\n\tat org.exist.xquery.update.Insert.eval(Insert.java:150)\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:99)\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111)\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:276)\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:261)\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:185)\r\n\tat org.exist.xmldb.LocalXPathQueryService.execute(LocalXPathQueryService.java:192)\r\n\t... 5 more\r\nCaused by: java.lang.NullPointerException\r\n\tat org.exist.dom.persistent.ElementImpl.appendChildren(ElementImpl.java:587)\r\n\tat org.exist.xquery.update.Insert.eval(Insert.java:150)\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:99)\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111)\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:276)\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:261)\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:185)\r\n\tat org.exist.xmldb.LocalXPathQueryService.execute(LocalXPathQueryService.java:192)\r\n\tat org.exist.xmldb.LocalXPathQueryService.lambda$execute$1(LocalXPathQueryService.java:159)\r\n\tat org.exist.xmldb.function.LocalXmldbFunction.apply(LocalXmldbFunction.java:46)\r\n\tat org.exist.xmldb.AbstractLocal.withDb(AbstractLocal.java:196)\r\n\tat org.exist.xmldb.LocalXPathQueryService.execute(LocalXPathQueryService.java:158)\r\n\tat org.exist.client.QueryDialog$QueryThread.run(QueryDialog.java:573)\r\n```\r\n### What did you expect\r\n\r\nfor the query below: no NPE, this XML file:\r\n\r\n```xml\r\n<root attr=\"1\">\r\n  <child/>\r\n</root>\r\n```\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nTo reproduce, run these lines of code:\r\n\r\n```xquery\r\nlet $f  := xmldb:store('/db/apps', 'ttt.xml', <root attr=\"1\"/>)\r\nlet $u  := update insert <child/> into doc($f)/root\r\n\r\nreturn doc($f)\r\n```\r\n\r\nIf you remove `attr=\u201c1\u201d` from the first node, the \"update insert\u201d statement will be successful.\r\nIf you add a `<!\u2014 comment \u2014>` under the root node, the \"update insert\u201d statement will be successful.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version : 3.6\r\n- Java version (Java8u141)\r\n- Operating system (MacOs)\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml : none\r\n", "url": "https://github.com/eXist-db/exist/issues/1663", "user": "dizzzz", "labels": ["bug"], "created": "2017-12-20 19:53:09", "closed": "2018-02-13 13:49:12", "commits": {"eaef79070455d961fa4293c7f8543117f1d4e291": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 54.000277777777775, "commitsDetails": [{"commitHash": "eaef79070455d961fa4293c7f8543117f1d4e291", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["8d74e07899cf37ac8807eb41c86dad88db165d9b"], "nameRev": "eaef79070455d961fa4293c7f8543117f1d4e291 tags/eXist-4.0.0~1^2", "commitMessage": "[bugfix] Fix DOM model for persistent ElementImpl#appendChildren. Used by XQuery Update `update insert`.\nCloses https://github.com/eXist-db/exist/issues/1663\n", "commitDateTime": "2018-02-13 12:47:58", "authoredDateTime": "2018-02-13 12:03:18", "commitGitStats": [{"filePath": "src/org/exist/dom/persistent/ElementImpl.java", "insertions": 29, "deletions": 6, "lines": 35}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ElementImpl.java", "spoonMethods": [{"spoonMethodName": "org.exist.dom.persistent.ElementImpl.getLastChild()", "TOT": 7, "UPD": 0, "INS": 1, "MOV": 4, "DEL": 2}, {"spoonMethodName": "org.exist.dom.persistent.ElementImpl.getLastChild(boolean)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.dom.persistent.ElementImpl.appendChildren(org.exist.storage.txn.Txn,org.w3c.dom.NodeList,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["eaef79070455d961fa4293c7f8543117f1d4e291"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 29, "deletions": 6, "lines": 35, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 12, "UPD": 0, "INS": 6, "MOV": 4, "DEL": 2, "spoonFilesChanged": 1, "spoonMethodsChanged": 3}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/dom/persistent"], "changesInPackagesSPOON": ["org.exist.dom.persistent.ElementImpl.appendChildren(org.exist.storage.txn.Txn,org.w3c.dom.NodeList,int)", "org.exist.dom.persistent.ElementImpl.getLastChild()", "org.exist.dom.persistent.ElementImpl.getLastChild(boolean)"]}, {"title": "ant target for javadocs breaks", "body": "### What is the problem\r\n the ant task in build.xml for generating xhtml javadocs no longer works. \r\n[Here](https://github.com/eXist-db/exist/blob/005045fda2ee0df0c3871b12d1b90a79f086ffbc/build/scripts/build-impl.xml#L425) \r\nThis means that we have broken  links on exist-db.orgs webpage. See exist-db/documentation#140\r\n\r\n### What did you expect\r\n the links not to end in `404`, and the ant task to actually generate javadoc files. \r\n\r\n### Describe how to reproduce or add a test\r\n run  `ant javadoc`\r\n\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db: 3.6.0\r\n- Java version: 1.8.0_152\r\n- Operating system: MacOs 10.13.2\r\n-  64 bit\r\n- Ant version: 1.10.1\r\n", "url": "https://github.com/eXist-db/exist/issues/1659", "user": "duncdrum", "labels": ["bug"], "created": "2017-12-13 18:46:25", "closed": "2019-05-22 12:08:23", "commits": {}, "ttf": 524.0002777777778, "commitsDetails": []}, {"title": "Align map:remove with 3.1 F&O spec to accept zero-or-more keys", "body": "### What is the problem\r\n\r\neXist's implementation of `map:remove` allows only a single key:\r\n\r\n> `map:remove($map as map, $key as xs:string)`\r\n\r\n### What did you expect\r\n\r\nThe XQuery 3.1 F&O spec says that `map:remove` can take 0 or more keys:\r\n\r\n> `map:remove($map as map(*), $keys as xs:anyAtomicType*)`\r\n\r\nSee https://www.w3.org/TR/xpath-functions-31/#func-map-remove.\r\n\r\nBesides the cardinality difference, note that keys can be of `xs:anyAtomicType`, not just `xs:string`.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nThis example is taken from the spec at the link above:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nlet $week := map{0:\"Sonntag\", 1:\"Montag\", 2:\"Dienstag\",\r\n       3:\"Mittwoch\", 4:\"Donnerstag\", 5:\"Freitag\", 6:\"Samstag\"}\r\nreturn\r\n    map:remove($week, (0, 6 to 7)) \r\n```\r\n\r\nBaseX and Saxon return the expected result: \r\n\r\n```xquery\r\nmap{1:\"Montag\",2:\"Dienstag\",3:\"Mittwoch\",4:\"Donnerstag\",5:\"Freitag\"}\r\n```\r\n\r\neXist returns the following error:\r\n\r\n> err:XPTY0004 checking function parameter 2 in call map:remove($week, untyped-value-check[xs:string, ( 0, 6 to 7 )]): XPTY0004: The actual cardinality for parameter 2 does not match the cardinality declared in the function's signature: map:remove($map as map, $key as xs:string) map. Expected cardinality: exactly one, got 3. \r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 3.7.0-SNAPSHOT+9091c3032\r\n- Java version: Oracle JDK 1.8.0_152\r\n- Operating system: macOS 10.13.1\r\n- 32 or 64 bit: 64 bit\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/1656", "user": "joewiz", "labels": ["bug"], "created": "2017-12-10 03:20:25", "closed": "2020-01-28 12:40:15", "commits": {}, "ttf": 779.0002777777778, "commitsDetails": []}, {"title": "RESTServer returns 202 when a bad XQuery is posted", "body": "If you HTTP POST an invalid XQuery to the REST Server, it will return HTTP Status Code 202 (Accepted), whilst returning a HTTP Response Body describing the query error. This is obviously not correct.\r\n\r\nIt should most likely return HTTP 400, or maybe even 422.", "url": "https://github.com/eXist-db/exist/issues/1646", "user": "adamretter", "labels": ["bug"], "created": "2017-12-04 13:43:24", "closed": "2018-01-20 17:00:23", "commits": {}, "ttf": 47.000277777777775, "commitsDetails": []}, {"title": "NPE in org.exist.xquery.functions.fn.FunId#getId()", "body": "Reported by craigberry  on exist-open\r\n\r\nI have a web app that is a variant of TEI Simple and it has a search form that works in 3.4.0 but breaks in 3.5.0 (and is still broken the same way in 3.6.0).  Thanks to the \"Copy as curl\" feature in my browser, the form submission boils down to:\r\n\r\ncurl 'http://localhost:8080/exist/apps/shc/works/search.html?query=justice&field=text&lucene-query-mode=any&tei-target=tei-text' \\\r\n-XGET \r\n\r\nThe result of that request is in the file attached here as search_test_350.html.  It consists mostly of a 2500-line Java stack dump. Changing GET to POST makes no difference as far as the error I get.  The heart of the matter seems to be somewhere around here:\r\n\r\nCaused by: javax.servlet.ServletException: An error occurred while processing request to /exist/apps/shc/works/search.html: An unknown error occurred: null\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:381)\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790)\r\n\r\nand here:\r\n\r\nCaused by: javax.servlet.ServletException: An unknown error occurred: null\r\n\tat org.exist.http.servlets.EXistServlet.doPost(EXistServlet.java:478)\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:707)\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790)\r\n\r\n\r\nThis problem has in common with GitHub issue #1612 (<https://github.com/eXist-db/exist/issues/1612>) blowing up on the same line in XQueryURLRewrite.java, but there it's an out of range exception rather than null exception as here, and I have no non-ASCII characters in my URL, which seems to be part of the problem there.  I should also note that other parts of the app, including other form submissions, seem to be fine.  A corollary of that is that I don't know how to make a smaller reproducer.\r\n\r\nSince I'm getting an exception caused by a null in some code that was explicitly changed to return null in commit a9c76a0fc040ede, I'm going to take a wild guess that the problem is somehow related to that commit:\r\n\r\n<https://github.com/eXist-db/exist/commit/a9c76a0fc040ede5a6e0d18b3452a11d918da4c7#diff-88285676e2d4cdf4bde12b4f92e821ca>\r\n\r\nThe rather cryptic commit message says, in its entirety, \"Node#getNamespaceURI and Node#getPrefix must return null unless a namespace or prefix is explicitly set at creation time.\"  Why must they?  Creation time of what, the HTTP request?  Is there something I should be looking for in my namespace declarations or form submission that would get the namespace set?\r\n\r\nIn case it matters, I'm running on macOS Sierra (10.12.6) and I've used the .dmg installers for 3.4.0, 3.5.0, and 3.6.0.  I've confirmed that downgrading to 3.4.0 fixes the problem.  And my Java version:\r\n\r\n$ java -version\r\njava version \"1.8.0_121\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_121-b13)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)\r\n\r\n[Trace.txt](https://github.com/eXist-db/exist/files/1524786/Trace.txt)\r\n\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1642", "user": "dizzzz", "labels": ["bug", "regression"], "created": "2017-12-03 13:56:30", "closed": "2017-12-09 19:20:49", "commits": {"44f41cad4c46493a02d2df21b046792c854118af": {"commitGHEventType": "referenced", "commitUser": "adamretter"}, "60784b70e699215cf60549717ab1dfedabae5bc5": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "44f41cad4c46493a02d2df21b046792c854118af", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["e38cdf04192993cdca94827cec37ead421ad13ec", "eaff7ce12af6676989630e58a80501e9a5c32beb"], "nameRev": "44f41cad4c46493a02d2df21b046792c854118af tags/eXist-4.0.0~47", "commitMessage": "Merge pull request #1644 from dizzzz/bugfix/NPE-in-org.exist.xquery.functions.fn.FunId\n\nFix for #1642 NPE in org.exist.xquery.functions.fn.FunId", "commitDateTime": "2017-12-05 10:03:52", "authoredDateTime": "2017-12-05 10:03:52", "commitGitStats": [{"filePath": "src/org/exist/xquery/functions/fn/FunId.java", "insertions": 9, "deletions": 31, "lines": 40}], "commitSpoonAstDiffStats": [{"spoonFilePath": "FunId.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.functions.fn.FunId", "TOT": 16, "UPD": 16, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.eval(org.exist.xquery.value.Sequence,org.exist.xquery.value.Item)", "TOT": 30, "UPD": 30, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.getId(org.exist.dom.persistent.NodeSet,org.exist.dom.persistent.DocumentSet,java.lang.String)", "TOT": 7, "UPD": 7, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.getId(org.exist.xquery.value.Sequence,org.exist.xquery.value.Sequence,java.lang.String)", "TOT": 5, "UPD": 4, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.getId(org.exist.xquery.functions.fn.Sequence,org.exist.xquery.functions.fn.Sequence,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "60784b70e699215cf60549717ab1dfedabae5bc5", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["a2c21206ec6933fd15899be39605d7c74f285ce6"], "nameRev": "60784b70e699215cf60549717ab1dfedabae5bc5 tags/eXist-3.6.1~11", "commitMessage": "Fix for #1642 NPE in org.exist.xquery.functions.fn.FunId\n", "commitDateTime": "2018-01-03 19:36:04", "authoredDateTime": "2017-12-03 14:58:31", "commitGitStats": [{"filePath": "src/org/exist/xquery/functions/fn/FunId.java", "insertions": 9, "deletions": 31, "lines": 40}], "commitSpoonAstDiffStats": [{"spoonFilePath": "FunId.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.functions.fn.FunId", "TOT": 16, "UPD": 16, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.eval(org.exist.xquery.value.Sequence,org.exist.xquery.value.Item)", "TOT": 30, "UPD": 30, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.getId(org.exist.dom.persistent.NodeSet,org.exist.dom.persistent.DocumentSet,java.lang.String)", "TOT": 7, "UPD": 7, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.getId(org.exist.xquery.value.Sequence,org.exist.xquery.value.Sequence,java.lang.String)", "TOT": 5, "UPD": 4, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.getId(org.exist.xquery.functions.fn.Sequence,org.exist.xquery.functions.fn.Sequence,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["60784b70e699215cf60549717ab1dfedabae5bc5"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 9, "deletions": 31, "lines": 40, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 59, "UPD": 57, "INS": 1, "MOV": 1, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 5}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/xquery/functions/fn"], "changesInPackagesSPOON": ["org.exist.xquery.functions.fn.FunId", "org.exist.xquery.functions.fn.FunId.getId(org.exist.dom.persistent.NodeSet,org.exist.dom.persistent.DocumentSet,java.lang.String)", "org.exist.xquery.functions.fn.FunId.getId(org.exist.xquery.functions.fn.Sequence,org.exist.xquery.functions.fn.Sequence,java.lang.String)", "org.exist.xquery.functions.fn.FunId.eval(org.exist.xquery.value.Sequence,org.exist.xquery.value.Item)", "org.exist.xquery.functions.fn.FunId.getId(org.exist.xquery.value.Sequence,org.exist.xquery.value.Sequence,java.lang.String)"]}, {"title": "Corrupt package repo XML file after repair action (3.6.0)", "body": "Seemingly innocent actions seems to cause the corruption of an XML file in package repo. After some research this is the minimum scenario that causes this:\r\n\r\n- Did a fresh install of eXist 3.6.0\r\n- Run the repo cleanup script from the eXist backup/restore docu page (not necessary but wanted to see what it did):\r\n\r\n`import module namespace repair=\"http://exist-db.org/xquery/repo/repair\" \r\nat \"resource:org/exist/xquery/modules/expathrepo/repair.xql\";\r\nrepair:clean-all(),\r\nrepair:repair()`\r\n\r\n- This causes a non well-formed **(!)** XML file: `webapp\\WEB-INF\\data\\expathrepo\\shared-0.4.2E:\\eXist\\webapp\\WEB-INF\\data\\expathrepo\\shared-0.4.2\\repo.xml`\r\n\r\n- Its root element now reads: \r\n`<repo:meta xmlns=\"http://exist-db.org/xquery/repo\" xmlns:repo=\"http://exist-db.org/xquery/repo\" #unknown=\"http://exist-db.org/xquery/repo\">`\r\n\r\nAnd this causes many follow up problems in using or trying to change the package repo.\r\n\r\n\r\n\r\nContext:\r\nPlease always add the following information\r\n- eXist-db version: 3.6.0 \r\n- Java version: 1.8.0_141\r\n- Operating system: Windows server 2012 standard 64 bits\r\n", "url": "https://github.com/eXist-db/exist/issues/1641", "user": "xatapult", "labels": ["bug", "duplicate"], "created": "2017-11-29 13:06:36", "closed": "2017-11-29 13:37:59", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "general comparison to empty sequence sometimes raises an error", "body": "### What is the problem\r\n\r\neXist sometimes raises a type error when making a general comparison to an empty-sequence on the right-hand side (eg. `current-date() = ()`). It never raises this error if the empty sequence appears on the left-hand side (eg. `() = current-date()`).\r\n\r\nThis appears to be due to inconsistent practice in the implementation of the `compareTo(Collator, Comparison, AtomicValue)` method in each of the `org.exist.xquery.value` classes. Some explicitly check for `.isEmpty()` at the start, but `BooleanValue`, `AbstractDateTimeValue`, and `BinaryValue` do not (and there may be others that I missed).\r\n\r\n### What did you expect\r\n\r\nA general comparison to the empty sequence should always return `false()`, since no \"[pair of atomic values](https://www.w3.org/TR/xquery-31/#id-general-comparisons)\" exists.\r\n\r\n### Context information\r\n- eXist-db 3.6.0 (build 201711271542) / ceaab01\r\n- Java 1.8.0_152-b16\r\n- MacOS 10.13.1\r\n- 64 bit\r\n", "url": "https://github.com/eXist-db/exist/issues/1639", "user": "telic", "labels": ["bug", "enhancement"], "created": "2017-11-28 23:16:21", "closed": "2017-12-09 19:22:06", "commits": {"02c19c66180966e168063800867beac5dc145e88": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 10.000277777777777, "commitsDetails": [{"commitHash": "02c19c66180966e168063800867beac5dc145e88", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["9611363d420f0b80ce9cec96f0598e1c92f1f09b"], "nameRev": "02c19c66180966e168063800867beac5dc145e88 tags/eXist-3.6.1~9", "commitMessage": "Fix for #1639 : if right value is () then always return false()\n", "commitDateTime": "2018-01-03 19:36:56", "authoredDateTime": "2017-12-04 19:21:39", "commitGitStats": [{"filePath": "src/org/exist/xquery/GeneralComparison.java", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "GeneralComparison.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.GeneralComparison.compareAtomic(com.ibm.icu.text.Collator,org.exist.xquery.value.AtomicValue,org.exist.xquery.value.AtomicValue)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["02c19c66180966e168063800867beac5dc145e88"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2, "deletions": 1, "lines": 3, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/xquery"], "changesInPackagesSPOON": ["org.exist.xquery.GeneralComparison.compareAtomic(com.ibm.icu.text.Collator,org.exist.xquery.value.AtomicValue,org.exist.xquery.value.AtomicValue)"]}, {"title": "Arrow operator \"function not found\" (XPST0017) error ", "body": "### What is the problem\r\n\r\nWhen (1) an arrow operator is used in function A and (2) the function that the arrow operator calls, function B, is declared after function A in the query prolog, eXist returns a \"function not found\" error.\r\n\r\n### What did you expect\r\n\r\nI expected eXist to locate function B when calling function B via the arrow operator. \r\n\r\nMy tests below show that Saxon and BaseX do not have this problem.\r\n\r\nMy tests also show that eXist has no problem locating function B when we either (1) call function B without the arrow operator or (2) move function B above function A in the prolog.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nGiven the following query, eXist raises a \"Function not found: local:B\" error:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\ndeclare function local:A($x) { \r\n    let $y := $x || $x \r\n    return \r\n        $y => local:B()\r\n};\r\n\r\ndeclare function local:B($x) {\r\n    string-length($x)\r\n};\r\n\r\nlocal:A(\"hello\")\r\n```\r\n\r\nThe full error:\r\n\r\n> Cannot compile xquery: err:XPST0017 Function not found: local:B [at line 6, column 12, source: xquery version \"3.1\"; declare function local:A($x) { let $y := $x || $x return $y => local:B() }; declare function local:B($x) { string-length($x) }; local:A(\"hello\")]\r\n\r\nThe query runs without error, as expected, in Saxon and BaseX.\r\n\r\nThe following variation, which defines `local:B` first, completes without error in eXist:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\ndeclare function local:B($x) {\r\n    string-length($x)\r\n};\r\n\r\ndeclare function local:A($x) { \r\n    let $y := $x || $x \r\n    return \r\n        $y => local:B()\r\n};\r\n\r\nlocal:A(\"hello\")\r\n```\r\n\r\nSimilarly, calling local:B without the arrow operator completes without error in eXist:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\ndeclare function local:A($x) { \r\n    let $y := $x || $x \r\n    return \r\n        local:B($y)\r\n};\r\n\r\ndeclare function local:B($x) {\r\n    string-length($x)\r\n};\r\n\r\nlocal:A(\"hello\")\r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist-db 3.6.0 /  145d6526e\r\n- Java version: 1.8.0_144\r\n- Operating system: macOS 10.13.1\r\n- 32 or 64 bit: 64 bit\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/1622", "user": "joewiz", "labels": ["bug"], "created": "2017-11-20 18:29:20", "closed": "2017-11-23 00:34:33", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Backup-restore failure : parsing errors", "body": "### What is the problem\r\nDuring a simple backup - restore (no database cleanup in between), some files haven't been restored due to errors reported by the XML parser:\r\n\r\n```\r\nException: ------------------------------------\r\nException: ------------------------------------\r\nProblems occured found during restore:\r\n\r\nWARN: Failed to restore resource 'repo.xml'\r\nfrom file '/path/eXist-backup.zip#db/apps/shared-resources/repo.xml'.\r\nReason: Failed to invoke method parse in class org.exist.xmlrpc.RpcConnection: org.xml.sax.SAXParseException: Element type \"repo:meta\" must be followed by either attribute specifications, \">\" or \"/>\".\r\n\r\nWARN: Failed to restore resource 'build.xml'\r\nfrom file '/path/eXist-backup.zip#db/apps/webstart/build.xml'.\r\nReason: Failed to invoke method parse in class org.exist.xmlrpc.RpcConnection: org.xml.sax.SAXParseException: The string \"--\" is not permitted within comments.\r\n\r\nWARN: Failed to restore resource 'repo.xml'\r\nfrom file '/path/eXist-backup.zip#db/apps/monex/repo.xml'.\r\nReason: Failed to invoke method parse in class org.exist.xmlrpc.RpcConnection: org.xml.sax.SAXParseException: Element type \"permissions\" must be followed by either attribute specifications, \">\" or \"/>\".\r\n\r\nWARN: Failed to restore resource 'repo.xml'\r\nfrom file '/path/eXist-backup.zip#db/apps/eXide/repo.xml'.\r\nReason: Failed to invoke method parse in class org.exist.xmlrpc.RpcConnection: org.xml.sax.SAXParseException: Element type \"permissions\" must be followed by either attribute specifications, \">\" or \"/>\".\r\n```\r\n\r\nThere is need a `--` in comments (issue 2), and all of the `repo.xml` files contain a root element with an attribute which name starts with an `#` character:\r\n\r\n```xml\r\n<repo:meta xmlns=\"http://exist-db.org/xquery/repo\" \r\n    xmlns:repo=\"http://exist-db.org/xquery/repo\" \r\n   #unknown=\"http://exist-db.org/xquery/repo\">\r\n    <repo:description>Shared resources used by other apps</repo:description>\r\n    <repo:author>Wolfgang Meier</repo:author>\r\n    <repo:website>https://github.com/eXist-db/shared-resources</repo:website>\r\n    <repo:status>alpha</repo:status>\r\n    <repo:license>GNU-LGPL</repo:license>\r\n    <repo:copyright>true</repo:copyright>\r\n    <repo:type>library</repo:type>\r\n    <repo:target>shared-resources</repo:target>\r\n    <repo:prepare/>\r\n    <repo:finish/>\r\n    <repo:permissions user=\"admin\" group=\"dba\" mode=\"0775\"/>\r\n```\r\n\r\n\r\n### What did you expect\r\nA restore should work flawlessly \r\n\r\n### Describe how to reproduce or add a test\r\nIn the admin client, make a backup of a database (no special apps needed) and directly do restore from the backup.zip file.\r\n\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version : latest dev\r\n- Java version (Java8u151)\r\n- Operating system (MacOs)\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml\r\n", "url": "https://github.com/eXist-db/exist/issues/1620", "user": "dizzzz", "labels": ["bug", "duplicate"], "created": "2017-11-19 21:34:47", "closed": "2017-12-02 10:29:38", "commits": {}, "ttf": 12.000277777777777, "commitsDetails": []}, {"title": "expath http client issue ", "body": "### What is the problem\r\nNPE in 3.6.0-SNAPSHOT for EXPath HTTP request which works perfectly fine on 3.4.x\r\n\r\n### What did you expect\r\nExpected was a response sequnce with header information in response[1] and the response itself in response[2]\r\n\r\n### Describe how to reproduce or add a test\r\n```\r\nimport module namespace http=\"http://expath.org/ns/http-client\";\r\n\r\nlet $user := \"user\"\r\nlet $pass:= \"pass\r\nlet $url := \"https://some-https-url-with-basic-auth\"\r\n\r\nlet $request := <http:request method=\"GET\" href=\"{$url}\" timeout=\"120\"  username=\"{$user}\" password=\"{$pass}\"\r\n                        auth-method=\"basic\" send-authorization=\"true\" override-media-type=\"application/octet-stream\">\r\n            <http:header name=\"accept\" value=\"application/xml\"/>\r\n        </http:request>\r\n\r\nreturn\r\n    <result>{ http:send-request($request) }</result>\r\n```\r\n\r\nFrom the log files: \r\n\r\n```\r\n2017-11-16 16:27:24,267 [qtp1999415998-103] ERROR (XQueryServlet.java [process]:534) - null \r\njava.lang.NullPointerException: null\r\n        at org.expath.httpclient.impl.ApacheHttpConnection.setCredentials(ApacheHttpConnection.java:415) ~[http-client-java-1.0-SNAPSHOT.jar:1.0-SNAPSHOT]\r\n        at org.expath.httpclient.impl.ApacheHttpConnection.connect(ApacheHttpConnection.java:98) ~[http-client-java-1.0-SNAPSHOT.jar:1.0-SNAPSHOT]\r\n        at org.expath.httpclient.impl.HttpRequestImpl.send(HttpRequestImpl.java:56) ~[http-client-java-1.0-SNAPSHOT.jar:1.0-SNAPSHOT]\r\n        at org.expath.exist.SendRequestFunction.sendOnceWithAuth(SendRequestFunction.java:206) ~[exist-expath-20130805.jar:3.6.0-SNAPSHOT]\r\n        at org.expath.exist.SendRequestFunction.sendOnce(SendRequestFunction.java:172) ~[exist-expath-20130805.jar:3.6.0-SNAPSHOT]\r\n        at org.expath.exist.SendRequestFunction.sendRequest(SendRequestFunction.java:151) ~[exist-expath-20130805.jar:3.6.0-SNAPSHOT]\r\n        at org.expath.exist.SendRequestFunction.eval(SendRequestFunction.java:133) ~[exist-expath-20130805.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.BasicFunction.eval(BasicFunction.java:74) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:41) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:82) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:329) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.XQuery.execute(XQuery.java:261) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.XQuery.execute(XQuery.java:185) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.http.servlets.XQueryServlet.process(XQueryServlet.java:470) [exist-optional.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.http.servlets.XQueryServlet.doPost(XQueryServlet.java:191) [exist-optional.jar:3.6.0-SNAPSHOT]\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:707) [servlet-api-3.1.jar:3.1.0]\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:790) [servlet-api-3.1.jar:3.1.0]\r\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:841) [jetty-servlet-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:535) [jetty-servlet-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:566) [jetty-security-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:190) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:188) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:168) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [jetty-servlet-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:166) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1155) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:163) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:73) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:50) [exist-optional.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:548) [exist-optional.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:352) [exist-optional.jar:3.6.0-SNAPSHOT]\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:790) [servlet-api-3.1.jar:3.1.0]\r\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:833) [jetty-servlet-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:535) [jetty-servlet-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:524) [jetty-security-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:190) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:188) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:168) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [jetty-servlet-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:166) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1155) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:219) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:454) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.Server.handle(Server.java:564) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:317) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:279) [jetty-io-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:110) [jetty-io-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:289) [jetty-io-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.io.ssl.SslConnection$3.succeeded(SslConnection.java:149) [jetty-io-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:110) [jetty-io-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:124) [jetty-io-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.util.thread.Invocable.invokePreferred(Invocable.java:128) [jetty-util-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.util.thread.Invocable$InvocableExecutor.invoke(Invocable.java:222) [jetty-util-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:294) [jetty-util-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:199) [jetty-util-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673) [jetty-util-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591) [jetty-util-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_151]\r\n```\r\n\r\n\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXistdb: 3.6.0\r\n- Java: 8\r\n- MacOs and CentOS\r\n- 64 bit\r\n- multiple custom changes in configs but nothing related to EXPath http client.\r\n\r\nHaven't found the time to debug this myself, since I'm fighting with some 3.4.x eXistdb issues which I hoped would be solved with 3.6.0.\r\n \r\n", "url": "https://github.com/eXist-db/exist/issues/1618", "user": "windauer", "labels": ["bug", "regression"], "created": "2017-11-16 16:41:36", "closed": "2017-11-16 22:00:29", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "xslfo:render() not working with FOP config document", "body": "Problem:\r\nThe `xslfo:render#4` function does not seem to work. The 4th parameter is the FOP config document. However when I supply a valid document to this parameter the answer is \"URI is not absolute\" It ried several variations but I cant get it working. \r\n\r\nWe have code that uses this parameter that runs on older (at least 2.1) versions of eXist that now breaks.\r\n\r\nReproduce:\r\n[eXist-backup-fo-rendertest.zip](https://github.com/eXist-db/exist/files/1470723/eXist-backup-fo-rendertest.zip)\r\nRestore this eXist backup file. It creates a collection /db/fo-rendertest.\r\nRun the `fo-test.xq`. On my system this causes the \"URI not absolute\" error. \r\nReplacing the FOP config reference with () works.\r\n\r\nContext:\r\n- eXist-db version: 3.4.1 (cant find the GIT hash, sorry)\r\n- Java version: 1.8.0_152\r\n- Operating system: Windows 10 64 bits\r\n- Any custom changes: None\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1616", "user": "xatapult", "labels": ["bug"], "created": "2017-11-14 12:25:19", "closed": "2017-11-15 17:21:39", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "dist-war build task includes unsigned JARs that overwrite a core JAR (causing a webstart error)", "body": "### What is the problem\r\nWhen deploying a WAR build of eXist-3.5.0, an error is thrown: \r\n\r\n> Unsigned application requesting unrestricted access to the system\r\n> Unsigned resource: http://localhost:8888/exist-3.5.0/webstart/jcip-annotations-1.0.jar\r\n\r\nI've verified the signatures of all 28 JAR files in the extracted WAR file's `WEB-INF\\lib` folder that are listed in exist.jnlp,, and indeed only `WEB-INF\\lib\\jcip-annotations-1.0.jar` is the sole unsigned one. \r\n\r\n**YET**, I've noticed that the eXist source tree includes multiple copies of `jcip-annotations-1.0.jar`:\r\n\r\n- `${exist_home}/lib/core/jcip-annotations-1.0.jar` (+- 5,5 Mb)\r\n- `${exist_home}/extensions/contentextraction/lib/jcip-annotations-1.0.jar` (+- 2,2 Mb)\r\n- `${exist_home}/extensions/betterform/main/lib/jcip-annotations-1.0.jar` (+- 2,2 Mb)\r\n\r\nThe one at `${exist_home}/lib/core/jcip-annotations-1.0.jar` is being signed by `jnlp-all`; the others aren't. Comparing with the version included in the WAR file, it is clearly one of the **unsigned** ones that ends up being copied there by the `dist-war` build target. \r\n\r\nOne dirty workaround is replacing the extracted `WEB-INF\\lib\\jcip-annotations-1.0.jar` in the WAR tree with the signed `${exist_home}/lib/core/jcip-annotations-1.0.jar` from the eXist source tree.\r\n\r\nOn further inspection, I've noticed how the generated WAR file contains **all 3 versions** of `jcip-annotations-1.0.jar` in the `WEB-INF\\lib` folder, so it makes sense that they eventually will overwrite each other when the WAR file is extracted.\r\n\r\nHence, IMO this rather seems an issue of incorrect file selection during the `dist-war` build task, unintendedly causing an unsigned JAR to be included in the WAR file, than a file signing issue.\r\n\r\n![2017-11-13 16_23_52-winzip - exist-3 5 0 zip](https://user-images.githubusercontent.com/223134/32733609-0acd5626-c890-11e7-8f66-1d11d330ac67.png)\r\n\r\n### What did you expect\r\nI'd expect the java admin client to start without problems.\r\n\r\n### Describe how to reproduce or add a test\r\nI've taken following steps, starting from a freshly installed eXist-3.5.0 version:\r\n\r\n1. sign all jar files via `build jnlp-all`\r\n2. build the WAR dist via `build dist-war`\r\n3. deploy the WAR file in a Tomcat servlet container\r\n4. start the Java web client via the dashboard\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db-3.5.0 / 12aea86\r\n- Java jdk1.8.0_112\r\n- Windows 7 Professional\r\n- 64 bit\r\n- Tomcat-7.0.50", "url": "https://github.com/eXist-db/exist/issues/1614", "user": "rvdb", "labels": ["bug"], "created": "2017-11-13 15:30:00", "closed": "2017-11-22 19:13:02", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "AST error when using attribute node test", "body": "### What is the problem\r\n\r\neXist throws AST errors when using the node test `@node()`. No error is thrown when the verbose form, `attribute::node()`, is used.\r\n\r\n### What did you expect\r\n\r\nI expected `@node()` to correctly perform a node test rather than throw AST errors.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nHere's a test query:\r\n\r\n```xquery\r\n<x y=\"z\"/> ! @node()\r\n```\r\n\r\nThe error thrown in eXide is:\r\n\r\n    <AST>:1:15: unexpected AST node: node.\r\n\r\nThe verbose form of this query returns the expected result:\r\n\r\n```xquery\r\n<x y=\"z\"/> ! attribute::node()\r\n```\r\n\r\n    y=\"z\" \r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 3.6.0-SNAPSHOT f8f0ab69c \r\n- Java version : 1.8.0_144\r\n- Operating system: macOS 10.13.1\r\n- 32 or 64 bit: 64 bit\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/1613", "user": "joewiz", "labels": ["bug"], "created": "2017-11-11 06:20:06", "closed": "2017-11-27 11:06:21", "commits": {}, "ttf": 16.00027777777778, "commitsDetails": []}, {"title": "Betterform integration in build target \u00bbdist\u00ab", "body": "### What is the problem\r\nwhen building eXist with the target \"dist\" (to place an executable version of the software in a single directory without the sources) the resulting software comes without a complete betterform integration, the initial observation is that the dashboard is not available (the browser reports 404 when requesting dojo.js from bfResources)\r\n\r\nit seems that the `web.xml` misses the corresponding servlets configuration which get added by the build target `patchWebXml` from `extensions/betterform/build.xml`.\r\n\r\n(if we manually call this task after the build is complete, we can correct this problem, thanks to @Lena-Luise who found this solution)\r\n\r\n### What did you expect\r\na working instance of the database with a working dashboard - obviously.\r\n\r\n### Describe how to reproduce or add a test\r\n```bash\r\n./build.sh dist\r\n./dist/eXist*/bin/startup.sh\r\ncurl http://localhost:8080/exist/apps/bfResources/scripts/dojo/dojo.js\r\n```\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version 3.6.0-SNAPSHOT commit f0d3647ec7b3fd66c642d3541a2645ffe244276e\r\n- openjdk 1.8.0_131\r\n- Linux, Ubuntu Server 64 bit\r\n- no custom changes, just a cloned repo\r\n", "url": "https://github.com/eXist-db/exist/issues/1586", "user": "mathias-goebel", "labels": ["bug"], "created": "2017-10-13 09:27:06", "closed": "2018-08-27 18:35:05", "commits": {}, "ttf": 318.0002777777778, "commitsDetails": []}, {"title": "Lost line and column number in XPST0081 error", "body": "### What is the problem\r\n\r\nIn eXist 3.4.1 and earlier, `util:compile-query()` would return the correct context for XPST0081 (\"No namespace defined for prefix __\") errors. In eXist 3.5.0 and later, the line and column context is lost.\r\n\r\n### What did you expect\r\n\r\nGiven a query that contains a missing module import declaration:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nutil:compile-query(\"console:log('foo')\", \"xmldb:exist://\")\r\n```\r\n\r\nI would expect the result as delivered under eXist 3.4.1 and earlier:\r\n\r\n```xml\r\n<info result=\"fail\">\r\n    <error code=\"(http://www.w3.org/2005/xqt-errors#XPST0081):It is a static error if a QName \r\n        used in an expression contains a namespace prefix that cannot be expanded into a namespace \r\n        URI by using the statically known namespaces.\" \r\n            line=\"1\" \r\n            column=\"1\">\r\n                No namespace defined for prefix console\r\n    </error>\r\n</info>\r\n```\r\n\r\nHowever, eXist 3.5.0 and higher, the `@line` and `@column` values are incorrect:\r\n\r\n```xml\r\n<info result=\"fail\">\r\n    <error code=\"(http://www.w3.org/2005/xqt-errors#XPST0081):It is a static error if a QName \r\n        used in an expression contains a namespace prefix that cannot be expanded into a namespace \r\n        URI by using the statically known namespaces.\" \r\n            line=\"0\" \r\n            column=\"0\">\r\n                Invalid qname console:log\r\n    </error>\r\n</info>\r\n```\r\n\r\nNotice the differences:\r\n\r\n1. `@line` and `@column` now both return `0` (null?) instead of `1`\r\n2. The error message has changed from `No namespace defined for prefix console` to `Invalid qname console:log`\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nHere's an XQSuite test (download at [test-compile-xquery.xq.zip](https://github.com/eXist-db/exist/files/1380101/test-compile-xquery.xq.zip))\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace cq = \"http://exist-db.org/test/util/compile-query\";\r\n\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare \r\n    %test:args('xquery version \"3.1\"; \r\n\r\nconsole:log(\"foo\")')\r\n    %test:assertEquals(3, 1)\r\n    function cq:get-error-line-column($query) {\r\n        let $context := \"xmldb:exist://\"\r\n        let $info := util:compile-query($query, $context)\r\n        return\r\n            if ($info/error) then\r\n                $info/error/(@line, @column) ! (. cast as xs:integer)\r\n            else\r\n                ()\r\n};\r\n```\r\n\r\nReturns:\r\n\r\n```xml\r\n<testsuites>\r\n    <testsuite package=\"http://exist-db.org/test/util/compile-query\"\r\n        timestamp=\"2017-10-12T13:17:08.388-04:00\" failures=\"1\" pending=\"0\" tests=\"1\" time=\"PT0.006S\">\r\n        <testcase name=\"get-error-line-column\" class=\"cq:get-error-line-column\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">3 1</failure>\r\n            <output>0 0</output>\r\n        </testcase>\r\n    </testsuite>\r\n</testsuites>\r\n```\r\n\r\n### Context information\r\n- eXist-db version + Git Revision hash: eXist 3.4.1+e8996ca748 and eXist 3.6.0-SNAPSHOT+ef437e27c9 (build 201710121258)\r\n- Java version: jdk1.8.0_144.jdk\r\n- Operating system: OSX 10.13\r\n- 32 or 64 bit: x86_64\r\n- Any custom changes in e.g. conf.xml: none", "url": "https://github.com/eXist-db/exist/issues/1583", "user": "joewiz", "labels": ["bug", "regression"], "created": "2017-10-12 17:20:06", "closed": "2020-03-03 10:55:15", "commits": {}, "ttf": 872.0002777777778, "commitsDetails": []}, {"title": "Regression? 3.5's installer doesn't create data folder.", "body": "### What is the problem\r\n\r\nWhile the installer of version 3.4.1 created the folder that was given as argument for the 'Data Directory', the one of 3.5.0 doesn't. This is at least true for relative paths that are supposed to be siblings of the installation target.\r\n\r\nIf this changed behaviour is intended, it should be mentioned in the changelog.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n```\r\n$ java -jar ~/Downloads/eXist-db-setup-3.5.0.jar -console                                                                                                                                        \r\nSelect target path [/tmp] \r\n/tmp/test\r\npress 1 to continue, 2 to quit, 3 to redisplay\r\n1\r\nSet Data Directory\r\nPlease select a directory where eXist-db will keep its data files. On Windows, this should be outside the 'Program Files' directory. Please make sure eXist can write to the directory it is installed in.\r\nData dir:  [webapp/WEB-INF/data] \r\n../data\r\npress 1 to continue, 2 to quit, 3 to redisplay\r\n1\r\nSet Admin Password and Configure Memory\r\nEnter password:  [] \r\ntest\r\nEnter password:  [test] \r\n\r\n------------------------------------------\r\n\r\nMaximum memory in MB: [2048] \r\n\r\nCache memory in MB: [256] \r\n\r\npress 1 to continue, 2 to quit, 3 to redisplay\r\n1\r\n[ Starting to unpack ]\r\n[ Processing package: Sources (1/10) ]\r\n[ Processing package: Core (2/10) ]\r\n[ Processing package: Apps (3/10) ]\r\n[ Processing package: shared (4/10) ]\r\n[ Processing package: dashboard (5/10) ]\r\n[ Processing package: doc (6/10) ]\r\n[ Processing package: eXide (7/10) ]\r\n[ Processing package: fundocs (8/10) ]\r\n[ Processing package: markdown (9/10) ]\r\n[ Processing package: monex (10/10) ]\r\n[ Unpacking finished ]\r\n[ Starting processing ]\r\nStarting process Setting admin password ... (1/1)\r\n--- Starting embedded database instance ---\r\nSetting admin user password...\r\n--- Initialization complete. Shutdown embedded database instance ---\r\n[ Console installation done ]\r\n$ [ -d /tmp/data ]; echo $?\r\n1\r\n```\r\n\r\nversus\r\n\r\n```\r\n$ java -jar ~/Downloads/eXist-db-setup-3.4.1.jar -console                                                                                                                                        \r\n/tmp/test\r\npress 1 to continue, 2 to quit, 3 to redisplay\r\n1\r\nSet Data Directory\r\nPlease select a directory where eXist-db will keep its data files. On Windows, this should be outside the 'Program Files' directory. Please make sure eXist can write to the directory it is installed in.\r\nData dir:  [webapp/WEB-INF/data] \r\n../data\r\npress 1 to continue, 2 to quit, 3 to redisplay\r\n1\r\nSet Admin Password and Configure Memory\r\nEnter password:  [] \r\ntest\r\nEnter password:  [test] \r\n\r\n------------------------------------------\r\n\r\nMaximum memory in MB: [2048] \r\n\r\nCache memory in MB: [256] \r\n\r\npress 1 to continue, 2 to quit, 3 to redisplay\r\n1\r\n[ Starting to unpack ]\r\n[ Processing package: Sources (1/10) ]\r\n[ Processing package: Core (2/10) ]\r\n[ Processing package: Apps (3/10) ]\r\n[ Processing package: shared (4/10) ]\r\n[ Processing package: dashboard (5/10) ]\r\n[ Processing package: doc (6/10) ]\r\n[ Processing package: eXide (7/10) ]\r\n[ Processing package: fundocs (8/10) ]\r\n[ Processing package: markdown (9/10) ]\r\n[ Processing package: monex (10/10) ]\r\n[ Unpacking finished ]\r\n[ Starting processing ]\r\nStarting process Setting admin password ... (1/1)\r\n--- Starting embedded database instance ---\r\nSetting admin user password...\r\n--- Initialization complete. Shutdown embedded database instance ---\r\n[ Console installation done ]\r\n$ [ -d /tmp/data ]; echo $?\r\n0\r\n```\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db 3.4.1 /  e8996ca |  3.5.0 / 12aea86\r\n- OpenJDK Runtime Environment (build 1.8.0_131-8u131-b11-2ubuntu1.16.04.3-b11)\r\n- Ubuntu Xenial\r\n- 64 bit", "url": "https://github.com/eXist-db/exist/issues/1576", "user": "funkyfuture", "labels": ["bug", "installer", "regression"], "created": "2017-10-12 10:07:38", "closed": "2019-05-22 12:08:24", "commits": {}, "ttf": 587.0002777777778, "commitsDetails": []}, {"title": "Bug with on-disk node test and following-sibling axis", "body": "### What is the problem\r\n\r\nA query which returns expected results with in-memory node returns incorrect results when stored to the database. The problem is manifest when performing a node test using the following-sibling axis against the on-disk data.\r\n\r\nMy test query creates an in-memory node, stores it on-disk, then performs a series of queries against the data in-memory and on-disk. The queries select a node, traverse the *-sibling XPath axes, and apply node tests. The results become inconsistent when the query performs a node test with a named namespace on the following-sibling axis.\r\n\r\n### What did you expect\r\n\r\nI expected queries on in-memory and on-disk data to perform identically, and for queries involving namespaces and the following-sibling axis to return expected results. \r\n\r\n### Describe how to reproduce or add a test\r\n\r\nMy test query is as follows:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\ndeclare namespace tei=\"http://www.tei-c.org/ns/1.0\";\r\n\r\nlet $in-mem := \r\n    <TEI xmlns=\"http://www.tei-c.org/ns/1.0\">\r\n        <div>\r\n            <div xml:id=\"d1\"/>\r\n            <div xml:id=\"d2\"/>\r\n            <div xml:id=\"d3\"/>\r\n        </div>\r\n    </TEI>\r\nlet $store := xmldb:store(\"/db\", \"test.xml\", $in-mem)\r\nlet $stored := doc($store)\r\nreturn\r\n    (\r\n        exists($in-mem//tei:div[@xml:id eq \"d2\"]),\r\n        exists($stored//tei:div[@xml:id eq \"d2\"]),\r\n        exists($in-mem//tei:div[@xml:id eq \"d2\"]/preceding-sibling::*:div),\r\n        exists($stored//tei:div[@xml:id eq \"d2\"]/preceding-sibling::*:div),\r\n        exists($in-mem//tei:div[@xml:id eq \"d2\"]/preceding-sibling::tei:div),\r\n        exists($stored//tei:div[@xml:id eq \"d2\"]/preceding-sibling::tei:div),\r\n        exists($in-mem//tei:div[@xml:id eq \"d2\"]/following-sibling::*:div),\r\n        exists($stored//tei:div[@xml:id eq \"d2\"]/following-sibling::*:div),\r\n        exists($in-mem//tei:div[@xml:id eq \"d2\"]/following-sibling::tei:div),\r\n        exists($stored//tei:div[@xml:id eq \"d2\"]/following-sibling::tei:div)\r\n    )\r\n```\r\n\r\nThe queries all return `true()` except the final one, which returns `false()`.\r\n\r\n**Update:** My original test query used retrieved the source document via HTTP request, but in the interests of simplifying the test, I trimmed the test document to the bare minimum needed to reproduce the result.\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 3.5.0-SNAPSHOT+0875a60cc (build 201709221341)\r\n- Java version: jdk1.8.0_144.jdk\r\n- Operating system: macOS 10.12.6\r\n- 32 or 64 bit: 64 bit\r\n- Any custom changes in e.g. conf.xml: none", "url": "https://github.com/eXist-db/exist/issues/1555", "user": "joewiz", "labels": ["bug"], "created": "2017-09-22 18:27:04", "closed": "2018-08-16 19:28:09", "commits": {"145e9bde2fd5f8b0e48dca71e08d4de3c01837de": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 328.0002777777778, "commitsDetails": [{"commitHash": "145e9bde2fd5f8b0e48dca71e08d4de3c01837de", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["8aaa78bc72e39d96f640ef5bbcc1165aad3bdfff"], "nameRev": "145e9bde2fd5f8b0e48dca71e08d4de3c01837de tags/eXist-5.1.0~328^2~1", "commitMessage": "[bugfix] Fix an issue with following-sibling selection when parent element has the same name as the context item element.\nCloses https://github.com/eXist-db/exist/issues/1555\n", "commitDateTime": "2018-08-16 10:43:09", "authoredDateTime": "2018-08-15 13:06:16", "commitGitStats": [{"filePath": "src/org/exist/dom/persistent/NewArrayNodeSet.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "test/src/org/exist/xquery/XPathQueryTest.java", "insertions": 63, "deletions": 2, "lines": 65}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NewArrayNodeSet.java", "spoonMethods": [{"spoonMethodName": "org.exist.dom.persistent.NewArrayNodeSet.selectFollowingSiblings(org.exist.dom.persistent.NodeSet,int)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "XPathQueryTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.XPathQueryTest.followingSiblingAxis_persistent()", "TOT": 11, "UPD": 0, "INS": 10, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.xquery.XPathQueryTest", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.XPathQueryTest.precedingSiblingAxis_persistent()", "TOT": 10, "UPD": 0, "INS": 10, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.XPathQueryTest.precedingSiblingAxis_memtree()", "TOT": 8, "UPD": 0, "INS": 8, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.XPathQueryTest.followingSiblingAxis_memtree()", "TOT": 8, "UPD": 0, "INS": 8, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["145e9bde2fd5f8b0e48dca71e08d4de3c01837de"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 1, "deletions": 1, "lines": 2, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 2, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/dom/persistent"], "changesInPackagesSPOON": ["org.exist.dom.persistent.NewArrayNodeSet.selectFollowingSiblings(org.exist.dom.persistent.NodeSet,int)"]}, {"title": "Arrow operator expression failure", "body": "### What is the problem\r\n\r\nAnother arrow operator expression is failing, whereas the non-arrow operator version works. For example, the following expression throws an error:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\n(1, 2, 3) => string-join(\"-\")\r\n```\r\n\r\nThe error from eXist:\r\n\r\n> err:XPTY0004 xs:integer(1) is not a sub-type of xs:string\r\n\r\nWhen expressing the query without the arrow operator, eXist does not throw an error:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nstring-join((1, 2, 3), \"-\")\r\n```\r\n\r\nI'm not sure if the underlying problem is some kind of type promotion failure when using the arrow operator? \r\n\r\nAlso, on a possibly related point (?), in version 3.1 of XQuery F&O spec appears changed the function signature for the first parameter of `fn:string-join()`, relaxing it from `xs:string*` to  `xs:anyAtomicType*`. eXist still restricts this parameter to `xs:string*`. See https://www.w3.org/TR/xpath-functions-31/#func-string-join vs. https://www.w3.org/TR/xpath-functions-30/#func-string-join vs. https://www.w3.org/TR/xpath-functions/#func-string-join vs. https://github.com/eXist-db/exist/blob/develop/src/org/exist/xquery/functions/fn/FunStringJoin.java#L58-L60. \r\n\r\n### What did you expect\r\n\r\nThe expected result, as produced correctly by BaseX and Saxon (and by eXist when using the variant of the query without the arrow operator), is \"1-2-3\".\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nSee the sample code above.\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist-db 3.5.0-SNAPSHOT+0875a60cc\r\n- Java version: jdk1.8.0_144\r\n- Operating system: macOS 10.12.6\r\n- 32 or 64 bit: 64 bit\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/1553", "user": "joewiz", "labels": ["bug"], "created": "2017-09-21 21:15:15", "closed": "2017-09-25 11:07:58", "commits": {"8cdf43f7d6e86369cd22637c60e5bc0db4d6e618": {"commitGHEventType": "closed", "commitUser": "adamretter"}}, "ttf": 3.000277777777778, "commitsDetails": [{"commitHash": "8cdf43f7d6e86369cd22637c60e5bc0db4d6e618", "commitGHEventType": "closed", "commitUser": "adamretter", "commitParents": ["430e17d79b77c2c4fd5b514f995e7953b2399bf5"], "nameRev": "8cdf43f7d6e86369cd22637c60e5bc0db4d6e618 tags/eXist-3.5.0~6^2", "commitMessage": "[bugfix] Arrow operator type error. Closes #1553, adds simpler fix for #1548.\n", "commitDateTime": "2017-09-25 12:25:15", "authoredDateTime": "2017-09-25 12:25:15", "commitGitStats": [{"filePath": "src/org/exist/xquery/ArrowOperator.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "src/org/exist/xquery/Function.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "src/org/exist/xquery/NamedFunctionReference.java", "insertions": 9, "deletions": 6, "lines": 15}, {"filePath": "src/org/exist/xquery/XQueryContext.java", "insertions": 2, "deletions": 14, "lines": 16}, {"filePath": "test/src/xquery/xquery3/arrowop.xql", "insertions": 18, "deletions": 2, "lines": 20}, {"filePath": "test/src/xquery/xquery3/higher-order.xml", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ArrowOperator.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.ArrowOperator.ContextParam", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Function.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.Function.Placeholder", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "NamedFunctionReference.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.NamedFunctionReference.lookupFunction(org.exist.xquery.Expression,org.exist.xquery.XQueryContext,org.exist.dom.QName,int)", "TOT": 8, "UPD": 0, "INS": 3, "MOV": 4, "DEL": 1}]}, {"spoonFilePath": "XQueryContext.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.XQueryContext.resolveForwardReferences()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.xquery.XQueryContext.resolveForwardReferences(boolean)", "TOT": 5, "UPD": 0, "INS": 0, "MOV": 1, "DEL": 4}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "regression with closures in maps (since 3.4.0)", "body": "### What is the problem\r\nStarting with eXist version 3.4.0 inline functions within maps will not inherit variables declared outside its function body. The problem has been discussed on [eXist-open](https://sourceforge.net/p/exist/mailman/message/36045046/) and was confirmed by @joewiz by testing against Saxon and BaseX.\r\n\r\n### What did you expect\r\n\r\nI expected all three tests to pass without errors (as they do in eXist version 3.3.0).\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace ct=\"http://exist-db.org/xquery/closures/test\";\r\n\r\ndeclare variable $ct:model := function($param) {\r\n    let $func := function() {\r\n       $param\r\n    }\r\n    return\r\n        map {\r\n            'test1' : $func,\r\n            'test2' : $func(),\r\n            'test3' : function() {\r\n                $param\r\n            }\r\n        }\r\n};\r\n\r\ndeclare %test:assertEquals('Hello World') function ct:test1-function-reference() as xs:string {\r\n    try {\r\n        $ct:model('Hello World')?test1()\r\n    }\r\n    catch * {$err:code || ' ' || $err:description}\r\n};\r\n\r\ndeclare %test:assertEquals('Hello World') function ct:test2-function-call() as xs:string {\r\n    try {\r\n        $ct:model('Hello World')?test2\r\n    }\r\n    catch * {$err:code || ' ' || $err:description}\r\n};\r\n\r\ndeclare %test:assertEquals('Hello World') function ct:test3-inline-function() as xs:string {\r\n    try {\r\n        $ct:model('Hello World')?test3()\r\n    }\r\n    catch * {$err:code || ' ' || $err:description}\r\n};\r\n```\r\n\r\n\r\n### Context information\r\n- eXist-db version 3.5.0-SNAPSHOT /  fdaabad\r\n- Java 1.8.0_131 [Oracle Corporation]\r\n- Operating system MacOs Capitan 64 bit\r\n- vanilla build from develop branch\r\n", "url": "https://github.com/eXist-db/exist/issues/1550", "user": "peterstadler", "labels": ["bug", "high prio", "regression"], "created": "2017-09-20 08:21:00", "closed": "2019-03-26 04:32:26", "commits": {}, "ttf": 551.0002777777778, "commitsDetails": []}, {"title": "Arrow operator in user-defined function causes NPE", "body": "### What is the problem\r\n\r\nIn the current develop branch, the use of an arrow operator inside user-defined functions is causing an NPE. Adapting the query to not use the arrow operator eliminates the NPE.\r\n\r\n### What did you expect\r\n\r\nI expected the arrow operator not to cause an NPE in this circumstance. Saxon and BaseX return the expected result, 6.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nThe following query triggers the NPE:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\ndeclare function local:foo($x) {\r\n    local:foo($x, \"bar\")\r\n};\r\n\r\ndeclare function local:foo($x, $y) {\r\n    ($x || $y) => string-length()\r\n};\r\n\r\nlocal:foo(\"foo\")\r\n```\r\n\r\nThe NPE, as seen in exist.log:\r\n\r\n```text\r\n2017-09-16 12:07:33,356 [qtp1229776026-79] ERROR (XQueryServlet.java [process]:534) - null \r\njava.lang.NullPointerException: null\r\n\tat org.exist.xquery.Function.analyze(Function.java:348) ~[exist.jar:3.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.FunctionCall.analyze(FunctionCall.java:142) ~[exist.jar:3.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.UserDefinedFunction.analyze(UserDefinedFunction.java:115) ~[exist.jar:3.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.FunctionCall.analyze(FunctionCall.java:148) ~[exist.jar:3.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.PathExpr.analyze(PathExpr.java:184) ~[exist.jar:3.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQueryContext.analyzeAndOptimizeIfModulesChanged(XQueryContext.java:1609) ~[exist.jar:3.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.compile(XQuery.java:137) ~[exist.jar:3.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.compile(XQuery.java:79) ~[exist.jar:3.5.0-SNAPSHOT]\r\n\tat org.exist.xquery.XQuery.compile(XQuery.java:71) ~[exist.jar:3.5.0-SNAPSHOT]\r\n\tat org.exist.http.servlets.XQueryServlet.process(XQueryServlet.java:425) [exist-optional.jar:3.5.0-SNAPSHOT]\r\n...\r\n```\r\n\r\nThe following query is identical to the first, but it avoids the use of the arrow operator. It does not trigger an NPE:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\ndeclare function local:foo($x) {\r\n    local:foo($x, \"bar\")\r\n};\r\n\r\ndeclare function local:foo($x, $y) {\r\n    string-length($x || $y)\r\n};\r\n\r\nlocal:foo(\"foo\")\r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 3.5.0-DEVELOP fdaabad17\r\n- Java version: 1.8.0_144\r\n- Operating system: macOS 10.12.6\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml: none", "url": "https://github.com/eXist-db/exist/issues/1548", "user": "joewiz", "labels": ["bug"], "created": "2017-09-16 16:13:12", "closed": "2017-09-25 11:07:54", "commits": {}, "ttf": 8.000277777777777, "commitsDetails": []}, {"title": "YAJSW: stdout output is truncated", "body": "### What is the problem\r\nWhen running eXIist-db as a service (yajsw), not all logging from `util:log-system-out` is written to the file `wrapper.log`\r\n\r\ne.g. the query \r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nfor $i in 1 to 1000\r\nreturn\r\n    util:log-system-out(\"message=\" || $i)\r\n```\r\n\r\nonly writes a limited nr of items to the file:\r\n\r\n```\r\nINFO|9197/0|Service eXist-db|17-08-28 21:41:05|(Line: 5 String) message=58\r\nINFO|9197/0|Service eXist-db|17-08-28 21:41:05|(Line: 5 String) message=59\r\nINFO|9197/0|Service eXist-db|17-08-28 21:41:05|(Line: 5 String) message=60\r\nINFO|9197/0|Service eXist-db|17-08-28 21:41:05|(Line: 5 String) message=61\r\nINFO|9197/0|Service eXist-db|17-08-28 21:41:05|[Fatal Error] :-1:-1: Premature end of file.\r\n```\r\ninteresting facts:\r\n- re-running the query does not write new data to the logs\r\n- rerunning with `util:log-system-err` has the same behaviour ; after some entries it stops outputting\r\n- rerunning the original query keeps the logfile quiet.\r\n- updating yajsw to the latest version does not solve the issue\r\n\r\n\r\n### What did you expect\r\nThe log file should always capture all stdout/stderr output\r\n\r\n### Describe how to reproduce or add a test\r\n- start exist: `./tools/yajsw/bin/installDaemon.sh`\r\n- tail logfile `./tools/yajsw/logs/wrapper.log`\r\n- run script 2x --> only a limited nr of entries are lofted\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version +  eXist-db 3.4.1 \r\n- Java version (e.g. Java8u141)\r\n- Operating system (MacOs)\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml: no\r\n", "url": "https://github.com/eXist-db/exist/issues/1533", "user": "dizzzz", "labels": ["YAJSW", "awaiting-response", "bug"], "created": "2017-08-28 20:31:41", "closed": "2019-10-28 22:39:11", "commits": {}, "ttf": 791.0002777777778, "commitsDetails": []}, {"title": "User manager2 is not showing correct user data", "body": "### What is the problem\r\n> User manager2 is showing data from the previously opened user\r\n\r\n### What did you expect\r\n> To show user's own data\r\n\r\n### Describe how to reproduce or add a test\r\n> This is screencast: [user-manager-2.zip](https://github.com/eXist-db/exist/files/1201233/user-manager-2.zip)\r\n> Open User manager from the Dashboard\r\n> Right click on monex (or any other)\r\n> Choose: Edit monex\r\n> Close the app by clicking [x] in upper right corner\r\n> Open User manager\r\n> Right click on any user\r\n> Edit user\r\n> Data of the monex user are displayed\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version 3.4.0.\r\n- Java8u141\r\n- Windows XP\r\n- 32 bit\r\n- Chrome, Firefox\r\n", "url": "https://github.com/eXist-db/exist/issues/1511", "user": "miljanuscumlic", "labels": ["bug", "deprecation"], "created": "2017-08-04 18:15:40", "closed": "2018-04-29 17:34:50", "commits": {}, "ttf": 267.0002777777778, "commitsDetails": []}, {"title": "xsl function key() failed with eXist-db version 3", "body": "### What is the problem\r\n\r\nWe have a java application using eXist-db 2.2 as a database (eXist-db is installed as a standalone server). We use queries to retrieve the XML documents stored in the database.\r\n\r\nOn these queries, we call the function `transform:transform` to get the requested output from an input document.\r\n\r\nBasically, the output is the input XML document with some attributes from a dictionary XML document.\r\n\r\nWe are in the process to migrate to eXist-db version 3 as we have some problems with indexation with eXist-db 2.2 (sometimes, some documents are not indexed properly and they can't be found with the `doc()` function). We hope not to have the same problem with eXist-db version 3 (hence the migration project), but we found an issue with the XSL function `key()`.\r\n\r\nFor example, we have queries and XSL documents like the ones below (these files are just examples, the queries and XSL files we have in a production environment are more complex and we need XSL transformation to get the requested output):\r\n\r\n`testListOps.xqy`:\r\n\r\n```xquery\r\nxquery version \"3.0\";\r\n\r\n(:Read document with xsl:for-each and look for key in the dictionary document :)\r\ndeclare variable $xsltPath as xs:string := '/db/agd';\r\ndeclare variable $listOpsFileUri as xs:string := '/db/agd/listOpsErr.xml';\r\ndeclare variable $inputFileUri as xs:string := '/db/agd/inputListOps.xml';\r\n\r\nlet $params :=  <parameters>\r\n                    <param name=\"listOpsFileUri\" value=\"{$listOpsFileUri}\" />\r\n                </parameters>\r\n\r\nlet $xmlData := doc($inputFileUri)\r\n\r\nreturn transform:transform($xmlData, doc(concat($xsltPath, '/', 'testListOps.xsl')),$params)\r\n\r\n```\r\n`testListOps.xsl`:\r\n\r\n```xslt\r\n<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:ts=\"http://www.talentia-software.fr\" version=\"2.0\">\r\n    <xsl:output method=\"xml\" encoding=\"UTF-8\"/>\r\n    <xsl:param name=\"listOpsFileUri\"/>\r\n\r\n    <xsl:variable name=\"ts:listOps\" select=\"doc($listOpsFileUri)\"/>\r\n    <xsl:key name=\"ts:listOpsById\" match=\"//ops\" use=\"@id\"/>\r\n\r\n    <xsl:template match=\"/\">\r\n        <DSN_FLAT>\r\n            <xsl:for-each select=\"//ops\">\r\n                <xsl:variable name=\"keyId\" select=\"@id\"/>\r\n                <xsl:variable name=\"refListOpsEntry\" select=\"$ts:listOps/key('ts:listOpsById', $keyId)\"/>\r\n                <xsl:element name=\"keyId\">\r\n                    <xsl:value-of select=\"$keyId\"/>\r\n                </xsl:element>\r\n                <xsl:element name=\"listOpsEntry\">\r\n                    <xsl:for-each select=\"$refListOpsEntry/@*\">\r\n                        <xsl:value-of select=\"concat(name(), ': ', ., ' ')\"/>\r\n                    </xsl:for-each>\r\n                </xsl:element>\r\n            </xsl:for-each>\r\n        </DSN_FLAT>\r\n    </xsl:template>\r\n</xsl:stylesheet>\r\n```\r\n\r\nThe input file (`inputListOps.xml`) is:\r\n```xml\r\n<listOps>\r\n    <ops id=\"IRCANTEC\"/>\r\n    <ops id=\"CIBTP\"/>\r\n    <ops id=\"AGIRC-ARRCO\"/>\r\n    <ops id=\"CTIP-FFSA-FNMF\"/>\r\n</listOps>\r\n```\r\n\r\nAnd the dictionary document (`listOpsErr.xml`) is:\r\n```xml\r\n<listOps>\r\n    <ops id=\"IRCANTEC\" doEntiteAff=\"false\" doGenerateB20=\"true\"> </ops>\r\n    <ops id=\"CIBTP\" doEntiteAff=\"true\" doGenerateB20=\"true\"/>\r\n    <ops id=\"AGIRC-ARRCO\" doEntiteAff=\"true\" doGenerateB20=\"false\"> </ops>\r\n    <ops id=\"CTIP-FFSA-FNMF\" doEntiteAff=\"true\" doGenerateB20=\"true\"> </ops>\r\n    <ops id=\"POLEEMPLOI\" doEntiteAff=\"true\" doGenerateB20=\"true\"> </ops>\r\n</listOps>\r\n```\r\n\r\n### What did you expect\r\nFrom the examples above, the output should be:\r\n```xml\r\n<DSN_FLAT xmlns:ts=\"http://www.talentia-software.fr\">\r\n    <keyId>IRCANTEC</keyId>\r\n    <listOpsEntry>id: IRCANTEC doEntiteAff: false doGenerateB20: true </listOpsEntry>\r\n    <keyId>CIBTP</keyId>\r\n    <listOpsEntry>id: CIBTP doEntiteAff: true doGenerateB20: true </listOpsEntry>\r\n    <keyId>AGIRC-ARRCO</keyId>\r\n    <listOpsEntry>id: AGIRC-ARRCO doEntiteAff: true doGenerateB20: false </listOpsEntry>\r\n    <keyId>CTIP-FFSA-FNMF</keyId>\r\n    <listOpsEntry>id: CTIP-FFSA-FNMF doEntiteAff: true doGenerateB20: true </listOpsEntry>\r\n</DSN_FLAT>\r\n```\r\n\r\nBut with eXist-db version 3.3, the output is:\r\n```xml\r\n<DSN_FLAT xmlns:ts=\"http://www.talentia-software.fr\">\r\n    <keyId>IRCANTEC</keyId>\r\n    <listOpsEntry>id: IRCANTEC doEntiteAff: false doGenerateB20: true </listOpsEntry>\r\n    <keyId>CIBTP</keyId>\r\n    <listOpsEntry>id: CIBTP doEntiteAff: true doGenerateB20: true </listOpsEntry>\r\n    <keyId>AGIRC-ARRCO</keyId>\r\n    <listOpsEntry/>\r\n    <keyId>CTIP-FFSA-FNMF</keyId>\r\n    <listOpsEntry/>\r\n</DSN_FLAT>\r\n```\r\n\r\nAs soon as the dictionary document has an element with no text value (`<ops id=\"CIBTP\" doEntiteAff=\"true\" doGenerateB20=\"true\"/>`), the following elements are not found with the function key(). In the example above, the elements `AGIRC-ARRCO` and `CTIP-FFSA-FNMF` are not found if the element `CIBTP` has no text value.\r\n\r\nWe had the same issue with eXist-db version 3.0 or 3.2.\r\n\r\nThis query/xsl works fine using eXist-db 2.2.\r\n\r\n\r\n### Describe how to reproduce or add a test\r\nAttached are the query and XSL files (`testListOps.xqy`, `testListOps.xsl`), the input file (`inputListOps.xml`) and the dictionary document (`listOpsErr.xml`)\r\n\r\nThese files can be uploaded in a collection (`/db/agd`) and the query `testListOps.xqy` can be run with eXide.\r\n\r\n\r\n\r\n### Context information\r\n- eXist-db version 3.3.0 build 201707021658 - Git commit dc76b14\r\n- Java version 1.8.0_121\r\n- Operating system Windows Server 2008 R2\r\n- 64 bit\r\n\r\neXist-db is installed as a standalone server, with no change to the `conf.xml` file.\r\nAttached are also the eXist-db logs\r\n\r\n\r\n\r\n\r\n[testListOps.zip](https://github.com/eXist-db/exist/files/1190064/testListOps.zip)\r\n[eXist-db.zip](https://github.com/eXist-db/exist/files/1190063/eXist-db.zip)\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1506", "user": "algrw", "labels": ["bug"], "created": "2017-08-01 09:12:31", "closed": "2017-08-25 20:52:49", "commits": {}, "ttf": 24.00027777777778, "commitsDetails": []}, {"title": "Java Admin Client deletes contents of the directory on backup", "body": "### What is the problem\r\n> Java Admin Client deletes contents of the directory on backup even I if choose No button in the Confirm deletion dialog\r\n\r\n### What did you expect\r\n> To store the backup without deleting anything\r\n\r\n### Describe how to reproduce or add a test\r\n> Open Java Admin Client\r\n> Click Create Backup toolbar button\r\n> In the opened dialog choose some directory with some content in it\r\n> Erase eXist-backup.zip from the target field (i.e. backup as directory structure)\r\n> Press OK button\r\n> In the Confirm deletion dialog press No\r\n> Voil\u00e0, contents of the chosen directory is deleted\r\n\r\n### Context information\r\n> - eXist-db version 3.4.0.\r\n> - Java8u141\r\n> - Operating system Windows XP\r\n> - 32\r\n> - Any custom changes in e.g. conf.xml: data directory\r\n\r\nResolution:\r\nCode for buttons YES and NO in the Confirm deletion dialog should be exchanged, because when you press YES button in the Confirm deletion dialog, the contents are **not deleted**. The logic is inverse.\r\n\r\n**Also**, close or cancel button in the same dialog should stop the backup procedure. But it acts as if I pressed YES button i.e. it proceeds with the backup and do not delete the contents.", "url": "https://github.com/eXist-db/exist/issues/1503", "user": "miljanuscumlic", "labels": ["bug"], "created": "2017-07-29 12:45:44", "closed": "2017-08-01 20:52:35", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "exportMain crashes", "body": "### What is the problem\r\n> java -jar start.jar org.exist.backup.ExportMain -h\r\ngives\r\nException in thread \"main\" java.lang.ExceptionInInitializerError\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.exist.start.Main.invokeMain(Main.java:140)\r\n\tat org.exist.start.Main.run(Main.java:453)\r\n\tat org.exist.start.Main.main(Main.java:64)\r\nCaused by: java.lang.IllegalArgumentException: Having a requried argument and a default value makes no sense\r\n\tat se.softhouse.common.guavaextensions.Preconditions2.check(Preconditions2.java:45)\r\n\tat se.softhouse.jargo.ArgumentBuilder.defaultValue(ArgumentBuilder.java:344)\r\n\tat org.exist.backup.ExportMain.<clinit>(ExportMain.java:93)\r\n\t... 7 more\r\n\r\n\r\n### What did you expect\r\n> the emergency tool is critical on headless system\r\n\r\n### Describe how to reproduce or add a test\r\n>  exist/src/org/exist/backup/ExportMain.java line 93 defines a default but the argument is marked as required (see exception above)\r\n\r\n\r\n### Context information\r\n- eXist-db 3.4.0-Snapshot  [Git commit : e8531dc]\r\n- Java8u131\r\n- Linux\r\n- 64 bit\r\n\r\nregards \r\nPeter", "url": "https://github.com/eXist-db/exist/issues/1499", "user": "pherk", "labels": ["bug"], "created": "2017-07-27 21:36:31", "closed": "2017-07-29 20:49:20", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Installing using the setup jar on OS X Sierra fails", "body": "### What is the problem\r\n\r\nI'm running the JAR installer from <https://bintray.com/existdb/releases/exist/3.3.0/view>, and it fails trying to set the exec permission on the app launcher with the following command:\r\n\r\n`/bin/chmod a+x /Applications/eXist-db/eXist-db.app/Contents/MacOS/JavaAppLauncher`\r\n\r\nThis file does not exist. There is one named `eXist-JavaAppLauncher` in that directory.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nDownload the eXist setup JAR, and run `java -jar java -jar eXist-db-setup-3.3.0.jar`\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist version: 3.3.0\r\n- Java version 1.8.0-b132\r\n- Operating system MacOS Sierra 10.12.5\r\n- 32 or 64 bit -- 64\r\n- Any custom changes in e.g. conf.xml -- none\r\n", "url": "https://github.com/eXist-db/exist/issues/1492", "user": "hcayless", "labels": ["bug"], "created": "2017-07-25 21:00:30", "closed": "2017-07-25 22:36:03", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Function documentation for xmldb:clear-lock", "body": "### What is the problem\r\n\r\nThe function documentation for `xmldb:clear-lock()` appears to be a copy of `xmldb:document-has-lock()`. See https://github.com/eXist-db/exist/blob/develop/src/org/exist/xquery/functions/xmldb/XMLDBHasLock.java#L63-L74.\r\n\r\n### What did you expect\r\n\r\nThe description should describe what the function actually does. Probably something like:\r\n\r\n> Clears a write lock on the resource `$resource` in the collection `$collection-uri`. \r\n\r\nI'm not sure what the return value is supposed to be, but I think the current value must be wrong:\r\n\r\n> the user id of the lock owner, otherwise if not locked the empty sequence\r\n\r\nPerhaps it should be:\r\n\r\n> `true()` if a lock was successfully cleared, `false()` if no lock was present\r\n\r\n(But I'm really not sure what the function does in practice.)\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nSee link to source above or http://exist-db.org/exist/apps/fundocs/view.html?uri=http://exist-db.org/xquery/xmldb#clear-lock.2.\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: 3.4.0-SNAPSHOT+201707142259 (af161fd52) \r\n- Java version: 1.8.0_131\r\n- Operating system: macOS 10.12.5\r\n- 32 or 64 bit: 64 bit\r\n- Any custom changes in e.g. conf.xml: No\r\n", "url": "https://github.com/eXist-db/exist/issues/1484", "user": "joewiz", "labels": ["bug"], "created": "2017-07-17 16:43:50", "closed": "2017-09-25 18:37:18", "commits": {}, "ttf": 70.00027777777778, "commitsDetails": []}, {"title": "local-name() on empty set raises XPDY0002 (undef context item)", "body": "### What is the problem\r\n\r\n```xquery\r\n\r\nlet $xml:= <a/>\r\nreturn $xml/blah/local-name()\r\n```\r\nraises an error instead of returning empty sequence\r\n\r\nerr:XPDY0002 Undefined context item\r\n\r\n### What did you expect\r\n\r\nExpected behaviour is the same as if the context item was explicitly passed as local-name()'s argument.\r\n\r\n```xquery\r\nlet $xml:= <a/>\r\nreturn $xml/blah/local-name(.)\r\n```\r\n\r\n### Context information\r\nPlease always add the following information\r\ntested on eXist-db 3.2.0 (Windows) and 3.0RC2 (Linux)\r\n", "url": "https://github.com/eXist-db/exist/issues/1476", "user": "tuurma", "labels": ["bug"], "created": "2017-07-06 11:09:57", "closed": "2017-09-26 16:13:29", "commits": {}, "ttf": 82.00027777777778, "commitsDetails": []}, {"title": "Error to start Java Client 3.3.0 from Dashboard/web browser ", "body": "Thank you for reporting your issue!\r\n\r\nTo be able to better understand you problem or suggestion, please add as much information as possible to this ticket. When there is no or just little information, it will be too difficult to work on it (and hence we will not be able to solve it)\r\n\r\nPlease fill in the following sections:\r\n\r\n### What is the problem\r\n> Trying to Open/Start Java Admin Client from Dashboard\r\nException:\r\n```\r\nJNLPException[category: Security Error : Exception: null : LaunchDesc: \r\n<jnlp spec=\"7.0\" codebase=\"http://localhost:8080/exist/webstart/\" href=\"exist.jnlp\" version=\"3.3.0\">\r\n  <information>\r\n    <title>eXist XML-DB client</title>\r\n    <vendor>exist-db.org</vendor>\r\n    <homepage href=\"http://exist-db.org\"/>\r\n    <description>Integrated command-line and gui client, entirely based on the XML:DB API and provides commands for most database related tasks, like creating and removing collections, user management, batch-loading XML data or querying.</description>\r\n    <description kind=\"short\">eXist XML-DB client</description>\r\n    <description kind=\"tooltip\">eXist XML-DB client</description>\r\n    <icon href=\"jnlp_logo.jpg\"/>\r\n    <icon href=\"jnlp_icon_128x128.gif\" width=\"128\" height=\"128\"/>\r\n    <icon href=\"jnlp_icon_64x64.gif\" width=\"64\" height=\"64\"/>\r\n    <icon href=\"jnlp_icon_32x32.gif\" width=\"32\" height=\"32\"/>\r\n  </information>\r\n  <security>\r\n    <all-permissions/>\r\n  </security>\r\n  <resources>\r\n    <property name=\"jnlp.packEnabled\" value=\"true\"/>\r\n    <property name=\"java.util.logging.manager\" value=\"org.apache.logging.log4j.jul.LogManager\"/>\r\n    <java version=\"1.8+\"/>\r\n    <jar href=\"log4j-jul-2.8.2.jar\" size=\"26272\"/>\r\n    <jar href=\"commons-codec-1.10.jar\" size=\"307249\"/>\r\n    <jar href=\"cglib-nodep-3.1.jar\" size=\"358483\"/>\r\n    <jar href=\"jcip-annotations-1.0.jar\" size=\"4005\"/>\r\n    <jar href=\"pkg-java-fork.jar\" size=\"87631\"/>\r\n    <jar href=\"commons-logging-1.2.jar\" size=\"66579\"/>\r\n    <jar href=\"jargo-0.4.2-SNAPSHOT-7fa1d04.jar\" size=\"200065\"/>\r\n    <jar href=\"xmlrpc-client-3.1.3.jar\" size=\"65537\"/>\r\n    <jar href=\"rsyntaxtextarea-2.6.1.jar\" size=\"1201107\"/>\r\n    <jar href=\"slf4j-api-1.7.21.jar\" size=\"46264\"/>\r\n    <jar href=\"exist.jar\" size=\"4441960\"/>\r\n    <jar href=\"quartz-2.2.3.jar\" size=\"700323\"/>\r\n    <jar href=\"clj-ds-0.0.4.jar\" size=\"290932\"/>\r\n    <jar href=\"jackson-core-2.7.4.jar\" size=\"262996\"/>\r\n    <jar href=\"log4j-core-2.8.2.jar\" size=\"1498139\"/>\r\n    <jar href=\"commons-pool-1.6.jar\" size=\"118732\"/>\r\n    <jar href=\"xmlrpc-common-3.1.3.jar\" size=\"122505\"/>\r\n    <jar href=\"jline-0.9.94.jar\" size=\"93084\"/>\r\n    <jar href=\"j8fu-1.4.1.jar\" size=\"54814\"/>\r\n    <jar href=\"log4j-api-2.8.2.jar\" size=\"243001\"/>\r\n    <jar href=\"commons-io-2.5.jar\" size=\"221540\"/>\r\n    <jar href=\"gnu-crypto-2.0.1.jar\" size=\"644209\"/>\r\n    <jar href=\"ws-commons-util-1.0.2.jar\" size=\"38575\"/>\r\n    <jar href=\"commons-collections-3.2.2.jar\" size=\"630602\"/>\r\n    <jar href=\"log4j-slf4j-impl-2.8.2.jar\" size=\"26094\"/>\r\n    <jar href=\"xmldb.jar\" size=\"12768\"/>\r\n    <jar href=\"antlr-2.7.7.jar\" size=\"464341\"/>\r\n    <jar href=\"jta-1.1.jar\" size=\"16277\"/>\r\n  </resources>\r\n  <application-desc main-class=\"org.exist.client.InteractiveClient\">\r\n    <argument>-ouri=xmldb:exist://localhost:8080/exist/xmlrpc</argument>\r\n    <argument>--no-embedded-mode</argument>\r\n  </application-desc>\r\n</jnlp> ]\r\n\tat com.sun.javaws.security.JNLPSignedResourcesHelper.checkSignedResourcesHelper(Unknown Source)\r\n\tat com.sun.javaws.security.JNLPSignedResourcesHelper.checkSignedResources(Unknown Source)\r\n\tat com.sun.javaws.Launcher.prepareResources(Unknown Source)\r\n\tat com.sun.javaws.Launcher.prepareAllResources(Unknown Source)\r\n\tat com.sun.javaws.Launcher.prepareToLaunch(Unknown Source)\r\n\tat com.sun.javaws.Launcher.prepareToLaunch(Unknown Source)\r\n\tat com.sun.javaws.Launcher.launch(Unknown Source)\r\n\tat com.sun.javaws.Main.launchApp(Unknown Source)\r\n\tat com.sun.javaws.Main.continueInSecureThread(Unknown Source)\r\n\tat com.sun.javaws.Main.access$000(Unknown Source)\r\n\tat com.sun.javaws.Main$1.run(Unknown Source)\r\n\tat java.lang.Thread.run(Unknown Source)\r\n```\r\n\r\n### What did you expect\r\n> Java Admin Client started as in versions prior to 3.3.0\r\n\r\n### Describe how to reproduce or add a test\r\n> Start Java Admin Client from Dashboard\r\n\r\n> The *best* way is to provide a 'self containing' test, a test that can be run without dependancies.\r\n\r\n1. in IE or Chrome Start Dashboard\r\n2. Click and open \"Java Admin Client\"\r\n\r\nIt is starts OK from \"Quick Start\" menu. the Quick Start menu not available if eXist runs as a service.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version 3.3.0  \r\n- Java version 1.8.0_131\r\n- Operating system Windows 10 or Windows 2016\r\n- 64 bit\r\n- no changes to conf.xml\r\n", "url": "https://github.com/eXist-db/exist/issues/1475", "user": "andray71", "labels": ["bug", "regression"], "created": "2017-07-05 23:53:00", "closed": "2017-07-31 17:45:37", "commits": {}, "ttf": 25.00027777777778, "commitsDetails": []}, {"title": "Problem with Ant task xdb:store", "body": "In an eXist Ant build task I'm doing an `xdb:store`. Whatever I specify (I tried several variations of the options avaliable), this results in an error:\r\n\r\n```\r\nC:\\Data\\Erik\\xmldev\\Benjamins\\awk-test\\deploy\\build.xml:76: java.nio.file.InvalidPathException: Illegal char <:> at index 2: /C:/xdata2/eXist-32/exist-eXist-3.2.0/conf.xml\r\n\tat sun.nio.fs.WindowsPathParser.normalize(Unknown Source)\r\n\t... (many more)\r\n```\r\n\r\nSince I did *not* specify or mention this `conf.xml` file,  this suggests to me that somewhere internally the code references `conf.xml` but has the URI wrong?\r\n\r\nI am running the develop version of eXist (`c018bd4`) on Windows 10 (64), Java 1.8.0_131, no setup changes, a fresh installation, just checked out and did a build.\r\n\r\nReproduce: Try running the attached Ant build script (please change the configuration settings at the top first to your local settings).\r\n\r\n[build.zip](https://github.com/eXist-db/exist/files/1107872/build.zip)\r\n", "url": "https://github.com/eXist-db/exist/issues/1471", "user": "xatapult", "labels": ["bug"], "created": "2017-06-28 07:25:56", "closed": "2017-11-22 10:11:10", "commits": {}, "ttf": 147.00027777777777, "commitsDetails": []}, {"title": "Error in adaptive serialization of fn:concat", "body": "### What is the problem\r\n\r\neXist should reject `fn:concat#1` with error XPST0017 (https://www.w3.org/TR/xpath-30/#ERRXPST0017), since the concat function requires an arity of 2 or more. Instead, it serializes `fn:concat#1` as `fn:concat#-1`. (`fn:concat#2` correctly returns no error.)\r\n\r\n### What did you expect\r\n\r\nI expected eXist to reject `fn:concat#1` with error XPST0017 (https://www.w3.org/TR/xpath-30/#ERRXPST0017). \r\n\r\n### Describe how to reproduce or add a test\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\ndeclare namespace output=\"http://www.w3.org/2010/xslt-xquery-serialization\";\r\ndeclare option output:method \"adaptive\";\r\n\r\nfn:concat#1\r\n```\r\n\r\neXist returns the following result without raising an error:\r\n\r\n> fn:concat#-1\r\n\r\nBaseX returns the following error:\r\n\r\n> [XPST0017] fn:concat(atom1,atom2[,...]): 1 argument supplied.\r\n\r\n### Context information\r\n\r\n- eXist-db version: 3.3.0-SNAPSHOT rev. 49624f2e7\r\n- Java version: Java 8u131\r\n- Operating system: macOS 10.12.5\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml: None\r\n", "url": "https://github.com/eXist-db/exist/issues/1467", "user": "joewiz", "labels": ["bug"], "created": "2017-06-26 13:46:13", "closed": "2020-03-10 11:28:27", "commits": {}, "ttf": 987.0002777777778, "commitsDetails": []}, {"title": "Missing elements when using descendant-or-self", "body": "```xquery\r\nlet $block :=\r\n<a>\r\n    <z>\r\n        <b></b>\r\n    </z>\r\n    <c>\r\n        <b></b>\r\n    </c>\r\n</a>\r\n\r\nreturn $block//*[name(.) eq 'b'][1]\r\n```\r\n\r\nThis only returns 1 `<b>` element in eXist-db. It should return both `<b>` elements.\r\nI have tested this in BaseX and Saxon and they are correct, whereas eXist-db is not.", "url": "https://github.com/eXist-db/exist/issues/1464", "user": "mjhallman", "labels": ["bug", "duplicate"], "created": "2017-06-23 19:56:02", "closed": "2019-01-11 10:39:18", "commits": {}, "ttf": 566.0002777777778, "commitsDetails": []}, {"title": "Packages with semver-min=3.3.0 fails to install on 3.3.0-SNAPSHOT", "body": "### What is the problem\r\n\r\nInstalling a .xar package built from https://github.com/wolfgangmm/eXide/tree/native-adaptive-serialization fails on eXist 3.3.0-SNAPSHOT, even though its `expath-pkg.xml` file states that it requires 3.3.0.\r\n\r\n### What did you expect\r\n\r\nI expected a package whose eXist dependency of `semver-min=3.3.0` would install on a snapshot build of 3.3.0. For example, this package should install without complaint on the current 3.3.0-SNAPSHOT https://github.com/wolfgangmm/eXide/blob/native-adaptive-serialization/expath-pkg.xml.tmpl#L5.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nClone https://github.com/wolfgangmm/eXide/tree/native-adaptive-serialization, run `ant` to build the package, and install the resulting .xar file via Dashboard > Package Manager > Upload. It will return the following error:\r\n\r\n> Package requires eXistdb version > 3.3.0. Installed version is 3.3.0-SNAPSHOT\r\n\r\nexist.log reports:\r\n\r\n```text\r\n2017-06-09 11:11:01,843 [qtp2068499906-100] ERROR (Deploy.java [installAndDeployFromDb]:215) - Package requires eXistdb version > 3.3.0. Installed version is 3.3.0-SNAPSHOT \r\norg.expath.pkg.repo.PackageException: Package requires eXistdb version > 3.3.0. Installed version is 3.3.0-SNAPSHOT\r\n        at org.exist.repo.Deployment.checkProcessorVersion(Deployment.java:293) ~[exist.jar:3.3.0-SNAPSHOT]\r\n        at org.exist.repo.Deployment.installAndDeploy(Deployment.java:217) ~[exist.jar:3.3.0-SNAPSHOT]\r\n        at org.exist.repo.Deployment.installAndDeploy(Deployment.java:163) ~[exist.jar:3.3.0-SNAPSHOT]\r\n        at org.exist.xquery.modules.expathrepo.Deploy.installAndDeployFromDb(Deploy.java:213) [exist-modules.jar:3.3.0-SNAPSHOT]\r\n        at org.exist.xquery.modules.expathrepo.Deploy.eval(Deploy.java:169) [exist-modules.jar:3.3.0-SNAPSHOT]\r\n        at org.exist.xquery.BasicFunction.eval(BasicFunction.java:74) [exist.jar:3.3.0-SNAPSHOT]\r\n        at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:41) [exist.jar:3.3.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:99) \r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version: 3.3.0-DEVELOP a059dec22\r\n- Java version: 8u121\r\n- Operating system: macOS 10.12.5\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/1455", "user": "joewiz", "labels": ["bug", "invalid"], "created": "2017-06-09 20:34:46", "closed": "2017-08-02 18:29:58", "commits": {}, "ttf": 53.000277777777775, "commitsDetails": []}, {"title": "Combined range index causes query to fail", "body": "### What is the problem\r\n\r\nIf a collection has an element-attribute combined index, certain type checks on function signature return values will erroneously fail. If the index is removed, the type check is performed correctly.\r\n\r\n### What did you expect\r\n\r\nI expected the index configuration to have no impact on function signature type checking. \r\n\r\n### Describe how to reproduce or add a test\r\n\r\nHere is a test that demonstrates the error in eXide. It performs the same query on the same data in two collections - one collection has the range index applied, and one has no index applied. The query fails on the indexed collection. Not shown in the test is a 3rd case: if you change the `<create>` element to a simple value like `<create qname=\"@type\" type=\"xs:string\"/>`, the test will pass. So it isn't all range indexes that cause the problem - it's the \"combined\" type, with `create/field`. \r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace rt=\"combined-range-function-signature-test\";\r\n\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare variable $rt:COLLECTION_CONFIG := \r\n    <collection xmlns=\"http://exist-db.org/collection-config/1.0\">\r\n        <index xmlns:xs=\"http://www.w3.org/2001/XMLSchema\">\r\n            <range>\r\n                <create match=\"//note\">\r\n                    <field name=\"note-type\" match=\"@type\" type=\"xs:string\"/>\r\n                </create>\r\n            </range>\r\n        </index>\r\n    </collection>;\r\n\r\ndeclare variable $rt:DATA :=\r\n    <root>\r\n        <div>\r\n            <head>Telegram 294530 From the Department of State to the Consulate in Montreal<note\r\n                    type=\"source\">Source: National Archives, RG 59, Central Files 1967-69, POL 27\r\n                    ARAB-ISR. Unclassified. Drafted by Loy (E/TT), cleared by Roger P. Davies (NEA) and\r\n                    Styles (E/OA/AVP), and approved by Rusk.</note>\r\n                <note type=\"summary\">A message from Deputy Assistant Secretary of State Loy to IATA\r\n                    Director-General Knut Hammarskjold expressing U.S. concern about recent hijackings.\r\n                    Loy condemned Israel for the attack on Khaldeh Airport in Lebanon and noted that the\r\n                    U.S. had registered disapproval of the Athens hijacking of an El Al aircraft.</note>\r\n            </head>\r\n        </div>\r\n    </root>;\r\n\r\ndeclare variable $rt:INDEXED_COLLECTION_NAME := \"test-indexed\";\r\ndeclare variable $rt:INDEXED_COLLECTION := \"/db/\" || $rt:INDEXED_COLLECTION_NAME;\r\n\r\ndeclare variable $rt:NON_INDEXED_COLLECTION_NAME := \"test-non-indexed\";\r\ndeclare variable $rt:NON_INDEXED_COLLECTION := \"/db/\" || $rt:NON_INDEXED_COLLECTION_NAME;\r\n\r\ndeclare\r\n    %test:setUp\r\nfunction rt:setup() {\r\n    xmldb:create-collection(\"/db/system/config/db\", $rt:INDEXED_COLLECTION_NAME),\r\n    xmldb:store(\"/db/system/config/db/\" || $rt:INDEXED_COLLECTION_NAME, \"collection.xconf\", $rt:COLLECTION_CONFIG),\r\n    xmldb:create-collection(\"/db\", $rt:INDEXED_COLLECTION_NAME),\r\n    xmldb:store($rt:INDEXED_COLLECTION_NAME, \"test.xml\", $rt:DATA),\r\n    xmldb:create-collection(\"/db\", $rt:NON_INDEXED_COLLECTION_NAME),\r\n    xmldb:store($rt:NON_INDEXED_COLLECTION_NAME, \"test.xml\", $rt:DATA)\r\n};\r\n\r\ndeclare\r\n    %test:tearDown\r\nfunction rt:cleanup() {\r\n    xmldb:remove($rt:INDEXED_COLLECTION_NAME),\r\n    xmldb:remove(\"/db/system/config/db/\" || $rt:INDEXED_COLLECTION_NAME),\r\n    xmldb:remove($rt:NON_INDEXED_COLLECTION_NAME),\r\n    xmldb:remove(\"/db/system/config/db/\" || $rt:NON_INDEXED_COLLECTION_NAME)\r\n};\r\n\r\ndeclare function rt:get-note($div as element(div)) as element(note)  {\r\n    $div//note[@type='summary']\r\n};\r\n\r\n(:~\r\n : Check indexed collection. This query should return one element. \r\n :)\r\ndeclare\r\n    %test:assertXPath('/@type = \"summary\"')\r\nfunction rt:test-indexed-collection() {\r\n    rt:get-note(collection($rt:INDEXED_COLLECTION_NAME)//div)\r\n};\r\n\r\n(:~\r\n : Check non-indexed collection. This query should return one element. \r\n :)\r\ndeclare\r\n    %test:assertXPath('/@type = \"summary\"')\r\nfunction rt:test-non-indexed-collection() {\r\n    rt:get-note(collection($rt:NON_INDEXED_COLLECTION_NAME)//div)\r\n};\r\n```\r\n\r\nThe test suite returns the following results:\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<testsuites>\r\n    <testsuite package=\"range-tests\" timestamp=\"2017-06-09T16:17:01.251-04:00\" failures=\"0\"\r\n        pending=\"0\" tests=\"2\" time=\"PT0.011S\">\r\n        <testcase name=\"test-indexed-collection\" class=\"rt:test-indexed-collection\">\r\n            <error type=\"err:XPTY0004\"\r\n                message=\"It is a type error if, during the static analysis phase, an expression is found to have a static type that is not appropriate for the context in which the expression occurs, or during the dynamic evaluation phase, the dynamic type of a value does not match a required type as specified by the matching rules in 2.5.4 SequenceType Matching. err:XPTY0004: return type of function 'rt:get-note'. exerr:ERROR Type error: expected type: element(); got: node()\"\r\n            />\r\n        </testcase>\r\n        <testcase name=\"test-non-indexed-collection\" class=\"rt:test-non-indexed-collection\"/>\r\n    </testsuite>\r\n</testsuites>\r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version: 3.3.0-DEVELOP a059dec22\r\n- Java version: 8u121\r\n- Operating system: macOS 10.12.5\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/1454", "user": "joewiz", "labels": ["bug"], "created": "2017-06-09 20:23:18", "closed": "2017-09-20 18:49:04", "commits": {}, "ttf": 102.00027777777778, "commitsDetails": []}, {"title": "xdb:restore doesn't support the \"dir\" attribute", "body": "### What is the problem\r\n\r\nWhen using the ant task to restore a directory I get the following error:\r\n\r\n```\r\nBUILD FAILED\r\n/home/mike/exist_ant_tasks/build.xml:28: xdb:restore doesn't support the \"dir\" attribute\r\n```\r\n\r\n### What did you expect\r\nI'd expect the task to work and the data to be restored.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nAccording to the documentation \"dir\" is an acceptable attribute for the restore task:\r\nhttp://www.exist-db.org/exist/apps/doc/ant-tasks.xml#D2.2.14\r\n\r\nI'm using the following build file:\r\n\r\n```\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<project default=\"Backup\" xmlns:xdb=\"http://exist-db.org/ant\">\r\n\r\n    <!-- the properties file -->\r\n    <property file=\"build.properties\"/>\r\n\r\n    <!-- classpath with eXist jars -->\r\n    <path id=\"classpath.core\">\r\n        <fileset dir=\"${server.dir}/lib/core\">\r\n            <include name=\"*.jar\"/>\r\n        </fileset>\r\n        <pathelement path=\"${server.dir}/exist.jar\"/>\r\n        <pathelement path=\"${server.dir}/exist-optional.jar\"/>\r\n    </path>\r\n\r\n    <!-- include exist ant tasks -->\r\n    <typedef resource=\"org/exist/ant/antlib.xml\" uri=\"http://exist-db.org/ant\">\r\n        <classpath refid=\"classpath.core\"/>\r\n    </typedef>\r\n\r\n    <!-- backup (collection) -->\r\n    <target name=\"Backup\" description=\"Backup collection to a directory\">\r\n        <xdb:backup uri=\"${backup.uri}\" dir=\"${backup.dir}\" user=\"${backup.user}\" password=\"${backup.pass}\"/>\r\n    </target>\r\n\r\n    <!-- restore (collection) -->\r\n    <target name=\"Restore\" description=\"Restore collection to a directory\">\r\n        <xdb:restore uri=\"${backup.uri}\" user=\"${backup.user}\" password=\"${backup.pass}\" dir=\"${backup.dir}\"/>\r\n    </target>\r\n</project>\r\n```\r\n\r\nCan Ant correctly convert an attribute value to a java.nio.file.Path, as used in the public setter method for the custom task?\r\n\r\nhttps://github.com/eXist-db/exist/blob/develop/src/org/exist/ant/RestoreTask.java\r\n\r\n### Context information\r\n\r\n- 3.1.1 / fe05cf7527db943ae6f936c263f744e24fdae2c7\r\n- Apache Ant(TM) version 1.9.7 compiled on April 9 2016\r\n- openjdk version \"1.8.0_131\"\r\n- OpenJDK Runtime Environment (build 1.8.0_131-b12)\r\n- OpenJDK 64-Bit Server VM (build 25.131-b12, mixed mode)\r\n- centos-release-7-3.1611.el7.centos.x86_64\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1453", "user": "MikeJ1971", "labels": ["bug"], "created": "2017-06-08 11:33:19", "closed": "2017-06-26 09:58:15", "commits": {"f018dddf6f3410e35a534c64a7394fbc63103092": {"commitGHEventType": "closed", "commitUser": "dizzzz"}, "49624f2e7b5850d8af916baeef7939d02a5a190a": {"commitGHEventType": "referenced", "commitUser": "dizzzz"}}, "ttf": 17.00027777777778, "commitsDetails": [{"commitHash": "f018dddf6f3410e35a534c64a7394fbc63103092", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["8b4e01cf213c431a53fb5676f9adcc1e145d9861"], "nameRev": "f018dddf6f3410e35a534c64a7394fbc63103092 tags/eXist-3.3.0~4^2", "commitMessage": "[bugfix] Fix xmldb:restore ant task. Closes #1453\n", "commitDateTime": "2017-06-24 20:03:47", "authoredDateTime": "2017-06-23 18:05:54", "commitGitStats": [{"filePath": "src/org/exist/ant/RestoreTask.java", "insertions": 5, "deletions": 4, "lines": 9}, {"filePath": "test/src/ant/exist.properties", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "test/src/ant/server.xml", "insertions": 18, "deletions": 4, "lines": 22}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RestoreTask.java", "spoonMethods": [{"spoonMethodName": "org.exist.ant.RestoreTask.setDir(java.nio.file.Path)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.ant.RestoreTask.setFile(java.nio.file.Path)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.ant.RestoreTask.setDir(java.io.File)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.ant.RestoreTask.setFile(java.io.File)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "49624f2e7b5850d8af916baeef7939d02a5a190a", "commitGHEventType": "referenced", "commitUser": "dizzzz", "commitParents": ["8b4e01cf213c431a53fb5676f9adcc1e145d9861", "f018dddf6f3410e35a534c64a7394fbc63103092"], "nameRev": "49624f2e7b5850d8af916baeef7939d02a5a190a tags/eXist-3.3.0~4", "commitMessage": "Merge pull request #1465 from wolfgangmm/bugfix/ant-restore\n\n[bugfix] Fix xmldb:restore ant task. Closes #1453", "commitDateTime": "2017-06-26 11:58:09", "authoredDateTime": "2017-06-26 11:58:09", "commitGitStats": [{"filePath": "src/org/exist/ant/RestoreTask.java", "insertions": 5, "deletions": 4, "lines": 9}, {"filePath": "test/src/ant/exist.properties", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "test/src/ant/server.xml", "insertions": 18, "deletions": 4, "lines": 22}], "commitSpoonAstDiffStats": [{"spoonFilePath": "RestoreTask.java", "spoonMethods": [{"spoonMethodName": "org.exist.ant.RestoreTask.setDir(java.nio.file.Path)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.ant.RestoreTask.setFile(java.nio.file.Path)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.ant.RestoreTask.setDir(java.io.File)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.ant.RestoreTask.setFile(java.io.File)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["f018dddf6f3410e35a534c64a7394fbc63103092"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 8, "deletions": 6, "lines": 14, "gitFilesChange": 2}, "spoonStatsSummary": {"TOT": 6, "UPD": 2, "INS": 2, "MOV": 0, "DEL": 2, "spoonFilesChanged": 1, "spoonMethodsChanged": 4}, "statsSkippedReason": "", "changesInPackagesGIT": ["test/src/ant/exist.properties", "src/org/exist/ant"], "changesInPackagesSPOON": ["org.exist.ant.RestoreTask.setFile(java.io.File)", "org.exist.ant.RestoreTask.setDir(java.nio.file.Path)", "org.exist.ant.RestoreTask.setFile(java.nio.file.Path)", "org.exist.ant.RestoreTask.setDir(java.io.File)"]}, {"title": "Setting \"java.io.File\" content to a resource locks file", "body": "Let's say I'm using the API:\r\n\r\n       `org.xmldb.api.base.Collection.createResource(String, String)`\r\n\r\nto create a resource and then use the method:\r\n\r\n      `org.xmldb.api.base.Resource.setContent(Object)`\r\n\r\nto set a `java.io.File` object to the Resource.\r\nAfter calling:\r\n\r\n          `org.xmldb.api.base.Collection.storeResource(Resource)`\r\n\r\nthe file remains locked on disk, for example it cannot be deleted anymore on Windows. Possibly this happens because you are not closing the FileInputStream which you are probably using internally to read the file contents.", "url": "https://github.com/eXist-db/exist/issues/1446", "user": "raducoravu", "labels": ["bug"], "created": "2017-05-19 06:39:46", "closed": "2017-11-20 22:16:36", "commits": {}, "ttf": 185.00027777777777, "commitsDetails": []}, {"title": "Lucene config for inline elements fails if empty element is found before ", "body": "### What is the problem\r\nThe lucene index configuration for inline elements fails, if an empty element is found before the element to be inlined.  \r\n\r\nSo with an appropriate index config for inlining em-elements (see attached xq-test)  the word \"trampletier\" would be found here:\r\n\r\n```\r\n    <p><em>trampel</em>tier</p>\r\n```\r\nbut not here:\r\n```\r\n    <p><a name=\"1\"/><em>trampel</em>tier</p>\r\n```\r\n\r\n### What did you expect\r\nI would expect that inline configuration for elements always works as described.\r\n\r\n### Describe how to reproduce or add a test\r\n```\r\nxquery version \"3.1\";\r\n\r\nmodule namespace fti=\"http://exist-db.org/xquery/ft-inline/test\";\r\n\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\ndeclare namespace stats=\"http://exist-db.org/xquery/profiling\";\r\n\r\ndeclare variable $fti:COLLECTION_CONFIG := \r\n    <collection xmlns=\"http://exist-db.org/collection-config/1.0\">\r\n        <index xmlns:xs=\"http://www.w3.org/2001/XMLSchema\">\r\n            <lucene>\r\n                <text qname=\"p\">\r\n                    <inline qname=\"em\"/>\r\n                </text>\r\n            </lucene>\r\n        </index>\r\n    </collection>;\r\n\r\ndeclare variable $fti:DATA :=\r\n    <root>\r\n        <p>trampeltier</p>\r\n        <p><em>trampel</em>tier</p>\r\n        <p><a name=\"1\"></a><em>trampel</em>tier</p>\r\n    </root>;\r\n    \r\ndeclare variable $fti:COLLECTION_NAME := \"inlinetest\";\r\ndeclare variable $fti:COLLECTION := \"/db/\" || $fti:COLLECTION_NAME;\r\n\r\ndeclare\r\n    %test:setUp\r\nfunction fti:setup() {\r\n    xmldb:create-collection(\"/db/system/config/db\", $fti:COLLECTION_NAME),\r\n    xmldb:store(\"/db/system/config/db/\" || $fti:COLLECTION_NAME, \"collection.xconf\", $fti:COLLECTION_CONFIG),\r\n    xmldb:create-collection(\"/db\", $fti:COLLECTION_NAME),\r\n    xmldb:store($fti:COLLECTION, \"test.xml\", $fti:DATA)\r\n};\r\n\r\ndeclare\r\n    %test:tearDown\r\nfunction fti:cleanup() {\r\n    xmldb:remove($fti:COLLECTION),\r\n    xmldb:remove(\"/db/system/config/db/\" || $fti:COLLECTION_NAME)\r\n};\r\n\r\n(:~\r\n : Check lucene inline configuration. As the <em> element is configured to be inlined.\r\n : this query should return 3 matching elements. \r\n :)\r\ndeclare\r\n    %test:args(\"trampeltier\")\r\n    %test:assertEquals(3)\r\nfunction fti:test-inline($query as xs:string) {\r\n    count(collection($fti:COLLECTION)//p[ft:query(., $query)])\r\n};\r\n```\r\n\r\n### Context information\r\n-  eXist 3.3.0-SNAPSHOT / 74085988e\r\n- OpenJDK Runtime Environment (build 1.8.0_131-8u131-b11-1-b11)\r\n- Linux / Debian Stretch 64 bit\r\n", "url": "https://github.com/eXist-db/exist/issues/1439", "user": "ubbo", "labels": ["bug"], "created": "2017-05-15 10:38:41", "closed": "2017-10-24 19:56:21", "commits": {}, "ttf": 162.00027777777777, "commitsDetails": []}, {"title": "Package-manager fails to look for sun/nio/cs/US_ASCII$Encoder ", "body": "### What is the problem\r\nAfter upgrade to eXist 3.2.0 via dmg installer, the package-manager (sp?) can't find available packages causing the following error:\r\n```2017-05-03 12:06:15,259 [qtp430944645-64] WARN  (LogFunction.java [writeLog]:196) - (Line: 152 /db/apps/dashboard/plugins/packageManager/packages.xql) Error while retrieving app packages: sun/nio/cs/US_ASCII$Encoder```\r\n\r\n[full log](https://www.dropbox.com/s/da2p7zcytrdbiso/exist-32.txt?dl=0)\r\nafter logging in the following lines seem relevant from the log\r\n```\r\n2017-05-03 12:04:54,981 [qtp430944645-51] WARN  (ServletHandler.java [doHandle]:670) - Error for /exist/rconsole \r\njava.util.ServiceConfigurationError: org.eclipse.jetty.websocket.servlet.WebSocketServletFactory: Provider org.eclipse.jetty.websocket.server.WebSocketServerFactory could not be instantiated\r\n\u2026\r\nCaused by: java.util.ServiceConfigurationError: org.eclipse.jetty.websocket.api.extensions.Extension: Provider org.eclipse.jetty.websocket.common.extensions.compress.PerMessageDeflateExtension could not be instantiated\r\n\u2026\r\n\r\nCaused by: java.lang.NoClassDefFoundError: java/util/zip/ZipException\r\n\u2026\r\nCaused by: java.lang.ClassNotFoundException: java.util.zip.ZipException\r\n\u2026\r\n2017-05-03 12:04:54,991 [qtp430944645-51] WARN  (HttpChannel.java [handle]:479) - //localhost:8080/exist/rconsole \r\njava.lang.NoClassDefFoundError: java/lang/Throwable$WrappedPrintWriter\r\n```\r\n### What did you expect\r\nA working package manager. \r\n\r\n### Describe how to reproduce or add a test\r\nUpdate exist, select open dashboard, log-in (with remember me unticked), click package-manager. (since i just filed another issues this error is happening after rebooting, so not just on initial run)\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db 3.2\r\n- Java8u131\r\n- MacOs 10.12.4\r\n- 64 bit\r\n", "url": "https://github.com/eXist-db/exist/issues/1432", "user": "duncdrum", "labels": ["bug"], "created": "2017-05-03 10:19:46", "closed": "2017-07-31 08:42:54", "commits": {}, "ttf": 88.00027777777778, "commitsDetails": []}, {"title": "Exist 3.2 won't quit on macOS", "body": "### What is the problem\r\nAfter upgrading from 3.1.1 to 3.2 using the dmg installer eXist won't quit after first run.  In addition to the process described [here](https://github.com/eXist-db/exist/issues/1248) which is still happening, now in addition the exist-db process and menubar item do not respond to either \"stop server\" or \"quit and stop server\" commands. \r\n\r\nEven after stopping the server remains running, quiting doesn't occur. The only way to properly kill the process is via reboot or force kill in activity monitor. \r\n\r\nAfter reboot stop quitting sometimes work, sometimes it doesn't. \r\n\r\n### What did you expect\r\nthe server to stop and quit when I click stop  and quit.\r\n\r\n### Describe how to reproduce or add a test\r\nPreviously there were multiple exist processes that stuck around (one for menubar and one for dock). We have limited that down to one,  for the menubar. This is after stop and quit:\r\n![screenshot 2017-05-03 11 48 21](https://cloud.githubusercontent.com/assets/6205362/25655773/6ee2b5da-2ff6-11e7-9d76-bacdbe6edbe0.png)\r\n\r\nhere is the shutdown log from a failed attempt:\r\n```2017-05-03 14:29:27,237 [AWT-EventQueue-0] INFO  (BrokerPool.java [shutdown]:1518) - Database is shutting down ... \r\n2017-05-03 14:29:27,741 [AWT-EventQueue-0] INFO  (Journal.java [shutdown]:507) - Transaction journal cleanly shutting down with checkpoint... \r\n2017-05-03 14:29:27,742 [AWT-EventQueue-0] INFO  (FileLock.java [release]:188) - Deleting lock file: /Users/halalpha/Library/Application Support/org.exist/journal.lck \r\n2017-05-03 14:29:27,743 [AWT-EventQueue-0] INFO  (FileLock.java [release]:188) - Deleting lock file: /Users/halalpha/Library/Application Support/org.exist/dbx_dir.lck \r\n2017-05-03 14:29:27,744 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: Scheduler-1005066295 \r\n2017-05-03 14:29:27,744 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: AsyncNCSARequestLog@5275b552 \r\n2017-05-03 14:29:27,744 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: Signal Dispatcher \r\n2017-05-03 14:29:27,745 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: Java2D Disposer \r\n2017-05-03 14:29:27,745 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: AWT-Shutdown \r\n2017-05-03 14:29:27,745 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: Thread-134 \r\n2017-05-03 14:29:27,745 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: Reference Handler \r\n2017-05-03 14:29:27,745 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: org.eclipse.jetty.util.RolloverFileOutputStream \r\n2017-05-03 14:29:27,746 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: DestroyJavaVM \r\n2017-05-03 14:29:27,746 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: TimerQueue \r\n2017-05-03 14:29:27,746 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: Finalizer \r\n2017-05-03 14:29:27,746 [AWT-EventQueue-0] INFO  (BrokerPool.java [shutdown]:1646) - shutdown complete ! \r\n2017-05-03 14:29:27,746 [AWT-EventQueue-0] INFO  (JettyStart.java [shutdown]:554) - Database shutdown: stopping server in 1sec ... \r\n2017-05-03 14:29:28,752 [jetty shutdown schedule] INFO  (JettyStart.java [lifeCycleStopping]:638) - Jetty server stopping... \r\n```\r\n=> force quit\r\nhere a successful shutdown (same system few minutes later)\r\n\r\n```\r\n2017-05-03 14:43:58,952 [AWT-EventQueue-0] INFO  (BrokerPool.java [shutdown]:1518) - Database is shutting down ... \r\n2017-05-03 14:43:59,382 [AWT-EventQueue-0] INFO  (Journal.java [shutdown]:507) - Transaction journal cleanly shutting down with checkpoint... \r\n2017-05-03 14:43:59,383 [AWT-EventQueue-0] INFO  (FileLock.java [release]:188) - Deleting lock file: /Users/halalpha/Library/Application Support/org.exist/journal.lck \r\n2017-05-03 14:43:59,384 [AWT-EventQueue-0] INFO  (FileLock.java [release]:188) - Deleting lock file: /Users/halalpha/Library/Application Support/org.exist/dbx_dir.lck \r\n2017-05-03 14:43:59,385 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: AWT-Shutdown \r\n2017-05-03 14:43:59,386 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: Reference Handler \r\n2017-05-03 14:43:59,386 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: Thread-26 \r\n2017-05-03 14:43:59,386 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: TimerQueue \r\n2017-05-03 14:43:59,386 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: Scheduler-448147266 \r\n2017-05-03 14:43:59,386 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: Java2D Disposer \r\n2017-05-03 14:43:59,386 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: org.eclipse.jetty.util.RolloverFileOutputStream \r\n2017-05-03 14:43:59,387 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: DestroyJavaVM \r\n2017-05-03 14:43:59,387 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: Finalizer \r\n2017-05-03 14:43:59,387 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: AsyncNCSARequestLog@72373532 \r\n2017-05-03 14:43:59,387 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: Signal Dispatcher \r\n2017-05-03 14:43:59,388 [AWT-EventQueue-0] WARN  (BrokerPool.java [clearThreadLocals]:1691) - Could not clear ThreadLocals for thread: qtp2070525344-55 \r\n2017-05-03 14:43:59,388 [AWT-EventQueue-0] INFO  (BrokerPool.java [shutdown]:1646) - shutdown complete ! \r\n2017-05-03 14:43:59,388 [AWT-EventQueue-0] INFO  (JettyStart.java [shutdown]:554) - Database shutdown: stopping server in 1sec ... \r\n2017-05-03 14:44:00,392 [jetty shutdown schedule] INFO  (JettyStart.java [lifeCycleStopping]:638) - Jetty server stopping... \r\n2017-05-03 14:44:00,398 [jetty shutdown schedule] INFO  (AbstractConnector.java [doStop]:310) - Stopped ServerConnector@6a1febd7{HTTP/1.1,[http/1.1]}{0.0.0.0:8080} \r\n2017-05-03 14:44:00,399 [jetty shutdown schedule] INFO  (AbstractConnector.java [doStop]:310) - Stopped ServerConnector@518f96de{SSL,[ssl, http/1.1]}{0.0.0.0:8443} \r\n2017-05-03 14:44:00,401 [jetty shutdown schedule] INFO  (ContextHandler.java [doStop]:904) - Stopped o.e.j.w.WebAppContext@5d08f79{/,null,UNAVAILABLE}{/portal} \r\n2017-05-03 14:44:00,404 [jetty shutdown schedule] INFO  (ContextHandler.java [doStop]:904) - Stopped eXist-db Open Source Native XML Database \r\n2017-05-03 14:44:00,405 [jetty shutdown schedule] INFO  (JettyStart.java [lifeCycleStopped]:645) - Jetty server stopped \r\n2017-05-03 14:44:00,405 [BrokerPools-ShutdownHook] INFO  (BrokerPools.java [run]:67) - Executing shutdown thread \r\n```\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db 3.2 \r\n- was Java8u121, now on Java8u131\r\n- MacOs 10.12.4\r\n- 64 bit", "url": "https://github.com/eXist-db/exist/issues/1431", "user": "duncdrum", "labels": ["bug", "high prio"], "created": "2017-05-03 09:51:48", "closed": "2017-08-07 14:45:22", "commits": {}, "ttf": 96.00027777777778, "commitsDetails": []}, {"title": "Search threw an exception", "body": "Exist version 2.2\r\nprobably linked to https://sourceforge.net/p/exist/mailman/message/24190180/\r\n~~~\r\n2017-04-13 12:10:19,340 [http-nio-443-exec-6] ERROR (XQueryServlet.java [process]:631) - String index out of range: -21 \r\njava.lang.StringIndexOutOfBoundsException: String index out of range: -21\r\n\tat java.lang.String.substring(Unknown Source)\r\n\tat org.exist.indexing.lucene.LuceneMatchListener.characters(LuceneMatchListener.java:153)\r\n\tat org.exist.storage.serializers.NativeSerializer.serializeToReceiver(NativeSerializer.java:234)\r\n\tat org.exist.storage.serializers.NativeSerializer.serializeToReceiver(NativeSerializer.java:205)\r\n\tat org.exist.storage.serializers.NativeSerializer.serializeToReceiver(NativeSerializer.java:205)\r\n\tat org.exist.storage.serializers.NativeSerializer.serializeToReceiver(NativeSerializer.java:205)\r\n\tat org.exist.storage.serializers.NativeSerializer.serializeToReceiver(NativeSerializer.java:80)\r\n\tat org.exist.storage.serializers.Serializer.serializeToReceiver(Serializer.java:1070)\r\n\tat org.exist.storage.serializers.Serializer.toSAX(Serializer.java:878)\r\n\tat org.exist.dom.NodeProxy.toSAX(NodeProxy.java:791)\r\n\tat org.exist.xquery.functions.util.Expand.eval(Expand.java:111)\r\n\tat org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\r\n\tat org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:56)\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:142)\r\n\tat org.exist.xquery.BindingExpression.eval(BindingExpression.java:166)\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:264)\r\n\tat org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:80)\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:264)\r\n\tat org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:311)\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\r\n\tat org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:189)\r\n\tat org.exist.xquery.BindingExpression.eval(BindingExpression.java:166)\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:264)\r\n\tat org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:80)\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:264)\r\n\tat org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:311)\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\r\n\tat org.exist.xquery.ForExpr.eval(ForExpr.java:307)\r\n\tat org.exist.xquery.BindingExpression.eval(BindingExpression.java:166)\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:264)\r\n\tat org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:80)\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:264)\r\n\tat org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:311)\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:189)\r\n\tat org.exist.xquery.BindingExpression.eval(BindingExpression.java:166)\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\r\n\tat org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:189)\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:187)\r\n~~~", "url": "https://github.com/eXist-db/exist/issues/1424", "user": "alebastrov", "labels": ["bug"], "created": "2017-04-25 11:59:50", "closed": "2018-08-18 02:45:44", "commits": {}, "ttf": 479.0002777777778, "commitsDetails": []}, {"title": "Too many opened HttpSession", "body": "Each HttpClient request to an application creates  a new HtppSession, which will be never used after. We should have possibility to release a HttpSession after having request processed. for instance with adding some header to HttpClient and in XQueryServlet we have to invalidate session in case this header is provided. It will allow us to save some memory during backup/restore procedure, because each file needs a single separate request, which creates a session", "url": "https://github.com/eXist-db/exist/issues/1421", "user": "alebastrov", "labels": ["bug"], "created": "2017-04-20 09:54:15", "closed": "2018-03-23 13:33:00", "commits": {}, "ttf": 337.0002777777778, "commitsDetails": []}, {"title": "Windows10 issue with YAJSW", "body": "### What is the problem\r\nOn [exist-open](http://exist.markmail.org/search/windows+10+order:date-backward) reports have been made that eXist-db cannot be run as a service on windows 10\r\n\r\n\r\n### What did you expect\r\neXist-db should also run on windows 10\r\n\r\n### Describe how to reproduce or add a test\r\nInstall eXist-db on windows 10, install as service to be sure that the database is gracefully shutdown when windows is shutdown.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db : 3.1.1\r\n- Java version : Java8u121\r\n- Operating system : Windows 10\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml : none\r\n\r\n### References\r\n- All mails on [MarkMail.org](http://exist.markmail.org/search/windows+10+order:date-backward)\r\n\r\n ", "url": "https://github.com/eXist-db/exist/issues/1417", "user": "dizzzz", "labels": ["YAJSW", "awaiting-response", "bug", "windows"], "created": "2017-04-18 17:58:21", "closed": "2019-10-28 22:36:43", "commits": {}, "ttf": 923.0002777777778, "commitsDetails": []}, {"title": "org.exist.security.realm.openid.OpenIDUtility never releases READ_LOCK", "body": "READ_LOCK is acquired here: https://github.com/eXist-db/exist/blob/develop/extensions/security/openid/src/org/exist/security/realm/openid/OpenIDUtility.java#L107", "url": "https://github.com/eXist-db/exist/issues/1415", "user": "adamretter", "labels": ["bug"], "created": "2017-04-17 17:30:21", "closed": "2017-04-19 08:24:07", "commits": {"60fdec29d7f88627a263bc786c20e67c5de1bd0e": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "60fdec29d7f88627a263bc786c20e67c5de1bd0e", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["e642b066384989c359b58da6e8a4322df9a3b843"], "nameRev": "60fdec29d7f88627a263bc786c20e67c5de1bd0e tags/eXist-3.2.0~11^2", "commitMessage": "[bugfix] OpenIDUtility must release the READ_LOCK that it acquired\nCloses https://github.com/eXist-db/exist/issues/1415\n", "commitDateTime": "2017-04-18 17:14:00", "authoredDateTime": "2017-04-18 17:14:00", "commitGitStats": [{"filePath": "extensions/security/openid/src/org/exist/security/realm/openid/OpenIDUtility.java", "insertions": 4, "deletions": 0, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "OpenIDUtility.java", "spoonMethods": [{"spoonMethodName": "org.exist.security.realm.openid.OpenIDUtility.registerUser(org.exist.security.Subject)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["60fdec29d7f88627a263bc786c20e67c5de1bd0e"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 4, "deletions": 0, "lines": 4, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["extensions/security/openid/src/org/exist/security/realm/openid"], "changesInPackagesSPOON": ["org.exist.security.realm.openid.OpenIDUtility.registerUser(org.exist.security.Subject)"]}, {"title": "org.exist.debuggee.dbgp.packets#Source does not release READ_LOCK", "body": "READ_LOCK is acquired here: https://github.com/eXist-db/exist/blob/develop/extensions/debuggee/src/org/exist/debuggee/dbgp/packets/Source.java#L111", "url": "https://github.com/eXist-db/exist/issues/1414", "user": "adamretter", "labels": ["bug"], "created": "2017-04-17 17:29:11", "closed": "2017-04-19 08:24:07", "commits": {"e642b066384989c359b58da6e8a4322df9a3b843": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "e642b066384989c359b58da6e8a4322df9a3b843", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["f6f3b85c0178d4e41e79a5c8c2ad73b040d0a525"], "nameRev": "e642b066384989c359b58da6e8a4322df9a3b843 tags/eXist-3.2.0~11^2~1", "commitMessage": "[bugfix] Debugee Source must release READ_LOCK which it acquired\nCloses https://github.com/eXist-db/exist/issues/1414\n", "commitDateTime": "2017-04-18 17:12:20", "authoredDateTime": "2017-04-18 17:12:20", "commitGitStats": [{"filePath": "extensions/debuggee/src/org/exist/debuggee/dbgp/packets/Source.java", "insertions": 14, "deletions": 6, "lines": 20}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Source.java", "spoonMethods": [{"spoonMethodName": "org.exist.debuggee.dbgp.packets.Source.exec()", "TOT": 5, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["e642b066384989c359b58da6e8a4322df9a3b843"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 14, "deletions": 6, "lines": 20, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 5, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["extensions/debuggee/src/org/exist/debuggee/dbgp/packets"], "changesInPackagesSPOON": ["org.exist.debuggee.dbgp.packets.Source.exec()"]}, {"title": "Resource#createNewFile releases a lock it doesn't hold", "body": "Document is retrieved without lock here: https://github.com/eXist-db/exist/blob/develop/src/org/exist/util/io/Resource.java#L659\r\n\r\nLock (which we have not acquired) is released here: https://github.com/eXist-db/exist/blob/develop/src/org/exist/util/io/Resource.java#L703", "url": "https://github.com/eXist-db/exist/issues/1413", "user": "adamretter", "labels": ["bug"], "created": "2017-04-17 16:28:03", "closed": "2017-04-19 08:24:07", "commits": {"f6f3b85c0178d4e41e79a5c8c2ad73b040d0a525": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "f6f3b85c0178d4e41e79a5c8c2ad73b040d0a525", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["20d8c5239927dbe463fd282d146ec80fcc77bf35"], "nameRev": "f6f3b85c0178d4e41e79a5c8c2ad73b040d0a525 tags/eXist-3.2.0~11^2~2", "commitMessage": "[bugfix] org.exist.util.io.Resource must not release a READ_LOCK which it has not acquired\nCloses https://github.com/eXist-db/exist/issues/1413\n", "commitDateTime": "2017-04-18 17:08:15", "authoredDateTime": "2017-04-18 17:08:15", "commitGitStats": [{"filePath": "src/org/exist/util/io/Resource.java", "insertions": 0, "deletions": 4, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Resource.java", "spoonMethods": [{"spoonMethodName": "org.exist.util.io.Resource.createNewFile()", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["f6f3b85c0178d4e41e79a5c8c2ad73b040d0a525"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 0, "deletions": 4, "lines": 4, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/util/io"], "changesInPackagesSPOON": ["org.exist.util.io.Resource.createNewFile()"]}, {"title": "InspectIndex leaks READ locks", "body": "Never releases the lock, see: https://github.com/eXist-db/exist/blob/develop/extensions/indexes/lucene/src/org/exist/xquery/modules/lucene/InspectIndex.java#L71", "url": "https://github.com/eXist-db/exist/issues/1412", "user": "adamretter", "labels": ["bug"], "created": "2017-04-17 16:11:47", "closed": "2017-04-19 08:24:07", "commits": {"20d8c5239927dbe463fd282d146ec80fcc77bf35": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "20d8c5239927dbe463fd282d146ec80fcc77bf35", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["ac32175a054708b047a885bfc774208fe941a0bd"], "nameRev": "20d8c5239927dbe463fd282d146ec80fcc77bf35 tags/eXist-3.2.0~11^2~3", "commitMessage": "[bugfix] InspectIndex must release the READ_LOCK\nCloses https://github.com/eXist-db/exist/issues/1412\n", "commitDateTime": "2017-04-18 17:04:39", "authoredDateTime": "2017-04-18 17:04:02", "commitGitStats": [{"filePath": "extensions/indexes/lucene/src/org/exist/xquery/modules/lucene/InspectIndex.java", "insertions": 9, "deletions": 4, "lines": 13}], "commitSpoonAstDiffStats": [{"spoonFilePath": "InspectIndex.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.modules.lucene.InspectIndex.eval(org.exist.xquery.value.Sequence[],org.exist.xquery.value.Sequence)", "TOT": 7, "UPD": 1, "INS": 4, "MOV": 1, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["20d8c5239927dbe463fd282d146ec80fcc77bf35"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 9, "deletions": 4, "lines": 13, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 7, "UPD": 1, "INS": 4, "MOV": 1, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["extensions/indexes/lucene/src/org/exist/xquery/modules/lucene"], "changesInPackagesSPOON": ["org.exist.xquery.modules.lucene.InspectIndex.eval(org.exist.xquery.value.Sequence[],org.exist.xquery.value.Sequence)"]}, {"title": "ZipFileFunctions leaks READ locks", "body": "Never releases the lock if the retrieved document is a non-binary, see: https://github.com/eXist-db/exist/blob/develop/extensions/expath/src/org/expath/exist/ZipFileFunctions.java#L270", "url": "https://github.com/eXist-db/exist/issues/1411", "user": "adamretter", "labels": ["bug"], "created": "2017-04-17 16:08:08", "closed": "2017-04-19 08:24:07", "commits": {"ac32175a054708b047a885bfc774208fe941a0bd": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 1.0002777777777778, "commitsDetails": [{"commitHash": "ac32175a054708b047a885bfc774208fe941a0bd", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["9c01e5d22caa4e188bec0d4b5feb4ae4587db64f"], "nameRev": "ac32175a054708b047a885bfc774208fe941a0bd tags/eXist-3.2.0~11^2~4", "commitMessage": "[bugfix] Must release the READ_LOCK if the document is an XML document\nCloses https://github.com/eXist-db/exist/issues/1411\n", "commitDateTime": "2017-04-18 17:01:29", "authoredDateTime": "2017-04-18 17:01:29", "commitGitStats": [{"filePath": "extensions/expath/src/org/expath/exist/ZipFileFunctions.java", "insertions": 8, "deletions": 4, "lines": 12}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ZipFileFunctions.java", "spoonMethods": [{"spoonMethodName": "org.expath.exist.ZipFileFunctions.ZipFileFromDb.getDoc()", "TOT": 4, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 1}, {"spoonMethodName": "org.expath.exist.ZipFileFunctions.ZipFileFromDb.getStream()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.expath.exist.ZipFileFunctions.ZipFileFromDb.getBinaryDoc()", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["ac32175a054708b047a885bfc774208fe941a0bd"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 8, "deletions": 4, "lines": 12, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 6, "UPD": 2, "INS": 1, "MOV": 2, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 3}, "statsSkippedReason": "", "changesInPackagesGIT": ["extensions/expath/src/org/expath/exist"], "changesInPackagesSPOON": ["org.expath.exist.ZipFileFunctions.ZipFileFromDb.getDoc()", "org.expath.exist.ZipFileFunctions.ZipFileFromDb.getBinaryDoc()", "org.expath.exist.ZipFileFunctions.ZipFileFromDb.getStream()"]}, {"title": "DefaultDocumentSet#contains always returns true", "body": "There is a bug in the implementation of `org.exist.dom.persistent.DefaultDocumentSet#contains(org.exist.dom.persistent.DocumentSet)` where it checks the contents of the set against itself.\r\n\r\nSee https://github.com/eXist-db/exist/blob/develop/src/org/exist/dom/persistent/DefaultDocumentSet.java#L187\r\n\r\nI have no idea why we don't see real problems from this...", "url": "https://github.com/eXist-db/exist/issues/1406", "user": "adamretter", "labels": ["bug"], "created": "2017-04-13 21:27:48", "closed": "2017-05-01 13:35:19", "commits": {"049785dac72e250bc5f06682e027edc1838688dd": {"commitGHEventType": "closed", "commitUser": "wolfgangmm"}}, "ttf": 17.00027777777778, "commitsDetails": [{"commitHash": "049785dac72e250bc5f06682e027edc1838688dd", "commitGHEventType": "closed", "commitUser": "wolfgangmm", "commitParents": ["8bcc3eed3f0ac45ffd0858a5ddb539db69b4eaac"], "nameRev": "049785dac72e250bc5f06682e027edc1838688dd tags/eXist-3.2.0~5^2~4", "commitMessage": "[bugfix] DefaultDocumentSet#contains previously always returned true\nCloses https://github.com/eXist-db/exist/issues/1406\n", "commitDateTime": "2017-04-15 11:57:37", "authoredDateTime": "2017-04-15 11:57:37", "commitGitStats": [{"filePath": "src/org/exist/dom/persistent/DefaultDocumentSet.java", "insertions": 5, "deletions": 6, "lines": 11}, {"filePath": "test/src/org/exist/dom/persistent/DefaultDocumentSetTest.java", "insertions": 159, "deletions": 0, "lines": 159}], "commitSpoonAstDiffStats": [{"spoonFilePath": "DefaultDocumentSet.java", "spoonMethods": [{"spoonMethodName": "org.exist.dom.persistent.DefaultDocumentSet.contains(org.exist.dom.persistent.DocumentSet)", "TOT": 10, "UPD": 2, "INS": 2, "MOV": 5, "DEL": 1}]}, {"spoonFilePath": "DefaultDocumentSetTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.dom.persistent.DefaultDocumentSetTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["049785dac72e250bc5f06682e027edc1838688dd"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 5, "deletions": 6, "lines": 11, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 10, "UPD": 2, "INS": 2, "MOV": 5, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/dom/persistent"], "changesInPackagesSPOON": ["org.exist.dom.persistent.DefaultDocumentSet.contains(org.exist.dom.persistent.DocumentSet)"]}, {"title": "client.sh does not handle '-p'", "body": "### What is the problem\r\n> client.sh says: Didn't expect -p ...\r\nclient.sh -h shows a lonely p\r\nnb --parse works\r\n\r\ntypo? `src/org/exist/client/CommandlineOptions.java`:\r\n```java\r\n    private static final Argument<List<File>> parseDocsArg = fileArgument(\"p\", \"--parse\")\r\n.description(\"store files or directories given as extra args on command line.\")\r\n```\r\n\r\n### Context information\r\n- eXist-db newest develop \r\n- Java8u121\r\n- Ubuntu 16.04LTS\r\n\r\nPeter", "url": "https://github.com/eXist-db/exist/issues/1401", "user": "pherk", "labels": ["bug"], "created": "2017-04-11 15:21:15", "closed": "2017-04-11 16:32:05", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Disabling the SQL Module breaks the build", "body": "Because a test for the SQL Module is in the core `src/org/exist/xquery/modules/sql/ExecuteFunctionTest.java` if you disable the SQL module in `extensions/build.properties` or `extensions/local.build.properties` then eXist fails to build.", "url": "https://github.com/eXist-db/exist/issues/1392", "user": "adamretter", "labels": ["bug"], "created": "2017-04-02 20:39:05", "closed": "2019-10-09 14:58:35", "commits": {}, "ttf": 919.0002777777778, "commitsDetails": []}, {"title": "NPE in Security Manager", "body": "### What is the problem\r\nDuring restore of a `3.0RC` generated backup into `3.2.0-SNAPSHOT` there is a NPE, see below; as a result eXide has not been stored correctly, the administration in `WEB-INF\\data\\expathrepo\\.expath-pkg` is incorrect. \r\n\r\n```\r\n2017-03-27 09:10:39,774 [pool-3-thread-1] INFO  (Configurator.java [save]:1280) - Storing configuration /db/system/security/exist/accounts/admin.xml \r\n2017-03-27 09:10:39,785 [pool-3-thread-1] INFO  (NativeBroker.java [removeXMLResource]:2707) - Removing document admin.xml (3) ... \r\n2017-03-27 09:10:39,915 [pool-3-thread-1] INFO  (NativeBroker.java [removeXMLResource]:2707) - Removing document config.xml (2) ... \r\n2017-03-27 09:10:39,932 [pool-3-thread-1] INFO  (NativeBroker.java [removeXMLResource]:2707) - Removing document admin.xml (3) ... \r\n2017-03-27 09:10:39,944 [pool-3-thread-1] INFO  (NativeBroker.java [removeXMLResource]:2707) - Removing document guest.xml (4) ... \r\n2017-03-27 09:10:39,957 [pool-3-thread-1] INFO  (NativeBroker.java [removeXMLResource]:2707) - Removing document monex.xml (743) ... \r\n2017-03-27 09:10:39,967 [pool-3-thread-1] INFO  (NativeBroker.java [removeXMLResource]:2707) - Removing document eXide.xml (541) ... \r\n2017-03-27 09:10:39,984 [pool-3-thread-1] ERROR (DocumentTriggers.java [afterCreateDocument]:238) - null \r\njava.lang.NullPointerException: null\r\n\tat org.exist.security.internal.SecurityManagerImpl.lambda$processPramatter$12(SecurityManagerImpl.java:902) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.security.internal.SecurityManagerImpl$PrincipalDbById.modify(SecurityManagerImpl.java:1008) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.security.internal.SecurityManagerImpl.processPramatter(SecurityManagerImpl.java:901) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.config.ConfigurationDocumentTrigger.afterCreateDocument(ConfigurationDocumentTrigger.java:148) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.collections.triggers.DocumentTriggers.afterCreateDocument(DocumentTriggers.java:236) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.collections.MutableCollection.storeXMLInternal(MutableCollection.java:1259) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.collections.MutableCollection.store(MutableCollection.java:1120) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.xmldb.LocalCollection.lambda$storeXMLResource$13(LocalCollection.java:583) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.xmldb.function.LocalXmldbCollectionFunction.apply(LocalXmldbCollectionFunction.java:48) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.xmldb.LocalCollection.lambda$null$22(LocalCollection.java:729) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.xmldb.function.LocalXmldbCollectionFunction.apply(LocalXmldbCollectionFunction.java:48) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.xmldb.AbstractLocal.lambda$with$6(AbstractLocal.java:172) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.xmldb.AbstractLocal.lambda$null$4(AbstractLocal.java:118) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.xmldb.function.LocalXmldbFunction.apply(LocalXmldbFunction.java:46) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.xmldb.AbstractLocal.withDb(AbstractLocal.java:195) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.xmldb.AbstractLocal.lambda$modify$5(AbstractLocal.java:118) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.xmldb.LocalCollection.lambda$modify$23(LocalCollection.java:727) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.xmldb.LocalCollection.storeXMLResource(LocalCollection.java:552) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.xmldb.LocalCollection.storeResource(LocalCollection.java:502) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.backup.restore.RestoreHandler.restoreResourceEntry(RestoreHandler.java:392) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.backup.restore.RestoreHandler.startElement(RestoreHandler.java:122) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.impl.XMLNSDocumentScannerImpl.scanStartElement(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.exist.backup.restore.RestoreHandler.restoreSubCollectionEntry(RestoreHandler.java:255) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.backup.restore.RestoreHandler.startElement(RestoreHandler.java:128) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.AbstractXMLDocumentParser.emptyElement(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.impl.XMLNSDocumentScannerImpl.scanStartElement(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.exist.backup.restore.RestoreHandler.restoreSubCollectionEntry(RestoreHandler.java:255) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.backup.restore.RestoreHandler.startElement(RestoreHandler.java:128) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.AbstractXMLDocumentParser.emptyElement(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.impl.XMLNSDocumentScannerImpl.scanStartElement(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.exist.backup.restore.RestoreHandler.restoreSubCollectionEntry(RestoreHandler.java:255) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.backup.restore.RestoreHandler.startElement(RestoreHandler.java:128) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.apache.xerces.parsers.AbstractSAXParser.startElement(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.AbstractXMLDocumentParser.emptyElement(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.impl.XMLNSDocumentScannerImpl.scanStartElement(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl$FragmentContentDispatcher.dispatch(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.impl.XMLDocumentFragmentScannerImpl.scanDocument(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.XMLParser.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source) ~[xercesImpl-2.11.0.jar:?]\r\n\tat org.exist.backup.Restore.restore(Restore.java:87) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat org.exist.client.ClientFrame.lambda$doRestore$17(ClientFrame.java:1143) ~[exist.jar:3.2.0-SNAPSHOT]\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_121]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_121]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_121]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_121]\r\n2017-03-27 09:10:40,008 [pool-3-thread-1] INFO  (NativeBroker.java [removeXMLResource]:2707) - Removing document eXide.xml (540) ... \r\n2017-03-27 09:10:40,011 [pool-3-thread-1] ERROR (SecurityManagerImpl.java [processPramatter]:930) - Group 'eXide' pressent at 'exist' realm, but get event that new one created. \r\n2017-03-27 09:10:40,034 [pool-3-thread-1] INFO  (NativeBroker.java [removeXMLResource]:2707) - Removing document monex.xml (742) ... \r\n2017-03-27 09:10:40,036 [pool-3-thread-1] ERROR (SecurityManagerImpl.java [processPramatter]:930) - Group 'monex' pressent at 'exist' realm, but get event that new one created. \r\n2017-03-27 09:10:40,051 [pool-3-thread-1] INFO  (NativeBroker.java [removeXMLResource]:2707) - Removing document collection.xconf (1) ... \r\n2017-03-27 09:10:40,085 [pool-3-thread-1] WARN  (TransactionManager.java [close]:186) - Transaction was not committed or aborted, auto aborting! \r\n```\r\n\r\n### What did you expect\r\n\r\nThe restore of a backup must be without any exceptions. I can provide the file upon request, offline.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nRestore a backup containing an older version of the eXide application.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db 3.2.0-SNAPSHOT (2017-03-17)\r\n- Java version (Java8u121)\r\n- Operating system (Windows 7)\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml : None\r\n", "url": "https://github.com/eXist-db/exist/issues/1384", "user": "dizzzz", "labels": ["awaiting-response", "bug"], "created": "2017-03-27 08:28:19", "closed": "2019-08-14 18:08:25", "commits": {}, "ttf": 870.0002777777778, "commitsDetails": []}, {"title": "EXPath Repo creates static absolute path properties", "body": "\r\n### What is the problem\r\nWhen installing a package, the repo system stores information in classpath.txt that contains absolut pathes from the filesystem. this makes it hard to move an instance from one location to another (same machine, or from local to server, when pathes are different).\r\nsee for example:\r\n`webapp/WEB-INF/data/fs/db/apps/monex/.exist/classpath.txt`\r\n`webapp/WEB-INF/data/expathrepo/monex-0.9.7/.exist/classpath.txt`\r\n\r\n### What did you expect\r\nI belive that i was able to move instances by copypasting or moving the folder in previous versions.\r\n\r\n### Describe how to reproduce or add a test\r\nstart exist the first time with monex and a package that imports console in the autodeploy folder.\r\nstop exist.\r\nmove the folder with for example `mv exist exist-moved`\r\nstart exist again\r\nmonex and console are not working and so the package with the dependency doesnt.\r\n\r\nyou can try it by calling `ant sade-dist-build` from https://gitlab.gwdg.de/fontane-notizbuecher/SADE.git develop branch\r\nafter the build task is completed \r\n`mv ./dist-build/antbuild/build/sade ./dist-build/antbuild/build/sade2\r\n./dist-build/antbuild/build/sade2/bin/startup.sh`\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version 3.1.1\r\n- openjdk version \"1.8.0_121\"\r\n- OpenJDK Runtime Environment (build 1.8.0_121-8u121-b13-0ubuntu1.16.04.2-b13)\r\n- OpenJDK 64-Bit Server VM (build 25.121-b13, mixed mode)\r\n- ubuntu\r\n- 64 bit\r\n", "url": "https://github.com/eXist-db/exist/issues/1382", "user": "mathias-goebel", "labels": ["bug"], "created": "2017-03-24 13:37:18", "closed": "2020-04-08 11:26:51", "commits": {}, "ttf": 1110.0002777777777, "commitsDetails": []}, {"title": "doc-available() should return false(), not an error, when encountering parsing errors", "body": "### What is the problem\r\n\r\nThe `fn:doc-available()` function is returning en error when the URI contains non-well-formed XML.\r\n\r\n### What did you expect\r\n\r\nThe `fn:doc-available()` function should return `false()` when the URI cannot return a document node. See https://www.w3.org/TR/xpath-functions-31/#func-doc-available. \r\n\r\n### Describe how to reproduce or add a test\r\n\r\nThe following query:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nfn:doc-available(\"https://www.kingjamesbibleonline.org/Genesis-Chapter-1_Original-1611-KJV/\")\r\n```\r\n\r\n... returns the following error:\r\n\r\n> err:FODC0005 An error occurred while parsing https://www.kingjamesbibleonline.org/Genesis-Chapter-1_Original-1611-KJV/: Open quote is expected for attribute \"lang\" associated with an element type \"html\". [source: xquery version \"3.1\"; fn:doc-available(\"https://www.kingjamesbibleonline.org/Genesis-Chapter-1_Original-1611-KJV/\")]\r\n\r\nSaxon and BaseX both return `false()`. QT3's tests for this function (https://dev.w3.org/cvsweb/2011/QT3-test-suite/fn/doc-available.xml?rev=1.9;content-type=text%2Fx-cvsweb-markup) don't seem to include a test for this possibility, but I believe the expected behavior is clear enough from the spec.\r\n\r\n### Context information\r\n\r\n- eXist-db version: 3.1.0\r\n- Java version: 1.8.0_121-b13\r\n- Operating system: macOS\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml: no\r\n", "url": "https://github.com/eXist-db/exist/issues/1364", "user": "joewiz", "labels": ["bug"], "created": "2017-03-19 19:24:02", "closed": "2017-11-27 10:25:37", "commits": {}, "ttf": 252.00027777777777, "commitsDetails": []}, {"title": "Unexpected error \"function argument placeholder not expanded\" with arrow operator", "body": "### What is the problem\r\n\r\nAn unexpected error is raised when using the arrow operator:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\n\"hello\" => replace(\"llo\", \"y\")\r\n```\r\n\r\nThe error (in eXide):\r\n\r\n> exerr:EXXQDY0001 Internal error: function argument placeholder not expanded. [source: xquery version \"3.1\"; \"hello\" => replace(\"llo\", \"y\")] In function: replace(xs:string?, xs:string, xs:string) [-1:-1:String]\r\n\r\n### What did you expect\r\n\r\nI expected the result `hey` - the result of the equivalent expression `replace(\"hello\", \"llo\", \"y\")`.\r\n\r\nSee https://www.w3.org/TR/xquery-31/#id-arrow-operator.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nSee above. I also tested in BaseX, which returns the expected result, `hey`.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version: 3.1.0\r\n- Java version: 1.8.0_121-b13\r\n- Operating system: macOS 10.12.3\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml: no\r\n", "url": "https://github.com/eXist-db/exist/issues/1357", "user": "joewiz", "labels": ["bug"], "created": "2017-03-16 17:12:47", "closed": "2017-05-25 21:00:51", "commits": {}, "ttf": 70.00027777777778, "commitsDetails": []}, {"title": "error in XFormsFilter blocks deployment of eXist WAR in Tomcat-8.5", "body": "### What is the problem\r\nDeploying an eXist-3.1.0 WAR build in Tomcat-8.5 fails due to errors caused by the XFormsFilter filter. Following errors are being reported:\r\n\r\n    14-Mar-2017 14:26:53.792 SEVERE [localhost-startStop-1] org.apache.catalina.core.StandardContext.filterStart Exception starting filter XFormsFilter\r\n     javax.servlet.ServletException: de.betterform.xml.config.XFormsConfigException: javax.xml.transform.TransformerException: javax.xml.transform.TransformerConfigurationException: net.sf.saxon.s9api.SaxonApiException: I/O error reported by XML parser processing file:/F:/ctb/CTB_webapps/CTBapps_dev/active/exist-3.1.0/WEB-INF/classes/META-INF/resources/xhtml.xsl: F:\\tomcat-8.5.12\\webapps\\exist-3.1.0\\WEB-INF\\classes\\META-INF\\resources\\xhtml.xsl (The system cannot find the path specified)\r\n      at de.betterform.agent.web.filter.XFormsFilter.init(XFormsFilter.java:76)\r\n      at org.apache.catalina.core.ApplicationFilterConfig.initFilter(ApplicationFilterConfig.java:279)\r\n      at org.apache.catalina.core.ApplicationFilterConfig.getFilter(ApplicationFilterConfig.java:260)\r\n      at org.apache.catalina.core.ApplicationFilterConfig.<init>(ApplicationFilterConfig.java:105)\r\n      at org.apache.catalina.core.StandardContext.filterStart(StandardContext.java:4599)\r\n      at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5242)\r\n      at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)\r\n      at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:752)\r\n      at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:728)\r\n      at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:734)\r\n      at org.apache.catalina.startup.HostConfig.deployDirectory(HostConfig.java:1107)\r\n      at org.apache.catalina.startup.HostConfig$DeployDirectory.run(HostConfig.java:1841)\r\n      at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n      at java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n      at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n      at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n      at java.lang.Thread.run(Thread.java:745)\r\n    Caused by: de.betterform.xml.config.XFormsConfigException: javax.xml.transform.TransformerException: javax.xml.transform.TransformerConfigurationException: net.sf.saxon.s9api.SaxonApiException: I/O error reported by XML parser processing file:/F:/ctb/CTB_webapps/CTBapps_dev/active/exist-3.1.0/WEB-INF/classes/META-INF/resources/xhtml.xsl: F:\\tomcat-8.5.12\\webapps\\exist-3.1.0\\WEB-INF\\classes\\META-INF\\resources\\xhtml.xsl (The system cannot find the path specified)\r\n      at de.betterform.agent.web.WebFactory.initTransformerService(WebFactory.java:206)\r\n      at de.betterform.agent.web.filter.XFormsFilter.init(XFormsFilter.java:72)\r\n      ... 16 more\r\n    Caused by: javax.xml.transform.TransformerException: javax.xml.transform.TransformerConfigurationException: net.sf.saxon.s9api.SaxonApiException: I/O error reported by XML parser processing file:/F:/ctb/CTB_webapps/CTBapps_dev/active/exist-3.1.0/WEB-INF/classes/META-INF/resources/xhtml.xsl: F:\\tomcat-8.5.12\\webapps\\exist-3.1.0\\WEB-INF\\classes\\META-INF\\resources\\xhtml.xsl (The system cannot find the path specified)\r\n      at de.betterform.xml.xslt.impl.CachingTransformerService.getTransformer(CachingTransformerService.java:156)\r\n      at de.betterform.agent.web.WebFactory.initTransformerService(WebFactory.java:188)\r\n      ... 17 more\r\n    Caused by: javax.xml.transform.TransformerConfigurationException: net.sf.saxon.s9api.SaxonApiException: I/O error reported by XML parser processing file:/F:/ctb/CTB_webapps/CTBapps_dev/active/exist-3.1.0/WEB-INF/classes/META-INF/resources/xhtml.xsl: F:\\tomcat-8.5.12\\webapps\\exist-3.1.0\\WEB-INF\\classes\\META-INF\\resources\\xhtml.xsl (The system cannot find the path specified)\r\n      at net.sf.saxon.jaxp.SaxonTransformerFactory.newTemplates(SaxonTransformerFactory.java:155)\r\n      at de.betterform.xml.xslt.impl.CachingTransformerService.getTransformer(CachingTransformerService.java:150)\r\n      ... 18 more\r\n    Caused by: net.sf.saxon.s9api.SaxonApiException: I/O error reported by XML parser processing file:/F:/ctb/CTB_webapps/CTBapps_dev/active/exist-3.1.0/WEB-INF/classes/META-INF/resources/xhtml.xsl: F:\\tomcat-8.5.12\\webapps\\exist-3.1.0\\WEB-INF\\classes\\META-INF\\resources\\xhtml.xsl (The system cannot find the path specified)\r\n      at net.sf.saxon.s9api.XsltCompiler.compile(XsltCompiler.java:546)\r\n      at net.sf.saxon.jaxp.SaxonTransformerFactory.newTemplates(SaxonTransformerFactory.java:152)\r\n      ... 19 more\r\n    Caused by: net.sf.saxon.trans.XPathException: I/O error reported by XML parser processing file:/F:/ctb/CTB_webapps/CTBapps_dev/active/exist-3.1.0/WEB-INF/classes/META-INF/resources/xhtml.xsl: F:\\tomcat-8.5.12\\webapps\\exist-3.1.0\\WEB-INF\\classes\\META-INF\\resources\\xhtml.xsl (The system cannot find the path specified)\r\n      at net.sf.saxon.event.Sender.sendSAXSource(Sender.java:467)\r\n      at net.sf.saxon.event.Sender.send(Sender.java:171)\r\n      at net.sf.saxon.style.StylesheetModule.loadStylesheetModule(StylesheetModule.java:128)\r\n      at net.sf.saxon.style.Compilation.compilePackage(Compilation.java:131)\r\n      at net.sf.saxon.style.Compilation.compileSingletonPackage(Compilation.java:94)\r\n      at net.sf.saxon.s9api.XsltCompiler.compile(XsltCompiler.java:543)\r\n      ... 20 more\r\n    Caused by: java.io.FileNotFoundException: F:\\tomcat-8.5.12\\webapps\\exist-3.1.0\\WEB-INF\\classes\\META-INF\\resources\\xhtml.xsl (The system cannot find the path specified)\r\n      at java.io.FileInputStream.open0(Native Method)\r\n      at java.io.FileInputStream.open(FileInputStream.java:195)\r\n      at java.io.FileInputStream.<init>(FileInputStream.java:138)\r\n      at java.io.FileInputStream.<init>(FileInputStream.java:93)\r\n      at sun.net.www.protocol.file.FileURLConnection.connect(FileURLConnection.java:90)\r\n      at sun.net.www.protocol.file.FileURLConnection.getInputStream(FileURLConnection.java:188)\r\n      at org.apache.xerces.impl.XMLEntityManager.setupCurrentEntity(Unknown Source)\r\n      at org.apache.xerces.impl.XMLVersionDetector.determineDocVersion(Unknown Source)\r\n      at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\r\n      at org.apache.xerces.parsers.XML11Configuration.parse(Unknown Source)\r\n      at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)\r\n      at org.apache.xerces.parsers.AbstractSAXParser.parse(Unknown Source)\r\n      at org.apache.xerces.jaxp.SAXParserImpl$JAXPSAXParser.parse(Unknown Source)\r\n      at net.sf.saxon.event.Sender.sendSAXSource(Sender.java:440)\r\n      ... 25 more\r\n\r\nI'm not sure if this missing file at `\\WEB-INF\\classes\\META-INF\\resources\\xhtml.xsl` is the root of the error, but initialization of the eXist-3.1.0 WAR file is stopped, and eXist is not accessible in Tomcat.\r\n\r\nYet, when the `XFormsFilter` sections are commented out in `web.xml`, eXist is deployed correctly. Hence, the problem most likely lies with XFormsFilter.\r\n\r\n### What did you expect\r\nDeployment without errors of the eXist WAR file in Tomcat.\r\n\r\n### Describe how to reproduce or add a test\r\n1. create an eXist WAR build on a fresh 3.1.0 installation by the `build dist-war` command\r\n2. unpack the generated .war file in an `exist-3.1.0` folder inside the `webapps` folder of Tomcat-8.5.12\r\n3. start Tomcat-8.5.12\r\n\r\n### Context information\r\n- eXist-db version: 3.1.0 /  c679cd8\r\n- Java version:  jdk1.8.0_112\r\n- Operating system: Windows 7 Professional\r\n- 64 bit\r\n- Tomcat-8.5.12\r\n", "url": "https://github.com/eXist-db/exist/issues/1352", "user": "rvdb", "labels": ["bug"], "created": "2017-03-14 13:52:01", "closed": "2018-06-08 17:51:55", "commits": {}, "ttf": 451.0002777777778, "commitsDetails": []}, {"title": "Git branch incorrectly recorded for tags (release builds)", "body": "This applies equally to:\r\n\r\n1. `scm.branch` field in `$EXIST_HOME/version.txt`\r\n2. `git-branch` property in `org/exist/system.properties` in builds.\r\n3. `Build-Tag` attribute in `META-INF/MANIFEST.MF` files of compiled jar and war files.\r\n\r\nWhen building from a branch, the branch name is correctly recorded, e.g. after building from the `develop` branch the `version.txt` file looks like:\r\n\r\n```\r\n#eXist build info\r\nproject.version=3.2.0-SNAPSHOT\r\nproject.built=20170308153559\r\nscm.branch=develop\r\nscm.revision=f713fde\r\n```\r\n\r\nHowever, when building from a tag the branch name is recorded as `HEAD`, e.g. after building from the `eXist-3.1.0` tag the `version.txt` file looks like:\r\n\r\n```\r\n#eXist build info\r\nproject.version=3.1.0\r\nproject.built=20170308154049\r\nscm.branch=HEAD\r\nscm.revision=c679cd8\r\n```\r\n\r\nThe `scm.branch` should likely instead be recorded as `tags/eXist-3.1.0`.\r\nThis is probably minor and we could fix it in a near future release.", "url": "https://github.com/eXist-db/exist/issues/1336", "user": "adamretter", "labels": ["bug"], "created": "2017-03-08 15:44:18", "closed": "2017-03-20 17:43:30", "commits": {}, "ttf": 12.000277777777777, "commitsDetails": []}, {"title": "Missing jar for install as service on Linux (systemV)", "body": "When installing as a systemV-init service, the [wrapper configuration file](https://github.com/eXist-db/exist/blob/develop/tools/yajsw/conf/wrapper.conf.in#L218) uses groovy scripting but the interpreter is not available:\r\n\r\n```\r\nXXX $ tools/yajsw/bin/installDaemon.sh\r\n...\r\n************* INSTALLING eXist-db ***********************\r\n\r\nMar 06, 2017 4:03:56 PM org.rzo.yajsw.os.posix.PosixService getPid\r\nINFO: wrapper pid file: /run/wrapper.eXist-db.pid\r\nMar 06, 2017 4:03:56 PM org.rzo.yajsw.os.posix.PosixService stop\r\nINFO: Stopping eXist-db ...\r\nINFO: lib not found: XXX/tools/yajsw/lib/extended/groovy/groovy-patch.jar\r\nINFO: lib not found: XXX/tools/yajsw/lib/extended/groovy/groovy-all-2.3.11.jar\r\nINFO: lib not found: XXX/tools/yajsw/lib/extended/commons/commons-httpclient-3.0.1.jar\r\n...\r\nMar 06, 2017 4:03:58 PM org.rzo.yajsw.os.posix.PosixService install\r\nINFO: error on creating script link ${if (new File('/etc/rc0.d').exists()) return '/etc/rc4.d' else return '/etc/init.d/rcX.d'}/S20eXist-db\r\nMar 06, 2017 4:03:58 PM org.rzo.yajsw.os.posix.PosixService install\r\nINFO: error on creating script link ${if (new File('/etc/rc0.d').exists()) return '/etc/rc2.d' else return '/etc/init.d/rcX.d'}/S20eXist-db\r\nMar 06, 2017 4:03:58 PM org.rzo.yajsw.os.posix.PosixService install\r\n...\r\n```\r\n\r\nAdding the `groovy-all-2.3.11.jar` and `groovy-patch.jar` from the [YAJSW](http://yajsw.sourceforge.net) distribution version 12.08  to `tools/yajsw/lib/extended/groovy/` solved the problem.\r\n\r\neXist-db 3.0.0 on Ubuntu 16.04.2 LTS", "url": "https://github.com/eXist-db/exist/issues/1331", "user": "ptrckb", "labels": ["bug"], "created": "2017-03-07 11:05:04", "closed": "2017-03-20 17:22:02", "commits": {}, "ttf": 13.000277777777777, "commitsDetails": []}, {"title": "Problem with string constructor interpolations surrounded by quotes", "body": "### What is the problem\r\n\r\nSupport for XQuery 3.1 string constructors (https://www.w3.org/TR/xquery-31/#id-string-constructors) was added in https://github.com/eXist-db/exist/pull/1297. Running the current develop branch, I get an error when surrounding an interpolation with quotes.\r\n\r\n### What did you expect\r\n\r\nNo error with the following code:\r\n\r\n### How to reproduce or add a test\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nlet $a := \"my\"\r\nreturn\r\n    ``[Hello \"`{$a}`\" world!]``\r\n```\r\n\r\nor as an xqsuite test:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace sc=\"http://exist-db.org/xquery/test/string-constructor\";\r\n\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare\r\n    %test:assertEquals('Hello \"my\" world!')\r\nfunction sc:simple-interpolation-surrounded-by-quotes() {\r\n    let $a := \"my\"\r\n    return\r\n        ``[Hello \"`{$a}`\" world!]``\r\n};\r\n```\r\n\r\nThis yields the error:\r\n\r\n```\r\nCannot compile xquery: exerr:ERROR expecting '\"', found '<EOF>' [at line 12, column 39] \r\n```\r\n\r\nBaseX 8.6 and Saxon 9.7.0.4 return the expected results: `Hello \"my\" world!`\r\n\r\n### Context information\r\n\r\n- eXist-db version: eXist-db 3.0 develop \r\n- Java version: Java 1.8.0_121-b13\r\n- Operating system: macOS\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml: no\r\n", "url": "https://github.com/eXist-db/exist/issues/1317", "user": "joewiz", "labels": ["bug"], "created": "2017-03-03 16:56:41", "closed": "2017-03-04 14:26:41", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "calls to doc() in an XSLTSerlvet context executed within the database throw URIResolver errors", "body": "### What is the problem\r\nWhen called in an XSLT stylesheet, which is executed via XSLTServlet within the database, the `doc()` function fails with following error:\r\n\r\n    SAX exception while transforming node: Exception thrown by URIResolver\r\n\r\nYet, the URI does resolve, and the same XSLT stylesheet is working without errors when called with the `transform:transform()` function, and when executed via XSLTServlet on the file system.\r\n\r\nMoreover, **execution order** seems to matter (see below).\r\n\r\n### What did you expect\r\n\r\nIn the sample app (see below), I'd expect the call to `doc('http://localhost:8080/exist/apps/doc-test/test.xml')` to be resolved properly, and to get following output from the simple XSLT stylesheet, irrespective of the execution context / order: \r\n\r\n    <xslt-output><h1>doc() has succeeded!</h1></xslt-output>\r\n\r\n### Describe how to reproduce or add a test\r\nThe zip file attached [doc-test.zip](https://github.com/eXist-db/exist/files/814514/doc-test.zip) contains a sample web application demonstrating the problem, which can be reproduced by following steps:\r\n\r\n1. install the `doc-test-0.1.xar` file in the database\r\n2. navigate to http://localhost:8080/exist/apps/doc-test/test-XSLTServlet/\r\n\r\nThis will cause an HTTP ERROR 500, stating that \r\n\r\n> An error occurred: SAX exception while transforming node: Exception thrown by URIResolver\r\n\r\nAdditional remarks: \r\n\r\n#### 1. execution context matters\r\nThe error only occurs when the XSLT transformation is executed via XSLTServlet within the database.\r\n\r\n- If the same XSLT transformation is executed via the `transform:transform()`  function in an XQuery script stored in the database, it succeeds without errors. See http://localhost:8080/exist/apps/doc-test/test-transform/ for an example.\r\n- If the same XSLT transformation is executed via XSLTServlet on the file system, it succeeds without errors. See http://localhost:8080/exist/doc-test/test-XSLTServlet/ for an example (this requires that the zip file is extracted in the `${exist.home}/webapps/` directory.\r\n\r\n#### 2. execution order matters\r\nThe error occurs when the XSLT transformation is executed via XSLTServlet within the database, but once the same transformation is executed via the `transform:transform()`  function in an XQuery script stored in the database, subsequent executions via XSLTServlet succeed without errors. See following steps:\r\n\r\n1. Execute via XSLTServlet: http://localhost:8080/exist/doc-test/test-XSLTServlet/ --> error\r\n2. Execute via `transform:transform()`: http://localhost:8080/exist/apps/doc-test/test-transform/ --> success\r\n3. Execute via XSLTServlet: http://localhost:8080/exist/doc-test/test-XSLTServlet/ --> **success**\r\n\r\nSince this error doesn't occur in eXist-3.0.RC1 (nor in eXist-3.0.RC2, although that version is giving me troubles with local paths to `doc()` that I couldn't reproduce, unfortunately), I suspect that it might be related to the issues that have been addressed recently in https://github.com/eXist-db/exist/pull/1221.\r\n\r\n### Context information\r\n- eXist-db version: 3.0 /  acd0c14\r\n- Java: 1.8.0_112\r\n- Operating system: Windows 7\r\n- 64 bit\r\n- No custom changes\r\n", "url": "https://github.com/eXist-db/exist/issues/1312", "user": "rvdb", "labels": ["bug"], "created": "2017-03-02 17:17:52", "closed": "2017-06-05 19:04:27", "commits": {}, "ttf": 95.00027777777778, "commitsDetails": []}, {"title": "Non-standard behavior in sibling axes", "body": "### What is the problem\r\n\r\nThe axes `preceding-sibling` and `following-sibling` should be empty on an attribute nodes. Instead, an array index out of bounds exception is thrown:\r\n\r\n```xquery\r\nlet $d := <a b=\"c\"/>\r\nreturn empty($d/@b/preceding-sibling::*)\r\n```\r\n\r\n### What did you expect\r\n\r\n`true` should be returned (see https://www.w3.org/TR/xpath/#axes). Instead, the following exception is thrown:\r\n\r\n<pre>\r\njava.lang.ArrayIndexOutOfBoundsException: -1\r\n\tat org.exist.dom.memtree.DocumentImpl.getFirstChildFor(DocumentImpl.java:630) ~[exist.jar:?]\r\n\tat org.exist.dom.memtree.NodeImpl.selectPrecedingSiblings(NodeImpl.java:787) ~[exist.jar:?]\r\n\tat org.exist.xquery.value.ValueSequence.getPrecedingSiblings(ValueSequence.java:630) ~[exist.jar:?]\r\n\tat org.exist.xquery.LocationStep.getSiblings(LocationStep.java:875) ~[exist.jar:?]\r\n\tat org.exist.xquery.LocationStep.eval(LocationStep.java:450) ~[exist.jar:?]\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:269) ~[exist.jar:?]\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58) ~[exist.jar:?]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:?]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:?]\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:?]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:?]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:253) ~[exist.jar:?]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:185) ~[exist.jar:?]\r\n\tat org.exist.http.servlets.XQueryServlet.process(XQueryServlet.java:470) [exist-optional.jar:?]\r\n\tat org.exist.http.servlets.XQueryServlet.doPost(XQueryServlet.java:191) [exist-optional.jar:?]\r\n...\r\n</pre>\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nExecute the query in eXide\r\n\r\n### Context information\r\n\r\n- eXist-db version 3.0 / develop-acd0c14\r\n- java version \"1.8.0_91\"\r\n- MacOs\r\n- 64 bit\r\n- No custom changes\r\n", "url": "https://github.com/eXist-db/exist/issues/1301", "user": "opax", "labels": ["bug"], "created": "2017-02-28 13:24:53", "closed": "2018-08-16 19:28:09", "commits": {"ebab1f0b019010cf3136bd9684057a20f79134a3": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 534.0002777777778, "commitsDetails": [{"commitHash": "ebab1f0b019010cf3136bd9684057a20f79134a3", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["8726f21457bc8b2a3360d420a2c04d99de0e5ce4"], "nameRev": "ebab1f0b019010cf3136bd9684057a20f79134a3 tags/eXist-5.1.0~328^2~6", "commitMessage": "[bugfix] Fix an issue with sibling selection on in-memory DOM attributes\nCloses https://github.com/eXist-db/exist/issues/1301\n", "commitDateTime": "2018-08-16 10:43:08", "authoredDateTime": "2018-08-12 12:43:14", "commitGitStats": [{"filePath": "src/org/exist/xquery/value/ValueSequence.java", "insertions": 13, "deletions": 4, "lines": 17}, {"filePath": "test/src/org/exist/xquery/XPathQueryTest.java", "insertions": 21, "deletions": 1, "lines": 22}, {"filePath": "test/src/xquery/positional-nested.xql", "insertions": 96, "deletions": 0, "lines": 96}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ValueSequence.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.value.ValueSequence.getPrecedingSiblings(org.exist.xquery.NodeTest)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.value.ValueSequence.getFollowingSiblings(org.exist.xquery.NodeTest)", "TOT": 4, "UPD": 0, "INS": 3, "MOV": 1, "DEL": 0}]}, {"spoonFilePath": "XPathQueryTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.XPathQueryTest.precedingSiblingAxis_persistent()", "TOT": 5, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.xquery.XPathQueryTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.XPathQueryTest.precedingSiblingAxis_memtree()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.XPathQueryTest.followingSiblingAxis_persistent()", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.XPathQueryTest.followingSiblingAxis_memtree()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["ebab1f0b019010cf3136bd9684057a20f79134a3"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 109, "deletions": 4, "lines": 113, "gitFilesChange": 2}, "spoonStatsSummary": {"TOT": 8, "UPD": 0, "INS": 6, "MOV": 2, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 2}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/xquery/value", "test/src/xquery/positional-nested.xql"], "changesInPackagesSPOON": ["org.exist.xquery.value.ValueSequence.getFollowingSiblings(org.exist.xquery.NodeTest)", "org.exist.xquery.value.ValueSequence.getPrecedingSiblings(org.exist.xquery.NodeTest)"]}, {"title": "webdav.ExistDocument.resourceCopyMove takes wrong Lock for copy", "body": "See https://github.com/eXist-db/exist/blob/develop/extensions/webdav/src/org/exist/webdav/ExistDocument.java#L549\r\n\r\nFor performance reasons, Lock should be READ_LOCK when mode == Mode.COPY.\r\n\r\nSuggest refactor to:\r\n\r\nfinal LockMode srcMode = (mode == Mode.COPY ? LockMode.READ_LOCK : LockMode.WRITE_LOCK);\r\n\r\n...\r\n\r\nsrcCollection = broker.openCollection(srcCollectionUri, srcMode);\r\n\r\n...\r\n\r\nif (srcCollection != null) {\r\n    srcCollection.release(srcMode);\r\n}", "url": "https://github.com/eXist-db/exist/issues/1293", "user": "adamretter", "labels": ["bug", "enhancement"], "created": "2017-02-24 22:59:02", "closed": "2017-03-01 16:35:15", "commits": {"38f3a8626a28b6d929c2744f0d9c79955299ca37": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "38f3a8626a28b6d929c2744f0d9c79955299ca37", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["d29c8d5d4d6a27056ec59e42f63c947434d9f866"], "nameRev": "38f3a8626a28b6d929c2744f0d9c79955299ca37 tags/eXist-3.1.0~14^2~1", "commitMessage": "[bugfix] webdav.ExistDocument#resourceCopyMove should take only a READ_LOCK on the source Collection\n\nCloses https://github.com/eXist-db/exist/issues/1293\n", "commitDateTime": "2017-02-26 10:07:52", "authoredDateTime": "2017-02-25 22:20:39", "commitGitStats": [{"filePath": "extensions/webdav/src/org/exist/webdav/ExistDocument.java", "insertions": 4, "deletions": 3, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ExistDocument.java", "spoonMethods": [{"spoonMethodName": "org.exist.webdav.ExistDocument.resourceCopyMove(org.exist.xmldb.XmldbURI,java.lang.String,org.exist.webdav.Mode)", "TOT": 6, "UPD": 1, "INS": 3, "MOV": 0, "DEL": 2}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["38f3a8626a28b6d929c2744f0d9c79955299ca37"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 4, "deletions": 3, "lines": 7, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 6, "UPD": 1, "INS": 3, "MOV": 0, "DEL": 2, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["extensions/webdav/src/org/exist/webdav"], "changesInPackagesSPOON": ["org.exist.webdav.ExistDocument.resourceCopyMove(org.exist.xmldb.XmldbURI,java.lang.String,org.exist.webdav.Mode)"]}, {"title": "webdav.ExistCollection.resourceCopyMove takes wrong Lock for copy", "body": "See https://github.com/eXist-db/exist/blob/develop/extensions/webdav/src/org/exist/webdav/ExistCollection.java#L457\r\n\r\nFor performance reasons, Lock should be `READ_LOCK` when `mode == Mode.COPY`.\r\n\r\nSuggest refactor to:\r\n```java\r\nfinal LockMode srcMode = (mode == Mode.COPY ? LockMode.READ_LOCK : LockMode.WRITE_LOCK);\r\n\r\n...\r\n\r\nsrcCollection = broker.openCollection(srcCollectionUri, srcMode);\r\n\r\n...\r\n\r\nif (srcCollection != null) {\r\n    srcCollection.release(srcMode);\r\n}\r\n```", "url": "https://github.com/eXist-db/exist/issues/1292", "user": "adamretter", "labels": ["bug", "enhancement"], "created": "2017-02-24 22:55:29", "closed": "2017-03-01 16:35:15", "commits": {"d29c8d5d4d6a27056ec59e42f63c947434d9f866": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "d29c8d5d4d6a27056ec59e42f63c947434d9f866", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["4473f9d3f5e11267fbb4b85b5e64e1208acd9040"], "nameRev": "d29c8d5d4d6a27056ec59e42f63c947434d9f866 tags/eXist-3.1.0~14^2~2", "commitMessage": "[bugfix] webdav.ExistCollection#resourceCopyMove should take only a READ_LOCK on the source Collection\n\nCloses https://github.com/eXist-db/exist/issues/1292\n", "commitDateTime": "2017-02-26 10:07:52", "authoredDateTime": "2017-02-25 22:17:04", "commitGitStats": [{"filePath": "extensions/webdav/src/org/exist/webdav/ExistCollection.java", "insertions": 4, "deletions": 3, "lines": 7}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ExistCollection.java", "spoonMethods": [{"spoonMethodName": "org.exist.webdav.ExistCollection.resourceCopyMove(org.exist.xmldb.XmldbURI,java.lang.String,org.exist.webdav.Mode)", "TOT": 6, "UPD": 1, "INS": 3, "MOV": 0, "DEL": 2}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["d29c8d5d4d6a27056ec59e42f63c947434d9f866"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 4, "deletions": 3, "lines": 7, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 6, "UPD": 1, "INS": 3, "MOV": 0, "DEL": 2, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["extensions/webdav/src/org/exist/webdav"], "changesInPackagesSPOON": ["org.exist.webdav.ExistCollection.resourceCopyMove(org.exist.xmldb.XmldbURI,java.lang.String,org.exist.webdav.Mode)"]}, {"title": "Resource#delete takes the wrong Lock", "body": "See https://github.com/eXist-db/exist/blob/develop/src/org/exist/util/io/Resource.java#L582\r\n\r\nIt should take a `WRITE_LOCK` instead of `NO_LOCK`\r\n", "url": "https://github.com/eXist-db/exist/issues/1291", "user": "adamretter", "labels": ["bug"], "created": "2017-02-24 22:41:10", "closed": "2017-03-01 16:35:14", "commits": {"4473f9d3f5e11267fbb4b85b5e64e1208acd9040": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "4473f9d3f5e11267fbb4b85b5e64e1208acd9040", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["2a1923a461e895eca185961794920b9db00e3159"], "nameRev": "4473f9d3f5e11267fbb4b85b5e64e1208acd9040 tags/eXist-3.1.0~14^2~3", "commitMessage": "[bugfix] Resource#delete should take WRITE_LOCK on Collection when deleting documents\n\nCloses https://github.com/eXist-db/exist/issues/1291\n", "commitDateTime": "2017-02-26 10:04:56", "authoredDateTime": "2017-02-25 18:03:33", "commitGitStats": [{"filePath": "src/org/exist/util/io/Resource.java", "insertions": 5, "deletions": 1, "lines": 6}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Resource.java", "spoonMethods": [{"spoonMethodName": "org.exist.util.io.Resource.delete()", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["4473f9d3f5e11267fbb4b85b5e64e1208acd9040"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 5, "deletions": 1, "lines": 6, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/util/io"], "changesInPackagesSPOON": ["org.exist.util.io.Resource.delete()"]}, {"title": "NativeBroker#getXMLResource takes wrong Lock", "body": "See https://github.com/eXist-db/exist/blob/develop/src/org/exist/storage/NativeBroker.java#L2225\r\n\r\nLikely that the lock on the Collection (**not** the Document) should be `READ_LOCK` and not `lockMode`; Check this!", "url": "https://github.com/eXist-db/exist/issues/1290", "user": "adamretter", "labels": ["bug"], "created": "2017-02-24 22:26:04", "closed": "2017-03-01 16:35:15", "commits": {"16931d258a0a47492c5219713fdf91d59920fc48": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "16931d258a0a47492c5219713fdf91d59920fc48", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["38f3a8626a28b6d929c2744f0d9c79955299ca37"], "nameRev": "16931d258a0a47492c5219713fdf91d59920fc48 tags/eXist-3.1.0~14^2", "commitMessage": "[bugfix] NativeBroker#getXMLResource should take only a READ_LOCK on the Collection\n\nCloses https://github.com/eXist-db/exist/issues/1290\n", "commitDateTime": "2017-02-26 10:07:52", "authoredDateTime": "2017-02-25 22:24:57", "commitGitStats": [{"filePath": "src/org/exist/storage/NativeBroker.java", "insertions": 8, "deletions": 9, "lines": 17}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NativeBroker.java", "spoonMethods": [{"spoonMethodName": "org.exist.storage.NativeBroker.getXMLResource(org.exist.xmldb.XmldbURI,org.exist.storage.lock.Lock.LockMode)", "TOT": 13, "UPD": 1, "INS": 5, "MOV": 2, "DEL": 5}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["16931d258a0a47492c5219713fdf91d59920fc48"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 8, "deletions": 9, "lines": 17, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 13, "UPD": 1, "INS": 5, "MOV": 2, "DEL": 5, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/storage"], "changesInPackagesSPOON": ["org.exist.storage.NativeBroker.getXMLResource(org.exist.xmldb.XmldbURI,org.exist.storage.lock.Lock.LockMode)"]}, {"title": "NativeBroker#doCopyCollection takes wrong Lock", "body": "See https://github.com/eXist-db/exist/blob/develop/src/org/exist/storage/NativeBroker.java#L1190\r\n\r\nLikely that this should be `READ_LOCK` and not `WRITE_LOCK`; Check this!", "url": "https://github.com/eXist-db/exist/issues/1289", "user": "adamretter", "labels": ["bug"], "created": "2017-02-24 22:22:11", "closed": "2017-03-01 16:35:14", "commits": {"2a1923a461e895eca185961794920b9db00e3159": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "2a1923a461e895eca185961794920b9db00e3159", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["bea0bac059cefcdb4cbd3f525c86b278911f8c2f"], "nameRev": "2a1923a461e895eca185961794920b9db00e3159 tags/eXist-3.1.0~14^2~4", "commitMessage": "[bugfix] NativeBroker#doCopyCollection should take READ_LOCK (not WRITE_LOCK) on source sub-collections\n\nCloses https://github.com/eXist-db/exist/issues/1289\n", "commitDateTime": "2017-02-26 10:04:56", "authoredDateTime": "2017-02-25 18:00:21", "commitGitStats": [{"filePath": "src/org/exist/storage/NativeBroker.java", "insertions": 10, "deletions": 7, "lines": 17}], "commitSpoonAstDiffStats": [{"spoonFilePath": "NativeBroker.java", "spoonMethods": [{"spoonMethodName": "org.exist.storage.NativeBroker.doCopyCollection(org.exist.storage.txn.Txn,org.exist.storage.DocumentTrigger,java.util.Collection,java.util.Collection,org.exist.xmldb.XmldbURI,boolean)", "TOT": 11, "UPD": 1, "INS": 2, "MOV": 6, "DEL": 2}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["2a1923a461e895eca185961794920b9db00e3159"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 10, "deletions": 7, "lines": 17, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 11, "UPD": 1, "INS": 2, "MOV": 6, "DEL": 2, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/storage"], "changesInPackagesSPOON": ["org.exist.storage.NativeBroker.doCopyCollection(org.exist.storage.txn.Txn,org.exist.storage.DocumentTrigger,java.util.Collection,java.util.Collection,org.exist.xmldb.XmldbURI,boolean)"]}, {"title": "LargeValuesTest#remove takes wrong Lock", "body": "Takes `READ_LOCK` should be `WRITE_LOCK`", "url": "https://github.com/eXist-db/exist/issues/1288", "user": "adamretter", "labels": ["bug"], "created": "2017-02-24 22:15:53", "closed": "2017-03-01 16:35:14", "commits": {"bea0bac059cefcdb4cbd3f525c86b278911f8c2f": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "bea0bac059cefcdb4cbd3f525c86b278911f8c2f", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["42dc8583583d272eb43be06099fc2eb5601a78a1"], "nameRev": "bea0bac059cefcdb4cbd3f525c86b278911f8c2f tags/eXist-3.1.0~14^2~5", "commitMessage": "[bugfix] LargeValuesTest should take WRITE_LOCK on Collection when removing\n\nCloses https://github.com/eXist-db/exist/issues/1288\n", "commitDateTime": "2017-02-25 22:26:34", "authoredDateTime": "2017-02-25 17:53:40", "commitGitStats": [{"filePath": "test/src/org/exist/storage/LargeValuesTest.java", "insertions": 7, "deletions": 2, "lines": 9}], "commitSpoonAstDiffStats": [{"spoonFilePath": "LargeValuesTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.storage.LargeValuesTest.remove()", "TOT": 13, "UPD": 1, "INS": 2, "MOV": 9, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["bea0bac059cefcdb4cbd3f525c86b278911f8c2f"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "EmbeddedUpload takes wrong Lock", "body": "`EmbeddedUpload` takes a READ_LOCK, but it should take a WRITE_LOCK; Also it releases the lock too early.\r\n\r\nSee https://github.com/eXist-db/exist/blob/develop/src/org/exist/protocolhandler/embedded/EmbeddedUpload.java#L147", "url": "https://github.com/eXist-db/exist/issues/1287", "user": "adamretter", "labels": ["bug"], "created": "2017-02-24 22:08:01", "closed": "2017-03-01 16:35:14", "commits": {"42dc8583583d272eb43be06099fc2eb5601a78a1": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "42dc8583583d272eb43be06099fc2eb5601a78a1", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["c1e281cb8f3a79522a424defbd280adaf54346bd"], "nameRev": "42dc8583583d272eb43be06099fc2eb5601a78a1 tags/eXist-3.1.0~14^2~6", "commitMessage": "[bugfix] EmbeddedUpload should take WRITE_LOCK on Collection when adding a document\n\nCloses https://github.com/eXist-db/exist/issues/1287\n", "commitDateTime": "2017-02-25 17:51:05", "authoredDateTime": "2017-02-25 17:51:05", "commitGitStats": [{"filePath": "src/org/exist/protocolhandler/embedded/EmbeddedUpload.java", "insertions": 9, "deletions": 19, "lines": 28}], "commitSpoonAstDiffStats": [{"spoonFilePath": "EmbeddedUpload.java", "spoonMethods": [{"spoonMethodName": "org.exist.protocolhandler.embedded.EmbeddedUpload.stream(org.exist.protocolhandler.xmldb.XmldbURL,java.io.File,org.exist.security.Subject)", "TOT": 12, "UPD": 1, "INS": 2, "MOV": 3, "DEL": 6}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["42dc8583583d272eb43be06099fc2eb5601a78a1"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 9, "deletions": 19, "lines": 28, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 12, "UPD": 1, "INS": 2, "MOV": 3, "DEL": 6, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/protocolhandler/embedded"], "changesInPackagesSPOON": ["org.exist.protocolhandler.embedded.EmbeddedUpload.stream(org.exist.protocolhandler.xmldb.XmldbURL,java.io.File,org.exist.security.Subject)"]}, {"title": "only one .xconf file per level rule not enforced nor flagged", "body": "As per http://exist-db.org/exist/apps/doc/indexing.xml\r\n\r\n> You can only have one .xconf file at each level.\r\n\r\nPhrasing here suggest this is strict rule, not a guideline, yet no checks are in place or warnings raised when multiple .xconf files are present in a collection. \r\n\r\nIt is unclear if multiple .xconfs are merged and acted upon or some arbitrary one is chosen?", "url": "https://github.com/eXist-db/exist/issues/1282", "user": "tuurma", "labels": ["bug"], "created": "2017-02-24 11:22:38", "closed": "2017-09-29 17:17:12", "commits": {}, "ttf": 217.00027777777777, "commitsDetails": []}, {"title": "The system.properties file causes errors when running from source", "body": "When you run eXist-db from a source code build (command line or IntelliJ), the file `$EXIST_HOME/src/org/exist/system.properties` file is not correctly populated and added to the classpath.\r\n\r\nThe `system.properties` file contains:\r\n```\r\nvendor=eXist-db Project\r\nvendor-url=http://exist-db.org\r\nproduct-name=eXist\r\nproduct-version=@version@\r\nproduct-semver=@semver@\r\nproduct-build=@build@\r\ngit-commit=@git.commit@\r\n```\r\n\r\nUnfortunately this means that features with dependencies on these properties break.\r\nFor example you cannot install packages from the Dashboard's PackageManager, instead you get errors in `exist.log`:\r\n\r\n```\r\n2017-02-23 15:32:47,344 [qtp651992021-119] ERROR (Deploy.java [installAndDeploy]:194) - Invalid SemVer pattern '@semver@': first part is not a number \r\norg.expath.pkg.repo.PackageException: Invalid SemVer pattern '@semver@': first part is not a number\r\n\tat org.expath.pkg.repo.deps.Semver.parseError(Semver.java:214) ~[pkg-java-fork.jar:?]\r\n\tat org.expath.pkg.repo.deps.Semver.parse(Semver.java:183) ~[pkg-java-fork.jar:?]\r\n\tat org.expath.pkg.repo.deps.Semver.<init>(Semver.java:37) ~[pkg-java-fork.jar:?]\r\n\tat org.expath.pkg.repo.deps.DepSemverMinMax.isCompatible(DepSemverMinMax.java:33) ~[pkg-java-fork.jar:?]\r\n\tat org.exist.repo.Deployment.checkProcessorVersion(Deployment.java:291) ~[eXist-db/:?]\r\n\tat org.exist.repo.Deployment.installAndDeploy(Deployment.java:217) ~[eXist-db/:?]\r\n\tat org.exist.repo.Deployment.installAndDeploy(Deployment.java:163) ~[eXist-db/:?]\r\n\tat org.exist.xquery.modules.expathrepo.Deploy.installAndDeploy(Deploy.java:188) [eXist-db/:?]\r\n\tat org.exist.xquery.modules.expathrepo.Deploy.eval(Deploy.java:163) [eXist-db/:?]\r\n\tat org.exist.xquery.BasicFunction.eval(BasicFunction.java:73) [eXist-db/:?]\r\n\tat org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:41) [eXist-db/:?]\r\n```\r\n\r\nA better solution is required...", "url": "https://github.com/eXist-db/exist/issues/1278", "user": "adamretter", "labels": ["bug", "in progress"], "created": "2017-02-23 15:51:40", "closed": "2019-08-14 13:22:59", "commits": {}, "ttf": 901.0002777777778, "commitsDetails": []}, {"title": "\"eXist-db\" app remains running after first install on macOS", "body": "When I first run eXist-db.app using current nightly builds on macOS, the eXist-db icon that appears in my dock doesn't close when I quit eXist via the menu bar.  It seems the only way to get this icon to go away is to control-click on it and select quit.  \r\n\r\nThis is odd, since it's not associated with the eXist-db process. It seems harmless but will certainly confuse users. \r\n\r\nThe \"normal\" behavior I would expect from eXist-db is that the dock icon appears briefly and then disappears after the menu bar icon appears.  \r\n\r\nSince this persistent dock icon only appears once - on first run of a new installation - my hunch is that this is somehow related to something that only happens on first run and not subsequent runs.  But I'm not sure what it is.", "url": "https://github.com/eXist-db/exist/issues/1248", "user": "joewiz", "labels": ["YAJSW", "bug", "regression"], "created": "2017-02-02 15:21:44", "closed": "2019-05-25 09:15:42", "commits": {"fae98f03247672dcc0789600e3942c4336f61219": {"commitGHEventType": "closed", "commitUser": "adamretter"}}, "ttf": 841.0002777777778, "commitsDetails": [{"commitHash": "fae98f03247672dcc0789600e3942c4336f61219", "commitGHEventType": "closed", "commitUser": "adamretter", "commitParents": ["1134c67ed2f846be9b1816274fe15bc40e9746ad"], "nameRev": "fae98f03247672dcc0789600e3942c4336f61219 tags/eXist-5.1.0~169^2~1", "commitMessage": "[bugfix] LauncherWrapper not exiting after first start. Closes #1248\n", "commitDateTime": "2019-05-23 19:16:43", "authoredDateTime": "2019-05-23 19:16:43", "commitGitStats": [{"filePath": "exist-core/src/main/java/org/exist/launcher/ConfigurationDialog.java", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConfigurationDialog.java", "spoonMethods": [{"spoonMethodName": "org.exist.launcher.ConfigurationDialog.open(boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["fae98f03247672dcc0789600e3942c4336f61219"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 3, "deletions": 0, "lines": 3, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["exist-core/src/main/java/org/exist/launcher"], "changesInPackagesSPOON": ["org.exist.launcher.ConfigurationDialog.open(boolean)"]}, {"title": "Null Pointer exception on inspect:inspect-module()", "body": "Following simple query causes a `NullPointerException` in 3.0RC1 under Windows.\r\n\r\nFilename : thisquery.xql\r\n---------------------------------------\r\n```xquery\r\nxquery version \"3.0\";\r\n\r\nimport module namespace inspect = \"http://exist-db.org/xquery/inspection\";\r\n\r\nlet $data := inspect:inspect-module(xs:anyURI(\"xmldb:exist:///db/apps/JonathanTest/thisquery.xql\"))\r\nreturn\r\n  $data\r\n```\r\n\r\nie: it is inspecting itself.\r\n```\r\njava.lang.NullPointerException\r\n\tat org.exist.xquery.XQueryContext.compileOrBorrowModule(XQueryContext.java:2835) ~[exist.jar:?]\r\n\tat org.exist.xquery.XQueryContext.importModule(XQueryContext.java:2748) ~[exist.jar:?]\r\n\tat org.exist.xquery.functions.inspect.InspectModule.eval(InspectModule.java:66) ~[exist.jar:?]\r\n\tat org.exist.xquery.BasicFunction.eval(BasicFunction.java:70) ~[exist.jar:?]\r\n\tat org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:56) ~[exist.jar:?]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:142) ~[exist.jar:?]\r\n\tat org.exist.xquery.BindingExpression.eval(BindingExpression.java:165) ~[exist.jar:?]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:?]\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:267) ~[exist.jar:?]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:?]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:280) ~[exist.jar:?]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:200) ~[exist.jar:?]\r\n\tat org.exist.http.servlets.XQueryServlet.process(XQueryServlet.java:492) [exist-optional.jar:?]\r\n\tat org.exist.http.servlets.XQueryServlet.doPost(XQueryServlet.java:198) [exist-optional.jar:?]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:755) [servlet-api-3.0.jar:?]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:848) [servlet-api-3.0.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:684) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:503) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575) [jetty-security-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:429) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:50) [exist-optional.jar:?]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:557) [exist-optional.jar:?]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:357) [exist-optional.jar:?]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:848) [servlet-api-3.0.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:684) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1496) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat de.betterform.agent.web.filter.XFormsFilter.doFilter(XFormsFilter.java:171) [betterform-exist-5.1-SNAPSHOT-20150603.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1476) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:501) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533) [jetty-security-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:429) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:370) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:494) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:982) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:1043) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:865) [jetty-http-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:240) [jetty-http-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:696) [jetty-io-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:53) [jetty-io-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608) [jetty-util-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543) [jetty-util-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n\tat java.lang.Thread.run(Unknown Source) [?:1.8.0_77]\r\n```\r\n", "url": "https://github.com/eXist-db/exist/issues/1245", "user": "JonathanRowell", "labels": ["bug"], "created": "2017-02-01 15:50:28", "closed": "2017-03-20 19:22:07", "commits": {}, "ttf": 47.000277777777775, "commitsDetails": []}, {"title": " namespace constructor in computed constructor inconsistency", "body": "I stumbled on namespace constructors in Walmsley *xQuery* 2nd ed. p. 167-8 (the output of her example is in *Example 10-9* Results).\r\n\r\n```xquery\r\nxquery version \"3.0\";\r\n\r\ndeclare namespace ok=\"http://place-on-interwebz.com/a-ok\";\r\ndeclare namespace doh=\"http://also-on-interwebz.com/problem\";\r\n\r\nelement root {namespace {\"\"} {\"http://also-on-interwebz.com/problem\"}, \r\n    namespace ok {\"http://place-on-interwebz.com/a-ok\"},\r\n    for $n in 1 to 3\r\n    return\r\n        element stuff {$n}\r\n}\r\n```\r\n\r\noutput:\r\n```xml\r\n<root xmlns:ok=\"http://place-on-interwebz.com/a-ok\">\r\n    <stuff>1</stuff>\r\n    <stuff>2</stuff>\r\n    <stuff>3</stuff>\r\n</root>\r\n```\r\n\r\nexpected:\r\n```xml\r\n<root xmlns=\"http://also-on-interwebz.com/problem\" \r\n    xmlns:ok=\"http://place-on-interwebz.com/a-ok\">\r\n    <stuff>1</stuff>\r\n    <stuff>2</stuff>\r\n    <stuff>3</stuff>\r\n</root\r\n```\r\n\r\nthe empty namespace prefix leads to the whole doh namespace uri part to be ommited. \r\n\r\nTested on eXist 2.2 via eXide and oxygen. Also tested with the ```xmldb:store``` active since there used to be a bug with how namespace appear in eXide's output vs. in stored documents. ", "url": "https://github.com/eXist-db/exist/issues/1237", "user": "duncdrum", "labels": ["bug"], "created": "2017-01-27 08:49:07", "closed": "2017-04-10 19:21:54", "commits": {}, "ttf": 73.00027777777778, "commitsDetails": []}, {"title": "Endless recursion", "body": "on eXistdb 2.2\r\n~~~\r\njava.lang.StackOverflowError\r\n\tjava.lang.reflect.InvocationTargetException.&lt;init&gt;(Unknown Source)\r\n\tsun.reflect.GeneratedMethodAccessor64.invoke(Unknown Source)\r\n\tsun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)\r\n\tjava.lang.reflect.Method.invoke(Unknown Source)\r\n\torg.apache.log4j.spi.LocationInfo.&lt;init&gt;(LocationInfo.java:139)\r\n\torg.apache.log4j.spi.LoggingEvent.getLocationInformation(LoggingEvent.java:253)\r\n\torg.apache.log4j.helpers.PatternParser$LocationPatternConverter.convert(PatternParser.java:500)\r\n\torg.apache.log4j.helpers.PatternConverter.format(PatternConverter.java:65)\r\n\torg.apache.log4j.PatternLayout.format(PatternLayout.java:506)\r\n\torg.apache.log4j.WriterAppender.subAppend(WriterAppender.java:310)\r\n\torg.apache.log4j.RollingFileAppender.subAppend(RollingFileAppender.java:276)\r\n\torg.apache.log4j.WriterAppender.append(WriterAppender.java:162)\r\n\torg.apache.log4j.AppenderSkeleton.doAppend(AppenderSkeleton.java:251)\r\n\torg.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.java:66)\r\n\torg.apache.log4j.Category.callAppenders(Category.java:206)\r\n\torg.apache.log4j.Category.forcedLog(Category.java:391)\r\n\torg.apache.log4j.Category.error(Category.java:305)\r\n\torg.exist.storage.NativeBroker.openCollection(NativeBroker.java:904)\r\n\torg.exist.storage.NativeBroker.openCollection(NativeBroker.java:769)\r\n\torg.exist.collections.Collection.allDocs(Collection.java:483)\r\n\torg.exist.collections.Collection.allDocs(Collection.java:486)\r\n\torg.exist.collections.Collection.allDocs(Collection.java:486)\r\n\torg.exist.collections.Collection.allDocs(Collection.java:486)\r\n\torg.exist.collections.Collection.allDocs(Collection.java:486)\r\n\torg.exist.collections.Collection.allDocs(Collection.java:486)\r\n\torg.exist.collections.Collection.allDocs(Collection.java:486)\r\n...\r\n~~~", "url": "https://github.com/eXist-db/exist/issues/1196", "user": "alebastrov", "labels": ["bug"], "created": "2016-12-12 13:31:07", "closed": "2016-12-12 13:55:03", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "JAR Installer: does not create tools/jetty/tmp directory", "body": "As a result... it is not possible to keep logged in in the dashboard.\r\n\r\n```\r\n2016-11-28 21:45:55,571 [qtp1961685841-47] ERROR (TemporaryFileManager.java [cleanupOldTempFolders]:151) - Unable to delete old temporary folders \r\njava.nio.file.NoSuchFileException: /......./tools/jetty/tmp\r\n\tat sun.nio.fs.UnixException.translateToIOException(UnixException.java:86) ~[?:1.8.0_111]\r\n\tat sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102) ~[?:1.8.0_111]\r\n\tat sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107) ~[?:1.8.0_111]\r\n\tat sun.nio.fs.UnixFileSystemProvider.newDirectoryStream(UnixFileSystemProvider.java:407) ~[?:1.8.0_111]\r\n\tat java.nio.file.Files.newDirectoryStream(Files.java:457) ~[?:1.8.0_111]\r\n\tat java.nio.file.Files.list(Files.java:3451) ~[?:1.8.0_111]\r\n\tat org.exist.util.io.TemporaryFileManager.cleanupOldTempFolders(TemporaryFileManager.java:146) [exist.jar:?]\r\n\tat org.exist.util.io.TemporaryFileManager.<init>(TemporaryFileManager.java:68) [exist.jar:?]\r\n\tat org.exist.util.io.TemporaryFileManager.<clinit>(TemporaryFileManager.java:61) [exist.jar:?]\r\n\tat org.exist.util.io.FileFilterInputStreamCache.<init>(FileFilterInputStreamCache.java:61) [exist.jar:?]\r\n\tat org.exist.util.io.FileFilterInputStreamCache.<init>(FileFilterInputStreamCache.java:55) [exist.jar:?]\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method) ~[?:1.8.0_111]\r\n\tat sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62) [?:1.8.0_111]\r\n\tat sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45) [?:1.8.0_111]\r\n\tat java.lang.reflect.Constructor.newInstance(Constructor.java:423) [?:1.8.0_111]\r\n\tat org.exist.util.io.FilterInputStreamCacheFactory.instantiate(FilterInputStreamCacheFactory.java:72) [exist.jar:?]\r\n\tat org.exist.util.io.FilterInputStreamCacheFactory.getCacheInstance(FilterInputStreamCacheFactory.java:60) [exist.jar:?]\r\n\tat org.exist.xquery.functions.request.GetData.eval(GetData.java:145) [exist-optional.jar:?]\r\n\tat org.exist.xquery.BasicFunction.eval(BasicFunction.java:73) [exist.jar:?]\r\n\tat org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:41) [exist.jar:?]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:99) [exist.jar:?]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) [exist.jar:?]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) [exist.jar:?]\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:276) [exist.jar:?]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) [exist.jar:?]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:253) [exist.jar:?]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:185) [exist.jar:?]\r\n\tat org.exist.http.RESTServer.executeXQuery(RESTServer.java:1506) [exist-optional.jar:?]\r\n\tat org.exist.http.RESTServer.doPost(RESTServer.java:671) [exist-optional.jar:?]\r\n\tat org.exist.http.servlets.EXistServlet.doPost(EXistServlet.java:433) [exist-optional.jar:?]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:707) [servlet-api-3.1.jar:3.1.0]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790) [servlet-api-3.1.jar:3.1.0]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:845) [jetty-servlet-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:583) [jetty-servlet-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:566) [jetty-security-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1174) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511) [jetty-servlet-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1106) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:159) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:74) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:50) [exist-optional.jar:?]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:545) [exist-optional.jar:?]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.applyViews(XQueryURLRewrite.java:410) [exist-optional.jar:?]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:356) [exist-optional.jar:?]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790) [servlet-api-3.1.jar:3.1.0]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:845) [jetty-servlet-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1689) [jetty-servlet-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat de.betterform.agent.web.filter.XFormsFilter.doFilter(XFormsFilter.java:171) [betterform-exist-5.1-SNAPSHOT-20160615.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1668) [jetty-servlet-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:581) [jetty-servlet-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:524) [jetty-security-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:226) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1174) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:511) [jetty-servlet-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:185) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1106) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:213) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:119) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:459) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:134) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:524) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:319) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:253) [jetty-server-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:273) [jetty-io-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:95) [jetty-io-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.io.SelectChannelEndPoint$2.run(SelectChannelEndPoint.java:93) [jetty-io-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.executeProduceConsume(ExecuteProduceConsume.java:303) [jetty-util-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.produceConsume(ExecuteProduceConsume.java:148) [jetty-util-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.util.thread.strategy.ExecuteProduceConsume.run(ExecuteProduceConsume.java:136) [jetty-util-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:671) [jetty-util-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:589) [jetty-util-9.3.9.v20160517.jar:9.3.9.v20160517]\r\n\tat java.lang.Thread.run(Thread.java:745) [?:1.8.0_111]\r\n```", "url": "https://github.com/eXist-db/exist/issues/1187", "user": "dizzzz", "labels": ["bug"], "created": "2016-11-28 20:49:43", "closed": "2016-12-03 15:22:32", "commits": {"ee697fc043e792e4bc56c9ed12a2e5d3bfefc4ab": {"commitGHEventType": "closed", "commitUser": "wolfgangmm"}, "54e5f2680afcebf928317cf3b128d856cb85bcff": {"commitGHEventType": "referenced", "commitUser": "wolfgangmm"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "ee697fc043e792e4bc56c9ed12a2e5d3bfefc4ab", "commitGHEventType": "closed", "commitUser": "wolfgangmm", "commitParents": ["605c4e3f4c2232e42467f6658f8b5e61516c7159"], "nameRev": "ee697fc043e792e4bc56c9ed12a2e5d3bfefc4ab tags/eXist-3.0~35^2", "commitMessage": "Retain temp files and directories. Fixes  #1187\n\nThese must be retained, only (*) is in the installer\n./tools/jetty/tmp/.DO_NOT_DELETE\n./tools/yajsw/tmp/.DO_NOT_DELETE\n./webapp/WEB-INF/data/.DO_NOT_DELETE (*)\n./webapp/WEB-INF/logs/.DO_NOT_DELETE\n", "commitDateTime": "2016-12-03 12:46:06", "authoredDateTime": "2016-12-03 12:46:06", "commitGitStats": [{"filePath": "installer/install.xml.tmpl", "insertions": 8, "deletions": 0, "lines": 8}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "54e5f2680afcebf928317cf3b128d856cb85bcff", "commitGHEventType": "referenced", "commitUser": "wolfgangmm", "commitParents": ["605c4e3f4c2232e42467f6658f8b5e61516c7159", "ee697fc043e792e4bc56c9ed12a2e5d3bfefc4ab"], "nameRev": "54e5f2680afcebf928317cf3b128d856cb85bcff tags/eXist-3.0~35", "commitMessage": "Merge pull request #1189 from dizzzz/bugfix/fix_installer_dirs\n\nRetain temp files and directories. Fixes  #1187", "commitDateTime": "2016-12-03 16:22:29", "authoredDateTime": "2016-12-03 16:22:29", "commitGitStats": [{"filePath": "installer/install.xml.tmpl", "insertions": 8, "deletions": 0, "lines": 8}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["ee697fc043e792e4bc56c9ed12a2e5d3bfefc4ab"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Map operator on array causes XPathException", "body": "The following query should return the sequence `(\"editors\", \"readers\", \"executioners\", \"devs\")` however in eXist it throws an `XPathException` with the message `exerr:ERROR cannot convert map('') to a node set`:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nlet $configs := (\r\n    map {\r\n        \"name\": \"thing1\",\r\n        \"user-groups\": (\r\n            map {\r\n                \"name\": \"editors\",\r\n                \"perm\": \"rwx\"\r\n            },\r\n            map {\r\n                \"name\": \"readers\",\r\n                \"perm\": \"r-x\"\r\n            }\r\n        )\r\n    },\r\n    map {\r\n        \"name\": \"thing2\",\r\n        \"user-groups\": (\r\n            map {\r\n                \"name\": \"executioners\",\r\n                \"perm\": \"r-x\"\r\n            },\r\n            map {\r\n                \"name\": \"devs\",\r\n                \"perm\": \"rwx\"\r\n            }\r\n        )\r\n    }\r\n) return\r\n\r\nfor $config in $configs\r\nlet $user-groups := $config(\"user-groups\")\r\nreturn\r\n\t$user-groups ! .(\"name\")\r\n```", "url": "https://github.com/eXist-db/exist/issues/1186", "user": "adamretter", "labels": ["bug", "duplicate", "xquery"], "created": "2016-11-28 16:51:36", "closed": "2020-04-09 09:12:47", "commits": {}, "ttf": 1227.0002777777777, "commitsDetails": []}, {"title": "ClassCastException with Partial Function Application", "body": "The following XQuery should work, but instead causes a `ClassCastException` in the `XQueryTreeParser`:\r\n```xquery\r\nlet $as-uri := xs:anyURI(?)\r\nreturn\r\n\t$as-uri(\"/db\")\r\n```\r\n\r\n\r\nThe work around for now is to use:\r\n```xquery\r\nlet $as-uri := function($path) { xs:anyURI($path) }\r\nreturn\r\n\t$as-uri(\"/db\")\r\n```\r\n", "url": "https://github.com/eXist-db/exist/issues/1185", "user": "adamretter", "labels": ["bug"], "created": "2016-11-28 16:40:16", "closed": "2017-02-26 13:41:11", "commits": {}, "ttf": 89.00027777777778, "commitsDetails": []}, {"title": "Infinite loop copying 2 xqueries to collection using oxygen.", "body": "This happens when i try to copy (using oxygen developer) 2 .xquery files (both of them import each other).\r\n\r\nHere is the restxq.log:\r\n\r\n```\r\n2016-11-17 14:32:29,515 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery'...\r\n2016-11-17 14:32:32,376 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery'...\r\n2016-11-17 14:32:34,707 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery'...\r\n2016-11-17 14:32:37,531 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery'...\r\n2016-11-17 14:32:39,843 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery'...\r\n2016-11-17 14:32:42,635 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery'...\r\n2016-11-17 14:32:44,909 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery'...\r\n2016-11-17 14:32:47,916 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery'...\r\n2016-11-17 14:32:50,242 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery'...\r\n2016-11-17 14:32:53,051 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery'...\r\n2016-11-17 14:32:55,441 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery'...\r\n2016-11-17 14:32:58,245 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery'...\r\n2016-11-17 14:33:00,508 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery'...\r\n2016-11-17 14:33:03,287 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery'...\r\n2016-11-17 14:33:05,554 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery'...\r\n2016-11-17 14:33:08,378 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery'...\r\n2016-11-17 14:33:10,638 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery'...\r\n2016-11-17 14:33:13,419 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery'...\r\n2016-11-17 14:33:15,874 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery'...\r\n2016-11-17 14:33:18,647 [eXistThread-664] INFO  (ExistXqueryRegistry.java [reexamineModulesWithResolvedDependencies]:287) - Missing dependency '/db/mdm-offer/apps/price-editor/modules/priceList/manage-priceList.xquery' has been added to the database, re-examining '/db/mdm-offer/apps/price-editor/modules/priceList/refresh-priceList.xquery'...\r\n\r\n```\r\n\r\nAnd it goes on and on... i have to shut down exist to then try to recover the db and usually this takes a lot of time....\r\n\r\nIm using exist 2.2 , java version \"1.7.0_72\", <oXygen/> XML Developer 18.0, build 2016051118\r\n\r\n \r\n\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1182", "user": "agucabral21", "labels": ["bug", "duplicate"], "created": "2016-11-18 18:01:25", "closed": "2019-01-10 12:44:24", "commits": {}, "ttf": 782.0002777777778, "commitsDetails": []}, {"title": "Comparison bug with large xs:integer values", "body": "The FLWOR expression fails to order input tuples of xs:integer type and a large value. The output tuples are ordered by just a certain portion of the number digits taken from left.\r\nSteps to reproduce - run this XQuery fragment:\r\n```\r\nlet $data := (\r\n310000000000920000300,\r\n310000000000930001800,\r\n310000000000930003900,\r\n310000000000970000400,\r\n310000000000930002800,\r\n310000000000920000200,\r\n310000000000930001700,\r\n310000000000930004900,\r\n310000000000930003800,\r\n310000000000970000300\r\n    )\r\nfor $i in $data\r\norder by $i \r\nreturn $i\r\n```\r\nThe result run on version 2.2:\r\n\r\n> 310000000000920000300\r\n> 310000000000920000200\r\n> 310000000000930001800\r\n> 310000000000930003900\r\n> 310000000000930002800\r\n> 310000000000930001700\r\n> 310000000000930004900\r\n> 310000000000930003800\r\n> 310000000000970000400\r\n> 310000000000970000300\r\n\r\nWhen the query is changed to:\r\n```\r\nlet $data := (\r\n310000000000920000300,\r\n310000000000930001800,\r\n310000000000930003900,\r\n310000000000970000400,\r\n310000000000930002800,\r\n310000000000920000200,\r\n310000000000930001700,\r\n310000000000930004900,\r\n310000000000930003800,\r\n310000000000970000300\r\n    )\r\nfor $i in $data\r\n(:  order by $i :)\r\norder by $i div 10000000, $i mod 10000000\r\nreturn $i\r\n```\r\nthe result is correct:\r\n> 310000000000920000200\r\n> 310000000000920000300\r\n> 310000000000930001700\r\n> 310000000000930001800\r\n> 310000000000930002800\r\n> 310000000000930003800\r\n> 310000000000930003900\r\n> 310000000000930004900\r\n> 310000000000970000300\r\n> 310000000000970000400\r\n", "url": "https://github.com/eXist-db/exist/issues/1176", "user": "median1st", "labels": ["bug", "xquery"], "created": "2016-11-10 16:14:08", "closed": "2020-05-10 12:41:00", "commits": {}, "ttf": 1276.0002777777777, "commitsDetails": []}, {"title": "Backup failure", "body": "I asked this on exist-open without response ( I should be the only one with this problem??):\r\n- after pulling latest commits on Nov 4 and rebuild my existdb installations are suffering from backup\r\n  failure;  cron and dashboard initiated backups only; cmdln backups with backup.sh are ok.\r\n- tons of error in exist.log: found orphaned document\r\n- the resulting backup is nearly empty (1,7kB). \r\n   NB. The log file in export dir tells nothing about this, the run seems complete\r\n \r\nsame problem with fresh existdb from github source (3.0RC2 develop branch), \r\nonly basic apps, no additional app/data\r\n\r\nregards\r\nPeter\r\n\r\nUbuntu 16.04LTS, java8-111\r\n", "url": "https://github.com/eXist-db/exist/issues/1175", "user": "pherk", "labels": ["bug"], "created": "2016-11-09 15:18:50", "closed": "2017-01-08 11:45:38", "commits": {}, "ttf": 59.000277777777775, "commitsDetails": []}, {"title": "Multiple Modules with the same Target Namespace", "body": "This is not handled by eXist. Only functions in the first location are recognised in the query.\r\nGiven two modules with the same namespace and two functions (test1, test2):\r\n\r\n    import module namespace t = \"http://example.com/test\" at \"test1.xqm\", \"test2.xqm\";\r\n    (t:test1(), t:test2())", "url": "https://github.com/eXist-db/exist/issues/1174", "user": "gspringtech", "labels": ["bug", "xquery"], "created": "2016-11-07 21:23:10", "closed": "2020-04-11 17:55:04", "commits": {}, "ttf": 1250.0002777777777, "commitsDetails": []}, {"title": "log-system-out writes \"raw\" query to std out too", "body": "when `util:log-system-out(\"hahaha\")`  is called from a not-stored-query, also the query itself is printed to standard out, giving a lot of noise.\r\n\r\ne.g. the above yields into \r\n\r\n```\r\n(Line: 1 util:log-system-out(\"hahaha\")) hahaha\r\n```\r\n\r\nwhilst I'd expect\r\n\r\n```\r\n(Line: 1 String) hahaha\r\n```\r\n\r\nthe cause is in org.exist.xquery.AbstractExpression#getSource line 121:\r\n\r\n```java\r\nif(getSource() != null && getSource().getKey() != null) {\r\n  buf.append(\" \");\r\n  buf.append(getSource().getKey());\r\n}\r\n```\r\n\r\nas far as I see `getSource().getKey()` returns the whole query string, which does not make sense to me?\r\n", "url": "https://github.com/eXist-db/exist/issues/1169", "user": "dizzzz", "labels": ["bug"], "created": "2016-11-05 13:45:42", "closed": "2016-11-06 11:21:51", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Lax handling of multiple items in positional predicate", "body": "According to the 3.1 spec, a positional predicate with more than one item should raise err:FORG0006. eXist (current develop branch) raises this error in some cases, but allows the following examples through instead of raising err:FORG0006:\r\n\r\n```xquery\r\n(15 to 25)[5, 6, 7]\r\n(15 to 25)[(5, 6, 7)]\r\n```\r\n\r\nBoth return a sequence of two items: `(19, 20, 21)` instead of raising err:FORG0006. \r\n\r\neXist does raise the correct error when the predicate is expressed as `[5 to 7]` or `[(5 to 7)]`: \r\n\r\n> exerr:ERROR err:FORG0006: effectiveBooleanValue: first item of '(5, 6, 7)' is not a node, and sequence length > 1\r\n\r\nSimilarly:\r\n\r\n```xquery\r\n<node><x/><y/><z/></node>/*[2, 3]\r\n```\r\n\r\nReturns `(<y/>, <z/>)`.\r\n\r\nThe error eXist raises in the case `[2 to 3]` should also perhaps be FORG0006 (?) but instead is this:\r\n\r\n> err:XPTY0004 The first operand must have at most one item\r\n\r\nIf any change is made here, let me also suggest a clearer error message - e.g.,\r\n\r\n> [FORG0006] Effective boolean value not defined for (5, 6, 7)\r\n\r\nThis would be much clearer than `first item of ... is not a node, and sequence length > 1`. The error message seems to point to definitions in the spec but doesn't tell the user what the problem is. The problem is that (5, 6, 7) can't be cast into an effective boolean value. This error has confused me, until I realized what the real issue. ", "url": "https://github.com/eXist-db/exist/issues/1168", "user": "joewiz", "labels": ["bug"], "created": "2016-11-05 03:25:26", "closed": "2020-04-05 18:04:03", "commits": {}, "ttf": 1247.0002777777777, "commitsDetails": []}, {"title": "Typeswitch allows invalid checks", "body": "I would expect the following query to fail, because `empty()` is not a type declaration:\n\n``` xquery\nxquery version \"3.1\";\n\nlet $item := ()\nreturn\n    typeswitch ($item)\n    case empty() return\n        'empty!?'\n    default return\n        'default'\n```\n\neXist allows this through and in fact returns `empty!?`. This is using a current build of the develop branch.\n", "url": "https://github.com/eXist-db/exist/issues/1155", "user": "joewiz", "labels": ["bug"], "created": "2016-10-27 15:13:27", "closed": "2018-01-26 20:14:27", "commits": {"6e321f32bc89ce80d2a339e08db1958adfd26d78": {"commitGHEventType": "closed", "commitUser": "adamretter"}, "780c87aef48aeb2b023c76011a3488dc114bad75": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 456.0002777777778, "commitsDetails": [{"commitHash": "6e321f32bc89ce80d2a339e08db1958adfd26d78", "commitGHEventType": "closed", "commitUser": "adamretter", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "780c87aef48aeb2b023c76011a3488dc114bad75", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["84841c83b7e643e9a5fecb31f5ba05b9b94226c7", "27bdc1876d7780aba5dc96254f7743ac85c5ad43"], "nameRev": "780c87aef48aeb2b023c76011a3488dc114bad75 tags/eXist-4.0.0~14", "commitMessage": "Manual merge of rebased pull request #1319 from shabanovd:bugfix/typeswitch-case-empty\n\nCloses https://github.com/eXist-db/exist/pull/1319\nCloses https://github.com/eXist-db/exist/issues/1155\n", "commitDateTime": "2018-01-26 20:15:52", "authoredDateTime": "2018-01-26 20:15:52", "commitGitStats": [{"filePath": "src/org/exist/xquery/parser/XQuery.g", "insertions": 0, "deletions": 3, "lines": 3}, {"filePath": "src/org/exist/xquery/parser/XQueryLexer.java", "insertions": 179, "deletions": 179, "lines": 358}, {"filePath": "src/org/exist/xquery/parser/XQueryLexer.smap", "insertions": 3824, "deletions": 3824, "lines": 7648}, {"filePath": "src/org/exist/xquery/parser/XQueryParser.java", "insertions": 1272, "deletions": 1215, "lines": 2487}, {"filePath": "src/org/exist/xquery/parser/XQueryParser.smap", "insertions": 9931, "deletions": 9866, "lines": 19797}, {"filePath": "test/src/org/exist/xquery/XQueryTest.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "test/src/xquery/xquery3/typeswitch.xml", "insertions": 29, "deletions": 0, "lines": 29}, {"filePath": "test/src/xquery/xquery3/typeswitch.xql", "insertions": 0, "deletions": 18, "lines": 18}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyChanges"}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 1, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0.0, "deletions": 0.0, "lines": 0.0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "yajsw wrapper does not work on Ubuntu", "body": "When I\u00a0tried to start exist with yajsw I\u00a0got a bunch of errors and exist does not run although the wrapper script seems to start.\n\nThe directory `/tmp/vfs_cache` is needed by the wrapper. So I solved the Java error by creating it.\n\nThe errors caused by the missing libs in `tools/yajsw/lib/extended/` are not important but I\u00a0installed the missing libs from the yajsw sources.\n\nThe next problem is (and still is) the `${env.EXIST_HOME}` environment variable. The system itself echoes the right path with `echo $EXIST_HOME` in any shell. Since I changed that with success the wrapper now does not try to make the folder with the name `${env.EXIST_HOME}` anymore but one with the name `?unresolved?` in the root of `$EXIST_HOME`.\n\nexist is still not running after a successful installation with `./tools/yajsw/bin/installDaemon.sh`; `sudo systemctl daemon-reload` and `sudo systemctl start eXist-db`. systemctl starts the script and echoes success. Nor a direct call with `/etc/init.d/eXist-db start` leaves a running exist.\n\nStarting `bin/startup.sh` in a screen session runs exist without any errors.\n", "url": "https://github.com/eXist-db/exist/issues/1154", "user": "tasmo", "labels": ["YAJSW", "bug"], "created": "2016-10-26 12:57:59", "closed": "2019-10-28 20:01:31", "commits": {}, "ttf": 1097.0002777777777, "commitsDetails": []}, {"title": "eXide does not work (expathrepo issue)", "body": "In current develop (clean clone) I can't open eXide; full logfile is attached, the core of the exception is below; it is a deployment issue.\n\nother apps _can_ be installed from the public-repo; the special part is (probably) that user eXide is created during startup/initialization...\n\nTo reproduce\n- clean repo ( `git clean -fdx` `git reset --hard` etc, warning bla bla)\n- rebuild existdb `./build.sh rebuild`\n- start existdb `bin/startup.sh`\n- check `webapp/WEB-INF/logs/expath-repo.log`\n\n```\n2016-10-20 21:56:51,472 [main] INFO  (Deployment.java [installAndDeploy]:270) - Deploying package http://exist-db.org/apps/eXide \n2016-10-20 21:56:51,522 [main] WARN  (AutoDeploymentTrigger.java [execute]:74) - Exception during deployment of app eXide-2.2.0.xar: Failed to create user: eXide \norg.expath.pkg.repo.PackageException: Failed to create user: eXide\n    at org.exist.repo.Deployment.checkUserSettings(Deployment.java:620) ~[exist.jar:?]\n    at org.exist.repo.Deployment.deploy(Deployment.java:405) ~[exist.jar:?]\n    at org.exist.repo.Deployment.installAndDeploy(Deployment.java:271) ~[exist.jar:?]\n    at org.exist.repo.AutoDeploymentTrigger.execute(AutoDeploymentTrigger.java:72) [exist.jar:?]\n    at org.exist.storage.StartupTriggersManager.startPreMultiUserSystem(StartupTriggersManager.java:58) [exist.jar:?]\n    at org.exist.storage.BrokerPoolServicesManager.startPreMultiUserSystemServices(BrokerPoolServicesManager.java:190) [exist.jar:?]\n    at org.exist.storage.BrokerPool._initialize(BrokerPool.java:631) [exist.jar:?]\n    at org.exist.storage.BrokerPool.initialize(BrokerPool.java:415) [exist.jar:?]\n    at org.exist.storage.BrokerPools.configure(BrokerPools.java:181) [exist.jar:?]\n    at org.exist.storage.BrokerPools.configure(BrokerPools.java:110) [exist.jar:?]\n    at org.exist.jetty.JettyStart.run(JettyStart.java:164) [exist-optional.jar:?]\n    at org.exist.jetty.JettyStart.main(JettyStart.java:78) [exist-optional.jar:?]\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_101]\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_101]\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_101]\n    at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_101]\n    at org.exist.start.Main.invokeMain(Main.java:140) [start.jar:?]\n    at org.exist.start.Main.run(Main.java:453) [start.jar:?]\n    at org.exist.start.Main.main(Main.java:64) [start.jar:?]\nCaused by: org.exist.config.ConfigurationException: org.exist.EXistException: Database instance 'exist' is not available\n    at org.exist.config.ConfigurationImpl.save(ConfigurationImpl.java:429) ~[exist.jar:?]\n    at org.exist.security.internal.SecurityManagerImpl.save(SecurityManagerImpl.java:650) ~[exist.jar:?]\n    at org.exist.security.internal.SecurityManagerImpl.addGroup(SecurityManagerImpl.java:595) ~[exist.jar:?]\n    at org.exist.repo.Deployment.checkUserSettings(Deployment.java:608) ~[exist.jar:?]\n    ... 18 more\nCaused by: java.io.IOException: org.exist.EXistException: Database instance 'exist' is not available\n    at org.exist.config.Configurator.save(Configurator.java:1231) ~[exist.jar:?]\n    at org.exist.config.ConfigurationImpl.save(ConfigurationImpl.java:424) ~[exist.jar:?]\n    at org.exist.security.internal.SecurityManagerImpl.save(SecurityManagerImpl.java:650) ~[exist.jar:?]\n    at org.exist.security.internal.SecurityManagerImpl.addGroup(SecurityManagerImpl.java:595) ~[exist.jar:?]\n    at org.exist.repo.Deployment.checkUserSettings(Deployment.java:608) ~[exist.jar:?]\n    ... 18 more\nCaused by: org.exist.EXistException: Database instance 'exist' is not available\n    at org.exist.storage.BrokerPools.getInstance(BrokerPools.java:260) ~[exist.jar:?]\n    at org.exist.storage.BrokerPools.getInstance(BrokerPools.java:239) ~[exist.jar:?]\n    at org.exist.config.Configurator.save(Configurator.java:1228) ~[exist.jar:?]\n    at org.exist.config.ConfigurationImpl.save(ConfigurationImpl.java:424) ~[exist.jar:?]\n    at org.exist.security.internal.SecurityManagerImpl.save(SecurityManagerImpl.java:650) ~[exist.jar:?]\n    at org.exist.security.internal.SecurityManagerImpl.addGroup(SecurityManagerImpl.java:595) ~[exist.jar:?]\n    at org.exist.repo.Deployment.checkUserSettings(Deployment.java:608) ~[exist.jar:?]\n    ... 18 more\n```\n\n[expath-repo.log.txt](https://github.com/eXist-db/exist/files/542771/expath-repo.log.txt)\n", "url": "https://github.com/eXist-db/exist/issues/1152", "user": "dizzzz", "labels": ["bug"], "created": "2016-10-20 20:09:04", "closed": "2016-10-25 06:10:21", "commits": {"d936857964637cfd556740bd3f18abbc9aa9e24f": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 4.000277777777778, "commitsDetails": [{"commitHash": "d936857964637cfd556740bd3f18abbc9aa9e24f", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["5e38fd7dc166429e9402f663b31ea7fafe751ca0"], "nameRev": "d936857964637cfd556740bd3f18abbc9aa9e24f tags/eXist-3.0~49^2~1", "commitMessage": "[bugfix] addGroup should use the provided broker\nCloses https://github.com/eXist-db/exist/issues/1152\n", "commitDateTime": "2016-10-23 20:50:25", "authoredDateTime": "2016-10-23 19:25:51", "commitGitStats": [{"filePath": "src/org/exist/security/internal/SecurityManagerImpl.java", "insertions": 2, "deletions": 2, "lines": 4}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SecurityManagerImpl.java", "spoonMethods": [{"spoonMethodName": "org.exist.security.internal.SecurityManagerImpl.addGroup(org.exist.storage.DBBroker,org.exist.security.Group)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["d936857964637cfd556740bd3f18abbc9aa9e24f"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2, "deletions": 2, "lines": 4, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/security/internal"], "changesInPackagesSPOON": ["org.exist.security.internal.SecurityManagerImpl.addGroup(org.exist.storage.DBBroker,org.exist.security.Group)"]}, {"title": "Wrapper config can be generated with unset variables eg replaced with property name on a direct repo build", "body": "The work from @ljo 's PR https://github.com/eXist-db/exist/pull/1141 does not yet for macOS:\n(added: same for ubuntu)\n\nDuring startup the directory `tools/yajsw/${env.EXIST_HOME}/` ; the variable does not seem to be substituted?  \n\nstart with\n\n``` bash\n./tools/yajsw/bin/runConsole.sh\n```\n\nIn the attached logfile the following line is relevant:\n\n```\njava.io.FileNotFoundException: ${env.EXIST_HOME}/tools/yajsw/tmp/in_-5209836399611897029$1476732036731 (Permission denied)\n    at java.io.RandomAccessFile.open0(Native Method)\n```\n\n[error.txt](https://github.com/eXist-db/exist/files/534495/error.txt)\n\nsetting EXIST_HOME manually does not fix the issue.\n", "url": "https://github.com/eXist-db/exist/issues/1147", "user": "dizzzz", "labels": ["bug", "high prio", "needs resolution"], "created": "2016-10-17 19:29:39", "closed": "2019-01-11 11:21:43", "commits": {}, "ttf": 815.0002777777778, "commitsDetails": []}, {"title": "Fix wrapper issues", "body": "- Settings chosen on install time, eg max_memory, is not reflected in tools/yajsw/conf/wrapper.conf making the db be run with default memory allocation, currently 1024 MB by the wrapper.\n- No dynamic wrapper.conf settings at all from template wrapper.conf.install were expanded on unix platforms.\n- The wrapper is always running as a privileged user eventhough eXist-db can be run as non-privileged user if specified in tools/yajsw/conf/wrapper.conf.\n- Documentation is still referring to the old service wrapper so clients have problem installing the wrapper at all.\n", "url": "https://github.com/eXist-db/exist/issues/1138", "user": "dizzzz", "labels": ["bug"], "created": "2016-10-03 18:47:15", "closed": "2016-10-13 13:47:33", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "log files are rotated but keep growing", "body": "At an instance we see an interesting pattern in the 'rotated' logfiles: \n\n![l_3c29 tmp](https://cloud.githubusercontent.com/assets/1700062/18542305/7fb1ceae-7b2a-11e6-9770-d26ff69e713c.PNG)\n\nrotation seems to be in place, but the file keeps growing and growing. \n- installed via JAR installer, \n- not running as service \n- Running with Java 1.8.0_101 [Oracle Corporation (Java HotSpot(TM) 64-Bit Server VM) in C:\\Program Files\\Java\\jre1.8.0_101] \n- [eXist Version : 3.0.RC2] \n- [eXist Build : 20160825] \n  - [Git commit : develop-07e86ab] \n- [Operating System : Windows 7 6.1 amd64] \n", "url": "https://github.com/eXist-db/exist/issues/1126", "user": "dizzzz", "labels": ["bug"], "created": "2016-09-15 07:58:49", "closed": "2016-09-15 20:41:30", "commits": {"91493335c76a37adb391517658ba12f2ac799dc3": {"commitGHEventType": "closed", "commitUser": "wolfgangmm"}, "005045fda2ee0df0c3871b12d1b90a79f086ffbc": {"commitGHEventType": "referenced", "commitUser": "wolfgangmm"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "91493335c76a37adb391517658ba12f2ac799dc3", "commitGHEventType": "closed", "commitUser": "wolfgangmm", "commitParents": ["1599c70e0081ad2b4bfae149e449c3fd4076c976"], "nameRev": "91493335c76a37adb391517658ba12f2ac799dc3 tags/eXist-3.0~67^2", "commitMessage": "Upgrade to log4j2 2.6.2 ; fixes #1126\n", "commitDateTime": "2016-09-15 21:05:30", "authoredDateTime": "2016-09-15 21:00:27", "commitGitStats": [{"filePath": ".classpath", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "lib/core/{log4j-api-2.6.1.jar => log4j-api-2.6.2.jar}", "insertions": 0, "deletions": 0, "lines": 0}, {"filePath": "lib/core/{log4j-core-2.6.1.jar => log4j-core-2.6.2.jar}", "insertions": 0, "deletions": 0, "lines": 0}, {"filePath": "lib/core/{log4j-jul-2.6.1.jar => log4j-jul-2.6.2.jar}", "insertions": 0, "deletions": 0, "lines": 0}, {"filePath": "lib/core/{log4j-slf4j-impl-2.6.1.jar => log4j-slf4j-impl-2.6.2.jar}", "insertions": 0, "deletions": 0, "lines": 0}, {"filePath": "lib/user/{log4j-1.2-api-2.6.1.jar => log4j-1.2-api-2.6.2.jar}", "insertions": 0, "deletions": 0, "lines": 0}, {"filePath": "nbproject/project.properties", "insertions": 10, "deletions": 10, "lines": 20}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "005045fda2ee0df0c3871b12d1b90a79f086ffbc", "commitGHEventType": "referenced", "commitUser": "wolfgangmm", "commitParents": ["1599c70e0081ad2b4bfae149e449c3fd4076c976", "91493335c76a37adb391517658ba12f2ac799dc3"], "nameRev": "005045fda2ee0df0c3871b12d1b90a79f086ffbc tags/eXist-3.0~67", "commitMessage": "Merge pull request #1127 from dizzzz/bugfix/upgrade_log4j2\n\nUpgrade to log4j2 2.6.2 ; fixes #1126", "commitDateTime": "2016-09-15 22:41:28", "authoredDateTime": "2016-09-15 22:41:28", "commitGitStats": [{"filePath": ".classpath", "insertions": 4, "deletions": 4, "lines": 8}, {"filePath": "lib/core/{log4j-api-2.6.1.jar => log4j-api-2.6.2.jar}", "insertions": 0, "deletions": 0, "lines": 0}, {"filePath": "lib/core/{log4j-core-2.6.1.jar => log4j-core-2.6.2.jar}", "insertions": 0, "deletions": 0, "lines": 0}, {"filePath": "lib/core/{log4j-jul-2.6.1.jar => log4j-jul-2.6.2.jar}", "insertions": 0, "deletions": 0, "lines": 0}, {"filePath": "lib/core/{log4j-slf4j-impl-2.6.1.jar => log4j-slf4j-impl-2.6.2.jar}", "insertions": 0, "deletions": 0, "lines": 0}, {"filePath": "lib/user/{log4j-1.2-api-2.6.1.jar => log4j-1.2-api-2.6.2.jar}", "insertions": 0, "deletions": 0, "lines": 0}, {"filePath": "nbproject/project.properties", "insertions": 10, "deletions": 10, "lines": 20}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["91493335c76a37adb391517658ba12f2ac799dc3"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 14, "deletions": 14, "lines": 28, "gitFilesChange": 7}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["lib/user/{log4j-1.2-api-2.6.1.jar => log4j-1.2-api-2.6.2.jar}", "lib/core/{log4j-core-2.6.1.jar => log4j-core-2.6.2.jar}", ".classpath", "lib/core/{log4j-api-2.6.1.jar => log4j-api-2.6.2.jar}", "lib/core/{log4j-jul-2.6.1.jar => log4j-jul-2.6.2.jar}", "nbproject/project.properties", "lib/core/{log4j-slf4j-impl-2.6.1.jar => log4j-slf4j-impl-2.6.2.jar}"]}, {"title": "Computed variable is lost in FLOWR", "body": "The following query looses the value of `$avg-overall` in the return clause when constructing XML:\n\n``` xquery\nfor $product in collection(\"/db/products\")/Product\nlet $avg-overall := avg($product/Reviews/Review/Overall)\norder by $avg-overall descending\nreturn\n    <x>{$avg-overall}</x>\n```\n\nreturns the **incorrect** result:\n\n``` xml\n<x/>\n<x/>\n```\n\nHowever, the following query demonstrates that `$avg-overall` does have a value:\n\n``` xquery\nfor $product in collection(\"/db/products\")/Product\nlet $avg-overall := avg($product/Reviews/Review/Overall)\norder by $avg-overall descending\nreturn\n    $avg-overall\n```\n\nwhich returns the result:\n\n``` xml\n5\n5\n```\n\nAn example input document looks like:\n\n``` xml\n<Product>\n  <Reviews>\n    <Review>\n       <Overall>5</Overall>\n   </Review>\n  </Reviews>\n</Product>\n```\n\nThe index configuration looks like:\n\n``` xml\n<collection xmlns=\"http://exist-db.org/collection-config/1.0\">\n   <index>\n        <range>\n            <create qname=\"Overall\" type=\"xs:float\"/>\n        </range>\n   </index>\n</collection>\n```\n", "url": "https://github.com/eXist-db/exist/issues/1125", "user": "adamretter", "labels": ["bug", "high prio", "regression"], "created": "2016-09-14 17:32:51", "closed": "2018-03-06 20:08:34", "commits": {}, "ttf": 538.0002777777778, "commitsDetails": []}, {"title": "Dashboard breaks reverse-proxy", "body": "You can't reverse proxy `/` to `/exist` any longer, as the dashboard will try and incorrectly redirect you to `/exist/apps/dashboard/index.html`. For example with this nginx config:\n\n```\nserver {\n        listen       80;\n        server_name  play.evolvedbinary.com;\n\n        charset utf8;\n\n        proxy_set_header    Host                              $host;\n        proxy_set_header    X-Real-IP                      $remote_addr;\n        proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;\n        proxy_set_header    X-Forwarded-URI        $request_uri;\n\n        location / {\n            proxy_pass http://localhost:8080/exist/;\n        }\n}\n```\n\nWhen you visit `http://play.evolvedbinary.com/` the Dashboard attempts to redirect you to `http://play.evolvedbinary.com/exist/apps/dashboard/index.html`, however for the reverse proxy to work it should be `http://play.evolvedbinary.com/apps/dashboard/index.html`, it seems that the Dashboard incorrectly ignores the `X-Forwarded-URI` header\n", "url": "https://github.com/eXist-db/exist/issues/1122", "user": "adamretter", "labels": ["bug"], "created": "2016-09-13 12:00:21", "closed": "2016-09-13 15:36:21", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "err:XPTY0018 caused by variable declaration", "body": "This simple query returns two items as expected:\n\n``` xquery\ndeclare function local:test() { (1,<n/>) };\nlocal:test()\n```\n\nHowever, simply adding an variable declaration causes a mysterious XPTY0018 error, eg\n\n``` xquery\ndeclare variable $a := 'a';\ndeclare function local:test() { (1,<n/>) };\nlocal:test()\n```\n\nresults in the error message \n\n> \"err:XPTY0018 Cannot mix nodes and atomic values in the result of a path expression. [at line 1, column 24, source:...]\"\n", "url": "https://github.com/eXist-db/exist/issues/1121", "user": "telic", "labels": ["bug"], "created": "2016-09-13 10:30:50", "closed": "2016-10-07 18:02:47", "commits": {}, "ttf": 24.00027777777778, "commitsDetails": []}, {"title": "Incorrect results when using maps and wildcard with lookup operator", "body": "The XQuery 3.1 spec contains an example of an expression involving a map and lookup operator whose key specifier is a wildcard. eXist's result for this query does not conform to the spec. \n\nThe example is described at https://www.w3.org/TR/xquery-31/#id-lookup:\n\n> If `$m` is bound to the weekdays map described in 3.11.1 Maps, then `$m?*` returns the values `(\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\")`, in implementation-dependent order.\n\nIf we construct a query using this [example weekdays map](https://www.w3.org/TR/xquery-31/#id-maps), eXist produces the map's **keys** instead of their values.\n\n**The query:**\n\n``` xquery\nxquery version \"3.1\";\n\nlet $m := \n    map {\n        \"Su\" : \"Sunday\",\n        \"Mo\" : \"Monday\",\n        \"Tu\" : \"Tuesday\",\n        \"We\" : \"Wednesday\",\n        \"Th\" : \"Thursday\",\n        \"Fr\" : \"Friday\",\n        \"Sa\" : \"Saturday\"\n    }\nreturn\n    $m?*\n```\n\n**Expected results:**\n\n``` xquery\n(\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\", \"Thursday\", \"Friday\",\"Saturday\")\n```\n\n**Actual results:** (using eXist develop branch 052c842)\n\n``` xquery\n(\"Tu\", \"Mo\", \"Su\", \"Fr\", \"Sa\", \"We\", \"Th\")\n```\n\nNote that the differing order of the items in the results here is insignificant. The problem I'm reporting is that the spec says the lookup operator whose key specifier is a wildcard, i.e., `?*`, should return **values**, not keys. \n\nI confirmed the spec's behavior is followed by BaseX 8.5.2 and Saxon 9.7.0.4.\n", "url": "https://github.com/eXist-db/exist/issues/1108", "user": "joewiz", "labels": ["bug"], "created": "2016-09-04 23:16:44", "closed": "2016-09-12 11:30:45", "commits": {"cd28110d78a833c7e5e49c61cd8a569854f5458f": {"commitGHEventType": "referenced", "commitUser": "adamretter"}, "cec141c1a1d276f74a37077823dfd432c5a511d8": {"commitGHEventType": "closed", "commitUser": "shabanovd"}}, "ttf": 7.000277777777778, "commitsDetails": [{"commitHash": "cd28110d78a833c7e5e49c61cd8a569854f5458f", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["052c842be33e5f81c4580467c3c68e365f1f1845", "b6860a559c808cc5820fd2f2b6d2edd621744bf8"], "nameRev": "cd28110d78a833c7e5e49c61cd8a569854f5458f tags/eXist-3.0~72", "commitMessage": "Merge pull request #1109 from joewiz/add-lookup-wildcard-map-test\n\nAdd test for #1108 - map wildcard lookup", "commitDateTime": "2016-09-08 11:47:34", "authoredDateTime": "2016-09-08 11:47:34", "commitGitStats": [{"filePath": "test/src/xquery/maps/maps.xql", "insertions": 11, "deletions": 1, "lines": 12}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "cec141c1a1d276f74a37077823dfd432c5a511d8", "commitGHEventType": "closed", "commitUser": "shabanovd", "commitParents": ["cd28110d78a833c7e5e49c61cd8a569854f5458f"], "nameRev": "cec141c1a1d276f74a37077823dfd432c5a511d8 tags/eXist-3.0~70^2~1", "commitMessage": "[bugfix] Lookup Wildcard should return values from map, not keys.\nCloses https://github.com/eXist-db/exist/issues/1108\n", "commitDateTime": "2016-09-12 11:58:33", "authoredDateTime": "2016-09-12 11:54:47", "commitGitStats": [{"filePath": "src/org/exist/xquery/Lookup.java", "insertions": 9, "deletions": 1, "lines": 10}, {"filePath": "test/src/xquery/arrays/arrays.xql", "insertions": 14, "deletions": 1, "lines": 15}, {"filePath": "test/src/xquery/maps/maps.xql", "insertions": 6, "deletions": 5, "lines": 11}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Lookup.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.Lookup.eval(org.exist.xquery.Sequence,org.exist.xquery.Item)", "TOT": 4, "UPD": 0, "INS": 2, "MOV": 2, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["cec141c1a1d276f74a37077823dfd432c5a511d8"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 29, "deletions": 7, "lines": 36, "gitFilesChange": 3}, "spoonStatsSummary": {"TOT": 4.0, "UPD": 0.0, "INS": 2.0, "MOV": 2.0, "DEL": 0.0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["test/src/xquery/maps/maps.xql", "test/src/xquery/arrays/arrays.xql", "src/org/exist/xquery"], "changesInPackagesSPOON": ["org.exist.xquery.Lookup.eval(org.exist.xquery.Sequence,org.exist.xquery.Item)"]}, {"title": "Boolean operations on nodes", "body": "As reported by @dariok in #1097 and confirmed by both @dariok and me using builds of the develop branch as current as 12f422d, boolean operations on a node produce different results based on the order that the node is selected.\n\nWe have two reproducible tests, which we tested with eXide (2.2.0):\n\n**Test 1: In-memory node**\n\n``` xquery\nxquery version \"3.1\";\n\nlet $node := \n    <root>\n        <foo/>\n        <bar/>\n    </root>\nlet $x := $node/blah\nlet $y := $node/blah\nreturn \n    <test>\n        <result>{$x/foo and $x/bar}</result>\n        <result>{$y/foo and $y/bar}</result> \n    </test>\n```\n\nExpected result:\n\n``` xml\n<test>\n    <result>false</result>\n    <result>false</result>\n</test>\n```\n\nActual result:\n\n``` xml\n<test>\n    <result/>\n    <result>false</result>\n</test>\n```\n\n**Test 2: On-database node**\n\n``` xquery\nxquery version \"3.1\";\n\nlet $node := \n    <root>\n        <foo/>\n        <bar/>\n    </root>\nlet $create-collection := xmldb:create-collection('/db', 'test')\nlet $store := xmldb:store('/db/test', 'test.xml', $node)\nlet $x := doc('/db/test/test.xml')/root\nlet $y := doc('/db/test/test.xml')/root\nreturn \n    <test>\n        <result>{$x/foo and $x/bar}</result>\n        <result>{$y/foo and $y/bar}</result> \n    </test>\n```\n\nExpected result:\n\n``` xml\n<test>\n    <result>true</result>\n    <result>true</result>\n</test>\n```\n\nActual result:\n\n``` xml\n<test>\n    <result/>\n    <result>true</result>\n</test>\n```\n", "url": "https://github.com/eXist-db/exist/issues/1106", "user": "joewiz", "labels": ["bug"], "created": "2016-08-27 19:16:55", "closed": "2017-01-15 16:39:10", "commits": {}, "ttf": 140.00027777777777, "commitsDetails": []}, {"title": "Strange behaviour evaluating a boolean expression in RC2", "body": "If have come across a situation where\n\n```\nreturn $node/child1 and $node/child2\n```\n\nreturns neither `true` nor `false` but nothing at all. **No exception is thrown**, either.\n\nThe code is available at https://gist.github.com/dariok/a4feb9ee14d58dff6aed0a2268cdf6d3\nand you can see the result on a fairly fresh install of RC2 at http://dev2.hab.de:8080/exist/edoc/test/test3.xql\n\nAs you can see, both children can be accessed. If I check for the number of children, it works as well as can be seen in `dariok[@type='ondisk2']`.\n", "url": "https://github.com/eXist-db/exist/issues/1097", "user": "dariok", "labels": ["bug"], "created": "2016-08-18 16:32:55", "closed": "2016-08-28 08:30:19", "commits": {}, "ttf": 9.000277777777777, "commitsDetails": []}, {"title": "Unit suite hangs on jetty shutdown", "body": "There trace is attached. My runs do never finish :-(\n\n[locktraces.txt](https://github.com/eXist-db/exist/files/392011/locktraces.txt)\n\nyour kit profiler output: \n\n![junittestrunner_-_yourkit_java_profiler_2016_02-b40_-_64-bit](https://cloud.githubusercontent.com/assets/1700062/17272018/e35641b0-568b-11e6-8df6-cbc1fe03ade6.png)\n\n@adamretter ? @wolfgangmm  ? can you reproduce?\n\nthe last logs:\n\n![exist_ _tail_-f_test_txt_ _bash_ _174x82](https://cloud.githubusercontent.com/assets/1700062/17272037/6738e122-568c-11e6-9ede-3d002c90507a.png)\n", "url": "https://github.com/eXist-db/exist/issues/1075", "user": "dizzzz", "labels": ["bug", "high prio"], "created": "2016-07-30 17:29:49", "closed": "2016-10-14 18:23:56", "commits": {}, "ttf": 76.00027777777778, "commitsDetails": []}, {"title": "Design issue Valuesequence", "body": "![valuesequence_java_-_exist_-____development_git_dizzzz_exist_](https://cloud.githubusercontent.com/assets/1700062/17269935/85b47bce-5656-11e6-8707-f19bbed89b3f.png)\n\nthis class variable 'size' has is initialized with value \"-1\"  (UNSET_SIZE)  yielding into some interesting issue in the addItem code:\n![additem](https://cloud.githubusercontent.com/assets/1700062/17269956/f75fa1f4-5656-11e6-9237-350b8e598e03.png)\n\nwhere t looks like it is used as array index instead (0=1st position). in the reverse value sequence though it is used differently:\n\n![reverse](https://cloud.githubusercontent.com/assets/1700062/17269969/4f55ddce-5657-11e6-8509-bb24698c5fad.png)\n\nwhich is the cause of https://github.com/eXist-db/exist/issues/1067 \n", "url": "https://github.com/eXist-db/exist/issues/1074", "user": "dizzzz", "labels": ["bug"], "created": "2016-07-30 11:13:09", "closed": "2016-08-20 12:01:41", "commits": {}, "ttf": 21.00027777777778, "commitsDetails": []}, {"title": "Wrapper startup broken on macOS", "body": "As first discussed in https://github.com/eXist-db/exist/pull/1065#issuecomment-232386003, something about the changes in https://github.com/eXist-db/exist/pull/1016 (merged in on May 18) resulted in wrapper startup failures on macOS with builds of the develop branch since that day.  As a result, methods of startup which used to work - double-clicking on the macOS `.app` version of eXist (from a .dmg installer), double-clicking on `start.jar`, or using the command `open start.jar` - no longer work.\n\nTo confirm this, I downloaded two nightlies from Adam's site to see whether this change resulted in the problem we're seeing. Indeed, the .app from the .dmg nightly of May 17 starts right up, whereas the May 19th version doesn't start.\n\nI also see a difference between the process of the May 17th (158eaa3) and May 19th (50d037f) versions. Here's how each appears when I start them via start.jar (opening its application package and double-click directly on its start.jar):\n\n**May 17:**\n\n> $ ps aux | grep java\n> joe              34956   0.2  2.8  7290824 467980   ??  S     5:06PM   0:18.43 /Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/java -Dwrapper.java.library.path=/Users/joe/Desktop/eXist-db.app/Contents/Resources/eXist-db/.tools/wrapper/ -Xms256m -Dfile.encoding=UTF-8 -Xmx1024m -Xdock:name=eXist-db -Xdock:icon=icon.png -Dapple.laf.useScreenMenuBar=true -Dapple.awt.UIElement=true -Dexist.home=/Users/joe/Desktop/eXist-db.app/Contents/Resources/eXist-db/. -Djava.endorsed.dirs=/Users/joe/Desktop/eXist-db.app/Contents/Resources/eXist-db/./lib/endorsed -jar /Users/joe/Desktop/eXist-db.app/Contents/Resources/eXist-db/./start.jar org.exist.launcher.Launcher\n\n**May 19:**\n\n> $ ps aux | grep java\n> joe              34935   0.0  0.1  8284660  17660   ??  Ss    5:03PM   0:00.02 /Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/java -jar /Users/joe/Desktop/eXist-db.app/Contents/Resources/eXist-db/start.jar\n\nWhen I swap the May 17th version out and put the May 19th version in its place, the startup command from the May 17th process output successfully starts the May 19th version:\n\n> $ /Library/Internet\\ Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/java -Dwrapper.java.library.path=/Users/joe/Desktop/eXist-db.app/Contents/Resources/eXist-db/.tools/wrapper/ -Xms256m -Dfile.encoding=UTF-8 -Xmx1024m -Xdock:name=eXist-db -Xdock:icon=icon.png -Dapple.laf.useScreenMenuBar=true -Dapple.awt.UIElement=true -Dexist.home=/Users/joe/Desktop/eXist-db.app/Contents/Resources/eXist-db/. -Djava.endorsed.dirs=/Users/joe/Desktop/eXist-db.app/Contents/Resources/eXist-db/./lib/endorsed -jar /Users/joe/Desktop/eXist-db.app/Contents/Resources/eXist-db/./start.jar org.exist.launcher.Launcher\n", "url": "https://github.com/eXist-db/exist/issues/1069", "user": "joewiz", "labels": ["bug"], "created": "2016-07-21 17:54:42", "closed": "2016-07-29 16:52:24", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "3.0 RC1: fold-right omits the rightmost sequence element in processing", "body": "The fn:fold-right function omits the rightmost element from the processed sequence. This xquery snippet demonstrates the bug:\n\n```\nlet $seq := (1,2,3,4)\nreturn\n    fold-right ($seq, (<state i='0'/>) , function($item as xs:integer, $accu as node()*) {\n        ($accu, <state i='{$item}'/>)\n    })\n```\n\neXist-db 3.0 RC1 returns the following sequence as a result:\n\n```\n<state i=\"0\"/>\n<state i=\"3\"/>\n<state i=\"2\"/>\n<state i=\"1\"/>\n\n```\n\nNote that the rightmost number ( 4 ) is omitted. When the same query is run in eXist-db 2.2, the result is correct:\n\n```\n<state i=\"0\"/>\n<state i=\"4\"/>\n<state i=\"3\"/>\n<state i=\"2\"/>\n<state i=\"1\"/>\n\n```\n", "url": "https://github.com/eXist-db/exist/issues/1067", "user": "median1st", "labels": ["bug"], "created": "2016-07-15 15:47:14", "closed": "2016-08-01 18:56:31", "commits": {"e4b821514f91f56dc40ad009d0bcd08b3da56e68": {"commitGHEventType": "closed", "commitUser": "wolfgangmm"}}, "ttf": 17.00027777777778, "commitsDetails": [{"commitHash": "e4b821514f91f56dc40ad009d0bcd08b3da56e68", "commitGHEventType": "closed", "commitUser": "wolfgangmm", "commitParents": ["69cba4d2401b7206b46d3942dba8cba1b08a395e"], "nameRev": "e4b821514f91f56dc40ad009d0bcd08b3da56e68 tags/eXist-3.0.RC2^2", "commitMessage": "Added unit tests for fold-right fix , fixes https://github.com/eXist-db/exist/issues/1067\n", "commitDateTime": "2016-07-30 23:10:16", "authoredDateTime": "2016-07-30 23:10:16", "commitGitStats": [{"filePath": "test/src/xquery/xquery3/fn.xql", "insertions": 16, "deletions": 0, "lines": 16}, {"filePath": "test/src/xquery/xquery3/suite.xql", "insertions": 2, "deletions": 1, "lines": 3}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["e4b821514f91f56dc40ad009d0bcd08b3da56e68"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 18, "deletions": 1, "lines": 19, "gitFilesChange": 2}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["test/src/xquery/xquery3/suite.xql", "test/src/xquery/xquery3/fn.xql"]}, {"title": "Jetty9 : startup issue", "body": "_only_ when exist-db is started with `java -jar start.jar' the following error is visible:\n\n![clipboard01](https://cloud.githubusercontent.com/assets/1700062/16794639/761fba00-48d9-11e6-8472-e03cb07a597d.png)\n\n`bin\\startup.sh` looks just fine..... and 'jetty.xml' hasn't changed.... \n", "url": "https://github.com/eXist-db/exist/issues/1063", "user": "dizzzz", "labels": ["bug"], "created": "2016-07-13 07:11:41", "closed": "2016-07-13 15:05:12", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Presentation modifiers for Z datetime formatting picture string not supported", "body": "Since #364, eXist added support for `[Z]` and `[z]` - the specifiers for formatting the timezone components of the datetime formatting picture string from the spec (https://www.w3.org/TR/xpath-functions-30/#rules-for-datetime-formatting). However, eXist doesn't handle the presentation modifiers for these two specifiers. For example:\n\n``` xquery\nformat-dateTime(xs:dateTime('2012-06-26T23:14:22.566-10:00'), '[Z0000]')\n```\n\nShould return `-1000`, but eXist returns `+00:00`.  There are actually two problems here: \n1. The presentation modifiers are not respected: `[Z0]`, `[Z0000]`, `[Z00:00t]`, `[ZN]`, etc.\n2. Timezones with negative offsets are always returned as GMT (e.g., `-10:00` dateTimes such as the one above will be formatted `+00:00`). Positive offsets do not suffer from this problem (e.g., change `-10:00` to `+10:00` in the example above, and the result will be `+10:00`).\n\nI believe the relevant code is https://github.com/adamretter/exist/blob/76abc91f1ad5d9697b6dbd466ef8dc60940ad9a4/src/org/exist/xquery/functions/fn/FnFormatDates.java#L318-L331. \n\nFor convenience, here is a screenshot of the presentation modifier table from the spec (linked above):\n\n> ![screen shot 2016-05-25 at 1 14 30 pm](https://cloud.githubusercontent.com/assets/59118/15549490/c5a10aaa-227a-11e6-9a87-b4fd60fe8423.png)\n", "url": "https://github.com/eXist-db/exist/issues/1024", "user": "joewiz", "labels": ["bug"], "created": "2016-05-25 17:23:17", "closed": "2016-08-20 13:45:55", "commits": {"3fdfa1f6d848f992570707a0b98ac93247fd5260": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 86.00027777777778, "commitsDetails": [{"commitHash": "3fdfa1f6d848f992570707a0b98ac93247fd5260", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["ebdd07a54244e67d758bae3986b12b77d37f336f"], "nameRev": "3fdfa1f6d848f992570707a0b98ac93247fd5260 tags/eXist-3.0~76^2~3", "commitMessage": "[bugfix] Implement support for timezone pictures. Closes https://github.com/eXist-db/exist/issues/1024\n", "commitDateTime": "2016-08-19 23:51:07", "authoredDateTime": "2016-08-19 23:19:38", "commitGitStats": [{"filePath": "src/org/exist/xquery/functions/fn/FnFormatDates.java", "insertions": 138, "deletions": 21, "lines": 159}], "commitSpoonAstDiffStats": [{"spoonFilePath": "FnFormatDates.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.functions.fn.FnFormatDates.eval(org.exist.xquery.functions.fn.Sequence[],org.exist.xquery.functions.fn.Sequence)", "TOT": 10, "UPD": 1, "INS": 7, "MOV": 1, "DEL": 1}, {"spoonMethodName": "org.exist.xquery.functions.fn.FnFormatDates.formatDate(java.lang.String,org.exist.xquery.functions.fn.AbstractDateTimeValue,java.lang.String)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FnFormatDates.formatComponent(java.lang.String,org.exist.xquery.functions.fn.AbstractDateTimeValue,java.lang.String,java.lang.StringBuilder)", "TOT": 13, "UPD": 5, "INS": 0, "MOV": 5, "DEL": 3}, {"spoonMethodName": "org.exist.xquery.functions.fn.FnFormatDates.formatNumber(char,java.lang.String,java.lang.String,int,java.lang.String,java.lang.StringBuilder)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FnFormatDates", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FnFormatDates.formatTimeZone(java.lang.String,int,int,java.util.TimeZone,java.util.Optional,java.util.Optional)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FnFormatDates.formatMilitaryTimeZone(int,int)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FnFormatDates.formatDate(java.lang.String,org.exist.xquery.functions.fn.AbstractDateTimeValue,java.util.Optional,java.util.Optional)", "TOT": 5, "UPD": 0, "INS": 5, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FnFormatDates.formatComponent(java.lang.String,org.exist.xquery.functions.fn.AbstractDateTimeValue,java.util.Optional,java.util.Optional,boolean,java.lang.StringBuilder)", "TOT": 7, "UPD": 0, "INS": 7, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FnFormatDates.getDefaultFormat(char)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FnFormatDates.formatNumber(char,java.lang.String,java.lang.String,int,java.util.Optional,java.lang.StringBuilder)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["3fdfa1f6d848f992570707a0b98ac93247fd5260"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 138, "deletions": 21, "lines": 159, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 46, "UPD": 8, "INS": 27, "MOV": 7, "DEL": 4, "spoonFilesChanged": 1, "spoonMethodsChanged": 11}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/xquery/functions/fn"], "changesInPackagesSPOON": ["org.exist.xquery.functions.fn.FnFormatDates.formatComponent(java.lang.String,org.exist.xquery.functions.fn.AbstractDateTimeValue,java.util.Optional,java.util.Optional,boolean,java.lang.StringBuilder)", "org.exist.xquery.functions.fn.FnFormatDates.getDefaultFormat(char)", "org.exist.xquery.functions.fn.FnFormatDates.formatDate(java.lang.String,org.exist.xquery.functions.fn.AbstractDateTimeValue,java.util.Optional,java.util.Optional)", "org.exist.xquery.functions.fn.FnFormatDates.eval(org.exist.xquery.functions.fn.Sequence[],org.exist.xquery.functions.fn.Sequence)", "org.exist.xquery.functions.fn.FnFormatDates.formatNumber(char,java.lang.String,java.lang.String,int,java.lang.String,java.lang.StringBuilder)", "org.exist.xquery.functions.fn.FnFormatDates.formatNumber(char,java.lang.String,java.lang.String,int,java.util.Optional,java.lang.StringBuilder)", "org.exist.xquery.functions.fn.FnFormatDates.formatComponent(java.lang.String,org.exist.xquery.functions.fn.AbstractDateTimeValue,java.lang.String,java.lang.StringBuilder)", "org.exist.xquery.functions.fn.FnFormatDates.formatTimeZone(java.lang.String,int,int,java.util.TimeZone,java.util.Optional,java.util.Optional)", "org.exist.xquery.functions.fn.FnFormatDates.formatMilitaryTimeZone(int,int)", "org.exist.xquery.functions.fn.FnFormatDates.formatDate(java.lang.String,org.exist.xquery.functions.fn.AbstractDateTimeValue,java.lang.String)", "org.exist.xquery.functions.fn.FnFormatDates"]}, {"title": "Recursion RestXQ: deploying web app fails ", "body": "I just upgraded my eXist instance via git and did a `build.sh rebuild`.\nAll went fine, but now I\u2019m having problems installing my [web app](https://github.com/Edirom/WeGA-WebApp/releases/download/v2.0.0/WeGA-WebApp-2.0.0.xar). The deployment process simply hangs, whether I upload via browser or try via autodeploy.\nI updated from commit 72b4bc7d3112593df2d508ca563ad23a31189c3e (February 1st) and I can confirm that going back to this commit indeed fixes the issue for me.\n\nMy system:\nOS X 10.11.4\nJava(TM) SE Runtime Environment (build 1.8.0_91-b14)\neXist develop branch at 5d6fc97102e27f5404f22ddf3e90e41b4310ae02\n\n@wolfgangmm confirmed on [exist-open](http://exist.2174344.n4.nabble.com/Problem-deploying-web-app-tp4670225p4670226.html):\n\n> I can see an endless loop in the thread dump (the first lines are repeated over and over again):\n\n```\nat org.exist.extensions.exquery.restxq.impl.ExistXqueryRegistry.findServices(ExistXqueryRegistry.java:239)\nat org.exist.extensions.exquery.restxq.impl.ExistXqueryRegistry.reexamineModulesWithResolvedDependencies(ExistXqueryRegistry.java:320)\nat org.exist.extensions.exquery.restxq.impl.ExistXqueryRegistry.findServices(ExistXqueryRegistry.java:239)\nat org.exist.extensions.exquery.restxq.impl.ExistXqueryRegistry.reexamineModulesWithResolvedDependencies(ExistXqueryRegistry.java:320)\nat org.exist.extensions.exquery.restxq.impl.ExistXqueryRegistry.findServices(ExistXqueryRegistry.java:239)\nat org.exist.extensions.exquery.restxq.impl.RestXqTrigger.after(RestXqTrigger.java:113)\nat org.exist.extensions.exquery.restxq.impl.RestXqTrigger.afterCreateDocument(RestXqTrigger.java:51)\nat org.exist.collections.triggers.DocumentTriggers.afterCreateDocument(DocumentTriggers.java:236)\nat org.exist.collections.Collection.addBinaryResource(Collection.java:1955)\nat org.exist.collections.Collection.addBinaryResource(Collection.java:1865)\nat org.exist.collections.Collection.addBinaryResource(Collection.java:1858)\nat org.exist.repo.Deployment.storeFiles(Deployment.java:771)\n```\n\n> Workaround: comment out the restxq trigger in EXIST_HOME/collection.xconf.init and /db/system/config/db/collection.xconf. As far as I can see your app is not using it.\n", "url": "https://github.com/eXist-db/exist/issues/1010", "user": "peterstadler", "labels": ["bug"], "created": "2016-05-13 11:20:35", "closed": "2020-01-22 11:15:03", "commits": {}, "ttf": 1348.0002777777777, "commitsDetails": []}, {"title": "Collection: locking around subCollections and documents is inconsisent", "body": "As an example, consider the following method from `org.exist.collections.Collection`:\n\n``` java\n    public Iterator<XmldbURI> collectionIterator(final DBBroker broker) throws PermissionDeniedException {\n        if(!getPermissionsNoLock().validate(broker.getCurrentSubject(), Permission.READ)) {\n            throw new PermissionDeniedException(\"Permission to list sub-collections denied on \" + this.getURI());\n        }\n\n        try {\n            getLock().acquire(Lock.READ_LOCK);\n            return subCollections.stableIterator();\n        } catch(final LockException e) {\n            LOG.warn(e.getMessage(), e);\n            return null;\n        } finally {\n            getLock().release(Lock.READ_LOCK);\n        }\n    }\n```\n\nIt takes a READ lock on the `subCollections` so that it may take a stable iterator (which copies the keys); However, there are many unlocked accesses to `subCollections` including writes (which defeats the purpose of the above READ locking) e.g. \n1. `Collection#update`.\n2. `Collection#addCollection`. This is called from `NativeBroker#getOrCreateCollectionExplicit` without a WRITE lock on the collection. Also it seems that `Collection current = getCollection(transaction, XmldbURI.ROOT_COLLECTION_URI);` in `NativeBroker#getOrCreateCollectionExplicit` should instead be `Collection current = getCollection(transaction, XmldbURI.ROOT_COLLECTION_URI, Lock.WRITE_LOCK);`\n", "url": "https://github.com/eXist-db/exist/issues/998", "user": "adamretter", "labels": ["bug", "discuss"], "created": "2016-05-06 18:52:55", "closed": "2016-05-18 10:43:30", "commits": {}, "ttf": 11.000277777777777, "commitsDetails": []}, {"title": "shutdown deadlock", "body": "```\nFound one Java-level deadlock:\n=============================\n\"jetty shutdown schedule\":\n  waiting to lock monitor 0x00007fb32b8255f8 (object 0x00000007be26fb50, a org.exist.storage.BrokerPool),\n  which is held by \"main\"\n\"main\":\n  waiting for ownable synchronizer 0x00000007bedd7f50, (a java.util.concurrent.locks.ReentrantLock$NonfairSync),\n  which is held by \"jetty shutdown schedule\"\n\nJava stack information for the threads listed above:\n===================================================\n\"jetty shutdown schedule\":\n    at org.exist.storage.BrokerPool.shutdown(BrokerPool.java:1962)\n    - waiting to lock <0x00000007be26fb50> (a org.exist.storage.BrokerPool)\n    at org.exist.storage.BrokerPool.stopAll(BrokerPool.java:410)\n    at org.exist.http.servlets.AbstractExistHttpServlet.destroy(AbstractExistHttpServlet.java:91)\n    at org.eclipse.jetty.servlet.ServletHolder.destroyInstance(ServletHolder.java:395)\n    at org.eclipse.jetty.servlet.ServletHolder.doStop(ServletHolder.java:368)\n    at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89)\n    - locked <0x00000007bec5b5f0> (a java.lang.Object)\n    at org.eclipse.jetty.servlet.ServletHandler.doStop(ServletHandler.java:242)\n    - locked <0x00000007bec58bc8> (a org.eclipse.jetty.servlet.ServletHandler)\n    at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89)\n    - locked <0x00000007bec58c58> (a java.lang.Object)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.doStop(HandlerWrapper.java:107)\n    at org.eclipse.jetty.security.SecurityHandler.doStop(SecurityHandler.java:392)\n    at org.eclipse.jetty.security.ConstraintSecurityHandler.doStop(ConstraintSecurityHandler.java:464)\n    at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89)\n    - locked <0x00000007bec58b08> (a java.lang.Object)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.doStop(HandlerWrapper.java:107)\n    at org.eclipse.jetty.server.session.SessionHandler.doStop(SessionHandler.java:136)\n    at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89)\n    - locked <0x00000007bec589d8> (a java.lang.Object)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.doStop(HandlerWrapper.java:107)\n    at org.eclipse.jetty.server.handler.ContextHandler.doStop(ContextHandler.java:815)\n    at org.eclipse.jetty.servlet.ServletContextHandler.doStop(ServletContextHandler.java:160)\n    at org.eclipse.jetty.webapp.WebAppContext.doStop(WebAppContext.java:518)\n    at org.exist.jetty.WebAppContext.doStop(WebAppContext.java:39)\n    at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89)\n    - locked <0x00000007bec588d0> (a java.lang.Object)\n    at org.eclipse.jetty.server.handler.HandlerCollection.doStop(HandlerCollection.java:250)\n    at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89)\n    - locked <0x00000007bf3224d0> (a java.lang.Object)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.doStop(HandlerWrapper.java:107)\n    at org.eclipse.jetty.server.Server.doStop(Server.java:343)\n    at org.eclipse.jetty.util.component.AbstractLifeCycle.stop(AbstractLifeCycle.java:89)\n    - locked <0x00000007be2ecd58> (a java.lang.Object)\n    at org.exist.jetty.JettyStart$ShutdownListenerImpl$1.run(JettyStart.java:387)\n    at java.util.TimerThread.mainLoop(Timer.java:555)\n    at java.util.TimerThread.run(Timer.java:505)\n\"main\":\n    at sun.misc.Unsafe.park(Native Method)\n    - parking to wait for  <0x00000007bedd7f50> (a java.util.concurrent.locks.ReentrantLock$NonfairSync)\n    at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:870)\n    at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1199)\n    at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:209)\n    at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:285)\n    at org.exist.storage.txn.TransactionManager.withLock(TransactionManager.java:344)\n    at org.exist.storage.txn.TransactionManager.withLock(TransactionManager.java:324)\n    at org.exist.storage.txn.TransactionManager.commit(TransactionManager.java:139)\n    at org.exist.repo.Deployment.storeFiles(Deployment.java:780)\n    at org.exist.repo.Deployment.scanDirectory(Deployment.java:694)\n    at org.exist.repo.Deployment.lambda$scanDirectory$4(Deployment.java:699)\n    at org.exist.repo.Deployment$$Lambda$165/1819271005.accept(Unknown Source)\n    at java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:184)\n    at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)\n    at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)\n    at java.util.Iterator.forEachRemaining(Iterator.java:116)\n    at java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)\n    at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)\n    at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)\n    at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)\n    at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)\n    at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n    at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)\n    at org.exist.repo.Deployment.scanDirectory(Deployment.java:699)\n    at org.exist.repo.Deployment.deploy(Deployment.java:411)\n    at org.exist.repo.Deployment.installAndDeploy(Deployment.java:272)\n    at org.exist.repo.AutoDeploymentTrigger.execute(AutoDeploymentTrigger.java:72)\n    at org.exist.storage.BrokerPool.callStartupTriggers(BrokerPool.java:1101)\n    at org.exist.storage.BrokerPool.initialize(BrokerPool.java:1013)\n    - locked <0x00000007be26fb50> (a org.exist.storage.BrokerPool)\n    at org.exist.storage.BrokerPool.<init>(BrokerPool.java:715)\n    at org.exist.storage.BrokerPool.configure(BrokerPool.java:268)\n    at org.exist.storage.BrokerPool.configure(BrokerPool.java:242)\n    at org.exist.storage.ModificationTimeTest.startDB(ModificationTimeTest.java:137)\n    at org.exist.storage.ModificationTimeTest.storeXML(ModificationTimeTest.java:185)\n    at org.exist.storage.ModificationTimeTest.check_if_modification_time_is_not_updated_on_parse_error(ModificationTimeTest.java:109)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:498)\n    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\n    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\n    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\n    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\n    at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\n    at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)\n    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\n    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\n    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\n    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\n    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\n    at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\n    at org.junit.runners.ParentRunner.run(ParentRunner.java:363)\n    at org.junit.runners.Suite.runChild(Suite.java:128)\n    at org.junit.runners.Suite.runChild(Suite.java:27)\n    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\n    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\n    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\n    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\n    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\n    at org.junit.runners.ParentRunner.run(ParentRunner.java:363)\n    at junit.framework.JUnit4TestAdapter.run(JUnit4TestAdapter.java:38)\n    at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:532)\n    at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:1179)\n    at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:1030)\n\nFound 1 deadlock.\n```\n", "url": "https://github.com/eXist-db/exist/issues/992", "user": "adamretter", "labels": ["bug"], "created": "2016-05-04 17:27:01", "closed": "2019-01-11 04:06:39", "commits": {}, "ttf": 981.0002777777778, "commitsDetails": []}, {"title": "Log flood during restore", "body": "during restore the next *_two *_ blocks flood `exist.log`; it this bad or ok?\n\n(current develop)\n\n```\n2016-04-11 13:58:48,904 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:48,915 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:48,918 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:48,922 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,223 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,227 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,230 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,457 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,460 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,465 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,469 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,475 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,491 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,587 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,590 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,594 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,791 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,795 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n2016-04-11 13:58:49,798 [pool-3-thread-1] WARN  (TransactionManager.java [close]:257) - Transaction was not committed or aborted, auto aborting! \n```\n\nand\n\n```\n2016-04-11 14:08:13,141 [pool-3-thread-1] INFO  (BFile.java [printStatistics]:419) - values.dbx DATA Buffers occupation : 2% (1 out of 64) Cache efficiency : 100% \n2016-04-11 14:08:13,142 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241502 \n2016-04-11 14:08:13,145 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241511 \n2016-04-11 14:08:13,147 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241514 \n2016-04-11 14:08:13,149 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241517 \n2016-04-11 14:08:13,152 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241532 \n2016-04-11 14:08:13,154 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241535 \n2016-04-11 14:08:13,156 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241538 \n2016-04-11 14:08:13,158 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241563 \n2016-04-11 14:08:13,160 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241566 \n2016-04-11 14:08:13,162 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241569 \n2016-04-11 14:08:13,164 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241578 \n2016-04-11 14:08:13,166 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241581 \n2016-04-11 14:08:13,168 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241584 \n2016-04-11 14:08:13,170 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241596 \n2016-04-11 14:08:13,173 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241605 \n2016-04-11 14:08:13,175 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241623 \n2016-04-11 14:08:13,178 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241645 \n2016-04-11 14:08:13,180 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241648 \n2016-04-11 14:08:13,182 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241651 \n2016-04-11 14:08:13,185 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241691 \n2016-04-11 14:08:13,187 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241700 \n2016-04-11 14:08:13,190 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241718 \n2016-04-11 14:08:13,192 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241721 \n2016-04-11 14:08:13,195 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241724 \n2016-04-11 14:08:13,198 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241727 \n2016-04-11 14:08:13,201 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241730 \n2016-04-11 14:08:13,204 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241733 \n2016-04-11 14:08:13,207 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241736 \n2016-04-11 14:08:13,209 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241739 \n2016-04-11 14:08:13,212 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241742 \n2016-04-11 14:08:13,215 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241745 \n2016-04-11 14:08:13,217 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241748 \n2016-04-11 14:08:13,220 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241751 \n2016-04-11 14:08:13,222 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241754 \n2016-04-11 14:08:13,225 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241757 \n2016-04-11 14:08:13,228 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241760 \n2016-04-11 14:08:13,231 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241763 \n2016-04-11 14:08:13,233 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241766 \n2016-04-11 14:08:13,236 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241769 \n2016-04-11 14:08:13,238 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241772 \n2016-04-11 14:08:13,241 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241789 \n2016-04-11 14:08:13,244 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241811 \n2016-04-11 14:08:13,246 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241814 \n2016-04-11 14:08:13,249 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241817 \n2016-04-11 14:08:13,251 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241859 \n2016-04-11 14:08:13,253 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241862 \n2016-04-11 14:08:13,255 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241865 \n2016-04-11 14:08:13,256 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241868 \n2016-04-11 14:08:13,258 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241871 \n2016-04-11 14:08:13,260 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241874 \n2016-04-11 14:08:13,262 [pool-3-thread-1] INFO  (Journal.java [lambda$clearBackupFiles$8]:375) - Checkpoint deleting: C:\\Dev\\GitHub\\eXist-db\\webapp\\WEB-INF\\data\\fs.journal\\txn.241877 \n```\n", "url": "https://github.com/eXist-db/exist/issues/973", "user": "dizzzz", "labels": ["bug"], "created": "2016-04-11 12:45:50", "closed": "2019-01-10 19:47:59", "commits": {}, "ttf": 1004.0002777777778, "commitsDetails": []}, {"title": "system:export function documentation is incorrect", "body": "(See src/../xquery/functions/system/FnExport.java)\nThe documentation for this function says \"Restore the database or a section of the database\" - when in fact this function generates a backup file or directory.\n\nThe $dir-or-file parameter should be $target-directory - \"The destination for the backup - this directory must be writeable by the database process\".\nThe other parameters are correct.\n\nThe associated error message should refer to \"export\" and not \"restore\"\n", "url": "https://github.com/eXist-db/exist/issues/969", "user": "gspringtech", "labels": ["bug"], "created": "2016-04-11 02:24:49", "closed": "2016-04-18 10:31:03", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "NPE in \"group by\" combined with \"for at\"", "body": "In versions 2.2 and 3.0.RC1, everything worked as expected. After migrating onto the last build I got this error (when trying to access a particular protected site, other sites work well). I guess it has something to do with the rewriting:\n\n```\nHTTP ERROR 500\n\nProblem accessing /exist/apps/test-app/create-ejournals-list.html. Reason:\n\n    Server Error\n\nCaused by:\n\njavax.servlet.ServletException: An unknown error occurred: null\n    at org.exist.http.servlets.EXistServlet.doPost(EXistServlet.java:460)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:755)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:684)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:503)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:429)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103)\n    at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:50)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:549)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.applyViews(XQueryURLRewrite.java:414)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:360)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:684)\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1496)\n    at de.betterform.agent.web.filter.XFormsFilter.doFilter(XFormsFilter.java:171)\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1476)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:501)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:429)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n    at org.eclipse.jetty.server.Server.handle(Server.java:370)\n    at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:494)\n    at org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:982)\n    at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:1043)\n    at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:865)\n    at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:240)\n    at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:696)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:53)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.NullPointerException\n    at org.exist.xquery.GroupByClause$GroupByData.access$200(GroupByClause.java:28)\n    at org.exist.xquery.GroupByClause.eval(GroupByClause.java:79)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.DynamicTypeCheck.eval(DynamicTypeCheck.java:61)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:323)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:227)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.value.FunctionReference.eval(FunctionReference.java:81)\n    at org.exist.xquery.DynamicFunctionCall.eval(DynamicFunctionCall.java:76)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.SwitchExpression.eval(SwitchExpression.java:104)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:323)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:227)\n    at org.exist.xquery.DynamicCardinalityCheck.eval(DynamicCardinalityCheck.java:74)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:209)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:323)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:227)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:100)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:100)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:81)\n    at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:318)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:81)\n    at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:318)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:81)\n    at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:318)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:81)\n    at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:318)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:81)\n    at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:318)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:81)\n    at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:318)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.isEmpty(DeferredFunctionCall.java:198)\n    at org.exist.xquery.DynamicCardinalityCheck.eval(DynamicCardinalityCheck.java:76)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:209)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:323)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:227)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:100)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:323)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:227)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:323)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:227)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.XQuery.execute(XQuery.java:270)\n    at org.exist.xquery.XQuery.execute(XQuery.java:190)\n    at org.exist.http.RESTServer.executeXQuery(RESTServer.java:1497)\n    at org.exist.http.RESTServer.doPost(RESTServer.java:672)\n    at org.exist.http.servlets.EXistServlet.doPost(EXistServlet.java:433)\n    ... 46 more\n\nCaused by:\n\njava.lang.NullPointerException\n    at org.exist.xquery.GroupByClause$GroupByData.access$200(GroupByClause.java:28)\n    at org.exist.xquery.GroupByClause.eval(GroupByClause.java:79)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.DynamicTypeCheck.eval(DynamicTypeCheck.java:61)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:323)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:227)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.value.FunctionReference.eval(FunctionReference.java:81)\n    at org.exist.xquery.DynamicFunctionCall.eval(DynamicFunctionCall.java:76)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.SwitchExpression.eval(SwitchExpression.java:104)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:323)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:227)\n    at org.exist.xquery.DynamicCardinalityCheck.eval(DynamicCardinalityCheck.java:74)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:209)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:323)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:227)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:100)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:100)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:81)\n    at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:318)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:81)\n    at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:318)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:81)\n    at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:318)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:81)\n    at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:318)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:81)\n    at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:318)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:81)\n    at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:318)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.isEmpty(DeferredFunctionCall.java:198)\n    at org.exist.xquery.DynamicCardinalityCheck.eval(DynamicCardinalityCheck.java:76)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:209)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:323)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:227)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:100)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall$DeferredFunctionCallImpl.execute(FunctionCall.java:420)\n    at org.exist.xquery.DeferredFunctionCall.realize(DeferredFunctionCall.java:57)\n    at org.exist.xquery.DeferredFunctionCall.iterate(DeferredFunctionCall.java:230)\n    at org.exist.xquery.value.ValueSequence.addAll(ValueSequence.java:167)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.TypeswitchExpression.eval(TypeswitchExpression.java:103)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:323)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:227)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.processItem(ForExpr.java:239)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:179)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:323)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:227)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.XQuery.execute(XQuery.java:270)\n    at org.exist.xquery.XQuery.execute(XQuery.java:190)\n    at org.exist.http.RESTServer.executeXQuery(RESTServer.java:1497)\n    at org.exist.http.RESTServer.doPost(RESTServer.java:672)\n    at org.exist.http.servlets.EXistServlet.doPost(EXistServlet.java:433)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:755)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:684)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:503)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:429)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103)\n    at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:50)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:549)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.applyViews(XQueryURLRewrite.java:414)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:360)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:684)\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1496)\n    at de.betterform.agent.web.filter.XFormsFilter.doFilter(XFormsFilter.java:171)\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1476)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:501)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:429)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n    at org.eclipse.jetty.server.Server.handle(Server.java:370)\n    at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:494)\n    at org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:982)\n    at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:1043)\n    at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:865)\n    at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:240)\n    at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:696)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:53)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n    at java.lang.Thread.run(Thread.java:745)\n\n```\n", "url": "https://github.com/eXist-db/exist/issues/967", "user": "welblaud", "labels": ["bug"], "created": "2016-04-06 11:08:16", "closed": "2017-02-21 20:20:29", "commits": {}, "ttf": 321.0002777777778, "commitsDetails": []}, {"title": "fop config -> issue resolving fonts via embed-url", "body": "As described in https://github.com/eXist-db/exist/pull/938 I tried to adjust the fop config for the tei-simple-pm app (https://github.com/wolfgangmm/tei-simple-pm).\n\nI changed the fop config in fo.xql (https://github.com/wolfgangmm/tei-simple-pm/blob/master/modules/fo.xql)  as follows: \n- removed <font-base> base from the config\n- changed  <font embed-url=\"Junicode.ttf\" ../> to \"<font embed-url=\"exist://localhost:8080/db/apps/tei-simple/resources/fonts/Junicode.ttf\"/>\n\nThis results in the following error: javax.servlet.ServletException: An error occurred: URI scheme is not \"file\". \n\nAm I doing something wrong? I tried various combinations as embed-url, with and without port 8080, http as url scheme, but nothing worked. \n", "url": "https://github.com/eXist-db/exist/issues/952", "user": "windauer", "labels": ["bug"], "created": "2016-03-23 13:45:49", "closed": "2016-04-17 15:40:09", "commits": {}, "ttf": 25.00027777777778, "commitsDetails": []}, {"title": "Restore leads to \"Reason: networking error\" errors using backup.sh and JAC", "body": "Easy way to reproduce (submitted by @jensopetersen ):\n- clone exist-develop\n- build.sh \n- install a few apps from the package manager (imo not needed)\n- backup from the Dashboard\n- clean build of the installation\n- restore the backup through rpc (ie using backup.sh or JAC)\n\nLeads to:\n\n> WARN: Failed to restore resource 'functx.xql' from file 'xxx.zip#db/system/repo/functx-1.0/functx/functx.xql'.\n> Reason: networking error\n> WARN: Failed to restore resource 'icon.png'\n> from file 'xxx.zip#db/system/repo/xqjson-0.2.0/icon.png'.\n> Reason: networking error\n\n@wolfgangmm added:\n\n> While the restore seems to work if eXist is running in embedded mode\n> (bin/client.sh -l), I can reproduce the issue with a remote\n> connection.\n\nIt still works with commit #927, but since #928 the problems appear.\n", "url": "https://github.com/eXist-db/exist/issues/942", "user": "ChiSamurai", "labels": ["bug"], "created": "2016-03-15 14:45:39", "closed": "2016-03-17 11:17:02", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "contentextraction (tika) library problem with compressed files (xslx, docx)", "body": "Using the current develop branch, contentextraction functions fail with a java.lang.NoClassDefFoundError error. \n\nSteps to reproduce:\n1. Upload the attached test files:\n   - [test.docx](https://github.com/eXist-db/exist/files/167258/test.docx)\n   - [test.xlsx](https://github.com/eXist-db/exist/files/167259/test.xlsx)\n2. Submit the following queries in eXide:\n\n``` xquery\nlet $binary := util:binary-doc('/db/test.xlsx')\nreturn\n    contentextraction:get-metadata-and-content($binary)\n```\n\n``` xquery\nlet $binary := util:binary-doc('/db/test.docx')\nreturn\n    contentextraction:get-metadata-and-content($binary)\n```\n\nResulting error from exist.log:\n\n```\n2016-03-10 09:13:39,318 [eXistThread-53] ERROR (XQueryServlet.java [process]:550) - Could not initialize class org.apache.poi.openxml4j.opc.internal.marshallers.ZipPackagePropertiesMarshaller \njava.lang.NoClassDefFoundError: Could not initialize class org.apache.poi.openxml4j.opc.internal.marshallers.ZipPackagePropertiesMarshaller\n    at org.apache.poi.openxml4j.opc.OPCPackage.init(OPCPackage.java:161) ~[poi-ooxml-3.12-beta1.jar:3.12-beta1]\n    at org.apache.poi.openxml4j.opc.OPCPackage.<init>(OPCPackage.java:141) ~[poi-ooxml-3.12-beta1.jar:3.12-beta1]\n    at org.apache.poi.openxml4j.opc.Package.<init>(Package.java:37) ~[poi-ooxml-3.12-beta1.jar:3.12-beta1]\n    at org.apache.poi.openxml4j.opc.ZipPackage.<init>(ZipPackage.java:105) ~[poi-ooxml-3.12-beta1.jar:3.12-beta1]\n    at org.apache.poi.openxml4j.opc.OPCPackage.open(OPCPackage.java:224) ~[poi-ooxml-3.12-beta1.jar:3.12-beta1]\n    at org.apache.tika.parser.pkg.ZipContainerDetector.detectOPCBased(ZipContainerDetector.java:208) ~[tika-parsers-1.8.jar:1.8]\n    at org.apache.tika.parser.pkg.ZipContainerDetector.detectZipFormat(ZipContainerDetector.java:145) ~[tika-parsers-1.8.jar:1.8]\n    at org.apache.tika.parser.pkg.ZipContainerDetector.detect(ZipContainerDetector.java:88) ~[tika-parsers-1.8.jar:1.8]\n    at org.apache.tika.detect.CompositeDetector.detect(CompositeDetector.java:61) ~[tika-core-1.8.jar:1.8]\n    at org.apache.tika.parser.AutoDetectParser.parse(AutoDetectParser.java:112) ~[tika-core-1.8.jar:1.8]\n    at org.exist.contentextraction.ContentExtraction.extractContentAndMetadata(ContentExtraction.java:56) ~[exist-contentextraction.jar:?]\n...\n```\n\nReference:\n\nhttp://stackoverflow.com/questions/28145857/nosuchmethoderror-initialization-failure-while-reading-excel-xlsx-file-using-a\n\nNote: I tried and failed at the following workarounds: (1) upgrade Tika to 1.12 and (2) downgrade POI to 3.9-20121203. My guess is that there are duplicate jars or conflicting classpath issues, but this is beyond my skill level.\n", "url": "https://github.com/eXist-db/exist/issues/937", "user": "joewiz", "labels": ["bug"], "created": "2016-03-10 14:20:42", "closed": "2016-03-27 20:33:48", "commits": {"1556f2bff59b26015ea5069f887145015d7e4c85": {"commitGHEventType": "referenced", "commitUser": "adamretter"}, "f447aec813b3319da32d13df2fad22ac8d22db8e": {"commitGHEventType": "referenced", "commitUser": "wolfgangmm"}}, "ttf": 17.00027777777778, "commitsDetails": [{"commitHash": "1556f2bff59b26015ea5069f887145015d7e4c85", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["513e58bdebe709613b6b3c3eddaa898faef0e536", "657e1c9e4e0a4f5aa83082707523e2ce4ca9c778"], "nameRev": "1556f2bff59b26015ea5069f887145015d7e4c85 tags/eXist-3.0.RC2~64", "commitMessage": "Merge pull request #959 from dizzzz/feature/upgrade_to_tika_1.12\n\nUpgrade to Tika v1.12 ; fixes #937", "commitDateTime": "2016-03-27 16:33:47", "authoredDateTime": "2016-03-27 16:33:47", "commitGitStats": [{"filePath": "extensions/contentextraction/ivy.xml", "insertions": 23, "deletions": 12, "lines": 35}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "f447aec813b3319da32d13df2fad22ac8d22db8e", "commitGHEventType": "referenced", "commitUser": "wolfgangmm", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0.0, "deletions": 0.0, "lines": 0.0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "Log4j2 is not writing logs to the correct path", "body": "Log4j2 is writing its logs relative to where eXist is started from, not relative to where eXist is installed.\n\nThere is a PR which attempted to fix that - https://github.com/eXist-db/exist/pull/637. However the solution was not satisfactory.\n\nI have submitted patches to the Log4j project here - https://issues.apache.org/jira/browse/LOG4J2-1050. As soon as the most recent bugfix is merged to their codebase, I will add a SNAPSHOT build to my [adamretter/exist/tree/log4j-2.5 branch](https://github.com/adamretter/exist/tree/log4j-2.5) and send over a PR.\n\n**NOTE** This is absolutely required for eXist 3.0.\n", "url": "https://github.com/eXist-db/exist/issues/931", "user": "adamretter", "labels": ["bug"], "created": "2016-03-07 19:24:55", "closed": "2016-03-08 09:37:30", "commits": {"9e0fc5a638268d105d9683405f1bc4a48305ede7": {"commitGHEventType": "closed", "commitUser": "wolfgangmm"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "9e0fc5a638268d105d9683405f1bc4a48305ede7", "commitGHEventType": "closed", "commitUser": "wolfgangmm", "commitParents": ["5b5e3754389e0f563365a15f1108ab60127ff333"], "nameRev": "9e0fc5a638268d105d9683405f1bc4a48305ede7 tags/eXist-3.0.RC2~82^2", "commitMessage": "Make the log path relative to ${log4j:configParentLocation}\n\nCloses https://github.com/eXist-db/exist/issues/931\nCloses https://github.com/eXist-db/exist/pull/637\n", "commitDateTime": "2016-03-07 17:28:55", "authoredDateTime": "2015-10-14 17:28:24", "commitGitStats": [{"filePath": "log4j2.xml", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["9e0fc5a638268d105d9683405f1bc4a48305ede7"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "eXist-db 2.2 web.xml validation issue", "body": "Not sure if there are plans for maintenance releases in 2.x. But there is a validation issue with web.xml and it'd be great to fix it. There is a big stacktrace which ends with:\n\n```\nCaused by: javax.xml.stream.XMLStreamException: ParseError at [row,col]:[350,7]\nMessage: Unexpected element '{http://java.sun.com/xml/ns/j2ee}init-param' encountered\n```\n\nI face it when building war and deploying it under JBoss AS 7. Element `init-param` is not allowed as a child of `servlet-mapping` and should be added under `servlet` element instead. The issue occurs for `ResourceServlet`. The valid code will look like:\n\n```\n<servlet>\n   <servlet-name>ResourceServlet</servlet-name>\n   <servlet-class>\n      de.betterform.agent.web.resources.ResourceServlet\n   </servlet-class>\n   <init-param>\n      <param-name>caching</param-name>\n      <param-value>true</param-value>\n   </init-param>\n</servlet>\n...\n<servlet-mapping>\n   <servlet-name>ResourceServlet</servlet-name>\n   <url-pattern>/bfResources/*</url-pattern>\n</servlet-mapping>\n```\n", "url": "https://github.com/eXist-db/exist/issues/924", "user": "lagivan", "labels": ["bug"], "created": "2016-03-01 19:55:47", "closed": "2016-03-27 18:13:55", "commits": {"03fd3158af4561a2cc1b28bd06f941f6199987a2": {"commitGHEventType": "closed", "commitUser": "adamretter"}, "87effa53ca9ac02970c8ebd42bcca8d853e4b01d": {"commitGHEventType": "referenced", "commitUser": "adamretter"}, "2231edbbc73e56bcbdc2703f9ed76f490a3c9bc3": {"commitGHEventType": "referenced", "commitUser": "wolfgangmm"}}, "ttf": 25.00027777777778, "commitsDetails": [{"commitHash": "03fd3158af4561a2cc1b28bd06f941f6199987a2", "commitGHEventType": "closed", "commitUser": "adamretter", "commitParents": ["23effb548ad6acf097b007cad9cda710b544b037"], "nameRev": "03fd3158af4561a2cc1b28bd06f941f6199987a2 tags/eXist-3.0.RC2~67^2", "commitMessage": "make web.xml valid. fixes #924\n", "commitDateTime": "2016-03-26 19:38:35", "authoredDateTime": "2016-03-26 19:38:35", "commitGitStats": [{"filePath": "extensions/betterform/main/etc/MergeWebXML.xsl", "insertions": 10, "deletions": 22, "lines": 32}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "87effa53ca9ac02970c8ebd42bcca8d853e4b01d", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["23effb548ad6acf097b007cad9cda710b544b037", "03fd3158af4561a2cc1b28bd06f941f6199987a2"], "nameRev": "87effa53ca9ac02970c8ebd42bcca8d853e4b01d tags/eXist-3.0.RC2~67", "commitMessage": "Merge pull request #956 from dizzzz/feature/make_web.xml_valid\n\nmake web.xml valid. fixes #924", "commitDateTime": "2016-03-27 14:13:53", "authoredDateTime": "2016-03-27 14:13:53", "commitGitStats": [{"filePath": "extensions/betterform/main/etc/MergeWebXML.xsl", "insertions": 10, "deletions": 22, "lines": 32}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "2231edbbc73e56bcbdc2703f9ed76f490a3c9bc3", "commitGHEventType": "referenced", "commitUser": "wolfgangmm", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["03fd3158af4561a2cc1b28bd06f941f6199987a2"], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 10.0, "deletions": 22.0, "lines": 32.0, "gitFilesChange": 1}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["extensions/betterform/main/etc/MergeWebXML.xsl"]}, {"title": "Issue with attributes", "body": "Following query return also TEI:blibl elements with types different to linguistic (e.g. 'auxiliary')\n\n``` xquery\ncollection('/db/apps/lgpn-data/data/ling/names')//TEI:orth[.='Agatho\u0304nymos']/ancestor::TEI:entry//TEI:bibl[@type = 'linguistic']\n```\n\nif the query is split like this:  \n\n``` xquery\nlet $bibls  := collection('/db/apps/lgpn-data/data/ling/names')//TEI:orth[.='Agatho\u0304nymos']/ancestor::TEI:entry//TEI:bibl\nreturn $bibls[@type = 'linguistic']\n```\n\nthe results are as expected. \n\nI can provide access to a server demonstrating this issue if someone wants to have a look and fix it.\n", "url": "https://github.com/eXist-db/exist/issues/923", "user": "windauer", "labels": ["bug"], "created": "2016-02-29 14:13:58", "closed": "2018-10-15 08:28:53", "commits": {}, "ttf": 958.0002777777778, "commitsDetails": []}, {"title": "Use of \"order by\" in recursively called function drops NPE", "body": "There seems to be an issue with the use of \"order by\" in an recursively called function, leading to a NPE:\n\n> 2015-12-03 10:59:21,512 [eXistThread-123] WARN  (ServletHandler.java [doHandle]:563) - /exist/apps/tamboti/modules/search/index.html \n> javax.servlet.ServletException: An unknown error occurred: null\n>   at org.exist.http.servlets.EXistServlet.doPost(EXistServlet.java:460) ~[exist-optional.jar:?]\n>   at javax.servlet.http.HttpServlet.service(HttpServlet.java:755) ~[servlet-api-3.0.jar:?]\n>   at javax.servlet.http.HttpServlet.service(HttpServlet.java:848) ~[servlet-api-3.0.jar:?]\n\n[...]\n\n> Caused by: java.lang.NullPointerException\n>   at org.exist.xquery.OrderByClause.eval(OrderByClause.java:53) ~[exist.jar:?]\n>   at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:?]\n>   at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:?]\n>   at org.exist.xquery.ForExpr.processItem(ForExpr.java:238) ~[exist.jar:?]\n>   at org.exist.xquery.ForExpr.eval(ForExpr.java:178) ~[exist.jar:?]\n>   at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:?]\n>   at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155) ~[exist.jar:?]\n>   at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:330) ~[exist.jar:?]\n>   at org.exist.xquery.FunctionCall.eval(FunctionCall.java:234) ~[exist.jar:?]\n>   at org.exist.xquery.LetExpr.eval(LetExpr.java:99) ~[exist.jar:?]\n\n[...]\n\nSee full exception quoted here: http://pastebin.com/V9pNFiiL\n\nThis code will show the problem:\n\n``` xquery\nxquery version \"3.0\";\n\ndeclare function local:recursive($collection) {\n    let $subcollections := xmldb:get-child-collections($collection)\n    for $subcol in $subcollections\n        order by $subcol\n    return \n        let $fullpath := xs:anyURI($collection || \"/\" || $subcol)\n        return\n            <col name=\"{$fullpath}\">\n                {local:recursive($fullpath)}\n            </col>\n\n};\n\ndeclare function local:non-recursive($collection) {\n    let $subcollections := xmldb:get-child-collections($collection)\n    for $subcol in $subcollections\n        order by $subcol\n    return \n        let $fullpath := xs:anyURI($collection || \"/\" || $subcol)\n        return\n            <col name=\"{$fullpath}\">\n                {\n                    let $subcollections := xmldb:get-child-collections($fullpath)\n                    for $subcol in $subcollections\n                    order by $subcol\n                    return \n                        let $fullpath := xs:anyURI($collection || \"/\" || $subcol)\n                        return\n                            <col name=\"{$fullpath}\"/>\n                }\n            </col>\n};\n\nlocal:recursive(\"/db\")\n```\n\nlocal:non-recursive(\"/db\") works, local:recursive(\"/db\") drops NPE. Maybe related to: https://github.com/eXist-db/exist/issues/839 ?\n", "url": "https://github.com/eXist-db/exist/issues/845", "user": "ChiSamurai", "labels": ["bug"], "created": "2015-12-03 10:39:10", "closed": "2018-08-04 07:44:16", "commits": {}, "ttf": 974.0002777777778, "commitsDetails": []}, {"title": "Modification times for existing resources will change on a failed parse attempt after uploading using XML-RPC", "body": "While using eXist's XML-RPC API I encountered some strange behavior. When parsing an uploaded resource to overwrite an existing one, and parsing fails due to non-wellformed XHTML, the modification time of the old existing resource gets updated while its content does not get changed.\n\nIs this intended behavior? Because it strikes me as a little unlogical and it makes it tricky for example to only upload locally changed files to eXist by checking the mtimes in the database without some workarounds.\n\nThis seems to be happening on 2.2 and also 3RC1.\n", "url": "https://github.com/eXist-db/exist/issues/811", "user": "olvidalo", "labels": ["bug"], "created": "2015-10-16 15:02:48", "closed": "2016-03-31 15:55:10", "commits": {}, "ttf": 167.00027777777777, "commitsDetails": []}, {"title": "Problem POST-ing XML documents with RESTXQ trigger", "body": "With the following resource function:\n\n``` xquery\ndeclare\n    %rest:POST(\"{$data}\")\n    %rest:path(\"/test\")\nfunction test:test($data as document-node()) {\n    util:log('warn', $data),\n    <x/>\n};\n```\n\nand trying to POST a (valid) XML file:\n\n``` bash\ncurl -v -X POST http://localhost:8080/exist/restxq/test -H Content-Type:application/xml -d @test.xml\n```\n\nIt works the first time (or, rarely, first few times) and then does not work anymore unless eXist-db is restarted. Is there a problem with the resource function?\n- eXist-db 2.2\n\nFirst time returns HTTP 200 then consistently returns HTTP 500 Server Error with body:\n\n``` html\n<html>\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\"/>\n<title>Error 500 Server Error</title>\n</head>\n<body><h2>HTTP ERROR 500</h2>\n<p>Problem accessing /exist/restxq/test. Reason:\n<pre>    Server Error</pre></p><h3>Caused by:</h3><pre>java.lang.NullPointerException\n    at org.exist.extensions.exquery.restxq.impl.ResourceFunctionExecutorImpl.convertToExistSequence(ResourceFunctionExecutorImpl.java:334)\n    at org.exist.extensions.exquery.restxq.impl.ResourceFunctionExecutorImpl.convertToExistFunctionArguments(ResourceFunctionExecutorImpl.java:254)\n    at org.exist.extensions.exquery.restxq.impl.ResourceFunctionExecutorImpl.execute(ResourceFunctionExecutorImpl.java:165)\n    at org.exquery.restxq.impl.AbstractRestXqService.service(AbstractRestXqService.java:190)\n    at org.exist.extensions.exquery.restxq.impl.RestXqServiceImpl.service(RestXqServiceImpl.java:119)\n    at org.exist.extensions.exquery.restxq.impl.RestXqServlet.service(RestXqServlet.java:102)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n[...]\n```\n\nand message on standard output:\n\n```\n29 sept. 2015 14:15:35,071 [eXistThread-28] WARN  (ServletHandler.java [doHandle]:492) -  \njavax.servlet.ServletException: An error occurred while processing request to /exist/restxq/test: null\n    at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:383)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n    at org.eclipse.jetty.server.Server.handle(Server.java:368)\n    at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:488)\n    at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:932)\n    at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:994)\n    at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:647)\n    at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\n    at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n    at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.NullPointerException\n    at org.exist.extensions.exquery.restxq.impl.ResourceFunctionExecutorImpl.convertToExistSequence(ResourceFunctionExecutorImpl.java:334)\n    at org.exist.extensions.exquery.restxq.impl.ResourceFunctionExecutorImpl.convertToExistFunctionArguments(ResourceFunctionExecutorImpl.java:254)\n    at org.exist.extensions.exquery.restxq.impl.ResourceFunctionExecutorImpl.execute(ResourceFunctionExecutorImpl.java:165)\n    at org.exquery.restxq.impl.AbstractRestXqService.service(AbstractRestXqService.java:190)\n    at org.exist.extensions.exquery.restxq.impl.RestXqServiceImpl.service(RestXqServiceImpl.java:119)\n    at org.exist.extensions.exquery.restxq.impl.RestXqServlet.service(RestXqServlet.java:102)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n```\n- eXist-db 3.0RC1\n\nFirst time returns HTTP 200 then consistently returns HTTP 500 Server Error with body:\n\n``` html\n<html>\n<head>\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=ISO-8859-1\"/>\n<title>Error 500 Server Error</title>\n</head>\n<body><h2>HTTP ERROR 500</h2>\n<p>Problem accessing /exist/restxq/test. Reason:\n<pre>    Server Error</pre></p><h3>Caused by:</h3><pre>javax.servlet.ServletException: err:XPTY0004 Invalid cardinality for parameter $data. Expected exactly one, got 0 [at line 11, column 19, source: /db/apps/test-rest/modules/test.xql]\nIn function:\n    test:test(document-node()) [-1:-1:/db/apps/test-rest/modules/test.xql]\n    at org.exist.extensions.exquery.restxq.impl.RestXqServlet.service(RestXqServlet.java:125)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:684)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:503)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n[...]\n```\n\nand message in restxq.log:\n\n```\n2015-09-29 14:22:43,714 [eXistThread-33] ERROR (RestXqServlet.java [service]:124) - err:XPTY0004 Invalid cardinality for parameter $data. Expected exactly one, got 0 [at line 11, column 19, source: /db/apps/test-rest/modules/test.xql]\nIn function:\n    test:test(document-node()) [-1:-1:/db/apps/test-rest/modules/test.xql] \norg.exquery.restxq.RestXqServiceException: err:XPTY0004 Invalid cardinality for parameter $data. Expected exactly one, got 0 [at line 11, column 19, source: /db/apps/test-rest/modules/test.xql]\nIn function:\n    test:test(document-node()) [-1:-1:/db/apps/test-rest/modules/test.xql]\n    at org.exist.extensions.exquery.restxq.impl.ResourceFunctionExecutorImpl.execute(ResourceFunctionExecutorImpl.java:178) ~[exist-restxq.jar:?]\n    at org.exquery.restxq.impl.AbstractRestXqService.service(AbstractRestXqService.java:190) ~[exquery-restxq-1.0-SNAPSHOT.jar:1.0-SNAPSHOT]\n    at org.exist.extensions.exquery.restxq.impl.RestXqServiceImpl.service(RestXqServiceImpl.java:120) ~[exist-restxq.jar:?]\n    at org.exist.extensions.exquery.restxq.impl.RestXqServlet.service(RestXqServlet.java:103) [exist-restxq.jar:?]\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848) [servlet-api-3.0.jar:?]\n```\n\nA similar issue had been reported on exist-open for [binary data](http://exist.2174344.n4.nabble.com/RESTXQ-and-binary-data-as-parameter-td4666131.html) instead of XML.\n", "url": "https://github.com/eXist-db/exist/issues/801", "user": "ptrckb", "labels": ["bug"], "created": "2015-09-29 12:59:14", "closed": "2019-01-11 04:58:01", "commits": {}, "ttf": 1199.0002777777777, "commitsDetails": []}, {"title": "Unexpected results using ft:get-field() with whitespace analyzer index", "body": "I've been experimenting with the whitespace analyzer as a named field as a way to offer case- and punctuation-sensitive full text search alongside the standard case & punctuation-insensitive analyzer.  However I'm getting unexpected results with the named whitespace fields.  The results have been confirmed by @jensopetersen. Below are the test files (a fuller version demonstrating #794 too can be downloaded directly from http://markmail.org/message/heesn3keggjkkmbg):\n\n/db/apps/test/\n- collection.xconf\n- text.xml\n- test.xq\n\ntest.xml:\n\n``` xml\n<doc xmlns=\"test\">\n    <para>Hello, my name is Joe.</para>\n</doc>\n```\n\ncollection.xconf:\n\n``` xml\n<collection xmlns=\"http://exist-db.org/collection-config/1.0\" xmlns:test=\"test\">\n    <index xmlns:xs=\"http://www.w3.org/2001/XMLSchema\">\n        <fulltext default=\"none\" attributes=\"false\"/>\n        <lucene>\n            <analyzer class=\"org.apache.lucene.analysis.standard.StandardAnalyzer\"/>\n            <analyzer id=\"ws\" class=\"org.apache.lucene.analysis.core.WhitespaceAnalyzer\"/>\n            <text qname=\"test:para\"/>\n            <text qname=\"test:para\" field=\"para-standard\"/>\n            <text qname=\"test:para\" field=\"para-ws\" analyzer=\"ws\"/>\n        </lucene>\n    </index>\n</collection>\n```\n\ntest.xq runs several simple queries, the first two which work, the final which does not:\n\n``` xquery\nxquery version \"3.0\";\n\ndeclare namespace test = \"test\";\n\ndeclare function local:index-keys-by-qname($namespace-uri as xs:string, $qname as xs:string, $start-value as xs:string) {\n    let $qname := QName($namespace-uri, $qname)\n    let $start-value := $start-value\n    let $callback := function($term as xs:string, $data as xs:integer+) { <key>{$term}</key> }\n    let $max-number-returned := 100\n    let $index := 'lucene-index'\n    return\n        <keys>{ util:index-keys-by-qname($qname, $start-value, $callback, $max-number-returned, $index) }</keys>\n};\n\nlet $query1 := collection('/db/apps/test')//test:para[ft:query(., 'hello')]\n(: query2 should be identical to query1 :)\nlet $query2 := ft:query-field('para-standard', 'hello')\n(: query3 should use the whitespace analyzer - but isn't!? :)\nlet $query3 := ft:query-field('para-ws', 'Hello,')\nreturn\n    element result {\n        element query1 { $query1 },\n        element query2 { $query2 },\n        element query3 { $query3 }\n    }\n```\n\nThe results of this query, via eXide:\n\n``` xml\n<result>\n    <query1>\n        <para xmlns=\"test\">Hello, my name is Joe.</para>\n    </query1>\n    <query2>\n        <para xmlns=\"test\">Hello, my name is Joe.</para>\n    </query2>\n    <query3/>\n</result>\n```\n", "url": "https://github.com/eXist-db/exist/issues/795", "user": "joewiz", "labels": ["Lucene", "bug"], "created": "2015-09-23 13:44:17", "closed": "2020-04-09 14:25:25", "commits": {}, "ttf": 1660.0002777777777, "commitsDetails": []}, {"title": "Lucene KeywordAnalyzer cannot be found", "body": "Lucene's KeywordAnalyzer cannot be found on a standard trunk build.  When launching eXist with the following collection.xconf:\n\n``` xml\n<collection xmlns=\"http://exist-db.org/collection-config/1.0\" xmlns:test=\"test\">\n    <index xmlns:xs=\"http://www.w3.org/2001/XMLSchema\">\n        <fulltext default=\"none\" attributes=\"false\"/>\n        <lucene>\n            <analyzer class=\"org.apache.lucene.analysis.standard.StandardAnalyzer\"/>\n            <analyzer id=\"ws\" class=\"org.apache.lucene.analysis.core.WhitespaceAnalyzer\"/>\n            <analyzer id=\"keyword\" class=\"org.apache.lucene.analysis.core.KeywordAnalyzer\"/>\n            <text qname=\"test:para\"/>\n            <text qname=\"test:para\" field=\"para-standard\"/>\n            <text qname=\"test:para\" field=\"para-ws\" analyzer=\"ws\"/>\n            <text qname=\"test:para\" field=\"para-keyword\" analyzer=\"keyword\"/>\n        </lucene>\n    </index>\n</collection>\n```\n\nexist.log reports the following error:\n\n```\n23 Sep 2015 14:40:15,394 [main] DEBUG (AnalyzerConfig.java [createInstance]:261) - Using analyzer org.apache.lucene.analysis.standard.StandardAnalyzer\n23 Sep 2015 14:40:15,395 [main] DEBUG (AnalyzerConfig.java [createInstance]:261) - Using analyzer org.apache.lucene.analysis.core.WhitespaceAnalyzer\n23 Sep 2015 14:40:15,395 [main] ERROR (AnalyzerConfig.java [createInstance]:269) - Could not find matching analyzer class constructororg.apache.lucene.analysis.core.KeywordAnalyzer: org.apache.lucene.analysis.core.KeywordAnalyzer.<init>(org.apache.lucene.util.Version)\njava.lang.NoSuchMethodException: org.apache.lucene.analysis.core.KeywordAnalyzer.<init>(org.apache.lucene.util.Version)\n    at java.lang.Class.getConstructor0(Class.java:3082) ~[?:1.8.0_60]\n    \u2026\n```\n\nFor a reproducible test, including files, see this thread from exist-open: http://markmail.org/message/heesn3keggjkkmbg.\n", "url": "https://github.com/eXist-db/exist/issues/794", "user": "joewiz", "labels": ["bug"], "created": "2015-09-23 13:39:32", "closed": "2019-04-05 18:03:33", "commits": {}, "ttf": 1290.0002777777777, "commitsDetails": []}, {"title": "Bug in monitoring modul for indexes on attributes with namespace-prefixes", "body": "When working on a collection of rdf-documents with various indexes I have noticed that the monitoring app fails listing the entries for indexed attributes having a namespace prefix such as @rdf:about and @rdf:resource.\n\nThe error message indicates a problem with QName:\nerr:XPTY0004 checking function parameter 2 in call util:log(\"DEBUG\", concat(\"INDEXES qname     :    \", $indexes:qname)): Invalid lexical form of either prefix or local name. [at line 211, column 70, source: /db/apps/monex/modules/indexes.xqm]\n\nI guess the problem is in the code starting with line 38 in indexes.xm where the attribute name including  '@' is used as second argument for QName().\n\nLine 38: \n\n```\ndeclare variable $indexes:qname := \n    if ($indexes:node-name ne '') then \n        if (not(matches($indexes:node-name, 'xml:')) and contains($indexes:node-name, ':')) then\n            QName(indexes:get-namespace-uri-from-node-name($indexes:node-name, $indexes:collection), $indexes:node-name) \n        else \n            xs:QName($indexes:node-name)\n    else ();\n```\n\nreplacing $indexes:node-name with code that removes '@' if it is present seems to solve the problem:\n\n```\ndeclare variable $indexes:qname := \n    if ($indexes:node-name ne '') then \n        if (not(matches($indexes:node-name, 'xml:')) and contains($indexes:node-name, ':')) then\n            QName(indexes:get-namespace-uri-from-node-name($indexes:node-name, $indexes:collection), \n            if (starts-with($indexes:node-name, '@')) then substring-after($indexes:node-name,'@') else $indexes:node-name) \n        else \n            xs:QName($indexes:node-name)\n    else ();\n```\n", "url": "https://github.com/eXist-db/exist/issues/792", "user": "trondaal", "labels": ["bug"], "created": "2015-09-19 16:48:20", "closed": "2017-03-01 16:12:29", "commits": {}, "ttf": 528.0002777777778, "commitsDetails": []}, {"title": "Binary streaming is broken", "body": "To reproduce:\r\n# Error Case 1\r\n<a name=\"error-case-1\"/>\r\n1. Store a binary document into the database, e.g. `/db/me.jpg`.\r\n2. Run the XQuery:\r\n\r\n``` xquery\r\nimport module namespace util = \"http://exist-db.org/xquery/util\";\r\nutil:binary-doc(\"/db/me.jpg\")\r\n```\r\n\r\nand you will get an error and the stack trace:\r\n\r\n```\r\n2015-10-05 13:06:22,965 [eXistThread-33] INFO  (RpcConnection.java [doQuery]:253) - query took 2ms. \r\n2015-10-05 13:06:22,966 [eXistThread-33] ERROR (XmlRpcErrorLogger.java [log]:36) - Failed to invoke method queryP in class org.exist.xmlrpc.RpcConnection: org.exist.xquery.XPathException: exerr:ERROR Unable to encode string value: The underlying InputStream has been closed \r\norg.apache.xmlrpc.common.XmlRpcInvocationException: Failed to invoke method queryP in class org.exist.xmlrpc.RpcConnection: org.exist.xquery.XPathException: exerr:ERROR Unable to encode string value: The underlying InputStream has been closed\r\n    at org.apache.xmlrpc.server.ReflectiveXmlRpcHandler.invoke(ReflectiveXmlRpcHandler.java:129) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.apache.xmlrpc.server.ReflectiveXmlRpcHandler.execute(ReflectiveXmlRpcHandler.java:106) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.apache.xmlrpc.server.XmlRpcServerWorker.execute(XmlRpcServerWorker.java:46) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.apache.xmlrpc.server.XmlRpcServer.execute(XmlRpcServer.java:86) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.apache.xmlrpc.server.XmlRpcStreamServer.execute(XmlRpcStreamServer.java:200) [xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.apache.xmlrpc.webserver.XmlRpcServletServer.execute(XmlRpcServletServer.java:112) [xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.apache.xmlrpc.webserver.XmlRpcServlet.doPost(XmlRpcServlet.java:196) [xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.exist.xmlrpc.RpcServlet.doPost(RpcServlet.java:67) [eXist/:?]\r\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:755) [servlet-api-3.0.jar:?]\r\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848) [servlet-api-3.0.jar:?]\r\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:684) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:503) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575) [jetty-security-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:429) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:50) [eXist/:?]\r\n    at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:223) [eXist/:?]\r\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848) [servlet-api-3.0.jar:?]\r\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:684) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:503) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533) [jetty-security-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:429) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.Server.handle(Server.java:370) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:494) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:982) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:1043) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:865) [jetty-http-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:240) [jetty-http-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:696) [jetty-io-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:53) [jetty-io-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608) [jetty-util-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543) [jetty-util-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at java.lang.Thread.run(Thread.java:745) [?:1.8.0_51]\r\nCaused by: org.exist.EXistException: org.exist.xquery.XPathException: exerr:ERROR Unable to encode string value: The underlying InputStream has been closed\r\n    at org.exist.xmlrpc.RpcConnection.lambda$queryP$285(RpcConnection.java:1756) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection$$Lambda$135/2006309794.applyXmlRpc(Unknown Source) ~[?:?]\r\n    at org.exist.xmlrpc.function.XmlRpcFunction.apply(XmlRpcFunction.java:45) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.withDb(RpcConnection.java:3764) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.withDb(RpcConnection.java:3748) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.queryP(RpcConnection.java:1662) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.queryP(RpcConnection.java:3387) ~[eXist/:?]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_51]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_51]\r\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_51]\r\n    at java.lang.reflect.Method.invoke(Method.java:497) ~[?:1.8.0_51]\r\n    at org.apache.xmlrpc.server.ReflectiveXmlRpcHandler.invoke(ReflectiveXmlRpcHandler.java:115) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    ... 48 more\r\nCaused by: org.exist.xquery.XPathException: exerr:ERROR Unable to encode string value: The underlying InputStream has been closed\r\n    at org.exist.xquery.value.BinaryValue.getStringValue(BinaryValue.java:225) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.lambda$queryP$285(RpcConnection.java:1738) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection$$Lambda$135/2006309794.applyXmlRpc(Unknown Source) ~[?:?]\r\n    at org.exist.xmlrpc.function.XmlRpcFunction.apply(XmlRpcFunction.java:45) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.withDb(RpcConnection.java:3764) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.withDb(RpcConnection.java:3748) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.queryP(RpcConnection.java:1662) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.queryP(RpcConnection.java:3387) ~[eXist/:?]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_51]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_51]\r\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_51]\r\n    at java.lang.reflect.Method.invoke(Method.java:497) ~[?:1.8.0_51]\r\n    at org.apache.xmlrpc.server.ReflectiveXmlRpcHandler.invoke(ReflectiveXmlRpcHandler.java:115) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    ... 48 more\r\nCaused by: java.io.IOException: The underlying InputStream has been closed\r\n    at org.exist.util.io.CachingFilterInputStream.read(CachingFilterInputStream.java:135) ~[eXist/:?]\r\n    at org.exist.util.io.CachingFilterInputStream.read(CachingFilterInputStream.java:128) ~[eXist/:?]\r\n    at org.exist.xquery.value.BinaryValueFromInputStream.streamBinaryTo(BinaryValueFromInputStream.java:73) ~[eXist/:?]\r\n    at org.exist.xquery.value.BinaryValue.streamTo(BinaryValue.java:254) ~[eXist/:?]\r\n    at org.exist.xquery.value.BinaryValue.getStringValue(BinaryValue.java:223) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.lambda$queryP$285(RpcConnection.java:1738) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection$$Lambda$135/2006309794.applyXmlRpc(Unknown Source) ~[?:?]\r\n    at org.exist.xmlrpc.function.XmlRpcFunction.apply(XmlRpcFunction.java:45) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.withDb(RpcConnection.java:3764) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.withDb(RpcConnection.java:3748) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.queryP(RpcConnection.java:1662) ~[eXist/:?]\r\n    at org.exist.xmlrpc.RpcConnection.queryP(RpcConnection.java:3387) ~[eXist/:?]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_51]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_51]\r\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_51]\r\n    at java.lang.reflect.Method.invoke(Method.java:497) ~[?:1.8.0_51]\r\n    at org.apache.xmlrpc.server.ReflectiveXmlRpcHandler.invoke(ReflectiveXmlRpcHandler.java:115) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    ... 48 more\r\n```\r\n# Error Case 2\r\n<a name=\"error-case-2\"/>\r\n1. Store the following XQuery into `/db/stream-image.xqy`:\r\n\r\n``` xquery\r\nimport module namespace util = \"http://exist-db.org/xquery/util\";\r\nimport module namespace response = \"http://exist-db.org/xquery/response\";\r\n\r\nlet $bin := util:binary-doc(\"/db/me.jpg\")\r\nreturn\r\n    response:stream($bin, \"media-type=image/jpeg\")\r\n```\r\n1. Give execute rights to all users for `/db/stream-image.xqy`.\r\n2. Call the stored query using curl. e.g. `curl -v http://localhost:8080/exist/rest/db/stream-image.xqy`\r\n\r\nYou will see that the output is actually Base64 encoded text and not binary data as it should be:\r\n\r\n```\r\n*   Trying ::1...\r\n* Connected to localhost (::1) port 8080 (#0)\r\n> GET /exist/rest/db/stream-image.xqy HTTP/1.1\r\n> Host: localhost:8080\r\n> User-Agent: curl/7.43.0\r\n> Accept: */*\r\n> \r\n< HTTP/1.1 200 OK\r\n< Date: Mon, 05 Oct 2015 12:21:59 GMT\r\n< Set-Cookie: JSESSIONID=1wk1bvpjy6o7z1vref7uoymvd1;Path=/exist\r\n< Expires: Thu, 01 Jan 1970 00:00:00 GMT\r\n< X-XQuery-Cached: true\r\n< Content-Type: image/jpeg; charset=UTF-8\r\n< Transfer-Encoding: chunked\r\n< Server: Jetty(8.1.17.v20150415)\r\n< \r\n* Connection #0 to host localhost left intact\r\n/9j/4AAQSkZJRgABAQAAAQABAAD//gA7Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2ODApLCBxdWFsaXR5ID0gOTAK/9sAQwADAgIDAgIDAwMDBAMDBAUIBQUEBAUKBwcGCAwKDAwLCgsLDQ4SEA0OEQ4LCxAWEBETFBUVFQwPFxgWFBgSFBUU/9sAQwEDBAQFBAUJBQUJFA0LDRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU/8AAEQgAYABgAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A/KvHy5oNO2nAHvQkbSSBQMkntQA3+HPekqeSMRs69CDjBrc8K6DHqSvLKAy5wM549aAMOzspb6dIokLOxwABXp/hf4E6nqwElz/o8Z6ZHNerfAn4V6bfSy6ncWwmWIiOLf3b1/CvqDQ/AsEtuNyDOMDAoA+NR+ztcxShY3lCYyCDmuc174Xa14dQzQL9pWM/MvRuv61+iVv4CihjP7jK9MgVh+IvhjZ6ojqYQh6AmgD4I0LVUuV8osY50O1opOGB/Gt0Tcc4zXsHxJ+BVjbyyTRwmG6HKTpwC3o31rxi5he0maOTCuh2t6UASmUqODkHjGaY0uOV+XsOe9VJJtp4f8Kia4Lrtzj3NAHlETQ5j3c4ya734HS+DIfiXoUnjS0vL7w8JCbqGykEch4OME5HWuD8xdijy48hSQc+tNsJSl5Ey8Y54NAHqP7QL/Dy48e3z+ArS/s9FdiUjv5Fdxx6gVyXgyQfJGMbiTtDHAyelYyaZea/rcFlZQPd3c7bY4k6u3pXW+FdCfS9QFpqEEkF7DJteFxyjA9CKAPtX4F6PFa+GokKgvjJI6FjX0N4X0IMIcgsD0rwD4MxyWVhb+YCisAQr9eelfVfhGD/AEaFiFJ6g56UAdBpvgyWSEsIgI+OcVm6z4QRGJIAJ74616Po+reXb+U0ZII4OOtZPiZmmjVlXGOOlAHzh8Q/B4ltpBsDEgjPocV8G/FPS5dC8UTocpFLlwMdG6Gv0p8XQPMOYycH86/P39qDRtQvvESRaVE0lyqSyNGg5CqNzH8AM0AeSS3qKMvJj6nFZtz4jtYFG2TzW9FGa4ee+llbLyMzH1NNErFs8g9BQBfmayMOfLYNt9e9QWYi+1KRkKF5OKiZ0kBPei3bEhkBxjvQB6j+zusL/Gnw8XUSlmmRFb++YX2/rivcf2g/BA0z4s6XfQIHTUBHFLKibd0g4PQdcDmvnX4K6kdJ+LHhG8LhdmqQ7mJ4ALBefzr7k/aEv47+98JXEtt5LRXyxRl1yCvz5I/H+QoAt6Nbz6TFaeTA1y6EZRD1H9K7ub4leKfDVv8AavJ08wbTttZbpIyoHYliM0/wpo0Wp2OfMeP5QgZDyaq6j8IdIkuJXvYjfl2DjdKVcEArwwOccnIzg55FAHpfwt/aHvtb2Wur6RaWxc/L9nnEn06E/oTXd+M/iRp2iaZJdXCpECPkDdz2Ar5/n0W9k1iDUWWNWhaNUWFFQKigALwBnoK3viPNqGp6l4dkzEjBW2rIgK78DGQeKAOH8RfG/XfFN3cWWnHR7PDYVpLgCTB6fLyc/hXzX8erzV9Le91C72pdR2EsDXELDDGQFM/XDYr6TvPhrHdPqrJZi3n1Q5u2P3T85f5R/D8xzxivG/2sfD0dh4OtLZG8wyzKrlzngc0AfC5VRk9/SnDIGD+vFdlJ4XhWLJfYME/KK4WXAlcAlgCQCepFAFgZKEDGc9akgUZO4/SkwflzwCOtOiyN5PG3t60ATW0/2aeOdGKPGd4I/vAgjH5V9ueMvjJ4W+L3w88GR6fqcEHiO2uI2k0zY3mKQhEhJ9MgEHvmvhuRspjpxW54H1kaH4z0y6LgRpcBWP8Asng/zoA/Vf4TTLcW9vG/HyjIPavZL2HQrW0jluS8k2PlhReWP1/+tXzv8OtQJhivIJMxTRK6Advb+tbr+IL+LVoZbySaSJmIj8kDGR/CMnrgg4780AdbrOp/aNQGywW2iWRF2l9x+Y96PiNbSWa6NO0I8oMCd5xnvWFdhb25Mq3ctlMcNsuoyg3DP1HWq3jbxhPqVraR3Ukt5FZhcC2jZ1yOnJwAPbNAHpdk2manppCgpOo+aOTn9a+Qv2uoo47WOLgDz1ZR74bj8hXtnhrxDNr8MOpWSSW1r2eQ/fUDnj0/rXyl+1Z8R7B/FsWkzXK74szPwScngZxQB4ZrR+z6bdMOAsZP04ryWvT/ABPeJJol4YmLjZjcBxgmvMKAO68d/DXXPh7eafBrNm1nJe2sd3CH/iicZVh9a5XYBJIDnOfwrV13Ub2+u4nurmWd1UIGlbdgAYAFZMhKgnvnqTQA2RQq8eg6CiDdPfW6LgMzqvTvnFQyS5TA4P1rqvhT4ebxH4xsIQu9EkEjj0A5zQB9kfBL4gvo4i0a+l2NCB5JY8uPT8Oa+hA1pr2hywuco58xWUYKv618y674Ommt7bUbGMm8tyGOzqR3Fdl8Pfid/ZssVtqO4x7gIy/3VPcHP44oA+g/C2t+JNHtHjFzaXigHZ9tiLtg5zzuB7nr6muT8eXfibxbL9nu54obEkeYtuuxWXAAGMnOMH8667Q4bbX9Pae5mWOBh8pjwGrifiZrEXgWyaZLtXRUYorHk8UAcR8UPitafCbwXdlbgFihgt4hwSR6Ad/8a/O/xB4gvPF3iK71W+lL3FzJ5jZ5ABPAHtXY/Gz4m3fjrxEV81msrcnYjH5dxPJxXn0E6B1yB1H40Ad9rMSjwxeY+UiMHnvzXmlek6/OraDdoGXJRe/uK82AyaANq5nMkyLzkZ5rLnbKkZyd1D+Y4yzk00x4xQA3BIFesfs33Udl8Q7NJeFukeD8SMj+VeZQQbxknp1xXSeELybw/rdjfRZMlvOsy+5BBxQB+i3hfRo5SIZBkkDaMdareIvhGlzOZbeEAvwy9BXf2uiSw6bpeqpbyR2l7bR3MEm35WR1DKQe/BHSuts4ftlopYAk8CgD5/GheNfDMLQ2Ms8dvjAUurJ+BbpXL+J/DWq3+mz3ms3ctxIqny42bIDEflx9K+nr7RZrgbWz5QOcHpXBa74cm1/UBp8EDykHbsjUksc9hQB+a/j/AMA3vhy4leRHMIfBcjgZyQM++DXGRw5YMjfdOT7V+sHxb/ZJkvv2f/F81zbAeIPs4vbZB1j8nL7TjqSu4e2RX5USw/Z7p1JIwe1AF/W76K5twI5CxxyCMGuf6GtjygUUg9eOnSoWsSRnA696AP/Z\r\n```\r\n# Error Case 3\r\n<a name=\"error-case-3\"/>\r\n1. Store a binary document into a temporary location on your filesystem, e.g. `/tmp/me.jpg`.\r\n2. Run the XQuery:\r\n\r\n``` xquery\r\nimport module namespace file = \"http://exist-db.org/xquery/file\";\r\nfile:read-binary(\"/tmp/me.jpg\")\r\n```\r\n\r\nand you will get an error and the stack trace:\r\n\r\n```\r\n2015-10-05 13:27:03,941 [eXistThread-29] INFO  (RpcConnection.java [doQuery]:253) - query took 2ms. \r\n2015-10-05 13:27:03,943 [eXistThread-29] ERROR (XmlRpcErrorLogger.java [log]:36) - Failed to invoke method queryP in class org.exist.xmlrpc.RpcConnection: org.exist.xquery.XPathException: exerr:ERROR Unable to encode string value: Underlying channel has been closed \r\norg.apache.xmlrpc.common.XmlRpcInvocationException: Failed to invoke method queryP in class org.exist.xmlrpc.RpcConnection: org.exist.xquery.XPathException: exerr:ERROR Unable to encode string value: Underlying channel has been closed\r\n    at org.apache.xmlrpc.server.ReflectiveXmlRpcHandler.invoke(ReflectiveXmlRpcHandler.java:129) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.apache.xmlrpc.server.ReflectiveXmlRpcHandler.execute(ReflectiveXmlRpcHandler.java:106) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.apache.xmlrpc.server.XmlRpcServerWorker.execute(XmlRpcServerWorker.java:46) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.apache.xmlrpc.server.XmlRpcServer.execute(XmlRpcServer.java:86) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.apache.xmlrpc.server.XmlRpcStreamServer.execute(XmlRpcStreamServer.java:200) [xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.apache.xmlrpc.webserver.XmlRpcServletServer.execute(XmlRpcServletServer.java:112) [xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.apache.xmlrpc.webserver.XmlRpcServlet.doPost(XmlRpcServlet.java:196) [xmlrpc-server-3.1.3.jar:3.1.3]\r\n    at org.exist.xmlrpc.RpcServlet.doPost(RpcServlet.java:67) [exist.jar:?]\r\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:755) [servlet-api-3.0.jar:?]\r\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848) [servlet-api-3.0.jar:?]\r\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:684) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:503) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575) [jetty-security-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:429) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:50) [exist-optional.jar:?]\r\n    at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:223) [exist-optional.jar:?]\r\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848) [servlet-api-3.0.jar:?]\r\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:684) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:503) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533) [jetty-security-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:429) [jetty-servlet-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.Server.handle(Server.java:370) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:494) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:982) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:1043) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:865) [jetty-http-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:240) [jetty-http-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82) [jetty-server-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:696) [jetty-io-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:53) [jetty-io-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608) [jetty-util-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543) [jetty-util-8.1.17.v20150415.jar:8.1.17.v20150415]\r\n    at java.lang.Thread.run(Thread.java:745) [?:1.8.0_51]\r\nCaused by: org.exist.EXistException: org.exist.xquery.XPathException: exerr:ERROR Unable to encode string value: Underlying channel has been closed\r\n    at org.exist.xmlrpc.RpcConnection.lambda$queryP$333(RpcConnection.java:1756) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection$$Lambda$109/1906088310.applyXmlRpc(Unknown Source) ~[?:?]\r\n    at org.exist.xmlrpc.function.XmlRpcFunction.apply(XmlRpcFunction.java:45) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.withDb(RpcConnection.java:3764) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.withDb(RpcConnection.java:3748) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.queryP(RpcConnection.java:1662) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.queryP(RpcConnection.java:3387) ~[exist.jar:?]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_51]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_51]\r\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_51]\r\n    at java.lang.reflect.Method.invoke(Method.java:497) ~[?:1.8.0_51]\r\n    at org.apache.xmlrpc.server.ReflectiveXmlRpcHandler.invoke(ReflectiveXmlRpcHandler.java:115) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    ... 48 more\r\nCaused by: org.exist.xquery.XPathException: exerr:ERROR Unable to encode string value: Underlying channel has been closed\r\n    at org.exist.xquery.value.BinaryValue.getStringValue(BinaryValue.java:225) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.lambda$queryP$333(RpcConnection.java:1738) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection$$Lambda$109/1906088310.applyXmlRpc(Unknown Source) ~[?:?]\r\n    at org.exist.xmlrpc.function.XmlRpcFunction.apply(XmlRpcFunction.java:45) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.withDb(RpcConnection.java:3764) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.withDb(RpcConnection.java:3748) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.queryP(RpcConnection.java:1662) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.queryP(RpcConnection.java:3387) ~[exist.jar:?]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_51]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_51]\r\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_51]\r\n    at java.lang.reflect.Method.invoke(Method.java:497) ~[?:1.8.0_51]\r\n    at org.apache.xmlrpc.server.ReflectiveXmlRpcHandler.invoke(ReflectiveXmlRpcHandler.java:115) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    ... 48 more\r\nCaused by: java.io.IOException: Underlying channel has been closed\r\n    at org.exist.xquery.value.BinaryValueFromFile.streamBinaryTo(BinaryValueFromFile.java:56) ~[exist.jar:?]\r\n    at org.exist.xquery.value.BinaryValue.streamTo(BinaryValue.java:254) ~[exist.jar:?]\r\n    at org.exist.xquery.value.BinaryValue.getStringValue(BinaryValue.java:223) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.lambda$queryP$333(RpcConnection.java:1738) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection$$Lambda$109/1906088310.applyXmlRpc(Unknown Source) ~[?:?]\r\n    at org.exist.xmlrpc.function.XmlRpcFunction.apply(XmlRpcFunction.java:45) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.withDb(RpcConnection.java:3764) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.withDb(RpcConnection.java:3748) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.queryP(RpcConnection.java:1662) ~[exist.jar:?]\r\n    at org.exist.xmlrpc.RpcConnection.queryP(RpcConnection.java:3387) ~[exist.jar:?]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_51]\r\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_51]\r\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_51]\r\n    at java.lang.reflect.Method.invoke(Method.java:497) ~[?:1.8.0_51]\r\n    at org.apache.xmlrpc.server.ReflectiveXmlRpcHandler.invoke(ReflectiveXmlRpcHandler.java:115) ~[xmlrpc-server-3.1.3.jar:3.1.3]\r\n    ... 48 more\r\n```\r\n# Error Case 4\r\n<a name=\"error-case-4\"/>\r\n1. Store a binary document into a temporary location on your filesystem, e.g. `/tmp/me.jpg`.\r\n2. Run the XQuery:\r\n\r\n``` xquery\r\nimport module namespace file = \"http://exist-db.org/xquery/file\";\r\nlet $bin := file:read-binary(\"/Users/aretter/Downloads/me.jpg\")\r\nreturn\r\n    file:serialize-binary($bin, \"/Users/aretter/Downloads/me2.jpg\")\r\n```\r\n\r\nand you will get the stack trace:\r\n\r\n```\r\norg.xmldb.api.base.XMLDBException: exerr:ERROR Cannot serialize file. A problem occurred while serializing the binary data: /tmp/me2.jpg [at line 3, column 9]\r\n    at org.exist.xmldb.LocalXPathQueryService.execute(LocalXPathQueryService.java:206)\r\n    at org.exist.xmldb.LocalXPathQueryService.lambda$execute$273(LocalXPathQueryService.java:170)\r\n    at org.exist.xmldb.LocalXPathQueryService$$Lambda$139/1854632053.applyXmldb(Unknown Source)\r\n    at org.exist.xmldb.function.LocalXmldbFunction.apply(LocalXmldbFunction.java:46)\r\n    at org.exist.xmldb.AbstractLocal.withDb(AbstractLocal.java:142)\r\n    at org.exist.xmldb.LocalXPathQueryService.execute(LocalXPathQueryService.java:169)\r\n    at org.exist.client.QueryDialog$QueryThread.run(QueryDialog.java:624)\r\nCaused by: org.exist.xquery.XPathException: exerr:ERROR Cannot serialize file. A problem occurred while serializing the binary data: /tmp/me2.jpg [at line 3, column 9]\r\n    at org.exist.xquery.modules.file.SerializeToFile.serializeBinary(SerializeToFile.java:228)\r\n    at org.exist.xquery.modules.file.SerializeToFile.eval(SerializeToFile.java:173)\r\n    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\r\n    at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:56)\r\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\r\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\r\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\r\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n    at org.exist.xquery.XQuery.execute(XQuery.java:280)\r\n    at org.exist.xquery.XQuery.execute(XQuery.java:200)\r\n    at org.exist.xmldb.LocalXPathQueryService.execute(LocalXPathQueryService.java:203)\r\n    ... 6 more\r\nCaused by: java.nio.file.NoSuchFileException: /tmp/me2.jpg\r\n    at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)\r\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)\r\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)\r\n    at sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:214)\r\n    at java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:434)\r\n    at java.nio.file.Files.newOutputStream(Files.java:216)\r\n    at org.exist.xquery.modules.file.SerializeToFile.serializeBinary(SerializeToFile.java:225)\r\n    ... 17 more\r\nCaused by: org.exist.xquery.XPathException: exerr:ERROR Cannot serialize file. A problem occurred while serializing the binary data: /tmp/me2.jpg [at line 3, column 9]\r\n    at org.exist.xquery.modules.file.SerializeToFile.serializeBinary(SerializeToFile.java:228)\r\n    at org.exist.xquery.modules.file.SerializeToFile.eval(SerializeToFile.java:173)\r\n    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\r\n    at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:56)\r\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\r\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:111)\r\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:267)\r\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\r\n    at org.exist.xquery.XQuery.execute(XQuery.java:280)\r\n    at org.exist.xquery.XQuery.execute(XQuery.java:200)\r\n    at org.exist.xmldb.LocalXPathQueryService.execute(LocalXPathQueryService.java:203)\r\n    at org.exist.xmldb.LocalXPathQueryService.lambda$execute$273(LocalXPathQueryService.java:170)\r\n    at org.exist.xmldb.LocalXPathQueryService$$Lambda$139/1854632053.applyXmldb(Unknown Source)\r\n    at org.exist.xmldb.function.LocalXmldbFunction.apply(LocalXmldbFunction.java:46)\r\n    at org.exist.xmldb.AbstractLocal.withDb(AbstractLocal.java:142)\r\n    at org.exist.xmldb.LocalXPathQueryService.execute(LocalXPathQueryService.java:169)\r\n    at org.exist.client.QueryDialog$QueryThread.run(QueryDialog.java:624)\r\nCaused by: java.nio.file.NoSuchFileException: /tmp/me2.jpg\r\n    at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)\r\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)\r\n    at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)\r\n    at sun.nio.fs.UnixFileSystemProvider.newByteChannel(UnixFileSystemProvider.java:214)\r\n    at java.nio.file.spi.FileSystemProvider.newOutputStream(FileSystemProvider.java:434)\r\n    at java.nio.file.Files.newOutputStream(Files.java:216)\r\n    at org.exist.xquery.modules.file.SerializeToFile.serializeBinary(SerializeToFile.java:225)\r\n    ... 17 more\r\n```\r\n# Error Case 5\r\n<a name=\"error-case-5\"/>\r\n1. Store the following XQuery into `/db/stream-from-fs.xqy`:\r\n\r\n``` xquery\r\nimport module namespace file = \"http://exist-db.org/xquery/file\";\r\nimport module namespace response = \"http://exist-db.org/xquery/response\";\r\n\r\nlet $bin := file:read-binary(\"/tmp/me.jpg\")\r\nreturn\r\n    response:stream($bin, \"media-type=image/jpeg\")\r\n```\r\n1. Call the stored query as an admin user using curl. e.g. `curl -v http://admin:@localhost:8080/exist/rest/db/stream-from-fs.xqy`\r\n\r\nYou will see that the output is actually Base64 encoded text and not binary data as it should be:\r\n\r\n```\r\n*   Trying ::1...\r\n* Connected to localhost (::1) port 8080 (#0)\r\n* Server auth using Basic with user 'admin'\r\n> GET /exist/rest/db/stream-from-fs.xqy HTTP/1.1\r\n> Host: localhost:8080\r\n> Authorization: Basic YWRtaW46\r\n> User-Agent: curl/7.43.0\r\n> Accept: */*\r\n> \r\n< HTTP/1.1 200 OK\r\n< Date: Mon, 05 Oct 2015 12:39:11 GMT\r\n< Set-Cookie: JSESSIONID=17z1kikjckqlbmfs2w8pv56dw;Path=/exist\r\n< Expires: Thu, 01 Jan 1970 00:00:00 GMT\r\n< X-XQuery-Cached: true\r\n< Content-Type: image/jpeg; charset=UTF-8\r\n< Transfer-Encoding: chunked\r\n< Server: Jetty(8.1.17.v20150415)\r\n< \r\n* Connection #0 to host localhost left intact\r\n/9j/4AAQSkZJRgABAQAAAQABAAD//gA7Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2ODApLCBxdWFsaXR5ID0gOTAK/9sAQwADAgIDAgIDAwMDBAMDBAUIBQUEBAUKBwcGCAwKDAwLCgsLDQ4SEA0OEQ4LCxAWEBETFBUVFQwPFxgWFBgSFBUU/9sAQwEDBAQFBAUJBQUJFA0LDRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU/8AAEQgAYABgAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A/KvHy5oNO2nAHvQkbSSBQMkntQA3+HPekqeSMRs69CDjBrc8K6DHqSvLKAy5wM549aAMOzspb6dIokLOxwABXp/hf4E6nqwElz/o8Z6ZHNerfAn4V6bfSy6ncWwmWIiOLf3b1/CvqDQ/AsEtuNyDOMDAoA+NR+ztcxShY3lCYyCDmuc174Xa14dQzQL9pWM/MvRuv61+iVv4CihjP7jK9MgVh+IvhjZ6ojqYQh6AmgD4I0LVUuV8osY50O1opOGB/Gt0Tcc4zXsHxJ+BVjbyyTRwmG6HKTpwC3o31rxi5he0maOTCuh2t6UASmUqODkHjGaY0uOV+XsOe9VJJtp4f8Kia4Lrtzj3NAHlETQ5j3c4ya734HS+DIfiXoUnjS0vL7w8JCbqGykEch4OME5HWuD8xdijy48hSQc+tNsJSl5Ey8Y54NAHqP7QL/Dy48e3z+ArS/s9FdiUjv5Fdxx6gVyXgyQfJGMbiTtDHAyelYyaZea/rcFlZQPd3c7bY4k6u3pXW+FdCfS9QFpqEEkF7DJteFxyjA9CKAPtX4F6PFa+GokKgvjJI6FjX0N4X0IMIcgsD0rwD4MxyWVhb+YCisAQr9eelfVfhGD/AEaFiFJ6g56UAdBpvgyWSEsIgI+OcVm6z4QRGJIAJ74616Po+reXb+U0ZII4OOtZPiZmmjVlXGOOlAHzh8Q/B4ltpBsDEgjPocV8G/FPS5dC8UTocpFLlwMdG6Gv0p8XQPMOYycH86/P39qDRtQvvESRaVE0lyqSyNGg5CqNzH8AM0AeSS3qKMvJj6nFZtz4jtYFG2TzW9FGa4ee+llbLyMzH1NNErFs8g9BQBfmayMOfLYNt9e9QWYi+1KRkKF5OKiZ0kBPei3bEhkBxjvQB6j+zusL/Gnw8XUSlmmRFb++YX2/rivcf2g/BA0z4s6XfQIHTUBHFLKibd0g4PQdcDmvnX4K6kdJ+LHhG8LhdmqQ7mJ4ALBefzr7k/aEv47+98JXEtt5LRXyxRl1yCvz5I/H+QoAt6Nbz6TFaeTA1y6EZRD1H9K7ub4leKfDVv8AavJ08wbTttZbpIyoHYliM0/wpo0Wp2OfMeP5QgZDyaq6j8IdIkuJXvYjfl2DjdKVcEArwwOccnIzg55FAHpfwt/aHvtb2Wur6RaWxc/L9nnEn06E/oTXd+M/iRp2iaZJdXCpECPkDdz2Ar5/n0W9k1iDUWWNWhaNUWFFQKigALwBnoK3viPNqGp6l4dkzEjBW2rIgK78DGQeKAOH8RfG/XfFN3cWWnHR7PDYVpLgCTB6fLyc/hXzX8erzV9Le91C72pdR2EsDXELDDGQFM/XDYr6TvPhrHdPqrJZi3n1Q5u2P3T85f5R/D8xzxivG/2sfD0dh4OtLZG8wyzKrlzngc0AfC5VRk9/SnDIGD+vFdlJ4XhWLJfYME/KK4WXAlcAlgCQCepFAFgZKEDGc9akgUZO4/SkwflzwCOtOiyN5PG3t60ATW0/2aeOdGKPGd4I/vAgjH5V9ueMvjJ4W+L3w88GR6fqcEHiO2uI2k0zY3mKQhEhJ9MgEHvmvhuRspjpxW54H1kaH4z0y6LgRpcBWP8Asng/zoA/Vf4TTLcW9vG/HyjIPavZL2HQrW0jluS8k2PlhReWP1/+tXzv8OtQJhivIJMxTRK6Advb+tbr+IL+LVoZbySaSJmIj8kDGR/CMnrgg4780AdbrOp/aNQGywW2iWRF2l9x+Y96PiNbSWa6NO0I8oMCd5xnvWFdhb25Mq3ctlMcNsuoyg3DP1HWq3jbxhPqVraR3Ukt5FZhcC2jZ1yOnJwAPbNAHpdk2manppCgpOo+aOTn9a+Qv2uoo47WOLgDz1ZR74bj8hXtnhrxDNr8MOpWSSW1r2eQ/fUDnj0/rXyl+1Z8R7B/FsWkzXK74szPwScngZxQB4ZrR+z6bdMOAsZP04ryWvT/ABPeJJol4YmLjZjcBxgmvMKAO68d/DXXPh7eafBrNm1nJe2sd3CH/iicZVh9a5XYBJIDnOfwrV13Ub2+u4nurmWd1UIGlbdgAYAFZMhKgnvnqTQA2RQq8eg6CiDdPfW6LgMzqvTvnFQyS5TA4P1rqvhT4ebxH4xsIQu9EkEjj0A5zQB9kfBL4gvo4i0a+l2NCB5JY8uPT8Oa+hA1pr2hywuco58xWUYKv618y674Ommt7bUbGMm8tyGOzqR3Fdl8Pfid/ZssVtqO4x7gIy/3VPcHP44oA+g/C2t+JNHtHjFzaXigHZ9tiLtg5zzuB7nr6muT8eXfibxbL9nu54obEkeYtuuxWXAAGMnOMH8667Q4bbX9Pae5mWOBh8pjwGrifiZrEXgWyaZLtXRUYorHk8UAcR8UPitafCbwXdlbgFihgt4hwSR6Ad/8a/O/xB4gvPF3iK71W+lL3FzJ5jZ5ABPAHtXY/Gz4m3fjrxEV81msrcnYjH5dxPJxXn0E6B1yB1H40Ad9rMSjwxeY+UiMHnvzXmlek6/OraDdoGXJRe/uK82AyaANq5nMkyLzkZ5rLnbKkZyd1D+Y4yzk00x4xQA3BIFesfs33Udl8Q7NJeFukeD8SMj+VeZQQbxknp1xXSeELybw/rdjfRZMlvOsy+5BBxQB+i3hfRo5SIZBkkDaMdareIvhGlzOZbeEAvwy9BXf2uiSw6bpeqpbyR2l7bR3MEm35WR1DKQe/BHSuts4ftlopYAk8CgD5/GheNfDMLQ2Ms8dvjAUurJ+BbpXL+J/DWq3+mz3ms3ctxIqny42bIDEflx9K+nr7RZrgbWz5QOcHpXBa74cm1/UBp8EDykHbsjUksc9hQB+a/j/AMA3vhy4leRHMIfBcjgZyQM++DXGRw5YMjfdOT7V+sHxb/ZJkvv2f/F81zbAeIPs4vbZB1j8nL7TjqSu4e2RX5USw/Z7p1JIwe1AF/W76K5twI5CxxyCMGuf6GtjygUUg9eOnSoWsSRnA696AP/Z\r\n```\r\n# Error Case 6 and 7\r\n<a name=\"error-case-6\"/>\r\n\r\n``` xquery\r\nimport module namespace transform = \"http://exist-db.org/xquery/transform\";\r\nimport module namespace xslfo = \"http://exist-db.org/xquery/xslfo\";\r\nimport module namespace file = \"http://exist-db.org/xquery/file\";\r\nimport module namespace response = \"http://exist-db.org/xquery/response\";\r\n\r\nlet $articles :=\r\n    document { \r\n        element PubmedArticleSet {\r\n            collection(\"/db/pubmed/data\")//PubmedArticle[1]\r\n        }\r\n    }\r\nreturn\r\n\r\n    let $fo := transform:transform($articles, doc(\"/db/apps/pubmed/to-pdf-fo.xslt\"), ())\r\n    return\r\n        let $pdf := xslfo:render($fo, \"application/pdf\", ())\r\n        return\r\n\r\n            response:stream($pdf, \"media-type=application/pdf\")\r\n\r\n                        (: file:serialize-binary does not work instead of response:stream either! :)\r\n            (:\r\n            file:serialize-binary($pdf, \"/tmp/my-output.pdf\")\r\n            :)\r\n```", "url": "https://github.com/eXist-db/exist/issues/790", "user": "adamretter", "labels": ["bug"], "created": "2015-09-17 11:24:41", "closed": "2018-02-10 09:53:27", "commits": {}, "ttf": 876.0002777777778, "commitsDetails": []}, {"title": "Configuring eXist from Optional[....../eXist-db/tools/wrapper/bin/../../../conf.xml]", "body": "The `Optional[....]` in the startup log looks a bit strange to me.....\n\n```\nSTATUS | wrapper  | 2015/09/11 15:20:29 | --> Wrapper Started as Daemon\nSTATUS | wrapper  | 2015/09/11 15:20:29 | Java Service Wrapper Community Edition 64-bit 3.5.26\nSTATUS | wrapper  | 2015/09/11 15:20:29 |   Copyright (C) 1999-2014 Tanuki Software, Ltd. All Rights Reserved.\nSTATUS | wrapper  | 2015/09/11 15:20:29 |     http://wrapper.tanukisoftware.com\nSTATUS | wrapper  | 2015/09/11 15:20:29 |\nSTATUS | wrapper  | 2015/09/11 15:20:29 | Launching a JVM...\nINFO   | jvm 1    | 2015/09/11 15:20:29 | WrapperManager: Initializing...\nINFO   | jvm 1    | 2015/09/11 15:20:29 | jetty.home = ../../../tools/jetty\nINFO   | jvm 1    | 2015/09/11 15:20:31 | 11 Sep 2015 15:20:31,129 [WrapperListener_start_runner] INFO  (JettyStart.java [run]:122) - Configuring eXist from Optional[/...../eXist-db/tools/wrapper/bin/../../../conf.xml]\nINFO   | jvm 1    | 2015/09/11 15:20:31 | 11 Sep 2015 15:20:31,129 [WrapperListener_start_runner] INFO  (JettyStart.java [run]:124) - Running with Java 1.8.0_60 [Oracle Corporation (Java HotSpot(TM) 64-Bit Server VM) in /usr/java/jdk1.8.0_60/jre]\n\n```\n", "url": "https://github.com/eXist-db/exist/issues/783", "user": "dizzzz", "labels": ["bug"], "created": "2015-09-11 13:24:06", "closed": "2015-09-11 13:25:53", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "U+FFFD replacement characters appear instead of SMP and SIP characters", "body": "eXist does a good job at maintaining higher-level Unicode values through transforms. However, there are exceptions. Take the following - innocent - script:\n\n```\nxquery version \"3.1\";\n\ndeclare function local:make-lemma-version($element as element())\nas element()\n{\n    element { node-name($element) } {\n        $element/@*,\n        for $child in $element/node()\n        return\n            if ($child instance of element(app)) \n            then $child/lem/string()\n            else $child\n    }\n};\n\nlet $test := \n<seg>\n    <app>\n        <lem>a</lem>\n        <rdg/>\n    </app>\n    &#x2a3c6;\n</seg>\n(:let $test := doc('/db/test.xml')/element():)\nlet $result := local:make-lemma-version($test)\nreturn\n    $result\n```\n\n$test contains a CJK Extension B character, U+2A3C6, which should look something like http://www.unicode.org/cgi-bin/GetUnihanData.pl?codepoint=2A3C6&useutf8=true (you may not have a font that allows you to view this character in eXide).\n\nThe result displays nicely when run over an in-memory fragment, but if you save the fragment and run it over a stored document (uncommenting the second \"let $test\" statement), you get two \"\ufffd\" U+FFFD replacement characters instead of one U+2A3C6 character. All information about the original U+2A3C6 is lost. - Many will never see a SIP character, but for me this is quite a problem.\n\nThere is a further puzzle: I have put an `a` as `<lem>` contents in the document, not because it occurs in my source, but because it does not matter what you put there. If you remove the `<lem>` contents in the document (or change `then $child/lem/string()` to `then $child/rdg/string()` or to `()` in the query), the U+2A3C6 will appear again. It will also appear again if you change `then $child/lem/string()` to `then <lem>{$child/lem/string()}</lem>`. Why?\n\nPS: The problem not only applies to characters in the Supplementary Ideographic Plane, but also to characters in the Supplementary Multilingual Plane (including e.g. Emoticons). \n", "url": "https://github.com/eXist-db/exist/issues/780", "user": "jensopetersen", "labels": ["bug"], "created": "2015-09-10 14:07:18", "closed": "2020-03-23 12:58:16", "commits": {}, "ttf": 1655.0002777777777, "commitsDetails": []}, {"title": "New range index causing trouble when going up an XML tree", "body": "Consider an HTML file like this:\n\n```\n<html>\n    <head/>\n    <body>\n        <span id=\"foo1\">\n            <span id=\"foo2\">Foo!</span>\n        </span>\n    </body>\n</html>\n```\n\nNow we try the query below:\n\n```\ndoc('/db/apps/test/test.html')//span[@id='foo2']/parent::span[@id='foo1']\n```\n\nThis works perfectly fine without an index (and also in Oxygen). Once you set a new range index for @id with the following lines\n\n```\n<range>\n    <create qname=\"@id\" type=\"xs:string\"/>  \n</range>\n```\n\n-- it won't work anymore. It works for a single step, i.e. you can either go to the first span or to the second. It also works top-down, going first to the \"higher\" span than to the lower, but going up the tree with parent:: and ancestor:: doesn't work after setting the index for @id.\n\nThis was tested and reproduced on two eXist 3.0 RC1 installtions on Windows 7 and Mac iOs.\n", "url": "https://github.com/eXist-db/exist/issues/779", "user": "christian-schwaderer", "labels": ["bug"], "created": "2015-09-09 13:20:33", "closed": "2018-03-06 14:32:44", "commits": {}, "ttf": 909.0002777777778, "commitsDetails": []}, {"title": "restxq Xquery Executer fail to interpret setUid/setGid flag", "body": "As a follow-up of #482 :\n\nTest case  (module owned by `admin/dba`, rights set to `-rwsr-sr-x`): \n\n``` xquery\nxquery version \"3.0\";\n\nmodule namespace t3 = \"http://e-smile.org/t3\" ;\ndeclare namespace rest=\"http://exquery.org/ns/restxq\";\n\ndeclare \n  %rest:GET   \n  %rest:path(\"/t3\") \n  function t3:t3() {\n      sm:id()\n    };\n```\n\nHitting http://localhost:port/restxq/t3 returns : \n\n``` xml\n<sm:id xmlns:sm=\"http://exist-db.org/xquery/securitymanager\">\n  <sm:real>\n    <sm:username>guest</sm:username>\n    <sm:groups>\n      <sm:group>guest</sm:group>\n    </sm:groups>\n  </sm:real>\n</sm:id>\n```\n\nIf I understand correctly (?), it should instead return something like: \n\n``` xml\n<sm:id xmlns:sm=\"http://exist-db.org/xquery/securitymanager\">\n  <sm:real>\n    <sm:username>guest</sm:username>\n    <sm:groups>\n      <sm:group>guest</sm:group>\n    </sm:groups>\n  </sm:real>\n  <sm:effective>\n    <sm:username>admin</sm:username>\n    <sm:groups>\n      <sm:group>dba</sm:group>\n    </sm:groups>\n  </sm:effective>\n</sm:id>\n```\n\nCheers,\nC.\n", "url": "https://github.com/eXist-db/exist/issues/778", "user": "christophe-g", "labels": ["bug"], "created": "2015-09-08 15:57:32", "closed": "2016-01-05 18:48:26", "commits": {}, "ttf": 119.00027777777778, "commitsDetails": []}, {"title": "unmatching try/catch occludes outer try/catch", "body": "A try/catch expression that does not catch the particular error type raised in the try's body changes the error in a way that makes it impossible to catch the error in an outer try/catch.\n\nFor example:\n\n``` xquery\ntry {\n    try {\n        error(xs:QName('test'))\n    } catch foo {\n        'inner catch'\n    }\n} catch test {\n    'outer catch'\n}\n```\n\nThe expected result is 'outer catch', but instead the query raises an \"exerr:ERROR Error.\" error.  This error cannot be caught with `catch exerr:ERROR` (even if the \"exerr\" namespace is explicitly bound to \"http://www.w3.org/2005/xqt-errors), but can be caught with `catch *`.\n\nThis example above obviously contrived, but there are cases where a function might choose to handle some exceptions while passing on others to the caller.  If there several different such errors that might be passed, the caller is left with no means of differentiating them.\n", "url": "https://github.com/eXist-db/exist/issues/745", "user": "telic", "labels": ["bug"], "created": "2015-07-16 23:42:32", "closed": "2016-08-08 07:08:11", "commits": {}, "ttf": 388.0002777777778, "commitsDetails": []}, {"title": "error variables in catch occluded by namespace definition", "body": "Try/catch clauses make some \"magic variables\" available in the catch block under the \"err\" namespace which the XQuery spec defines as \"http://www.w3.org/2005/xqt-errors\" (eg. $err:code, $err:description, etc).  However, eXist only understands these variables if the 'err' prefix is **unbound** in the query.\n\nFor example, this works as one would expect, returning 'just a test':\n\n```\ntry {\n  error(xs:QName('test'), 'just a test')\n} catch * {\n  $err:description\n}\n```\n\nBut simply adding the namespace definition for 'err' as below results in an XPDY0002 compile-time error:\n\n```\ndeclare namespace err=\"http://www.w3.org/2005/xqt-errors\";\ntry {\n  error(xs:QName('test'), 'just a test')\n} catch * {\n  $err:description\n}\n```\n\nThis is the exact **opposite** behaviour than expected by the spec, since it states that the 'err' namespace prefix is not predeclared.\n", "url": "https://github.com/eXist-db/exist/issues/743", "user": "telic", "labels": ["bug"], "created": "2015-07-16 22:47:33", "closed": "2016-08-09 09:47:56", "commits": {"b0bb7206248c5d52fe6dcb8d5c1ed55e4d1040bb": {"commitGHEventType": "closed", "commitUser": "wolfgangmm"}}, "ttf": 389.0002777777778, "commitsDetails": [{"commitHash": "b0bb7206248c5d52fe6dcb8d5c1ed55e4d1040bb", "commitGHEventType": "closed", "commitUser": "wolfgangmm", "commitParents": ["cf3eb7751010803c041911a575cd9a8a4a882a55"], "nameRev": "b0bb7206248c5d52fe6dcb8d5c1ed55e4d1040bb tags/eXist-3.0~82^2", "commitMessage": "[bugfix] Correct namespace for xqt-errors from 'http://www.w3.org/2005/xqt-errors/' to 'http://www.w3.org/2005/xqt-errors'. Closes https://github.com/eXist-db/exist/issues/743\n", "commitDateTime": "2016-08-08 00:17:27", "authoredDateTime": "2016-08-08 00:17:27", "commitGitStats": [{"filePath": "src/org/exist/Namespaces.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "src/org/exist/xquery/TryCatchExpression.java", "insertions": 1, "deletions": 5, "lines": 6}, {"filePath": "test/src/xquery/xquery3/xq3_trycatch.xml", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Namespaces.java", "spoonMethods": [{"spoonMethodName": "org.exist", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "TryCatchExpression.java", "spoonMethods": []}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["b0bb7206248c5d52fe6dcb8d5c1ed55e4d1040bb"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2, "deletions": 6, "lines": 8, "gitFilesChange": 2}, "spoonStatsSummary": {"TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist", "src/org/exist/xquery"], "changesInPackagesSPOON": ["org.exist"]}, {"title": "catch does not support partial wildcards", "body": "According to the XQuery 3 spec, the catch clause in a try/catch expression should support any NameTest, including `*:name`, and `ns:*` wildcard forms.  However, only NCName's, QName's, and \" \\* \" are currently supported by eXist.  eXide reports an \"<AST>:0:0: Unexpected AST node\" error for other wildcard types.\n\nPS: URIQualifiedName's aren't supported either, but they seem to be generally unsupported in eXist, not just in try/catch.\n", "url": "https://github.com/eXist-db/exist/issues/742", "user": "telic", "labels": ["bug"], "created": "2015-07-16 22:35:26", "closed": "2016-08-12 08:36:25", "commits": {}, "ttf": 392.0002777777778, "commitsDetails": []}, {"title": "xs:QName not coerced by value/general comparison", "body": "Comparing an xs:QName to another atomic type results in a type error, even when explicit casts allow the comparison.\r\n\r\nFor example `'test' eq xs:QName('test')` results in `err:XPTY0004 cannot compare xs:string('test') with xs:QName('test')`, but `'test' eq xs:QName('test') cast as xs:string` results in `true()`.\r\n\r\nThis affects both value and general comparisons.  General comparisons are a particular problem, since `xs:QName` can not be compared to an empty sequence (which ends up being `xs:anyAtomicType`)!\r\n\r\nFurthermore, a different error is reported by eXide depending on which side of the comparison the `xs:QName` appears on. If it is the left-hand operand, `exerr:ERROR\" is raised, otherwise \"err:XPT0004` is raised.  This has repercussions on try/catch clauses that attempt to mitigate the error.\r\n", "url": "https://github.com/eXist-db/exist/issues/741", "user": "telic", "labels": ["bug"], "created": "2015-07-16 22:09:30", "closed": "2017-11-27 08:46:29", "commits": {}, "ttf": 864.0002777777778, "commitsDetails": []}, {"title": "use of \"order by\" is too restrictive", "body": "According to the spec, FLWOR expressions may contain any number of \"order by\" clauses intermingled with other clauses before the return. However, eXist only allows a single \"order by\" clause as the final clause before the return; all other uses result in a parse error.\n\nFor example, this is a valid XQuery that results in a parse error in eXist:\n\n```\nfor $x in (3, 2, 4)\norder by $x\nfor $y in (1 to $x)\nreturn $y\n```\n\nThis can usually be worked around by rearranging the clauses or using nested FLWOR expressions (eg. simply inserting a `return` clause between the `order by` and second `for` in the above example), but it's not always obvious how to do so while getting the same result.\n", "url": "https://github.com/eXist-db/exist/issues/739", "user": "telic", "labels": ["bug"], "created": "2015-07-16 21:40:16", "closed": "2017-07-03 15:27:39", "commits": {}, "ttf": 717.0002777777778, "commitsDetails": []}, {"title": "The value of local-name applied to a text node is null, not the empty string", "body": "Calling local-name() on a text node should return the zero-length string. In the following, the let statement does nothing, but brings about a NPE.\n\n```\ndeclare function local:copy($element as element(), $tests as element()) as element() {\n    element {node-name($element)}\n    {$element/@*,\n    for $child in $element/node()\n    let $name := $tests//test[case eq local-name($child)]\n    return\n        if ($child instance of element())\n        then local:copy($child, $tests)\n        else $child\n      }\n};\n\nlet $fragment :=\n<x>\n    <y>a</y>\n</x>\n\nlet $tests :=\n<tests>\n    <test>\n        <case>y</case>\n    </test>\n</tests>\n\nreturn\n    local:copy($fragment, $tests)\n```\n\nRemove the text node in $fragment, and it works. Change local-name() to name() and it works.\n\nlocal-name() applied to a text node evaluates to null, not the empty string:\n\n```\nlet $fragment :=\n<x>\n    <y>a</y>\n</x>\n\nlet $text-node := $fragment//text()\n\nreturn\n    local-name($text-node)\n```\n\nWith name() it returns the empty string.\n", "url": "https://github.com/eXist-db/exist/issues/735", "user": "jensopetersen", "labels": ["bug"], "created": "2015-07-15 13:32:14", "closed": "2016-08-07 20:56:36", "commits": {}, "ttf": 389.0002777777778, "commitsDetails": []}, {"title": "A space in JAVA_HOME on Windows 7 causes build.bat to fail", "body": "Using cmd.exe:\n\n``` cmd\ngit clone https://github.com/exist-db/exist.git\ncd exist\nset JAVA_HOME=\"c:\\Program Files\\Java\\jdk1.8.0_45\"\nbuild.bat\n```\n\nResults in:\n`Files\\Java\\jdk1.8.0_45\"\" was unexpected at this time.`\n", "url": "https://github.com/eXist-db/exist/issues/729", "user": "adamretter", "labels": ["bug"], "created": "2015-07-12 11:34:53", "closed": "2015-07-16 15:41:15", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "Windows: Unclean shutdown", "body": "On windows 7, 32bit: machine is shut down cleanly, but eXist crashes and reinforces a recovery run upon restart. This used to work in the past, i.e. eXist received the shutdown signal and stopped properly before windows powered off the machine.\n\nCould someone confirm if this happens on other windows versions as well?\n", "url": "https://github.com/eXist-db/exist/issues/713", "user": "wolfgangmm", "labels": ["bug", "high prio"], "created": "2015-07-02 08:11:20", "closed": "2015-10-03 13:40:52", "commits": {}, "ttf": 93.00027777777778, "commitsDetails": []}, {"title": "array:tail on nested array incorrect", "body": "`array:tail($array)` doesn't return the correct tail when `$array` is nested.\n", "url": "https://github.com/eXist-db/exist/issues/695", "user": "wshager", "labels": ["bug"], "created": "2015-06-25 15:21:55", "closed": "2015-06-25 21:52:48", "commits": {"4e505e2b2b6277dff865a4b3937b2c0544a5e8ce": {"commitGHEventType": "referenced", "commitUser": "wolfgangmm"}, "16a539dded9911f8e67463b0ac3daf8632d5e6d4": {"commitGHEventType": "referenced", "commitUser": "wolfgangmm"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "4e505e2b2b6277dff865a4b3937b2c0544a5e8ce", "commitGHEventType": "referenced", "commitUser": "wolfgangmm", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "16a539dded9911f8e67463b0ac3daf8632d5e6d4", "commitGHEventType": "referenced", "commitUser": "wolfgangmm", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "spoonStatsSummary": {}, "statsSkippedReason": ""}, {"title": "Internal evaluation error: context is missing for node 1", "body": "I found a really strange bug that is reproducible with my exist-2.2 installation:\n\nThe query\n\n```\ndeclare function local:f() {\n    xmldb:xcollection(\"/db/tmp\")//html/body[table/@border = '1']\n};\nmap { 'bla' := local:f() }\n```\n\nexits with the error message \"context is missing for node ...\", assuming a matching document exists in `/db/tmp`. \n\nIt seems like every element in the query is necessary to reproduce the bug - the function must be called from within a map constructor, simply calling the function works. The simpler query `xmldb:xcollection(...)//body[table/@border='1']` inside the function works. Even the query `xmldb:xcollection(...)//body[../self::html][table/@border='1']` does not trigger the bug.\n", "url": "https://github.com/eXist-db/exist/issues/689", "user": "opax", "labels": ["bug"], "created": "2015-06-22 19:53:00", "closed": "2017-07-16 16:02:36", "commits": {}, "ttf": 754.0002777777778, "commitsDetails": []}, {"title": "Logs not written to correct location", "body": "Currently the logs are not written to `/webapp/WEB-INF/logs`, but to `/tools/wrapper/bin/webapp/WEB-INF/logs`. This is confirmed to be the case when running eXist as a service, or at least installed as upstart daemon. The cause lies in the new log4j configuration for the wrapper, in `/tools/wrapper/conf/log4j2.xml`.\n", "url": "https://github.com/eXist-db/exist/issues/634", "user": "wshager", "labels": ["bug"], "created": "2015-05-28 20:37:32", "closed": "2015-05-29 21:50:23", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "AssertFailure when addressing comment nodes outside root elements for db documents", "body": "I can confirm the issue reported at http://stackoverflow.com/questions/30086095/select-comments-before-root-node with a fresh build of eXist from the [current develop branch](https://github.com/eXist-db/exist/commit/fa949a73fad7d9c62ab2e78e9676b3cf07425d30). \n\nReproducible test:\n\nStore the following document as `/db/test.xml`\n\n```\n<!-- DOCUMENT REVIEWED -->\n<doc id=\"test\">\n  <figure>\n    <figcaption>caption</figcaption>\n  </figure>\n  <p>blah blah blah</p>\n</doc>\n```\n\nThe following query will fail:\n\n``` xquery\ndoc('/db/test.xml')/node()[2]/preceding-sibling::comment()\n```\n\nExpected result: \n\n```\n<!-- DOCUMENT REVIEWED -->\n```\n\nActual result, as reported in exist.log:\n\n```\n2015-05-06 20:28:36,739 [eXistThread-50] WARN  (SanityCheck.java [showTrace]:94) - Stacktrace:\norg.exist.util.sanity.AssertFailure: TRACE: Node 891:null not found.\n    at org.exist.util.sanity.SanityCheck.TRACE(SanityCheck.java:73)\n    at org.exist.storage.dom.DOMFile.findValue(DOMFile.java:1265)\n    at org.exist.storage.dom.RawNodeIterator.seek(RawNodeIterator.java:84)\n    at org.exist.storage.dom.RawNodeIterator.<init>(RawNodeIterator.java:71)\n    at org.exist.storage.NativeBroker.getXMLStreamReader(NativeBroker.java:545)\n    at org.exist.xquery.LocationStep.getSiblings(LocationStep.java:899)\n    at org.exist.xquery.LocationStep.eval(LocationStep.java:449)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:265)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.XQuery.execute(XQuery.java:298)\n    at org.exist.xquery.XQuery.execute(XQuery.java:218)\n    at org.exist.http.servlets.XQueryServlet.process(XQueryServlet.java:492)\n    at org.exist.http.servlets.XQueryServlet.doPost(XQueryServlet.java:198)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:755)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103)\n    at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:50)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:557)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:357)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1448)\n    at de.betterform.agent.web.filter.XFormsFilter.doFilter(XFormsFilter.java:171)\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:455)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n    at org.eclipse.jetty.server.Server.handle(Server.java:368)\n    at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:488)\n    at org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:943)\n    at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:1004)\n    at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:861)\n    at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:240)\n    at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n    at java.lang.Thread.run(Thread.java:745)\n```\n\nOn the other hand, the in-memory version of this query returns the expected result:\n\n``` xquery\nlet $doc := \n    document { \n        <!-- DOCUMENT REVIEWED -->,\n        <doc id=\"test\">\n          <figure>\n            <figcaption>caption</figcaption>\n          </figure>\n          <p>blah blah blah</p>\n        </doc>\n    }\nreturn \n    $doc/node()[2]/preceding-sibling::comment()\n```\n\nResult:\n\n```\n<!-- DOCUMENT REVIEWED -->\n```\n\nOn a perhaps related note, eXide returns unexpected results when displaying the in-database version of this document - seemingly because of the presence of the comment:\n\n```\ndoc('/db/test.xml')\n```\n\neXide reports that this returns one node, but only displays:\n\n```\n<!-- DOCUMENT REVIEWED -->\n```\n\nI would expect to see the entire document, but only the comment displays.\n\nThis variant returns expected results - 2 items, the comment node and the <doc> node:\n\n```\ndoc('/db/test.xml')/node()\n```\n\nSo all in all, eXist seems to have some issues handling comments outside the root element of the document.\n", "url": "https://github.com/eXist-db/exist/issues/623", "user": "joewiz", "labels": ["bug"], "created": "2015-05-07 00:36:12", "closed": "2018-08-16 19:28:09", "commits": {"3958fbbc5a3d28bf7dc133ec0595a61277dbce20": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 1197.0002777777777, "commitsDetails": [{"commitHash": "3958fbbc5a3d28bf7dc133ec0595a61277dbce20", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["145e9bde2fd5f8b0e48dca71e08d4de3c01837de"], "nameRev": "3958fbbc5a3d28bf7dc133ec0595a61277dbce20 tags/eXist-5.1.0~328^2", "commitMessage": "[bugfix] Fix a problem with self-axis selection\nCloses https://github.com/eXist-db/exist/issues/623\n", "commitDateTime": "2018-08-16 10:43:09", "authoredDateTime": "2018-08-15 13:31:58", "commitGitStats": [{"filePath": "src/org/exist/xquery/LocationStep.java", "insertions": 14, "deletions": 6, "lines": 20}, {"filePath": "test/src/org/exist/xquery/XPathQueryTest.java", "insertions": 18, "deletions": 0, "lines": 18}], "commitSpoonAstDiffStats": [{"spoonFilePath": "LocationStep.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.LocationStep.getSelf(org.exist.xquery.XQueryContext,org.exist.xquery.Sequence)", "TOT": 4, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 1}]}, {"spoonFilePath": "XPathQueryTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.XPathQueryTest.selfAxis()", "TOT": 16, "UPD": 0, "INS": 16, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["3958fbbc5a3d28bf7dc133ec0595a61277dbce20"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 14, "deletions": 6, "lines": 20, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 4, "UPD": 0, "INS": 1, "MOV": 2, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/xquery"], "changesInPackagesSPOON": ["org.exist.xquery.LocationStep.getSelf(org.exist.xquery.XQueryContext,org.exist.xquery.Sequence)"]}, {"title": "Calling sm:get-group-metadata-keys($group) with an invalid group causes a null point exception", "body": "In 2.2 and a call to sm:get-group-metadata-keys($group) with an invalid group causes a null point exception.\n", "url": "https://github.com/eXist-db/exist/issues/611", "user": "lcahlander", "labels": ["bug"], "created": "2015-04-27 15:07:01", "closed": "2015-06-12 13:01:25", "commits": {"46f62a9056effe97e772af105381f8f383559a99": {"commitGHEventType": "referenced", "commitUser": "adamretter"}, "157b99547b119204f3a1020a5c5ca783c19cea21": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 45.000277777777775, "commitsDetails": [{"commitHash": "46f62a9056effe97e772af105381f8f383559a99", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "157b99547b119204f3a1020a5c5ca783c19cea21", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "spoonStatsSummary": {}, "statsSkippedReason": ""}, {"title": "key alt not work #bug", "body": "key \"alt\" not found.\nWhen i press alt it doesn't paint nothing...\ns.o client: Yosemite IOs\nclient java: 2.2\n\nAlt+2 expected @ got nothing \nAlt+` expected [ got nothing\nAlt+\u00b4 expected ] got nothing\nAlt+3 expected # got nothing\n", "url": "https://github.com/eXist-db/exist/issues/606", "user": "apolalca", "labels": ["bug"], "created": "2015-04-17 14:39:49", "closed": "2015-04-29 07:18:41", "commits": {"fe2a3a527ba6377ca1a6682d1e714631b61a6d2f": {"commitGHEventType": "closed", "commitUser": "adamretter"}}, "ttf": 11.000277777777777, "commitsDetails": [{"commitHash": "fe2a3a527ba6377ca1a6682d1e714631b61a6d2f", "commitGHEventType": "closed", "commitUser": "adamretter", "commitParents": ["5d67fb9898d2c7ae92c4277c2b3fcd8abcedd7d2"], "nameRev": "fe2a3a527ba6377ca1a6682d1e714631b61a6d2f tags/eXist-3.0.RC1~71^2", "commitMessage": "Switch from a very very old jEdit-syntax to RSytnaxTextArea. Fixes an\nissue with extended characters on Mac. Closes\nhttps://github.com/eXist-db/exist/issues/606\n", "commitDateTime": "2015-04-29 00:03:53", "authoredDateTime": "2015-04-29 00:03:53", "commitGitStats": [{"filePath": ".classpath", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "lib/core/jEdit-syntax.LICENSE.txt", "insertions": 0, "deletions": 13, "lines": 13}, {"filePath": "lib/core/jEdit-syntax.jar", "insertions": 0, "deletions": 0, "lines": 0}, {"filePath": "lib/core/rsyntaxtextarea-2.5.6.jar", "insertions": 0, "deletions": 0, "lines": 0}, {"filePath": "lib/core/rsyntaxtextarea-LICENSE.txt", "insertions": 24, "deletions": 0, "lines": 24}, {"filePath": "nbproject/project.properties", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "src/org/exist/client/ClientInputHandler.java", "insertions": 0, "deletions": 164, "lines": 164}, {"filePath": "src/org/exist/client/ClientTextArea.java", "insertions": 0, "deletions": 114, "lines": 114}, {"filePath": "src/org/exist/client/DocumentView.java", "insertions": 35, "deletions": 26, "lines": 61}, {"filePath": "src/org/exist/client/QueryDialog.java", "insertions": 95, "deletions": 82, "lines": 177}, {"filePath": "src/org/exist/start/start.config", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ClientInputHandler.java", "spoonMethods": [{"spoonMethodName": "org.exist.client.ClientInputHandler", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "ClientTextArea.java", "spoonMethods": [{"spoonMethodName": "org.exist.client.ClientTextArea", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}, {"spoonFilePath": "DocumentView.java", "spoonMethods": [{"spoonMethodName": "org.exist.client.DocumentView", "TOT": 2, "UPD": 1, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.client.DocumentView.setupComponents()", "TOT": 14, "UPD": 0, "INS": 6, "MOV": 4, "DEL": 4}, {"spoonMethodName": "org.exist.client.DocumentView.setText(java.lang.String)", "TOT": 4, "UPD": 0, "INS": 0, "MOV": 2, "DEL": 2}]}, {"spoonFilePath": "QueryDialog.java", "spoonMethods": [{"spoonMethodName": "org.exist.client.QueryDialog", "TOT": 11, "UPD": 5, "INS": 3, "MOV": 3, "DEL": 0}, {"spoonMethodName": "org.exist.client.QueryDialog.setupComponents(boolean)", "TOT": 36, "UPD": 12, "INS": 11, "MOV": 10, "DEL": 3}, {"spoonMethodName": "org.exist.client.QueryDialog.createQueryBox()", "TOT": 12, "UPD": 6, "INS": 1, "MOV": 3, "DEL": 2}, {"spoonMethodName": "org.exist.client.QueryDialog.compileQuery()", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.client.QueryDialog.QueryThread.run()", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["fe2a3a527ba6377ca1a6682d1e714631b61a6d2f"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 134, "deletions": 390, "lines": 524, "gitFilesChange": 9}, "spoonStatsSummary": {"TOT": 85, "UPD": 26, "INS": 22, "MOV": 23, "DEL": 14, "spoonFilesChanged": 4, "spoonMethodsChanged": 10}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/client", "src/org/exist/start/start.config", "lib/core/rsyntaxtextarea-2.5.6.jar", ".classpath", "lib/core/jEdit-syntax.jar", "nbproject/project.properties"], "changesInPackagesSPOON": ["org.exist.client.QueryDialog", "org.exist.client.ClientTextArea", "org.exist.client.DocumentView.setText(java.lang.String)", "org.exist.client.QueryDialog.compileQuery()", "org.exist.client.DocumentView", "org.exist.client.QueryDialog.setupComponents(boolean)", "org.exist.client.QueryDialog.QueryThread.run()", "org.exist.client.QueryDialog.createQueryBox()", "org.exist.client.DocumentView.setupComponents()", "org.exist.client.ClientInputHandler"]}, {"title": "bin/shutdown.sh not shuting down", "body": "In fact it appears to be doing nothing at all. I have to manually kill the thread. I've tried this on the most recent commit a277568192 and also the one from earlier today on two different machines. Both linux, one debain 7 and the other archlinux. Both with java 8. It was working fine the last few times I've updated. \n\n More information available upon request. \n", "url": "https://github.com/eXist-db/exist/issues/602", "user": "mgr34", "labels": ["bug", "regression"], "created": "2015-04-14 19:38:17", "closed": "2015-05-31 14:47:28", "commits": {}, "ttf": 46.000277777777775, "commitsDetails": []}, {"title": "Creating Collection/Resource could have wrong owner group", "body": "If a user is a member of the DBA group as their primary group and N other groups and then creates a resource/collection. The group owner of that collection could be any of the groups they are a member of instead of the DBA group.\n\nTo reproduce - \n1. Create a user, set their primary group to the DBA group.\n2. Add them to _n_ other groups\n3. Shutdown eXist\n4. Startup eXist, login as your new user.\n5. Create a Collection/Resource\n6. The group owner of the resource could be any of the groups the user is a member of. Repeating steps 4 - 5 results in resources with different group members.\n\nSolution - Resources/Collections should always be created with the users primary group.\n", "url": "https://github.com/eXist-db/exist/issues/583", "user": "adamretter", "labels": ["bug", "high prio"], "created": "2015-04-09 13:19:08", "closed": "2015-04-09 23:36:37", "commits": {"c33c14dbaa7abf1266b5c0b4e2275aba5d931980": {"commitGHEventType": "closed", "commitUser": "adamretter"}}, "ttf": 0.0002777777777777778, "commitsDetails": [{"commitHash": "c33c14dbaa7abf1266b5c0b4e2275aba5d931980", "commitGHEventType": "closed", "commitUser": "adamretter", "commitParents": ["f910822e34fc06e25fb4ca3399febd3417324af8"], "nameRev": "c33c14dbaa7abf1266b5c0b4e2275aba5d931980 tags/eXist-3.0.RC1~93^2", "commitMessage": "[bugfix] Try to ensure that the configurator does not reorder the values\nof lists. Closes https://github.com/eXist-db/exist/issues/583\n", "commitDateTime": "2015-04-09 21:20:26", "authoredDateTime": "2015-04-09 21:16:24", "commitGitStats": [{"filePath": "src/org/exist/config/Configuration.java", "insertions": 9, "deletions": 1, "lines": 10}, {"filePath": "src/org/exist/config/ConfigurationImpl.java", "insertions": 13, "deletions": 26, "lines": 39}, {"filePath": "src/org/exist/config/Configurator.java", "insertions": 126, "deletions": 84, "lines": 210}, {"filePath": "src/org/exist/security/AbstractAccount.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "src/org/exist/security/internal/AccountImpl.java", "insertions": 30, "deletions": 0, "lines": 30}], "commitSpoonAstDiffStats": [{"spoonFilePath": "Configuration.java", "spoonMethods": [{"spoonMethodName": "org.exist.config.equals(java.lang.Object,java.lang.String)", "TOT": 2, "UPD": 2, "INS": 0, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "ConfigurationImpl.java", "spoonMethods": [{"spoonMethodName": "org.exist.config.ConfigurationImpl.equals(java.lang.Object,java.lang.String)", "TOT": 20, "UPD": 9, "INS": 0, "MOV": 6, "DEL": 5}, {"spoonMethodName": "org.exist.config.ConfigurationImpl.equals(java.lang.Object)", "TOT": 12, "UPD": 2, "INS": 2, "MOV": 6, "DEL": 2}, {"spoonMethodName": "org.exist.config.ConfigurationImpl.equals(java.lang.Object,java.util.Optional)", "TOT": 4, "UPD": 0, "INS": 4, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "Configurator.java", "spoonMethods": [{"spoonMethodName": "org.exist.config.Configurator.parse(org.exist.config.Configurable,org.exist.storage.DBBroker,org.exist.collections.Collection,org.exist.xmldb.XmldbURI)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.config.Configurator.save(org.exist.config.Configurable,org.exist.storage.DBBroker,org.exist.collections.Collection,org.exist.xmldb.XmldbURI)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.config.Configurator.save(org.exist.storage.DBBroker,org.exist.config.Configurable,org.exist.xmldb.XmldbURI)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.config.Configurator.configureByCurrent(org.exist.config.Configurable,org.exist.config.Configuration)", "TOT": 170, "UPD": 49, "INS": 28, "MOV": 71, "DEL": 22}, {"spoonMethodName": "org.exist.config.Configurator.searchForInsertMethod(java.lang.Class,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.config.Configurator.updateListFn(org.exist.config.Configurable,java.lang.String,java.util.Map,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.config.Configurator.getFieldRecursive(java.util.Optional,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.config.Configurator.filter(java.util.List,java.util.function.Predicate)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "AbstractAccount.java", "spoonMethods": []}, {"spoonFilePath": "AccountImpl.java", "spoonMethods": [{"spoonMethodName": "org.exist.security.internal.AccountImpl.insertGroup(int,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.security.internal.AccountImpl.insertGroup(int,org.exist.security.Group)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["c33c14dbaa7abf1266b5c0b4e2275aba5d931980"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 179, "deletions": 112, "lines": 291, "gitFilesChange": 5}, "spoonStatsSummary": {"TOT": 219, "UPD": 65, "INS": 40, "MOV": 85, "DEL": 29, "spoonFilesChanged": 4, "spoonMethodsChanged": 14}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/config", "src/org/exist/security/internal", "src/org/exist/security"], "changesInPackagesSPOON": ["org.exist.security.internal.AccountImpl.insertGroup(int,java.lang.String)", "org.exist.config.Configurator.getFieldRecursive(java.util.Optional,java.lang.String)", "org.exist.security.internal.AccountImpl.insertGroup(int,org.exist.security.Group)", "org.exist.config.Configurator.filter(java.util.List,java.util.function.Predicate)", "org.exist.config.ConfigurationImpl.equals(java.lang.Object,java.lang.String)", "org.exist.config.ConfigurationImpl.equals(java.lang.Object)", "org.exist.config.equals(java.lang.Object,java.lang.String)", "org.exist.config.Configurator.searchForInsertMethod(java.lang.Class,java.lang.String)", "org.exist.config.Configurator.configureByCurrent(org.exist.config.Configurable,org.exist.config.Configuration)", "org.exist.config.Configurator.save(org.exist.storage.DBBroker,org.exist.config.Configurable,org.exist.xmldb.XmldbURI)", "org.exist.config.ConfigurationImpl.equals(java.lang.Object,java.util.Optional)", "org.exist.config.Configurator.save(org.exist.config.Configurable,org.exist.storage.DBBroker,org.exist.collections.Collection,org.exist.xmldb.XmldbURI)", "org.exist.config.Configurator.updateListFn(org.exist.config.Configurable,java.lang.String,java.util.Map,java.lang.String)", "org.exist.config.Configurator.parse(org.exist.config.Configurable,org.exist.storage.DBBroker,org.exist.collections.Collection,org.exist.xmldb.XmldbURI)"]}, {"title": "Resolve Diff license issue", "body": "See https://github.com/eXist-db/exist/blob/develop/extensions/versioning/src/bmsi/util/Diff.java\n", "url": "https://github.com/eXist-db/exist/issues/570", "user": "adamretter", "labels": ["bug", "high prio"], "created": "2015-04-06 10:09:01", "closed": "2015-06-29 11:32:10", "commits": {}, "ttf": 84.00027777777778, "commitsDetails": []}, {"title": "Deadlock in validation (and more?)", "body": "I have found a repeatable deadlock in validation:\r\n\r\n```java\r\nfinal TransactionManager transact = brokerPool.getTransactionManager();\r\ntry(final DBBroker broker = brokerPool.get(user));\r\n        final Txn transaction = transact.beginTransaction()) {\r\n\r\n  Collection coll = broker.getOrCreateCollection(\"/db/validate-test\");\r\n  broker.saveCollection(transaction, coll);\r\n\r\n  //do some validatation\r\n  final Properties properties = new Properties();\r\n  final ExistResolver resolver = new ExistResolver(brokerPool);\r\n  ValidateProperty.URI_RESOLVER.put(properties, resolver);\r\n  ValidateProperty.ENTITY_RESOLVER.put(properties, resolver);\r\n  final ValidationDriver driver = new\r\nValidationDriver(properties.toPropertyMap(), schemaReader);\r\n\r\n  // Load schema\r\n\r\n  InputSource grammar =\r\nShared.getInputSource(\"/db/validate-test/something.nvdl\", context);\r\n\r\n  driver.loadSchema(grammar); // THIS WILL DEADLOCK PROGRESS\r\n\r\n  transaction.commit();\r\n}\r\n```\r\n\r\nSo the real issue is the interaction between `broker.getOrCreateCollection` and `EmbeddedDownload` used by the validation. Basically what happens is -\r\n\r\n1) The `main` thread executing the `broker.getOrCreateCollection` will acquire a `WRITE_LOCK` on the collection `/db/validate-test` and add it to the transaction.\r\n\r\n2) When `driver.loadSchema`is executed, it uses the registered `ExistResolver`.\r\n\r\n3) The `ExistResolver` will call `EmbeddedInputStream`, and the key thing here is that `EmbeddedInputStream` creates a new thread - `EmbeddedDownloadThread`.\r\n\r\n4) `EmbeddedDownloadThread` will attempt to take a `READ_LOCK` on `/db/validate-test`.\r\n\r\n5) KABOOM! Basically (1) is waiting on (4) to progress, and (4) is awaiting on the lock held by (1).\r\n\r\nThis is not the classic deadlock. It happens specifically because `NativeBroker#getOrCreateCollection` causes the transaction to hold onto a `WRITE_LOCK` until it is committed.\r\n\r\nUnfortunately, the architecture of this issue is not just limited to validation...\r\n\r\nThe implication of this, is that within the same transaction, it is impossible to run any code in another thread that may try to access the collection (or a sub-collection or resource of).\r\n\r\nThat is exactly what the `ExistResolver` does! This limitation will lead to a deadlock anywhere multithreaded code is used within the same transaction (if the same collection (or sub collection/resource) is accessed.\r\n\r\nSo... is there any other multithreaded code apart from `ExistResolver` that might execute within a transaction after `getOrCreateCollection`? I don't know! If so, then that may be deadlock prone also.\r\n\r\nI guess we have two options:\r\n\r\n1) If `ExistResolver` is likely the only multithreaded code, and we can accept a single threaded limitation. Then we have to refactor `ExistResolver` not to use threads.\r\n\r\n2) Otherwise, we have to do a bit more serious work...\r\n\r\n2.1) Perhaps one solution is that `getOrCreateCollection` does not need to register a `WRITE_LOCK` with the transaction. Perhaps just a `READ_LOCK` is enough (as that would prevent further writes anyway). This would only remove the **_t1:WRITE<-2:READ**_ issue, it would not prevent a **_t1:WRITE<-t2:WRITE**_ deadlock.\r\n\r\n2.2) Probably other solutions...\r\n", "url": "https://github.com/eXist-db/exist/issues/558", "user": "adamretter", "labels": ["bug"], "created": "2015-04-02 08:55:27", "closed": "2018-06-05 09:22:35", "commits": {"4cb813851748991fdf89cac99a3d0780e8f19c6e": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 1160.0002777777777, "commitsDetails": [{"commitHash": "4cb813851748991fdf89cac99a3d0780e8f19c6e", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 1, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "spoonStatsSummary": {}, "statsSkippedReason": ""}, {"title": "Windows/shutdown FATAL message (develop)", "body": "Question: is the FATAL below a problem? (WIn7, Java8, develop)\n\nreproduce:\n- run `bin\\startup.sh`\n- open `dashboard`, open e.g. `eXide` (essential!)\n- press `control-c`\n\nmessage:\n\n```\n19 Mar 2015 12:43:53,031 [Thread-4] INFO  (JettyStart.java [lifeCycleStopping]:433) - Jetty server stopping...\n2015-03-19 12:43:54,201 FATAL Unable to register shutdown hook because JVM is shutting down.\nTerminate batch job (Y/N)? y\n```\n", "url": "https://github.com/eXist-db/exist/issues/534", "user": "dizzzz", "labels": ["bug", "high prio", "investigate", "regression"], "created": "2015-03-19 11:46:39", "closed": "2015-06-08 18:56:48", "commits": {}, "ttf": 81.00027777777778, "commitsDetails": []}, {"title": "Predicate issue (NPE)", "body": "Reported by @joewiz \n\nsimplified test case that produces the NPE using current develop branch in eXide:\n\n```\n  1 < (2, 2)[1 + 2]\n```\n\nThe NPE is detailed in the `exist.log` entry below.\n\nHere are three similar expressions that produce the expected result (false) instead of the NPE:\n\n```\n  1 < (2, 2)[3]\n  1 < (2, 2)[position() = 1 + 2]\n  1 < (2)[3]\n```\n\nI tested all versions in Saxon and got the expected result for all (false).\n\n```\n2015-03-12 01:10:19,683 [eXistThread-40] ERROR (XQueryServlet.java [process]:566) -  \njava.lang.NullPointerException\n    at org.exist.xquery.value.ValueSequence.add(ValueSequence.java:143)\n    at org.exist.xquery.Predicate.evalBoolean(Predicate.java:407)\n    at org.exist.xquery.Predicate.evalPredicate(Predicate.java:332)\n    at org.exist.xquery.FilteredExpression.processPredicate(FilteredExpression.java:150)\n    at org.exist.xquery.FilteredExpression.eval(FilteredExpression.java:140)\n    at org.exist.xquery.GeneralComparison.genericCompare(GeneralComparison.java:522)\n    at org.exist.xquery.GeneralComparison.genericCompare(GeneralComparison.java:515)\n    at org.exist.xquery.GeneralComparison.eval(GeneralComparison.java:470)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.XQuery.execute(XQuery.java:297)\n    at org.exist.xquery.XQuery.execute(XQuery.java:217)\n    at org.exist.http.servlets.XQueryServlet.process(XQueryServlet.java:489)\n    at org.exist.http.servlets.XQueryServlet.doPost(XQueryServlet.java:195)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:755)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103)\n    at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:50)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:567)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:355)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1448)\n    at de.betterform.agent.web.filter.XFormsFilter.doFilter(XFormsFilter.java:164)\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:455)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n    at org.eclipse.jetty.server.Server.handle(Server.java:368)\n    at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:488)\n    at org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:943)\n    at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:1004)\n    at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:861)\n    at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:240)\n    at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n    at java.lang.Thread.run(Thread.java:745)\n```\n", "url": "https://github.com/eXist-db/exist/issues/512", "user": "dizzzz", "labels": ["bug"], "created": "2015-03-12 08:11:16", "closed": "2017-03-06 20:25:06", "commits": {}, "ttf": 725.0002777777778, "commitsDetails": []}, {"title": "xmldb:create-collection() and encoding", "body": "Some time ago we have been struggling with encoding in our collection-names. For example: `xmldb:create-collection()` allows creating collections with unencoded `@`  like `a@b` which then indeed is created and accessible by XQuery functions. Using that function with `xmldb:encode-uri(\"a@b\")` also works, resulting two different collections: `a@b` and `a%40b`. \r\n\r\nThis leads to some issues using WebDAV and JAC: \"a@b\" is not accessible by JAC, \"a%40b\" not accessible by WebDAV (tried with Konqueror). \r\n\r\nReferring to RFC3986 (Uniform Resource Identifier: Generic Syntax) there are reserved characters for controlling, seperating etc. and i.e. the \"@\" char is reserverd as well:\r\n\r\nhttp://tools.ietf.org/html/rfc3986#section-2.2\r\nhttp://en.wikipedia.org/wiki/Percent-encoding\r\n\r\nSince the function call looks like this\r\n\r\n```xquery\r\nxmldb:create-collection($target-collection-uri as xs:string, $new-collection as \r\nxs:string) as xs:string?\r\n```\r\nunencoded strings are indeed accepted. Shouldn't this be avoided?\r\n\r\nTo avoid creating of non-RFC-compliant URIs, changing the function call to only accept `xs:anyURI` as `$new-collection` would solve this IMHO. But this would probably mean incompatibilities to existing apps, maybe an inner-function encoding of the submitted string would be a more compatible solution? Of course only if you see this as an issue at all :)\r\n", "url": "https://github.com/eXist-db/exist/issues/495", "user": "ChiSamurai", "labels": ["bug"], "created": "2015-02-26 15:09:54", "closed": "2019-01-08 12:04:18", "commits": {}, "ttf": 1411.0002777777777, "commitsDetails": []}, {"title": "Usage of xmlns:xml prefix causes org.exist.xquery.XPathException: exerr:ERROR err:XQST0070 can not redefine 'xmlns:xml'", "body": "When using a xml document which has xmlns:xml=\"http://www.w3.org/XML/1998/namespace\" declaration, exist returns org.exist.xquery.XPathException: exerr:ERROR err:XQST0070 can not redefine 'xmlns:xml'.\n\nBut according to the spec, it should raise no error because the prefix is using the correct namespace. It is correct to raise an error if the namespace were different to \"http://www.w3.org/XML/1998/namespace\" \n\nI think the error is caused here https://github.com/eXist-db/exist/blob/develop/src/org/exist/xquery/ElementConstructor.java#L109\n\nYou can find an example of the bug here:\n\n```\nxquery version \"3.0\";\nlet $row := <parent xmlns:xml=\"http://www.w3.org/XML/1998/namespace\">\n                <dummyElement>blabla</dummyElement>\n            </parent>\nreturn $row\n```\n", "url": "https://github.com/eXist-db/exist/issues/494", "user": "agucabral21", "labels": ["bug"], "created": "2015-02-26 14:58:10", "closed": "2015-04-11 22:20:58", "commits": {"5193292133ba6d27ced44dd12a43645117708521": {"commitGHEventType": "referenced", "commitUser": "shabanovd"}}, "ttf": 44.000277777777775, "commitsDetails": [{"commitHash": "5193292133ba6d27ced44dd12a43645117708521", "commitGHEventType": "referenced", "commitUser": "shabanovd", "commitParents": ["ca0c7b2f675d1b8d9d9a5829ca0fb678310f07fc", "7aa23587eebe36f1d29858c092ca7156426dd271"], "nameRev": "5193292133ba6d27ced44dd12a43645117708521 tags/eXist-3.0.RC1~85", "commitMessage": "Merge pull request #596 from zwobit/feature/eXist-494\n\nPossible fix for #494", "commitDateTime": "2015-04-12 01:20:58", "authoredDateTime": "2015-04-12 01:20:58", "commitGitStats": [{"filePath": "src/org/exist/xquery/ElementConstructor.java", "insertions": 7, "deletions": 3, "lines": 10}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ElementConstructor.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.ElementConstructor.addNamespaceDecl(java.lang.String,java.lang.String)", "TOT": 14, "UPD": 2, "INS": 4, "MOV": 5, "DEL": 3}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {"TOT": 0, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 0, "spoonFilesChanged": 0, "spoonMethodsChanged": 0}, "statsSkippedReason": "", "changesInPackagesGIT": [], "changesInPackagesSPOON": []}, {"title": "Content of base64Binary not available under certain circumstances", "body": "When working with Contentextraction- and image-module I encountered some weird behaviour of an base64Binary variable: If processed with one of these modules, the binary itself is empty aftwards. I first thought, that this modules just swallow the binary somehow (which would not be a good thing at all), but I made some further investigations which revealed that the value of a base64Binary variable gets lost as well If you cast this variable $a  into a hexBinary $b.\n\nI posted an example at pastebin:\nhttp://pastebin.com/fr4mXpEC\n\nThere are six almost identical snippets, the last two drop this error:\n\n\"exerr:ERROR Unable to encode string value: The underlying InputStream\nhas been closed\"\n\nIn the above example the problemous scripts had some further processing (static cast to hexBinary) of the same base64Binary. Without wrapping it into an additional node, the script results in the above error. wrapping it, works as it should. Also this error does not occur with unwrapped\n_and_ unprocessed binary data.\n\nHere a smaller sample (fist one works, last one drops that error):\n\n```\nxquery version \"3.0\";\nlet $url := xs:anyURI(\"http://mirrors.creativecommons.org/presskit/logos/cc.logo.large.png\")\nreturn\n        <div>\n            {\n                let $response := http:send-request(<http:request method=\"GET\" href=\"{$url}\"/>)\n                let $binary-data := data($response[2])\n                let $hex := xs:hexBinary($binary-data)\n                return\n                    <value>{$binary-data}</value>\n            }\n        </div>\n        <div>\n            {\n                let $response := http:send-request(<http:request method=\"GET\" href=\"{$url}\"/>)\n                let $binary-data := data($response[2])\n                let $hex := xs:hexBinary($binary-data)\n                return\n                    $binary-data\n            }\n        </div>\n```\n\nImo it could be some kind of a variable validity issue or a time related thing (race condition)... but I'm not really into Java so this is only a guess. This makes contentextraction- and image module unuseable if you ie. want to get the mime type of a base64binary containing an image and afterwards try to use binary-stream().\n", "url": "https://github.com/eXist-db/exist/issues/492", "user": "ChiSamurai", "labels": ["bug"], "created": "2015-02-26 09:16:32", "closed": "2015-09-07 15:23:19", "commits": {"5ef94c1f484108077d869d8882533b358dc9c4f5": {"commitGHEventType": "closed", "commitUser": "adamretter"}}, "ttf": 193.00027777777777, "commitsDetails": [{"commitHash": "5ef94c1f484108077d869d8882533b358dc9c4f5", "commitGHEventType": "closed", "commitUser": "adamretter", "commitParents": ["4d19a5274eb0c6b0a7586951de8364bb41c3bcab", "f01ae9c9fe5fe438240242939685c5f6c8bbd483"], "nameRev": "5ef94c1f484108077d869d8882533b358dc9c4f5 tags/eXist-3.0.RC2~149", "commitMessage": "Rewrite of InputStream caching in eXist. Closes https://github.com/eXist-db/exist/pull/776. Closes https://github.com/eXist-db/exist/issues/492\n", "commitDateTime": "2015-09-07 16:22:51", "authoredDateTime": "2015-09-07 16:22:51", "commitGitStats": [{"filePath": "extensions/exquery/restxq/src/main/java/org/exist/extensions/exquery/restxq/impl/RestXqServiceImpl.java", "insertions": 73, "deletions": 75, "lines": 148}, {"filePath": "extensions/exquery/restxq/src/main/java/org/exist/extensions/exquery/restxq/impl/adapters/HttpServletRequestAdapter.java", "insertions": 79, "deletions": 79, "lines": 158}, {"filePath": "extensions/modules/src/org/exist/xquery/modules/httpclient/BaseHTTPClientFunction.java", "insertions": 144, "deletions": 139, "lines": 283}, {"filePath": "src/org/exist/util/io/AbstractFilterInputStreamCache.java", "insertions": 202, "deletions": 0, "lines": 202}, {"filePath": "src/org/exist/util/io/CachingFilterInputStream.java", "insertions": 104, "deletions": 148, "lines": 252}, {"filePath": "src/org/exist/util/io/FileFilterInputStreamCache.java", "insertions": 30, "deletions": 27, "lines": 57}, {"filePath": "src/org/exist/util/io/FilterInputStreamCache.java", "insertions": 105, "deletions": 39, "lines": 144}, {"filePath": "src/org/exist/util/io/FilterInputStreamCacheFactory.java", "insertions": 48, "deletions": 49, "lines": 97}, {"filePath": "src/org/exist/util/io/MemoryFilterInputStreamCache.java", "insertions": 36, "deletions": 36, "lines": 72}, {"filePath": "src/org/exist/util/io/MemoryMappedFileFilterInputStreamCache.java", "insertions": 31, "deletions": 27, "lines": 58}, {"filePath": "src/org/exist/util/io/TemporaryFileManager.java", "insertions": 49, "deletions": 40, "lines": 89}, {"filePath": "src/org/exist/xquery/functions/request/GetData.java", "insertions": 51, "deletions": 53, "lines": 104}, {"filePath": "src/org/exist/xquery/value/BinaryValueFromInputStream.java", "insertions": 26, "deletions": 22, "lines": 48}, {"filePath": "test/src/org/exist/util/io/CachingFilterInputStreamTest.java", "insertions": 71, "deletions": 69, "lines": 140}, {"filePath": "test/src/org/exist/util/io/CachingFilterInputStreamTest_NonMarkableByteArrayInputStream.java", "insertions": 911, "deletions": 0, "lines": 911}, {"filePath": "test/src/org/exist/util/io/NonMarkableByteArrayInputStream.java", "insertions": 71, "deletions": 0, "lines": 71}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyChanges"}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 1, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "XQuery Parser issue with call to inline function", "body": "The following query:\n\n``` xquery\nfunction ($x) {\n    $x\n}(\"hello\")\n```\n\nResults an exception from the parser:\n\n```\norg.xmldb.api.base.XMLDBException: exerr:ERROR <AST>:0:0: unexpected AST node: DynamicFunction\n [at line 6, column 10]\n    at org.exist.xmldb.LocalXPathQueryService.compile(LocalXPathQueryService.java:259)\n    at org.exist.client.QueryDialog$QueryThread.run(QueryDialog.java:600)\nCaused by: org.exist.xquery.StaticXQueryException: exerr:ERROR <AST>:0:0: unexpected AST node: DynamicFunction\n [at line 6, column 10]\n    at org.exist.xquery.XQuery.compile(XQuery.java:165)\n    at org.exist.xquery.XQuery.compile(XQuery.java:109)\n    at org.exist.xquery.XQuery.compile(XQuery.java:93)\n    at org.exist.xquery.XQuery.compile(XQuery.java:85)\n    at org.exist.xmldb.LocalXPathQueryService.compileAndCheck(LocalXPathQueryService.java:272)\n    at org.exist.xmldb.LocalXPathQueryService.compile(LocalXPathQueryService.java:257)\n    ... 1 more\nCaused by: <AST>:0:0: unexpected AST node: DynamicFunction\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:3787)\n    at org.exist.xquery.parser.XQueryTreeParser.mainModule(XQueryTreeParser.java:4220)\n    at org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:4153)\n    at org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3807)\n    at org.exist.xquery.XQuery.compile(XQuery.java:160)\n    ... 6 more\nCaused by: org.exist.xquery.StaticXQueryException: exerr:ERROR <AST>:0:0: unexpected AST node: DynamicFunction\n [at line 6, column 10]\n    at org.exist.xquery.XQuery.compile(XQuery.java:165)\n    at org.exist.xquery.XQuery.compile(XQuery.java:109)\n    at org.exist.xquery.XQuery.compile(XQuery.java:93)\n    at org.exist.xquery.XQuery.compile(XQuery.java:85)\n    at org.exist.xmldb.LocalXPathQueryService.compileAndCheck(LocalXPathQueryService.java:272)\n    at org.exist.xmldb.LocalXPathQueryService.compile(LocalXPathQueryService.java:257)\n    at org.exist.client.QueryDialog$QueryThread.run(QueryDialog.java:600)\nCaused by: <AST>:0:0: unexpected AST node: DynamicFunction\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:3787)\n    at org.exist.xquery.parser.XQueryTreeParser.mainModule(XQueryTreeParser.java:4220)\n    at org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:4153)\n    at org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3807)\n    at org.exist.xquery.XQuery.compile(XQuery.java:160)\n```\n\nThe trace of the XQuery parse tree looks like:\n\n```\n > xpath; LA(1)==function\n  > module; LA(1)==function\n   > mainModule; LA(1)==function\n    > prolog; LA(1)==function\n    < prolog; LA(1)==function\n    > queryBody; LA(1)==function\n     > expr; LA(1)==function\n      > exprSingle; LA(1)==function\n       > orExpr; LA(1)==function\n        > andExpr; LA(1)==function\n         > comparisonExpr; LA(1)==function\n          > stringConcatExpr; LA(1)==function\n           > rangeExpr; LA(1)==function\n            > additiveExpr; LA(1)==function\n             > multiplicativeExpr; LA(1)==function\n              > unionExpr; LA(1)==function\n               > intersectExceptExpr; LA(1)==function\n                > instanceofExpr; LA(1)==function\n                 > treatExpr; LA(1)==function\n                  > castableExpr; LA(1)==function\n                   > castExpr; LA(1)==function\n                    > unaryExpr; LA(1)==function\n                     > valueExpr; LA(1)==function\n                      > pathExpr; LA(1)==function\n                       > relativePathExpr; LA(1)==function\n                        > stepExpr; LA(1)==function\n                         > qName; [guessing]LA(1)==function\n                          > ncnameOrKeyword; [guessing]LA(1)==function\n                           > reservedKeywords; [guessing]LA(1)==function\n                           < reservedKeywords; [guessing]LA(1)==(\n                          < ncnameOrKeyword; [guessing]LA(1)==(\n                          > ncnameOrKeyword; [guessing]LA(1)==function\n                           > reservedKeywords; [guessing]LA(1)==function\n                           < reservedKeywords; [guessing]LA(1)==(\n                          < ncnameOrKeyword; [guessing]LA(1)==(\n                         < qName; [guessing]LA(1)==(\n                         > postfixExpr; LA(1)==function\n                          > primaryExpr; LA(1)==function\n                           > functionItemExpr; LA(1)==function\n                            > inlineFunctionExpr; LA(1)==function\n                             > annotations; LA(1)==function\n                             < annotations; LA(1)==function\n                             > paramList; LA(1)==$\n                              > param; LA(1)==$\n                               > qName; LA(1)==x\n                                > ncnameOrKeyword; [guessing]LA(1)==x\n                                < ncnameOrKeyword; [guessing]LA(1)==)\n                                > ncnameOrKeyword; LA(1)==x\n                                < ncnameOrKeyword; LA(1)==)\n                               < qName; LA(1)==)\n                              < param; LA(1)==)\n                             < paramList; LA(1)==)\n                             > functionBody; LA(1)=={\n                              > expr; LA(1)==$\n                               > exprSingle; LA(1)==$\n                                > orExpr; LA(1)==$\n                                 > andExpr; LA(1)==$\n                                  > comparisonExpr; LA(1)==$\n                                   > stringConcatExpr; LA(1)==$\n                                    > rangeExpr; LA(1)==$\n                                     > additiveExpr; LA(1)==$\n                                      > multiplicativeExpr; LA(1)==$\n                                       > unionExpr; LA(1)==$\n                                        > intersectExceptExpr; LA(1)==$\n                                         > instanceofExpr; LA(1)==$\n                                          > treatExpr; LA(1)==$\n                                           > castableExpr; LA(1)==$\n                                            > castExpr; LA(1)==$\n                                             > unaryExpr; LA(1)==$\n                                              > valueExpr; LA(1)==$\n                                               > pathExpr; LA(1)==$\n                                                > relativePathExpr; LA(1)==$\n                                                 > stepExpr; LA(1)==$\n                                                  > postfixExpr; LA(1)==$\n                                                   > primaryExpr; LA(1)==$\n                                                    > varRef; LA(1)==$\n                                                     > qName; LA(1)==x\n                                                      > ncnameOrKeyword; [guessing]LA(1)==x\n                                                      < ncnameOrKeyword; [guessing]LA(1)==}\n                                                      > ncnameOrKeyword; LA(1)==x\n                                                      < ncnameOrKeyword; LA(1)==}\n                                                     < qName; LA(1)==}\n                                                    < varRef; LA(1)==}\n                                                   < primaryExpr; LA(1)==}\n                                                  < postfixExpr; LA(1)==}\n                                                 < stepExpr; LA(1)==}\n                                                < relativePathExpr; LA(1)==}\n                                               < pathExpr; LA(1)==}\n                                              < valueExpr; LA(1)==}\n                                             < unaryExpr; LA(1)==}\n                                            < castExpr; LA(1)==}\n                                           < castableExpr; LA(1)==}\n                                          < treatExpr; LA(1)==}\n                                         < instanceofExpr; LA(1)==}\n                                        < intersectExceptExpr; LA(1)==}\n                                       < unionExpr; LA(1)==}\n                                      < multiplicativeExpr; LA(1)==}\n                                     < additiveExpr; LA(1)==}\n                                    < rangeExpr; LA(1)==}\n                                   < stringConcatExpr; LA(1)==}\n                                  < comparisonExpr; LA(1)==}\n                                 < andExpr; LA(1)==}\n                                < orExpr; LA(1)==}\n                               < exprSingle; LA(1)==}\n                              < expr; LA(1)==}\n                             < functionBody; LA(1)==(\n                            < inlineFunctionExpr; LA(1)==(\n                           < functionItemExpr; LA(1)==(\n                          < primaryExpr; LA(1)==(\n                          > dynamicFunCall; LA(1)==(\n                           > argumentList; LA(1)==(\n                            > argument; LA(1)==hello\n                             > exprSingle; LA(1)==hello\n                              > orExpr; LA(1)==hello\n                               > andExpr; LA(1)==hello\n                                > comparisonExpr; LA(1)==hello\n                                 > stringConcatExpr; LA(1)==hello\n                                  > rangeExpr; LA(1)==hello\n                                   > additiveExpr; LA(1)==hello\n                                    > multiplicativeExpr; LA(1)==hello\n                                     > unionExpr; LA(1)==hello\n                                      > intersectExceptExpr; LA(1)==hello\n                                       > instanceofExpr; LA(1)==hello\n                                        > treatExpr; LA(1)==hello\n                                         > castableExpr; LA(1)==hello\n                                          > castExpr; LA(1)==hello\n                                           > unaryExpr; LA(1)==hello\n                                            > valueExpr; LA(1)==hello\n                                             > pathExpr; LA(1)==hello\n                                              > relativePathExpr; LA(1)==hello\n                                               > stepExpr; LA(1)==hello\n                                                > literal; [guessing]LA(1)==hello\n                                                < literal; [guessing]LA(1)==)\n                                                > postfixExpr; LA(1)==hello\n                                                 > primaryExpr; LA(1)==hello\n                                                  > eqName; [guessing]LA(1)==hello\n                                                   > uriQualifiedName; [guessing]LA(1)==hello\n                                                   < uriQualifiedName; [guessing]LA(1)==)\n                                                  < eqName; [guessing]LA(1)==)\n                                                  > literal; LA(1)==hello\n                                                  < literal; LA(1)==)\n                                                 < primaryExpr; LA(1)==)\n                                                < postfixExpr; LA(1)==)\n                                               < stepExpr; LA(1)==)\n                                              < relativePathExpr; LA(1)==)\n                                             < pathExpr; LA(1)==)\n                                            < valueExpr; LA(1)==)\n                                           < unaryExpr; LA(1)==)\n                                          < castExpr; LA(1)==)\n                                         < castableExpr; LA(1)==)\n                                        < treatExpr; LA(1)==)\n                                       < instanceofExpr; LA(1)==)\n                                      < intersectExceptExpr; LA(1)==)\n                                     < unionExpr; LA(1)==)\n                                    < multiplicativeExpr; LA(1)==)\n                                   < additiveExpr; LA(1)==)\n                                  < rangeExpr; LA(1)==)\n                                 < stringConcatExpr; LA(1)==)\n                                < comparisonExpr; LA(1)==)\n                               < andExpr; LA(1)==)\n                              < orExpr; LA(1)==)\n                             < exprSingle; LA(1)==)\n                            < argument; LA(1)==)\n                           < argumentList; LA(1)==null\n                          < dynamicFunCall; LA(1)==null\n                         < postfixExpr; LA(1)==null\n                        < stepExpr; LA(1)==null\n                       < relativePathExpr; LA(1)==null\n                      < pathExpr; LA(1)==null\n                     < valueExpr; LA(1)==null\n                    < unaryExpr; LA(1)==null\n                   < castExpr; LA(1)==null\n                  < castableExpr; LA(1)==null\n                 < treatExpr; LA(1)==null\n                < instanceofExpr; LA(1)==null\n               < intersectExceptExpr; LA(1)==null\n              < unionExpr; LA(1)==null\n             < multiplicativeExpr; LA(1)==null\n            < additiveExpr; LA(1)==null\n           < rangeExpr; LA(1)==null\n          < stringConcatExpr; LA(1)==null\n         < comparisonExpr; LA(1)==null\n        < andExpr; LA(1)==null\n       < orExpr; LA(1)==null\n      < exprSingle; LA(1)==null\n     < expr; LA(1)==null\n    < queryBody; LA(1)==null\n   < mainModule; LA(1)==null\n  < module; LA(1)==null\n < xpath; LA(1)==null\n```\n\nand the trace of the XQuery Tree parse looks like:\n\n```\n> xpath(null)\n  > module(null)\n   > mainModule(null)\n    > prolog(null)\n     > functionDecl(null)\n      > annotations(x)\n      < annotations(x)\n      > paramList(x)\n       > param(x)\n       < param({)\n      < paramList({)\n      > expr(x)\n       > primaryExpr(x)\n        > postfixExpr(null)\n        < postfixExpr(<ASTNULL>)\n       < primaryExpr(<ASTNULL>)\n      < expr(<ASTNULL>)\n     < functionDecl(DynamicFunction)\n    < prolog(DynamicFunction)\n    > expr(DynamicFunction)\n    < expr(DynamicFunction)\n   < mainModule(DynamicFunction)\n  < module(null)\n < xpath(null)\n```\n", "url": "https://github.com/eXist-db/exist/issues/486", "user": "adamretter", "labels": ["bug"], "created": "2015-02-19 20:23:39", "closed": "2015-03-21 11:34:12", "commits": {}, "ttf": 29.00027777777778, "commitsDetails": []}, {"title": "JSON annotation error", "body": "The following should serialize to `intarray:[1]`\n\n``` xquery\n<intarray json:array=\"true\" json:literal=\"true\">1</intarray>\n```\n", "url": "https://github.com/eXist-db/exist/issues/465", "user": "wshager", "labels": ["bug"], "created": "2015-02-06 13:30:12", "closed": "2015-06-15 19:31:01", "commits": {"a93312960cd016bbd87d1d2bf0236e931f9ddfd4": {"commitGHEventType": "referenced", "commitUser": "adamretter"}, "e000c5cefec5f271782f4767820c0d10fcde2e52": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 129.00027777777777, "commitsDetails": [{"commitHash": "a93312960cd016bbd87d1d2bf0236e931f9ddfd4", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "e000c5cefec5f271782f4767820c0d10fcde2e52", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "spoonStatsSummary": {}, "statsSkippedReason": ""}, {"title": "file:serialize json", "body": "I need to write out some json to the file system from an xml doc.  So, I tried the following:\n\n``` xquery\nfile:serialize(<root><item>thing</item></root>, \"/path/to/data.json\", (\"method=json\",\"media-type=application/json\"))\n```\n\nIn data.json the node is duplicated as such:\n\n``` javascript\n{ \"item\" : \"thing\" } { \"item\" : \"thing\" }\n```\n\nMy system info:\n\nSystem Status\nGeneral\nUptime: PT8H43M14.379S\neXist Version:  2.1.6-LTS\neXist Build:    20140616\neXist Home: C:\\eXist216\nSVN Revision:  \nOperating System:   Windows Server 2008 R2 6.1 amd64\nFile encoding:  UTF-8\nJava\nVendor: Oracle Corporation\nVersion:    1.7.0_51\nImplementation: Java HotSpot(TM) 64-Bit Server VM\n", "url": "https://github.com/eXist-db/exist/issues/458", "user": "ford-thomas-w", "labels": ["bug"], "created": "2015-01-30 16:03:42", "closed": "2015-06-12 13:00:45", "commits": {"cf30df9d1376531165e1248fa5e66b6c0be52904": {"commitGHEventType": "closed", "commitUser": "adamretter"}, "a39189a14dbf472ab84d3239611304d7dea2fb88": {"commitGHEventType": "referenced", "commitUser": "adamretter"}, "1a734d242715f32cffac102d98e2f292f2047994": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 132.00027777777777, "commitsDetails": [{"commitHash": "cf30df9d1376531165e1248fa5e66b6c0be52904", "commitGHEventType": "closed", "commitUser": "adamretter", "commitParents": ["1c1e9b158d9b3a2e52c6927369d9ef85240c7055"], "nameRev": "cf30df9d1376531165e1248fa5e66b6c0be52904 tags/eXist-3.0.RC1~40^2~1", "commitMessage": "[bugfix] Fix double serialization issue. Closes\nhttps://github.com/eXist-db/exist/issues/458\n", "commitDateTime": "2015-06-12 11:35:28", "authoredDateTime": "2015-06-12 11:35:28", "commitGitStats": [{"filePath": "extensions/modules/src/org/exist/xquery/modules/file/SerializeToFile.java", "insertions": 12, "deletions": 48, "lines": 60}], "commitSpoonAstDiffStats": [{"spoonFilePath": "SerializeToFile.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.modules.file.SerializeToFile.eval(org.exist.xquery.value.Sequence[],org.exist.xquery.value.Sequence)", "TOT": 7, "UPD": 7, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.modules.file.SerializeToFile.parseXMLSerializationOptions(org.exist.xquery.value.Sequence)", "TOT": 3, "UPD": 3, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.modules.file.SerializeToFile.serializeXML(org.exist.xquery.value.SequenceIterator,java.util.Properties,java.io.File,boolean)", "TOT": 21, "UPD": 7, "INS": 0, "MOV": 11, "DEL": 3}, {"spoonMethodName": "org.exist.xquery.modules.file.SerializeToFile.serializeBinary(org.exist.xquery.value.BinaryValue,java.io.File,boolean)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.modules.file.SerializeToFile", "TOT": 16, "UPD": 16, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.modules.file.SerializeToFile.serializeXML(org.exist.xquery.modules.file.SequenceIterator,java.util.Properties,java.io.File,boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "a39189a14dbf472ab84d3239611304d7dea2fb88", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "1a734d242715f32cffac102d98e2f292f2047994", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["cf30df9d1376531165e1248fa5e66b6c0be52904"], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 12.0, "deletions": 48.0, "lines": 60.0, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 49.0, "UPD": 34.0, "INS": 1.0, "MOV": 11.0, "DEL": 3.0, "spoonFilesChanged": 1, "spoonMethodsChanged": 6}, "statsSkippedReason": "", "changesInPackagesGIT": ["extensions/modules/src/org/exist/xquery/modules/file"], "changesInPackagesSPOON": ["org.exist.xquery.modules.file.SerializeToFile.eval(org.exist.xquery.value.Sequence[],org.exist.xquery.value.Sequence)", "org.exist.xquery.modules.file.SerializeToFile.serializeXML(org.exist.xquery.value.SequenceIterator,java.util.Properties,java.io.File,boolean)", "org.exist.xquery.modules.file.SerializeToFile.serializeBinary(org.exist.xquery.value.BinaryValue,java.io.File,boolean)", "org.exist.xquery.modules.file.SerializeToFile.serializeXML(org.exist.xquery.modules.file.SequenceIterator,java.util.Properties,java.io.File,boolean)", "org.exist.xquery.modules.file.SerializeToFile", "org.exist.xquery.modules.file.SerializeToFile.parseXMLSerializationOptions(org.exist.xquery.value.Sequence)"]}, {"title": "backup.sh -q option is not quiet", "body": "when restoring with -r option, I also specified -q  to 'only report errors', however details of all restored are written out to stderr anyway\n\nusing 2.2 with openjdk 7 jre\n\nif I specify -q option twice, it does complain \"duplicate option specified\"\n", "url": "https://github.com/eXist-db/exist/issues/455", "user": "bkcsfi", "labels": ["bug", "investigate"], "created": "2015-01-30 01:09:11", "closed": "2015-04-12 14:21:04", "commits": {}, "ttf": 72.00027777777778, "commitsDetails": []}, {"title": "Add support for SequenceTypeUnions in typeswitch case expressions", "body": "In the XQuery 3 spec, [typeswitch case clauses](http://www.w3.org/TR/xquery-30/#id-typeswitch) can contain union operators (or more properly, can contain [SequenceTypeUnions](http://www.w3.org/TR/xquery-30/#doc-xquery30-SequenceTypeUnion)).  Here is an example adapted from the spec:\n\n``` xquery\nxquery version \"3.0\";\n\nlet $customer := <customer/>\nreturn\ntypeswitch($customer/billing-address)\n   case $a as element(*, USAddress)\n            | element(*, AustraliaAddress)\n            | element(*, MexicoAddress)\n     return $a/state\n   case $a as element(*, CanadaAddress)\n     return $a/province\n   case $a as element(*, JapanAddress)\n     return $a/prefecture\n   default\n     return \"unknown\"\n```\n\nIn eXide, this triggers the following error:\n\n```\nerror found while executing expression: org.exist.xquery.XPathException: err:XPST0003 expecting \"return\", found '|' [at line 7, column 13]\n```\n\n(Line 7 is the line with `| element(*, AustraliaAddress)`.)\n\nPlease add support for SequenceTypeUnions in typeswitch case expressions.  Thanks!\n", "url": "https://github.com/eXist-db/exist/issues/445", "user": "joewiz", "labels": ["bug"], "created": "2015-01-23 17:38:00", "closed": "2015-02-25 08:00:57", "commits": {}, "ttf": 32.000277777777775, "commitsDetails": []}, {"title": "jvm remains open when database is shutdown", "body": "hello,\nthe java process remains open, when i shutdown exist from dashboard \"Shutdown\" button (or xquery), !! it assigns 200mb to itself!\nhow can I close java process or close jvm when shutdown db?\nthanks all;\n", "url": "https://github.com/eXist-db/exist/issues/435", "user": "meshkin", "labels": ["bug", "investigate"], "created": "2015-01-04 14:30:30", "closed": "2015-04-01 19:47:51", "commits": {}, "ttf": 87.00027777777778, "commitsDetails": []}, {"title": "XPaths with `[1]` attribute return wrong results", "body": "XPath queries that contain a `[1]` attribute will return only some of the nodes that they should return.\n\nFor example, the following query will return only 1 item, the one with ID `lemma-AnuvaMSya`. Instead it should have returned 4 results, as confirmed by libxml and oXygen.\n\nA note on the query. This is a minimal test case reduction; in this particular case removing the `[1]` will lead to the expected behaviour, but removing the `[1]` is not possible in the original query/environment from which this test case has been derived.\n- `text.xql`\n\n``` xquery\nxquery version \"3.0\";\n\ndeclare namespace tei=\"http://www.tei-c.org/ns/1.0\";\n\ndoc('/db/dict/test.tei')//tei:entry\n    [./tei:sense//text()\n        [contains(., 'aMSa')]\n        [ancestor::*[@xml:lang][1]]\n    ]\n```\n- `/db/dict/test.tei`\n\n``` xml\n<TEI xmlns=\"http://www.tei-c.org/ns/1.0\" version=\"5\" xml:id=\"monier\" xml:lang=\"en\">\n    <text>\n        <entry xml:id=\"lemma-anaMSin\" ana=\"H1\">\n            <sense>an-aMSa</sense>\n        </entry>\n        <entry xml:id=\"lemma-apaBraMSa\" ana=\"H1\">\n            <sense ana=\"H1A\">ungrammatical language</sense>\n        </entry>\n        <entry xml:id=\"lemma-apaSabda\" ana=\"H1\">\n            <sense> bad or vulgar speech apa-BraMSa</sense>\n        </entry>\n        <entry xml:id=\"lemma-AMhaspatya\" ana=\"H1\">\n            <sense>belonging to the dominion of</sense>\n        </entry>\n        <entry xml:id=\"lemma-AnuvaMSya\" ana=\"H1\">\n            <sense>(fr. <w xml:lang=\"san-Latn-x-SLP1\">anu-vaMSa</w>), belonging\n                to a race</sense>\n        </entry>\n        <entry xml:id=\"lemma-AnuvaMSya-no-elem\" ana=\"H1\">\n            <sense>(fr. anu-vaMSa), belonging to a race</sense>\n        </entry>\n    </text>\n</TEI>\n```\n", "url": "https://github.com/eXist-db/exist/issues/426", "user": "gioele", "labels": ["bug"], "created": "2014-12-18 17:53:32", "closed": "2019-01-08 11:43:46", "commits": {}, "ttf": 1481.0002777777777, "commitsDetails": []}, {"title": "build dist doesn't build working distribution - missing autodeploy", "body": "Issue: dist creation fail (404 dashboard not found)\nProcess: clone, ./build.sh, ./build.sh dist\nProblem: no autodeploy directory in dist result\nSolution: copy autodeploy folder to dist directory\nForked and fixed by adding necessary stanza to dist.xml script\nMaking pull request\n\nps. startup.sh output complains about lib/test directory missing. Added mkdir lib/test to dist.xml.\n", "url": "https://github.com/eXist-db/exist/issues/410", "user": "gtnewton", "labels": ["bug", "duplicate"], "created": "2014-12-09 17:20:44", "closed": "2015-03-10 19:31:01", "commits": {}, "ttf": 91.00027777777778, "commitsDetails": []}, {"title": "output XQuery comments", "body": "```\nxquery version \"3.0\";\n(:for eXist 2.2:)\n<r>\n    <a>1</a>(:comment:)\n    <b>2</b>\n    (:<c>3</c>:)\n    <d>4</d>\n</r>\n\n(:output as follows: ----------\n<r>\n    <a>1</a>\n    <b>2</b>\n(:\n    <c>3</c>\n:)\n    <d>4</d>\n</r>\n----------:)\n```\n", "url": "https://github.com/eXist-db/exist/issues/404", "user": "jesselet", "labels": ["bug"], "created": "2014-12-03 08:42:53", "closed": "2015-04-12 11:59:26", "commits": {"d723a2004eacbe12da336003d47b5b7c421b4414": {"commitGHEventType": "closed", "commitUser": "wolfgangmm"}}, "ttf": 130.00027777777777, "commitsDetails": [{"commitHash": "d723a2004eacbe12da336003d47b5b7c421b4414", "commitGHEventType": "closed", "commitUser": "wolfgangmm", "commitParents": ["0797d71ab6c0e8808802130511344d1075f9ca35"], "nameRev": "d723a2004eacbe12da336003d47b5b7c421b4414 tags/eXist-3.0.RC1~81^2", "commitMessage": "XQuery comment inside XML element or attribute value should be treated as text. Closes #404\n", "commitDateTime": "2015-04-12 12:58:28", "authoredDateTime": "2015-04-11 22:09:24", "commitGitStats": [{"filePath": "src/org/exist/xquery/parser/XQuery.g", "insertions": 1, "deletions": 0, "lines": 1}, {"filePath": "src/org/exist/xquery/parser/XQueryLexer.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "src/org/exist/xquery/parser/XQueryLexer.smap", "insertions": 1971, "deletions": 1971, "lines": 3942}, {"filePath": "test/src/xquery/comments.xql", "insertions": 33, "deletions": 0, "lines": 33}, {"filePath": "test/src/xquery/suite.xql", "insertions": 3, "deletions": 2, "lines": 5}], "commitSpoonAstDiffStats": [{"spoonFilePath": "XQueryLexer.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.parser.XQueryLexer.mNEXT_TOKEN(boolean)", "TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["d723a2004eacbe12da336003d47b5b7c421b4414"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2009, "deletions": 1974, "lines": 3983, "gitFilesChange": 5}, "spoonStatsSummary": {"TOT": 2, "UPD": 0, "INS": 1, "MOV": 1, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/xquery/parser", "test/src/xquery/suite.xql", "src/org/exist/xquery/parser/XQuery.g", "test/src/xquery/comments.xql", "src/org/exist/xquery/parser/XQueryLexer.smap"], "changesInPackagesSPOON": ["org.exist.xquery.parser.XQueryLexer.mNEXT_TOKEN(boolean)"]}, {"title": "sm:id() in module throws error", "body": "Potentially linked to https://github.com/eXist-db/exist/issues/252, this code throws an NPE : \n\n**tesging.xqm**: \n\n``` xquery\nxquery version \"3.0\";\n\nmodule namespace testing=\"http://e-smile.org/common/testing\";\ndeclare namespace sm =\"http://exist-db.org/xquery/securitymanager\";\n\ndeclare function testing:id() {\n    sm:id()\n};\n\ndeclare function testing:real-user() {\n    sm:id()//sm:real/sm:username\n};\n\ndeclare function testing:find-user($str) {\n    sm:find-users-by-username($str)\n};\n\n```\n\n**test.xql**: \n\n``` xquery\nxquery version \"3.0\";\nimport module namespace testing = \"http://e-smile.org/common/testing\" at \"/db/apps/testing/testing.xqm\";\n <test>{\n     testing:id()\n }</test>\n```\n\n**error**:\n\n```\n2014-11-11 15:55:17,904 [eXistThread-35] ERROR (XQueryServlet.java [process]:566) -  \njava.lang.NullPointerException\n    at org.exist.xquery.functions.securitymanager.IdFunction.subjectToXml(IdFunction.java:95)\n    at org.exist.xquery.functions.securitymanager.IdFunction.functionId(IdFunction.java:77)\n    at org.exist.xquery.functions.securitymanager.IdFunction.eval(IdFunction.java:59)\n    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\n    at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:56)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:155)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:328)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:189)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.XQuery.execute(XQuery.java:297)\n    at org.exist.xquery.XQuery.execute(XQuery.java:217)\n    at org.exist.http.servlets.XQueryServlet.process(XQueryServlet.java:489)\n    at org.exist.http.servlets.XQueryServlet.doPost(XQueryServlet.java:195)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:755)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103)\n    at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:50)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:567)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:355)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:557)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n    at org.eclipse.jetty.server.Server.handle(Server.java:368)\n    at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:488)\n    at org.eclipse.jetty.server.AbstractHttpConnection.content(AbstractHttpConnection.java:943)\n    at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content(AbstractHttpConnection.java:1004)\n    at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:861)\n    at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\n    at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n    at java.lang.Thread.run(Thread.java:744)\n```\n", "url": "https://github.com/eXist-db/exist/issues/388", "user": "christophe-g", "labels": ["bug"], "created": "2014-11-11 15:34:19", "closed": "2014-12-16 11:22:54", "commits": {}, "ttf": 34.000277777777775, "commitsDetails": []}, {"title": "Failure to recognize grouping variable", "body": "Problem: eXist fails to recognize the grouping variable in the following query, and returns this error:\n\n```\n\"Definition for grouping var character not found\"\n```\n\nQuery:\n\n``` xquery\ndeclare variable $plays := (\n  document {\n   <play>\n    <title>Hamlet</title>\n    <characters>\n      <character>Hamlet</character>       \n      <character>Claudius</character>\n      <character>Polonius</character>\n      <character>Rosencrantz</character>\n      <character>Guildenstern</character>\n      <character>Francisco</character>\n      <character>Reynaldo</character>     \n    </characters>\n   </play>\n   },\n   document {<play>\n    <title>Rosenkrantz and Guildenstern are Dead</title>\n    <characters>\n      <character>Alfred</character>\n      <character>Rosencrantz</character>\n      <character>Guildenstern</character>\n      <character>Hamlet</character>   \n      <character>Claudius</character>     \n    </characters>  \n   </play>\n   }\n);\n\nfor $play in $plays/play\nlet $title := $play/title\nfor $character in $play/characters/character\ngroup by $character\nreturn\n    <character name=\"{$character}\">\n     {\n        $title ! <play>{ . }</play>\n     }\n    </character>\n```\n\nExpected result:\n\n``` xml\n<character name=\"Hamlet\">\n  <play>\n    <title>Hamlet</title>\n  </play>\n  <play>\n    <title>Rosenkrantz and Guildenstern are Dead</title>\n  </play>\n</character>\n<character name=\"Claudius\">\n  <play>\n    <title>Hamlet</title>\n  </play>\n  <play>\n    <title>Rosenkrantz and Guildenstern are Dead</title>\n  </play>\n</character>\n<character name=\"Polonius\">\n  <play>\n    <title>Hamlet</title>\n  </play>\n</character>\n<character name=\"Rosencrantz\">\n  <play>\n    <title>Hamlet</title>\n  </play>\n  <play>\n    <title>Rosenkrantz and Guildenstern are Dead</title>\n  </play>\n</character>\n<character name=\"Guildenstern\">\n  <play>\n    <title>Hamlet</title>\n  </play>\n  <play>\n    <title>Rosenkrantz and Guildenstern are Dead</title>\n  </play>\n</character>\n<character name=\"Francisco\">\n  <play>\n    <title>Hamlet</title>\n  </play>\n</character>\n<character name=\"Reynaldo\">\n  <play>\n    <title>Hamlet</title>\n  </play>\n</character>\n<character name=\"Alfred\">\n  <play>\n    <title>Rosenkrantz and Guildenstern are Dead</title>\n  </play>\n</character>\n```\n", "url": "https://github.com/eXist-db/exist/issues/384", "user": "jonathanrobie", "labels": ["bug"], "created": "2014-11-04 16:12:51", "closed": "2015-08-17 20:06:59", "commits": {}, "ttf": 286.0002777777778, "commitsDetails": []}, {"title": "Error in fn:format-number", "body": "If you evaluate the following in eXide:\n\n&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n    &lt;head&gt;\n        &lt;title&gt;&lt;/title&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;table&gt;\n            &lt;tr&gt;\n                &lt;th&gt;Formula&lt;/th&gt;\n                &lt;th&gt;Expected&lt;/th&gt;\n                &lt;th&gt;Actual&lt;/th&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td&gt;format-number(12345.6, '#,###.00')&lt;/td&gt;\n                &lt;td&gt;12,345.60&lt;/td&gt;\n                &lt;td&gt;{try {format-number(12345.6, '#,###.00')} catch \\* {$err:code}}&lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td&gt;format-number(12345678.9, '9,999.99')&lt;/td&gt;\n                &lt;td&gt;12,345,678.90&lt;/td&gt;\n                &lt;td&gt;{try {format-number(12345678.9, '9,999.99')} catch \\* {$err:code}}&lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td&gt;format-number(123.9, '9999')&lt;/td&gt;\n                &lt;td&gt;0124&lt;/td&gt;\n                &lt;td&gt;{try {format-number(123.9, '9999')} catch \\* {$err:code}}&lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td&gt;format-number(0.14, '01%')&lt;/td&gt;\n                &lt;td&gt;14%&lt;/td&gt;\n                &lt;td&gt;{try {format-number(0.14, '01%')} catch \\* {$err:code}}&lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td&gt;format-number(-6, '000')&lt;/td&gt;\n                &lt;td&gt;-006&lt;/td&gt;\n                &lt;td&gt;{try {format-number(-6, '000')} catch \\* {$err:code}}&lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td&gt;format-number(12.34, '0.000e00')&lt;/td&gt;\n                &lt;td&gt;1.234e01&lt;/td&gt;\n                &lt;td&gt;{try {format-number(12.34, '0.000e00')} catch \\* {$err:code}}&lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td&gt;format-number(12.34, '#.000e0')&lt;/td&gt;\n                &lt;td&gt;0.123e2&lt;/td&gt;\n                &lt;td&gt;{try {format-number(12345.6, '#,###.00')} catch \\* {$err:code}}&lt;/td&gt;\n            &lt;/tr&gt;\n            &lt;tr&gt;\n                &lt;td&gt;format-number(1234.5678, '#\u02b9##0\u202200', 'ch')&lt;/td&gt;\n                &lt;td&gt;1\u02b9234\u202257&lt;/td&gt;\n                &lt;td&gt;{try {format-number(1234.5678, '#\u02b9##0\u202200', 'ch')} catch \\* {$err:code}}&lt;/td&gt;\n            &lt;/tr&gt;\n        &lt;/table&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n\nYou will see failures for the examples in http://www.w3.org/TR/xpath-functions-30/#func-format-number\n\nI found this, because I was trying:\n\nfn:format-number(3.1, '000.0') and got 3.1\n\nwhere xsl:format-number(3.1, '000.0') returns what I expected as 003.1\n\nAlso, the documentation for fn:format-number is wrong.  The $picture should be referring to the W3C spec mentioned above and not java.text.Decimal.\n\nformat-number\nformat-number($value as numeric?, $picture as xs:string) as xs:string\nThe formatting of a number is controlled by a picture string. The picture string is a sequence of \u2022characters\u2022, in which the characters assigned to the variables decimal-separator-sign, grouping-sign, decimal-digit-family, optional-digit-sign and pattern-separator-sign are classified as active characters, and all other characters (including the percent-sign and per-mille-sign) are classified as passive characters.\nParameters:\n$value? The number to format\n$picture    The format pattern string. Please see the JavaDoc for java.text.DecimalFormat to get the specifics of this format string.\nReturns:\nxs:string : the formatted string\nformat-number\nformat-number($value as numeric?, $picture as xs:string, $decimal-format-name as \nxs:string) as xs:string\nParameters:\n$value? The number to format\n$picture    The format pattern string. Please see the JavaDoc for java.text.DecimalFormat to get the specifics of this format string.\n$decimal-format-name    The decimal-format name must be a QName, which is expanded as described in [2.4 Qualified Names]. It is an error if the stylesheet does not contain a declaration of the decimal-format with the specified expanded-name.\nReturns:\nxs:string : the formatted string\n", "url": "https://github.com/eXist-db/exist/issues/383", "user": "lcahlander", "labels": ["bug"], "created": "2014-11-03 15:15:29", "closed": "2019-12-06 17:39:48", "commits": {"db72540327dcf86dcb3c6c5e0219725adbad9712": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 1859.0002777777777, "commitsDetails": [{"commitHash": "db72540327dcf86dcb3c6c5e0219725adbad9712", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["10cb87dcebecfdc4e1790532eaaef59c4441ac41"], "nameRev": "db72540327dcf86dcb3c6c5e0219725adbad9712 tags/eXist-5.1.1~5", "commitMessage": "[bugfix] New implementation of fn:format-number\nCloses https://github.com/eXist-db/exist/issues/383\n", "commitDateTime": "2019-12-06 18:45:58", "authoredDateTime": "2019-11-27 19:28:51", "commitGitStats": [{"filePath": "exist-core/src/main/java/org/exist/dom/QName.java", "insertions": 22, "deletions": 9, "lines": 31}, {"filePath": "exist-core/src/main/java/org/exist/util/CodePointString.java", "insertions": 374, "deletions": 0, "lines": 374}, {"filePath": "exist-core/src/main/java/org/exist/xquery/DecimalFormat.java", "insertions": 80, "deletions": 0, "lines": 80}, {"filePath": "exist-core/src/main/java/org/exist/xquery/ErrorCodes.java", "insertions": 3, "deletions": 2, "lines": 5}, {"filePath": "exist-core/src/main/java/org/exist/xquery/Function.java", "insertions": 1, "deletions": 1, "lines": 2}, {"filePath": "exist-core/src/main/java/org/exist/xquery/XQueryContext.java", "insertions": 28, "deletions": 0, "lines": 28}, {"filePath": "exist-core/src/main/java/org/exist/xquery/functions/fn/FnFormatNumbers.java", "insertions": 821, "deletions": 295, "lines": 1116}, {"filePath": "exist-core/src/main/java/org/exist/xquery/functions/fn/FnModule.java", "insertions": 2, "deletions": 2, "lines": 4}, {"filePath": "exist-core/src/test/java/org/exist/util/CodePointStringTest.java", "insertions": 528, "deletions": 0, "lines": 528}, {"filePath": "exist-core/src/test/xquery/numbers/format-numbers.xql", "insertions": 245, "deletions": 3, "lines": 248}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": "tooManyChanges"}], "filteredCommits": ["db72540327dcf86dcb3c6c5e0219725adbad9712"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 1331, "deletions": 309, "lines": 1640, "gitFilesChange": 8}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": ["exist-core/src/main/java/org/exist/xquery", "exist-core/src/main/java/org/exist/util", "exist-core/src/main/java/org/exist/xquery/functions/fn", "exist-core/src/main/java/org/exist/dom"]}, {"title": "document-node()", "body": "Calling document-node() returns in all nodes in an in-memory document and all nodes accessed by node() in a stored document, whereas it should return all document nodes in the context. The document node cannot be accessed on the child or descendant axes.\n\nSee http://markmail.org/thread/bpgngbsg3suliioo.\n", "url": "https://github.com/eXist-db/exist/issues/382", "user": "jensopetersen", "labels": ["bug"], "created": "2014-11-03 13:07:49", "closed": "2015-06-09 14:03:03", "commits": {}, "ttf": 218.00027777777777, "commitsDetails": []}, {"title": "attributes can be accessed on child axis", "body": "It should not be possible to access attributes on the child or descendant axes.\n\n```\nlet $doc-1 := \n<doc xml:id=\"x\">\n    <a>\n        <b x=\"1\" n=\"7\">text1<e>text2</e>text3</b>\n        <b>text0</b>\n    </a>\n</doc>\n\nlet $doc-2 := doc('/db/test/test-doc.xml') (:$doc-2.xml is $doc-1.xml stored.:)\n\nreturn \n    <result>\n        <a-1>{$doc-1//b[contains(., 'text1')]/child::attribute()}</a-1>\n        <a-2>{$doc-1//b[contains(., 'text1')]/descendant-or-self::attribute()}</a-2>\n        <a-3>{$doc-1//b[contains(., 'text1')]//descendant-or-self::attribute()}</a-3>\n        <b-1>{$doc-2//b[contains(., 'text1')]/child::attribute()}</b-1>\n        <b-2>{$doc-2//b[contains(., 'text1')]/descendant-or-self::attribute()}</b-2>\n        <b-3>{$doc-2//b[contains(., 'text1')]//descendant-or-self::attribute()}</b-3>\n    </result>\n```\n\nSee http://markmail.org/message/li3zbri3kc6jcnhp.\n", "url": "https://github.com/eXist-db/exist/issues/381", "user": "jensopetersen", "labels": ["bug"], "created": "2014-11-03 13:01:55", "closed": "2015-06-24 11:19:49", "commits": {"6da0d65b7d185f85dee7d4c317bfad0c0805bae6": {"commitGHEventType": "referenced", "commitUser": "wolfgangmm"}, "70c1b511a3c58e5b609863d55ce42087dfab67a8": {"commitGHEventType": "referenced", "commitUser": "wolfgangmm"}}, "ttf": 232.00027777777777, "commitsDetails": [{"commitHash": "6da0d65b7d185f85dee7d4c317bfad0c0805bae6", "commitGHEventType": "referenced", "commitUser": "wolfgangmm", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "70c1b511a3c58e5b609863d55ce42087dfab67a8", "commitGHEventType": "referenced", "commitUser": "wolfgangmm", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "spoonStatsSummary": {}, "statsSkippedReason": ""}, {"title": "Permissions does not copy on copy operation ", "body": "here an old fix https://github.com/shabanovd/exist/commit/8d36f0fa33a65dc235ea7068196de2ea708fd5e6\n", "url": "https://github.com/eXist-db/exist/issues/377", "user": "shabanovd", "labels": ["bug", "investigate"], "created": "2014-10-29 20:51:47", "closed": "2015-06-09 18:44:53", "commits": {"2d187747f5ada9998edda649a15e4ac43212f5bc": {"commitGHEventType": "referenced", "commitUser": "adamretter"}, "591cea0baff23dc2d3de60201643365c1541ed3d": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 222.00027777777777, "commitsDetails": [{"commitHash": "2d187747f5ada9998edda649a15e4ac43212f5bc", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "591cea0baff23dc2d3de60201643365c1541ed3d", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "spoonStatsSummary": {}, "statsSkippedReason": ""}, {"title": "wrapper does not work for MacOSX 10.10 Yosemite ", "body": "With the newest MacOsX  the wrapper detects the OS (numbered 10.10) as an older OS (pre 10.5)\n\n```\nDIST_ARCH=universal\n[[ 10.10 < 10.5.0 ]]\nDIST_BITS=32\n```\n\nsee http://sourceforge.net/p/wrapper/mailman/message/32947751/  \n", "url": "https://github.com/eXist-db/exist/issues/375", "user": "dizzzz", "labels": ["bug"], "created": "2014-10-20 08:16:46", "closed": "2014-10-20 08:17:30", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "format-dateTime does not support [Z] in picture string", "body": "[Z] is not recognized as timezone indicator on the regular format-dateTime\n\n```\n   format-dateTime(current-dateTime(),'[Y0001][M01][D01][H01][m01][s01][Z]')\n```\n\n[Z] is defined here http://www.w3.org/TR/xpath-functions-30/#date-picture-string.\n", "url": "https://github.com/eXist-db/exist/issues/364", "user": "ahenket", "labels": ["bug"], "created": "2014-10-10 18:52:50", "closed": "2014-10-11 13:21:12", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "position() on reverse axes", "body": "position() on reverse axes goes by forward document order, but should count backwards, as discovered by @gioele.\n\nhttp://markmail.org/thread/ijvbtkejott2bwj7\n\n```\nxquery version \"3.0\";\n\nlet $doc := \n    <doc>\n        <entry>a</entry>\n        <entry>b</entry>\n        <entry>c</entry>\n    </doc>\n\nlet $preceding-siblings-a := $doc//entry[. eq \"c\"]/preceding-sibling::entry[position() = 1] (:incorrect:)\nlet $preceding-siblings-b := $doc//entry[. eq \"c\"]/preceding-sibling::entry[1] (:correct:)\nlet $preceding-siblings-c := $doc//entry[. eq \"c\"]/preceding-sibling::entry[last()] (:correct:)\n\nreturn \n    <result>{$preceding-siblings-a, $preceding-siblings-b, $preceding-siblings-c}</result>\n```\n", "url": "https://github.com/eXist-db/exist/issues/362", "user": "jensopetersen", "labels": ["bug"], "created": "2014-10-08 12:26:46", "closed": "2015-06-14 10:38:25", "commits": {"8c5f835f47bc940aa3af749e6ab9473278b8d75a": {"commitGHEventType": "referenced", "commitUser": "wolfgangmm"}, "bc7404db9b6135cb800cb52fe51456bcbabde912": {"commitGHEventType": "referenced", "commitUser": "wolfgangmm"}}, "ttf": 248.00027777777777, "commitsDetails": [{"commitHash": "8c5f835f47bc940aa3af749e6ab9473278b8d75a", "commitGHEventType": "referenced", "commitUser": "wolfgangmm", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "bc7404db9b6135cb800cb52fe51456bcbabde912", "commitGHEventType": "referenced", "commitUser": "wolfgangmm", "commitParents": [], "nameRev": "", "commitMessage": "", "commitDateTime": "", "authoredDateTime": "", "commitGitStats": [], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": [], "filteredCommitsReason": {"duplicated": 2, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "spoonStatsSummary": {}, "statsSkippedReason": ""}, {"title": "restxq encoding issue with media-type \"application/json\"", "body": "In 2.2 RC2 \n\nsetting the %output:media-type to application/json removes the default UTF-8 encoding from the HTTP Content-Type Header\n\nI've found no other way to set the encoding - only omitting the media-type works\n\n``` xquery\ndeclare\n  %rest:GET\n  %rest:path(\"/categories/{$id}\")\n  (: removes the encoding from response :)\n   %output:media-type(\"application/json\") \n   %output:method(\"json\")\n  (: not needed: %rest:produces(\"application/json\") :)\n  (: gives error:  %output:media-type(\"application/json; charset=UTF-8\") :)\n  (: gives error:  %output:encoding(\"UTF-8\") :)\nfunction _:get-json($id as xs:string) {\n     <json>umlauts: \u00e4\u00f6\u00fc</json>\n};\n```\n", "url": "https://github.com/eXist-db/exist/issues/353", "user": "mgaerber", "labels": ["bug"], "created": "2014-10-01 14:41:30", "closed": "2014-12-11 17:28:15", "commits": {}, "ttf": 71.00027777777778, "commitsDetails": []}, {"title": "Exception override in string-join()", "body": "If the evaluation of the parameters of `string-join()` triggers an error, the error gets overriden and is reported instead as a dynamic type mismatch.\n\nIn the following test-case `err:XPTY0004` is returned instead of `error`.\n\nTested with version 2.2RC2 and 2.1.\n\n``` xquery\nxquery version \"3.0\";\n\ndeclare function local:x() as xs:string { error(xs:QName('error')), 'x' };\n\ntry {\n   string-join(( 'a', local:x() ))\n} catch * {\n   $err:code\n}\n```\n", "url": "https://github.com/eXist-db/exist/issues/324", "user": "ptrckb", "labels": ["bug"], "created": "2014-09-04 09:52:12", "closed": "2016-05-10 19:28:36", "commits": {}, "ttf": 614.0002777777778, "commitsDetails": []}, {"title": "QuartzSchedulerImpl initialization is broken", "body": "It seems like the [QuartzSchedulerImpl initialization section](https://github.com/eXist-db/exist/blob/develop/src/org/exist/scheduler/impl/QuartzSchedulerImpl.java#L98) is wrong because the thread pool class name is invalid:\n\n``` java\ndefaultQuartzProperties.setProperty(\"org.quartz.threadPool.class\", \"org.quartz.threadPool.class\");\n```\n\nThis would lead to a runtime exception (i.e. `java.lang.ClassNotFoundException: org.quartz.threadPool.class`)\n\nShouldn't the configuration be changed to something like this?:\n\n``` java\ndefaultQuartzProperties.setProperty(\"org.quartz.threadPool.class\", \"org.quartz.simpl.SimpleThreadPool\");\n```\n", "url": "https://github.com/eXist-db/exist/issues/307", "user": "cmontemuino", "labels": ["bug"], "created": "2014-08-22 11:19:53", "closed": "2014-08-22 12:21:13", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Spatial index: GMLHSQLIndexWorker doesn't compiles", "body": "Please note that [GMLHSQLIndexWorker](https://github.com/eXist-db/exist/blob/develop/extensions/indexes/spatial/src/org/exist/indexing/spatial/GMLHSQLIndexWorker.java) class is not implementing [method getQueryRewriter from IndexWorker class](https://github.com/eXist-db/exist/blob/develop/src/org/exist/indexing/IndexWorker.java#L215).\n\nBTW, I already checked the [AbstractGMLJDBCIndexWorker](https://github.com/eXist-db/exist/blob/develop/extensions/indexes/spatial/src/org/exist/indexing/spatial/AbstractGMLJDBCIndexWorker.java) and the method is not there.\n", "url": "https://github.com/eXist-db/exist/issues/306", "user": "cmontemuino", "labels": ["bug"], "created": "2014-08-21 15:42:12", "closed": "2017-02-06 12:22:21", "commits": {}, "ttf": 899.0002777777778, "commitsDetails": []}, {"title": "Embedded: repair:clean-all(), repair:repair() give stack trace", "body": "In embedded (local) mode running the following query \n\n``` xquery\nimport module namespace repair=\"http://exist-db.org/xquery/repo/repair\" at \"resource:org/exist/xquery/modules/expathrepo/repair.xql\";\nrepair:clean-all(),\nrepair:repair()\n```\n\nresults in the following trace\n\n```\norg.xmldb.api.base.XMLDBException: err:XPST0081 error found while loading module repair: Error while loading module resource:org/exist/xquery/modules/expathrepo/repair.xql: No namespace defined for prefix compression [at line 100, column 26]\n    at org.exist.xmldb.LocalXPathQueryService.compile(LocalXPathQueryService.java:259)\n    at org.exist.client.QueryDialog$QueryThread.run(QueryDialog.java:600)\nCaused by: org.exist.xquery.XPathException: err:XPST0081 error found while loading module repair: Error while loading module resource:org/exist/xquery/modules/expathrepo/repair.xql: No namespace defined for prefix compression [at line 100, column 26]\n    at org.exist.dom.QName.parse(QName.java:289)\n    at org.exist.xquery.FunctionFactory.createFunction(FunctionFactory.java:48)\n    at org.exist.xquery.parser.XQueryTreeParser.functionCall(XQueryTreeParser.java:9843)\n    at org.exist.xquery.parser.XQueryTreeParser.primaryExpr(XQueryTreeParser.java:7071)\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:3651)\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:367)\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:1668)\n    at org.exist.xquery.parser.XQueryTreeParser.functionDecl(XQueryTreeParser.java:5688)\n    at org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:4851)\n    at org.exist.xquery.parser.XQueryTreeParser.libraryModule(XQueryTreeParser.java:4108)\n    at org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:3943)\n    at org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3731)\n    at org.exist.xquery.XQueryContext.compileModule(XQueryContext.java:2902)\n    at org.exist.xquery.XQueryContext.compileOrBorrowModule(XQueryContext.java:2831)\n    at org.exist.xquery.XQueryContext.importModule(XQueryContext.java:2773)\n    at org.exist.xquery.parser.XQueryTreeParser.importDecl(XQueryTreeParser.java:5804)\n    at org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:4844)\n    at org.exist.xquery.parser.XQueryTreeParser.mainModule(XQueryTreeParser.java:4120)\n    at org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:4065)\n    at org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3731)\n    at org.exist.xquery.XQuery.compile(XQuery.java:160)\n    at org.exist.xquery.XQuery.compile(XQuery.java:109)\n    at org.exist.xquery.XQuery.compile(XQuery.java:93)\n    at org.exist.xquery.XQuery.compile(XQuery.java:85)\n    at org.exist.xmldb.LocalXPathQueryService.compileAndCheck(LocalXPathQueryService.java:272)\n    at org.exist.xmldb.LocalXPathQueryService.compile(LocalXPathQueryService.java:257)\n    ... 1 more\nCaused by: org.exist.xquery.XPathException: err:XPST0081 error found while loading module repair: Error while loading module resource:org/exist/xquery/modules/expathrepo/repair.xql: No namespace defined for prefix compression [at line 100, column 26]\n    at org.exist.dom.QName.parse(QName.java:289)\n    at org.exist.xquery.FunctionFactory.createFunction(FunctionFactory.java:48)\n    at org.exist.xquery.parser.XQueryTreeParser.functionCall(XQueryTreeParser.java:9843)\n    at org.exist.xquery.parser.XQueryTreeParser.primaryExpr(XQueryTreeParser.java:7071)\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:3651)\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:367)\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:1668)\n    at org.exist.xquery.parser.XQueryTreeParser.functionDecl(XQueryTreeParser.java:5688)\n    at org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:4851)\n    at org.exist.xquery.parser.XQueryTreeParser.libraryModule(XQueryTreeParser.java:4108)\n    at org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:3943)\n    at org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3731)\n    at org.exist.xquery.XQueryContext.compileModule(XQueryContext.java:2902)\n    at org.exist.xquery.XQueryContext.compileOrBorrowModule(XQueryContext.java:2831)\n    at org.exist.xquery.XQueryContext.importModule(XQueryContext.java:2773)\n    at org.exist.xquery.parser.XQueryTreeParser.importDecl(XQueryTreeParser.java:5804)\n    at org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:4844)\n    at org.exist.xquery.parser.XQueryTreeParser.mainModule(XQueryTreeParser.java:4120)\n    at org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:4065)\n    at org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3731)\n    at org.exist.xquery.XQuery.compile(XQuery.java:160)\n    at org.exist.xquery.XQuery.compile(XQuery.java:109)\n    at org.exist.xquery.XQuery.compile(XQuery.java:93)\n    at org.exist.xquery.XQuery.compile(XQuery.java:85)\n    at org.exist.xmldb.LocalXPathQueryService.compileAndCheck(LocalXPathQueryService.java:272)\n    at org.exist.xmldb.LocalXPathQueryService.compile(LocalXPathQueryService.java:257)\n    at org.exist.client.QueryDialog$QueryThread.run(QueryDialog.java:600)\n```\n\nthis is bad for repairing the database :-). Query is taken from documentation.\nIn ``exist.log` the following trace is visible:\n\n```\n2014-08-14 21:32:49,970 [main] ERROR (Configuration.java [lookupModuleClass]:462) - Module http://exist-db.org/xquery/compression could not be initialized due to a missing dependancy (NoClassDefFoundError): org/apache/commons/compress/archivers/tar/TarArchiveOutputStream \njava.lang.NoClassDefFoundError: org/apache/commons/compress/archivers/tar/TarArchiveOutputStream\n        at org.exist.xquery.modules.compression.CompressionModule.<clinit>(CompressionModule.java:47)\n        at java.lang.Class.forName0(Native Method)\n        at java.lang.Class.forName(Class.java:190)\n        at org.exist.util.Configuration.lookupModuleClass(Configuration.java:446)\n        at org.exist.util.Configuration.loadModuleClasses(Configuration.java:412)\n        at org.exist.util.Configuration.configureXQuery(Configuration.java:348)\n        at org.exist.util.Configuration.<init>(Configuration.java:253)\n        at org.exist.xmldb.DatabaseImpl.configure(DatabaseImpl.java:107)\n        at org.exist.xmldb.DatabaseImpl.getLocalCollection(DatabaseImpl.java:183)\n        at org.exist.xmldb.DatabaseImpl.getCollection(DatabaseImpl.java:162)\n        at org.exist.xmldb.DatabaseImpl.getCollection(DatabaseImpl.java:153)\n        at org.xmldb.api.DatabaseManager.getCollection(Unknown Source)\n        at org.exist.client.InteractiveClient.connect(InteractiveClient.java:330)\n        at org.exist.client.InteractiveClient.connectToDatabase(InteractiveClient.java:2338)\n        at org.exist.client.InteractiveClient.run(InteractiveClient.java:2426)\n        at org.exist.client.InteractiveClient.main(InteractiveClient.java:292)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n        at java.lang.reflect.Method.invoke(Method.java:606)\n        at org.exist.start.Main.invokeMain(Main.java:126)\n        at org.exist.start.Main.run(Main.java:448)\n        at org.exist.start.Main.main(Main.java:50)\nCaused by: java.lang.ClassNotFoundException: org.apache.commons.compress.archivers.tar.TarArchiveOutputStream\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:366)\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:355)\n        at java.security.AccessController.doPrivileged(Native Method)\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:354)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:425)\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:358)\n        ... 23 more\n```\n", "url": "https://github.com/eXist-db/exist/issues/297", "user": "dizzzz", "labels": ["bug"], "created": "2014-08-14 19:37:50", "closed": "2014-08-16 17:41:35", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "RC2.2 causes an error when inserting a library that is recursively referenced.", "body": "I have just installed RC2.2 and was copying our application code when I noticed that the db seems become unresponsive when saving certain module files. From the logs it appears that it is in some sort of an endless loop recompiling dependencies.\n\nThis is how it happened. I renamed the file that was already present, and copied it using oxygen from an instance running v2.1.\nI had to forcibly kill exist, since no other way was available to stop it. When restarting, the file was not present. However, opening the original file, modifying it and saving it caused no error. Seems to be only when inserting the file anew. Using Oxygen 15.1 to do the insert.\n\nWhen RestXq is enabled, this causes exist to hang in a repeating loop of trying to compile the dependent libraries. Note that in this case the libraries do not have the .xqm ending, but and .xql ending.\n\nAfter disabling, restXq, the database did not hang, but Oxygen still reports an error when saving the file. However, it appears as if it has been saved correctly.\n\nI created a small example with 2 libraries and a calling function, but could not replicate the problem. It seems that there need to be more libraries involved. The best would be to provide the full application to whoever needs to test it. You can request that for us, or we can give you access to the application from a remote location.\n", "url": "https://github.com/eXist-db/exist/issues/294", "user": "WillemvdW", "labels": ["bug", "invalid", "investigate"], "created": "2014-08-12 20:03:23", "closed": "2015-06-12 17:29:10", "commits": {}, "ttf": 303.0002777777778, "commitsDetails": []}, {"title": "Problem with XQuery literal construction", "body": "The following (legal, according to my and Saxon's understanding) XQuery expressions fails to parse in eXist-db-2.2RC2:\n\n```\n<root a=\"{'a'}\"/>\n```\n\nThe error is: err:XPST0003 unexpected token: ' (while expecting closing tag for element constructor: root)\n\nOther literals do no cause this problem; for instance `<root a=\"{1}\"/>` works without problems.\n", "url": "https://github.com/eXist-db/exist/issues/291", "user": "opax", "labels": ["bug", "investigate"], "created": "2014-08-08 09:48:13", "closed": "2019-11-11 21:00:41", "commits": {}, "ttf": 1921.0002777777777, "commitsDetails": []}, {"title": "Creating users without group in the command-line client should throw an error", "body": "With the command-line client, the `adduser` command allows to create users without groups. The corresponding `/db/system/security/exist/accounts/user.xml` does not contain a group element.\n\nThe correct behavior would be to display an error instead of creating the user.\n", "url": "https://github.com/eXist-db/exist/issues/290", "user": "opax", "labels": ["bug", "investigate"], "created": "2014-08-06 16:07:17", "closed": "2015-04-11 15:42:26", "commits": {"84345c383d3d0ee2b6df0dac344567a06a0e6c19": {"commitGHEventType": "closed", "commitUser": "adamretter"}}, "ttf": 247.00027777777777, "commitsDetails": [{"commitHash": "84345c383d3d0ee2b6df0dac344567a06a0e6c19", "commitGHEventType": "closed", "commitUser": "adamretter", "commitParents": ["a4f8b0a7c5d9fa2526cd57d0590947bab37bd8df"], "nameRev": "84345c383d3d0ee2b6df0dac344567a06a0e6c19 tags/eXist-3.0.RC1~88^2", "commitMessage": "[bugfix] Console admin client must set at least one group when creating\na user. Closes https://github.com/eXist-db/exist/issues/290\n", "commitDateTime": "2015-04-11 14:21:10", "authoredDateTime": "2015-04-11 14:21:10", "commitGitStats": [{"filePath": "src/org/exist/client/InteractiveClient.java", "insertions": 14, "deletions": 8, "lines": 22}], "commitSpoonAstDiffStats": [{"spoonFilePath": "InteractiveClient.java", "spoonMethods": [{"spoonMethodName": "org.exist.client.InteractiveClient.process(java.lang.String)", "TOT": 29, "UPD": 12, "INS": 6, "MOV": 8, "DEL": 3}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["84345c383d3d0ee2b6df0dac344567a06a0e6c19"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 14, "deletions": 8, "lines": 22, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 29, "UPD": 12, "INS": 6, "MOV": 8, "DEL": 3, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/client"], "changesInPackagesSPOON": ["org.exist.client.InteractiveClient.process(java.lang.String)"]}, {"title": "conf.xml / jobs / unschedule-on-exception not working", "body": "Within conf.xml user jobs, we have added unschedule-on-exception not working=\"false\" (and tried \"no\" also).  Jobs are still stopping (showing as COMPLETE) when a syntax error is found within the xquery being called in the job.\n\neXist 2.1\n", "url": "https://github.com/eXist-db/exist/issues/256", "user": "phattire", "labels": ["bug", "invalid"], "created": "2014-06-30 15:06:52", "closed": "2019-01-08 11:03:57", "commits": {}, "ttf": 1652.0002777777777, "commitsDetails": []}, {"title": "move and copy triggers not firing", "body": "It appears the move document (before and after) and copy (before and after) document are not working in eXist 2.1.  (We have not verified move/copy collection triggers.)  We are not having issues with the other document triggers.  Our collection.xconf trigger definition does not call out which trigger events to fire on.\n", "url": "https://github.com/eXist-db/exist/issues/255", "user": "phattire", "labels": ["bug"], "created": "2014-06-30 15:02:45", "closed": "2016-02-10 13:43:53", "commits": {}, "ttf": 589.0002777777778, "commitsDetails": []}, {"title": "sql:execute with prepared statement crashes on empty param", "body": "The following script:\n\ndeclare namespace sql=\"http://exist-db.org/xquery/sql\";\nlet $conn := sql:get-connection(\"com.mysql.jdbc.Driver\", \"jdbc:mysql://localhost/codif\", \"root\", \"\")\nlet $stmt := sql:prepare($conn, \"insert into table1 (foo) values (?)\")\nlet $params := sql:parameters<sql:param sql:type=\"varchar\">/sql:param/sql:parameters\nreturn sql:execute($conn, $stmt, $params, false())\n\ncauses an exception.\n\nI traced the problem to method setParametersOnPreparedStatement() in ExecuteFunction.java in the sql module.  At line 433, variable child is set:\n\n  Node child = param.getFirstChild();\n\nIt is obviously set to null if the <param> element is empty.  Then at line 438 it is used:\n\n  final String  value = child.getNodeValue();\n\nwhich crashes on a NullPointerException.\n", "url": "https://github.com/eXist-db/exist/issues/254", "user": "fyergeau", "labels": ["bug"], "created": "2014-06-27 20:21:30", "closed": "2014-07-09 20:10:01", "commits": {}, "ttf": 11.000277777777777, "commitsDetails": []}, {"title": "sm:is-authenticated() in module throws error", "body": "When sm:is-authenticated() is called in a module, the function throws an error.\n\ntest.xqm:\n\n``` xquery\nxquery version \"3.0\";\n\nmodule namespace test=\"http://exist-db.org/test\";\n\ndeclare namespace sm=\"http://exist-db.org/xquery/securitymanager\";\n\ndeclare function test:is-authenticated() as xs:boolean {\n    sm:is-authenticated()\n};\n```\n\ntest.xql:\n\n``` xquery\nxquery version \"3.0\";\n\nimport module namespace test=\"http://exist-db.org/test\" at \"test.xqm\";\n\ntest:is-authenticated()\n```\n\nError:\n\njava.lang.NullPointerException\n    at org.exist.xquery.functions.securitymanager.IsAuthenticatedFunction.eval(IsAuthenticatedFunction.java:64)\n    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\n    at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:56)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.DynamicCardinalityCheck.eval(DynamicCardinalityCheck.java:74)\n    at org.exist.xquery.Atomize.eval(Atomize.java:66)\n    at org.exist.xquery.DynamicTypeCheck.eval(DynamicTypeCheck.java:61)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:328)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.XQuery.execute(XQuery.java:297)\n    at org.exist.xquery.XQuery.execute(XQuery.java:217)\n    at org.exist.http.RESTServer.executeXQuery(RESTServer.java:1533)\n    at org.exist.http.RESTServer.doGet(RESTServer.java:508)\n    at org.exist.http.servlets.EXistServlet.doGet(EXistServlet.java:222)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:735)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103)\n    at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:46)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:567)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:355)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1448)\n    at de.betterform.agent.web.filter.XFormsFilter.doFilter(XFormsFilter.java:177)\n    at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:455)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n    at org.eclipse.jetty.server.Server.handle(Server.java:368)\n    at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:488)\n    at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:932)\n    at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:994)\n    at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:640)\n    at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\n    at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n    at java.lang.Thread.run(Thread.java:722)\n", "url": "https://github.com/eXist-db/exist/issues/252", "user": "wshager", "labels": ["bug"], "created": "2014-06-26 20:41:13", "closed": "2014-12-16 11:22:54", "commits": {}, "ttf": 172.00027777777777, "commitsDetails": []}, {"title": "storeMetadata() is not always called", "body": "e.g. storeXMLResource does not call storeMetadata;\nas a consequence metadata like owner/group kan not be updated\n\nDS: think better to check all places where calling storeXMLResource to update metadata and replace by storeMetadata\n", "url": "https://github.com/eXist-db/exist/issues/250", "user": "dizzzz", "labels": ["bug"], "created": "2014-06-25 19:26:57", "closed": "2018-03-05 21:05:04", "commits": {}, "ttf": 1349.0002777777777, "commitsDetails": []}, {"title": "query rewriter issue", "body": "As shown by Gerrit (http://markmail.org/thread/ecossedrufb5yamp) whether or not indexing is applied influences the outcome of a query like,\n\n```\nlet $query :=\n<query>\n    <near slop=\"20\"><term>love</term><near>father</near></near>\n</query>\nreturn //SPEECH[ft:query(., $query)][contains(../TITLE,' ')][../STAGEDIR='Exit']\n```\n\nWith indexing of both TITLE and STAGEDIR, it results in 0 items; without indexing or with an index on just one of these, it results in 2 items.\n\nCuriously, if one supplies a dummy attribute to one or both of the indexed elements (*:TITLE or *:STAGEDIR), one obtains the expected results.\n\nTested with current develop.\n", "url": "https://github.com/eXist-db/exist/issues/248", "user": "jensopetersen", "labels": ["bug"], "created": "2014-06-24 15:27:29", "closed": "2014-09-22 20:29:10", "commits": {}, "ttf": 90.00027777777778, "commitsDetails": []}, {"title": "Collection names displayed using URL quoting", "body": "I created a collection through the web with name '\u00df'. The collection browser display the name of this collection as the url encoded represenation of the UTF8 char values.\n\n![screenshot 2014-06-15 20 04 29](https://cloud.githubusercontent.com/assets/594239/3281600/da030996-f4b7-11e3-9daf-5e8c0d938358.png)\n", "url": "https://github.com/eXist-db/exist/issues/241", "user": "zopyx", "labels": ["bug"], "created": "2014-06-15 18:08:05", "closed": "2019-01-08 10:55:51", "commits": {}, "ttf": 1667.0002777777777, "commitsDetails": []}, {"title": "Parameter named \"source\" serialize response as TEXT", "body": "When you use a parameter named \"source\" the response is TEXT instead of HTML.\n\nYou can see it in action on exist-db home page :\nhttp://exist-db.org/exist/apps/homepage/index.html?source => text\nhttp://exist-db.org/exist/apps/homepage/index.html?sourc => html\n\nBug5.xql :\n\nxquery version \"3.0\" encoding \"UTF-8\";\ndeclare option exist:serialize \"method=xhtml media-type=text/html\";\n\nlet $form := <form action=\"Bug5.xql\" method=\"get\">\n        source:<input name=\"source\" type=\"text\"/>\n        <input type=\"submit\" value=\"Send\"/>\n    </form>\nlet $source := request:get-parameter(\"source\", \"\")\nreturn\n<html>\n  <head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html;charset=UTF-8\" />\n  </head>\n  <body>\n    <p>Form: {$form}</p>\n    <p>source: {$source}</p>\n  </body>\n</html>\n", "url": "https://github.com/eXist-db/exist/issues/228", "user": "RemiKoutcherawy", "labels": ["bug", "discuss"], "created": "2014-06-06 10:17:28", "closed": "2015-04-11 15:41:57", "commits": {}, "ttf": 309.0002777777778, "commitsDetails": []}, {"title": "Save in eXide, the SetUID permission will be disabled.", "body": "Save a xquery with a SetUID permission in eXide,\nthe SetUID permission of this xquery will be disable.\n", "url": "https://github.com/eXist-db/exist/issues/227", "user": "jesselet", "labels": ["bug", "discuss"], "created": "2014-06-05 07:31:37", "closed": "2015-03-18 21:35:33", "commits": {}, "ttf": 286.0002777777778, "commitsDetails": []}, {"title": "bad XML upon authentication event", "body": "Upon an authentication event, something like the following is output when in debug or trace mode:\n\nAuthenticated by 'exist' as '[auth] &lt;account name=\"guest\" id=\"1048573\"&gt;&lt;group name=\"guest\" id=\"1048574\"&gt;&lt;manager name=\"admin\"/&gt;&lt;/group&gt;&lt;/user&gt;'.\n\nThis is not well-formed: &lt;/user&gt; should be &lt;/account&gt; (&lt;or <account&gt; should be &lt;user&gt;). I know it is not supposed to be read as XML, but it should at least look like XML.\n", "url": "https://github.com/eXist-db/exist/issues/221", "user": "jensopetersen", "labels": ["bug"], "created": "2014-05-18 18:02:02", "closed": "2014-06-03 11:18:11", "commits": {}, "ttf": 15.000277777777777, "commitsDetails": []}, {"title": "Excessive empty element created by templates:each", "body": "The following template:\n\n```\n<tr class=\"templates:each?from=addresses&amp;to=address\">\n    <td class=\"ex:print-name\"/>\n    <td class=\"ex:print-street\"/>\n    <td class=\"ex:print-city\"/>\n</tr>\n```\n\nresults in the following markup:\n\n```\n<tr class=\"templates:each?from=addresses&amp;to=address\">\n                                                </tr><tr class=\"templates:each?from=addresses&amp;to=address\">\n                    <td class=\"ex:print-name\">111</td>\n                    <td class=\"ex:print-street\">222</td>\n                    <td class=\"ex:print-city\">333</td>\n                </tr>\n...more tr tags here...\n```\n\nThe first empty tr tag is always added. This looks like a bug.\n\nThis example is taken from the documentation: \nhttp://exist-db.org/exist/apps/demo/examples/templating/templates.html\n", "url": "https://github.com/eXist-db/exist/issues/203", "user": "lagivan", "labels": ["bug", "invalid"], "created": "2014-04-23 14:17:52", "closed": "2014-08-17 21:31:54", "commits": {}, "ttf": 116.00027777777778, "commitsDetails": []}, {"title": "NPE when running util:serialize with doctype parameters", "body": "I'm trying to serialize DITA topic to string with DOCTYPE's added. So the following code block is used:\n\n```\nlet $serialization-params := \n(\n    \"doctype-public=-//D//DTD P-Topic//EN\", \n    \"doctype-system=http://domain.com/xmetal/schemas/p-topic.dtd\"\n)\nlet $topic-string := util:serialize($topic-document, $serialization-params)\n```\n\nIt fails with the following NPE:\n\n```\nCaused by: java.lang.NullPointerException\n    at org.exist.xquery.functions.util.Serialize.parseSerializationOptions(Serialize.java:194)\n    at org.exist.xquery.functions.util.Serialize.eval(Serialize.java:156)\n    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\n    at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:55)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n```\n\nAccording to the code, it splits the string using space character as a delimiter. It looks like the same code is used to parse the serialization parameters that can be provided in `declare option exist:serialize` statement. However, in case of util:serialize the parameters format is different and I believe the space should not be considered as a delimiter.\n\nI've tried to replace the space with the non-breaking space code `&#160;` This technique works well in `declare option exist:serialize` statement, however, with util:serialize it leads to another error:\n\n```\nexerr:ERROR XMLDB reported an exception while storing documentorg.xmldb.api.base.XMLDBException: The XML parser reported a problem: fatal error at (2,39) : An invalid XML character (Unicode: 0xa0) was found in the public identifier. [at line 57, column 22]\n```\n\nNot sure if it makes more sense to allow using space or `&#160;` or both but at least one of those ways should be working. Any considerations? It would be nice to fix it before 2.2 final release. I'm willing to help fixing but I'd like to hear developers' opinion on this.\n", "url": "https://github.com/eXist-db/exist/issues/200", "user": "lagivan", "labels": ["bug", "regression"], "created": "2014-04-18 18:07:30", "closed": "2019-03-10 18:23:03", "commits": {}, "ttf": 1787.0002777777777, "commitsDetails": []}, {"title": "admin web application: indexes: contents of arbitrary files listed", "body": "I just added some files with names like `a.a`, `coll.xc`, ... in `/db/system/config/db/test/`. I was expecting that only the `collection.xconf` file has any influence on the configuration.\n\nBut it seems as if every file (indepedent of its name) is used for index configuration or at least displayed in the admin panel under \"indexes\". This results in the attached screenshot \n![screenshot from 2014-04-13 06 10 01](https://cloud.githubusercontent.com/assets/6820896/2688717/0131cc28-c2c2-11e3-97ca-ea87e461a655.png)\n\nThere are 6 different, contradictory entries for the collection `/db/test`.\n\neXist version 2.2RC1\n", "url": "https://github.com/eXist-db/exist/issues/195", "user": "vogelsgesang", "labels": ["bug"], "created": "2014-04-13 04:15:20", "closed": "2014-04-27 15:48:05", "commits": {}, "ttf": 14.000277777777777, "commitsDetails": []}, {"title": "Permissions incorrect in Java admin tool Properties", "body": "With multiple files selected in the Java admin client, opening the Properties window always shows the permissions for the selected files as rw-rw-rw-, regardless of the actual permissions of the selected files. \n\n![screen shot 2014-03-27 at 8 58 12 am](https://cloud.githubusercontent.com/assets/59118/2537402/f84cfcd2-b5af-11e3-9d0d-303c6e9e6c86.png)\n\nNotice here that the original files are rw-r--r--, but the Java admin client shows the permissions as rw-rw-rw-.  \n\nA better approach would be to pick up the actual properties of the selected items. This should be straightforward if the properties are identical. If not identical, then it would make sense to display the overlapping set of properties. Even better, some UIs allow for a \"gray dash\" mark over the property checkbox that are not common across all the items; then the user can click once to turn all on, again to turn all off, or not at all to leave the original properties unchanged. I'm not sure if this UI element is available to the Java admin client though.\n", "url": "https://github.com/eXist-db/exist/issues/179", "user": "joewiz", "labels": ["bug"], "created": "2014-03-27 13:07:36", "closed": "2020-03-04 17:48:24", "commits": {}, "ttf": 2169.0002777777777, "commitsDetails": []}, {"title": "NPE in Lucene", "body": "Similar to the error reported in #166 (was #57), I am seeing an NPE at http://history.state.gov/search?q=peace&within=frus-history.  Other search terms like http://history.state.gov/search?q=piece&within=frus-history do not return any error.  This page is doing a Lucene full text search on a collection of TEI documents.  The server is running v2.1 develop branch rev. a36fbcff from Mar 2.  Restarting eXist-db didn't have an effect on the error.  The error I get in browser window is:\n\n```\nHTTP ERROR 500\n\nProblem accessing /search. Reason:\n\n    An error occurred: null\nCaused by:\n\njavax.servlet.ServletException: An error occurred: null\n    at org.exist.http.servlets.EXistServlet.doGet(EXistServlet.java:256)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:735)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103)\n    at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:46)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:577)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:353)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n    at org.eclipse.jetty.server.Server.handle(Server.java:368)\n    at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:488)\n    at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:932)\n    at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:994)\n    at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:640)\n    at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\n    at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n    at java.lang.Thread.run(Thread.java:744)\nCaused by: java.lang.NullPointerException\n    at org.exist.indexing.lucene.LuceneMatchListener.scanMatches(LuceneMatchListener.java:167)\n    at org.exist.indexing.lucene.LuceneMatchListener.startElement(LuceneMatchListener.java:126)\n    at org.exist.storage.serializers.NativeSerializer.serializeToReceiver(NativeSerializer.java:203)\n    at org.exist.storage.serializers.NativeSerializer.serializeToReceiver(NativeSerializer.java:80)\n    at org.exist.storage.serializers.Serializer.serializeToReceiver(Serializer.java:1070)\n    at org.exist.storage.serializers.Serializer.toSAX(Serializer.java:878)\n    at org.exist.dom.NodeProxy.toSAX(NodeProxy.java:791)\n    at org.exist.xquery.functions.util.Expand.eval(Expand.java:111)\n    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\n    at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:55)\n    at org.exist.xquery.DynamicCardinalityCheck.eval(DynamicCardinalityCheck.java:74)\n    at org.exist.xquery.DynamicTypeCheck.eval(DynamicTypeCheck.java:61)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:214)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.DynamicTypeCheck.eval(DynamicTypeCheck.java:61)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:327)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:307)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:189)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:327)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:100)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:189)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:327)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.XQuery.execute(XQuery.java:297)\n    at org.exist.xquery.XQuery.execute(XQuery.java:226)\n    at org.exist.xquery.functions.util.Eval.execute(Eval.java:443)\n    at org.exist.xquery.functions.util.Eval.doEval(Eval.java:396)\n    at org.exist.xquery.functions.util.Eval.eval(Eval.java:224)\n    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\n    at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:55)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:100)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:327)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.XQuery.execute(XQuery.java:297)\n    at org.exist.xquery.XQuery.execute(XQuery.java:217)\n    at org.exist.http.RESTServer.executeXQuery(RESTServer.java:1533)\n    at org.exist.http.RESTServer.doGet(RESTServer.java:508)\n    at org.exist.http.servlets.EXistServlet.doGet(EXistServlet.java:222)\n    ... 42 more\nCaused by:\n\njava.lang.NullPointerException\n    at org.exist.indexing.lucene.LuceneMatchListener.scanMatches(LuceneMatchListener.java:167)\n    at org.exist.indexing.lucene.LuceneMatchListener.startElement(LuceneMatchListener.java:126)\n    at org.exist.storage.serializers.NativeSerializer.serializeToReceiver(NativeSerializer.java:203)\n    at org.exist.storage.serializers.NativeSerializer.serializeToReceiver(NativeSerializer.java:80)\n    at org.exist.storage.serializers.Serializer.serializeToReceiver(Serializer.java:1070)\n    at org.exist.storage.serializers.Serializer.toSAX(Serializer.java:878)\n    at org.exist.dom.NodeProxy.toSAX(NodeProxy.java:791)\n    at org.exist.xquery.functions.util.Expand.eval(Expand.java:111)\n    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\n    at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:55)\n    at org.exist.xquery.DynamicCardinalityCheck.eval(DynamicCardinalityCheck.java:74)\n    at org.exist.xquery.DynamicTypeCheck.eval(DynamicTypeCheck.java:61)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:214)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.DynamicTypeCheck.eval(DynamicTypeCheck.java:61)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:327)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:307)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:189)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:327)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:100)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:189)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:327)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.XQuery.execute(XQuery.java:297)\n    at org.exist.xquery.XQuery.execute(XQuery.java:226)\n    at org.exist.xquery.functions.util.Eval.execute(Eval.java:443)\n    at org.exist.xquery.functions.util.Eval.doEval(Eval.java:396)\n    at org.exist.xquery.functions.util.Eval.eval(Eval.java:224)\n    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\n    at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:55)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:100)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:327)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.XQuery.execute(XQuery.java:297)\n    at org.exist.xquery.XQuery.execute(XQuery.java:217)\n    at org.exist.http.RESTServer.executeXQuery(RESTServer.java:1533)\n    at org.exist.http.RESTServer.doGet(RESTServer.java:508)\n    at org.exist.http.servlets.EXistServlet.doGet(EXistServlet.java:222)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:735)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103)\n    at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:46)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:577)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:353)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n    at org.eclipse.jetty.server.Server.handle(Server.java:368)\n    at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:488)\n    at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:932)\n    at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:994)\n    at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:640)\n    at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\n    at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n    at java.lang.Thread.run(Thread.java:744)\nPowered by Jetty://\n```\n\nThe error in exist.log appears to be identical (?):\n\n```\n2014-03-25 18:23:49,977 [eXistThread-51] ERROR (EXistServlet.java [doGet]:255) -  \njava.lang.NullPointerException\n    at org.exist.indexing.lucene.LuceneMatchListener.scanMatches(LuceneMatchListener.java:167)\n    at org.exist.indexing.lucene.LuceneMatchListener.startElement(LuceneMatchListener.java:126)\n    at org.exist.storage.serializers.NativeSerializer.serializeToReceiver(NativeSerializer.java:203)\n    at org.exist.storage.serializers.NativeSerializer.serializeToReceiver(NativeSerializer.java:80)\n    at org.exist.storage.serializers.Serializer.serializeToReceiver(Serializer.java:1070)\n    at org.exist.storage.serializers.Serializer.toSAX(Serializer.java:878)\n    at org.exist.dom.NodeProxy.toSAX(NodeProxy.java:791)\n    at org.exist.xquery.functions.util.Expand.eval(Expand.java:111)\n    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\n    at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:55)\n    at org.exist.xquery.DynamicCardinalityCheck.eval(DynamicCardinalityCheck.java:74)\n    at org.exist.xquery.DynamicTypeCheck.eval(DynamicTypeCheck.java:61)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:214)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.DynamicTypeCheck.eval(DynamicTypeCheck.java:61)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:327)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.ForExpr.eval(ForExpr.java:307)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:189)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:327)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:100)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:102)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)\n    at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:189)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:327)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.XQuery.execute(XQuery.java:297)\n    at org.exist.xquery.XQuery.execute(XQuery.java:226)\n    at org.exist.xquery.functions.util.Eval.execute(Eval.java:443)\n    at org.exist.xquery.functions.util.Eval.doEval(Eval.java:396)\n    at org.exist.xquery.functions.util.Eval.eval(Eval.java:224)\n    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\n    at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:55)\n    at org.exist.xquery.ConditionalExpression.eval(ConditionalExpression.java:100)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.UserDefinedFunction.eval(UserDefinedFunction.java:153)\n    at org.exist.xquery.FunctionCall.evalFunction(FunctionCall.java:327)\n    at org.exist.xquery.FunctionCall.eval(FunctionCall.java:232)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.SequenceConstructor.eval(SequenceConstructor.java:84)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:187)\n    at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.PathExpr.eval(PathExpr.java:264)\n    at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)\n    at org.exist.xquery.XQuery.execute(XQuery.java:297)\n    at org.exist.xquery.XQuery.execute(XQuery.java:217)\n    at org.exist.http.RESTServer.executeXQuery(RESTServer.java:1533)\n    at org.exist.http.RESTServer.doGet(RESTServer.java:508)\n    at org.exist.http.servlets.EXistServlet.doGet(EXistServlet.java:222)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:735)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229)\n    at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103)\n    at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:46)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:577)\n    at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:353)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n    at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)\n    at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)\n    at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533)\n    at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)\n    at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)\n    at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)\n    at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)\n    at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)\n    at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)\n    at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)\n    at org.eclipse.jetty.server.Server.handle(Server.java:368)\n    at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:488)\n    at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:932)\n    at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:994)\n    at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:640)\n    at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)\n    at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)\n    at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)\n    at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)\n    at java.lang.Thread.run(Thread.java:744)\n```\n", "url": "https://github.com/eXist-db/exist/issues/177", "user": "joewiz", "labels": ["bug"], "created": "2014-03-25 22:27:31", "closed": "2015-06-06 03:59:37", "commits": {}, "ttf": 437.0002777777778, "commitsDetails": []}, {"title": "Local mode: err:XPST0081 error found while loading module repair", "body": "The following xquery yields in a trace when running in localmode:\n\n``` xquery\nxquery version \"3.0\";\nimport module namespace repair=\"http://exist-db.org/xquery/repo/repair\" \nat \"resource:org/exist/xquery/modules/expathrepo/repair.xql\";\nrepair:clean-all(),\nrepair:repair()\n```\n\n```\norg.xmldb.api.base.XMLDBException: err:XPST0081 error found while loading module repair: Error while loading module resource:org/exist/xquery/modules/expathrepo/repair.xql: No namespace defined for prefix compression [at line 100, column 26]\n    at org.exist.xmldb.LocalXPathQueryService.compile(LocalXPathQueryService.java:259)\n    at org.exist.client.QueryDialog$QueryThread.run(QueryDialog.java:593)\nCaused by: org.exist.xquery.XPathException: err:XPST0081 error found while loading module repair: Error while loading module resource:org/exist/xquery/modules/expathrepo/repair.xql: No namespace defined for prefix compression [at line 100, column 26]\n    at org.exist.dom.QName.parse(QName.java:289)\n    at org.exist.xquery.FunctionFactory.createFunction(FunctionFactory.java:48)\n    at org.exist.xquery.parser.XQueryTreeParser.functionCall(XQueryTreeParser.java:9843)\n    at org.exist.xquery.parser.XQueryTreeParser.primaryExpr(XQueryTreeParser.java:7071)\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:3651)\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:367)\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:1668)\n    at org.exist.xquery.parser.XQueryTreeParser.functionDecl(XQueryTreeParser.java:5688)\n    at org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:4851)\n    at org.exist.xquery.parser.XQueryTreeParser.libraryModule(XQueryTreeParser.java:4108)\n    at org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:3943)\n    at org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3731)\n    at org.exist.xquery.XQueryContext.compileModule(XQueryContext.java:2905)\n    at org.exist.xquery.XQueryContext.compileOrBorrowModule(XQueryContext.java:2834)\n    at org.exist.xquery.XQueryContext.importModule(XQueryContext.java:2776)\n    at org.exist.xquery.parser.XQueryTreeParser.importDecl(XQueryTreeParser.java:5804)\n    at org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:4844)\n    at org.exist.xquery.parser.XQueryTreeParser.mainModule(XQueryTreeParser.java:4120)\n    at org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:4065)\n    at org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3731)\n    at org.exist.xquery.XQuery.compile(XQuery.java:160)\n    at org.exist.xquery.XQuery.compile(XQuery.java:109)\n    at org.exist.xquery.XQuery.compile(XQuery.java:93)\n    at org.exist.xquery.XQuery.compile(XQuery.java:85)\n    at org.exist.xmldb.LocalXPathQueryService.compileAndCheck(LocalXPathQueryService.java:272)\n    at org.exist.xmldb.LocalXPathQueryService.compile(LocalXPathQueryService.java:257)\n    ... 1 more\nCaused by: org.exist.xquery.XPathException: err:XPST0081 error found while loading module repair: Error while loading module resource:org/exist/xquery/modules/expathrepo/repair.xql: No namespace defined for prefix compression [at line 100, column 26]\n    at org.exist.dom.QName.parse(QName.java:289)\n    at org.exist.xquery.FunctionFactory.createFunction(FunctionFactory.java:48)\n    at org.exist.xquery.parser.XQueryTreeParser.functionCall(XQueryTreeParser.java:9843)\n    at org.exist.xquery.parser.XQueryTreeParser.primaryExpr(XQueryTreeParser.java:7071)\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:3651)\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:367)\n    at org.exist.xquery.parser.XQueryTreeParser.expr(XQueryTreeParser.java:1668)\n    at org.exist.xquery.parser.XQueryTreeParser.functionDecl(XQueryTreeParser.java:5688)\n    at org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:4851)\n    at org.exist.xquery.parser.XQueryTreeParser.libraryModule(XQueryTreeParser.java:4108)\n    at org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:3943)\n    at org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3731)\n    at org.exist.xquery.XQueryContext.compileModule(XQueryContext.java:2905)\n    at org.exist.xquery.XQueryContext.compileOrBorrowModule(XQueryContext.java:2834)\n    at org.exist.xquery.XQueryContext.importModule(XQueryContext.java:2776)\n    at org.exist.xquery.parser.XQueryTreeParser.importDecl(XQueryTreeParser.java:5804)\n    at org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:4844)\n    at org.exist.xquery.parser.XQueryTreeParser.mainModule(XQueryTreeParser.java:4120)\n    at org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:4065)\n    at org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3731)\n    at org.exist.xquery.XQuery.compile(XQuery.java:160)\n    at org.exist.xquery.XQuery.compile(XQuery.java:109)\n    at org.exist.xquery.XQuery.compile(XQuery.java:93)\n    at org.exist.xquery.XQuery.compile(XQuery.java:85)\n    at org.exist.xmldb.LocalXPathQueryService.compileAndCheck(LocalXPathQueryService.java:272)\n    at org.exist.xmldb.LocalXPathQueryService.compile(LocalXPathQueryService.java:257)\n    at org.exist.client.QueryDialog$QueryThread.run(QueryDialog.java:593)\n\n``\n```\n", "url": "https://github.com/eXist-db/exist/issues/171", "user": "dizzzz", "labels": ["bug"], "created": "2014-03-17 11:23:43", "closed": "2014-09-30 20:28:55", "commits": {}, "ttf": 197.00027777777777, "commitsDetails": []}, {"title": "Proxy firewall: trace at startup", "body": "Behind a proxy/firewall it seems during startup a call is made to a server. Need to verify why, it makes exist hang for some time.\n", "url": "https://github.com/eXist-db/exist/issues/163", "user": "dizzzz", "labels": ["bug", "investigate"], "created": "2014-03-06 14:25:01", "closed": "2017-03-06 20:15:22", "commits": {}, "ttf": 1096.0002777777777, "commitsDetails": []}, {"title": "Trace at startup: (NoClassDefFoundError): TarArchiveOutputStream", "body": "The tracelog explains it all\n\n```\n2014-03-06 14:57:33,968 [main] INFO  (Configuration.java [<init>]:183) - Reading configuration from file C:\\Localdata\\Development\\GitHub\\exist\\conf.xml \n2014-03-06 14:57:34,060 [main] INFO  (Configuration.java [configureStartup]:1258) - Registered StartupTrigger: org.exist.extensions.exquery.restxq.impl.RestXqStartupTrigger \n2014-03-06 14:57:34,061 [main] INFO  (Configuration.java [configureStartup]:1258) - Registered StartupTrigger: org.exist.repo.AutoDeploymentTrigger \n2014-03-06 14:57:34,335 [main] ERROR (Configuration.java [lookupModuleClass]:462) - Module http://exist-db.org/xquery/compression could not be initialized due to a missing dependancy (NoClassDefFoundError): org/apache/commons/compress/archivers/tar/TarArchiveOutputStream \njava.lang.NoClassDefFoundError: org/apache/commons/compress/archivers/tar/TarArchiveOutputStream\n    at org.exist.xquery.modules.compression.CompressionModule.<clinit>(CompressionModule.java:47)\n    at java.lang.Class.forName0(Native Method)\n    at java.lang.Class.forName(Class.java:190)\n    at org.exist.util.Configuration.lookupModuleClass(Configuration.java:446)\n    at org.exist.util.Configuration.loadModuleClasses(Configuration.java:412)\n    at org.exist.util.Configuration.configureXQuery(Configuration.java:348)\n    at org.exist.util.Configuration.<init>(Configuration.java:253)\n    at org.exist.xmldb.DatabaseImpl.configure(DatabaseImpl.java:107)\n    at org.exist.xmldb.DatabaseImpl.getLocalCollection(DatabaseImpl.java:183)\n    at org.exist.xmldb.DatabaseImpl.getCollection(DatabaseImpl.java:162)\n    at org.exist.xmldb.DatabaseImpl.getCollection(DatabaseImpl.java:153)\n    at org.xmldb.api.DatabaseManager.getCollection(Unknown Source)\n    at org.exist.client.InteractiveClient.connect(InteractiveClient.java:329)\n    at org.exist.client.InteractiveClient.connectToDatabase(InteractiveClient.java:2339)\n    at org.exist.client.InteractiveClient.run(InteractiveClient.java:2427)\n    at org.exist.client.InteractiveClient.main(InteractiveClient.java:291)\n    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.lang.reflect.Method.invoke(Method.java:606)\n    at org.exist.start.Main.invokeMain(Main.java:126)\n    at org.exist.start.Main.run(Main.java:448)\n    at org.exist.start.Main.main(Main.java:50)\nCaused by: java.lang.ClassNotFoundException: org.apache.commons.compress.archivers.tar.TarArchiveOutputStream\n    at java.net.URLClassLoader$1.run(URLClassLoader.java:366)\n    at java.net.URLClassLoader$1.run(URLClassLoader.java:355)\n    at java.security.AccessController.doPrivileged(Native Method)\n    at java.net.URLClassLoader.findClass(URLClassLoader.java:354)\n    at java.lang.ClassLoader.loadClass(ClassLoader.java:425)\n    at java.lang.ClassLoader.loadClass(ClassLoader.java:358)\n    ... 23 more\n2014-03-06 14:57:34,355 [main] INFO  (eXistURLStreamHandlerFactory.java [init]:53) - Succesfully registered eXistURLStreamHandlerFactory. \n```\n", "url": "https://github.com/eXist-db/exist/issues/162", "user": "dizzzz", "labels": ["bug"], "created": "2014-03-06 14:20:16", "closed": "2015-05-30 14:44:29", "commits": {}, "ttf": 450.0002777777778, "commitsDetails": []}, {"title": "\"boundary-space preserve\" declaration not observed", "body": "With a \"boundary-space preserve\" declaration, white-space between elements is supposed to be maintained. However, when I feed the function below with the exact same contents from an in-memory variable and from a document stored in the database, the result of the in-memory fragment is returned with white-space preserved, whereas the result of the stored document is returned as if the declaration had told the function to strip white-space, if the text node is white-space-only.\n# \n\n```\nxquery version \"3.0\";\n\ndeclare namespace tei=\"http://www.tei-c.org/ns/1.0\";\n\ndeclare boundary-space preserve;\n\ndeclare function local:get-text($input as node()*) as item()* {\n   for $node in $input/node()\n       return\n           typeswitch($node)\n               case text() return \n                   $node\n                       default return local:get-text($node)\n};\n\nlet $in-memory := \n<TEI xmlns=\"http://www.tei-c.org/ns/1.0\">\n<p>Government of new Territory of Nevada\u2014Governor <name>Nye</name> <lb/>and the practical jokers\u2014<name>Mr. Clemens</name> begins journalistic life <lb/>on <name>Virginia City</name> <name>Enterprise</name>.</p>\n</TEI>\n\nlet $stored := doc('/db/test/stored.xml')\n\nreturn\n   <result>\n       <inline>{string-join(local:get-text($in-memory))}</inline>\n       <stored>{string-join(local:get-text($stored))}</stored>\n   </result>\n```\n# \n\nThe result I get is:\n\n```\n<result>\n    <inline>Government of new Territory of Nevada\u2014Governor Nye and the practical jokers\u2014Mr. Clemens begins journalistic life on Virginia City Enterprise. </inline>\n    <stored>Government of new Territory of Nevada\u2014Governor Nyeand the practical jokers\u2014Mr. Clemens begins journalistic life on Virginia CityEnterprise.</stored>\n</result>\n```\n\nwhere \"Nye\" and \"and\" and \"City\" and \"Enterprise\" are run together in the \"stored\" output, because the space between <name> and <lb> and between <name> and <name> is stripped.\n\nSetting preserve-whitespace-mixed-content=\"yes\" in conf.xml works as a workaround, but is not ideal.\n", "url": "https://github.com/eXist-db/exist/issues/147", "user": "jensopetersen", "labels": ["bug", "wontfix"], "created": "2014-02-12 10:08:05", "closed": "2019-01-09 04:20:56", "commits": {}, "ttf": 1791.0002777777777, "commitsDetails": []}, {"title": "History trigger fails", "body": "Current (pull #128) develop branch:\n\n| General |  |\n| --- | --- |\n| Uptime: | PT49M2.568S |\n| eXist Version: | 2.1 |\n| eXist Build: | 20140131 |\n| eXist Home: | C:\\exist |\n| SVN Revision: |  |\n| Operating System: | Windows 7 6.1 amd64 |\n| File encoding: | UTF-8 |\n\n| Java |  |\n| --- | --- |\n| Vendor: | Oracle Corporation |\n| Version: | 1.7.0_51 |\n| Implementation: | Java HotSpot(TM) 64-Bit Server VM |\n| Installation: | C:\\Java\\jre7 |\n| Temp file path: | C:\\exist\\tools\\jetty/tmp |\n\n| Memory Usage |  |\n| --- | --- |\n| Max. Memory: | 932352K |\n| Current Total: | 357376K |\n| Free: | 153699K |\n\nAdded a HistoryTrigger and received a Stack Overflow error:\n\n```\n2014-01-31 09:41:13,555 [eXistThread-61] DEBUG (RpcConnection.java [handleException]:124) -  \njava.lang.StackOverflowError\n    at sun.misc.Unsafe.putInt(Native Method)\n    at java.nio.DirectByteBuffer.putInt(Unknown Source)\n    at java.nio.DirectByteBuffer.putInt(Unknown Source)\n    at org.exist.storage.btree.UpdateValueLoggable.write(UpdateValueLoggable.java:73)\n    at org.exist.storage.journal.Journal.writeToLog(Journal.java:244)\n    at org.exist.storage.btree.BTree.writeToLog(BTree.java:759)\n    at org.exist.storage.btree.BTree.access$2(BTree.java:757)\n    at org.exist.storage.btree.BTree$BTreeNode.addValue(BTree.java:1424)\n    at org.exist.storage.btree.BTree$BTreeNode.addValue(BTree.java:1414)\n    at org.exist.storage.btree.BTree$BTreeNode.access$0(BTree.java:1406)\n    at org.exist.storage.btree.BTree.addValue(BTree.java:272)\n    at org.exist.storage.index.BFile.update(BFile.java:986)\n    at org.exist.storage.index.BFile.update(BFile.java:934)\n    at org.exist.storage.index.BFile.put(BFile.java:692)\n    at org.exist.storage.NativeBroker.saveCollection(NativeBroker.java:1646)\n    at org.exist.collections.triggers.HistoryTrigger.makeCopy(HistoryTrigger.java:101)\n    at org.exist.collections.triggers.HistoryTrigger.beforeCopyDocument(HistoryTrigger.java:143)\n    at org.exist.collections.triggers.DocumentTriggersVisitor.beforeCopyDocument(DocumentTriggersVisitor.java:86)\n    at org.exist.storage.NativeBroker.copyResource(NativeBroker.java:2509)\n    at org.exist.collections.triggers.HistoryTrigger.makeCopy(HistoryTrigger.java:102)\n    at org.exist.collections.triggers.HistoryTrigger.beforeCopyDocument(HistoryTrigger.java:143)\n    at org.exist.collections.triggers.DocumentTriggersVisitor.beforeCopyDocument(DocumentTriggersVisitor.java:86)\n    at org.exist.storage.NativeBroker.copyResource(NativeBroker.java:2509)\n    at org.exist.collections.triggers.HistoryTrigger.makeCopy(HistoryTrigger.java:102)\n    at org.exist.collections.triggers.HistoryTrigger.beforeCopyDocument(HistoryTrigger.java:143)\n    at org.exist.collections.triggers.DocumentTriggersVisitor.beforeCopyDocument(DocumentTriggersVisitor.java:86)\n    at org.exist.storage.NativeBroker.copyResource(NativeBroker.java:2509)\n    at org.exist.collections.triggers.HistoryTrigger.makeCopy(HistoryTrigger.java:102)\n    at org.exist.collections.triggers.HistoryTrigger.beforeCopyDocument(HistoryTrigger.java:143)\n    at org.exist.collections.triggers.DocumentTriggersVisitor.beforeCopyDocument(DocumentTriggersVisitor.java:86)\n    at org.exist.storage.NativeBroker.copyResource(NativeBroker.java:2509)\n    at org.exist.collections.triggers.HistoryTrigger.makeCopy(HistoryTrigger.java:102)\n    at org.exist.collections.triggers.HistoryTrigger.beforeCopyDocument(HistoryTrigger.java:143)\n    at org.exist.collections.triggers.DocumentTriggersVisitor.beforeCopyDocument(DocumentTriggersVisitor.java:86)\n    at org.exist.storage.NativeBroker.copyResource(NativeBroker.java:2509)\n    at org.exist.collections.triggers.HistoryTrigger.makeCopy(HistoryTrigger.java:102)\n    at org.exist.collections.triggers.HistoryTrigger.beforeCopyDocument(HistoryTrigger.java:143)\n    at org.exist.collections.triggers.DocumentTriggersVisitor.beforeCopyDocument(DocumentTriggersVisitor.java:86)\n    at org.exist.storage.NativeBroker.copyResource(NativeBroker.java:2509)\n    at org.exist.collections.triggers.HistoryTrigger.makeCopy(HistoryTrigger.java:102)\n    at org.exist.collections.triggers.HistoryTrigger.beforeCopyDocument(HistoryTrigger.java:143)\n    at \n.\n.\n.\norg.exist.collections.triggers.DocumentTriggersVisitor.beforeCopyDocument(DocumentTriggersVisitor.java:86)\n    at org.exist.storage.NativeBroker.copyResource(NativeBroker.java:2509)\n    at org.exist.collections.triggers.HistoryTrigger.makeCopy(HistoryTrigger.java:102)\n    at org.exist.collections.triggers.HistoryTrigger.beforeCopyDocument(HistoryTrigger.java:143)\n    at org.exist.collections.triggers.DocumentTriggersVisitor.beforeCopyDocument(DocumentTriggersVisitor.java:86)\n    at org.exist.storage.NativeBroker.copyResource(NativeBroker.java:2509)\n    at org.exist.collections.triggers.HistoryTrigger.makeCopy(HistoryTrigger.java:102)\n```\n", "url": "https://github.com/eXist-db/exist/issues/139", "user": "lcahlander", "labels": ["bug"], "created": "2014-01-31 14:58:27", "closed": "2017-11-21 19:47:24", "commits": {"991e2da4eb66cb61b8f58ba28d74cf1488bc9a89": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 1390.0002777777777, "commitsDetails": [{"commitHash": "991e2da4eb66cb61b8f58ba28d74cf1488bc9a89", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["f502c41aab04bc44cff778c92bfdd25332d985f6"], "nameRev": "991e2da4eb66cb61b8f58ba28d74cf1488bc9a89 tags/eXist-3.6.0~14^2", "commitMessage": "[bugfix] Resolve StackOverflow in HistoryTrigger. Closes https://github.com/eXist-db/exist/issues/139\n", "commitDateTime": "2017-11-21 18:49:22", "authoredDateTime": "2017-11-21 18:47:35", "commitGitStats": [{"filePath": "src/org/exist/collections/triggers/HistoryTrigger.java", "insertions": 1, "deletions": 1, "lines": 2}], "commitSpoonAstDiffStats": [{"spoonFilePath": "HistoryTrigger.java", "spoonMethods": [{"spoonMethodName": "org.exist.collections.triggers.HistoryTrigger.beforeCopyDocument(org.exist.storage.DBBroker,org.exist.storage.txn.Txn,org.exist.dom.persistent.DocumentImpl,org.exist.xmldb.XmldbURI)", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["991e2da4eb66cb61b8f58ba28d74cf1488bc9a89"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 1, "deletions": 1, "lines": 2, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/collections/triggers"], "changesInPackagesSPOON": ["org.exist.collections.triggers.HistoryTrigger.beforeCopyDocument(org.exist.storage.DBBroker,org.exist.storage.txn.Txn,org.exist.dom.persistent.DocumentImpl,org.exist.xmldb.XmldbURI)"]}, {"title": "when backing up with the Admin Client, an existing backup file is always overwritten", "body": "On Mac OS 10.9.1, using Oracle build 1.7.0_51-b13, I have done the following:\n\n1 download latest develop (8dc2e164dd)\n2 build\n2 start up eXist\n3 open up admin client against new build\n4 accept default settings (connect type: remote) and log in to admin account with the default empty password\n5 export the contents of the database to some destination\n6 export the contents of the database to the same destination, using the same filename. Answer \"No\" to \"OK to delete\".\n    # It does not matter what you answer - the original backup is deleted in any case.\n", "url": "https://github.com/eXist-db/exist/issues/129", "user": "jensopetersen", "labels": ["bug", "enhancement"], "created": "2014-01-22 13:22:12", "closed": "2019-01-08 10:11:41", "commits": {}, "ttf": 1811.0002777777777, "commitsDetails": []}, {"title": "unable to change password of users other than admin in Admin Client", "body": "One is unable to change the password of a user one has created in the Admin Client\n\nOn Mac OS 10.9.1, using Oracle build 1.7.0_51-b13, I have done the following:\n\n1 download develop (8dc2e164dd)\n2 build\n2 start up eXist\n3 open up admin client against new build\n4 accept default settings (connect type: remote) and log in to admin account with the default empty password\n5 choose Edit Users from Tools\n6 set admin password to e.g. \"secret\"\n7 create a user \"foo\" with password \"bar\" - assign \"foo\" to the group \"guest\" and click \"Create\"\n9 open the user account for foo\n10 change foo's password to e.g. \"magic\" and click \"Save\"\n    # One gets the error \"org.xmldb.api.base.XMLDBException: Wrong password for user [admin]\"\n11 restart the (now unresponding) admin client and log in with admin/secret\n12 change the password of the foo user to the password of the admin user, \"secret\", and click \"Save\"\n    # this works: the problem is that one can only change the password of existing users to the password of the admin user, since (I guess) the code for changing the admin user and changing other users is mixed up - when you change the admin user, a login with the new admin password is presumably performed, and this appears to be happening as well when you change the password of other users\n", "url": "https://github.com/eXist-db/exist/issues/128", "user": "jensopetersen", "labels": ["bug", "investigate"], "created": "2014-01-22 13:20:08", "closed": "2015-04-11 15:42:25", "commits": {"a4f8b0a7c5d9fa2526cd57d0590947bab37bd8df": {"commitGHEventType": "closed", "commitUser": "adamretter"}}, "ttf": 444.0002777777778, "commitsDetails": [{"commitHash": "a4f8b0a7c5d9fa2526cd57d0590947bab37bd8df", "commitGHEventType": "closed", "commitUser": "adamretter", "commitParents": ["5869d68cd6057058c476a2cbbe995c627ec13922"], "nameRev": "a4f8b0a7c5d9fa2526cd57d0590947bab37bd8df tags/eXist-3.0.RC1~88^2~1", "commitMessage": "[bugfix] Changing a users password attempted to reset the\nlogged-in-user. Closes https://github.com/eXist-db/exist/issues/128\n", "commitDateTime": "2015-04-11 14:03:23", "authoredDateTime": "2015-04-11 14:03:23", "commitGitStats": [{"filePath": "src/org/exist/client/InteractiveClient.java", "insertions": 4, "deletions": 0, "lines": 4}, {"filePath": "src/org/exist/client/security/EditUserDialog.java", "insertions": 45, "deletions": 28, "lines": 73}, {"filePath": "src/org/exist/client/security/UserManagerDialog.java", "insertions": 4, "deletions": 11, "lines": 15}], "commitSpoonAstDiffStats": [{"spoonFilePath": "InteractiveClient.java", "spoonMethods": [{"spoonMethodName": "org.exist.client.InteractiveClient.connect()", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "EditUserDialog.java", "spoonMethods": [{"spoonMethodName": "org.exist.client.security.EditUserDialog.setAccountFromFormProperties()", "TOT": 6, "UPD": 2, "INS": 2, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.exist.client.security.EditUserDialog.updateUser()", "TOT": 10, "UPD": 2, "INS": 4, "MOV": 3, "DEL": 1}, {"spoonMethodName": "org.exist.client.security.EditUserDialog", "TOT": 3, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 3}]}, {"spoonFilePath": "UserManagerDialog.java", "spoonMethods": [{"spoonMethodName": "org.exist.client.security.UserManagerDialog.showEditUserDialog(org.exist.security.Account)", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.client.security.UserManagerDialog.showEditGroupDialog(org.exist.security.Group)", "TOT": 1, "UPD": 1, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.client.security.UserManagerDialog.showEditUserDialog(org.exist.security.Account).15", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.client.security.UserManagerDialog.showEditGroupDialog(org.exist.security.Group).16", "TOT": 2, "UPD": 1, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.client.security.UserManagerDialog.showEditUserDialog(org.exist.security.Account).15.windowClosed(java.awt.event.WindowEvent)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.exist.client.security.UserManagerDialog.showEditGroupDialog(org.exist.security.Group).16.windowClosed(java.awt.event.WindowEvent)", "TOT": 3, "UPD": 1, "INS": 0, "MOV": 2, "DEL": 0}, {"spoonMethodName": "org.exist.client.security.UserManagerDialog", "TOT": 1, "UPD": 0, "INS": 0, "MOV": 0, "DEL": 1}, {"spoonMethodName": "org.exist.client.security.UserManagerDialog.showEditUserDialog(org.exist.security.Account).13.complete(java.lang.String)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["a4f8b0a7c5d9fa2526cd57d0590947bab37bd8df"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 53, "deletions": 39, "lines": 92, "gitFilesChange": 3}, "spoonStatsSummary": {"TOT": 37, "UPD": 10, "INS": 10, "MOV": 11, "DEL": 6, "spoonFilesChanged": 3, "spoonMethodsChanged": 12}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/client/security", "src/org/exist/client"], "changesInPackagesSPOON": ["org.exist.client.security.UserManagerDialog.showEditUserDialog(org.exist.security.Account)", "org.exist.client.security.EditUserDialog", "org.exist.client.security.UserManagerDialog.showEditGroupDialog(org.exist.security.Group).16", "org.exist.client.security.UserManagerDialog.showEditUserDialog(org.exist.security.Account).15.windowClosed(java.awt.event.WindowEvent)", "org.exist.client.security.UserManagerDialog.showEditUserDialog(org.exist.security.Account).15", "org.exist.client.security.UserManagerDialog.showEditGroupDialog(org.exist.security.Group)", "org.exist.client.security.UserManagerDialog.showEditGroupDialog(org.exist.security.Group).16.windowClosed(java.awt.event.WindowEvent)", "org.exist.client.InteractiveClient.connect()", "org.exist.client.security.EditUserDialog.setAccountFromFormProperties()", "org.exist.client.security.UserManagerDialog", "org.exist.client.security.UserManagerDialog.showEditUserDialog(org.exist.security.Account).13.complete(java.lang.String)", "org.exist.client.security.EditUserDialog.updateUser()"]}, {"title": "Signature of fn:filter doesn't look like it conforms to the spec", "body": "The fn:filter() function is not according to spec;\n\nspec-> http://www.w3.org/TR/xpath-functions-30/#func-filter\n\n```\nfn:filter($seq as item()*, $f as function(item()) as xs:boolean) as item()*\n```\n\nexist --> http://exist-db.org/exist/apps/fundocs/view.html?uri=http://www.w3.org/2005/xpath-functions&location=java:org.exist.xquery.functions.fn.FnModule \n\n```\nfilter($function as function, $sequence as item()*) as item()*\n```\n", "url": "https://github.com/eXist-db/exist/issues/120", "user": "iheOnwuka", "labels": ["bug"], "created": "2014-01-13 17:36:43", "closed": "2014-08-23 09:21:10", "commits": {}, "ttf": 221.00027777777777, "commitsDetails": []}, {"title": "eXist seems to treat 'xquery' as reserved namespace prefix in xquery modules", "body": "When an imported xquery module declares 'xquery' as its namespace prefix, eXist-2.1 throws an error.  A test case can be found at https://gist.github.com/rvdb/7152363. If ns_main.xq is executed with eXist (eXide / Java client / controller), following error is thrown:\n\n```\nCannot compile xquery: exerr:ERROR error found while loading module test: \nError while loading module ns_module.xq: error found while loading module \nfrom ns_module.xq: org.exist.xquery.XPathException: err:XPST0003 expecting\nname, found 'xquery' [at line 2, column 18]\n```\n\nThis seems incorrect: 'xquery' is not listed as reserved namespace prefix in the spec (http://www.w3.org/TR/xquery/#id-basics), which is confirmed by the fact that Saxon does execute ns_main.xq without problems.\n\nAdditionally, this problem seems limited to module namespace declarations. Another test case at https://gist.github.com/rvdb/7152340 is executed without errors, which demonstrates that 'xquery' _can_ be used in a main module without complaints.\n", "url": "https://github.com/eXist-db/exist/issues/71", "user": "rvdb", "labels": ["bug"], "created": "2013-10-25 10:16:10", "closed": "2013-10-28 07:28:31", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "util:string-to-binary() leaks files", "body": "During intensive usage of util:string-to-binary() we found out that many files were written to jetty/tmp but these were never cleaned up.\n\nAs a result a system (linux, oracle java7) ran out of file handles over time.\n\nexample:\n\njava      28644 29132 username  219u      REG              202,1      1700     411310 /opt/exist-trunk/tools/jetty/tmp/_mmtfm_16f53166-157f-4f5d-82a1-5c8c2c42e6bf/mmtf_1382636042437789285362156175046.tmp (deleted)\njava      28644 29132 username  222u      REG              202,1      1700     411056 /opt/exist-trunk/tools/jetty/tmp/_mmtfm_16f53166-157f-4f5d-82a1-5c8c2c42e6bf/mmtf_1382636042437789285362156175046.tmp (deleted)\njava      28644 29132 username  227u      REG              202,1      1700     411056 /opt/exist-trunk/tools/jetty/tmp/_mmtfm_16f53166-157f-4f5d-82a1-5c8c2c42e6bf/mmtf_1382636042437789285362156175046.tmp (deleted)\njava      28644 29132 username  229u      REG              202,1      1700     411148 /opt/exist-trunk/tools/jetty/tmp/_mmtfm_16f53166-157f-4f5d-82a1-5c8c2c42e6bf/mmtf_1382636042437789285362156175046.tmp (deleted)\njava      28644 29132 username  233u      REG              202,1      2690     411152 /opt/exist-trunk/tools/jetty/tmp/_mmtfm_16f53166-157f-4f5d-82a1-5c8c2c42e6bf/mmtf_1382636042437789285362156175046.tmp (deleted)\njava      28644 29132 username  234u      REG              202,1      1700     411148 /opt/exist-trunk/tools/jetty/tmp/_mmtfm_16f53166-157f-4f5d-82a1-5c8c2c42e6bf/mmtf_1382636042437789285362156175046.tmp (deleted)\nusername@myserver:/opt/exist-trunk/tools/jetty/tmp$ lsof| grep mmtf | wc -l\n2912\n", "url": "https://github.com/eXist-db/exist/issues/69", "user": "dizzzz", "labels": ["bug"], "created": "2013-10-24 20:30:24", "closed": "2018-10-02 20:33:58", "commits": {}, "ttf": 1804.0002777777777, "commitsDetails": []}, {"title": "NPE in new lucene", "body": "While performing a 'search' in the documentation app an NPE appeared:\n\nHTTP ERROR 500\n\nProblem accessing /exist/apps/doc/search.html. Reason:\n\n```\nAn unknown error occurred: null\n```\n\nCaused by:\n\njavax.servlet.ServletException: An unknown error occurred: null\n    at org.exist.http.servlets.EXistServlet.doPost(EXistServlet.java:473)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:755)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n\n(.......)\n\nCaused by: java.lang.NullPointerException\n    at org.exist.indexing.lucene.LuceneIndexWorker$LuceneHitCollector.collect(LuceneIndexWorker.java:874)\n    at org.apache.lucene.search.Scorer.score(Scorer.java:65)\n    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:624)\n    at org.apache.lucene.search.IndexSearcher.search(IndexSearcher.java:309)\n    at org.exist.indexing.lucene.LuceneIndexWorker.searchAndProcess(LuceneIndexWorker.java:499)\n    at org.exist.indexing.lucene.LuceneIndexWorker.query(LuceneIndexWorker.java:393)\n    at org.exist.xquery.modules.lucene.Query.preSelect(Query.java:198)\n\n(....)\n", "url": "https://github.com/eXist-db/exist/issues/57", "user": "dizzzz", "labels": ["bug"], "created": "2013-10-01 09:37:05", "closed": "2014-03-26 11:39:41", "commits": {}, "ttf": 176.00027777777777, "commitsDetails": []}, {"title": "Spatial module doesn't build", "body": "Environment: ubuntu 13.04 64-bit, OpenJDK 7, latest exist from git\n\nSteps to reproduce:\n1) Activate spatial module in $build-dir/extensions/indexes/local.build.properties\n2) ./build.sh download-additional-jars\n3) ./build.sh all\n\nThe end of the compile looks like this\n\n```\ncompile-src:\n     [echo] Compiling sources 'index-spatial'\n    [mkdir] Created dir: /home/gtn/exist/extensions/indexes/spatial/build/classes\n    [javac] Compiling 10 source files to /home/gtn/exist/extensions/indexes/spatial/build/classes\n    [javac] warning: [options] bootstrap class path not set in conjunction with -source 1.6\n    [javac] /home/gtn/exist/extensions/indexes/spatial/src/org/exist/indexing/spatial/GMLHSQLIndexWorker.java:61: error: GMLHSQLIndexWorker is not abstract and does not override abstract method getQueryRewriter(XQueryContext) in IndexWorker\n    [javac] public class GMLHSQLIndexWorker extends AbstractGMLJDBCIndexWorker {\n    [javac]        ^\n    [javac] Note: Some input files use or override a deprecated API.\n    [javac] Note: Recompile with -Xlint:deprecation for details.\n    [javac] 1 error\n    [javac] 1 warning\n\nBUILD FAILED\n/home/gtn/exist/build/scripts/build-impl.xml:415: The following error occurred while executing this line:\n/home/gtn/exist/build/scripts/extensions-build.xml:31: The following error occurred while executing this line:\n/home/gtn/exist/build/scripts/extensions-common.xml:137: The following error occurred while executing this line:\n/home/gtn/exist/build/scripts/extensions-common.xml:199: The following error occurred while executing this line:\n/home/gtn/exist/build/scripts/extensions-common.xml:152: The following error occurred while executing this line:\n/home/gtn/exist/build/scripts/extensions-common.xml:163: Compile failed; see the compiler error output for details.\n```\n\nAlso, note that the fetch url in $build-dir/extensions/indexes/spatial/extension.xml pointing to geoapi-nogenerics-2.1.1.jar (line 19) gets a 404. The file is available at the osgeo.org location used elsewhere in the file.\n", "url": "https://github.com/eXist-db/exist/issues/49", "user": "gtnewton", "labels": ["bug"], "created": "2013-09-19 17:52:53", "closed": "2017-02-06 12:20:18", "commits": {}, "ttf": 1235.0002777777777, "commitsDetails": []}, {"title": "Missing dirs for dist-war target (sourceforge bug #826)", "body": "Running ./build.sh dist-war I get two errors:\n1) BUILD FAILED $home/exist/build/scripts/dist.xml:35: $MYBUILDDIR/extensions/indexes/spatial/lib does not exist.\n2) BUILD FAILED $home/exist/build/scripts/dist.xml:35: $MYBUILDDIR/extensions/betterform/main/xrx does not exist.\nThe problem is that the $home/exist/extensions/indexes/spatial/lib/ and $home/exist/extensions/betterform/main/xrx/ directories do not exist. Manually creating them before running dist-war stops the errors from recurring.\nPlatform: Ubuntu 13.04, OpenJDK 1.7.0_25\nGIT info: develop branch\n", "url": "https://github.com/eXist-db/exist/issues/47", "user": "gtnewton", "labels": ["bug"], "created": "2013-09-18 22:45:24", "closed": "2013-09-25 10:02:03", "commits": {}, "ttf": 6.000277777777778, "commitsDetails": []}, {"title": "Empty tag \"source\" should be self-closing in HTML5 ", "body": "When serializing output as HTML5, the `<source>` tag is output with a separate closing tag, instead of being a self-closing tag -- it's an empty tag according to the specification:\n\nhttp://www.w3.org/TR/html51/embedded-content-0.html#the-source-element\n\nI think this is because the HTML5 serializer is a subclass of the XHTML serializer, and this uses a list of element names (emptyTags) to determine which tags should be output as self-closing tags, and \"source\" isn't on the list:\n\nhttps://github.com/eXist-db/exist/blob/develop/src/org/exist/util/serializer/XHTMLWriter.java\n\nOutputting `<source>` with a separate closing tag results in validation errors from the HTML5 validator.\n", "url": "https://github.com/eXist-db/exist/issues/46", "user": "martindholmes", "labels": ["bug"], "created": "2013-09-18 22:42:56", "closed": "2017-02-06 13:17:30", "commits": {}, "ttf": 1236.0002777777777, "commitsDetails": []}, {"title": "Coding of path components in URIs", "body": "This is a port of SF ticket http://sourceforge.net/p/exist/bugs/766/ - for short:\n\nIn a few places the eXist codebase uses \"java.net.URLDecoder\" (which is intended to be used on http _query strings_) instead of \"java.net.URI\", resulting in wrong coding of _path components_ in URIs and thereby creation of ressources, that cannot be fetched by the name, they were uploaded with.\n\nSimplest way to show the (mis)behaviour:\n- From the dashboard start collections browser,\n- create collection \"/db/testing\",\n- upload a ressource, eg. \"A+A.svg\"\n- note that it gets represented as \"A%2BA.svg\" in the list widget,\n- which is the same as displayed in \"/exist/rest/db/testing/\",\n- and also in \"/exist/webdav/db/testing/\", while\n- in eXide open dialog it will show up as \"A+A.svg\".\n\nBUT\n- fetching /exist/rest/db/testing/A%2BA.svg will result in a 404,\n- same as /exist/rest/db/testing/A+A.svg,\n- while fetching /exist/rest/db/testing/A%252BA.svg will work,\n- same as /exist/webdav/db/testing/A%252BA.svg,\n- all the while the file is inaccessible from eXide's \"open\", but\n- double clicking in coll.browser will fire up eXide to \"A%2BA.svg\".\n\nThat is: there is **double encoding** happening. The plus sign is encoded to %2B on store, and the newly introduced percent sign has to be coded to %25 on retrieve. This applies to all the characters, that java.net.URLDecoder codes different from java.net.URI in path components (most prominently the plus sign, but also others).\n", "url": "https://github.com/eXist-db/exist/issues/44", "user": "hungerburg", "labels": ["bug"], "created": "2013-09-15 10:43:40", "closed": "2017-02-05 09:47:52", "commits": {}, "ttf": 1238.0002777777777, "commitsDetails": []}, {"title": "compression:gzip() malfunction", "body": "see http://exist.2174344.n4.nabble.com/compression-gzip-tp4661212.html\n", "url": "https://github.com/eXist-db/exist/issues/39", "user": "peterstadler", "labels": ["bug"], "created": "2013-09-11 15:08:01", "closed": "2015-10-27 12:26:31", "commits": {}, "ttf": 775.0002777777778, "commitsDetails": []}, {"title": "[BUG] \"Unknown type: xs:numeric\" error", "body": "**Describe the bug**\r\n\r\nIn eXist 5.3.0-SNAPSHOT (develop HEAD), certain expressions related to the `xs:numeric` type produce the error:\r\n\r\n> exerr:ERROR Unknown type: xs:numeric\r\n\r\n**Expected behavior**\r\n\r\nThis type should be known to eXist.\r\n\r\n**To Reproduce**\r\n\r\nThe following code produces the error:\r\n\r\n```xquery\r\n1 cast as xs:numeric\r\n```\r\n\r\nHere is a corresponding XQSuite test:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace it = \"http://exist-db.org/xquery/test/integer-tests\";\r\n\r\ndeclare namespace test = \"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare\r\n    %test:args(\"1\")\r\n    %test:assertEquals(1)\r\nfunction it:string-cast-as-numeric($string as xs:integer) as xs:numeric {\r\n    $string cast as xs:numeric\r\n};\r\n```\r\n\r\nRunning this test in eXist 5.2.0 succeeds; the expression `1 cast as xs:numeric` also returns the expected `xs:numeric(1)` in BaseX and Saxon. But in eXist 5.3.0-SNAPSHOT, this test returns:\r\n\r\n```xml\r\n<testsuites>\r\n    <testsuite package=\"http://exist-db.org/xquery/test/integer-tests\"\r\n        timestamp=\"2020-03-25T23:42:28.916-04:00\" tests=\"1\" failures=\"0\"\r\n        errors=\"1\" pending=\"0\" time=\"PT0.229S\">\r\n        <testcase name=\"string-cast-as-numeric\"\r\n            class=\"it:string-cast-as-numeric\">\r\n            <error type=\"java:org.exist.xquery.XPathException\"\r\n                message=\"exerr:ERROR Unknown type: xs:numeric [at line 10, column 35]...\"/>\r\n        </testcase>\r\n    </testsuite>\r\n</testsuites>\r\n```\r\n\r\nAs discussed with @adamretter in Slack, there may be some relation between this issue and https://github.com/eXist-db/exist/pull/3266.\r\n\r\nThe problem was first observed when running the tests included as part of the documentation app's build script, tests which effectively weren't running between Feb 4 and Mar 23. To reproduce the error, clone and build the documentation app using these steps:\r\n\r\n```bash\r\ngit clone https://github.com/eXist-db/documentation.git\r\ncd documentation\r\nmvn clean package\r\n```\r\n\r\nDuring the maven operation, the error is raised. Here's the portion of the console output from that build process where the error appears:\r\n\r\n```text\r\n[INFO]   running XQsuite test \u2026\r\n[INFO]         3 xqsuite tests:\r\n[INFO]           [ 'section-headings',\r\n[INFO]             'exerr:ERROR Unknown type: xs:numeric [at line 53, column 27, source: /db/apps/doc/modules/config.xqm]\\nIn function:\\n\\ttests:missing-id() [18:1:/db/apps/doc/modules/test-suite.xql]\\n\\ttest:apply(function(*), item()*) [560:9:jar:file:/exist/lib/exist.uber.jar!/org/exist/xquery/lib/xqsuite/xqsuite.xql]\\n\\ttest:apply(function(*), element(), item()*) [467:9:jar:file:/exist/lib/exist.uber.jar!/org/exist/xquery/lib/xqsuite/xqsuite.xql]\\n\\ttest:call-test(function(*), element(), element()*) [279:32:jar:file:/exist/lib/exist.uber.jar!/org/exist/xquery/lib/xqsuite/xqsuite.xql]. Unknown type: xs:numeric' ]\r\n[INFO] npm ERR! Test failed.  See above for more details.\r\n```\r\n\r\nStrangely, in the relevant code\u2014`doc/modules/config.xqm`, `doc/modules/test-suite.xql`, and eXist's `xqsuite.xql` module\u2014there is no direct invocation of the `xs:numeric` type.\r\n\r\n\r\n**Context (please always complete the following information):**\r\n - OS: macOS 10.13.6\r\n - eXist-db version: 5.3.0-SNAPSHOT (develop 5d59f738b1e180c035a5605c02e2bdcb1cf6dfe5)\r\n - Java Version: OpenJDK Runtime Environment (Zulu 8.44.0.11-CA-macosx) (build 1.8.0_242-b20)\r\n\r\n**Additional context**\r\n- How is eXist-db installed?\r\n    ```bash\r\n    docker pull existdb/existdb:latest\r\n    docker run -dit -p 8080:8080 --name docs --rm existdb/existdb:latest\r\n    ```\r\n- Any custom changes in e.g. `conf.xml`? No\r\n", "url": "https://github.com/eXist-db/exist/issues/3323", "user": "joewiz", "labels": ["bug", "regression"], "created": "2020-03-26 03:54:47", "closed": "2020-03-27 07:24:57", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "command-line client fails in 5.0-RC8 when TERM is \"linux\"", "body": "For a terminal or emulator that reports its type as \"linux\", `bin/client.sh --no-gui` with 5.0-RC8 on RHEL Linux crashes as below.  If the terminal type is \"vt100\" it all works fine.  It sounds very similar to this:\r\n\r\n<https://github.com/jline/jline3/issues/408>\r\n\r\nSo maybe just upgrading to current jline would take care of it.\r\n\r\n\r\n```\r\n# echo $TERM\r\nlinux\r\n# bin/client.sh --no-gui\r\neXist version 5.0.0-RC8 (b7a9e898163b8362e092ebfa5536c29032d2a93f), Copyright (C) 2001-2019 The eXist-db Project\r\neXist-db comes with ABSOLUTELY NO WARRANTY.\r\nThis is free software, and you are welcome to redistribute it\r\nunder certain conditions; for details read the license file.\r\n\r\njava.lang.reflect.InvocationTargetException\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.exist.start.Main.invokeMain(Main.java:118)\r\n\tat org.exist.start.Main.runEx(Main.java:248)\r\n\tat org.exist.start.Main.run(Main.java:123)\r\n\tat org.exist.start.Main.main(Main.java:60)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.codehaus.mojo.appassembler.booter.AppassemblerBooter.executeMain(AppassemblerBooter.java:257)\r\n\tat org.codehaus.mojo.appassembler.booter.AppassemblerBooter.main(AppassemblerBooter.java:77)\r\nCaused by: java.io.IOError: java.lang.UnsupportedOperationException\r\n\tat org.jline.utils.Curses.tputs(Curses.java:62)\r\n\tat org.jline.utils.Curses.tputs(Curses.java:45)\r\n\tat org.jline.keymap.KeyMap.key(KeyMap.java:243)\r\n\tat org.jline.reader.impl.LineReaderImpl.key(LineReaderImpl.java:5784)\r\n\tat java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)\r\n\tat java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)\r\n\tat java.util.Spliterators$ArraySpliterator.forEachRemaining(Spliterators.java:948)\r\n\tat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)\r\n\tat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)\r\n\tat java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)\r\n\tat java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)\r\n\tat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\r\n\tat java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)\r\n\tat org.jline.reader.impl.LineReaderImpl.bindKeys(LineReaderImpl.java:5792)\r\n\tat org.jline.reader.impl.LineReaderImpl.emacs(LineReaderImpl.java:5503)\r\n\tat org.jline.reader.impl.LineReaderImpl.defaultKeyMaps(LineReaderImpl.java:5479)\r\n\tat org.jline.reader.impl.LineReaderImpl.<init>(LineReaderImpl.java:277)\r\n\tat org.jline.reader.LineReaderBuilder.build(LineReaderBuilder.java:115)\r\n\tat org.exist.client.InteractiveClient.run(InteractiveClient.java:2223)\r\n\tat org.exist.client.InteractiveClient.main(InteractiveClient.java:243)\r\n\t... 14 more\r\nCaused by: java.lang.UnsupportedOperationException\r\n\tat org.jline.utils.Curses.doTputs(Curses.java:78)\r\n\tat org.jline.utils.Curses.tputs(Curses.java:60)\r\n\t... 33 more\r\n```", "url": "https://github.com/eXist-db/exist/issues/2951", "user": "craigberry", "labels": ["needs resolution", "regression"], "created": "2019-08-13 02:05:26", "closed": "2019-08-25 19:10:20", "commits": {}, "ttf": 12.000277777777777, "commitsDetails": []}, {"title": "Restore: wrong location data directory", "body": "### What is the problem\r\nWhen running restore of a backup file, in localmode, an \"unexpected\" location is used for the data directory.\r\n\r\n### What did you expect\r\nUse the data directory `EXIST_HOME/data` in stead of `EXIST_HOME/../data`\r\n\r\n### Describe how to reproduce or add a test\r\nRun\r\n\r\n```\r\nbin\\backup.bat -r full20190409-0300.zip -ouri=xmldb:exist:/// -R -q -P \"password\"\r\n```\r\n\r\nthe data directory is actually written in the directory `exist-distribution\\target\\data` in stead of `exist-distribution\\target\\exist-distribution-5.0.0-RC8-SNAPSHOT-dir`\r\n\r\nthe current directory is `exist-distribution\\target\\exist-distribution-5.0.0-RC8-SNAPSHOT-dir`\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version : v5 RCx\r\n- Java version (e.g. Java8u201)\r\n- Operating system (Windows 10)\r\n- 64 bit\r\n- How is eXist-db installed? (clone from GitHub, exist-distribution-5.0.0-RC8-SNAPSHOT-dir)\r\n- Any custom changes in e.g. conf.xml - none\r\n", "url": "https://github.com/eXist-db/exist/issues/2874", "user": "dizzzz", "labels": ["bug", "high prio", "needs develop port", "needs resolution", "regression"], "created": "2019-07-12 14:50:39", "closed": "2019-08-06 08:30:26", "commits": {}, "ttf": 24.00027777777778, "commitsDetails": []}, {"title": "descriptor.xml not properly registered", "body": "### What is the problem\r\nUpon start of exist we get the following warnings:\r\n```\r\n13 Jun 2019 10:39:51,084 [qtp606365803-40] WARN  (Descriptor.java [<init>]:100) - Giving up unable to read descriptor file from /exist/descriptor.xml \r\n13 Jun 2019 10:39:51,084 [qtp606365803-40] WARN  (Descriptor.java [<init>]:113) - Giving up unable to read descriptor.xml file from classloader in package org.exist.http, eXist-db Core, version 5.0 \r\n```\r\n\r\nYet the file `descriptor.xml` is present at `exist/etc`, so chances are exist is looking in the wrong location\r\n\r\n### What did you expect\r\nExist to know where to look for this file, and find it.              \r\n\r\n### Describe how to reproduce or add a test\r\nStart exist and check `exist.log`\r\n\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version 5.0.0-RC8-SNAPSHOT\r\n- Java version (8)\r\n- OS Docker\r\n- 64 bit", "url": "https://github.com/eXist-db/exist/issues/2808", "user": "duncdrum", "labels": ["bug", "regression"], "created": "2019-06-13 11:07:45", "closed": "2020-03-04 17:47:23", "commits": {}, "ttf": 265.0002777777778, "commitsDetails": []}, {"title": "Missing JARs in JNLP/webstart", "body": "As reported by @raducoravu  in https://github.com/eXist-db/exist/issues/2311#issuecomment-455116030:\r\n\r\nThe JNLP file is pointing to non existing JAR files:\r\n\r\n```\r\nexist/webstart/pkg-java-fork.jar  --> missing version nr\r\nexist/webstart/j8fu-1.16.jar --> probably double digit is a problem\r\nexist/webstart/gnu-crypto-2.0.1.jar --> replaced\r\nexist/webstart/xmldb.jar -> renamed and has version nr\r\n```", "url": "https://github.com/eXist-db/exist/issues/2397", "user": "dizzzz", "labels": ["bug", "high prio", "regression"], "created": "2019-01-17 13:32:35", "closed": "2019-01-22 19:34:01", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "util:get-fragment-between is not producing correct fragment(s)", "body": "### What is the problem\r\n\r\nThe fragmenting process used by `util:get-fragment-between` isn't stopping at second node. \r\n\r\nRunning `util:get-fragment-between` to get the fragment between the first and second `<pb>` in the full sample below returns:\r\n\r\n```xml\r\n            <pb facs=\"1.jpg\"></pb>     \r\n            <p>Aus dem Leben einer Kartoffel.</p>\r\n            <pb facs=\"2.jpg\"></pb>\r\n       </front>\r\n       <body>\r\n            <pb facs=\"3.jpg\"></pb>\r\n            <p>Hubertus Knoll spazierte \u00fcber das <pb facs=\"4.jpg\"></pb> Feld.</p>\r\n            <pb facs=\"5.jpg\"></pb>\r\n        </body>\r\n    </text>\r\n</TEI>\r\n```\r\n\r\nMaybe the problem was caused here?\r\nhttps://github.com/eXist-db/exist/blob/eXist-4.4.0/src/org/exist/xquery/functions/util/GetFragmentBetween.java#L182\r\n\r\n### What did you expect\r\n\r\nI expected output (like in version 4.3.1):\r\n\r\n```xml\r\n<pb facs=\"1.jpg\"></pb>\r\n<p>Aus dem Leben einer Kartoffel.</p>\r\n```\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nStore the following as `kartoffelmann.xml`:\r\n\r\n```xml\r\n<TEI xmlns=\"http://www.tei-c.org/ns/1.0\">\r\n    <text>\r\n        <front>\r\n            <pb facs=\"1.jpg\"/>\r\n            <p>Aus dem Leben einer Kartoffel.</p>\r\n            <pb facs=\"2.jpg\"/>\r\n        </front>\r\n        <body>\r\n            <pb facs=\"3.jpg\"/>\r\n            <p>Hubertus Knoll spazierte \u00fcber das <pb facs=\"4.jpg\"/> Feld.</p>\r\n            <pb facs=\"5.jpg\"/>\r\n        </body>\r\n    </text>\r\n</TEI>\r\n```\r\n\r\nRun the following query:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\ndeclare namespace tei = \"http://www.tei-c.org/ns/1.0\";\r\n\r\nlet $doc := doc(\"kartoffelmann.xml\")\r\nlet $pbs := $doc//tei:pb\r\nlet $pb1 := $pbs[1]\r\nlet $pb2 := $pbs[2]\r\nreturn\r\n    util:get-fragment-between($pb1, $pb2, false(), true())\r\n```\r\n\r\nResults are as above.\r\n\r\n### Context information\r\n\r\n- eXist-db version:  eXist-db >= 4.4.0\r\n- Java version:  jdk1.8.0_191\r\n- Operating system: Windows 10\r\n- 64 bit\r\n- How is eXist-db installed? JAR installer\r\n- Any custom changes in e.g. conf.xml: no\r\n", "url": "https://github.com/eXist-db/exist/issues/2316", "user": "babslgam", "labels": ["bug", "regression"], "created": "2018-11-29 14:27:00", "closed": "2020-03-27 19:59:10", "commits": {}, "ttf": 484.0002777777778, "commitsDetails": []}, {"title": "Documentation not accessible via public-repo by \"doc\" abbrev during build", "body": "*@joewiz commented on Oct 5, 2018, 9:39 AM UTC:*\n\n### Where is the problem\n\nIn the generated package's expath-pkg.xml file.\n\n### What is the problem\n\nThe same issue I fixed in [eXist-db/shared-resources#37](https://github.com/eXist-db/shared-resources/pull/37) affects the documentation app. Its `@abbrev` (in `expath-pkg.xml` under `package/@abbrev`) used to be \"doc\", but it is now \"exist-documentation\".\n\nAs a result, the build step during which xars are fetched for the autodeploy directory ([https://github.com/eXist-db/exist/blob/develop/build.properties#L33](https://github.com/eXist-db/exist/blob/develop/build.properties#L33)), or calling `./build.sh download-xars` ([https://github.com/eXist-db/exist/blob/develop/installer/apps.properties#L2](https://github.com/eXist-db/exist/blob/develop/installer/apps.properties#L2)), will fail to download the documentation app. Here's the relevant portion of the log from `./build.sh download-xars`:\n\n```\ndownload-xar:\n    [fetch] Getting: http://demo.exist-db.org/exist/apps/public-repo/pkg.zip?abbrev=doc&zip=yes&processor=4.5.0-SNAPSHOT\n    [fetch] To: /var/folders/ky/gdx8y19x3gj7xxjm1zr3wr_r0000gn/T/FetchTask8738793445563451693tmp\n    [fetch] Error opening connection java.io.FileNotFoundException: http://demo.exist-db.org/exist/apps/public-repo/pkg.zip?abbrev=doc&zip=yes&processor=4.5.0-SNAPSHOT\n    [fetch] Can't get http://demo.exist-db.org/exist/apps/public-repo/pkg.zip?abbrev=doc&zip=yes&processor=4.5.0-SNAPSHOT to /var/folders/ky/gdx8y19x3gj7xxjm1zr3wr_r0000gn/T/FetchTask8738793445563451693tmp\n\n```\n\nThe public repo responds to this request by build script with a 404 error and `<p>Package file not found!</p>`.\n\nUnfortunately I'm not sure how we should address this in the mavenized build process now used for the documentation app... But you might see how I distinguished between the package \"app\" name and \"abbrev\" name in `build.properties`, `build.xml`, and `expath-pkg.xml.tmpl` in my PR that fixed this (again) in the shared-resources app: [https://github.com/eXist-db/shared-resources/pull/37/files](https://github.com/eXist-db/shared-resources/pull/37/files).\n\n### Please provide the following\n\n*   exist-db version: `4.x.x-develop`\n*   documentation version: `4.0.3`\n\n*This issue was moved by [duncdrum](https://github.com/duncdrum) from [eXist-db/documentation#269](https://github.com/eXist-db/documentation/issues/269).*", "url": "https://github.com/eXist-db/exist/issues/2194", "user": "move[bot]", "labels": ["regression"], "created": "2018-10-05 09:48:08", "closed": "2019-01-21 10:16:04", "commits": {}, "ttf": 108.00027777777778, "commitsDetails": []}, {"title": "Module import via remote URL is broken", "body": "### What is the problem\r\n\r\neXist used to support loading modules over the web, but doing so with 4.3.1 raises an error:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nimport module namespace functx = \"http://www.functx.com\" \r\n    at \"http://www.xqueryfunctions.com/xq/functx-1.0-doc-2007-01.xq\";\r\n\r\n\"hello\"\r\n```\r\n\r\nThe error raised is:\r\n\r\n> Invalid URI: xmldb URI scheme does not start with xmldb:: http://www.xqueryfunctions.com/xq/functx-1.0-doc-2007-01.xq\r\n\r\nUnder 4.0.0 (release), this query does not raise an error, but instead returns the expected result, `\"hello\"`.\r\n\r\n### What did you expect\r\n\r\nLoading modules via URI is discussed at https://exist-db.org/exist/apps/doc/xquery#module-system.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nSee test query above. The stack trace is:\r\n\r\n```text\r\n2018-09-15 15:16:56,737 [qtp2000015086-35] ERROR (XQueryServlet.java [process]:552) - Invalid URI: xmldb URI scheme does not start with xmldb:: http://www.xqueryfunctions.com/xq/functx-1.0-doc-2007-01.xq \r\njava.lang.IllegalArgumentException: Invalid URI: xmldb URI scheme does not start with xmldb:: http://www.xqueryfunctions.com/xq/functx-1.0-doc-2007-01.xq\r\n\tat org.exist.xmldb.XmldbURI.create(XmldbURI.java:219) ~[exist.jar:4.3.1]\r\n\tat org.exist.xmldb.XmldbURI.append(XmldbURI.java:595) ~[exist.jar:4.3.1]\r\n\tat org.exist.source.SourceFactory.getSource(SourceFactory.java:98) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.XQueryContext.importModule(XQueryContext.java:2846) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.importDecl(XQueryTreeParser.java:6312) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.prolog(XQueryTreeParser.java:5340) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.mainModule(XQueryTreeParser.java:4042) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.module(XQueryTreeParser.java:3987) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.parser.XQueryTreeParser.xpath(XQueryTreeParser.java:3642) ~[exist.jar:4.3.1]\r\n\tat org.exist.xquery.XQuery.compile(XQuery.java:128) ~[exist.jar:4.3.1]\r\n        ...\r\n```\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 4.3.1 release\r\n- Java version: 10.0.2+13\r\n- Operating system: macOS 10.13.6\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed? DMG installer\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/2157", "user": "joewiz", "labels": ["bug", "regression"], "created": "2018-09-15 19:19:23", "closed": "2018-09-21 05:29:28", "commits": {}, "ttf": 5.000277777777778, "commitsDetails": []}, {"title": "JMX servlet does not contain eXist-db specific information", "body": "### What is the problem\r\nThe url http://localhost:8080/exist/status does not return all required information for the Monex app. As a result the Monex app does not work as expected.\r\n\r\nin logging:\r\n\r\n```\r\n2018-08-16 10:25:52,196 [main] WARN  (AgentFactory.java [getInstance]:46) - Failed to instantiate class for JMX agent: org.exist.management.impl.JMXAgent \r\n```\r\n\r\nwith debugger\r\n\r\n```\r\njava.lang.IllegalAccessException: Class org.exist.management.AgentFactory can not access a member of class org.exist.management.impl.JMXAgent with modifiers \"private\"\r\n```\r\n\r\n![image](https://user-images.githubusercontent.com/1700062/44214884-6e609580-a171-11e8-9b26-0614556c4fff.png)\r\n\r\n### What did you expect\r\nThe XML file should contain the sections as defined in `org/exist/management/impl/JMXAgent.java`\r\n\r\n### Describe how to reproduce or add a test\r\n- Start monex\r\n- retrieve XML via URL\r\n\r\n### Context information\r\n\r\n- eXist-db version : 4.x.x / 24ec68348bcd7854d65b75c396de3acdfbd2932a\r\n- Java version (e.g. Java8u121) // java8U172\r\n- Operating system (Windows 7, Linux, MacOs) / windows\r\n- 32 or 64 bit / 64\r\n- How is eXist-db installed? (JAR installer, DMG, WAR file, clone from GitHub) / clone\r\n- Any custom changes in e.g. conf.xml / nope\r\n", "url": "https://github.com/eXist-db/exist/issues/2118", "user": "dizzzz", "labels": ["bug", "needs 4.x.x backport", "needs 5.0.0 backport", "needs develop port", "regression"], "created": "2018-08-16 14:22:07", "closed": "2018-09-02 15:47:35", "commits": {}, "ttf": 17.00027777777778, "commitsDetails": []}, {"title": "Xerces 2.12: problems with betterform <xf:bind/>", "body": "### What is the problem\r\n\r\nthe update to xerces 2.12 leads to NullPointerExecption if betterform is used.\r\nthe problem seems to be a call via <xf:bind id=\"\" ref=\"\" type=\"xs:int\"/>.\r\nActually only the datatype xs:string is ok (xf:integer, xf:boolean tested with error result).\r\n\r\n```\r\nCaused by: java.lang.NullPointerException\r\n946     at org.apache.xerces.impl.dv.xs.XSSimpleTypeDecl.getActualValue(Unknown Source) ~[xercesImpl-2.12.0.jar:?]\r\n947     at org.apache.xerces.impl.dv.xs.XSSimpleTypeDecl.validate(Unknown Source) ~[xercesImpl-2.12.0.jar:?]\r\n948     at de.betterform.xml.xforms.model.constraints.Validator.checkDatatype(Validator.java:303) ~[betterform-exist-5.1-SNAPSHOT-20160615.jar:?]\r\n949     at de.betterform.xml.xforms.model.constraints.Validator.validate(Validator.java:257) ~[betterform-exist-5.1-SNAPSHOT-20160615.jar:?]\r\n950     at de.betterform.xml.xforms.model.constraints.Validator.validate(Validator.java:213) ~[betterform-exist-5.1-SNAPSHOT-20160615.jar:?]\r\n951     at de.betterform.xml.xforms.model.constraints.Validator.validate(Validator.java:190) ~[betterform-exist-5.1-SNAPSHOT-20160615.jar:?]\r\n```\r\n\r\n### What did you expect\r\n\r\nI know it is a betterform problem not a eXist, but it is relevant for some eXist users.\r\nbetterform xf:bind should be usable with type validation\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nas far I could reduce it.\r\nsome test app for betterform is needed (a little bit complex but the gurus knows ;-)\r\nand the following example app function:\r\n\r\n--\r\n see next comment\r\n---\r\n\r\nreverting to xerces 2.11 resolves the problem\r\n\r\n### Context information\r\n8 Jul 2018 11:20:08,957 [main] INFO  (JettyStart.java [run]:146) - Running with Java 1.8.0_171 [Oracle Corporation (Java HotSpot(TM) 64-Bit Server VM) in /usr/lib/jvm/java-8-oracle/jre]\r\n08 Jul 2018 11:20:08,957 [main] INFO  (JettyStart.java [run]:153) - Running as user 'peter'\r\n08 Jul 2018 11:20:08,957 [main] INFO  (JettyStart.java [run]:154) - [eXist Home : /media/peter/TrekStor/existdb-4.0]\r\n08 Jul 2018 11:20:08,958 [main] INFO  (JettyStart.java [run]:155) - [eXist Version : 4.3.0]\r\n08 Jul 2018 11:20:08,959 [main] INFO  (JettyStart.java [run]:156) - [eXist Build : 201807081118]\r\n08 Jul 2018 11:20:08,959 [main] INFO  (JettyStart.java [run]:157) - [Git commit : dd335e5]\r\n08 Jul 2018 11:20:08,959 [main] INFO  (JettyStart.java [run]:159) - [Operating System : Linux 4.4.0-130-generic amd64]\r\nno relevant changes to conf.xml\r\n", "url": "https://github.com/eXist-db/exist/issues/2007", "user": "pherk", "labels": ["bug", "regression", "security"], "created": "2018-07-08 17:14:24", "closed": "2018-08-02 12:59:55", "commits": {}, "ttf": 24.00027777777778, "commitsDetails": []}, {"title": "eXist-db installed as yajsw daemon service does not startup on Ubuntu 16.04 / Ubuntu 18.04", "body": "### What is the problem\r\n> set EXIST_HOME, JAVA_HOME install eXist-db as a non-privileged daemon service. Attempt to start-up exist-db using systemd. Startup failes.\r\n\r\n### What did you expect\r\n> eXist-db should have started.\r\n\r\n### Describe how to reproduce or add a test\r\n> Install eXist-db 4.2.1 or eXist-db 4.3.0 using the jar installer and attempt to register as a service with yajsw.\r\n\r\n### Fixing the Problem\r\n\r\n`yajsw/conf/wrapper.conf` is set with an incorrect path (possibly by the eXist-db installer). It points to a non-existent JVM on my system \r\n```\r\nwrapper.java.command=/Library/Java/JavaVirtualMachines/jdk1.8.0_151.jdk/Contents/Home/bin/java\r\n```\r\nOnce i change it to the actual `<JAVA_HOME_PATH>/bin/java` and reinstall the daemon, eXist-db startups fine with yajsw. ", "url": "https://github.com/eXist-db/exist/issues/2005", "user": "kohsah", "labels": ["investigate", "regression"], "created": "2018-07-07 07:29:37", "closed": "2018-08-01 06:35:48", "commits": {"ed7b83b787f557ab62907629026acb3d905947a7": {"commitGHEventType": "referenced", "commitUser": "wolfgangmm"}, "92868ea70400d0b245b8f0f1da45988a04aacc06": {"commitGHEventType": "closed", "commitUser": "dizzzz"}}, "ttf": 24.00027777777778, "commitsDetails": [{"commitHash": "ed7b83b787f557ab62907629026acb3d905947a7", "commitGHEventType": "referenced", "commitUser": "wolfgangmm", "commitParents": ["447ec64ab2831af9da2b11065e295c9f773b9628"], "nameRev": "ed7b83b787f557ab62907629026acb3d905947a7 tags/eXist-4.3.1~6", "commitMessage": "(4.x.x) Fix variables used by installer for wrapper.conf. Closes #2005\n", "commitDateTime": "2018-07-16 21:29:19", "authoredDateTime": "2018-07-16 21:29:19", "commitGitStats": [{"filePath": "tools/yajsw/build.xml", "insertions": 4, "deletions": 3, "lines": 7}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}, {"commitHash": "92868ea70400d0b245b8f0f1da45988a04aacc06", "commitGHEventType": "closed", "commitUser": "dizzzz", "commitParents": ["3eb07483bba471e72abd9afcc605c307697740aa"], "nameRev": "92868ea70400d0b245b8f0f1da45988a04aacc06 tags/eXist-5.1.0~339^2", "commitMessage": "[bugfix] Fix variables used by installer for wrapper.conf.\nCloses https://github.com/eXist-db/exist/issues/2043\nCloses https://github.com/eXist-db/exist/issues/2005\n", "commitDateTime": "2018-07-31 16:56:17", "authoredDateTime": "2018-07-16 21:29:19", "commitGitStats": [{"filePath": "tools/yajsw/build.xml", "insertions": 4, "deletions": 3, "lines": 7}], "commitSpoonAstDiffStats": [], "spoonStatsSkippedReason": ""}], "filteredCommits": ["ed7b83b787f557ab62907629026acb3d905947a7", "92868ea70400d0b245b8f0f1da45988a04aacc06"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 0, "gitStatsSummary": {"insertions": 0, "deletions": 0, "lines": 0, "gitFilesChange": 0}, "spoonStatsSummary": {}, "statsSkippedReason": "", "changesInPackagesGIT": []}, {"title": "NPE on inspect:module-functions unless location is prepended with xmldb:exist://", "body": "### What is the problem\r\n\r\n`inspect:module-functions` does not work unless the location is prepended with `xmldb:exist://`.\r\n\r\n### What did you expect\r\n\r\nI expected the `inspect:module-functions` to work even if the location is not prepended with `xmldb:exist://`.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nThe following two expressions should return identical results:\r\n\r\n**Case 1**: *with* `xmldb:exist://` prefix\r\n\r\n```xquery\r\ninspect:module-functions(xs:anyURI(\"xmldb:exist:///db/apps/shared-resources/content/apputil.xql\"))\r\n```\r\n\r\n**Case 2**: *without* `xmldb:exist://`prefix\r\n\r\n```xquery\r\ninspect:module-functions(xs:anyURI(\"/db/apps/shared-resources/content/apputil.xql\"))\r\n```\r\n\r\nCase 1 returns the list of functions in the app-util module. Case 2 triggers an NPE:\r\n\r\n```text\r\n2018-06-08 16:57:54,365 [qtp1635955718-74] ERROR (XQueryServlet.java [process]:545) - null \r\njava.lang.NullPointerException: null\r\n```\r\n\r\nWork was recently done on this code to address https://github.com/eXist-db/exist/issues/1827 (closed by https://github.com/eXist-db/exist/pull/1833). \r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash: eXist 4.2.0\r\n- Java version: 1.8.0_172-b11\r\n- Operating system: macOS 10.13.4\r\n- 32 or 64 bit: 64 bit\r\n- How is eXist-db installed: cloned from GitHub\r\n- Any custom changes in e.g. conf.xml: no\r\n", "url": "https://github.com/eXist-db/exist/issues/1927", "user": "joewiz", "labels": ["bug", "regression"], "created": "2018-06-08 21:14:09", "closed": "2018-06-13 12:44:45", "commits": {}, "ttf": 4.000277777777778, "commitsDetails": []}, {"title": "XQSuite outdated functions in code for suite.xql", "body": "*@MRodz commented on Jun 8, 2018, 6:38 AM UTC:*\r\n\r\nOn [http://exist-db.org/exist/apps/doc/xqsuite#D3.19](http://exist-db.org/exist/apps/doc/xqsuite#D3.19) the provided example seems to be outdated in the code for `suite.xql`.\r\n\r\nThe query:\r\n\r\n```xquery\r\nimport module namespace test=\"http://exist-db.org/xquery/xqsuite\" at \"resource:org/exist/xquery/lib/xqsuite/xqsuite.xql\";\r\n\r\ntest:suite( inspect:module-functions(xs:anyURI(\"math.xql\")) )\r\n````\r\n\r\nhas 0 results when tested in exist-db 4.2.0 and 4.1.0, while [Joe's approach](https://gist.github.com/joewiz/fa32be80749a69fcb8da) with `util:list-functions` instead of `inspect:module-functions` yields the expected testsuite outcome.\r\n\r\n*   exist-db version: `4.2.0`\r\n*   documentation version: current website\r\n\r\n*This issue was moved by [duncdrum](https://github.com/duncdrum) from eXist-db/documentation/issues/257.*", "url": "https://github.com/eXist-db/exist/issues/1925", "user": "move[bot]", "labels": ["bug", "regression"], "created": "2018-06-08 12:59:33", "closed": "2018-06-08 21:14:44", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Client unable to upload large XML files (4.1.0)", "body": "When I try to upload a large XML file (>512k) using the client, I see the following error in the Java console:\r\n```\r\nException in thread \"Thread-23\" java.lang.NullPointerException\r\n\tat org.exist.xmldb.RemoteCollection.uploadAndStore(RemoteCollection.java:606)\r\n\tat org.exist.xmldb.RemoteCollection.storeResource(RemoteCollection.java:507)\r\n\tat org.exist.xmldb.RemoteCollection.storeResource(RemoteCollection.java:476)\r\n\tat org.exist.client.InteractiveClient.store(InteractiveClient.java:1763)\r\n\tat org.exist.client.InteractiveClient.parse(InteractiveClient.java:1673)\r\n\tat org.exist.client.ClientFrame$2.run(ClientFrame.java:980)\r\n```\r\nI tried to reconstruct the code to understand what the problem is.\r\n\r\nIt appears the res.getContent() returns a String (not a File or InputStream). Consequently the InputStream instance \"is\" is never instantiated and generates a null pointer exception.\r\n\r\nThis bug also causes restore to skip large files.\r\n", "url": "https://github.com/eXist-db/exist/issues/1874", "user": "thammr", "labels": ["bug", "regression"], "created": "2018-05-14 00:45:27", "closed": "2018-06-08 05:11:53", "commits": {}, "ttf": 25.00027777777778, "commitsDetails": []}, {"title": "xmldiff:compare fails under 4.1.0", "body": "The function xmldiff:compare in eXist 4.1.0 (downloaded fro eXist website) appears to be broken. According to the errors reported in various log files, it seems that lib/text/xmlunit-core-2.5.1.jar is not in the classpath.\r\n\r\nI am unable to construct any xquery involving xmldiff:compare that does not fail, except when one or both arguments is an empty sequence. \r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nxmldiff:compare(<fred/>, <barney/>)\r\n```\r\n\r\nI get the same results using:\r\n\r\nCentOS 7 64 bit running openjdk version \"1.8.0_131\"\r\nWindows 7 32 bit Java SE 1.8.0_152\r\nDebian 32 bit openjdk 1.8.0_? (Internet connected)\r\n\r\nThe error occurs when running as a service or run manually from command line.\r\n\r\nFollowing is an error report from exist.log:\r\n\r\n```text\r\n2018-04-23 08:39:44,498 [qtp775911842-245] ERROR (XQueryServlet.java [process]:545) - org/xmlunit/builder/Input \r\njava.lang.NoClassDefFoundError: org/xmlunit/builder/Input\r\n\tat org.exist.xquery.modules.xmldiff.Compare.eval(Compare.java:123) ~[exist-modules.jar:4.1.0]\r\n\tat org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:41) ~[exist.jar:4.1.0]\r\n\tat org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58) ~[exist.jar:4.1.0]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:4.1.0]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:4.1.0]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:4.1.0]\r\n\tat org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:4.1.0]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:4.1.0]\r\n\tat org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:4.1.0]\r\n\tat org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:4.1.0]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:261) ~[exist.jar:4.1.0]\r\n\tat org.exist.xquery.XQuery.execute(XQuery.java:185) ~[exist.jar:4.1.0]\r\n\tat org.exist.http.servlets.XQueryServlet.process(XQueryServlet.java:481) [exist-optional.jar:4.1.0]\r\n\tat org.exist.http.servlets.XQueryServlet.doPost(XQueryServlet.java:192) [exist-optional.jar:4.1.0]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:707) [servlet-api-3.1.jar:3.1.0]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790) [servlet-api-3.1.jar:3.1.0]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:864) [jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:535) [jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:146) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:566) [jetty-security-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:257) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1155) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:163) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:73) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:51) [exist-optional.jar:4.1.0]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:519) [exist-optional.jar:4.1.0]\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:338) [exist-optional.jar:4.1.0]\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790) [servlet-api-3.1.jar:3.1.0]\r\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:864) [jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1655) [jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat de.betterform.agent.web.filter.XFormsFilter.doFilter(XFormsFilter.java:171) [betterform-exist-5.1-SNAPSHOT-20160615.jar:?]\r\n\tat org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1634) [jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:533) [jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:146) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:524) [jetty-security-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:257) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:255) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:203) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [jetty-servlet-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:201) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1155) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:144) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:219) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:666) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.Server.handle(Server.java:531) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:352) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:260) [jetty-server-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:281) [jetty-io-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:102) [jetty-io-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:118) [jetty-io-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:319) [jetty-util-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:175) [jetty-util-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:133) [jetty-util-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:366) [jetty-util-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:754) [jetty-util-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:672) [jetty-util-9.4.9.v20180320.jar:9.4.9.v20180320]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_131]\r\n```\r\n\r\nWorkaround\r\n==========\r\n\r\nProcMon on Windows indicates that eXist is trying to access:\r\n\r\nc:\\eXist-db\\tools\\yajsw\\classes\\org\\xmlunit\\Input.class\r\n\r\nSo the workaround is to extract xmlunit-core-2.5.1.jar into eXist-db\\tools\\yajsw\\classes and restart service.\r\n\r\nThis works on CentOS and Windows.\r\n", "url": "https://github.com/eXist-db/exist/issues/1844", "user": "thammr", "labels": ["regression"], "created": "2018-04-23 03:17:27", "closed": "2018-04-25 17:13:56", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Error preventing xqsuite tests from running", "body": "### What is the problem\r\n\r\nThe `test:suite` function from the xqsuite.xql module takes a sequence of function items, typically supplied via the `inspect:module-functions` function. However, with a current build of develop, the  `inspect:module-functions` function fails, returning 0 items.\r\n\r\n### What did you expect\r\n\r\nI expected the `inspect:module-functions` function to be able to access modules and return function items for each function within the module.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n1. Upload an xqsuite test such as https://github.com/eXist-db/exist/blob/develop/extensions/indexes/lucene/test/src/xquery/lucene/analyzers.xql to the database, storing it as `/db/analyzers.xql`.\r\n\r\n2. Run the following query (in eXide or your query environment of choice):\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nimport module namespace test=\"http://exist-db.org/xquery/xqsuite\" at \"resource:org/exist/xquery/lib/xqsuite/xqsuite.xql\";\r\n\r\nlet $source := \"/db/analyzers.xql\"\r\nreturn\r\n    try { \r\n        test:suite(inspect:module-functions(xs:anyURI(\"xmldb:exist://\" || $source))) \r\n    } catch * {\r\n        map {\r\n            \"code\": $err:code,\r\n            \"description\": $err:description,\r\n            \"value\": $err:value,\r\n            \"module\": $err:module,\r\n            \"line-number\": $err:line-number,\r\n            \"column-number\": $err:column-number,\r\n            \"additional\": $err:additional\r\n        }\r\n    }\r\n```\r\n\r\nThe query will return the following error:\r\n\r\n```xquery\r\nmap {\r\n    \"column-number\": 20,\r\n    \"line-number\": 8,\r\n    \"additional\": (),\r\n    \"module\": \"String\",\r\n    \"code\": Q{http://exist.sourceforge.net/NS/exist/java-binding}org.exist.xquery.XPathException,\r\n    \"value\": (),\r\n    \"description\": \"exerr:ERROR XPTY0004: The actual cardinality for parameter 1 does not match the cardinality declared in the function's signature: test:suite($functions as function(*)+) item()*. Expected cardinality: one or more, got 0. [at line 8, column 20...]\"\r\n}\r\n```\r\n\r\nA more direct test is as follows:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nimport module namespace test=\"http://exist-db.org/xquery/xqsuite\" at \"resource:org/exist/xquery/lib/xqsuite/xqsuite.xql\";\r\n\r\nlet $source := \"/db/analyzers.xql\"\r\nreturn\r\n    (\r\n        util:binary-doc-available($source),\r\n        empty(inspect:module-functions(xs:anyURI(\"xmldb:exist://\" || $source)))\r\n    )\r\n```\r\n\r\nThe query returns two `true()` - meaning that the module is in the database and that `inspect:module-functions` is returning the empty sequence.\r\n\r\n### Context information\r\n\r\n- eXist-db version + Git Revision hash e.g. eXist-db 4.1.0-SNAPSHOT+201804141256 /  7db6f7ca0 \r\n- Java version: Oracle JDK 1.8.0_162\r\n- Operating system: macOS 10.13.4\r\n- 32 or 64 bit: 64 bit\r\n- Any custom changes in e.g. conf.xml: none\r\n", "url": "https://github.com/eXist-db/exist/issues/1827", "user": "joewiz", "labels": ["regression"], "created": "2018-04-14 17:59:32", "closed": "2018-04-16 11:25:27", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "Java9/10/... installation failure (on macOS and others)", "body": "### What is the problem\r\nStarting exist via GUI results in \r\n![screen shot 2018-03-29 at 13 09 08](https://user-images.githubusercontent.com/6205362/38086180-ac9fbef2-3353-11e8-9d23-7b101b11e0ba.png)\r\n \r\n\r\n### What did you expect\r\nexist-db to start\r\n\r\n### Describe how to reproduce or add a test\r\nmake sure that java 9 is in stalled and that:\r\n```bash\r\necho $JAVA_HOME\r\n/Library/Java/JavaVirtualMachines/jdk-9.0.4.jdk/Contents/Home\r\n```\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version 4.0.0\r\n- Java version 9.0.4\r\n- Operating system MacOs\r\n- 64 bit", "url": "https://github.com/eXist-db/exist/issues/1792", "user": "duncdrum", "labels": ["java 9", "regression"], "created": "2018-03-29 11:20:46", "closed": "2019-05-22 12:08:23", "commits": {}, "ttf": 419.0002777777778, "commitsDetails": []}, {"title": "From eXist 3.6.1 onwards, transform:transform() output of xmlns=\"\" causes err:XQDY0102", "body": "In eXist 3.6.1, but not in eXist 3.6.0 or any previous versions, when `transform:transform()` outputs an element with `xmlns=\"\"` which is embedded within prefixed or default namespace elements this causes the error:\r\n\r\n```\r\norg.xmldb.api.base.XMLDBException: err:XQDY0102 Cannot output a namespace node \r\n    for the default namespace when the element is in no namespace. \r\n```\r\n\r\nIf the same node sequence is constructed within XQuery it does not cause the error.\r\n\r\nI've attached an XQuery which demonstrates the issue.\r\n\r\nFinian\r\n\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n(:\r\n    In eXist-db 3.6.1 this XQuery causes the error\r\n    \r\n    \"org.xmldb.api.base.XMLDBException: err:XQDY0102 Cannot output a namespace node \r\n    for the default namespace when the element is in no namespace. \r\n    [at line 28, column 1, source: xquery version \"3.1\";\"\r\n    \r\n    In eXist-db 3.6.0, this XQuery returns the expected output:\r\n    \r\n    <package>\r\n        <unprefixed xmlns=\"http://default-namespace\">\r\n            <prefixed:element xmlns:prefixed=\"http://prefixed-namespace\">\r\n                <dummy xmlns=\"\"/>\r\n            </prefixed:element>\r\n        </unprefixed>\r\n    </package\r\n\r\n:)\r\nlet $xml := <anything/>\r\nlet $xslt := \r\n<xsl:stylesheet xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" exclude-result-prefixes=\"#all\" version=\"2.0\">\r\n    <xsl:template match=\"/\">\r\n        <unprefixed xmlns=\"http://default-namespace\">\r\n        <prefixed:element xmlns:prefixed=\"http://prefixed-namespace\">\r\n                <dummy xmlns=\"\"/>\r\n            </prefixed:element>\r\n        </unprefixed>\r\n    </xsl:template>\r\n</xsl:stylesheet>\r\n\r\nlet $output := transform:transform($xml, $xslt, ())\r\n\r\nlet $package:=\r\n<package>\r\n{$output}\r\n</package>\r\n\r\nreturn $package\r\n```\r\n\r\n[test-an-error-in-361.txt](https://github.com/eXist-db/exist/files/1622074/test-an-error-in-361.txt)\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1682", "user": "finianoboyle", "labels": ["regression"], "created": "2018-01-11 09:56:53", "closed": "2018-07-05 11:42:28", "commits": {"cc5b4fea88964a4b5fff141e549502686c3661f3": {"commitGHEventType": "closed", "commitUser": "ljo"}}, "ttf": 175.00027777777777, "commitsDetails": [{"commitHash": "cc5b4fea88964a4b5fff141e549502686c3661f3", "commitGHEventType": "closed", "commitUser": "ljo", "commitParents": ["1a4da07cbba4ed8a84695a8f760a0721680cdf3e"], "nameRev": "cc5b4fea88964a4b5fff141e549502686c3661f3 tags/eXist-5.1.0~362^2~1", "commitMessage": "[bugfix] Fix an issue with namespaces when merging memtree docs\nCloses https://github.com/eXist-db/exist/issues/1682\n", "commitDateTime": "2018-07-03 16:46:51", "authoredDateTime": "2018-07-03 16:46:23", "commitGitStats": [{"filePath": "src/org/exist/xquery/EnclosedExpr.java", "insertions": 2, "deletions": 0, "lines": 2}, {"filePath": "test/src/org/exist/dom/memtree/DocumentBuilderReceiverIntegrationTest.java", "insertions": 96, "deletions": 0, "lines": 96}], "commitSpoonAstDiffStats": [{"spoonFilePath": "EnclosedExpr.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.EnclosedExpr.eval(org.exist.xquery.Sequence,org.exist.xquery.Item)", "TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0}]}, {"spoonFilePath": "DocumentBuilderReceiverIntegrationTest.java", "spoonMethods": [{"spoonMethodName": "org.exist.dom.memtree.DocumentBuilderReceiverIntegrationTest", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["cc5b4fea88964a4b5fff141e549502686c3661f3"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 2, "deletions": 0, "lines": 2, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 2, "UPD": 0, "INS": 2, "MOV": 0, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/xquery"], "changesInPackagesSPOON": ["org.exist.xquery.EnclosedExpr.eval(org.exist.xquery.Sequence,org.exist.xquery.Item)"]}, {"title": "NPE in org.exist.xquery.functions.fn.FunId#getId()", "body": "Reported by craigberry  on exist-open\r\n\r\nI have a web app that is a variant of TEI Simple and it has a search form that works in 3.4.0 but breaks in 3.5.0 (and is still broken the same way in 3.6.0).  Thanks to the \"Copy as curl\" feature in my browser, the form submission boils down to:\r\n\r\ncurl 'http://localhost:8080/exist/apps/shc/works/search.html?query=justice&field=text&lucene-query-mode=any&tei-target=tei-text' \\\r\n-XGET \r\n\r\nThe result of that request is in the file attached here as search_test_350.html.  It consists mostly of a 2500-line Java stack dump. Changing GET to POST makes no difference as far as the error I get.  The heart of the matter seems to be somewhere around here:\r\n\r\nCaused by: javax.servlet.ServletException: An error occurred while processing request to /exist/apps/shc/works/search.html: An unknown error occurred: null\r\n\tat org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:381)\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790)\r\n\r\nand here:\r\n\r\nCaused by: javax.servlet.ServletException: An unknown error occurred: null\r\n\tat org.exist.http.servlets.EXistServlet.doPost(EXistServlet.java:478)\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:707)\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:790)\r\n\r\n\r\nThis problem has in common with GitHub issue #1612 (<https://github.com/eXist-db/exist/issues/1612>) blowing up on the same line in XQueryURLRewrite.java, but there it's an out of range exception rather than null exception as here, and I have no non-ASCII characters in my URL, which seems to be part of the problem there.  I should also note that other parts of the app, including other form submissions, seem to be fine.  A corollary of that is that I don't know how to make a smaller reproducer.\r\n\r\nSince I'm getting an exception caused by a null in some code that was explicitly changed to return null in commit a9c76a0fc040ede, I'm going to take a wild guess that the problem is somehow related to that commit:\r\n\r\n<https://github.com/eXist-db/exist/commit/a9c76a0fc040ede5a6e0d18b3452a11d918da4c7#diff-88285676e2d4cdf4bde12b4f92e821ca>\r\n\r\nThe rather cryptic commit message says, in its entirety, \"Node#getNamespaceURI and Node#getPrefix must return null unless a namespace or prefix is explicitly set at creation time.\"  Why must they?  Creation time of what, the HTTP request?  Is there something I should be looking for in my namespace declarations or form submission that would get the namespace set?\r\n\r\nIn case it matters, I'm running on macOS Sierra (10.12.6) and I've used the .dmg installers for 3.4.0, 3.5.0, and 3.6.0.  I've confirmed that downgrading to 3.4.0 fixes the problem.  And my Java version:\r\n\r\n$ java -version\r\njava version \"1.8.0_121\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_121-b13)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.121-b13, mixed mode)\r\n\r\n[Trace.txt](https://github.com/eXist-db/exist/files/1524786/Trace.txt)\r\n\r\n\r\n", "url": "https://github.com/eXist-db/exist/issues/1642", "user": "dizzzz", "labels": ["bug", "regression"], "created": "2017-12-03 13:56:30", "closed": "2017-12-09 19:20:49", "commits": {"44f41cad4c46493a02d2df21b046792c854118af": {"commitGHEventType": "referenced", "commitUser": "adamretter"}, "60784b70e699215cf60549717ab1dfedabae5bc5": {"commitGHEventType": "referenced", "commitUser": "adamretter"}}, "ttf": 6.000277777777778, "commitsDetails": [{"commitHash": "44f41cad4c46493a02d2df21b046792c854118af", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["e38cdf04192993cdca94827cec37ead421ad13ec", "eaff7ce12af6676989630e58a80501e9a5c32beb"], "nameRev": "44f41cad4c46493a02d2df21b046792c854118af tags/eXist-4.0.0~47", "commitMessage": "Merge pull request #1644 from dizzzz/bugfix/NPE-in-org.exist.xquery.functions.fn.FunId\n\nFix for #1642 NPE in org.exist.xquery.functions.fn.FunId", "commitDateTime": "2017-12-05 10:03:52", "authoredDateTime": "2017-12-05 10:03:52", "commitGitStats": [{"filePath": "src/org/exist/xquery/functions/fn/FunId.java", "insertions": 9, "deletions": 31, "lines": 40}], "commitSpoonAstDiffStats": [{"spoonFilePath": "FunId.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.functions.fn.FunId", "TOT": 16, "UPD": 16, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.eval(org.exist.xquery.value.Sequence,org.exist.xquery.value.Item)", "TOT": 30, "UPD": 30, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.getId(org.exist.dom.persistent.NodeSet,org.exist.dom.persistent.DocumentSet,java.lang.String)", "TOT": 7, "UPD": 7, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.getId(org.exist.xquery.value.Sequence,org.exist.xquery.value.Sequence,java.lang.String)", "TOT": 5, "UPD": 4, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.getId(org.exist.xquery.functions.fn.Sequence,org.exist.xquery.functions.fn.Sequence,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}, {"commitHash": "60784b70e699215cf60549717ab1dfedabae5bc5", "commitGHEventType": "referenced", "commitUser": "adamretter", "commitParents": ["a2c21206ec6933fd15899be39605d7c74f285ce6"], "nameRev": "60784b70e699215cf60549717ab1dfedabae5bc5 tags/eXist-3.6.1~11", "commitMessage": "Fix for #1642 NPE in org.exist.xquery.functions.fn.FunId\n", "commitDateTime": "2018-01-03 19:36:04", "authoredDateTime": "2017-12-03 14:58:31", "commitGitStats": [{"filePath": "src/org/exist/xquery/functions/fn/FunId.java", "insertions": 9, "deletions": 31, "lines": 40}], "commitSpoonAstDiffStats": [{"spoonFilePath": "FunId.java", "spoonMethods": [{"spoonMethodName": "org.exist.xquery.functions.fn.FunId", "TOT": 16, "UPD": 16, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.eval(org.exist.xquery.value.Sequence,org.exist.xquery.value.Item)", "TOT": 30, "UPD": 30, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.getId(org.exist.dom.persistent.NodeSet,org.exist.dom.persistent.DocumentSet,java.lang.String)", "TOT": 7, "UPD": 7, "INS": 0, "MOV": 0, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.getId(org.exist.xquery.value.Sequence,org.exist.xquery.value.Sequence,java.lang.String)", "TOT": 5, "UPD": 4, "INS": 0, "MOV": 1, "DEL": 0}, {"spoonMethodName": "org.exist.xquery.functions.fn.FunId.getId(org.exist.xquery.functions.fn.Sequence,org.exist.xquery.functions.fn.Sequence,java.lang.String)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["60784b70e699215cf60549717ab1dfedabae5bc5"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 1, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 9, "deletions": 31, "lines": 40, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 59, "UPD": 57, "INS": 1, "MOV": 1, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 5}, "statsSkippedReason": "", "changesInPackagesGIT": ["src/org/exist/xquery/functions/fn"], "changesInPackagesSPOON": ["org.exist.xquery.functions.fn.FunId", "org.exist.xquery.functions.fn.FunId.getId(org.exist.dom.persistent.NodeSet,org.exist.dom.persistent.DocumentSet,java.lang.String)", "org.exist.xquery.functions.fn.FunId.getId(org.exist.xquery.functions.fn.Sequence,org.exist.xquery.functions.fn.Sequence,java.lang.String)", "org.exist.xquery.functions.fn.FunId.eval(org.exist.xquery.value.Sequence,org.exist.xquery.value.Item)", "org.exist.xquery.functions.fn.FunId.getId(org.exist.xquery.value.Sequence,org.exist.xquery.value.Sequence,java.lang.String)"]}, {"title": "expath http client issue ", "body": "### What is the problem\r\nNPE in 3.6.0-SNAPSHOT for EXPath HTTP request which works perfectly fine on 3.4.x\r\n\r\n### What did you expect\r\nExpected was a response sequnce with header information in response[1] and the response itself in response[2]\r\n\r\n### Describe how to reproduce or add a test\r\n```\r\nimport module namespace http=\"http://expath.org/ns/http-client\";\r\n\r\nlet $user := \"user\"\r\nlet $pass:= \"pass\r\nlet $url := \"https://some-https-url-with-basic-auth\"\r\n\r\nlet $request := <http:request method=\"GET\" href=\"{$url}\" timeout=\"120\"  username=\"{$user}\" password=\"{$pass}\"\r\n                        auth-method=\"basic\" send-authorization=\"true\" override-media-type=\"application/octet-stream\">\r\n            <http:header name=\"accept\" value=\"application/xml\"/>\r\n        </http:request>\r\n\r\nreturn\r\n    <result>{ http:send-request($request) }</result>\r\n```\r\n\r\nFrom the log files: \r\n\r\n```\r\n2017-11-16 16:27:24,267 [qtp1999415998-103] ERROR (XQueryServlet.java [process]:534) - null \r\njava.lang.NullPointerException: null\r\n        at org.expath.httpclient.impl.ApacheHttpConnection.setCredentials(ApacheHttpConnection.java:415) ~[http-client-java-1.0-SNAPSHOT.jar:1.0-SNAPSHOT]\r\n        at org.expath.httpclient.impl.ApacheHttpConnection.connect(ApacheHttpConnection.java:98) ~[http-client-java-1.0-SNAPSHOT.jar:1.0-SNAPSHOT]\r\n        at org.expath.httpclient.impl.HttpRequestImpl.send(HttpRequestImpl.java:56) ~[http-client-java-1.0-SNAPSHOT.jar:1.0-SNAPSHOT]\r\n        at org.expath.exist.SendRequestFunction.sendOnceWithAuth(SendRequestFunction.java:206) ~[exist-expath-20130805.jar:3.6.0-SNAPSHOT]\r\n        at org.expath.exist.SendRequestFunction.sendOnce(SendRequestFunction.java:172) ~[exist-expath-20130805.jar:3.6.0-SNAPSHOT]\r\n        at org.expath.exist.SendRequestFunction.sendRequest(SendRequestFunction.java:151) ~[exist-expath-20130805.jar:3.6.0-SNAPSHOT]\r\n        at org.expath.exist.SendRequestFunction.eval(SendRequestFunction.java:133) ~[exist-expath-20130805.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.BasicFunction.eval(BasicFunction.java:74) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:41) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:82) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:329) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.LetExpr.eval(LetExpr.java:111) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.PathExpr.eval(PathExpr.java:276) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.XQuery.execute(XQuery.java:261) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.xquery.XQuery.execute(XQuery.java:185) ~[exist.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.http.servlets.XQueryServlet.process(XQueryServlet.java:470) [exist-optional.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.http.servlets.XQueryServlet.doPost(XQueryServlet.java:191) [exist-optional.jar:3.6.0-SNAPSHOT]\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:707) [servlet-api-3.1.jar:3.1.0]\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:790) [servlet-api-3.1.jar:3.1.0]\r\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:841) [jetty-servlet-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:535) [jetty-servlet-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:566) [jetty-security-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:190) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:188) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n    at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:168) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [jetty-servlet-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:166) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1155) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:163) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:73) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:50) [exist-optional.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:548) [exist-optional.jar:3.6.0-SNAPSHOT]\r\n        at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:352) [exist-optional.jar:3.6.0-SNAPSHOT]\r\n        at javax.servlet.http.HttpServlet.service(HttpServlet.java:790) [servlet-api-3.1.jar:3.1.0]\r\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:833) [jetty-servlet-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:535) [jetty-servlet-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:524) [jetty-security-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:190) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1595) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:188) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1253) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:168) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:473) [jetty-servlet-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1564) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:166) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1155) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:219) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:126) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.gzip.GzipHandler.handle(GzipHandler.java:454) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:132) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.Server.handle(Server.java:564) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:317) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:251) [jetty-server-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:279) [jetty-io-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:110) [jetty-io-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:289) [jetty-io-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.io.ssl.SslConnection$3.succeeded(SslConnection.java:149) [jetty-io-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:110) [jetty-io-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.io.ChannelEndPoint$2.run(ChannelEndPoint.java:124) [jetty-io-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.util.thread.Invocable.invokePreferred(Invocable.java:128) [jetty-util-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.util.thread.Invocable$InvocableExecutor.invoke(Invocable.java:222) [jetty-util-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:294) [jetty-util-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:199) [jetty-util-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:673) [jetty-util-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at org.eclipse.jetty.util.thread.QueuedThreadPool$2.run(QueuedThreadPool.java:591) [jetty-util-9.4.6.v20170531.jar:9.4.6.v20170531]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_151]\r\n```\r\n\r\n\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXistdb: 3.6.0\r\n- Java: 8\r\n- MacOs and CentOS\r\n- 64 bit\r\n- multiple custom changes in configs but nothing related to EXPath http client.\r\n\r\nHaven't found the time to debug this myself, since I'm fighting with some 3.4.x eXistdb issues which I hoped would be solved with 3.6.0.\r\n \r\n", "url": "https://github.com/eXist-db/exist/issues/1618", "user": "windauer", "labels": ["bug", "regression"], "created": "2017-11-16 16:41:36", "closed": "2017-11-16 22:00:29", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Lost line and column number in XPST0081 error", "body": "### What is the problem\r\n\r\nIn eXist 3.4.1 and earlier, `util:compile-query()` would return the correct context for XPST0081 (\"No namespace defined for prefix __\") errors. In eXist 3.5.0 and later, the line and column context is lost.\r\n\r\n### What did you expect\r\n\r\nGiven a query that contains a missing module import declaration:\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nutil:compile-query(\"console:log('foo')\", \"xmldb:exist://\")\r\n```\r\n\r\nI would expect the result as delivered under eXist 3.4.1 and earlier:\r\n\r\n```xml\r\n<info result=\"fail\">\r\n    <error code=\"(http://www.w3.org/2005/xqt-errors#XPST0081):It is a static error if a QName \r\n        used in an expression contains a namespace prefix that cannot be expanded into a namespace \r\n        URI by using the statically known namespaces.\" \r\n            line=\"1\" \r\n            column=\"1\">\r\n                No namespace defined for prefix console\r\n    </error>\r\n</info>\r\n```\r\n\r\nHowever, eXist 3.5.0 and higher, the `@line` and `@column` values are incorrect:\r\n\r\n```xml\r\n<info result=\"fail\">\r\n    <error code=\"(http://www.w3.org/2005/xqt-errors#XPST0081):It is a static error if a QName \r\n        used in an expression contains a namespace prefix that cannot be expanded into a namespace \r\n        URI by using the statically known namespaces.\" \r\n            line=\"0\" \r\n            column=\"0\">\r\n                Invalid qname console:log\r\n    </error>\r\n</info>\r\n```\r\n\r\nNotice the differences:\r\n\r\n1. `@line` and `@column` now both return `0` (null?) instead of `1`\r\n2. The error message has changed from `No namespace defined for prefix console` to `Invalid qname console:log`\r\n\r\n### Describe how to reproduce or add a test\r\n\r\nHere's an XQSuite test (download at [test-compile-xquery.xq.zip](https://github.com/eXist-db/exist/files/1380101/test-compile-xquery.xq.zip))\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace cq = \"http://exist-db.org/test/util/compile-query\";\r\n\r\ndeclare namespace test=\"http://exist-db.org/xquery/xqsuite\";\r\n\r\ndeclare \r\n    %test:args('xquery version \"3.1\"; \r\n\r\nconsole:log(\"foo\")')\r\n    %test:assertEquals(3, 1)\r\n    function cq:get-error-line-column($query) {\r\n        let $context := \"xmldb:exist://\"\r\n        let $info := util:compile-query($query, $context)\r\n        return\r\n            if ($info/error) then\r\n                $info/error/(@line, @column) ! (. cast as xs:integer)\r\n            else\r\n                ()\r\n};\r\n```\r\n\r\nReturns:\r\n\r\n```xml\r\n<testsuites>\r\n    <testsuite package=\"http://exist-db.org/test/util/compile-query\"\r\n        timestamp=\"2017-10-12T13:17:08.388-04:00\" failures=\"1\" pending=\"0\" tests=\"1\" time=\"PT0.006S\">\r\n        <testcase name=\"get-error-line-column\" class=\"cq:get-error-line-column\">\r\n            <failure message=\"assertEquals failed.\" type=\"failure-error-code-1\">3 1</failure>\r\n            <output>0 0</output>\r\n        </testcase>\r\n    </testsuite>\r\n</testsuites>\r\n```\r\n\r\n### Context information\r\n- eXist-db version + Git Revision hash: eXist 3.4.1+e8996ca748 and eXist 3.6.0-SNAPSHOT+ef437e27c9 (build 201710121258)\r\n- Java version: jdk1.8.0_144.jdk\r\n- Operating system: OSX 10.13\r\n- 32 or 64 bit: x86_64\r\n- Any custom changes in e.g. conf.xml: none", "url": "https://github.com/eXist-db/exist/issues/1583", "user": "joewiz", "labels": ["bug", "regression"], "created": "2017-10-12 17:20:06", "closed": "2020-03-03 10:55:15", "commits": {}, "ttf": 872.0002777777778, "commitsDetails": []}, {"title": "Regression? 3.5's installer doesn't create data folder.", "body": "### What is the problem\r\n\r\nWhile the installer of version 3.4.1 created the folder that was given as argument for the 'Data Directory', the one of 3.5.0 doesn't. This is at least true for relative paths that are supposed to be siblings of the installation target.\r\n\r\nIf this changed behaviour is intended, it should be mentioned in the changelog.\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n```\r\n$ java -jar ~/Downloads/eXist-db-setup-3.5.0.jar -console                                                                                                                                        \r\nSelect target path [/tmp] \r\n/tmp/test\r\npress 1 to continue, 2 to quit, 3 to redisplay\r\n1\r\nSet Data Directory\r\nPlease select a directory where eXist-db will keep its data files. On Windows, this should be outside the 'Program Files' directory. Please make sure eXist can write to the directory it is installed in.\r\nData dir:  [webapp/WEB-INF/data] \r\n../data\r\npress 1 to continue, 2 to quit, 3 to redisplay\r\n1\r\nSet Admin Password and Configure Memory\r\nEnter password:  [] \r\ntest\r\nEnter password:  [test] \r\n\r\n------------------------------------------\r\n\r\nMaximum memory in MB: [2048] \r\n\r\nCache memory in MB: [256] \r\n\r\npress 1 to continue, 2 to quit, 3 to redisplay\r\n1\r\n[ Starting to unpack ]\r\n[ Processing package: Sources (1/10) ]\r\n[ Processing package: Core (2/10) ]\r\n[ Processing package: Apps (3/10) ]\r\n[ Processing package: shared (4/10) ]\r\n[ Processing package: dashboard (5/10) ]\r\n[ Processing package: doc (6/10) ]\r\n[ Processing package: eXide (7/10) ]\r\n[ Processing package: fundocs (8/10) ]\r\n[ Processing package: markdown (9/10) ]\r\n[ Processing package: monex (10/10) ]\r\n[ Unpacking finished ]\r\n[ Starting processing ]\r\nStarting process Setting admin password ... (1/1)\r\n--- Starting embedded database instance ---\r\nSetting admin user password...\r\n--- Initialization complete. Shutdown embedded database instance ---\r\n[ Console installation done ]\r\n$ [ -d /tmp/data ]; echo $?\r\n1\r\n```\r\n\r\nversus\r\n\r\n```\r\n$ java -jar ~/Downloads/eXist-db-setup-3.4.1.jar -console                                                                                                                                        \r\n/tmp/test\r\npress 1 to continue, 2 to quit, 3 to redisplay\r\n1\r\nSet Data Directory\r\nPlease select a directory where eXist-db will keep its data files. On Windows, this should be outside the 'Program Files' directory. Please make sure eXist can write to the directory it is installed in.\r\nData dir:  [webapp/WEB-INF/data] \r\n../data\r\npress 1 to continue, 2 to quit, 3 to redisplay\r\n1\r\nSet Admin Password and Configure Memory\r\nEnter password:  [] \r\ntest\r\nEnter password:  [test] \r\n\r\n------------------------------------------\r\n\r\nMaximum memory in MB: [2048] \r\n\r\nCache memory in MB: [256] \r\n\r\npress 1 to continue, 2 to quit, 3 to redisplay\r\n1\r\n[ Starting to unpack ]\r\n[ Processing package: Sources (1/10) ]\r\n[ Processing package: Core (2/10) ]\r\n[ Processing package: Apps (3/10) ]\r\n[ Processing package: shared (4/10) ]\r\n[ Processing package: dashboard (5/10) ]\r\n[ Processing package: doc (6/10) ]\r\n[ Processing package: eXide (7/10) ]\r\n[ Processing package: fundocs (8/10) ]\r\n[ Processing package: markdown (9/10) ]\r\n[ Processing package: monex (10/10) ]\r\n[ Unpacking finished ]\r\n[ Starting processing ]\r\nStarting process Setting admin password ... (1/1)\r\n--- Starting embedded database instance ---\r\nSetting admin user password...\r\n--- Initialization complete. Shutdown embedded database instance ---\r\n[ Console installation done ]\r\n$ [ -d /tmp/data ]; echo $?\r\n0\r\n```\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db 3.4.1 /  e8996ca |  3.5.0 / 12aea86\r\n- OpenJDK Runtime Environment (build 1.8.0_131-8u131-b11-2ubuntu1.16.04.3-b11)\r\n- Ubuntu Xenial\r\n- 64 bit", "url": "https://github.com/eXist-db/exist/issues/1576", "user": "funkyfuture", "labels": ["bug", "installer", "regression"], "created": "2017-10-12 10:07:38", "closed": "2019-05-22 12:08:24", "commits": {}, "ttf": 587.0002777777778, "commitsDetails": []}, {"title": "regression with closures in maps (since 3.4.0)", "body": "### What is the problem\r\nStarting with eXist version 3.4.0 inline functions within maps will not inherit variables declared outside its function body. The problem has been discussed on [eXist-open](https://sourceforge.net/p/exist/mailman/message/36045046/) and was confirmed by @joewiz by testing against Saxon and BaseX.\r\n\r\n### What did you expect\r\n\r\nI expected all three tests to pass without errors (as they do in eXist version 3.3.0).\r\n\r\n### Describe how to reproduce or add a test\r\n\r\n```xquery\r\nxquery version \"3.1\";\r\n\r\nmodule namespace ct=\"http://exist-db.org/xquery/closures/test\";\r\n\r\ndeclare variable $ct:model := function($param) {\r\n    let $func := function() {\r\n       $param\r\n    }\r\n    return\r\n        map {\r\n            'test1' : $func,\r\n            'test2' : $func(),\r\n            'test3' : function() {\r\n                $param\r\n            }\r\n        }\r\n};\r\n\r\ndeclare %test:assertEquals('Hello World') function ct:test1-function-reference() as xs:string {\r\n    try {\r\n        $ct:model('Hello World')?test1()\r\n    }\r\n    catch * {$err:code || ' ' || $err:description}\r\n};\r\n\r\ndeclare %test:assertEquals('Hello World') function ct:test2-function-call() as xs:string {\r\n    try {\r\n        $ct:model('Hello World')?test2\r\n    }\r\n    catch * {$err:code || ' ' || $err:description}\r\n};\r\n\r\ndeclare %test:assertEquals('Hello World') function ct:test3-inline-function() as xs:string {\r\n    try {\r\n        $ct:model('Hello World')?test3()\r\n    }\r\n    catch * {$err:code || ' ' || $err:description}\r\n};\r\n```\r\n\r\n\r\n### Context information\r\n- eXist-db version 3.5.0-SNAPSHOT /  fdaabad\r\n- Java 1.8.0_131 [Oracle Corporation]\r\n- Operating system MacOs Capitan 64 bit\r\n- vanilla build from develop branch\r\n", "url": "https://github.com/eXist-db/exist/issues/1550", "user": "peterstadler", "labels": ["bug", "high prio", "regression"], "created": "2017-09-20 08:21:00", "closed": "2019-03-26 04:32:26", "commits": {}, "ttf": 551.0002777777778, "commitsDetails": []}, {"title": "Error to start Java Client 3.3.0 from Dashboard/web browser ", "body": "Thank you for reporting your issue!\r\n\r\nTo be able to better understand you problem or suggestion, please add as much information as possible to this ticket. When there is no or just little information, it will be too difficult to work on it (and hence we will not be able to solve it)\r\n\r\nPlease fill in the following sections:\r\n\r\n### What is the problem\r\n> Trying to Open/Start Java Admin Client from Dashboard\r\nException:\r\n```\r\nJNLPException[category: Security Error : Exception: null : LaunchDesc: \r\n<jnlp spec=\"7.0\" codebase=\"http://localhost:8080/exist/webstart/\" href=\"exist.jnlp\" version=\"3.3.0\">\r\n  <information>\r\n    <title>eXist XML-DB client</title>\r\n    <vendor>exist-db.org</vendor>\r\n    <homepage href=\"http://exist-db.org\"/>\r\n    <description>Integrated command-line and gui client, entirely based on the XML:DB API and provides commands for most database related tasks, like creating and removing collections, user management, batch-loading XML data or querying.</description>\r\n    <description kind=\"short\">eXist XML-DB client</description>\r\n    <description kind=\"tooltip\">eXist XML-DB client</description>\r\n    <icon href=\"jnlp_logo.jpg\"/>\r\n    <icon href=\"jnlp_icon_128x128.gif\" width=\"128\" height=\"128\"/>\r\n    <icon href=\"jnlp_icon_64x64.gif\" width=\"64\" height=\"64\"/>\r\n    <icon href=\"jnlp_icon_32x32.gif\" width=\"32\" height=\"32\"/>\r\n  </information>\r\n  <security>\r\n    <all-permissions/>\r\n  </security>\r\n  <resources>\r\n    <property name=\"jnlp.packEnabled\" value=\"true\"/>\r\n    <property name=\"java.util.logging.manager\" value=\"org.apache.logging.log4j.jul.LogManager\"/>\r\n    <java version=\"1.8+\"/>\r\n    <jar href=\"log4j-jul-2.8.2.jar\" size=\"26272\"/>\r\n    <jar href=\"commons-codec-1.10.jar\" size=\"307249\"/>\r\n    <jar href=\"cglib-nodep-3.1.jar\" size=\"358483\"/>\r\n    <jar href=\"jcip-annotations-1.0.jar\" size=\"4005\"/>\r\n    <jar href=\"pkg-java-fork.jar\" size=\"87631\"/>\r\n    <jar href=\"commons-logging-1.2.jar\" size=\"66579\"/>\r\n    <jar href=\"jargo-0.4.2-SNAPSHOT-7fa1d04.jar\" size=\"200065\"/>\r\n    <jar href=\"xmlrpc-client-3.1.3.jar\" size=\"65537\"/>\r\n    <jar href=\"rsyntaxtextarea-2.6.1.jar\" size=\"1201107\"/>\r\n    <jar href=\"slf4j-api-1.7.21.jar\" size=\"46264\"/>\r\n    <jar href=\"exist.jar\" size=\"4441960\"/>\r\n    <jar href=\"quartz-2.2.3.jar\" size=\"700323\"/>\r\n    <jar href=\"clj-ds-0.0.4.jar\" size=\"290932\"/>\r\n    <jar href=\"jackson-core-2.7.4.jar\" size=\"262996\"/>\r\n    <jar href=\"log4j-core-2.8.2.jar\" size=\"1498139\"/>\r\n    <jar href=\"commons-pool-1.6.jar\" size=\"118732\"/>\r\n    <jar href=\"xmlrpc-common-3.1.3.jar\" size=\"122505\"/>\r\n    <jar href=\"jline-0.9.94.jar\" size=\"93084\"/>\r\n    <jar href=\"j8fu-1.4.1.jar\" size=\"54814\"/>\r\n    <jar href=\"log4j-api-2.8.2.jar\" size=\"243001\"/>\r\n    <jar href=\"commons-io-2.5.jar\" size=\"221540\"/>\r\n    <jar href=\"gnu-crypto-2.0.1.jar\" size=\"644209\"/>\r\n    <jar href=\"ws-commons-util-1.0.2.jar\" size=\"38575\"/>\r\n    <jar href=\"commons-collections-3.2.2.jar\" size=\"630602\"/>\r\n    <jar href=\"log4j-slf4j-impl-2.8.2.jar\" size=\"26094\"/>\r\n    <jar href=\"xmldb.jar\" size=\"12768\"/>\r\n    <jar href=\"antlr-2.7.7.jar\" size=\"464341\"/>\r\n    <jar href=\"jta-1.1.jar\" size=\"16277\"/>\r\n  </resources>\r\n  <application-desc main-class=\"org.exist.client.InteractiveClient\">\r\n    <argument>-ouri=xmldb:exist://localhost:8080/exist/xmlrpc</argument>\r\n    <argument>--no-embedded-mode</argument>\r\n  </application-desc>\r\n</jnlp> ]\r\n\tat com.sun.javaws.security.JNLPSignedResourcesHelper.checkSignedResourcesHelper(Unknown Source)\r\n\tat com.sun.javaws.security.JNLPSignedResourcesHelper.checkSignedResources(Unknown Source)\r\n\tat com.sun.javaws.Launcher.prepareResources(Unknown Source)\r\n\tat com.sun.javaws.Launcher.prepareAllResources(Unknown Source)\r\n\tat com.sun.javaws.Launcher.prepareToLaunch(Unknown Source)\r\n\tat com.sun.javaws.Launcher.prepareToLaunch(Unknown Source)\r\n\tat com.sun.javaws.Launcher.launch(Unknown Source)\r\n\tat com.sun.javaws.Main.launchApp(Unknown Source)\r\n\tat com.sun.javaws.Main.continueInSecureThread(Unknown Source)\r\n\tat com.sun.javaws.Main.access$000(Unknown Source)\r\n\tat com.sun.javaws.Main$1.run(Unknown Source)\r\n\tat java.lang.Thread.run(Unknown Source)\r\n```\r\n\r\n### What did you expect\r\n> Java Admin Client started as in versions prior to 3.3.0\r\n\r\n### Describe how to reproduce or add a test\r\n> Start Java Admin Client from Dashboard\r\n\r\n> The *best* way is to provide a 'self containing' test, a test that can be run without dependancies.\r\n\r\n1. in IE or Chrome Start Dashboard\r\n2. Click and open \"Java Admin Client\"\r\n\r\nIt is starts OK from \"Quick Start\" menu. the Quick Start menu not available if eXist runs as a service.\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version 3.3.0  \r\n- Java version 1.8.0_131\r\n- Operating system Windows 10 or Windows 2016\r\n- 64 bit\r\n- no changes to conf.xml\r\n", "url": "https://github.com/eXist-db/exist/issues/1475", "user": "andray71", "labels": ["bug", "regression"], "created": "2017-07-05 23:53:00", "closed": "2017-07-31 17:45:37", "commits": {}, "ttf": 25.00027777777778, "commitsDetails": []}, {"title": "Problem with eXist-db 3.1.0 client-CLI (new jargo parser suspect)", "body": "Hi everybody,\r\n\r\nI work on Linux Debian Wheezy distribution and I install the newest 3.1.0 eXist-db version.\r\nThe version of the JDK is openJdk-8-jdk.\r\nI work only in the command line.\r\nWhen I try to send an XQuery with the `client.sh` script like this:\r\n```bash\r\n$EXIST_HOME/bin/client.sh -u admin -P pass -x \"xquery\"\r\n```\r\n \r\neXist-db return this error:\r\n```\r\nConnecting to database...\r\nConnection to database failed; message: HTTP server returned unexpected status: Unauthorized\r\norg.xmldb.api.base.XMLDBException: HTTP server returned unexpected status: Unauthorized\r\n        at org.exist.xmldb.RemoteCollection.instance(RemoteCollection.java:89)\r\n        at org.exist.xmldb.RemoteCollection.instance(RemoteCollection.java:72)\r\n        at org.exist.xmldb.DatabaseImpl.readCollection(DatabaseImpl.java:265)\r\n        at org.exist.xmldb.DatabaseImpl.getRemoteCollection(DatabaseImpl.java:227)\r\n        at org.exist.xmldb.DatabaseImpl.getCollection(DatabaseImpl.java:167)\r\n        at org.exist.xmldb.DatabaseImpl.getCollection(DatabaseImpl.java:156)\r\n        at org.xmldb.api.DatabaseManager.getCollection(Unknown Source)\r\n        at org.exist.client.InteractiveClient.connect(InteractiveClient.java:282)\r\n        at org.exist.client.InteractiveClient.connectToDatabase(InteractiveClient.java:2079)\r\n        at org.exist.client.InteractiveClient.run(InteractiveClient.java:2173)\r\n        at org.exist.client.InteractiveClient.main(InteractiveClient.java:237)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.lang.reflect.Method.invoke(Method.java:498)\r\n        at org.exist.start.Main.invokeMain(Main.java:140)\r\n        at org.exist.start.Main.run(Main.java:453)\r\n        at org.exist.start.Main.main(Main.java:64)\r\nCaused by: org.apache.xmlrpc.client.XmlRpcHttpTransportException: HTTP server returned unexpected status: Unauthorized\r\n        at org.apache.xmlrpc.client.XmlRpcSunHttpTransport.getInputStream(XmlRpcSunHttpTransport.java:94)\r\n        at org.apache.xmlrpc.client.XmlRpcStreamTransport.sendRequest(XmlRpcStreamTransport.java:152)\r\n        at org.apache.xmlrpc.client.XmlRpcHttpTransport.sendRequest(XmlRpcHttpTransport.java:143)\r\n        at org.apache.xmlrpc.client.XmlRpcSunHttpTransport.sendRequest(XmlRpcSunHttpTransport.java:69)\r\n        at org.apache.xmlrpc.client.XmlRpcClientWorker.execute(XmlRpcClientWorker.java:56)\r\n        at org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:167)\r\n        at org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:158)\r\n        at org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:147)\r\n        at org.exist.xmldb.RemoteCollection.instance(RemoteCollection.java:81)\r\n        ... 17 more\r\n[B@1329efforg.apache.xmlrpc.client.XmlRpcHttpTransportException: HTTP server returned unexpected status: Unauthorized\r\n        at org.apache.xmlrpc.client.XmlRpcSunHttpTransport.getInputStream(XmlRpcSunHttpTransport.java:94)\r\n        at org.apache.xmlrpc.client.XmlRpcStreamTransport.sendRequest(XmlRpcStreamTransport.java:152)\r\n        at org.apache.xmlrpc.client.XmlRpcHttpTransport.sendRequest(XmlRpcHttpTransport.java:143)\r\n        at org.apache.xmlrpc.client.XmlRpcSunHttpTransport.sendRequest(XmlRpcSunHttpTransport.java:69)\r\n        at org.apache.xmlrpc.client.XmlRpcClientWorker.execute(XmlRpcClientWorker.java:56)\r\n        at org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:167)\r\n        at org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:158)\r\n        at org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:147)\r\n        at org.exist.xmldb.RemoteCollection.instance(RemoteCollection.java:81)\r\n        at org.exist.xmldb.RemoteCollection.instance(RemoteCollection.java:72)\r\n        at org.exist.xmldb.DatabaseImpl.readCollection(DatabaseImpl.java:265)\r\n        at org.exist.xmldb.DatabaseImpl.getRemoteCollection(DatabaseImpl.java:227)\r\n        at org.exist.xmldb.DatabaseImpl.getCollection(DatabaseImpl.java:167)\r\n        at org.exist.xmldb.DatabaseImpl.getCollection(DatabaseImpl.java:156)\r\n        at org.xmldb.api.DatabaseManager.getCollection(Unknown Source)\r\n        at org.exist.client.InteractiveClient.connect(InteractiveClient.java:282)\r\n        at org.exist.client.InteractiveClient.connectToDatabase(InteractiveClient.java:2079)\r\n        at org.exist.client.InteractiveClient.run(InteractiveClient.java:2173)\r\n        at org.exist.client.InteractiveClient.main(InteractiveClient.java:237)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.lang.reflect.Method.invoke(Method.java:498)\r\n        at org.exist.start.Main.invokeMain(Main.java:140)\r\n        at org.exist.start.Main.run(Main.java:453)\r\n        at org.exist.start.Main.main(Main.java:64)\r\nCaused by: org.apache.xmlrpc.client.XmlRpcHttpTransportException: HTTP server returned unexpected status: Unauthorized\r\n        at org.apache.xmlrpc.client.XmlRpcSunHttpTransport.getInputStream(XmlRpcSunHttpTransport.java:94)\r\n        at org.apache.xmlrpc.client.XmlRpcStreamTransport.sendRequest(XmlRpcStreamTransport.java:152)\r\n        at org.apache.xmlrpc.client.XmlRpcHttpTransport.sendRequest(XmlRpcHttpTransport.java:143)\r\n        at org.apache.xmlrpc.client.XmlRpcSunHttpTransport.sendRequest(XmlRpcSunHttpTransport.java:69)\r\n        at org.apache.xmlrpc.client.XmlRpcClientWorker.execute(XmlRpcClientWorker.java:56)\r\n        at org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:167)\r\n        at org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:158)\r\n        at org.apache.xmlrpc.client.XmlRpcClient.execute(XmlRpcClient.java:147)\r\n        at org.exist.xmldb.RemoteCollection.instance(RemoteCollection.java:81)\r\n        at org.exist.xmldb.RemoteCollection.instance(RemoteCollection.java:72)\r\n        at org.exist.xmldb.DatabaseImpl.readCollection(DatabaseImpl.java:265)\r\n        at org.exist.xmldb.DatabaseImpl.getRemoteCollection(DatabaseImpl.java:227)\r\n        at org.exist.xmldb.DatabaseImpl.getCollection(DatabaseImpl.java:167)\r\n        at org.exist.xmldb.DatabaseImpl.getCollection(DatabaseImpl.java:156)\r\n        at org.xmldb.api.DatabaseManager.getCollection(Unknown Source)\r\n        at org.exist.client.InteractiveClient.connect(InteractiveClient.java:282)\r\n        at org.exist.client.InteractiveClient.connectToDatabase(InteractiveClient.java:2079)\r\n        at org.exist.client.InteractiveClient.run(InteractiveClient.java:2173)\r\n        at org.exist.client.InteractiveClient.main(InteractiveClient.java:237)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.lang.reflect.Method.invoke(Method.java:498)\r\n        at org.exist.start.Main.invokeMain(Main.java:140)\r\n        at org.exist.start.Main.run(Main.java:453)\r\n        at org.exist.start.Main.main(Main.java:64)\r\n```\r\n\r\nI suspect a new Jargo parser problem because this command line work when admin password is empty.\r\nIndeed, if the admin password is empty, the command `$EXIST_HOME/bin.client.sh -x \"xquery\"` works fine.\r\nI think `-u` and `-P` arg are not correctly parse. Somedoby can help me?\r\nThanks!", "url": "https://github.com/eXist-db/exist/issues/1354", "user": "ThomasTos", "labels": ["regression"], "created": "2017-03-16 08:53:26", "closed": "2017-03-20 08:49:23", "commits": {}, "ttf": 3.000277777777778, "commitsDetails": []}, {"title": "backup/restore not working", "body": "### What is the problem\r\nwhen executing command:\r\n`bin/backup.sh --restore \"$EXIST_BACKUP/backup-config-service.zip\" -u admin -p \"$EXIST_ADMIN_PASSW\"`\r\n\r\ngetting error:\r\n`Missing required arguments: [-b]null`\r\n\r\n### What did you expect\r\ndatabase/collection restored. It worked in previous version 3.0\r\n\r\n### Describe how to reproduce or add a test\r\njust try to restore any collection using command line\r\n\r\n### Context information\r\nPlease always add the following information\r\n- eXist-db version: eXist-db 3.1.0 (running in Docker - FROM openjdk:latest...)\r\n- Java version (e.g. Java8u121): \r\nopenjdk version \"1.8.0_121\"\r\nOpenJDK Runtime Environment (build 1.8.0_121-8u121-b13-1~bpo8+1-b13)\r\nOpenJDK 64-Bit Server VM (build 25.121-b13, mixed mode)\r\n- Operating system: Linux 4.9.12-moby amd64\r\n- 64 bit\r\n- Any custom changes in e.g. conf.xml: no\r\n", "url": "https://github.com/eXist-db/exist/issues/1338", "user": "andray71", "labels": ["regression"], "created": "2017-03-08 18:51:55", "closed": "2017-03-20 18:08:02", "commits": {}, "ttf": 11.000277777777777, "commitsDetails": []}, {"title": "\"eXist-db\" app remains running after first install on macOS", "body": "When I first run eXist-db.app using current nightly builds on macOS, the eXist-db icon that appears in my dock doesn't close when I quit eXist via the menu bar.  It seems the only way to get this icon to go away is to control-click on it and select quit.  \r\n\r\nThis is odd, since it's not associated with the eXist-db process. It seems harmless but will certainly confuse users. \r\n\r\nThe \"normal\" behavior I would expect from eXist-db is that the dock icon appears briefly and then disappears after the menu bar icon appears.  \r\n\r\nSince this persistent dock icon only appears once - on first run of a new installation - my hunch is that this is somehow related to something that only happens on first run and not subsequent runs.  But I'm not sure what it is.", "url": "https://github.com/eXist-db/exist/issues/1248", "user": "joewiz", "labels": ["YAJSW", "bug", "regression"], "created": "2017-02-02 15:21:44", "closed": "2019-05-25 09:15:42", "commits": {"fae98f03247672dcc0789600e3942c4336f61219": {"commitGHEventType": "closed", "commitUser": "adamretter"}}, "ttf": 841.0002777777778, "commitsDetails": [{"commitHash": "fae98f03247672dcc0789600e3942c4336f61219", "commitGHEventType": "closed", "commitUser": "adamretter", "commitParents": ["1134c67ed2f846be9b1816274fe15bc40e9746ad"], "nameRev": "fae98f03247672dcc0789600e3942c4336f61219 tags/eXist-5.1.0~169^2~1", "commitMessage": "[bugfix] LauncherWrapper not exiting after first start. Closes #1248\n", "commitDateTime": "2019-05-23 19:16:43", "authoredDateTime": "2019-05-23 19:16:43", "commitGitStats": [{"filePath": "exist-core/src/main/java/org/exist/launcher/ConfigurationDialog.java", "insertions": 3, "deletions": 0, "lines": 3}], "commitSpoonAstDiffStats": [{"spoonFilePath": "ConfigurationDialog.java", "spoonMethods": [{"spoonMethodName": "org.exist.launcher.ConfigurationDialog.open(boolean)", "TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0}]}], "spoonStatsSkippedReason": ""}], "filteredCommits": ["fae98f03247672dcc0789600e3942c4336f61219"], "filteredCommitsReason": {"duplicated": 0, "alsoFixesPhrase": 0, "moreThanOneParent": 0, "multipleIssueFixes": 0, "unavailable": 0, "mergeCommitUsed": 0}, "numCommits": 1, "gitStatsSummary": {"insertions": 3, "deletions": 0, "lines": 3, "gitFilesChange": 1}, "spoonStatsSummary": {"TOT": 1, "UPD": 0, "INS": 1, "MOV": 0, "DEL": 0, "spoonFilesChanged": 1, "spoonMethodsChanged": 1}, "statsSkippedReason": "", "changesInPackagesGIT": ["exist-core/src/main/java/org/exist/launcher"], "changesInPackagesSPOON": ["org.exist.launcher.ConfigurationDialog.open(boolean)"]}, {"title": "Webstart is not working", "body": "latest development: jar files are missing in jnlp file\n\n``` xml\n<?xml version=\"1.0\" ?>\n<jnlp spec=\"7.0\" codebase=\"http://localhost:8080/exist/webstart/\" href=\"exist.jnlp\">\n    <information>\n        <title>eXist XML-DB client</title>\n        <vendor>exist-db.org</vendor>\n        <homepage href=\"http://exist-db.org\"/>\n        <description>Integrated command-line and gui client, entirely based on the XML:DB API and provides commands for\n            most database related tasks, like creating and removing collections, user management, batch-loading XML data\n            or querying.</description>\n        <description kind=\"short\">eXist XML-DB client</description>\n        <description kind=\"tooltip\">eXist XML-DB client</description>\n        <icon href=\"jnlp_logo.jpg\"/>\n        <icon href=\"jnlp_icon_128x128.gif\" width=\"128\" height=\"128\"/>\n        <icon href=\"jnlp_icon_64x64.gif\" width=\"64\" height=\"64\"/>\n        <icon href=\"jnlp_icon_32x32.gif\" width=\"32\" height=\"32\"/>\n    </information>\n    <security>\n        <all-permissions/>\n    </security>\n    <resources>\n        <property name=\"jnlp.packEnabled\" value=\"true\"/>\n        <java version=\"1.8+\"/>\n        <jar href=\"exist.jar\" size=\"4570345\"/>\n    </resources>\n    <application-desc main-class=\"org.exist.client.InteractiveClient\">\n        <argument>-ouri=xmldb:exist://localhost:8080/exist/xmlrpc</argument>\n        <argument>--no-embedded-mode</argument>\n    </application-desc>\n</jnlp>\n```\n", "url": "https://github.com/eXist-db/exist/issues/1146", "user": "dizzzz", "labels": ["regression"], "created": "2016-10-17 17:46:00", "closed": "2016-10-29 15:32:05", "commits": {}, "ttf": 11.000277777777777, "commitsDetails": []}, {"title": "Computed variable is lost in FLOWR", "body": "The following query looses the value of `$avg-overall` in the return clause when constructing XML:\n\n``` xquery\nfor $product in collection(\"/db/products\")/Product\nlet $avg-overall := avg($product/Reviews/Review/Overall)\norder by $avg-overall descending\nreturn\n    <x>{$avg-overall}</x>\n```\n\nreturns the **incorrect** result:\n\n``` xml\n<x/>\n<x/>\n```\n\nHowever, the following query demonstrates that `$avg-overall` does have a value:\n\n``` xquery\nfor $product in collection(\"/db/products\")/Product\nlet $avg-overall := avg($product/Reviews/Review/Overall)\norder by $avg-overall descending\nreturn\n    $avg-overall\n```\n\nwhich returns the result:\n\n``` xml\n5\n5\n```\n\nAn example input document looks like:\n\n``` xml\n<Product>\n  <Reviews>\n    <Review>\n       <Overall>5</Overall>\n   </Review>\n  </Reviews>\n</Product>\n```\n\nThe index configuration looks like:\n\n``` xml\n<collection xmlns=\"http://exist-db.org/collection-config/1.0\">\n   <index>\n        <range>\n            <create qname=\"Overall\" type=\"xs:float\"/>\n        </range>\n   </index>\n</collection>\n```\n", "url": "https://github.com/eXist-db/exist/issues/1125", "user": "adamretter", "labels": ["bug", "high prio", "regression"], "created": "2016-09-14 17:32:51", "closed": "2018-03-06 20:08:34", "commits": {}, "ttf": 538.0002777777778, "commitsDetails": []}, {"title": "junit testsuite (still) does not finish", "body": "It is still not possible for me and @ljo to successfully run the junit suite locally.\n\nfor me it stops (=no updates) after the following, with a deadlock:\n\n```\ntest-recovery:\n     [echo] --------------\n     [echo] Recovery tests\n     [echo] --------------\n    [junit] Running org.exist.storage.AllStorageTests\n    [junit] Scanning journal  [=                                                 ] (2 %)\n    [junit] Error found while parsing document: play.dtd: The XML parser reported a problem: fatal error at (5,3) : The markup in the document preceding the root element must be well-formed.\n    [junit] Error found while parsing document: shakes.css: The XML parser reported a problem: fatal error at (1,1) : Content is not allowed in prolog.\n    [junit] Error found while parsing document: play.dtd: The XML parser reported a problem: fatal error at (5,3) : The markup in the document preceding the root element must be well-formed.\n    [junit] Error found while parsing document: shakes.css: The XML parser reported a problem: fatal error at (1,1) : Content is not allowed in prolog.\n```\n\nlatest trunk. macOsX latest, java8u101\n", "url": "https://github.com/eXist-db/exist/issues/1117", "user": "dizzzz", "labels": ["regression"], "created": "2016-09-11 11:04:50", "closed": "2016-09-12 18:45:44", "commits": {}, "ttf": 1.0002777777777778, "commitsDetails": []}, {"title": "XSLTforms demo broken", "body": "Heading for release 3.0: the XSLTforms demo seems to be disfunctional\n", "url": "https://github.com/eXist-db/exist/issues/1072", "user": "dizzzz", "labels": ["regression"], "created": "2016-07-26 06:59:22", "closed": "2019-01-10 11:53:04", "commits": {}, "ttf": 898.0002777777778, "commitsDetails": []}, {"title": "doc() no longer accepts file: protocol", "body": "In the current development code (exist-3.0.RC2-develop, rev. a88848d), the doc() function no longer accepts the `file:` protocol.\n\nFor example, suppose I want to fetch a document that lives at F:/eXist/eXist-git/log4j2.xml, following function call:\n\n```\ndoc('file:///F:/eXist/eXist-git/log4j2.xml')\n```\n\nthrows following error: \n\n```\norg.xmldb.api.base.XMLDBException: err:FODC0005 Illegal char <:> at index 4: file:///F:/eXist/eXist-git/log4j2.xml [at line 1, column 1, source: doc('file:///F:/eXist/eXist-git/log4j2.xml')]\n    at org.exist.xmldb.RemoteXPathQueryService.throwException(RemoteXPathQueryService.java:181)\n    at org.exist.xmldb.RemoteXPathQueryService.query(RemoteXPathQueryService.java:106)\n    at org.exist.xmldb.RemoteXPathQueryService.query(RemoteXPathQueryService.java:73)\n    at org.exist.xmldb.RemoteXPathQueryService.execute(RemoteXPathQueryService.java:441)\n    at org.exist.client.QueryDialog$QueryThread.run(QueryDialog.java:612)\nCaused by: org.exist.xquery.XPathException: exerr:ERROR err:FODC0005 Illegal char <:> at index 4: file:///F:/eXist/eXist-git/log4j2.xml [at line 1, column 1, source: doc('file:///F:/eXist/eXist-git/log4j2.xml')] [at line 1, column 1]\n    at org.exist.xmldb.RemoteXPathQueryService.throwException(RemoteXPathQueryService.java:180)\n    ... 4 more\nCaused by: org.exist.xquery.XPathException: exerr:ERROR err:FODC0005 Illegal char <:> at index 4: file:///F:/eXist/eXist-git/log4j2.xml [at line 1, column 1, source: doc('file:///F:/eXist/eXist-git/log4j2.xml')] [at line 1, column 1]\n    at org.exist.xmldb.RemoteXPathQueryService.throwException(RemoteXPathQueryService.java:180)\n    at org.exist.xmldb.RemoteXPathQueryService.query(RemoteXPathQueryService.java:106)\n    at org.exist.xmldb.RemoteXPathQueryService.query(RemoteXPathQueryService.java:73)\n    at org.exist.xmldb.RemoteXPathQueryService.execute(RemoteXPathQueryService.java:441)\n    at org.exist.client.QueryDialog$QueryThread.run(QueryDialog.java:612)\n```\n\nThere's nothing wrong with the URL, nor the file. This still worked in eXist-3.0.RC1 (rev. e34eb95). Also, the `http:` protocol still works (e.g. `doc('http://exist-db.org/exist/apps/homepage/index.html')`).\n", "url": "https://github.com/eXist-db/exist/issues/1041", "user": "rvdb", "labels": ["regression"], "created": "2016-06-08 20:17:24", "closed": "2017-01-12 18:37:56", "commits": {}, "ttf": 217.00027777777777, "commitsDetails": []}, {"title": "suggestion to fix logging with log4j2 in \"WAR deployment context\"", "body": "The switch from log4j to log4j2 in eXist-3.0.RC1 has broken logging when eXist is deployed as a WAR file in Tomcat. More precisely, no log files are written at all.\n\nI've figured out what needs to be done for fixing this:\n- log4j-web.jar should be added to %EXIST_HOME%/lib/core (see the [log4j2 documentation](https://logging.apache.org/log4j/2.x/manual/webapp.html))\n- in the log4j2.xml file that is generated under %EXIST_HOME%/webapp/WEB-INF/log4j2.xml, the path to the log directory should be modified in following way: \n\n&#160;\n\n```\n<Property name=\"logs\">${log4j:configParentLocation}/webapp/WEB-INF/logs</Property>\n```\n\nshould be changed to:\n\n```\n<Property name=\"logs\">${web:rootDir}/WEB-INF/logs</Property>\n```\n\nIn any case, the original `${log4j:configParentLocation}/webapp/WEB-INF/logs` setting (necessary for 'standalone' deployment of eXist) can't be used, since in a \"WAR deployment context\", log4j2.xml will be located inside WEB-INF already. I originally tried with `${log4j:configParentLocation}/logs`, but that didn't work (see below); that's why I ended up with the `${web:rootDir}` lookup.\n\nSearching for a working directory lookup inside log4j2.xml, I noticed how the `${log4j:configParentLocation}` lookup didn't work when deployed in Tomcat, resulting in errors like:\n\n```\nERROR Cannot acces RandomAccessFile java.io.FileNotFoundException: jndi:\\localhost\\exist-3.0.RC2\\WEB-INF\\logs\\expath-repo.log \nERROR Unable to invoke factory method in class class org.apache.logging.log4j.core.appender.RollingRandomAccessFileAppender for element RollingRandomAccessFile. java.lang.reflect.InvocationTargetException\nCaused by: java.lang.IllegalStateException: ManagerFactory [org.apache.logging.log4j.core.appender.rolling.RollingRandomAccessFileManager$RollingRandomAccessFileManagerFactory$FactoryData]\n```\n\nEven when I built eXist with the JNDI extension enabled, this didn't change these errors. I don't know if this means that something should be changed to the log4j2 configuration if it wants to work with JNDI. I gave up when I noticed how `${web:rootDir}` is resolved correctly in a \"WAR deployment context\".\n", "url": "https://github.com/eXist-db/exist/issues/1040", "user": "rvdb", "labels": ["regression"], "created": "2016-06-08 14:43:22", "closed": "2016-08-11 12:19:43", "commits": {}, "ttf": 63.000277777777775, "commitsDetails": []}, {"title": "Performance regression: new log4j2' LogManager.getLogger slows doen queries", "body": "As reported by @wolfgangmm in HipChat:\n\nSince the update of log4j, `LogManager.getLogger()` is consuming an amazing amount of time, up to 98% for some queries.\n\nIt's the same effect on two different instances. log4j configuration unchanged.\n\nConfirmation: going back to the previous version removes the bottleneck.\n", "url": "https://github.com/eXist-db/exist/issues/1036", "user": "dizzzz", "labels": ["regression"], "created": "2016-06-02 19:25:13", "closed": "2016-06-10 15:59:49", "commits": {}, "ttf": 7.000277777777778, "commitsDetails": []}, {"title": "JnlpWriter has a dependency on an optional module", "body": "`org.exist.webstart.JnlpWriter` in exist-optional has a dependency on a library (`milton-api-1.8.3.jar`) provided by the optional WebDav module. Without enabling the WebDAV module this now makes it impossible to compile eXist correctly.\n", "url": "https://github.com/eXist-db/exist/issues/717", "user": "adamretter", "labels": ["regression"], "created": "2015-07-04 15:53:05", "closed": "2015-07-05 12:30:10", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "Binary-Files in older Versions are missing", "body": "We are using eXist 2.0 for our Plattform.\nSo we have to build eXist very often while developing.\nSince Friday we are no longer able to build eXist (2.0 and 2.2).\n\nAfter some Investigations, we saw that git removes some binaries and java-files, while cloning\ne.g. eXist/tools/ant, eXist/lib/\\* etc. etc. ! The Files are renamed to %Name +\"REMOVED.git-id\".\n\nAre you able to disable this git-\"feature\"?\n\nBest Regards\nStephan\n", "url": "https://github.com/eXist-db/exist/issues/712", "user": "StephanMa", "labels": ["high prio", "regression"], "created": "2015-06-30 13:35:18", "closed": "2015-07-03 13:15:47", "commits": {}, "ttf": 2.000277777777778, "commitsDetails": []}, {"title": "Update webstart to use rsyntaxtextarea.jar", "body": "on its way...\n", "url": "https://github.com/eXist-db/exist/issues/614", "user": "dizzzz", "labels": ["regression"], "created": "2015-04-29 12:57:39", "closed": "2015-04-29 20:26:42", "commits": {}, "ttf": 0.0002777777777777778, "commitsDetails": []}, {"title": "bin/shutdown.sh not shuting down", "body": "In fact it appears to be doing nothing at all. I have to manually kill the thread. I've tried this on the most recent commit a277568192 and also the one from earlier today on two different machines. Both linux, one debain 7 and the other archlinux. Both with java 8. It was working fine the last few times I've updated. \n\n More information available upon request. \n", "url": "https://github.com/eXist-db/exist/issues/602", "user": "mgr34", "labels": ["bug", "regression"], "created": "2015-04-14 19:38:17", "closed": "2015-05-31 14:47:28", "commits": {}, "ttf": 46.000277777777775, "commitsDetails": []}, {"title": "Windows/shutdown FATAL message (develop)", "body": "Question: is the FATAL below a problem? (WIn7, Java8, develop)\n\nreproduce:\n- run `bin\\startup.sh`\n- open `dashboard`, open e.g. `eXide` (essential!)\n- press `control-c`\n\nmessage:\n\n```\n19 Mar 2015 12:43:53,031 [Thread-4] INFO  (JettyStart.java [lifeCycleStopping]:433) - Jetty server stopping...\n2015-03-19 12:43:54,201 FATAL Unable to register shutdown hook because JVM is shutting down.\nTerminate batch job (Y/N)? y\n```\n", "url": "https://github.com/eXist-db/exist/issues/534", "user": "dizzzz", "labels": ["bug", "high prio", "investigate", "regression"], "created": "2015-03-19 11:46:39", "closed": "2015-06-08 18:56:48", "commits": {}, "ttf": 81.00027777777778, "commitsDetails": []}, {"title": "NPE when running util:serialize with doctype parameters", "body": "I'm trying to serialize DITA topic to string with DOCTYPE's added. So the following code block is used:\n\n```\nlet $serialization-params := \n(\n    \"doctype-public=-//D//DTD P-Topic//EN\", \n    \"doctype-system=http://domain.com/xmetal/schemas/p-topic.dtd\"\n)\nlet $topic-string := util:serialize($topic-document, $serialization-params)\n```\n\nIt fails with the following NPE:\n\n```\nCaused by: java.lang.NullPointerException\n    at org.exist.xquery.functions.util.Serialize.parseSerializationOptions(Serialize.java:194)\n    at org.exist.xquery.functions.util.Serialize.eval(Serialize.java:156)\n    at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)\n    at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:55)\n    at org.exist.xquery.LetExpr.eval(LetExpr.java:142)\n```\n\nAccording to the code, it splits the string using space character as a delimiter. It looks like the same code is used to parse the serialization parameters that can be provided in `declare option exist:serialize` statement. However, in case of util:serialize the parameters format is different and I believe the space should not be considered as a delimiter.\n\nI've tried to replace the space with the non-breaking space code `&#160;` This technique works well in `declare option exist:serialize` statement, however, with util:serialize it leads to another error:\n\n```\nexerr:ERROR XMLDB reported an exception while storing documentorg.xmldb.api.base.XMLDBException: The XML parser reported a problem: fatal error at (2,39) : An invalid XML character (Unicode: 0xa0) was found in the public identifier. [at line 57, column 22]\n```\n\nNot sure if it makes more sense to allow using space or `&#160;` or both but at least one of those ways should be working. Any considerations? It would be nice to fix it before 2.2 final release. I'm willing to help fixing but I'd like to hear developers' opinion on this.\n", "url": "https://github.com/eXist-db/exist/issues/200", "user": "lagivan", "labels": ["bug", "regression"], "created": "2014-04-18 18:07:30", "closed": "2019-03-10 18:23:03", "commits": {}, "ttf": 1787.0002777777777, "commitsDetails": []}]}