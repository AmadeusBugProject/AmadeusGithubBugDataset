{"bugLabels": ["type/bug"], "captureTime": "Fri Jul  3 21:31:15 2020", "issues": [{"created": "2020-04-12 22:45:32", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BookieInitializationTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest.bookieConnectAfterCookieDeleteWorker(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.discover.RegistrationManager)"}, {"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest.testBookieStartException()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest.testBookieConnectAfterCookieDelete()"}]}, {"spoonFilePath": "Bookie.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.checkEnvironmentWithStorageExpansion(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.MetadataBookieDriver,java.util.List,java.util.List)"}]}], "nameRev": "a7ca7cff615391d1267f3546735e18b3306eb1e4 remotes/origin/branch-4.11~23", "commitHash": "a7ca7cff615391d1267f3546735e18b3306eb1e4", "commitMessage": "Issue #2305: Bookies should not be allowed to come up without a cookie in metadata store.\n\n### Motivation\r\nCurrently we allow bookies to come up even if they don't have a cookie in the metadata store.\r\nThe cookie is an identity of a registered bookie and a bookie should not be allowed to come up without it.\r\n\r\n### Changes\r\nUpdate handling of bookie boot up. Add test.\r\nThis scenario is rarely expected but can happen in case of corruption or errant deletion of znodes for cookies\r\n\n\nReviewers: Matteo Minardi <minardi.matteo@hotmail.it>, Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <None>\n\nThis closes #2306 from Ghatage/disableBootup-Wo-Cookie, closes #2305", "commitGitStats": [{"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java"}, {"lines": 69, "deletions": 0, "insertions": 69, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieInitializationTest.java"}], "commitParents": ["f373cb5976ebca41ae036a26ba69f1c341897c08"], "commitDateTime": "2020-05-18 22:57:56", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-05-18 22:57:56"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["triage/week-16", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Bookies come up without a cookie in metadata store", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\n\r\nBookies are allowed tot boot up even if they don't have a cookie in the metadata store.\r\n\r\n***To Reproduce***\r\n\r\nSteps to reproduce the behavior in jUnit:\r\n1. Boot up a bookie\r\n2. Delete it's cookie from metadata store\r\n3. Restart bookie\r\n4. Bookie comes back up even without a cookie\r\n5. This is a problem because any following operations on cookies will result in `InvalidCookieException`\r\n\r\n***Expected behavior***\r\n\r\nIf for some reason, the bookie does not have a cookie in metadata store it should not be allowed to come up because the cookies are out of sync.\r\n\r\n***Additional context***\r\n\r\nSee slack conversation [here](https://apachebookkeeper.slack.com/archives/C6G5104SF/p1582304160015200).\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"a7ca7cff615391d1267f3546735e18b3306eb1e4": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2020-05-19 05:57:58", "url": "https://github.com/apache/bookkeeper/issues/2305", "user": "Ghatage", "ttf": 36.000277777777775}, {"created": "2020-03-18 18:18:36", "closed": "2020-03-27 10:20:32", "title": "BookKeeper is not compatible with ZookKeeper 3.6.0", "url": "https://github.com/apache/bookkeeper/issues/2292", "body": "in ZKRegistrationManager  we are using the Utility function  org.apache.zookeeper.ZKUtil.deleteRecursive that has been changed in 3.6.0.\r\n\r\n***To Reproduce***\r\nUse ZooKeeper 3.6.0 in a project that is also using BookKeeper 4.10.0\r\n(like https://github.com/diennea/herddb/pull/581) \r\n\r\nBookKeeperAdmin won't be able to work.\r\n\r\n```\r\njava.lang.NoSuchMethodError: org.apache.zookeeper.ZKUtil.deleteRecursive(Lorg/apache/zookeeper/ZooKeeper;Ljava/lang/String;)V\r\n\tat org.apache.bookkeeper.discover.ZKRegistrationManager.format(ZKRegistrationManager.java:513)\r\n\tat org.apache.bookkeeper.client.BookKeeperAdmin.lambda$format$3(BookKeeperAdmin.java:1194)\r\n\tat org.apache.bookkeeper.meta.MetadataDrivers.runFunctionWithMetadataBookieDriver(MetadataDrivers.java:370)\r\n\tat org.apache.bookkeeper.client.BookKeeperAdmin.format(BookKeeperAdmin.java:1167)\r\n\r\n```\r\n***Expected behavior***\r\nBookKeeperAdmin should be able to \"format\" the cluster\r\n\r\n", "commits": {}, "user": "eolivelli", "commitsDetails": [], "labels": ["type/bug"], "ttf": 8.000277777777777}, {"created": "2020-03-05 11:38:06", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BookieShell.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.ReadJournalCmd"}]}], "nameRev": "7662819ebb1c7cfdf81165d5301bd47344edc6db remotes/origin/branch-4.10~6", "commitHash": "7662819ebb1c7cfdf81165d5301bd47344edc6db", "commitMessage": "2279 fix NPE when exec readjournal command\n\nDescriptions of the changes in this PR:\r\nThis PR fix NullPointerException when exec readjournal command\r\nSee issue #2279 \r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <None>\n\nThis closes #2280 from aloyszhang/read-jounral\n\n(cherry picked from commit bd3d3b5473f1b8d90d681d03a128c9332c80425d)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieShell.java"}], "commitParents": ["6abe13cc4dba1c8c7b9c1a1bf20e1ebdf5cb54a4"], "commitDateTime": "2020-03-18 16:52:05", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-03-19 07:51:46"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "BookieShell.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.ReadJournalCmd"}]}], "nameRev": "bd3d3b5473f1b8d90d681d03a128c9332c80425d remotes/origin/branch-4.11~48", "commitHash": "bd3d3b5473f1b8d90d681d03a128c9332c80425d", "commitMessage": "2279 fix NPE when exec readjournal command\n\nDescriptions of the changes in this PR:\r\nThis PR fix NullPointerException when exec readjournal command\r\nSee issue #2279 \r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <None>\n\nThis closes #2280 from aloyszhang/read-jounral", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieShell.java"}], "commitParents": ["ec3ade0a255d94e8329e9eb3b69ec9c2ed59e6e4"], "commitDateTime": "2020-03-18 16:51:46", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-03-19 07:51:46"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "NullPointerException when execute `bin/bookkeeper shell readjournal`", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\nRun\r\n`./bin/bookkeeper shell readjournal -msg /data1/bookkeeper/journal/current/1709f92d291.txn   -dir /data1/bookkeeper/journal`\r\n\r\nIt throws exception\r\n```\r\nException in thread \"main\" java.lang.NullPointerException\r\n        at org.apache.bookkeeper.tools.cli.commands.bookie.ReadJournalCommand.handler(ReadJournalCommand.java:127)\r\n        at org.apache.bookkeeper.tools.cli.commands.bookie.ReadJournalCommand.apply(ReadJournalCommand.java:105)\r\n        at org.apache.bookkeeper.bookie.BookieShell$ReadJournalCmd.runCmd(BookieShell.java:1046)\r\n        at org.apache.bookkeeper.bookie.BookieShell$MyCommand.runCmd(BookieShell.java:223)\r\n        at org.apache.bookkeeper.bookie.BookieShell.run(BookieShell.java:1976)\r\n        at org.apache.bookkeeper.bookie.BookieShell.main(BookieShell.java:2067)\r\n```\r\nI found when  `ReadJournalCmd` initialized,  the \"dir \" `Option`  added with `hasArg` flag is false. So, we can't get the option's value of \u201ddir\u201c from shell command parameters.\r\nHere is the related code\r\n   ```\r\nReadJournalCmd() {\r\n            super(CMD_READJOURNAL);\r\n            rjOpts.addOption(\"dir\", false, \"Journal directory (needed if more than one journal configured)\");\r\n            rjOpts.addOption(\"m\", \"msg\", false, \"Print message body\");\r\n        }\r\n```\r\n\r\n```\r\nReadJournalCommand.ReadJournalFlags flags = new ReadJournalCommand.ReadJournalFlags().msg(printMsg)\r\n                                                            .fileName(filename).journalId(journalId)\r\n                                                            .dir(cmdLine.getOptionValue(\"dir\"));\r\n```\r\n\r\nI think set the `hasArg`  to true will resolve this problem.\r\n\r\n***To Reproduce***\r\nJust run `bin/bookkeeper shell readjournal ` ", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"7662819ebb1c7cfdf81165d5301bd47344edc6db": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "bd3d3b5473f1b8d90d681d03a128c9332c80425d": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2020-04-09 22:02:21", "url": "https://github.com/apache/bookkeeper/issues/2279", "user": "aloyszhang", "ttf": 35.000277777777775}, {"created": "2020-02-25 03:41:56", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "AbstractZkLedgerManager.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManager.isLeadgerIdGeneratorZnode(java.lang.String)"}, {"INS": 1, "DEL": 1, "TOT": 6, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManager.isSpecialZnode(java.lang.String)"}]}, {"spoonFilePath": "AbstractZkLedgerManagerFactory.java", "spoonMethods": [{"INS": 3, "DEL": 2, "TOT": 8, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManagerFactory.format(org.apache.bookkeeper.conf.AbstractConfiguration,org.apache.bookkeeper.meta.LayoutManager)"}]}, {"spoonFilePath": "BookKeeperAdminTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.BookKeeperAdminTest.testBookkeeperAdminFormatResetsLedgerIds()"}]}], "nameRev": "76286bc5505e4ba1cfeb47ce30bbe627d53f4869 remotes/origin/branch-4.11~38", "commitHash": "76286bc5505e4ba1cfeb47ce30bbe627d53f4869", "commitMessage": "ISSUE #2274: The 'metaformat' command does not delete 'idgen' znode\n\nDescriptions of the changes in this PR:\r\n\r\n### Motivation\r\n\r\nAfter `metaformat`, ledgerId does not count from 0 because\uff0cthe `metaformat` command does not delete `idgen` znode.\r\n\r\n### Changes\r\n\r\nIn the `AbstractZkLedgerManagerFactory` avoid skipping the igen and idgen-long nodes\r\n\r\nMaster Issue: #2274\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <None>\n\nThis closes #2315 from mino181295/leadger-metaformat, closes #2274", "commitGitStats": [{"lines": 7, "deletions": 1, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/AbstractZkLedgerManagerFactory.java"}, {"lines": 38, "deletions": 0, "insertions": 38, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookKeeperAdminTest.java"}, {"lines": 6, "deletions": 1, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/AbstractZkLedgerManager.java"}], "commitParents": ["f1077a6fa48553d7d8b1cf164e2e5a4f37125204"], "commitDateTime": "2020-04-21 13:21:28", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-04-21 22:21:28"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "AbstractZkLedgerManager.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManager.isLeadgerIdGeneratorZnode(java.lang.String)"}, {"INS": 1, "DEL": 1, "TOT": 6, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManager.isSpecialZnode(java.lang.String)"}]}, {"spoonFilePath": "AbstractZkLedgerManagerFactory.java", "spoonMethods": [{"INS": 3, "DEL": 2, "TOT": 8, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManagerFactory.format(org.apache.bookkeeper.conf.AbstractConfiguration,org.apache.bookkeeper.meta.LayoutManager)"}]}, {"spoonFilePath": "BookKeeperAdminTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.BookKeeperAdminTest.testBookkeeperAdminFormatResetsLedgerIds()"}]}], "nameRev": "f0d27f7c3376f1160d3b5a39f8cae8670cb07159 remotes/origin/branch-4.10~3", "commitHash": "f0d27f7c3376f1160d3b5a39f8cae8670cb07159", "commitMessage": "ISSUE #2274: The 'metaformat' command does not delete 'idgen' znode\n\nDescriptions of the changes in this PR:\r\n\r\n### Motivation\r\n\r\nAfter `metaformat`, ledgerId does not count from 0 because\uff0cthe `metaformat` command does not delete `idgen` znode.\r\n\r\n### Changes\r\n\r\nIn the `AbstractZkLedgerManagerFactory` avoid skipping the igen and idgen-long nodes\r\n\r\nMaster Issue: #2274\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <None>\n\nThis closes #2315 from mino181295/leadger-metaformat, closes #2274\n\n(cherry picked from commit 76286bc5505e4ba1cfeb47ce30bbe627d53f4869)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 7, "deletions": 1, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/AbstractZkLedgerManagerFactory.java"}, {"lines": 38, "deletions": 0, "insertions": 38, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookKeeperAdminTest.java"}, {"lines": 6, "deletions": 1, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/AbstractZkLedgerManager.java"}], "commitParents": ["6fab0884dee19f1c5ac8befe13d176e70a3895f7"], "commitDateTime": "2020-04-21 13:21:44", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-04-21 22:21:28"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tools", "release/4.10.1", "release/4.11.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "The `metaformat` command does not delete `idgen` znode", "numCommits": 0, "body": "**BUG REPORT**\r\nAfter `metaformat`, ledgerId does not count from 0\r\n\r\n***To Reproduce***\r\n\r\nSteps to reproduce the behavior:\r\n1. create some ledgers\r\n2. bin/bookkeeper shell metaformat\r\n3. bin/bookkeeper shell simpletest\r\n4. See error: The new ledgerid does not start at 0\r\n\r\n***Expected behavior***\r\n`metaformat`  deleted the ledger, and should have deleted ledgerid's records as well\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"76286bc5505e4ba1cfeb47ce30bbe627d53f4869": {"commitUser": "sijie", "commitGHEventType": "closed"}, "f0d27f7c3376f1160d3b5a39f8cae8670cb07159": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2020-04-21 20:21:31", "url": "https://github.com/apache/bookkeeper/issues/2274", "user": "SunDapeng1", "ttf": 56.000277777777775}, {"created": "2020-02-01 13:39:28", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "TestEntryLog.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestEntryLog"}]}], "nameRev": "761e42c608689dc595f019a2ac6a92fa1e0d30c7 remotes/origin/dependabot/bundler/site/nokogiri-1.10.8~6", "commitHash": "761e42c608689dc595f019a2ac6a92fa1e0d30c7", "commitMessage": "Fix method order in order to make the execution of TestEntryLog predictable\n\n### Motivation\r\n\r\nTestEntyLog reuses the entryLogger variable across test methods execution, resulting in an unpredictable execution.\r\nWe can at least make the test work consistently across environments using JUnit built-in FixMethodOrder annotation\r\n\r\n### Changes\r\nFixMethodOrder(MethodSorters.NAME_ASCENDING)\r\n\r\nFixes #2260\r\n\n\nReviewers: Atri Sharma <atri@apache.org>\n\nThis closes #2266 from eolivelli/fix/flaky", "commitGitStats": [{"lines": 3, "deletions": 0, "insertions": 3, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/TestEntryLog.java"}], "commitParents": ["3ae3ad445b9d22b0a6c8b82f8da383955f4d6a4d"], "commitDateTime": "2020-02-17 09:12:37", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-02-17 09:12:37"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "org.apache.bookkeeper.bookie.TestEntryLog is very flaky (expecially on GitHub Actions machines)", "numCommits": 0, "body": "org.apache.bookkeeper.bookie.TestEntryLog test fails very often on GitHub actions, this is very annoying for contributors\r\n\r\n```\r\nERROR] Tests run: 28, Failures: 3, Errors: 0, Skipped: 0, Time elapsed: 10.731 s <<< FAILURE! - in org.apache.bookkeeper.bookie.TestEntryLog\r\n[ERROR] testGetEntryLogsSet(org.apache.bookkeeper.bookie.TestEntryLog)  Time elapsed: 0.033 s  <<< FAILURE!\r\njava.lang.AssertionError: expected:<[0, 1]> but was:<[0]>\r\n\tat org.apache.bookkeeper.bookie.TestEntryLog.testGetEntryLogsSet(TestEntryLog.java:442)\r\n\r\n[ERROR] testGetEntryLogsSet(org.apache.bookkeeper.bookie.TestEntryLog)  Time elapsed: 0.003 s  <<< FAILURE!\r\njava.lang.AssertionError: expected:<[0, 1]> but was:<[0]>\r\n\tat org.apache.bookkeeper.bookie.TestEntryLog.testGetEntryLogsSet(TestEntryLog.java:442)\r\n\r\n[ERROR] testGetEntryLogsSet(org.apache.bookkeeper.bookie.TestEntryLog)  Time elapsed: 0.003 s  <<< FAILURE!\r\njava.lang.AssertionError: expected:<[0, 1]> but was:<[0]>\r\n\tat org.apache.bookkeeper.bookie.TestEntryLog.testGetEntryLogsSet(TestEntryLog.java:442)\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"761e42c608689dc595f019a2ac6a92fa1e0d30c7": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}}, "closed": "2020-02-17 08:12:37", "url": "https://github.com/apache/bookkeeper/issues/2260", "user": "eolivelli", "ttf": 15.000277777777777}, {"created": "2020-01-21 06:45:54", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "e37f3aa03ad4d1ad1e5ded2ffceac3e844e6f46e remotes/origin/dependabot/bundler/site/nokogiri-1.10.8~12", "commitHash": "e37f3aa03ad4d1ad1e5ded2ffceac3e844e6f46e", "commitMessage": "Website: update Gemfile dependencies\n\nUpdating Gemfile dependencies to try fix Travis (see https://github.com/apache/bookkeeper/issues/2252)\r\n\r\nAlso fixing https://www.cvedetails.com/cve/CVE-2018-17567/ in the meantime\r\n\r\nYou can find the staging website  https://aluccaroni.github.io/bookkeeper-staging-site\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <None>\n\nThis closes #2256 from aluccaroni/master", "commitGitStats": [{"lines": 8, "deletions": 4, "insertions": 4, "filePath": "site/Gemfile"}, {"lines": 66, "deletions": 34, "insertions": 32, "filePath": "site/Gemfile.lock"}, {"lines": 1, "deletions": 0, "insertions": 1, "filePath": "site/Makefile"}], "commitParents": ["2836241fbdbe2c8b31718f2374f6fbe50645a2b7"], "commitDateTime": "2020-01-30 20:02:14", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-01-31 05:02:14"}], "gitStatsSummary": {"lines": 75, "gitFilesChange": 3, "deletions": 38, "insertions": 37}, "statsSkippedReason": "", "labels": ["area/website", "triage/week-4", "type/bug"], "filteredCommits": ["e37f3aa03ad4d1ad1e5ded2ffceac3e844e6f46e"], "changesInPackagesGIT": ["site/Gemfile", "site/Gemfile.lock", "site/Makefile"], "title": "Travis fails on changes about the Website", "numCommits": 1, "body": "Travis builds are failing due to some error on \"Bundler\".\r\n\r\n```\r\n\r\nWarning: the lockfile is being updated to Bundler 2, after which you will be unable to return to Bundler 1.\r\n\r\nBundle complete! 3 Gemfile dependencies, 29 gems now installed.\r\n\r\nBundled gems are installed into `./vendor/bundle`\r\n\r\nrm -rf _site local-generated generated_site\r\n\r\nJEKYLL_ENV=production bundle exec jekyll build \\\r\n\r\n\t--config _config.yml,_config.apache.yml\r\n\r\nBundler::LockfileError: You must use Bundler 2 or greater with this lockfile.\r\n\r\n  /usr/local/lib/ruby/gems/2.4.0/gems/bundler-1.15.4/lib/bundler/lockfile_parser.rb:108:in `warn_for_outdated_bundler_version'\r\n\r\n  /usr/local/lib/ruby/gems/2.4.0/gems/bundler-1.15.4/lib/bundler/lockfile_parser.rb:95:in `initialize'\r\n\r\n  /usr/local/lib/ruby/gems/2.4.0/gems/bundler-1.15.4/lib/bundler/definition.rb:72:in `new'\r\n\r\n  /usr/local/lib/ruby/gems/2.4.0/gems/bundler-1.15.4/lib/bundler/definition.rb:72:in `initialize'\r\n\r\n  /usr/local/lib/ruby/gems/2.4.0/gems/bundler-1.15.4/lib/bundler/dsl.rb:200:in `new'\r\n\r\n  /usr/local/lib/ruby/gems/2.4.0/gems/bundler-1.15.4/lib/bundler/dsl.rb:200:in `to_definition'\r\n\r\n  /usr/local/lib/ruby/gems/2.4.0/gems/bundler-1.15.4/lib/bundler/dsl.rb:12:in `evaluate'\r\n\r\n  /usr/local/lib/ruby/gems/2.4.0/gems/bundler-1.15.4/lib/bundler/definition.rb:33:in `build'\r\n\r\n  /usr/local/lib/ruby/gems/2.4.0/gems/bundler-1.15.4/lib/bundler.rb:129:in `definition'\r\n\r\n  /usr/local/lib/ruby/gems/2.4.0/gems/bundler-1.15.4/lib/bundler.rb:95:in `setup'\r\n\r\n  /usr/local/lib/ruby/gems/2.4.0/gems/bundler-1.15.4/lib/bundler/setup.rb:19:in `<top (required)>'\r\n\r\n  /usr/local/lib/ruby/site_ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\r\n  /usr/local/lib/ruby/site_ruby/2.4.0/rubygems/core_ext/kernel_require.rb:55:in `require'\r\n\r\nbundler: failed to load command: jekyll (/home/travis/build/apache/bookkeeper/site/vendor/bundle/ruby/2.4.0/bin/jekyll)\r\n\r\nmake: *** [apache] Error 1\r\n\r\nMakefile:24: recipe for target 'apache' failed\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 0, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"e37f3aa03ad4d1ad1e5ded2ffceac3e844e6f46e": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2020-02-01 13:38:19", "url": "https://github.com/apache/bookkeeper/issues/2252", "user": "eolivelli", "ttf": 11.000277777777777}, {"created": "2020-01-16 10:23:40", "closed": "2020-01-16 13:56:15", "title": "Subscription metrics name error", "url": "https://github.com/apache/bookkeeper/issues/2247", "body": "The metric name of the document is `pulse_subscription_unacked_messages` but Prometheus print is `pulsar_subscription_unacked_massages`  ,  word `messages` spelling mistakes\r\n", "commits": {}, "user": "yangwenjie88", "commitsDetails": [], "labels": ["type/bug"], "ttf": 0.0002777777777777778}, {"created": "2019-12-31 03:48:19", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "SingleDirectoryDbLedgerStorage.java", "spoonMethods": [{"INS": 2, "DEL": 1, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.storage.ldb.SingleDirectoryDbLedgerStorage.fillReadAheadCache(long,long,long)"}]}], "nameRev": "45871dccbb72a5aee30f7bbfaacfa0d6c2c202a5 remotes/origin/branch-4.11~40", "commitHash": "45871dccbb72a5aee30f7bbfaacfa0d6c2c202a5", "commitMessage": "Fix batch read data in cache does not take effect\n\nDescriptions of the changes in this PR:\r\n\r\n\r\n\r\n### Motivation\r\n\r\nFix batch read data in cache does not take effect\r\n\r\n### Changes\r\n\r\n(Describe: what changes you have made)\r\n\r\nMaster Issue: #2230 \r\nFixes: #2230 \r\n\r\n\r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <None>\n\nThis closes #2231 from liudezhi2098/issue-branch-xxx", "commitGitStats": [{"lines": 3, "deletions": 1, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/storage/ldb/SingleDirectoryDbLedgerStorage.java"}], "commitParents": ["e7430ce25e3609bf77b028e4f0475dad2147c22d"], "commitDateTime": "2020-04-13 09:26:07", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-04-13 15:26:07"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["triage/week-4", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "bookie reads messages in batches very slowly, it takes about 300 milliseconds to read 100", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\n\r\nbookie reads messages in batches very slowly, it takes about 300 milliseconds to read 100\r\n\r\n- SingleDirectoryDbLedgerStorage\r\n\r\n\r\n            while (count < readAheadCacheBatchSize && currentEntryLogId == firstEntryLogId) {\r\n                ByteBuf entry = entryLogger.internalReadEntry(orginalLedgerId, -1, currentEntryLocation,\r\n                        false /* validateEntry */);\r\n\r\n\r\n- EntryLogger\r\n\r\n        long thisLedgerId = sizeBuff.getLong(4);\r\n        long thisEntryId = sizeBuff.getLong(12);\r\n        if (thisLedgerId != ledgerId || thisEntryId != entryId) {\r\n            throw new EntryLookupException.WrongEntryException(\r\n                    thisEntryId, thisLedgerId, ledgerId, entryId, entryLogId, pos);\r\n        }\r\n\r\nbecause entryId = -1, an exception must be thrown here", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"45871dccbb72a5aee30f7bbfaacfa0d6c2c202a5": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}}, "closed": "2020-04-13 07:26:08", "url": "https://github.com/apache/bookkeeper/issues/2230", "user": "liudezhi2098", "ttf": 104.00027777777778}, {"created": "2019-12-28 13:36:12", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "2ff7ca5af53f59f2ba11391292016554ace35720 remotes/origin/dependabot/bundler/site/nokogiri-1.10.8~26", "commitHash": "2ff7ca5af53f59f2ba11391292016554ace35720", "commitMessage": "Account Apache Thrift and Http Client files in LICENSE files - Fix build on Travis\n\nfixes #2227\r\n\r\nDescriptions of the changes in this PR:\r\n- Account Thrift and Http client in LICENSE files.\r\n- Force using Maven 3.6.3 in MacOSx builds on Travis\r\n- Test only with -Dstream profile\r\n\r\n\r\n### Motivation\r\n\r\nThose files are inside the binary packages but they are not taken into account in LICENSE file.\r\nTravis started to report errors when Travis updated Maven version to 3.6.2 in Linux machines, MaxOSx machines are still with 3.3.9 and the build does not bundle all of the needed jars ! \r\n\r\nMaster Issue: #2227 \r\n\r\n\r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <None>\n\nThis closes #2228 from eolivelli/fix/license-files", "commitGitStats": [{"lines": 14, "deletions": 8, "insertions": 6, "filePath": ".travis.yml"}, {"lines": 34, "deletions": 19, "insertions": 15, "filePath": ".travis_scripts/build.sh"}, {"lines": 7, "deletions": 1, "insertions": 6, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-all.bin.txt"}, {"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-bkctl.bin.txt"}, {"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-server.bin.txt"}], "commitParents": ["2bbf58e0168df000db1712a84acaecf61d00c347"], "commitDateTime": "2020-01-04 14:10:31", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-01-04 14:10:31"}, {"commitSpoonAstDiffStats": [], "nameRev": "320248fceb471a124600ea8b4111793816f53c63 remotes/origin/branch-4.10~12", "commitHash": "320248fceb471a124600ea8b4111793816f53c63", "commitMessage": "Account Apache Thrift and Http Client files in LICENSE files - Fix build on Travis\n\nfixes #2227\r\n\r\nDescriptions of the changes in this PR:\r\n- Account Thrift and Http client in LICENSE files.\r\n- Force using Maven 3.6.3 in MacOSx builds on Travis\r\n- Test only with -Dstream profile\r\n\r\n\r\n### Motivation\r\n\r\nThose files are inside the binary packages but they are not taken into account in LICENSE file.\r\nTravis started to report errors when Travis updated Maven version to 3.6.2 in Linux machines, MaxOSx machines are still with 3.3.9 and the build does not bundle all of the needed jars ! \r\n\r\nMaster Issue: #2227 \r\n\r\n\r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <None>\n\nThis closes #2228 from eolivelli/fix/license-files", "commitGitStats": [{"lines": 14, "deletions": 8, "insertions": 6, "filePath": ".travis.yml"}, {"lines": 34, "deletions": 19, "insertions": 15, "filePath": ".travis_scripts/build.sh"}, {"lines": 7, "deletions": 1, "insertions": 6, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-all.bin.txt"}, {"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-bkctl.bin.txt"}, {"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-server.bin.txt"}], "commitParents": ["c8539c3fa5029a2eb72362b842c142043c1436e5"], "commitDateTime": "2020-01-04 14:11:46", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-01-04 14:10:31"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Travis is failing with an error about LICENSE files", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\nCI Travis jobs fail due to a validation error reported by check-binary-license script.\r\nThe error is on current master and on 4.10 branch\r\n\r\n```\r\norg.apache.httpcomponents-httpclient-4.4.1.jar unaccounted for in LICENSE\r\norg.apache.httpcomponents-httpcore-4.4.1.jar unaccounted for in LICENSE\r\norg.apache.thrift-libthrift-0.9.3.jar unaccounted for in LICENSE\r\n\r\n```\r\nA clear and concise description of what the bug is.\r\n\r\n***To Reproduce***\r\n\r\nJust run this script from the command line (it will build BookKeeper and perform the license checj)\r\n.travis_scripts/build.sh\r\n\r\n***Expected behavior***\r\n\r\nNo error is reported\r\n\r\n***Additional context***\r\n\r\nThose files are needed by distributed-core module and they seem to be needed in order to make the Stream Storage service to run (it is using DistributedLog).\r\n\r\nI can reproduce the problem locally and consistently and the reported error seems real.\r\nMaybe Travis started to fail after an upgrade of Maven ? \r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"2ff7ca5af53f59f2ba11391292016554ace35720": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}, "320248fceb471a124600ea8b4111793816f53c63": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}}, "closed": "2020-01-04 13:10:32", "url": "https://github.com/apache/bookkeeper/issues/2227", "user": "eolivelli", "ttf": 6.000277777777778}, {"created": "2019-12-27 07:34:32", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "GarbageCollectorThreadTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.GarbageCollectorThreadTest"}]}], "nameRev": "eba63dbfa8c646616b55280c700d8bf5114d3cbe remotes/origin/dependabot/bundler/site/nokogiri-1.10.8~24", "commitHash": "eba63dbfa8c646616b55280c700d8bf5114d3cbe", "commitMessage": "ISSUE #2224: Config ServerConfiguration with setAllowLoopback(true) for Unit Tests\n\n### Motivation\r\n\r\nUnit test fails when build master branch\r\n\r\n### Changes\r\n\r\nConfig ServerConfiguration with setAllowLoopback(true) in the class GarbageCollectorThreadTest\r\n\r\nMaster Issue: #2224 \r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #2226 from coolbeevip/ISSUE-2224, closes #2224 and squashes the following commits:\n\nfdba4fbce [Lei Zhang] ISSUE-2224 set allowLoopback is true\n2ff7ca5af [Enrico Olivelli] Account Apache Thrift and Http Client files in LICENSE files - Fix build on Travis\n2bbf58e01 [Dapeng] Fixed bin/bookkeeper shell readjournal\n9d61fb4fe [Dapeng] [DOCS] Modify \u201cUsing Autoecovery\u201d,recover does not support the specified target bookie\n2ca4025e4 [Anup Ghatage] [DOCUMENTATION] Add doc for decommissioning bookie process\n62e3b9b6f [Enrico Olivelli] Make 4.9.2 as stable\n40f349ccf [Enrico Olivelli] Bump Python client version\nb1991e6b3 [Enrico Olivelli] Release notes for 4.10\n9f4b1359e [\u5189\u5c0f\u9f99] Fix the log level of not support Sse42Crc32C\n557dfe90f [Jennifer Huang] [DOCS] Update coding_guide.md\n43f8cd74f [Enrico Olivelli] Add -Dtwitter to fix auto-build\nf57962bcc [Matteo Merli] Removed mutex contention on BufferedChannel\nf5d2e5931 [Enrico Olivelli] Add -Dtwitter to release scripts in order to build Twitter stats providers\n7efa8e89e [Enrico Olivelli] Fix version in modules that are not active by default\nd49b46f4e [Enrico Olivelli] [maven-release-plugin] prepare for next development iteration\n5a4213bb0 [Enrico Olivelli] [maven-release-plugin] prepare branch branch-4.10\nf8a5974a5 [Charan Reddy Guttapalem] Fix firstStoredEntryId logic in LedgerFragment\n8559126a3 [Anup Ghatage] Issue #2145: Make ledgerDirs in Cookie consistent across generating a\u2026", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/GarbageCollectorThreadTest.java"}], "commitParents": ["e7dd19bb52d0654006decb383cb35ffcde928990"], "commitDateTime": "2020-01-07 16:15:28", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-01-07 16:15:28"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/config", "release/4.11.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Test fails", "numCommits": 0, "body": "**QUESTION**\r\n\r\nAccording to the developer documents https://cwiki.apache.org/confluence/display/BOOKKEEPER/Developer+Setup, I failed to build & test base the master branch\r\n\r\n**Operating system && JVM**\r\n\r\njava version \"1.8.0_201\"\r\nJava(TM) SE Runtime Environment (build 1.8.0_201-b09)\r\nJava HotSpot(TM) 64-Bit Server VM (build 25.201-b09, mixed mode)\r\nApache Maven 3.6.0 (97c98ec64a1fdfee7767ce5ffb20918da4f719f3; 2018-10-25T02:41:47+08:00)\r\nOS name: \"mac os x\", version: \"10.14.3\", arch: \"x86_64\", family: \"mac\"\r\n\r\nThe error is as follows\r\n\r\n```bash\r\nmvn clean package \r\n...\r\n...\r\n[INFO] Running org.apache.bookkeeper.bookie.GarbageCollectorThreadTest\r\n[ERROR] Tests run: 3, Failures: 0, Errors: 3, Skipped: 0, Time elapsed: 1.097 s <<< FAILURE! - in org.apache.bookkeeper.bookie.GarbageCollectorThreadTest\r\n[ERROR] testCompactEntryLogWithException(org.apache.bookkeeper.bookie.GarbageCollectorThreadTest)  Time elapsed: 0.145 s  <<< ERROR!\r\norg.mockito.exceptions.misusing.InjectMocksException:\r\n\r\nCannot instantiate @InjectMocks field named 'mockGCThread' of type 'class org.apache.bookkeeper.bookie.GarbageCollectorThread'.\r\nYou haven't provided the instance at field declaration so I tried to construct the instance.\r\nHowever the constructor or the initialization block threw an exception : Trying to listen on loopback address, 127.0.0.1:3181 but this is forbidden by default (see ServerConfiguration#getAllowLoopback()).\r\nIf this happen, you can consider specifying the network interface to listen on (e.g. listeningInterface=eth0) or specifying the advertised address (e.g. advertisedAddress=172.x.y.z)\r\n\r\n\tat org.apache.bookkeeper.bookie.GarbageCollectorThreadTest.setUp(GarbageCollectorThreadTest.java:64)\r\nCaused by: java.net.UnknownHostException:\r\nTrying to listen on loopback address, 127.0.0.1:3181 but this is forbidden by default (see ServerConfiguration#getAllowLoopback()).\r\nIf this happen, you can consider specifying the network interface to listen on (e.g. listeningInterface=eth0) or specifying the advertised address (e.g. advertisedAddress=172.x.y.z)\r\n\tat org.apache.bookkeeper.bookie.GarbageCollectorThreadTest.setUp(GarbageCollectorThreadTest.java:64)\r\n\r\n[ERROR] testCompactEntryLogWithException(org.apache.bookkeeper.bookie.GarbageCollectorThreadTest)  Time elapsed: 0.003 s  <<< ERROR!\r\norg.mockito.exceptions.misusing.InjectMocksException:\r\n\r\nCannot instantiate @InjectMocks field named 'mockGCThread' of type 'class org.apache.bookkeeper.bookie.GarbageCollectorThread'.\r\nYou haven't provided the instance at field declaration so I tried to construct the instance.\r\nHowever the constructor or the initialization block threw an exception : Trying to listen on loopback address, 127.0.0.1:3181 but this is forbidden by default (see ServerConfiguration#getAllowLoopback()).\r\nIf this happen, you can consider specifying the network interface to listen on (e.g. listeningInterface=eth0) or specifying the advertised address (e.g. advertisedAddress=172.x.y.z)\r\n\r\n\tat org.apache.bookkeeper.bookie.GarbageCollectorThreadTest.setUp(GarbageCollectorThreadTest.java:64)\r\nCaused by: java.net.UnknownHostException:\r\nTrying to listen on loopback address, 127.0.0.1:3181 but this is forbidden by default (see ServerConfiguration#getAllowLoopback()).\r\nIf this happen, you can consider specifying the network interface to listen on (e.g. listeningInterface=eth0) or specifying the advertised address (e.g. advertisedAddress=172.x.y.z)\r\n\tat org.apache.bookkeeper.bookie.GarbageCollectorThreadTest.setUp(GarbageCollectorThreadTest.java:64)\r\n\r\n[ERROR] testCompactEntryLogWithException(org.apache.bookkeeper.bookie.GarbageCollectorThreadTest)  Time elapsed: 0.002 s  <<< ERROR!\r\norg.mockito.exceptions.misusing.InjectMocksException:\r\n\r\nCannot instantiate @InjectMocks field named 'mockGCThread' of type 'class org.apache.bookkeeper.bookie.GarbageCollectorThread'.\r\nYou haven't provided the instance at field declaration so I tried to construct the instance.\r\nHowever the constructor or the initialization block threw an exception : Trying to listen on loopback address, 127.0.0.1:3181 but this is forbidden by default (see ServerConfiguration#getAllowLoopback()).\r\nIf this happen, you can consider specifying the network interface to listen on (e.g. listeningInterface=eth0) or specifying the advertised address (e.g. advertisedAddress=172.x.y.z)\r\n\r\n\tat org.apache.bookkeeper.bookie.GarbageCollectorThreadTest.setUp(GarbageCollectorThreadTest.java:64)\r\nCaused by: java.net.UnknownHostException:\r\nTrying to listen on loopback address, 127.0.0.1:3181 but this is forbidden by default (see ServerConfiguration#getAllowLoopback()).\r\nIf this happen, you can consider specifying the network interface to listen on (e.g. listeningInterface=eth0) or specifying the advertised address (e.g. advertisedAddress=172.x.y.z)\r\n\tat org.apache.bookkeeper.bookie.GarbageCollectorThreadTest.setUp(GarbageCollectorThreadTest.java:64)\r\n\r\n[INFO] Running org.apache.bookkeeper.bookie.CompactionByEntriesTest\r\n[INFO] Tests run: 15, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 66.694 s - in org.apache.bookkeeper.bookie.CompactionByEntriesTest\r\n[INFO] Running org.apache.bookkeeper.bookie.CheckpointOnNewLedgersTest\r\n[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.936 s - in org.apache.bookkeeper.bookie.CheckpointOnNewLedgersTest\r\n[INFO] Running org.apache.bookkeeper.bookie.BookieWriteToJournalTest\r\n[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.401 s - in org.apache.bookkeeper.bookie.BookieWriteToJournalTest\r\n[INFO] Running org.apache.bookkeeper.bookie.TestLedgerDirsManager\r\n[INFO] Tests run: 10, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 5.879 s - in org.apache.bookkeeper.bookie.TestLedgerDirsManager\r\n[INFO] Running org.apache.bookkeeper.bookie.IndexPersistenceMgrTest\r\n[INFO] Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.335 s - in org.apache.bookkeeper.bookie.IndexPersistenceMgrTest\r\n[INFO] Running org.apache.bookkeeper.bookie.UpgradeTest\r\n[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.775 s - in org.apache.bookkeeper.bookie.UpgradeTest\r\n[INFO] Running org.apache.bookkeeper.bookie.LedgerCacheTest\r\n[INFO] Tests run: 13, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.436 s - in org.apache.bookkeeper.bookie.LedgerCacheTest\r\n[INFO] Running org.apache.bookkeeper.bookie.CompactionByBytesTest\r\n[INFO] Tests run: 15, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 67.663 s - in org.apache.bookkeeper.bookie.CompactionByBytesTest\r\n[INFO] Running org.apache.bookkeeper.bookie.IndexCorruptionTest\r\n[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 68.95 s - in org.apache.bookkeeper.bookie.IndexCorruptionTest\r\n[INFO]\r\n[INFO] Results:\r\n[INFO]\r\n[ERROR] Errors:\r\n[ERROR] org.apache.bookkeeper.bookie.GarbageCollectorThreadTest.testCompactEntryLogWithException(org.apache.bookkeeper.bookie.GarbageCollectorThreadTest)\r\n[ERROR]   Run 1: GarbageCollectorThreadTest.setUp:64 InjectMocks\r\nCannot instantiate @InjectMoc...\r\n[ERROR]   Run 2: GarbageCollectorThreadTest.setUp:64 InjectMocks\r\nCannot instantiate @InjectMoc...\r\n[ERROR]   Run 3: GarbageCollectorThreadTest.setUp:64 InjectMocks\r\nCannot instantiate @InjectMoc...\r\n[INFO]\r\n[WARNING] Flakes:\r\n[WARNING] org.apache.bookkeeper.client.SlowBookieTest.testManyBookieFailureWithSlowBookies(org.apache.bookkeeper.client.SlowBookieTest)\r\n[ERROR]   Run 1: SlowBookieTest.testManyBookieFailureWithSlowBookies:364 There should be no missing fragments expected:<0> but was:<1>\r\n[ERROR]   Run 2: SlowBookieTest.testManyBookieFailureWithSlowBookies:364 There should be no missing fragments expected:<0> but was:<1>\r\n[INFO]   Run 3: PASS\r\n[INFO]\r\n[WARNING] org.apache.bookkeeper.replication.BookieAutoRecoveryTest.testEmptyLedgerLosesQuorumEventually(org.apache.bookkeeper.replication.BookieAutoRecoveryTest)\r\n[ERROR]   Run 1: BookieAutoRecoveryTest.testEmptyLedgerLosesQuorumEventually:393 Should be marked as replicated\r\n[INFO]   Run 2: PASS\r\n[INFO]\r\n[INFO]\r\n[ERROR] Tests run: 1554, Failures: 0, Errors: 1, Skipped: 17, Flakes: 2\r\n[INFO]\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] Reactor Summary for Apache BookKeeper :: Parent 4.11.0-SNAPSHOT:\r\n[INFO]\r\n[INFO] Apache BookKeeper :: Parent ........................ SUCCESS [  1.599 s]\r\n[INFO] Apache BookKeeper :: Build Tools ................... SUCCESS [  0.599 s]\r\n[INFO] Apache BookKeeper :: Circe Checksum Library ........ SUCCESS [ 17.247 s]\r\n[INFO] Apache BookKeeper :: Stats API ..................... SUCCESS [  2.348 s]\r\n[INFO] Apache BookKeeper :: CPU Affinity Library .......... SUCCESS [  6.776 s]\r\n[INFO] Apache BookKeeper :: Common ........................ SUCCESS [ 20.766 s]\r\n[INFO] Apache BookKeeper :: Common :: Allocator ........... SUCCESS [  2.543 s]\r\n[INFO] Apache BookKeeper :: Stats :: Parent ............... SUCCESS [  0.062 s]\r\n[INFO] Apache BookKeeper :: Stats :: Utils ................ SUCCESS [  0.819 s]\r\n[INFO] Apache BookKeeper :: Protocols ..................... SUCCESS [  3.605 s]\r\n[INFO] Apache BookKeeper :: Tools :: Parent ............... SUCCESS [  0.044 s]\r\n[INFO] Apache BookKeeper :: Tools :: Framework ............ SUCCESS [  2.455 s]\r\n[INFO] Apache BookKeeper :: Http :: Http Server ........... SUCCESS [  0.882 s]\r\n[INFO] Apache BookKeeper :: Stats Providers :: Prometheus . SUCCESS [  3.813 s]\r\n[INFO] Apache BookKeeper :: Bookkeeper Http :: Vertx Http Server SUCCESS [  2.909 s]\r\n[INFO] Apache BookKeeper :: Server ........................ FAILURE [  01:25 h]\r\n[INFO] Apache BookKeeper :: Benchmark ..................... SKIPPED\r\n[INFO] Apache BookKeeper :: Stats Providers :: Codahale Metrics SKIPPED\r\n[INFO] Apache BookKeeper :: Stats Providers ............... SKIPPED\r\n[INFO] Apache BookKeeper :: Bookkeeper Http :: Twitter Http Server SKIPPED\r\n[INFO] Apache BookKeeper :: Http .......................... SKIPPED\r\n[INFO] Apache BookKeeper :: DistributedLog :: Parent ...... SKIPPED\r\n[INFO] Apache BookKeeper :: DistributedLog :: Common ...... SKIPPED\r\n[INFO] Apache BookKeeper :: DistributedLog :: Protocol .... SKIPPED\r\n[INFO] Apache BookKeeper :: DistributedLog :: Core Library  SKIPPED\r\n[INFO] Apache BookKeeper :: DistributedLog :: IO :: FileSystem SKIPPED\r\n[INFO] Apache BookKeeper :: DistributedLog :: IO .......... SKIPPED\r\n[INFO] Apache BookKeeper :: Tools :: Ledger ............... SKIPPED\r\n[INFO] Apache BookKeeper :: Tools ......................... SKIPPED\r\n[INFO] Apache BookKeeper :: Metadata Drivers :: Parent .... SKIPPED\r\n[INFO] Apache BookKeeper :: Metadata Drivers:: Etcd ....... SKIPPED\r\n[INFO] Apache BookKeeper :: Dist (Parent) ................. SKIPPED\r\n[INFO] Apache BookKeeper :: Dist (All) .................... SKIPPED\r\n[INFO] Apache BookKeeper :: Dist (Server) ................. SKIPPED\r\n[INFO] Apache BookKeeper :: Dist (Bkctl) .................. SKIPPED\r\n[INFO] Apache BookKeeper :: Shaded :: Parent .............. SKIPPED\r\n[INFO] Apache BookKeeper :: Shaded :: bookkeeper-server-shaded SKIPPED\r\n[INFO] Apache BookKeeper :: Shaded :: bookkeeper-server-tests-shaded SKIPPED\r\n[INFO] Apache BookKeeper :: Shaded :: distributedlog-core-shaded SKIPPED\r\n[INFO] Apache BookKeeper :: microbenchmarks ............... SKIPPED\r\n[INFO] Apache BookKeeper :: Tests ......................... SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Test Shaded Jars ..... SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: bookkeeper-server-shaded test SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: bookkeeper-server-tests-shaded test SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: distributedlog-core-shaded test SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Docker Images ........ SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Docker Images :: All Released Versions SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Docker Images :: All Versions SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Docker Images :: Current Version SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Utility module for Arquillian based integration tests SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Common topologies for Docker based integration tests SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Base module for Arquillian based integration tests SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Base module for Arquillian based integration tests using groovy SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Backward Compatibility SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Backward Compatibility :: Test upgrade between all released versions and current version SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Backward Compatibility :: Test upgrade between 4.1.0 and current version SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Backward Compatibility :: Test compat between old version and new version of hierarchical ledger manager SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Backward Compatibility :: Test upgrade between 4.1.0 and current version (with hostname bookie ID) SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Backward Compatibility :: Test recovery does not work when password no in metadata SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Backward Compatibility :: Test upgrade 4.1.0 to current in cluster with cookies SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Backward Compatibility :: Test old clients working on current server SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Backward Compatibility :: Test upgrade between yahoo custom version and current SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Integration .......... SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Integration :: Smoke test SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Integration :: Standalone test SKIPPED\r\n[INFO] Apache BookKeeper :: Tests :: Bash Scripts Test .... SKIPPED\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] BUILD FAILURE\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] Total time:  01:27 h\r\n[INFO] Finished at: 2019-12-27T14:46:16+08:00\r\n[INFO] ------------------------------------------------------------------------\r\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.21.0:test (default-test) on project bookkeeper-server: There was a timeout or other error in the fork -> [Help 1]\r\n[ERROR]\r\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\r\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\r\n[ERROR]\r\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\r\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException\r\n[ERROR]\r\n[ERROR] After correcting the problems, you can resume the build with the command\r\n[ERROR]   mvn <goals> -rf :bookkeeper-server\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"eba63dbfa8c646616b55280c700d8bf5114d3cbe": {"commitUser": "jiazhai", "commitGHEventType": "closed"}}, "closed": "2020-01-07 08:15:30", "url": "https://github.com/apache/bookkeeper/issues/2224", "user": "coolbeevip", "ttf": 11.000277777777777}, {"created": "2019-12-11 11:16:17", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "93b4afa082bfd4af153b1a9f9dcfa938ce6f8bd8 remotes/origin/branch-4.9~1", "commitHash": "93b4afa082bfd4af153b1a9f9dcfa938ce6f8bd8", "commitMessage": "Issue #2212: Fix issues in Bookkeeper Docker image that prevented containers from starting up\n\nDescriptions of the changes in this PR:\n\n### Motivation\n\nThis PR modifies the Apache Bookkeeper Docker image to fix issues that were causing errors upon container bootstrap. The containers would exit soon after they were launched. See issue #2212 for a description of such an error.\n\nNote that the problems that are fixed in this PR were observed:\n\n* when launching containers using both Docker Compose and Kubernetes.\n* when we were trying to upgrade the image to: `4.9.2`. It is highly likely that the issue is observed in other versions (except for `4.7.3`) too.\n* when launching both a standalone container as well as a cluster of three containers.\n\n### Changes\nThe major changes made in this PR are as follows:\n* Updates the `Dockerfile` to install `zk-shell`.\n* Update the `init_bookie.sh` file to:\n   * Use `zk-shell` instead of `/opt/bookkeeper/bin/bookkeeper org.apache.zookeeper.ZooKeeperMain` command that doesn't work.\n  * Use `opt/bookkeeper/bin/bookkeeper shell initnewcluster` for initializing the cluster instead of the previously used command that did not work.\n  * Increase the time a container waits for an in-flight `initnewcluster` operation.\n  * Make the comments more descriptive.\n* Modifies `bin/common.sh` to handle the condition when file `/proc/sys/net/ipv6/bindv6only` is missing in the system. This can prevent a container from starting up in some cases. We have seen this issue on some Kubernetes-based environments.\n* Fixes errors in `docker-compose.yml` file.\n\n*Note:* Some of the changes made in this PR are modeled after changes made by sijie for `v4.7.2` in PR #1666 .\n\n### Master Issue\n#2212\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #2219 from ravisharda/startup-failure-docker-image, closes #2212\n\n(cherry picked from commit 092ebf2a7ec596db0357a072caf123b18a7f29e6)\nSigned-off-by: Enrico Olivelli <enrico.olivelli@diennea.com>\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bin/common.sh"}, {"lines": 7, "deletions": 1, "insertions": 6, "filePath": "docker/Dockerfile"}, {"lines": 49, "deletions": 29, "insertions": 20, "filePath": "docker/scripts/init_bookie.sh"}, {"lines": 6, "deletions": 3, "insertions": 3, "filePath": "docker/docker-compose.yml"}, {"lines": 5, "deletions": 0, "insertions": 5, "filePath": "tests/docker-images/current-version-image/Dockerfile"}], "commitParents": ["6304cb9dbbc9d2bd400f7e73241aa2ea432716e9"], "commitDateTime": "2020-05-04 12:19:20", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-05-04 15:36:43"}, {"commitSpoonAstDiffStats": [], "nameRev": "092ebf2a7ec596db0357a072caf123b18a7f29e6 remotes/origin/branch-4.11~32", "commitHash": "092ebf2a7ec596db0357a072caf123b18a7f29e6", "commitMessage": "Issue #2212: Fix issues in Bookkeeper Docker image that prevented containers from starting up\n\nDescriptions of the changes in this PR:\r\n\r\n### Motivation\r\n\r\nThis PR modifies the Apache Bookkeeper Docker image to fix issues that were causing errors upon container bootstrap. The containers would exit soon after they were launched. See issue #2212 for a description of such an error. \r\n\r\nNote that the problems that are fixed in this PR were observed:\r\n\r\n* when launching containers using both Docker Compose and Kubernetes.  \r\n* when we were trying to upgrade the image to: `4.9.2`. It is highly likely that the issue is observed in other versions (except for `4.7.3`) too.  \r\n* when launching both a standalone container as well as a cluster of three containers.\r\n\r\n### Changes\r\nThe major changes made in this PR are as follows: \r\n* Updates the `Dockerfile` to install `zk-shell`. \r\n* Update the `init_bookie.sh` file to:\r\n   * Use `zk-shell` instead of `/opt/bookkeeper/bin/bookkeeper org.apache.zookeeper.ZooKeeperMain` command that doesn't work. \r\n  * Use `opt/bookkeeper/bin/bookkeeper shell initnewcluster` for initializing the cluster instead of the previously used command that did not work. \r\n  * Increase the time a container waits for an in-flight `initnewcluster` operation. \r\n  * Make the comments more descriptive.\r\n* Modifies `bin/common.sh` to handle the condition when file `/proc/sys/net/ipv6/bindv6only` is missing in the system. This can prevent a container from starting up in some cases. We have seen this issue on some Kubernetes-based environments. \r\n* Fixes errors in `docker-compose.yml` file. \r\n\r\n*Note:* Some of the changes made in this PR are modeled after changes made by sijie for `v4.7.2` in PR #1666 .\r\n\r\n### Master Issue\r\n#2212 \r\n\r\n\r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #2219 from ravisharda/startup-failure-docker-image, closes #2212", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bin/common.sh"}, {"lines": 7, "deletions": 1, "insertions": 6, "filePath": "docker/Dockerfile"}, {"lines": 49, "deletions": 29, "insertions": 20, "filePath": "docker/scripts/init_bookie.sh"}, {"lines": 6, "deletions": 3, "insertions": 3, "filePath": "docker/docker-compose.yml"}, {"lines": 5, "deletions": 0, "insertions": 5, "filePath": "tests/docker-images/current-version-image/Dockerfile"}], "commitParents": ["94912a9fdca68391866baf598c36708e406728f8"], "commitDateTime": "2020-05-04 12:18:43", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-05-04 15:36:43"}, {"commitSpoonAstDiffStats": [], "nameRev": "f8ae7e27140ffb76c43c8325cd7f5a10b96f7ecf remotes/origin/branch-4.10~2", "commitHash": "f8ae7e27140ffb76c43c8325cd7f5a10b96f7ecf", "commitMessage": "Issue #2212: Fix issues in Bookkeeper Docker image that prevented containers from starting up\n\nDescriptions of the changes in this PR:\n\n### Motivation\n\nThis PR modifies the Apache Bookkeeper Docker image to fix issues that were causing errors upon container bootstrap. The containers would exit soon after they were launched. See issue #2212 for a description of such an error.\n\nNote that the problems that are fixed in this PR were observed:\n\n* when launching containers using both Docker Compose and Kubernetes.\n* when we were trying to upgrade the image to: `4.9.2`. It is highly likely that the issue is observed in other versions (except for `4.7.3`) too.\n* when launching both a standalone container as well as a cluster of three containers.\n\n### Changes\nThe major changes made in this PR are as follows:\n* Updates the `Dockerfile` to install `zk-shell`.\n* Update the `init_bookie.sh` file to:\n   * Use `zk-shell` instead of `/opt/bookkeeper/bin/bookkeeper org.apache.zookeeper.ZooKeeperMain` command that doesn't work.\n  * Use `opt/bookkeeper/bin/bookkeeper shell initnewcluster` for initializing the cluster instead of the previously used command that did not work.\n  * Increase the time a container waits for an in-flight `initnewcluster` operation.\n  * Make the comments more descriptive.\n* Modifies `bin/common.sh` to handle the condition when file `/proc/sys/net/ipv6/bindv6only` is missing in the system. This can prevent a container from starting up in some cases. We have seen this issue on some Kubernetes-based environments.\n* Fixes errors in `docker-compose.yml` file.\n\n*Note:* Some of the changes made in this PR are modeled after changes made by sijie for `v4.7.2` in PR #1666 .\n\n### Master Issue\n#2212\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #2219 from ravisharda/startup-failure-docker-image, closes #2212\n\n(cherry picked from commit 092ebf2a7ec596db0357a072caf123b18a7f29e6)\nSigned-off-by: Enrico Olivelli <enrico.olivelli@diennea.com>\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bin/common.sh"}, {"lines": 7, "deletions": 1, "insertions": 6, "filePath": "docker/Dockerfile"}, {"lines": 49, "deletions": 29, "insertions": 20, "filePath": "docker/scripts/init_bookie.sh"}, {"lines": 6, "deletions": 3, "insertions": 3, "filePath": "docker/docker-compose.yml"}, {"lines": 5, "deletions": 0, "insertions": 5, "filePath": "tests/docker-images/current-version-image/Dockerfile"}], "commitParents": ["f0d27f7c3376f1160d3b5a39f8cae8670cb07159"], "commitDateTime": "2020-05-04 12:19:02", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-05-04 15:36:43"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/docker", "triage/week-4", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Docker-compose example not working", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\nTried to launch bookkeeper docker-compose environment locally but bookie containers failed, stating that bookkeeper metadata does not exist in zookeeper. This makes sense since every container was launched from scratch and the docker-compose file executes no logic to create said metadata. I would expect either the bookie node to create this metadata or have some logic in the docker-compose file that performs it.\r\n\r\n***To Reproduce***\r\n\r\nSteps to reproduce the behavior:\r\n1. Checkout repository \r\n2. In the docker folder execute `docker-compose up -d`\r\n\r\n***Expected behavior***\r\nDocker-compose launched containers to be healthy and ready. Not the case\r\n\r\n***Screenshots***\r\nNot a screenshot but here is the output of the command:\r\n```\r\ndocker ps -a\r\nCONTAINER ID        IMAGE                       COMMAND                  CREATED             STATUS                              PORTS                                    NAMES\r\n39439cc08650        caiok/bookkeeper-tutorial   \"/bin/sh -c '/bin/sh\u2026\"   6 seconds ago       Up 4 seconds                                                                 docker_dice_1\r\na2b6528404ef        apache/bookkeeper           \"/bin/bash /opt/book\u2026\"   9 seconds ago       Exited (2) Less than a second ago                                            docker_bookie3_1\r\ne293db7298e1        apache/bookkeeper           \"/bin/bash /opt/book\u2026\"   9 seconds ago       Exited (2) 2 seconds ago                                                     docker_bookie1_1\r\n06deafd59daf        apache/bookkeeper           \"/bin/bash /opt/book\u2026\"   9 seconds ago       Up 5 seconds (health: starting)     3181/tcp                                 docker_bookie2_1\r\n7a0238738e39        zookeeper                   \"/docker-entrypoint.\u2026\"   11 seconds ago      Up 9 seconds                        2181/tcp, 2888/tcp, 3888/tcp, 8080/tcp   docker_zookeeper_1\r\n```\r\n```\r\ndocker-compose ps   \r\n       Name                     Command               State                    Ports                 \r\n-----------------------------------------------------------------------------------------------------\r\ndocker_bookie1_1     /bin/bash /opt/bookkeeper/ ...   Exit 2                                         \r\ndocker_bookie2_1     /bin/bash /opt/bookkeeper/ ...   Exit 2                                         \r\ndocker_bookie3_1     /bin/bash /opt/bookkeeper/ ...   Exit 2                                         \r\ndocker_dice_1        /bin/sh -c /bin/sh /local/ ...   Up                                             \r\ndocker_zookeeper_1   /docker-entrypoint.sh zkSe ...   Up       2181/tcp, 2888/tcp, 3888/tcp, 8080/tcp\r\n```\r\n\r\nBookie logs:\r\n```\r\ndocker logs docker_bookie3_1\r\nEnvironment Vars for bookie:\r\n\r\n  [metadata service]\r\n  BK_zkServers is zookeeper:2181\r\n  BK_CLUSTER_ROOT_PATH is \r\n  BK_metadataServiceUri is zk://zookeeper:2181/ledgers\r\n\r\n  [bookie]\r\n  BK_bookiePort bookie service port is 3181\r\n  BK_DATA_DIR is /data/bookkeeper\r\n  BK_journalDirectory is /data/bookkeeper/journal\r\n  BK_ledgerDirectories are /data/bookkeeper/ledgers\r\n  BK_indexDirectories are /data/bookkeeper/ledgers\r\n\r\n  [bookie http]\r\n  BK_httpServerEnabled is true\r\n  BK_httpServerPort is \r\n\r\n  [dlog]\r\n  BK_dlogRootPath is /distributedlog\r\n\r\n  [stream storage]\r\n  BK_STREAM_STORAGE_ROOT_PATH is /stream\r\n  BK_NUM_STORAGE_CONTAINERS is 32\r\n  BOOKIE_GRPC_PORT is \r\nconf files: \r\n['/opt/bookkeeper/conf/jaas_example.conf', '/opt/bookkeeper/conf/log4j.properties', '/opt/bookkeeper/conf/bk_cli_env.sh', '/opt/bookkeeper/conf/log4j.cli.properties', '/opt/bookkeeper/conf/standalone.conf', '/opt/bookkeeper/conf/bkenv.sh', '/opt/bookkeeper/conf/zookeeper.conf.dynamic', '/opt/bookkeeper/conf/bk_server.conf', '/opt/bookkeeper/conf/log4j.shell.properties', '/opt/bookkeeper/conf/zookeeper.conf', '/opt/bookkeeper/conf/nettyenv.sh']\r\n[/opt/bookkeeper/conf/bk_server.conf] Applying config bookiePort = 3181\r\n[/opt/bookkeeper/conf/bk_server.conf] Applying config httpServerEnabled = true\r\n[/opt/bookkeeper/conf/bk_server.conf] Applying config httpServerPort = \r\n[/opt/bookkeeper/conf/bk_server.conf] Applying config indexDirectories = /data/bookkeeper/ledgers\r\n[/opt/bookkeeper/conf/bk_server.conf] Applying config journalDirectory = /data/bookkeeper/journal\r\n[/opt/bookkeeper/conf/bk_server.conf] Applying config ledgerDirectories = /data/bookkeeper/ledgers\r\n[/opt/bookkeeper/conf/bk_server.conf] Applying config metadataServiceUri = zk://zookeeper:2181/ledgers\r\n[/opt/bookkeeper/conf/bk_server.conf] Applying config zkLedgersRootPath = /ledgers\r\n[/opt/bookkeeper/conf/bk_server.conf] Applying config zkServers = zookeeper:2181\r\nCreated bookie dirs : \r\n  journal = /data/bookkeeper/journal\r\n  ledger = /data/bookkeeper/ledgers\r\n  index = /data/bookkeeper/ledgers\r\nwait for zookeeper\r\nConnecting to zookeeper:2181\r\n2019-12-11 11:03:15,666 - INFO  - [main:Environment@100] - Client environment:zookeeper.version=3.4.13-2d71af4dbe22557fda74f9a9b4309b15a7487f03, built on 06/29/2018 00:39 GMT\r\n2019-12-11 11:03:15,668 - INFO  - [main:Environment@100] - Client environment:host.name=bookie3\r\n2019-12-11 11:03:15,669 - INFO  - [main:Environment@100] - Client environment:java.version=1.8.0_201\r\n2019-12-11 11:03:15,671 - INFO  - [main:Environment@100] - Client environment:java.vendor=Oracle Corporation\r\n2019-12-11 11:03:15,672 - INFO  - [main:Environment@100] - Client environment:java.home=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.201.b09-2.el7_6.x86_64/jre\r\n2019-12-11 11:03:15,672 - INFO  - [main:Environment@100] - Client environment:java.class.path=/opt/bookkeeper/conf:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-server-4.9.0.jar::/opt/bookkeeper/lib/com.beust-jcommander-1.48.jar:/opt/bookkeeper/lib/com.fasterxml.jackson.core-jackson-annotations-2.9.7.jar:/opt/bookkeeper/lib/com.fasterxml.jackson.core-jackson-core-2.9.7.jar:/opt/bookkeeper/lib/com.fasterxml.jackson.core-jackson-databind-2.9.7.jar:/opt/bookkeeper/lib/com.google.api.grpc-proto-google-common-protos-1.0.0.jar:/opt/bookkeeper/lib/com.google.auth-google-auth-library-credentials-0.9.0.jar:/opt/bookkeeper/lib/com.google.code.gson-gson-2.7.jar:/opt/bookkeeper/lib/com.google.errorprone-error_prone_annotations-2.1.2.jar:/opt/bookkeeper/lib/com.google.guava-guava-21.0.jar:/opt/bookkeeper/lib/com.google.protobuf-protobuf-java-3.5.1.jar:/opt/bookkeeper/lib/com.google.protobuf-protobuf-java-util-3.5.1.jar:/opt/bookkeeper/lib/com.google.protobuf.nano-protobuf-javanano-3.0.0-alpha-5.jar:/opt/bookkeeper/lib/com.squareup.okhttp-okhttp-2.5.0.jar:/opt/bookkeeper/lib/com.squareup.okio-okio-1.13.0.jar:/opt/bookkeeper/lib/com.yahoo.datasketches-memory-0.8.3.jar:/opt/bookkeeper/lib/com.yahoo.datasketches-sketches-core-0.8.3.jar:/opt/bookkeeper/lib/commons-cli-commons-cli-1.2.jar:/opt/bookkeeper/lib/commons-codec-commons-codec-1.6.jar:/opt/bookkeeper/lib/commons-configuration-commons-configuration-1.10.jar:/opt/bookkeeper/lib/commons-io-commons-io-2.4.jar:/opt/bookkeeper/lib/commons-lang-commons-lang-2.6.jar:/opt/bookkeeper/lib/commons-logging-commons-logging-1.1.1.jar:/opt/bookkeeper/lib/io.grpc-grpc-all-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-auth-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-context-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-core-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-netty-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-okhttp-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-protobuf-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-protobuf-lite-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-protobuf-nano-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-stub-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-testing-1.12.0.jar:/opt/bookkeeper/lib/io.netty-netty-buffer-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-dns-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-http-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-http2-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-socks-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-common-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-handler-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-handler-proxy-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-resolver-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-resolver-dns-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-tcnative-boringssl-static-2.0.19.Final.jar:/opt/bookkeeper/lib/io.netty-netty-transport-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-transport-native-epoll-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-transport-native-unix-common-4.1.31.Final.jar:/opt/bookkeeper/lib/io.opencensus-opencensus-api-0.11.0.jar:/opt/bookkeeper/lib/io.opencensus-opencensus-contrib-grpc-metrics-0.11.0.jar:/opt/bookkeeper/lib/io.prometheus-simpleclient-0.0.21.jar:/opt/bookkeeper/lib/io.prometheus-simpleclient_common-0.0.21.jar:/opt/bookkeeper/lib/io.prometheus-simpleclient_hotspot-0.0.21.jar:/opt/bookkeeper/lib/io.prometheus-simpleclient_servlet-0.0.21.jar:/opt/bookkeeper/lib/io.vertx-vertx-auth-common-3.4.1.jar:/opt/bookkeeper/lib/io.vertx-vertx-core-3.4.1.jar:/opt/bookkeeper/lib/io.vertx-vertx-web-3.4.1.jar:/opt/bookkeeper/lib/javax.servlet-javax.servlet-api-3.1.0.jar:/opt/bookkeeper/lib/jline-jline-2.11.jar:/opt/bookkeeper/lib/log4j-log4j-1.2.17.jar:/opt/bookkeeper/lib/net.java.dev.jna-jna-3.2.7.jar:/opt/bookkeeper/lib/net.jpountz.lz4-lz4-1.3.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-common-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-common-allocator-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-proto-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-tools-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-tools-framework-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-tools-ledger-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-circe-checksum-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-cpu-affinity-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-statelib-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-cli-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-java-client-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-server-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-service-api-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-service-impl-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.http-http-server-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.http-vertx-http-server-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.stats-bookkeeper-stats-api-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.stats-prometheus-metrics-provider-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.tests-stream-storage-tests-common-4.9.0.jar:/opt/bookkeeper/lib/org.apache.commons-commons-collections4-4.1.jar:/opt/bookkeeper/lib/org.apache.commons-commons-lang3-3.6.jar:/opt/bookkeeper/lib/org.apache.curator-curator-client-4.0.1.jar:/opt/bookkeeper/lib/org.apache.curator-curator-framework-4.0.1.jar:/opt/bookkeeper/lib/org.apache.curator-curator-recipes-4.0.1.jar:/opt/bookkeeper/lib/org.apache.distributedlog-distributedlog-common-4.9.0.jar:/opt/bookkeeper/lib/org.apache.distributedlog-distributedlog-core-4.9.0-tests.jar:/opt/bookkeeper/lib/org.apache.distributedlog-distributedlog-core-4.9.0.jar:/opt/bookkeeper/lib/org.apache.distributedlog-distributedlog-protocol-4.9.0.jar:/opt/bookkeeper/lib/org.apache.yetus-audience-annotations-0.5.0.jar:/opt/bookkeeper/lib/org.apache.zookeeper-zookeeper-3.4.13.jar:/opt/bookkeeper/lib/org.codehaus.jackson-jackson-core-asl-1.9.11.jar:/opt/bookkeeper/lib/org.codehaus.jackson-jackson-mapper-asl-1.9.11.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-http-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-io-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-security-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-server-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-servlet-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-util-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.inferred-freebuilder-1.14.9.jar:/opt/bookkeeper/lib/org.jctools-jctools-core-2.1.2.jar:/opt/bookkeeper/lib/org.rocksdb-rocksdbjni-5.13.1.jar:/opt/bookkeeper/lib/org.slf4j-slf4j-api-1.7.25.jar:/opt/bookkeeper/lib/org.slf4j-slf4j-log4j12-1.7.25.jar:\r\n2019-12-11 11:03:15,673 - INFO  - [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib\r\n2019-12-11 11:03:15,673 - INFO  - [main:Environment@100] - Client environment:java.io.tmpdir=/tmp\r\n2019-12-11 11:03:15,673 - INFO  - [main:Environment@100] - Client environment:java.compiler=<NA>\r\n2019-12-11 11:03:15,673 - INFO  - [main:Environment@100] - Client environment:os.name=Linux\r\n2019-12-11 11:03:15,673 - INFO  - [main:Environment@100] - Client environment:os.arch=amd64\r\n2019-12-11 11:03:15,674 - INFO  - [main:Environment@100] - Client environment:os.version=4.15.0-70-generic\r\n2019-12-11 11:03:15,674 - INFO  - [main:Environment@100] - Client environment:user.name=root\r\n2019-12-11 11:03:15,674 - INFO  - [main:Environment@100] - Client environment:user.home=/root\r\n2019-12-11 11:03:15,674 - INFO  - [main:Environment@100] - Client environment:user.dir=/opt/bookkeeper\r\n2019-12-11 11:03:15,676 - INFO  - [main:ZooKeeper@442] - Initiating client connection, connectString=zookeeper:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@782830e\r\n2019-12-11 11:03:15,715 - INFO  - [main-SendThread(zookeeper:2181):ClientCnxn$SendThread@1029] - Opening socket connection to server zookeeper/192.168.48.2:2181. Will not attempt to authenticate using SASL (unknown error)\r\n2019-12-11 11:03:15,788 - INFO  - [main-SendThread(zookeeper:2181):ClientCnxn$SendThread@879] - Socket connection established to zookeeper/192.168.48.2:2181, initiating session\r\n2019-12-11 11:03:15,799 - INFO  - [main-SendThread(zookeeper:2181):ClientCnxn$SendThread@1303] - Session establishment complete on server zookeeper/192.168.48.2:2181, sessionid = 0x1000fd21e490002, negotiated timeout = 30000\r\n\r\nWATCHER::\r\n\r\nWatchedEvent state:SyncConnected type:None path:null\r\n[zookeeper]\r\nConnecting to zookeeper:2181\r\n2019-12-11 11:03:16,653 - INFO  - [main:Environment@100] - Client environment:zookeeper.version=3.4.13-2d71af4dbe22557fda74f9a9b4309b15a7487f03, built on 06/29/2018 00:39 GMT\r\n2019-12-11 11:03:16,655 - INFO  - [main:Environment@100] - Client environment:host.name=bookie3\r\n2019-12-11 11:03:16,655 - INFO  - [main:Environment@100] - Client environment:java.version=1.8.0_201\r\n2019-12-11 11:03:16,659 - INFO  - [main:Environment@100] - Client environment:java.vendor=Oracle Corporation\r\n2019-12-11 11:03:16,659 - INFO  - [main:Environment@100] - Client environment:java.home=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.201.b09-2.el7_6.x86_64/jre\r\n2019-12-11 11:03:16,659 - INFO  - [main:Environment@100] - Client environment:java.class.path=/opt/bookkeeper/conf:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-server-4.9.0.jar::/opt/bookkeeper/lib/com.beust-jcommander-1.48.jar:/opt/bookkeeper/lib/com.fasterxml.jackson.core-jackson-annotations-2.9.7.jar:/opt/bookkeeper/lib/com.fasterxml.jackson.core-jackson-core-2.9.7.jar:/opt/bookkeeper/lib/com.fasterxml.jackson.core-jackson-databind-2.9.7.jar:/opt/bookkeeper/lib/com.google.api.grpc-proto-google-common-protos-1.0.0.jar:/opt/bookkeeper/lib/com.google.auth-google-auth-library-credentials-0.9.0.jar:/opt/bookkeeper/lib/com.google.code.gson-gson-2.7.jar:/opt/bookkeeper/lib/com.google.errorprone-error_prone_annotations-2.1.2.jar:/opt/bookkeeper/lib/com.google.guava-guava-21.0.jar:/opt/bookkeeper/lib/com.google.protobuf-protobuf-java-3.5.1.jar:/opt/bookkeeper/lib/com.google.protobuf-protobuf-java-util-3.5.1.jar:/opt/bookkeeper/lib/com.google.protobuf.nano-protobuf-javanano-3.0.0-alpha-5.jar:/opt/bookkeeper/lib/com.squareup.okhttp-okhttp-2.5.0.jar:/opt/bookkeeper/lib/com.squareup.okio-okio-1.13.0.jar:/opt/bookkeeper/lib/com.yahoo.datasketches-memory-0.8.3.jar:/opt/bookkeeper/lib/com.yahoo.datasketches-sketches-core-0.8.3.jar:/opt/bookkeeper/lib/commons-cli-commons-cli-1.2.jar:/opt/bookkeeper/lib/commons-codec-commons-codec-1.6.jar:/opt/bookkeeper/lib/commons-configuration-commons-configuration-1.10.jar:/opt/bookkeeper/lib/commons-io-commons-io-2.4.jar:/opt/bookkeeper/lib/commons-lang-commons-lang-2.6.jar:/opt/bookkeeper/lib/commons-logging-commons-logging-1.1.1.jar:/opt/bookkeeper/lib/io.grpc-grpc-all-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-auth-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-context-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-core-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-netty-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-okhttp-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-protobuf-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-protobuf-lite-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-protobuf-nano-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-stub-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-testing-1.12.0.jar:/opt/bookkeeper/lib/io.netty-netty-buffer-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-dns-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-http-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-http2-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-socks-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-common-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-handler-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-handler-proxy-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-resolver-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-resolver-dns-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-tcnative-boringssl-static-2.0.19.Final.jar:/opt/bookkeeper/lib/io.netty-netty-transport-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-transport-native-epoll-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-transport-native-unix-common-4.1.31.Final.jar:/opt/bookkeeper/lib/io.opencensus-opencensus-api-0.11.0.jar:/opt/bookkeeper/lib/io.opencensus-opencensus-contrib-grpc-metrics-0.11.0.jar:/opt/bookkeeper/lib/io.prometheus-simpleclient-0.0.21.jar:/opt/bookkeeper/lib/io.prometheus-simpleclient_common-0.0.21.jar:/opt/bookkeeper/lib/io.prometheus-simpleclient_hotspot-0.0.21.jar:/opt/bookkeeper/lib/io.prometheus-simpleclient_servlet-0.0.21.jar:/opt/bookkeeper/lib/io.vertx-vertx-auth-common-3.4.1.jar:/opt/bookkeeper/lib/io.vertx-vertx-core-3.4.1.jar:/opt/bookkeeper/lib/io.vertx-vertx-web-3.4.1.jar:/opt/bookkeeper/lib/javax.servlet-javax.servlet-api-3.1.0.jar:/opt/bookkeeper/lib/jline-jline-2.11.jar:/opt/bookkeeper/lib/log4j-log4j-1.2.17.jar:/opt/bookkeeper/lib/net.java.dev.jna-jna-3.2.7.jar:/opt/bookkeeper/lib/net.jpountz.lz4-lz4-1.3.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-common-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-common-allocator-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-proto-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-tools-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-tools-framework-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-tools-ledger-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-circe-checksum-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-cpu-affinity-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-statelib-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-cli-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-java-client-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-server-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-service-api-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-service-impl-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.http-http-server-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.http-vertx-http-server-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.stats-bookkeeper-stats-api-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.stats-prometheus-metrics-provider-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.tests-stream-storage-tests-common-4.9.0.jar:/opt/bookkeeper/lib/org.apache.commons-commons-collections4-4.1.jar:/opt/bookkeeper/lib/org.apache.commons-commons-lang3-3.6.jar:/opt/bookkeeper/lib/org.apache.curator-curator-client-4.0.1.jar:/opt/bookkeeper/lib/org.apache.curator-curator-framework-4.0.1.jar:/opt/bookkeeper/lib/org.apache.curator-curator-recipes-4.0.1.jar:/opt/bookkeeper/lib/org.apache.distributedlog-distributedlog-common-4.9.0.jar:/opt/bookkeeper/lib/org.apache.distributedlog-distributedlog-core-4.9.0-tests.jar:/opt/bookkeeper/lib/org.apache.distributedlog-distributedlog-core-4.9.0.jar:/opt/bookkeeper/lib/org.apache.distributedlog-distributedlog-protocol-4.9.0.jar:/opt/bookkeeper/lib/org.apache.yetus-audience-annotations-0.5.0.jar:/opt/bookkeeper/lib/org.apache.zookeeper-zookeeper-3.4.13.jar:/opt/bookkeeper/lib/org.codehaus.jackson-jackson-core-asl-1.9.11.jar:/opt/bookkeeper/lib/org.codehaus.jackson-jackson-mapper-asl-1.9.11.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-http-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-io-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-security-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-server-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-servlet-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-util-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.inferred-freebuilder-1.14.9.jar:/opt/bookkeeper/lib/org.jctools-jctools-core-2.1.2.jar:/opt/bookkeeper/lib/org.rocksdb-rocksdbjni-5.13.1.jar:/opt/bookkeeper/lib/org.slf4j-slf4j-api-1.7.25.jar:/opt/bookkeeper/lib/org.slf4j-slf4j-log4j12-1.7.25.jar:\r\n2019-12-11 11:03:16,660 - INFO  - [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib\r\n2019-12-11 11:03:16,660 - INFO  - [main:Environment@100] - Client environment:java.io.tmpdir=/tmp\r\n2019-12-11 11:03:16,660 - INFO  - [main:Environment@100] - Client environment:java.compiler=<NA>\r\n2019-12-11 11:03:16,661 - INFO  - [main:Environment@100] - Client environment:os.name=Linux\r\n2019-12-11 11:03:16,661 - INFO  - [main:Environment@100] - Client environment:os.arch=amd64\r\n2019-12-11 11:03:16,661 - INFO  - [main:Environment@100] - Client environment:os.version=4.15.0-70-generic\r\n2019-12-11 11:03:16,661 - INFO  - [main:Environment@100] - Client environment:user.name=root\r\n2019-12-11 11:03:16,661 - INFO  - [main:Environment@100] - Client environment:user.home=/root\r\n2019-12-11 11:03:16,661 - INFO  - [main:Environment@100] - Client environment:user.dir=/opt/bookkeeper\r\n2019-12-11 11:03:16,665 - INFO  - [main:ZooKeeper@442] - Initiating client connection, connectString=zookeeper:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@782830e\r\n2019-12-11 11:03:16,706 - INFO  - [main-SendThread(zookeeper:2181):ClientCnxn$SendThread@1029] - Opening socket connection to server zookeeper/192.168.48.2:2181. Will not attempt to authenticate using SASL (unknown error)\r\n2019-12-11 11:03:16,805 - INFO  - [main-SendThread(zookeeper:2181):ClientCnxn$SendThread@879] - Socket connection established to zookeeper/192.168.48.2:2181, initiating session\r\n2019-12-11 11:03:16,818 - INFO  - [main-SendThread(zookeeper:2181):ClientCnxn$SendThread@1303] - Session establishment complete on server zookeeper/192.168.48.2:2181, sessionid = 0x1000fd21e490004, negotiated timeout = 30000\r\n\r\nWATCHER::\r\n\r\nWatchedEvent state:SyncConnected type:None path:null\r\nNode does not exist: /stream\r\nMetadata of cluster already exists, no need to init\r\nThis is root, will use user bookkeeper to run command '/opt/bookkeeper/bin/bookkeeper bookie'\r\n2019-12-11 11:03:19,653 - INFO  - [main:Main@112] - Using configuration file /opt/bookkeeper/conf/bk_server.conf\r\n2019-12-11 11:03:19,659 - INFO  - [main:Main@269] - Hello, I'm your bookie, listening on port 3181. Metadata service uri is zk://zookeeper:2181/ledgers. Journals are in [/data/bookkeeper/journal]. Ledgers are stored in /data/bookkeeper/ledgers.\r\n2019-12-11 11:03:19,675 - INFO  - [main:Main@298] - Load lifecycle component : org.apache.bookkeeper.server.service.StatsProviderService\r\n2019-12-11 11:03:19,893 - INFO  - [main:BookieServer@97] - {\r\n  \"storage.cluster.controller.schedule.interval.ms\" : \"30000\",\r\n  \"zkEnableSecurity\" : \"false\",\r\n  \"dlog.bkcAckQuorumSize\" : \"2\",\r\n  \"indexDirectories\" : \"/data/bookkeeper/ledgers\",\r\n  \"zkServers\" : \"zookeeper:2181\",\r\n  \"zkLedgersRootPath\" : \"/ledgers\",\r\n  \"storage.range.store.dirs\" : \"data/bookkeeper/ranges\",\r\n  \"httpServerPort\" : \"\",\r\n  \"dlog.bkcWriteQuorumSize\" : \"2\",\r\n  \"bookiePort\" : \"3181\",\r\n  \"storage.serve.readonly.tables\" : \"false\",\r\n  \"ledgerDirectories\" : \"/data/bookkeeper/ledgers\",\r\n  \"zkTimeout\" : \"10000\",\r\n  \"httpServerClass\" : \"org.apache.bookkeeper.http.vertx.VertxHttpServer\",\r\n  \"httpServerEnabled\" : \"true\",\r\n  \"metadataServiceUri\" : \"zk://zookeeper:2181/ledgers\",\r\n  \"dlog.bkcEnsembleSize\" : \"3\",\r\n  \"storageserver.grpc.port\" : \"4181\",\r\n  \"journalDirectory\" : \"/data/bookkeeper/journal\"\r\n}\r\n2019-12-11 11:03:20,033 - WARN  - [main:EventLoopUtil@81] - Could not use Netty Epoll event loop: failed to load the required native library\r\n2019-12-11 11:03:20,190 - INFO  - [main:MetadataDrivers@107] - BookKeeper metadata driver manager initialized\r\n2019-12-11 11:03:20,190 - INFO  - [main:MetadataDrivers@107] - BookKeeper metadata driver manager initialized\r\n2019-12-11 11:03:20,191 - INFO  - [main:MetadataDrivers@107] - BookKeeper metadata driver manager initialized\r\n2019-12-11 11:03:20,207 - INFO  - [main:ZKMetadataDriverBase@187] - Initialize zookeeper metadata driver at metadata service uri zk://zookeeper:2181/ledgers : zkServers = zookeeper:2181, ledgersRootPath = /ledgers.\r\n2019-12-11 11:03:20,218 - INFO  - [main:Environment@100] - Client environment:zookeeper.version=3.4.13-2d71af4dbe22557fda74f9a9b4309b15a7487f03, built on 06/29/2018 00:39 GMT\r\n2019-12-11 11:03:20,218 - INFO  - [main:Environment@100] - Client environment:host.name=bookie3\r\n2019-12-11 11:03:20,218 - INFO  - [main:Environment@100] - Client environment:java.version=1.8.0_201\r\n2019-12-11 11:03:20,219 - INFO  - [main:Environment@100] - Client environment:java.vendor=Oracle Corporation\r\n2019-12-11 11:03:20,219 - INFO  - [main:Environment@100] - Client environment:java.home=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.201.b09-2.el7_6.x86_64/jre\r\n2019-12-11 11:03:20,219 - INFO  - [main:Environment@100] - Client environment:java.class.path=/opt/bookkeeper/conf:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-server-4.9.0.jar::/opt/bookkeeper/lib/com.beust-jcommander-1.48.jar:/opt/bookkeeper/lib/com.fasterxml.jackson.core-jackson-annotations-2.9.7.jar:/opt/bookkeeper/lib/com.fasterxml.jackson.core-jackson-core-2.9.7.jar:/opt/bookkeeper/lib/com.fasterxml.jackson.core-jackson-databind-2.9.7.jar:/opt/bookkeeper/lib/com.google.api.grpc-proto-google-common-protos-1.0.0.jar:/opt/bookkeeper/lib/com.google.auth-google-auth-library-credentials-0.9.0.jar:/opt/bookkeeper/lib/com.google.code.gson-gson-2.7.jar:/opt/bookkeeper/lib/com.google.errorprone-error_prone_annotations-2.1.2.jar:/opt/bookkeeper/lib/com.google.guava-guava-21.0.jar:/opt/bookkeeper/lib/com.google.protobuf-protobuf-java-3.5.1.jar:/opt/bookkeeper/lib/com.google.protobuf-protobuf-java-util-3.5.1.jar:/opt/bookkeeper/lib/com.google.protobuf.nano-protobuf-javanano-3.0.0-alpha-5.jar:/opt/bookkeeper/lib/com.squareup.okhttp-okhttp-2.5.0.jar:/opt/bookkeeper/lib/com.squareup.okio-okio-1.13.0.jar:/opt/bookkeeper/lib/com.yahoo.datasketches-memory-0.8.3.jar:/opt/bookkeeper/lib/com.yahoo.datasketches-sketches-core-0.8.3.jar:/opt/bookkeeper/lib/commons-cli-commons-cli-1.2.jar:/opt/bookkeeper/lib/commons-codec-commons-codec-1.6.jar:/opt/bookkeeper/lib/commons-configuration-commons-configuration-1.10.jar:/opt/bookkeeper/lib/commons-io-commons-io-2.4.jar:/opt/bookkeeper/lib/commons-lang-commons-lang-2.6.jar:/opt/bookkeeper/lib/commons-logging-commons-logging-1.1.1.jar:/opt/bookkeeper/lib/io.grpc-grpc-all-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-auth-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-context-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-core-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-netty-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-okhttp-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-protobuf-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-protobuf-lite-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-protobuf-nano-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-stub-1.12.0.jar:/opt/bookkeeper/lib/io.grpc-grpc-testing-1.12.0.jar:/opt/bookkeeper/lib/io.netty-netty-buffer-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-dns-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-http-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-http2-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-codec-socks-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-common-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-handler-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-handler-proxy-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-resolver-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-resolver-dns-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-tcnative-boringssl-static-2.0.19.Final.jar:/opt/bookkeeper/lib/io.netty-netty-transport-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-transport-native-epoll-4.1.31.Final.jar:/opt/bookkeeper/lib/io.netty-netty-transport-native-unix-common-4.1.31.Final.jar:/opt/bookkeeper/lib/io.opencensus-opencensus-api-0.11.0.jar:/opt/bookkeeper/lib/io.opencensus-opencensus-contrib-grpc-metrics-0.11.0.jar:/opt/bookkeeper/lib/io.prometheus-simpleclient-0.0.21.jar:/opt/bookkeeper/lib/io.prometheus-simpleclient_common-0.0.21.jar:/opt/bookkeeper/lib/io.prometheus-simpleclient_hotspot-0.0.21.jar:/opt/bookkeeper/lib/io.prometheus-simpleclient_servlet-0.0.21.jar:/opt/bookkeeper/lib/io.vertx-vertx-auth-common-3.4.1.jar:/opt/bookkeeper/lib/io.vertx-vertx-core-3.4.1.jar:/opt/bookkeeper/lib/io.vertx-vertx-web-3.4.1.jar:/opt/bookkeeper/lib/javax.servlet-javax.servlet-api-3.1.0.jar:/opt/bookkeeper/lib/jline-jline-2.11.jar:/opt/bookkeeper/lib/log4j-log4j-1.2.17.jar:/opt/bookkeeper/lib/net.java.dev.jna-jna-3.2.7.jar:/opt/bookkeeper/lib/net.jpountz.lz4-lz4-1.3.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-common-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-common-allocator-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-proto-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-tools-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-tools-framework-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-bookkeeper-tools-ledger-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-circe-checksum-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-cpu-affinity-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-statelib-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-cli-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-java-client-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-server-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-service-api-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper-stream-storage-service-impl-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.http-http-server-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.http-vertx-http-server-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.stats-bookkeeper-stats-api-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.stats-prometheus-metrics-provider-4.9.0.jar:/opt/bookkeeper/lib/org.apache.bookkeeper.tests-stream-storage-tests-common-4.9.0.jar:/opt/bookkeeper/lib/org.apache.commons-commons-collections4-4.1.jar:/opt/bookkeeper/lib/org.apache.commons-commons-lang3-3.6.jar:/opt/bookkeeper/lib/org.apache.curator-curator-client-4.0.1.jar:/opt/bookkeeper/lib/org.apache.curator-curator-framework-4.0.1.jar:/opt/bookkeeper/lib/org.apache.curator-curator-recipes-4.0.1.jar:/opt/bookkeeper/lib/org.apache.distributedlog-distributedlog-common-4.9.0.jar:/opt/bookkeeper/lib/org.apache.distributedlog-distributedlog-core-4.9.0-tests.jar:/opt/bookkeeper/lib/org.apache.distributedlog-distributedlog-core-4.9.0.jar:/opt/bookkeeper/lib/org.apache.distributedlog-distributedlog-protocol-4.9.0.jar:/opt/bookkeeper/lib/org.apache.yetus-audience-annotations-0.5.0.jar:/opt/bookkeeper/lib/org.apache.zookeeper-zookeeper-3.4.13.jar:/opt/bookkeeper/lib/org.codehaus.jackson-jackson-core-asl-1.9.11.jar:/opt/bookkeeper/lib/org.codehaus.jackson-jackson-mapper-asl-1.9.11.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-http-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-io-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-security-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-server-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-servlet-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.eclipse.jetty-jetty-util-9.4.5.v20170502.jar:/opt/bookkeeper/lib/org.inferred-freebuilder-1.14.9.jar:/opt/bookkeeper/lib/org.jctools-jctools-core-2.1.2.jar:/opt/bookkeeper/lib/org.rocksdb-rocksdbjni-5.13.1.jar:/opt/bookkeeper/lib/org.slf4j-slf4j-api-1.7.25.jar:/opt/bookkeeper/lib/org.slf4j-slf4j-log4j12-1.7.25.jar:\r\n2019-12-11 11:03:20,220 - INFO  - [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib\r\n2019-12-11 11:03:20,222 - INFO  - [main:Environment@100] - Client environment:java.io.tmpdir=/tmp\r\n2019-12-11 11:03:20,222 - INFO  - [main:Environment@100] - Client environment:java.compiler=<NA>\r\n2019-12-11 11:03:20,222 - INFO  - [main:Environment@100] - Client environment:os.name=Linux\r\n2019-12-11 11:03:20,222 - INFO  - [main:Environment@100] - Client environment:os.arch=amd64\r\n2019-12-11 11:03:20,222 - INFO  - [main:Environment@100] - Client environment:os.version=4.15.0-70-generic\r\n2019-12-11 11:03:20,223 - INFO  - [main:Environment@100] - Client environment:user.name=bookkeeper\r\n2019-12-11 11:03:20,223 - INFO  - [main:Environment@100] - Client environment:user.home=/home/bookkeeper\r\n2019-12-11 11:03:20,223 - INFO  - [main:Environment@100] - Client environment:user.dir=/opt/bookkeeper\r\n2019-12-11 11:03:20,226 - INFO  - [main:ZooKeeper@442] - Initiating client connection, connectString=zookeeper:2181 sessionTimeout=10000 watcher=org.apache.bookkeeper.zookeeper.ZooKeeperWatcherBase@2e55dd0c\r\n2019-12-11 11:03:20,250 - INFO  - [main-SendThread(zookeeper:2181):ClientCnxn$SendThread@1029] - Opening socket connection to server zookeeper/192.168.48.2:2181. Will not attempt to authenticate using SASL (unknown error)\r\n2019-12-11 11:03:20,256 - INFO  - [main-SendThread(zookeeper:2181):ClientCnxn$SendThread@879] - Socket connection established to zookeeper/192.168.48.2:2181, initiating session\r\n2019-12-11 11:03:20,270 - INFO  - [main-SendThread(zookeeper:2181):ClientCnxn$SendThread@1303] - Session establishment complete on server zookeeper/192.168.48.2:2181, sessionid = 0x1000fd21e490009, negotiated timeout = 10000\r\n2019-12-11 11:03:20,274 - INFO  - [main-EventThread:ZooKeeperWatcherBase@130] - ZooKeeper client is connected now.\r\n2019-12-11 11:03:20,304 - ERROR - [main:ZKRegistrationManager@379] - BookKeeper metadata doesn't exist in zookeeper. Has the cluster been initialized? Try running bin/bookkeeper shell metaformat\r\n2019-12-11 11:03:20,304 - INFO  - [main:BookieNettyServer@424] - Shutting down BookieNettyServer\r\n2019-12-11 11:03:20,317 - ERROR - [main:Main@223] - Failed to build bookie server\r\norg.apache.bookkeeper.bookie.BookieException$MetadataStoreException: Failed to get cluster instance id\r\n\tat org.apache.bookkeeper.discover.ZKRegistrationManager.getClusterInstanceId(ZKRegistrationManager.java:392)\r\n\tat org.apache.bookkeeper.bookie.Bookie.checkEnvironmentWithStorageExpansion(Bookie.java:408)\r\n\tat org.apache.bookkeeper.bookie.Bookie.checkEnvironment(Bookie.java:252)\r\n\tat org.apache.bookkeeper.bookie.Bookie.<init>(Bookie.java:691)\r\n\tat org.apache.bookkeeper.proto.BookieServer.newBookie(BookieServer.java:137)\r\n\tat org.apache.bookkeeper.proto.BookieServer.<init>(BookieServer.java:106)\r\n\tat org.apache.bookkeeper.server.service.BookieService.<init>(BookieService.java:43)\r\n\tat org.apache.bookkeeper.server.Main.buildBookieServer(Main.java:301)\r\n\tat org.apache.bookkeeper.server.Main.doMain(Main.java:221)\r\n\tat org.apache.bookkeeper.server.Main.main(Main.java:203)\r\nCaused by: org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for BookKeeper metadata\r\n\tat org.apache.bookkeeper.discover.ZKRegistrationManager.getClusterInstanceId(ZKRegistrationManager.java:382)\r\n\t... 9 more\r\n```\r\n\r\n***Additional context***\r\nBookkeeper branch: release-4.10.0-docker, locally compiled before trying to run example.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 2, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"93b4afa082bfd4af153b1a9f9dcfa938ce6f8bd8": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}, "092ebf2a7ec596db0357a072caf123b18a7f29e6": {"commitUser": "eolivelli", "commitGHEventType": "closed"}, "f8ae7e27140ffb76c43c8325cd7f5a10b96f7ecf": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}}, "closed": "2020-05-04 10:18:46", "url": "https://github.com/apache/bookkeeper/issues/2212", "user": "pedro93", "ttf": 144.00027777777777}, {"created": "2019-11-01 05:06:12", "closed": "2020-01-26 19:13:07", "title": "Creating namespace throws error", "url": "https://github.com/apache/bookkeeper/issues/2194", "body": "**BUG REPORT**\r\n\r\nWhen trying to create a Distributed Log Namespace an error \"java.io.IOException: No bkdl config bound under dl path\"  is thrown.\r\n\r\n***To Reproduce***\r\nRun local bookkeeper \r\n\r\n`DistributedLogConfiguration distributedLogConfiguration = new DistributedLogConfiguration()\r\n                .setCreateStreamIfNotExists(true)\r\n                .setExplicitTruncationByApplication(true)\r\n                .setLogSegmentRollingIntervalMinutes(-1);\r\n\r\n        URI uri = new URI(\"distributedlog://127.0.0.1:2181/test/path\");\r\n        Namespace namespace = NamespaceBuilder.newBuilder()\r\n                                              .uri(uri)\r\n                                              .conf(distributedLogConfiguration)\r\n                                              .build();`\r\n\r\n***Expected behavior***\r\n\r\nCode completes without error.\r\n\r\n***Additional context***\r\n\r\nStack trace.. \r\n`java.io.IOException: No bkdl config bound under dl path : /test/path\r\n\r\n\tat org.apache.distributedlog.impl.metadata.ZkMetadataResolver.resolve(ZkMetadataResolver.java:74)\r\n\tat org.apache.distributedlog.impl.metadata.BKDLConfig.resolveDLConfig(BKDLConfig.java:71)\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.initializeZooKeeperClients(BKNamespaceDriver.java:234)\r\n\tat org.apache.distributedlog.impl.BKNamespaceDriver.initialize(BKNamespaceDriver.java:203)\r\n\tat org.apache.distributedlog.api.namespace.NamespaceBuilder.build(NamespaceBuilder.java:239)\r\n\tat com.mindsignited.continuum.internal.core.api.event.BkDistributedLogTest.testCreateBkLog(BkDistributedLogTest.java:34)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)\r\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)\r\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat org.springframework.test.context.junit4.statements.RunBeforeTestExecutionCallbacks.evaluate(RunBeforeTestExecutionCallbacks.java:74)\r\n\tat org.springframework.test.context.junit4.statements.RunAfterTestExecutionCallbacks.evaluate(RunAfterTestExecutionCallbacks.java:84)\r\n\tat org.springframework.test.context.junit4.statements.RunBeforeTestMethodCallbacks.evaluate(RunBeforeTestMethodCallbacks.java:75)\r\n\tat org.springframework.test.context.junit4.statements.RunAfterTestMethodCallbacks.evaluate(RunAfterTestMethodCallbacks.java:86)\r\n\tat org.springframework.test.context.junit4.statements.SpringRepeat.evaluate(SpringRepeat.java:84)\r\n\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)\r\n\tat org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:251)\r\n\tat org.springframework.test.context.junit4.SpringJUnit4ClassRunner.runChild(SpringJUnit4ClassRunner.java:97)\r\n\tat org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)\r\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)\r\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)\r\n\tat org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)\r\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)\r\n\tat org.springframework.test.context.junit4.statements.RunBeforeTestClassCallbacks.evaluate(RunBeforeTestClassCallbacks.java:61)\r\n\tat org.springframework.test.context.junit4.statements.RunAfterTestClassCallbacks.evaluate(RunAfterTestClassCallbacks.java:70)\r\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:363)\r\n\tat org.springframework.test.context.junit4.SpringJUnit4ClassRunner.run(SpringJUnit4ClassRunner.java:190)\r\n\tat org.junit.runner.JUnitCore.run(JUnitCore.java:137)\r\n\tat com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)\r\n\tat com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)\r\n\tat com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)\r\n\tat com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)`\r\n", "commits": {}, "user": "NavidMitchell", "commitsDetails": [], "labels": ["type/bug"], "ttf": 86.00027777777778}, {"created": "2019-10-15 03:25:28", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "JournalChannel.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.JournalChannel.openFileChannel(java.io.RandomAccessFile)"}, {"INS": 1, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.JournalChannel"}]}, {"spoonFilePath": "BookieJournalTest.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieJournalTest"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieJournalTest.testJournalScanIOException()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieJournalTest.DummyJournalScan"}]}], "nameRev": "9d6f5db2da75da2050ec753b4a3e7784f90c7c37 remotes/origin/dependabot/bundler/site/nokogiri-1.10.8~3", "commitHash": "9d6f5db2da75da2050ec753b4a3e7784f90c7c37", "commitMessage": "2178: IOException Should Be Thrown When Journal Is Corrupted\n\nFixes #2178 \n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>,  Sijie Guo <sijie@apache.org>\n\nThis closes #2257 from atris/2176", "commitGitStats": [{"lines": 60, "deletions": 0, "insertions": 60, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieJournalTest.java"}, {"lines": 17, "deletions": 2, "insertions": 15, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/JournalChannel.java"}], "commitParents": ["b94d3fbb7540618e13781b3db14e2d2bcb2c823d"], "commitDateTime": "2020-03-06 08:15:15", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-03-06 12:33:15"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "triage/week-4", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "JournalChannel should throw IOException if it cannot seek to desired position", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\n\r\nHere's a piece of code from `JournalChannel.java`\r\n```\r\ntry {\r\n    if (position == START_OF_FILE) {\r\n        if (formatVersion >= V5) {\r\n            fc.position(HEADER_SIZE);\r\n        } else if (formatVersion >= V2) {\r\n            fc.position(VERSION_HEADER_SIZE);\r\n        } else {\r\n            fc.position(0);\r\n        }\r\n    } else {\r\n        fc.position(position);\r\n    }\r\n} catch (IOException e) {\r\n    LOG.error(\"Bookie journal file can seek to position :\", e); <-- Swallows IOException and moves on\r\n}\r\n```\r\n\r\n***To Reproduce***\r\n\r\nCreate a corrupt journal file. Try seeking to the desired position.\r\n\r\n***Expected behavior***\r\n\r\nIOException should be thrown and bookie should be shutdown. Not sure if a retry would help. It's not really recoverable since journal file is corrupted. \r\n\r\n@reddycharan @jvrao @eolivelli Another potential problem?", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"9d6f5db2da75da2050ec753b4a3e7784f90c7c37": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}}, "closed": "2020-03-06 07:15:16", "url": "https://github.com/apache/bookkeeper/issues/2178", "user": "karanmehta93", "ttf": 143.00027777777777}, {"created": "2019-10-11 01:21:29", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BookieJournalTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieJournalTest.writeV5Journal(java.io.File,int,byte[])"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieJournalTest.writeV5Journal(java.io.File,int,byte[],boolean)"}]}, {"spoonFilePath": "BookieInitializationTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest.testNegativeLengthEntryBookieShutdown()"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest.testBookieStartException()"}]}, {"spoonFilePath": "Journal.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 6, "MOV": 2, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.Journal.scanJournal(long,long,org.apache.bookkeeper.bookie.Journal$JournalScanner)"}]}], "nameRev": "14c445dae3976ec314ec7d1bac0e2d30a9d0e4c0 tags/release-4.10.0~8", "commitHash": "14c445dae3976ec314ec7d1bac0e2d30a9d0e4c0", "commitMessage": "Journal scan should throw IOException when it reads negative length\n\nDescriptions of the changes in this PR:\r\n\r\n### Motivation\r\n\r\nDuring journal replay, we can encounter negative length value if there is journal corruption. Currently, due to this bug, we pass negative length to limit a buffer, which throws IllegalArgumentException.\r\n\r\n### Changes\r\n\r\nUpdated the Journal class to throw `IOException` with a clear message, instead of unclear `IllegalArgumentException`.\r\n\r\nMaster Issue: #2176\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Charan Reddy Guttapalem <reddycharan18@gmail.com>\n\nThis closes #2177 from karanmehta93/master", "commitGitStats": [{"lines": 7, "deletions": 3, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Journal.java"}, {"lines": 37, "deletions": 1, "insertions": 36, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieInitializationTest.java"}, {"lines": 14, "deletions": 2, "insertions": 12, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieJournalTest.java"}], "commitParents": ["4872b1f2bbdb0cdde72ed7922b8de25dc17f58de"], "commitDateTime": "2019-10-24 14:39:01", "commitUser": "reddycharan", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-10-24 14:39:01"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "triage/week-4", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Journal scan should throw IOException when it reads negative length", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\n\r\nDuring journal replay, we can encounter negative length value if there is journal corruption. Currently, due to this bug, we pass negative length to limit a buffer, which throws `IllegalArgumentException`.\r\n\r\n***To Reproduce***\r\n\r\nMinor bug, good to have for debugging.\r\n\r\n***Expected behavior***\r\n\r\nError handling should be done via IOExpection, and it should be thrown instead.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"14c445dae3976ec314ec7d1bac0e2d30a9d0e4c0": {"commitUser": "reddycharan", "commitGHEventType": "referenced"}}, "closed": "2020-04-04 01:28:38", "url": "https://github.com/apache/bookkeeper/issues/2176", "user": "karanmehta93", "ttf": 176.00027777777777}, {"created": "2019-09-19 02:38:12", "closed": "2019-09-19 06:06:50", "title": "decommissionbookie not  complete correctly", "url": "https://github.com/apache/bookkeeper/issues/2162", "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\n\r\nI have four bookie for pulsar now, when i close one bookie, i want to know dose it ledger has been re-replicated to other bookie. so i use the command like this:\r\n\r\n    ./bookkeeper shell decommissionbookie  --bookieid  closedbookieip:3181\r\nand then i find that looply print the follow mesages:\r\n\r\n10:34:53.292 [main] INFO  org.apache.bookkeeper.client.BookKeeperAdmin - Count of Ledgers which need to be rereplicated: 1\r\n\r\nand never stop.\r\n\r\n***To Reproduce***\r\n\r\nSteps to reproduce the behavior:\r\n1. start bookie at a new machine\r\n2. pulsar produce some message\r\n3. stop bookie at the new machine\r\n4. run command:  ./bookkeeper shell decommissionbookie  --bookieid  closedbookieip:3181\r\n\r\n***Expected behavior***\r\n\r\nI would like the following information to confirm that the bookie has been backed up:\r\n```\r\n the ledgers stored in the given decommissioning booki:xxx:3181 are properly replicated\r\n    \r\n no cookie to remove for the decommissioning bookie: xxx:3181, it could be deleted already\r\n```\r\n\r\n", "commits": {}, "user": "sydnash", "commitsDetails": [], "labels": ["type/bug"], "ttf": 0.0002777777777777778}, {"created": "2019-08-27 01:53:00", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "DiskChecker.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.util.DiskChecker.checkDiskFull(java.io.File)"}]}], "nameRev": "4487cee4f14bd495a9b02071e0bdd0fc7df0dbf6 tags/release-4.10.0~21", "commitHash": "4487cee4f14bd495a9b02071e0bdd0fc7df0dbf6", "commitMessage": "Issue #2152: Amend disk usage warn log\n\n### Motivation\r\n\r\nFixes #2152\r\n\r\n### Changes\r\n\r\nReplace `diskUsageThreshold` by `diskUsageWarnThreshold` when disk usage threshold doesn't trigger first.\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <None>\n\nThis closes #2153 from murong00/branch-2153, closes #2152", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/DiskChecker.java"}], "commitParents": ["171e2f914c05357d9e81c7e951f5c86a0f463a75"], "commitDateTime": "2019-08-26 22:47:47", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-08-27 13:47:47"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Disk usage warn log is confused", "numCommits": 0, "body": "***Describe the bug***\r\n\r\nThe following log is weird since the default value of `diskUsageWarnThreshold` is 0.90:\r\n\r\n```\r\n09:20:09.787 [LedgerDirsMonitorThread] WARN  org.apache.bookkeeper.util.DiskChecker - Space left on device data/bookkeeper/ledgers/current : 3790188544, Used space fraction: 0.91004634 > WarnThreshold 0.95.\r\n09:20:09.787 [LedgerDirsMonitorThread] WARN  org.apache.bookkeeper.bookie.LedgerDirsMonitor - Ledger directory data/bookkeeper/ledgers/current is almost full : usage 0.91004634\r\n```\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"4487cee4f14bd495a9b02071e0bdd0fc7df0dbf6": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2019-08-27 05:47:48", "url": "https://github.com/apache/bookkeeper/issues/2152", "user": "ayolivia", "ttf": 0.0002777777777777778}, {"created": "2019-08-16 09:43:16", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "Cookie.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.Cookie.encodeDirPaths(java.lang.String[])"}]}, {"spoonFilePath": "GenerateCookieCommand.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.cookie.GenerateCookieCommand.apply(org.apache.bookkeeper.discover.RegistrationManager,org.apache.bookkeeper.tools.cli.commands.cookie.GenerateCookieCommand$Flags)"}]}, {"spoonFilePath": "GenerateCookieCommandTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.cookie.GenerateCookieCommandTest.testGenerateCookieWithMultipleLedgerDirs()"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.cookie.GenerateCookieCommandTest.testGenerateCookieWithInstanceId()"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.cookie.GenerateCookieCommandTest.testGenerateCookieWithoutInstanceId()"}]}], "nameRev": "8559126a3ec00f2b1912d40d37b8bf8a000b0c4b tags/release-4.10.0~5", "commitHash": "8559126a3ec00f2b1912d40d37b8bf8a000b0c4b", "commitMessage": "Issue #2145: Make ledgerDirs in Cookie consistent across generating a\u2026\n\n\u2026nd setting\r\n\r\nDescriptions of the changes in this PR:\r\n\r\n### Motivation\r\n\r\nIn PR #1794 we brought in a way to generate a cookie from command line.\r\nHowever during generation, we have to also encode the ledger dirs by default.\r\n\r\n### Changes\r\n\r\nAdded encoding of ledger dir paths while setting the ledger dirs in a generated cookie in `GenerateCookieCommand.java`.\r\nTweaked existing test to include more than one ledger path for test coverage.\r\n\r\nMaster Issue: #2145 \n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <None>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #2146 from Ghatage/community/2145, closes #2145 and squashes the following commits:\n\n2de21f854 [Anup Ghatage] Fix checkstyle\n4695675ff [Anup Ghatage] Revert to handling encoding like in generateCookie(), Add another test\n90d02136a [Anup Ghatage] Change GenerateCookieCommandTest's to encodeDirPaths while creating cookies\nd8da5153a [Anup Ghatage] Issue #2145: Make ledgerDirs in Cookie consistent across generating and setting", "commitGitStats": [{"lines": 42, "deletions": 2, "insertions": 40, "filePath": "tools/ledger/src/test/java/org/apache/bookkeeper/tools/cli/commands/cookie/GenerateCookieCommandTest.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/tools/cli/commands/cookie/GenerateCookieCommand.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Cookie.java"}], "commitParents": ["029e8e0e02d8e384e7d08ca548b593368574cf36"], "commitDateTime": "2019-10-29 20:50:02", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-10-29 05:50:02"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "GarbageCollectorThreadTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.GarbageCollectorThreadTest"}]}], "nameRev": "eba63dbfa8c646616b55280c700d8bf5114d3cbe remotes/origin/dependabot/bundler/site/nokogiri-1.10.8~24", "commitHash": "eba63dbfa8c646616b55280c700d8bf5114d3cbe", "commitMessage": "ISSUE #2224: Config ServerConfiguration with setAllowLoopback(true) for Unit Tests\n\n### Motivation\r\n\r\nUnit test fails when build master branch\r\n\r\n### Changes\r\n\r\nConfig ServerConfiguration with setAllowLoopback(true) in the class GarbageCollectorThreadTest\r\n\r\nMaster Issue: #2224 \r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #2226 from coolbeevip/ISSUE-2224, closes #2224 and squashes the following commits:\n\nfdba4fbce [Lei Zhang] ISSUE-2224 set allowLoopback is true\n2ff7ca5af [Enrico Olivelli] Account Apache Thrift and Http Client files in LICENSE files - Fix build on Travis\n2bbf58e01 [Dapeng] Fixed bin/bookkeeper shell readjournal\n9d61fb4fe [Dapeng] [DOCS] Modify \u201cUsing Autoecovery\u201d,recover does not support the specified target bookie\n2ca4025e4 [Anup Ghatage] [DOCUMENTATION] Add doc for decommissioning bookie process\n62e3b9b6f [Enrico Olivelli] Make 4.9.2 as stable\n40f349ccf [Enrico Olivelli] Bump Python client version\nb1991e6b3 [Enrico Olivelli] Release notes for 4.10\n9f4b1359e [\u5189\u5c0f\u9f99] Fix the log level of not support Sse42Crc32C\n557dfe90f [Jennifer Huang] [DOCS] Update coding_guide.md\n43f8cd74f [Enrico Olivelli] Add -Dtwitter to fix auto-build\nf57962bcc [Matteo Merli] Removed mutex contention on BufferedChannel\nf5d2e5931 [Enrico Olivelli] Add -Dtwitter to release scripts in order to build Twitter stats providers\n7efa8e89e [Enrico Olivelli] Fix version in modules that are not active by default\nd49b46f4e [Enrico Olivelli] [maven-release-plugin] prepare for next development iteration\n5a4213bb0 [Enrico Olivelli] [maven-release-plugin] prepare branch branch-4.10\nf8a5974a5 [Charan Reddy Guttapalem] Fix firstStoredEntryId logic in LedgerFragment\n8559126a3 [Anup Ghatage] Issue #2145: Make ledgerDirs in Cookie consistent across generating a\u2026", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/GarbageCollectorThreadTest.java"}], "commitParents": ["e7dd19bb52d0654006decb383cb35ffcde928990"], "commitDateTime": "2020-01-07 16:15:28", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-01-07 16:15:28"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tools", "triage/week-33", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Using shell generate an unexpected cookie", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\n\r\nWhen I run the order \"bookkeeper shell cookie_generate\", I got a new cookie, but this new cookie is different from the other cookie in zk.\r\n\r\nOrder( It belongs to pulsar ) :\r\n./bin/bookkeeper shell cookie_generate -j data2/bookkeeper/journal -l data2/bookkeeper/ledgers -i 9285da1b-e1be-471b-8d11-d30d80212e68 -o /tmp/cookie.x 10.254.3.60:3181\r\n\r\n\r\nThe generated cookie is this:\r\n4\r\nbookieHost: \"10.254.17.8:3181\"\r\njournalDir: \"data2/bookkeeper/journal\"\r\nledgerDirs: \"data2/bookkeeper/ledgers\"\r\ninstanceId: \"3ed785b5-eb93-498c-9d57-b38ab8846e7b\"\r\n\r\nThe cookie in zk is this :\r\n4\r\nbookieHost: \"10.254.17.8:3181\"\r\njournalDir: \"data/bookkeeper/journal\"\r\nledgerDirs: \"1\\tdata/bookkeeper/ledgers\"\r\ninstanceId: \"3ed785b5-eb93-498c-9d57-b38ab8846e7b\"\r\n\r\n\r\nWe can find the difference is \"1\\t\" in two ledgerDirs, because of it, After I changed the dir and others operation, starting bookie is fail.\r\n\r\n09:26:07.829 [main] ERROR org.apache.bookkeeper.server.Main - Failed to build bookie server\r\norg.apache.bookkeeper.bookie.BookieException$InvalidCookieException: Cookie [4\r\nbookieHost: \"10.254.17.8:3181\"\r\njournalDir: \"data2/bookkeeper/journal\"\r\nledgerDirs: \"1\\tdata2/bookkeeper/ledgers\"\r\ninstanceId: \"3ed785b5-eb93-498c-9d57-b38ab8846e7b\"\r\n] is not matching with [4\r\nbookieHost: \"10.254.17.8:3181\"\r\njournalDir: \"data/bookkeeper/journal\"\r\nledgerDirs: \"1\\tdata/bookkeeper/ledgers\"\r\ninstanceId: \"3ed785b5-eb93-498c-9d57-b38ab8846e7b\"\r\n\r\n\r\n***To Reproduce***\r\n\r\nAs BUG says\r\n\r\n***Expected behavior***\r\n\r\nWhen I generate the cookie by the shell way, It should include \"1\\t\"\r\n\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 2, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"8559126a3ec00f2b1912d40d37b8bf8a000b0c4b": {"commitUser": "jiazhai", "commitGHEventType": "closed"}, "eba63dbfa8c646616b55280c700d8bf5114d3cbe": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}}, "closed": "2019-10-29 12:50:05", "url": "https://github.com/apache/bookkeeper/issues/2145", "user": "lsy180829", "ttf": 74.00027777777778}, {"created": "2019-08-16 08:14:16", "closed": "2019-08-16 09:26:51", "title": "Bookkeeper shell bookiesanity doesn't work when SASL enabled", "url": "https://github.com/apache/bookkeeper/issues/2144", "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\n\r\nAfter enable SASL on BookKeeper and Zookeeper, bookiesanity command report Unauthorized \r\n error\r\n***To Reproduce***\r\n\r\nSteps to reproduce the behavior:\r\nEnable SASL on zookeeper and bookkeeper\r\n\r\n***Expected behavior***\r\n\r\n bookkeeper shell bookiesanity work properly\r\n\r\n***Screenshots***\r\n\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n***Additional context***\r\n\r\nAdd any other context about the problem here.\r\n", "commits": {}, "user": "29x10", "commitsDetails": [], "labels": ["type/bug"], "ttf": 0.0002777777777777778}, {"created": "2019-07-26 11:38:51", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "5e5d7a386b4725324f3fcff756039feb11d7c875 remotes/origin/branch-4.8~1", "commitHash": "5e5d7a386b4725324f3fcff756039feb11d7c875", "commitMessage": "Make build pass on JDK11, fix javadoc configuration\n\n\r\nDescriptions of the changes in this PR:\r\n\r\n### Motivation\r\n\r\nBuild fails on recent JDK11 versions and on JDK11, see #2133, this is because javadoc has problems with references to core Java API when source version is set to 8.\r\n\r\n### Changes\r\nUpgrade Java doc plugin to latest 3.1.1 and disable auto linking to core Java classes with\r\n`<detectJavaApiLink>false</detectJavaApiLink>\r\n`\r\nCloses #2133\r\n\r\n\r\n\n\nReviewers: Sijie Guo <None>\n\nThis closes #2134 from eolivelli/fix/javadoc-jdk11\n\n(cherry picked from commit 5311e00f399ae3b5cb39fe03d8b5dd8c0547de14)\nSigned-off-by: eolivelli <eolivelli@apache.org>\n", "commitGitStats": [{"lines": 3, "deletions": 1, "insertions": 2, "filePath": "pom.xml"}], "commitParents": ["ba6e6f12588144eda6bcb4d3f16ae67f089d0d54"], "commitDateTime": "2019-07-27 14:47:59", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-07-27 14:47:07"}, {"commitSpoonAstDiffStats": [], "nameRev": "d2cd48a9f681a31d711ee855d5de41f84f307236 remotes/origin/branch-4.9~5", "commitHash": "d2cd48a9f681a31d711ee855d5de41f84f307236", "commitMessage": "Make build pass on JDK11, fix javadoc configuration\n\n\r\nDescriptions of the changes in this PR:\r\n\r\n### Motivation\r\n\r\nBuild fails on recent JDK11 versions and on JDK11, see #2133, this is because javadoc has problems with references to core Java API when source version is set to 8.\r\n\r\n### Changes\r\nUpgrade Java doc plugin to latest 3.1.1 and disable auto linking to core Java classes with\r\n`<detectJavaApiLink>false</detectJavaApiLink>\r\n`\r\nCloses #2133\r\n\r\n\r\n\n\nReviewers: Sijie Guo <None>\n\nThis closes #2134 from eolivelli/fix/javadoc-jdk11\n\n(cherry picked from commit 5311e00f399ae3b5cb39fe03d8b5dd8c0547de14)\nSigned-off-by: eolivelli <eolivelli@apache.org>\n", "commitGitStats": [{"lines": 3, "deletions": 1, "insertions": 2, "filePath": "pom.xml"}], "commitParents": ["a35e6c157745a86da6e71da8b2711995a322f09b"], "commitDateTime": "2019-07-27 14:47:34", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-07-27 14:47:07"}, {"commitSpoonAstDiffStats": [], "nameRev": "5311e00f399ae3b5cb39fe03d8b5dd8c0547de14 tags/release-4.10.0~32", "commitHash": "5311e00f399ae3b5cb39fe03d8b5dd8c0547de14", "commitMessage": "Make build pass on JDK11, fix javadoc configuration\n\n\r\nDescriptions of the changes in this PR:\r\n\r\n### Motivation\r\n\r\nBuild fails on recent JDK11 versions and on JDK11, see #2133, this is because javadoc has problems with references to core Java API when source version is set to 8.\r\n\r\n### Changes\r\nUpgrade Java doc plugin to latest 3.1.1 and disable auto linking to core Java classes with\r\n`<detectJavaApiLink>false</detectJavaApiLink>\r\n`\r\nCloses #2133\r\n\r\n\r\n\n\nReviewers: Sijie Guo <None>\n\nThis closes #2134 from eolivelli/fix/javadoc-jdk11", "commitGitStats": [{"lines": 3, "deletions": 1, "insertions": 2, "filePath": "pom.xml"}], "commitParents": ["86e8a72c7fcfb38b76bcbf434df586f3dc00a2af"], "commitDateTime": "2019-07-27 14:47:07", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-07-27 14:47:07"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Build fails on recent JDK11 versions", "numCommits": 0, "body": "CI started reporting errors about javadocs.\r\nI can reproduce the same error on JDK11 and JDK22.\r\nEven upgrading the javadoc plugin does not help.\r\nI will try to send a fix soon\r\n\r\n```\r\n[INFO] Total time:  01:43 min\r\n[INFO] Finished at: 2019-07-25T21:41:14Z\r\n[INFO] ------------------------------------------------------------------------\r\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-javadoc-plugin:3.0.0:jar (attach-javadocs) on project bookkeeper-stats-api: MavenReportException: Error while generating Javadoc: \r\n[ERROR] Exit code: 1 - javadoc: error - The code being documented uses modules but the packages defined in https://docs.oracle.com/javase/8/docs/api/ are in the unnamed module.\r\n[ERROR] \r\n[ERROR] Command line was: /usr/local/lib/jvm/openjdk11/bin/javadoc @options\r\n[ERROR] \r\n[ERROR] Refer to the generated Javadoc files in '/home/travis/build/apache/bookkeeper/bookkeeper-stats/target/apidocs' dir.\r\n[ERROR] -> [Help 1]\r\n[ERROR] \r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 2, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"5e5d7a386b4725324f3fcff756039feb11d7c875": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}, "d2cd48a9f681a31d711ee855d5de41f84f307236": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}, "5311e00f399ae3b5cb39fe03d8b5dd8c0547de14": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}}, "closed": "2019-07-27 12:47:08", "url": "https://github.com/apache/bookkeeper/issues/2133", "user": "eolivelli", "ttf": 1.0002777777777778}, {"created": "2019-07-23 17:14:06", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "38e0c2d3ccc1a3f31c6c1f47c5ab059962eb1a8b tags/release-4.10.0~31", "commitHash": "38e0c2d3ccc1a3f31c6c1f47c5ab059962eb1a8b", "commitMessage": "Issue #2130 : Fix for broken URLs\n\nFixed broken URLs in README for Programmer Guide, Tutorial and Java API.\r\n\r\nDescriptions of the changes in this PR:\r\n\r\nUpdated the URLs.\r\n\r\n### Motivation\r\nWanted to go through the tutorial when I came to the repo and found the links were broken in the README.\r\n### Changes\r\n\r\n\r\nMaster Issue: #2130\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <None>\n\nThis closes #2131 from pavankumarchaitanya/master, closes #2130", "commitGitStats": [{"lines": 6, "deletions": 3, "insertions": 3, "filePath": "README.md"}], "commitParents": ["5311e00f399ae3b5cb39fe03d8b5dd8c0547de14"], "commitDateTime": "2019-07-27 14:48:56", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-07-27 05:48:56"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "broken URLs in README for Programmer Guide, Tutorial and Java API", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\nBroken URLs in README for Programmer Guide, Tutorial and Java API\r\n\r\n***To Reproduce***\r\n\r\nSteps to reproduce the behavior:\r\n1. Go to https://github.com/apache/bookkeeper\r\n2. Click on Programmer Guide\r\n3. URL opens http://bookkeeper.apache.org/docs/master/bookkeeperProgrammer.html\r\n4. See error as below: \r\nNot Found\r\nThe requested URL /docs/master/bookkeeperProgrammer.html was not found on this server.\r\n\r\n5. Same issue with Tutorial and Java API links\r\n\r\n\r\n***Expected behavior***\r\nExpect to open pages relevant to Programmer Guide/Tutorial/Java API for users visiting GitHub page of bookkeeper\r\n\r\n***Screenshots***\r\nAttached are screenshots.\r\n![image](https://user-images.githubusercontent.com/1131854/61732475-89993500-ad32-11e9-9772-267a5cd47cb9.png)\r\n![image](https://user-images.githubusercontent.com/1131854/61732484-8e5de900-ad32-11e9-8a7b-89db0a47f99e.png)\r\n\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"38e0c2d3ccc1a3f31c6c1f47c5ab059962eb1a8b": {"commitUser": "eolivelli", "commitGHEventType": "closed"}}, "closed": "2019-07-27 12:49:01", "url": "https://github.com/apache/bookkeeper/issues/2130", "user": "pavankumarchaitanya", "ttf": 3.000277777777778}, {"created": "2019-07-17 09:55:33", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0.0, "DEL": 0.0, "TOT": 0.0, "spoonMethodsChanged": 0, "MOV": 0.0, "UPD": 0.0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "ListBookiesCommandTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testListNoArgs()"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testListReadWriteLongArgs()"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testListReadWriteShortArgs()"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testListReadOnlyShortArgs()"}, {"INS": 2, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testListTwoFlagsCoexistsShortArgs()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testListAllShortArgs()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testListAllLongArgs()"}, {"INS": 4, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.setup()"}, {"INS": 2, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testListTwoFlagsCoexistsLongArgs()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testCommand(boolean,boolean,boolean,java.lang.String[])"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testListReadOnlyLongArgs()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testCommand(boolean,boolean,java.lang.String[])"}]}], "nameRev": "5a3fa848f1817d447446f8250de559d631b81487 tags/release-4.10.0~34", "commitHash": "5a3fa848f1817d447446f8250de559d631b81487", "commitMessage": "Issue #2124: Test 'ListBookiesCommand ' is failing\n\nIntroduced and fixed the tests involving the ListBookiesCommand\r\n\r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <None>\n\nThis closes #2125 from mino181295/fix/test-cmd-list, closes #2124", "commitGitStats": [{"lines": 57, "deletions": 10, "insertions": 47, "filePath": "tools/ledger/src/test/java/org/apache/bookkeeper/tools/cli/commands/bookies/ListBookiesCommandTest.java"}], "commitParents": ["df24f672ae7d0f9503980cd0a8f782470f6e663b"], "commitDateTime": "2019-07-21 14:14:52", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-07-21 08:14:52"}, {"commitSpoonAstDiffStats": [], "nameRev": "86e8a72c7fcfb38b76bcbf434df586f3dc00a2af tags/release-4.10.0~33", "commitHash": "86e8a72c7fcfb38b76bcbf434df586f3dc00a2af", "commitMessage": "Implementation of new scrutiny - replicas check (Part-1)\n\nDescriptions of the changes in this PR:\r\n\r\n- this is implementation of scrutiny mentioned in\r\nhttps://github.com/apache/bookkeeper/blob/master/site/bps/BP-34-cluster-metadata-checker.md\r\n- In this commit, urLedgersElapsedRecoveryGracePeriod check is added to placementPolicyCheck.\r\n- new scrutiny is added replicasCheck and it is disabled by default.\r\n- this is first part of replicas check, in this part currently metrics are not added and\r\nalso delayed replicas check for potentially faulty ledgers (failure in trying to get\r\ninfo. from Bookie of the ensembles of the ledger) is not added.\r\n- have to add more failure test scenarios for replicas check logic.\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <None>\n\nThis closes #2120 from reddycharan/replicascheck and squashes the following commits:\n\nd4dc81e15 [Sijie Guo] Merge remote-tracking branch 'apache/master' into replicascheck\n5a3fa848f [Matteo Minardi] Issue #2124: Test 'ListBookiesCommand ' is failing\ndf24f672a [vzhikserg] Use bulk operation instead of iteration\n2a1cfe249 [vzhikserg] Fix log statements with incorrect placeholders", "commitGitStats": [{"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorLedgerCheckerTest.java"}, {"lines": 18, "deletions": 0, "insertions": 18, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java"}, {"lines": 46, "deletions": 0, "insertions": 46, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/RoundRobinDistributionScheduleTest.java"}, {"lines": 40, "deletions": 0, "insertions": 40, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookKeeperAdminTest.java"}, {"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-proto/src/main/proto/DataFormats.proto"}, {"lines": 130, "deletions": 0, "insertions": 130, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorPlacementPolicyCheckTest.java"}, {"lines": 115, "deletions": 27, "insertions": 88, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java"}, {"lines": 869, "deletions": 21, "insertions": 848, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java"}, {"lines": 57, "deletions": 1, "insertions": 56, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/AvailabilityOfEntriesOfLedger.java"}, {"lines": 8, "deletions": 0, "insertions": 8, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/ReplicationStats.java"}, {"lines": 50, "deletions": 0, "insertions": 50, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java"}, {"lines": 29, "deletions": 0, "insertions": 29, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/LedgerUnderreplicationManager.java"}, {"lines": 110, "deletions": 0, "insertions": 110, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/util/AvailabilityOfEntriesOfLedgerTest.java"}, {"lines": 1, "deletions": 0, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/BookKeeperConstants.java"}, {"lines": 109, "deletions": 0, "insertions": 109, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorPeriodicCheckTest.java"}, {"lines": 6, "deletions": 0, "insertions": 6, "filePath": "site/_data/config/bk_server.yaml"}, {"lines": 32, "deletions": 1, "insertions": 31, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java"}, {"lines": 15, "deletions": 0, "insertions": 15, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/TestLedgerUnderreplicationManager.java"}], "commitParents": ["5a3fa848f1817d447446f8250de559d631b81487"], "commitDateTime": "2019-07-21 13:28:55", "commitUser": "reddycharan", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "tooManyChanges", "authoredDateTime": "2019-07-21 13:28:55"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Test 'ListBookiesCommand ' is failing", "numCommits": 0, "body": "Test are failing on CI on current master on test ListBookiesCommand due to #2114 which is apparently flaky\r\n\r\n```\r\n2019-07-17 08:06:48,027 - ERROR - [main:DiscoveryCommand@61] - Fail to process command 'list'\r\njava.lang.NullPointerException\r\n\tat org.apache.bookkeeper.common.concurrent.FutureUtils.result(FutureUtils.java:72)\r\n\tat org.apache.bookkeeper.common.concurrent.FutureUtils.result(FutureUtils.java:61)\r\n\tat org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommand.run(ListBookiesCommand.java:103)\r\n\tat org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommand.run(ListBookiesCommand.java:39)\r\n\tat org.apache.bookkeeper.tools.cli.helpers.DiscoveryCommand.apply(DiscoveryCommand.java:57)\r\n\tat org.apache.bookkeeper.tools.cli.helpers.ClientCommand.apply(ClientCommand.java:54)\r\n\tat org.apache.bookkeeper.tools.common.BKCommand.apply(BKCommand.java:94)\r\n\tat org.apache.bookkeeper.tools.common.BKCommand.lambda$apply$0(BKCommand.java:49)\r\n\tat org.apache.bookkeeper.tools.framework.Cli.run(Cli.java:224)\r\n\tat org.apache.bookkeeper.tools.framework.Cli.runCli(Cli.java:244)\r\n\tat org.apache.bookkeeper.tools.common.BKCommand.apply(BKCommand.java:51)\r\n\tat org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testCommand(ListBookiesCommandTest.java:157)\r\n\tat org.apache.bookkeeper.tools.cli.commands.bookies.ListBookiesCommandTest.testListNoArgs(ListBookiesCommandTest.java:135)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.junit.internal.runners.TestMethod.invoke(TestMethod.java:68)\r\n\tat org.powermock.modules.junit4.internal.impl.PowerMockJUnit44RunnerDelegateImpl$PowerMockJUnit44MethodRunner.runTestMethod(PowerMockJUnit44RunnerDelegateImpl.java:326)\r\n\tat org.junit.internal.runners.MethodRoadie$2.run(MethodRoadie.java:89)\r\n\tat org.junit.internal.runners.MethodRoadie.runBeforesThenTestThenAfters(MethodRoadie.java:97)\r\n\tat org.powermock.modules.junit4.internal.impl.PowerMockJUnit44RunnerDelegateImpl$PowerMockJUn\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 2, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"86e8a72c7fcfb38b76bcbf434df586f3dc00a2af": {"commitUser": "reddycharan", "commitGHEventType": "referenced"}, "5a3fa848f1817d447446f8250de559d631b81487": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2019-07-21 06:14:58", "url": "https://github.com/apache/bookkeeper/issues/2124", "user": "eolivelli", "ttf": 3.000277777777778}, {"created": "2019-05-31 07:07:40", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "ZKContainer.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.tests.containers.ZKContainer.start()"}]}], "nameRev": "fe25574edc80f7c53141a0bd610bcf26d6b9b8d8 remotes/origin/branch-4.11~29", "commitHash": "fe25574edc80f7c53141a0bd610bcf26d6b9b8d8", "commitMessage": "Issue #2106: Update ZookKeeper dependency to 3.5.7\n\nDescriptions of the changes in this PR:\r\nUpdated ZooKeeper dependency from 3.4.13 to 3.5.7\r\nExcluded transitive dependency to netty-all.\r\nUpdated maven-shade-pluging configuration in 'distributedlog-core-shaded' project. Package 'org.apache.jute' was moved to a ZooKeeper dependency (org.apache.zookeeper:zookeeper-jute), so i added the artifact to the artifactSet.\r\n\r\nUpdated license files:\r\n- updated Zookeeper to 3.5.7\r\n- removed Jline 2.11\r\n- removed Netty 3.10.1\r\n- added Zookeeper-jute 3.5.7\r\n\r\nMaster Issue: #2106 \r\n\r\n\n\nReviewers: Matteo Minardi <minardi.matteo@hotmail.it>, Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <zhaijia@apache.org>\n\nThis closes #2112 from dmercuriali/fix/#2106-update-zookeeper, closes #2106", "commitGitStats": [{"lines": 5, "deletions": 2, "insertions": 3, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-server.bin.txt"}, {"lines": 5, "deletions": 2, "insertions": 3, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-bkctl.bin.txt"}, {"lines": 5, "deletions": 2, "insertions": 3, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-all.bin.txt"}, {"lines": 7, "deletions": 2, "insertions": 5, "filePath": "tests/integration-tests-topologies/src/main/java/org/apache/bookkeeper/tests/containers/ZKContainer.java"}, {"lines": 3, "deletions": 2, "insertions": 1, "filePath": "shaded/distributedlog-core-shaded/pom.xml"}, {"lines": 6, "deletions": 3, "insertions": 3, "filePath": "pom.xml"}], "commitParents": ["34d35f033e1ef099e60ac75a9d59aecc6c5a2001"], "commitDateTime": "2020-05-07 09:23:04", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2020-05-07 09:23:04"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/security", "triage/week-33", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Update ZookKeeper dependency to 3.5.5", "numCommits": 0, "body": "Why should update to 3.5.5 due to:  CVE-2019-0201\r\n\r\nMore information\r\nmoderate severity\r\nVulnerable versions: >= 3.5.0, < 3.5.5\r\nPatched version: 3.5.5\r\n\r\nAn issue is present in Apache ZooKeeper 1.0.0 to 3.4.13 and 3.5.0-alpha to 3.5.4-beta. ZooKeeper?s getACL() command doesn?t check any permission when retrieves the ACLs of the requested node and returns all information contained in the ACL Id field as plaintext string. DigestAuthenticationProvider overloads the Id field with the hash value that is used for user authentication. As a consequence, if Digest Authentication is in use, the unsalted hash value will be disclosed by getACL() request for unauthenticated or unprivileged users.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"fe25574edc80f7c53141a0bd610bcf26d6b9b8d8": {"commitUser": "eolivelli", "commitGHEventType": "closed"}}, "closed": "2020-05-07 07:23:07", "url": "https://github.com/apache/bookkeeper/issues/2106", "user": "eolivelli", "ttf": 342.0002777777778}, {"created": "2019-05-28 07:34:03", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "GarbageCollectorThreadTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.GarbageCollectorThreadTest"}]}, {"spoonFilePath": "GarbageCollectorThread.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.GarbageCollectorThread.compactEntryLog(org.apache.bookkeeper.bookie.EntryLogMetadata)"}]}], "nameRev": "1adc93f05954fdb06d7e8b548d606e281831924a tags/release-4.10.0~40", "commitHash": "1adc93f05954fdb06d7e8b548d606e281831924a", "commitMessage": "Issue #2103: Avoid stop of entry log compaction\n\n### Motivation\r\n\r\nAs mentioned in #2103, if an exception occurs during compaction of a specific entry log, `GarbageCollectorThread` does not perform compaction of other entry logs until the bookie server is restarted. As a result, the number of entry logs continues to increase and eventually it will run out of disk space.\r\n\r\n### Changes\r\n\r\nThe cause of the compaction stop is that the `compacting` flag remains true if `compactor.compact(entryLogMeta)` throws some exception.\r\nhttps://github.com/apache/bookkeeper/blob/b2e099bbc7b13f13825fe78ab009ca132cb3a9ba/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/GarbageCollectorThread.java#L504-L519\r\n\r\nTherefore, fixed `GarbageCollectorThread` so that it set the compaction flag to false even if compaction of a specific entry log fails.\r\n\r\nMaster Issue: #2103\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #2121 from massakam/entry-log-compaction, closes #2103", "commitGitStats": [{"lines": 14, "deletions": 4, "insertions": 10, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/GarbageCollectorThread.java"}, {"lines": 81, "deletions": 0, "insertions": 81, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/GarbageCollectorThreadTest.java"}], "commitParents": ["6b892a45f02a6d8d0b1d33235d4134d91e3ea111"], "commitDateTime": "2019-07-12 10:04:46", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-07-12 17:04:46"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Ledger directory is 100% used", "numCommits": 0, "body": "**Describe the bug**\r\nA single ledger directory is 100% used, but other directories are used very low\r\n\r\n**Screenshots**\r\n![image](https://user-images.githubusercontent.com/12592133/58229119-674f5f00-7d63-11e9-8710-f97142fd7748.png)\r\n\r\n**Heap dump**\r\nhttps://drive.google.com/open?id=11J9OQjCj-pYgJxu0MLzEWg8ge63H71Te\r\n\r\n**Bookkeeper version**\r\n4.7.2", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"1adc93f05954fdb06d7e8b548d606e281831924a": {"commitUser": "eolivelli", "commitGHEventType": "closed"}}, "closed": "2019-07-12 08:04:52", "url": "https://github.com/apache/bookkeeper/issues/2103", "user": "codelipenghui", "ttf": 45.000277777777775}, {"created": "2019-05-10 11:15:15", "closed": "2019-05-21 05:35:13", "title": "Can't use `bin/bookkeeper bookie` start a new bookie", "url": "https://github.com/apache/bookkeeper/issues/2091", "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\nWhen I start a zooKeeper then start a bookie by `bin/bookkeeper bookie`:\r\n```\r\n2019-05-10 19:11:47,590 - ERROR - [main:Main@223] - Failed to build bookie server\r\norg.apache.bookkeeper.bookie.BookieException$InvalidCookieException: instanceId 0012d8f3-ca5e-412b-ae30-a6f9514be0de is not matching with 29c8d8ac-1b55-4de2-ba7a-53b64f8b0f20\r\n\tat org.apache.bookkeeper.bookie.Cookie.verifyInternal(Cookie.java:142)\r\n\tat org.apache.bookkeeper.bookie.Cookie.verify(Cookie.java:147)\r\n\tat org.apache.bookkeeper.bookie.Bookie.verifyAndGetMissingDirs(Bookie.java:369)\r\n\tat org.apache.bookkeeper.bookie.Bookie.checkEnvironmentWithStorageExpansion(Bookie.java:432)\r\n\tat org.apache.bookkeeper.bookie.Bookie.checkEnvironment(Bookie.java:250)\r\n\tat org.apache.bookkeeper.bookie.Bookie.<init>(Bookie.java:688)\r\n\tat org.apache.bookkeeper.proto.BookieServer.newBookie(BookieServer.java:137)\r\n\tat org.apache.bookkeeper.proto.BookieServer.<init>(BookieServer.java:106)\r\n\tat org.apache.bookkeeper.server.service.BookieService.<init>(BookieService.java:43)\r\n\tat org.apache.bookkeeper.server.Main.buildBookieServer(Main.java:301)\r\n\tat org.apache.bookkeeper.server.Main.doMain(Main.java:221)\r\n\tat org.apache.bookkeeper.server.Main.main(Main.java:203)\r\n```\r\nzookkeeper\r\n\r\n```\r\n[zk: localhost:2181(CONNECTED) 4] get /ledgers/INSTANCEID\r\n0012d8f3-ca5e-412b-ae30-a6f9514be0de\r\n```\r\n***To Reproduce***\r\n\r\n1. start a zooKeeper server\r\n2. start a bookie by `bin/bookkeeper bookie`\r\n", "commits": {}, "user": "zymap", "commitsDetails": [], "labels": ["type/bug"], "ttf": 10.000277777777777}, {"created": "2019-05-01 08:58:46", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "7fbd3620a09852e5ac7a4c206bcf2d070151db03 tags/release-4.10.0~57", "commitHash": "7fbd3620a09852e5ac7a4c206bcf2d070151db03", "commitMessage": "[SITE] modify nettyMaxFrameSizeBytes Description\n\nDescriptions of the changes in this PR:\r\n\r\nFixes #2079\r\n\r\n### Motivation\r\nwhen the client-side attempt to send more than the default size bytes, it should set up the corresponding parameter `setNettyMaxFrameSizeBytes(int maxSize)`\r\n\r\n(Explain: why you're making that change, what is the problem you're trying to solve)\r\n\r\nMaster Issue: #2079 \r\n\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #2086 from hellozepp/issue-2079", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/_data/config/bk_server.yaml"}], "commitParents": ["36be8362399341022c8de64f9319270726df2cb3"], "commitDateTime": "2019-05-20 10:45:34", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-05-20 10:45:35"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Modifying configuration `nettyMaxFrameSizeBytes` does not work", "numCommits": 0, "body": "**BUG REPORT**\r\nconfiguration `nettyMaxFrameSizeBytes` does not work \r\n***Describe the bug***\r\nI tried to modify the configuration of bk_server to nettyMaxFrameSizeBytes=52428800(50M).I modified the bookie server-side configuration file conf/bk_server.conf, and then restart the bookkeeper service, Sending 5M data addEntry can be successful, but the following exception occurred when readEntries:\r\n```\r\n2019-04-29 15:10:37,498 - ERROR - [bookie-io-1-2:BookieRequestHandler@70] - Unhandled exception occurred in I/O thread or handler\r\njava.io.IOException: Connection reset by peer\r\n\tat sun.nio.ch.FileDispatcherImpl.read0(Native Method)\r\n\tat sun.nio.ch.SocketDispatcher.read(SocketDispatcher.java:39)\r\n\tat sun.nio.ch.IOUtil.readIntoNativeBuffer(IOUtil.java:223)\r\n\tat sun.nio.ch.IOUtil.read(IOUtil.java:192)\r\n\tat sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:380)\r\n\tat io.netty.buffer.PooledUnsafeDirectByteBuf.setBytes(PooledUnsafeDirectByteBuf.java:288)\r\n\tat io.netty.buffer.AbstractByteBuf.writeBytes(AbstractByteBuf.java:1132)\r\n\tat io.netty.channel.socket.nio.NioSocketChannel.doReadBytes(NioSocketChannel.java:347)\r\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:148)\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:648)\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:583)\r\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:500)\r\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:462)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:897)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\ntest source code:\r\n```\r\n        long ledgerId = ledger.getId();\r\n        log.info(\"Writing to ledger: {}\", ledgerId);\r\n        ledger.addEntry(\"foo\".getBytes());\r\n        ledger.addEntry(new byte[5 * 1024 * 1024 + 1]);\r\n\r\n        ledger.close();\r\n\r\n        LedgerHandle lh2 = bkc.openLedger(ledgerId, DigestType.CRC32, \"foobar\".getBytes());\r\n        long lastEntry = lh2.getLastAddConfirmed();\r\n        System.out.println(\"lastEntry:\" + lastEntry);\r\n        Enumeration<LedgerEntry> entries = lh2.readEntries(0, lastEntry);\r\n```\r\nThen try to modify to less than 5M to get the information.\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"7fbd3620a09852e5ac7a4c206bcf2d070151db03": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2019-05-06 11:39:54", "url": "https://github.com/apache/bookkeeper/issues/2079", "user": "hellozepp", "ttf": 5.000277777777778}, {"created": "2019-04-28 08:19:48", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LastMarkCommand.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookie.LastMarkCommand.apply(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.tools.framework.CliFlags)"}]}], "nameRev": "ef7ba357ae73cbebd5d2c749531cc2aa766e0fc5 tags/release-4.9.2~4", "commitHash": "ef7ba357ae73cbebd5d2c749531cc2aa766e0fc5", "commitMessage": "ISSUE #2075: Bookieshell lastmark command isn't functional, always returning 0-0\n\nDescriptions of the changes in this PR:\r\n\r\n\r\n\r\n### Motivation\r\n\r\n`lastmark` shell command is to be used while debugging however currently it cannot be used since it returns incorrect value.\r\n\r\n### Changes\r\n\r\nUpdated `LedgerDirsManager` object initialization to use correct `ledgerDirs`.\r\nMaster Issue: #2075\r\n\r\n\r\n\n\nReviewers: Charan Reddy Guttapalem <reddycharan18@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #2076 from karanmehta93/ISSUE-2075, closes #2075\n\n(cherry picked from commit 707ae5c8536f967c0369f951d6178670c5dd031d)\nSigned-off-by: Charan Reddy Guttapalem <cguttapalem@salesforce.com>\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/tools/cli/commands/bookie/LastMarkCommand.java"}], "commitParents": ["bbb87cdf4801dd1815319fb92830f2c8298da5d8"], "commitDateTime": "2019-05-02 12:42:35", "commitUser": "reddycharan", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-05-02 12:38:31"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "LastMarkCommand.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookie.LastMarkCommand.apply(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.tools.framework.CliFlags)"}]}], "nameRev": "707ae5c8536f967c0369f951d6178670c5dd031d tags/release-4.10.0~66", "commitHash": "707ae5c8536f967c0369f951d6178670c5dd031d", "commitMessage": "ISSUE #2075: Bookieshell lastmark command isn't functional, always returning 0-0\n\nDescriptions of the changes in this PR:\r\n\r\n\r\n\r\n### Motivation\r\n\r\n`lastmark` shell command is to be used while debugging however currently it cannot be used since it returns incorrect value.\r\n\r\n### Changes\r\n\r\nUpdated `LedgerDirsManager` object initialization to use correct `ledgerDirs`.\r\nMaster Issue: #2075\r\n\r\n\r\n\n\nReviewers: Charan Reddy Guttapalem <reddycharan18@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #2076 from karanmehta93/ISSUE-2075, closes #2075", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/tools/cli/commands/bookie/LastMarkCommand.java"}], "commitParents": ["41b39c6eff249729a698838e880ad77cc0c18c67"], "commitDateTime": "2019-05-02 12:38:31", "commitUser": "reddycharan", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-05-02 12:38:31"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "ZkUtils.java", "spoonMethods": [{"INS": 2, "DEL": 1, "TOT": 7, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.ZkUtils.asyncDeleteFullPathOptimistic(org.apache.zookeeper.ZooKeeper,java.lang.String,int,org.apache.zookeeper.AsyncCallback$VoidCallback,java.lang.String).2.processResult(int,java.lang.String,java.lang.Object)"}]}], "nameRev": "335c2aba9bfd24eff224f1afae393026c17a2d5a tags/release-4.10.0~59", "commitHash": "335c2aba9bfd24eff224f1afae393026c17a2d5a", "commitMessage": "[BK-CLIENT] Check empty ledger-parent node while deleting ledger\n\n### Motivation\r\n\r\nAs discussed at [#4276](https://github.com/apache/pulsar/issues/4276), while deleting ledger, bk-client should check parent node is empty before issuing delete request for parent znode.\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Charan Reddy Guttapalem <reddycharan18@gmail.com>, Matteo Merli <mmerli@apache.org>\n\nThis closes #2097 from rdhabalia/led_del and squashes the following commits:\n\nf5c0ca36c [rdhabalia] return callback with ok\nede5e9403 [rdhabalia] [Bk-Client] Check empty ledger-parent node while deleting ledger\nd35aa22ad [Charan Reddy Guttapalem] Move common placementpolicy components to TopologyAwareEnsemblePlacementPolicy.\nb4ca4537b [Charan Reddy Guttapalem] Move common placementpolicy components to TopologyAwareEnsemblePlacementPolicy.\naa84c7fdd [Charan Reddy Guttapalem] GetListOfEntriesOfLedger implementation\n10859afb7 [Matteo Merli] Added HTTP handler to expose bookie state\n707ae5c85 [karanmehta93] ISSUE #2075: Bookieshell lastmark command isn't functional, always returning 0-0\n41b39c6ef [Charan Reddy Guttapalem] ISSUE #1967: make ledger creation and removal robust to zk connectionloss\n973d2ab0d [Matteo Merli] Use pure python implementation of MurmurHash\n9bb7e4b82 [Venkateswararao Jujjuri (JV)] Explicit error message if extent is not present on ZK (#2066)\nbd699e61d [mtang01] ISSUE #2067: reduce byte[] allocation in add entry\n7c62e1232 [karanmehta93] ISSUE #2073: ReadOnlyBookieTest#testBookieContinueWritingIfMulti\u2026\n42e77802c [Ivan Kelly] DLog Namespace#openLog should declare LogNotFoundException\n86bce12b5 [Yong Zhang] Migrate command `ledgermetadata`\n407cb35e5 [Charan Reddy Guttapalem] ISSUE #1967: make ledger creation and removal robust to zk connectionloss\neaa601404 [Like] Support asynchronous fence request for V2 ReadEntryProcessor\nd23b45ec8 [Ivan Kelly] Fix typo in overview page for 4.8.2\n44ee320b6 [Ivan Kelly] k\n316b71923 [Ivan Kelly] Wait for LAC update even if ledger fenced\n066621507 [Yong Zhang] Migrate command `updatecookie`\n6f3396801 [Yong Zhang] Migrate command `triggeraudit`\n60d993edf [Yong Zhang] Migrate command `autorecovery`\ned008f278 [Yong Zhang] Migrate command `whoisauditor`\n5b8e0971a [Yong Zhang] Migrate command `Whatisinstanceid`\n90c79444d [Yong Zhang] Migrate command `rebuild-db-ledger-locations-index`\n848f8527f [Nicolas Michael] ISSUE #2053: Bugfix for Percentile Calculation in FastCodahale Timer Implementation\n06f2b6f50 [Yong Zhang] Migrate command `updateledgers`\n7ad5849b1 [Yong Zhang] Migrate command `regenerate-interleaved-storage-index-file`\nd4dbb6bfb [Dongfa,Huang] Avoid useless verify if LedgerEntryRequest completed\n5c150f283 [Enrico Olivelli] Release notes for 4.9.1\n1246826ba [Yong Zhang] Migrate command `recover`\n1d4cc71fd [Yong Zhang] Migrate command `localconsistencycheck`\n67f83620e [Yong Zhang] Migrate command `readledger`\nbfbd6b023 [Yong Zhang] Migrate command `decommission`\nd40b8b69f [Yong Zhang] Migrate command `readlog`\n95d145a15 [Yong Zhang] Migrate command `nukeexistingcluster`\ne2b1dc7f3 [Yong Zhang] Migrate command `listunderreplicated`\n0988e12c7 [bd2019us] ISSUE #2023: change cached thread pool to fixed thread pool\n6a6d7bbd9 [Yong Zhang] Migrate command `initnewcluster`\nc391fe58d [Yong Zhang] Migrate command `readlogmetadata`\n120d67737 [Yong Zhang] Migrate command `lostbookierecoverydelay`\nbf66235e5 [Yong Zhang] Migrate command `deleteledger`\n751e55fa4 [Arvin] ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n138a7ae85 [Yong Zhang] Migrate command `metadataformat`\nb043d1694 [Yong Zhang] Migrate command `listledgers`\n4573285db [Ivan Kelly] Docker autobuild hook\ne3d807a32 [Like] Fix IDE complain as there are multi choices for error code\n9524a9f4a [Yong Zhang] Migrate command `readjournal`\n6c3f33f55 [Yong Zhang] Fix when met unexpect entry id crashed\ne35a108c7 [Like] Fix error message for unrecognized number-of-bookies\n5902ee27b [Boyang Jerry Peng] fix potential NPE when releasing entry that is null\n6aa73ce05 [Ivan Kelly] [RELEASE] Update website to include documentation for 4.8.2\n1448d12aa [Yong Zhang] Migrate command `listfilesondisk`\n4de598379 [Yong Zhang] Issue #1987: Migrate command `convert-to-interleaved-storage`\n468743e7e [Matteo Merli] In DbLedgerStorage use default values when config key is present but empty\nf26a4cae0 [Ivan Kelly] Release notes for v4.8.2\nec2636cd2 [Yong Zhang] Issue #1985: Migrate command `convert-to-db-storage`\n8cc7239ac [Yong Zhang] Issue #1982: Migrate command `bookiesanity`\nfa90f0185 [Yong Zhang] Issue #1980: Migrate command `ledger` from shell to bkctl", "commitGitStats": [{"lines": 11, "deletions": 1, "insertions": 10, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/ZkUtils.java"}], "commitParents": ["2ff26d69e400d16f533f424c6e95f2f30189e183"], "commitDateTime": "2019-05-17 15:39:12", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-05-17 00:39:12"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "LastMarkCommand.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookie.LastMarkCommand.apply(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.tools.framework.CliFlags)"}]}], "nameRev": "2aca9521c2dd81a7fe8058b9a8a1f4daf59180ef remotes/origin/branch-4.8~3", "commitHash": "2aca9521c2dd81a7fe8058b9a8a1f4daf59180ef", "commitMessage": "ISSUE #2075: Bookieshell lastmark command isn't functional, always returning 0-0\n\nDescriptions of the changes in this PR:\r\n\r\n\r\n\r\n### Motivation\r\n\r\n`lastmark` shell command is to be used while debugging however currently it cannot be used since it returns incorrect value.\r\n\r\n### Changes\r\n\r\nUpdated `LedgerDirsManager` object initialization to use correct `ledgerDirs`.\r\nMaster Issue: #2075\r\n\r\n\r\n\n\nReviewers: Charan Reddy Guttapalem <reddycharan18@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #2076 from karanmehta93/ISSUE-2075, closes #2075\n\n(cherry picked from commit 707ae5c8536f967c0369f951d6178670c5dd031d)\nSigned-off-by: Charan Reddy Guttapalem <cguttapalem@salesforce.com>\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/tools/cli/commands/bookie/LastMarkCommand.java"}], "commitParents": ["3480584993e94adbe43c5687c57965a527ed1106"], "commitDateTime": "2019-05-02 12:47:54", "commitUser": "reddycharan", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-05-02 12:38:31"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Bookieshell lastmark command isn't functional, always returning 0-0", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\n\r\nBookieshell lastmark command isn't functional. it is always returning 0-0\r\n\r\n***To Reproduce***\r\n\r\nOn running bookkeeper cluster, go to bin directory and run `./bookkeeper shell lastmark`\r\n\r\n***Expected behavior***\r\n\r\nRead `lastMark` file present inside ledger directory to indicate the last persisted log file id and offset\r\n\r\n***Screenshots***\r\n\r\n<img width=\"1286\" alt=\"Screen Shot 2019-04-24 at 11 35 55 AM\" src=\"https://user-images.githubusercontent.com/6191256/56861199-8e2c9800-6953-11e9-83fd-ef59f5e3a760.png\">\r\n\r\n***Additional context***\r\n\r\nAdd any other context about the problem here.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 2, "duplicated": 2, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"ef7ba357ae73cbebd5d2c749531cc2aa766e0fc5": {"commitUser": "reddycharan", "commitGHEventType": "referenced"}, "707ae5c8536f967c0369f951d6178670c5dd031d": {"commitUser": "reddycharan", "commitGHEventType": "closed"}, "335c2aba9bfd24eff224f1afae393026c17a2d5a": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}, "2aca9521c2dd81a7fe8058b9a8a1f4daf59180ef": {"commitUser": "reddycharan", "commitGHEventType": "referenced"}}, "closed": "2019-05-02 19:38:37", "url": "https://github.com/apache/bookkeeper/issues/2075", "user": "karanmehta93", "ttf": 4.000277777777778}, {"created": "2019-04-27 06:39:19", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "ReadOnlyBookieTest.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.test.ReadOnlyBookieTest.startNewBookieWithMultipleLedgerDirs(int)"}]}], "nameRev": "7c62e1232cf8063d3b0f0dc59978da69710602b5 tags/release-4.10.0~71", "commitHash": "7c62e1232cf8063d3b0f0dc59978da69710602b5", "commitMessage": "ISSUE #2073: ReadOnlyBookieTest#testBookieContinueWritingIfMulti\u2026\n\n\u2026pleLedgersPresent is flaky\r\n\r\nDescriptions of the changes in this PR:\r\n\r\nUpdated the test to use random port number for bookie startup instead of predefined one.\r\n\r\n### Motivation\r\n\r\nReadOnlyBookieTest#testBookieContinueWritingIfMultipleLedgersPresent test is flaky due to this reason.\r\n\r\n### Changes\r\n\r\n(Describe: what changes you have made)\r\n\r\nMaster Issue: #2073 \r\n\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #2074 from karanmehta93/master, closes #2073", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/test/ReadOnlyBookieTest.java"}], "commitParents": ["42e77802c025964d826c3b57e8f18c4bc464c481"], "commitDateTime": "2019-04-30 10:28:35", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-29 19:28:35"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "ZkUtils.java", "spoonMethods": [{"INS": 2, "DEL": 1, "TOT": 7, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.ZkUtils.asyncDeleteFullPathOptimistic(org.apache.zookeeper.ZooKeeper,java.lang.String,int,org.apache.zookeeper.AsyncCallback$VoidCallback,java.lang.String).2.processResult(int,java.lang.String,java.lang.Object)"}]}], "nameRev": "335c2aba9bfd24eff224f1afae393026c17a2d5a tags/release-4.10.0~59", "commitHash": "335c2aba9bfd24eff224f1afae393026c17a2d5a", "commitMessage": "[BK-CLIENT] Check empty ledger-parent node while deleting ledger\n\n### Motivation\r\n\r\nAs discussed at [#4276](https://github.com/apache/pulsar/issues/4276), while deleting ledger, bk-client should check parent node is empty before issuing delete request for parent znode.\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Charan Reddy Guttapalem <reddycharan18@gmail.com>, Matteo Merli <mmerli@apache.org>\n\nThis closes #2097 from rdhabalia/led_del and squashes the following commits:\n\nf5c0ca36c [rdhabalia] return callback with ok\nede5e9403 [rdhabalia] [Bk-Client] Check empty ledger-parent node while deleting ledger\nd35aa22ad [Charan Reddy Guttapalem] Move common placementpolicy components to TopologyAwareEnsemblePlacementPolicy.\nb4ca4537b [Charan Reddy Guttapalem] Move common placementpolicy components to TopologyAwareEnsemblePlacementPolicy.\naa84c7fdd [Charan Reddy Guttapalem] GetListOfEntriesOfLedger implementation\n10859afb7 [Matteo Merli] Added HTTP handler to expose bookie state\n707ae5c85 [karanmehta93] ISSUE #2075: Bookieshell lastmark command isn't functional, always returning 0-0\n41b39c6ef [Charan Reddy Guttapalem] ISSUE #1967: make ledger creation and removal robust to zk connectionloss\n973d2ab0d [Matteo Merli] Use pure python implementation of MurmurHash\n9bb7e4b82 [Venkateswararao Jujjuri (JV)] Explicit error message if extent is not present on ZK (#2066)\nbd699e61d [mtang01] ISSUE #2067: reduce byte[] allocation in add entry\n7c62e1232 [karanmehta93] ISSUE #2073: ReadOnlyBookieTest#testBookieContinueWritingIfMulti\u2026\n42e77802c [Ivan Kelly] DLog Namespace#openLog should declare LogNotFoundException\n86bce12b5 [Yong Zhang] Migrate command `ledgermetadata`\n407cb35e5 [Charan Reddy Guttapalem] ISSUE #1967: make ledger creation and removal robust to zk connectionloss\neaa601404 [Like] Support asynchronous fence request for V2 ReadEntryProcessor\nd23b45ec8 [Ivan Kelly] Fix typo in overview page for 4.8.2\n44ee320b6 [Ivan Kelly] k\n316b71923 [Ivan Kelly] Wait for LAC update even if ledger fenced\n066621507 [Yong Zhang] Migrate command `updatecookie`\n6f3396801 [Yong Zhang] Migrate command `triggeraudit`\n60d993edf [Yong Zhang] Migrate command `autorecovery`\ned008f278 [Yong Zhang] Migrate command `whoisauditor`\n5b8e0971a [Yong Zhang] Migrate command `Whatisinstanceid`\n90c79444d [Yong Zhang] Migrate command `rebuild-db-ledger-locations-index`\n848f8527f [Nicolas Michael] ISSUE #2053: Bugfix for Percentile Calculation in FastCodahale Timer Implementation\n06f2b6f50 [Yong Zhang] Migrate command `updateledgers`\n7ad5849b1 [Yong Zhang] Migrate command `regenerate-interleaved-storage-index-file`\nd4dbb6bfb [Dongfa,Huang] Avoid useless verify if LedgerEntryRequest completed\n5c150f283 [Enrico Olivelli] Release notes for 4.9.1\n1246826ba [Yong Zhang] Migrate command `recover`\n1d4cc71fd [Yong Zhang] Migrate command `localconsistencycheck`\n67f83620e [Yong Zhang] Migrate command `readledger`\nbfbd6b023 [Yong Zhang] Migrate command `decommission`\nd40b8b69f [Yong Zhang] Migrate command `readlog`\n95d145a15 [Yong Zhang] Migrate command `nukeexistingcluster`\ne2b1dc7f3 [Yong Zhang] Migrate command `listunderreplicated`\n0988e12c7 [bd2019us] ISSUE #2023: change cached thread pool to fixed thread pool\n6a6d7bbd9 [Yong Zhang] Migrate command `initnewcluster`\nc391fe58d [Yong Zhang] Migrate command `readlogmetadata`\n120d67737 [Yong Zhang] Migrate command `lostbookierecoverydelay`\nbf66235e5 [Yong Zhang] Migrate command `deleteledger`\n751e55fa4 [Arvin] ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n138a7ae85 [Yong Zhang] Migrate command `metadataformat`\nb043d1694 [Yong Zhang] Migrate command `listledgers`\n4573285db [Ivan Kelly] Docker autobuild hook\ne3d807a32 [Like] Fix IDE complain as there are multi choices for error code\n9524a9f4a [Yong Zhang] Migrate command `readjournal`\n6c3f33f55 [Yong Zhang] Fix when met unexpect entry id crashed\ne35a108c7 [Like] Fix error message for unrecognized number-of-bookies\n5902ee27b [Boyang Jerry Peng] fix potential NPE when releasing entry that is null\n6aa73ce05 [Ivan Kelly] [RELEASE] Update website to include documentation for 4.8.2\n1448d12aa [Yong Zhang] Migrate command `listfilesondisk`\n4de598379 [Yong Zhang] Issue #1987: Migrate command `convert-to-interleaved-storage`\n468743e7e [Matteo Merli] In DbLedgerStorage use default values when config key is present but empty\nf26a4cae0 [Ivan Kelly] Release notes for v4.8.2\nec2636cd2 [Yong Zhang] Issue #1985: Migrate command `convert-to-db-storage`\n8cc7239ac [Yong Zhang] Issue #1982: Migrate command `bookiesanity`\nfa90f0185 [Yong Zhang] Issue #1980: Migrate command `ledger` from shell to bkctl", "commitGitStats": [{"lines": 11, "deletions": 1, "insertions": 10, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/ZkUtils.java"}], "commitParents": ["2ff26d69e400d16f533f424c6e95f2f30189e183"], "commitDateTime": "2019-05-17 15:39:12", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-05-17 00:39:12"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "ReadOnlyBookieTest#testBookieContinueWritingIfMultipleLedgersPresent is flaky", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\n\r\nThe test `testBookieContinueWritingIfMultipleLedgersPresent` contains a method `startNewBookieWithMultipleLedgerDirs`, which kills a bookie server and tries to start a new one bound to the port number which is 1 more than previous bookie's port number. On Jenkins instances where multiple processes might be running, this causes `io.netty.channel.unix.Errors$NativeIoException: bind(..) failed: Address already in use` error sometimes. Jenkins retries the test but the test fails again but with the error, which is already an open issue here. https://github.com/apache/bookkeeper/issues/1400\r\n\r\n***To Reproduce***\r\n\r\nRun `mvn clean install` to run all the tests. Reproducibility is not guaranteed. \r\n\r\n***Expected behavior***\r\n\r\nThe test should pass without any errors however currently it throws following errors\r\n```\r\n[ERROR]   Run 1: ReadOnlyBookieTest.testBookieContinueWritingIfMultipleLedgersPresent \u00bb NativeIo\r\n[ERROR]   Run 2: ReadOnlyBookieTest.testBookieContinueWritingIfMultipleLedgersPresent \u00bb BKNotEnoughBookies\r\n[ERROR]   Run 3: ReadOnlyBookieTest.testBookieContinueWritingIfMultipleLedgersPresent \u00bb BKNotEnoughBookies\r\n```\r\n\r\n***Screenshots***\r\n\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n***Additional context***\r\n\r\nAdd any other context about the problem here.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 2, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"7c62e1232cf8063d3b0f0dc59978da69710602b5": {"commitUser": "sijie", "commitGHEventType": "closed"}, "335c2aba9bfd24eff224f1afae393026c17a2d5a": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}}, "closed": "2019-04-30 02:28:43", "url": "https://github.com/apache/bookkeeper/issues/2073", "user": "karanmehta93", "ttf": 2.000277777777778}, {"created": "2019-04-05 07:00:19", "closed": "2019-08-18 15:52:56", "title": "Build failure on Java 11 due to javadoc plugin", "url": "https://github.com/apache/bookkeeper/issues/2062", "body": "Build fail on 4.9.1 tag if using Java 11 (adoptopen jdk 11.0.2 + linux + maven 3.6.0):\r\n```\r\n\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] BUILD FAILURE\r\n[INFO] ------------------------------------------------------------------------\r\n[INFO] Total time:  29.880 s\r\n[INFO] Finished at: 2019-04-05T08:51:39+02:00\r\n[INFO] ------------------------------------------------------------------------\r\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-javadoc-plugin:3.0.0:jar (attach-javadocs) on project bookkeeper-stats-api: MavenReportException: Error while generating Javadoc: \r\n[ERROR] Exit code: 1 - javadoc: error - The code being documented uses modules but the packages defined in https://docs.oracle.com/javase/8/docs/api/ are in the unnamed module.\r\n[ERROR] \r\n[ERROR] Command line was: /home/diennea.lan/enrico.olivelli/dev/jdk-11/bin/javadoc @options\r\n[ERROR] \r\n[ERROR] Refer to the generated Javadoc files in '/home/diennea.lan/enrico.olivelli/Scaricati/bookkeeper-4.9.1/bookkeeper-stats/target/apidocs' dir.\r\n[ERROR] \r\n```\r\n\r\n", "commits": {}, "user": "eolivelli", "commitsDetails": [], "labels": ["area/build", "triage/week-33", "type/bug"], "ttf": 135.00027777777777}, {"created": "2019-04-02 23:23:49", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "AutoRecoveryCommandGroup.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.AutoRecoveryCommandGroup"}]}, {"spoonFilePath": "BookieShell.java", "spoonMethods": [{"INS": 3, "DEL": 2, "TOT": 15, "MOV": 6, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.AutoRecoveryCmd.runCmd(org.apache.commons.cli.CommandLine)"}]}, {"spoonFilePath": "AutoRecoveryCommandTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.autorecovery.AutoRecoveryCommandTest"}]}, {"spoonFilePath": "ToggleCommand.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.autorecovery.ToggleCommand"}]}], "nameRev": "60d993edf50417ace9777d2f40cc2bbc97510125 tags/release-4.10.0~81", "commitHash": "60d993edf50417ace9777d2f40cc2bbc97510125", "commitMessage": "Migrate command `autorecovery`\n\nDescriptions of the changes in this PR:\r\n\r\n- Using `bkctl` run command `autorecovery`\r\n\r\n### Motivation\r\n\r\n#2009 \n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #2010 from zymap/command-autorecovery and squashes the following commits:\n\n6fcd96904 [Yong Zhang] Fix validation\ncd383f372 [Yong Zhang] Rename package\nefb573221 [Yong Zhang] Rename command\n89da2852e [Yong Zhang] Fix error in bookieshell\na037501ee [Yong Zhang] Rename args\n4bb36b0b3 [Yong Zhang] Fix imports postion\ne41a742d3 [Yong Zhang] Add unit test for command `autorecovery`\nb0c91f704 [Yong Zhang] Rename file\ncb06f66de [Yong Zhang] Migrate command `autorecovery`\ned008f278 [Yong Zhang] Migrate command `whoisauditor`\n5b8e0971a [Yong Zhang] Migrate command `Whatisinstanceid`\n90c79444d [Yong Zhang] Migrate command `rebuild-db-ledger-locations-index`\n848f8527f [Nicolas Michael] ISSUE #2053: Bugfix for Percentile Calculation in FastCodahale Timer Implementation\n06f2b6f50 [Yong Zhang] Migrate command `updateledgers`\n7ad5849b1 [Yong Zhang] Migrate command `regenerate-interleaved-storage-index-file`\nd4dbb6bfb [Dongfa,Huang] Avoid useless verify if LedgerEntryRequest completed\n5c150f283 [Enrico Olivelli] Release notes for 4.9.1\n1246826ba [Yong Zhang] Migrate command `recover`\n1d4cc71fd [Yong Zhang] Migrate command `localconsistencycheck`\n67f83620e [Yong Zhang] Migrate command `readledger`\nbfbd6b023 [Yong Zhang] Migrate command `decommission`\nd40b8b69f [Yong Zhang] Migrate command `readlog`\n95d145a15 [Yong Zhang] Migrate command `nukeexistingcluster`\ne2b1dc7f3 [Yong Zhang] Migrate command `listunderreplicated`\n0988e12c7 [bd2019us] ISSUE #2023: change cached thread pool to fixed thread pool\n6a6d7bbd9 [Yong Zhang] Migrate command `initnewcluster`\nc391fe58d [Yong Zhang] Migrate command `readlogmetadata`\n120d67737 [Yong Zhang] Migrate command `lostbookierecoverydelay`\nbf66235e5 [Yong Zhang] Migrate command `deleteledger`\n751e55fa4 [Arvin] ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n138a7ae85 [Yong Zhang] Migrate command `metadataformat`\nb043d1694 [Yong Zhang] Migrate command `listledgers`\n4573285db [Ivan Kelly] Docker autobuild hook\ne3d807a32 [Like] Fix IDE complain as there are multi choices for error code\n9524a9f4a [Yong Zhang] Migrate command `readjournal`\n6c3f33f55 [Yong Zhang] Fix when met unexpect entry id crashed\ne35a108c7 [Like] Fix error message for unrecognized number-of-bookies\n5902ee27b [Boyang Jerry Peng] fix potential NPE when releasing entry that is null\n6aa73ce05 [Ivan Kelly] [RELEASE] Update website to include documentation for 4.8.2\n1448d12aa [Yong Zhang] Migrate command `listfilesondisk`\n4de598379 [Yong Zhang] Issue #1987: Migrate command `convert-to-interleaved-storage`\n468743e7e [Matteo Merli] In DbLedgerStorage use default values when config key is present but empty\nf26a4cae0 [Ivan Kelly] Release notes for v4.8.2\nec2636cd2 [Yong Zhang] Issue #1985: Migrate command `convert-to-db-storage`\n8cc7239ac [Yong Zhang] Issue #1982: Migrate command `bookiesanity`\nfa90f0185 [Yong Zhang] Issue #1980: Migrate command `ledger` from shell to bkctl", "commitGitStats": [{"lines": 121, "deletions": 0, "insertions": 121, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/tools/cli/commands/autorecovery/ToggleCommand.java"}, {"lines": 2, "deletions": 0, "insertions": 2, "filePath": "tools/ledger/src/main/java/org/apache/bookkeeper/tools/cli/commands/AutoRecoveryCommandGroup.java"}, {"lines": 45, "deletions": 40, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieShell.java"}, {"lines": 123, "deletions": 0, "insertions": 123, "filePath": "tools/ledger/src/test/java/org/apache/bookkeeper/tools/cli/commands/autorecovery/AutoRecoveryCommandTest.java"}], "commitParents": ["ed008f27807a75ba384246fc7fae6ca3a5a6971f"], "commitDateTime": "2019-04-16 16:48:32", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-16 16:48:32"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "FastSnapshot.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.codahale.FastSnapshot.getValue(double)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.codahale.FastSnapshot.sumOf(long[])"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.codahale.FastSnapshot"}]}, {"spoonFilePath": "FastTimerTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.codahale.FastTimerTest.testSnapshotOutOfSync()"}]}], "nameRev": "3e48a98f1861700c8bebb0048864c869552e12c7 remotes/origin/branch-4.8~5", "commitHash": "3e48a98f1861700c8bebb0048864c869552e12c7", "commitMessage": "ISSUE #2053: Bugfix for Percentile Calculation in FastCodahale Timer Implementation\n\nThis bugfix for the FastCodahale timer implementation ensures that percentiles provided by a FastSnapshot are calculated correctly even if the total count of events (provided by FastTimer) is out of sync with the recorded events in the percentile buckets.\r\n\r\n### Motivation\r\n\r\nFastCodahale Timer implementation may miscalculate percentiles if snapshots of values are slightly out of sync, and if only few events have been recorded.\r\n\r\nFastCodahale Timers use fine-grained locking and are meant to tolerate that (some) values change while being recorded or while snapshots are created. Currently, the total count of requests is not synchronized with the number of requests recorded in percentile buckets. If a snapshot is created while the total count of the timer has been incremented beyond the sum of values in the percentile buckets, the percentile calculation may produce wrong values.\r\n\r\nFor example, if 3 percentile values have been recorded, but the overall count is 4, then the percentile calculation would be based on 4 values. This becomes most obvious if a percentile > .75 (e.g. p95) is being calculated. For this, the implementation will try to find 0.95 * 4 values, which is more than the 3 values recorded in the buckets. Since no bucket fulfills the criteria, the bound of the last (overflow) bucket will be returned, i.e. Long.MAX_VALUE.\r\n\r\n### Changes\r\n\r\nFastSnapshots now bases the percentile calculation on the sum of values in the percentile buckets rather than a count provided by the caller (i.e. FastTimer). This ensures that percentiles are calculated correctly without the need of having all counters fully synchronized.\r\n\r\nMaster Issue: #2053 \r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #2054 from nicmichael/fast-codahale-bugfix, closes #2053\n\n(cherry picked from commit 848f8527f9d4745753b2f1e22ac1b8e981ea0d1d)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 23, "deletions": 0, "insertions": 23, "filePath": "bookkeeper-stats-providers/codahale-metrics-provider/src/test/java/org/apache/bookkeeper/stats/codahale/FastTimerTest.java"}, {"lines": 19, "deletions": 2, "insertions": 17, "filePath": "bookkeeper-stats-providers/codahale-metrics-provider/src/main/java/org/apache/bookkeeper/stats/codahale/FastSnapshot.java"}], "commitParents": ["436f9bce55cfac129d93dde776293cdc5adf7751"], "commitDateTime": "2019-04-10 09:47:03", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-09 18:44:52"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "FastSnapshot.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.codahale.FastSnapshot.getValue(double)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.codahale.FastSnapshot.sumOf(long[])"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.codahale.FastSnapshot"}]}, {"spoonFilePath": "FastTimerTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.codahale.FastTimerTest.testSnapshotOutOfSync()"}]}], "nameRev": "7f7610b741d29f0fe44332127028c53fb8627f18 tags/release-4.9.2~8", "commitHash": "7f7610b741d29f0fe44332127028c53fb8627f18", "commitMessage": "ISSUE #2053: Bugfix for Percentile Calculation in FastCodahale Timer Implementation\n\nThis bugfix for the FastCodahale timer implementation ensures that percentiles provided by a FastSnapshot are calculated correctly even if the total count of events (provided by FastTimer) is out of sync with the recorded events in the percentile buckets.\r\n\r\n### Motivation\r\n\r\nFastCodahale Timer implementation may miscalculate percentiles if snapshots of values are slightly out of sync, and if only few events have been recorded.\r\n\r\nFastCodahale Timers use fine-grained locking and are meant to tolerate that (some) values change while being recorded or while snapshots are created. Currently, the total count of requests is not synchronized with the number of requests recorded in percentile buckets. If a snapshot is created while the total count of the timer has been incremented beyond the sum of values in the percentile buckets, the percentile calculation may produce wrong values.\r\n\r\nFor example, if 3 percentile values have been recorded, but the overall count is 4, then the percentile calculation would be based on 4 values. This becomes most obvious if a percentile > .75 (e.g. p95) is being calculated. For this, the implementation will try to find 0.95 * 4 values, which is more than the 3 values recorded in the buckets. Since no bucket fulfills the criteria, the bound of the last (overflow) bucket will be returned, i.e. Long.MAX_VALUE.\r\n\r\n### Changes\r\n\r\nFastSnapshots now bases the percentile calculation on the sum of values in the percentile buckets rather than a count provided by the caller (i.e. FastTimer). This ensures that percentiles are calculated correctly without the need of having all counters fully synchronized.\r\n\r\nMaster Issue: #2053 \r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #2054 from nicmichael/fast-codahale-bugfix, closes #2053\n\n(cherry picked from commit 848f8527f9d4745753b2f1e22ac1b8e981ea0d1d)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 23, "deletions": 0, "insertions": 23, "filePath": "bookkeeper-stats-providers/codahale-metrics-provider/src/test/java/org/apache/bookkeeper/stats/codahale/FastTimerTest.java"}, {"lines": 19, "deletions": 2, "insertions": 17, "filePath": "bookkeeper-stats-providers/codahale-metrics-provider/src/main/java/org/apache/bookkeeper/stats/codahale/FastSnapshot.java"}], "commitParents": ["ab15045bf98f5bc0cf6aba1019f6607c5ce17ea1"], "commitDateTime": "2019-04-10 09:46:34", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-09 18:44:52"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "FastSnapshot.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.codahale.FastSnapshot.getValue(double)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.codahale.FastSnapshot.sumOf(long[])"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.codahale.FastSnapshot"}]}, {"spoonFilePath": "FastTimerTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.codahale.FastTimerTest.testSnapshotOutOfSync()"}]}], "nameRev": "848f8527f9d4745753b2f1e22ac1b8e981ea0d1d tags/release-4.10.0~85", "commitHash": "848f8527f9d4745753b2f1e22ac1b8e981ea0d1d", "commitMessage": "ISSUE #2053: Bugfix for Percentile Calculation in FastCodahale Timer Implementation\n\nThis bugfix for the FastCodahale timer implementation ensures that percentiles provided by a FastSnapshot are calculated correctly even if the total count of events (provided by FastTimer) is out of sync with the recorded events in the percentile buckets.\r\n\r\n### Motivation\r\n\r\nFastCodahale Timer implementation may miscalculate percentiles if snapshots of values are slightly out of sync, and if only few events have been recorded.\r\n\r\nFastCodahale Timers use fine-grained locking and are meant to tolerate that (some) values change while being recorded or while snapshots are created. Currently, the total count of requests is not synchronized with the number of requests recorded in percentile buckets. If a snapshot is created while the total count of the timer has been incremented beyond the sum of values in the percentile buckets, the percentile calculation may produce wrong values.\r\n\r\nFor example, if 3 percentile values have been recorded, but the overall count is 4, then the percentile calculation would be based on 4 values. This becomes most obvious if a percentile > .75 (e.g. p95) is being calculated. For this, the implementation will try to find 0.95 * 4 values, which is more than the 3 values recorded in the buckets. Since no bucket fulfills the criteria, the bound of the last (overflow) bucket will be returned, i.e. Long.MAX_VALUE.\r\n\r\n### Changes\r\n\r\nFastSnapshots now bases the percentile calculation on the sum of values in the percentile buckets rather than a count provided by the caller (i.e. FastTimer). This ensures that percentiles are calculated correctly without the need of having all counters fully synchronized.\r\n\r\nMaster Issue: #2053 \r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #2054 from nicmichael/fast-codahale-bugfix, closes #2053", "commitGitStats": [{"lines": 23, "deletions": 0, "insertions": 23, "filePath": "bookkeeper-stats-providers/codahale-metrics-provider/src/test/java/org/apache/bookkeeper/stats/codahale/FastTimerTest.java"}, {"lines": 19, "deletions": 2, "insertions": 17, "filePath": "bookkeeper-stats-providers/codahale-metrics-provider/src/main/java/org/apache/bookkeeper/stats/codahale/FastSnapshot.java"}], "commitParents": ["06f2b6f50ca2c6c1ccc630aa9d9fd761abf1becc"], "commitDateTime": "2019-04-10 09:44:52", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-09 18:44:52"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "TriggerAuditCommandTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.autorecovery.TriggerAuditCommandTest"}]}, {"spoonFilePath": "AutoRecoveryCommandGroup.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 4, "MOV": 1, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.AutoRecoveryCommandGroup"}]}, {"spoonFilePath": "package-info.java", "spoonMethods": []}, {"spoonFilePath": "TriggerAuditCommand.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.autorecovery.TriggerAuditCommand"}]}, {"spoonFilePath": "BookieShell.java", "spoonMethods": [{"INS": 1, "DEL": 2, "TOT": 9, "MOV": 2, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.TriggerAuditCmd.runCmd(org.apache.commons.cli.CommandLine)"}]}], "nameRev": "6f33968019c3452cefc2d78e0258bb3206d78e8a tags/release-4.10.0~80", "commitHash": "6f33968019c3452cefc2d78e0258bb3206d78e8a", "commitMessage": "Migrate command `triggeraudit`\n\nDescriptions of the changes in this PR:\r\n\r\n- Using `bkctl` run command `triggeraudit`\r\n\r\n### Motivation\r\n\r\n#2011 \n\nReviewers: Sijie Guo <sijie@apache.org>, Jia Zhai <zhaijia@apache.org>\n\nThis closes #2012 from zymap/command-triggeraudit and squashes the following commits:\n\n5a4b496ec [Yong Zhang] Fix conflict ---\n236b7d6e5 [Yong Zhang] Fix validation\nb039b637e [Yong Zhang] Rename file\n8bea52522 [Yong Zhang] Remove unused imports\nd39d1e886 [Yong Zhang] Migrate command `triggeraudit`\n60d993edf [Yong Zhang] Migrate command `autorecovery`\ned008f278 [Yong Zhang] Migrate command `whoisauditor`\n5b8e0971a [Yong Zhang] Migrate command `Whatisinstanceid`\n90c79444d [Yong Zhang] Migrate command `rebuild-db-ledger-locations-index`\n848f8527f [Nicolas Michael] ISSUE #2053: Bugfix for Percentile Calculation in FastCodahale Timer Implementation\n06f2b6f50 [Yong Zhang] Migrate command `updateledgers`\n7ad5849b1 [Yong Zhang] Migrate command `regenerate-interleaved-storage-index-file`\nd4dbb6bfb [Dongfa,Huang] Avoid useless verify if LedgerEntryRequest completed\n5c150f283 [Enrico Olivelli] Release notes for 4.9.1\n1246826ba [Yong Zhang] Migrate command `recover`\n1d4cc71fd [Yong Zhang] Migrate command `localconsistencycheck`\n67f83620e [Yong Zhang] Migrate command `readledger`\nbfbd6b023 [Yong Zhang] Migrate command `decommission`\nd40b8b69f [Yong Zhang] Migrate command `readlog`\n95d145a15 [Yong Zhang] Migrate command `nukeexistingcluster`\ne2b1dc7f3 [Yong Zhang] Migrate command `listunderreplicated`\n0988e12c7 [bd2019us] ISSUE #2023: change cached thread pool to fixed thread pool\n6a6d7bbd9 [Yong Zhang] Migrate command `initnewcluster`\nc391fe58d [Yong Zhang] Migrate command `readlogmetadata`\n120d67737 [Yong Zhang] Migrate command `lostbookierecoverydelay`\nbf66235e5 [Yong Zhang] Migrate command `deleteledger`\n751e55fa4 [Arvin] ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n138a7ae85 [Yong Zhang] Migrate command `metadataformat`\nb043d1694 [Yong Zhang] Migrate command `listledgers`\n4573285db [Ivan Kelly] Docker autobuild hook\ne3d807a32 [Like] Fix IDE complain as there are multi choices for error code\n9524a9f4a [Yong Zhang] Migrate command `readjournal`\n6c3f33f55 [Yong Zhang] Fix when met unexpect entry id crashed\ne35a108c7 [Like] Fix error message for unrecognized number-of-bookies\n5902ee27b [Boyang Jerry Peng] fix potential NPE when releasing entry that is null\n6aa73ce05 [Ivan Kelly] [RELEASE] Update website to include documentation for 4.8.2\n1448d12aa [Yong Zhang] Migrate command `listfilesondisk`\n4de598379 [Yong Zhang] Issue #1987: Migrate command `convert-to-interleaved-storage`\n468743e7e [Matteo Merli] In DbLedgerStorage use default values when config key is present but empty\nf26a4cae0 [Ivan Kelly] Release notes for v4.8.2\nec2636cd2 [Yong Zhang] Issue #1985: Migrate command `convert-to-db-storage`\n8cc7239ac [Yong Zhang] Issue #1982: Migrate command `bookiesanity`\nfa90f0185 [Yong Zhang] Issue #1980: Migrate command `ledger` from shell to bkctl", "commitGitStats": [{"lines": 19, "deletions": 12, "insertions": 7, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/tools/cli/commands/autorecovery/package-info.java"}, {"lines": 7, "deletions": 0, "insertions": 7, "filePath": "tools/ledger/src/main/java/org/apache/bookkeeper/tools/cli/commands/AutoRecoveryCommandGroup.java"}, {"lines": 14, "deletions": 11, "insertions": 3, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieShell.java"}, {"lines": 68, "deletions": 0, "insertions": 68, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/tools/cli/commands/autorecovery/TriggerAuditCommand.java"}, {"lines": 81, "deletions": 0, "insertions": 81, "filePath": "tools/ledger/src/test/java/org/apache/bookkeeper/tools/cli/commands/autorecovery/TriggerAuditCommandTest.java"}], "commitParents": ["60d993edf50417ace9777d2f40cc2bbc97510125"], "commitDateTime": "2019-04-17 14:32:24", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-17 14:32:24"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "ZkUtils.java", "spoonMethods": [{"INS": 2, "DEL": 1, "TOT": 7, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.ZkUtils.asyncDeleteFullPathOptimistic(org.apache.zookeeper.ZooKeeper,java.lang.String,int,org.apache.zookeeper.AsyncCallback$VoidCallback,java.lang.String).2.processResult(int,java.lang.String,java.lang.Object)"}]}], "nameRev": "335c2aba9bfd24eff224f1afae393026c17a2d5a tags/release-4.10.0~59", "commitHash": "335c2aba9bfd24eff224f1afae393026c17a2d5a", "commitMessage": "[BK-CLIENT] Check empty ledger-parent node while deleting ledger\n\n### Motivation\r\n\r\nAs discussed at [#4276](https://github.com/apache/pulsar/issues/4276), while deleting ledger, bk-client should check parent node is empty before issuing delete request for parent znode.\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Charan Reddy Guttapalem <reddycharan18@gmail.com>, Matteo Merli <mmerli@apache.org>\n\nThis closes #2097 from rdhabalia/led_del and squashes the following commits:\n\nf5c0ca36c [rdhabalia] return callback with ok\nede5e9403 [rdhabalia] [Bk-Client] Check empty ledger-parent node while deleting ledger\nd35aa22ad [Charan Reddy Guttapalem] Move common placementpolicy components to TopologyAwareEnsemblePlacementPolicy.\nb4ca4537b [Charan Reddy Guttapalem] Move common placementpolicy components to TopologyAwareEnsemblePlacementPolicy.\naa84c7fdd [Charan Reddy Guttapalem] GetListOfEntriesOfLedger implementation\n10859afb7 [Matteo Merli] Added HTTP handler to expose bookie state\n707ae5c85 [karanmehta93] ISSUE #2075: Bookieshell lastmark command isn't functional, always returning 0-0\n41b39c6ef [Charan Reddy Guttapalem] ISSUE #1967: make ledger creation and removal robust to zk connectionloss\n973d2ab0d [Matteo Merli] Use pure python implementation of MurmurHash\n9bb7e4b82 [Venkateswararao Jujjuri (JV)] Explicit error message if extent is not present on ZK (#2066)\nbd699e61d [mtang01] ISSUE #2067: reduce byte[] allocation in add entry\n7c62e1232 [karanmehta93] ISSUE #2073: ReadOnlyBookieTest#testBookieContinueWritingIfMulti\u2026\n42e77802c [Ivan Kelly] DLog Namespace#openLog should declare LogNotFoundException\n86bce12b5 [Yong Zhang] Migrate command `ledgermetadata`\n407cb35e5 [Charan Reddy Guttapalem] ISSUE #1967: make ledger creation and removal robust to zk connectionloss\neaa601404 [Like] Support asynchronous fence request for V2 ReadEntryProcessor\nd23b45ec8 [Ivan Kelly] Fix typo in overview page for 4.8.2\n44ee320b6 [Ivan Kelly] k\n316b71923 [Ivan Kelly] Wait for LAC update even if ledger fenced\n066621507 [Yong Zhang] Migrate command `updatecookie`\n6f3396801 [Yong Zhang] Migrate command `triggeraudit`\n60d993edf [Yong Zhang] Migrate command `autorecovery`\ned008f278 [Yong Zhang] Migrate command `whoisauditor`\n5b8e0971a [Yong Zhang] Migrate command `Whatisinstanceid`\n90c79444d [Yong Zhang] Migrate command `rebuild-db-ledger-locations-index`\n848f8527f [Nicolas Michael] ISSUE #2053: Bugfix for Percentile Calculation in FastCodahale Timer Implementation\n06f2b6f50 [Yong Zhang] Migrate command `updateledgers`\n7ad5849b1 [Yong Zhang] Migrate command `regenerate-interleaved-storage-index-file`\nd4dbb6bfb [Dongfa,Huang] Avoid useless verify if LedgerEntryRequest completed\n5c150f283 [Enrico Olivelli] Release notes for 4.9.1\n1246826ba [Yong Zhang] Migrate command `recover`\n1d4cc71fd [Yong Zhang] Migrate command `localconsistencycheck`\n67f83620e [Yong Zhang] Migrate command `readledger`\nbfbd6b023 [Yong Zhang] Migrate command `decommission`\nd40b8b69f [Yong Zhang] Migrate command `readlog`\n95d145a15 [Yong Zhang] Migrate command `nukeexistingcluster`\ne2b1dc7f3 [Yong Zhang] Migrate command `listunderreplicated`\n0988e12c7 [bd2019us] ISSUE #2023: change cached thread pool to fixed thread pool\n6a6d7bbd9 [Yong Zhang] Migrate command `initnewcluster`\nc391fe58d [Yong Zhang] Migrate command `readlogmetadata`\n120d67737 [Yong Zhang] Migrate command `lostbookierecoverydelay`\nbf66235e5 [Yong Zhang] Migrate command `deleteledger`\n751e55fa4 [Arvin] ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n138a7ae85 [Yong Zhang] Migrate command `metadataformat`\nb043d1694 [Yong Zhang] Migrate command `listledgers`\n4573285db [Ivan Kelly] Docker autobuild hook\ne3d807a32 [Like] Fix IDE complain as there are multi choices for error code\n9524a9f4a [Yong Zhang] Migrate command `readjournal`\n6c3f33f55 [Yong Zhang] Fix when met unexpect entry id crashed\ne35a108c7 [Like] Fix error message for unrecognized number-of-bookies\n5902ee27b [Boyang Jerry Peng] fix potential NPE when releasing entry that is null\n6aa73ce05 [Ivan Kelly] [RELEASE] Update website to include documentation for 4.8.2\n1448d12aa [Yong Zhang] Migrate command `listfilesondisk`\n4de598379 [Yong Zhang] Issue #1987: Migrate command `convert-to-interleaved-storage`\n468743e7e [Matteo Merli] In DbLedgerStorage use default values when config key is present but empty\nf26a4cae0 [Ivan Kelly] Release notes for v4.8.2\nec2636cd2 [Yong Zhang] Issue #1985: Migrate command `convert-to-db-storage`\n8cc7239ac [Yong Zhang] Issue #1982: Migrate command `bookiesanity`\nfa90f0185 [Yong Zhang] Issue #1980: Migrate command `ledger` from shell to bkctl", "commitGitStats": [{"lines": 11, "deletions": 1, "insertions": 10, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/ZkUtils.java"}], "commitParents": ["2ff26d69e400d16f533f424c6e95f2f30189e183"], "commitDateTime": "2019-05-17 15:39:12", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-05-17 00:39:12"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/stats", "release/4.10.0", "release/4.8.3", "release/4.9.2", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "FastCodahale Timers miscalculate percentiles", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\n\r\nFastCodahale Timer implementation may miscalculate percentiles if snapshots of values are slightly out of sync, and if only few events have been recorded.\r\n\r\nFastCodahale Timers use fine-grained locking and are meant to tolerate that (some) values change while being recorded or while snapshots are created. Currently, the total count of requests is not synchronized with the number of requests recorded in percentile buckets. If a snapshot is created while the total count of the timer has been incremented beyond the sum of values in the percentile buckets, the percentile calculation may produce wrong values.\r\n\r\nFor example, if 3 percentile values have been recorded, but the overall count is 4, then the percentile calculation would be based on 4 values. This becomes most obvious if a percentile > .75 (e.g. p95) is being calculated. For this, the implementation will try to find 0.95 * 4 values, which is more than the 3 values recorded in the buckets. Since no bucket fulfills the criteria, the bound of the last (overflow) bucket will be returned, i.e. Long.MAX_VALUE.\r\n\r\n***To Reproduce***\r\n\r\nI added a test case in my pull request to fix this bug which demonstrates the behavior.\r\n\r\n***Expected behavior***\r\n\r\nSnapshots should base the percentile calculation on the sum of all values contained in the buckets, not on any value provided by a caller (which might be wrong or out of sync).\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 4, "duplicated": 2, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"60d993edf50417ace9777d2f40cc2bbc97510125": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}, "3e48a98f1861700c8bebb0048864c869552e12c7": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "7f7610b741d29f0fe44332127028c53fb8627f18": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "848f8527f9d4745753b2f1e22ac1b8e981ea0d1d": {"commitUser": "sijie", "commitGHEventType": "closed"}, "335c2aba9bfd24eff224f1afae393026c17a2d5a": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}, "6f33968019c3452cefc2d78e0258bb3206d78e8a": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}}, "closed": "2019-04-10 01:44:59", "url": "https://github.com/apache/bookkeeper/issues/2053", "user": "nicmichael", "ttf": 7.000277777777778}, {"created": "2019-03-30 10:24:22", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "MVCCStoreFactoryImpl.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stream.storage.impl.store.MVCCStoreFactoryImpl.closeStores(long)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stream.storage.impl.store.MVCCStoreFactoryImpl.addStore(long,long,long,org.apache.bookkeeper.statelib.api.mvcc.MVCCAsyncStore)"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stream.storage.impl.store.MVCCStoreFactoryImpl.newStore(long,long,long)"}]}, {"spoonFilePath": "StorageContainerRegistryImpl.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stream.storage.impl.sc.StorageContainerRegistryImpl.unsafeStartStorageContainer(long)"}]}], "nameRev": "751e55fa433172422fb82556ff748c5f6f2bfc41 tags/release-4.10.0~102", "commitHash": "751e55fa433172422fb82556ff748c5f6f2bfc41", "commitMessage": "ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n\nDescriptions of the changes in this PR:\r\n\r\n### Motivation\r\n\r\nIf not releasing resources of failed/closed asyncStore, new creating of the same store identifier will fail, mainly caused by RocksDBException, like #2020 shows.\r\n\r\n### Changes\r\n\r\nadd scStores to factory's instance variable at the `addstore` method of `MVCCStoreFactoryImpl` class;\r\nrelease store when open fail;\r\n\r\nDescriptions of the changes in this PR:\r\n\r\nMaster Issue: #2020 \r\n\r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #2022 from ArvinDevel/issue2020, closes #2020", "commitGitStats": [{"lines": 16, "deletions": 1, "insertions": 15, "filePath": "stream/storage/impl/src/main/java/org/apache/bookkeeper/stream/storage/impl/store/MVCCStoreFactoryImpl.java"}, {"lines": 5, "deletions": 0, "insertions": 5, "filePath": "stream/storage/impl/src/main/java/org/apache/bookkeeper/stream/storage/impl/sc/StorageContainerRegistryImpl.java"}], "commitParents": ["138a7ae8569fa36b70e03ba61c57104d6ab94f18"], "commitDateTime": "2019-04-01 09:27:42", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-02 00:27:42"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "AutoRecoveryCommandGroup.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.AutoRecoveryCommandGroup"}]}, {"spoonFilePath": "BookieShell.java", "spoonMethods": [{"INS": 3, "DEL": 2, "TOT": 15, "MOV": 6, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.AutoRecoveryCmd.runCmd(org.apache.commons.cli.CommandLine)"}]}, {"spoonFilePath": "AutoRecoveryCommandTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.autorecovery.AutoRecoveryCommandTest"}]}, {"spoonFilePath": "ToggleCommand.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.autorecovery.ToggleCommand"}]}], "nameRev": "60d993edf50417ace9777d2f40cc2bbc97510125 tags/release-4.10.0~81", "commitHash": "60d993edf50417ace9777d2f40cc2bbc97510125", "commitMessage": "Migrate command `autorecovery`\n\nDescriptions of the changes in this PR:\r\n\r\n- Using `bkctl` run command `autorecovery`\r\n\r\n### Motivation\r\n\r\n#2009 \n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #2010 from zymap/command-autorecovery and squashes the following commits:\n\n6fcd96904 [Yong Zhang] Fix validation\ncd383f372 [Yong Zhang] Rename package\nefb573221 [Yong Zhang] Rename command\n89da2852e [Yong Zhang] Fix error in bookieshell\na037501ee [Yong Zhang] Rename args\n4bb36b0b3 [Yong Zhang] Fix imports postion\ne41a742d3 [Yong Zhang] Add unit test for command `autorecovery`\nb0c91f704 [Yong Zhang] Rename file\ncb06f66de [Yong Zhang] Migrate command `autorecovery`\ned008f278 [Yong Zhang] Migrate command `whoisauditor`\n5b8e0971a [Yong Zhang] Migrate command `Whatisinstanceid`\n90c79444d [Yong Zhang] Migrate command `rebuild-db-ledger-locations-index`\n848f8527f [Nicolas Michael] ISSUE #2053: Bugfix for Percentile Calculation in FastCodahale Timer Implementation\n06f2b6f50 [Yong Zhang] Migrate command `updateledgers`\n7ad5849b1 [Yong Zhang] Migrate command `regenerate-interleaved-storage-index-file`\nd4dbb6bfb [Dongfa,Huang] Avoid useless verify if LedgerEntryRequest completed\n5c150f283 [Enrico Olivelli] Release notes for 4.9.1\n1246826ba [Yong Zhang] Migrate command `recover`\n1d4cc71fd [Yong Zhang] Migrate command `localconsistencycheck`\n67f83620e [Yong Zhang] Migrate command `readledger`\nbfbd6b023 [Yong Zhang] Migrate command `decommission`\nd40b8b69f [Yong Zhang] Migrate command `readlog`\n95d145a15 [Yong Zhang] Migrate command `nukeexistingcluster`\ne2b1dc7f3 [Yong Zhang] Migrate command `listunderreplicated`\n0988e12c7 [bd2019us] ISSUE #2023: change cached thread pool to fixed thread pool\n6a6d7bbd9 [Yong Zhang] Migrate command `initnewcluster`\nc391fe58d [Yong Zhang] Migrate command `readlogmetadata`\n120d67737 [Yong Zhang] Migrate command `lostbookierecoverydelay`\nbf66235e5 [Yong Zhang] Migrate command `deleteledger`\n751e55fa4 [Arvin] ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n138a7ae85 [Yong Zhang] Migrate command `metadataformat`\nb043d1694 [Yong Zhang] Migrate command `listledgers`\n4573285db [Ivan Kelly] Docker autobuild hook\ne3d807a32 [Like] Fix IDE complain as there are multi choices for error code\n9524a9f4a [Yong Zhang] Migrate command `readjournal`\n6c3f33f55 [Yong Zhang] Fix when met unexpect entry id crashed\ne35a108c7 [Like] Fix error message for unrecognized number-of-bookies\n5902ee27b [Boyang Jerry Peng] fix potential NPE when releasing entry that is null\n6aa73ce05 [Ivan Kelly] [RELEASE] Update website to include documentation for 4.8.2\n1448d12aa [Yong Zhang] Migrate command `listfilesondisk`\n4de598379 [Yong Zhang] Issue #1987: Migrate command `convert-to-interleaved-storage`\n468743e7e [Matteo Merli] In DbLedgerStorage use default values when config key is present but empty\nf26a4cae0 [Ivan Kelly] Release notes for v4.8.2\nec2636cd2 [Yong Zhang] Issue #1985: Migrate command `convert-to-db-storage`\n8cc7239ac [Yong Zhang] Issue #1982: Migrate command `bookiesanity`\nfa90f0185 [Yong Zhang] Issue #1980: Migrate command `ledger` from shell to bkctl", "commitGitStats": [{"lines": 121, "deletions": 0, "insertions": 121, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/tools/cli/commands/autorecovery/ToggleCommand.java"}, {"lines": 2, "deletions": 0, "insertions": 2, "filePath": "tools/ledger/src/main/java/org/apache/bookkeeper/tools/cli/commands/AutoRecoveryCommandGroup.java"}, {"lines": 45, "deletions": 40, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieShell.java"}, {"lines": 123, "deletions": 0, "insertions": 123, "filePath": "tools/ledger/src/test/java/org/apache/bookkeeper/tools/cli/commands/autorecovery/AutoRecoveryCommandTest.java"}], "commitParents": ["ed008f27807a75ba384246fc7fae6ca3a5a6971f"], "commitDateTime": "2019-04-16 16:48:32", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-16 16:48:32"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "MVCCStoreFactoryImpl.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stream.storage.impl.store.MVCCStoreFactoryImpl.closeStores(long)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stream.storage.impl.store.MVCCStoreFactoryImpl.addStore(long,long,long,org.apache.bookkeeper.statelib.api.mvcc.MVCCAsyncStore)"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stream.storage.impl.store.MVCCStoreFactoryImpl.newStore(long,long,long)"}]}, {"spoonFilePath": "StorageContainerRegistryImpl.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stream.storage.impl.sc.StorageContainerRegistryImpl.unsafeStartStorageContainer(long)"}]}], "nameRev": "fe0e0d88b4f36e25aebd81c5b3596cbcd2c2d21e tags/release-4.9.2~2", "commitHash": "fe0e0d88b4f36e25aebd81c5b3596cbcd2c2d21e", "commitMessage": "ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n\nDescriptions of the changes in this PR:\r\n\r\n### Motivation\r\n\r\nIf not releasing resources of failed/closed asyncStore, new creating of the same store identifier will fail, mainly caused by RocksDBException, like #2020 shows.\r\n\r\n### Changes\r\n\r\nadd scStores to factory's instance variable at the `addstore` method of `MVCCStoreFactoryImpl` class;\r\nrelease store when open fail;\r\n\r\nDescriptions of the changes in this PR:\r\n\r\nMaster Issue: #2020 \r\n\r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #2022 from ArvinDevel/issue2020, closes #2020", "commitGitStats": [{"lines": 16, "deletions": 1, "insertions": 15, "filePath": "stream/storage/impl/src/main/java/org/apache/bookkeeper/stream/storage/impl/store/MVCCStoreFactoryImpl.java"}, {"lines": 5, "deletions": 0, "insertions": 5, "filePath": "stream/storage/impl/src/main/java/org/apache/bookkeeper/stream/storage/impl/sc/StorageContainerRegistryImpl.java"}], "commitParents": ["c89d6afd53ac98e0302002521d06699d4d710c3a"], "commitDateTime": "2019-05-03 09:52:38", "commitUser": "merlimat", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-02 00:27:42"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "TriggerAuditCommandTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.autorecovery.TriggerAuditCommandTest"}]}, {"spoonFilePath": "AutoRecoveryCommandGroup.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 4, "MOV": 1, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.AutoRecoveryCommandGroup"}]}, {"spoonFilePath": "package-info.java", "spoonMethods": []}, {"spoonFilePath": "TriggerAuditCommand.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.autorecovery.TriggerAuditCommand"}]}, {"spoonFilePath": "BookieShell.java", "spoonMethods": [{"INS": 1, "DEL": 2, "TOT": 9, "MOV": 2, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.TriggerAuditCmd.runCmd(org.apache.commons.cli.CommandLine)"}]}], "nameRev": "6f33968019c3452cefc2d78e0258bb3206d78e8a tags/release-4.10.0~80", "commitHash": "6f33968019c3452cefc2d78e0258bb3206d78e8a", "commitMessage": "Migrate command `triggeraudit`\n\nDescriptions of the changes in this PR:\r\n\r\n- Using `bkctl` run command `triggeraudit`\r\n\r\n### Motivation\r\n\r\n#2011 \n\nReviewers: Sijie Guo <sijie@apache.org>, Jia Zhai <zhaijia@apache.org>\n\nThis closes #2012 from zymap/command-triggeraudit and squashes the following commits:\n\n5a4b496ec [Yong Zhang] Fix conflict ---\n236b7d6e5 [Yong Zhang] Fix validation\nb039b637e [Yong Zhang] Rename file\n8bea52522 [Yong Zhang] Remove unused imports\nd39d1e886 [Yong Zhang] Migrate command `triggeraudit`\n60d993edf [Yong Zhang] Migrate command `autorecovery`\ned008f278 [Yong Zhang] Migrate command `whoisauditor`\n5b8e0971a [Yong Zhang] Migrate command `Whatisinstanceid`\n90c79444d [Yong Zhang] Migrate command `rebuild-db-ledger-locations-index`\n848f8527f [Nicolas Michael] ISSUE #2053: Bugfix for Percentile Calculation in FastCodahale Timer Implementation\n06f2b6f50 [Yong Zhang] Migrate command `updateledgers`\n7ad5849b1 [Yong Zhang] Migrate command `regenerate-interleaved-storage-index-file`\nd4dbb6bfb [Dongfa,Huang] Avoid useless verify if LedgerEntryRequest completed\n5c150f283 [Enrico Olivelli] Release notes for 4.9.1\n1246826ba [Yong Zhang] Migrate command `recover`\n1d4cc71fd [Yong Zhang] Migrate command `localconsistencycheck`\n67f83620e [Yong Zhang] Migrate command `readledger`\nbfbd6b023 [Yong Zhang] Migrate command `decommission`\nd40b8b69f [Yong Zhang] Migrate command `readlog`\n95d145a15 [Yong Zhang] Migrate command `nukeexistingcluster`\ne2b1dc7f3 [Yong Zhang] Migrate command `listunderreplicated`\n0988e12c7 [bd2019us] ISSUE #2023: change cached thread pool to fixed thread pool\n6a6d7bbd9 [Yong Zhang] Migrate command `initnewcluster`\nc391fe58d [Yong Zhang] Migrate command `readlogmetadata`\n120d67737 [Yong Zhang] Migrate command `lostbookierecoverydelay`\nbf66235e5 [Yong Zhang] Migrate command `deleteledger`\n751e55fa4 [Arvin] ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n138a7ae85 [Yong Zhang] Migrate command `metadataformat`\nb043d1694 [Yong Zhang] Migrate command `listledgers`\n4573285db [Ivan Kelly] Docker autobuild hook\ne3d807a32 [Like] Fix IDE complain as there are multi choices for error code\n9524a9f4a [Yong Zhang] Migrate command `readjournal`\n6c3f33f55 [Yong Zhang] Fix when met unexpect entry id crashed\ne35a108c7 [Like] Fix error message for unrecognized number-of-bookies\n5902ee27b [Boyang Jerry Peng] fix potential NPE when releasing entry that is null\n6aa73ce05 [Ivan Kelly] [RELEASE] Update website to include documentation for 4.8.2\n1448d12aa [Yong Zhang] Migrate command `listfilesondisk`\n4de598379 [Yong Zhang] Issue #1987: Migrate command `convert-to-interleaved-storage`\n468743e7e [Matteo Merli] In DbLedgerStorage use default values when config key is present but empty\nf26a4cae0 [Ivan Kelly] Release notes for v4.8.2\nec2636cd2 [Yong Zhang] Issue #1985: Migrate command `convert-to-db-storage`\n8cc7239ac [Yong Zhang] Issue #1982: Migrate command `bookiesanity`\nfa90f0185 [Yong Zhang] Issue #1980: Migrate command `ledger` from shell to bkctl", "commitGitStats": [{"lines": 19, "deletions": 12, "insertions": 7, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/tools/cli/commands/autorecovery/package-info.java"}, {"lines": 7, "deletions": 0, "insertions": 7, "filePath": "tools/ledger/src/main/java/org/apache/bookkeeper/tools/cli/commands/AutoRecoveryCommandGroup.java"}, {"lines": 14, "deletions": 11, "insertions": 3, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieShell.java"}, {"lines": 68, "deletions": 0, "insertions": 68, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/tools/cli/commands/autorecovery/TriggerAuditCommand.java"}, {"lines": 81, "deletions": 0, "insertions": 81, "filePath": "tools/ledger/src/test/java/org/apache/bookkeeper/tools/cli/commands/autorecovery/TriggerAuditCommandTest.java"}], "commitParents": ["60d993edf50417ace9777d2f40cc2bbc97510125"], "commitDateTime": "2019-04-17 14:32:24", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-17 14:32:24"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "BookieCommandGroup.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 5, "MOV": 1, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.BookieCommandGroup"}]}, {"spoonFilePath": "ReadLedgerCommand.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookie.ReadLedgerCommand"}]}, {"spoonFilePath": "BookieShell.java", "spoonMethods": [{"INS": 10, "DEL": 9, "TOT": 61, "MOV": 20, "UPD": 22, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.ReadLedgerEntriesCmd.runCmd(org.apache.commons.cli.CommandLine)"}]}, {"spoonFilePath": "ReadLedgerCommandTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookie.ReadLedgerCommandTest"}]}], "nameRev": "67f83620eb8ed93bf73322293deb1a1bde8d09c7 tags/release-4.10.0~92", "commitHash": "67f83620eb8ed93bf73322293deb1a1bde8d09c7", "commitMessage": "Migrate command `readledger`\n\nDescriptions of the changes in this PR:\r\n\r\n#2040 \r\n\r\n- Using `bkctl` run `readledger`\r\n\r\n```\r\nRead a range of entries from a ledger.\r\n\r\nUsage:  bkctl bookie readledger [flags]\r\n\r\nFlags:\r\n\r\n    -b, --bookie\r\n        Only read from a specific bookie\r\n\r\n    -ef, --entryformatter\r\n        Set entry formatter\r\n\r\n    -fe, --firstentryid\r\n        First Entry ID\r\n\r\n    -r, --force-recovery\r\n        Ensure the ledger is properly closed before reading\r\n\r\n    -le, --lastentryid\r\n        Last Entry ID\r\n\r\n    -l, --ledgerid\r\n        Ledger ID\r\n\r\n    -lf, --ledgeridformatter\r\n        Set ledger id formatter\r\n\r\n    -m, --msg\r\n        Print message body\r\n\r\n\r\n    -h, --help\r\n        Display help information\r\n```\r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #2041 from zymap/command-readledger and squashes the following commits:\n\n56b0a4581 [Yong Zhang] Remove unused import\n30dafa85f [Yong Zhang] Merge branch 'master' into command-readledger\nbfbd6b023 [Yong Zhang] Migrate command `decommission`\nd40b8b69f [Yong Zhang] Migrate command `readlog`\n95d145a15 [Yong Zhang] Migrate command `nukeexistingcluster`\ne2b1dc7f3 [Yong Zhang] Migrate command `listunderreplicated`\nc465c4761 [Yong Zhang] Remove unused import\n0988e12c7 [bd2019us] ISSUE #2023: change cached thread pool to fixed thread pool\n6a6d7bbd9 [Yong Zhang] Migrate command `initnewcluster`\n931df8c2c [Sijie Guo] Merge branch 'master' into command-readledger\nc391fe58d [Yong Zhang] Migrate command `readlogmetadata`\n120d67737 [Yong Zhang] Migrate command `lostbookierecoverydelay`\nbf66235e5 [Yong Zhang] Migrate command `deleteledger`\n87e6644f2 [Yong Zhang] Fix some conflict\n5ae05f0d2 [Yong Zhang] Migrate command `readledger`\n751e55fa4 [Arvin] ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n138a7ae85 [Yong Zhang] Migrate command `metadataformat`\nb043d1694 [Yong Zhang] Migrate command `listledgers`\n4573285db [Ivan Kelly] Docker autobuild hook\ne3d807a32 [Like] Fix IDE complain as there are multi choices for error code\n9524a9f4a [Yong Zhang] Migrate command `readjournal`\n6c3f33f55 [Yong Zhang] Fix when met unexpect entry id crashed\ne35a108c7 [Like] Fix error message for unrecognized number-of-bookies\n5902ee27b [Boyang Jerry Peng] fix potential NPE when releasing entry that is null\n6aa73ce05 [Ivan Kelly] [RELEASE] Update website to include documentation for 4.8.2\n1448d12aa [Yong Zhang] Migrate command `listfilesondisk`\n4de598379 [Yong Zhang] Issue #1987: Migrate command `convert-to-interleaved-storage`\n468743e7e [Matteo Merli] In DbLedgerStorage use default values when config key is present but empty\nf26a4cae0 [Ivan Kelly] Release notes for v4.8.2\nec2636cd2 [Yong Zhang] Issue #1985: Migrate command `convert-to-db-storage`\n8cc7239ac [Yong Zhang] Issue #1982: Migrate command `bookiesanity`\nfa90f0185 [Yong Zhang] Issue #1980: Migrate command `ledger` from shell to bkctl", "commitGitStats": [{"lines": 2, "deletions": 0, "insertions": 2, "filePath": "tools/ledger/src/main/java/org/apache/bookkeeper/tools/cli/commands/BookieCommandGroup.java"}, {"lines": 244, "deletions": 0, "insertions": 244, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/tools/cli/commands/bookie/ReadLedgerCommand.java"}, {"lines": 169, "deletions": 0, "insertions": 169, "filePath": "tools/ledger/src/test/java/org/apache/bookkeeper/tools/cli/commands/bookie/ReadLedgerCommandTest.java"}, {"lines": 104, "deletions": 91, "insertions": 13, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieShell.java"}], "commitParents": ["bfbd6b023b68ca0c23bf976274279ac8338181f5"], "commitDateTime": "2019-04-03 21:30:16", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-03 21:30:16"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "BookieCommandGroup.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.BookieCommandGroup"}]}, {"spoonFilePath": "BookieShell.java", "spoonMethods": [{"INS": 1, "DEL": 3, "TOT": 12, "MOV": 1, "UPD": 7, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.LocalConsistencyCheck.runCmd(org.apache.commons.cli.CommandLine)"}]}, {"spoonFilePath": "LocalConsistencyCheckCommand.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookie.LocalConsistencyCheckCommand"}]}, {"spoonFilePath": "LocalConsistencyCheckCommandTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tools.cli.commands.bookie.LocalConsistencyCheckCommandTest"}]}], "nameRev": "1d4cc71fd77ab803a3ebec5a8e7f1b8f51de92c9 tags/release-4.10.0~91", "commitHash": "1d4cc71fd77ab803a3ebec5a8e7f1b8f51de92c9", "commitMessage": "Migrate command `localconsistencycheck`\n\nDescriptions of the changes in this PR:\r\n\r\n#2042 \r\n\r\nUsing bkctl run command localconsistencycheck\r\n\r\n```\r\nValidate Ledger Storage internal metadata\r\nUsage:  bkctl bookie localconsistencycheck [flags]\r\nFlags:\r\n\r\n    -h, --help\r\n        Display help information\r\n```\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #2043 from zymap/command-localconsistencycheck and squashes the following commits:\n\nc31f07a00 [Sijie Guo] Merge branch 'master' into command-localconsistencycheck\nc391fe58d [Yong Zhang] Migrate command `readlogmetadata`\n120d67737 [Yong Zhang] Migrate command `lostbookierecoverydelay`\nbf66235e5 [Yong Zhang] Migrate command `deleteledger`\nc9bb4a42c [Yong Zhang] Migrate command `localconsistencycheck`\n751e55fa4 [Arvin] ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n138a7ae85 [Yong Zhang] Migrate command `metadataformat`\nb043d1694 [Yong Zhang] Migrate command `listledgers`\n4573285db [Ivan Kelly] Docker autobuild hook\ne3d807a32 [Like] Fix IDE complain as there are multi choices for error code\n9524a9f4a [Yong Zhang] Migrate command `readjournal`\n6c3f33f55 [Yong Zhang] Fix when met unexpect entry id crashed\ne35a108c7 [Like] Fix error message for unrecognized number-of-bookies\n5902ee27b [Boyang Jerry Peng] fix potential NPE when releasing entry that is null\n6aa73ce05 [Ivan Kelly] [RELEASE] Update website to include documentation for 4.8.2\n1448d12aa [Yong Zhang] Migrate command `listfilesondisk`\n4de598379 [Yong Zhang] Issue #1987: Migrate command `convert-to-interleaved-storage`\n468743e7e [Matteo Merli] In DbLedgerStorage use default values when config key is present but empty\nf26a4cae0 [Ivan Kelly] Release notes for v4.8.2\nec2636cd2 [Yong Zhang] Issue #1985: Migrate command `convert-to-db-storage`\n8cc7239ac [Yong Zhang] Issue #1982: Migrate command `bookiesanity`\nfa90f0185 [Yong Zhang] Issue #1980: Migrate command `ledger` from shell to bkctl", "commitGitStats": [{"lines": 2, "deletions": 0, "insertions": 2, "filePath": "tools/ledger/src/main/java/org/apache/bookkeeper/tools/cli/commands/BookieCommandGroup.java"}, {"lines": 77, "deletions": 0, "insertions": 77, "filePath": "tools/ledger/src/test/java/org/apache/bookkeeper/tools/cli/commands/bookie/LocalConsistencyCheckCommandTest.java"}, {"lines": 19, "deletions": 15, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieShell.java"}, {"lines": 77, "deletions": 0, "insertions": 77, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/tools/cli/commands/bookie/LocalConsistencyCheckCommand.java"}], "commitParents": ["67f83620eb8ed93bf73322293deb1a1bde8d09c7"], "commitDateTime": "2019-04-03 21:40:06", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-03 21:40:06"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "ZkUtils.java", "spoonMethods": [{"INS": 2, "DEL": 1, "TOT": 7, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.ZkUtils.asyncDeleteFullPathOptimistic(org.apache.zookeeper.ZooKeeper,java.lang.String,int,org.apache.zookeeper.AsyncCallback$VoidCallback,java.lang.String).2.processResult(int,java.lang.String,java.lang.Object)"}]}], "nameRev": "335c2aba9bfd24eff224f1afae393026c17a2d5a tags/release-4.10.0~59", "commitHash": "335c2aba9bfd24eff224f1afae393026c17a2d5a", "commitMessage": "[BK-CLIENT] Check empty ledger-parent node while deleting ledger\n\n### Motivation\r\n\r\nAs discussed at [#4276](https://github.com/apache/pulsar/issues/4276), while deleting ledger, bk-client should check parent node is empty before issuing delete request for parent znode.\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Charan Reddy Guttapalem <reddycharan18@gmail.com>, Matteo Merli <mmerli@apache.org>\n\nThis closes #2097 from rdhabalia/led_del and squashes the following commits:\n\nf5c0ca36c [rdhabalia] return callback with ok\nede5e9403 [rdhabalia] [Bk-Client] Check empty ledger-parent node while deleting ledger\nd35aa22ad [Charan Reddy Guttapalem] Move common placementpolicy components to TopologyAwareEnsemblePlacementPolicy.\nb4ca4537b [Charan Reddy Guttapalem] Move common placementpolicy components to TopologyAwareEnsemblePlacementPolicy.\naa84c7fdd [Charan Reddy Guttapalem] GetListOfEntriesOfLedger implementation\n10859afb7 [Matteo Merli] Added HTTP handler to expose bookie state\n707ae5c85 [karanmehta93] ISSUE #2075: Bookieshell lastmark command isn't functional, always returning 0-0\n41b39c6ef [Charan Reddy Guttapalem] ISSUE #1967: make ledger creation and removal robust to zk connectionloss\n973d2ab0d [Matteo Merli] Use pure python implementation of MurmurHash\n9bb7e4b82 [Venkateswararao Jujjuri (JV)] Explicit error message if extent is not present on ZK (#2066)\nbd699e61d [mtang01] ISSUE #2067: reduce byte[] allocation in add entry\n7c62e1232 [karanmehta93] ISSUE #2073: ReadOnlyBookieTest#testBookieContinueWritingIfMulti\u2026\n42e77802c [Ivan Kelly] DLog Namespace#openLog should declare LogNotFoundException\n86bce12b5 [Yong Zhang] Migrate command `ledgermetadata`\n407cb35e5 [Charan Reddy Guttapalem] ISSUE #1967: make ledger creation and removal robust to zk connectionloss\neaa601404 [Like] Support asynchronous fence request for V2 ReadEntryProcessor\nd23b45ec8 [Ivan Kelly] Fix typo in overview page for 4.8.2\n44ee320b6 [Ivan Kelly] k\n316b71923 [Ivan Kelly] Wait for LAC update even if ledger fenced\n066621507 [Yong Zhang] Migrate command `updatecookie`\n6f3396801 [Yong Zhang] Migrate command `triggeraudit`\n60d993edf [Yong Zhang] Migrate command `autorecovery`\ned008f278 [Yong Zhang] Migrate command `whoisauditor`\n5b8e0971a [Yong Zhang] Migrate command `Whatisinstanceid`\n90c79444d [Yong Zhang] Migrate command `rebuild-db-ledger-locations-index`\n848f8527f [Nicolas Michael] ISSUE #2053: Bugfix for Percentile Calculation in FastCodahale Timer Implementation\n06f2b6f50 [Yong Zhang] Migrate command `updateledgers`\n7ad5849b1 [Yong Zhang] Migrate command `regenerate-interleaved-storage-index-file`\nd4dbb6bfb [Dongfa,Huang] Avoid useless verify if LedgerEntryRequest completed\n5c150f283 [Enrico Olivelli] Release notes for 4.9.1\n1246826ba [Yong Zhang] Migrate command `recover`\n1d4cc71fd [Yong Zhang] Migrate command `localconsistencycheck`\n67f83620e [Yong Zhang] Migrate command `readledger`\nbfbd6b023 [Yong Zhang] Migrate command `decommission`\nd40b8b69f [Yong Zhang] Migrate command `readlog`\n95d145a15 [Yong Zhang] Migrate command `nukeexistingcluster`\ne2b1dc7f3 [Yong Zhang] Migrate command `listunderreplicated`\n0988e12c7 [bd2019us] ISSUE #2023: change cached thread pool to fixed thread pool\n6a6d7bbd9 [Yong Zhang] Migrate command `initnewcluster`\nc391fe58d [Yong Zhang] Migrate command `readlogmetadata`\n120d67737 [Yong Zhang] Migrate command `lostbookierecoverydelay`\nbf66235e5 [Yong Zhang] Migrate command `deleteledger`\n751e55fa4 [Arvin] ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n138a7ae85 [Yong Zhang] Migrate command `metadataformat`\nb043d1694 [Yong Zhang] Migrate command `listledgers`\n4573285db [Ivan Kelly] Docker autobuild hook\ne3d807a32 [Like] Fix IDE complain as there are multi choices for error code\n9524a9f4a [Yong Zhang] Migrate command `readjournal`\n6c3f33f55 [Yong Zhang] Fix when met unexpect entry id crashed\ne35a108c7 [Like] Fix error message for unrecognized number-of-bookies\n5902ee27b [Boyang Jerry Peng] fix potential NPE when releasing entry that is null\n6aa73ce05 [Ivan Kelly] [RELEASE] Update website to include documentation for 4.8.2\n1448d12aa [Yong Zhang] Migrate command `listfilesondisk`\n4de598379 [Yong Zhang] Issue #1987: Migrate command `convert-to-interleaved-storage`\n468743e7e [Matteo Merli] In DbLedgerStorage use default values when config key is present but empty\nf26a4cae0 [Ivan Kelly] Release notes for v4.8.2\nec2636cd2 [Yong Zhang] Issue #1985: Migrate command `convert-to-db-storage`\n8cc7239ac [Yong Zhang] Issue #1982: Migrate command `bookiesanity`\nfa90f0185 [Yong Zhang] Issue #1980: Migrate command `ledger` from shell to bkctl", "commitGitStats": [{"lines": 11, "deletions": 1, "insertions": 10, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/ZkUtils.java"}], "commitParents": ["2ff26d69e400d16f533f424c6e95f2f30189e183"], "commitDateTime": "2019-05-17 15:39:12", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-05-17 00:39:12"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tableservice", "release/4.10.0", "release/4.9.2", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Error on starting pulsar standalone using Pulsar 2.2", "numCommits": 0, "body": "1. It was okay to start pulsar standalone using `bin/pulsar-daemon start standalone`\r\n2. The machine was crashed due to other issues.\r\n3. After the machine is rebooted, run `bin/pulsar-daemon start standalone` again. It failed to start due to following errors:\r\n```\r\ndir /home/work/service/apache-pulsar-2.2.0/data/bookkeeper/ranges/ranges/000000000000000000/000000000000000001/000000000000000000\r\norg.rocksdb.RocksDBException: While lock file: /home/work/service/apache-pulsar-2.2.0/data/bookkeeper/ranges/ranges/000000000000000000/000000000000000001/000000000000000000/current/LOCK: \u6ca1\u6709\u53ef\u7528\u7684\u9501\r\n\tat org.rocksdb.RocksDB.open(Native Method) ~[org.rocksdb-rocksdbjni-5.13.3.jar:?]\r\n\tat org.rocksdb.RocksDB.open(RocksDB.java:286) ~[org.rocksdb-rocksdbjni-5.13.3.jar:?]\r\n\tat org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.openRocksdb(RocksdbKVStore.java:323) ~[org.apache.bookkeeper-statelib-4.7.2.jar:4.7.2]\r\n\tat org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.openLocalDB(RocksdbKVStore.java:298) ~[org.apache.bookkeeper-statelib-4.7.2.jar:4.7.2]\r\n\tat org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.openRocksdb(RocksdbKVStore.java:288) ~[org.apache.bookkeeper-statelib-4.7.2.jar:4.7.2]\r\n\tat org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.init(RocksdbKVStore.java:233) ~[org.apache.bookkeeper-statelib-4.7.2.jar:4.7.2]\r\n\tat org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$initializeLocalStore$5(AbstractStateStoreWithJournal.java:202) ~[org.apache.bookkeeper-statelib-4.7.2.jar:4.7.2]\r\n\tat org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$executeIO$16(AbstractStateStoreWithJournal.java:471) ~[org.apache.bookkeeper-statelib-4.7.2.jar:4.7.2]\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_161]\r\n\tat com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:111) [org.apache.pulsar-pulsar-functions-metrics-2.2.0.jar:?]\r\n\tat com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:58) [org.apache.pulsar-pulsar-functions-metrics-2.2.0.jar:?]\r\n\tat com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:75) [org.apache.pulsar-pulsar-functions-metrics-2.2.0.jar:?]\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_161]\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_161]\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_161]\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [?:1.8.0_161]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_161]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_161]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_161]\r\n17:18:16.374 [io-write-scheduler-OrderedScheduler-1-0] WARN  org.apache.bookkeeper.stream.storage.impl.sc.StorageContainerRegistryImpl - De-registered StorageContainer ('0') when failed to start\r\njava.util.concurrent.CompletionException: org.apache.bookkeeper.statelib.api.exceptions.StateStoreException: Failed to restore rocksdb 000000000000000000/000000000000000000/000000000000000000\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292) ~[?:1.8.0_161]\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308) ~[?:1.8.0_161]\r\n\tat java.util.concurrent.CompletableFuture.uniCompose(CompletableFuture.java:943) ~[?:1.8.0_161]\r\n\tat java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:926) ~[?:1.8.0_161]\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_161]\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1977) ~[?:1.8.0_161]\r\n\tat org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$executeIO$16(AbstractStateStoreWithJournal.java:474) ~[org.apache.bookkeeper-statelib-4.7.2.jar:4.7.2]\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_161]\r\n\tat com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:111) [org.apache.pulsar-pulsar-functions-metrics-2.2.0.jar:?]\r\n\tat com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:58) [org.apache.pulsar-pulsar-functions-metrics-2.2.0.jar:?]\r\n\tat com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:75) [org.apache.pulsar-pulsar-functions-metrics-2.2.0.jar:?]\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_161]\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_161]\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_161]\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [?:1.8.0_161]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_161]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_161]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_161]\r\nCaused by: org.apache.bookkeeper.statelib.api.exceptions.StateStoreException: Failed to restore rocksdb 000000000000000000/000000000000000000/000000000000000000\r\n\tat org.apache.bookkeeper.statelib.impl.rocksdb.checkpoint.RocksCheckpointer.restore(RocksCheckpointer.java:84) ~[org.apache.bookkeeper-statelib-4.7.2.jar:4.7.2]\r\n\tat org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.loadRocksdbFromCheckpointStore(RocksdbKVStore.java:161) ~[org.apache.bookkeeper-statelib-4.7.2.jar:4.7.2]\r\n\tat org.apache.bookkeeper.statelib.impl.kv.RocksdbKVStore.init(RocksdbKVStore.java:223) ~[org.apache.bookkeeper-statelib-4.7.2.jar:4.7.2]\r\n\tat org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$initializeLocalStore$5(AbstractStateStoreWithJournal.java:202) ~[org.apache.bookkeeper-statelib-4.7.2.jar:4.7.2]\r\n\tat org.apache.bookkeeper.statelib.impl.journal.AbstractStateStoreWithJournal.lambda$executeIO$16(AbstractStateStoreWithJournal.java:471) ~[org.apache.bookkeeper-statelib-4.7.2.jar:4.7.2]\r\n\t... 12 more\r\nCaused by: java.io.FileNotFoundException: \r\n```\r\n\r\n4. `bin/pulsar-daemon start standalone -nss` can bypass the issue.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 6, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"751e55fa433172422fb82556ff748c5f6f2bfc41": {"commitUser": "sijie", "commitGHEventType": "closed"}, "60d993edf50417ace9777d2f40cc2bbc97510125": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}, "335c2aba9bfd24eff224f1afae393026c17a2d5a": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}, "fe0e0d88b4f36e25aebd81c5b3596cbcd2c2d21e": {"commitUser": "merlimat", "commitGHEventType": "referenced"}, "67f83620eb8ed93bf73322293deb1a1bde8d09c7": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}, "1d4cc71fd77ab803a3ebec5a8e7f1b8f51de92c9": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}, "6f33968019c3452cefc2d78e0258bb3206d78e8a": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}}, "closed": "2019-04-01 16:27:47", "url": "https://github.com/apache/bookkeeper/issues/2020", "user": "xinln", "ttf": 2.000277777777778}, {"created": "2019-03-26 04:40:24", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "EntryLocationIndex.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex.removeOffsetFromDeletedLedgers()"}]}, {"spoonFilePath": "EntryLocationIndexTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndexTest.testDeleteSpecialEntry()"}]}], "nameRev": "6c3f33f55fc3754925323b1d077108331d027aaf tags/release-4.10.0~108", "commitHash": "6c3f33f55fc3754925323b1d077108331d027aaf", "commitMessage": "Fix when met unexpect entry id crashed\n\n\r\nFixes #2001\r\n\r\n*Motivation*\r\n\r\nWhen met a unexpect entry id, db indexes failed cleanup.\r\n\r\n*Modifications*\r\n\r\nCatch the exception and ignore it.\r\n\r\nMaster Issue: #2001 \r\n\r\n\r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Matteo Merli <mmerli@apache.org>\n\nThis closes #2002 from zymap/fixnoentryexception", "commitGitStats": [{"lines": 10, "deletions": 1, "insertions": 9, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/storage/ldb/EntryLocationIndex.java"}, {"lines": 32, "deletions": 0, "insertions": 32, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/storage/ldb/EntryLocationIndexTest.java"}], "commitParents": ["e35a108c7a47d746d5010ee5178712496741cc18"], "commitDateTime": "2019-03-27 08:35:48", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-03-27 23:35:48"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "EntryLocationIndex.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex.removeOffsetFromDeletedLedgers()"}]}, {"spoonFilePath": "EntryLocationIndexTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndexTest.testDeleteSpecialEntry()"}]}], "nameRev": "f6f0f653d871792572ba504ffa80092f4803958d tags/release-4.9.2~13", "commitHash": "f6f0f653d871792572ba504ffa80092f4803958d", "commitMessage": "Fix when met unexpect entry id crashed\n\n\r\nFixes #2001\r\n\r\n*Motivation*\r\n\r\nWhen met a unexpect entry id, db indexes failed cleanup.\r\n\r\n*Modifications*\r\n\r\nCatch the exception and ignore it.\r\n\r\nMaster Issue: #2001 \r\n\r\n\r\n\n\nReviewers: Jia Zhai <zhaijia@apache.org>, Matteo Merli <mmerli@apache.org>\n\nThis closes #2002 from zymap/fixnoentryexception\n\n(cherry picked from commit 6c3f33f55fc3754925323b1d077108331d027aaf)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 10, "deletions": 1, "insertions": 9, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/storage/ldb/EntryLocationIndex.java"}, {"lines": 32, "deletions": 0, "insertions": 32, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/storage/ldb/EntryLocationIndexTest.java"}], "commitParents": ["4f80f82e177eddf04a2e3239a9a729ada695eafd"], "commitDateTime": "2019-03-27 08:36:36", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-03-27 23:35:48"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "[DbLedgerStorage] Failed to cleanup db indexes due to NoEntryException", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\n\r\n```\r\n00:39:38.506 [db-storage-cleanup-10-1] WARN  org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage - Failed to cleanup db indexes\r\norg.apache.bookkeeper.bookie.Bookie$NoEntryException: Entry -1 not found in 472560206455324944\r\n        at org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex.getLastEntryInLedgerInternal(EntryLocationIndex.java:123) ~[org.apache.         bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n        at org.apache.bookkeeper.bookie.storage.ldb.EntryLocationIndex.removeOffsetFromDeletedLedgers(EntryLocationIndex.java:219) ~[org.apache.       bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n        at org.apache.bookkeeper.bookie.storage.ldb.SingleDirectoryDbLedgerStorage.lambda$checkpoint$7(SingleDirectoryDbLedgerStorage.java:624) ~[org. apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) [?:1.8.0_181]\r\n        at java.util.concurrent.FutureTask.run(FutureTask.java:266) [?:1.8.0_181]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180) [?:1.8.0_181]\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293) [?:1.8.0_181]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_181]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_181]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]            at java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\n```\r\n\r\ndb cleanup process will be aborted when failed to no entries found in entry index location.\r\n\r\n***Expected behavior***\r\n\r\ndb clean up should proceed even there are no entries.\r\n\r\n***Additional context***\r\n\r\n```\r\n                    entryLocationIndex.removeOffsetFromDeletedLedgers();\r\n                    ledgerIndex.removeDeletedLedgers();\r\n```\r\n\r\nremoving entry locations and ledger index entry is not an atomic operation. if the bookie crashes between removed offsets and removing index entry, then when the bookie comes back online it will fail to delete entries since there are no entries to delete.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"6c3f33f55fc3754925323b1d077108331d027aaf": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "f6f0f653d871792572ba504ffa80092f4803958d": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2019-03-27 15:35:49", "url": "https://github.com/apache/bookkeeper/issues/2001", "user": "sijie", "ttf": 1.0002777777777778}, {"created": "2019-03-01 17:28:40", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerHandle.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.getWriteSetForReadOperation(long)"}, {"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.recordReadErrorOnBookie(int)"}, {"INS": 2, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle"}]}, {"spoonFilePath": "EnsemblePlacementPolicy.java", "spoonMethods": [{"INS": 2, "DEL": 2, "TOT": 8, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.getStickyReadBookieIndex(org.apache.bookkeeper.client.api.LedgerMetadata,java.util.Optional)"}]}], "nameRev": "96fc2e2aac4d026fe336ae8347521d9910165dd5 tags/release-4.10.0~45", "commitHash": "96fc2e2aac4d026fe336ae8347521d9910165dd5", "commitMessage": "Issue #1970: Ensure getStickyReadBookieIndex returns valid bookie index\n\nDescriptions of the changes in this PR:\r\n\r\nMaster Issue: #1970\r\nRelated Issues: apache/pulsar#3715 apache/pulsar#4526\r\n\r\n*Motivation*\r\n\r\nFixes #1970\r\n\r\nBy default bookie uses a random generator to generate a bookie index as the sticky\r\nread bookie index. However the random generator will generate negative numbers. Hence\r\nit will generate negative bookie indexes in write set and cause ArrayIndexOutOfBoundException\r\nwhen bookkeeper attempts to read entries.\r\n\r\n*Modifications*\r\n\r\nMake sure getStickyReadBookieIndex not return negative number.\r\n\r\n*Verify this change*\r\n\r\nThis problem introduced by a random generator. It is very hard to write a unit test to reproduce this issue.\r\nExisting StickyRead tests are good to cover this code change.\r\n\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <zhaijia@apache.org>, Yong Zhang <zhangyong1025.zy@gmail.com>\n\nThis closes #2111 from sijie/fix_sticky_read, closes #1970", "commitGitStats": [{"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java"}, {"lines": 5, "deletions": 2, "insertions": 3, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/EnsemblePlacementPolicy.java"}], "commitParents": ["533dd5d6e9d3ac9b24d2462f6ae4d4240a4bffdf"], "commitDateTime": "2019-06-20 20:19:53", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-06-20 20:19:53"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerHandle.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.getWriteSetForReadOperation(long)"}, {"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.recordReadErrorOnBookie(int)"}, {"INS": 2, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle"}]}, {"spoonFilePath": "EnsemblePlacementPolicy.java", "spoonMethods": [{"INS": 2, "DEL": 2, "TOT": 8, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.getStickyReadBookieIndex(org.apache.bookkeeper.client.api.LedgerMetadata,java.util.Optional)"}]}], "nameRev": "a35e6c157745a86da6e71da8b2711995a322f09b remotes/origin/branch-4.9~6", "commitHash": "a35e6c157745a86da6e71da8b2711995a322f09b", "commitMessage": "Issue #1970: Ensure getStickyReadBookieIndex returns valid bookie index\n\nDescriptions of the changes in this PR:\r\n\r\nMaster Issue: #1970\r\nRelated Issues: apache/pulsar#3715 apache/pulsar#4526\r\n\r\n*Motivation*\r\n\r\nFixes #1970\r\n\r\nBy default bookie uses a random generator to generate a bookie index as the sticky\r\nread bookie index. However the random generator will generate negative numbers. Hence\r\nit will generate negative bookie indexes in write set and cause ArrayIndexOutOfBoundException\r\nwhen bookkeeper attempts to read entries.\r\n\r\n*Modifications*\r\n\r\nMake sure getStickyReadBookieIndex not return negative number.\r\n\r\n*Verify this change*\r\n\r\nThis problem introduced by a random generator. It is very hard to write a unit test to reproduce this issue.\r\nExisting StickyRead tests are good to cover this code change.\r\n\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <zhaijia@apache.org>, Yong Zhang <zhangyong1025.zy@gmail.com>\n\nThis closes #2111 from sijie/fix_sticky_read, closes #1970", "commitGitStats": [{"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java"}, {"lines": 5, "deletions": 2, "insertions": 3, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/EnsemblePlacementPolicy.java"}], "commitParents": ["bdf206e5710baf33e85c28ab5bb2b37763ce5f8a"], "commitDateTime": "2019-06-20 20:20:34", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-06-20 20:19:53"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Exception when sending read requests", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n***Describe the bug***\r\n\r\nGot reports from Pulsar users (with BK 4.9.0) of these errors: \r\n\r\n```\r\n17:24:16.302 [BookKeeperClientWorker-OrderedExecutor-0-0] ERROR org.apache.bookkeeper.common.util.SafeRunnable - Unexpected throwable caught \r\njava.lang.ArrayIndexOutOfBoundsException: -2\r\n    at com.google.common.collect.RegularImmutableList.get(RegularImmutableList.java:60) ~[com.google.guava-guava-21.0.jar:?]\r\n    at org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest.sendNextRead(PendingReadOp.java:400) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest.read(PendingReadOp.java:382) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.client.PendingReadOp.initiate(PendingReadOp.java:526) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.client.PendingReadOp.safeRun(PendingReadOp.java:536) ~[org.apache.bookkeeper-bookkeeper-server-4.9.0.jar:4.9.0]\r\n    at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.9.0.jar:4.9.0]\r\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_181]\r\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_181]\r\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.32.Final.jar:4.1.32.Final]\r\n    at java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"96fc2e2aac4d026fe336ae8347521d9910165dd5": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "a35e6c157745a86da6e71da8b2711995a322f09b": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2019-06-21 03:19:54", "url": "https://github.com/apache/bookkeeper/issues/1970", "user": "merlimat", "ttf": 111.00027777777778}, {"created": "2019-02-27 19:41:37", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BookKeeperTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.BookKeeperTest.testZKConnectionLossForLedgerCreation()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.BookKeeperTest"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.BookKeeperTest.testLedgerDeletionIdempotency()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.BookKeeperTest.MockZooKeeperClient"}]}, {"spoonFilePath": "AbstractZkLedgerManagerTest.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManagerTest.testRemoveLedgerMetadataException()"}, {"INS": 1, "DEL": 2, "TOT": 7, "MOV": 3, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManagerTest.testRemoveLedgerMetadataNoNode()"}]}, {"spoonFilePath": "LedgerMetadataBuilder.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataBuilder.build()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataBuilder.withCToken(long)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataBuilder"}]}, {"spoonFilePath": "LedgerMetadataImpl.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataImpl"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataImpl.getCToken()"}]}, {"spoonFilePath": "TestLedgerMetadataSerDe.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.meta.TestLedgerMetadataSerDe"}]}, {"spoonFilePath": "AbstractZkLedgerManager.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManager.removeLedgerMetadata(long,org.apache.bookkeeper.versioning.Version).2.processResult(int,java.lang.String,java.lang.Object)"}, {"INS": 2, "DEL": 2, "TOT": 12, "MOV": 7, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManager.createLedgerMetadata(long,org.apache.bookkeeper.client.api.LedgerMetadata).1.processResult(int,java.lang.String,java.lang.Object,java.lang.String)"}, {"INS": 3, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManager.createLedgerMetadata(long,org.apache.bookkeeper.client.api.LedgerMetadata)"}]}, {"spoonFilePath": "LedgerMetadata.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.api.getCToken()"}]}, {"spoonFilePath": "ZooKeeperClient.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.zookeeper.ZooKeeperClient"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.zookeeper.ZooKeeperClient.waitForConnection()"}]}, {"spoonFilePath": "LedgerMetadataSerDe.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.LedgerMetadataSerDe"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.LedgerMetadataSerDe.decodeFormat(org.apache.bookkeeper.proto.DataFormats.LedgerMetadataFormat,org.apache.bookkeeper.client.LedgerMetadataBuilder)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.LedgerMetadataSerDe.serializeVersion3(org.apache.bookkeeper.client.api.LedgerMetadata)"}]}], "nameRev": "407cb35e594e2334ae687f7c884651c7642349fa tags/release-4.10.0~74", "commitHash": "407cb35e594e2334ae687f7c884651c7642349fa", "commitMessage": "ISSUE #1967: make ledger creation and removal robust to zk connectionloss\n\n\r\nDescriptions of the changes in this PR:\r\n\r\nThe bookkeeper project ZooKeeperClient wrapper for the ZooKeeper client\r\nwill resend zk node creations and removals upon reconnect after a\r\nConnectionLoss event. In the event that the original succeeded, the\r\nresent operation will erroneously return LedgerExistException or\r\nNoSuchLedgerExistsException for creation and removal respectively.\r\n\r\nFor removal, this patch limits the operation by allowing it to always\r\nsucceed if the ledger does not exist in order to make it idempotent.\r\nThis is appears to be the simplest solution as exclusive removal isn't\r\nimportant.\r\n\r\n**Note, the above is an actual change to the bk client semantics**\r\n\r\nFor creation, exclusive creation is cleary important for correctness,\r\nso this patch adds a creator token field to the LedgerMetdata to\r\ndisambiguate the above race from a real race. For\r\nAbstractZkLedgerManager, this is simply a random long value.\r\n\r\nThere's an oportunity for optimization with the above if exclusive\r\nledger creation failures are expected to be common.  You only actually\r\nneed to perform this check if the operation was really resent.  I chose\r\nnot to go this route yet because it would require messing with the\r\nZooKeeperClient interface to surface that information without burdening\r\nother callers.\r\n\r\nIf the client is set to version 2 or older, this field will be ignored\r\nand the old behavior will be retained.  If the client is version 3 or\r\nnewer but creation races with an older client, the new client will\r\ninterpret the nonce to be BLANK and thereby detect the race correctly.\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #2006 from reddycharan/zkretrialrobust, closes #1967", "commitGitStats": [{"lines": 10, "deletions": 0, "insertions": 10, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerMetadataImpl.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/meta/TestLedgerMetadataSerDe.java"}, {"lines": 2, "deletions": 0, "insertions": 2, "filePath": "bookkeeper-proto/src/main/proto/DataFormats.proto"}, {"lines": 7, "deletions": 0, "insertions": 7, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/api/LedgerMetadata.java"}, {"lines": 142, "deletions": 1, "insertions": 141, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookKeeperTest.java"}, {"lines": 8, "deletions": 1, "insertions": 7, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/LedgerMetadataSerDe.java"}, {"lines": 5, "deletions": 3, "insertions": 2, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/meta/AbstractZkLedgerManagerTest.java"}, {"lines": 54, "deletions": 5, "insertions": 49, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/AbstractZkLedgerManager.java"}, {"lines": 9, "deletions": 0, "insertions": 9, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerMetadataBuilder.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/zookeeper/ZooKeeperClient.java"}, {"lines": 38, "deletions": 1, "insertions": 37, "filePath": "tests/backward-compat/current-server-old-clients/src/test/groovy/org/apache/bookkeeper/tests/backwardcompat/TestCompatOldClients.groovy"}, {"lines": 20, "deletions": 4, "insertions": 16, "filePath": "tests/backward-compat/yahoo-custom-version/src/test/groovy/org/apache/bookkeeper/tests/backwardcompat/TestCompatUpgradeYahooCustom.groovy"}], "commitParents": ["eaa6014049e6bc8253f5b0282e4ace8a3aff92e2"], "commitDateTime": "2019-04-19 10:11:08", "commitUser": "reddycharan", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-04-19 10:11:08"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "AbstractZkLedgerManagerTest.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 10, "MOV": 1, "UPD": 8, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManagerTest.setup()"}, {"INS": 4, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.AbstractZkLedgerManagerTest.testCreateLedgerMetadataNodeExists()"}]}, {"spoonFilePath": "TestLedgerMetadataSerDe.java", "spoonMethods": [{"INS": 0, "DEL": 2, "TOT": 4, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.TestLedgerMetadataSerDe.testPeggedToV2SerDe()"}, {"INS": 0, "DEL": 1, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.TestLedgerMetadataSerDe.testStoreSystemtimeAsLedgerCtimeDisabledWithVersion2()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.TestLedgerMetadataSerDe.testStoreSystemtimeAsLedgerCtimeEnabledWithVersion2()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.TestLedgerMetadataSerDe.testPeggedToV3SerDe()"}]}, {"spoonFilePath": "LedgerMetadataSerDe.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.LedgerMetadataSerDe.parseVersion3Config(java.io.InputStream)"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.LedgerMetadataSerDe.serializeVersion3(org.apache.bookkeeper.client.api.LedgerMetadata)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.LedgerMetadataSerDe.parseConfig(byte[],java.util.Optional)"}, {"INS": 4, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.LedgerMetadataSerDe.parseVersion3Config(java.io.InputStream,java.util.Optional)"}]}], "nameRev": "41b39c6eff249729a698838e880ad77cc0c18c67 tags/release-4.10.0~67", "commitHash": "41b39c6eff249729a698838e880ad77cc0c18c67", "commitMessage": "ISSUE #1967: make ledger creation and removal robust to zk connectionloss\n\n\r\n- fix test failures in TestLedgerMetadataSerDe\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #2070 from reddycharan/fixzktestfailures, closes #1967", "commitGitStats": [{"lines": 14, "deletions": 2, "insertions": 12, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/meta/AbstractZkLedgerManagerTest.java"}, {"lines": 22, "deletions": 5, "insertions": 17, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/LedgerMetadataSerDe.java"}, {"lines": 13, "deletions": 7, "insertions": 6, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/meta/TestLedgerMetadataSerDe.java"}], "commitParents": ["973d2ab0da91e5a24b1d30990ca6bb1484f07f7e"], "commitDateTime": "2019-05-02 11:42:49", "commitUser": "reddycharan", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-05-02 11:42:49"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "ZkUtils.java", "spoonMethods": [{"INS": 2, "DEL": 1, "TOT": 7, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.ZkUtils.asyncDeleteFullPathOptimistic(org.apache.zookeeper.ZooKeeper,java.lang.String,int,org.apache.zookeeper.AsyncCallback$VoidCallback,java.lang.String).2.processResult(int,java.lang.String,java.lang.Object)"}]}], "nameRev": "335c2aba9bfd24eff224f1afae393026c17a2d5a tags/release-4.10.0~59", "commitHash": "335c2aba9bfd24eff224f1afae393026c17a2d5a", "commitMessage": "[BK-CLIENT] Check empty ledger-parent node while deleting ledger\n\n### Motivation\r\n\r\nAs discussed at [#4276](https://github.com/apache/pulsar/issues/4276), while deleting ledger, bk-client should check parent node is empty before issuing delete request for parent znode.\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Charan Reddy Guttapalem <reddycharan18@gmail.com>, Matteo Merli <mmerli@apache.org>\n\nThis closes #2097 from rdhabalia/led_del and squashes the following commits:\n\nf5c0ca36c [rdhabalia] return callback with ok\nede5e9403 [rdhabalia] [Bk-Client] Check empty ledger-parent node while deleting ledger\nd35aa22ad [Charan Reddy Guttapalem] Move common placementpolicy components to TopologyAwareEnsemblePlacementPolicy.\nb4ca4537b [Charan Reddy Guttapalem] Move common placementpolicy components to TopologyAwareEnsemblePlacementPolicy.\naa84c7fdd [Charan Reddy Guttapalem] GetListOfEntriesOfLedger implementation\n10859afb7 [Matteo Merli] Added HTTP handler to expose bookie state\n707ae5c85 [karanmehta93] ISSUE #2075: Bookieshell lastmark command isn't functional, always returning 0-0\n41b39c6ef [Charan Reddy Guttapalem] ISSUE #1967: make ledger creation and removal robust to zk connectionloss\n973d2ab0d [Matteo Merli] Use pure python implementation of MurmurHash\n9bb7e4b82 [Venkateswararao Jujjuri (JV)] Explicit error message if extent is not present on ZK (#2066)\nbd699e61d [mtang01] ISSUE #2067: reduce byte[] allocation in add entry\n7c62e1232 [karanmehta93] ISSUE #2073: ReadOnlyBookieTest#testBookieContinueWritingIfMulti\u2026\n42e77802c [Ivan Kelly] DLog Namespace#openLog should declare LogNotFoundException\n86bce12b5 [Yong Zhang] Migrate command `ledgermetadata`\n407cb35e5 [Charan Reddy Guttapalem] ISSUE #1967: make ledger creation and removal robust to zk connectionloss\neaa601404 [Like] Support asynchronous fence request for V2 ReadEntryProcessor\nd23b45ec8 [Ivan Kelly] Fix typo in overview page for 4.8.2\n44ee320b6 [Ivan Kelly] k\n316b71923 [Ivan Kelly] Wait for LAC update even if ledger fenced\n066621507 [Yong Zhang] Migrate command `updatecookie`\n6f3396801 [Yong Zhang] Migrate command `triggeraudit`\n60d993edf [Yong Zhang] Migrate command `autorecovery`\ned008f278 [Yong Zhang] Migrate command `whoisauditor`\n5b8e0971a [Yong Zhang] Migrate command `Whatisinstanceid`\n90c79444d [Yong Zhang] Migrate command `rebuild-db-ledger-locations-index`\n848f8527f [Nicolas Michael] ISSUE #2053: Bugfix for Percentile Calculation in FastCodahale Timer Implementation\n06f2b6f50 [Yong Zhang] Migrate command `updateledgers`\n7ad5849b1 [Yong Zhang] Migrate command `regenerate-interleaved-storage-index-file`\nd4dbb6bfb [Dongfa,Huang] Avoid useless verify if LedgerEntryRequest completed\n5c150f283 [Enrico Olivelli] Release notes for 4.9.1\n1246826ba [Yong Zhang] Migrate command `recover`\n1d4cc71fd [Yong Zhang] Migrate command `localconsistencycheck`\n67f83620e [Yong Zhang] Migrate command `readledger`\nbfbd6b023 [Yong Zhang] Migrate command `decommission`\nd40b8b69f [Yong Zhang] Migrate command `readlog`\n95d145a15 [Yong Zhang] Migrate command `nukeexistingcluster`\ne2b1dc7f3 [Yong Zhang] Migrate command `listunderreplicated`\n0988e12c7 [bd2019us] ISSUE #2023: change cached thread pool to fixed thread pool\n6a6d7bbd9 [Yong Zhang] Migrate command `initnewcluster`\nc391fe58d [Yong Zhang] Migrate command `readlogmetadata`\n120d67737 [Yong Zhang] Migrate command `lostbookierecoverydelay`\nbf66235e5 [Yong Zhang] Migrate command `deleteledger`\n751e55fa4 [Arvin] ISSUE #2020: close db properly to avoid open RocksDB failure at the second time\n138a7ae85 [Yong Zhang] Migrate command `metadataformat`\nb043d1694 [Yong Zhang] Migrate command `listledgers`\n4573285db [Ivan Kelly] Docker autobuild hook\ne3d807a32 [Like] Fix IDE complain as there are multi choices for error code\n9524a9f4a [Yong Zhang] Migrate command `readjournal`\n6c3f33f55 [Yong Zhang] Fix when met unexpect entry id crashed\ne35a108c7 [Like] Fix error message for unrecognized number-of-bookies\n5902ee27b [Boyang Jerry Peng] fix potential NPE when releasing entry that is null\n6aa73ce05 [Ivan Kelly] [RELEASE] Update website to include documentation for 4.8.2\n1448d12aa [Yong Zhang] Migrate command `listfilesondisk`\n4de598379 [Yong Zhang] Issue #1987: Migrate command `convert-to-interleaved-storage`\n468743e7e [Matteo Merli] In DbLedgerStorage use default values when config key is present but empty\nf26a4cae0 [Ivan Kelly] Release notes for v4.8.2\nec2636cd2 [Yong Zhang] Issue #1985: Migrate command `convert-to-db-storage`\n8cc7239ac [Yong Zhang] Issue #1982: Migrate command `bookiesanity`\nfa90f0185 [Yong Zhang] Issue #1980: Migrate command `ledger` from shell to bkctl", "commitGitStats": [{"lines": 11, "deletions": 1, "insertions": 10, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/ZkUtils.java"}], "commitParents": ["2ff26d69e400d16f533f424c6e95f2f30189e183"], "commitDateTime": "2019-05-17 15:39:12", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-05-17 00:39:12"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "area/config", "area/metadata", "area/protocol", "area/tests", "release/4.10.0", "type/bug", "type/feature", "type/improvement"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Ledger creation and removal can return erroneous errors if there is a zk ConnectionLoss event while the update is inflight", "numCommits": 0, "body": "The bookkeeper project ZooKeeperClient wrapper (not to be confused with ZooKeeper or the distributed log analogue) will resend zk node creations and removals upon reconnect after a ConnectionLoss event.  In the event that the original succeeded, the resent operation will erroneously return LedgerExistException or NoSuchLedgerExistsException for creation and removal respectively.\r\n\r\nFor removal, I propose limiting the operation to be idempotent by letting it succeed if the ledger does not exist.  This is by far the simplest solution if exclusive removal isn't important.\r\n\r\nFor creation, exclusive creation is genuinely important for correctness, so I suggest adding a unique nonce to the LedgerMetadata to disambiguate the above race from a real race.  For zk, this can simply be the zk session id.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 2, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"407cb35e594e2334ae687f7c884651c7642349fa": {"commitUser": "reddycharan", "commitGHEventType": "closed"}, "41b39c6eff249729a698838e880ad77cc0c18c67": {"commitUser": "reddycharan", "commitGHEventType": "referenced"}, "335c2aba9bfd24eff224f1afae393026c17a2d5a": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}}, "closed": "2019-04-19 17:11:13", "url": "https://github.com/apache/bookkeeper/issues/1967", "user": "athanatos", "ttf": 50.000277777777775}, {"created": "2019-02-25 13:00:35", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "StatsLoggerBenchmark.java", "spoonMethods": [{"INS": 0, "DEL": 2, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.StatsLoggerBenchmark"}]}], "nameRev": "b689d8313654de21759b2e2d47210b75434038c3 tags/release-4.10.0~130", "commitHash": "b689d8313654de21759b2e2d47210b75434038c3", "commitMessage": "Fix unable download twitter dependencies\n\n---\r\n\r\nFixes #1962\r\n\r\n*Motivation*\r\n\r\nThere are some twitter dependencies can't download from repo\r\n\r\n*Modifications*\r\n\r\n- remove some using in StatsLoggerBenchmark.java\r\n- update some config in pom.xml\r\n\r\nDescriptions of the changes in this PR:\r\n\r\nYou can add -Dtwitter to choose add twitter dependencies.\r\n\r\n### Motivation\r\n\r\n(Explain: why you're making that change, what is the problem you're trying to solve)\r\n\r\n### Changes\r\n\r\n(Describe: what changes you have made)\r\n\r\nMaster Issue: #1962\r\n\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <zhaijia@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #1966 from zymap/master", "commitGitStats": [{"lines": 21, "deletions": 3, "insertions": 18, "filePath": "bookkeeper-stats-providers/pom.xml"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "microbenchmarks/src/main/java/org/apache/bookkeeper/stats/StatsLoggerBenchmark.java"}, {"lines": 10, "deletions": 10, "insertions": 0, "filePath": "microbenchmarks/pom.xml"}, {"lines": 20, "deletions": 20, "insertions": 0, "filePath": "bookkeeper-server/pom.xml"}], "commitParents": ["9ad191ca0fc0bf2eaeabdc5dc796c8c53fe390a8"], "commitDateTime": "2019-02-27 15:21:49", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-02-27 15:21:49"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Failed to download twitter maven repo dependencies", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\nWhen compiling using maven, there are some twitter maven repo can't download.\r\nThe dependencies are used by twitter-science-provider module.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"b689d8313654de21759b2e2d47210b75434038c3": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2019-02-27 07:21:50", "url": "https://github.com/apache/bookkeeper/issues/1962", "user": "zymap", "ttf": 1.0002777777777778}, {"created": "2019-02-25 11:23:40", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "DistributedLogAdmin.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 5, "MOV": 1, "UPD": 3, "spoonMethodName": "org.apache.distributedlog.admin.DistributedLogAdmin.UnbindCommand.runCmd(org.apache.commons.cli.CommandLine)"}]}], "nameRev": "ecf1c715f88feb8bcaf08b9063f774b0443f7ead tags/release-4.10.0~39", "commitHash": "ecf1c715f88feb8bcaf08b9063f774b0443f7ead", "commitMessage": "Issue #1961: Included ZooKeeper client AclId.\n\nDescriptions of the changes in this PR:\r\nIncluded ZooKeeper Acl to the builder.\r\n\r\n### Changes\r\n\r\nIt is now possible to unbind DistributedLog namesapaces.\r\n\r\nMaster Issue: #1961\r\n\r\n\nReviewers: Ivan Kelly <ivank@apache.org>, Sijie Guo <None>\n\nThis closes #2118 from hugomiguelabreu/master, closes #1961", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/distributedlog/core/src/main/java/org/apache/distributedlog/admin/DistributedLogAdmin.java"}], "commitParents": ["1adc93f05954fdb06d7e8b548d606e281831924a"], "commitDateTime": "2019-07-17 15:41:39", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-07-17 08:41:39"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/dlog", "triage/week-10", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "bin/dlog unbind is broken", "numCommits": 0, "body": "```\r\nroot@XXXXX:/bookkeeper# bin/dlog admin unbind -f distributedlog://XXXX:2181/XXXXX\r\nFail to run tool org.apache.distributedlog.admin.DistributedLogAdmin : \r\njava.lang.IllegalArgumentException: Zookeeper acl id not set.\r\n        at com.google.common.base.Preconditions.checkArgument(Preconditions.java:122)\r\n        at org.apache.distributedlog.ZooKeeperClientBuilder.validateParameters(ZooKeeperClientBuilder.java:199)\r\n        at org.apache.distributedlog.ZooKeeperClientBuilder.buildClient(ZooKeeperClientBuilder.java:215)\r\n        at org.apache.distributedlog.ZooKeeperClientBuilder.build(ZooKeeperClientBuilder.java:209)\r\n        at org.apache.distributedlog.admin.DistributedLogAdmin$UnbindCommand.runCmd(DistributedLogAdmin.java:464)\r\n        at org.apache.distributedlog.tools.Tool$OptsCommand.runCmd(Tool.java:96)\r\n        at org.apache.distributedlog.tools.Tool.run(Tool.java:223)\r\n        at org.apache.distributedlog.tools.Tool.main(Tool.java:239)\r\n```\r\n\r\nIt looks like the builder for ZooKeeperClient requires something be set for the acl, even if null.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"ecf1c715f88feb8bcaf08b9063f774b0443f7ead": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2019-07-17 07:41:46", "url": "https://github.com/apache/bookkeeper/issues/1961", "user": "ivankelly", "ttf": 141.00027777777777}, {"created": "2019-02-25 10:53:07", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LocalDLMEmulator.java", "spoonMethods": [{"INS": 5, "DEL": 2, "TOT": 10, "MOV": 2, "UPD": 1, "spoonMethodName": "org.apache.distributedlog.LocalDLMEmulator.main(java.lang.String[])"}]}], "nameRev": "54ce17312f53c9b2a1ac3ea83303a7bebebc0a31 tags/release-4.10.0~44", "commitHash": "54ce17312f53c9b2a1ac3ea83303a7bebebc0a31", "commitMessage": "Added zookeeper host configuration. Closes #1960\n\nDescriptions of the changes in this PR:\r\nAdded host IP binding to sandbox.\r\n\r\n### Motivation\r\nAllowing running the sandbox inside guest machines and be accessible by all system (including other guest machines). When binding 127.0.0.1 other guest machines will experience an error. By allowing to bind the correct IP the namespace will be available and correctly configured for other hosts.\r\n\r\n### Changes\r\nAdded a new argument to the _dlog_ tool allowing to define the host IP to bind ZooKeeper and DistributedLog namespace.\r\n\r\nMaster Issue: #1960\r\n\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #2081 from hugomiguelabreu/master, closes #1960", "commitGitStats": [{"lines": 15, "deletions": 3, "insertions": 12, "filePath": "stream/distributedlog/core/src/main/java/org/apache/distributedlog/LocalDLMEmulator.java"}], "commitParents": ["96fc2e2aac4d026fe336ae8347521d9910165dd5"], "commitDateTime": "2019-06-20 20:22:33", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-06-21 04:22:33"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/dlog", "triage/week-10", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Configure sandbox binding", "numCommits": 0, "body": "**FEATURE REQUEST**\r\nWhen running the docker sandbox, the default namespace for DistributedLog is bonded to the 127.0.0.1.\r\n\r\nI think it would be nice to configure such IP, as for development sometimes there are multiple virtual machines and containers running. And for fast prototyping, the sandbox is very useful, but when deploying code on a VM that same machine will not be able to connect correctly to the sandbox.\r\n\r\nMeanwhile, a new namespace with the correct IP can be created to workaround.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"54ce17312f53c9b2a1ac3ea83303a7bebebc0a31": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2019-06-21 03:22:38", "url": "https://github.com/apache/bookkeeper/issues/1960", "user": "hugomiguelabreu", "ttf": 115.00027777777778}, {"created": "2019-02-01 14:25:02", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LocalBookKeeper.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 5, "MOV": 2, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.initializeZookeeper(java.lang.String,int)"}]}], "nameRev": "4fe353425ef6e6df1a04cd1be541139881abae9b tags/release-4.10.0~52", "commitHash": "4fe353425ef6e6df1a04cd1be541139881abae9b", "commitMessage": "ISSUE #1927: fix NoNodeException in LocalBookeeper\n\n### Motivation\r\nIt addresses #1927 where it provides a conf check at the beginning of startLocalBookiesInternal function.\r\n### Changes\r\n\r\n- Add a conf check at the beginning of startLocalBookiesInternal function where non-default zkLedgersRootPath is not allowed.\r\n\r\ncc sijie \n\nReviewers: Ivan Kelly <ivank@apache.org>, Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #2082 from zhaohaidao/master, closes #1927", "commitGitStats": [{"lines": 9, "deletions": 6, "insertions": 3, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/LocalBookKeeper.java"}], "commitParents": ["b88f4b813f5ee5846b4879972e2c8359ac0eb4f2"], "commitDateTime": "2019-06-06 09:31:27", "commitUser": "ivankelly", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-06-06 15:31:27"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "area/utils", "release/4.10.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "localbookie cannot be started with a ledger path which isn't on the root level", "numCommits": 0, "body": "74bd92605bc4986705031aea8943905dbc9f9f85 allowed the client to overwrite localbookie configurations from conf/bk_server.conf\r\n\r\nHowever, if you set the zkLedgersRootPath to something like /messaging/bookkeeper/ledgers, it will fail because it doesn't create the parent znodes (and there's no other way to do it since this is localbookie, and it only lives for the lifetime of the process).", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"4fe353425ef6e6df1a04cd1be541139881abae9b": {"commitUser": "ivankelly", "commitGHEventType": "closed"}}, "closed": "2019-06-06 07:31:33", "url": "https://github.com/apache/bookkeeper/issues/1927", "user": "ivankelly", "ttf": 124.00027777777778}, {"created": "2019-02-01 14:22:20", "closed": "2019-03-26 14:48:58", "title": "dlog core pulls in log4j", "url": "https://github.com/apache/bookkeeper/issues/1926", "body": "dlog core is a client library. it shouldn't pull in log4j and the log4j slf4j adapter as that interferes with the logging of the application which is pulling it in.", "commits": {}, "user": "ivankelly", "commitsDetails": [], "labels": ["area/dlog", "help wanted", "triage/week-7", "type/bug"], "ttf": 53.000277777777775}, {"created": "2019-01-31 10:57:23", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LocalBookKeeper.java", "spoonMethods": [{"INS": 1, "DEL": 2, "TOT": 6, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.serializeLocalBookieConfig(org.apache.bookkeeper.conf.ServerConfiguration,java.lang.String)"}, {"INS": 2, "DEL": 2, "TOT": 5, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.main(java.lang.String[])"}]}], "nameRev": "e35a108c7a47d746d5010ee5178712496741cc18 tags/release-4.10.0~109", "commitHash": "e35a108c7a47d746d5010ee5178712496741cc18", "commitMessage": "Fix error message for unrecognized number-of-bookies\n\nCloses #1925 \n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1997 from liketic/fix-issue-1925", "commitGitStats": [{"lines": 15, "deletions": 4, "insertions": 11, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/LocalBookKeeper.java"}], "commitParents": ["5902ee27be2fb7eeade53f5e8e4afd3fe573ad5c"], "commitDateTime": "2019-03-26 22:11:17", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-03-27 13:11:17"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "LocalBookKeeper.java", "spoonMethods": [{"INS": 1, "DEL": 2, "TOT": 6, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.serializeLocalBookieConfig(org.apache.bookkeeper.conf.ServerConfiguration,java.lang.String)"}, {"INS": 2, "DEL": 2, "TOT": 5, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.main(java.lang.String[])"}]}], "nameRev": "4f80f82e177eddf04a2e3239a9a729ada695eafd tags/release-4.9.2~14", "commitHash": "4f80f82e177eddf04a2e3239a9a729ada695eafd", "commitMessage": "Fix error message for unrecognized number-of-bookies\n\nCloses #1925 \n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1997 from liketic/fix-issue-1925\n\n(cherry picked from commit e35a108c7a47d746d5010ee5178712496741cc18)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 15, "deletions": 4, "insertions": 11, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/LocalBookKeeper.java"}], "commitParents": ["f139bbc970bb8fd03f8fa023f5a1c3996dedc28e"], "commitDateTime": "2019-03-26 22:11:27", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2019-03-27 13:11:17"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tools", "help wanted", "triage/week-7", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "localbookie error messages are rubbish when started incorrectly", "numCommits": 0, "body": "I couldn't remember the correct invokation. It didn't help me.\r\n\r\n```\r\nivan@tethra:~/Junk/bookkeeper-4.9.0-rc1/bookkeeper-all-4.9.0$ bin/bookkeeper localbookie\r\nJAVA_HOME not set, using java from PATH. (/usr/bin/java)\r\nivan@tethra:~/Junk/bookkeeper-4.9.0-rc1/bookkeeper-all-4.9.0$ bin/bookkeeper localbookie -n 5\r\nJAVA_HOME not set, using java from PATH. (/usr/bin/java)\r\n2019-01-31 11:44:44,618 - ERROR - [main:LocalBookKeeper@477] - Exiting LocalBookKeeper because of exception in main method\r\njava.lang.NumberFormatException: For input string: \"-n\"\r\n        at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)\r\n        at java.lang.Integer.parseInt(Integer.java:580)\r\n        at java.lang.Integer.parseInt(Integer.java:615)\r\n        at org.apache.bookkeeper.util.LocalBookKeeper.main(LocalBookKeeper.java:449)\r\njava.lang.NumberFormatException: For input string: \"-n\"\r\n        at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)\r\n        at java.lang.Integer.parseInt(Integer.java:580)\r\n        at java.lang.Integer.parseInt(Integer.java:615)\r\n        at org.apache.bookkeeper.util.LocalBookKeeper.main(LocalBookKeeper.java:449)\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"4f80f82e177eddf04a2e3239a9a729ada695eafd": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "e35a108c7a47d746d5010ee5178712496741cc18": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2019-03-27 05:11:18", "url": "https://github.com/apache/bookkeeper/issues/1925", "user": "ivankelly", "ttf": 54.000277777777775}, {"created": "2018-11-20 13:50:59", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "VertxHttpServer.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.VertxHttpServer.startServer(int)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.VertxHttpServer"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.VertxHttpServer.getListeningPort()"}]}, {"spoonFilePath": "TestVertxHttpServer.java", "spoonMethods": [{"INS": 2, "DEL": 2, "TOT": 7, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.TestVertxHttpServer.testStartBasicHttpServer()"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.TestVertxHttpServer.getNextPort()"}, {"INS": 2, "DEL": 2, "TOT": 7, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.TestVertxHttpServer.testStartMetricsServiceOnRouterPath()"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.TestVertxHttpServer"}]}], "nameRev": "3e255e82b8aa9c3d6b71ed4679c690062489a0c3 tags/release-4.8.2~8", "commitHash": "3e255e82b8aa9c3d6b71ed4679c690062489a0c3", "commitMessage": "Let OS choose port for vertx test\n\nThe previous implementation was searching for a open port by\nrepeatedly trying to startServer on ports starting at 8080. However,\nafter the first attempt fails, the Vertx instance in VertxHttpServer\nis broken and the test hangs. 8080 is a very common port to have stuff\nrunning on, so these hangs have happened to be repeatedly.\n\nThis fix is to allow the OS to choose the port, by specifying 0 as the\nlistening port and querying afterwards.\n\nIssue: #1821\n\nReviewers: Sijie Guo <sijie@apache.org>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #1853 from ivankelly/vertx-8080\n\n(cherry picked from commit b39564183eb8cab5ab21752843fe65a949fc96ff)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 25, "deletions": 20, "insertions": 5, "filePath": "bookkeeper-http/vertx-http-server/src/test/java/org/apache/bookkeeper/http/vertx/TestVertxHttpServer.java"}, {"lines": 10, "deletions": 2, "insertions": 8, "filePath": "bookkeeper-http/vertx-http-server/src/main/java/org/apache/bookkeeper/http/vertx/VertxHttpServer.java"}], "commitParents": ["36686d6a2825c867d1d02e5b33b4a763c2c67893"], "commitDateTime": "2018-11-30 16:06:47", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-12-01 01:06:29"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "VertxHttpServer.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.VertxHttpServer.startServer(int)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.VertxHttpServer"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.VertxHttpServer.getListeningPort()"}]}, {"spoonFilePath": "TestVertxHttpServer.java", "spoonMethods": [{"INS": 2, "DEL": 2, "TOT": 7, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.TestVertxHttpServer.testStartBasicHttpServer()"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.TestVertxHttpServer.getNextPort()"}, {"INS": 2, "DEL": 2, "TOT": 7, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.TestVertxHttpServer.testStartMetricsServiceOnRouterPath()"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.TestVertxHttpServer"}]}], "nameRev": "b39564183eb8cab5ab21752843fe65a949fc96ff tags/release-4.9.0~51", "commitHash": "b39564183eb8cab5ab21752843fe65a949fc96ff", "commitMessage": "Let OS choose port for vertx test\n\nThe previous implementation was searching for a open port by\r\nrepeatedly trying to startServer on ports starting at 8080. However,\r\nafter the first attempt fails, the Vertx instance in VertxHttpServer\r\nis broken and the test hangs. 8080 is a very common port to have stuff\r\nrunning on, so these hangs have happened to be repeatedly.\r\n\r\nThis fix is to allow the OS to choose the port, by specifying 0 as the\r\nlistening port and querying afterwards.\r\n\r\nIssue: #1821\r\n\n\nReviewers: Sijie Guo <sijie@apache.org>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #1853 from ivankelly/vertx-8080", "commitGitStats": [{"lines": 25, "deletions": 20, "insertions": 5, "filePath": "bookkeeper-http/vertx-http-server/src/test/java/org/apache/bookkeeper/http/vertx/TestVertxHttpServer.java"}, {"lines": 10, "deletions": 2, "insertions": 8, "filePath": "bookkeeper-http/vertx-http-server/src/main/java/org/apache/bookkeeper/http/vertx/VertxHttpServer.java"}], "commitParents": ["d6007edc419751378e5f7efb2a944693c1956401"], "commitDateTime": "2018-11-30 16:06:29", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-12-01 01:06:29"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "TestVertxHttpServer hangs forever if 8080 already in use", "numCommits": 0, "body": "First off, it shouldn't be using 8080, it should be using a random free port.\r\n\r\nBut also, the test should fail rather than hanging forever. This is super annoying when you're running a full test run, and bookkeeper-server has passed and then you get caught on this.\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"3e255e82b8aa9c3d6b71ed4679c690062489a0c3": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "b39564183eb8cab5ab21752843fe65a949fc96ff": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-12-05 17:17:11", "url": "https://github.com/apache/bookkeeper/issues/1821", "user": "ivankelly", "ttf": 15.000277777777777}, {"created": "2018-11-14 09:31:11", "closed": "2019-02-21 09:40:19", "title": "StandaloneTest does not pass without building sources with -Dstream profile", "url": "https://github.com/apache/bookkeeper/issues/1811", "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\nIntegration tests are not passing if you do not compile sources with -Dstream (Stream Storage profile)\r\nI am seeing it on branch-4.8 but the same should be on master (4.9) as well\r\n\r\n- What did you do?\r\n\r\n```\r\ngit checkout branch-4.8        \r\nmvn clean install -DskipTests -Pdocker\r\ncd tests\r\nmvn test -DintegrationTests\r\n\r\n```\r\n- What did you expect to see?\r\nAll the tests are passing\r\n\r\n- What did you see instead?\r\norg.apache.bookkeeper.tests.integration.standalone.StandaloneTest does not pass\r\n\r\n```\r\n2018-11-14 10:17:21,803 - INFO  - [dockerjava-netty-1-6:Slf4jLogConsumer@44] - STDOUT: This is root, will use user bookkeeper to run command '/opt/bookkeeper/bin/bookkeeper standalone --num-bookies 3 --zk-port 2181 --initial-bookie-port 3181 --initial-bookie-grpc-port 4181'\r\n2018-11-14 10:17:21,804 - INFO  - [dockerjava-netty-1-6:Slf4jLogConsumer@44] - STDERR: Couldn't find module '(org.apache.bookkeeper-)?stream-storage-server' jar.\r\n2018-11-14 10:17:21,804 - INFO  - [dockerjava-netty-1-6:Slf4jLogConsumer@44] - STDERR: Error: Could not find or load main class org.apache.bookkeeper.stream.cluster.StandaloneStarter\r\n```\r\n", "commits": {}, "user": "eolivelli", "commitsDetails": [], "labels": ["area/build", "triage/week-8", "type/bug"], "ttf": 99.00027777777778}, {"created": "2018-11-09 16:29:40", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "faeb9bb89c40045bd63681ecab662b838cdeec32 tags/release-4.9.0~89", "commitHash": "faeb9bb89c40045bd63681ecab662b838cdeec32", "commitMessage": "ISSUE #1799: bkctl is broken with default build options\n\nDescriptions of the changes in this PR:\r\n\r\n*Motivation*\r\n\r\n`bkctl` is designed in a modularized way for extensibility.\r\nit loads command groups via ServiceLoader. However current build\r\nprofile doesn't leverage this extensibility. Instead it hardcodes\r\nall the commands in one service load file. So if `bkctl` is built\r\nwithout `-Dstream`, it will broke.\r\n\r\n*Changes*\r\n\r\n- move `ledger` related commands to `tools/ledger`\r\n- generate the service load file by concating `commands` files from each module's resources directory.\r\n\r\n*Results*\r\n\r\nbkctl works for all build profiles.\r\n\r\n- without `-Dstream`\r\n\r\n```\r\n$ bin/bkctl\r\n\r\nbkctl interacts and operates Apache BookKeeper clusters\r\n\r\nUsage:  bkctl [flags] [command group] [commands]\r\n\r\nCommands:\r\n\r\n    bookie      Commands on operating a single bookie\r\n    bookies     Commands on operating a cluster of bookies\r\n    cookie      Commands on operating cookies\r\n    ledger      Commands on interacting with ledgers\r\n\r\n    help        Display help information about it\r\n\r\nFlags:\r\n\r\n    -c, --conf\r\n        Configuration file\r\n\r\n    -n, --namespace\r\n        Namespace scope to run commands (only valid for table service for now)\r\n\r\n    -u, --service-uri\r\n        Service Uri\r\n\r\n    -h, --help\r\n        Display help information\r\n\r\nUse \"bkctl [command] --help\" or \"bkctl help [command]\" for more information\r\nabout a command\r\n```\r\n\r\n- with `-Dstream`\r\n\r\n```\r\n$ bin/bkctl\r\n\r\nbkctl interacts and operates Apache BookKeeper clusters\r\n\r\nUsage:  bkctl [flags] [command group] [commands]\r\n\r\nCommands:\r\n\r\n    bookie          Commands on operating a single bookie\r\n    bookies         Commands on operating a cluster of bookies\r\n    cluster         Commands on administrating bookkeeper clusters\r\n    cookie          Commands on operating cookies\r\n    ledger          Commands on interacting with ledgers\r\n    namespace       Commands on operating namespaces\r\n    table           Commands on interacting with tables\r\n    tables          Commands on operating tables\r\n\r\n    help            Display help information about it\r\n\r\nFlags:\r\n\r\n    -c, --conf\r\n        Configuration file\r\n\r\n    -n, --namespace\r\n        Namespace scope to run commands (only valid for table service for now)\r\n\r\n    -u, --service-uri\r\n        Service Uri\r\n\r\n    -h, --help\r\n        Display help information\r\n\r\nUse \"bkctl [command] --help\" or \"bkctl help [command]\" for more information\r\nabout a command\r\n```\r\n\r\nMaster Issue: #1799 \r\n\r\n\r\n\n\nReviewers: Ivan Kelly <ivank@apache.org>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #1800 from sijie/refactor_bkctl, closes #1799", "commitGitStats": [{"lines": 57, "deletions": 0, "insertions": 57, "filePath": "tools/ledger/pom.xml"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/resources/log4j.properties"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/BookieCommandTestBase.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/BKCtl.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/DiscoveryCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/cookie/GetCookieCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/ClientCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/client/SimpleTestCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/cookie/GenerateCookieCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/CommandTestBase.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/commands/package-info.java"}, {"lines": 1, "deletions": 0, "insertions": 1, "filePath": "tools/pom.xml"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/ClientCommandTestBase.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/cookie/UpdateCookieCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/cookie/CreateCookieCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/DiscoveryCommandTestBase.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/commands/BookiesCommandGroup.java"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "tools/{all/src/main/resources/META-INF/services/org.apache.bookkeeper.tools.framework.CommandGroup => ledger/src/main/resources/commands}"}, {"lines": 111, "deletions": 39, "insertions": 72, "filePath": "tools/all/pom.xml"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/commands/BookieCommandGroup.java"}, {"lines": 3, "deletions": 0, "insertions": 3, "filePath": ".gitignore"}, {"lines": 10, "deletions": 1, "insertions": 9, "filePath": "site/docs/latest/getting-started/installation.md"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/BookieShellCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/commands/CookieCommandGroup.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/cookie/DeleteCookieCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/package-info.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/bookie/LastMarkCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/bookies/ListBookiesCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/commands/LedgerCommandGroup.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/CookieCommandTestBase.java"}, {"lines": 22, "deletions": 0, "insertions": 22, "filePath": "tools/stream/src/main/resources/commands"}], "commitParents": ["398aa4cdc4b168f76d453fd74eda66182e24b21f"], "commitDateTime": "2018-11-12 13:42:59", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "tooManyFiles", "authoredDateTime": "2018-11-12 04:42:59"}, {"commitSpoonAstDiffStats": [], "nameRev": "fbfcdbae1c7484f2a783be98b5fdb7db2d7498fd tags/release-4.8.1~2", "commitHash": "fbfcdbae1c7484f2a783be98b5fdb7db2d7498fd", "commitMessage": "ISSUE #1799: bkctl is broken with default build options\n\nThis is a cherry pick of #1799 on branch-4.8.\r\nOriginal commit is from Sijie Guo\r\n\r\nDescriptions of the changes in this PR:\r\n\r\n*Motivation*\r\n\r\n`bkctl` is designed in a modularized way for extensibility.\r\nit loads command groups via ServiceLoader. However current build\r\nprofile doesn't leverage this extensibility. Instead it hardcodes\r\nall the commands in one service load file. So if `bkctl` is built\r\nwithout `-Dstream`, it will broke.\r\n\r\n*Changes*\r\n\r\n- move `ledger` related commands to `tools/ledger`\r\n- generate the service load file by concating `commands` files from each module's resources directory.\r\n\r\n*Results*\r\n\r\nbkctl works for all build profiles.\r\n\r\n- without `-Dstream`\r\n\r\n```\r\n$ bin/bkctl\r\n\r\nbkctl interacts and operates Apache BookKeeper clusters\r\n\r\nUsage:  bkctl [flags] [command group] [commands]\r\n\r\nCommands:\r\n\r\n    bookie      Commands on operating a single bookie\r\n    bookies     Commands on operating a cluster of bookies\r\n    cookie      Commands on operating cookies\r\n    ledger      Commands on interacting with ledgers\r\n\r\n    help        Display help information about it\r\n\r\nFlags:\r\n\r\n    -c, --conf\r\n        Configuration file\r\n\r\n    -n, --namespace\r\n        Namespace scope to run commands (only valid for table service for now)\r\n\r\n    -u, --service-uri\r\n        Service Uri\r\n\r\n    -h, --help\r\n        Display help information\r\n\r\nUse \"bkctl [command] --help\" or \"bkctl help [command]\" for more information\r\nabout a command\r\n```\r\n\r\n- with `-Dstream`\r\n\r\n```\r\n$ bin/bkctl\r\n\r\nbkctl interacts and operates Apache BookKeeper clusters\r\n\r\nUsage:  bkctl [flags] [command group] [commands]\r\n\r\nCommands:\r\n\r\n    bookie          Commands on operating a single bookie\r\n    bookies         Commands on operating a cluster of bookies\r\n    cluster         Commands on administrating bookkeeper clusters\r\n    cookie          Commands on operating cookies\r\n    ledger          Commands on interacting with ledgers\r\n    namespace       Commands on operating namespaces\r\n    table           Commands on interacting with tables\r\n    tables          Commands on operating tables\r\n\r\n    help            Display help information about it\r\n\r\nFlags:\r\n\r\n    -c, --conf\r\n        Configuration file\r\n\r\n    -n, --namespace\r\n        Namespace scope to run commands (only valid for table service for now)\r\n\r\n    -u, --service-uri\r\n        Service Uri\r\n\r\n    -h, --help\r\n        Display help information\r\n\r\nUse \"bkctl [command] --help\" or \"bkctl help [command]\" for more information\r\nabout a command\r\n```\r\n\r\nMaster Issue: #1799\r\n\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #1806 from eolivelli/fix/backport-bkctl, closes #1799", "commitGitStats": [{"lines": 57, "deletions": 0, "insertions": 57, "filePath": "tools/ledger/pom.xml"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/resources/log4j.properties"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/BookieCommandTestBase.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/BKCtl.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/DiscoveryCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/cookie/GetCookieCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/ClientCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/client/SimpleTestCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/cookie/GenerateCookieCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/CommandTestBase.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/commands/package-info.java"}, {"lines": 1, "deletions": 0, "insertions": 1, "filePath": "tools/pom.xml"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/ClientCommandTestBase.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/cookie/UpdateCookieCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/cookie/CreateCookieCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/DiscoveryCommandTestBase.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/commands/BookiesCommandGroup.java"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "tools/{all/src/main/resources/META-INF/services/org.apache.bookkeeper.tools.framework.CommandGroup => ledger/src/main/resources/commands}"}, {"lines": 111, "deletions": 39, "insertions": 72, "filePath": "tools/all/pom.xml"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/commands/BookieCommandGroup.java"}, {"lines": 9, "deletions": 0, "insertions": 9, "filePath": ".gitignore"}, {"lines": 10, "deletions": 1, "insertions": 9, "filePath": "site/docs/latest/getting-started/installation.md"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/BookieShellCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/commands/CookieCommandGroup.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/cookie/DeleteCookieCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/package-info.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/bookie/LastMarkCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/commands/bookies/ListBookiesCommandTest.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/main/java/org/apache/bookkeeper/tools/cli/commands/LedgerCommandGroup.java"}, {"lines": 0, "deletions": 0, "insertions": 0, "filePath": "tools/{all => ledger}/src/test/java/org/apache/bookkeeper/tools/cli/helpers/CookieCommandTestBase.java"}, {"lines": 22, "deletions": 0, "insertions": 22, "filePath": "tools/stream/src/main/resources/commands"}], "commitParents": ["9cb144e2fb83284aae3176ac12185308f8e6e64f"], "commitDateTime": "2018-11-14 12:19:52", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "tooManyFiles", "authoredDateTime": "2018-11-14 12:19:52"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "release/4.8.1", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "bkctl is broken with default build options", "numCommits": 0, "body": "When building without the -Dstream profile enabled, the bkctl command is broken.\r\n\r\n```\r\n2018-11-09 16:18:43,271 - ERROR - [main:DockerUtils@188] - DOCKER.exec(bookkeeper1_6e7e4ddf-717d-42bb-8701-4717d5027c92:/opt/bookkeeper/4.8.1/bin/bkctl ledger simpletest --ensemble-size 3 --write-quorum-size 3 --ack-quorum-size 2 --num-entries 100): failed with 1 : Exception in thread \"main\" java.util.ServiceConfigurationError: org.apache.bookkeeper.tools.framework.CommandGroup: Provider org.apache.bookkeeper.stream.cli.ClusterCommandGroup not found\r\n       at java.util.ServiceLoader.fail(ServiceLoader.java:239)\r\n       at java.util.ServiceLoader.access$300(ServiceLoader.java:185)\r\n       at java.util.ServiceLoader$LazyIterator.nextService(ServiceLoader.java:372)\r\n       at java.util.ServiceLoader$LazyIterator.next(ServiceLoader.java:404)\r\n       at java.util.ServiceLoader$1.next(ServiceLoader.java:480)\r\n       at org.apache.bookkeeper.tools.cli.BKCtl.main(BKCtl.java:52)\r\n```\r\n\r\nWe shouldn't expect users to know they need to add special flags to maven to get a working build.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"faeb9bb89c40045bd63681ecab662b838cdeec32": {"commitUser": "eolivelli", "commitGHEventType": "closed"}, "fbfcdbae1c7484f2a783be98b5fdb7db2d7498fd": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}}, "closed": "2018-11-12 12:43:07", "url": "https://github.com/apache/bookkeeper/issues/1799", "user": "ivankelly", "ttf": 2.000277777777778}, {"created": "2018-10-29 20:56:32", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "40b0bd101dccd3cd9aefc8c3e915b34071ae1229 tags/release-4.9.0~100", "commitHash": "40b0bd101dccd3cd9aefc8c3e915b34071ae1229", "commitMessage": "ISSUE #1767: security vulnerabilities in 3rd party dependencies\n\nDescriptions of the changes in this PR:\r\n\r\nUpgraded jline and jackson to remove security vulnerabilities mentioned in #1767 \r\n\r\n### Motivation\r\n\r\nRemove security vulnerabilities mentioned in #1767 \r\n\r\n### Changes\r\n\r\nUpgraded jline and jackson 3rd party dependencies\r\n\r\nMaster Issue: #1767 \r\n\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #1777 from mptap/fix-1767-remove-vulnerabilities, closes #1767", "commitGitStats": [{"lines": 12, "deletions": 6, "insertions": 6, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-server.bin.txt"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-dist/src/assemble/bin-server.xml"}, {"lines": 4, "deletions": 1, "insertions": 3, "filePath": "bookkeeper-dist/src/main/resources/deps/{jline-0.9.94 => jline-2.11}/LICENSE"}, {"lines": 24, "deletions": 12, "insertions": 12, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-all.bin.txt"}, {"lines": 18, "deletions": 1, "insertions": 17, "filePath": "pom.xml"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-dist/src/assemble/bin-all.xml"}], "commitParents": ["911a08f7a3bcb82688f9d1a5b6ef7b86a615a2f9"], "commitDateTime": "2018-11-03 10:41:19", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-11-03 10:41:19"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "area/security", "release/4.9.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "security vulnerabilities in 3rd party dependencies", "numCommits": 0, "body": "Similar as apache/pulsar#2882, bookkeeper has 3rd party dependencies that are exposed to security vulnerabilities\r\n\r\n```\r\nmvn com.redhat.victims.maven:security-versions:check\r\n```\r\n\r\nResults:\r\n\r\n```\r\n[ERROR] jline:jline is vulnerable to CVE-2013-2035\r\n[ERROR] com.fasterxml.jackson.core:jackson-databind is vulnerable to CVE-2017-17485\r\n[ERROR] com.fasterxml.jackson.core:jackson-databind is vulnerable to CVE-2017-7525\r\n[ERROR] com.fasterxml.jackson.core:jackson-databind is vulnerable to CVE-2018-5968\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"40b0bd101dccd3cd9aefc8c3e915b34071ae1229": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-11-03 17:41:25", "url": "https://github.com/apache/bookkeeper/issues/1767", "user": "sijie", "ttf": 4.000277777777778}, {"created": "2018-10-24 18:37:52", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerCacheTest.java", "spoonMethods": [{"INS": 13, "DEL": 3, "TOT": 23, "MOV": 5, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace()"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace().4.run()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace().3"}, {"INS": 0, "DEL": 0, "TOT": 23, "MOV": 13, "UPD": 10, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace().3.run()"}, {"INS": 4, "DEL": 1, "TOT": 7, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace().2.run()"}]}, {"spoonFilePath": "IndexPersistenceMgr.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 4, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexPersistenceMgr.writeBuffers(java.lang.Long,java.util.List,org.apache.bookkeeper.bookie.FileInfo,int,int)"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexPersistenceMgr.moveLedgerIndexFile(java.lang.Long,org.apache.bookkeeper.bookie.FileInfo)"}]}, {"spoonFilePath": "FileInfo.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo.FileInfoDeletedException"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo.delete()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo.checkOpen(boolean,boolean)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo.isDeleted()"}]}, {"spoonFilePath": "IndexInMemPageMgr.java", "spoonMethods": [{"INS": 2, "DEL": 2, "TOT": 8, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexInMemPageMgr.flushOneOrMoreLedgers(boolean)"}, {"INS": 0, "DEL": 2, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexInMemPageMgr"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexInMemPageMgr.removePagesForLedger(long)"}]}, {"spoonFilePath": "LedgerEntryPage.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerEntryPage.getPageToWrite()"}]}, {"spoonFilePath": "FileInfoBackingCache.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 4, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfoBackingCache.tryRetainFileInfo(org.apache.bookkeeper.bookie.FileInfoBackingCache$CachedFileInfo)"}]}], "nameRev": "41e4bccb9694e1f373e919f6891b8e88b2232c5e tags/release-4.9.0~107", "commitHash": "41e4bccb9694e1f373e919f6891b8e88b2232c5e", "commitMessage": "ISSUE #1757: prevent race between flush and delete from recreating index\n\nIndexPersistencManager.flushLedgerHandle can race with delete by\r\nobtaining a FileInfo just prior to delete and then proceeding to rewrite\r\nthe file info resurrecting it.  FileInfo provides a convenient point of\r\nsynchronization for avoinding this race.  FileInfo.moveLedgerIndexFile,\r\nFileInfo.flushHeader, and FileInfo.delete() are synchronized already, so\r\nthis patch simply adds a deleted flag to the FileInfo object to indicate\r\nthat the FileInfo has become invalid.  checkOpen is called in every\r\nmethod and will now throw FileInfoDeleted if delete has been called.\r\nIndexPersistenceManager can catch it and deal with it appropriately in\r\nflush (which generally means moving onto the next ledger).\r\n\r\nThis patch also eliminates ledgersToFlush and ledgersFlushing.  Their\r\npurpose appears to be to allow delete to avoid flushing a ledger which\r\nhas been selected for flushing but not flushed yet avoiding the above\r\nrace.  It's not sufficient, however, because IndexInMemPageMgr calls\r\nIndexPersistenceManager.flushLedgerHeader, which can obtain a FileInfo\r\nfor the ledger prior to the deletion and then call\r\nrelocateIndexFileAndFlushHeader afterwards.\r\n\r\nAlso, if the purpose was to avoid concurrent calls into\r\nflushSpecificLedger on the same ledger, it's wrong because of the\r\nfollowing sequence:\r\n\r\nt0: thread 0 calls flushOneOrMoreLedgers\r\nt1: thread 0 place ledger 10 into ledgersFlushing and completes\r\nflushSpecificLedger\r\nt2: thread 2 performs a write to ledger 10\r\nt3: thread 1 calls flushOneOrMoreLedgers skipping ledger 10\r\nt4: thread 0 releases ledger 10 from ledgersFlushing\r\nt5: thread 1 completes flushOneOrMoreLedgers\r\n\r\nAlthough thread 1 begins to flush after the write to ledger 10, it won't\r\ncapture the write rendering the flush incorrect.  I don't think it's\r\nactually worth avoiding overlapping flushes here because both FileInfo\r\nand LedgerEntryPage track dirty state.  As such, it seems simpler to\r\njust get rid of them.\r\n\r\nThis patch also adds a more agressive version of testFlushDeleteRace to\r\ntest the new behavior.  Testing with multiple flushers turned up a bug\r\nwith LedgerEntryPage.getPageToWrite where didn't return a buffer with\r\nindependent read pointers, so this patch addresses that as well.\r\n\r\n(bug W-5549455)\r\n(rev cguttapalem)\r\nSigned-off-by: Samuel Just <sjustsalesforce.com>\r\n(cherry picked from commit 7b5ac3d5e76ac4df618764cafe80aef2994703ec)\r\n\n\nAuthor: \n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1769 from athanatos/forupstream/wip-1757, closes #1757", "commitGitStats": [{"lines": 22, "deletions": 18, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/IndexInMemPageMgr.java"}, {"lines": 2, "deletions": 0, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/FileInfoBackingCache.java"}, {"lines": 16, "deletions": 3, "insertions": 13, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/IndexPersistenceMgr.java"}, {"lines": 17, "deletions": 0, "insertions": 17, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/FileInfo.java"}, {"lines": 3, "deletions": 1, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerEntryPage.java"}, {"lines": 83, "deletions": 26, "insertions": 57, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/LedgerCacheTest.java"}], "commitParents": ["6c2d58ef059ad64d36c71b205061c2d6aefaab35"], "commitDateTime": "2018-10-30 11:26:50", "commitUser": "athanatos", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-10-30 11:26:50"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerCacheTest.java", "spoonMethods": [{"INS": 13, "DEL": 3, "TOT": 23, "MOV": 5, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace()"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace().4.run()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace().3"}, {"INS": 0, "DEL": 0, "TOT": 23, "MOV": 13, "UPD": 10, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace().3.run()"}, {"INS": 4, "DEL": 1, "TOT": 7, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace().2.run()"}]}, {"spoonFilePath": "IndexPersistenceMgr.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 4, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexPersistenceMgr.writeBuffers(java.lang.Long,java.util.List,org.apache.bookkeeper.bookie.FileInfo,int,int)"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexPersistenceMgr.moveLedgerIndexFile(java.lang.Long,org.apache.bookkeeper.bookie.FileInfo)"}]}, {"spoonFilePath": "FileInfo.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo.FileInfoDeletedException"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo.delete()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo.checkOpen(boolean,boolean)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo.isDeleted()"}]}, {"spoonFilePath": "IndexInMemPageMgr.java", "spoonMethods": [{"INS": 2, "DEL": 2, "TOT": 8, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexInMemPageMgr.flushOneOrMoreLedgers(boolean)"}, {"INS": 0, "DEL": 2, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexInMemPageMgr"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexInMemPageMgr.removePagesForLedger(long)"}]}, {"spoonFilePath": "LedgerEntryPage.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerEntryPage.getPageToWrite()"}]}, {"spoonFilePath": "FileInfoBackingCache.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 4, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfoBackingCache.tryRetainFileInfo(org.apache.bookkeeper.bookie.FileInfoBackingCache$CachedFileInfo)"}]}], "nameRev": "1c42ef9c481ee93fc4ebf81fbdfbfcb392a84891 tags/release-4.8.1~14", "commitHash": "1c42ef9c481ee93fc4ebf81fbdfbfcb392a84891", "commitMessage": "ISSUE #1757: prevent race between flush and delete from recreating index\n\nIndexPersistencManager.flushLedgerHandle can race with delete by\r\nobtaining a FileInfo just prior to delete and then proceeding to rewrite\r\nthe file info resurrecting it.  FileInfo provides a convenient point of\r\nsynchronization for avoinding this race.  FileInfo.moveLedgerIndexFile,\r\nFileInfo.flushHeader, and FileInfo.delete() are synchronized already, so\r\nthis patch simply adds a deleted flag to the FileInfo object to indicate\r\nthat the FileInfo has become invalid.  checkOpen is called in every\r\nmethod and will now throw FileInfoDeleted if delete has been called.\r\nIndexPersistenceManager can catch it and deal with it appropriately in\r\nflush (which generally means moving onto the next ledger).\r\n\r\nThis patch also eliminates ledgersToFlush and ledgersFlushing.  Their\r\npurpose appears to be to allow delete to avoid flushing a ledger which\r\nhas been selected for flushing but not flushed yet avoiding the above\r\nrace.  It's not sufficient, however, because IndexInMemPageMgr calls\r\nIndexPersistenceManager.flushLedgerHeader, which can obtain a FileInfo\r\nfor the ledger prior to the deletion and then call\r\nrelocateIndexFileAndFlushHeader afterwards.\r\n\r\nAlso, if the purpose was to avoid concurrent calls into\r\nflushSpecificLedger on the same ledger, it's wrong because of the\r\nfollowing sequence:\r\n\r\nt0: thread 0 calls flushOneOrMoreLedgers\r\nt1: thread 0 place ledger 10 into ledgersFlushing and completes\r\nflushSpecificLedger\r\nt2: thread 2 performs a write to ledger 10\r\nt3: thread 1 calls flushOneOrMoreLedgers skipping ledger 10\r\nt4: thread 0 releases ledger 10 from ledgersFlushing\r\nt5: thread 1 completes flushOneOrMoreLedgers\r\n\r\nAlthough thread 1 begins to flush after the write to ledger 10, it won't\r\ncapture the write rendering the flush incorrect.  I don't think it's\r\nactually worth avoiding overlapping flushes here because both FileInfo\r\nand LedgerEntryPage track dirty state.  As such, it seems simpler to\r\njust get rid of them.\r\n\r\nThis patch also adds a more agressive version of testFlushDeleteRace to\r\ntest the new behavior.  Testing with multiple flushers turned up a bug\r\nwith LedgerEntryPage.getPageToWrite where didn't return a buffer with\r\nindependent read pointers, so this patch addresses that as well.\r\n\r\n(bug W-5549455)\r\n(rev cguttapalem)\r\nSigned-off-by: Samuel Just <sjustsalesforce.com>\r\n(cherry picked from commit 7b5ac3d5e76ac4df618764cafe80aef2994703ec)\r\n\r\n\r\nAuthor: \r\n\r\nReviewers: Enrico Olivelli <eolivelligmail.com>, Sijie Guo <sijieapache.org>\r\n\r\nThis closes #1769 from athanatos/forupstream/wip-1757, closes #1757\r\n\r\n(cherry picked from commit 41e4bccb9694e1f373e919f6891b8e88b2232c5e)\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1775 from athanatos/forupstream/wip-1757-4.8, closes #1757", "commitGitStats": [{"lines": 22, "deletions": 18, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/IndexInMemPageMgr.java"}, {"lines": 2, "deletions": 0, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/FileInfoBackingCache.java"}, {"lines": 16, "deletions": 3, "insertions": 13, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/IndexPersistenceMgr.java"}, {"lines": 17, "deletions": 0, "insertions": 17, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/FileInfo.java"}, {"lines": 3, "deletions": 1, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerEntryPage.java"}, {"lines": 83, "deletions": 26, "insertions": 57, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/LedgerCacheTest.java"}], "commitParents": ["dda5f7c4153f71ff7c021a0f53f54e0c59119c44"], "commitDateTime": "2018-10-31 01:21:46", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-10-31 01:21:46"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerCacheTest.java", "spoonMethods": [{"INS": 13, "DEL": 3, "TOT": 23, "MOV": 5, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace()"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace().4.run()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace().3"}, {"INS": 0, "DEL": 0, "TOT": 23, "MOV": 13, "UPD": 10, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace().3.run()"}, {"INS": 4, "DEL": 1, "TOT": 7, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.testFlushDeleteRace().2.run()"}]}, {"spoonFilePath": "IndexPersistenceMgr.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 4, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexPersistenceMgr.writeBuffers(java.lang.Long,java.util.List,org.apache.bookkeeper.bookie.FileInfo,int,int)"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexPersistenceMgr.moveLedgerIndexFile(java.lang.Long,org.apache.bookkeeper.bookie.FileInfo)"}]}, {"spoonFilePath": "FileInfo.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo.FileInfoDeletedException"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo.delete()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo.checkOpen(boolean,boolean)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfo.isDeleted()"}]}, {"spoonFilePath": "IndexInMemPageMgr.java", "spoonMethods": [{"INS": 2, "DEL": 2, "TOT": 8, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexInMemPageMgr.flushOneOrMoreLedgers(boolean)"}, {"INS": 0, "DEL": 2, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexInMemPageMgr"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexInMemPageMgr.removePagesForLedger(long)"}]}, {"spoonFilePath": "LedgerEntryPage.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerEntryPage.getPageToWrite()"}]}, {"spoonFilePath": "FileInfoBackingCache.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 4, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.FileInfoBackingCache.tryRetainFileInfo(org.apache.bookkeeper.bookie.FileInfoBackingCache$CachedFileInfo)"}]}], "nameRev": "1c54206c985a4d361e8bffa4cf9de4265a1bfc45 tags/release-4.7.3~11", "commitHash": "1c54206c985a4d361e8bffa4cf9de4265a1bfc45", "commitMessage": "ISSUE #1757: prevent race between flush and delete from recreating index\n\nIndexPersistencManager.flushLedgerHandle can race with delete by\r\nobtaining a FileInfo just prior to delete and then proceeding to rewrite\r\nthe file info resurrecting it.  FileInfo provides a convenient point of\r\nsynchronization for avoinding this race.  FileInfo.moveLedgerIndexFile,\r\nFileInfo.flushHeader, and FileInfo.delete() are synchronized already, so\r\nthis patch simply adds a deleted flag to the FileInfo object to indicate\r\nthat the FileInfo has become invalid.  checkOpen is called in every\r\nmethod and will now throw FileInfoDeleted if delete has been called.\r\nIndexPersistenceManager can catch it and deal with it appropriately in\r\nflush (which generally means moving onto the next ledger).\r\n\r\nThis patch also eliminates ledgersToFlush and ledgersFlushing.  Their\r\npurpose appears to be to allow delete to avoid flushing a ledger which\r\nhas been selected for flushing but not flushed yet avoiding the above\r\nrace.  It's not sufficient, however, because IndexInMemPageMgr calls\r\nIndexPersistenceManager.flushLedgerHeader, which can obtain a FileInfo\r\nfor the ledger prior to the deletion and then call\r\nrelocateIndexFileAndFlushHeader afterwards.\r\n\r\nAlso, if the purpose was to avoid concurrent calls into\r\nflushSpecificLedger on the same ledger, it's wrong because of the\r\nfollowing sequence:\r\n\r\nt0: thread 0 calls flushOneOrMoreLedgers\r\nt1: thread 0 place ledger 10 into ledgersFlushing and completes\r\nflushSpecificLedger\r\nt2: thread 2 performs a write to ledger 10\r\nt3: thread 1 calls flushOneOrMoreLedgers skipping ledger 10\r\nt4: thread 0 releases ledger 10 from ledgersFlushing\r\nt5: thread 1 completes flushOneOrMoreLedgers\r\n\r\nAlthough thread 1 begins to flush after the write to ledger 10, it won't\r\ncapture the write rendering the flush incorrect.  I don't think it's\r\nactually worth avoiding overlapping flushes here because both FileInfo\r\nand LedgerEntryPage track dirty state.  As such, it seems simpler to\r\njust get rid of them.\r\n\r\nThis patch also adds a more agressive version of testFlushDeleteRace to\r\ntest the new behavior.  Testing with multiple flushers turned up a bug\r\nwith LedgerEntryPage.getPageToWrite where didn't return a buffer with\r\nindependent read pointers, so this patch addresses that as well.\r\n\r\n(bug W-5549455)\r\n(rev cguttapalem)\r\nSigned-off-by: Samuel Just <sjustsalesforce.com>\r\n(cherry picked from commit 7b5ac3d5e76ac4df618764cafe80aef2994703ec)\r\n\r\nAuthor:\r\n\r\nReviewers: Enrico Olivelli <eolivelligmail.com>, Sijie Guo <sijieapache.org>\r\n\r\nThis closes #1769 from athanatos/forupstream/wip-1757, closes #1757\r\n\r\n(cherry picked from commit 41e4bccb9694e1f373e919f6891b8e88b2232c5e)\r\n\r\nConflicts:\r\n    bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/FileInfo.java\r\n\r\nMinor conflict over fileInfoVersionToWrite from the explicit lac patch.\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #1774 from athanatos/forupstream/wip-1757-4.7, closes #1757", "commitGitStats": [{"lines": 22, "deletions": 18, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/IndexInMemPageMgr.java"}, {"lines": 2, "deletions": 0, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/FileInfoBackingCache.java"}, {"lines": 16, "deletions": 3, "insertions": 13, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/IndexPersistenceMgr.java"}, {"lines": 17, "deletions": 0, "insertions": 17, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/FileInfo.java"}, {"lines": 3, "deletions": 1, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerEntryPage.java"}, {"lines": 83, "deletions": 26, "insertions": 57, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/LedgerCacheTest.java"}], "commitParents": ["e765c426dbced50a479e7fb1d409fe20ddfe09b5"], "commitDateTime": "2018-10-31 01:20:30", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-10-31 01:20:30"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "release/4.7.3", "release/4.8.1", "release/4.9.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Ledger deletion racing with flush can cause a ledger index to be resurrected.", "numCommits": 0, "body": "The fix to https://issues.apache.org/jira/browse/BOOKKEEPER-604 was fundamentally incomplete.  I think the most viable fix would be for the FileInfo object (the only viable point of synchronization between flush and delete) to remember that it's been deleted and ignore flushHeader() and moveToNewLocation().", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 2, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"41e4bccb9694e1f373e919f6891b8e88b2232c5e": {"commitUser": "athanatos", "commitGHEventType": "closed"}, "1c42ef9c481ee93fc4ebf81fbdfbfcb392a84891": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "1c54206c985a4d361e8bffa4cf9de4265a1bfc45": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-10-30 18:26:57", "url": "https://github.com/apache/bookkeeper/issues/1757", "user": "athanatos", "ttf": 5.000277777777778}, {"created": "2018-10-18 15:56:54", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "6c2d58ef059ad64d36c71b205061c2d6aefaab35 tags/release-4.9.0~108", "commitHash": "6c2d58ef059ad64d36c71b205061c2d6aefaab35", "commitMessage": "Issue #1752: Etcd docker based tests are running on wrong jobs on CI\n\n\r\n\r\nDescriptions of the changes in this PR:\r\n\r\n*Motivation*\r\n\r\nFixes #1752 \r\n\r\nEtcd metadata driver is using testcontainer to run Etcd in containers for integration tests.\r\nHowever this job is running as part normal build, which can cause container image being deleted\r\ndue to concurrent builds.\r\n\r\n*Changes*\r\n\r\nMove etcd metadata driver tests to be as part of `integrationTests`\r\n\r\nMaster Issue: #1752 \r\n\r\n\r\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1766 from codingwangqi/move_etcd_to_integration_tests, closes #1752", "commitGitStats": [{"lines": 121, "deletions": 50, "insertions": 71, "filePath": "metadata-drivers/etcd/pom.xml"}, {"lines": 1, "deletions": 0, "insertions": 1, "filePath": ".test-infra/scripts/pre-docker-tests.sh"}, {"lines": 9, "deletions": 0, "insertions": 9, "filePath": ".test-infra/jenkins/job_bookkeeper_precommit_integrationtests.groovy"}], "commitParents": ["d9444ba143c9cdba4af427afdd9f0b696c1d7683"], "commitDateTime": "2018-10-29 18:53:19", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-10-30 09:53:19"}, {"commitSpoonAstDiffStats": [], "nameRev": "49924130d083015b788c43f057d66c993d343c82 tags/release-4.9.0~103", "commitHash": "49924130d083015b788c43f057d66c993d343c82", "commitMessage": "[TESTS] Issue #1752: disable etcd tests in normal builds\n\n\r\n\r\nDescriptions of the changes in this PR:\r\n\r\n*Motivation*\r\n\r\napache/bookkeeper#1766 attempts to disable etcd tests in normal builds.\r\nhowever it only added the `integrationTests` profile but didn't disable tests\r\nin normal builds.\r\n\r\n*Changes*\r\n\r\nDisable etcd tests in normal builds\r\n\r\nMaster Issue: #1752 \r\n\r\n\r\n\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #1779 from sijie/run_etcd_tests_on_integrationtests, closes #1752", "commitGitStats": [{"lines": 18, "deletions": 0, "insertions": 18, "filePath": "metadata-drivers/etcd/pom.xml"}], "commitParents": ["b17b1657e938aa41d747fd49537559c4f29860de"], "commitDateTime": "2018-11-02 09:59:38", "commitUser": "merlimat", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-11-02 09:59:38"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Etcd docker based tests are running on wrong jobs on CI", "numCommits": 0, "body": "For instance we have this error in Java 8 job:\r\n\r\n```\r\n2018-10-17T22:40:33.646 [INFO] Results:\r\n2018-10-17T22:40:33.646 [INFO]\r\n2018-10-17T22:40:33.646 [ERROR] Errors:\r\n2018-10-17T22:40:33.646 [ERROR]   Etcd64bitIdGeneratorTest.org.apache.bookkeeper.metadata.etcd.Etcd64bitIdGeneratorTest \u00bb NotFound\r\n2018-10-17T22:40:33.646 [ERROR]   EtcdClusterTest.org.apache.bookkeeper.metadata.etcd.EtcdClusterTest \u00bb NotFound\r\n2018-10-17T22:40:33.646 [ERROR]   EtcdCookieTest.org.apache.bookkeeper.metadata.etcd.EtcdCookieTest \u00bb NotFound {...\r\n2018-10-17T22:40:33.646 [ERROR]   EtcdLayoutManagerTest.org.apache.bookkeeper.metadata.etcd.EtcdLayoutManagerTest \u00bb NotFound\r\n2018-10-17T22:40:33.646 [ERROR]   EtcdLedgerManagerTest.org.apache.bookkeeper.metadata.etcd.EtcdLedgerManagerTest \u00bb NotFound\r\n2018-10-17T22:40:33.646 [ERROR]   EtcdRegistrationTest.org.apache.bookkeeper.metadata.etcd.EtcdRegistrationTest \u00bb NotFound\r\n2018-10-17T22:40:33.646 [ERROR]   HelpersTest.org.apache.bookkeeper.metadata.etcd.helpers.HelpersTest \u00bb NotFound\r\n2018-10-17T22:40:33.646 [ERROR]   KeySetReaderTest.org.apache.bookkeeper.metadata.etcd.helpers.KeySetReaderTest \u00bb NotFound\r\n2018-10-17T22:40:33.646 [ERROR]   SmokeTest.org.apache.bookkeeper.metadata.etcd.integration.SmokeTest \u00bb NotFound\r\n2018-10-17T22:40:33.646 [INFO]\r\n2018-10-17T22:40:33.646 [ERROR] Tests run: 9, Failures: 0, Errors: 9, Skipped: 0\r\n2018-10-17T22:40:33.646 [INFO]\r\n2018-10-17T22:40:33.650 [ERROR] There are test failures.\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 2, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"6c2d58ef059ad64d36c71b205061c2d6aefaab35": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "49924130d083015b788c43f057d66c993d343c82": {"commitUser": "merlimat", "commitGHEventType": "referenced"}}, "closed": "2018-10-30 01:53:20", "url": "https://github.com/apache/bookkeeper/issues/1752", "user": "eolivelli", "ttf": 11.000277777777777}, {"created": "2018-09-27 10:21:32", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerClose2Test.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerClose2Test.testDoubleCloseOnHandle()"}]}, {"spoonFilePath": "LedgerHandle.java", "spoonMethods": [{"INS": 2, "DEL": 2, "TOT": 12, "MOV": 6, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.doAsyncCloseInternal(org.apache.bookkeeper.client.AsyncCallback.CloseCallback,java.lang.Object,int).5.safeRun()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle"}]}], "nameRev": "52d195700381bb3782a86e983f1a8c62d12bad2a tags/release-4.9.0~20", "commitHash": "52d195700381bb3782a86e983f1a8c62d12bad2a", "commitMessage": "Multiple calls to LedgerHandle#close should wait on actual close\n\nThe previous behaviour was to complete successfully immediately if\r\nclose had already been called on the handle. This allowed for\r\npotential consistency violations, as the caller could believe that the\r\nledger was closed, when in fact the close operation was still in\r\nprogress and could still potentially fail.\r\n\r\nIssue: #1712\r\n\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #1889 from ivankelly/double-close-anomoly", "commitGitStats": [{"lines": 36, "deletions": 0, "insertions": 36, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/LedgerClose2Test.java"}, {"lines": 22, "deletions": 8, "insertions": 14, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java"}], "commitParents": ["21d71fb9e576d95e2ff2adf7a961a2847b96a9f9"], "commitDateTime": "2018-12-22 07:41:22", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-12-22 00:41:22"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Potential for TOAB violation with multiple calls to close", "numCommits": 0, "body": "I came across this when doing the immutable work. It exists in both pre and post immutable implementations.\r\n\r\nThe problem occurs if a client calls close twice concurrently with some writes outstanding. Take the local LAC in the writer to be 10, and 11-20 are outstanding writes. In this case, in the pre-immutable world, the first close will do the actual work, update the state in the metadata to closed and try to do the write to metadata with lastEntry as 10. The second local call to close sees that state is closed, so returns immediately, so the caller thinks that the ledger has been successfully closed with 10 as the last entry. However, if another client recovers the ledger, and sets the lastEntry to 20, then we have a potential for a TOAB violation.\r\n\r\nThe solution would be to have 3 handle states, OPEN, CLOSING, and CLOSED, and when the state is CLOSING, only wait for the outstanding close operation to complete before returning to the client. It's out of scope for this change though.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"52d195700381bb3782a86e983f1a8c62d12bad2a": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2019-02-21 09:43:13", "url": "https://github.com/apache/bookkeeper/issues/1712", "user": "ivankelly", "ttf": 146.00027777777777}, {"created": "2018-09-25 18:17:50", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BufferedChannel.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BufferedChannel"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BufferedChannel.close()"}]}], "nameRev": "ba6d3ee3d0005c809d926f952b1c1b4d33215dd5 tags/release-4.9.0~124", "commitHash": "ba6d3ee3d0005c809d926f952b1c1b4d33215dd5", "commitMessage": "ISSUE #1703: IllegalReferenceCountException at closing EntryLogManagerForSingleEntryLog\n\nDescriptions of the changes in this PR:\r\n\r\n*Motivation*\r\n\r\nFixes #1703.\r\n\r\nThe active entry log channel in EntryLogManagerForSingleEntryLog is closed twice during shutdown.\r\nOne is by EntryLogManagerForSingleEntryLog#close and the other one is EntryLogManagerForSingleEntryLog#forceClose().\r\n\r\n*Changes*\r\n\r\nThis change is adding logic in BufferedChannel to make sure BufferedChannel can be closed multiple times.\r\n\r\n\r\n\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Charan Reddy Guttapalem <reddycharan18@gmail.com>, Enrico Olivelli <eolivelli@gmail.com>, Andrey Yegorov <None>\n\nThis closes #1735 from sijie/issue_1703, closes #1703", "commitGitStats": [{"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BufferedChannel.java"}], "commitParents": ["125fdb9761ffaaf5551d5e192d82b23fe555165f"], "commitDateTime": "2018-10-05 15:36:00", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-10-05 15:36:00"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "BufferedChannel.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BufferedChannel"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BufferedChannel.close()"}]}], "nameRev": "b4064648b5e9814773920a84a51e6664af46143d tags/release-4.8.1~19", "commitHash": "b4064648b5e9814773920a84a51e6664af46143d", "commitMessage": "ISSUE #1703: IllegalReferenceCountException at closing EntryLogManagerForSingleEntryLog\n\nDescriptions of the changes in this PR:\n\n*Motivation*\n\nFixes #1703.\n\nThe active entry log channel in EntryLogManagerForSingleEntryLog is closed twice during shutdown.\nOne is by EntryLogManagerForSingleEntryLog#close and the other one is EntryLogManagerForSingleEntryLog#forceClose().\n\n*Changes*\n\nThis change is adding logic in BufferedChannel to make sure BufferedChannel can be closed multiple times.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Charan Reddy Guttapalem <reddycharan18@gmail.com>, Enrico Olivelli <eolivelli@gmail.com>, Andrey Yegorov <None>\n\nThis closes #1735 from sijie/issue_1703, closes #1703\n\n(cherry picked from commit ba6d3ee3d0005c809d926f952b1c1b4d33215dd5)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BufferedChannel.java"}], "commitParents": ["08da23c32b4a2891b431cff203db62c7368d5fba"], "commitDateTime": "2018-10-05 15:36:13", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-10-05 15:36:00"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "release/4.7.3", "release/4.8.1", "release/4.9.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "IllegalReferenceCountException at closing EntryLogManagerForSingleEntryLog", "numCommits": 0, "body": "\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nrun bookkeeper standalone\r\n\r\n- What did you expect to see?\r\n\r\nbookkeeper runs well and no surprise in the log\r\n\r\n- What did you see instead?\r\n\r\n```\r\n2018-09-24 19:03:58,116 - WARN  [component-shutdown-thread:Slf4JLogger@146] - Failed to release a message: PooledUnsafeDirectByteBuf(freed)\r\nio.netty.util.IllegalReferenceCountException: refCnt: 0, increment: 1\r\n        at io.netty.buffer.AbstractReferenceCountedByteBuf.release0(AbstractReferenceCountedByteBuf.java:100)\r\n        at io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:84)\r\n        at io.netty.util.ReferenceCountUtil.release(ReferenceCountUtil.java:88)\r\n        at io.netty.util.ReferenceCountUtil.safeRelease(ReferenceCountUtil.java:113)\r\n        at org.apache.bookkeeper.bookie.BufferedChannel.close(BufferedChannel.java:91)\r\n        at org.apache.bookkeeper.util.IOUtils.close(IOUtils.java:48)\r\n        at org.apache.bookkeeper.bookie.EntryLogManagerForSingleEntryLog.forceClose(EntryLogManagerForSingleEntryLog.java:221)\r\n        at org.apache.bookkeeper.bookie.EntryLogger.shutdown(EntryLogger.java:1087)\r\n        at org.apache.bookkeeper.bookie.InterleavedLedgerStorage.shutdown(InterleavedLedgerStorage.java:186)\r\n        at org.apache.bookkeeper.bookie.SortedLedgerStorage.shutdown(SortedLedgerStorage.java:124)\r\n        at org.apache.bookkeeper.bookie.Bookie.shutdown(Bookie.java:1099)\r\n        at org.apache.bookkeeper.bookie.Bookie.shutdown(Bookie.java:1068)\r\n        at org.apache.bookkeeper.proto.BookieServer.shutdown(BookieServer.java:201)\r\n        at org.apache.bookkeeper.server.service.BookieService.doClose(BookieService.java:71)\r\n        at org.apache.bookkeeper.common.component.AbstractLifecycleComponent.close(AbstractLifecycleComponent.java:109)\r\n        at org.apache.bookkeeper.common.component.LifecycleComponentStack.lambda$close$4(LifecycleComponentStack.java:123)\r\n        at com.google.common.collect.ImmutableList.forEach(ImmutableList.java:408)\r\n        at org.apache.bookkeeper.common.component.LifecycleComponentStack.close(LifecycleComponentStack.java:123)\r\n        at org.apache.bookkeeper.common.component.ComponentStarter$ComponentShutdownHook.run(ComponentStarter.java:46)\r\n        at java.lang.Thread.run(Thread.java:748)\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"b4064648b5e9814773920a84a51e6664af46143d": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "ba6d3ee3d0005c809d926f952b1c1b4d33215dd5": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-10-05 22:36:01", "url": "https://github.com/apache/bookkeeper/issues/1703", "user": "sijie", "ttf": 10.000277777777777}, {"created": "2018-09-19 11:53:29", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "0284c147d5a81578b7005af6f8ee5bd28c6cae15 tags/release-4.9.0~168", "commitHash": "0284c147d5a81578b7005af6f8ee5bd28c6cae15", "commitMessage": "ISSUE #1687: Using eval instead of exec to handle quotes in healtcheck.sh\n\nDescriptions of the changes in this PR:\r\n\r\nFixes https://github.com/apache/bookkeeper/issues/1687\r\n\r\n\r\n### Motivation\r\n\r\nhttps://github.com/apache/bookkeeper/issues/1687\r\n\r\n### Changes\r\nUsing eval instead of exec to run the health check script.\r\n\r\nMaster Issue: #1687 \r\n\r\n\r\n\n\nAuthor: matevarga <mate@monadic.hu>\n\nReviewers: Sijie Guo <sijie@apache.org>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #1688 from matevarga/master, closes #1687", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "docker/scripts/healthcheck.sh"}], "commitParents": ["a9665f8494ae7e6fb6066ebfb652e72228fb677b"], "commitDateTime": "2018-09-20 01:08:33", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-09-20 10:08:33"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/docker", "release/4.9.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "healthcheck.sh script is incorrect ", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\nStarting a BookKeeper cluster in Docker Swarm using the official, latest Docker images.\r\n\r\n- What did you expect to see?\r\nBookkeeper starts up.\r\n\r\n- What did you see instead?\r\nDocker Swarm kills the containers because health checks fail.\r\n\r\nUnderlying issue: there's a health check script in the image at `/opt/bookkeeper/scripts/healthcheck.sh`. This has a bug:\r\n`./healthcheck.sh: line 34: /opt/bookkeeper/bin/bookkeeper shell bookiesanity: No such file or directory`\r\n\r\nProblematic code:\r\n```\r\nHEALTH_CHECK_CMD=${HEALTH_CHECK_CMD:-\"${DEFAULT_HEALTH_CHECK_CMD}\"}\r\nexec \"${HEALTH_CHECK_CMD}\"\r\n```\r\n\r\nThis should be \r\n```\r\nHEALTH_CHECK_CMD=${HEALTH_CHECK_CMD:-\"${DEFAULT_HEALTH_CHECK_CMD}\"}\r\neval \"${HEALTH_CHECK_CMD}\"\r\n```\r\n.. so `eval` instead of `exec`. \r\n\r\n**BP**\r\n\r\nThis is the master ticket for tracking BP-&lt;bp-number&gt; :\r\n\r\n[a short description for this BP]\r\n\r\nProposal PR - #&lt;pr-number&gt;\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"0284c147d5a81578b7005af6f8ee5bd28c6cae15": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-09-20 08:08:33", "url": "https://github.com/apache/bookkeeper/issues/1687", "user": "matevarga", "ttf": 0.0002777777777777778}, {"created": "2018-09-06 18:20:45", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "AbstractConfiguration.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 9, "MOV": 6, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.conf.AbstractConfiguration.getMetadataServiceUri()"}]}, {"spoonFilePath": "AbstractConfigurationTest.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.conf.AbstractConfigurationTest.testUnsupportedLedgerManagerFactory()"}]}, {"spoonFilePath": "LocalBookKeeper.java", "spoonMethods": [{"INS": 4, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.newMetadataServiceUri(java.lang.String,int,java.lang.String,java.lang.String)"}, {"INS": 0, "DEL": 1, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.newMetadataServiceUri(java.lang.String,int)"}, {"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper"}, {"INS": 8, "DEL": 0, "TOT": 8, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.runBookies(java.util.List,java.lang.String)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.initializeZookeeper(java.lang.String,int)"}, {"INS": 0, "DEL": 7, "TOT": 10, "MOV": 1, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.runBookies(org.apache.bookkeeper.conf.ServerConfiguration,java.util.List,java.lang.String)"}, {"INS": 1, "DEL": 3, "TOT": 5, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.startLocalBookiesInternal(org.apache.bookkeeper.conf.ServerConfiguration,java.lang.String,int,int,boolean,int,boolean,java.lang.String,java.lang.String,java.lang.String)"}, {"INS": 0, "DEL": 2, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.initializeZookeeper(org.apache.bookkeeper.conf.AbstractConfiguration,java.lang.String,int)"}, {"INS": 0, "DEL": 2, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.runBookies(org.apache.bookkeeper.conf.ServerConfiguration,java.lang.String)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.LocalBookKeeper.runBookies(java.lang.String)"}]}], "nameRev": "74bd92605bc4986705031aea8943905dbc9f9f85 tags/release-4.9.0~180", "commitHash": "74bd92605bc4986705031aea8943905dbc9f9f85", "commitMessage": "ISSUE #1662: LocalBookKeeper use layout manager and ledger path configs\n\nThe URI patch had a side effect of causing LocalBookKeeper to always\r\nuse a URI string of the form zk:// which defaults to HLM.  This\r\npatch updates LocalBookKeeper to generate zk+<layout>:// based on\r\nthe legacy LEDGER_MANAGER_FACTORY_CLASS config when present.  +null\r\nwill be used otherwise and defaults to HLM.  Further, use the\r\n(admittedly deprecated) zkLedgerRootPath config to determine the\r\nledger path (defaults to /ledger, so the behavior will be unchanged\r\nif unspecified).\r\n\r\n(bug W-5415276)\r\n(rev cguttapalem)\r\nSigned-off-by: Samuel Just <sjustsalesforce.com>\n\nAuthor: Samuel Just <sjust@salesforce.com>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #1669 from athanatos/forupstream/wip-1662, closes #1662", "commitGitStats": [{"lines": 58, "deletions": 24, "insertions": 34, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/AbstractConfiguration.java"}, {"lines": 52, "deletions": 21, "insertions": 31, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/LocalBookKeeper.java"}, {"lines": 3, "deletions": 1, "insertions": 2, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/conf/AbstractConfigurationTest.java"}], "commitParents": ["8711c3b911beb79c20ca87e47077a8ab4ccf5025"], "commitDateTime": "2018-09-07 15:08:57", "commitUser": "athanatos", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-09-07 15:08:57"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "release/4.9.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "LocalBookKeeper should respect LEDGER_MANAGER_FACTORY_CLASS when generating the URI", "numCommits": 0, "body": "", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"74bd92605bc4986705031aea8943905dbc9f9f85": {"commitUser": "athanatos", "commitGHEventType": "closed"}}, "closed": "2018-09-07 22:09:01", "url": "https://github.com/apache/bookkeeper/issues/1662", "user": "athanatos", "ttf": 1.0002777777777778}, {"created": "2018-09-06 07:25:48", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "3bfecd4941da57994d1a32e7c4ca997c452b751e tags/release-4.7.3~20", "commitHash": "3bfecd4941da57994d1a32e7c4ca997c452b751e", "commitMessage": "Issue #1660: Bookie can't start using 4.7.2 docker image (for branch-4.7)\n\nDescriptions of the changes in this PR:\n\n*Motivation*\n\nzookeeper cli always returns '0' as return code no matter the command succeeds or not.\n\n*Changes*\n\nSwitch to use a zookeeper python cli.\n\n**NOTE**: this fix attempts to fix from docker scripts without touching any bookkeeper code.\n\nMaster Issue: #1660\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Matteo Merli <mmerli@apache.org>\n\nThis closes #1666 from sijie/fix_docker_image, closes #1660\n", "commitGitStats": [{"lines": 5, "deletions": 0, "insertions": 5, "filePath": "docker/Dockerfile"}, {"lines": 18, "deletions": 9, "insertions": 9, "filePath": "docker/scripts/init_bookie.sh"}], "commitParents": ["d9167a600b7cc8d8cbf8aa6a3dc43d8e51491366"], "commitDateTime": "2018-09-10 13:22:14", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-09-10 13:22:14"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/docker", "release/4.7.2", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Bookie can't start using 4.7.2 docker image", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nupgrade to use bookkeeper 4.7.2 docker image.\r\n\r\n- What did you expect to see?\r\n\r\nbookie can start on a new environment.\r\n\r\n- What did you see instead?\r\n\r\nbookie failed to start.\r\n\r\n```\r\n2018-09-06 06:53:51,124 - ERROR - [main:Main@221] - Failed to build bookie server\r\norg.apache.bookkeeper.bookie.BookieException$MetadataStoreException: Failed to get cluster instance id\r\n\tat org.apache.bookkeeper.discover.ZKRegistrationManager.getClusterInstanceId(ZKRegistrationManager.java:387)\r\n\tat org.apache.bookkeeper.bookie.Bookie.checkEnvironmentWithStorageExpansion(Bookie.java:412)\r\n\tat org.apache.bookkeeper.bookie.Bookie.checkEnvironment(Bookie.java:256)\r\n\tat org.apache.bookkeeper.bookie.Bookie.<init>(Bookie.java:640)\r\n\tat org.apache.bookkeeper.proto.BookieServer.newBookie(BookieServer.java:131)\r\n\tat org.apache.bookkeeper.proto.BookieServer.<init>(BookieServer.java:100)\r\n\tat org.apache.bookkeeper.server.service.BookieService.<init>(BookieService.java:43)\r\n\tat org.apache.bookkeeper.server.Main.buildBookieServer(Main.java:299)\r\n\tat org.apache.bookkeeper.server.Main.doMain(Main.java:219)\r\n\tat org.apache.bookkeeper.server.Main.main(Main.java:201)\r\nCaused by: org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for BookKeeper metadata\r\n\tat org.apache.bookkeeper.discover.ZKRegistrationManager.getClusterInstanceId(ZKRegistrationManager.java:377)\r\n\t... 9 more\r\n```\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"3bfecd4941da57994d1a32e7c4ca997c452b751e": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-10-04 04:17:59", "url": "https://github.com/apache/bookkeeper/issues/1660", "user": "sijie", "ttf": 27.00027777777778}, {"created": "2018-09-06 05:31:45", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "d7c99f86dd60534739c9eec1c826b4736c38c162 tags/release-4.9.0~187", "commitHash": "d7c99f86dd60534739c9eec1c826b4736c38c162", "commitMessage": "ISSUE #1658: License file: typo \"Google Protocal Buffers\" instead of \"Google Protocol Buffers\"\n\nFix a typo in LICENSE files for binary distributions.\n\nMaster issue #1658\n\nAuthor: Enrico Olivelli <eolivelli@apache.org>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #1659 from eolivelli/fix/protocal-typo, closes #1658\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-server.bin.txt"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-all.bin.txt"}], "commitParents": ["a031e0ede1767960d191d70a6cda21990d1f541e"], "commitDateTime": "2018-09-06 10:10:38", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-09-06 10:10:38"}, {"commitSpoonAstDiffStats": [], "nameRev": "b3012023b2c49dca834b82279ea68f9f6c0add02 tags/release-4.8.1~36", "commitHash": "b3012023b2c49dca834b82279ea68f9f6c0add02", "commitMessage": "ISSUE #1658: License file: typo \"Google Protocal Buffers\" instead of \"Google Protocol Buffers\"\n\nFix a typo in LICENSE files for binary distributions.\n\nMaster issue #1658\n\nAuthor: Enrico Olivelli <eolivelli@apache.org>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #1659 from eolivelli/fix/protocal-typo, closes #1658\n\n(cherry picked from commit d7c99f86dd60534739c9eec1c826b4736c38c162)\nSigned-off-by: Enrico Olivelli <eolivelli@apache.org>\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-server.bin.txt"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-dist/src/main/resources/LICENSE-all.bin.txt"}], "commitParents": ["65f02abe97edd478f5fb89a8bc000176d3227ba7"], "commitDateTime": "2018-09-06 10:11:07", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-09-06 10:10:38"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/documentation", "release/4.8.0", "release/4.9.0", "to-cherry-pick/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "License file: typo \"Google Protocal Buffers\" instead of \"Google Protocol Buffers\"", "numCommits": 0, "body": "There is a small typo in the LICENSE file which we are distributing.\r\n\r\nIt is not a blocker issue, but LICENSE file is to be kept as tidy as possible", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"d7c99f86dd60534739c9eec1c826b4736c38c162": {"commitUser": "eolivelli", "commitGHEventType": "closed"}, "b3012023b2c49dca834b82279ea68f9f6c0add02": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}}, "closed": "2018-09-06 08:10:50", "url": "https://github.com/apache/bookkeeper/issues/1658", "user": "eolivelli", "ttf": 0.0002777777777777778}, {"created": "2018-08-28 13:24:53", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "AuditorElector.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.replication.AuditorElector.submitElectionTask()"}, {"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.replication.AuditorElector.start()"}]}, {"spoonFilePath": "TestHttpService.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.server.http.TestHttpService.testWhoIsAuditorService()"}, {"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.server.http.TestHttpService.startAuditorElector()"}]}], "nameRev": "53294f4a13130ce7efded5648bbf413d5f37d6cb tags/release-4.7.3~22", "commitHash": "53294f4a13130ce7efded5648bbf413d5f37d6cb", "commitMessage": "ISSUE #1630: TestHttpService#testWhoIsAuditorService is flaky\n\nDescriptions of the changes in this PR:\n\n ### Motivation\n\nFixes #1630. The problem is auditor elector was started async, the test itself doesn't wait until election completed.\nso the test can be running before auditor runs elector.\n\n ### Changes\n\nThe fix is simple, just wait until auditor completes election.\n\nMaster Issue: #1630\n\nAuthor: Qi Wang <codingwangqi@gmail.com>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1649 from codingwangqi/issue_1630, closes #1630\n\n(cherry picked from commit 18a40787930df990e9e3ac3aad58011dc65b1b9f)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 9, "deletions": 4, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AuditorElector.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/server/http/TestHttpService.java"}], "commitParents": ["3b2c8f749ca7a1f3bf63601b1649ed6a70408563"], "commitDateTime": "2018-09-05 12:08:09", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-09-05 12:07:29"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "AuditorElector.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.replication.AuditorElector.submitElectionTask()"}, {"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.replication.AuditorElector.start()"}]}, {"spoonFilePath": "TestHttpService.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.server.http.TestHttpService.testWhoIsAuditorService()"}, {"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.server.http.TestHttpService.startAuditorElector()"}]}], "nameRev": "18a40787930df990e9e3ac3aad58011dc65b1b9f tags/release-4.9.0~190", "commitHash": "18a40787930df990e9e3ac3aad58011dc65b1b9f", "commitMessage": "ISSUE #1630: TestHttpService#testWhoIsAuditorService is flaky\n\nDescriptions of the changes in this PR:\n\n ### Motivation\n\nFixes #1630. The problem is auditor elector was started async, the test itself doesn't wait until election completed.\nso the test can be running before auditor runs elector.\n\n ### Changes\n\nThe fix is simple, just wait until auditor completes election.\n\nMaster Issue: #1630\n\nAuthor: Qi Wang <codingwangqi@gmail.com>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1649 from codingwangqi/issue_1630, closes #1630\n", "commitGitStats": [{"lines": 9, "deletions": 4, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AuditorElector.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/server/http/TestHttpService.java"}], "commitParents": ["1db41acf1503e38694dba60adb478b2bfb4d41f9"], "commitDateTime": "2018-09-05 12:07:29", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-09-05 12:07:29"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "AuditorElector.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.replication.AuditorElector.submitElectionTask()"}, {"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.replication.AuditorElector.start()"}]}, {"spoonFilePath": "TestHttpService.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.server.http.TestHttpService.testWhoIsAuditorService()"}, {"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.server.http.TestHttpService.startAuditorElector()"}]}], "nameRev": "65f02abe97edd478f5fb89a8bc000176d3227ba7 tags/release-4.8.1~37", "commitHash": "65f02abe97edd478f5fb89a8bc000176d3227ba7", "commitMessage": "ISSUE #1630: TestHttpService#testWhoIsAuditorService is flaky\n\nDescriptions of the changes in this PR:\n\n ### Motivation\n\nFixes #1630. The problem is auditor elector was started async, the test itself doesn't wait until election completed.\nso the test can be running before auditor runs elector.\n\n ### Changes\n\nThe fix is simple, just wait until auditor completes election.\n\nMaster Issue: #1630\n\nAuthor: Qi Wang <codingwangqi@gmail.com>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1649 from codingwangqi/issue_1630, closes #1630\n\n(cherry picked from commit 18a40787930df990e9e3ac3aad58011dc65b1b9f)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 9, "deletions": 4, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AuditorElector.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/server/http/TestHttpService.java"}], "commitParents": ["b5065b9479404948b231ab55d5df561211579cb1"], "commitDateTime": "2018-09-05 12:07:49", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-09-05 12:07:29"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "release/4.7.3", "release/4.8.0", "release/4.9.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "TestHttpService#testWhoIsAuditorService is flaky", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nrun \"mvn clean install\" on the root of 4.7.2 source distribution (it still happens on master)\r\n\r\n- What did you expect to see?\r\n\r\nAll tests passing\r\n\r\n- What did you see instead?\r\n\r\n```\r\n[ERROR] org.apache.bookkeeper.server.http.TestHttpService.testWhoIsAuditorService(org.apache.bookkeeper.server.http.TestHttpService)\r\n[ERROR]   Run 1: TestHttpService.testWhoIsAuditorService:638 expected:<200> but was:<404>\r\n[ERROR]   Run 2: TestHttpService.testWhoIsAuditorService:638 expected:<200> but was:<404>\r\n[ERROR]   Run 3: TestHttpService.testWhoIsAuditorService:638 expected:<200> but was:<404>\r\n\r\n```\r\n\r\n\r\nthe failure happens only if running the whole TestHttpService file, not the single test\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 2, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"53294f4a13130ce7efded5648bbf413d5f37d6cb": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "18a40787930df990e9e3ac3aad58011dc65b1b9f": {"commitUser": "sijie", "commitGHEventType": "closed"}, "65f02abe97edd478f5fb89a8bc000176d3227ba7": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-09-05 19:07:43", "url": "https://github.com/apache/bookkeeper/issues/1630", "user": "eolivelli", "ttf": 8.000277777777777}, {"created": "2018-08-17 18:15:05", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "5358467746d154118f4e318c7546298531d01b67 tags/release-4.8.1~47", "commitHash": "5358467746d154118f4e318c7546298531d01b67", "commitMessage": "Issue #1610: netty leak detector logs 'LEAK: HashedWheelTimer.release() was not called before it's garbage-collected.' in unit tests\n\nDescriptions of the changes in this PR:\n\nEnabled netty's paranoid leak detection for tests.\nFixed most of the 'LEAK: HashedWheelTimer.release() was not called before it's garbage-collected.' issues. Did not fix ones produced by AuditorElector. In long term we should fix these, ByteBuf leaks in BufferedChannel and whatever else we find and make tests fail if netty logs a leak.\n\nI used to have random test timeouts/failures caused by delayed bookie shutdown when I built repo with OpenJDK 8 but ran tests after switching to Oracle JDK 8 (or vice versa). After these changes tests did not fail in these runs.\n\nMade bk/bkadmin/auditor close resources properly in the tests and shutdown calls.\nChanged order of initialization in Bookkeeper so it creates HashedWheelTimer after bookie client, in case bookie client creation fails due to misconfiguration.\n\nMaster Issue: #1610\n\nAuthor: Andrey Yegorov <ayegorov@salesforce.com>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1613 from dlg99/fix/issue_1610_hashedwheeltimer, closes #1610\n\n(cherry picked from commit 5f2d45c8fa0619d50423f1672303fea2d1a59238)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 1, "deletions": 0, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java"}, {"lines": 7, "deletions": 1, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java"}, {"lines": 57, "deletions": 28, "insertions": 29, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestBookieWatcher.java"}, {"lines": 10, "deletions": 4, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieRequestProcessor.java"}, {"lines": 316, "deletions": 156, "insertions": 160, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/UpdateLedgerOpTest.java"}, {"lines": 7, "deletions": 3, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java"}, {"lines": 37, "deletions": 18, "insertions": 19, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/auth/TestAuth.java"}, {"lines": 24, "deletions": 11, "insertions": 13, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorPeriodicCheckTest.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "pom.xml"}], "commitParents": ["c5c016082de9df4013c4764c6144fe2df93c3a06"], "commitDateTime": "2018-08-21 14:14:39", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "tooManyChanges", "authoredDateTime": "2018-08-21 14:08:14"}, {"commitSpoonAstDiffStats": [], "nameRev": "5f2d45c8fa0619d50423f1672303fea2d1a59238 tags/release-4.9.0~208", "commitHash": "5f2d45c8fa0619d50423f1672303fea2d1a59238", "commitMessage": "Issue #1610: netty leak detector logs 'LEAK: HashedWheelTimer.release() was not called before it's garbage-collected.' in unit tests\n\nDescriptions of the changes in this PR:\n\nEnabled netty's paranoid leak detection for tests.\nFixed most of the 'LEAK: HashedWheelTimer.release() was not called before it's garbage-collected.' issues. Did not fix ones produced by AuditorElector. In long term we should fix these, ByteBuf leaks in BufferedChannel and whatever else we find and make tests fail if netty logs a leak.\n\n### Motivation\n\nI used to have random test timeouts/failures caused by delayed bookie shutdown when I built repo with OpenJDK 8 but ran tests after switching to Oracle JDK 8 (or vice versa). After these changes tests did not fail in these runs.\n\n### Changes\n\nMade bk/bkadmin/auditor close resources properly in the tests and shutdown calls.\nChanged order of initialization in Bookkeeper so it creates HashedWheelTimer after bookie client, in case bookie client creation fails due to misconfiguration.\n\nMaster Issue: #1610\n\nAuthor: Andrey Yegorov <ayegorov@salesforce.com>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1613 from dlg99/fix/issue_1610_hashedwheeltimer, closes #1610\n", "commitGitStats": [{"lines": 1, "deletions": 0, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java"}, {"lines": 7, "deletions": 1, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java"}, {"lines": 57, "deletions": 28, "insertions": 29, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestBookieWatcher.java"}, {"lines": 10, "deletions": 4, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieRequestProcessor.java"}, {"lines": 316, "deletions": 156, "insertions": 160, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/UpdateLedgerOpTest.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java"}, {"lines": 37, "deletions": 18, "insertions": 19, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/auth/TestAuth.java"}, {"lines": 24, "deletions": 11, "insertions": 13, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/AuditorPeriodicCheckTest.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "pom.xml"}], "commitParents": ["f782a9d818a12479d08c580a68b2566715da4c89"], "commitDateTime": "2018-08-21 14:08:14", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "tooManyChanges", "authoredDateTime": "2018-08-21 14:08:14"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "release/4.8.0", "release/4.9.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "netty leak detector logs \"LEAK: HashedWheelTimer.release() was not called before it's garbage-collected.\" in unit tests", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nRan org.apache.bookkeeper.replication.TestAutoRecoveryAlongWithBookieServers unit test\r\n\r\n- What did you expect to see?\r\n\r\nno leak detection warnings\r\n\r\n- What did you see instead?\r\n\r\n```\r\n20180817103439.000560 [ERROR] [AuditorElector-127.0.0.1:60318] [Slf4JLogger.java:171] - LEAK: HashedWheelTimer.release() was not called before it's garbage-collected.\r\n See http://netty.io/wiki/reference-counted-objects.html for more information.\r\nRecent access records:\r\nCreated at:\r\n        io.netty.util.HashedWheelTimer.<init>(HashedWheelTimer.java:272)\r\n        io.netty.util.HashedWheelTimer.<init>(HashedWheelTimer.java:216)\r\n        io.netty.util.HashedWheelTimer.<init>(HashedWheelTimer.java:195)\r\n        org.apache.bookkeeper.proto.BookieRequestProcessor.<init>(BookieRequestProcessor.java:185)\r\n        org.apache.bookkeeper.proto.BookieServer.<init>(BookieServer.java:112)\r\n        org.apache.bookkeeper.test.BookKeeperClusterTestCase.startBookie(BookKeeperClusterTestCase.java:612)\r\n        org.apache.bookkeeper.test.BookKeeperClusterTestCase.startNewBookieAndReturnAddress(BookKeeperClusterTestCase.java:595)\r\n        org.apache.bookkeeper.test.BookKeeperClusterTestCase.startNewBookie(BookKeeperClusterTestCase.java:587)\r\n        org.apache.bookkeeper.test.BookKeeperClusterTestCase.startBKCluster(BookKeeperClusterTestCase.java:219)\r\n        org.apache.bookkeeper.test.BookKeeperClusterTestCase.setUp(BookKeeperClusterTestCase.java:134)\r\n        sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n...\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"5358467746d154118f4e318c7546298531d01b67": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "5f2d45c8fa0619d50423f1672303fea2d1a59238": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-08-21 21:08:23", "url": "https://github.com/apache/bookkeeper/issues/1610", "user": "dlg99", "ttf": 4.000277777777778}, {"created": "2018-08-16 00:57:09", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "ConcurrentLongHashMapTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashMapTest.stressConcurrentInsertionsAndReads()"}]}, {"spoonFilePath": "ConcurrentOpenHashSet.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentOpenHashSet.Section"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentOpenHashSet.Section.rehash()"}]}, {"spoonFilePath": "ConcurrentLongHashSet.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashSet.Section"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashSet.Section.rehash()"}]}, {"spoonFilePath": "ConcurrentLongLongPairHashMap.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongLongPairHashMap.Section.rehash()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongLongPairHashMap.Section"}]}, {"spoonFilePath": "ConcurrentLongHashMap.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashMap.Section.rehash()"}, {"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashMap.Section"}]}, {"spoonFilePath": "ConcurrentOpenHashMap.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentOpenHashMap.Section.rehash()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentOpenHashMap.Section"}]}, {"spoonFilePath": "ConcurrentLongLongHashMap.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongLongHashMap.Section.rehash()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongLongHashMap.Section"}]}], "nameRev": "a7e66e1dd84ff17c918dbbf54e5baa18ff9c9c9b tags/release-4.9.0~218", "commitHash": "a7e66e1dd84ff17c918dbbf54e5baa18ff9c9c9b", "commitMessage": "ISSUE #1606: Fixed race condition during expansion of concurrent open hash maps\n\n### Motivation\n\nAs reported in #1606, there is a race condition in the concurrent open hash maps implementation. The race happens when the maps gets re-hashed after the expansion and the new arrays are substituting the old ones.\n\nThe race itself is that a thread doing a `get()` on the map is first checking the current `capacity` of the map, uses that to get the bucket and then tries to do optimistic read of the value in that bucket.\n\nThis assumes `capacity` update is visible only after the `values` array is already swapped, but that is not always the case in current code.\n\n### Changes\n * Use `volatile` qualifier for `capacity` and `values` arrays to ensure ordering of memory read is respected by compiler\n * In rehashing, update `capacity` after `values`\n\nAuthor: Matteo Merli <mmerli@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1607 from merlimat/fix-concurrent-maps, closes #1606\n", "commitGitStats": [{"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentOpenHashSet.java"}, {"lines": 68, "deletions": 0, "insertions": 68, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/util/collections/ConcurrentLongHashMapTest.java"}, {"lines": 10, "deletions": 4, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentLongHashMap.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentLongLongHashMap.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentOpenHashMap.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentLongHashSet.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentLongLongPairHashMap.java"}], "commitParents": ["b0c04dffdf0c6f243ef9f17326c9e5ad83d20544"], "commitDateTime": "2018-08-16 09:53:57", "commitUser": "merlimat", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-16 09:53:57"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "ConcurrentLongHashMapTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashMapTest.stressConcurrentInsertionsAndReads()"}]}, {"spoonFilePath": "ConcurrentOpenHashSet.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentOpenHashSet.Section"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentOpenHashSet.Section.rehash()"}]}, {"spoonFilePath": "ConcurrentLongHashSet.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashSet.Section"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashSet.Section.rehash()"}]}, {"spoonFilePath": "ConcurrentLongLongPairHashMap.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongLongPairHashMap.Section.rehash()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongLongPairHashMap.Section"}]}, {"spoonFilePath": "ConcurrentLongHashMap.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashMap.Section.rehash()"}, {"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashMap.Section"}]}, {"spoonFilePath": "ConcurrentOpenHashMap.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentOpenHashMap.Section.rehash()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentOpenHashMap.Section"}]}, {"spoonFilePath": "ConcurrentLongLongHashMap.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongLongHashMap.Section.rehash()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongLongHashMap.Section"}]}], "nameRev": "07bb42add176423e83b7db5777ac5f67a563d9ea tags/release-4.8.1~55", "commitHash": "07bb42add176423e83b7db5777ac5f67a563d9ea", "commitMessage": "ISSUE #1606: Fixed race condition during expansion of concurrent open hash maps\n\n### Motivation\n\nAs reported in #1606, there is a race condition in the concurrent open hash maps implementation. The race happens when the maps gets re-hashed after the expansion and the new arrays are substituting the old ones.\n\nThe race itself is that a thread doing a `get()` on the map is first checking the current `capacity` of the map, uses that to get the bucket and then tries to do optimistic read of the value in that bucket.\n\nThis assumes `capacity` update is visible only after the `values` array is already swapped, but that is not always the case in current code.\n\n### Changes\n * Use `volatile` qualifier for `capacity` and `values` arrays to ensure ordering of memory read is respected by compiler\n * In rehashing, update `capacity` after `values`\n\nAuthor: Matteo Merli <mmerli@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1607 from merlimat/fix-concurrent-maps, closes #1606\n\n(cherry picked from commit a7e66e1dd84ff17c918dbbf54e5baa18ff9c9c9b)\nSigned-off-by: Matteo Merli <mmerli@apache.org>\n", "commitGitStats": [{"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentOpenHashSet.java"}, {"lines": 68, "deletions": 0, "insertions": 68, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/util/collections/ConcurrentLongHashMapTest.java"}, {"lines": 10, "deletions": 4, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentLongHashMap.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentLongLongHashMap.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentOpenHashMap.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentLongHashSet.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentLongLongPairHashMap.java"}], "commitParents": ["da16515b603ba88d59b7b8d37c66ce1bf69af1fd"], "commitDateTime": "2018-08-16 09:54:47", "commitUser": "merlimat", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-16 09:53:57"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "ConcurrentLongHashMapTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashMapTest.stressConcurrentInsertionsAndReads()"}]}, {"spoonFilePath": "ConcurrentOpenHashSet.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentOpenHashSet.Section"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentOpenHashSet.Section.rehash()"}]}, {"spoonFilePath": "ConcurrentLongHashSet.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashSet.Section"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashSet.Section.rehash()"}]}, {"spoonFilePath": "ConcurrentLongLongPairHashMap.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongLongPairHashMap.Section.rehash()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongLongPairHashMap.Section"}]}, {"spoonFilePath": "ConcurrentLongHashMap.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashMap.Section.rehash()"}, {"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongHashMap.Section"}]}, {"spoonFilePath": "ConcurrentOpenHashMap.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentOpenHashMap.Section.rehash()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentOpenHashMap.Section"}]}, {"spoonFilePath": "ConcurrentLongLongHashMap.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongLongHashMap.Section.rehash()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.util.collections.ConcurrentLongLongHashMap.Section"}]}], "nameRev": "36edacab64e1e0bd2c9747557ffeec57b6b5ffa1 tags/release-4.7.2~11", "commitHash": "36edacab64e1e0bd2c9747557ffeec57b6b5ffa1", "commitMessage": "ISSUE #1606: Fixed race condition during expansion of concurrent open hash maps\n\n### Motivation\n\nAs reported in #1606, there is a race condition in the concurrent open hash maps implementation. The race happens when the maps gets re-hashed after the expansion and the new arrays are substituting the old ones.\n\nThe race itself is that a thread doing a `get()` on the map is first checking the current `capacity` of the map, uses that to get the bucket and then tries to do optimistic read of the value in that bucket.\n\nThis assumes `capacity` update is visible only after the `values` array is already swapped, but that is not always the case in current code.\n\n### Changes\n * Use `volatile` qualifier for `capacity` and `values` arrays to ensure ordering of memory read is respected by compiler\n * In rehashing, update `capacity` after `values`\n\nAuthor: Matteo Merli <mmerli@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1607 from merlimat/fix-concurrent-maps, closes #1606\n\n(cherry picked from commit a7e66e1dd84ff17c918dbbf54e5baa18ff9c9c9b)\nSigned-off-by: Matteo Merli <mmerli@apache.org>\n", "commitGitStats": [{"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentOpenHashSet.java"}, {"lines": 68, "deletions": 0, "insertions": 68, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/util/collections/ConcurrentLongHashMapTest.java"}, {"lines": 10, "deletions": 4, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentLongHashMap.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentLongLongHashMap.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentOpenHashMap.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentLongHashSet.java"}, {"lines": 8, "deletions": 3, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/collections/ConcurrentLongLongPairHashMap.java"}], "commitParents": ["e5a54752a5f2a6190acb06fbe88cd650eb32533b"], "commitDateTime": "2018-08-16 09:55:29", "commitUser": "merlimat", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-16 09:53:57"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "area/client", "release/4.7.2", "release/4.8.0", "release/4.9.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "ArrayIndexOutOfBoundsException on ConcurrentLongHashMap", "numCommits": 0, "body": "*Problem*\r\n\r\n```\r\n00:34:54.922 [bookie-io-1-6] ERROR org.apache.bookkeeper.proto.WriteEntryProcessor - Unexpected exception while writing 30031@3 : 4611\r\njava.lang.ArrayIndexOutOfBoundsException: 4611\r\n        at org.apache.bookkeeper.util.collections.ConcurrentLongHashMap$Section.get(ConcurrentLongHashMap.java:245) ~[org.apache.bookkeeper-bookkeeper-server-4.7.1.jar:4.7.1]\r\n        at org.apache.bookkeeper.util.collections.ConcurrentLongHashMap.get(ConcurrentLongHashMap.java:125) ~[org.apache.bookkeeper-bookkeeper-server-4.7.1.jar:4.7.1]\r\n        at org.apache.bookkeeper.bookie.HandleFactoryImpl.getHandle(HandleFactoryImpl.java:45) ~[org.apache.bookkeeper-bookkeeper-server-4.7.1.jar:4.7.1]\r\n        at org.apache.bookkeeper.bookie.Bookie.getLedgerForEntry(Bookie.java:1104) ~[org.apache.bookkeeper-bookkeeper-server-4.7.1.jar:4.7.1]\r\n        at org.apache.bookkeeper.bookie.Bookie.addEntry(Bookie.java:1214) ~[org.apache.bookkeeper-bookkeeper-server-4.7.1.jar:4.7.1]\r\n        at org.apache.bookkeeper.proto.WriteEntryProcessor.processPacket(WriteEntryProcessor.java:79) [org.apache.bookkeeper-bookkeeper-server-4.7.1.jar:4.7.1]\r\n        at org.apache.bookkeeper.proto.PacketProcessorBase.safeRun(PacketProcessorBase.java:85) [org.apache.bookkeeper-bookkeeper-server-4.7.1.jar:4.7.1]\r\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [org.apache.bookkeeper-bookkeeper-common-4.7.1.jar:4.7.1]\r\n        at org.apache.bookkeeper.proto.BookieRequestProcessor.processAddRequest(BookieRequestProcessor.java:487) [org.apache.bookkeeper-bookkeeper-server-4.7.1.jar:4.7.1]\r\n        at org.apache.bookkeeper.proto.BookieRequestProcessor.processRequest(BookieRequestProcessor.java:303) [org.apache.bookkeeper-bookkeeper-server-4.7.1.jar:4.7.1]\r\n        at org.apache.bookkeeper.proto.BookieRequestHandler.channelRead(BookieRequestHandler.java:80) [org.apache.bookkeeper-bookkeeper-server-4.7.1.jar:4.7.1]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.ChannelInboundHandlerAdapter.channelRead(ChannelInboundHandlerAdapter.java:86) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at org.apache.bookkeeper.proto.AuthHandler$ServerSideHandler.channelRead(AuthHandler.java:89) [org.apache.bookkeeper-bookkeeper-server-4.7.1.jar:4.7.1]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at org.apache.bookkeeper.proto.BookieProtoEncoding$RequestDecoder.channelRead(BookieProtoEncoding.java:441) [org.apache.bookkeeper-bookkeeper-server-4.7.1.jar:4.7.1]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:310) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:284) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1414) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:945) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:806) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:404) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:304) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_181]\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 2, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"a7e66e1dd84ff17c918dbbf54e5baa18ff9c9c9b": {"commitUser": "merlimat", "commitGHEventType": "closed"}, "07bb42add176423e83b7db5777ac5f67a563d9ea": {"commitUser": "merlimat", "commitGHEventType": "referenced"}, "36edacab64e1e0bd2c9747557ffeec57b6b5ffa1": {"commitUser": "merlimat", "commitGHEventType": "referenced"}}, "closed": "2018-08-16 16:54:11", "url": "https://github.com/apache/bookkeeper/issues/1606", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2018-08-15 17:33:48", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "AbstractConfiguration.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.conf.AbstractConfiguration"}]}, {"spoonFilePath": "LedgerIdFormatter.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.util.LedgerIdFormatter.newLedgerIdFormatter(org.apache.bookkeeper.conf.AbstractConfiguration)"}]}, {"spoonFilePath": "BookieShell.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 6, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.LedgerMetadataCmd"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.ReadMetadataCallback"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.LedgerMetadataCmd.getDescription()"}, {"INS": 0, "DEL": 1, "TOT": 7, "MOV": 3, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.ReadMetadataCallback.operationComplete(int,org.apache.bookkeeper.client.LedgerMetadata)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.LedgerMetadataCmd.getUsage()"}, {"INS": 2, "DEL": 1, "TOT": 15, "MOV": 10, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.LedgerMetadataCmd.runCmd(org.apache.commons.cli.CommandLine)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.ReadMetadataCallback.getLedgerId()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.LedgerMetadataCmd.getOptions()"}]}, {"spoonFilePath": "TestBookieShellCluster.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestBookieShellCluster.test102_DumpRestoreMetadata()"}]}], "nameRev": "b2439d67073c880d350f93c1939bbede5e00ec49 tags/release-4.9.0~173", "commitHash": "b2439d67073c880d350f93c1939bbede5e00ec49", "commitMessage": "Utility to dump/restore ledger metadata to/from file\n\nDumping will dump the serialized metadata to a file. Restoring will\r\nparse the metadata from the file and write it to the metadata store.\r\n\r\nAlso changes the LedgerIdFormatter to default to long formatter (it\r\nwas UUID before, and we don't even currently support UUID ledger ids).\r\n\r\nThis fixes #1604\r\n\n\nAuthor: Ivan Kelly <ivank@apache.org>\nAuthor: Enrico Olivelli <eolivelli@apache.org>\nAuthor: cguttapalem <cguttapalem@salesforce.com>\nAuthor: Qi Wang <codingwangqi@gmail.com>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>, Jia Zhai <None>\n\nThis closes #1667 from ivankelly/dump-metadata-to-from-file", "commitGitStats": [{"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/LedgerIdFormatter.java"}, {"lines": 43, "deletions": 0, "insertions": 43, "filePath": "tests/integration/smoke/src/test/java/org/apache/bookkeeper/tests/integration/TestBookieShellCluster.java"}, {"lines": 55, "deletions": 28, "insertions": 27, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieShell.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/AbstractConfiguration.java"}], "commitParents": ["5a818b226bf2c3e3d9d649ffe1e690af5ec2f794"], "commitDateTime": "2018-09-13 23:47:26", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-09-14 08:47:26"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tools", "release/4.9.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Default ledger id formatter should be LongLedgerIdFormatter", "numCommits": 0, "body": "Currently the default ledger id formatter in bookie shell is set to UUID formatter. I think that is only applicable when using LedgerAdv. so I think we need to change the default ledger id formatter to long ledger id formatter.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"b2439d67073c880d350f93c1939bbede5e00ec49": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-09-14 06:47:26", "url": "https://github.com/apache/bookkeeper/issues/1604", "user": "sijie", "ttf": 29.00027777777778}, {"created": "2018-08-09 14:41:44", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerHandle.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.handleBookieFailure(java.util.Map)"}, {"INS": 1, "DEL": 6, "TOT": 14, "MOV": 4, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.handleDelayedWriteBookieFailure()"}, {"INS": 0, "DEL": 3, "TOT": 6, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.ChangeEnsembleCb.safeOperationComplete(int,org.apache.bookkeeper.client.LedgerMetadata)"}, {"INS": 0, "DEL": 3, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.ChangeEnsembleCb"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.ReReadLedgerMetadataCb.updateMetadataIfPossible(org.apache.bookkeeper.client.LedgerMetadata,org.apache.bookkeeper.client.LedgerMetadata)"}]}], "nameRev": "3ab6e9253555d013a8c6eb3b90cddffa090fcaee tags/release-4.9.0~224", "commitHash": "3ab6e9253555d013a8c6eb3b90cddffa090fcaee", "commitMessage": "Delayed write ensemble change may cause dataloss\n\nDescriptions of the changes in this PR:\n\nThe Original intent of this change is to do a best-effort ensemble change.\nBut this is not possible until the local metadata is completely immutable.\nUntil the feature \"Make LedgerMetadata Immutable #610\" Is complete we will use\nhandleBookieFailure() to handle delayed writes as regular bookie failures.\n\nSigned-off-by: Venkateswararao Jujjuri (JV) <vjujjurisalesforce.com>\n\nMaster Issue: #1591\nRelate Issue: #1395\n\nAuthor: JV Jujjuri <vjujjuri@salesforce.com>\nAuthor: Ivan Kelly <ivank@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #1592 from jvrao/datalossbug\n", "commitGitStats": [{"lines": 78, "deletions": 61, "insertions": 17, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java"}], "commitParents": ["6b9cbf2052b27f331553f2738483ae21bf12b49c"], "commitDateTime": "2018-08-13 15:00:02", "commitUser": "ivankelly", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-13 15:00:02"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerHandle.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.handleBookieFailure(java.util.Map)"}, {"INS": 1, "DEL": 6, "TOT": 14, "MOV": 4, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.handleDelayedWriteBookieFailure()"}, {"INS": 0, "DEL": 3, "TOT": 6, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.ChangeEnsembleCb.safeOperationComplete(int,org.apache.bookkeeper.client.LedgerMetadata)"}, {"INS": 0, "DEL": 3, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.ChangeEnsembleCb"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.ReReadLedgerMetadataCb.updateMetadataIfPossible(org.apache.bookkeeper.client.LedgerMetadata,org.apache.bookkeeper.client.LedgerMetadata)"}]}], "nameRev": "2c421e9ed6cee7f5259f2a7ea433466a5424edf6 tags/release-4.8.1~58", "commitHash": "2c421e9ed6cee7f5259f2a7ea433466a5424edf6", "commitMessage": "Delayed write ensemble change may cause dataloss\n\nDescriptions of the changes in this PR:\n\nThe Original intent of this change is to do a best-effort ensemble change.\nBut this is not possible until the local metadata is completely immutable.\nUntil the feature \"Make LedgerMetadata Immutable #610\" Is complete we will use\nhandleBookieFailure() to handle delayed writes as regular bookie failures.\n\nSigned-off-by: Venkateswararao Jujjuri (JV) <vjujjurisalesforce.com>\n\nMaster Issue: #1591\nRelate Issue: #1395\n\nAuthor: JV Jujjuri <vjujjuri@salesforce.com>\nAuthor: Ivan Kelly <ivank@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #1592 from jvrao/datalossbug\n\n(cherry picked from commit 3ab6e9253555d013a8c6eb3b90cddffa090fcaee)\nSigned-off-by: Ivan Kelly <ivank@apache.org>\n", "commitGitStats": [{"lines": 78, "deletions": 61, "insertions": 17, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java"}], "commitParents": ["5f3d28228ac984ded435d932b05cb1d348694dfc"], "commitDateTime": "2018-08-13 15:00:52", "commitUser": "ivankelly", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-13 15:00:02"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "release/4.7.2", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Deferred failure handling can cause data loss", "numCommits": 0, "body": "The bookkeeper client has a feature where if you have a ledger with a write quorum(Qw) larger than an ack quorum(Qa), such as 3:3:2, if (Qw-Qa) bookies return an error, after the entry add has completed, the erroring bookie will be replaced in the ensemble in the background.\r\n\r\nThis can cause data loss.\r\n\r\nConsider a 3:3:2 ledger. Assume zookeeper is not accepting writes.\r\n\r\nStart ensemble is b1,b2,b3\r\n- e0 is written to b1,b2,b3\r\n- b2 & b3 acknowledge, e0 request completes\r\n- b1 responds with and error and is added to the delayed ensemble change list\r\n- e1 is written, delayed error handling kicks off, b1 is replaced, so e1 is written to b4,b2,b3 while the client tries to update the metadata in zookeeper. zookeeper is stalled so fails to respond.\r\n- repeat this sequence for each of b2 and b3.\r\n\r\nAs each bookie fails, it will be replaced and writes will be acknowledged. Eventually the ensembles will look something like\r\n```\r\n0: b1,b2,b3\r\n1: b4,b2,b3\r\n3: b4,b5,b3\r\n4: b4,b5,b6\r\n```\r\nHow ever, this is only local, zookeeper still only has the initial ensemble. So, even though all entries from 4 onwards are acknowledged successfully to the client, if another client comes to read the ledger, they will not see them. If the other client recovers the ledger, the data is lost. TOAB violation.\r\n\r\nHere's a test case which triggers the issue:\r\nhttps://github.com/ivankelly/bookkeeper/blob/15bc251d46d5cd5fcceef130c0046eeacbe446cc/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestDeferredFailure.java\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"3ab6e9253555d013a8c6eb3b90cddffa090fcaee": {"commitUser": "ivankelly", "commitGHEventType": "referenced"}, "2c421e9ed6cee7f5259f2a7ea433466a5424edf6": {"commitUser": "ivankelly", "commitGHEventType": "referenced"}}, "closed": "2018-08-21 18:46:08", "url": "https://github.com/apache/bookkeeper/issues/1591", "user": "ivankelly", "ttf": 12.000277777777777}, {"created": "2018-08-03 01:52:23", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "Auditor.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.checkAllLedgers().7.process(java.lang.Long,org.apache.zookeeper.AsyncCallback$VoidCallback)"}]}], "nameRev": "f782a9d818a12479d08c580a68b2566715da4c89 tags/release-4.9.0~209", "commitHash": "f782a9d818a12479d08c580a68b2566715da4c89", "commitMessage": "ISSUE #1578: Fixed deadlock in auditor blocking ZK thread\n\n### Motivation\n\nFixes #1578\n\nAfter getting ZK callback from ZK event thread, we need to jump to a background thread before doing synchronous call to `admin.openLedgerNoRecovery(ledgerId);` which will try to make a ZK request a wait for a response (which would be coming through same ZK event thread currently blocked..)\n\nAuthor: Matteo Merli <mmerli@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1608 from merlimat/fix-auditor-deadlock, closes #1578\n", "commitGitStats": [{"lines": 83, "deletions": 39, "insertions": 44, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java"}], "commitParents": ["dd964d6388987d2431b9fc5afa87d6e2e993feb8"], "commitDateTime": "2018-08-21 11:42:14", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-21 11:42:14"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "Auditor.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.checkAllLedgers().7.process(java.lang.Long,org.apache.zookeeper.AsyncCallback$VoidCallback)"}]}], "nameRev": "51040cf0942615b915720287b8bb3d9378583ec0 tags/release-4.7.2~6", "commitHash": "51040cf0942615b915720287b8bb3d9378583ec0", "commitMessage": "ISSUE #1578: Fixed deadlock in auditor blocking ZK thread\n\n### Motivation\n\nFixes #1578\n\nAfter getting ZK callback from ZK event thread, we need to jump to a background thread before doing synchronous call to `admin.openLedgerNoRecovery(ledgerId);` which will try to make a ZK request a wait for a response (which would be coming through same ZK event thread currently blocked..)\n\nAuthor: Matteo Merli <mmerli@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1608 from merlimat/fix-auditor-deadlock, closes #1578\n\n(cherry picked from commit f782a9d818a12479d08c580a68b2566715da4c89)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 83, "deletions": 39, "insertions": 44, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java"}], "commitParents": ["603bdbfa47e0843f4129eece58d514d416f8fcbe"], "commitDateTime": "2018-08-21 11:43:33", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-21 11:42:14"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "BKException.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.BKException"}]}, {"spoonFilePath": "ReplicationException.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.ReplicationException"}]}, {"spoonFilePath": "LedgerUnderreplicationManager.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 6, "MOV": 2, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.markLedgerUnderreplicated(long,java.lang.String)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.markLedgerUnderreplicatedAsync(long,java.util.Collection)"}]}, {"spoonFilePath": "TestLedgerUnderreplicationManager.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.replication.TestLedgerUnderreplicationManager.verifyMarkLedgerUnderreplicated(java.util.Collection)"}]}, {"spoonFilePath": "Auditor.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.publishSuspectedLedgersAsync(java.util.Collection,java.util.Set)"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.start().6.run()"}, {"INS": 3, "DEL": 2, "TOT": 29, "MOV": 14, "UPD": 10, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.ProcessLostFragmentsCb.operationComplete(int,java.util.Set)"}, {"INS": 0, "DEL": 1, "TOT": 11, "MOV": 3, "UPD": 7, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.publishSuspectedLedgers(java.lang.String,java.util.Set)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.handleLostBookiesAsync(java.util.Collection,java.util.Map)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.checkAllLedgers().8.processResult(int,java.lang.String,java.lang.Object)"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.startAudit(boolean)"}, {"INS": 0, "DEL": 7, "TOT": 39, "MOV": 24, "UPD": 8, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.checkAllLedgers().7.process(java.lang.Long,org.apache.zookeeper.AsyncCallback$VoidCallback)"}, {"INS": 0, "DEL": 1, "TOT": 9, "MOV": 4, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.handleLostBookies(java.util.Collection,java.util.Map)"}, {"INS": 1, "DEL": 2, "TOT": 6, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.auditBookies()"}, {"INS": 4, "DEL": 6, "TOT": 28, "MOV": 9, "UPD": 9, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.checkAllLedgers()"}]}, {"spoonFilePath": "ZkLedgerUnderreplicationManager.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.markLedgerUnderreplicatedAsync(long,java.util.Collection)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.handleLedgerUnderreplicatedAlreadyMarked(java.lang.String,java.util.Collection,java.util.List,java.util.concurrent.CompletableFuture)"}, {"INS": 0, "DEL": 3, "TOT": 58, "MOV": 38, "UPD": 17, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.markLedgerUnderreplicated(long,java.lang.String)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.getLedgerUnreplicationInfo(long)"}, {"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.tryMarkLedgerUnderreplicatedAsync(java.lang.String,java.util.Collection,java.util.List,java.util.concurrent.CompletableFuture)"}]}], "nameRev": "3e0112505381b3eb922f21de1f18daf302002201 tags/release-4.7.2~3", "commitHash": "3e0112505381b3eb922f21de1f18daf302002201", "commitMessage": "Provide async version of markLedgerUnderreplicated for LedgerUnderreplicationManager\n\nDescriptions of the changes in this PR:\n\n ### Motivation\n\nAuditor has multiple places calling sync methods in async callbacks.\nThis raises the possibility hitting deadlock. Issue #1578 is one of the examples.\n\nAfter looking into the `LedgerUnderreplicationManager`, `markLedgerUnderreplicated`\nis the only interface that will be called in async callbacks. This change is\nto provide an async version of `markLedgerUnderreplicated`.\n\n ### Changes\n\n- add `markLedgerUnderreplicatedAsync` interface in `LedgerUnderreplicationManager`.\n- implement the logic of `markLedgerUnderreplicated` using async callbacks\n- use `markLedgerUnderreplicatedAsync` in the Auditor\n\nRelated Issues: #1578\nMaster Issue: #1617\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Charan Reddy Guttapalem <reddycharan18@gmail.com>, Enrico Olivelli <eolivelli@gmail.com>, Matteo Merli <mmerli@apache.org>\n\nThis closes #1619 from sijie/async_sync_autorecovery\n", "commitGitStats": [{"lines": 238, "deletions": 142, "insertions": 96, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java"}, {"lines": 123, "deletions": 42, "insertions": 81, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java"}, {"lines": 4, "deletions": 3, "insertions": 1, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/TestLedgerUnderreplicationManager.java"}, {"lines": 15, "deletions": 0, "insertions": 15, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BKException.java"}, {"lines": 22, "deletions": 2, "insertions": 20, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/LedgerUnderreplicationManager.java"}, {"lines": 11, "deletions": 0, "insertions": 11, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/ReplicationException.java"}], "commitParents": ["6698ab8bc1f2f491e0f8ecd6826dfccddb7f32cb"], "commitDateTime": "2018-08-26 20:49:17", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-26 19:51:08"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "BKException.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.BKException"}]}, {"spoonFilePath": "ReplicationException.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.ReplicationException"}]}, {"spoonFilePath": "LedgerUnderreplicationManager.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 6, "MOV": 2, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.markLedgerUnderreplicated(long,java.lang.String)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.markLedgerUnderreplicatedAsync(long,java.util.Collection)"}]}, {"spoonFilePath": "TestLedgerUnderreplicationManager.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.replication.TestLedgerUnderreplicationManager.verifyMarkLedgerUnderreplicated(java.util.Collection)"}]}, {"spoonFilePath": "Auditor.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.publishSuspectedLedgersAsync(java.util.Collection,java.util.Set)"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.start().6.run()"}, {"INS": 3, "DEL": 2, "TOT": 29, "MOV": 14, "UPD": 10, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.ProcessLostFragmentsCb.operationComplete(int,java.util.Set)"}, {"INS": 0, "DEL": 1, "TOT": 11, "MOV": 3, "UPD": 7, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.publishSuspectedLedgers(java.lang.String,java.util.Set)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.handleLostBookiesAsync(java.util.Collection,java.util.Map)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.checkAllLedgers().8.processResult(int,java.lang.String,java.lang.Object)"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.startAudit(boolean)"}, {"INS": 0, "DEL": 7, "TOT": 39, "MOV": 24, "UPD": 8, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.checkAllLedgers().7.process(java.lang.Long,org.apache.zookeeper.AsyncCallback$VoidCallback)"}, {"INS": 0, "DEL": 1, "TOT": 9, "MOV": 4, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.handleLostBookies(java.util.Collection,java.util.Map)"}, {"INS": 1, "DEL": 2, "TOT": 6, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.auditBookies()"}, {"INS": 4, "DEL": 6, "TOT": 28, "MOV": 9, "UPD": 9, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.checkAllLedgers()"}]}, {"spoonFilePath": "ZkLedgerUnderreplicationManager.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.markLedgerUnderreplicatedAsync(long,java.util.Collection)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.handleLedgerUnderreplicatedAlreadyMarked(java.lang.String,java.util.Collection,java.util.List,java.util.concurrent.CompletableFuture)"}, {"INS": 0, "DEL": 3, "TOT": 54, "MOV": 38, "UPD": 13, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.markLedgerUnderreplicated(long,java.lang.String)"}, {"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.tryMarkLedgerUnderreplicatedAsync(java.lang.String,java.util.Collection,java.util.List,java.util.concurrent.CompletableFuture)"}]}], "nameRev": "73b428c7975c975f25956815670493a7093441ec tags/release-4.9.0~201", "commitHash": "73b428c7975c975f25956815670493a7093441ec", "commitMessage": "Provide async version of markLedgerUnderreplicated for LedgerUnderreplicationManager\n\nDescriptions of the changes in this PR:\n\n ### Motivation\n\nAuditor has multiple places calling sync methods in async callbacks.\nThis raises the possibility hitting deadlock. Issue #1578 is one of the examples.\n\nAfter looking into the `LedgerUnderreplicationManager`, `markLedgerUnderreplicated`\nis the only interface that will be called in async callbacks. This change is\nto provide an async version of `markLedgerUnderreplicated`.\n\n ### Changes\n\n- add `markLedgerUnderreplicatedAsync` interface in `LedgerUnderreplicationManager`.\n- implement the logic of `markLedgerUnderreplicated` using async callbacks\n- use `markLedgerUnderreplicatedAsync` in the Auditor\n\nRelated Issues: #1578\nMaster Issue: #1617\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Charan Reddy Guttapalem <reddycharan18@gmail.com>, Enrico Olivelli <eolivelli@gmail.com>, Matteo Merli <mmerli@apache.org>\n\nThis closes #1619 from sijie/async_sync_autorecovery\n", "commitGitStats": [{"lines": 238, "deletions": 142, "insertions": 96, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java"}, {"lines": 131, "deletions": 45, "insertions": 86, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java"}, {"lines": 4, "deletions": 3, "insertions": 1, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/TestLedgerUnderreplicationManager.java"}, {"lines": 15, "deletions": 0, "insertions": 15, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BKException.java"}, {"lines": 22, "deletions": 2, "insertions": 20, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/LedgerUnderreplicationManager.java"}, {"lines": 11, "deletions": 0, "insertions": 11, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/ReplicationException.java"}], "commitParents": ["3672a280e9b1f776514cba7066e5100aa7a32d08"], "commitDateTime": "2018-08-26 19:51:08", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-26 19:51:08"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "BKException.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.BKException"}]}, {"spoonFilePath": "ReplicationException.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.ReplicationException"}]}, {"spoonFilePath": "LedgerUnderreplicationManager.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 6, "MOV": 2, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.markLedgerUnderreplicated(long,java.lang.String)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.markLedgerUnderreplicatedAsync(long,java.util.Collection)"}]}, {"spoonFilePath": "TestLedgerUnderreplicationManager.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.replication.TestLedgerUnderreplicationManager.verifyMarkLedgerUnderreplicated(java.util.Collection)"}]}, {"spoonFilePath": "Auditor.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.publishSuspectedLedgersAsync(java.util.Collection,java.util.Set)"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.start().6.run()"}, {"INS": 3, "DEL": 2, "TOT": 29, "MOV": 14, "UPD": 10, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.ProcessLostFragmentsCb.operationComplete(int,java.util.Set)"}, {"INS": 0, "DEL": 1, "TOT": 11, "MOV": 3, "UPD": 7, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.publishSuspectedLedgers(java.lang.String,java.util.Set)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.handleLostBookiesAsync(java.util.Collection,java.util.Map)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.checkAllLedgers().8.processResult(int,java.lang.String,java.lang.Object)"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.startAudit(boolean)"}, {"INS": 0, "DEL": 7, "TOT": 39, "MOV": 24, "UPD": 8, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.checkAllLedgers().7.process(java.lang.Long,org.apache.zookeeper.AsyncCallback$VoidCallback)"}, {"INS": 0, "DEL": 1, "TOT": 9, "MOV": 4, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.handleLostBookies(java.util.Collection,java.util.Map)"}, {"INS": 1, "DEL": 2, "TOT": 6, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.auditBookies()"}, {"INS": 4, "DEL": 6, "TOT": 28, "MOV": 9, "UPD": 9, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.checkAllLedgers()"}]}, {"spoonFilePath": "ZkLedgerUnderreplicationManager.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.markLedgerUnderreplicatedAsync(long,java.util.Collection)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.handleLedgerUnderreplicatedAlreadyMarked(java.lang.String,java.util.Collection,java.util.List,java.util.concurrent.CompletableFuture)"}, {"INS": 0, "DEL": 3, "TOT": 54, "MOV": 38, "UPD": 13, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.markLedgerUnderreplicated(long,java.lang.String)"}, {"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.ZkLedgerUnderreplicationManager.tryMarkLedgerUnderreplicatedAsync(java.lang.String,java.util.Collection,java.util.List,java.util.concurrent.CompletableFuture)"}]}], "nameRev": "9f641c16d51ce25f36549a1dc5b7600e114bbcbb tags/release-4.8.1~43", "commitHash": "9f641c16d51ce25f36549a1dc5b7600e114bbcbb", "commitMessage": "Provide async version of markLedgerUnderreplicated for LedgerUnderreplicationManager\n\nDescriptions of the changes in this PR:\n\n ### Motivation\n\nAuditor has multiple places calling sync methods in async callbacks.\nThis raises the possibility hitting deadlock. Issue #1578 is one of the examples.\n\nAfter looking into the `LedgerUnderreplicationManager`, `markLedgerUnderreplicated`\nis the only interface that will be called in async callbacks. This change is\nto provide an async version of `markLedgerUnderreplicated`.\n\n ### Changes\n\n- add `markLedgerUnderreplicatedAsync` interface in `LedgerUnderreplicationManager`.\n- implement the logic of `markLedgerUnderreplicated` using async callbacks\n- use `markLedgerUnderreplicatedAsync` in the Auditor\n\nRelated Issues: #1578\nMaster Issue: #1617\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Charan Reddy Guttapalem <reddycharan18@gmail.com>, Enrico Olivelli <eolivelli@gmail.com>, Matteo Merli <mmerli@apache.org>\n\nThis closes #1619 from sijie/async_sync_autorecovery\n\n(cherry picked from commit 73b428c7975c975f25956815670493a7093441ec)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 238, "deletions": 142, "insertions": 96, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java"}, {"lines": 131, "deletions": 45, "insertions": 86, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java"}, {"lines": 4, "deletions": 3, "insertions": 1, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/TestLedgerUnderreplicationManager.java"}, {"lines": 15, "deletions": 0, "insertions": 15, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BKException.java"}, {"lines": 22, "deletions": 2, "insertions": 20, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/LedgerUnderreplicationManager.java"}, {"lines": 11, "deletions": 0, "insertions": 11, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/ReplicationException.java"}], "commitParents": ["d65482feffcae2c572655975f93948f565fb7ec3"], "commitDateTime": "2018-08-26 19:51:22", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-26 19:51:08"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "Auditor.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.replication.Auditor.checkAllLedgers().7.process(java.lang.Long,org.apache.zookeeper.AsyncCallback$VoidCallback)"}]}], "nameRev": "c5c016082de9df4013c4764c6144fe2df93c3a06 tags/release-4.8.1~48", "commitHash": "c5c016082de9df4013c4764c6144fe2df93c3a06", "commitMessage": "ISSUE #1578: Fixed deadlock in auditor blocking ZK thread\n\n### Motivation\n\nFixes #1578\n\nAfter getting ZK callback from ZK event thread, we need to jump to a background thread before doing synchronous call to `admin.openLedgerNoRecovery(ledgerId);` which will try to make a ZK request a wait for a response (which would be coming through same ZK event thread currently blocked..)\n\nAuthor: Matteo Merli <mmerli@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1608 from merlimat/fix-auditor-deadlock, closes #1578\n\n(cherry picked from commit f782a9d818a12479d08c580a68b2566715da4c89)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 83, "deletions": 39, "insertions": 44, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java"}], "commitParents": ["9a96874be8db454031901bfc312cdc4b290a08d9"], "commitDateTime": "2018-08-21 11:43:14", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-21 11:42:14"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/metadata", "release/4.7.2", "release/4.8.0", "release/4.9.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Auditor run Periodic check only once", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n**What did you do?**\r\n\r\nIn our cluster, Auditor run periodic check only once. If interval expires after first periodic check, auditor will not run periodic check.\r\nIf we want to run periodic check again, we have to restart auditor bookie.\r\n\r\nAuditor's thread dump\r\nIt seems that `AuditorBookie` thread stop by `CountDownLatch` with some reason.\r\nhttps://gist.github.com/hrsakai/d65e8e2cd511173232b1010a9bbdf126\r\n```\r\n\"AuditorBookie-XXXXX:3181\" #40 daemon prio=5 os_prio=0 tid=0x00007f049c117830 nid=0x5da4 waiting on condition [0x00007f0477dfc000]\r\n   java.lang.Thread.State: WAITING (parking)\r\n        at sun.misc.Unsafe.park(Native Method)\r\n        - parking to wait for  <0x00000000e04e54f8> (a java.util.concurrent.CountDownLatch$Sync)\r\n        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:997)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1304)\r\n        at java.util.concurrent.CountDownLatch.await(CountDownLatch.java:231)\r\n        at org.apache.bookkeeper.replication.Auditor.checkAllLedgers(Auditor.java:696)\r\n        at org.apache.bookkeeper.replication.Auditor$5.run(Auditor.java:359)\r\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)\r\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n        at java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nI saw many timed-out logs in Auditor's log file.\r\n```\r\n23:14:56.769 [BookKeeperClientScheduler-OrderedScheduler-0-0] INFO  o.a.b.proto.PerChannelBookieClient   - Timed-out 2 operations to channel [id: 0xa17320e1, L:/AAAA:38234 - R:XXXX.co.jp/BBBB:3181] for BBBB:3181\r\n23:14:56.921 [BookKeeperClientScheduler-OrderedScheduler-0-0] INFO  o.a.b.proto.PerChannelBookieClient   - Timed-out 48 operations to channel [id: 0x359c20bd, L:/AAAA:38222 - R:BBBB/BBBB:3181] for BBBB:3181\r\n23:15:37.768 [BookKeeperClientScheduler-OrderedScheduler-0-0] INFO  o.a.b.proto.PerChannelBookieClient   - Timed-out 2 operations to channel [id: 0xa17320e1, L:/AAAA:38234 - R:XXXX.co.jp/BBBB:3181] for BBBB:3181\r\n23:15:37.921 [BookKeeperClientScheduler-OrderedScheduler-0-0] INFO  o.a.b.proto.PerChannelBookieClient   - Timed-out 91 operations to channel [id: 0x359c20bd, L:/AAAA:38222 - R:BBBB/BBBB:3181] for BBBB:3181\r\n\u30fb\r\n\u30fb\r\n```\r\n\r\n\r\n**What did you expect to see?**\r\n\r\nAuditor run periodic check after every interval expires.\r\n\r\n**What did you see instead?**\r\n\r\nAuditor run periodic check only once.\r\n\r\n**System configuration**\r\nBookKeeper version : 4.7.0\r\nNumber of Bookies: 5\r\nEnsemble size: 2\r\nWrite quorum size: 2\r\nAck quorum size: 2\r\nPriodic check interval: 1day\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 2, "duplicated": 4, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"f782a9d818a12479d08c580a68b2566715da4c89": {"commitUser": "sijie", "commitGHEventType": "closed"}, "51040cf0942615b915720287b8bb3d9378583ec0": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "9f641c16d51ce25f36549a1dc5b7600e114bbcbb": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "73b428c7975c975f25956815670493a7093441ec": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "3e0112505381b3eb922f21de1f18daf302002201": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "c5c016082de9df4013c4764c6144fe2df93c3a06": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-08-27 08:15:07", "url": "https://github.com/apache/bookkeeper/issues/1578", "user": "hrsakai", "ttf": 24.00027777777778}, {"created": "2018-07-15 15:17:37", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "ZKLogSegmentMetadataStore.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.distributedlog.impl.ZKLogSegmentMetadataStore.notifyLogStreamDeleted(java.lang.String,java.util.Map)"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.distributedlog.impl.ZKLogSegmentMetadataStore.notifyLogSegmentsUpdated(java.lang.String,java.util.Map,org.apache.bookkeeper.versioning.Versioned)"}]}], "nameRev": "e04020acda245c66351ccf2612f01b2c26ddbdd6 tags/release-4.7.2~13", "commitHash": "e04020acda245c66351ccf2612f01b2c26ddbdd6", "commitMessage": "ISSUE #1544: [DLOG] ConcurrentModificationException with nonblocking logReader.readNext(true)\n\nDescriptions of the changes in this PR:\n\n*Motivation*\n\nFixes #1544. ConcurrentModificationException is thrown when trying to access a non-thread-safe hashmap from different threads.\n\n*Changes*\n\nMake sure accessing to this non-thread-safe hashmap is under synchronized block.\n\n*Tests*\n\nIt is a bit tricky to reproduce this race condition in a unit test or an integration test. so not going to attempt adding any tests.\n\nMaster Issue: #1544\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #1558 from sijie/issue_1544, closes #1544\n\n(cherry picked from commit ec7fb62f025a3b03b42fd92b38bc836515310fad)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 16, "deletions": 4, "insertions": 12, "filePath": "stream/distributedlog/core/src/main/java/org/apache/distributedlog/impl/ZKLogSegmentMetadataStore.java"}], "commitParents": ["5eacab950dc6d6dca0ea9b8137dbbe7be3bbcff5"], "commitDateTime": "2018-07-23 11:04:49", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-07-23 11:04:33"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "ZKLogSegmentMetadataStore.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.distributedlog.impl.ZKLogSegmentMetadataStore.notifyLogStreamDeleted(java.lang.String,java.util.Map)"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.distributedlog.impl.ZKLogSegmentMetadataStore.notifyLogSegmentsUpdated(java.lang.String,java.util.Map,org.apache.bookkeeper.versioning.Versioned)"}]}], "nameRev": "ec7fb62f025a3b03b42fd92b38bc836515310fad tags/release-4.8.1~77", "commitHash": "ec7fb62f025a3b03b42fd92b38bc836515310fad", "commitMessage": "ISSUE #1544: [DLOG] ConcurrentModificationException with nonblocking logReader.readNext(true)\n\nDescriptions of the changes in this PR:\n\n*Motivation*\n\nFixes #1544. ConcurrentModificationException is thrown when trying to access a non-thread-safe hashmap from different threads.\n\n*Changes*\n\nMake sure accessing to this non-thread-safe hashmap is under synchronized block.\n\n*Tests*\n\nIt is a bit tricky to reproduce this race condition in a unit test or an integration test. so not going to attempt adding any tests.\n\nMaster Issue: #1544\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #1558 from sijie/issue_1544, closes #1544\n", "commitGitStats": [{"lines": 16, "deletions": 4, "insertions": 12, "filePath": "stream/distributedlog/core/src/main/java/org/apache/distributedlog/impl/ZKLogSegmentMetadataStore.java"}], "commitParents": ["50f29ed9425095e2115b7c18518b8e9a81c204e9"], "commitDateTime": "2018-07-23 11:04:33", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-07-23 11:04:33"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/dlog", "release/4.7.2", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "ConcurrentModificationException with nonblocking logReader.readNext(true) ", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nI do a nonblocking read from the server with three bookie, my version is bookkeeper 4.7.1\r\nmy code is \r\n````\r\nreader = dlm.getInputStream(nextTxId);\r\n                    while (true) {\r\n                        try {\r\n                            LogRecord record = reader.readNext(false);\r\n                            if (record == null) {\r\n                                reader.close();\r\n                                reader = null;\r\n                                break;\r\n                            }\r\n                            if (record.getTransactionId() > getLocalLastTxId()) {\r\n                                LOG.info(\"updatelog \" + this.nodeName + \",\" + this.instanceName + \":\" + \"newTransactionId:\" + record.getTransactionId() + \",localLastTxId:\" + getLocalLastTxId());\r\n                                updateLog(record);\r\n                            }\r\n                        } catch (LogEmptyException t) {\r\n                            System.out.println(\"no record in log.\");\r\n                        } catch (Throwable ioe) {\r\n                            // handle the exception\r\n                            if(reader!=null){\r\n                                reader.close();\r\n                            }\r\n                            nextTxId = getLocalLastTxId();\r\n                            reader = dlm.getInputStream(nextTxId);\r\n                        }\r\n\r\n                    }\r\n````\r\n\r\nand I observe an error log \r\n\r\n```\r\n2018-07-15 23:05:01  [ DLM-/pigeon40namespace-OrderedScheduler-1-0:8345 ] - [ ERROR ]  Unexpected throwable caught  org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:38)  \r\njava.util.ConcurrentModificationException\r\n\tat java.util.HashMap$HashIterator.nextNode(HashMap.java:1437)\r\n\tat java.util.HashMap$ValueIterator.next(HashMap.java:1466)\r\n\tat org.apache.distributedlog.impl.ZKLogSegmentMetadataStore.lambda$notifyLogSegmentsUpdated$1(ZKLogSegmentMetadataStore.java:493)\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:266)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\n```\r\n\r\nand then no more data is read.\r\n\r\n\r\n**BP**\r\n\r\nThis is the master ticket for tracking BP-&lt;bp-number&gt; :\r\n\r\n[a short description for this BP]\r\n\r\nProposal PR - #&lt;pr-number&gt;\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"e04020acda245c66351ccf2612f01b2c26ddbdd6": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "ec7fb62f025a3b03b42fd92b38bc836515310fad": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-07-23 18:04:43", "url": "https://github.com/apache/bookkeeper/issues/1544", "user": "infodog", "ttf": 8.000277777777777}, {"created": "2018-07-14 01:27:07", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "b1d23b483a06f987efab8b794a9e754dc4552542 tags/release-4.8.1~88", "commitHash": "b1d23b483a06f987efab8b794a9e754dc4552542", "commitMessage": "ISSUE #1542: Unable to run 'bookkeeper' shell script from /bookkeeper/bin folder\n\nDescriptions of the changes in this PR:\n\n*Bug*\n\n```\nGetting NoClassDefFoundError while trying to run 'bookkeeper' shell script from 'bin' folder. Issue seems to be related with classpath (cached classpath file - cached_classpath.txt)\n\n~/Workspace/Community/bookkeeper/bin$ ./bookkeeper shell\nJAVA_HOME not set, using java from PATH. (/usr/bin/java)\ncat: bookkeeper-server/target/cached_classpath.txt: No such file or directory\nError: A JNI error has occurred, please check your installation and try again\nException in thread \"main\" java.lang.NoClassDefFoundError: org/apache/commons/configuration/Configuration\nat java.lang.Class.getDeclaredMethods0(Native Method)\nat java.lang.Class.privateGetDeclaredMethods(Class.java:2701)\nat java.lang.Class.privateGetMethodRecursive(Class.java:3048)\nat java.lang.Class.getMethod0(Class.java:3018)\nat java.lang.Class.getMethod(Class.java:1784)\nat sun.launcher.LauncherHelper.validateMainClass(LauncherHelper.java:544)\nat sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:526)\nCaused by: java.lang.ClassNotFoundException: org.apache.commons.configuration.Configuration\nat java.net.URLClassLoader.findClass(URLClassLoader.java:381)\nat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\nat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)\nat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\n... 7 more\n```\n\n*Motivation*\n\nFixes #1542\n\n*Problem*\n\n`bin/common.sh` uses a relative path for caching classpath and locating the pom file.\n\n*Changes*\n\n- change to use full path for cached classpath file and the module pom file\n- add a test case to cover this problem\n\nMaster Issue: #1542\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Charan Reddy Guttapalem <reddycharan18@gmail.com>\n\nThis closes #1548 from sijie/fix_issue_1542, closes #1542\n", "commitGitStats": [{"lines": 6, "deletions": 3, "insertions": 3, "filePath": "bin/common.sh"}, {"lines": 22, "deletions": 0, "insertions": 22, "filePath": "tests/scripts/src/test/bash/bk_test_bin_common.sh"}], "commitParents": ["30175bf0b924a7da16cbd5ed8cb7e870dff76d73"], "commitDateTime": "2018-07-17 00:32:27", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-07-17 00:32:27"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tools", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Unable to run 'bookkeeper' shell script from /bookkeeper/bin folder", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\nGetting NoClassDefFoundError while trying to run 'bookkeeper' shell script from 'bin' folder. Issue seems to be related with classpath (cached classpath file - cached_classpath.txt)\r\n\r\n~/Workspace/Community/bookkeeper/bin$ ./bookkeeper shell\r\nJAVA_HOME not set, using java from PATH. (/usr/bin/java)\r\ncat: bookkeeper-server/target/cached_classpath.txt: No such file or directory\r\nError: A JNI error has occurred, please check your installation and try again\r\nException in thread \"main\" java.lang.NoClassDefFoundError: org/apache/commons/configuration/Configuration\r\n\tat java.lang.Class.getDeclaredMethods0(Native Method)\r\n\tat java.lang.Class.privateGetDeclaredMethods(Class.java:2701)\r\n\tat java.lang.Class.privateGetMethodRecursive(Class.java:3048)\r\n\tat java.lang.Class.getMethod0(Class.java:3018)\r\n\tat java.lang.Class.getMethod(Class.java:1784)\r\n\tat sun.launcher.LauncherHelper.validateMainClass(LauncherHelper.java:544)\r\n\tat sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:526)\r\nCaused by: java.lang.ClassNotFoundException: org.apache.commons.configuration.Configuration\r\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:381)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)\r\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\n\t... 7 more\r\n\r\nBut If I run 'bookkeeper' shell script from parent directory then it is working fine\r\n\r\n~/Workspace/Community/bookkeeper$ ./bin/bookkeeper shell\r\nJAVA_HOME not set, using java from PATH. (/usr/bin/java)\r\nUsage: bookkeeper shell [-localbookie [<host:port>]] [-ledgeridformat <hex/long/uuid>] [-entryformat <hex/string>] [-conf configuration] <command>\r\nwhere command is one of:\r\n...", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"b1d23b483a06f987efab8b794a9e754dc4552542": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-07-17 07:32:38", "url": "https://github.com/apache/bookkeeper/issues/1542", "user": "reddycharan", "ttf": 3.000277777777778}, {"created": "2018-07-12 01:41:04", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "TestLifecycleComponentStack.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.TestLifecycleComponentStack.testSetExceptionHandler()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.TestLifecycleComponentStack.testExceptionHandlerShutdownLifecycleComponentStack()"}]}, {"spoonFilePath": "LifecycleComponentStack.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.LifecycleComponentStack.setExceptionHandler(java.lang.Thread$UncaughtExceptionHandler)"}]}, {"spoonFilePath": "BookieService.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.server.service.BookieService.setExceptionHandler(java.lang.Thread$UncaughtExceptionHandler)"}]}, {"spoonFilePath": "TestComponentStarter.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.TestComponentStarter.testExceptionHandler()"}]}, {"spoonFilePath": "LifecycleComponent.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.setExceptionHandler(java.lang.Thread$UncaughtExceptionHandler)"}]}, {"spoonFilePath": "BookieServer.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieServer.start()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieServer"}, {"INS": 1, "DEL": 2, "TOT": 4, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.proto.BookieServer.DeathWatcher.run()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieServer.setExceptionHandler(java.lang.Thread$UncaughtExceptionHandler)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieServer.DeathWatcher"}]}, {"spoonFilePath": "AbstractLifecycleComponent.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.AbstractLifecycleComponent.setExceptionHandler(java.lang.Thread$UncaughtExceptionHandler)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.AbstractLifecycleComponent"}]}, {"spoonFilePath": "BookieException.java", "spoonMethods": [{"INS": 4, "DEL": 0, "TOT": 5, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieException"}, {"INS": 0, "DEL": 1, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieException.setCode(int)"}]}, {"spoonFilePath": "BookieInitializationTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest.testBookieServiceExceptionHandler()"}]}, {"spoonFilePath": "ComponentStarter.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 4, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.ComponentStarter.startComponent(org.apache.bookkeeper.common.component.LifecycleComponent)"}]}], "nameRev": "50f29ed9425095e2115b7c18518b8e9a81c204e9 tags/release-4.8.1~78", "commitHash": "50f29ed9425095e2115b7c18518b8e9a81c204e9", "commitMessage": "ISSUE #1540: Bookie/BookieServer components shutdown will fail to end exit the BookieProcess\n\nDescriptions of the changes in this PR:\n\n ### Motivation\n\nFixes the issue at #1540.\n\nIf Bookie/BookieServer components are shutdown internally because of any fatal errors\n(ExitCode - INVALID_CONF, SERVER_EXCEPTION, ZK_EXPIRED, ZK_REG_FAIL, BOOKIE_EXCEPTION) then\nit will go through shutdown method logic and shutdowns components internal to Bookie/BookieServer\nbut it will not succeed in bringing down the bookie process.\n\nThis is because in BookieServer.main / server.Main.doMain it would wait for the startComponent\nfuture to complete\nhttp://github.com/apache/bookkeeper/blob/master/bookkeeper-server/src/main/java/org/apache/bookkeeper/server/Main.java#L227 .\nThe startComponent future will be market complete only in runtime shutdownhook -\nhttps://github.com/apache/bookkeeper/blob/master/bookkeeper-common/src/main/java/org/apache/bookkeeper/common/component/ComponentStarter.java#L66.\n\nBut the problem is nowhere in Bookie/BookieProcess shutdown we are calling System.exit() and hence\nthe runtime shutdownhook is not executed to mark the startComponent future to complete. Hence\nMain.doMain will wait forever on this future though Bookie/BookieServer components are shutdown\nbecause of known fatal errors.\n\n ### Regression\n\nIssue #508 introduced this regression. Before this change, the main thread is blocking using `BookieServer#join()`.\nWhen bookie is dead for any reason, the DeathWatchThread will kill the bookie and bookie server. so the main thread will quite.\nHowever after #508 is introduced, the lifecycle management is disconnected from the bookie and bookie server. so when they are dead,\nlifecycle management is unaware of the situation and the main thread doesn't quite.\n\n ### Changes\n\n- Add `UncaughtExceptionHandler` to lifecycle components\n- When a lifecycle component hits an error, it can use `UncaughtExceptionHandler` to notify lifecycle component stack to shutdown the whole stack\n\nMaster Issue: #1540\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Andrey Yegorov <None>, Charan Reddy Guttapalem <reddycharan18@gmail.com>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #1543 from sijie/fix_lifcycle_components, closes #1540\n", "commitGitStats": [{"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-common/src/main/java/org/apache/bookkeeper/common/component/LifecycleComponentStack.java"}, {"lines": 11, "deletions": 0, "insertions": 11, "filePath": "bookkeeper-common/src/main/java/org/apache/bookkeeper/common/component/LifecycleComponent.java"}, {"lines": 34, "deletions": 3, "insertions": 31, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java"}, {"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/server/service/BookieService.java"}, {"lines": 25, "deletions": 0, "insertions": 25, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieInitializationTest.java"}, {"lines": 15, "deletions": 2, "insertions": 13, "filePath": "bookkeeper-common/src/main/java/org/apache/bookkeeper/common/component/ComponentStarter.java"}, {"lines": 57, "deletions": 0, "insertions": 57, "filePath": "bookkeeper-common/src/test/java/org/apache/bookkeeper/common/component/TestLifecycleComponentStack.java"}, {"lines": 32, "deletions": 0, "insertions": 32, "filePath": "bookkeeper-common/src/test/java/org/apache/bookkeeper/common/component/TestComponentStarter.java"}, {"lines": 7, "deletions": 0, "insertions": 7, "filePath": "bookkeeper-common/src/main/java/org/apache/bookkeeper/common/component/AbstractLifecycleComponent.java"}, {"lines": 12, "deletions": 5, "insertions": 7, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieException.java"}], "commitParents": ["424204ebecb8ba2e4856cb2f570f3a8bf1589da8"], "commitDateTime": "2018-07-23 11:02:36", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-07-23 11:02:36"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "TestLifecycleComponentStack.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.TestLifecycleComponentStack.testSetExceptionHandler()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.TestLifecycleComponentStack.testExceptionHandlerShutdownLifecycleComponentStack()"}]}, {"spoonFilePath": "LifecycleComponentStack.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.LifecycleComponentStack.setExceptionHandler(java.lang.Thread$UncaughtExceptionHandler)"}]}, {"spoonFilePath": "BookieService.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.server.service.BookieService.setExceptionHandler(java.lang.Thread$UncaughtExceptionHandler)"}]}, {"spoonFilePath": "TestComponentStarter.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.TestComponentStarter.testExceptionHandler()"}]}, {"spoonFilePath": "LifecycleComponent.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.setExceptionHandler(java.lang.Thread$UncaughtExceptionHandler)"}]}, {"spoonFilePath": "BookieServer.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieServer.start()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieServer"}, {"INS": 1, "DEL": 2, "TOT": 4, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.proto.BookieServer.DeathWatcher.run()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieServer.setExceptionHandler(java.lang.Thread$UncaughtExceptionHandler)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieServer.DeathWatcher"}]}, {"spoonFilePath": "AbstractLifecycleComponent.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.AbstractLifecycleComponent.setExceptionHandler(java.lang.Thread$UncaughtExceptionHandler)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.AbstractLifecycleComponent"}]}, {"spoonFilePath": "BookieException.java", "spoonMethods": [{"INS": 4, "DEL": 0, "TOT": 5, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieException"}, {"INS": 0, "DEL": 1, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieException.setCode(int)"}]}, {"spoonFilePath": "BookieInitializationTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest.testBookieServiceExceptionHandler()"}]}, {"spoonFilePath": "ComponentStarter.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 4, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.ComponentStarter.startComponent(org.apache.bookkeeper.common.component.LifecycleComponent)"}]}], "nameRev": "5eacab950dc6d6dca0ea9b8137dbbe7be3bbcff5 tags/release-4.7.2~14", "commitHash": "5eacab950dc6d6dca0ea9b8137dbbe7be3bbcff5", "commitMessage": "ISSUE #1540: Bookie/BookieServer components shutdown will fail to end exit the BookieProcess\n\nDescriptions of the changes in this PR:\n\n ### Motivation\n\nFixes the issue at #1540.\n\nIf Bookie/BookieServer components are shutdown internally because of any fatal errors\n(ExitCode - INVALID_CONF, SERVER_EXCEPTION, ZK_EXPIRED, ZK_REG_FAIL, BOOKIE_EXCEPTION) then\nit will go through shutdown method logic and shutdowns components internal to Bookie/BookieServer\nbut it will not succeed in bringing down the bookie process.\n\nThis is because in BookieServer.main / server.Main.doMain it would wait for the startComponent\nfuture to complete\nhttp://github.com/apache/bookkeeper/blob/master/bookkeeper-server/src/main/java/org/apache/bookkeeper/server/Main.java#L227 .\nThe startComponent future will be market complete only in runtime shutdownhook -\nhttps://github.com/apache/bookkeeper/blob/master/bookkeeper-common/src/main/java/org/apache/bookkeeper/common/component/ComponentStarter.java#L66.\n\nBut the problem is nowhere in Bookie/BookieProcess shutdown we are calling System.exit() and hence\nthe runtime shutdownhook is not executed to mark the startComponent future to complete. Hence\nMain.doMain will wait forever on this future though Bookie/BookieServer components are shutdown\nbecause of known fatal errors.\n\n ### Regression\n\nIssue #508 introduced this regression. Before this change, the main thread is blocking using `BookieServer#join()`.\nWhen bookie is dead for any reason, the DeathWatchThread will kill the bookie and bookie server. so the main thread will quite.\nHowever after #508 is introduced, the lifecycle management is disconnected from the bookie and bookie server. so when they are dead,\nlifecycle management is unaware of the situation and the main thread doesn't quite.\n\n ### Changes\n\n- Add `UncaughtExceptionHandler` to lifecycle components\n- When a lifecycle component hits an error, it can use `UncaughtExceptionHandler` to notify lifecycle component stack to shutdown the whole stack\n\nMaster Issue: #1540\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Andrey Yegorov <None>, Charan Reddy Guttapalem <reddycharan18@gmail.com>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #1543 from sijie/fix_lifcycle_components, closes #1540\n\n(cherry picked from commit 50f29ed9425095e2115b7c18518b8e9a81c204e9)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-common/src/main/java/org/apache/bookkeeper/common/component/LifecycleComponentStack.java"}, {"lines": 11, "deletions": 0, "insertions": 11, "filePath": "bookkeeper-common/src/main/java/org/apache/bookkeeper/common/component/LifecycleComponent.java"}, {"lines": 34, "deletions": 3, "insertions": 31, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java"}, {"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/server/service/BookieService.java"}, {"lines": 25, "deletions": 0, "insertions": 25, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieInitializationTest.java"}, {"lines": 15, "deletions": 2, "insertions": 13, "filePath": "bookkeeper-common/src/main/java/org/apache/bookkeeper/common/component/ComponentStarter.java"}, {"lines": 57, "deletions": 0, "insertions": 57, "filePath": "bookkeeper-common/src/test/java/org/apache/bookkeeper/common/component/TestLifecycleComponentStack.java"}, {"lines": 32, "deletions": 0, "insertions": 32, "filePath": "bookkeeper-common/src/test/java/org/apache/bookkeeper/common/component/TestComponentStarter.java"}, {"lines": 7, "deletions": 0, "insertions": 7, "filePath": "bookkeeper-common/src/main/java/org/apache/bookkeeper/common/component/AbstractLifecycleComponent.java"}, {"lines": 12, "deletions": 5, "insertions": 7, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieException.java"}], "commitParents": ["21c8ccf11a0e5213d1d35d45fc4dfab1f5c37878"], "commitDateTime": "2018-07-23 11:02:51", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-07-23 11:02:36"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "release/4.7.2", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Bookie/BookieServer components shutdown will fail to end/exit the BookieProcess", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\nIf Bookie/BookieServer components are shutdown internally because of any fatal errors (ExitCode - INVALID_CONF, SERVER_EXCEPTION, ZK_EXPIRED, ZK_REG_FAIL, BOOKIE_EXCEPTION) then it will go through shutdown method logic and shutdowns components internal to Bookie/BookieServer but it will not succeed in bringing down the bookie process. \r\n\r\nThis is because in BookieServer.main / server.Main.doMain it would wait for the startComponent future to complete http://github.com/apache/bookkeeper/blob/master/bookkeeper-server/src/main/java/org/apache/bookkeeper/server/Main.java#L227 .  The startComponent future will be market complete only in runtime shutdownhook - https://github.com/apache/bookkeeper/blob/master/bookkeeper-common/src/main/java/org/apache/bookkeeper/common/component/ComponentStarter.java#L66. \r\n\r\nBut the problem is nowhere in Bookie/BookieProcess shutdown we are calling System.exit() and hence the runtime shutdownhook is not executed to mark the startComponent future to complete. Hence Main.doMain will wait forever on this future though Bookie/BookieServer components are shutdown because of known fatal errors.\r\n\r\nFollowing is the thread callstacktrace of main method which is waiting forever\r\n(line numbers might not match, since we are using little older code)\r\n\r\nmain - priority:5 - threadId:0x00007fd60000d000 - nativeId:0x2d37b - state:WAITING\r\nstackTrace:\r\njava.lang.Thread.State: WAITING (parking)\r\nat sun.misc.Unsafe.park(Native Method)\r\n- parking to wait for <0x00007fcddf015af0> (a java.util.concurrent.CompletableFuture$Signaller)\r\nat java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\r\nat java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1693)\r\nat java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3323)\r\nat java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1729)\r\nat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)\r\nat org.apache.bookkeeper.server.Main.doMain(Main.java:215)\r\nat org.apache.bookkeeper.server.Main.main(Main.java:189)\r\nat org.apache.bookkeeper.proto.BookieServer.main(BookieServer.java:256)\r\n\r\nNote: This is regression bug, which must be introduced with lifecycle components introduction.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"50f29ed9425095e2115b7c18518b8e9a81c204e9": {"commitUser": "sijie", "commitGHEventType": "closed"}, "5eacab950dc6d6dca0ea9b8137dbbe7be3bbcff5": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-07-23 18:02:47", "url": "https://github.com/apache/bookkeeper/issues/1540", "user": "reddycharan", "ttf": 11.000277777777777}, {"created": "2018-07-09 21:31:22", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "NullHttpService.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.http.service.NullHttpService.handle(org.apache.bookkeeper.http.service.HttpServiceRequest)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.service.NullHttpService"}]}, {"spoonFilePath": "HttpRouter.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.HttpRouter"}]}, {"spoonFilePath": "TestVertxHttpServer.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.TestVertxHttpServer.testStartMetricsServiceOnRouterPath()"}]}], "nameRev": "cae44b4e858922b2a3fa95f4004be7a044394d5d tags/release-4.7.3~5", "commitHash": "cae44b4e858922b2a3fa95f4004be7a044394d5d", "commitMessage": "ISSUE #1538: Expose MetricsServer in http server\n\nDescriptions of the changes in this PR:\n\nExpose MetricsServer in  http server under `/metrics`\n\nAuthor: Jia Zhai <zhaijia@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1546 from jiazhai/issue_1538, closes #1538\n", "commitGitStats": [{"lines": 15, "deletions": 0, "insertions": 15, "filePath": "bookkeeper-http/vertx-http-server/src/test/java/org/apache/bookkeeper/http/vertx/TestVertxHttpServer.java"}, {"lines": 13, "deletions": 0, "insertions": 13, "filePath": "site/docs/latest/admin/http.md"}, {"lines": 8, "deletions": 2, "insertions": 6, "filePath": "bookkeeper-http/http-server/src/main/java/org/apache/bookkeeper/http/service/NullHttpService.java"}, {"lines": 120, "deletions": 59, "insertions": 61, "filePath": "bookkeeper-http/http-server/src/main/java/org/apache/bookkeeper/http/HttpRouter.java"}], "commitParents": ["8189fb09db37378b74348e82ec2881fe376c417c"], "commitDateTime": "2018-11-26 11:52:38", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-07-24 14:06:08"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "NullHttpService.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.http.service.NullHttpService.handle(org.apache.bookkeeper.http.service.HttpServiceRequest)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.service.NullHttpService"}]}, {"spoonFilePath": "HttpRouter.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.HttpRouter"}]}, {"spoonFilePath": "TestVertxHttpServer.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.http.vertx.TestVertxHttpServer.testStartMetricsServiceOnRouterPath()"}]}], "nameRev": "16553057b0ddba53ac169c4fef81336e2bd26116 tags/release-4.8.1~71", "commitHash": "16553057b0ddba53ac169c4fef81336e2bd26116", "commitMessage": "ISSUE #1538: Expose MetricsServer in http server\n\nDescriptions of the changes in this PR:\n\nExpose MetricsServer in  http server under `/metrics`\n\nAuthor: Jia Zhai <zhaijia@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #1546 from jiazhai/issue_1538, closes #1538\n", "commitGitStats": [{"lines": 15, "deletions": 0, "insertions": 15, "filePath": "bookkeeper-http/vertx-http-server/src/test/java/org/apache/bookkeeper/http/vertx/TestVertxHttpServer.java"}, {"lines": 13, "deletions": 0, "insertions": 13, "filePath": "site/docs/latest/admin/http.md"}, {"lines": 8, "deletions": 2, "insertions": 6, "filePath": "bookkeeper-http/http-server/src/main/java/org/apache/bookkeeper/http/service/NullHttpService.java"}, {"lines": 120, "deletions": 59, "insertions": 61, "filePath": "bookkeeper-http/http-server/src/main/java/org/apache/bookkeeper/http/HttpRouter.java"}], "commitParents": ["d3e9d56c18df337fa22da47aa8458bde5b74d141"], "commitDateTime": "2018-07-24 14:06:08", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-07-24 14:06:08"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/http", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Stats are not exposed to http server when httpServer is enabled", "numCommits": 0, "body": "\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nenable httpServer and use Prometheus stats provider.\r\n\r\n- What did you expect to see?\r\n\r\nthe prometheus stats is exposed in the http server under `/metrics`\r\n\r\n- What did you see instead?\r\n\r\n\"Resource not found\"\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"cae44b4e858922b2a3fa95f4004be7a044394d5d": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "16553057b0ddba53ac169c4fef81336e2bd26116": {"commitUser": "eolivelli", "commitGHEventType": "closed"}}, "closed": "2018-07-24 12:06:15", "url": "https://github.com/apache/bookkeeper/issues/1538", "user": "sijie", "ttf": 14.000277777777777}, {"created": "2018-07-09 20:30:15", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "1760c0590b6ed775ca55911f4e2a177234c59cc7 tags/release-4.8.1~87", "commitHash": "1760c0590b6ed775ca55911f4e2a177234c59cc7", "commitMessage": "ISSUE #1537: fix distributedlog incubator link\n\nDescriptions of the changes in this PR:\n### Motivation\n\nIn bookkeeper website, we are still using incubator locations for dlog references. we should change it to http://bookkeeper.apache.org/distributedlog\n\n### Changes\nchange links from\n`https://distributedlog.incubator.apache.org`\nto\n`https://bookkeeper.apache.org/distributedlog`\n\nMaster Issue: #1537\n\nAuthor: Jia Zhai <zhaijia@apache.org>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #1545 from jiazhai/issue_1537, closes #1537\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/docs/4.5.1/api/distributedlog-api.md"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/docs/latest/api/distributedlog-api.md"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/docs/4.5.0/overview/releaseNotes.md"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/docs/4.6.0/api/distributedlog-api.md"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/docs/4.6.2/api/distributedlog-api.md"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/docs/4.6.1/api/distributedlog-api.md"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/docs/4.7.0/api/distributedlog-api.md"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/docs/4.5.0/api/distributedlog-api.md"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/docs/4.7.1/api/distributedlog-api.md"}], "commitParents": ["b1d23b483a06f987efab8b794a9e754dc4552542"], "commitDateTime": "2018-07-17 00:34:27", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-07-17 00:34:27"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/website", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "distributedlog links still point to incubator location", "numCommits": 0, "body": "*Problem*\r\n\r\nin bookkeeper website, we are still using incubator locations for dlog references. we should change it to http://bookkeeper.apache.org/distributedlog", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"1760c0590b6ed775ca55911f4e2a177234c59cc7": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-07-17 07:34:35", "url": "https://github.com/apache/bookkeeper/issues/1537", "user": "sijie", "ttf": 7.000277777777778}, {"created": "2018-07-05 22:49:56", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "EntryLogCompactor.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.EntryLogCompactor.CompactionScannerFactory.flush()"}]}, {"spoonFilePath": "CompactionTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testCompactionPersistence()"}, {"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.prepareData(int,boolean)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.verifyLedger(long,long,long)"}]}], "nameRev": "7a2e73177d3147221a0992455a9b73049d9a5447 tags/release-4.8.1~86", "commitHash": "7a2e73177d3147221a0992455a9b73049d9a5447", "commitMessage": "ISSUE #1534: LedgerCache should be flushed\n\nDescriptions of the changes in this PR:\n\n### Motivation\n\nEntryLogComparator.CompactionScannerFactory.flush just calls \"ledgerStorage.updateEntriesLocations(offsets);\" but not \"ledgerStorage.flushEntriesLocationsIndex()\".\n\nBecause of this, EntryLogCompactor.compact method would remove compacted entryLog without updated offsets/locations getting flushed/persisted/fsynced to LedgerCache (Index/FileInfo files). This could lead to data corruption/loss if Bookie is broughtdown/killed before those updated offsets/locations are flushed/persisted/fsynced.\n### Changes\n\nIn EntryLogComparator, before removing compacted entryLog, LedgerCache (IndexInMemPageMgr and Index files) should be flushed, just like EntryLogger.\n\nMaster Issue: #1534\n\nAuthor: cguttapalem <cguttapalem@salesforce.com>\n\nReviewers: Matteo Merli <mmerli@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #1536 from reddycharan/compactfix, closes #1534\n", "commitGitStats": [{"lines": 1, "deletions": 0, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/EntryLogCompactor.java"}, {"lines": 93, "deletions": 3, "insertions": 90, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/CompactionTest.java"}], "commitParents": ["1760c0590b6ed775ca55911f4e2a177234c59cc7"], "commitDateTime": "2018-07-17 00:36:30", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-07-17 00:36:30"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "priority/important", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Absence of flushEntriesLocationsIndex in EntryLogCompactor can lead to data corruption/loss ", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\nEntryLogComparator.CompactionScannerFactory.flush just calls \"ledgerStorage.updateEntriesLocations(offsets);\" instead of \"ledgerStorage.flushEntriesLocationsIndex()\". \r\n\r\nThis was broken with this change - https://github.com/apache/bookkeeper/commit/d32010f5fcc6a040a56dc8b983cc14d107cff2df#diff-ca4e05e22214ba76f892216124975514L203.\r\n\r\nBecause of this, EntryLogCompactor.compact method would remove compacted entryLog without updated offsets/locations getting flushed/persisted/fsynced to LedgerCache (Index/FileInfo files). This could lead to data corruption/loss if Bookie is broughtdown/killed before those updated offsets/locations are flushed/persisted/fsynced.\r\n\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"7a2e73177d3147221a0992455a9b73049d9a5447": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-07-17 07:36:39", "url": "https://github.com/apache/bookkeeper/issues/1534", "user": "reddycharan", "ttf": 11.000277777777777}, {"created": "2018-06-06 20:13:49", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "77202f3f618d44a9c9e626d6168ed3736e54d635 tags/release-4.7.1~10", "commitHash": "77202f3f618d44a9c9e626d6168ed3736e54d635", "commitMessage": "ISSUE #1491: fix GLIBC_2.14 dep issue for protoc-3.5.1-linux-x86_64\n\nDescriptions of the changes in this PR:\n\nI tried to build the bookkeeper branch-4.7 on RHEL6 and ran into:\n\n```\n /lib64/libc.so.6: version `GLIBC_2.14' not found (required by bookkeeper-proto/target/protoc-plugins/protoc-3.5.1-linux-x86_64.exe)\n```\nThis is similar to google/protobuf#4109 and it's related to google/protobuf#4138\n\nWe can take advantage of pulsar's fix apache/incubator-pulsar#1914 here\n\nMaster Issue:  https://github.com/apache/bookkeeper/issues/1491\n\nAuthor: Ethan Li <ethanopensource@gmail.com>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>, Sijie Guo <sijie@apache.org>\n\nThis closes #1492 from Ethanlm/ISSUE-1491, closes #1491\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-proto/pom.xml"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/statelib/pom.xml"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/tests-common/pom.xml"}, {"lines": 1, "deletions": 0, "insertions": 1, "filePath": "pom.xml"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/proto/pom.xml"}], "commitParents": ["50761a9fd9a313d4436dff2883f47f3ab3cefeea"], "commitDateTime": "2018-06-06 23:06:23", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-06-06 23:06:23"}, {"commitSpoonAstDiffStats": [], "nameRev": "dc30f4938664cbfe07f061e35007c37871ad6b28 tags/release-4.8.1~115", "commitHash": "dc30f4938664cbfe07f061e35007c37871ad6b28", "commitMessage": "ISSUE #1491: fix GLIBC_2.14 dep issue for protoc-3.5.1-linux-x86_64\n\nDescriptions of the changes in this PR:\n\nI tried to build the bookkeeper branch-4.7 on RHEL6 and ran into:\n\n```\n /lib64/libc.so.6: version `GLIBC_2.14' not found (required by bookkeeper-proto/target/protoc-plugins/protoc-3.5.1-linux-x86_64.exe)\n```\nThis is similar to google/protobuf#4109 and it's related to google/protobuf#4138\n\nWe can take advantage of pulsar's fix apache/incubator-pulsar#1914 here\n\nMaster Issue:  https://github.com/apache/bookkeeper/issues/1491\n\nAuthor: Ethan Li <ethanopensource@gmail.com>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>, Sijie Guo <sijie@apache.org>\n\nThis closes #1492 from Ethanlm/ISSUE-1491, closes #1491\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-proto/pom.xml"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/statelib/pom.xml"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/tests-common/pom.xml"}, {"lines": 1, "deletions": 0, "insertions": 1, "filePath": "pom.xml"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/proto/pom.xml"}], "commitParents": ["b8a5289a968e4afca2b7ef557fd978234c162b2f"], "commitDateTime": "2018-06-06 23:07:04", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-06-06 23:06:23"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "release/4.7.1", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": " GLIBC_2.14 dep issue for protoc-3.5.1-linux-x86_64", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\nI tried to build the bookkeeper branch-4.7 on RHEL6 and ran into:\r\n```\r\n /lib64/libc.so.6: version `GLIBC_2.14' not found (required by bookkeeper-proto/target/protoc-plugins/protoc-3.5.1-linux-x86_64.exe)\r\n```\r\nThis is similar to https://github.com/google/protobuf/issues/4109 and it's related to https://github.com/google/protobuf/issues/4138\r\n\r\nWe can take advantage of pulsar's fix https://github.com/apache/incubator-pulsar/pull/1914 here\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"77202f3f618d44a9c9e626d6168ed3736e54d635": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "dc30f4938664cbfe07f061e35007c37871ad6b28": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-06-07 06:07:28", "url": "https://github.com/apache/bookkeeper/issues/1491", "user": "Ethanlm", "ttf": 0.0002777777777777778}, {"created": "2018-06-06 17:58:57", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BookieJournalForceTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieJournalForceTest.testAckBeforeSyncWithJournalBufferedEntriesThreshold()"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieJournalForceTest.testAckAfterSync()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieJournalForceTest.testForceLedger()"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieJournalForceTest.testAckBeforeSync()"}]}], "nameRev": "7b04ce80fd56250afa37efcb60b61a1bf235256a tags/release-4.8.1~104", "commitHash": "7b04ce80fd56250afa37efcb60b61a1bf235256a", "commitMessage": "ISSUE #1490: BookieJournalForceTest is flaky\n\nDescriptions of the changes in this PR:\n\n### Motivation\n\nThe test cases in BookieJournalForceTest check if the forceWriteQueue is empty after everything is flushed.\nHowever if `adaptiveGroupWrites` is enabled, the forceWrite thread will insert a marker entry into force write queue,\nthis will fail the forceWriteQueue length checking.\n\n### Changes\n\nDisable `adaptiveGroupWrites` in BookieJournalForceTest\n\nMaster Issue: #1490\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #1512 from sijie/fix_journalforcetest, closes #1490\n", "commitGitStats": [{"lines": 10, "deletions": 3, "insertions": 7, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieJournalForceTest.java"}], "commitParents": ["b65fa438d6212eb4a89a848b4f2642ba2ad573da"], "commitDateTime": "2018-06-12 19:29:15", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-06-12 19:29:15"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "BookieJournalForceTest is flaky", "numCommits": 0, "body": "*Problem*\r\n\r\n```\r\n2018-06-06\\T\\08:03:29.167 [ERROR] testForceLedger(org.apache.bookkeeper.bookie.BookieJournalForceTest)  Time elapsed: 0.263 s  <<< FAILURE!\r\njava.lang.AssertionError: expected:<0> but was:<1>\r\n\tat org.apache.bookkeeper.bookie.BookieJournalForceTest.testForceLedger(BookieJournalForceTest.java:367)\r\n\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"7b04ce80fd56250afa37efcb60b61a1bf235256a": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-06-13 02:29:26", "url": "https://github.com/apache/bookkeeper/issues/1490", "user": "sijie", "ttf": 6.000277777777778}, {"created": "2018-06-06 09:50:43", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "SingleDirectoryDbLedgerStorage.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.storage.ldb.SingleDirectoryDbLedgerStorage.fillReadAheadCache(long,long,long)"}]}], "nameRev": "e35a679316c50f7e7ec69a528734d7d75ef340d2 tags/release-4.7.1~9", "commitHash": "e35a679316c50f7e7ec69a528734d7d75ef340d2", "commitMessage": "[BOOKIE] [DBLEDGERSTORAGE] fix illegal reference count exception on filling read cache\n\nDescriptions of the changes in this PR:\n\n*Problem*\n\nByteBuf is released at a finally block. DbLedgerStorage doesn't have to release it on return. If it does so, that will cause\ndouble-release and it will throw IllegalReferenceCountException.\n\n*Solution*\n\nRemove `ByteBuf.release` at return.\n\nRelated Issue: #1487\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>, Matteo Merli <mmerli@apache.org>\n\nThis closes #1488 from sijie/fix_double_release_on_db_ledgerstorage\n\n(cherry picked from commit 4764c7637ecdcadfaddac74244d5c78449589c07)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 1, "deletions": 1, "insertions": 0, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/storage/ldb/SingleDirectoryDbLedgerStorage.java"}], "commitParents": ["77202f3f618d44a9c9e626d6168ed3736e54d635"], "commitDateTime": "2018-06-06 23:20:51", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-06-06 23:20:38"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "SingleDirectoryDbLedgerStorage.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.storage.ldb.SingleDirectoryDbLedgerStorage.fillReadAheadCache(long,long,long)"}]}], "nameRev": "4764c7637ecdcadfaddac74244d5c78449589c07 tags/release-4.8.1~112", "commitHash": "4764c7637ecdcadfaddac74244d5c78449589c07", "commitMessage": "[BOOKIE] [DBLEDGERSTORAGE] fix illegal reference count exception on filling read cache\n\nDescriptions of the changes in this PR:\n\n*Problem*\n\nByteBuf is released at a finally block. DbLedgerStorage doesn't have to release it on return. If it does so, that will cause\ndouble-release and it will throw IllegalReferenceCountException.\n\n*Solution*\n\nRemove `ByteBuf.release` at return.\n\nRelated Issue: #1487\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>, Matteo Merli <mmerli@apache.org>\n\nThis closes #1488 from sijie/fix_double_release_on_db_ledgerstorage\n", "commitGitStats": [{"lines": 1, "deletions": 1, "insertions": 0, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/storage/ldb/SingleDirectoryDbLedgerStorage.java"}], "commitParents": ["2b66cb16d6f6a16c556ac304d3337a74f99a95df"], "commitDateTime": "2018-06-06 23:20:38", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-06-06 23:20:38"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "release/4.7.1", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "[DbLedgerStorage] IllegalReferenceCount on filling readahead cache", "numCommits": 0, "body": "*Problem*\r\n\r\nRunning pulsar standalone with bookkeeper master. \r\n\r\n```\r\n02:45:55.430 [BookieReadThreadPool-OrderedExecutor-3-0] DEBUG org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage - Ledger exists. ledger: 19 : true\r\n02:45:55.431 [BookieReadThreadPool-OrderedExecutor-3-0] DEBUG org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage - Get Entry: 19@0\r\n02:45:55.431 [BookieReadThreadPool-OrderedExecutor-3-0] DEBUG org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage - Exception during read ahead for ledger: 19: e\r\nio.netty.util.IllegalReferenceCountException: refCnt: 0, increment: 1\r\n        at io.netty.buffer.AbstractReferenceCountedByteBuf.release0(AbstractReferenceCountedByteBuf.java:100) ~[netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:84) ~[netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at org.apache.bookkeeper.bookie.storage.ldb.SingleDirectoryDbLedgerStorage.fillReadAheadCache(SingleDirectoryDbLedgerStorage.java:537) [bookkeeper-server-4.8.0-SNAPSHOT.jar:4.8.0-SNAPSHOT]\r\n        at org.apache.bookkeeper.bookie.storage.ldb.SingleDirectoryDbLedgerStorage.getEntry(SingleDirectoryDbLedgerStorage.java:500) [bookkeeper-server-4.8.0-SNAPSHOT.jar:4.8.0-SNAPSHOT]\r\n        at org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage.getEntry(DbLedgerStorage.java:222) [bookkeeper-server-4.8.0-SNAPSHOT.jar:4.8.0-SNAPSHOT]\r\n        at org.apache.bookkeeper.bookie.LedgerDescriptorImpl.readEntry(LedgerDescriptorImpl.java:153) [bookkeeper-server-4.8.0-SNAPSHOT.jar:4.8.0-SNAPSHOT]\r\n        at org.apache.bookkeeper.bookie.Bookie.readEntry(Bookie.java:1302) [bookkeeper-server-4.8.0-SNAPSHOT.jar:4.8.0-SNAPSHOT]\r\n        at org.apache.bookkeeper.proto.ReadEntryProcessorV3.readEntry(ReadEntryProcessorV3.java:177) [bookkeeper-server-4.8.0-SNAPSHOT.jar:4.8.0-SNAPSHOT]\r\n        at org.apache.bookkeeper.proto.ReadEntryProcessorV3.readEntry(ReadEntryProcessorV3.java:157) [bookkeeper-server-4.8.0-SNAPSHOT.jar:4.8.0-SNAPSHOT]\r\n        at org.apache.bookkeeper.proto.ReadEntryProcessorV3.getReadResponse(ReadEntryProcessorV3.java:220) [bookkeeper-server-4.8.0-SNAPSHOT.jar:4.8.0-SNAPSHOT]\r\n        at org.apache.bookkeeper.proto.ReadEntryProcessorV3.executeOp(ReadEntryProcessorV3.java:263) [bookkeeper-server-4.8.0-SNAPSHOT.jar:4.8.0-SNAPSHOT]\r\n        at org.apache.bookkeeper.proto.ReadEntryProcessorV3.safeRun(ReadEntryProcessorV3.java:259) [bookkeeper-server-4.8.0-SNAPSHOT.jar:4.8.0-SNAPSHOT]\r\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) [bookkeeper-common-4.8.0-SNAPSHOT.jar:4.8.0-SNAPSHOT]\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_144]\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_144]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [netty-all-4.1.22.Final.jar:4.1.22.Final]\r\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_144]\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"e35a679316c50f7e7ec69a528734d7d75ef340d2": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "4764c7637ecdcadfaddac74244d5c78449589c07": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-06-11 17:40:26", "url": "https://github.com/apache/bookkeeper/issues/1487", "user": "sijie", "ttf": 5.000277777777778}, {"created": "2018-06-04 10:05:50", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "c7b1610bb0dac9d46b80e5f607248b9b391ec267 tags/release-4.7.1~5", "commitHash": "c7b1610bb0dac9d46b80e5f607248b9b391ec267", "commitMessage": "ISSUE #1476: LedgerEntry is recycled twice at ReadLastConfirmedAndEntryOp\n\nDescriptions of the changes in this PR:\n\nThe issue #1476 is caused by peculative reads with object recycling, same request object will be added to the CompletionObjects multiple times with different txnid.  In fact the logic of process the request already take this into account, only on place inside `ReadLastConfirmedAndEntryOp.requestComplete` forget to check requestComplete before calling `submitCallback` which in turn call request.close.\n\n### Motivation\n\nto fix #1476\n\n### Changes\n\ncheck `requestComplete` before `submitCallback` in `ReadLastConfirmedAndEntryOp.requestComplete`\n\nMaster Issue: #1476\n\nAuthor: Sijie Guo <sijie@apache.org>\nAuthor: infodog <infodog@hotmail.com>\nAuthor: zhengxiangyang <zxy@xinshi.net>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #1509 from infodog/issue1476, closes #1476\n\n(cherry picked from commit 6476fc323fffd328ed9620d9aa39c4c232f8d2be)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 4, "deletions": 0, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java"}, {"lines": 14, "deletions": 5, "insertions": 9, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/impl/LastConfirmedAndEntryImpl.java"}, {"lines": 252, "deletions": 0, "insertions": 252, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/ReadLastConfirmedAndEntryOpTest.java"}, {"lines": 52, "deletions": 24, "insertions": 28, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedAndEntryOp.java"}], "commitParents": ["0cea52e75e669daae72407ef50e52ad7506bffc9"], "commitDateTime": "2018-06-14 02:13:40", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "tooManyChanges", "authoredDateTime": "2018-06-14 02:13:22"}, {"commitSpoonAstDiffStats": [], "nameRev": "6476fc323fffd328ed9620d9aa39c4c232f8d2be tags/release-4.8.1~100", "commitHash": "6476fc323fffd328ed9620d9aa39c4c232f8d2be", "commitMessage": "ISSUE #1476: LedgerEntry is recycled twice at ReadLastConfirmedAndEntryOp\n\nDescriptions of the changes in this PR:\n\nThe issue #1476 is caused by peculative reads with object recycling, same request object will be added to the CompletionObjects multiple times with different txnid.  In fact the logic of process the request already take this into account, only on place inside `ReadLastConfirmedAndEntryOp.requestComplete` forget to check requestComplete before calling `submitCallback` which in turn call request.close.\n\n### Motivation\n\nto fix #1476\n\n### Changes\n\ncheck `requestComplete` before `submitCallback` in `ReadLastConfirmedAndEntryOp.requestComplete`\n\nMaster Issue: #1476\n\nAuthor: Sijie Guo <sijie@apache.org>\nAuthor: infodog <infodog@hotmail.com>\nAuthor: zhengxiangyang <zxy@xinshi.net>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #1509 from infodog/issue1476, closes #1476\n", "commitGitStats": [{"lines": 4, "deletions": 0, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java"}, {"lines": 14, "deletions": 5, "insertions": 9, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/impl/LastConfirmedAndEntryImpl.java"}, {"lines": 252, "deletions": 0, "insertions": 252, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/ReadLastConfirmedAndEntryOpTest.java"}, {"lines": 52, "deletions": 24, "insertions": 28, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedAndEntryOp.java"}], "commitParents": ["134a6c25a846731dc2ad0dc6c3e848170557b7b9"], "commitDateTime": "2018-06-14 02:13:22", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "tooManyChanges", "authoredDateTime": "2018-06-14 02:13:22"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "priority/blocker", "release/4.7.1", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "recycle already.", "numCommits": 0, "body": "bookkeeper 4.7, when using distributed log api, got the following error:\r\n\r\n [BookKeeperClientWorker-OrderedExecutor-0-0] ERROR org.apache.bookkeeper.common.util.SafeRunnable - Unexpected throwable caught \r\njava.lang.IllegalStateException: recycled already\r\n\tat io.netty.util.Recycler$Stack.pushNow(Recycler.java:560)\r\n\tat io.netty.util.Recycler$Stack.push(Recycler.java:550)\r\n\tat io.netty.util.Recycler$DefaultHandle.recycle(Recycler.java:209)\r\n\tat org.apache.bookkeeper.client.impl.LedgerEntryImpl.recycle(LedgerEntryImpl.java:163)\r\n\tat org.apache.bookkeeper.client.impl.LedgerEntryImpl.close(LedgerEntryImpl.java:154)\r\n\tat org.apache.bookkeeper.client.ReadLastConfirmedAndEntryOp$ReadLACAndEntryRequest.close(ReadLastConfirmedAndEntryOp.java:94)\r\n\tat org.apache.bookkeeper.client.ReadLastConfirmedAndEntryOp.submitCallback(ReadLastConfirmedAndEntryOp.java:530)\r\n\tat org.apache.bookkeeper.client.ReadLastConfirmedAndEntryOp.readEntryComplete(ReadLastConfirmedAndEntryOp.java:568)\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion$1.readEntryComplete(PerChannelBookieClient.java:1559)\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion.handleReadResponse(PerChannelBookieClient.java:1640)\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion.handleV3Response(PerChannelBookieClient.java:1615)\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$3.safeRun(PerChannelBookieClient.java:1232)\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.java:138)\r\n\tat java.lang.Thread.run(Thread.java:745)", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"c7b1610bb0dac9d46b80e5f607248b9b391ec267": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "6476fc323fffd328ed9620d9aa39c4c232f8d2be": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-06-14 09:13:33", "url": "https://github.com/apache/bookkeeper/issues/1476", "user": "infodog", "ttf": 9.000277777777777}, {"created": "2018-06-04 02:04:23", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "TestStorageClientBuilder.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.clients.TestStorageClientBuilder.testBuildClientInvalidNamespaceName()"}]}], "nameRev": "0cb9de02c3734f7811c0b36e32e612542533791a tags/release-4.8.1~133", "commitHash": "0cb9de02c3734f7811c0b36e32e612542533791a", "commitMessage": "ISSUE #1472: [TABLE SERVICE] TestStorageClientBuilder.testBuildClientInvalidNamespaceName failed\n\nDescriptions of the changes in this PR:\n\n*Problem*\n\n #1457 changed the validation of namespace/stream name. so \"-\" is a valid character.\n\n*Solution*\n\nFix the test.\n\nMaster Issue: #1472\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>\n\nThis closes #1473 from sijie/fix_storage_client_builder, closes #1472\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/clients/java/all/src/test/java/org/apache/bookkeeper/clients/TestStorageClientBuilder.java"}], "commitParents": ["9472596792932cb785ac842544b45cc45bcf6578"], "commitDateTime": "2018-06-04 00:57:09", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-06-04 00:57:09"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "TestStorageClientBuilder.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.clients.TestStorageClientBuilder.testBuildClientInvalidNamespaceName()"}]}], "nameRev": "96d599e5ee1c304e73591225297066af35553df7 tags/release-4.7.1~15", "commitHash": "96d599e5ee1c304e73591225297066af35553df7", "commitMessage": "ISSUE #1472: [TABLE SERVICE] TestStorageClientBuilder.testBuildClientInvalidNamespaceName failed\n\nDescriptions of the changes in this PR:\n\n*Problem*\n\n #1457 changed the validation of namespace/stream name. so \"-\" is a valid character.\n\n*Solution*\n\nFix the test.\n\nMaster Issue: #1472\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>\n\nThis closes #1473 from sijie/fix_storage_client_builder, closes #1472\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/clients/java/all/src/test/java/org/apache/bookkeeper/clients/TestStorageClientBuilder.java"}], "commitParents": ["87f965587dc1df0b6f3877a037e5c120d1ec9c4a"], "commitDateTime": "2018-06-04 15:02:31", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-06-04 00:57:09"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tableservice", "area/tests", "release/4.7.1", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "TestStorageClientBuilder.testBuildClientInvalidNamespaceName", "numCommits": 0, "body": "\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nCI runs postcommit jobs\r\n\r\n- What did you expect to see?\r\n\r\nCI should pass\r\n\r\n- What did you see instead?\r\n\r\n```\r\nError Message\r\nExpected exception: java.lang.IllegalArgumentException\r\nStacktrace\r\njava.lang.AssertionError: Expected exception: java.lang.IllegalArgumentException\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"0cb9de02c3734f7811c0b36e32e612542533791a": {"commitUser": "sijie", "commitGHEventType": "closed"}, "96d599e5ee1c304e73591225297066af35553df7": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-06-04 07:57:21", "url": "https://github.com/apache/bookkeeper/issues/1472", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2018-06-02 00:11:15", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "9472596792932cb785ac842544b45cc45bcf6578 tags/release-4.8.1~134", "commitHash": "9472596792932cb785ac842544b45cc45bcf6578", "commitMessage": "Issue #1467: build failing with MavenReportException: Error while generating Javadoc. (#1468)\n\n", "commitGitStats": [{"lines": 1, "deletions": 0, "insertions": 1, "filePath": "pom.xml"}], "commitParents": ["319f761ca1769d0b35aa70c99b3a1ea8795acaf8"], "commitDateTime": "2018-06-01 22:08:46", "commitUser": "dlg99", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-06-01 22:08:46"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "MavenReportException: Error while generating Javadoc\" while building master", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\npulled master locally and ran \"mvn clean apache-rat:check install spotbugs:check -Dstream -DskipTests\"\r\nBuild failed with \"MavenReportException: Error while generating Javadoc\" - \"no description for @throws\" etc.\r\n\r\nExpected: build not failing because of javadoc", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"9472596792932cb785ac842544b45cc45bcf6578": {"commitUser": "dlg99", "commitGHEventType": "referenced"}}, "closed": "2018-06-02 21:22:31", "url": "https://github.com/apache/bookkeeper/issues/1467", "user": "dlg99", "ttf": 0.0002777777777777778}, {"created": "2018-05-31 06:43:20", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "cf6d8b40da75e8f02ca3790763bc9c70d1d677ef tags/release-4.8.1~138", "commitHash": "cf6d8b40da75e8f02ca3790763bc9c70d1d677ef", "commitMessage": "ISSUE #1458: [CI] Fix bookkeeper-seed CI Job\n\nDescriptions of the changes in this PR:\n\n*Motivation*\n\nIssue #1454 introduced a typo, which cause the seed job can not parse groovy DSL files.\n\n*Solution*\n\nFix the typo.\n\nMaster Issue: #1458\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #1464 from sijie/fix_job_seed, closes #1458\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": ".test-infra/jenkins/job_bookkeeper_release_nightly_snapshot.groovy"}], "commitParents": ["a804faeafe40e1ffd74e85e8f7104811c02cd8c4"], "commitDateTime": "2018-06-01 09:30:49", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-06-01 09:30:49"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "[CI] bookkeeper-seed job failed", "numCommits": 0, "body": "\r\n\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nJenkins CI run bookkeeper-seed job\r\n\r\n- What did you expect to see?\r\n\r\nCI succeed\r\n\r\n- What did you see instead?\r\n\r\n```\r\nERROR: (job_bookkeeper_release_nightly_snapshot.groovy, line 41) No such property: defaultBranch for class: javaposse.jobdsl.dsl.helpers.BuildParametersContext\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"cf6d8b40da75e8f02ca3790763bc9c70d1d677ef": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-06-01 16:31:00", "url": "https://github.com/apache/bookkeeper/issues/1458", "user": "sijie", "ttf": 1.0002777777777778}, {"created": "2018-05-24 06:11:04", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "6bfad08b4851406c219c1b5dc445c33453e7ecc4 tags/release-4.8.1~156", "commitHash": "6bfad08b4851406c219c1b5dc445c33453e7ecc4", "commitMessage": "Issue #1434: Checkstyle is not executed at some modules\n\nDescriptions of the changes in this PR:\n\n*Motivation*\n\nCheckstyle was supposed to run at `validate` phase for every modules. However checkstyle is not running at some modules.\nThis introduces inconsistency between modules.\n\n*Changes*\n\n- Fix Checkstyle warnings.\n- Remove `checkstyle` plugins from modules, only leave it at root pom file or modules that have overrides. This improves default build time.\n- Add `checkstyle:check` to CI jobs.\n\n*NOTES*\n\n`microbenchmarks` has too many checkstyle volations. so skip checkstyle for this PR.\n\nMaster Issue: #1434\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #1435 from sijie/checkstyle_tests, closes #1434\n", "commitGitStats": [{"lines": 4, "deletions": 4, "insertions": 0, "filePath": "bookkeeper-benchmark/pom.xml"}, {"lines": 8, "deletions": 8, "insertions": 0, "filePath": "bookkeeper-stats-providers/codahale-metrics-provider/pom.xml"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": ".test-infra/jenkins/job_bookkeeper_precommit_java9.groovy"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/storage/impl/src/main/java/org/apache/bookkeeper/stream/storage/impl/grpc/GrpcTableService.java"}, {"lines": 3, "deletions": 0, "insertions": 3, "filePath": "bookkeeper-tools/src/test/java/org/apache/bookkeeper/tools/cli/helpers/CommandTestBase.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/storage/impl/src/main/java/org/apache/bookkeeper/stream/storage/impl/sc/ZkStorageContainerManager.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/storage/impl/src/main/java/org/apache/bookkeeper/stream/storage/impl/grpc/GrpcRootRangeService.java"}, {"lines": 5, "deletions": 2, "insertions": 3, "filePath": "tests/integration-tests-topologies/src/main/java/org/apache/bookkeeper/tests/containers/wait/HttpWaitStrategy.java"}, {"lines": 5, "deletions": 3, "insertions": 2, "filePath": "tests/backward-compat/yahoo-custom-version/src/test/groovy/org/apache/bookkeeper/tests/backwardcompat/TestCompatUpgradeYahooCustom.groovy"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "bookkeeper-stats/pom.xml"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "circe-checksum/pom.xml"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": ".test-infra/jenkins/job_bookkeeper_postcommit_master_java8.groovy"}, {"lines": 12, "deletions": 6, "insertions": 6, "filePath": "bookkeeper-tools/src/test/java/org/apache/bookkeeper/tools/cli/commands/cluster/ListBookiesCommandTest.java"}, {"lines": 7, "deletions": 2, "insertions": 5, "filePath": "tests/integration/smoke/src/test/java/org/apache/bookkeeper/tests/integration/TestDlogCLI.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": ".test-infra/jenkins/job_bookkeeper_release_nightly_snapshot.groovy"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "stream/distributedlog/common/pom.xml"}, {"lines": 1, "deletions": 1, "insertions": 0, "filePath": "stream/clients/java/kv/src/main/java/org/apache/bookkeeper/clients/impl/kv/TableRequestProcessor.java"}, {"lines": 8, "deletions": 8, "insertions": 0, "filePath": "bookkeeper-http/twitter-http-server/pom.xml"}, {"lines": 22, "deletions": 0, "insertions": 22, "filePath": "bookkeeper-tools/src/main/java/org/apache/bookkeeper/tools/cli/package-info.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "tests/backward-compat/hostname-bookieid/src/test/groovy/org/apache/bookkeeper/tests/backwardcompat/TestCompatUpgradeWithHostnameBookieId.groovy"}, {"lines": 20, "deletions": 9, "insertions": 11, "filePath": "tests/integration-tests-utils/src/main/java/org/apache/bookkeeper/tests/{ => integration/utils}/BookKeeperLogsToTargetDirStopAction.java"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "bookkeeper-server/pom.xml"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "stream/server/pom.xml"}, {"lines": 8, "deletions": 8, "insertions": 0, "filePath": "bookkeeper-http/vertx-http-server/pom.xml"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "tests/backward-compat/hierarchical-ledger-manager/src/test/groovy/org/apache/bookkeeper/tests/backwardcompat/TestCompatHierarchicalLedgerManager.groovy"}, {"lines": 1, "deletions": 1, "insertions": 0, "filePath": "tests/integration/cluster/src/test/java/org/apache/bookkeeper/tests/integration/stream/LocationClientTest.java"}, {"lines": 7, "deletions": 3, "insertions": 4, "filePath": "stream/storage/impl/src/main/java/org/apache/bookkeeper/stream/storage/impl/sc/DefaultStorageContainerController.java"}, {"lines": 7, "deletions": 7, "insertions": 0, "filePath": "tests/shaded/distributedlog-core-shaded-test/pom.xml"}, {"lines": 8, "deletions": 8, "insertions": 0, "filePath": "bookkeeper-stats-providers/twitter-ostrich-provider/pom.xml"}, {"lines": 22, "deletions": 0, "insertions": 22, "filePath": "tests/integration-tests-topologies/src/main/java/org/apache/bookkeeper/tests/containers/package-info.java"}, {"lines": 5, "deletions": 1, "insertions": 4, "filePath": "tests/integration-tests-topologies/src/main/java/org/apache/bookkeeper/tests/containers/ZKContainer.java"}, {"lines": 7, "deletions": 2, "insertions": 5, "filePath": "tests/integration/smoke/src/test/java/org/apache/bookkeeper/tests/integration/TestBookieShellCluster.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": ".test-infra/jenkins/job_bookkeeper_precommit_java8.groovy"}, {"lines": 22, "deletions": 0, "insertions": 22, "filePath": "bookkeeper-tools/src/main/java/org/apache/bookkeeper/tools/cli/commands/package-info.java"}, {"lines": 22, "deletions": 11, "insertions": 11, "filePath": "tests/integration-tests-utils/src/main/java/org/apache/bookkeeper/tests/{ => integration/utils}/NoopAwaitStrategy.java"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "tests/shaded/bookkeeper-server-tests-shaded-test/pom.xml"}, {"lines": 27, "deletions": 13, "insertions": 14, "filePath": "tests/integration-tests-utils/src/main/java/org/apache/bookkeeper/tests/{ => integration/utils}/MavenClassLoader.java"}, {"lines": 6, "deletions": 3, "insertions": 3, "filePath": "tests/backward-compat/current-server-old-clients/src/test/groovy/org/apache/bookkeeper/tests/backwardcompat/TestCompatOldClients.groovy"}, {"lines": 7, "deletions": 2, "insertions": 5, "filePath": "tests/integration/smoke/src/test/java/org/apache/bookkeeper/tests/integration/TestSmoke.java"}, {"lines": 3, "deletions": 1, "insertions": 2, "filePath": "tests/integration-tests-topologies/src/main/java/org/apache/bookkeeper/tests/containers/MetadataStoreContainer.java"}, {"lines": 28, "deletions": 15, "insertions": 13, "filePath": "tests/integration-tests-utils/src/main/java/org/apache/bookkeeper/tests/{ => integration/utils}/ZooKeeperAwaitStrategy.java"}, {"lines": 20, "deletions": 9, "insertions": 11, "filePath": "tests/integration-tests-utils/src/main/java/org/apache/bookkeeper/tests/{ => integration/utils}/LogToTargetDirStopAction.java"}, {"lines": 38, "deletions": 18, "insertions": 20, "filePath": "tests/integration-tests-utils/src/main/java/org/apache/bookkeeper/tests/{ => integration/utils}/DockerUtils.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/storage/impl/src/main/java/org/apache/bookkeeper/stream/storage/impl/grpc/GrpcMetaRangeService.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "stream/storage/impl/src/test/java/org/apache/bookkeeper/stream/storage/impl/cluster/ClusterControllerLeaderImplTest.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": ".test-infra/jenkins/job_bookkeeper_postcommit_master_java9.groovy"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "tests/shaded/bookkeeper-server-shaded-test/pom.xml"}, {"lines": 22, "deletions": 0, "insertions": 22, "filePath": "tests/integration-tests-topologies/src/main/java/org/apache/bookkeeper/tests/containers/wait/package-info.java"}, {"lines": 9, "deletions": 9, "insertions": 0, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/pom.xml"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "tests/integration-tests-topologies/src/main/java/org/apache/bookkeeper/tests/containers/BKStandaloneContainer.java"}, {"lines": 1, "deletions": 1, "insertions": 0, "filePath": "stream/storage/api/src/main/java/org/apache/bookkeeper/stream/storage/conf/StorageConfiguration.java"}, {"lines": 3, "deletions": 0, "insertions": 3, "filePath": "tests/integration/smoke/src/test/java/org/apache/bookkeeper/tests/integration/BookieShellTestBase.java"}, {"lines": 7, "deletions": 0, "insertions": 7, "filePath": "microbenchmarks/pom.xml"}, {"lines": 8, "deletions": 8, "insertions": 0, "filePath": "bookkeeper-stats-providers/twitter-science-provider/pom.xml"}, {"lines": 16, "deletions": 8, "insertions": 8, "filePath": "tests/integration-tests-topologies/src/main/resources/cube-definitions/3-node-all-version-unstarted.yaml"}, {"lines": 31, "deletions": 15, "insertions": 16, "filePath": "stream/proto/src/main/java/org/apache/bookkeeper/stream/protocol/util/StorageContainerPlacementPolicy.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "tests/integration-tests-topologies/src/main/java/org/apache/bookkeeper/tests/containers/ChaosContainer.java"}, {"lines": 24, "deletions": 12, "insertions": 12, "filePath": "tests/integration-tests-utils/src/test/java/org/apache/bookkeeper/tests/{ => integration/utils}/MavenClassLoaderTest.java"}, {"lines": 8, "deletions": 8, "insertions": 0, "filePath": "bookkeeper-http/http-server/pom.xml"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "tests/backward-compat/old-cookie-new-cluster/src/test/groovy/org/apache/bookkeeper/tests/backwardcompat/TestCompatUpgradeOldServerInClusterWithCookies.groovy"}, {"lines": 7, "deletions": 2, "insertions": 5, "filePath": "tests/integration/smoke/src/test/java/org/apache/bookkeeper/tests/integration/TestCLI.java"}, {"lines": 22, "deletions": 0, "insertions": 22, "filePath": "tests/integration-tests-utils/src/main/java/org/apache/bookkeeper/tests/integration/utils/package-info.java"}, {"lines": 9, "deletions": 3, "insertions": 6, "filePath": "stream/storage/impl/src/main/java/org/apache/bookkeeper/stream/storage/impl/cluster/ClusterControllerLeaderImpl.java"}, {"lines": 26, "deletions": 12, "insertions": 14, "filePath": "tests/integration-tests-utils/src/main/java/org/apache/bookkeeper/tests/{ => integration/utils}/BookKeeperClusterUtils.java"}, {"lines": 7, "deletions": 5, "insertions": 2, "filePath": "tests/backward-compat/upgrade-direct/src/test/groovy/org/apache/bookkeeper/tests/backwardcompat/TestCompatUpgradeDirect.groovy"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "tests/integration-tests-topologies/src/main/java/org/apache/bookkeeper/tests/containers/wait/ZKWaitStrategy.java"}, {"lines": 14, "deletions": 14, "insertions": 0, "filePath": "pom.xml"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-tools/src/test/java/org/apache/bookkeeper/tools/cli/BookKeeperCLITest.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/storage/impl/src/test/java/org/apache/bookkeeper/stream/storage/impl/cluster/ZkClusterMetadataStoreTest.java"}, {"lines": 1, "deletions": 1, "insertions": 0, "filePath": "bookkeeper-tools/src/test/java/org/apache/bookkeeper/tools/cli/commands/bookie/LastMarkCommandTest.java"}, {"lines": 9, "deletions": 5, "insertions": 4, "filePath": "tests/backward-compat/recovery-no-password/src/test/groovy/org/apache/bookkeeper/tests/backwardcompat/TestCompatRecoveryNoPassword.groovy"}, {"lines": 22, "deletions": 11, "insertions": 11, "filePath": "tests/integration-tests-utils/src/main/java/org/apache/bookkeeper/tests/{ => integration/utils}/ThreadReaper.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "tests/integration-tests-topologies/src/main/java/org/apache/bookkeeper/tests/containers/BookieContainer.java"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "tests/integration/cluster/src/test/java/org/apache/bookkeeper/tests/integration/stream/StorageAdminClientTest.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "stream/storage/impl/src/main/java/org/apache/bookkeeper/stream/storage/StorageConstants.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "tests/backward-compat/upgrade/src/test/groovy/org/apache/bookkeeper/tests/backwardcompat/TestCompatUpgrade.groovy"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "bookkeeper-common/pom.xml"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "stream/distributedlog/io/dlfs/pom.xml"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "stream/distributedlog/protocol/pom.xml"}, {"lines": 4, "deletions": 4, "insertions": 0, "filePath": "bookkeeper-tools/src/test/java/org/apache/bookkeeper/tools/cli/helpers/DiscoveryCommandTestBase.java"}, {"lines": 8, "deletions": 8, "insertions": 0, "filePath": "bookkeeper-stats-providers/twitter-finagle-provider/pom.xml"}], "commitParents": ["78ccddfeeda9de0187fc379799507d27fa2aaeaf"], "commitDateTime": "2018-05-25 00:58:26", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "tooManyFiles", "authoredDateTime": "2018-05-25 00:58:26"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Checkstyle are not executed at some modules", "numCommits": 0, "body": "\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\nnoticed this behavior when working on some integration tests. it seems that checkstyle is not executed at some modules.\r\n\r\n- What did you do?\r\n\r\nmanually run `checkstyle:check`\r\n\r\n- What did you expect to see?\r\n\r\nit should pass\r\n\r\n- What did you see instead?\r\n\r\n```\r\n[ERROR] src/main/java/org/apache/bookkeeper/tools/cli/BookKeeperCLI.java:[0] (javadoc) JavadocPackage: Missing package-info.java file.\r\n[ERROR] src/main/java/org/apache/bookkeeper/tools/cli/commands/CmdCluster.java:[0] (javadoc) JavadocPackage: Missing package-info.java file.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/BookKeeperCLITest.java:[58] (javadoc) JavadocStyle: First sentence should end with a period.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/commands/cluster/ListBookiesCommandTest.java:[158,41] (whitespace) WhitespaceAfter: ',' is not followed by whitespace.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/commands/cluster/ListBookiesCommandTest.java:[159,41] (whitespace) WhitespaceAfter: ',' is not followed by whitespace.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/commands/cluster/ListBookiesCommandTest.java:[161,41] (whitespace) WhitespaceAfter: ',' is not followed by whitespace.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/commands/cluster/ListBookiesCommandTest.java:[162,41] (whitespace) WhitespaceAfter: ',' is not followed by whitespace.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/commands/cluster/ListBookiesCommandTest.java:[164,41] (whitespace) WhitespaceAfter: ',' is not followed by whitespace.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/commands/cluster/ListBookiesCommandTest.java:[165,41] (whitespace) WhitespaceAfter: ',' is not followed by whitespace.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/commands/bookie/LastMarkCommandTest.java:[22,15] (imports) UnusedImports: Unused import: org.mockito.ArgumentMatchers.anyObject.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/helpers/DiscoveryCommandTestBase.java:[21,15] (imports) UnusedImports: Unused import: org.mockito.ArgumentMatchers.any.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/helpers/DiscoveryCommandTestBase.java:[26,8] (imports) UnusedImports: Unused import: org.apache.bookkeeper.conf.ClientConfiguration.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/helpers/DiscoveryCommandTestBase.java:[28,8] (imports) UnusedImports: Unused import: org.apache.bookkeeper.util.ReflectionUtils.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/helpers/DiscoveryCommandTestBase.java:[30,8] (imports) UnusedImports: Unused import: org.junit.Test.\r\n[ERROR] src/test/java/org/apache/bookkeeper/tools/cli/helpers/CommandTestBase.java:[31] (javadoc) JavadocType: Missing a Javadoc comment.\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"6bfad08b4851406c219c1b5dc445c33453e7ecc4": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-05-25 07:58:39", "url": "https://github.com/apache/bookkeeper/issues/1434", "user": "sijie", "ttf": 1.0002777777777778}, {"created": "2018-05-12 04:04:08", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "DistributionSchedule.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.getWriteSetForLongPoll(long)"}]}, {"spoonFilePath": "RoundRobinDistributionSchedule.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.RoundRobinDistributionSchedule.getWriteSetForLongPoll(long)"}]}, {"spoonFilePath": "ReadLastConfirmedAndEntryOp.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.ReadLastConfirmedAndEntryOp.ReadLACAndEntryRequest"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.ReadLastConfirmedAndEntryOp"}]}, {"spoonFilePath": "TestSmoke.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testTailingReadsWithExplicitLac()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testLongPollTailingReads(int,long,int)"}, {"INS": 2, "DEL": 2, "TOT": 33, "MOV": 21, "UPD": 8, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testReadWrite()"}, {"INS": 0, "DEL": 1, "TOT": 22, "MOV": 17, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testTailingReads()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testTailingReadsWithoutExplicitLac()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.readEntries(org.apache.bookkeeper.client.BookKeeper,long,int)"}, {"INS": 6, "DEL": 0, "TOT": 6, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testTailingReads(int,long,int)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.writeEntries(int,org.apache.bookkeeper.client.LedgerHandle,java.util.concurrent.ExecutorService,java.util.concurrent.CompletableFuture)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testLongTailingReadsWithoutExplicitLac()"}, {"INS": 2, "DEL": 2, "TOT": 11, "MOV": 6, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testReadWriteAdv()"}]}], "nameRev": "5442537cf34babc9ef2021d1c18cad6fb675ae52 tags/release-4.7.1~50", "commitHash": "5442537cf34babc9ef2021d1c18cad6fb675ae52", "commitMessage": "ISSUE #1403: ArrayIndexOutOfBoundsException is thrown on readLastAddConfirmedAndEntry\n\nDescriptions of the changes in this PR:\n\n*Motivation*\n\nThere are two bugs in `ReadLastAddConfirmedAndEntry`:\n\n1) a regression was introduced by #657. the long poll read op is attempting to long-poll reading lac. since lac is stored across ensemble, so the retry logic assumes it will attempt over all the bookies in the ensemble. however #657 use a `write-quorum-size` write set for tracking those attempts. this leads to ArrayIndexOutOfBoundsException reported at #1403. The integrate tests added in this PR can easily reproduce this issue.\n\n2) there was a bug on retry logic when a ledger whose ensemble size is larger than write quorum size. when this happens, it will claim lac is not advanced prior to attempt the bookie in the ensemble. so the client will never know lac is advanced if using long poll reads on such ledgers. The integrate tests added in this PR can also catch this issue.\n\ndisclaim: twitter uses long poll reads but never uses `ensembleSize > writeQuorumSize`. so this is not a problem for dlog users.\n\n*Solution*\n\n- introduce a `getWriteSetForLongPoll` call that uses `ensembleSize` for building the write set. this would address problem 1)\n- fix the assignment of `numEmptyResponsesAllowed`, so the long poll reads can work with `ensembleSize > writeQuorumSize`\n- add integration tests for long polling reads\n\nat the same time, also add an integration test for normal tailing reads with\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #1404 from sijie/longpoll_tests, closes #1403\n\n(cherry picked from commit 92591733c8b778f63cd71a00b2c7ed2c69c41312)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 7, "deletions": 0, "insertions": 7, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java"}, {"lines": 181, "deletions": 29, "insertions": 152, "filePath": "tests/integration/smoke/src/test/java/org/apache/bookkeeper/tests/integration/TestSmoke.java"}, {"lines": 7, "deletions": 0, "insertions": 7, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java"}, {"lines": 7, "deletions": 2, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedAndEntryOp.java"}], "commitParents": ["6b3943576fed7a9dd90dacb6bd6a11fa1e4971ce"], "commitDateTime": "2018-05-15 11:13:11", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-05-15 11:12:54"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "DistributionSchedule.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.getWriteSetForLongPoll(long)"}]}, {"spoonFilePath": "RoundRobinDistributionSchedule.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.RoundRobinDistributionSchedule.getWriteSetForLongPoll(long)"}]}, {"spoonFilePath": "ReadLastConfirmedAndEntryOp.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.ReadLastConfirmedAndEntryOp.ReadLACAndEntryRequest"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.ReadLastConfirmedAndEntryOp"}]}, {"spoonFilePath": "TestSmoke.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testTailingReadsWithExplicitLac()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testLongPollTailingReads(int,long,int)"}, {"INS": 2, "DEL": 2, "TOT": 33, "MOV": 21, "UPD": 8, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testReadWrite()"}, {"INS": 0, "DEL": 1, "TOT": 22, "MOV": 17, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testTailingReads()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testTailingReadsWithoutExplicitLac()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.readEntries(org.apache.bookkeeper.client.BookKeeper,long,int)"}, {"INS": 6, "DEL": 0, "TOT": 6, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testTailingReads(int,long,int)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.writeEntries(int,org.apache.bookkeeper.client.LedgerHandle,java.util.concurrent.ExecutorService,java.util.concurrent.CompletableFuture)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testLongTailingReadsWithoutExplicitLac()"}, {"INS": 2, "DEL": 2, "TOT": 11, "MOV": 6, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.tests.integration.TestSmoke.testReadWriteAdv()"}]}], "nameRev": "92591733c8b778f63cd71a00b2c7ed2c69c41312 tags/release-4.8.1~180", "commitHash": "92591733c8b778f63cd71a00b2c7ed2c69c41312", "commitMessage": "ISSUE #1403: ArrayIndexOutOfBoundsException is thrown on readLastAddConfirmedAndEntry\n\nDescriptions of the changes in this PR:\n\n*Motivation*\n\nThere are two bugs in `ReadLastAddConfirmedAndEntry`:\n\n1) a regression was introduced by #657. the long poll read op is attempting to long-poll reading lac. since lac is stored across ensemble, so the retry logic assumes it will attempt over all the bookies in the ensemble. however #657 use a `write-quorum-size` write set for tracking those attempts. this leads to ArrayIndexOutOfBoundsException reported at #1403. The integrate tests added in this PR can easily reproduce this issue.\n\n2) there was a bug on retry logic when a ledger whose ensemble size is larger than write quorum size. when this happens, it will claim lac is not advanced prior to attempt the bookie in the ensemble. so the client will never know lac is advanced if using long poll reads on such ledgers. The integrate tests added in this PR can also catch this issue.\n\ndisclaim: twitter uses long poll reads but never uses `ensembleSize > writeQuorumSize`. so this is not a problem for dlog users.\n\n*Solution*\n\n- introduce a `getWriteSetForLongPoll` call that uses `ensembleSize` for building the write set. this would address problem 1)\n- fix the assignment of `numEmptyResponsesAllowed`, so the long poll reads can work with `ensembleSize > writeQuorumSize`\n- add integration tests for long polling reads\n\nat the same time, also add an integration test for normal tailing reads with\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #1404 from sijie/longpoll_tests, closes #1403\n", "commitGitStats": [{"lines": 7, "deletions": 0, "insertions": 7, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java"}, {"lines": 181, "deletions": 29, "insertions": 152, "filePath": "tests/integration/smoke/src/test/java/org/apache/bookkeeper/tests/integration/TestSmoke.java"}, {"lines": 7, "deletions": 0, "insertions": 7, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java"}, {"lines": 7, "deletions": 2, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedAndEntryOp.java"}], "commitParents": ["0d862fa42792301f26127addd5cc5a6a0114ce9b"], "commitDateTime": "2018-05-15 11:12:54", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-05-15 11:12:54"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "area/tests", "release/4.7.1", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "ArrayIndexOutOfBoundsException is thrown on readLastAddConfirmedAndEntry", "numCommits": 0, "body": "\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nwrite an integration test on testing long poll reads\r\n\r\n- What did you expect to see?\r\n\r\nintegration test can pass\r\n\r\n- What did you see instead?\r\n\r\nthe integration test hangs on.\r\n\r\n```\r\n2018-05-12 03:41:11,910 - ERROR - [BookKeeperClientWorker-OrderedExecutor-0-0:SafeRunnable@38] - Unexpected throwable caught\r\njava.lang.ArrayIndexOutOfBoundsException: 2\r\n\tat org.apache.bookkeeper.client.RoundRobinDistributionSchedule$WriteSetImpl.get(RoundRobinDistributionSchedule.java:123)\r\n\tat org.apache.bookkeeper.client.ReadLastConfirmedAndEntryOp$SequenceReadRequest.sendNextRead(ReadLastConfirmedAndEntryOp.java:373)\r\n\tat org.apache.bookkeeper.client.ReadLastConfirmedAndEntryOp$SequenceReadRequest.logErrorAndReattemptRead(ReadLastConfirmedAndEntryOp.java:406)\r\n\tat org.apache.bookkeeper.client.ReadLastConfirmedAndEntryOp.readEntryComplete(ReadLastConfirmedAndEntryOp.java:602)\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion$1.readEntryComplete(PerChannelBookieClient.java:1633)\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion.handleReadResponse(PerChannelBookieClient.java:1714)\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion.handleV3Response(PerChannelBookieClient.java:1689)\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$3.safeRun(PerChannelBookieClient.java:1304)\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.java:138)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"5442537cf34babc9ef2021d1c18cad6fb675ae52": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "92591733c8b778f63cd71a00b2c7ed2c69c41312": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-05-15 18:13:05", "url": "https://github.com/apache/bookkeeper/issues/1403", "user": "sijie", "ttf": 3.000277777777778}, {"created": "2018-05-03 08:06:57", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "c495cf0acc3e9ba818162a298802366472c3cab9 tags/release-4.7.1~44", "commitHash": "c495cf0acc3e9ba818162a298802366472c3cab9", "commitMessage": "ISSUE #1384: Bump checkstyle version\n\nDescriptions of the changes in this PR:\n\n*Motivation*\n\nmvn build fails on a centos/7 box. Exceptions are thrown as below:\n\n```\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:2.17:check (checkstyle) on project circe-checksum: Execution checkstyle of goal org.apache.maven.plugins:maven-checkstyle-plugin:2.17:check failed: An API incompatibility was encountered while executing org.apache.maven.plugins:maven-checkstyle-plugin:2.17:check: java.lang.NoSuchMethodError: org.slf4j.spi.LocationAwareLogger.log(Lorg/slf4j/Marker;Ljava/lang/String;ILjava/lang/String;Ljava/lang/Throwable;)V\n```\n\n*Solution*\n\nThe problem was addressed in https://issues.apache.org/jira/browse/MCHECKSTYLE-335. We need to bump the checkstyle plugin version to `3.0.0`\n\nMaster Issue: #1384\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #1385 from sijie/vagrant_files, closes #1384\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "pom.xml"}], "commitParents": ["71e0604ed60d6e1cd14cef41b7f041d57422dbfc"], "commitDateTime": "2018-06-04 13:39:05", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-05-03 12:30:54"}, {"commitSpoonAstDiffStats": [], "nameRev": "d47efa9fcc4601228d14219275b8d450256ccca8 tags/release-4.8.1~197", "commitHash": "d47efa9fcc4601228d14219275b8d450256ccca8", "commitMessage": "ISSUE #1384: Bump checkstyle version\n\nDescriptions of the changes in this PR:\n\n*Motivation*\n\nmvn build fails on a centos/7 box. Exceptions are thrown as below:\n\n```\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:2.17:check (checkstyle) on project circe-checksum: Execution checkstyle of goal org.apache.maven.plugins:maven-checkstyle-plugin:2.17:check failed: An API incompatibility was encountered while executing org.apache.maven.plugins:maven-checkstyle-plugin:2.17:check: java.lang.NoSuchMethodError: org.slf4j.spi.LocationAwareLogger.log(Lorg/slf4j/Marker;Ljava/lang/String;ILjava/lang/String;Ljava/lang/Throwable;)V\n```\n\n*Solution*\n\nThe problem was addressed in https://issues.apache.org/jira/browse/MCHECKSTYLE-335. We need to bump the checkstyle plugin version to `3.0.0`\n\nMaster Issue: #1384\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #1385 from sijie/vagrant_files, closes #1384\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "pom.xml"}], "commitParents": ["7580ce9dd8449f777e35b580bb6786f12d7703bc"], "commitDateTime": "2018-05-03 12:30:54", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-05-03 12:30:54"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "release/4.7.1", "release/4.8.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Fail to build bookkeeper at centos/7 with maven 3.5.0", "numCommits": 0, "body": "\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nrun `mvn install -DskipTests` in a centos/7 vm.\r\n\r\n- What did you expect to see?\r\n\r\nit should be able to build the project successfully\r\n\r\n- What did you see instead?\r\n\r\n```\r\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:2.17:check (checkstyle) on project circe-checksum: Execution checkstyle of goal org.apache.maven.plugins:maven-checkstyle-plugin:2.17:check failed: An API incompatibility was encountered while executing org.apache.maven.plugins:maven-checkstyle-plugin:2.17:check: java.lang.NoSuchMethodError: org.slf4j.spi.LocationAwareLogger.log(Lorg/slf4j/Marker;Ljava/lang/String;ILjava/lang/String;Ljava/lang/Throwable;)V\r\n```\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"c495cf0acc3e9ba818162a298802366472c3cab9": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "d47efa9fcc4601228d14219275b8d450256ccca8": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-05-03 19:31:05", "url": "https://github.com/apache/bookkeeper/issues/1384", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2018-05-01 05:22:30", "closed": "2018-06-12 07:42:48", "title": "`bin/dlog` should promote user to run `mvn install` if the source is not built", "url": "https://github.com/apache/bookkeeper/issues/1377", "body": "\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\n1. download the source bindary\r\n2. run `stream/distributedlog/core/bin/dlog local 7000`\r\n\r\n- What did you expect to see?\r\n\r\nthe local emulator started\r\n\r\n- What did you see instead?\r\n\r\n```\r\n$ ./stream/distributedlog/core/bin/dlog local\r\nJMX enabled by default\r\nDLOG_HOME => ./stream/distributedlog/core/bin/..\r\nError: Could not find or load main class org.apache.distributedlog.LocalDLMEmulator\r\n```", "commits": {}, "user": "sijie", "commitsDetails": [], "labels": ["area/dlog", "type/bug"], "ttf": 42.000277777777775}, {"created": "2018-04-18 21:44:44", "closed": "2018-06-12 07:44:31", "title": "new bookkeeper-cli doesn't work in binary distribution", "url": "https://github.com/apache/bookkeeper/issues/1356", "body": "\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\n- run standalone in docker\r\n- docker exec -it <container id> bash\r\n- run bin/bookkeeper-cli\r\n\r\n- What did you expect to see?\r\n\r\nbookkeeper-cli should print help usage\r\n\r\n- What did you see instead?\r\n\r\n```\r\n# bin/bookkeeper-cli\r\nCouldn't find bookkeeper jar.\r\nDo you want me to run `mvn package -DskiptTests` for you ?\r\n```\r\n\r\n", "commits": {}, "user": "sijie", "commitsDetails": [], "labels": ["area/tools", "type/bug"], "ttf": 54.000277777777775}, {"created": "2018-03-13 22:38:32", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "CheckpointOnNewLedgersTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CheckpointOnNewLedgersTest"}]}, {"spoonFilePath": "SyncThread.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread"}]}, {"spoonFilePath": "Bookie.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.addEntryInternal(org.apache.bookkeeper.bookie.LedgerDescriptor,io.netty.buffer.ByteBuf,boolean,org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.WriteCallback,java.lang.Object)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.addEntryInternal(org.apache.bookkeeper.bookie.LedgerDescriptor,io.netty.buffer.ByteBuf,boolean,org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.WriteCallback,java.lang.Object,byte[])"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.recoveryAddEntry(io.netty.buffer.ByteBuf,org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.WriteCallback,java.lang.Object,byte[])"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.addEntry(io.netty.buffer.ByteBuf,boolean,org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.WriteCallback,java.lang.Object,byte[])"}, {"INS": 1, "DEL": 2, "TOT": 7, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.getLedgerForEntry(io.netty.buffer.ByteBuf,byte[])"}]}], "nameRev": "7e8980fff096a9111e9365d0dc959af0625a87db tags/release-4.8.1~286", "commitHash": "7e8980fff096a9111e9365d0dc959af0625a87db", "commitMessage": "ISSUE #1255: Bookie should not advance the journal marker before creating the index file\n\nDescriptions of the changes in this PR:\n\n*Problem*\n\nCurrently Bookie journal 'new ledger' entry if a ledger doesn't exist at ledger storage. This 'new ledger' entry is journaled before adding the entry to ledger storage. so this would cause a problem on checkpointing.\n\n- journal 'new ledger' entry\n\n```\n    /**\n     * Retrieve the ledger descriptor for the ledger which entry should be added to.\n     * The LedgerDescriptor returned from this method should be eventually freed with\n     * #putHandle().\n     *\n     * throws BookieException if masterKey does not match the master key of the ledger\n     */\n    private LedgerDescriptor getLedgerForEntry(ByteBuf entry, final byte[] masterKey)\n            throws IOException, BookieException {\n        final long ledgerId = entry.getLong(entry.readerIndex());\n\n        LedgerDescriptor l = handles.getHandle(ledgerId, masterKey);\n        if (masterKeyCache.get(ledgerId) == null) {\n            // Force the load into masterKey cache\n            byte[] oldValue = masterKeyCache.putIfAbsent(ledgerId, masterKey);\n            if (oldValue == null) {\n                // new handle, we should add the key to journal ensure we can rebuild\n                ByteBuffer bb = ByteBuffer.allocate(8 + 8 + 4 + masterKey.length);\n                bb.putLong(ledgerId);\n                bb.putLong(METAENTRY_ID_LEDGER_KEY);\n                bb.putInt(masterKey.length);\n                bb.put(masterKey);\n                bb.flip();\n\n                getJournal(ledgerId).logAddEntry(bb, false /* ackBeforeSync */, new NopWriteCallback(), null);\n            }\n        }\n\n        return l;\n    }\n```\n\n- add entry to ledger storage\n```\n    /**\n     * Add an entry to a ledger as specified by handle.\n     */\n    private void addEntryInternal(LedgerDescriptor handle, ByteBuf entry,\n                                  boolean ackBeforeSync, WriteCallback cb, Object ctx)\n            throws IOException, BookieException {\n        long ledgerId = handle.getLedgerId();\n        long entryId = handle.addEntry(entry);\n\n        writeBytes.add(entry.readableBytes());\n\n        if (LOG.isTraceEnabled()) {\n            LOG.trace(\"Adding {}{}\", entryId, ledgerId);\n        }\n        getJournal(ledgerId).logAddEntry(entry, ackBeforeSync, cb, ctx);\n    }\n\n```\n\nThe problematic sequence can be described as below:\n\n- thread t1 is adding the first entry of ledger L1\n- thread t2 is adding entries of ledger L2\n- t1 is adding a journal entry of 'new ledger L1'\n- t2 is adding entries after t1 adds the journal entry and before t1 adding the entry to ledger storage\n- after t2 added entries, checkpoint happens in the ledger storage. it would roll the journal mark, which will claim the 'new ledger L1' entry as persistent.\n- if the bookie restarts, it would fail with no such ledger exception.\n\nThe problem can be produced using a unit test: https://github.com/sijie/bookkeeper/commit/5053a717cd578aeb88236d373553d7494501b801\n\n*Solution*\n\nThe fix is simple - just make sure the 'new ledger' journal entry is added after an entry is added to ledger storage. so it make sure when checkpoint happen it will flush and create the ledger before moving the journal mark.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Charan Reddy Guttapalem <reddycharan18@gmail.com>, Jia Zhai <None>, Yiming Zang <yzang2016@gmail.com>, Matteo Merli <mmerli@apache.org>\n\nThis closes #1256 from sijie/fix_db_ledger_storage_checkpoint, closes #1255\n", "commitGitStats": [{"lines": 46, "deletions": 22, "insertions": 24, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java"}, {"lines": 197, "deletions": 0, "insertions": 197, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/CheckpointOnNewLedgersTest.java"}, {"lines": 3, "deletions": 0, "insertions": 3, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/SyncThread.java"}], "commitParents": ["96ff1c0d44bf1ac6b0ce3ca21053ae10ab7e2294"], "commitDateTime": "2018-03-14 11:03:05", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-03-14 11:03:05"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "CheckpointOnNewLedgersTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CheckpointOnNewLedgersTest"}]}, {"spoonFilePath": "SyncThread.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread"}]}, {"spoonFilePath": "Bookie.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.addEntryInternal(org.apache.bookkeeper.bookie.LedgerDescriptor,io.netty.buffer.ByteBuf,org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.WriteCallback,java.lang.Object)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.addEntry(io.netty.buffer.ByteBuf,org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.WriteCallback,java.lang.Object,byte[])"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.addEntryInternal(org.apache.bookkeeper.bookie.LedgerDescriptor,io.netty.buffer.ByteBuf,org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.WriteCallback,java.lang.Object,byte[])"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.recoveryAddEntry(io.netty.buffer.ByteBuf,org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.WriteCallback,java.lang.Object,byte[])"}, {"INS": 1, "DEL": 2, "TOT": 7, "MOV": 4, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.getLedgerForEntry(io.netty.buffer.ByteBuf,byte[])"}]}], "nameRev": "3adacf06f9ab8254b6ba6b45a6dcdd523e5030b8 tags/release-4.6.2~7", "commitHash": "3adacf06f9ab8254b6ba6b45a6dcdd523e5030b8", "commitMessage": "ISSUE #1255: Bookie should not advance the journal marker before creating the index file\n\nDescriptions of the changes in this PR:\n\n*Problem*\n\nCurrently Bookie journal 'new ledger' entry if a ledger doesn't exist at ledger storage. This 'new ledger' entry is journaled before adding the entry to ledger storage. so this would cause a problem on checkpointing.\n\n- journal 'new ledger' entry\n\n```\n    /**\n     * Retrieve the ledger descriptor for the ledger which entry should be added to.\n     * The LedgerDescriptor returned from this method should be eventually freed with\n     * #putHandle().\n     *\n     * throws BookieException if masterKey does not match the master key of the ledger\n     */\n    private LedgerDescriptor getLedgerForEntry(ByteBuf entry, final byte[] masterKey)\n            throws IOException, BookieException {\n        final long ledgerId = entry.getLong(entry.readerIndex());\n\n        LedgerDescriptor l = handles.getHandle(ledgerId, masterKey);\n        if (masterKeyCache.get(ledgerId) == null) {\n            // Force the load into masterKey cache\n            byte[] oldValue = masterKeyCache.putIfAbsent(ledgerId, masterKey);\n            if (oldValue == null) {\n                // new handle, we should add the key to journal ensure we can rebuild\n                ByteBuffer bb = ByteBuffer.allocate(8 + 8 + 4 + masterKey.length);\n                bb.putLong(ledgerId);\n                bb.putLong(METAENTRY_ID_LEDGER_KEY);\n                bb.putInt(masterKey.length);\n                bb.put(masterKey);\n                bb.flip();\n\n                getJournal(ledgerId).logAddEntry(bb, false /* ackBeforeSync */, new NopWriteCallback(), null);\n            }\n        }\n\n        return l;\n    }\n```\n\n- add entry to ledger storage\n```\n    /**\n     * Add an entry to a ledger as specified by handle.\n     */\n    private void addEntryInternal(LedgerDescriptor handle, ByteBuf entry,\n                                  boolean ackBeforeSync, WriteCallback cb, Object ctx)\n            throws IOException, BookieException {\n        long ledgerId = handle.getLedgerId();\n        long entryId = handle.addEntry(entry);\n\n        writeBytes.add(entry.readableBytes());\n\n        if (LOG.isTraceEnabled()) {\n            LOG.trace(\"Adding {}{}\", entryId, ledgerId);\n        }\n        getJournal(ledgerId).logAddEntry(entry, ackBeforeSync, cb, ctx);\n    }\n\n```\n\nThe problematic sequence can be described as below:\n\n- thread t1 is adding the first entry of ledger L1\n- thread t2 is adding entries of ledger L2\n- t1 is adding a journal entry of 'new ledger L1'\n- t2 is adding entries after t1 adds the journal entry and before t1 adding the entry to ledger storage\n- after t2 added entries, checkpoint happens in the ledger storage. it would roll the journal mark, which will claim the 'new ledger L1' entry as persistent.\n- if the bookie restarts, it would fail with no such ledger exception.\n\nThe problem can be produced using a unit test: https://github.com/sijie/bookkeeper/commit/5053a717cd578aeb88236d373553d7494501b801\n\n*Solution*\n\nThe fix is simple - just make sure the 'new ledger' journal entry is added after an entry is added to ledger storage. so it make sure when checkpoint happen it will flush and create the ledger before moving the journal mark.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Charan Reddy Guttapalem <reddycharan18@gmail.com>, Jia Zhai <None>, Yiming Zang <yzang2016@gmail.com>, Matteo Merli <mmerli@apache.org>\n\nThis closes #1256 from sijie/fix_db_ledger_storage_checkpoint, closes #1255\n\n(cherry picked from commit 7e8980fff096a9111e9365d0dc959af0625a87db)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 45, "deletions": 21, "insertions": 24, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java"}, {"lines": 194, "deletions": 0, "insertions": 194, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/CheckpointOnNewLedgersTest.java"}, {"lines": 4, "deletions": 0, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/SyncThread.java"}], "commitParents": ["e248147463281986d29d75d959732834f4225a9b"], "commitDateTime": "2018-03-14 11:12:59", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-03-14 11:03:05"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "release/4.6.2", "release/4.7.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Bookie should not advance the journal marker before creating the index file", "numCommits": 0, "body": "**Bug**\r\n\r\n*Problem*\r\n\r\nCurrently Bookie journal 'new ledger' entry if a ledger doesn't exist at ledger storage. This 'new ledger' entry is journaled before adding the entry to ledger storage. so this would cause a problem on checkpointing.\r\n\r\n- journal 'new ledger' entry\r\n\r\n```\r\n    /**\r\n     * Retrieve the ledger descriptor for the ledger which entry should be added to.\r\n     * The LedgerDescriptor returned from this method should be eventually freed with\r\n     * #putHandle().\r\n     *\r\n     * @throws BookieException if masterKey does not match the master key of the ledger\r\n     */\r\n    private LedgerDescriptor getLedgerForEntry(ByteBuf entry, final byte[] masterKey)\r\n            throws IOException, BookieException {\r\n        final long ledgerId = entry.getLong(entry.readerIndex());\r\n\r\n        LedgerDescriptor l = handles.getHandle(ledgerId, masterKey);\r\n        if (masterKeyCache.get(ledgerId) == null) {\r\n            // Force the load into masterKey cache\r\n            byte[] oldValue = masterKeyCache.putIfAbsent(ledgerId, masterKey);\r\n            if (oldValue == null) {\r\n                // new handle, we should add the key to journal ensure we can rebuild\r\n                ByteBuffer bb = ByteBuffer.allocate(8 + 8 + 4 + masterKey.length);\r\n                bb.putLong(ledgerId);\r\n                bb.putLong(METAENTRY_ID_LEDGER_KEY);\r\n                bb.putInt(masterKey.length);\r\n                bb.put(masterKey);\r\n                bb.flip();\r\n\r\n                getJournal(ledgerId).logAddEntry(bb, false /* ackBeforeSync */, new NopWriteCallback(), null);\r\n            }\r\n        }\r\n\r\n        return l;\r\n    }\r\n```\r\n\r\n- add entry to ledger storage\r\n```\r\n    /**\r\n     * Add an entry to a ledger as specified by handle.\r\n     */\r\n    private void addEntryInternal(LedgerDescriptor handle, ByteBuf entry,\r\n                                  boolean ackBeforeSync, WriteCallback cb, Object ctx)\r\n            throws IOException, BookieException {\r\n        long ledgerId = handle.getLedgerId();\r\n        long entryId = handle.addEntry(entry);\r\n\r\n        writeBytes.add(entry.readableBytes());\r\n\r\n        if (LOG.isTraceEnabled()) {\r\n            LOG.trace(\"Adding {}@{}\", entryId, ledgerId);\r\n        }\r\n        getJournal(ledgerId).logAddEntry(entry, ackBeforeSync, cb, ctx);\r\n    }\r\n\r\n```\r\n\r\nThe problematic sequence can be described as below:\r\n\r\n- thread t1 is adding the first entry of ledger L1\r\n- thread t2 is adding entries of ledger L2\r\n- t1 is adding a journal entry of 'new ledger L1'\r\n- t2 is adding entries after t1 adds the journal entry and before t1 adding the entry to ledger storage\r\n- after t2 added entries, checkpoint happens in the ledger storage. it would roll the journal mark, which will claim the 'new ledger L1' entry as persistent.\r\n- if the bookie restarts, it would fail with no such ledger exception.\r\n\r\nThe problem can be produced using a unit test: https://github.com/sijie/bookkeeper/commit/5053a717cd578aeb88236d373553d7494501b801\r\n\r\n*Solution*\r\n\r\nThe fix is simple - just make sure the 'new ledger' journal entry is added after an entry is added to ledger storage. so it make sure when checkpoint happen it will flush and create the ledger before moving the journal mark.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"7e8980fff096a9111e9365d0dc959af0625a87db": {"commitUser": "sijie", "commitGHEventType": "closed"}, "3adacf06f9ab8254b6ba6b45a6dcdd523e5030b8": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-03-14 18:03:15", "url": "https://github.com/apache/bookkeeper/issues/1255", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2018-03-09 18:41:48", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "PerChannelBookieClient.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.proto.PerChannelBookieClient.initTLSHandshake().7.operationComplete(io.netty.util.concurrent.Future)"}, {"INS": 0, "DEL": 6, "TOT": 12, "MOV": 5, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.proto.PerChannelBookieClient.writeAndFlush(io.netty.channel.Channel,org.apache.bookkeeper.proto.PerChannelBookieClient$CompletionKey,java.lang.Object).5.operationComplete(io.netty.channel.ChannelFuture)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.proto.PerChannelBookieClient.initTLSHandshake().7"}, {"INS": 5, "DEL": 1, "TOT": 6, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.PerChannelBookieClient.writeAndFlush(io.netty.channel.Channel,org.apache.bookkeeper.proto.PerChannelBookieClient$CompletionKey,java.lang.Object)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.proto.PerChannelBookieClient.readV3Response(org.apache.bookkeeper.proto.BookkeeperProtocol.Response).6"}]}], "nameRev": "f0757e9ac643d6f36a11be4065d163437180cb7e tags/release-4.8.1~294", "commitHash": "f0757e9ac643d6f36a11be4065d163437180cb7e", "commitMessage": "Issue #1241: Fixed NPE in PerChannelBookieClient\n\nThe `CompletionValue` object from the map can be null in some cases and we need to protect for it.\n\nFixes #1241\n\nAuthor: Matteo Merli <mmerli@apache.org>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #1242 from merlimat/fix-npe, closes #1241\n", "commitGitStats": [{"lines": 21, "deletions": 10, "insertions": 11, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java"}], "commitParents": ["e3d47ae14a0140b10a6303ecfddbcba66ce90933"], "commitDateTime": "2018-03-09 21:06:18", "commitUser": "merlimat", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-03-09 21:06:18"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["priority/important", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "NullPointerException in PerChannelBookieClient", "numCommits": 0, "body": "I have seen this error in `PerChannelBookieClient` with the latest master code:\r\n\r\n```\r\n18:36:28.989 [bookkeeper-io-5-1] WARN  io.netty.util.concurrent.DefaultPromise - An exception was thrown by org.apache.bookkeeper.proto.PerChannelBookieClient$3.operationComplete()\r\njava.lang.NullPointerException: null\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$3.operationComplete(PerChannelBookieClient.java:885) ~[org.apache.bookkeeper-bookkeeper-server-shaded-4.7.0-20180309.150140-65.jar:4.7.0-SNAPSHOT]\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$3.operationComplete(PerChannelBookieClient.java:879) ~[org.apache.bookkeeper-bookkeeper-server-shaded-4.7.0-20180309.150140-65.jar:4.7.0-SNAPSHOT]\r\n\tat io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:512) [io.netty-netty-all-4.1.21.Final.jar:4.1.21.Final]\r\n\tat io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:486) [io.netty-netty-all-4.1.21.Final.jar:4.1.21.Final]\r\n\tat io.netty.util.concurrent.DefaultPromise.access$000(DefaultPromise.java:34) [io.netty-netty-all-4.1.21.Final.jar:4.1.21.Final]\r\n\tat io.netty.util.concurrent.DefaultPromise$1.run(DefaultPromise.java:436) [io.netty-netty-all-4.1.21.Final.jar:4.1.21.Final]\r\n\tat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:163) [io.netty-netty-all-4.1.21.Final.jar:4.1.21.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:404) [io.netty-netty-all-4.1.21.Final.jar:4.1.21.Final]\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:309) [io.netty-netty-all-4.1.21.Final.jar:4.1.21.Final]\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:886) [io.netty-netty-all-4.1.21.Final.jar:4.1.21.Final]\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-all-4.1.21.Final.jar:4.1.21.Final]\r\n\tat java.lang.Thread.run(Thread.java:748) [?:1.8.0_161]\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"f0757e9ac643d6f36a11be4065d163437180cb7e": {"commitUser": "merlimat", "commitGHEventType": "closed"}}, "closed": "2018-03-10 05:06:26", "url": "https://github.com/apache/bookkeeper/issues/1241", "user": "merlimat", "ttf": 0.0002777777777777778}, {"created": "2018-03-05 21:58:23", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerHandle.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.getBk()"}]}, {"spoonFilePath": "PendingAddOp.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingAddOp.maybeRecycle()"}, {"INS": 4, "DEL": 4, "TOT": 8, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingAddOp.create(org.apache.bookkeeper.client.LedgerHandle,io.netty.buffer.ByteBuf,org.apache.bookkeeper.client.AsyncCallback.AddCallbackWithLatency,java.lang.Object)"}]}, {"spoonFilePath": "BookKeeper.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.BookKeeper.getAddEntryQuorumTimeoutNanos()"}]}, {"spoonFilePath": "PendingAddOpTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingAddOpTest"}]}], "nameRev": "fbc06ef3139ca857c60a2edbc209c8b088e979df tags/release-4.8.1~302", "commitHash": "fbc06ef3139ca857c60a2edbc209c8b088e979df", "commitMessage": "ISSUE #1229: PendingAddOp can get recycled before it gets executed\n\nDescriptions of the changes in this PR:\n*Problem*\n\nThe PendingAddOp can be recycled when it is cancelled before it is executed. so it will hit NPE when it is actually executed. This is a bug introduced by #1091\n\n*Solution*\n\nOnly recycle PendingAddOp after it has been run.\n\nMaster Issue: #1229\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Andrey Yegorov <None>, Matteo Merli <mmerli@apache.org>, Venkateswararao Jujjuri (JV) <None>\n\nThis closes #1230 from sijie/fix_npe, closes #1229\n", "commitGitStats": [{"lines": 4, "deletions": 0, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java"}, {"lines": 11, "deletions": 5, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java"}, {"lines": 80, "deletions": 0, "insertions": 80, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/PendingAddOpTest.java"}, {"lines": 4, "deletions": 0, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java"}], "commitParents": ["3e51b8116c363604f93bdd0c6b6b71ef3387c8a8"], "commitDateTime": "2018-03-05 19:13:14", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-03-05 19:13:14"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerHandle.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.getBk()"}]}, {"spoonFilePath": "PendingAddOp.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingAddOp.maybeRecycle()"}, {"INS": 3, "DEL": 3, "TOT": 6, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingAddOp.create(org.apache.bookkeeper.client.LedgerHandle,io.netty.buffer.ByteBuf,org.apache.bookkeeper.client.AsyncCallback.AddCallback,java.lang.Object)"}]}, {"spoonFilePath": "PendingAddOpTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingAddOpTest"}]}], "nameRev": "b59dab59020e11ff2fa6fab342081a3f90c22b03 tags/release-4.6.2~9", "commitHash": "b59dab59020e11ff2fa6fab342081a3f90c22b03", "commitMessage": "ISSUE #1229: PendingAddOp can get recycled before it gets executed\n\nDescriptions of the changes in this PR:\n*Problem*\n\nThe PendingAddOp can be recycled when it is cancelled before it is executed. so it will hit NPE when it is actually executed. This is a bug introduced by #1091\n\n*Solution*\n\nOnly recycle PendingAddOp after it has been run.\n\nMaster Issue: #1229\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Andrey Yegorov <None>, Matteo Merli <mmerli@apache.org>, Venkateswararao Jujjuri (JV) <None>\n\nThis closes #1230 from sijie/fix_npe, closes #1229\n", "commitGitStats": [{"lines": 11, "deletions": 6, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java"}, {"lines": 78, "deletions": 0, "insertions": 78, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/PendingAddOpTest.java"}, {"lines": 4, "deletions": 0, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java"}], "commitParents": ["d0c9a9a2c7d6e8a606b1edaf71936b7fa1df95eb"], "commitDateTime": "2018-03-12 16:41:30", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-03-05 19:13:14"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "priority/important", "release/4.6.2", "release/4.7.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "PendingAddOp can get recycled before it gets executed", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\nScenario:\r\n1. many async writes submitted/pending for the same ledger.\r\n2. Write fails due to not enough bookies.\r\n3. Ledger handle cancels all pending adds. \r\n4. PendingAddOps of these adds get recycled.\r\n5. Pending add finally gets its chance to execute.\r\n6. LH at that point happens to be null (recycled already) hence Preconditions.checkNotNull throws exception.\r\n7. Exception is logged and swallowed by SafeRunnable.\r\n\r\nProblems:\r\n- unnecessary exceptions affecting performance and generating garbage in the log.\r\n- it is possible that recycled op gets reused and executed instead of original one. I think it is possible to get second write of the same entry to single bookie in this case in leu of write to another bookie though I did not try to repro that specific case.\r\n\r\n\r\nMinimized version of repro, worked on current master / 3e51b8116c363604f93bdd0c6b6b71ef3387c8a8 :\r\n\r\nthrow in the following test into SlowBookieTest suite:\r\n\r\n```java\r\n    @Test\r\n    public void testBookieFailure() throws Exception {\r\n        ClientConfiguration conf = new ClientConfiguration();\r\n        conf.setReadTimeout(5)\r\n                .setAddEntryQuorumTimeout(5)\r\n                .setAddEntryQuorumTimeout(10)\r\n                .setZkServers(zkUtil.getZooKeeperConnectString());\r\n\r\n        BookKeeper bkc = new BookKeeper(conf);\r\n\r\n        byte[] pwd = new byte[] {};\r\n        final LedgerHandle lh = bkc.createLedger(4, 4, 3, BookKeeper.DigestType.CRC32, pwd);\r\n        final AtomicBoolean finished = new AtomicBoolean(false);\r\n        final AtomicBoolean failTest = new AtomicBoolean(false);\r\n        final byte[] entry = \"Test Entry\".getBytes();\r\n\r\n        Thread t = new Thread(() -> {\r\n            try {\r\n                while (!finished.get()) {\r\n                    lh.asyncAddEntry(entry, (rc, lh1, entryId, ctx) -> {\r\n                        if (rc != BKException.Code.OK) {\r\n                            failTest.set(true);\r\n                            finished.set(true);\r\n                        }\r\n                    }, null);\r\n                }\r\n            } catch (Exception e) {\r\n                LOG.error(\"Exception in add entry thread\", e);\r\n                failTest.set(true);\r\n            }\r\n        });\r\n\r\n        killBookie(0);\r\n\r\n        t.start();\r\n\r\n        Thread.sleep(2_000);\r\n\r\n        finished.set(true);\r\n        t.join();\r\n\r\n        assertFalse(failTest.get());\r\n\r\n        lh.close();\r\n\r\n        LedgerHandle lh2 = bkc.openLedger(lh.getId(), BookKeeper.DigestType.CRC32, pwd);\r\n        LedgerChecker lc = new LedgerChecker(bkc);\r\n        final CountDownLatch checklatch = new CountDownLatch(1);\r\n        final AtomicInteger numFragments = new AtomicInteger(-1);\r\n        lc.checkLedger(lh2, new GenericCallback<Set<LedgerFragment>>() {\r\n            public void operationComplete(int rc, Set<LedgerFragment> fragments) {\r\n                LOG.debug(\"Checked ledgers returned {} {}\", rc, fragments);\r\n                if (rc == BKException.Code.OK) {\r\n                    numFragments.set(fragments.size());\r\n                    LOG.error(\"Checked ledgers returned {} {}\", rc, fragments);\r\n                }\r\n                checklatch.countDown();\r\n            }\r\n        });\r\n        checklatch.await();\r\n        assertEquals(\"There should be no missing fragments\", 0, numFragments.get());\r\n    }\r\n```\r\n\r\nNote log messages after execution:\r\n\r\n```\r\n2018-03-05 13:41:43,751 - WARN  - [BookKeeperClientWorker-OrderedSafeExecutor-0-0:RackawareEnsemblePlacementPolicyImpl@695] - Failed to choose a bookie: excluded [<Bookie:127.0.0.1:50656>, <Bookie:127.0.0.1:50660>, <Bookie:127.0.0.1:50662>, <Bookie:127.0.0.1:50658>], fallback to choose bookie randomly from the cluster.\r\n2018-03-05 13:41:43,751 - WARN  - [BookKeeperClientWorker-OrderedSafeExecutor-0-0:RackawareEnsemblePlacementPolicyImpl@886] - Failed to find 1 bookies : excludeBookies [<Bookie:127.0.0.1:50656>, <Bookie:127.0.0.1:50660>, <Bookie:127.0.0.1:50662>, <Bookie:127.0.0.1:50658>], allBookies [].\r\n2018-03-05 13:41:43,751 - ERROR - [BookKeeperClientWorker-OrderedSafeExecutor-0-0:LedgerHandle@1652] - Could not get additional bookie to remake ensemble, closing ledger: 0\r\n2018-03-05 13:41:43,751 - ERROR - [BookKeeperClientWorker-OrderedSafeExecutor-0-0:LedgerHandle@1495] - Closing ledger 0 due to NotEnoughBookiesException: Not enough non-faulty bookies available\r\n2018-03-05 13:41:43,751 - ERROR - [BookKeeperClientWorker-OrderedSafeExecutor-0-0:SafeRunnable@38] - Unexpected throwable caught \r\njava.lang.NullPointerException\r\n\tat com.google.common.base.Preconditions.checkNotNull(Preconditions.java:770)\r\n\tat org.apache.bookkeeper.client.PendingAddOp.safeRun(PendingAddOp.java:229)\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.java:138)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\n2018-03-05 13:41:43,751 - ERROR - [BookKeeperClientWorker-OrderedSafeExecutor-0-0:SafeRunnable@38] - Unexpected throwable caught \r\njava.lang.NullPointerException\r\n\tat com.google.common.base.Preconditions.checkNotNull(Preconditions.java:770)\r\n\tat org.apache.bookkeeper.client.PendingAddOp.safeRun(PendingAddOp.java:229)\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n\tat io.netty.util.concurrent.DefaultThreadFactory$DefaultRunnableDecorator.run(DefaultThreadFactory.java:138)\r\n\tat java.lang.Thread.run(Thread.java:745)\r\n```\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"fbc06ef3139ca857c60a2edbc209c8b088e979df": {"commitUser": "sijie", "commitGHEventType": "closed"}, "b59dab59020e11ff2fa6fab342081a3f90c22b03": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-03-06 03:13:22", "url": "https://github.com/apache/bookkeeper/issues/1229", "user": "dlg99", "ttf": 0.0002777777777777778}, {"created": "2018-02-18 10:06:05", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BKAbstractLogWriter.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.distributedlog.BKAbstractLogWriter.getLastTruncationAttempt()"}]}, {"spoonFilePath": "TestTruncate.java", "spoonMethods": [{"INS": 2, "DEL": 1, "TOT": 13, "MOV": 4, "UPD": 6, "spoonMethodName": "org.apache.distributedlog.TestTruncate.testPurgeLogs()"}]}], "nameRev": "9db6e919b023c9e3833c51b34c83d6c482b1e659 tags/release-4.8.1~338", "commitHash": "9db6e919b023c9e3833c51b34c83d6c482b1e659", "commitMessage": "Issue #1164: TestTruncate#testPurgeLogs is flaky\n\nDescriptions of the changes in this PR:\n\n*Problem*\n\nlog segments are truncated in the background after TTL. the truncation is done asynchronously.\nso when we finish writing all the log records, the truncation might still not complete yet.\n\n*Solution*\n\nImprove the test case to wait until the last truncation attempt is completed before asserting the log segments\n\nMaster Issue: #1164\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #1165 from sijie/fix_test_truncate, closes #1164\n", "commitGitStats": [{"lines": 21, "deletions": 7, "insertions": 14, "filePath": "stream/distributedlog/core/src/test/java/org/apache/distributedlog/TestTruncate.java"}, {"lines": 5, "deletions": 0, "insertions": 5, "filePath": "stream/distributedlog/core/src/main/java/org/apache/distributedlog/BKAbstractLogWriter.java"}], "commitParents": ["13dc9230e79c0ecbc30b8b804e506b978c3f9cb1"], "commitDateTime": "2018-02-20 11:37:42", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-02-20 11:37:42"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/dlog", "area/tests", "release/4.7.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "TestTruncate#testPurgeLogs fails on postcommit CI", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nrun `TestTruncate#testPurgeLogs`\r\n\r\n- What did you expect to see?\r\n\r\nThe test should pass\r\n\r\n- What did you see instead?\r\n\r\nThe test case failed with assertions of number of log segments after truncation.\r\n\r\n```\r\nError Message\r\nexpected:<6> but was:<7>\r\nStacktrace\r\njava.lang.AssertionError: expected:<6> but was:<7>\r\n\tat org.apache.distributedlog.TestTruncate.testPurgeLogs(TestTruncate.java:112)\r\n```\r\n\r\nExample runs can be found at: https://builds.apache.org/job/bookkeeper_postcommit_master_java8/org.apache.distributedlog$distributedlog-core/41/testReport/junit/org.apache.distributedlog/TestTruncate/testPurgeLogs/\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"9db6e919b023c9e3833c51b34c83d6c482b1e659": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2018-02-20 19:37:57", "url": "https://github.com/apache/bookkeeper/issues/1164", "user": "sijie", "ttf": 2.000277777777778}, {"created": "2018-02-12 15:22:11", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "8dcbda6e27947c64437aa7e38455f57bd25ecc43 tags/release-4.6.2~20", "commitHash": "8dcbda6e27947c64437aa7e38455f57bd25ecc43", "commitMessage": "Issue-1143 Error on Java 9 using BookKeeperAdmin API and bookkeeper-server-shaded\n\nUpdate Maven Shade Plugin to 3.1.0\n\nRelates to issue #1143\n\nAuthor: Enrico Olivelli <eolivelli@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #1144 from eolivelli/fix/update-shade-plugin\n\n(cherry picked from commit dcb22dddf5a7d97d7c320605facb142cc836c5fd)\nSigned-off-by: Enrico Olivelli <eolivelli@apache.org>\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "pom.xml"}], "commitParents": ["955f7aceaefa9df131447f6005f4a16a50bc7172"], "commitDateTime": "2018-02-13 10:52:22", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-02-13 10:51:54"}, {"commitSpoonAstDiffStats": [], "nameRev": "dcb22dddf5a7d97d7c320605facb142cc836c5fd tags/release-4.8.1~389", "commitHash": "dcb22dddf5a7d97d7c320605facb142cc836c5fd", "commitMessage": "Issue-1143 Error on Java 9 using BookKeeperAdmin API and bookkeeper-server-shaded\n\nUpdate Maven Shade Plugin to 3.1.0\n\nRelates to issue #1143\n\nAuthor: Enrico Olivelli <eolivelli@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #1144 from eolivelli/fix/update-shade-plugin\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "pom.xml"}], "commitParents": ["e2b93f28813556c1971a04c1ffe4b65cbe40c427"], "commitDateTime": "2018-02-13 10:51:54", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-02-13 10:51:54"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "priority/important", "release/4.6.2", "release/4.7.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Error on Java 9 using BookKeeperAdmin API and bookkeeper-server-shaded artifact", "numCommits": 0, "body": "I am using 4.6.1 bookkeeper-server-shaded, I get this only in some unit tests, not in \"real\" environments on Java 9\r\n\r\nThis is due to a bug in Maven Shade Plugin\r\n\r\n{code}\r\njava.lang.RuntimeException: java.lang.IncompatibleClassChangeError: Inconsistent constant\r\npool data in classfile for class org/apache/bookkeeper/versioning/Version. Method lambda$static$0(Lorg/apache/bookkeeper/versioning/Version;)Lorg/apache/bookkeeper/versioning/Version$Occurred; at index 51 is CONSTANT_MethodRef and should be CONSTANT_InterfaceMethodRef\r\n    at xxxxx.tasklog.TaskLoggerTest.test(TaskLoggerTest.java:75)\r\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n    at java.base/java.lang.reflect.Method.invoke(Method.java:564)\r\n    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)\r\n    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)\r\n    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n    at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)\r\n    at org.junit.rules.RunRules.evaluate(RunRules.java:20)\r\n    at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)\r\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)\r\n    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)\r\n    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)\r\n    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)\r\n    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)\r\n    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)\r\n    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)\r\n    at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n    at org.junit.runners.ParentRunner.run(ParentRunner.java:309)\r\n    at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:369)\r\n    at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:275)\r\n    at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:239)\r\n    at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:160)\r\n    at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:373)\r\n    at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:334)\r\n    at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:119)\r\n    at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:407)\r\nCaused by: java.lang.IncompatibleClassChangeError: Inconsistent constant pool data in classfile for class org/apache/bookkeeper/versioning/Version. Method lambda$static$0(Lorg/apache/bookkeeper/versioning/Version;)Lorg/apache/bookkeeper/versioning/Version$Occurred; at index 51 is CONSTANT_MethodRef and should be CONSTANT_InterfaceMethodRef\r\n    at org.apache.bookkeeper.versioning.Version.<clinit>(Version.java:47)\r\n    at org.apache.bookkeeper.discover.ZKRegistrationClient$WatchTask.<init>(ZKRegistrationClient.java:79)\r\n    at org.apache.bookkeeper.discover.ZKRegistrationClient.watchWritableBookies(ZKRegistrationClient.java:287)\r\n    at org.apache.bookkeeper.client.BookieWatcher.initialBlockingBookieRead(BookieWatcher.java:152)\r\n    at org.apache.bookkeeper.client.BookKeeper.<init>(BookKeeper.java:506)\r\n    at org.apache.bookkeeper.client.BookKeeper.<init>(BookKeeper.java:365)\r\n    at org.apache.bookkeeper.client.BookKeeperAdmin.format(BookKeeperAdmin.java:1181)\r\n    at ......\r\n{code}", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"8dcbda6e27947c64437aa7e38455f57bd25ecc43": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}, "dcb22dddf5a7d97d7c320605facb142cc836c5fd": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}}, "closed": "2018-02-13 13:44:18", "url": "https://github.com/apache/bookkeeper/issues/1143", "user": "eolivelli", "ttf": 0.0002777777777777778}, {"created": "2018-02-07 02:17:41", "closed": "2018-03-12 23:43:11", "title": "ZK Ledger Manager doesn't handle zookeeper session expires", "url": "https://github.com/apache/bookkeeper/issues/1126", "body": "\r\n\r\n**BUG REPORT**\r\n\r\n*Problem*\r\n\r\n@jvrao mentioned this at slack channel\r\n\r\n```\r\nJust trying to understand the current code in the following scenario:\r\n\r\nTwo clients\r\nClient-1 writing a ledger\r\nClient-2 tailing the same ledger (with lac updates etc)\r\nclient-2 lost connection with ZK\r\nclient-1 lost connection with bookies and replaced entire ensemble.\r\nNow client-2 can't get ensemble change update as its lots its session\r\nalso client-2 can't read new LAC as all bookies that it is talking to have old LAC\r\nand apparently we don't handle session expiry on readonly ledger handle watcher\r\nso what happens?\r\nthe reader hangs for-ever?\r\n```\r\n\r\nThe expected behavior : ledger manager will handle session expires and register watcher on the ledger metadata. However in current apache/master there is no session expire handling logic in ledger manager. This logic exists only at twitter/master.\r\n\r\nThis issue is to port that change back from twitter/master to apache/master.", "commits": {}, "user": "sijie", "commitsDetails": [], "labels": ["area/client", "area/metadata", "priority/important", "release/4.6.2", "release/4.7.0", "type/bug"], "ttf": 33.000277777777775}, {"created": "2018-01-15 16:20:32", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "25b0d93405e87efeb35ca50cbd04ab14488ceaea tags/release-4.8.1~470", "commitHash": "25b0d93405e87efeb35ca50cbd04ab14488ceaea", "commitMessage": "Issue #981: Revert \"ISSUE #561: Remove exec commands to start in the shell pid\"\n\nThis reverts commit 7d7497b70507ea3d31b184ebe04d98c733e2cf5b.\n\nAuthor: Ivan Kelly <ivank@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>, Sijie Guo <sijie@apache.org>\n\nThis closes #994 from ivankelly/revert-exec, closes #981, closes #561\n", "commitGitStats": [{"lines": 12, "deletions": 6, "insertions": 6, "filePath": "bookkeeper-server/bin/bookkeeper"}], "commitParents": ["1f0d15356ef10c8ebb14dfb3048b66dbec6c0260"], "commitDateTime": "2018-01-17 16:08:02", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-01-17 16:08:02"}, {"commitSpoonAstDiffStats": [], "nameRev": "ed7fd114444a9f8f392ca026328eb9d4541f3e50 tags/release-4.6.2~34", "commitHash": "ed7fd114444a9f8f392ca026328eb9d4541f3e50", "commitMessage": "Issue #981: Revert \"ISSUE #561: Remove exec commands to start in the shell pid\"\n\nThis reverts commit 7d7497b70507ea3d31b184ebe04d98c733e2cf5b.\n\nAuthor: Ivan Kelly <ivank@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>, Sijie Guo <sijie@apache.org>\n\nThis closes #994 from ivankelly/revert-exec, closes #981, closes #561\n\n(cherry picked from commit 25b0d93405e87efeb35ca50cbd04ab14488ceaea)\nSigned-off-by: Enrico Olivelli <eolivelli@apache.org>\n", "commitGitStats": [{"lines": 12, "deletions": 6, "insertions": 6, "filePath": "bookkeeper-server/bin/bookkeeper"}], "commitParents": ["569a4822595d31e1929d096588290e5719723dbc"], "commitDateTime": "2018-01-17 16:08:16", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-01-17 16:08:02"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["priority/important", "release/4.6.1", "release/4.7.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "SIGTERM on bookkeeper script not propagated to java process", "numCommits": 0, "body": "> What did you do?\r\n\r\nRun bin/bookkeeper bookie from supervisord or systemd or some other supervisor.\r\n\r\n> What did you expect to see?\r\n\r\nWhen I stop the unit, the bookie should shutdown.\r\n\r\n> What did you see instead?\r\n\r\nThe bookie does not go down.\r\n\r\nThis problem is 4.6.0+ only. \r\nSeems to be caused by https://github.com/apache/bookkeeper/pull/557/file\r\n\r\n@aahmed-se Do you recall why you made this change in the first place?\r\n\r\nThis is problematic as it'll leave zombie bookie processes. It's also a break from pre 4.6 behaviour.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"25b0d93405e87efeb35ca50cbd04ab14488ceaea": {"commitUser": "eolivelli", "commitGHEventType": "closed"}, "ed7fd114444a9f8f392ca026328eb9d4541f3e50": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}}, "closed": "2018-01-17 15:08:11", "url": "https://github.com/apache/bookkeeper/issues/981", "user": "ivankelly", "ttf": 1.0002777777777778}, {"created": "2018-01-05 21:25:36", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerDirsManager.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 3, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerDirsManager"}]}, {"spoonFilePath": "TestLedgerDirsManager.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestLedgerDirsManager.setUp()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestLedgerDirsManager"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestLedgerDirsManager.testLedgerDirsMonitorHandlingWithMultipleLedgerDirectories()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestLedgerDirsManager.getGauge(java.lang.String)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestLedgerDirsManager.testGetWritableDir()"}, {"INS": 8, "DEL": 0, "TOT": 8, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestLedgerDirsManager.setUsageAndThenVerify(java.io.File,float,java.io.File,float,org.apache.bookkeeper.bookie.TestLedgerDirsManager$MockDiskChecker,org.apache.bookkeeper.bookie.TestLedgerDirsManager$MockLedgerDirsListener,boolean)"}]}, {"spoonFilePath": "TestStatsProvider.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.test.TestStatsProvider.getStatsLogger(java.lang.String)"}]}], "nameRev": "1a8b35d38737f6d043995a756da10ea111268b4a tags/release-4.8.1~496", "commitHash": "1a8b35d38737f6d043995a756da10ea111268b4a", "commitMessage": "ISSUE #954: dir_*_usage stats are always 0\n\ndue to mismatch between the way they are initialized in `LedgerDirsManager` and\nthe way the `diskUsages` is populated subsequently in `LedgerDirsMonitor`\n\nDecisions potentially worth some attention:\n- stat names are kept `dir_{dir}_usage` while the actual dirs being checked have been changed to `{dir}/current`;\n- the stats aren't being updated if the bookie is in a readonly mode -- uncovered while testing, not sure if it's worth addressing at all, kept the fix minimalistic for now.\n\n(bug W-4594204)\n\nAuthor: Pasha Kuznetsov <pkuznetsov@salesforce.com>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>, Sijie Guo <sijie@apache.org>\n\nThis closes #957 from pasha-kuznetsov/dir-usage-stats, closes #954\n", "commitGitStats": [{"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerDirsManager.java"}, {"lines": 36, "deletions": 3, "insertions": 33, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/TestLedgerDirsManager.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/test/TestStatsProvider.java"}], "commitParents": ["d320936c00c3eeae0a4e2795f0a9bfa780fd6f98"], "commitDateTime": "2018-01-06 21:34:46", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-01-06 21:34:46"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerDirsManager.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 3, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerDirsManager"}]}, {"spoonFilePath": "TestLedgerDirsManager.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestLedgerDirsManager.setUp()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestLedgerDirsManager"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestLedgerDirsManager.testLedgerDirsMonitorHandlingWithMultipleLedgerDirectories()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestLedgerDirsManager.getGauge(java.lang.String)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestLedgerDirsManager.testGetWritableDir()"}, {"INS": 8, "DEL": 0, "TOT": 8, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestLedgerDirsManager.setUsageAndThenVerify(java.io.File,float,java.io.File,float,org.apache.bookkeeper.bookie.TestLedgerDirsManager$MockDiskChecker,org.apache.bookkeeper.bookie.TestLedgerDirsManager$MockLedgerDirsListener,boolean)"}]}, {"spoonFilePath": "TestStatsProvider.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.test.TestStatsProvider.getStatsLogger(java.lang.String)"}]}], "nameRev": "1c4181bcf798dbaa8d3694139b48475a9e215b17 tags/release-4.6.2~41", "commitHash": "1c4181bcf798dbaa8d3694139b48475a9e215b17", "commitMessage": "ISSUE #954: dir_*_usage stats are always 0\n\ndue to mismatch between the way they are initialized in `LedgerDirsManager` and\nthe way the `diskUsages` is populated subsequently in `LedgerDirsMonitor`\n\nDecisions potentially worth some attention:\n- stat names are kept `dir_{dir}_usage` while the actual dirs being checked have been changed to `{dir}/current`;\n- the stats aren't being updated if the bookie is in a readonly mode -- uncovered while testing, not sure if it's worth addressing at all, kept the fix minimalistic for now.\n\n(bug W-4594204)\n\nAuthor: Pasha Kuznetsov <pkuznetsov@salesforce.com>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>, Sijie Guo <sijie@apache.org>\n\nThis closes #957 from pasha-kuznetsov/dir-usage-stats, closes #954\n", "commitGitStats": [{"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerDirsManager.java"}, {"lines": 39, "deletions": 5, "insertions": 34, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/TestLedgerDirsManager.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/test/TestStatsProvider.java"}], "commitParents": ["9007abd6e7fcdbc4953b917231608c0f80cae12c"], "commitDateTime": "2018-01-08 16:58:04", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-01-06 21:34:46"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "release/4.6.1", "release/4.7.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "dir_*_usage stats are always 0", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nNormal BK operation\r\n\r\n- What did you expect to see?\r\n\r\n`dir_*_usage` gauges to contain dir usage %\r\n\r\n- What did you see instead?\r\n\r\n`dir_*_usage` gauges are always `0` due to mismatch between the way they are initialized in `LedgerDirsManager`:\r\n\r\n```\r\n    LedgerDirsManager(ServerConfiguration conf, File[] dirs, DiskChecker diskChecker, StatsLogger statsLogger) {\r\n        this.ledgerDirectories = Arrays.asList(Bookie\r\n                .getCurrentDirectories(dirs)); // <------------- NOTE adding \"/current\" here\r\n        this.writableLedgerDirectories = new ArrayList<File>(ledgerDirectories);\r\n        this.filledDirs = new ArrayList<File>();\r\n        ...\r\n        for (File dir : dirs) { // <------------- NOTE using the original dirs\r\n            diskUsages.put(dir, 0f);\r\n            String statName = \"dir_\" + dir.getPath().replace('/', '_') + \"_usage\";\r\n            final File targetDir = dir;\r\n            statsLogger.registerGauge(statName, new Gauge<Number>() {\r\n                ...\r\n                @Override\r\n                public Number getSample() {\r\n                    return diskUsages.get(targetDir) * 100;\r\n                }\r\n            });\r\n        }\r\n```\r\nand the way the `diskUsages` is populated subsequently in `LedgerDirsMonitor`:\r\n```\r\n    @Override\r\n    public void run() {\r\n        while (true) {\r\n            try {\r\n                List<File> writableDirs = ldm.getWritableLedgerDirs();\r\n                // Check all writable dirs disk space usage.\r\n                for (File dir : writableDirs) {\r\n                    try {\r\n                        diskUsages.put(dir, diskChecker.checkDir(dir)); // <------------- NOTE that writableDirs has \"/current\" appended\r\n                ...\r\n            try {\r\n                if (hasWritableLedgerDirs\r\n                        || (totalDiskUsage = diskChecker.getTotalDiskUsage(ldm.getAllLedgerDirs())) < conf\r\n                                .getDiskLowWaterMarkUsageThreshold()) {\r\n                    // Check all full-filled disk space usage\r\n                    for (File dir : fullfilledDirs) {\r\n                        try {\r\n                            diskUsages.put(dir, diskChecker.checkDir(dir)); // <------------- NOTE that fullfilledDirs has \"/current\" appended\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"1a8b35d38737f6d043995a756da10ea111268b4a": {"commitUser": "sijie", "commitGHEventType": "closed"}, "1c4181bcf798dbaa8d3694139b48475a9e215b17": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2018-01-07 05:34:57", "url": "https://github.com/apache/bookkeeper/issues/954", "user": "pasha-kuznetsov", "ttf": 1.0002777777777778}, {"created": "2017-12-27 10:35:15", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BookKeeperServerShadedArtifactTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.shaded.BookKeeperServerShadedArtifactTest"}]}, {"spoonFilePath": "BookKeeperServerShadedJarTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.shaded.BookKeeperServerShadedJarTest"}]}, {"spoonFilePath": "BookKeeperServerTestsShadedJarTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.shaded.BookKeeperServerTestsShadedJarTest"}]}], "nameRev": "1ed78912907cd2157f0b93ecaa653923ede4365c tags/release-4.8.1~503", "commitHash": "1ed78912907cd2157f0b93ecaa653923ede4365c", "commitMessage": "ISSUE #922: changes to shading bookkeeper-server jar\n\nDescriptions of the changes in this PR:\n\n**Problem:**\n\n`shadedArtifactAttached` was introduced in 4.6.0 to generate plain and shaded artifact for `bookkeeper-server`. Because for projects (e.g. distributedlog) that would use same protobuf and guava version as bookkeeper, they will use the plain artifact (to avoid shading protobuf/guava multiple times). However there are a few problems with that:\n\n1) bookkeeper-common is not included in the shading include set.\n2) `shadedArtifactAttached` only generate a shaded artifact (with relocated classes), but doesn't generate a dependency-reduced pom file. so you have to manually exclude relocated dependencies.\n\n**Solutions:**\n\n- for shaded artifact of `bookkeeper-server`, include all the bookkeeper submodules that bookkeeper-server depends on. so the shaded artifact includes all the classes that need to be relocated.\n- introduce a `shaded` module for keeping new shaded libraries. Currently `bookkeeper-server-shaded` is a shaded module of `bookkeeper-server`, while `bookkeeper-server-tests-shaded` is a shaded moulde of the tests jar of `bookkeeper-server`.\n- update the client api documentation about the instructions on how to use shaded artifact of `bookkeeper-server` and the new shaded module `bookkeeper-server-shaded`.\n- add test cases to verify the shaded artifact and the new shaded modules generate the right artifacts.\n\n**This change doesn't address:**\n\nCurrently both client and server are bundled in one `bookkeeper-server`. this change will not introduce any shaded client-only jar. that would be deferred until we split `bookkeeper-server` module.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #928 from sijie/fix_shading, closes #922\n", "commitGitStats": [{"lines": 1, "deletions": 0, "insertions": 1, "filePath": "pom.xml"}, {"lines": 3, "deletions": 0, "insertions": 3, "filePath": "tests/pom.xml"}, {"lines": 34, "deletions": 0, "insertions": 34, "filePath": "shaded/pom.xml"}, {"lines": 63, "deletions": 0, "insertions": 63, "filePath": "site/docs/latest/api/ledger-api.md"}, {"lines": 142, "deletions": 0, "insertions": 142, "filePath": "shaded/bookkeeper-server-tests-shaded/pom.xml"}, {"lines": 116, "deletions": 0, "insertions": 116, "filePath": "tests/bookkeeper-server-tests-shaded-test/pom.xml"}, {"lines": 125, "deletions": 0, "insertions": 125, "filePath": "shaded/bookkeeper-server-shaded/pom.xml"}, {"lines": 54, "deletions": 0, "insertions": 54, "filePath": "tests/bookkeeper-server-tests-shaded-test/src/test/java/org/apache/bookkeeper/tests/shaded/BookKeeperServerTestsShadedJarTest.java"}, {"lines": 93, "deletions": 0, "insertions": 93, "filePath": "tests/bookkeeper-server-shaded-artifact-test/pom.xml"}, {"lines": 46, "deletions": 39, "insertions": 7, "filePath": "bookkeeper-server/pom.xml"}, {"lines": 62, "deletions": 0, "insertions": 62, "filePath": "tests/bookkeeper-server-shaded-artifact-test/src/test/java/org/apache/bookkeeper/tests/shaded/BookKeeperServerShadedArtifactTest.java"}, {"lines": 96, "deletions": 0, "insertions": 96, "filePath": "tests/bookkeeper-server-shaded-test/pom.xml"}, {"lines": 62, "deletions": 0, "insertions": 62, "filePath": "tests/bookkeeper-server-shaded-test/src/test/java/org/apache/bookkeeper/tests/shaded/BookKeeperServerShadedJarTest.java"}], "commitParents": ["1f8b26d5f02ae6bccf0d586bcb145f4461f4fde6"], "commitDateTime": "2017-12-30 10:52:35", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-12-30 10:52:35"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "BookKeeperServerShadedArtifactTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.shaded.BookKeeperServerShadedArtifactTest"}]}, {"spoonFilePath": "BookKeeperServerShadedJarTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.shaded.BookKeeperServerShadedJarTest"}]}, {"spoonFilePath": "BookKeeperServerTestsShadedJarTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.tests.shaded.BookKeeperServerTestsShadedJarTest"}]}], "nameRev": "99f2e548c3485a658a1bf8ae57268d12bb028cbd tags/release-4.6.2~44", "commitHash": "99f2e548c3485a658a1bf8ae57268d12bb028cbd", "commitMessage": "Issue 922: changes to shading bookkeeper-server jar for branch-4.6 (#929)\n\nDescriptions of the changes in this PR:\r\n\r\n**Problem:**\r\n\r\n`shadedArtifactAttached` was introduced in 4.6.0 to generate plain and shaded artifact for `bookkeeper-server`. Because for projects (e.g. distributedlog) that would use same protobuf and guava version as bookkeeper, they will use the plain artifact (to avoid shading protobuf/guava multiple times). However there are a few problems with that:\r\n\r\n1) bookkeeper-common is not included in the shading include set.\r\n2) `shadedArtifactAttached` only generate a shaded artifact (with relocated classes), but doesn't generate a dependency-reduced pom file. so you have to manually exclude relocated dependencies.\r\n\r\n**Solutions:**\r\n\r\n- for shaded artifact of `bookkeeper-server`, include all the bookkeeper submodules that bookkeeper-server depends on. so the shaded artifact includes all the classes that need to be relocated.\r\n- introduce a `shaded` module for keeping new shaded libraries. Currently `bookkeeper-server-shaded` is a shaded module of `bookkeeper-server`, while `bookkeeper-server-tests-shaded` is a shaded moulde of the tests jar of `bookkeeper-server`.\r\n- update the client api documentation about the instructions on how to use shaded artifact of `bookkeeper-server` and the new shaded module `bookkeeper-server-shaded`.\r\n- add test cases to verify the shaded artifact and the new shaded modules generate the right artifacts.\r\n\r\n**This change doesn't address:**\r\n\r\nCurrently both client and server are bundled in one `bookkeeper-server`. this change will not introduce any shaded client-only jar. that would be deferred until we split `bookkeeper-server` module.\r\n\r\nAuthor: Sijie Guo <sijie@apache.org>\r\n\r\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\r\n\r\nThis closes #928 from sijie/fix_shading, closes #922\r\n\r\nThis closes #922 \r\n\r\nSigned-off-by: Jia Zhai <zhaijia@apache.org>\r\n\r\n* change 4.7.0 into 4.6.0\r\n", "commitGitStats": [{"lines": 1, "deletions": 0, "insertions": 1, "filePath": "pom.xml"}, {"lines": 3, "deletions": 0, "insertions": 3, "filePath": "tests/pom.xml"}, {"lines": 34, "deletions": 0, "insertions": 34, "filePath": "shaded/pom.xml"}, {"lines": 63, "deletions": 0, "insertions": 63, "filePath": "site/docs/latest/api/ledger-api.md"}, {"lines": 142, "deletions": 0, "insertions": 142, "filePath": "shaded/bookkeeper-server-tests-shaded/pom.xml"}, {"lines": 116, "deletions": 0, "insertions": 116, "filePath": "tests/bookkeeper-server-tests-shaded-test/pom.xml"}, {"lines": 125, "deletions": 0, "insertions": 125, "filePath": "shaded/bookkeeper-server-shaded/pom.xml"}, {"lines": 54, "deletions": 0, "insertions": 54, "filePath": "tests/bookkeeper-server-tests-shaded-test/src/test/java/org/apache/bookkeeper/tests/shaded/BookKeeperServerTestsShadedJarTest.java"}, {"lines": 93, "deletions": 0, "insertions": 93, "filePath": "tests/bookkeeper-server-shaded-artifact-test/pom.xml"}, {"lines": 46, "deletions": 39, "insertions": 7, "filePath": "bookkeeper-server/pom.xml"}, {"lines": 62, "deletions": 0, "insertions": 62, "filePath": "tests/bookkeeper-server-shaded-artifact-test/src/test/java/org/apache/bookkeeper/tests/shaded/BookKeeperServerShadedArtifactTest.java"}, {"lines": 96, "deletions": 0, "insertions": 96, "filePath": "tests/bookkeeper-server-shaded-test/pom.xml"}, {"lines": 62, "deletions": 0, "insertions": 62, "filePath": "tests/bookkeeper-server-shaded-test/src/test/java/org/apache/bookkeeper/tests/shaded/BookKeeperServerShadedJarTest.java"}], "commitParents": ["538755fbb5eca1220a7b5d7f6663e5bb9148e71b"], "commitDateTime": "2018-01-02 00:02:42", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-01-02 16:02:42"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "release/4.6.1", "release/4.7.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Bookie and BookKeeperAdmin and BookKeeper client does not use shaded Protobuf JAR", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\nBookie depends on non-shaded Google Protobuf 3.4.0\r\n\r\n- What did you do?\r\nStart a Bookie (embedded) without Protobuf on the classpath\r\n\r\n- What did you expect to see?\r\nThe Bookie should start, because we are shading and relocating Protobuf\r\n\r\n- What did you see instead?\r\n\r\nThis is the error on BookKeeper client:\r\n```\r\njava.lang.NoClassDefFoundError: com/google/protobuf/GeneratedMessageV3\r\n        at java.lang.ClassLoader.defineClass1(Native Method)\r\n        at java.lang.ClassLoader.defineClass(ClassLoader.java:763)\r\n        at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)\r\n        at java.net.URLClassLoader.defineClass(URLClassLoader.java:467)\r\n        at java.net.URLClassLoader.access$100(URLClassLoader.java:73)\r\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:368)\r\n        at java.net.URLClassLoader$1.run(URLClassLoader.java:362)\r\n        at java.security.AccessController.doPrivileged(Native Method)\r\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:361)\r\n        at magnews.server.ServiceClassLoader.findClass(ServiceClassLoader.java:105)\r\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\n        at org.apache.bookkeeper.client.LedgerMetadata.parseConfig(LedgerMetadata.java:459)\r\n        at org.apache.bookkeeper.meta.AbstractZkLedgerManager$3.processResult(AbstractZkLedgerManager.java:389)\r\n```\r\n\r\nThis is the error on BookKeeperAdmin:\r\n```\r\n\r\nCaused by: java.lang.NoClassDefFoundError: com/google/protobuf/ExtensionRegistry\r\n\tat org.apache.bookkeeper.proto.BookieClient.<init>(BookieClient.java:108)\r\n\tat org.apache.bookkeeper.client.BookKeeper.<init>(BookKeeper.java:492)\r\n\tat org.apache.bookkeeper.client.BookKeeper.<init>(BookKeeper.java:365)\r\n\tat org.apache.bookkeeper.client.BookKeeperAdmin.format(BookKeeperAdmin.java:1181)\r\n```\r\n\r\nThis is the error on Bookie:\r\n\r\n```\r\n2017-12-27-11-22-11.938 Caused by: java.lang.NoClassDefFoundError: com/google/protobuf/GeneratedMessageV3\r\n2017-12-27-11-22-11.938 \tat java.lang.ClassLoader.defineClass1(Native Method)\r\n2017-12-27-11-22-11.938 \tat java.lang.ClassLoader.defineClass(ClassLoader.java:763)\r\n2017-12-27-11-22-11.939 \tat java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)\r\n2017-12-27-11-22-11.939 \tat java.net.URLClassLoader.defineClass(URLClassLoader.java:467)\r\n2017-12-27-11-22-11.939 \tat java.net.URLClassLoader.access$100(URLClassLoader.java:73)\r\n2017-12-27-11-22-11.940 \tat java.net.URLClassLoader$1.run(URLClassLoader.java:368)\r\n2017-12-27-11-22-11.940 \tat java.net.URLClassLoader$1.run(URLClassLoader.java:362)\r\n2017-12-27-11-22-11.940 \tat java.security.AccessController.doPrivileged(Native Method)\r\n2017-12-27-11-22-11.941 \tat java.net.URLClassLoader.findClass(URLClassLoader.java:361)\r\n2017-12-27-11-22-11.941 \tat magnews.server.ServiceClassLoader.findClass(ServiceClassLoader.java:105)\r\n2017-12-27-11-22-11.942 \tat java.lang.ClassLoader.loadClass(ClassLoader.java:424)\r\n2017-12-27-11-22-11.942 \tat java.lang.ClassLoader.loadClass(ClassLoader.java:357)\r\n2017-12-27-11-22-11.942 \tat org.apache.bookkeeper.bookie.Cookie.parse(Cookie.java:199)\r\n2017-12-27-11-22-11.943 \tat org.apache.bookkeeper.bookie.Cookie.readFromRegistrationManager(Cookie.java:336)\r\n2017-12-27-11-22-11.943 \tat org.apache.bookkeeper.bookie.Bookie.readAndVerifyCookieFromRegistrationManager(Bookie.java:363)\r\n2017-12-27-11-22-11.944 \tat org.apache.bookkeeper.bookie.Bookie.checkEnvironmentWithStorageExpansion(Bookie.java:442)\r\n2017-12-27-11-22-11.944 \tat org.apache.bookkeeper.bookie.Bookie.checkEnvironment(Bookie.java:282)\r\n2017-12-27-11-22-11.944 \tat org.apache.bookkeeper.bookie.Bookie.<init>(Bookie.java:642)\r\n2017-12-27-11-22-11.945 \tat org.apache.bookkeeper.proto.BookieServer.newBookie(BookieServer.java:102)\r\n2017-12-27-11-22-11.945 \tat org.apache.bookkeeper.proto.BookieServer.<init>(BookieServer.java:83)\r\n```\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 2, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"1ed78912907cd2157f0b93ecaa653923ede4365c": {"commitUser": "jiazhai", "commitGHEventType": "closed"}, "99f2e548c3485a658a1bf8ae57268d12bb028cbd": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2017-12-30 02:52:44", "url": "https://github.com/apache/bookkeeper/issues/922", "user": "eolivelli", "ttf": 2.000277777777778}, {"created": "2017-12-19 00:58:53", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0.0, "DEL": 0.0, "TOT": 0.0, "spoonMethodsChanged": 0, "MOV": 0.0, "UPD": 0.0}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "f7cdb5775651e9deb268e5cf9dd57e77291be035 tags/release-4.8.1~495", "commitHash": "f7cdb5775651e9deb268e5cf9dd57e77291be035", "commitMessage": "ISSUE #952: Split the multiple-jdk-versions ci jobs into two\n\nDescriptions of the changes in this PR:\n\n*Problem*\n\nWhen using a matrix job to define a CI job running on both java 9 and java 8, the workspace file path will be added with \"jdk name\" (e.g. \"JDK 1.8 latest\" and \"JDK 9 latest\"). This will cause file paths contain spaces, and fail the builds.\n\nfor example, #879 #880 is one of the examples. #937 can't pass ci because g++ fails when the file path contains spaces.\n\n*Solution*\n\nSplitting the matrix job into two separate jobs suffixed with \"java8\" and \"java9\", so it won't contains any space in workspace.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #953 from sijie/separate_jdk_cis, closes #952\n", "commitGitStats": [{"lines": 43, "deletions": 0, "insertions": 43, "filePath": ".test-infra/jenkins/job_bookkeeper_precommit_java9.groovy"}, {"lines": 27, "deletions": 19, "insertions": 8, "filePath": ".test-infra/jenkins/{job_bookkeeper_precommit_pullrequest.groovy => job_bookkeeper_precommit_java8.groovy}"}, {"lines": 33, "deletions": 22, "insertions": 11, "filePath": ".test-infra/jenkins/{job_bookkeeper_postcommit_master_jdkversions.groovy => job_bookkeeper_postcommit_master_java8.groovy}"}, {"lines": 46, "deletions": 0, "insertions": 46, "filePath": ".test-infra/jenkins/job_bookkeeper_postcommit_master_java9.groovy"}, {"lines": 6, "deletions": 2, "insertions": 4, "filePath": ".test-infra/jenkins/common_job_properties.groovy"}], "commitParents": ["1a8b35d38737f6d043995a756da10ea111268b4a"], "commitDateTime": "2018-01-06 21:37:08", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-01-06 21:37:08"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "TestTLS.java", "spoonMethods": [{"INS": 8, "DEL": 0, "TOT": 32, "MOV": 8, "UPD": 16, "spoonMethodName": "org.apache.bookkeeper.tls.TestTLS.setUp()"}]}], "nameRev": "4a4896c9b66741000c923b587ee1eafafca40273 tags/release-4.8.1~524", "commitHash": "4a4896c9b66741000c923b587ee1eafafca40273", "commitMessage": "ISSUE #879: TestTLS fails when project path contains spaces\n\nDescriptions of the changes in this PR:\n\nUse `URI` rather than `URL`, so it won't use url-encoded path as the file path.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Yiming Zang <yzang2016@gmail.com>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #880 from sijie/relative_path, closes #879\n", "commitGitStats": [{"lines": 20, "deletions": 8, "insertions": 12, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/tls/TestTLS.java"}], "commitParents": ["67d560f9dc2ad71e12ebffde74def7ac1738f6f9"], "commitDateTime": "2017-12-19 00:24:00", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-12-19 00:24:00"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "area/tests", "release/4.7.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "TestTLS fails when project path contains spaces", "numCommits": 0, "body": "\r\n\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nrun CI.\r\n\r\n- What did you expect to see?\r\n\r\nCI should pass TestTLS\r\n\r\n- What did you see instead?\r\n\r\nTestTLS fails when project paths contain spaces.\r\n\r\n```\r\ntestConnectToTLSClusterTLSClient(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 1.94 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestStartTLSServerNoKeyStore(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.328 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestBookieAuthPluginDenyAccessToClientWithoutTLS(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.272 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestMixedCluster(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.277 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestStartTLSServerBadPassword(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.254 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestConnectToTLSClusterMixedClient(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.252 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestTLSClientButOnlyFewTLSServers(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.282 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestConnectToTLSClusterTLSClientWithAuthentication(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.397 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestConnectToTLSClusterNonTLSClient(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.342 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestBookieAuthPluginDenyAccesstoClientWithoutTLSAuthentication(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.425 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestBookieAuthPluginRequireClientTLSAuthentication(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.29 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestClientWantsTLSNoServersHaveIt(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.413 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestClientAuthPlugin(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.279 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestHungServer(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.287 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n\r\ntestConnectToTLSClusterTLSClientWithTLSNoAuthentication(org.apache.bookkeeper.tls.TestTLS)  Time elapsed: 0.292 sec  <<< ERROR!\r\norg.apache.bookkeeper.tls.SecurityException: Error initializing TLSContext\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\nCaused by: java.io.FileNotFoundException: /home/jenkins/jenkins-slave/workspace/bookkeeper_precommit_pullrequest%402/jdk/JDK%201.8%20(latest)/label/ubuntu/bookkeeper-server/target/test-classes/server.jks (No such file or directory)\r\n\tat org.apache.bookkeeper.tls.TestTLS.setUp(TestTLS.java:106)\r\n```\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 2, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"f7cdb5775651e9deb268e5cf9dd57e77291be035": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "4a4896c9b66741000c923b587ee1eafafca40273": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-12-19 08:24:09", "url": "https://github.com/apache/bookkeeper/issues/879", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-12-15 23:15:27", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "155c3c95f3fcc823432e23a93a8cd3f51ebff917 tags/release-4.8.1~518", "commitHash": "155c3c95f3fcc823432e23a93a8cd3f51ebff917", "commitMessage": "ISSUE #865: LongHierarchicalLedgerManager: refactor to fix races\n\nLongHierarchicalLedgerRangeIterator.initialize() could erroneously exit\nwith iteratorDone if the lexicographically first path in zk had fewer\nthan 4 levels.  This can happen for a few reasons including a case where\na client creating a ledger on that path crashed during the zk updates or\nthe iterator.hasNext() call simply raced with an in-progress node\ncreation or removal.  ScanAndCompareGarbageCollector is hasNext()\nreturns false will delete all ledgers on the bookie, so this is a fairly\nserious bug.\n\nRuling out other such bugs was fairly dificult with the structure of the\ncode as written, so instead use a simpler recursive iterator design with\nsimpler pre/post conditions.\n\nAlso, surface KeeperException.NoNodeException from\nZkUtils.getChildrenInSingleNode so that we can actually handle it in\nLHLM.\n\nMaster Issue: #865\n\nAuthor: Samuel Just <sjust@salesforce.com>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #875 from athanatos/forupstream/issue-865, closes #865\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/LedgerManager.java"}, {"lines": 7, "deletions": 3, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/ZkUtils.java"}, {"lines": 3, "deletions": 0, "insertions": 3, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/FlatLedgerManager.java"}, {"lines": 301, "deletions": 172, "insertions": 129, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/LongHierarchicalLedgerManager.java"}, {"lines": 390, "deletions": 1, "insertions": 389, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/meta/LedgerManagerIteratorTest.java"}, {"lines": 5, "deletions": 0, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/LegacyHierarchicalLedgerManager.java"}, {"lines": 5, "deletions": 0, "insertions": 5, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/meta/LedgerManagerTestCase.java"}], "commitParents": ["9ab30454343118e6c80ca3f3eb13d01e511c89fc"], "commitDateTime": "2017-12-19 18:42:53", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "tooManyChanges", "authoredDateTime": "2017-12-19 18:42:53"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "area/metadata", "release/4.7.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "LongHierarchicalLedgerManager: fix race with concurrent updates in initialize()", "numCommits": 0, "body": "LongHierarchicalLedgerRangeIterator.initialize() can erroneously exit with iteratorDone if the lexicographically first path in zk has fewer than 4 levels.  This can happen for a few reasons including a case where a client creating a ledger on that path crashed during the zk updates or the iterator.hasNext() call simply raced with an in-progress node creation or removal.  ScanAndCompareGarbageCollector is hasNext() returns false will delete all ledgers on the bookie, so this is a fairly serious bug.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"155c3c95f3fcc823432e23a93a8cd3f51ebff917": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-12-20 02:43:02", "url": "https://github.com/apache/bookkeeper/issues/865", "user": "athanatos", "ttf": 4.000277777777778}, {"created": "2017-12-04 08:25:14", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "9b99b3b944ea44da0c87b6ae71e4afe05923241c tags/release-4.6.2~68", "commitHash": "9b99b3b944ea44da0c87b6ae71e4afe05923241c", "commitMessage": "ISSUE #801: remove assembly plugin in root pom\n\nDescriptions of the changes in this PR:\nmvn release:prepare cmd will fail, for the wrong assembly plugin in root pom. This change remove it, for it has already in bookkeeper-dist/pom.\n\nAuthor: Jia Zhai <zhaijia@apache.org>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #802 from jiazhai/issue-801, closes #801\n\n(cherry picked from commit f671926f7fbc89e9bb20e2a3b5e937dc6b716cc3)\nSigned-off-by: Jia Zhai <zhaijia@apache.org>\n", "commitGitStats": [{"lines": 10, "deletions": 10, "insertions": 0, "filePath": "pom.xml"}], "commitParents": ["24f45e6a62ddf875319c30a2323aae00b13b6248"], "commitDateTime": "2017-12-04 16:40:36", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-12-04 16:40:05"}, {"commitSpoonAstDiffStats": [], "nameRev": "f671926f7fbc89e9bb20e2a3b5e937dc6b716cc3 tags/release-4.8.1~577", "commitHash": "f671926f7fbc89e9bb20e2a3b5e937dc6b716cc3", "commitMessage": "ISSUE #801: remove assembly plugin in root pom\n\nDescriptions of the changes in this PR:\nmvn release:prepare cmd will fail, for the wrong assembly plugin in root pom. This change remove it, for it has already in bookkeeper-dist/pom.\n\nAuthor: Jia Zhai <zhaijia@apache.org>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #802 from jiazhai/issue-801, closes #801\n", "commitGitStats": [{"lines": 10, "deletions": 10, "insertions": 0, "filePath": "pom.xml"}], "commitParents": ["39a539e5c5a3381cad9e5e0da334c7f359e17c3b"], "commitDateTime": "2017-12-04 16:40:05", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-12-04 16:40:05"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/release", "release/4.6.0", "release/4.7.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "mvn release command runs failed", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\nexecute\r\n```\r\nmvn release:prepare \\\r\n    -Dresume=false \\\r\n    -DreleaseVersion=${VERSION} \\\r\n    -Dtag=${TAG} \\\r\n    -DupdateWorkingCopyVersions=false \\\r\n    -DdryRun \\\r\n    -Darguments=\"-Dmaven.javadoc.skip=true -DskipTests=true\"\r\n```\r\n- What did you expect to see?\r\nsuccess\r\n\r\n- What did you see instead?\r\nfailure with \r\n```\r\n[INFO] [ERROR] Failed to execute goal org.apache.maven.plugins:maven-assembly-plugin:2.2.1:single (source-release-assembly) on project bookkeeper: Error reading assemblies: Error locating assembly descriptor: src/assemble/src.xml\r\n[INFO] [ERROR] \r\n[INFO] [ERROR] [1] [INFO] Searching for file location: /Users/jia/ws/code/jia/bookkeeper-apache/src/assemble/src.xml\r\n[INFO] [ERROR] \r\n[INFO] [ERROR] [2] [INFO] File: /Users/jia/ws/code/jia/bookkeeper-apache/src/assemble/src.xml does not exist.\r\n[INFO] [ERROR] \r\n[INFO] [ERROR] [3] [INFO] File: /Users/jia/ws/code/jia/bookkeeper-apache/src/assemble/src.xml does not exist.\r\n[INFO] [ERROR] -> [Help 1]\r\n[INFO] [ERROR] \r\n[INFO] [ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\r\n[INFO] [ERROR] Re-run Maven using the -X switch to enable full debug logging.\r\n[INFO] [ERROR] \r\n[INFO] [ERROR] For more information about the errors and possible solutions, please read the following articles:\r\n[INFO] [ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\r\n```\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"9b99b3b944ea44da0c87b6ae71e4afe05923241c": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}, "f671926f7fbc89e9bb20e2a3b5e937dc6b716cc3": {"commitUser": "jiazhai", "commitGHEventType": "closed"}}, "closed": "2017-12-04 08:40:15", "url": "https://github.com/apache/bookkeeper/issues/801", "user": "jiazhai", "ttf": 0.0002777777777777778}, {"created": "2017-11-16 07:48:08", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "MySqlClient.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.benchmark.MySqlClient"}]}, {"spoonFilePath": "TestClient.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.benchmark.TestClient.HDFSClient"}, {"INS": 0, "DEL": 1, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.benchmark.TestClient.main(java.lang.String[])"}]}], "nameRev": "9b538aff7da5cba15ae59b70e0b0c9bd2464dca3 tags/release-4.8.1~611", "commitHash": "9b538aff7da5cba15ae59b70e0b0c9bd2464dca3", "commitMessage": "ISSUE #734: bookkeeper-benchmark is broken after protobuf files are moved to bookkeeper-proto\n\nDescriptions of the changes in this PR:\n\nProblem:\n\nThe issue was introduced after protobuf files are moved to bookkeeper-proto. so the protobuf is not shaded correctly.\nSo in bookkeeper-benchmark, it is conflicted with the protobuf version introduced by hadoop.\n\nSolution:\n\n- update the bookkeeper-server pom.xml to shade protobuf correctly\n- remove hadoop dependency from bookkeeper-benchmark.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Ivan Kelly <ivan@ivankelly.net>, Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #735 from sijie/protobuf_issue, closes #734\n", "commitGitStats": [{"lines": 49, "deletions": 49, "insertions": 0, "filePath": "bookkeeper-benchmark/pom.xml"}, {"lines": 138, "deletions": 138, "insertions": 0, "filePath": "bookkeeper-benchmark/src/main/java/org/apache/bookkeeper/benchmark/MySqlClient.java"}, {"lines": 56, "deletions": 56, "insertions": 0, "filePath": "bookkeeper-benchmark/src/main/java/org/apache/bookkeeper/benchmark/TestClient.java"}, {"lines": 7, "deletions": 0, "insertions": 7, "filePath": "pom.xml"}, {"lines": 9, "deletions": 7, "insertions": 2, "filePath": "bookkeeper-server/pom.xml"}], "commitParents": ["07bb94f25a49c6f28c5b33ce930c0e2a3601db83"], "commitDateTime": "2017-11-16 21:06:26", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-11-16 21:06:26"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "MySqlClient.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.benchmark.MySqlClient"}]}, {"spoonFilePath": "TestClient.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.benchmark.TestClient.HDFSClient"}, {"INS": 0, "DEL": 1, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.benchmark.TestClient.main(java.lang.String[])"}]}], "nameRev": "60197b82f7ab474405f453fcb74ccffe8a522feb tags/release-4.6.2~89", "commitHash": "60197b82f7ab474405f453fcb74ccffe8a522feb", "commitMessage": "ISSUE #734: bookkeeper-benchmark is broken after protobuf files are moved to bookkeeper-proto\n\nDescriptions of the changes in this PR:\n\nProblem:\n\nThe issue was introduced after protobuf files are moved to bookkeeper-proto. so the protobuf is not shaded correctly.\nSo in bookkeeper-benchmark, it is conflicted with the protobuf version introduced by hadoop.\n\nSolution:\n\n- update the bookkeeper-server pom.xml to shade protobuf correctly\n- remove hadoop dependency from bookkeeper-benchmark.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Ivan Kelly <ivan@ivankelly.net>, Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #735 from sijie/protobuf_issue, closes #734\n\n(cherry picked from commit 9b538aff7da5cba15ae59b70e0b0c9bd2464dca3)\nSigned-off-by: Jia Zhai <zhaijia@apache.org>\n", "commitGitStats": [{"lines": 49, "deletions": 49, "insertions": 0, "filePath": "bookkeeper-benchmark/pom.xml"}, {"lines": 138, "deletions": 138, "insertions": 0, "filePath": "bookkeeper-benchmark/src/main/java/org/apache/bookkeeper/benchmark/MySqlClient.java"}, {"lines": 56, "deletions": 56, "insertions": 0, "filePath": "bookkeeper-benchmark/src/main/java/org/apache/bookkeeper/benchmark/TestClient.java"}, {"lines": 7, "deletions": 0, "insertions": 7, "filePath": "pom.xml"}, {"lines": 9, "deletions": 7, "insertions": 2, "filePath": "bookkeeper-server/pom.xml"}], "commitParents": ["46a0cf88c58cdd33d221e098452b11b25ea43587"], "commitDateTime": "2017-11-16 21:07:50", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-11-16 21:06:26"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "priority/blocker", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "bookkeeper-benchmark is broken after protobuf files are moved to bookkeeper-proto module", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nrun tests on bookkeeper-benchmark module\r\n\r\n- What did you expect to see?\r\n\r\nthe test should be passing\r\n\r\n- What did you see instead?\r\n\r\n```\r\nRunning org.apache.bookkeeper.benchmark.TestBenchmark\r\nTests run: 3, Failures: 0, Errors: 3, Skipped: 0, Time elapsed: 0.803 sec <<< FAILURE! - in org.apache.bookkeeper.benchmark.TestBenchmark\r\ntestThroughputLatency(org.apache.bookkeeper.benchmark.TestBenchmark)  Time elapsed: 0.562 sec  <<< ERROR!\r\njava.lang.NoClassDefFoundError: com/google/protobuf/GeneratedMessageV3\r\nCaused by: java.lang.ClassNotFoundException: com.google.protobuf.GeneratedMessageV3\r\n\r\ntestBookie(org.apache.bookkeeper.benchmark.TestBenchmark)  Time elapsed: 0.044 sec  <<< ERROR!\r\njava.lang.NoClassDefFoundError: org/apache/bookkeeper/proto/DataFormats$CookieFormat\r\n\r\ntestReadThroughputLatency(org.apache.bookkeeper.benchmark.TestBenchmark)  Time elapsed: 0.044 sec  <<< ERROR!\r\njava.lang.NoClassDefFoundError: org/apache/bookkeeper/proto/DataFormats$CookieFormat\r\n```\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"60197b82f7ab474405f453fcb74ccffe8a522feb": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}, "9b538aff7da5cba15ae59b70e0b0c9bd2464dca3": {"commitUser": "jiazhai", "commitGHEventType": "closed"}}, "closed": "2017-11-16 13:06:38", "url": "https://github.com/apache/bookkeeper/issues/734", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-11-15 05:15:52", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerMetadata.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadata.getCtime()"}, {"INS": 3, "DEL": 0, "TOT": 5, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadata"}, {"INS": 4, "DEL": 1, "TOT": 20, "MOV": 7, "UPD": 8, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadata.isConflictWith(org.apache.bookkeeper.client.LedgerMetadata)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadata.setCtime(long)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadata.parseConfig(byte[],org.apache.bookkeeper.versioning.Version,com.google.common.base.Optional)"}]}, {"spoonFilePath": "LedgerMetadataTest.java", "spoonMethods": [{"INS": 4, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataTest.testIsConflictWithStoreSystemtimeAsLedgerCtimeDisabled()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataTest"}, {"INS": 1, "DEL": 2, "TOT": 16, "MOV": 10, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataTest.testStoreSystemtimeAsLedgerCtimeDisabled()"}, {"INS": 1, "DEL": 2, "TOT": 4, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataTest.testStoreSystemtimeAsLedgerCtimeEnabled()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataTest.testIsConflictWithStoreSystemtimeAsLedgerCtimeEnabled()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataTest.testIsConflictWithDifferentStoreSystemtimeAsLedgerCtimeFlags()"}]}], "nameRev": "970363c020ae58a3c07c70d53169fbc4e9057223 tags/release-4.6.2~91", "commitHash": "970363c020ae58a3c07c70d53169fbc4e9057223", "commitMessage": "ISSUE #726: Unit Tests failure with BKMetadataVersionException\n\nDescriptions of the changes in this PR:\n\nProblem:\n\nThe problem is introduced after making storing ctime optional. the verification become inconsistent because the way how ctime was assigned and compared. It causes the test cases failing in #726\n\nSolution:\n\nThis change is to change `isConflict` to ignore comparing ctime if client disables storing system time as ctime.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #730 from sijie/fix_ctime_issue, closes #726\n\n(cherry picked from commit c9a150b58fb1c8636dabbd7930bc3acffbf89881)\nSigned-off-by: Jia Zhai <zhaijia@apache.org>\n", "commitGitStats": [{"lines": 62, "deletions": 4, "insertions": 58, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/LedgerMetadataTest.java"}, {"lines": 35, "deletions": 5, "insertions": 30, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerMetadata.java"}], "commitParents": ["f757a124d39308a9d28ba101f1d740e773501fed"], "commitDateTime": "2017-11-16 20:55:10", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-11-16 20:54:42"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerMetadata.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadata.getCtime()"}, {"INS": 3, "DEL": 0, "TOT": 5, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadata"}, {"INS": 4, "DEL": 1, "TOT": 20, "MOV": 9, "UPD": 6, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadata.isConflictWith(org.apache.bookkeeper.client.LedgerMetadata)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadata.setCtime(long)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadata.parseConfig(byte[],org.apache.bookkeeper.versioning.Version,com.google.common.base.Optional)"}]}, {"spoonFilePath": "LedgerMetadataTest.java", "spoonMethods": [{"INS": 4, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataTest.testIsConflictWithStoreSystemtimeAsLedgerCtimeDisabled()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataTest"}, {"INS": 1, "DEL": 2, "TOT": 16, "MOV": 10, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataTest.testStoreSystemtimeAsLedgerCtimeDisabled()"}, {"INS": 1, "DEL": 2, "TOT": 4, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataTest.testStoreSystemtimeAsLedgerCtimeEnabled()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataTest.testIsConflictWithStoreSystemtimeAsLedgerCtimeEnabled()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerMetadataTest.testIsConflictWithDifferentStoreSystemtimeAsLedgerCtimeFlags()"}]}], "nameRev": "c9a150b58fb1c8636dabbd7930bc3acffbf89881 tags/release-4.8.1~613", "commitHash": "c9a150b58fb1c8636dabbd7930bc3acffbf89881", "commitMessage": "ISSUE #726: Unit Tests failure with BKMetadataVersionException\n\nDescriptions of the changes in this PR:\n\nProblem:\n\nThe problem is introduced after making storing ctime optional. the verification become inconsistent because the way how ctime was assigned and compared. It causes the test cases failing in #726\n\nSolution:\n\nThis change is to change `isConflict` to ignore comparing ctime if client disables storing system time as ctime.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #730 from sijie/fix_ctime_issue, closes #726\n", "commitGitStats": [{"lines": 62, "deletions": 4, "insertions": 58, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/LedgerMetadataTest.java"}, {"lines": 35, "deletions": 5, "insertions": 30, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerMetadata.java"}], "commitParents": ["e253ca32eb2f9f06b7525b85e7fa2ca870e6d0fa"], "commitDateTime": "2017-11-16 20:54:42", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-11-16 20:54:42"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "area/metadata", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Unit Tests failure with BKMetadataVersionException", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\nRun mvn test\r\n- What did you expect to see?\r\nExpect all tests passed\r\n- What did you see instead?\r\nsome tests failed, with Exception: BKMetadataVersionException\r\nFailure cases:\r\n```\r\n  BookieRecoveryTest.testMetadataConflictWhenDelayingEnsembleChange \u00bb BKMetadataVersion\r\n  BookieRecoveryTest.testMetadataConflictWithRecovery \u00bb BKMetadataVersion Bad le...\r\n  BookieRecoveryTest.testSyncBookieRecoveryToRandomBookiesCheckForDupes \u00bb BKMetadataVersion\r\n  TestDelayEnsembleChange.testChangeEnsembleSecondBookieReadOnly \u00bb BKMetadataVersion\r\n  TestWatchEnsembleChange.testWatchEnsembleChange[1] \u00bb BKMetadataVersion Bad led...\r\n  UpdateLedgerCmdTest.testUpdateLedgersToHostname \u00bb BKMetadataVersion Bad ledger...\r\n  UpdateLedgerOpTest.testChangeEnsembleAfterRenaming:202 \u00bb BKMetadataVersion Bad...\r\n  UpdateLedgerOpTest.testLimitLessThanTotalLedgers \u00bb BKMetadataVersion Bad ledge...\r\n  UpdateLedgerOpTest.testManyLedgers \u00bb BKMetadataVersion Bad ledger metadata ver...\r\n  UpdateLedgerOpTest.testRenameWhenAddEntryInProgress \u00bb BKMetadataVersion Bad le...\r\n```\r\n\r\nget one stack example from TestWatchEnsembleChange.testWatchEnsembleChange here:\r\n```\r\n 2017-11-15 13:00:11,838 - ERROR - [BookKeeperClientWorker-OrderedSafeExecutor-0-0:PendingAddOp@354] - Write of ledger entry to quorum failed: L0 E10\r\n org.apache.bookkeeper.client.BKException$BKMetadataVersionException: Bad ledger metadata version\r\n     at org.apache.bookkeeper.client.SyncCallbackUtils.finish(SyncCallbackUtils.java:68)\r\n     at org.apache.bookkeeper.client.SyncCallbackUtils$SyncAddCallback.addComplete(SyncCallbackUtils.java:264)\r\n     at org.apache.bookkeeper.client.PendingAddOp.submitCallback(PendingAddOp.java:359)\r\n     at org.apache.bookkeeper.client.LedgerHandle.errorOutPendingAdds(LedgerHandle.java:1300)\r\n     at org.apache.bookkeeper.client.LedgerHandle$3.safeRun(LedgerHandle.java:427)\r\n     at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36)\r\n     at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n     at java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n     at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\r\n     at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\r\n     at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\r\n     at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\r\n     at java.lang.Thread.run(Thread.java:748)\r\n```\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"970363c020ae58a3c07c70d53169fbc4e9057223": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}, "c9a150b58fb1c8636dabbd7930bc3acffbf89881": {"commitUser": "jiazhai", "commitGHEventType": "closed"}}, "closed": "2017-11-16 12:54:52", "url": "https://github.com/apache/bookkeeper/issues/726", "user": "jiazhai", "ttf": 1.0002777777777778}, {"created": "2017-11-14 08:55:29", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "e253ca32eb2f9f06b7525b85e7fa2ca870e6d0fa tags/release-4.8.1~614", "commitHash": "e253ca32eb2f9f06b7525b85e7fa2ca870e6d0fa", "commitMessage": "ISSUE #724: fix wrong link for slack signup\n\nDescriptions of the changes in this PR:\nChange the link of slack signup from http://apachebookkeeper.slack.com/ to https://apachebookkeeper.herokuapp.com/ in https://bookkeeper.apache.org/community/slack/ and click the self-register link.\n\nAuthor: Jia Zhai <zhaijia@apache.org>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #725 from jiazhai/issue-724, closes #724\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/community/slack.md"}], "commitParents": ["ed7696b130a0b7b6fb63b4d37c4a873fa1f8f96f"], "commitDateTime": "2017-11-14 17:31:38", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-11-14 17:31:38"}, {"commitSpoonAstDiffStats": [], "nameRev": "f757a124d39308a9d28ba101f1d740e773501fed tags/release-4.6.2~92", "commitHash": "f757a124d39308a9d28ba101f1d740e773501fed", "commitMessage": "ISSUE #724: fix wrong link for slack signup\n\nDescriptions of the changes in this PR:\nChange the link of slack signup from http://apachebookkeeper.slack.com/ to https://apachebookkeeper.herokuapp.com/ in https://bookkeeper.apache.org/community/slack/ and click the self-register link.\n\nAuthor: Jia Zhai <zhaijia@apache.org>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #725 from jiazhai/issue-724, closes #724\n\n(cherry picked from commit e253ca32eb2f9f06b7525b85e7fa2ca870e6d0fa)\nSigned-off-by: Jia Zhai <zhaijia@apache.org>\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/community/slack.md"}], "commitParents": ["fc0681278b752128adcb4645dee88e2f3938d9a6"], "commitDateTime": "2017-11-14 17:32:11", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-11-14 17:31:38"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/documentation", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Slack signup link is wrong", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nOpen https://bookkeeper.apache.org/community/slack/ and click the self-register link.\r\n\r\n- What did you expect to see?\r\n\r\nI should see the signup link not the signin link.\r\n\r\n- What did you see instead?\r\n\r\nI saw the signin link. The link of `https://apachebookkeeper.herokuapp.com/` was pointed to `http://apachebookkeeper.slack.com/`.\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"e253ca32eb2f9f06b7525b85e7fa2ca870e6d0fa": {"commitUser": "jiazhai", "commitGHEventType": "closed"}, "f757a124d39308a9d28ba101f1d740e773501fed": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}}, "closed": "2017-11-14 09:31:49", "url": "https://github.com/apache/bookkeeper/issues/724", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-11-11 07:25:48", "closed": "2017-11-11 07:27:28", "title": " Fixed simultaneus reads on same ledger/entry with v2 protocol ", "url": "https://github.com/apache/bookkeeper/issues/719", "body": "This change is coming from yahoo branch at https://github.com/yahoo/bookkeeper/commit/ce7b0f7d0fbb4c24ce13bd2d86e48c5c8143167a\r\n\r\nWith v2 protocol there's no way to disambiguate the read request since the completion key is made from `(ledgerId, entryId)`. \r\nThis PR introduced an additional multimap to handle the conflicts (multiple simultaneus read requests for the same entry).", "commits": {}, "user": "merlimat", "commitsDetails": [], "labels": ["type/bug"], "ttf": 0.0002777777777777778}, {"created": "2017-11-11 00:46:31", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "MockBookKeeperTestCase.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupWriteLedgerMetadata()"}, {"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupCreateLedgerMetadata()"}, {"INS": 0, "DEL": 1, "TOT": 13, "MOV": 11, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupWriteLedgerMetadata().7.answer(org.mockito.invocation.InvocationOnMock)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.extractEntryPayload(long,long,io.netty.buffer.ByteBuf)"}, {"INS": 1, "DEL": 2, "TOT": 8, "MOV": 3, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupBookieClientReadEntry()"}, {"INS": 0, "DEL": 3, "TOT": 14, "MOV": 10, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupReadLedgerMetadata().2.answer(org.mockito.invocation.InvocationOnMock)"}, {"INS": 3, "DEL": 1, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupRemoveLedgerMetadata()"}, {"INS": 0, "DEL": 3, "TOT": 11, "MOV": 8, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupRemoveLedgerMetadata().3.answer(org.mockito.invocation.InvocationOnMock)"}, {"INS": 1, "DEL": 1, "TOT": 3, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupLedgerIdGenerator()"}, {"INS": 0, "DEL": 1, "TOT": 13, "MOV": 11, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupCreateLedgerMetadata().6.answer(org.mockito.invocation.InvocationOnMock)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupRegisterLedgerMetadataListener().4"}, {"INS": 3, "DEL": 1, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupReadLedgerMetadata()"}, {"INS": 0, "DEL": 1, "TOT": 7, "MOV": 6, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupLedgerIdGenerator().5.answer(org.mockito.invocation.InvocationOnMock)"}, {"INS": 3, "DEL": 2, "TOT": 7, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupBookieClientAddEntry()"}]}, {"spoonFilePath": "PendingAddOp.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingAddOp.submitCallback(int)"}]}], "nameRev": "dd7dc6399504b246c65f7a09657597578b81cb6c tags/release-4.8.1~619", "commitHash": "dd7dc6399504b246c65f7a09657597578b81cb6c", "commitMessage": "ISSUE #716: PendingAddOp accesses a released ByteBuf\n\nDescriptions of the changes in this PR:\n\n- release `toSend` bytebuf only when a PendingAddOp is recycled.\n- fix MockBookKeeperTestCase to run callbacks in the same executor thread.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #717 from sijie/issue_176, closes #716\n", "commitGitStats": [{"lines": 4, "deletions": 3, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java"}, {"lines": 123, "deletions": 62, "insertions": 61, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/MockBookKeeperTestCase.java"}], "commitParents": ["e713953aec8523e1018e0eba458c019ec9ba1f9f"], "commitDateTime": "2017-11-11 13:55:57", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-11-11 13:55:57"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "MockBookKeeperTestCase.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupWriteLedgerMetadata()"}, {"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupCreateLedgerMetadata()"}, {"INS": 0, "DEL": 1, "TOT": 13, "MOV": 11, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupWriteLedgerMetadata().7.answer(org.mockito.invocation.InvocationOnMock)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.extractEntryPayload(long,long,io.netty.buffer.ByteBuf)"}, {"INS": 1, "DEL": 2, "TOT": 8, "MOV": 3, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupBookieClientReadEntry()"}, {"INS": 0, "DEL": 3, "TOT": 14, "MOV": 10, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupReadLedgerMetadata().2.answer(org.mockito.invocation.InvocationOnMock)"}, {"INS": 3, "DEL": 1, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupRemoveLedgerMetadata()"}, {"INS": 0, "DEL": 3, "TOT": 11, "MOV": 8, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupRemoveLedgerMetadata().3.answer(org.mockito.invocation.InvocationOnMock)"}, {"INS": 1, "DEL": 1, "TOT": 3, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupLedgerIdGenerator()"}, {"INS": 0, "DEL": 1, "TOT": 13, "MOV": 11, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupCreateLedgerMetadata().6.answer(org.mockito.invocation.InvocationOnMock)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupRegisterLedgerMetadataListener().4"}, {"INS": 3, "DEL": 1, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupReadLedgerMetadata()"}, {"INS": 0, "DEL": 1, "TOT": 7, "MOV": 6, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupLedgerIdGenerator().5.answer(org.mockito.invocation.InvocationOnMock)"}, {"INS": 3, "DEL": 2, "TOT": 7, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.MockBookKeeperTestCase.setupBookieClientAddEntry()"}]}, {"spoonFilePath": "PendingAddOp.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingAddOp.submitCallback(int)"}]}], "nameRev": "3cecb89429234ed7407e12da9034fdfa10a1844d tags/release-4.6.2~97", "commitHash": "3cecb89429234ed7407e12da9034fdfa10a1844d", "commitMessage": "ISSUE #716: PendingAddOp accesses a released ByteBuf\n\nDescriptions of the changes in this PR:\n\n- release `toSend` bytebuf only when a PendingAddOp is recycled.\n- fix MockBookKeeperTestCase to run callbacks in the same executor thread.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #717 from sijie/issue_176, closes #716\n\n(cherry picked from commit dd7dc6399504b246c65f7a09657597578b81cb6c)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 4, "deletions": 3, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java"}, {"lines": 123, "deletions": 62, "insertions": 61, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/MockBookKeeperTestCase.java"}], "commitParents": ["cb2dc537f68c064cfdceb0b169461f2677e06659"], "commitDateTime": "2017-11-11 13:56:22", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-11-11 13:55:57"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "priority/blocker", "release/4.5.1", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "PendingAddOp accessed a released ByteBuf", "numCommits": 0, "body": "\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nrun `BookKeeperApiTest`\r\n\r\n- What did you expect to see?\r\n\r\nI would like to see all the tests pass and no exceptions in the log\r\n\r\n- What did you see instead?\r\n\r\nI saw tons of NullPointerExceptions as below. The problem is we attempt to release the send buffer once it is ready for callback. However this is not correct, because the callback can return when using a small `AckQuorumSize`. This won't be a correctness, and most likely won't show up in a real environment. but we still need to address it. \r\n\r\n```\r\n2017-11-10 16:38:49,144 - ERROR - [Builder-OrderedSafeExecutor-1-0:SafeRunnable@38] - Unexpected throwable caught \r\njava.lang.NullPointerException\r\n\tat org.apache.bookkeeper.util.DoubleByteBuf.readableBytes(DoubleByteBuf.java:125)\r\n\tat io.netty.buffer.Unpooled.copiedBuffer(Unpooled.java:433)\r\n\tat org.apache.bookkeeper.client.MockBookKeeperTestCase.extractEntryPayload(MockBookKeeperTestCase.java:386)\r\n\tat org.apache.bookkeeper.client.MockBookKeeperTestCase.lambda$setupBookieClientAddEntry$8(MockBookKeeperTestCase.java:410)\r\n\tat org.mockito.internal.stubbing.StubbedInvocationMatcher.answer(StubbedInvocationMatcher.java:35)\r\n\tat org.mockito.internal.handler.MockHandlerImpl.handle(MockHandlerImpl.java:95)\r\n\tat org.mockito.internal.handler.NullResultGuardian.handle(NullResultGuardian.java:32)\r\n\tat org.mockito.internal.handler.InvocationNotifierHandler.handle(InvocationNotifierHandler.java:36)\r\n\tat org.mockito.internal.creation.bytebuddy.MockMethodInterceptor.doIntercept(MockMethodInterceptor.java:57)\r\n\tat org.mockito.internal.creation.bytebuddy.MockMethodInterceptor.doIntercept(MockMethodInterceptor.java:43)\r\n\tat org.mockito.internal.creation.bytebuddy.MockMethodInterceptor$DispatcherDefaultingToRealMethod.interceptSuperCallable(MockMethodInterceptor.java:119)\r\n\tat org.apache.bookkeeper.proto.BookieClient$MockitoMock$1300928847.addEntry(Unknown Source)\r\n\tat org.apache.bookkeeper.client.PendingAddOp.sendWriteRequest(PendingAddOp.java:129)\r\n\tat org.apache.bookkeeper.client.PendingAddOp.safeRun(PendingAddOp.java:242)\r\n\tat org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36)\r\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\r\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)\r\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"3cecb89429234ed7407e12da9034fdfa10a1844d": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "dd7dc6399504b246c65f7a09657597578b81cb6c": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-11-11 21:56:06", "url": "https://github.com/apache/bookkeeper/issues/716", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-11-05 10:11:32", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "cbf6668af320135af65c4590385a29fcf6d8d6c8 tags/release-4.8.1~624", "commitHash": "cbf6668af320135af65c4590385a29fcf6d8d6c8", "commitMessage": "ISSUE #699: Docker healthchek is failing #699\n\nThe docker healthcheck is failing because it's trying to run the\nbookkeeper command without specifying a path.\n\nAdding the full path to the command fix this issue.\n\nSigned-off-by: Antonio Ojea <antonio.ojea.garciagmail.com>\n\nDescriptions of the changes in this PR:\n\n(PR description content here)...\n\nAuthor: Antonio Ojea <antonio.ojea.garcia@gmail.com>\n\nReviewers: Jia Zhai <None>, Matteo Merli <mmerli@apache.org>\n\nThis closes #700 from itsuugo/issue#699, closes #699, closes #699\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "docker/scripts/healthcheck.sh"}], "commitParents": ["8b2ead67bc895c9e6bfe18228e949da94583230b"], "commitDateTime": "2017-11-06 22:47:17", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-11-06 22:47:17"}, {"commitSpoonAstDiffStats": [], "nameRev": "dba005d39674a6310a6a4d7f12b701cc8a00a428 tags/release-4.6.2~99", "commitHash": "dba005d39674a6310a6a4d7f12b701cc8a00a428", "commitMessage": "ISSUE #699: Docker healthchek is failing #699\n\nThe docker healthcheck is failing because it's trying to run the\nbookkeeper command without specifying a path.\n\nAdding the full path to the command fix this issue.\n\nSigned-off-by: Antonio Ojea <antonio.ojea.garciagmail.com>\n\nDescriptions of the changes in this PR:\n\n(PR description content here)...\n\nAuthor: Antonio Ojea <antonio.ojea.garcia@gmail.com>\n\nReviewers: Jia Zhai <None>, Matteo Merli <mmerli@apache.org>\n\nThis closes #700 from itsuugo/issue#699, closes #699, closes #699\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "docker/scripts/healthcheck.sh"}], "commitParents": ["3ce2fb7ed510976413df07b00c81c3383f5494d1"], "commitDateTime": "2017-11-07 11:33:21", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-11-06 22:47:17"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/docker", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Docker healthchek is failing ", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\nThe docker healthcheck is failing and reporting a wrong status.\r\n\r\nThe problem is that the healthcheck script is trying to run the command `bookkeeper` without specifying the path or adding the location of the command to the PATH variable.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"cbf6668af320135af65c4590385a29fcf6d8d6c8": {"commitUser": "jiazhai", "commitGHEventType": "closed"}, "dba005d39674a6310a6a4d7f12b701cc8a00a428": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2017-11-06 14:47:28", "url": "https://github.com/apache/bookkeeper/issues/699", "user": "aojea", "ttf": 1.0002777777777778}, {"created": "2017-10-31 17:57:27", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerHandleAdv.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandleAdv.doAsyncAddEntry(org.apache.bookkeeper.client.PendingAddOp,io.netty.buffer.ByteBuf,org.apache.bookkeeper.client.AsyncCallback.AddCallback,java.lang.Object)"}]}], "nameRev": "c3fe58dfbc63a33e20b901b6ab2724e86f864d13 tags/release-4.5.1~5", "commitHash": "c3fe58dfbc63a33e20b901b6ab2724e86f864d13", "commitMessage": "ISSUE #683: Correctly update length in LedgerHandleAdv\n\nCommit 7b1eec introduced a change which removed the length parameter\nto doAsyncAddEntry. This resulted in the length of the ledger being\nadded to itself each time for a LedgerHandleAdv, which ultimately\nmeant that that length would be 0, as it never had anything non-zero\nadded to it.\n\nThis change corrects this, by adding the length of the data parameter\nto the ledger length.\n\nAuthor: Ivan Kelly <ivank@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@apache.org>\n\nThis closes #684 from ivankelly/len-fix, closes #683\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandleAdv.java"}], "commitParents": ["c6ca4ecbf76f6dac7ebcd843a429dbbaaba62420"], "commitDateTime": "2017-11-02 12:58:20", "commitUser": "eolivelli", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-11-02 12:58:20"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "priority/blocker", "release/4.5.1", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Ledger length is not updated correctly in LedgerHandleAdv", "numCommits": 0, "body": "\r\n```\r\nivankelly [4:37 AM] \r\n@eolivelli the adv ledger stuff, does it take the ledger length into account?\r\n\r\n\r\n[4:37] \r\nwhen adding entries\r\n\r\n\r\neolivelli [8:30 AM] \r\nI hope so\r\n\r\n\r\n[8:30] \r\nI am using LEdgerHAndleAdv and it is working\r\n\r\n\r\n[8:30] \r\nI have to check code\r\n\r\n\r\n[8:31] \r\nyes\r\n\r\n\r\n[8:31] \r\nsee doAsyncAddEntry in LedgerHandleAdv\r\n\r\n\r\n[8:31] \r\nhttps://github.com/apache/bookkeeper/blob/c6ca4ecbf76f6dac7ebcd843a429dbbaaba62420/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandleAdv.java#L182\r\nGitHub\r\napache/bookkeeper\r\nbookkeeper - Apache Bookkeeper\r\n \r\n\r\n\r\nivankelly [10:25 AM] \r\nyes, that's what I'm asking about\r\n\r\n\r\n[10:25] \r\nIt's basically doubling the length of the ledger each time, without taking the data length into consideration\r\n\r\n\r\nsijie [10:49 AM] \r\n@ivankelly I think this is a problem introduced by  netty 4 upgrade\r\n\r\n\r\n[10:50] \r\nbefore netty 4 upgrade, the `length` is the entry length.\r\n\r\n\r\n[10:52] \r\nthe problem was introduced at 7b1eec47092d0de6776c5a89575dbfc678165ee7\r\n```\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"c3fe58dfbc63a33e20b901b6ab2724e86f864d13": {"commitUser": "eolivelli", "commitGHEventType": "referenced"}}, "closed": "2017-11-03 07:37:36", "url": "https://github.com/apache/bookkeeper/issues/683", "user": "sijie", "ttf": 2.000277777777778}, {"created": "2017-10-24 22:40:38", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "GcLedgersTest.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.GcLedgersTest.MockLedgerStorage.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.GcLedgersTest.MockLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}]}, {"spoonFilePath": "LedgerCacheTest.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.FlushTestSortedLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.FlushTestSortedLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.stats.StatsLogger)"}]}, {"spoonFilePath": "CacheCallback.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.onSizeLimitReached(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}]}, {"spoonFilePath": "LedgerStorageTestBase.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerStorageTestBase"}]}, {"spoonFilePath": "SyncThread.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.requestFlush()"}, {"INS": 0, "DEL": 0, "TOT": 8, "MOV": 4, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.flush()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.startCheckpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.start()"}, {"INS": 0, "DEL": 2, "TOT": 7, "MOV": 4, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.start().1.run()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.shutdown()"}, {"INS": 1, "DEL": 1, "TOT": 10, "MOV": 5, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 0, "DEL": 0, "TOT": 5, "MOV": 3, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.requestFlush().2.call()"}, {"INS": 1, "DEL": 1, "TOT": 4, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread"}]}, {"spoonFilePath": "Bookie.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.start()"}]}, {"spoonFilePath": "SortedLedgerStorage.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.onRotateEntryLog()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.stats.StatsLogger)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.onSizeLimitReached(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint).1.run()"}, {"INS": 2, "DEL": 3, "TOT": 10, "MOV": 2, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.onSizeLimitReached().1.run()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.getScheduler()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.onSizeLimitReached(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}]}, {"spoonFilePath": "Checkpointer.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie"}]}, {"spoonFilePath": "TestSyncThread.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadShutdownOnError().5"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadLongShutdown().2.call()"}, {"INS": 1, "DEL": 1, "TOT": 3, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadLongShutdown()"}, {"INS": 0, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadShutdownOnError()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadSuspension().3"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadDisksFull().7.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 1, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadSuspension()"}, {"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadSuspension().3.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadDisksFull().6"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.DummyLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadShutdownOnError().4"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadShutdownOnError().5.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.DummyLedgerStorage.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadDisksFull().7"}, {"INS": 0, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadDisksFull()"}, {"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadLongShutdown().1.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}]}, {"spoonFilePath": "EntryMemTable.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.EntryMemTable.addEntry(long,long,java.nio.ByteBuffer,org.apache.bookkeeper.bookie.CacheCallback)"}]}, {"spoonFilePath": "CompactionTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testWhenNoLogsToCompact()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testForceGarbageCollection()"}, {"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testCompactionSafety()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testSuspendGarbageCollection()"}]}, {"spoonFilePath": "LedgerManagerTestCase.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.LedgerManagerTestCase.MockLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}, {"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.LedgerManagerTestCase.MockLedgerStorage.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}]}, {"spoonFilePath": "LedgerStorage.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}]}, {"spoonFilePath": "SortedLedgerStorageCheckpointTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorageCheckpointTest"}]}, {"spoonFilePath": "TestEntryMemTable.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestEntryMemTable.onSizeLimitReached(org.apache.bookkeeper.bookie.Checkpoint)"}]}, {"spoonFilePath": "InterleavedLedgerStorage.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.InterleavedLedgerStorage.CheckpointHolder"}, {"INS": 1, "DEL": 0, "TOT": 4, "MOV": 1, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.InterleavedLedgerStorage.onRotateEntryLog()"}, {"INS": 0, "DEL": 4, "TOT": 5, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.InterleavedLedgerStorage.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 4, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.InterleavedLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}, {"INS": 0, "DEL": 1, "TOT": 4, "MOV": 0, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.bookie.InterleavedLedgerStorage"}]}], "nameRev": "24f45e6a62ddf875319c30a2323aae00b13b6248 tags/release-4.6.2~69", "commitHash": "24f45e6a62ddf875319c30a2323aae00b13b6248", "commitMessage": "ISSUE #659: Fix Checkpoint logic in SortedLedgerStorage\n\nDescriptions of the changes in this PR:\n\n- add a test case to reproduce the behavior\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Charan Reddy Guttapalem <reddycharan18@gmail.com>\n\nThis closes #677 from sijie/fix_checkpoint, closes #659\n", "commitGitStats": [{"lines": 18, "deletions": 7, "insertions": 11, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java"}, {"lines": 15, "deletions": 5, "insertions": 10, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/meta/LedgerManagerTestCase.java"}, {"lines": 3, "deletions": 1, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/CacheCallback.java"}, {"lines": 88, "deletions": 0, "insertions": 88, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/LedgerStorageTestBase.java"}, {"lines": 89, "deletions": 45, "insertions": 44, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/SyncThread.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/EntryMemTable.java"}, {"lines": 17, "deletions": 7, "insertions": 10, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/meta/GcLedgersTest.java"}, {"lines": 40, "deletions": 0, "insertions": 40, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Checkpointer.java"}, {"lines": 57, "deletions": 41, "insertions": 16, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/InterleavedLedgerStorage.java"}, {"lines": 231, "deletions": 0, "insertions": 231, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/SortedLedgerStorageCheckpointTest.java"}, {"lines": 59, "deletions": 30, "insertions": 29, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/TestSyncThread.java"}, {"lines": 55, "deletions": 13, "insertions": 42, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/SortedLedgerStorage.java"}, {"lines": 68, "deletions": 15, "insertions": 53, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/CompactionTest.java"}, {"lines": 11, "deletions": 5, "insertions": 6, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/TestEntryMemTable.java"}, {"lines": 11, "deletions": 3, "insertions": 8, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerStorage.java"}, {"lines": 19, "deletions": 4, "insertions": 15, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/LedgerCacheTest.java"}], "commitParents": ["17cb7bc7e4a76393437580f1454fdff40346919a"], "commitDateTime": "2017-12-01 22:07:20", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-12-01 22:05:53"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "GcLedgersTest.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.GcLedgersTest.MockLedgerStorage.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.GcLedgersTest.MockLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}]}, {"spoonFilePath": "LedgerCacheTest.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.FlushTestSortedLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerCacheTest.FlushTestSortedLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.stats.StatsLogger)"}]}, {"spoonFilePath": "CacheCallback.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.onSizeLimitReached(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}]}, {"spoonFilePath": "LedgerStorageTestBase.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerStorageTestBase"}]}, {"spoonFilePath": "SyncThread.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.requestFlush()"}, {"INS": 0, "DEL": 0, "TOT": 8, "MOV": 4, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.flush()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.startCheckpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.start()"}, {"INS": 0, "DEL": 2, "TOT": 7, "MOV": 4, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.start().1.run()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.shutdown()"}, {"INS": 1, "DEL": 1, "TOT": 10, "MOV": 5, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 0, "DEL": 0, "TOT": 5, "MOV": 3, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread.requestFlush().2.call()"}, {"INS": 1, "DEL": 1, "TOT": 4, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.SyncThread"}]}, {"spoonFilePath": "Bookie.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.start()"}]}, {"spoonFilePath": "SortedLedgerStorage.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.onRotateEntryLog()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.stats.StatsLogger)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.onSizeLimitReached(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint).1.run()"}, {"INS": 2, "DEL": 3, "TOT": 10, "MOV": 2, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.onSizeLimitReached().1.run()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.getScheduler()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorage.onSizeLimitReached(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}]}, {"spoonFilePath": "Checkpointer.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie"}]}, {"spoonFilePath": "TestSyncThread.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadShutdownOnError().5"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadLongShutdown().2.call()"}, {"INS": 1, "DEL": 1, "TOT": 3, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadLongShutdown()"}, {"INS": 0, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadShutdownOnError()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadSuspension().3"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadDisksFull().7.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 1, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadSuspension()"}, {"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadSuspension().3.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadDisksFull().6"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.DummyLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadShutdownOnError().4"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadShutdownOnError().5.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.DummyLedgerStorage.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadDisksFull().7"}, {"INS": 0, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadDisksFull()"}, {"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.TestSyncThread.testSyncThreadLongShutdown().1.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}]}, {"spoonFilePath": "EntryMemTable.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.EntryMemTable.addEntry(long,long,java.nio.ByteBuffer,org.apache.bookkeeper.bookie.CacheCallback)"}]}, {"spoonFilePath": "CompactionTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testWhenNoLogsToCompact()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testForceGarbageCollection()"}, {"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testCompactionSafety()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testSuspendGarbageCollection()"}]}, {"spoonFilePath": "LedgerManagerTestCase.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.meta.LedgerManagerTestCase.MockLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}, {"INS": 0, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.meta.LedgerManagerTestCase.MockLedgerStorage.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}]}, {"spoonFilePath": "LedgerStorage.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}]}, {"spoonFilePath": "SortedLedgerStorageCheckpointTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.SortedLedgerStorageCheckpointTest"}]}, {"spoonFilePath": "TestEntryMemTable.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.TestEntryMemTable.onSizeLimitReached(org.apache.bookkeeper.bookie.Checkpoint)"}]}, {"spoonFilePath": "InterleavedLedgerStorage.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.InterleavedLedgerStorage.CheckpointHolder"}, {"INS": 1, "DEL": 0, "TOT": 4, "MOV": 1, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.InterleavedLedgerStorage.onRotateEntryLog()"}, {"INS": 0, "DEL": 4, "TOT": 5, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.InterleavedLedgerStorage.checkpoint(org.apache.bookkeeper.bookie.CheckpointSource.Checkpoint)"}, {"INS": 4, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.InterleavedLedgerStorage.initialize(org.apache.bookkeeper.conf.ServerConfiguration,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.LedgerDirsManager,org.apache.bookkeeper.bookie.CheckpointSource,org.apache.bookkeeper.bookie.Checkpointer,org.apache.bookkeeper.stats.StatsLogger)"}, {"INS": 0, "DEL": 1, "TOT": 4, "MOV": 0, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.bookie.InterleavedLedgerStorage"}]}], "nameRev": "81cbba3cf620f2a6df48c0da6ee1ac019de24fbc tags/release-4.8.1~581", "commitHash": "81cbba3cf620f2a6df48c0da6ee1ac019de24fbc", "commitMessage": "ISSUE #659: Fix Checkpoint logic in SortedLedgerStorage\n\nDescriptions of the changes in this PR:\n\n- add a test case to reproduce the behavior\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Charan Reddy Guttapalem <reddycharan18@gmail.com>\n\nThis closes #677 from sijie/fix_checkpoint, closes #659\n", "commitGitStats": [{"lines": 18, "deletions": 7, "insertions": 11, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java"}, {"lines": 15, "deletions": 5, "insertions": 10, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/meta/LedgerManagerTestCase.java"}, {"lines": 3, "deletions": 1, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/CacheCallback.java"}, {"lines": 88, "deletions": 0, "insertions": 88, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/LedgerStorageTestBase.java"}, {"lines": 89, "deletions": 45, "insertions": 44, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/SyncThread.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/EntryMemTable.java"}, {"lines": 17, "deletions": 7, "insertions": 10, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/meta/GcLedgersTest.java"}, {"lines": 40, "deletions": 0, "insertions": 40, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Checkpointer.java"}, {"lines": 57, "deletions": 41, "insertions": 16, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/InterleavedLedgerStorage.java"}, {"lines": 231, "deletions": 0, "insertions": 231, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/SortedLedgerStorageCheckpointTest.java"}, {"lines": 59, "deletions": 30, "insertions": 29, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/TestSyncThread.java"}, {"lines": 55, "deletions": 13, "insertions": 42, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/SortedLedgerStorage.java"}, {"lines": 68, "deletions": 15, "insertions": 53, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/CompactionTest.java"}, {"lines": 11, "deletions": 5, "insertions": 6, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/TestEntryMemTable.java"}, {"lines": 11, "deletions": 3, "insertions": 8, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerStorage.java"}, {"lines": 19, "deletions": 4, "insertions": 15, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/LedgerCacheTest.java"}], "commitParents": ["ba7db47ab912269eca160bc1112f46cc417688d1"], "commitDateTime": "2017-12-01 22:05:53", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-12-01 22:05:53"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Checkpoint logic is broken in SortedLedgerStorage", "numCommits": 0, "body": "*Problem*\r\n\r\nCurrently SortedLedgerStorage doesn't maintain any checkpoint related information. It shares the same `checkpoint holder` with InterleavedLedgerStorage. The checkpoint holder is updated when an entry log file is rotated. Unfortunately this can happen when compaction adds entries in the entry log files causing entry log file rotated and SortedLedgerStorage isn't aware of this. This can cause data not durably persisted in ledger storage before advancing journal checkpoint marker.\r\n\r\n*Discussion*\r\n\r\nThe detail discussion can be found at:\r\n\r\nhttp://mail-archives.apache.org/mod_mbox/bookkeeper-dev/201710.mbox/%3CCAAFz1KPbOZjSnmpHDt%2BdeU7FPQvv__XFPc_a69zhd31TuSFJ_g%40mail.gmail.com%3E\r\n\r\nhttp://mail-archives.apache.org/mod_mbox/bookkeeper-dev/201710.mbox/%3CCAO2yDyZ-_3N6_YMGuG%3DG0k3Q-omDRxshBmegv%3DSMLb7dmsiBmQ%40mail.gmail.com%3E\r\n\r\n*Solutions*\r\n\r\n```\r\n   1. Use the approach that I used before (as in the old commits at\r\n   twitter\u2019s branch). Ledger storage is responsible for instantiating the\r\n   checkpoints.\r\n   2. Sorted ledger storage maintains a separate checkpoint marker (can be\r\n   using the checkpoint markers in memtables).\r\n   3. Compaction avoids advancing checkpoint holder in entry log files.\r\n   This can be covered by\r\n   https://cwiki.apache.org/confluence/display/BOOKKEEPER/BP-6+-+Use+separate+log+for+compaction\r\n```\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"24f45e6a62ddf875319c30a2323aae00b13b6248": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "81cbba3cf620f2a6df48c0da6ee1ac019de24fbc": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-12-02 05:06:00", "url": "https://github.com/apache/bookkeeper/issues/659", "user": "sijie", "ttf": 38.000277777777775}, {"created": "2017-10-17 21:46:08", "closed": "2019-08-18 16:32:16", "title": "AuditorLedgerCheckerTest is flakey", "url": "https://github.com/apache/bookkeeper/issues/637", "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-718\n\nReporter: Ivan Kelly @ivankelly\n\nSee:\nhttps://builds.apache.org/job/bookkeeper-trunk/505/\n& \nhttps://builds.apache.org/job/bookkeeper-trunk/509\n\nRelevant errors attached.\n\n### Comments from JIRA\n\n\n---\n*Sijie Guo* 2014-07-26T07:31:10.649+0000\n\nping the status. [~ikelly]\n\n---\n*Ivan Kelly* 2014-08-26T14:02:35.031+0000\n\nProblem was that BookKeeperAdmin was taking ownership of a bookkeeper and zookeeper handle that was being passed in. This meant that when it was closed, it would clean up both. In the test in question, multiple bookkeeperadmin instances eventually shared the same zookeeper instance via auditor electors, so when one auditor elector was shut down, it would kill the zookeeper session of the other auditor electors and they weren't able to mark the unreplicated ledgers.\n\n---\n*Hadoop QA* 2014-08-26T14:30:08.730+0000\n\nTesting JIRA BOOKKEEPER-718\n\n\nPatch [0001-BOOKKEEPER-718-AuditorLedgerCheckerTest-is-flakey.patch|https://issues.apache.org/jira/secure/attachment/12664390/0001-BOOKKEEPER-718-AuditorLedgerCheckerTest-is-flakey.patch] downloaded at Tue Aug 26 14:25:41 UTC 2014\n\n----------------------------\n\n{color:red}-1{color} Patch failed to apply to head of branch\n\n----------------------------\n\n---\n*Hadoop QA* 2014-08-26T15:45:50.280+0000\n\nTesting JIRA BOOKKEEPER-718\n\n\nPatch [0001-BOOKKEEPER-718-AuditorLedgerCheckerTest-is-flakey.patch|https://issues.apache.org/jira/secure/attachment/12664390/0001-BOOKKEEPER-718-AuditorLedgerCheckerTest-is-flakey.patch] downloaded at Tue Aug 26 15:41:43 UTC 2014\n\n----------------------------\n\n{color:red}-1{color} Patch failed to apply to head of branch\n\n----------------------------\n\n---\n*Hadoop QA* 2014-08-26T16:35:50.353+0000\n\nTesting JIRA BOOKKEEPER-718\n\n\nPatch [0001-BOOKKEEPER-718-AuditorLedgerCheckerTest-is-flakey.patch|https://issues.apache.org/jira/secure/attachment/12664390/0001-BOOKKEEPER-718-AuditorLedgerCheckerTest-is-flakey.patch] downloaded at Tue Aug 26 16:31:43 UTC 2014\n\n----------------------------\n\n{color:red}-1{color} Patch failed to apply to head of branch\n\n----------------------------\n\n---\n*Ivan Kelly* 2014-08-28T14:45:26.210+0000\n\nForgot to specify --no-prefix in previous patch.\n\n---\n*Hadoop QA* 2014-08-28T15:55:35.937+0000\n\nTesting JIRA BOOKKEEPER-718\n\n\nPatch [0001-BOOKKEEPER-718-AuditorLedgerCheckerTest-is-flakey.patch|https://issues.apache.org/jira/secure/attachment/12664986/0001-BOOKKEEPER-718-AuditorLedgerCheckerTest-is-flakey.patch] downloaded at Thu Aug 28 14:51:55 UTC 2014\n\n----------------------------\n\n{color:green}+1 PATCH_APPLIES{color}\n{color:green}+1 CLEAN{color}\n{color:red}-1 RAW_PATCH_ANALYSIS{color}\n.    {color:green}+1{color} the patch does not introduce any @author tags\n.    {color:green}+1{color} the patch does not introduce any tabs\n.    {color:green}+1{color} the patch does not introduce any trailing spaces\n.    {color:green}+1{color} the patch does not introduce any line longer than 120\n.    {color:red}-1{color} the patch does not add/modify any testcase\n{color:green}+1 RAT{color}\n.    {color:green}+1{color} the patch does not seem to introduce new RAT warnings\n{color:green}+1 JAVADOC{color}\n.    {color:green}+1{color} the patch does not seem to introduce new Javadoc warnings\n.    {color:red}WARNING{color}: the current HEAD has 23 Javadoc warning(s)\n{color:green}+1 COMPILE{color}\n.    {color:green}+1{color} HEAD compiles\n.    {color:green}+1{color} patch compiles\n.    {color:green}+1{color} the patch does not seem to introduce new javac warnings\n{color:green}+1 FINDBUGS{color}\n.    {color:green}+1{color} the patch does not seem to introduce new Findbugs warnings\n.    {color:red}WARNING: the current HEAD has  Findbugs warning(s), they should be addressed ASAP{color}\n{color:red}-1 TESTS{color}\n.    Tests run: 863\n.    Tests failed: 16\n.    Tests errors: 20\n\n.    The patch failed the following testcases:\n\n.      testAsyncSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testSyncUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testAsyncUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testSyncHubSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testAsyncHubSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testSyncHubUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testAsyncHubUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testPublishWithBookKeeperError[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testAsyncSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testSyncUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testAsyncUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testSyncHubSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testAsyncHubSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testSyncHubUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testAsyncHubUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testPublishWithBookKeeperError[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n\n{color:green}+1 DISTRO{color}\n.    {color:green}+1{color} distro tarball builds with the patch \n\n----------------------------\n{color:red}*-1 Overall result, please check the reported -1(s)*{color}\n\n{color:red}.   There is at least one warning, please check{color}\n\nThe full output of the test-patch run is available at\n\n.   https://builds.apache.org/job/bookkeeper-trunk-precommit-build/689/\n\n---\n*Hadoop QA* 2014-08-28T22:26:31.588+0000\n\nTesting JIRA BOOKKEEPER-718\n\n\nPatch [0001-BOOKKEEPER-718-AuditorLedgerCheckerTest-is-flakey.patch|https://issues.apache.org/jira/secure/attachment/12664986/0001-BOOKKEEPER-718-AuditorLedgerCheckerTest-is-flakey.patch] downloaded at Thu Aug 28 21:23:15 UTC 2014\n\n----------------------------\n\n{color:green}+1 PATCH_APPLIES{color}\n{color:green}+1 CLEAN{color}\n{color:red}-1 RAW_PATCH_ANALYSIS{color}\n.    {color:green}+1{color} the patch does not introduce any @author tags\n.    {color:green}+1{color} the patch does not introduce any tabs\n.    {color:green}+1{color} the patch does not introduce any trailing spaces\n.    {color:green}+1{color} the patch does not introduce any line longer than 120\n.    {color:red}-1{color} the patch does not add/modify any testcase\n{color:green}+1 RAT{color}\n.    {color:green}+1{color} the patch does not seem to introduce new RAT warnings\n{color:green}+1 JAVADOC{color}\n.    {color:green}+1{color} the patch does not seem to introduce new Javadoc warnings\n.    {color:red}WARNING{color}: the current HEAD has 23 Javadoc warning(s)\n{color:green}+1 COMPILE{color}\n.    {color:green}+1{color} HEAD compiles\n.    {color:green}+1{color} patch compiles\n.    {color:green}+1{color} the patch does not seem to introduce new javac warnings\n{color:green}+1 FINDBUGS{color}\n.    {color:green}+1{color} the patch does not seem to introduce new Findbugs warnings\n.    {color:red}WARNING: the current HEAD has  Findbugs warning(s), they should be addressed ASAP{color}\n{color:red}-1 TESTS{color}\n.    Tests run: 863\n.    Tests failed: 16\n.    Tests errors: 20\n\n.    The patch failed the following testcases:\n\n.      testAsyncSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testSyncUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testAsyncUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testSyncHubSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testAsyncHubSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testSyncHubUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testAsyncHubUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testPublishWithBookKeeperError[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testAsyncSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testSyncUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testAsyncUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testSyncHubSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testAsyncHubSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testSyncHubUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testAsyncHubUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testPublishWithBookKeeperError[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n\n{color:green}+1 DISTRO{color}\n.    {color:green}+1{color} distro tarball builds with the patch \n\n----------------------------\n{color:red}*-1 Overall result, please check the reported -1(s)*{color}\n\n{color:red}.   There is at least one warning, please check{color}\n\nThe full output of the test-patch run is available at\n\n.   https://builds.apache.org/job/bookkeeper-trunk-precommit-build/696/\n\n---\n*Hadoop QA* 2014-08-29T00:04:41.257+0000\n\nTesting JIRA BOOKKEEPER-718\n\n\nPatch [0001-BOOKKEEPER-718-AuditorLedgerCheckerTest-is-flakey.patch|https://issues.apache.org/jira/secure/attachment/12664986/0001-BOOKKEEPER-718-AuditorLedgerCheckerTest-is-flakey.patch] downloaded at Thu Aug 28 23:01:27 UTC 2014\n\n----------------------------\n\n{color:green}+1 PATCH_APPLIES{color}\n{color:green}+1 CLEAN{color}\n{color:red}-1 RAW_PATCH_ANALYSIS{color}\n.    {color:green}+1{color} the patch does not introduce any @author tags\n.    {color:green}+1{color} the patch does not introduce any tabs\n.    {color:green}+1{color} the patch does not introduce any trailing spaces\n.    {color:green}+1{color} the patch does not introduce any line longer than 120\n.    {color:red}-1{color} the patch does not add/modify any testcase\n{color:green}+1 RAT{color}\n.    {color:green}+1{color} the patch does not seem to introduce new RAT warnings\n{color:green}+1 JAVADOC{color}\n.    {color:green}+1{color} the patch does not seem to introduce new Javadoc warnings\n.    {color:red}WARNING{color}: the current HEAD has 23 Javadoc warning(s)\n{color:green}+1 COMPILE{color}\n.    {color:green}+1{color} HEAD compiles\n.    {color:green}+1{color} patch compiles\n.    {color:green}+1{color} the patch does not seem to introduce new javac warnings\n{color:green}+1 FINDBUGS{color}\n.    {color:green}+1{color} the patch does not seem to introduce new Findbugs warnings\n.    {color:red}WARNING: the current HEAD has  Findbugs warning(s), they should be addressed ASAP{color}\n{color:red}-1 TESTS{color}\n.    Tests run: 863\n.    Tests failed: 16\n.    Tests errors: 20\n\n.    The patch failed the following testcases:\n\n.      testAsyncSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testSyncUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testAsyncUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testSyncHubSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testAsyncHubSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testSyncHubUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testAsyncHubUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testPublishWithBookKeeperError[1](org.apache.hedwig.server.integration.TestHedwigHubRegular)\n.      testAsyncSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testSyncUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testAsyncUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testSyncHubSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testAsyncHubSubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testSyncHubUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testAsyncHubUnsubscribeWithInvalidSubscriberId[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n.      testPublishWithBookKeeperError[1](org.apache.hedwig.server.integration.TestHedwigHubSSL)\n\n{color:green}+1 DISTRO{color}\n.    {color:green}+1{color} distro tarball builds with the patch \n\n----------------------------\n{color:red}*-1 Overall result, please check the reported -1(s)*{color}\n\n{color:red}.   There is at least one warning, please check{color}\n\nThe full output of the test-patch run is available at\n\n.   https://builds.apache.org/job/bookkeeper-trunk-precommit-build/697/\n\n---\n*Sijie Guo* 2014-09-06T05:51:29.048+0000\n\npatch looks good to me. +1.\n\ncommitted as r1622830.\n\n---\n*Hudson* 2014-09-06T07:08:24.692+0000\n\nFAILURE: Integrated in bookkeeper-trunk #766 (See [https://builds.apache.org/job/bookkeeper-trunk/766/])\nBOOKKEEPER-718: AuditorLedgerCheckerTest is flakey (ivank via sijie) (sijie: rev 1622830)\n* /zookeeper/bookkeeper/trunk/CHANGES.txt\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeperAdmin.java\n\n\n---\n*Charan Reddy Guttapalem* 2017-02-24T22:44:25.164+0000\n\nHey [~govindmenon] , wondering if you got chance to look at this flakiness. Tests of this testsuite are flapping both in the community builds and in our internal builds. Considering that this testsuite tests Auditor, I'm little hesitant to exclude this testsuite from testruns/testresults. \n\n[~jujjuri] FYI\n\n---\n*Govind Menon* 2017-02-24T22:54:12.503+0000\n\nI'll take a closer look at this now (was working on another JIRA)\n", "commits": {}, "user": "ivankelly", "commitsDetails": [], "labels": ["jiramigrated", "type/bug"], "ttf": 669.0002777777778}, {"created": "2017-10-17 21:33:20", "closed": "2019-08-18 16:34:38", "title": "BookieRecoveryTest.ensurePasswordUsedForOldLedgers failing", "url": "https://github.com/apache/bookkeeper/issues/631", "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-1000\n\nReporter: Robert Joseph Evans \n\nTests in error:\n  BookieRecoveryTest.ensurePasswordUsedForOldLedgers[4] \u00bb BKNoSuchLedgerExists\n  BookieRecoveryTest.ensurePasswordUsedForOldLedgers[5] \u00bb BKNoSuchLedgerExists\n\nThis has been happening in master recently both in Jenkins and on my Mac.  I'll try to take a look at it.\n\n### Comments from JIRA\n\n\n---\n*Robert Joseph Evans* 2017-02-08T21:31:05.619+0000\n\nThe test fails consistently for org.apache.bookkeeper.meta.LongHierarchicalLedgerManagerFactory.\n\n---\n*Robert Joseph Evans* 2017-02-08T21:46:12.647+0000\n\nIt looks like this is a bug in BOOKKEEPER-873 and BOOKKEEPER-553.  Not sure how this test ever passed for them.  Essentially because the layout of the files changed for 2-4-4- to 3-4-4-4-4 it is not able to see the older ledgers.  It just ignores them.  It seems like we should be able to make it so that for IDs < max int we go with 2-4-4 and for > max int we go with 3-4-4-4-4.  Or we just disable this particular test because it will never work.  I would prefer to do the former because it provides a path towards a rolling upgrade.\n\n[~knusbaum] said he was already looking at this so I think I will just hand it off to him.\n\n---\n*Robert Joseph Evans* 2017-02-08T21:48:08.873+0000\n\n[~mmerli],\n\nWould you mind adding in [~knusbaum] as a contributor so he can take over this JIRA?\n\n---\n*Matteo Merli* 2017-02-08T22:10:17.484+0000\n\n[~revans2] Sure, added Kyle\n", "commits": {}, "user": "ivankelly", "commitsDetails": [], "labels": ["jiramigrated", "type/bug"], "ttf": 669.0002777777778}, {"created": "2017-10-17 21:28:53", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerHandle.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.handleBookieFailure(java.util.Map)"}, {"INS": 1, "DEL": 6, "TOT": 14, "MOV": 4, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.handleDelayedWriteBookieFailure()"}, {"INS": 0, "DEL": 3, "TOT": 6, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.ChangeEnsembleCb.safeOperationComplete(int,org.apache.bookkeeper.client.LedgerMetadata)"}, {"INS": 0, "DEL": 3, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.ChangeEnsembleCb"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.ReReadLedgerMetadataCb.updateMetadataIfPossible(org.apache.bookkeeper.client.LedgerMetadata,org.apache.bookkeeper.client.LedgerMetadata)"}]}], "nameRev": "3ab6e9253555d013a8c6eb3b90cddffa090fcaee tags/release-4.9.0~224", "commitHash": "3ab6e9253555d013a8c6eb3b90cddffa090fcaee", "commitMessage": "Delayed write ensemble change may cause dataloss\n\nDescriptions of the changes in this PR:\n\nThe Original intent of this change is to do a best-effort ensemble change.\nBut this is not possible until the local metadata is completely immutable.\nUntil the feature \"Make LedgerMetadata Immutable #610\" Is complete we will use\nhandleBookieFailure() to handle delayed writes as regular bookie failures.\n\nSigned-off-by: Venkateswararao Jujjuri (JV) <vjujjurisalesforce.com>\n\nMaster Issue: #1591\nRelate Issue: #1395\n\nAuthor: JV Jujjuri <vjujjuri@salesforce.com>\nAuthor: Ivan Kelly <ivank@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #1592 from jvrao/datalossbug\n", "commitGitStats": [{"lines": 78, "deletions": 61, "insertions": 17, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java"}], "commitParents": ["6b9cbf2052b27f331553f2738483ae21bf12b49c"], "commitDateTime": "2018-08-13 15:00:02", "commitUser": "ivankelly", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-13 15:00:02"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerHandle.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.handleBookieFailure(java.util.Map)"}, {"INS": 1, "DEL": 6, "TOT": 14, "MOV": 4, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.handleDelayedWriteBookieFailure()"}, {"INS": 0, "DEL": 3, "TOT": 6, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.ChangeEnsembleCb.safeOperationComplete(int,org.apache.bookkeeper.client.LedgerMetadata)"}, {"INS": 0, "DEL": 3, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.ChangeEnsembleCb"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerHandle.ReReadLedgerMetadataCb.updateMetadataIfPossible(org.apache.bookkeeper.client.LedgerMetadata,org.apache.bookkeeper.client.LedgerMetadata)"}]}], "nameRev": "2c421e9ed6cee7f5259f2a7ea433466a5424edf6 tags/release-4.8.1~58", "commitHash": "2c421e9ed6cee7f5259f2a7ea433466a5424edf6", "commitMessage": "Delayed write ensemble change may cause dataloss\n\nDescriptions of the changes in this PR:\n\nThe Original intent of this change is to do a best-effort ensemble change.\nBut this is not possible until the local metadata is completely immutable.\nUntil the feature \"Make LedgerMetadata Immutable #610\" Is complete we will use\nhandleBookieFailure() to handle delayed writes as regular bookie failures.\n\nSigned-off-by: Venkateswararao Jujjuri (JV) <vjujjurisalesforce.com>\n\nMaster Issue: #1591\nRelate Issue: #1395\n\nAuthor: JV Jujjuri <vjujjuri@salesforce.com>\nAuthor: Ivan Kelly <ivank@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Sijie Guo <sijie@apache.org>\n\nThis closes #1592 from jvrao/datalossbug\n\n(cherry picked from commit 3ab6e9253555d013a8c6eb3b90cddffa090fcaee)\nSigned-off-by: Ivan Kelly <ivank@apache.org>\n", "commitGitStats": [{"lines": 78, "deletions": 61, "insertions": 17, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java"}], "commitParents": ["5f3d28228ac984ded435d932b05cb1d348694dfc"], "commitDateTime": "2018-08-13 15:00:52", "commitUser": "ivankelly", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-08-13 15:00:02"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["jiramigrated", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Make LedgerMetadata Immutable", "numCommits": 0, "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-822\n\nReporter: Ivan Kelly @ivankelly\n\nMutable metadata has been a very rich source of bugs. There are multiple processing modifying for rebuilding ensembles, closing, fencing, autorecovery etc.\n\nThe local metadata should be a mirror of the metadata in zookeeper. So we should only modify the local metadata as a whole. The first part of this is making it immutable, so that it can only be modified with a builder.\n\n### Comments from JIRA\n\n\n---\n*Ivan Kelly* 2017-10-09T09:28:33.199+0000\n\nI think this is already done, but moving over to gh anyhow to verify.\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"3ab6e9253555d013a8c6eb3b90cddffa090fcaee": {"commitUser": "ivankelly", "commitGHEventType": "referenced"}, "2c421e9ed6cee7f5259f2a7ea433466a5424edf6": {"commitUser": "ivankelly", "commitGHEventType": "referenced"}}, "closed": "2018-07-31 09:28:35", "url": "https://github.com/apache/bookkeeper/issues/610", "user": "ivankelly", "ttf": 286.0002777777778}, {"created": "2017-10-17 21:28:37", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "67e818a97bac9204699af8474f42159056d407b9 tags/release-4.8.1~408", "commitHash": "67e818a97bac9204699af8474f42159056d407b9", "commitMessage": "Issue #605: bk_server.conf wrong default logSizeLimit\n\nIt's commented out, but the value is invalid. This patch changes it to\nmatch the default in ServerConfiguration.\n\nAuthor: Ivan Kelly <ivank@apache.org>\n\nReviewers: Jia Zhai <None>, Sijie Guo <sijie@apache.org>\n\nThis closes #1105 from ivankelly/entry-log-size, closes #605\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/conf/bk_server.conf"}], "commitParents": ["a226dbedff03102291648df3a60e78a2c85ae65f"], "commitDateTime": "2018-02-02 10:37:59", "commitUser": "jiazhai", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-02-02 10:37:59"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["jiramigrated", "release/4.7.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Fix default value of logSizeLimit", "numCommits": 0, "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-856\n\nReporter: Flavio Junqueira @fpj\n\nWhen I run ./bookkeeper bookie, I get an error complaining about the value of the variable:\n\n{norformat}\n2015-05-24 14:14:01,196 - ERROR - [main:BookieServer@289] - Malformed configuration file: /home/fpj/code/bookkeeper-4.3.1/bookkeeper-server/conf/bk_server.conf\norg.apache.commons.configuration.ConfigurationException: Entry log file size should not be larger than 1073741824\n{noformat}\n\nThe parameter is commented out by default, so the fix is to bring it back in and set an appropriate value.\n\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"67e818a97bac9204699af8474f42159056d407b9": {"commitUser": "jiazhai", "commitGHEventType": "referenced"}}, "closed": "2018-02-01 20:26:23", "url": "https://github.com/apache/bookkeeper/issues/605", "user": "ivankelly", "ttf": 106.00027777777778}, {"created": "2017-10-17 21:28:09", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "6fcabfc80c5bd6cdfa9252cdfc4ed209cc0620a6 tags/release-4.6.2~111", "commitHash": "6fcabfc80c5bd6cdfa9252cdfc4ed209cc0620a6", "commitMessage": "ISSUE #596 ISSUE #583: Auto replication should honor ensemble placement policy\n\nDescriptions of the changes in this PR:\n\nThis pull request ports the changes from [twitter/bookkeeperfc7e171](https://github.com/twitter/bookkeeper/commit/fc7e171135a58cddb9e91f5f614b3ceb6f9f9fee)\n\nThe changes include:\n\n1. when bookkeeper admin re-replicates a ledger, it will pick a bookie from the available bookies in the cluster to satisfy the placement constraint. (#596)\n2. hence, remove `targetBookie` from ReplicationWorker, because the parameter will volatile the placement constraint. (#583)\n3. at the same time, change `LedgerFragement` to represent the number of bookies that need to be check and replicate. a) the ledger checker can use the correct bookie index for verifying the existence of entries in a bookie (for stripping case) b) only read entries one time when need to replicate them to multiple bookies.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>\n\nThis closes #641 from sijie/twitter_autorecovery_fixes, closes #596, closes #583\n", "commitGitStats": [{"lines": 106, "deletions": 17, "insertions": 89, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerFragment.java"}, {"lines": 7, "deletions": 0, "insertions": 7, "filePath": "bookkeeper-server/conf/log4j.shell.properties"}, {"lines": 168, "deletions": 100, "insertions": 68, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/ReplicationWorker.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/BookieAutoRecoveryTest.java"}, {"lines": 55, "deletions": 10, "insertions": 45, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestLedgerChecker.java"}, {"lines": 1, "deletions": 0, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/ReplicationStats.java"}, {"lines": 173, "deletions": 91, "insertions": 82, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerFragmentReplicator.java"}, {"lines": 12, "deletions": 7, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java"}, {"lines": 21, "deletions": 0, "insertions": 21, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java"}, {"lines": 9, "deletions": 7, "insertions": 2, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java"}, {"lines": 21, "deletions": 12, "insertions": 9, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookKeeperCloseTest.java"}, {"lines": 15, "deletions": 9, "insertions": 6, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestLedgerFragmentReplication.java"}, {"lines": 167, "deletions": 37, "insertions": 130, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerChecker.java"}, {"lines": 9, "deletions": 6, "insertions": 3, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AutoRecoveryMain.java"}, {"lines": 64, "deletions": 55, "insertions": 9, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/TestReplicationWorker.java"}, {"lines": 486, "deletions": 187, "insertions": 299, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeperAdmin.java"}], "commitParents": ["e9b857092703719c9ea38a3a74107fe5114af94a"], "commitDateTime": "2017-10-27 16:09:48", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "tooManyChanges", "authoredDateTime": "2017-10-27 16:09:48"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "area/client", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Auto replication should honor ensemble placement policy", "numCommits": 0, "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-915\n\nReporter: Siddharth Sunil Boobna @sboobna\n\nReplicationWorker does not honor Ensemble Placement Policy.\nThe target bookie in ReplicationWorker should only be able to replicate based on the placement policy, else give up the underreplicated lock. For example, in rackaware policy, the target bookie should only be able to replicate if its not in the same rack as the other bookies in the ensemble, or if there isn't any other bookie available in different racks.\n\n### Comments from JIRA\n\n\n---\n*Sijie Guo* 2016-04-07T05:59:59.916+0000\n\n[~sboobna] we actually have a fix at Twitter's branch: https://github.com/twitter/bookkeeper/commit/fc7e171135a58cddb9e91f5f614b3ceb6f9f9fee would willing to consolidate the work if you haven't started yet.\n\n---\n*Sijie Guo* 2017-07-28T00:03:24.547+0000\n\nmove replication related changes to 4.6.0\n\n---\n*Ivan Kelly* 2017-10-06T09:01:29.241+0000\n\nRelevant commit in yahoo branch :\nhttps://github.com/yahoo/bookkeeper/commit/8b6f7f07793c6a1cbfe142c94c14a66c7c415eaa\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"6fcabfc80c5bd6cdfa9252cdfc4ed209cc0620a6": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-10-27 23:09:59", "url": "https://github.com/apache/bookkeeper/issues/596", "user": "ivankelly", "ttf": 10.000277777777777}, {"created": "2017-10-17 21:27:45", "closed": "2019-08-18 16:46:25", "title": "command line options", "url": "https://github.com/apache/bookkeeper/issues/589", "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-953\n\nReporter: John Lonergan @Johnlon\n\nUse more conventional patterns in usage warning messages ..\n\nEg  \n{code}usage: listbookies  [-readwrite|-readonly] [-hostnames]{code}\nought to be \n{code}usage: listbookies  (-readwrite|-readonly) [-hostnames]{code}\n\n.. if exactly one of -readwrite|-readonly are required as per the warning ...\n\n{code}\n$ bin/bookkeeper shell listbookies\n20:23:17,808 ERROR One and only one of -readwrite and -readonly must be specified\nlistbookies: List the bookies, which are running as either readwrite or readonly mode.\nusage: listbookies  [-readwrite|-readonly] [-hostnames]\n -h,--hostnames    Also print hostname of the bookie\n -ro,--readonly    Print readonly bookies\n -rw,--readwrite   Print readwrite bookies\n{code}\n\nThere might be other instances so I suggest they are listed here and done in one go.\n\n", "commits": {}, "user": "ivankelly", "commitsDetails": [], "labels": ["jiramigrated", "triage/18-w13", "type/bug"], "ttf": 669.0002777777778}, {"created": "2017-10-17 21:27:42", "closed": "2018-03-26 11:03:10", "title": "Bk vs gluster docs", "url": "https://github.com/apache/bookkeeper/issues/588", "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-954\n\nReporter: John Lonergan @Johnlon\n\nhttps://cwiki.apache.org/confluence/display/BOOKKEEPER/BookKeeper+and+GlusterFS\n\nIt would be good if this page actually explained the GFS differences to Bk.\n\n\nSo for example where we have \"Now A and B are inconsistent.\", this could be followed by a comparison to bk .. \"by contrast bk would avoid this possibility by...\"\n\n### Comments from JIRA\n\n\n---\n*John Lonergan* 2016-10-19T10:31:21.018+0000\n\nTypo. I meant you say...\n\nthe GFS differences to Bk.\n\n---\n*Sijie Guo* 2016-10-19T16:44:08.266+0000\n\n[~johnlon] I didn't realize the existence of this page. It seems to be pretty old - I guessed it was created by [~ikelly] and [~fpj]. \n\n[~ikelly] [~fpj] - do you remember any context about this? \n", "commits": {}, "user": "ivankelly", "commitsDetails": [], "labels": ["jiramigrated", "type/bug"], "ttf": 159.00027777777777}, {"created": "2017-10-17 21:27:29", "closed": "2018-03-26 10:54:44", "title": "Jenkins failed while test BookieClientTest.testWriteGaps", "url": "https://github.com/apache/bookkeeper/issues/584", "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-975\n\nReporter: Jia Zhai @jiazhai\n\nHere is error reporting:\n```\n2016-11-23 09:03:24,919 - ERROR - [BookieWriteThread-13645-orderedsafeexecutor-0-0:WriteEntryProcessorV3@125] - Unexpected exception while writing 1@1 : \njava.nio.BufferUnderflowException\n\tat java.nio.Buffer.nextGetIndex(Buffer.java:506)\n\tat java.nio.HeapByteBuffer.getLong(HeapByteBuffer.java:412)\n\tat org.apache.bookkeeper.bookie.SortedLedgerStorage.addEntry(SortedLedgerStorage.java:99)\n\tat org.apache.bookkeeper.bookie.LedgerDescriptorImpl.addEntry(LedgerDescriptorImpl.java:80)\n\tat org.apache.bookkeeper.bookie.Bookie.addEntryInternal(Bookie.java:1176)\n\tat org.apache.bookkeeper.bookie.Bookie.addEntry(Bookie.java:1235)\n\tat org.apache.bookkeeper.proto.WriteEntryProcessorV3.getAddResponse(WriteEntryProcessorV3.java:109)\n\tat org.apache.bookkeeper.proto.WriteEntryProcessorV3.safeRun(WriteEntryProcessorV3.java:142)\n\tat org.apache.bookkeeper.util.SafeRunnable.run(SafeRunnable.java:31)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n2016-11-23 09:03:24,950 - ERROR - [BKClientOrderedSafeExecutor-orderedsafeexecutor-1-0:SafeRunnable@33] - Unexpected throwable caught \njava.lang.IndexOutOfBoundsException: Invalid readerIndex: 16 - Maximum is 0\n\tat org.jboss.netty.buffer.EmptyChannelBuffer.readerIndex(EmptyChannelBuffer.java:50)\n\tat org.apache.bookkeeper.test.BookieClientTest$1.readEntryComplete(BookieClientTest.java:112)\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion$1.readEntryComplete(PerChannelBookieClient.java:930)\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient.handleReadResponse(PerChannelBookieClient.java:868)\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient$7.safeRun(PerChannelBookieClient.java:793)\n\tat org.apache.bookkeeper.util.SafeRunnable.run(SafeRunnable.java:31)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.run(FutureTask.java:266)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n\tat java.lang.Thread.run(Thread.java:745)\n2016-11-23 09:03:25,088 - WARN  - [GarbageCollectorThread:ScanAndCompareGarbageCollector@153] - Exception when iterating over the metadata {}\njava.lang.NullPointerException\n\tat org.apache.bookkeeper.util.ZkUtils.getChildrenInSingleNode(ZkUtils.java:207)\n\tat org.apache.bookkeeper.util.ZkUtils.getChildrenInSingleNode(ZkUtils.java:169)\n\tat org.apache.bookkeeper.meta.FlatLedgerManager$1.preload(FlatLedgerManager.java:110)\n\tat org.apache.bookkeeper.meta.FlatLedgerManager$1.hasNext(FlatLedgerManager.java:120)\n\tat org.apache.bookkeeper.bookie.ScanAndCompareGarbageCollector.gc(ScanAndCompareGarbageCollector.java:104)\n\tat org.apache.bookkeeper.bookie.GarbageCollectorThread.doGcLedgers(GarbageCollectorThread.java:371)\n\tat org.apache.bookkeeper.bookie.GarbageCollectorThread.run(GarbageCollectorThread.java:329)\n2016-11-23 09:03:25,944 - INFO  - [main:BookieServer@167] - Shutting down BookieServer\n2016-11-23 09:03:25,945 - INFO  - [main:BookieNettyServer@127] - Shutting down BookieNettyServer\n2016-11-23 09:03:25,950 - INFO  - [New I/O worker #10:PerChannelBookieClient@701] - Disconnected from bookie channel [id: 0x7b660837, /127.0.0.1:48812 :> /127.0.0.1:13645]\n2016-11-23 09:03:25,971 - INFO  - [main:Bookie@1096] - Shutting down Bookie-13645 with exitCode 0\n2016-11-23 09:03:25,972 - INFO  - [main:Journal@970] - Shutting down Journal\n2016-11-23 09:03:25,973 - ERROR - [ForceWriteThread:Journal$ForceWriteThread@433] - ForceWrite thread interrupted\njava.lang.InterruptedException\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.reportInterruptAfterWait(AbstractQueuedSynchronizer.java:2014)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2048)\n\tat java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)\n\tat org.apache.bookkeeper.bookie.Journal$ForceWriteThread.run(Journal.java:393)\n2016-11-23 09:03:25,974 - WARN  - [BookieJournal-13645:Journal@950] - Journal exits when shutting down\njava.lang.InterruptedException\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.reportInterruptAfterWait(AbstractQueuedSynchronizer.java:2014)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2048)\n\tat java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)\n\tat org.apache.bookkeeper.bookie.Journal.run(Journal.java:835)\n2016-11-23 09:03:25,975 - INFO  - [BookieJournal-13645:Journal@959] - Journal exited loop!\n```\n\nThis link contains more info:\nhttps://builds.apache.org/job/bookkeeper-master-git-pullrequest/159/testReport/org.apache.bookkeeper.test/BookieClientTest/testWriteGaps/\n\n", "commits": {}, "user": "ivankelly", "commitsDetails": [], "labels": ["jiramigrated", "type/bug"], "ttf": 159.00027777777777}, {"created": "2017-10-17 21:27:26", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "6fcabfc80c5bd6cdfa9252cdfc4ed209cc0620a6 tags/release-4.6.2~111", "commitHash": "6fcabfc80c5bd6cdfa9252cdfc4ed209cc0620a6", "commitMessage": "ISSUE #596 ISSUE #583: Auto replication should honor ensemble placement policy\n\nDescriptions of the changes in this PR:\n\nThis pull request ports the changes from [twitter/bookkeeperfc7e171](https://github.com/twitter/bookkeeper/commit/fc7e171135a58cddb9e91f5f614b3ceb6f9f9fee)\n\nThe changes include:\n\n1. when bookkeeper admin re-replicates a ledger, it will pick a bookie from the available bookies in the cluster to satisfy the placement constraint. (#596)\n2. hence, remove `targetBookie` from ReplicationWorker, because the parameter will volatile the placement constraint. (#583)\n3. at the same time, change `LedgerFragement` to represent the number of bookies that need to be check and replicate. a) the ledger checker can use the correct bookie index for verifying the existence of entries in a bookie (for stripping case) b) only read entries one time when need to replicate them to multiple bookies.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>\n\nThis closes #641 from sijie/twitter_autorecovery_fixes, closes #596, closes #583\n", "commitGitStats": [{"lines": 106, "deletions": 17, "insertions": 89, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerFragment.java"}, {"lines": 7, "deletions": 0, "insertions": 7, "filePath": "bookkeeper-server/conf/log4j.shell.properties"}, {"lines": 168, "deletions": 100, "insertions": 68, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/ReplicationWorker.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/BookieAutoRecoveryTest.java"}, {"lines": 55, "deletions": 10, "insertions": 45, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestLedgerChecker.java"}, {"lines": 1, "deletions": 0, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/ReplicationStats.java"}, {"lines": 173, "deletions": 91, "insertions": 82, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerFragmentReplicator.java"}, {"lines": 12, "deletions": 7, "insertions": 5, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/Auditor.java"}, {"lines": 21, "deletions": 0, "insertions": 21, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java"}, {"lines": 9, "deletions": 7, "insertions": 2, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java"}, {"lines": 21, "deletions": 12, "insertions": 9, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookKeeperCloseTest.java"}, {"lines": 15, "deletions": 9, "insertions": 6, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestLedgerFragmentReplication.java"}, {"lines": 167, "deletions": 37, "insertions": 130, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerChecker.java"}, {"lines": 9, "deletions": 6, "insertions": 3, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AutoRecoveryMain.java"}, {"lines": 64, "deletions": 55, "insertions": 9, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/TestReplicationWorker.java"}, {"lines": 486, "deletions": 187, "insertions": 299, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeperAdmin.java"}], "commitParents": ["e9b857092703719c9ea38a3a74107fe5114af94a"], "commitDateTime": "2017-10-27 16:09:48", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "tooManyChanges", "authoredDateTime": "2017-10-27 16:09:48"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "area/client", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "ReplicationWorker should choose bookies from cluster rather than using local bookie", "numCommits": 0, "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-977\n\nReporter: Sijie Guo @sijie\n\ncurrently replication worker uses local address for the target address. it has two problems:\n\n1) if autorecovery is running separately, it doesn't work\n2) it will volatile the placement policy\n\n### Comments from JIRA\n\n\n---\n*Sijie Guo* 2017-07-28T00:03:42.073+0000\n\nmove replication related changes to 4.6.0\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"6fcabfc80c5bd6cdfa9252cdfc4ed209cc0620a6": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-10-27 23:09:59", "url": "https://github.com/apache/bookkeeper/issues/583", "user": "ivankelly", "ttf": 10.000277777777777}, {"created": "2017-10-17 21:27:20", "closed": "2019-08-18 16:47:48", "title": "Open a Ticket for \"Who is using Bookkeeper\"", "url": "https://github.com/apache/bookkeeper/issues/581", "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-982\n\nReporter: Jia Zhai @jiazhai\n\nAs discussed, would like to create an always open issue \"who is using Bookkeeper\" on github.\n\nHere is some example of other project:\n[https://github.com/alibaba/RocketMQ/issues/1] \n[https://github.com/mgechev/angular-seed/issues/855]\n[https://github.com/labstack/echo/issues/295]\n\n", "commits": {}, "user": "ivankelly", "commitsDetails": [], "labels": ["jiramigrated", "type/bug"], "ttf": 669.0002777777778}, {"created": "2017-10-17 21:27:13", "closed": "2018-02-01 20:56:59", "title": "The merge pr script should handle new review comments", "url": "https://github.com/apache/bookkeeper/issues/579", "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-990\n\nReporter: Sijie Guo @sijie\n\nCurrent pr script only works github comments but doesn't work with the new github review comments. We need to improve the script to support it.\n\n", "commits": {}, "user": "ivankelly", "commitsDetails": [], "labels": ["jiramigrated", "status/wontfix", "type/bug"], "ttf": 106.00027777777778}, {"created": "2017-10-17 21:26:45", "closed": "2017-11-30 12:05:59", "title": "Use separate log for compaction", "url": "https://github.com/apache/bookkeeper/issues/571", "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-1040\n\nReporter: Yiming Zang \n\n1. Bookkeeper is not able to reclaim disk space when it's full\nIf all disks are full or almost full, both major and minor compactions would be suspended, and only GC will be running. In the current design, this is the right thing to do, because when disks are full, EntryLogger can not allocate any new entry logs any more, and apart from that,  the intention is to prevent disk usage from keep growing.\nHowever, the problem is if we have a mixed of short-lived ledgers and long-lived ledgers in all entry logs, when disks are full, GC wouldn't be able to delete any entry logs, and if compaction is disabled, bookie can't reclaim any disk space any more by itself.\n\n2. Compaction might keep generating duplicated data which would cause disk full\nCurrently, there's no transactional operation for compaction. In the current CompactionScannerFactory, if it fails to flush entry log file, or fails to flush ledgerCache, the data which is already flushed wouldn't be deleted, and the entry log that is being compacted will be retried again for the next time, which would generate duplicated data.\nMoreover, if the entry log being compacted has long-lived data and the compaction keeps failing for some reason(e.g. corrupted entry, corrupted index), it would cause the BK disk usage keep growing until the either the entry log can be garbage collected, or disk full.\n\n\n", "commits": {}, "user": "ivankelly", "commitsDetails": [], "labels": ["jiramigrated", "type/bug"], "ttf": 43.000277777777775}, {"created": "2017-10-17 21:26:33", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "EntryLogTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.EntryLogTest.testPreAllocateLog()"}]}, {"spoonFilePath": "EntryLogger.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.EntryLogger.getEntryLoggerAllocator()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.EntryLogger.EntryLoggerAllocator.getPreallocationFuture()"}, {"INS": 1, "DEL": 1, "TOT": 7, "MOV": 5, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.EntryLogger.EntryLoggerAllocator.createNewLog()"}]}], "nameRev": "b69f1e4d63e3f7adf04a772bd5cef002c81bc311 tags/release-4.8.1~562", "commitHash": "b69f1e4d63e3f7adf04a772bd5cef002c81bc311", "commitMessage": "ISSUE #568: Refactor EntryLoggerAllocator to enable preallocation\n\nDescriptions of the changes in this PR:\n\nEnable 'entryLogFilePreallocationEnabled' which is  never be used.\n\nAuthor: Arvin <arvindevel@gmail.com>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #814 from ArvinDevel/issue568, closes #568\n", "commitGitStats": [{"lines": 88, "deletions": 21, "insertions": 67, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/EntryLogTest.java"}, {"lines": 52, "deletions": 16, "insertions": 36, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/EntryLogger.java"}], "commitParents": ["a7991e5616b0f78d3b80334774a5b7d63dabb8c9"], "commitDateTime": "2017-12-06 00:30:44", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-12-06 00:30:44"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "CreateNewLogTest.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CreateNewLogTest.testCreateNewLog()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CreateNewLogTest.testCreateNewLogWithNoWritableLedgerDirs()"}]}], "nameRev": "50d50bd8064f67583c70688171bd3386ae418b64 tags/release-4.8.1~546", "commitHash": "50d50bd8064f67583c70688171bd3386ae418b64", "commitMessage": "Fix Flaky CreateNewLogTest\n\nDescriptions of the changes in this PR:\n\nCreateNewLogTest becomes flaky after fixing #568 because preallocation can happen in the background. Changing the sequence of creating entry logger and entry log file injection to make the test sequence deterministic.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #836 from sijie/fix_createnewlog_test\n", "commitGitStats": [{"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/CreateNewLogTest.java"}], "commitParents": ["f207d2d9f432d43e2461f260056b91f1ba4803e1"], "commitDateTime": "2017-12-13 13:45:04", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-12-13 13:45:04"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "release/4.7.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Issue with 'preallocation' feature in EntryLogger", "numCommits": 0, "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-1082\n\nReporter: Charan Reddy Guttapalem @reddycharan\n\nWith BOOKKEEPER-643 (https://github.com/apache/bookkeeper/commit/694568b0ff0d048c284c8d5db0c9455d30dfa3ce) feature, 'entryLogFilePreallocationEnabled' is introduced. But by the way it is handled,  it looks like it can never be used. \n\nIn EntryLoggerAllocator.createNewLog, even if entryLogPreAllocationEnabled is configured to true, else block is unreachable because \u2018preallocation\u2019 will always be null and it would end up with \u2018if\u2019 block. So effectively \u2018entryLogFilePreallocationEnabled\u2019 logic is broken.\n\n\n\n        synchronized BufferedLogChannel createNewLog() throws IOException {\n            BufferedLogChannel bc;\n            if (!entryLogPreAllocationEnabled || null == preallocation) {\n                // initialization time to create a new log\n                bc = allocateNewLog();\n            } else {\n                // has a preallocated entry log\n                ......\n                ......\n                preallocation = allocatorExecutor.submit(new Callable<BufferedLogChannel>() {   <-------- this is the only place where 'preallocation' is set and it is not possible to get into the else block in this method  ------------>\n\n                    @Override\n                    public BufferedLogChannel call() throws IOException {\n                        return allocateNewLog();\n                    }\n                });\n            }\n            LOG.info(\"Created new entry logger {}.\", bc.getLogId());\n            return bc;\n        }\n\n\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 2, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"50d50bd8064f67583c70688171bd3386ae418b64": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "b69f1e4d63e3f7adf04a772bd5cef002c81bc311": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-12-06 08:30:51", "url": "https://github.com/apache/bookkeeper/issues/568", "user": "ivankelly", "ttf": 49.000277777777775}, {"created": "2017-10-17 21:24:23", "closed": "2017-11-30 12:06:40", "title": "Ledger eviction should not impact write performance", "url": "https://github.com/apache/bookkeeper/issues/566", "body": "\nJIRA: https://issues.apache.org/jira/browse/BOOKKEEPER-1106\n\nReporter: Yiming Zang \n\nWhen read behind happens, it would quickly read bunch of ledgers, which will evict current active ledgers for writing from the ledger cache. with the ledger being evicted from cache, it would impact the write performance.\n\nIn order to address this issue, we should separate write FileInfo and read FileInfo in the cache.\n\n", "commits": {}, "user": "ivankelly", "commitsDetails": [], "labels": ["jiramigrated", "type/bug"], "ttf": 43.000277777777775}, {"created": "2017-10-09 08:26:26", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "819443cd5efc9393236d76ca2a5e2284efea0e22 tags/release-4.8.1~590", "commitHash": "819443cd5efc9393236d76ca2a5e2284efea0e22", "commitMessage": "ISSUE #544: Bootup cookie validation considers an empty journal to signify a new bookie\n\nDescriptions of the changes in this PR:\n\n- read cookie from registration manager as the source-of-truth (for all potential options)\n- remove duplicated code between checkEnvironment and checkEnvironmentWithStorageExpansion\n\nAuthor: Sijie Guo <sijie@apache.org>\nAuthor: Ivan Kelly <ivank@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Enrico Olivelli <eolivelli@gmail.com>, Venkateswararao Jujjuri (JV) <None>\n\nThis closes #712 from sijie/fix_cookie_issue, closes #544\n", "commitGitStats": [{"lines": 6, "deletions": 3, "insertions": 3, "filePath": "tests/backward/src/test/java/org/apache/bookkeeper/tests/backward/TestBackwardCompat.java"}, {"lines": 424, "deletions": 212, "insertions": 212, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java"}, {"lines": 107, "deletions": 9, "insertions": 98, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/CookieTest.java"}, {"lines": 6, "deletions": 0, "insertions": 6, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/ScanAndCompareGarbageCollector.java"}, {"lines": 30, "deletions": 14, "insertions": 16, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieInitializationTest.java"}, {"lines": 10, "deletions": 6, "insertions": 4, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/UpdateCookieCmdTest.java"}, {"lines": 1, "deletions": 0, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieShell.java"}], "commitParents": ["87ffad969c160b0e82944a6638f1710347b0bbeb"], "commitDateTime": "2017-11-29 18:53:39", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "tooManyChanges", "authoredDateTime": "2017-11-29 18:53:39"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "priority/blocker", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Bootup cookie validation considers an empty journal to signify a new bookie", "numCommits": 0, "body": "This is wrong, and can lead to split brain.\r\n\r\nFrom the dev list:\r\nWe check all ledger, journal and index directories for a cookie. If it\r\ndoesn't exist, it gets added to a missingCookieDirs list. We then\r\niterate over this directory. If any directory in missingCookieDirs\r\nisn't listed as a ledger directory in the journal dir cookies, or\r\nisn't empty, we fail to start.\r\n\r\nThe issue is that a journal dir could be emptied and we wouldn't\r\ndetect it. It would be great if someone else could eyeball the code\r\nand tell me I'm wrong. The code is in Bookie#checkEnvironment.\r\n\r\nThis breaks correctness. Imagine we have a ledger on b1, b2, b3.\r\nWriter w1 is writing to the ledger.\r\nThe state of the ledger on the bookies is:\r\n\r\nb1: e0     Fenced: false, LAC: -\r\nb2: e0     Fenced: false, LAC: -\r\nb3: e0     Fenced: false, LAC: -\r\n\r\nw1 gets partitioned from network. w2 tries to recover the ledger, it\r\ntries to fence on all bookies. The message to b3 gets lost. b1 and b2\r\nacknowledge the fencing, so w2 continues to recover and close the\r\nledger with e0 as the last entry.\r\n\r\nb1: e0     Fenced: true, LAC: e0\r\nb2: e0     Fenced: true, LAC: e0\r\nb3: e0     Fenced: false, LAC: -\r\n\r\nIf w1 became unpartitioned at this point, it wouldn't be able to add a\r\nnew entry to the ledger as any quorum would see fenced on b1 or b2.\r\n\r\nHowever, imagine that the fenced message is only in the journal on b2,\r\nb2 crashes, something wipes the journal directory and then b2 comes\r\nback up. The new state of the ledger on the bookies will be.\r\n\r\nb1: e0     Fenced: true, LAC: e0\r\nb2: e0     Fenced: false, LAC: -\r\nb3: e0     Fenced: false, LAC: -\r\n\r\nNow w1 can write a new entry, e1, and b2 & b3 would both acknowledge\r\nit, even though the end of the ledger is e0.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"819443cd5efc9393236d76ca2a5e2284efea0e22": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-11-30 02:53:47", "url": "https://github.com/apache/bookkeeper/issues/544", "user": "ivankelly", "ttf": 51.000277777777775}, {"created": "2017-10-05 02:59:43", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LifecycleComponentStack.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.common.component.LifecycleComponentStack.Builder.build()"}]}, {"spoonFilePath": "Main.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 10, "MOV": 8, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.server.Main.buildBookieServer(org.apache.bookkeeper.server.conf.BookieConfiguration)"}]}], "nameRev": "9694fd263a3ee5e03740f99ca21e99918262f395 tags/release-4.6.2~133", "commitHash": "9694fd263a3ee5e03740f99ca21e99918262f395", "commitMessage": "ISSUE #540: BookieServer failed to start because lifecycle component name is not provided\n\nDescriptions of the changes in this PR:\n\n- add component name `bookie-server`\n- remove the catch block\n- fix the prometheus stats provider package name in configuration files.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>\n\nThis closes #541 from sijie/fix_lifecycle_stack, closes #540\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-common/src/main/java/org/apache/bookkeeper/common/component/LifecycleComponentStack.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/conf/bk_server.conf"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "deploy/kubernetes/gke/bookkeeper.yaml"}, {"lines": 56, "deletions": 31, "insertions": 25, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/server/Main.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/docs/latest/admin/metrics.md"}], "commitParents": ["758cdebb655bb68f7fd8017d289ce66ba9072e3e"], "commitDateTime": "2017-10-05 00:22:40", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-10-05 00:22:40"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "BookieServer failed to start because lifecycle component name is not provided", "numCommits": 0, "body": "\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\ndeploy the latest master to k8s\r\n\r\n- What did you expect to see?\r\n\r\nit should be able to run successfully.\r\n\r\n- What did you see instead?\r\n\r\nIt failed to start bookie pod due to \"Lifecycle component stack name is not provided\"\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"9694fd263a3ee5e03740f99ca21e99918262f395": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-10-05 07:22:48", "url": "https://github.com/apache/bookkeeper/issues/540", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-10-04 06:50:16", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "TestPrometheusMetricsProvider.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.prometheus.TestPrometheusMetricsProvider.testTwoCounters()"}]}], "nameRev": "758cdebb655bb68f7fd8017d289ce66ba9072e3e tags/release-4.6.2~134", "commitHash": "758cdebb655bb68f7fd8017d289ce66ba9072e3e", "commitMessage": "ISSUE #537: Compilation warning on unchecked cast\n\nDescriptions of the changes in this PR:\n\nadd `SuppressWarnings(\"unchecked\")` in TestPrometheusMetricsProvider.java\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>\n\nThis closes #538 from sijie/fix_compilation_error, closes #537\n", "commitGitStats": [{"lines": 1, "deletions": 0, "insertions": 1, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/test/java/org/apache/bookkeeper/stats/prometheus/TestPrometheusMetricsProvider.java"}], "commitParents": ["d82dc1c3e64e12e27ac8492ecbd4204a5529099c"], "commitDateTime": "2017-10-04 00:30:49", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-10-04 00:30:49"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "TestPrometheusMetricsProvider.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.prometheus.TestPrometheusMetricsProvider.testTwoCounters()"}]}], "nameRev": "c6ca4ecbf76f6dac7ebcd843a429dbbaaba62420 tags/release-4.5.1~6", "commitHash": "c6ca4ecbf76f6dac7ebcd843a429dbbaaba62420", "commitMessage": "ISSUE #537: Compilation warning on unchecked cast\n\nDescriptions of the changes in this PR:\n\nadd `SuppressWarnings(\"unchecked\")` in TestPrometheusMetricsProvider.java\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>\n\nThis closes #538 from sijie/fix_compilation_error, closes #537\n", "commitGitStats": [{"lines": 1, "deletions": 0, "insertions": 1, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/test/java/org/apache/bookkeeper/stats/prometheus/TestPrometheusMetricsProvider.java"}], "commitParents": ["01897ee3f647bd6b344ce816ab9d9f1eec5a7ff9"], "commitDateTime": "2017-10-04 00:49:44", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-10-04 00:30:49"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "release/4.5.1", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Compilation warning on unchecked cast", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nrun bookkeeper ci job\r\n\r\n- What did you expect to see?\r\n\r\nci passes\r\n\r\n- What did you see instead?\r\n\r\nthe compilation failed due to \"unchecked cast\" warning.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"758cdebb655bb68f7fd8017d289ce66ba9072e3e": {"commitUser": "sijie", "commitGHEventType": "closed"}, "c6ca4ecbf76f6dac7ebcd843a429dbbaaba62420": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2017-10-04 07:30:58", "url": "https://github.com/apache/bookkeeper/issues/537", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-10-04 01:33:24", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "PrometheusOpStatsLogger.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger.registerSuccessfulEvent(long,java.util.concurrent.TimeUnit)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger.registerFailedEvent(long,java.util.concurrent.TimeUnit)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger.registerFailedValue(long)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger.clear()"}, {"INS": 0, "DEL": 0, "TOT": 6, "MOV": 0, "UPD": 6, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger.registerSuccessfulValue(long)"}]}, {"spoonFilePath": "TestPrometheusMetricsProvider.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.prometheus.TestPrometheusMetricsProvider"}]}, {"spoonFilePath": "PrometheusMetricsProvider.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusMetricsProvider.getStatsLogger(java.lang.String)"}, {"INS": 0, "DEL": 0, "TOT": 8, "MOV": 0, "UPD": 8, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusMetricsProvider.start(org.apache.commons.configuration.Configuration)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusMetricsProvider"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusMetricsProvider.stop()"}]}, {"spoonFilePath": "PrometheusCounter.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter.add(long)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter.get()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter.dec()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter.clear()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter.inc()"}]}, {"spoonFilePath": "PrometheusUtil.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusUtil"}]}, {"spoonFilePath": "PrometheusStatsLogger.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger.getOpStatsLogger(java.lang.String)"}, {"INS": 0, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger.registerGauge(java.lang.String,org.apache.bookkeeper.stats.Gauge)"}, {"INS": 0, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger.scope(java.lang.String)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger.completeName(java.lang.String)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger.getCounter(java.lang.String)"}]}, {"spoonFilePath": "package-info.java", "spoonMethods": []}], "nameRev": "d82dc1c3e64e12e27ac8492ecbd4204a5529099c tags/release-4.6.2~135", "commitHash": "d82dc1c3e64e12e27ac8492ecbd4204a5529099c", "commitMessage": "ISSUE #535: Prometheus metrics provider fails to initialize\n\nDescriptions of the changes in this PR:\n\n- the parameter of `collectorNames` should be Collector rather than String\n- add test case for prometheus metrics provider\n- rename the classes to under `org.apache.bookkeeper.stats.prometheus` rather than taking the common `stats` package.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>, Matteo Merli <mmerli@apache.org>\n\nThis closes #536 from sijie/fix_promethus, closes #535\n", "commitGitStats": [{"lines": 54, "deletions": 0, "insertions": 54, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/test/java/org/apache/bookkeeper/stats/prometheus/TestPrometheusMetricsProvider.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/{ => prometheus}/package-info.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/{ => prometheus}/PrometheusUtil.java"}, {"lines": 3, "deletions": 1, "insertions": 2, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/{ => prometheus}/PrometheusCounter.java"}, {"lines": 4, "deletions": 1, "insertions": 3, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/{ => prometheus}/PrometheusMetricsProvider.java"}, {"lines": 4, "deletions": 1, "insertions": 3, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/{ => prometheus}/PrometheusOpStatsLogger.java"}, {"lines": 6, "deletions": 1, "insertions": 5, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/{ => prometheus}/PrometheusStatsLogger.java"}], "commitParents": ["029fc609cd4933b55af4d40af69ef59dad83a842"], "commitDateTime": "2017-10-04 10:51:08", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-10-04 10:51:08"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "PrometheusOpStatsLogger.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger.registerSuccessfulEvent(long,java.util.concurrent.TimeUnit)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger.registerFailedEvent(long,java.util.concurrent.TimeUnit)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger.registerFailedValue(long)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger.clear()"}, {"INS": 0, "DEL": 0, "TOT": 6, "MOV": 0, "UPD": 6, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger.registerSuccessfulValue(long)"}]}, {"spoonFilePath": "TestPrometheusMetricsProvider.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.prometheus.TestPrometheusMetricsProvider"}]}, {"spoonFilePath": "PrometheusMetricsProvider.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusMetricsProvider.getStatsLogger(java.lang.String)"}, {"INS": 0, "DEL": 0, "TOT": 8, "MOV": 0, "UPD": 8, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusMetricsProvider.start(org.apache.commons.configuration.Configuration)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusMetricsProvider"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusMetricsProvider.stop()"}]}, {"spoonFilePath": "PrometheusCounter.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter.add(long)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter.get()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter.dec()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter.clear()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter.inc()"}]}, {"spoonFilePath": "PrometheusUtil.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusUtil"}]}, {"spoonFilePath": "PrometheusStatsLogger.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger.getOpStatsLogger(java.lang.String)"}, {"INS": 0, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger.registerGauge(java.lang.String,org.apache.bookkeeper.stats.Gauge)"}, {"INS": 0, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger.scope(java.lang.String)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger.completeName(java.lang.String)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger.getCounter(java.lang.String)"}]}, {"spoonFilePath": "package-info.java", "spoonMethods": []}], "nameRev": "01897ee3f647bd6b344ce816ab9d9f1eec5a7ff9 tags/release-4.5.1~7", "commitHash": "01897ee3f647bd6b344ce816ab9d9f1eec5a7ff9", "commitMessage": "ISSUE #535: Prometheus metrics provider fails to initialize\n\nDescriptions of the changes in this PR:\n\n- the parameter of `collectorNames` should be Collector rather than String\n- add test case for prometheus metrics provider\n- rename the classes to under `org.apache.bookkeeper.stats.prometheus` rather than taking the common `stats` package.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>, Matteo Merli <mmerli@apache.org>\n\nThis closes #536 from sijie/fix_promethus, closes #535\n", "commitGitStats": [{"lines": 54, "deletions": 0, "insertions": 54, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/test/java/org/apache/bookkeeper/stats/prometheus/TestPrometheusMetricsProvider.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/{ => prometheus}/package-info.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/{ => prometheus}/PrometheusUtil.java"}, {"lines": 3, "deletions": 1, "insertions": 2, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/{ => prometheus}/PrometheusCounter.java"}, {"lines": 4, "deletions": 1, "insertions": 3, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/{ => prometheus}/PrometheusMetricsProvider.java"}, {"lines": 4, "deletions": 1, "insertions": 3, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/{ => prometheus}/PrometheusOpStatsLogger.java"}, {"lines": 6, "deletions": 1, "insertions": 5, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/{ => prometheus}/PrometheusStatsLogger.java"}], "commitParents": ["20b360a3530d8a377169bf0740785d422d6e5181"], "commitDateTime": "2017-10-04 00:49:24", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-10-04 10:51:08"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tools", "release/4.5.1", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Prometheus metrics provider fails to initialize", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\ntry to enable prometheus metrics provider in a k8s installation\r\n\r\n- What did you expect to see?\r\n\r\nbookies should be running and expose metrics to prometheus.\r\n\r\n- What did you see instead?\r\n\r\nbookies fail to start.\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"d82dc1c3e64e12e27ac8492ecbd4204a5529099c": {"commitUser": "jiazhai", "commitGHEventType": "closed"}, "01897ee3f647bd6b344ce816ab9d9f1eec5a7ff9": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2017-10-04 02:51:17", "url": "https://github.com/apache/bookkeeper/issues/535", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-09-26 09:18:50", "closed": "2018-02-01 20:27:36", "title": "BookKeeper doesn't compile with oracle jdk", "url": "https://github.com/apache/bookkeeper/issues/522", "body": "This is a bug, though whether the bug is in oracle jdk or our code is unknown. \r\n\r\nTo repro, download the oracle jdk, install it (I did so using java-package on debian 9), and run \"mvn package -DskipTests\".\r\n\r\nThis command should complete without error. Instead you get an error compiling bookkeeper-benchmark.\r\n```\r\n[INFO] --- maven-compiler-plugin:3.5.1:compile (default-compile) @ bookkeeper-benchmark ---\r\n[INFO] Changes detected - recompiling the module!\r\n[INFO] Compiling 6 source files to /home/ivan/src/bookkeeper/bookkeeper-benchmark/target/classes\r\n[INFO] -------------------------------------------------------------\r\n[ERROR] COMPILATION ERROR : \r\n[INFO] -------------------------------------------------------------\r\n[ERROR] An unknown compilation problem occurred\r\n```", "commits": {}, "user": "ivankelly", "commitsDetails": [], "labels": ["type/bug"], "ttf": 128.00027777777777}, {"created": "2017-09-18 22:12:10", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "eba4d6e5d7eab8beab699c6dba8ac41e5ceec3db tags/release-4.6.2~142", "commitHash": "eba4d6e5d7eab8beab699c6dba8ac41e5ceec3db", "commitMessage": "ISSUE #515: Run bookies using hostIP instead of containerIP in k8s\n\nDescriptions of the changes in this PR:\n\n- use `status.hostIP` rather than `status.containerIP`. so the identifier (ip) of a bookie pod will not be changed after it is restarted.\n- use `adverstiseAddress` to advertise hostip as the ip of a bookie pod\n- change it to use `hierarchical` ledger manager\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>, Matteo Merli <mmerli@apache.org>\n\nThis closes #516 from sijie/run_bookie_using_hostport_bk, closes #515\n", "commitGitStats": [{"lines": 3, "deletions": 0, "insertions": 3, "filePath": "bookkeeper-server/conf/bk_server.conf"}, {"lines": 21, "deletions": 5, "insertions": 16, "filePath": "deploy/kubernetes/gke/bookkeeper.yaml"}], "commitParents": ["aa03c523126a2ad9aa0cae3665410bbc4dfb5edd"], "commitDateTime": "2017-09-19 07:23:24", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-09-19 07:23:24"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/docker", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Use `status.hostIP` to run bookies in k8s", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nfollow the [tutorial](http://bookkeeper.apache.org/docs/latest/deployment/kubernetes/) to deploy bookkeeper in k8s.\r\n\r\n- What did you expect to see?\r\n\r\nwhen pods restarted (via `kubectl delete` and `kubectl create`), the pods should be able to run again. \r\n\r\n- What did you see instead?\r\n\r\nInvalidCookieException. Because when pods are restarted, the container ip will changed. The bookies do a cookie validation to ensure the ip address doesn't change during the lifecycle of bookies.\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"eba4d6e5d7eab8beab699c6dba8ac41e5ceec3db": {"commitUser": "jiazhai", "commitGHEventType": "closed"}}, "closed": "2017-09-18 23:23:35", "url": "https://github.com/apache/bookkeeper/issues/515", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-08-28 17:59:48", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "CompactionTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.getGCThread()"}, {"INS": 12, "DEL": 1, "TOT": 16, "MOV": 3, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testMinorCompaction()"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testCompactionWithEntryLogRollover()"}, {"INS": 11, "DEL": 1, "TOT": 14, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testMinorCompactionWithNoWritableLedgerDirsButIsForceGCAllowWhenNoSpaceIsSet()"}, {"INS": 10, "DEL": 1, "TOT": 13, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testMinorCompactionWithNoWritableLedgerDirs()"}, {"INS": 8, "DEL": 1, "TOT": 11, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testMajorCompactionAboveThreshold()"}, {"INS": 7, "DEL": 1, "TOT": 14, "MOV": 3, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testDisableCompaction()"}, {"INS": 2, "DEL": 1, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testCompactionSmallEntryLogs()"}, {"INS": 11, "DEL": 1, "TOT": 14, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.CompactionTest.testMajorCompaction()"}]}, {"spoonFilePath": "GarbageCollectorThread.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.GarbageCollectorThread"}]}], "nameRev": "ae58e92bd3f0c17ed242544a097dd19656d39c42 tags/release-4.6.2~153", "commitHash": "ae58e92bd3f0c17ed242544a097dd19656d39c42", "commitMessage": "ISSUE #479: CompactionTest#testCompactionWithEntryLogRollover failed\n\nDescriptions of the changes in this PR:\n\n- restart bookie with disabling gc for #testCompactionWithEntryLogRollover\n- improve other tests to remove `Thread.sleep` and use a more deterministic way for doing gc\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>\n\nThis closes #480 from sijie/fix_compaction_test, closes #479\n", "commitGitStats": [{"lines": 7, "deletions": 4, "insertions": 3, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/GarbageCollectorThread.java"}, {"lines": 99, "deletions": 13, "insertions": 86, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/CompactionTest.java"}], "commitParents": ["c0fdfa5c1a05bd5cadb175928aa02a8e1c3f1e1f"], "commitDateTime": "2017-08-29 16:05:18", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-29 16:05:18"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "CompactionTest#testCompactionWithEntryLogRollover failed", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nRun bookkeeper-master CI job.\r\n\r\n- What did you expect to see?\r\n\r\nAll tests should pass.\r\n\r\n- What did you see instead?\r\n\r\nCompactionTest#testCompactionWithEntryLogRollover failed.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"ae58e92bd3f0c17ed242544a097dd19656d39c42": {"commitUser": "jiazhai", "commitGHEventType": "closed"}}, "closed": "2017-08-29 08:05:26", "url": "https://github.com/apache/bookkeeper/issues/479", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-08-22 13:12:34", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "TestTLS.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 6, "MOV": 2, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.tls.TestTLS.testClientWantsTLSNoServersHaveIt()"}, {"INS": 1, "DEL": 1, "TOT": 6, "MOV": 2, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.tls.TestTLS.testTLSClientButOnlyFewTLSServers()"}]}], "nameRev": "6e6556f29ecbf966404423b7d67897e5dcba712a tags/release-4.6.2~156", "commitHash": "6e6556f29ecbf966404423b7d67897e5dcba712a", "commitMessage": "ISSUE #462: TestTLS failures\n\nDescriptions of the changes in this PR:\n\nProblem:\n\nThe behavior of loading configuration in `AbstractConfiguration` was changed recently.\nSo the TLS provider was not cleared correctly for the failed tests.\n\nSolution:\n\nExplicitly clear TLS provider for each configuratio to address the failed tests.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #478 from sijie/fix_tls_test, closes #462\n", "commitGitStats": [{"lines": 12, "deletions": 4, "insertions": 8, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/tls/TestTLS.java"}], "commitParents": ["5c83b6e2ab7329c428b2c63415f3c695f4edaf12"], "commitDateTime": "2017-08-28 02:00:53", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-28 02:00:53"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "TestTLS failures", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\nhttps://builds.apache.org/job/bookkeeper-precommit-pullrequest/307/#showFailuresLink\r\ncontains test failure related with TestTLS\r\n\r\n- What did you expect to see?\r\nno ut errors.\r\n\r\n- What did you see instead?\r\nhttps://builds.apache.org/job/bookkeeper-precommit-pullrequest/307/#showFailuresLink\r\n\r\n    org.apache.bookkeeper.tls.TestTLS.testTLSClientButOnlyFewTLSServers org.apache.bookkeeper.tls.TestTLS.testBookieAuthPluginDenyAccesstoClientWithoutTLSAuthentication\r\n    org.apache.bookkeeper.tls.TestTLS.testClientWantsTLSNoServersHaveIt\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"6e6556f29ecbf966404423b7d67897e5dcba712a": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-08-28 09:01:01", "url": "https://github.com/apache/bookkeeper/issues/462", "user": "zhaijack", "ttf": 5.000277777777778}, {"created": "2017-08-22 09:15:20", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "AbstractConfiguration.java", "spoonMethods": [{"INS": 2, "DEL": 1, "TOT": 6, "MOV": 2, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.conf.AbstractConfiguration.loadConf(org.apache.commons.configuration.CompositeConfiguration)"}, {"INS": 2, "DEL": 1, "TOT": 6, "MOV": 2, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.conf.AbstractConfiguration.loadConf(java.net.URL)"}]}], "nameRev": "f4a9a53ce725f8c495e100430a05dc13942d0837 tags/release-4.6.2~162", "commitHash": "f4a9a53ce725f8c495e100430a05dc13942d0837", "commitMessage": "ISSUE #459: fix loadConf in AbstractConfiguration\n\nDescriptions of the changes in this PR:\nIn loadConf, call setProperty for all k-v in baseConf.\nPlease reference #459 for more anlysis and details.\n\nAuthor: Jia Zhai <zhaijia@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #460 from zhaijack/issue_459, closes #459\n", "commitGitStats": [{"lines": 20, "deletions": 7, "insertions": 13, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/AbstractConfiguration.java"}], "commitParents": ["e28ea6baecc181f90b5e26f5456ec3b657938b24"], "commitDateTime": "2017-08-23 15:07:26", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-23 15:07:26"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "area/client", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "CompactionTest failures", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\nin code reveiw of #452, we find that there are test failures realted to CompactionTest.\r\n\r\n- What did you expect to see?\r\nno ut errors.\r\n\r\n- What did you see instead?\r\nhttps://builds.apache.org/job/bookkeeper-precommit-pullrequest/307/#showFailuresLink\r\n\r\norg.apache.bookkeeper.bookie.CompactionByBytesTest.testMinorCompactionWithNoWritableLedgerDirsButIsForceGCAllowWhenNoSpaceIsSet\r\norg.apache.bookkeeper.bookie.CompactionByBytesTest.testDisableCompaction\r\norg.apache.bookkeeper.bookie.CompactionByEntriesTest.testMinorCompactionWithNoWritableLedgerDirsButIsForceGCAllowWhenNoSpaceIsSet\r\norg.apache.bookkeeper.bookie.CompactionByEntriesTest.testDisableCompaction\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"f4a9a53ce725f8c495e100430a05dc13942d0837": {"commitUser": "eolivelli", "commitGHEventType": "closed"}}, "closed": "2017-08-23 13:07:41", "url": "https://github.com/apache/bookkeeper/issues/459", "user": "zhaijack", "ttf": 1.0002777777777778}, {"created": "2017-08-20 23:32:25", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "35cffdf6a38b5dba702b11e5902d5aa745429b01 tags/release-4.6.2~164", "commitHash": "35cffdf6a38b5dba702b11e5902d5aa745429b01", "commitMessage": "ISSUE #453: fix image broken in website\n\nDescriptions of the changes in this PR:\nFix image broken in website\n\nAfter fix, image works well.\n<img width=\"1535\" alt=\"default\" src=\"https://user-images.githubusercontent.com/26834121/29500286-ee3e4d88-8651-11e7-80c2-d4febffb0bfe.png\">\n\nAuthor: Jia Zhai <zhaijia@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Sijie Guo <sijie@apache.org>\n\nThis closes #455 from zhaijack/issue_453, closes #453\n", "commitGitStats": [{"lines": 4, "deletions": 2, "insertions": 2, "filePath": "site/docs/latest/api/distributedlog-api.md"}, {"lines": 8, "deletions": 4, "insertions": 4, "filePath": "site/docs/latest/deployment/dcos.md"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "site/docs/4.5.0/api/distributedlog-api.md"}, {"lines": 8, "deletions": 4, "insertions": 4, "filePath": "site/docs/4.5.0/deployment/dcos.md"}], "commitParents": ["b15e167f49d968d0e990a0eb467ca1f186bdc0a7"], "commitDateTime": "2017-08-22 11:34:43", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-22 11:34:43"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/documentation", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Documentation: diagrams on website of dl-api be broken", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\nThis is an issue the @sslavic find on slack channel.\r\ndiagrams on https://bookkeeper.apache.org/docs/latest/api/distributedlog-api/ seem to be broken\r\n\r\n- What did you expect to see?\r\ndiagrams could show well\r\n\r\n- What did you see instead?\r\ndiagrams not show\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"35cffdf6a38b5dba702b11e5902d5aa745429b01": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-08-22 18:34:52", "url": "https://github.com/apache/bookkeeper/issues/453", "user": "zhaijack", "ttf": 1.0002777777777778}, {"created": "2017-08-08 02:52:22", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "AbstractConfiguration.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.conf.AbstractConfiguration.loadConf(org.apache.commons.configuration.CompositeConfiguration)"}, {"INS": 1, "DEL": 0, "TOT": 3, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.conf.AbstractConfiguration.loadConf(java.net.URL)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.conf.AbstractConfiguration.loadConf(org.apache.bookkeeper.conf.AbstractConfiguration)"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.conf.AbstractConfiguration.loadConf(org.apache.commons.configuration.Configuration)"}]}, {"spoonFilePath": "BookieShell.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieShell.setConf(org.apache.commons.configuration.Configuration)"}]}, {"spoonFilePath": "Tool.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.util.setConf(org.apache.commons.configuration.Configuration)"}]}], "nameRev": "b4a1c76054c54d05d38a89399efa716201a2206b tags/release-4.6.2~179", "commitHash": "b4a1c76054c54d05d38a89399efa716201a2206b", "commitMessage": "ISSUE #414: use a clone of baseconf in new ServerConfiguration(baseConf)\n\nDescriptions of the changes in this PR:\nThis PR fix Issue #414 , and in the comments of that issue contains the anysis of the bug.  Main changes:\n- Privde a clone of baseConf while do loadconf(baseConf), so make baseConf and newConf work independently.\n- Remove 'loadConf(Configuration otherConf) ', since Configuration is an interface in common-configs and not have a clone method.\n\n---\nBe sure to do all of the following to help us incorporate your contribution\nquickly and easily:\n\n- [X] Make sure the PR title is formatted like:\n    `<Issue # or BOOKKEEPER-#>: Description of pull request`\n    `e.g. Issue 123: Description ...`\n    `e.g. BOOKKEEPER-1234: Description ...`\n- [ ] Make sure tests pass via `mvn clean apache-rat:check install findbugs:check`.\n- [X] Replace `<Issue # or BOOKKEEPER-#>` in the title with the actual Issue/JIRA number.\n\n---\n\nAuthor: zhaijack <zhaijia03@gmail.com>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #424 from zhaijack/issue_414, closes #414\n", "commitGitStats": [{"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/util/Tool.java"}, {"lines": 3, "deletions": 2, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/BookieShell.java"}, {"lines": 18, "deletions": 14, "insertions": 4, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/AbstractConfiguration.java"}], "commitParents": ["88a61eefcc23a72e9ec18d64168dddd0e2e01269"], "commitDateTime": "2017-08-11 03:23:08", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-11 03:23:08"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "area/tests", "release/4.5.1", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Test failure in UpdateLedgerOpTest", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\nrun unit tests\r\n- What did you expect to see?\r\ntests passed\r\n- What did you see instead?\r\n```\r\nRunning org.apache.bookkeeper.client.UpdateLedgerOpTest\r\nTests run: 4, Failures: 0, Errors: 3, Skipped: 0, Time elapsed: 2.822 sec <<< FAILURE! - in org.apache.bookkeeper.client.UpdateLedgerOpTest\r\ntestLimitLessThanTotalLedgers(org.apache.bookkeeper.client.UpdateLedgerOpTest)  Time elapsed: 0.741 sec  <<< ERROR!\r\njava.net.UnknownHostException: Trying to listen on loopback address, 127.0.0.1:3181 but this is forbidden by default (see ServerConfiguration#getAllowLoopback())\r\n\tat org.apache.bookkeeper.client.UpdateLedgerOpTest.testLimitLessThanTotalLedgers(UpdateLedgerOpTest.java:127)\r\n\r\ntestManyLedgers(org.apache.bookkeeper.client.UpdateLedgerOpTest)  Time elapsed: 0.329 sec  <<< ERROR!\r\njava.net.UnknownHostException: Trying to listen on loopback address, 127.0.0.1:3181 but this is forbidden by default (see ServerConfiguration#getAllowLoopback())\r\n\tat org.apache.bookkeeper.client.UpdateLedgerOpTest.testManyLedgers(UpdateLedgerOpTest.java:87)\r\n\r\ntestChangeEnsembleAfterRenaming(org.apache.bookkeeper.client.UpdateLedgerOpTest)  Time elapsed: 0.167 sec  <<< ERROR!\r\njava.net.UnknownHostException: Trying to listen on loopback address, 127.0.0.1:3181 but this is forbidden by default (see ServerConfiguration#getAllowLoopback())\r\n\tat org.apache.bookkeeper.client.UpdateLedgerOpTest.testChangeEnsembleAfterRenaming(UpdateLedgerOpTest.java:174)\r\n\r\nResults :\r\nTests in error: \r\n  UpdateLedgerOpTest.testChangeEnsembleAfterRenaming:174 \u00bb UnknownHost Trying to...\r\n  UpdateLedgerOpTest.testLimitLessThanTotalLedgers:127 \u00bb UnknownHost Trying to l...\r\n  UpdateLedgerOpTest.testManyLedgers:87 \u00bb UnknownHost Trying to listen on loopba...\r\n\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"b4a1c76054c54d05d38a89399efa716201a2206b": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-08-11 10:23:16", "url": "https://github.com/apache/bookkeeper/issues/414", "user": "zhaijack", "ttf": 3.000277777777778}, {"created": "2017-08-07 22:22:45", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "52e8fca0df1a3876db5be8f7e68d7a864af1f333 remotes/origin/asf-site~424", "commitHash": "52e8fca0df1a3876db5be8f7e68d7a864af1f333", "commitMessage": "Issue 412: css and js files are broken in `archives` links (#413)\n\nThis closes #412 ", "commitGitStats": [{"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/hedwigBuild.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/hedwigBuild.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/bookkeeperStream.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/hedwigBuild.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookkeeperConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/hedwigDesign.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/hedwigMessageFilter.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/metastore.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/hedwigUser.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/metastore.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/bookkeeperOverview.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/hedwigUser.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/hedwigUser.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/releaseNotes.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/bookieRecovery.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/bookkeeperStarted.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/index.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/bookkeeperInternals.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/bookkeeperStream.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/bookkeeperMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/bookkeeperProgrammer.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookkeeperInternals.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/releaseNotes.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/bookkeeperStarted.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/bookkeeperJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/hedwigMessageFilter.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/metastore.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/releaseNotes.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookkeeperConfig.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/hedwigJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/hedwigConsole.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/bookkeeperConfig.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/metastore.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/metastore.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/index.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/index.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/index.html"}, {"lines": 58, "deletions": 29, "insertions": 29, "filePath": "content/archives/docs/master/index.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/bookkeeperProgrammer.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/hedwigJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/bookkeeperStarted.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/bookkeeperProgrammer.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/doc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/bookkeeperMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/releaseNotes.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/hedwigJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/bookkeeperConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/doc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookkeeperJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/bookieConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/hedwigConsole.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/bookkeeperProgrammer.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/hedwigDesign.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/bookkeeperStream.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/bookkeeperConfig.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/hedwigBuild.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/hedwigDesign.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/hedwigMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/hedwigDesign.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/bookkeeperStream.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/hedwigUser.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/releaseNotes.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/bookieConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/bookkeeperMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/hedwigJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/bookkeeperInternals.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/bookkeeperJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/bookkeeperConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookkeeperConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/bookkeeperInternals.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/hedwigMessageFilter.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/bookkeeperJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/hedwigDesign.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/index.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/hedwigMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/hedwigBuild.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/hedwigBuild.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/bylaws.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookkeeperOverview.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/bookieConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/bookieConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/hedwigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/metastore.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/bookkeeperProgrammer.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/lists.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/hedwigConsole.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/hedwigMessageFilter.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/bookieRecovery.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/index.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/hedwigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/bookkeeperOverview.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookkeeperTutorial.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/index.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/bookkeeperOverview.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/bookkeeperConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/doc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/bookkeeperProgrammer.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/bookkeeperConfig.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/releaseNotes.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/bookkeeperOverview.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/bookkeeperStarted.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookkeeperStarted.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/bookkeeperConfig.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/index.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/bookkeeperStream.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/bookieConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/hedwigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/hedwigBuild.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/hedwigBuild.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/bookkeeperConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/bookkeeperJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/bookkeeperProgrammer.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/bookkeeperStarted.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/bookkeeperStream.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/bookkeeperMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/bookkeeperInternals.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookkeeperInternals.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/bookkeeperJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/bookkeeperOverview.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/bookkeeperInternals.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/privacy.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookieRecovery.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/bookkeeperMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/bookieConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/hedwigDocs.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/hedwigBuild.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/hedwigMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/bookkeeperConfig.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/metastore.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/doc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookieConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookkeeperStream.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/bookkeeperStarted.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/bookkeeperConfig.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/hedwigBuild.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookkeeperProtocol.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/hedwigMessageFilter.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/releaseNotes.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/hedwigConsole.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/bookkeeperConfig.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookkeeperProgrammer.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/bookkeeperConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/hedwigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookieRecovery.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/bookkeeperStream.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/hedwigMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/index.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/bookkeeperOverview.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/hedwigMessageFilter.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/bookieConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/bookkeeperStream.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/hedwigConsole.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/releases.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/bookkeeperConfig.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/irc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/hedwigDesign.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/bookkeeperMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/hedwigJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/bookkeeperOverview.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/doc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookkeeperLedgers2Logs.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/releaseNotes.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookkeeperProgrammer.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/doc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookkeeperConfig.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/hedwigUser.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/bookkeeperProgrammer.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/bookkeeperConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/hedwigJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/hedwigUser.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/releaseNotes.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/bookieRecovery.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/hedwigMessageFilter.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/bookkeeperJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/hedwigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/hedwigUser.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/bookkeeperConfig.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/hedwigDesign.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/bookkeeperStarted.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/bookieRecovery.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/hedwigMessageFilter.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/bookkeeperStarted.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/bookieRecovery.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/hedwigConsole.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/releaseNotes.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/bookkeeperConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/bookieRecovery.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/hedwigDesign.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/hedwigMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/hedwigConsole.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/hedwigUser.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/hedwigDesign.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/bookkeeperProgrammer.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/bookkeeperStarted.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/hedwigJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/bookieConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/bookkeeperInternals.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/hedwigJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/metastore.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/hedwigMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/bookkeeperInternals.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/bookkeeperConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/hedwigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/bookkeeperJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/hedwigConsole.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/bookkeeperInternals.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/bookkeeperConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/bookkeeperProgrammer.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/bookieRecovery.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/svn.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/hedwigUser.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/hedwigDesign.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/hedwigJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookkeeperStarted.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/bookkeeperStream.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/hedwigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/index.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookkeeperLedgers2Logs.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/hedwigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/doc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/credits.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/bookkeeperOverview.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/hedwigMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookkeeperStream.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/doc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/hedwigConsole.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/bookkeeperJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/bookkeeperStarted.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/bookkeeperConfig.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/bookieRecovery.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookkeeperMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/hedwigConsole.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/bookkeeperInternals.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/releaseNotes.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/bookkeeperMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/bookieRecovery.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.1.0/bookkeeperInternals.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/index.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/hedwigUser.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/bookieRecovery.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/hedwigMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/hedwigDesign.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/metastore.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/metastore.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookkeeperMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookkeeperOverview.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/bookkeeperOverview.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/bookkeeperStream.html"}, {"lines": 58, "deletions": 29, "insertions": 29, "filePath": "content/archives/docs/r4.4.0/index.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/bookkeeperConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/hedwigMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/bookieConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookkeeperJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/bookieConfigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.4/hedwigMessageFilter.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/master/bookkeeperTutorial.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/hedwigUser.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.4.0/doc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.2/hedwigJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.1/doc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/bookkeeperJMX.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.0.0/doc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.2/bookkeeperOverview.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.3/bookkeeperMetadata.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.0/doc.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.2.1/hedwigParams.html"}, {"lines": 56, "deletions": 28, "insertions": 28, "filePath": "content/archives/docs/r4.3.0/hedwigBuild.html"}], "commitParents": ["c27ab9794cc0d539ed87e391953c4b1a2c3c9f85"], "commitDateTime": "2017-08-07 15:55:26", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-07 15:55:26"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/documentation", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "css and js files are broken in `archives` links", "numCommits": 0, "body": "Is this a question, feature request, or bug repor\r\n\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nINFRA moved bookkeeper site from cms to git\r\n\r\n- What did you expect to see?\r\n\r\narchives should work as expected.\r\n\r\n- What did you see instead?\r\n\r\narchives content is there, but css and js locations are not correct.\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"52e8fca0df1a3876db5be8f7e68d7a864af1f333": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2017-08-10 18:24:23", "url": "https://github.com/apache/bookkeeper/issues/412", "user": "sijie", "ttf": 2.000277777777778}, {"created": "2017-08-07 14:25:03", "closed": "2017-08-08 03:05:56", "title": "Docker image: fix non-privileged user execution", "url": "https://github.com/apache/bookkeeper/issues/405", "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nI run bookkeeper using \"--user $(id -u)\" option in \"docker run\" \r\n\r\n- What did you expect to see?\r\n\r\nBookeeper process owned by the current user in the host system.  \r\n\r\n- What did you see instead?\r\n\r\nProcess is owned by root\r\n", "commits": {}, "user": "caiok", "commitsDetails": [], "labels": ["area/docker", "type/bug"], "ttf": 0.0002777777777777778}, {"created": "2017-08-05 21:52:00", "closed": "2018-03-19 10:09:47", "title": "BookKeeperDiskSpaceWeightedLedgerPlacementTest.testDiskSpaceWeightedBookieSelectionWithBookiesDying failed", "url": "https://github.com/apache/bookkeeper/issues/399", "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nci job ran\r\n\r\n- What did you expect to see?\r\n\r\nci passed\r\n\r\n- What did you see instead?\r\n\r\n```\r\njava.lang.AssertionError: Weigheted placement is not honored1\r\n\tat org.apache.bookkeeper.client.BookKeeperDiskSpaceWeightedLedgerPlacementTest.testDiskSpaceWeightedBookieSelectionWithBookiesDying(BookKeeperDiskSpaceWeightedLedgerPlacementTest.java:330)\r\n```\r\n\r\nhttps://builds.apache.org/job/bookkeeper-release-nightly-snapshot/org.apache.bookkeeper$bookkeeper-server/7/testReport/junit/org.apache.bookkeeper.client/BookKeeperDiskSpaceWeightedLedgerPlacementTest/testDiskSpaceWeightedBookieSelectionWithBookiesDying/", "commits": {}, "user": "sijie", "commitsDetails": [], "labels": ["area/build", "area/tests", "type/bug"], "ttf": 225.00027777777777}, {"created": "2017-08-05 21:07:42", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "cbcc64d6d0fd1a3d6738e4efcb0db3d5005ad0f8 tags/release-4.6.2~196", "commitHash": "cbcc64d6d0fd1a3d6738e4efcb0db3d5005ad0f8", "commitMessage": "ISSUE #397: [CI] publish-website job failed when mvn:release bump version to 4.6.0-SNAPSHOT\n\nDescriptions of the changes in this PR:\n\nUse `mvn install` rather than `mvn compile`\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Matteo Merli <None>\n\nThis closes #398 from sijie/issue_397, closes #397\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/scripts/javadoc-gen.sh"}], "commitParents": ["59562a7bb2b300b0706d17e9fc034d6604b71626"], "commitDateTime": "2017-08-05 15:13:02", "commitUser": "merlimat", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-05 15:13:02"}, {"commitSpoonAstDiffStats": [], "nameRev": "ebd02a5b802921e7904b211fc6244f1ce9bc4a33 tags/release-4.5.1~25", "commitHash": "ebd02a5b802921e7904b211fc6244f1ce9bc4a33", "commitMessage": "ISSUE #397: [CI] publish-website job failed when mvn:release bump version to 4.6.0-SNAPSHOT\n\nDescriptions of the changes in this PR:\n\nUse `mvn install` rather than `mvn compile`\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Matteo Merli <None>\n\nThis closes #398 from sijie/issue_397, closes #397\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "site/scripts/javadoc-gen.sh"}], "commitParents": ["3bbb6aa32ca9634434aa59759a40524aae2bacc9"], "commitDateTime": "2017-08-11 03:08:06", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-05 15:13:02"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "[CI] publish-website job failed when mvn:release bump version to 4.6.0-SNAPSHOT", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nci runs publish-website job when a change is merge to master. the change was from `mvn release` to bump the version from 4.5.0 to 4.6.0\r\n\r\n- What did you expect to see?\r\n\r\npublish-website job should run as expected.\r\n\r\n- What did you see instead?\r\n\r\npublish-website job failed due to\r\n\r\n```\r\n[ERROR] Failed to execute goal on project bookkeeper-benchmark: Could not resolve dependencies for project org.apache.bookkeeper:bookkeeper-benchmark:jar:4.6.0-SNAPSHOT: Could not find artifact org.apache.bookkeeper:bookkeeper-server:jar:tests:4.6.0-SNAPSHOT in Nexus (http://repository.apache.org/snapshots) -> [Help 1]\r\n```\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"cbcc64d6d0fd1a3d6738e4efcb0db3d5005ad0f8": {"commitUser": "merlimat", "commitGHEventType": "closed"}, "ebd02a5b802921e7904b211fc6244f1ce9bc4a33": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2017-08-05 22:13:11", "url": "https://github.com/apache/bookkeeper/issues/397", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-08-05 06:43:39", "closed": "2017-08-07 04:35:22", "title": "GSSAPIBookKeeperTest failed on jenkins", "url": "https://github.com/apache/bookkeeper/issues/395", "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\ntrigger pullrequest-precommit CI job\r\n\r\n- What did you expect to see?\r\n\r\nCI should pass\r\n\r\n- What did you see instead?\r\n\r\n```\r\njava.lang.NoClassDefFoundError: org/apache/directory/api/ldap/model/entry/Entry\r\n\tat org.apache.bookkeeper.sasl.GSSAPIBookKeeperTest.startMiniKdc(GSSAPIBookKeeperTest.java:74)\r\nCaused by: java.lang.ClassNotFoundException: org.apache.directory.api.ldap.model.entry.Entry\r\n\tat org.apache.bookkeeper.sasl.GSSAPIBookKeeperTest.startMiniKdc(GSSAPIBookKeeperTest.java:74)\r\n```", "commits": {}, "user": "sijie", "commitsDetails": [], "labels": ["area/build", "area/release", "status/wontfix", "type/bug"], "ttf": 1.0002777777777778}, {"created": "2017-08-05 06:29:16", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "8986f32db757799ea678fa8c31823566572f3082 tags/release-4.6.2~200", "commitHash": "8986f32db757799ea678fa8c31823566572f3082", "commitMessage": "ISSUE #393: [CI] publish-website job will be marked as failure if it is an empty commit\n\nDescriptions of the changes in this PR:\n\n- use `git diff-index` to checkout if there is any changes to commit or not\n- port some changes from CI back to script.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Matteo Merli <mmerli@apache.org>\n\nThis closes #394 from sijie/issue_393, closes #393\n", "commitGitStats": [{"lines": 7, "deletions": 4, "insertions": 3, "filePath": "site/scripts/publish-website.sh"}], "commitParents": ["31960b027f391ee8ca7400cb3e647c20864966a3"], "commitDateTime": "2017-08-04 23:37:43", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-04 23:37:43"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "[CI] publish-website job will be marked as failure if it is an empty commit", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nrun publish-website ci job on post commit\r\n\r\n- What did you expect to see?\r\n\r\nthe job should be marked as successful\r\n\r\n- What did you see instead?\r\n\r\nthe job is marked as failure if it is an empty commit\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"8986f32db757799ea678fa8c31823566572f3082": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-08-05 06:37:50", "url": "https://github.com/apache/bookkeeper/issues/393", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-08-04 06:00:45", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "1c8101ed688d97fa93a8143c697f6c7489d5c6f9 tags/release-4.6.2~203", "commitHash": "1c8101ed688d97fa93a8143c697f6c7489d5c6f9", "commitMessage": "ISSUE #383: mvn release:branch fails\n\nDescriptions of the changes in this PR:\n\n- change `compilerArguments` to `compilerArgs`\n- use `compilerArg` for configuring the arguments for compilation.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #384 from sijie/sijie/fix_release, closes #383\n", "commitGitStats": [{"lines": 10, "deletions": 5, "insertions": 5, "filePath": "pom.xml"}], "commitParents": ["18f5c6a0a3de8727bcc12a8f6b1747c9a6a3c305"], "commitDateTime": "2017-08-04 13:53:41", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-04 13:53:41"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "area/release", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "mvn release:branch fails", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\n@jvrao and me were working together to cut a release branch.\r\n\r\n- What did you expect to see?\r\n\r\nmvn release:branch should be able to create a branch.\r\n\r\n- What did you see instead?\r\n\r\n`mvn release:branch` failed due to compilerArgs specified in compiler plugin are not recognized. \r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"1c8101ed688d97fa93a8143c697f6c7489d5c6f9": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-08-04 20:53:49", "url": "https://github.com/apache/bookkeeper/issues/383", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-08-03 20:26:49", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "PrometheusOpStatsLogger.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusOpStatsLogger"}]}, {"spoonFilePath": "PrometheusUtil.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusUtil"}]}, {"spoonFilePath": "PrometheusStatsLogger.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusStatsLogger.registerGauge(java.lang.String,org.apache.bookkeeper.stats.Gauge)"}]}, {"spoonFilePath": "PrometheusCounter.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.stats.PrometheusCounter"}]}], "nameRev": "398d33218eb2d9a4932fa69b9b3a29f02b2dce02 tags/release-4.6.2~209", "commitHash": "398d33218eb2d9a4932fa69b9b3a29f02b2dce02", "commitMessage": "Issue #377: Make Prometheus stats logger registration idempotent\n\nMake sure the metric are only registered once on Prometheus client lib.\n\nDiscusses in #377.\n\nAuthor: Matteo Merli <mmerli@apache.org>\n\nReviewers: Enrico Olivelli <None>, Sijie Guo <None>\n\nThis closes #378 from merlimat/fix-metrics-double-registration, closes #377\n", "commitGitStats": [{"lines": 3, "deletions": 1, "insertions": 2, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/PrometheusCounter.java"}, {"lines": 23, "deletions": 11, "insertions": 12, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/PrometheusOpStatsLogger.java"}, {"lines": 6, "deletions": 3, "insertions": 3, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/PrometheusStatsLogger.java"}, {"lines": 67, "deletions": 0, "insertions": 67, "filePath": "bookkeeper-stats-providers/prometheus-metrics-provider/src/main/java/org/apache/bookkeeper/stats/PrometheusUtil.java"}], "commitParents": ["6c340e06bbc13bd5ce7526f3531a9bab23108776"], "commitDateTime": "2017-08-03 14:00:09", "commitUser": "merlimat", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-03 14:00:09"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Exception in double registering of Prometheus metric collectors", "numCommits": 0, "body": "When the `PrometheusMetricsProvider` is enabled in the bookie, there can be cases in which the metrics are registered multiple times, leading to `IllegalArgumentException` errors that can cause the bookie process to restart. \r\n\r\nWe should make the metric to be idempotent for the Prometheus provider, such that trying to get a bookie `StatsOpLogger` multiple times will always return the same instance instead of throwing exception. ", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"398d33218eb2d9a4932fa69b9b3a29f02b2dce02": {"commitUser": "merlimat", "commitGHEventType": "closed"}}, "closed": "2017-08-03 21:00:18", "url": "https://github.com/apache/bookkeeper/issues/377", "user": "merlimat", "ttf": 0.0002777777777777778}, {"created": "2017-08-02 06:04:09", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "610b603a34c0d7fbea151f7d1fd4951a6db1ac9b tags/release-4.6.2~214", "commitHash": "610b603a34c0d7fbea151f7d1fd4951a6db1ac9b", "commitMessage": "ISSUE #351: Apache rat check failed on master\n\nDescriptions of the changes in this PR:\n\nExcludes cacerts from apache-rat check\n\nAuthor: Jia Zhai <zhaijia03@gmail.com>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #352 from zhaijack/fix_rat_issue, closes #351\n", "commitGitStats": [{"lines": 1, "deletions": 0, "insertions": 1, "filePath": "pom.xml"}], "commitParents": ["41f63c86a3d228887f08946dde14d485a40ac7b9"], "commitDateTime": "2017-08-01 23:18:08", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-01 23:18:08"}, {"commitSpoonAstDiffStats": [], "nameRev": "3b7c06481262d5ac84c1a79fa2479570975100a6 tags/release-4.6.2~213", "commitHash": "3b7c06481262d5ac84c1a79fa2479570975100a6", "commitMessage": "ISSUE #351: Apache rat check failed on master\n\nDescriptions of the changes in this PR:\n\nThis fix on #352 was adding the exclusion rule in wrong location. this fix is to address that.\n\nAuthor: Jia Zhai <zhaijia03@gmail.com>\n\nReviewers: Sijie Guo <sijie@apache.org>\n\nThis closes #353 from zhaijack/fix_rat_issue, closes #351\n", "commitGitStats": [{"lines": 1, "deletions": 1, "insertions": 0, "filePath": "pom.xml"}, {"lines": 1, "deletions": 0, "insertions": 1, "filePath": "bookkeeper-server/pom.xml"}], "commitParents": ["610b603a34c0d7fbea151f7d1fd4951a6db1ac9b"], "commitDateTime": "2017-08-02 13:51:44", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-02 13:51:44"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/build", "priority/blocker", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Apache rat check failed on master", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nrun `apache-rat:check`\r\n\r\n- What did you expect to see?\r\n\r\nthe task should pass\r\n\r\n- What did you see instead?\r\n\r\nThe task passed locally on mac, but failed on jenkins: https://builds.apache.org/job/bookkeeper-master/ws/bookkeeper-server/target/rat.txt\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"610b603a34c0d7fbea151f7d1fd4951a6db1ac9b": {"commitUser": "sijie", "commitGHEventType": "closed"}, "3b7c06481262d5ac84c1a79fa2479570975100a6": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-08-02 20:51:53", "url": "https://github.com/apache/bookkeeper/issues/351", "user": "zhaijack", "ttf": 0.0002777777777777778}, {"created": "2017-08-01 17:04:13", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "ListenerBasedPendingReadOp.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.ListenerBasedPendingReadOp"}]}, {"spoonFilePath": "PendingReadOp.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.readEntryComplete(int,long,long,io.netty.buffer.ByteBuf,java.lang.Object)"}, {"INS": 4, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp"}]}, {"spoonFilePath": "LedgerRecoveryOp.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerRecoveryOp.addComplete(int,org.apache.bookkeeper.client.LedgerHandle,long,java.lang.Object)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerRecoveryOp.closeAndCallback().2.closeComplete(int,org.apache.bookkeeper.client.LedgerHandle,java.lang.Object)"}, {"INS": 0, "DEL": 0, "TOT": 7, "MOV": 0, "UPD": 7, "spoonMethodName": "org.apache.bookkeeper.client.LedgerRecoveryOp.onEntryComplete(int,org.apache.bookkeeper.client.LedgerHandle,org.apache.bookkeeper.client.LedgerEntry,java.lang.Object)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerRecoveryOp.submitCallback(int)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerRecoveryOp.RecoveryReadOp"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.LedgerRecoveryOp.initiate().1.readLastConfirmedDataComplete(int,org.apache.bookkeeper.client.DigestManager.RecoveryData)"}]}], "nameRev": "5c83b6e2ab7329c428b2c63415f3c695f4edaf12 tags/release-4.6.2~157", "commitHash": "5c83b6e2ab7329c428b2c63415f3c695f4edaf12", "commitMessage": "ISSUE #343: TestFencing.testManyOpenParallel\n\nDescriptions of the changes in this PR:\n\nProblem:\n\nThe `LastAddConfirmed` was advanced due to piggyback on recovery adds. It will cause recovery adds become stall because\nof the entry id check.\n\nThis problem only occurs when there are multiple clients concurrently recover same ledger.\n\nSolution:\n\nDisable lac piggyback on recovery adds.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #477 from sijie/tests, closes #343\n", "commitGitStats": [{"lines": 28, "deletions": 4, "insertions": 24, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ListenerBasedPendingReadOp.java"}, {"lines": 32, "deletions": 3, "insertions": 29, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java"}, {"lines": 3, "deletions": 1, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java"}], "commitParents": ["814edb69dda698e6f719bf4b0c970c206064f606"], "commitDateTime": "2017-08-28 01:54:27", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-28 01:54:27"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "ListenerBasedPendingReadOp.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.ListenerBasedPendingReadOp"}]}, {"spoonFilePath": "PendingReadOp.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 3, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.readEntryComplete(int,long,long,io.netty.buffer.ByteBuf,java.lang.Object)"}, {"INS": 4, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp"}]}, {"spoonFilePath": "LedgerRecoveryOp.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerRecoveryOp.addComplete(int,org.apache.bookkeeper.client.LedgerHandle,long,java.lang.Object)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerRecoveryOp.closeAndCallback().2.closeComplete(int,org.apache.bookkeeper.client.LedgerHandle,java.lang.Object)"}, {"INS": 0, "DEL": 0, "TOT": 7, "MOV": 0, "UPD": 7, "spoonMethodName": "org.apache.bookkeeper.client.LedgerRecoveryOp.onEntryComplete(int,org.apache.bookkeeper.client.LedgerHandle,org.apache.bookkeeper.client.LedgerEntry,java.lang.Object)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.LedgerRecoveryOp.submitCallback(int)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerRecoveryOp.RecoveryReadOp"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.LedgerRecoveryOp.initiate().1.readLastConfirmedDataComplete(int,org.apache.bookkeeper.client.DigestManager.RecoveryData)"}]}], "nameRev": "03e6a0b7c5491aa5477c872cb9d6e4edc1962a43 tags/release-4.5.1~12", "commitHash": "03e6a0b7c5491aa5477c872cb9d6e4edc1962a43", "commitMessage": "ISSUE #343: TestFencing.testManyOpenParallel\n\nDescriptions of the changes in this PR:\n\nProblem:\n\nThe `LastAddConfirmed` was advanced due to piggyback on recovery adds. It will cause recovery adds become stall because\nof the entry id check.\n\nThis problem only occurs when there are multiple clients concurrently recover same ledger.\n\nSolution:\n\nDisable lac piggyback on recovery adds.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <None>, Enrico Olivelli <eolivelli@gmail.com>\n\nThis closes #477 from sijie/tests, closes #343\n\n(cherry picked from commit 5c83b6e2ab7329c428b2c63415f3c695f4edaf12)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 28, "deletions": 4, "insertions": 24, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ListenerBasedPendingReadOp.java"}, {"lines": 32, "deletions": 3, "insertions": 29, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java"}, {"lines": 3, "deletions": 1, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java"}], "commitParents": ["4f50617e5b1141382731bc759cc16ff5fa26bbcc"], "commitDateTime": "2017-08-28 01:54:43", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-28 01:54:27"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "area/tests", "release/4.5.1", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "TestFencing.testManyOpenParallel", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nRun TestFencing\r\n\r\n- What did you expect to see?\r\n\r\nTestFencing should pass\r\n\r\n- What did you see instead?\r\n\r\nTestFencing fails on \r\n\r\ntestManyOpenParallel(org.apache.bookkeeper.client.TestFencing)  Time elapsed: 60.267 sec  <<< ERROR!\r\norg.junit.runners.model.TestTimedOutException: test timed out after 60000 milliseconds\r\n\tat org.apache.bookkeeper.client.TestFencing.testManyOpenParallel(TestFencing.java:196)\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"5c83b6e2ab7329c428b2c63415f3c695f4edaf12": {"commitUser": "sijie", "commitGHEventType": "closed"}, "03e6a0b7c5491aa5477c872cb9d6e4edc1962a43": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2017-08-28 08:54:34", "url": "https://github.com/apache/bookkeeper/issues/343", "user": "zhaijack", "ttf": 26.00027777777778}, {"created": "2017-07-26 08:50:00", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "TestRegionAwareEnsemblePlacementPolicy.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testNodeDown()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testNodeReadOnly()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testNodeNotInSameRegions()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testEnsembleDurabilityDisabledInternal(int,boolean)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testNewEnsembleWithThreeRegions()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testNewEnsembleWithThreeRegionsWithDisable()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testNodeInSameRegion()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.setUp()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testNotReorderReadIfInDefaultRack()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testEnsembleWithThreeRegionsReplaceInternal(int,boolean,boolean)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.prepareNetworkTopologyForReorderTests(java.lang.String)"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testTwoNodesDown()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testNodeWithFailures()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testNewEnsembleWithSingleRegion()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testNewEnsembleWithFiveRegions()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testNewEnsembleFailWithFiveRegions()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRegionAwareEnsemblePlacementPolicy.testNewEnsembleWithMultipleRegions()"}]}, {"spoonFilePath": "LocalBookieEnsemblePlacementPolicy.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.LocalBookieEnsemblePlacementPolicy.initialize(org.apache.bookkeeper.conf.ClientConfiguration,com.google.common.base.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger)"}]}, {"spoonFilePath": "RackawareEnsemblePlacementPolicyImpl.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl.initialize(org.apache.bookkeeper.conf.ClientConfiguration,com.google.common.base.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger)"}]}, {"spoonFilePath": "BookKeeper.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.BookKeeper.initializeEnsemblePlacementPolicy(org.apache.bookkeeper.conf.ClientConfiguration,org.apache.bookkeeper.net.DNSToSwitchMapping,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger)"}]}, {"spoonFilePath": "TestRackawareEnsemblePlacementPolicy.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicy.testPlacementOnStabilizeNetworkTopology()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicy.testWeightedPlacementAndReplaceBookieWithoutEnoughBookiesInSameRack()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicy.testNodeWithFailures()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicy.testWeightedPlacementAndNewEnsembleWithEnoughBookiesInSameRack()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicy.setUp()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicy.testWeightedPlacementAndNewEnsembleWithoutEnoughBookies()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicy.testNodeReadOnly()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicy.testNodeDownAndReadOnly()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicy.testTwoNodesDown()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicy.testNodeDown()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicy.testWeightedPlacementAndReplaceBookieWithEnoughBookiesInSameRack()"}]}, {"spoonFilePath": "DefaultEnsemblePlacementPolicy.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.DefaultEnsemblePlacementPolicy.initialize(org.apache.bookkeeper.conf.ClientConfiguration,com.google.common.base.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger)"}]}, {"spoonFilePath": "TestRackawareEnsemblePlacementPolicyUsingScript.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.TestRackawareEnsemblePlacementPolicyUsingScript.setUp()"}]}, {"spoonFilePath": "EnsemblePlacementPolicy.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.initialize(org.apache.bookkeeper.conf.ClientConfiguration,com.google.common.base.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger)"}]}, {"spoonFilePath": "RegionAwareEnsemblePlacementPolicy.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.RegionAwareEnsemblePlacementPolicy.initialize(org.apache.bookkeeper.conf.ClientConfiguration,com.google.common.base.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger)"}]}], "nameRev": "b63eb86da3757a3740f922093128868d5a53394c tags/release-4.6.2~228", "commitHash": "b63eb86da3757a3740f922093128868d5a53394c", "commitMessage": "ISSUE #300: EnsemblePlacementPolicy must not use com.google.common.base.Optional but java.util.Optional\n\nUse standard java8 java.util.Optional instead of Optional from Guava.\nIn BookKeeper 4.5 we are shading Guava so this class is not available to downstream projects\n\nAuthor: Enrico Olivelli <eolivelli@apache.org>\n\nReviewers: Jia Zhai <None>, Matteo Merli <None>, Sijie Guo <None>\n\nThis closes #302 from eolivelli/issue-300-no-guava, closes #300\n", "commitGitStats": [{"lines": 36, "deletions": 18, "insertions": 18, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestRegionAwareEnsemblePlacementPolicy.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java"}, {"lines": 5, "deletions": 4, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DefaultEnsemblePlacementPolicy.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RackawareEnsemblePlacementPolicyImpl.java"}, {"lines": 3, "deletions": 2, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LocalBookieEnsemblePlacementPolicy.java"}, {"lines": 24, "deletions": 12, "insertions": 12, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestRackawareEnsemblePlacementPolicy.java"}, {"lines": 4, "deletions": 2, "insertions": 2, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestRackawareEnsemblePlacementPolicyUsingScript.java"}, {"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/EnsemblePlacementPolicy.java"}, {"lines": 5, "deletions": 4, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RegionAwareEnsemblePlacementPolicy.java"}], "commitParents": ["0ccbc0e9c3e6a82d5e44b8347cc6567e043f253f"], "commitDateTime": "2017-07-28 17:31:43", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-07-28 17:31:43"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "priority/blocker", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "EnsemblePlacementPolicy must not use com.google.common.base.Optional but java.util.Optional", "numCommits": 0, "body": "In EnsemblePlacementPolicy during the development of 4.5 we used Guava com.google.common.base.Optional.\r\nWe are shading Guava from 4.5 so this class cannot be exposed in \"public\" APIs", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"b63eb86da3757a3740f922093128868d5a53394c": {"commitUser": "jiazhai", "commitGHEventType": "closed"}}, "closed": "2017-07-28 09:31:59", "url": "https://github.com/apache/bookkeeper/issues/300", "user": "eolivelli", "ttf": 2.000277777777778}, {"created": "2017-07-26 07:28:53", "closed": "2017-07-27 07:27:09", "title": "EnsemblePlacementPolicy in 4.5 is not compatible with 4.4 clients", "url": "https://github.com/apache/bookkeeper/issues/299", "body": "Is is not possible to use custom EnsemblePlacementPolicy compiled for BookKeeper 4.4 having 4.5 BookKeeper on the classpath.\r\nIt would be better to use method overloading and java8 default interface methods to make the transition to 4.5 simpler", "commits": {}, "user": "eolivelli", "commitsDetails": [], "labels": ["area/client", "priority/blocker", "type/bug"], "ttf": 0.0002777777777777778}, {"created": "2017-07-21 22:32:35", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BenchThroughputLatency.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.benchmark.BenchThroughputLatency.warmUp(byte[],int,int,int,byte[],org.apache.bookkeeper.conf.ClientConfiguration)"}]}], "nameRev": "61bcba2194aa28ebd51c83e0448965c18211319a tags/release-4.5.1~9", "commitHash": "61bcba2194aa28ebd51c83e0448965c18211319a", "commitMessage": "ISSUE #274: Ensuring the right number of bookies are passed.\n\nDescriptions of the changes in this PR:\nThis fixes #274. Ensures that benchmark measure right number of bookies for the warmup.\n\nAuthor: arvindkandhare <arvind.kandhare@emc.com>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>, Sijie Guo <sijie@apache.org>\n\nThis closes #482 from arvindkandhare/issue-274-benchmarkfix, closes #274\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-benchmark/src/main/java/org/apache/bookkeeper/benchmark/BenchThroughputLatency.java"}], "commitParents": ["9d139ae40e95f7eb79e389edf2a0fa2d89d1e9c3"], "commitDateTime": "2017-10-04 00:37:40", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-30 09:30:31"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "BenchThroughputLatency.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.benchmark.BenchThroughputLatency.warmUp(byte[],int,int,int,byte[],org.apache.bookkeeper.conf.ClientConfiguration)"}]}], "nameRev": "29e74229eda138c13c88ec890ce3d2c215972303 tags/release-4.6.2~151", "commitHash": "29e74229eda138c13c88ec890ce3d2c215972303", "commitMessage": "ISSUE #274: Ensuring the right number of bookies are passed.\n\nDescriptions of the changes in this PR:\nThis fixes #274. Ensures that benchmark measure right number of bookies for the warmup.\n\nAuthor: arvindkandhare <arvind.kandhare@emc.com>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>, Sijie Guo <sijie@apache.org>\n\nThis closes #482 from arvindkandhare/issue-274-benchmarkfix, closes #274\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-benchmark/src/main/java/org/apache/bookkeeper/benchmark/BenchThroughputLatency.java"}], "commitParents": ["dd9680373188948f0e7b8f3b994309626a472856"], "commitDateTime": "2017-08-30 09:30:31", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-30 09:30:31"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "release/4.5.1", "release/4.6.0", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Write benchmark fails with `BkNotEnoughBookiesException` even when enough bookies are available", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\nCompile and ran the benchmark against a bookkeeper deployment.\r\n`./bin/benchmark writes`\r\n- What did you expect to see?\r\nThe benchmark succeeds.\r\n- What did you see instead?\r\nThe following exception:\r\n```\r\n2017-07-21 22:23:44,942 - ERROR - [main:LedgerCreateOp@114] - Not enough bookies to create ledger\r\norg.apache.bookkeeper.client.BKException$BKNotEnoughBookiesException\r\n\tat org.apache.bookkeeper.client.SynchCallbackUtils.finish(SynchCallbackUtils.java:63)\r\n\tat org.apache.bookkeeper.client.BookKeeper$SyncCreateCallback.createComplete(BookKeeper.java:1252)\r\n\tat org.apache.bookkeeper.client.LedgerCreateOp.createComplete(LedgerCreateOp.java:200)\r\n\tat org.apache.bookkeeper.client.LedgerCreateOp.initiate(LedgerCreateOp.java:115)\r\n\tat org.apache.bookkeeper.client.BookKeeper.asyncCreateLedger(BookKeeper.java:626)\r\n\tat org.apache.bookkeeper.client.BookKeeper.createLedger(BookKeeper.java:711)\r\n\tat org.apache.bookkeeper.client.BookKeeper.createLedger(BookKeeper.java:685)\r\n\tat org.apache.bookkeeper.benchmark.BenchThroughputLatency.<init>(BenchThroughputLatency.java:97)\r\n\tat org.apache.bookkeeper.benchmark.BenchThroughputLatency.warmUp(BenchThroughputLatency.java:452)\r\n\tat org.apache.bookkeeper.benchmark.BenchThroughputLatency.main(BenchThroughputLatency.java:319)\r\n```\r\n\r\nThis is because at line 445 of `BenchThroughputLatency.java` the node `readonly` is counted in available bookies too. Changing the line to \r\n`bookies = zk.getChildren(bookieRegistrationPath, false).size() -1;`\r\nresolves the issue.\r\n---------------------------------------------------------------------------------\r\n\r\nPlease label the issue with proper labels. It would help us triage the issues.\r\n\r\n- \"release/\": please mark the issue with the release. \r\n- \"type/\": please mark the issue with corresponding issue type.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"61bcba2194aa28ebd51c83e0448965c18211319a": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "29e74229eda138c13c88ec890ce3d2c215972303": {"commitUser": "eolivelli", "commitGHEventType": "closed"}}, "closed": "2017-08-30 07:30:42", "url": "https://github.com/apache/bookkeeper/issues/274", "user": "arvindkandhare", "ttf": 39.000277777777775}, {"created": "2017-07-21 07:57:17", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BookKeeperTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.BookKeeperTest.testReadEntryReleaseByteBufs()"}]}, {"spoonFilePath": "ClientConfiguration.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.conf.ClientConfiguration.isNettyUsePooledBuffers()"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.conf.ClientConfiguration"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.conf.ClientConfiguration.setNettyUsePooledBuffers(boolean)"}]}, {"spoonFilePath": "LedgerEntry.java", "spoonMethods": [{"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerEntry.getEntry()"}, {"INS": 4, "DEL": 0, "TOT": 5, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.LedgerEntry.getEntryInputStream()"}]}, {"spoonFilePath": "PerChannelBookieClient.java", "spoonMethods": [{"INS": 3, "DEL": 1, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.PerChannelBookieClient.connect()"}]}], "nameRev": "c00cb9f69104c99d7ad10242c04175a5d9ef3801 tags/release-4.6.2~233", "commitHash": "c00cb9f69104c99d7ad10242c04175a5d9ef3801", "commitMessage": "ISSUE #271: LedgerHandle#readEntries leaks ByteBufs\n\nAdd a setNettyUsePooledBuffers() client configuration option to let the user decide to use Pooled vs Unpooled ByteBufs.\nUsing v2 wire protocol Application receives the original ByteBuf return from Channel and it is responsible for 'releasing' it.\n\nAdd assertions on LedgerEntry to prevent the user from accessing data more then once\n\nAuthor: Enrico Olivelli <eolivelli@apache.org>\n\nReviewers: Matteo Merli, Sijie Guo\n\nThis closes #276 from eolivelli/issue-271-leaks, closes #271\n", "commitGitStats": [{"lines": 11, "deletions": 1, "insertions": 10, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java"}, {"lines": 30, "deletions": 0, "insertions": 30, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ClientConfiguration.java"}, {"lines": 137, "deletions": 0, "insertions": 137, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookKeeperTest.java"}, {"lines": 31, "deletions": 3, "insertions": 28, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerEntry.java"}], "commitParents": ["671ec2b21d6e603f00abc8f92a04bbec7d5750b2"], "commitDateTime": "2017-07-27 05:04:03", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-07-27 05:04:03"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "priority/blocker", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "LedgerHandle#readEntries leaks ByteBufs if getEntry not called or getEntryInputStream() not called and closed", "numCommits": 0, "body": "After the switch to Netty 4 I noticed this \"API change\", that is very important to be documented and/or address immediately.\r\n\r\nInside LedgerEntry object we retain a ByteBuf, which is turn is automatically 'released' only in this cases:\r\n- getEntry() is called\r\n- getEntryInputStream() is called and the InputStream is closed\r\n- the ByteBuf is manually closed by the client\r\n\r\nThe real tricky thing is that if the client calls readEntry and the Enumeration is not fully processed we are going to leak ByteBufs and so head/direct memory.\r\n\r\nProposals:\r\nintroduce some \"entry reference counting\" and ensure that all generated entries by a LedgerHandler are \"disposed\" on LedgerHandler.close() and  make sure that when BookKeeper client is closed all of the LedgerHandlers process their own disposal procedure\r\n\r\n\r\n\r\n\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"c00cb9f69104c99d7ad10242c04175a5d9ef3801": {"commitUser": "eolivelli", "commitGHEventType": "closed"}}, "closed": "2017-07-27 03:04:10", "url": "https://github.com/apache/bookkeeper/issues/271", "user": "eolivelli", "ttf": 5.000277777777778}, {"created": "2017-07-18 17:56:55", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BookieInitializationTest.java", "spoonMethods": [{"INS": 4, "DEL": 2, "TOT": 7, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest.testRegNodeExistsAfterSessionTimeOut()"}, {"INS": 1, "DEL": 1, "TOT": 4, "MOV": 1, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest.createNewZKClient()"}, {"INS": 5, "DEL": 4, "TOT": 16, "MOV": 7, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest.testBookieRegistration()"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest.testBookieRegistration().2.run()"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.BookieInitializationTest.tearDown()"}]}], "nameRev": "11fdac3cfdfe0900db994b45aa17500974ba3907 tags/release-4.6.2~244", "commitHash": "11fdac3cfdfe0900db994b45aa17500974ba3907", "commitMessage": "ISSUE #258: BookieInitializationTest.testRegNodeExistsAfterSessionTimeOut failed\n\nDescriptions of the changes in this PR:\n\nConstruct new zookeeper client to ensure the tests get new zookeeper session.\n\n(this change is based on 77c7721 )\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <eolivelli@apache.org>\n\nThis closes #259 from sijie/issue_258, closes #258\n", "commitGitStats": [{"lines": 66, "deletions": 37, "insertions": 29, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/bookie/BookieInitializationTest.java"}], "commitParents": ["7e9350cff67f0cb72ab757d500d98044cbdd4264"], "commitDateTime": "2017-07-19 09:31:04", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-07-19 09:31:04"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "priority/blocker", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "BookieInitializationTest.testRegNodeExistsAfterSessionTimeOut failed", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nRun BookieInitializationTest\r\n\r\n- What did you expect to see?\r\n\r\nThe test should pass.\r\n\r\n- What did you see instead?\r\n\r\njava.lang.AssertionError: Should throw NodeExistsException as the znode is not getting expired\r\n\tat org.apache.bookkeeper.bookie.BookieInitializationTest.testRegNodeExistsAfterSessionTimeOut(BookieInitializationTest.java:237)\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"11fdac3cfdfe0900db994b45aa17500974ba3907": {"commitUser": "eolivelli", "commitGHEventType": "closed"}}, "closed": "2017-07-19 07:31:10", "url": "https://github.com/apache/bookkeeper/issues/258", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-07-18 17:35:26", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "IndexPersistenceMgr.java", "spoonMethods": [{"INS": 0, "DEL": 3, "TOT": 4, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexPersistenceMgr.getNewLedgerIndexFile(java.lang.Long,java.io.File,boolean)"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexPersistenceMgr.getNewLedgerIndexFile(java.lang.Long,java.io.File)"}, {"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexPersistenceMgr.getFileInfo(java.lang.Long,byte[])"}]}], "nameRev": "7e9350cff67f0cb72ab757d500d98044cbdd4264 tags/release-4.6.2~245", "commitHash": "7e9350cff67f0cb72ab757d500d98044cbdd4264", "commitMessage": "ISSUE #256: BookieInitializationTest.testWithDiskFullAndAbilityToCreateNewIndexFile failed\n\nDescriptions of the changes in this PR:\n\nin c49621b, we allow creating FileInfo even when disk is full to allow fence requests succeed at this case.\n\nit is conflicted with Charan's change. Since there is already a setting to configure the min usable size to allow index file creation. if we configure that to be zero, it is same as allowing index file creation even disks are full. so removing the fallback logic introduced in c49621b.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Charan Reddy Guttapalem, Enrico Olivelli\n\nThis closes #257 from sijie/issue_256, closes #256\n", "commitGitStats": [{"lines": 35, "deletions": 33, "insertions": 2, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/IndexPersistenceMgr.java"}], "commitParents": ["7277657740c276b6f036322177c147264ba5100b"], "commitDateTime": "2017-07-19 08:43:14", "commitUser": "eolivelli", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-07-19 08:43:14"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "priority/blocker", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "BookieInitializationTest.testWithDiskFullAndAbilityToCreateNewIndexFile failed", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nrun BookieInitializationTest.testWithDiskFullAndAbilityToCreateNewIndexFile\r\n\r\n- What did you expect to see?\r\n\r\nthe test 'testWithDiskFullAndAbilityToCreateNewIndexFile' should pass\r\n\r\n- What did you see instead?\r\n\r\nthe test failed\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"7e9350cff67f0cb72ab757d500d98044cbdd4264": {"commitUser": "eolivelli", "commitGHEventType": "closed"}}, "closed": "2017-07-19 06:43:31", "url": "https://github.com/apache/bookkeeper/issues/256", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-07-18 00:12:50", "spoonStatsSummary": {}, "commitsDetails": [{"commitSpoonAstDiffStats": [], "nameRev": "d61cfaba69cb0f87bc388889a58f2095f4034f30 tags/release-4.6.2~248", "commitHash": "d61cfaba69cb0f87bc388889a58f2095f4034f30", "commitMessage": "ISSUE #252: Enable four-letter-words zookeeper commands in localbookie\n\nDescriptions of the changes in this PR:\n\nEnable four-letter-words zookeeper commands in localbookie\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <None>, Jia Zhai <None>, Matteo Merli <None>\n\nThis closes #253 from sijie/fix_4letters_issue, closes #252\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/bin/bookkeeper"}], "commitParents": ["086537beda9427c057a286ad6c4614659da6ed7f"], "commitDateTime": "2017-07-18 16:34:47", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-07-18 16:34:47"}], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Enable four-letter-words zookeeper commands in localbookie", "numCommits": 0, "body": "**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nRun localbookie\r\n\r\n- What did you expect to see?\r\n\r\nThe localbookie should start immediately\r\n\r\n- What did you see instead?\r\n\r\nIt took very long time to start local bookie. Because #237 upgraded zookeeper to 3.5.3-beta, most of the four-letter-words command are disabled since this version. LocalBookKeeper relies on 'stat' command to check whether the zookeeper is up and running.", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"d61cfaba69cb0f87bc388889a58f2095f4034f30": {"commitUser": "jiazhai", "commitGHEventType": "closed"}}, "closed": "2017-07-18 08:35:09", "url": "https://github.com/apache/bookkeeper/issues/252", "user": "sijie", "ttf": 0.0002777777777777778}, {"created": "2017-07-07 12:02:22", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "ServerConfiguration.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.conf.ServerConfiguration.setJournalMaxGroupWaitMSec(long)"}]}], "nameRev": "3b33d636a058f211e1cc24b748dc9888256899c6 tags/release-4.6.2~258", "commitHash": "3b33d636a058f211e1cc24b748dc9888256899c6", "commitMessage": "ISSUE #235: Setter for JournalMaxGroupWaitMSec/JOURNAL_MAX_GROUP_WAIT_M\u2026\n\nAdd a setter for JournalMaxGroupWaitMSec configuration property\n\n- [x] Make sure the PR title is formatted like:\n    `<Issue # or BOOKKEEPER-#>: Description of pull request`\n    `e.g. Issue 123: Description ...`\n    `e.g. BOOKKEEPER-1234: Description ...`\n- [x] Make sure tests pass via `mvn clean apache-rat:check install findbugs:check`.\n- [x] Replace `<Issue # or BOOKKEEPER-#>` in the title with the actual Issue/JIRA number.\n\n---\n\nAuthor: Enrico Olivelli <eolivelli@apache.org>\n\nReviewers: Jia Zhai <None>\n\nThis closes #236 from eolivelli/JOURNAL_MAX_GROUP_WAIT_MSEC, closes #235\n", "commitGitStats": [{"lines": 12, "deletions": 0, "insertions": 12, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java"}], "commitParents": ["9aff6d52e01b50f25f5dbe1086ff10012ca25c48"], "commitDateTime": "2017-07-09 15:36:11", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-07-09 15:36:11"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/bookie", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Setter for JournalMaxGroupWaitMSec/JOURNAL_MAX_GROUP_WAIT_MSEC is missing", "numCommits": 0, "body": "ServerConfiguration misses the setter method for JOURNAL_MAX_GROUP_WAIT_MSEC\r\nthere is only getJournalMaxGroupWaitMSec", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"3b33d636a058f211e1cc24b748dc9888256899c6": {"commitUser": "jiazhai", "commitGHEventType": "closed"}}, "closed": "2017-07-09 07:36:25", "url": "https://github.com/apache/bookkeeper/issues/235", "user": "eolivelli", "ttf": 1.0002777777777778}, {"created": "2017-06-30 06:28:03", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0.0, "DEL": 0.0, "TOT": 0.0, "spoonMethodsChanged": 0, "MOV": 0.0, "UPD": 0.0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BookieNettyServer.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieNettyServer"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieNettyServer.shutdown()"}]}], "nameRev": "450629d4314cf467fbf78da2d2a43840d0ccf783 tags/release-4.6.2~265", "commitHash": "450629d4314cf467fbf78da2d2a43840d0ccf783", "commitMessage": "ISSUE #221: Make netty server shutdown idempotent\n\nDescriptions of the changes in this PR:\n\n(see the detailed discussion in #221 )\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Enrico Olivelli <None>, Jia Zhai <None>\n\nThis closes #222 from sijie/make_shutdown_idempotent, closes #221\n", "commitGitStats": [{"lines": 7, "deletions": 0, "insertions": 7, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieNettyServer.java"}], "commitParents": ["1b0492bf2ac547cf583736d3eaf9849498e42f80"], "commitDateTime": "2017-07-01 15:05:43", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-07-01 15:05:43"}, {"commitSpoonAstDiffStats": [], "nameRev": "1ff17d899f9998cdefc99c47f0f38a75b99d1c0e tags/release-4.6.2~178", "commitHash": "1ff17d899f9998cdefc99c47f0f38a75b99d1c0e", "commitMessage": "ISSUE #431 ISSUE #221: merge scripts should mark milestone when merging pull requests\n\nDescriptions of the changes in this PR:\n\nimprove merge script to do:\n\n- assign a milestone\n- add `area/` label\n- add `type/` label\n- add `release/` label\n- when a change needs to merge to a different branch, add the bug fix `release/` label\n\nThis also addresses #221 to trim the template from pull request body.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Jia Zhai <zhaijia03@gmail.com>\n\nThis closes #437 from sijie/merge_script_for_bug_releases, closes #431, closes #221\n", "commitGitStats": [{"lines": 6, "deletions": 6, "insertions": 0, "filePath": ".github/ISSUE_TEMPLATE.md"}, {"lines": 254, "deletions": 12, "insertions": 242, "filePath": "dev/bk-merge-pr.py"}, {"lines": 24, "deletions": 12, "insertions": 12, "filePath": ".github/PULL_REQUEST_TEMPLATE.md"}], "commitParents": ["b4a1c76054c54d05d38a89399efa716201a2206b"], "commitDateTime": "2017-08-11 15:19:32", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-08-11 15:19:32"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "priority/blocker", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "TestAuth#testCloseMethodCalledOnAuthProvider is failing ", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nRun TestAuth.\r\n\r\n- What did you expect to see?\r\n\r\nThe test should pass.\r\n\r\n- What did you see instead?\r\n\r\nThe test failed. Because the shutdown is called twice after this change 9ddd9e6f9e48b03a57a2c78ec2630303abd49782 . So the assertion fails.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 2, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"450629d4314cf467fbf78da2d2a43840d0ccf783": {"commitUser": "jiazhai", "commitGHEventType": "closed"}, "1ff17d899f9998cdefc99c47f0f38a75b99d1c0e": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2017-07-01 07:05:59", "url": "https://github.com/apache/bookkeeper/issues/221", "user": "sijie", "ttf": 1.0002777777777778}, {"created": "2017-06-29 19:12:25", "closed": "2019-08-18 16:58:33", "title": "NPE at TestLongZkLedgerIdGenerator.testGenerateLedgerId", "url": "https://github.com/apache/bookkeeper/issues/218", "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\nI found the failed test case in CI build. https://builds.apache.org/job/bookkeeper-precommit-pullrequest/90\r\n\r\n- What did you expect to see?\r\n\r\nThe test should pass.\r\n\r\n- What did you see instead?\r\n\r\n`\r\n2017-06-28 23:28:33,840 - ERROR - [Thread-4:NIOServerCnxnFactory$1@92] - Thread Thread[Thread-4,5,main] died\r\njava.lang.NullPointerException\r\n\tat org.apache.bookkeeper.meta.LongZkLedgerIdGenerator.generateLongLedgerId(LongZkLedgerIdGenerator.java:198)\r\n\tat org.apache.bookkeeper.meta.LongZkLedgerIdGenerator.createHOBPathAndGenerateId(LongZkLedgerIdGenerator.java:147)\r\n\tat org.apache.bookkeeper.meta.LongZkLedgerIdGenerator.generateLongLedgerId(LongZkLedgerIdGenerator.java:186)\r\n\tat org.apache.bookkeeper.meta.LongZkLedgerIdGenerator.generateLongLedgerId(LongZkLedgerIdGenerator.java:182)\r\n\tat org.apache.bookkeeper.meta.LongZkLedgerIdGenerator.generateLedgerId(LongZkLedgerIdGenerator.java:320)\r\n`\r\n\r\n", "commits": {}, "user": "sijie", "commitsDetails": [], "labels": ["area/tests", "help wanted", "low hanging fruit", "triage/18-w11", "type/bug"], "ttf": 779.0002777777778}, {"created": "2017-06-22 17:52:30", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "LedgerDirsManager.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerDirsManager.pickRandomDir(java.io.File)"}]}, {"spoonFilePath": "IndexPersistenceMgr.java", "spoonMethods": [{"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexPersistenceMgr.getNewLedgerIndexFile(java.lang.Long,java.io.File,boolean)"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexPersistenceMgr.getNewLedgerIndexFile(java.lang.Long,java.io.File)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.IndexPersistenceMgr.getFileInfo(java.lang.Long,byte[])"}]}, {"spoonFilePath": "LedgerDescriptorImpl.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerDescriptorImpl.fenceAndLogInJournal(org.apache.bookkeeper.bookie.Journal)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerDescriptorImpl"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerDescriptorImpl.logFenceEntryInJournal(org.apache.bookkeeper.bookie.Journal)"}]}, {"spoonFilePath": "LedgerDescriptor.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerDescriptor.fenceAndLogInJournal(org.apache.bookkeeper.bookie.Journal)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.bookie.LedgerDescriptor.createLedgerFenceEntry(java.lang.Long)"}]}, {"spoonFilePath": "Bookie.java", "spoonMethods": [{"INS": 1, "DEL": 3, "TOT": 7, "MOV": 1, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.bookie.Bookie.fenceLedger(long,byte[])"}]}], "nameRev": "c49621bacaa960d240afbbee83a9703b4cbc3ec2 tags/release-4.6.2~254", "commitHash": "c49621bacaa960d240afbbee83a9703b4cbc3ec2", "commitMessage": "ISSUE #208: Improve ledger fence logic\n\nDescriptions of the changes in this PR:\n\nProblem:\n    When bookie receive a fence request and couldn't find any writable dirs for the new index file, it will throw exception. This behavior can be improved, because as long as ledger fence request be persisted in Journal, we can say the fence request succeed. It should not depends on the success of flushing new index file.\n\nSolution:\n\n- Add option to fall back to pick from all directories regardless of writable or not when we getFileInfo for a new ledger\n- Return success only when ledger fence request has been persisted in Journal\n\n---\nBe sure to do all of the following to help us incorporate your contribution\nquickly and easily:\n\n- [x] Make sure the PR title is formatted like:\n    `<Issue #>: Description of pull request`\n    `e.g. Issue 123: Description ...`\n- [x] Make sure tests pass via `mvn clean apache-rat:check install findbugs:check`.\n- [x] Replace `<Issue #>` in the title with the actual Issue number, if there is one.\n\n---\n\nAuthor: Sijie Guo <sijie@apache.org>\nAuthor: Yiming Zang <yzang@twitter.com>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>\n\nThis closes #205 from sijie/improve_fencing_behavior, closes #208\n", "commitGitStats": [{"lines": 58, "deletions": 2, "insertions": 56, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerDescriptorImpl.java"}, {"lines": 24, "deletions": 23, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java"}, {"lines": 35, "deletions": 2, "insertions": 33, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/IndexPersistenceMgr.java"}, {"lines": 11, "deletions": 2, "insertions": 9, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerDirsManager.java"}, {"lines": 20, "deletions": 1, "insertions": 19, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerDescriptor.java"}], "commitParents": ["ccf83ed5bd49155697e909e13edb572082e838ec"], "commitDateTime": "2017-07-17 13:47:37", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-07-17 13:47:37"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Improve fencing logic", "numCommits": 0, "body": "\r\n**BUG REPORT**\r\n\r\n1. Please describe the issue you observed:\r\n\r\n- What did you do?\r\n\r\n- What did you expect to see?\r\n\r\nWhen bookie receive a fence request and couldn't find any writable dirs for the new index file, it will throw exception. This behavior can be improved, because as long as ledger fence request be persisted in Journal, we can say the fence request succeed. It should not depends on the success of flushing new index file.\r\n\r\n- What did you see instead?\r\n\r\nFence failed when bookies are in readonly.\r\n\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"c49621bacaa960d240afbbee83a9703b4cbc3ec2": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-07-17 20:47:46", "url": "https://github.com/apache/bookkeeper/issues/208", "user": "sijie", "ttf": 25.00027777777778}, {"created": "2017-06-22 17:44:54", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "TestSpeculativeRead.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 9, "MOV": 1, "UPD": 7, "spoonMethodName": "org.apache.bookkeeper.client.TestSpeculativeRead.testSpeculativeReadScheduling()"}]}, {"spoonFilePath": "TestSequenceRead.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.TestSequenceRead"}]}, {"spoonFilePath": "PendingReadOp.java", "spoonMethods": [{"INS": 0, "DEL": 0, "TOT": 1, "MOV": 1, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.SequenceReadRequest.getSentToBitSet()"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.LedgerEntryRequest.complete(int,org.apache.bookkeeper.net.BookieSocketAddress,io.netty.buffer.ByteBuf)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.SequenceReadRequest.logErrorAndReattemptRead(org.apache.bookkeeper.net.BookieSocketAddress,java.lang.String,int)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.ParallelReadRequest.read()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.LedgerEntryRequest.maybeSendSpeculativeRead(java.util.Set)"}, {"INS": 0, "DEL": 0, "TOT": 4, "MOV": 3, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.SequenceReadRequest.getReplicaIndex(org.apache.bookkeeper.net.BookieSocketAddress)"}, {"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.readEntryComplete(int,long,long,io.netty.buffer.ByteBuf,java.lang.Object)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.SequenceReadRequest.sendNextRead()"}, {"INS": 0, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.ParallelReadRequest.maybeSendSpeculativeRead(java.util.Set)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.SequenceReadRequest.logErrorAndReattemptRead(int,org.apache.bookkeeper.net.BookieSocketAddress,java.lang.String,int)"}, {"INS": 0, "DEL": 1, "TOT": 3, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.SequenceReadRequest.maybeSendSpeculativeRead(java.util.Set)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.ParallelReadRequest.logErrorAndReattemptRead(int,org.apache.bookkeeper.net.BookieSocketAddress,java.lang.String,int)"}, {"INS": 1, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.submitCallback(int)"}, {"INS": 0, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.SequenceReadRequest.getHeardFromBitSet(java.util.Set)"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.sendReadTo(org.apache.bookkeeper.net.BookieSocketAddress,org.apache.bookkeeper.client.PendingReadOp$LedgerEntryRequest)"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.sendReadTo(int,org.apache.bookkeeper.net.BookieSocketAddress,org.apache.bookkeeper.client.PendingReadOp$LedgerEntryRequest)"}, {"INS": 2, "DEL": 0, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp"}, {"INS": 0, "DEL": 0, "TOT": 5, "MOV": 2, "UPD": 3, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.initiate().1.run()"}, {"INS": 3, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.ReadContext"}, {"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.client.PendingReadOp.LedgerEntryRequest.logErrorAndReattemptRead(int,org.apache.bookkeeper.net.BookieSocketAddress,java.lang.String,int)"}]}], "nameRev": "75aca2397e43ec321a049aaec514c99cc9fad235 tags/release-4.6.2~269", "commitHash": "75aca2397e43ec321a049aaec514c99cc9fad235", "commitMessage": "ISSUE #207: change the HashSet to BitSet to handle duplicated bookies on reading entries\n\nDescriptions of the changes in this PR:\n\nProblem:\n\nIf there happens to have duplicated bookies in same ledger (it happened before when ensemble change still has problem), the read doesn't work as expected. It hang forever.\n\nSolution:\n\nChange the HashSet to BitSet to use bookieIndex rather than InetSocketAddress to track the heardfrom bookies set.\n\n---\nBe sure to do all of the following to help us incorporate your contribution\nquickly and easily:\n\n- [x] Make sure the PR title is formatted like:\n    `<Issue #>: Description of pull request`\n    `e.g. Issue 123: Description ...`\n- [x] Make sure tests pass via `mvn clean apache-rat:check install findbugs:check`.\n- [x] Replace `<Issue #>` in the title with the actual Issue number, if there is one.\n\n---\n\nAuthor: Sijie Guo <sijie@apache.org>\nAuthor: Sijie Guo <sijieg@twitter.com>\n\nReviewers: Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>, Matteo Merli <mmerli@apache.org>\n\nThis closes #199 from sijie/client_changes/bitset, closes #207\n", "commitGitStats": [{"lines": 83, "deletions": 42, "insertions": 41, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java"}, {"lines": 20, "deletions": 9, "insertions": 11, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestSpeculativeRead.java"}, {"lines": 94, "deletions": 0, "insertions": 94, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestSequenceRead.java"}], "commitParents": ["b9648998802ce4bf256e33ffd6296b4c973a4824"], "commitDateTime": "2017-06-29 14:57:16", "commitUser": "sijie", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-06-29 14:57:16"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/client", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "Change the HashSet to BitSet to handle duplicated bookies on reading entries", "numCommits": 0, "body": "Problem:\r\n\r\nIf there happens to have duplicated bookies in same ledger (it happened before when ensemble change still has problem), the read doesn't work as expected. It hang forever.\r\n", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 1, "duplicated": 0, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"75aca2397e43ec321a049aaec514c99cc9fad235": {"commitUser": "sijie", "commitGHEventType": "closed"}}, "closed": "2017-06-29 21:57:25", "url": "https://github.com/apache/bookkeeper/issues/207", "user": "sijie", "ttf": 7.000277777777778}, {"created": "2017-06-21 14:20:15", "spoonStatsSummary": {"spoonFilesChanged": 0, "INS": 0, "DEL": 0, "TOT": 0, "spoonMethodsChanged": 0, "MOV": 0, "UPD": 0}, "commitsDetails": [{"commitSpoonAstDiffStats": [{"spoonFilePath": "BookieProtoEncoding.java", "spoonMethods": [{"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieProtoEncoding.ResponseEnDeCoderPreV3.decode(io.netty.buffer.ByteBuf)"}]}], "nameRev": "1b0492bf2ac547cf583736d3eaf9849498e42f80 tags/release-4.6.2~266", "commitHash": "1b0492bf2ac547cf583736d3eaf9849498e42f80", "commitMessage": "ISSUE #198: TestBackwardCompat.testCompat410 often fails due to io.netty.util.IllegalReferenceCountException\n\nDescriptions of the changes in this PR:\n\nProblem:\n\nin TestBackwardCompat#testCompact400, the test is to verify the current client can't talk to a 4.0.0 server.\n\nThe 4.5.0 client is sending a protobuf encoded request to 4.0.0 server. The 4.0.0 server will interpret the 4.5.0 protobuf encoded request, but it will realize this is bad request and sending v2 protocol encoded response. because the request is a bad request, 4.0.0 server sent a response back with unknown op code.\n\nIn current v2 ResponseEnDecoder (listed as below), when it doesn't know the op code, it will return the buffer to the channel. this might cause the misbehavior in the channel pipeline to decrement reference count.\n\nSolution:\n\nthrow exception in the EnDeCoder when receiving unknown op code. so the netty can close the connection, error out the pending requests and cleaning up the resources.\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Matteo Merli <None>\n\nThis closes #219 from sijie/issue_198, closes #198\n", "commitGitStats": [{"lines": 2, "deletions": 1, "insertions": 1, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtoEncoding.java"}], "commitParents": ["5e399df67c2aa1e5f228c62ba8533ca3293ab147"], "commitDateTime": "2017-06-30 13:10:42", "commitUser": "jiazhai", "commitGHEventType": "closed", "spoonStatsSkippedReason": "", "authoredDateTime": "2017-06-30 13:10:42"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "BookieProtoEncodingTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieProtoEncodingTest"}]}, {"spoonFilePath": "TestBackwardCompatCMS42.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42"}, {"INS": 0, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 4, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42.testAuthSingleMessage()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42.CompatClient42.pollResponse()"}, {"INS": 2, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42.newCompatClient(org.apache.bookkeeper.net.BookieSocketAddress)"}, {"INS": 1, "DEL": 1, "TOT": 3, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42.CompatClient42.channelRead(io.netty.channel.ChannelHandlerContext,java.lang.Object)"}, {"INS": 0, "DEL": 0, "TOT": 7, "MOV": 0, "UPD": 7, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42.testAuthFail()"}, {"INS": 5, "DEL": 0, "TOT": 5, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42.CompatClient42"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42.CompatClient42.takeResponse()"}, {"INS": 0, "DEL": 0, "TOT": 5, "MOV": 0, "UPD": 5, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42.testAuthMultiMessage()"}, {"INS": 0, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42.CompatClient42.sendRequest(org.apache.bookkeeper.proto.Request)"}]}, {"spoonFilePath": "BookieProtoEncoding.java", "spoonMethods": [{"INS": 2, "DEL": 1, "TOT": 5, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.proto.BookieProtoEncoding.ResponseDecoder"}, {"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieProtoEncoding.RequestEnDeCoderPreV3.decode(io.netty.buffer.ByteBuf)"}, {"INS": 1, "DEL": 2, "TOT": 5, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieProtoEncoding.ResponseDecoder.decode(io.netty.channel.ChannelHandlerContext,java.lang.Object,java.util.List)"}]}, {"spoonFilePath": "PerChannelBookieClient.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.PerChannelBookieClient.connect().4.initChannel(io.netty.channel.Channel)"}]}], "nameRev": "3a999226e10936951c7081df3b6d8b54204dfdc2 tags/release-4.6.2~13", "commitHash": "3a999226e10936951c7081df3b6d8b54204dfdc2", "commitMessage": "Disable using v2 decoder to decode v3 response if usingV2WireProtocol is enabled and handle unknown op in v2 request decoder\n\nDescriptions of the changes in this PR:\n\n*Problem*\n\n- response decoder should use whatever protocol that request is using to decode the response. otherwise it is making wrong assumption on response protocol.\n- v2 request decoder doesn't handle unknown op correctly, which will cause netty double-release bytebuf\n\n*Solution*\n\n- make sure response decoder respect the protocol that client is using for sending requests\n- v2 request decoder should throw exceptions when fail to decode unknown request\n\nRelated issues: #198\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>, Matteo Merli <mmerli@apache.org>\n\nThis closes #1240 from sijie/bookkeeper_fix_bytebuf_issues\n\n(cherry picked from commit 59e48a390c1caa12adb7cc89afd2f9d48790a674)\nSigned-off-by: Sijie Guo <sijie@apache.org>\n", "commitGitStats": [{"lines": 4, "deletions": 1, "insertions": 3, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java"}, {"lines": 121, "deletions": 0, "insertions": 121, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/proto/BookieProtoEncodingTest.java"}, {"lines": 21, "deletions": 13, "insertions": 8, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtoEncoding.java"}, {"lines": 51, "deletions": 18, "insertions": 33, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/proto/TestBackwardCompatCMS42.java"}], "commitParents": ["cc5770d60f06e09f3b032dcdec266234a20eab97"], "commitDateTime": "2018-03-10 00:25:18", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-03-10 00:13:57"}, {"commitSpoonAstDiffStats": [{"spoonFilePath": "BookieProtoEncodingTest.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieProtoEncodingTest"}]}, {"spoonFilePath": "TestBackwardCompatCMS42.java", "spoonMethods": [{"INS": 0, "DEL": 1, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42"}, {"INS": 4, "DEL": 0, "TOT": 4, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42.CompatClient42"}, {"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42.CompatClient42.channelRead(io.netty.channel.ChannelHandlerContext,java.lang.Object)"}, {"INS": 2, "DEL": 0, "TOT": 3, "MOV": 0, "UPD": 1, "spoonMethodName": "org.apache.bookkeeper.proto.TestBackwardCompatCMS42.newCompatClient(org.apache.bookkeeper.net.BookieSocketAddress)"}]}, {"spoonFilePath": "BookieProtoEncoding.java", "spoonMethods": [{"INS": 2, "DEL": 1, "TOT": 5, "MOV": 0, "UPD": 2, "spoonMethodName": "org.apache.bookkeeper.proto.BookieProtoEncoding.ResponseDecoder"}, {"INS": 1, "DEL": 1, "TOT": 2, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieProtoEncoding.RequestEnDeCoderPreV3.decode(io.netty.buffer.ByteBuf)"}, {"INS": 1, "DEL": 2, "TOT": 5, "MOV": 2, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.BookieProtoEncoding.ResponseDecoder.decode(io.netty.channel.ChannelHandlerContext,java.lang.Object,java.util.List)"}]}, {"spoonFilePath": "PerChannelBookieClient.java", "spoonMethods": [{"INS": 1, "DEL": 0, "TOT": 1, "MOV": 0, "UPD": 0, "spoonMethodName": "org.apache.bookkeeper.proto.PerChannelBookieClient.connect().4.initChannel(io.netty.channel.Channel)"}]}], "nameRev": "59e48a390c1caa12adb7cc89afd2f9d48790a674 tags/release-4.8.1~293", "commitHash": "59e48a390c1caa12adb7cc89afd2f9d48790a674", "commitMessage": "Disable using v2 decoder to decode v3 response if usingV2WireProtocol is enabled and handle unknown op in v2 request decoder\n\nDescriptions of the changes in this PR:\n\n*Problem*\n\n- response decoder should use whatever protocol that request is using to decode the response. otherwise it is making wrong assumption on response protocol.\n- v2 request decoder doesn't handle unknown op correctly, which will cause netty double-release bytebuf\n\n*Solution*\n\n- make sure response decoder respect the protocol that client is using for sending requests\n- v2 request decoder should throw exceptions when fail to decode unknown request\n\nRelated issues: #198\n\nAuthor: Sijie Guo <sijie@apache.org>\n\nReviewers: Ivan Kelly <ivank@apache.org>, Enrico Olivelli <eolivelli@gmail.com>, Jia Zhai <None>, Matteo Merli <mmerli@apache.org>\n\nThis closes #1240 from sijie/bookkeeper_fix_bytebuf_issues\n", "commitGitStats": [{"lines": 4, "deletions": 1, "insertions": 3, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java"}, {"lines": 121, "deletions": 0, "insertions": 121, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/proto/BookieProtoEncodingTest.java"}, {"lines": 21, "deletions": 13, "insertions": 8, "filePath": "bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtoEncoding.java"}, {"lines": 22, "deletions": 6, "insertions": 16, "filePath": "bookkeeper-server/src/test/java/org/apache/bookkeeper/proto/TestBackwardCompatCMS42.java"}], "commitParents": ["f0757e9ac643d6f36a11be4065d163437180cb7e"], "commitDateTime": "2018-03-10 00:13:57", "commitUser": "sijie", "commitGHEventType": "referenced", "spoonStatsSkippedReason": "", "authoredDateTime": "2018-03-10 00:13:57"}], "changesInPackagesSPOON": [], "gitStatsSummary": {"lines": 0, "gitFilesChange": 0, "deletions": 0, "insertions": 0}, "statsSkippedReason": "", "labels": ["area/tests", "priority/blocker", "type/bug"], "filteredCommits": [], "changesInPackagesGIT": [], "title": "TestBackwardCompat.testCompat410 often fails due to io.netty.util.IllegalReferenceCountException", "numCommits": 0, "body": "The test is failing very often on Jenkins.\r\nIt is a bug related to Netty 4 buffers usage\r\n\r\n> Error\r\n> Shouldn't be able to write\r\n> Stacktrace\r\n> java.lang.AssertionError: Shouldn't be able to write\r\n> \tat org.apache.bookkeeper.test.TestBackwardCompat.testCompat410(TestBackwardCompat.java:647)\r\n> \r\n\r\n```\r\n2017-06-21 12:52:51,207 - WARN  - [bookkeeper-io-0:Slf4JLogger@151] - An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception.\r\nio.netty.util.IllegalReferenceCountException: refCnt: 0, decrement: 1\r\n\tat io.netty.buffer.AbstractReferenceCountedByteBuf.release0(AbstractReferenceCountedByteBuf.java:101)\r\n\tat io.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:89)\r\n\tat io.netty.util.ReferenceCountUtil.release(ReferenceCountUtil.java:84)\r\n\tat io.netty.channel.DefaultChannelPipeline.onUnhandledInboundMessage(DefaultChannelPipeline.java:1169)\r\n\tat io.netty.channel.DefaultChannelPipeline$TailContext.channelRead(DefaultChannelPipeline.java:1221)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat org.apache.bookkeeper.proto.PerChannelBookieClient.channelRead(PerChannelBookieClient.java:1175)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat io.netty.channel.ChannelInboundHandlerAdapter.channelRead(ChannelInboundHandlerAdapter.java:86)\r\n\tat org.apache.bookkeeper.proto.AuthHandler$ClientSideHandler.channelRead(AuthHandler.java:272)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:102)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:293)\r\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:267)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:340)\r\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1334)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:348)\r\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:926)\r\n\tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:1017)\r\n\tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:394)\r\n\tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:299)\r\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:858)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n```", "filteredCommitsReason": {"moreThanOneParent": 0, "multipleIssueFixes": 2, "duplicated": 1, "alsoFixesPhrase": 0, "mergeCommitUsed": 0, "unavailable": 0}, "commits": {"1b0492bf2ac547cf583736d3eaf9849498e42f80": {"commitUser": "jiazhai", "commitGHEventType": "closed"}, "3a999226e10936951c7081df3b6d8b54204dfdc2": {"commitUser": "sijie", "commitGHEventType": "referenced"}, "59e48a390c1caa12adb7cc89afd2f9d48790a674": {"commitUser": "sijie", "commitGHEventType": "referenced"}}, "closed": "2017-06-30 05:10:56", "url": "https://github.com/apache/bookkeeper/issues/198", "user": "eolivelli", "ttf": 8.000277777777777}], "projectName": "apache/bookkeeper"}